var utils,base,Laya=window.Laya=function(window){var Laya={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(ofs,sz){return 1==arguments.length?Laya.__presubstr.call(this,ofs):Laya.__presubstr.call(this,ofs,0<sz?sz:this.length+sz)},__init:function(_classs){_classs.forEach(function(o){o.__init$&&o.__init$()})},__isClass:function(o){return o&&(o.__isclass||o==Object||o==String||o==Array)},__newvec:function(sz,value){var d=[];d.length=sz;for(var i=0;i<sz;i++)d[i]=value;return d},__extend:function(d,b){for(var p in b){var gs,g,s;b.hasOwnProperty(p)&&(g=(gs=Object.getOwnPropertyDescriptor(b,p)).get,s=gs.set,g||s?g&&s?Object.defineProperty(d,p,gs):(g&&Object.defineProperty(d,p,g),s&&Object.defineProperty(d,p,s)):d[p]=b[p])}function __(){Laya.un(this,"constructor",d)}__.prototype=b.prototype,d.prototype=new __,Laya.un(d.prototype,"__imps",Laya.__copy({},b.prototype.__imps))},__copy:function(dec,src){if(!src)return null;for(var i in dec=dec||{},src)dec[i]=src[i];return dec},__package:function(name,o){if(!Laya.__packages[name]){Laya.__packages[name]=!0;var p=window,strs=name.split(".");if(1<strs.length)for(var i=0,sz=strs.length-1;i<sz;i++)var c=p[strs[i]],p=c||(p[strs[i]]={});p[strs[strs.length-1]]||(p[strs[strs.length-1]]=o||{})}},__hasOwnProperty:function(name,o){return o=o||this,Object.hasOwnProperty.call(o,name)||function classHas(name,o){return!!Object.hasOwnProperty.call(o.prototype,name)||(null==(o=o.prototype.__super)?null:classHas(name,o))}(name,o.__class)},__typeof:function(o,value){if(!o||!value)return!1;if(value===String)return"string"==typeof o;if(value===Number)return"number"==typeof o;if(value.__interface__)value=value.__interface__;else if("string"!=typeof value)return o instanceof value;return o.__imps&&o.__imps[value]||o.__class==value},__as:function(value,type){return this.__typeof(value,type)?value:null},__int:function(value){return value?parseInt(value):0},interface:function(name,_super){Laya.__package(name,{});var ins=Laya.__internals,a=ins[name]=ins[name]||{self:name};if(_super){var supers=_super.split(",");a.extend=[];for(var i=0;i<supers.length;i++){var nm=supers[i];ins[nm]=ins[nm]||{self:nm},a.extend.push(ins[nm])}}for(var o=window,words=name.split("."),i=0;i<words.length-1;i++)o=o[words[i]];o[words[words.length-1]]={__interface__:name}},class:function(o,fullName,_super,miniName){_super&&Laya.__extend(o,_super),fullName&&(Laya.__package(fullName,o),Laya.__classmap[fullName]=o,0<fullName.indexOf(".")?0==fullName.indexOf("laya.")&&(paths=fullName.split("."),miniName=miniName||paths[paths.length-1],Laya[miniName]&&console.log("Warning!,this class["+miniName+"] already exist:",Laya[miniName]),Laya[miniName]=o):"Main"==fullName?window.Main=o:(Laya[fullName]&&console.log("Error!,this class["+fullName+"] already exist:",Laya[fullName]),Laya[fullName]=o));var paths=Laya.un,miniName=o.prototype;paths(miniName,"hasOwnProperty",Laya.__hasOwnProperty),paths(miniName,"__class",o),paths(miniName,"__super",_super),paths(miniName,"__className",fullName),paths(o,"__super",_super),paths(o,"__className",fullName),paths(o,"__isclass",!0),paths(o,"super",function(o){this.__super.call(o)})},imps:function(dec,src){if(!src)return null;var i,d=dec.__imps||Laya.un(dec,"__imps",{});for(i in src)!function __(name){var c,exs;if((c=Laya.__internals[name])&&(d[name]=!0,exs=c.extend))for(var i=0;i<exs.length;i++)__(exs[i].self)}(i)},superSet:function(clas,o,prop,value){clas=clas.prototype["_$set_"+prop];clas&&clas.call(o,value)},superGet:function(clas,o,prop){clas=clas.prototype["_$get_"+prop];return clas?clas.call(o):null},getset:function(isStatic,o,name,getfn,setfn){isStatic?(getfn&&(o["_$GET_"+name]=getfn),setfn&&(o["_$SET_"+name]=setfn)):(getfn&&Laya.un(o,"_$get_"+name,getfn),setfn&&Laya.un(o,"_$set_"+name,setfn)),getfn&&setfn?Object.defineProperty(o,name,{get:getfn,set:setfn,enumerable:!1,configurable:!0}):(getfn&&Object.defineProperty(o,name,{get:getfn,enumerable:!1,configurable:!0}),setfn&&Object.defineProperty(o,name,{set:setfn,enumerable:!1,configurable:!0}))},static:function(_class,def){for(var i=0,sz=def.length;i<sz;i+=2)"length"==def[i]?_class.length=def[i+1].call(_class):function(){var name=def[i],getfn=def[i+1];Object.defineProperty(_class,name,{get:function(){return delete this[name],this[name]=getfn.call(this)},set:function(v){delete this[name],this[name]=v},enumerable:!0,configurable:!0})}()},un:function(obj,name,value){return value=value||obj[name],Laya.__propun.value=value,Object.defineProperty(obj,name,Laya.__propun),value},uns:function(obj,names){names.forEach(function(o){Laya.un(obj,o)})}};return window.console=window.console||{log:function(){}},window.trace=window.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),Laya}(window,document),__extends=(!function(Laya){Laya.un,Laya.uns,Laya.static,Laya.class,Laya.getset,Laya.__newvec}((window,document,Laya)),!function(window,document,Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,RunDriver=(Laya.__newvec,Laya.interface("laya.runtime.IMarket"),Laya.interface("laya.filters.IFilter"),Laya.interface("laya.display.ILayout"),Laya.interface("laya.resource.IDispose"),Laya.interface("laya.runtime.IPlatform"),Laya.interface("laya.resource.IDestroy"),Laya.interface("laya.runtime.IConchNode"),Laya.interface("laya.filters.IFilterAction"),Laya.interface("laya.runtime.ICPlatformClass"),Laya.interface("laya.resource.ICreateResource"),Laya.interface("laya.runtime.IConchRenderObject"),Laya.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform"),function(){function RunDriver(){}return __class(RunDriver,"laya.utils.RunDriver"),RunDriver.FILTER_ACTIONS=[],RunDriver.pixelRatio=-1,RunDriver._charSizeTestDiv=null,RunDriver.now=function(){return Date.now()},RunDriver.getWindow=function(){return window},RunDriver.getPixelRatio=function(){var ctx;return RunDriver.pixelRatio=RunDriver.pixelRatio<0&&(ctx=(ctx=Browser.context).backingStorePixelRatio||ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1,(RunDriver.pixelRatio=(Browser.window.devicePixelRatio||1)/ctx)<1)?1:RunDriver.pixelRatio},RunDriver.getIncludeStr=function(name){return null},RunDriver.createShaderCondition=function(conditionScript){return Laya._runScript("(function() {return "+conditionScript+";})")},RunDriver.fontMap=[],RunDriver.measureText=function(txt,font){var ctx,isChinese=RunDriver.hanzi.test(txt);return isChinese&&RunDriver.fontMap[font]?RunDriver.fontMap[font]:((ctx=Browser.context).font=font,ctx=ctx.measureText(txt),isChinese&&(RunDriver.fontMap[font]=ctx),ctx)},RunDriver.getWebGLContext=function(canvas){},RunDriver.beginFlush=function(){},RunDriver.endFinish=function(){},RunDriver.addToAtlas=null,RunDriver.flashFlushImage=function(atlasWebGLCanvas){},RunDriver.drawToCanvas=function(sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){var canvas=HTMLCanvas.create("2D"),canvasWidth=new RenderContext(canvasWidth,canvasHeight,canvas);return RenderSprite.renders[_renderType]._fun(sprite,canvasWidth,offsetX,offsetY),canvas},RunDriver.createParticleTemplate2D=null,RunDriver.createGLTextur=null,RunDriver.createWebGLContext2D=null,RunDriver.changeWebGLSize=function(w,h){},RunDriver.createRenderSprite=function(type,next){return new RenderSprite(type,next)},RunDriver.createFilterAction=function(type){return new ColorFilterAction},RunDriver.createGraphics=function(){return new Graphics},RunDriver.clear=function(value){Render._context.ctx.clear()},RunDriver.cancelLoadByUrl=function(url){},RunDriver.clearAtlas=function(value){},RunDriver.isAtlas=function(bitmap){return!1},RunDriver.addTextureToAtlas=function(value){},RunDriver.getTexturePixels=function(value,x,y,width,height){return null},RunDriver.skinAniSprite=function(){return null},RunDriver.update3DLoop=function(){},__static(RunDriver,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),RunDriver}()),Config=(__getset(1,Laya,"alertGlobalError",null,function(value){var erralert=0;Browser.window.onerror=value?function(msg,url,line,column,detail){erralert++<5&&detail&&alert(detail.stack||detail)}:null}),Laya.init=function(width,height,__plugins){for(var plugins=[],i=2,sz=arguments.length;i<sz;i++)plugins.push(arguments[i]);if(!Laya._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=Laya._arrayBufferSlice),Laya._isinit=!0,Browser.__init__(),Context.__init__(),Graphics.__init__(),Laya.timer=new Timer,Laya.scaleTimer=new Timer,Laya.loader=new LoaderManager,WeakObject.__init__();for(var i=0,n=plugins.length;i<n;i++)plugins[i].enable&&plugins[i].enable();return Font.__init__(),Style.__init__(),ResourceManager.__init__(),CacheManager.beginCheck(),Laya._currentStage=Laya.stage=new Stage,Laya.stage.conchModel&&Laya.stage.conchModel.setRootNode(),Laya._getUrlPath(),Laya.render=new Render(0,0),Laya.stage.size(width,height),RenderSprite.__init__(),KeyBoardManager.__init__(),MouseManager.instance.__init__(Laya.stage,Render.canvas),Input.__init__(),SoundManager.autoStopMusic=!0,LocalStorage.__init__(),Render.canvas}},Laya._getUrlPath=function(){var location=Browser.window.location,pathName=":"==(pathName=location.pathname).charAt(2)?pathName.substring(1):pathName;URL.rootPath=URL.basePath=URL.getPath("file:"==location.protocol?pathName:location.protocol+"//"+location.host+location.pathname)},Laya._arrayBufferSlice=function(start,end){end=new Uint8Array(this,start,end-start),start=new Uint8Array(end.length);return start.set(end),start.buffer},Laya._runScript=function(script){return Browser.window[Laya._evcode](script)},Laya.stage=null,Laya.timer=null,Laya.scaleTimer=null,Laya.loader=null,Laya.version="1.7.20.1beta",Laya.render=null,Laya._currentStage=null,Laya._isinit=!1,Laya.MiniAdpter={init:function(){window.navigator&&window.navigator.userAgent&&-1<window.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},__static(Laya,["conchMarket",function(){return this.conchMarket=window.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=window.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function Config(){}return __class(Config,"Config"),Config.WebGLTextCacheCount=500,Config.atlasEnable=!1,Config.showCanvasMark=!1,Config.animationInterval=50,Config.isAntialias=!1,Config.isAlpha=!1,Config.premultipliedAlpha=!0,Config.isStencil=!0,Config.preserveDrawingBuffer=!1,Config}()),EventDispatcher=function(){function EventDispatcher(){this._events=null}__class(EventDispatcher,"laya.events.EventDispatcher");var __proto=EventDispatcher.prototype;return __proto.hasListener=function(type){return!!(this._events&&this._events[type])},__proto.event=function(type,data){if(!this._events||!this._events[type])return!1;var node,list=this._events[type];if(list.lock)list.queue||(list.queue=[]),list.queue.push(data);else{for(list.lock=!0,list.cursor=list.head;list.cursor;)node=list.cursor,list.cursor=node.next,node.once&&EventDispatcher.delNode(list,node),null!=data?node.args?node.method.apply(node.caller,node.args.concat(data)):data instanceof Array?node.method.apply(node.caller,data):node.method.call(node.caller,data):node.method.apply(node.caller,node.args),node.once&&EventDispatcher.recoverHandler(node);list.lock=!1,!list.head&&this._events&&this._events[type]==list&&delete this._events[type],list.queue&&list.queue.length&&this.event(type,list.queue.shift())}return!0},__proto.on=function(type,caller,listener,args){return this._createListener(type,caller,listener,args,!1)},__proto.once=function(type,caller,listener,args){return this._createListener(type,caller,listener,args,!0)},__proto._createListener=function(type,caller,listener,args,once,offBefore){(offBefore=void 0===offBefore?!0:offBefore)&&this.off(type,caller,listener,once);offBefore=EventDispatcher.createHandler(caller||this,listener,args,once),this._events||(this._events={}),caller=this._events,listener=caller[type];return listener?listener.tail?(offBefore.prev=listener.tail,listener.tail.next=offBefore,listener.tail=offBefore):listener.head=listener.tail=offBefore:caller[type]={head:offBefore,tail:offBefore,cursor:null,lock:!1},this},__proto.off=function(type,caller,listener,onceOnly){if(void 0===onceOnly&&(onceOnly=!1),this._events&&this._events[type])for(var list=this._events[type],node=list.head;node;){if((!caller||node.caller===caller)&&node.method===listener&&(!onceOnly||node.once)){EventDispatcher.delNode(list,node),list.cursor==node&&(list.cursor=node.next),EventDispatcher.recoverHandler(node);break}node=node.next}return this},__proto.offAll=function(type){var events=this._events;if(events)if(type)this._recoverHandlers(events[type]),delete events[type];else{for(var name in events)this._recoverHandlers(events[name]);this._events=null}return this},__proto._recoverHandlers=function(list){if(list){for(var node=list.head;node;){EventDispatcher.delNode(list,node);var next=node.next;EventDispatcher.recoverHandler(node),node=next}list.cursor=null}},__proto.isMouseEvent=function(type){return EventDispatcher.MOUSE_EVENTS[type]},EventDispatcher.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},EventDispatcher.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},EventDispatcher.delNode=function(list,node){node.prev?node.prev.next=node.next:list.head=node.next,node.next?node.next.prev=node.prev:list.tail=node.prev},EventDispatcher.createHandler=function(caller,method,args,once){var result=EventDispatcher._freeHandler;return result?(EventDispatcher._freeCount--,EventDispatcher._freeHandler=result.next,result.caller=caller,result.method=method,result.args=args,result.once=once):result={caller:caller,method:method,args:args,once:once},result.prev=result.next=null,result},EventDispatcher.recoverHandler=function(handler){handler.caller=handler.method=handler.args=handler.prev=null,handler.next=EventDispatcher._freeHandler,EventDispatcher._freeHandler=handler,EventDispatcher._freeCount++},EventDispatcher._freeHandler=null,EventDispatcher._freeCount=0,EventDispatcher}(),Handler=function(){function Handler(caller,method,args,once){this.once=!1,this._id=0,this.setTo(caller,method,args,once=void 0===once?!1:once)}__class(Handler,"laya.utils.Handler");var __proto=Handler.prototype;return __proto.setTo=function(caller,method,args,once){return this._id=Handler._gid++,this.caller=caller,this.method=method,this.args=args,this.once=once,this},__proto.run=function(){var id,result;return null==this.method?null:(id=this._id,result=this.method.apply(this.caller,this.args),this._id===id&&this.once&&this.recover(),result)},__proto.runWith=function(data){var id;return null==this.method?null:(id=this._id,data=null==data?this.method.apply(this.caller,this.args):this.args||data.unshift?this.args?this.method.apply(this.caller,this.args.concat(data)):this.method.apply(this.caller,data):this.method.call(this.caller,data),this._id===id&&this.once&&this.recover(),data)},__proto.clear=function(){return this.caller=null,this.method=null,this.args=null,this},__proto.recover=function(){0<this._id&&(this._id=0,this.clear())},Handler.create=function(caller,method,args,once){return new Handler(caller,method,args,once=void 0===once?!0:once)},Handler._gid=1,Handler}(),BitmapFont=function(){function BitmapFont(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}__class(BitmapFont,"laya.display.BitmapFont");var __proto=BitmapFont.prototype;return __proto.loadFont=function(path,complete){this._path=path,this._complete=complete,Laya.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],Handler.create(this,this.onLoaded))},__proto.onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},__proto.parseFont=function(xml,texture){if(null!=xml&&null!=texture){this._texture=texture;var tInfo=xml.getElementsByTagName("info");if(!tInfo[0].getAttributeNode)return this.parseFont2(xml,texture);this.fontSize=parseInt(tInfo[0].getAttributeNode("size").nodeValue);for(var chars,tInfo=tInfo[0].getAttributeNode("padding").nodeValue.split(","),i=(this._padding=[parseInt(tInfo[0]),parseInt(tInfo[1]),parseInt(tInfo[2]),parseInt(tInfo[3])],chars=xml.getElementsByTagName("char"),0),i=0;i<chars.length;i++){var tAttribute=chars[i],tId=parseInt(tAttribute.getAttributeNode("id").nodeValue),xOffset=+parseInt(tAttribute.getAttributeNode("xoffset").nodeValue),yOffset=+parseInt(tAttribute.getAttributeNode("yoffset").nodeValue),xAdvance=+parseInt(tAttribute.getAttributeNode("xadvance").nodeValue),region=new Rectangle,tAttribute=(region.x=parseInt(tAttribute.getAttributeNode("x").nodeValue),region.y=parseInt(tAttribute.getAttributeNode("y").nodeValue),region.width=parseInt(tAttribute.getAttributeNode("width").nodeValue),region.height=parseInt(tAttribute.getAttributeNode("height").nodeValue),Texture.create(texture,region.x,region.y,region.width,region.height,xOffset,yOffset));this._maxWidth=Math.max(this._maxWidth,xAdvance+this.letterSpacing),this._fontCharDic[tId]=tAttribute,this._fontWidthMap[tId]=xAdvance}}},__proto.parseFont2=function(xml,texture){if(null!=xml&&null!=texture){this._texture=texture;var tInfo=xml.getElementsByTagName("info");this.fontSize=parseInt(tInfo[0].attributes.size.nodeValue);for(var tInfo=tInfo[0].attributes.padding.nodeValue.split(","),chars=(this._padding=[parseInt(tInfo[0]),parseInt(tInfo[1]),parseInt(tInfo[2]),parseInt(tInfo[3])],xml.getElementsByTagName("char")),i=0,i=0;i<chars.length;i++){var tAttribute=chars[i].attributes,tId=parseInt(tAttribute.id.nodeValue),xOffset=+parseInt(tAttribute.xoffset.nodeValue),yOffset=+parseInt(tAttribute.yoffset.nodeValue),xAdvance=+parseInt(tAttribute.xadvance.nodeValue),region=new Rectangle,tAttribute=(region.x=parseInt(tAttribute.x.nodeValue),region.y=parseInt(tAttribute.y.nodeValue),region.width=parseInt(tAttribute.width.nodeValue),region.height=parseInt(tAttribute.height.nodeValue),Texture.create(texture,region.x,region.y,region.width,region.height,xOffset,yOffset));this._maxWidth=Math.max(this._maxWidth,xAdvance+this.letterSpacing),this._fontCharDic[tId]=tAttribute,this._fontWidthMap[tId]=xAdvance}}},__proto.getCharTexture=function(char){return this._fontCharDic[char.charCodeAt(0)]},__proto.destroy=function(){if(this._texture){for(var p in this._fontCharDic){p=this._fontCharDic[p];p&&p.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},__proto.setSpaceWidth=function(spaceWidth){this._spaceWidth=spaceWidth},__proto.getCharWidth=function(char){var code=char.charCodeAt(0);return this._fontWidthMap[code]?this._fontWidthMap[code]+this.letterSpacing:" "==char?this._spaceWidth+this.letterSpacing:0},__proto.getTextWidth=function(text){for(var tWidth=0,i=0,n=text.length;i<n;i++)tWidth+=this.getCharWidth(text.charAt(i));return tWidth},__proto.getMaxWidth=function(){return this._maxWidth},__proto.getMaxHeight=function(){return this.fontSize},__proto.drawText=function(text,sprite,drawX,drawY,align,width){for(var tTexture,tWidth=this.getTextWidth(text),dx="right"===align?width-tWidth:"center"===align?(width-tWidth)/2:0,tX=0,i=0,n=text.length;i<n;i++)(tTexture=this.getCharTexture(text.charAt(i)))&&(sprite.graphics.drawTexture(tTexture,drawX+tX+dx,drawY),tX+=this.getCharWidth(text.charAt(i)))},BitmapFont}(),Style=function(){function Style(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=Style._TF_EMPTY}__class(Style,"laya.display.css.Style");var __proto=Style.prototype;return __proto.getTransform=function(){return this._tf},__proto.setTransform=function(value){this._tf="none"!==value&&value?value:Style._TF_EMPTY},__proto.setTranslateX=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateX=value},__proto.setTranslateY=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateY=value},__proto.setScaleX=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=value},__proto.setScale=function(x,y){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=x,this._tf.scaleY=y},__proto.setScaleY=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleY=value},__proto.setRotate=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.rotate=value},__proto.setSkewX=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.skewX=value},__proto.setSkewY=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.skewY=value},__proto.destroy=function(){this.scrollRect=null},__proto.render=function(sprite,context,x,y){},__proto.getCSSStyle=function(){return CSSStyle.EMPTY},__proto._enableLayout=function(){return!1},__getset(0,__proto,"scaleX",function(){return this._tf.scaleX},function(value){this.setScaleX(value)}),__getset(0,__proto,"transform",function(){return this.getTransform()},function(value){this.setTransform(value)}),__getset(0,__proto,"translateX",function(){return this._tf.translateX},function(value){this.setTranslateX(value)}),__getset(0,__proto,"translateY",function(){return this._tf.translateY},function(value){this.setTranslateY(value)}),__getset(0,__proto,"scaleY",function(){return this._tf.scaleY},function(value){this.setScaleY(value)}),__getset(0,__proto,"block",function(){return 0!=(1&this._type)}),__getset(0,__proto,"skewY",function(){return this._tf.skewY},function(value){this.setSkewY(value)}),__getset(0,__proto,"rotate",function(){return this._tf.rotate},function(value){this.setRotate(value)}),__getset(0,__proto,"skewX",function(){return this._tf.skewX},function(value){this.setSkewX(value)}),__getset(0,__proto,"paddingLeft",function(){return 0}),__getset(0,__proto,"paddingTop",function(){return 0}),__getset(0,__proto,"absolute",function(){return!0}),Style.__init__=function(){Style._TF_EMPTY=new TransformInfo,Style.EMPTY=new Style},Style.EMPTY=null,Style._TF_EMPTY=null,Style}(),Font=function(){function Font(src){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=Color.create(Font.defaultColor),this.family=Font.defaultFamily,this.stroke=Font._STROKE,this.size=Font.defaultSize,src&&src!==Font.EMPTY&&src.copyTo(this)}__class(Font,"laya.display.css.Font");var __proto=Font.prototype;return __proto.set=function(value){this._text=null;for(var strs=value.split(" "),i=0,n=strs.length;i<n;i++){var str=strs[i];switch(str){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<str.indexOf("px")&&(this.size=parseInt(str),this.family=strs[i+1],i++)}},__proto.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},__proto.copyTo=function(dec){dec._type=this._type,dec._text=this._text,dec._weight=this._weight,dec._color=this._color,dec.family=this.family,dec.stroke=this.stroke!=Font._STROKE?this.stroke.slice():Font._STROKE,dec.indent=this.indent,dec.size=this.size},__getset(0,__proto,"password",function(){return 0!=(1024&this._type)},function(value){value?this._type|=1024:this._type&=-1025}),__getset(0,__proto,"color",function(){return this._color.strColor},function(value){this._color=Color.create(value)}),__getset(0,__proto,"italic",function(){return 0!=(512&this._type)},function(value){value?this._type|=512:this._type&=-513}),__getset(0,__proto,"bold",function(){return 0!=(2048&this._type)},function(value){value?this._type|=2048:this._type&=-2049}),__getset(0,__proto,"weight",function(){return""+this._weight},function(value){var weight=0;switch(value){case"normal":break;case"bold":this.bold=!0,weight=700;break;case"bolder":weight=800;break;case"lighter":weight=100;break;default:weight=parseInt(value)}this._weight=weight,this._text=null}),__getset(0,__proto,"decoration",function(){return this._decoration?this._decoration.value:null},function(value){var strs=value.split(" ");switch(this._decoration||(this._decoration={}),strs[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=strs[0]}strs[1]&&(this._decoration.color=Color.create(strs)),this._decoration.value=value}),Font.__init__=function(){Font.EMPTY=new Font(null)},Font.EMPTY=null,Font.defaultColor="#000000",Font.defaultSize=12,Font.defaultFamily="Arial",Font.defaultFont="12px Arial",Font._STROKE=[0,"#000000"],Font._ITALIC=512,Font._PASSWORD=1024,Font._BOLD=2048,Font}(),TransformInfo=function(){function TransformInfo(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return __class(TransformInfo,"laya.display.css.TransformInfo"),TransformInfo}(),Graphics=function(){function Graphics(){this._one=null,this._cmds=null,this._render=this._renderEmpty,Render.isConchNode&&(this._nativeObj=new window._conchGraphics,this.id=this._nativeObj.conchID)}__class(Graphics,"laya.display.Graphics");var __proto=Graphics.prototype;return __proto.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},__proto.clear=function(recoverCmds){var i=0,len=0;if(recoverCmds=void 0===recoverCmds?!1:recoverCmds){var tCmd=this._one;if(this._cmds){for(len=this._cmds.length,i=0;i<len;i++)!(tCmd=this._cmds[i])||tCmd.callee!==Render._context._drawTexture&&tCmd.callee!==Render._context._drawTextureWithTransform||(tCmd[0]=null,Graphics._cache.push(tCmd));this._cmds.length=0}else!tCmd||tCmd.callee!==Render._context._drawTexture&&tCmd.callee!==Render._context._drawTextureWithTransform||(tCmd[0]=null,Graphics._cache.push(tCmd))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(i=0,len=this._vectorgraphArray.length;i<len;i++)VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[i]);this._vectorgraphArray.length=0}},__proto._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},__proto._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new GraphicsBounds,this._graphicBounds._graphics=this)},__proto._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},__proto._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},__proto.getBounds=function(realSize){return void 0===realSize&&(realSize=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(realSize)},__proto.getBoundPoints=function(realSize){return void 0===realSize&&(realSize=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(realSize)},__proto._addCmd=function(a){this._cmds=this._cmds||[],a.callee=a.shift(),this._cmds.push(a)},__proto.setFilters=function(fs){this._saveToCmd(Render._context._setFilters,fs)},__proto.drawTexture=function(tex,x,y,width,height,m,alpha){if(void 0===x&&(x=0),void 0===y&&(y=0),void 0===alpha&&(alpha=1),!tex||alpha<.01)return null;width=(width=void 0===width?0:width)||tex.sourceWidth,height=(height=void 0===height?0:height)||tex.sourceHeight,alpha=alpha<0?0:1<alpha?1:alpha;var args,offset=!Render.isWebGL&&(Browser.onFirefox||Browser.onEdge||Browser.onIE||Browser.onSafari)?.5:0,wRate=width/tex.sourceWidth,hRate=height/tex.sourceHeight;return width=tex.width*wRate,height=tex.height*hRate,tex.loaded&&(width<=0||height<=0)?null:(x+=tex.offsetX*wRate,y+=tex.offsetY*hRate,this._sp&&(this._sp._renderType|=512),x-=offset,y-=offset,width+=2*offset,height+=2*offset,Graphics._cache.length?((args=Graphics._cache.pop())[0]=tex,args[1]=x,args[2]=y,args[3]=width,args[4]=height,args[5]=m,args[6]=alpha):args=[tex,x,y,width,height,m,alpha],args.callee=m||1!=alpha?Render._context._drawTextureWithTransform:Render._context._drawTexture,null!=this._one||m||1!=alpha?this._saveToCmd(args.callee,args):(this._one=args,this._render=this._renderOneImg),tex.loaded||tex.once("loaded",this,this._textureLoaded,[tex,args]),this._repaint(),args)},__proto.cleanByTexture=function(tex,x,y,width,height){if(void 0===width&&(width=0),void 0===height&&(height=0),!tex)return this.clear();var wRate,hRate;this._one&&this._render===this._renderOneImg?(width=width||tex.sourceWidth,height=height||tex.sourceHeight,wRate=width/tex.sourceWidth,hRate=height/tex.sourceHeight,width=tex.width*wRate,height=tex.height*hRate,x+=tex.offsetX*wRate,y+=tex.offsetY*hRate,this._one[0]=tex,this._one[1]=x,this._one[2]=y,this._one[3]=width,this._one[4]=height,this._repaint()):(this.clear(),tex&&this.drawTexture(tex,x,y,width,height))},__proto.drawTextures=function(tex,pos){tex&&this._saveToCmd(Render._context._drawTextures,[tex,pos])},__proto.fillTexture=function(tex,x,y,width,height,type,offset){void 0===width&&(width=0),void 0===height&&(height=0),void 0===type&&(type="repeat"),tex&&(x=[tex,x,y,width,height,type,offset||Point.EMPTY,{}],tex.loaded||tex.once("loaded",this,this._textureLoaded,[tex,x]),this._saveToCmd(Render._context._fillTexture,x))},__proto._textureLoaded=function(tex,param){param[3]=param[3]||tex.width,param[4]=param[4]||tex.height,this._repaint()},__proto.fillCircle=function(x,y,tex,cx,cy,radius,segNum){tex.bitmap.enableMerageInAtlas=!1;for(var verts=new Float32Array(2*(segNum+1)),uvs=new Float32Array(2*(segNum+1)),indices=new Uint16Array(3*segNum),dang=2*Math.PI/segNum,cang=0,idx=(verts[0]=cx,verts[1]=cy,uvs[0]=cx/tex.width,uvs[1]=cy/tex.height,2),i=0;i<segNum;i++){var px=radius*Math.cos(cang)+cx,py=radius*Math.sin(cang)+cy;verts[idx]=px,verts[idx+1]=py,uvs[idx]=px/tex.width,uvs[idx+1]=py/tex.height,cang+=dang,idx+=2}for(i=idx=0;i<segNum;i++)indices[idx++]=0,indices[idx++]=i+1,indices[idx++]=segNum+1<=i+2?1:i+2;this.drawTriangles(tex,x,y,verts,uvs,indices)},__proto.drawTriangles=function(texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){this._saveToCmd(Render._context.drawTriangles,[texture,x,y,vertices,uvs,indices,matrix,alpha=void 0===alpha?1:alpha,color,blendMode])},__proto._saveToCmd=function(fun,args){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=args,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(args)),args.callee=fun,this._repaint(),args},__proto.clipRect=function(x,y,width,height){this._saveToCmd(Render._context._clipRect,[x,y,width,height])},__proto.fillText=function(text,x,y,font,color,textAlign,underLine){void 0===underLine&&(underLine=0),this._saveToCmd(Render._context._fillText,[text,x,y,font||Font.defaultFont,color,textAlign])},__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){this._saveToCmd(Render._context._fillBorderText,[text,x,y,font||Font.defaultFont,fillColor,borderColor,lineWidth,textAlign])},__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){this._saveToCmd(Render._context._strokeText,[text,x,y,font||Font.defaultFont,color,lineWidth,textAlign])},__proto.alpha=function(value){this._saveToCmd(Render._context._alpha,[value=value<0?0:1<value?1:value])},__proto.setAlpha=function(value){this._saveToCmd(Render._context._setAlpha,[value=value<0?0:1<value?1:value])},__proto.transform=function(matrix,pivotX,pivotY){this._saveToCmd(Render._context._transform,[matrix,pivotX=void 0===pivotX?0:pivotX,pivotY=void 0===pivotY?0:pivotY])},__proto.rotate=function(angle,pivotX,pivotY){this._saveToCmd(Render._context._rotate,[angle,pivotX=void 0===pivotX?0:pivotX,pivotY=void 0===pivotY?0:pivotY])},__proto.scale=function(scaleX,scaleY,pivotX,pivotY){this._saveToCmd(Render._context._scale,[scaleX,scaleY,pivotX=void 0===pivotX?0:pivotX,pivotY=void 0===pivotY?0:pivotY])},__proto.translate=function(x,y){this._saveToCmd(Render._context._translate,[x,y])},__proto.save=function(){this._saveToCmd(Render._context._save,[])},__proto.restore=function(){this._saveToCmd(Render._context._restore,[])},__proto.replaceText=function(text){this._repaint();var cmds=this._cmds;if(cmds){for(var i=cmds.length-1;-1<i;i--)if(this._isTextCmd(cmds[i].callee))return cmds[i][0].toUpperCase?cmds[i][0]=text:cmds[i][0].setText(text),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=text:this._one[0].setText(text),!0;return!1},__proto._isTextCmd=function(fun){return fun===Render._context._fillText||fun===Render._context._fillBorderText||fun===Render._context._strokeText},__proto.replaceTextColor=function(color){this._repaint();var cmds=this._cmds;if(cmds)for(var i=cmds.length-1;-1<i;i--)this._isTextCmd(cmds[i].callee)&&(cmds[i][4]=color,cmds[i][0].toUpperCase||(cmds[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=color,this._one[0].toUpperCase||(this._one[0].changed=!0))},__proto.loadImage=function(url,x,y,width,height,complete){var _$this=this,tex=(void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),Loader.getRes(url));function onloaded(tex){tex&&(_$this.drawTexture(tex,x,y,width,height),null!=complete)&&complete.call(_$this._sp,tex)}tex?onloaded(tex):Laya.loader.load(url,Handler.create(null,onloaded),null,"image")},__proto._renderEmpty=function(sprite,context,x,y){},__proto._renderAll=function(sprite,context,x,y){for(var cmd,cmds=this._cmds,i=0,n=cmds.length;i<n;i++)(cmd=cmds[i]).callee.call(context,x,y,cmd)},__proto._renderOne=function(sprite,context,x,y){this._one.callee.call(context,x,y,this._one)},__proto._renderOneImg=function(sprite,context,x,y){this._one.callee.call(context,x,y,this._one),2305!==sprite._renderType&&(sprite._renderType|=1)},__proto.drawLine=function(fromX,fromY,toX,toY,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var tId=0,offset=(Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId)),lineWidth%2==0?0:.5);this._saveToCmd(Render._context._drawLine,[fromX+offset,fromY+offset,toX+offset,toY+offset,lineColor,lineWidth,tId])},__proto.drawLines=function(x,y,points,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var tId=0;!points||points.length<4||(Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId)),this._saveToCmd(Render._context._drawLines,[x+(x=lineWidth%2==0?0:.5),y+x,points,lineColor,lineWidth,tId]))},__proto.drawCurves=function(x,y,points,lineColor,lineWidth){this._saveToCmd(Render._context._drawCurves,[x,y,points,lineColor,lineWidth=void 0===lineWidth?1:lineWidth])},__proto.drawRect=function(x,y,width,height,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var offset=lineColor?lineWidth/2:0,lineOffset=lineColor?lineWidth:0;this._saveToCmd(Render._context._drawRect,[x+offset,y+offset,width-lineOffset,height-lineOffset,fillColor,lineColor,lineWidth])},__proto.drawCircle=function(x,y,radius,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var offset=lineColor?lineWidth/2:0,tId=0,x=(Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId)),[x,y,radius-offset,fillColor,lineColor,lineWidth,tId]);this._saveToCmd(Render._context._drawCircle,x)},__proto.drawPie=function(x,y,radius,startAngle,endAngle,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var offset=lineColor?lineWidth/2:0,lineOffset=lineColor?lineWidth:0,tId=0,x=(Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId)),[x+offset,y+offset,radius-lineOffset,startAngle,endAngle,fillColor,lineColor,lineWidth,tId]);x[3]=Utils.toRadian(startAngle),x[4]=Utils.toRadian(endAngle),this._saveToCmd(Render._context._drawPie,x)},__proto.drawPoly=function(x,y,points,fillColor,lineColor,lineWidth){void 0===lineWidth&&(lineWidth=1);var tId=0,tIsConvexPolygon=!1,offset=(Render.isWebGL&&(tId=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(tId),tIsConvexPolygon=!(6<points.length)),!lineColor||lineWidth%2==0?0:.5);this._saveToCmd(Render._context._drawPoly,[x+offset,y+offset,points,fillColor,lineColor,lineWidth,tId,tIsConvexPolygon])},__proto.drawPath=function(x,y,paths,brush,pen){this._saveToCmd(Render._context._drawPath,[x,y,paths,brush,pen])},__getset(0,__proto,"cmds",function(){return this._cmds},function(value){this._sp&&(this._sp._renderType|=512),this._cmds=value,this._render=this._renderAll,this._repaint()}),Graphics.__init__=function(){if(Render.isConchNode){for(var from=laya.display.Graphics.prototype,to=Browser.window.ConchGraphics.prototype,list=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],i=0,len=list.length;i<=len;i++){var temp=list[i];from[temp]=to[temp]}from._saveToCmd=null,to.drawImageS&&(from.drawTextures=function(tex,pos){var uv,w,h;tex&&tex.loaded&&tex.bitmap&&tex.source&&(uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height,this.drawImageS(tex.bitmap.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,tex.offsetX,tex.offsetY,tex.width,tex.height,pos))}),from.drawTexture=function(tex,x,y,width,height,m,alpha){var uv,w,h;void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),void 0===alpha&&(alpha=1),tex&&(tex.loaded?tex.loaded&&tex.bitmap&&tex.source&&(width=width||tex.sourceWidth,height=height||tex.sourceHeight,alpha=alpha<0?0:1<alpha?1:alpha,width=width-tex.sourceWidth+tex.width,height=height-tex.sourceHeight+tex.height,width<=0||height<=0||(x+=tex.offsetX,y+=tex.offsetY,uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height,uv[4]<uv[0]&&uv[5]<uv[1]?this.drawImageM(tex.bitmap.source,uv[4]*w,uv[5]*h,(uv[0]-uv[4])*w,(uv[1]-uv[5])*h,x,y,width,height,m,alpha):this.drawImageM(tex.bitmap.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x,y,width,height,m,alpha),this._repaint())):tex.once("loaded",this,function(){this.drawTexture(tex,x,y,width,height,m)}))},from.fillTexture=function(tex,x,y,width,height,type,offset){var ctxi,w,uv,h;void 0===width&&(width=0),void 0===height&&(height=0),void 0===type&&(type="repeat"),tex&&tex.loaded&&(ctxi=Render._context.ctx,w=tex.bitmap.width,h=tex.bitmap.height,uv=tex.uv,w=tex.uv!=Texture.DEF_UV?ctxi.createPattern(tex.bitmap.source,type,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h):ctxi.createPattern(tex.bitmap.source,type),h=uv=0,offset&&(x+=offset.x%tex.width,y+=offset.y%tex.height,uv-=offset.x%tex.width,h-=offset.y%tex.height),this._fillImage(w,x,y,uv,h,width,height))}}},Graphics._cache=[],Graphics}(),GraphicsBounds=function(){function GraphicsBounds(){this._cacheBoundsType=!1}__class(GraphicsBounds,"laya.display.GraphicsBounds");var __proto=GraphicsBounds.prototype;return __proto.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},__proto.reset=function(){this._temp&&(this._temp.length=0)},__proto.getBounds=function(realSize){return void 0===realSize&&(realSize=!1),this._bounds&&this._temp&&!(this._temp.length<1)&&realSize==this._cacheBoundsType||(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(realSize),this._bounds)),this._cacheBoundsType=realSize,this._bounds},__proto.getBoundPoints=function(realSize){return void 0===realSize&&(realSize=!1),(!this._temp||this._temp.length<1||realSize!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(realSize)),this._cacheBoundsType=realSize,this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp)},__proto._getCmdPoints=function(realSize){void 0===realSize&&(realSize=!1);var context=Render._context,cmds=this._graphics.cmds,rst=this._temp||(this._temp=[]);if(rst.length=0,cmds||null==this._graphics._one||(GraphicsBounds._tempCmds.length=0,GraphicsBounds._tempCmds.push(this._graphics._one),cmds=GraphicsBounds._tempCmds),cmds){var matrixs=GraphicsBounds._tempMatrixArrays;matrixs.length=0;for(var cmd,tex,tMatrix=GraphicsBounds._initMatrix,tempMatrix=(tMatrix.identity(),GraphicsBounds._tempMatrix),wRate=NaN,hRate=NaN,oWidth=NaN,oHeight=NaN,offX=NaN,offY=NaN,i=0,n=cmds.length;i<n;i++)if((cmd=cmds[i]).callee)switch(cmd.callee){case context._save:case 7:matrixs.push(tMatrix),tMatrix=tMatrix.clone();break;case context._restore:case 8:tMatrix=matrixs.pop();break;case context._scale:case 5:tempMatrix.identity(),tempMatrix.translate(-cmd[2],-cmd[3]),tempMatrix.scale(cmd[0],cmd[1]),tempMatrix.translate(cmd[2],cmd[3]),this._switchMatrix(tMatrix,tempMatrix);break;case context._rotate:case 3:tempMatrix.identity(),tempMatrix.translate(-cmd[1],-cmd[2]),tempMatrix.rotate(cmd[0]),tempMatrix.translate(cmd[1],cmd[2]),this._switchMatrix(tMatrix,tempMatrix);break;case context._translate:case 6:tempMatrix.identity(),tempMatrix.translate(cmd[0],cmd[1]),this._switchMatrix(tMatrix,tempMatrix);break;case context._transform:case 4:tempMatrix.identity(),tempMatrix.translate(-cmd[1],-cmd[2]),tempMatrix.concat(cmd[0]),tempMatrix.translate(cmd[1],cmd[2]),this._switchMatrix(tMatrix,tempMatrix);break;case 16:case 24:GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tMatrix);break;case 17:tMatrix.copyTo(tempMatrix),tempMatrix.concat(cmd[4]),GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tempMatrix);break;case context._drawTexture:tex=cmd[0],realSize?cmd[3]&&cmd[4]?GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix):(tex=cmd[0],GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),tMatrix)):(wRate=(cmd[3]||tex.sourceWidth)/tex.width,hRate=(cmd[4]||tex.sourceHeight)/tex.height,oWidth=wRate*tex.sourceWidth,oHeight=hRate*tex.sourceHeight,offX=0<tex.offsetX?tex.offsetX:0,offY=0<tex.offsetY?tex.offsetY:0,offX*=wRate,offY*=hRate,GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1]-offX,cmd[2]-offY,oWidth,oHeight),tMatrix));break;case context._fillTexture:cmd[3]&&cmd[4]?GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix):(tex=cmd[0],GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),tMatrix));break;case context._drawTextureWithTransform:var drawMatrix=cmd[5]?(tMatrix.copyTo(tempMatrix),tempMatrix.concat(cmd[5]),tempMatrix):tMatrix;realSize?cmd[3]&&cmd[4]?GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),drawMatrix):(tex=cmd[0],GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),drawMatrix)):(tex=cmd[0],wRate=(cmd[3]||tex.sourceWidth)/tex.width,hRate=(cmd[4]||tex.sourceHeight)/tex.height,oWidth=wRate*tex.sourceWidth,oHeight=hRate*tex.sourceHeight,offX=0<tex.offsetX?tex.offsetX:0,offY=0<tex.offsetY?tex.offsetY:0,offX*=wRate,offY*=hRate,GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1]-offX,cmd[2]-offY,oWidth,oHeight),drawMatrix));break;case context._drawRect:case 13:GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tMatrix);break;case context._drawCircle:case context._fillCircle:case 14:GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0]-cmd[2],cmd[1]-cmd[2],cmd[2]+cmd[2],cmd[2]+cmd[2]),tMatrix);break;case context._drawLine:case 20:GraphicsBounds._tempPoints.length=0;drawMatrix=.5*cmd[5];cmd[0]==cmd[2]?GraphicsBounds._tempPoints.push(cmd[0]+drawMatrix,cmd[1],cmd[2]+drawMatrix,cmd[3],cmd[0]-drawMatrix,cmd[1],cmd[2]-drawMatrix,cmd[3]):cmd[1]==cmd[3]?GraphicsBounds._tempPoints.push(cmd[0],cmd[1]+drawMatrix,cmd[2],cmd[3]+drawMatrix,cmd[0],cmd[1]-drawMatrix,cmd[2],cmd[3]-drawMatrix):GraphicsBounds._tempPoints.push(cmd[0],cmd[1],cmd[2],cmd[3]),GraphicsBounds._addPointArrToRst(rst,GraphicsBounds._tempPoints,tMatrix);break;case context._drawCurves:case 22:GraphicsBounds._addPointArrToRst(rst,Bezier.I.getBezierPoints(cmd[2]),tMatrix,cmd[0],cmd[1]);break;case context._drawPoly:case context._drawLines:case 18:GraphicsBounds._addPointArrToRst(rst,cmd[2],tMatrix,cmd[0],cmd[1]);break;case context._drawPath:case 19:GraphicsBounds._addPointArrToRst(rst,this._getPathPoints(cmd[2]),tMatrix,cmd[0],cmd[1]);break;case context._drawPie:case 15:GraphicsBounds._addPointArrToRst(rst,this._getPiePoints(cmd[0],cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix)}200<rst.length?rst=Utils.copyArray(rst,Rectangle._getWrapRec(rst)._getBoundPoints()):8<rst.length&&(rst=GrahamScan.scanPList(rst))}return rst},__proto._switchMatrix=function(tMatix,tempMatrix){tempMatrix.concat(tMatix),tempMatrix.copyTo(tMatix)},__proto._getPiePoints=function(x,y,radius,startAngle,endAngle){var rst=GraphicsBounds._tempPoints;GraphicsBounds._tempPoints.length=0,rst.push(x,y);for(var step=(endAngle-startAngle)%(2*Math.PI)/10,i=NaN,angle=startAngle,i=0;i<=10;i++)rst.push(x+radius*Math.cos(angle),y+radius*Math.sin(angle)),angle+=step;return rst},__proto._getPathPoints=function(paths){var len,tCMD,i=0,rst=GraphicsBounds._tempPoints;for(rst.length=0,len=paths.length,i=0;i<len;i++)1<(tCMD=paths[i]).length&&(rst.push(tCMD[1],tCMD[2]),3<tCMD.length)&&rst.push(tCMD[3],tCMD[4]);return rst},GraphicsBounds._addPointArrToRst=function(rst,points,matrix,dx,dy){void 0===dx&&(dx=0),void 0===dy&&(dy=0);for(var i=0,len=points.length,i=0;i<len;i+=2)GraphicsBounds._addPointToRst(rst,points[i]+dx,points[i+1]+dy,matrix)},GraphicsBounds._addPointToRst=function(rst,x,y,matrix){var _tempPoint=Point.TEMP;_tempPoint.setTo(x||0,y||0),matrix.transformPoint(_tempPoint),rst.push(_tempPoint.x,_tempPoint.y)},GraphicsBounds._tempPoints=[],GraphicsBounds._tempMatrixArrays=[],GraphicsBounds._tempCmds=[],__static(GraphicsBounds,["_tempMatrix",function(){return this._tempMatrix=new Matrix},"_initMatrix",function(){return this._initMatrix=new Matrix}]),GraphicsBounds}(),Event=function(){function Event(){}__class(Event,"laya.events.Event");var __proto=Event.prototype;return __proto.setTo=function(type,currentTarget,target){return this.type=type,this.currentTarget=currentTarget,this.target=target,this},__proto.stopPropagation=function(){this._stoped=!0},__getset(0,__proto,"stageY",function(){return Laya.stage.mouseY}),__getset(0,__proto,"charCode",function(){return this.nativeEvent.charCode}),__getset(0,__proto,"touches",function(){var arr=this.nativeEvent.touches;if(arr)for(var stage=Laya.stage,i=0,n=arr.length;i<n;i++){var e=arr[i],point=Point.TEMP;point.setTo(e.clientX,e.clientY),stage._canvasTransform.invertTransformPoint(point),stage.transform.invertTransformPoint(point),e.stageX=point.x,e.stageY=point.y}return arr}),__getset(0,__proto,"keyLocation",function(){return this.nativeEvent.keyLocation}),__getset(0,__proto,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),__getset(0,__proto,"altKey",function(){return this.nativeEvent.altKey}),__getset(0,__proto,"shiftKey",function(){return this.nativeEvent.shiftKey}),__getset(0,__proto,"stageX",function(){return Laya.stage.mouseX}),Event.EMPTY=new Event,Event.MOUSE_DOWN="mousedown",Event.MOUSE_UP="mouseup",Event.CLICK="click",Event.RIGHT_MOUSE_DOWN="rightmousedown",Event.RIGHT_MOUSE_UP="rightmouseup",Event.RIGHT_CLICK="rightclick",Event.MOUSE_MOVE="mousemove",Event.MOUSE_OVER="mouseover",Event.MOUSE_OUT="mouseout",Event.MOUSE_WHEEL="mousewheel",Event.ROLL_OVER="mouseover",Event.ROLL_OUT="mouseout",Event.DOUBLE_CLICK="doubleclick",Event.CHANGE="change",Event.CHANGED="changed",Event.RESIZE="resize",Event.ADDED="added",Event.REMOVED="removed",Event.DISPLAY="display",Event.UNDISPLAY="undisplay",Event.ERROR="error",Event.COMPLETE="complete",Event.LOADED="loaded",Event.PROGRESS="progress",Event.INPUT="input",Event.RENDER="render",Event.OPEN="open",Event.MESSAGE="message",Event.CLOSE="close",Event.KEY_DOWN="keydown",Event.KEY_PRESS="keypress",Event.KEY_UP="keyup",Event.FRAME="enterframe",Event.DRAG_START="dragstart",Event.DRAG_MOVE="dragmove",Event.DRAG_END="dragend",Event.ENTER="enter",Event.SELECT="select",Event.BLUR="blur",Event.FOCUS="focus",Event.VISIBILITY_CHANGE="visibilitychange",Event.FOCUS_CHANGE="focuschange",Event.PLAYED="played",Event.PAUSED="paused",Event.STOPPED="stopped",Event.START="start",Event.END="end",Event.ENABLE_CHANGED="enablechanged",Event.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",Event.COMPONENT_ADDED="componentadded",Event.COMPONENT_REMOVED="componentremoved",Event.LAYER_CHANGED="layerchanged",Event.HIERARCHY_LOADED="hierarchyloaded",Event.RECOVERED="recovered",Event.RELEASED="released",Event.LINK="link",Event.LABEL="label",Event.FULL_SCREEN_CHANGE="fullscreenchange",Event.DEVICE_LOST="devicelost",Event.MESH_CHANGED="meshchanged",Event.MATERIAL_CHANGED="materialchanged",Event.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",Event.ANIMATION_CHANGED="animationchanged",Event.TRIGGER_ENTER="triggerenter",Event.TRIGGER_STAY="triggerstay",Event.TRIGGER_EXIT="triggerexit",Event.TRAIL_FILTER_CHANGE="trailfilterchange",Event.DOMINO_FILTER_CHANGE="dominofilterchange",Event}(),KeyBoardManager=(function(){function Keyboard(){}__class(Keyboard,"laya.events.Keyboard"),Keyboard.NUMBER_0=48,Keyboard.NUMBER_1=49,Keyboard.NUMBER_2=50,Keyboard.NUMBER_3=51,Keyboard.NUMBER_4=52,Keyboard.NUMBER_5=53,Keyboard.NUMBER_6=54,Keyboard.NUMBER_7=55,Keyboard.NUMBER_8=56,Keyboard.NUMBER_9=57,Keyboard.A=65,Keyboard.B=66,Keyboard.C=67,Keyboard.D=68,Keyboard.E=69,Keyboard.F=70,Keyboard.G=71,Keyboard.H=72,Keyboard.I=73,Keyboard.J=74,Keyboard.K=75,Keyboard.L=76,Keyboard.M=77,Keyboard.N=78,Keyboard.O=79,Keyboard.P=80,Keyboard.Q=81,Keyboard.R=82,Keyboard.S=83,Keyboard.T=84,Keyboard.U=85,Keyboard.V=86,Keyboard.W=87,Keyboard.X=88,Keyboard.Y=89,Keyboard.Z=90,Keyboard.F1=112,Keyboard.F2=113,Keyboard.F3=114,Keyboard.F4=115,Keyboard.F5=116,Keyboard.F6=117,Keyboard.F7=118,Keyboard.F8=119,Keyboard.F9=120,Keyboard.F10=121,Keyboard.F11=122,Keyboard.F12=123,Keyboard.F13=124,Keyboard.F14=125,Keyboard.F15=126,Keyboard.NUMPAD=21,Keyboard.NUMPAD_0=96,Keyboard.NUMPAD_1=97,Keyboard.NUMPAD_2=98,Keyboard.NUMPAD_3=99,Keyboard.NUMPAD_4=100,Keyboard.NUMPAD_5=101,Keyboard.NUMPAD_6=102,Keyboard.NUMPAD_7=103,Keyboard.NUMPAD_8=104,Keyboard.NUMPAD_9=105,Keyboard.NUMPAD_ADD=107,Keyboard.NUMPAD_DECIMAL=110,Keyboard.NUMPAD_DIVIDE=111,Keyboard.NUMPAD_ENTER=108,Keyboard.NUMPAD_MULTIPLY=106,Keyboard.NUMPAD_SUBTRACT=109,Keyboard.SEMICOLON=186,Keyboard.EQUAL=187,Keyboard.COMMA=188,Keyboard.MINUS=189,Keyboard.PERIOD=190,Keyboard.SLASH=191,Keyboard.BACKQUOTE=192,Keyboard.LEFTBRACKET=219,Keyboard.BACKSLASH=220,Keyboard.RIGHTBRACKET=221,Keyboard.QUOTE=222,Keyboard.ALTERNATE=18,Keyboard.BACKSPACE=8,Keyboard.CAPS_LOCK=20,Keyboard.COMMAND=15,Keyboard.CONTROL=17,Keyboard.DELETE=46,Keyboard.ENTER=13,Keyboard.ESCAPE=27,Keyboard.PAGE_UP=33,Keyboard.PAGE_DOWN=34,Keyboard.END=35,Keyboard.HOME=36,Keyboard.LEFT=37,Keyboard.UP=38,Keyboard.RIGHT=39,Keyboard.DOWN=40,Keyboard.SHIFT=16,Keyboard.SPACE=32,Keyboard.TAB=9,Keyboard.INSERT=45}(),function(){function KeyBoardManager(){}return __class(KeyBoardManager,"laya.events.KeyBoardManager"),KeyBoardManager.__init__=function(){KeyBoardManager._addEvent("keydown"),KeyBoardManager._addEvent("keypress"),KeyBoardManager._addEvent("keyup")},KeyBoardManager._addEvent=function(type){Browser.document.addEventListener(type,function(e){laya.events.KeyBoardManager._dispatch(e,type)},!0)},KeyBoardManager._dispatch=function(e,type){if(KeyBoardManager.enabled){KeyBoardManager._event._stoped=!1,KeyBoardManager._event.nativeEvent=e,KeyBoardManager._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===type?KeyBoardManager._pressKeys[KeyBoardManager._event.keyCode]=!0:"keyup"===type&&(KeyBoardManager._pressKeys[KeyBoardManager._event.keyCode]=null);for(var target=Laya.stage.focus&&null!=Laya.stage.focus.event&&Laya.stage.focus.displayedInStage?Laya.stage.focus:Laya.stage,ct=target;ct;)ct.event(type,KeyBoardManager._event.setTo(type,ct,target)),ct=ct.parent}},KeyBoardManager.hasKeyDown=function(key){return KeyBoardManager._pressKeys[key]},KeyBoardManager._pressKeys={},KeyBoardManager.enabled=!0,__static(KeyBoardManager,["_event",function(){return this._event=new Event}]),KeyBoardManager}()),MouseManager=(function(){function KeyLocation(){}__class(KeyLocation,"laya.events.KeyLocation"),KeyLocation.STANDARD=0,KeyLocation.LEFT=1,KeyLocation.RIGHT=2,KeyLocation.NUM_PAD=3}(),function(){function MouseManager(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new Event,this._matrix=new Matrix,this._point=new Point,this._rect=new Rectangle,this._prePoint=new Point,this._curTouchID=NaN}__class(MouseManager,"laya.events.MouseManager");var __proto=MouseManager.prototype;return __proto.__init__=function(stage,canvas){var _$this=this,_this=(this._stage=stage,this),list=this._eventList;canvas.oncontextmenu=function(e){if(MouseManager.enabled)return!1},canvas.addEventListener("mousedown",function(e){MouseManager.enabled&&(Browser.onIE||e.preventDefault(),list.push(e),_this.mouseDownTime=Browser.now())}),canvas.addEventListener("mouseup",function(e){MouseManager.enabled&&(e.preventDefault(),list.push(e),_this.mouseDownTime=-Browser.now())},!0),canvas.addEventListener("mousemove",function(e){var now;MouseManager.enabled&&(e.preventDefault(),(now=Browser.now())-_this._lastMoveTimer<10||(_this._lastMoveTimer=now,list.push(e)))},!0),canvas.addEventListener("mouseout",function(e){MouseManager.enabled&&list.push(e)}),canvas.addEventListener("mouseover",function(e){MouseManager.enabled&&list.push(e)}),canvas.addEventListener("touchstart",function(e){MouseManager.enabled&&(list.push(e),MouseManager._isFirstTouch||Input.isInputting||e.preventDefault(),_this.mouseDownTime=Browser.now())}),canvas.addEventListener("touchend",function(e){MouseManager.enabled?(MouseManager._isFirstTouch||Input.isInputting||e.preventDefault(),MouseManager._isFirstTouch=!1,list.push(e),_this.mouseDownTime=-Browser.now()):_$this._curTouchID=NaN},!0),canvas.addEventListener("touchmove",function(e){MouseManager.enabled&&(e.preventDefault(),list.push(e))},!0),canvas.addEventListener("touchcancel",function(e){MouseManager.enabled?(e.preventDefault(),list.push(e)):_$this._curTouchID=NaN},!0),canvas.addEventListener("mousewheel",function(e){MouseManager.enabled&&list.push(e)}),canvas.addEventListener("DOMMouseScroll",function(e){MouseManager.enabled&&list.push(e)})},__proto.initEvent=function(e,nativeEvent){this._event._stoped=!1,this._event.nativeEvent=nativeEvent||e,this._target=null,this._point.setTo(e.pageX||e.clientX,e.pageY||e.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=e.identifier||0,this._tTouchID=this._event.touchId,(nativeEvent=TouchManager.I._event)._stoped=!1,nativeEvent.nativeEvent=this._event.nativeEvent,nativeEvent.touchId=this._event.touchId},__proto.checkMouseWheel=function(e){this._event.delta=e.wheelDelta?.025*e.wheelDelta:-e.detail;for(var _lastOvers=TouchManager.I.getLastOvers(),i=0,n=_lastOvers.length;i<n;i++){var ele=_lastOvers[i];ele.event("mousewheel",this._event.setTo("mousewheel",ele,this._target))}},__proto.onMouseMove=function(ele){TouchManager.I.onMouseMove(ele,this._tTouchID)},__proto.onMouseDown=function(ele){var pre_input,new_input;Input.isInputting&&Laya.stage.focus&&Laya.stage.focus.focus&&!Laya.stage.focus.contains(this._target)&&(pre_input=Laya.stage.focus._tf||Laya.stage.focus,(new_input=ele._tf||ele)instanceof laya.display.Input&&new_input.multiline==pre_input.multiline?pre_input._focusOut():pre_input.focus=!1),TouchManager.I.onMouseDown(ele,this._tTouchID,this._isLeftMouse)},__proto.onMouseUp=function(ele){TouchManager.I.onMouseUp(ele,this._tTouchID,this._isLeftMouse)},__proto.check=function(sp,mouseX,mouseY,callBack){this._point.setTo(mouseX,mouseY),sp.fromParentPoint(this._point),mouseX=this._point.x,mouseY=this._point.y;var scrollRect=sp.scrollRect;if(scrollRect&&(this._rect.setTo(scrollRect.x,scrollRect.y,scrollRect.width,scrollRect.height),!this._rect.contains(mouseX,mouseY)))return!1;if(!this.disableMouseEvent){if(sp.hitTestPrior&&!sp.mouseThrough&&!this.hitTest(sp,mouseX,mouseY))return!1;for(var i=sp._childs.length-1;-1<i;i--){var child=sp._childs[i];if(!child.destroyed&&child.mouseEnabled&&child.visible&&this.check(child,mouseX,mouseY,callBack))return!0}}scrollRect=!(!sp.hitTestPrior||sp.mouseThrough||this.disableMouseEvent)||this.hitTest(sp,mouseX,mouseY);return scrollRect?(this._target=sp,callBack.call(this,sp)):callBack===this.onMouseUp&&sp===this._stage&&(this._target=this._stage,callBack.call(this,this._target)),scrollRect},__proto.hitTest=function(sp,mouseX,mouseY){var hitRect,isHit=!1;return sp.scrollRect&&(mouseX-=sp.scrollRect.x,mouseY-=sp.scrollRect.y),sp.hitArea instanceof laya.utils.HitArea?sp.hitArea.isHit(mouseX,mouseY):0<sp.width&&0<sp.height||sp.mouseThrough||sp.hitArea?(sp.mouseThrough?sp.getGraphicBounds():(hitRect=this._rect,sp.hitArea?hitRect=sp.hitArea:hitRect.setTo(0,0,sp.width,sp.height),hitRect)).contains(mouseX,mouseY):isHit},__proto.runEvent=function(){var len=this._eventList.length;if(len){var i=0,j=0,n=0;try{for(;i<len;){var evt=this._eventList[i];switch("mousemove"!==evt.type&&(this._prePoint.x=this._prePoint.y=-1e6),evt.type){case"mousedown":this._touchIDs[0]=this._id++,MouseManager._isTouchRespond?MouseManager._isTouchRespond=!1:(this._isLeftMouse=0===evt.button,this.initEvent(evt),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===evt.button,this.initEvent(evt),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-evt.clientX)+Math.abs(this._prePoint.y-evt.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=evt.clientX,this._prePoint.y=evt.clientY,this.initEvent(evt),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":MouseManager._isTouchRespond=!0,this._isLeftMouse=!0;for(var touches=evt.changedTouches,j=0,n=touches.length;j<n;j++)touch=touches[j],(MouseManager.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=touch.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[touch.identifier]=this._id++,this.initEvent(touch,evt),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":MouseManager._isTouchRespond=!0,this._isLeftMouse=!0;var touchends=evt.changedTouches;for(j=0,n=touchends.length;j<n;j++){var touch=touchends[j];!MouseManager.multiTouchEnabled&&touch.identifier!=this._curTouchID||(this._curTouchID=NaN,this.initEvent(touch,evt),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseUp))||this.onMouseUp(null)}break;case"touchmove":var touchemoves=evt.changedTouches;for(j=0,n=touchemoves.length;j<n;j++)touch=touchemoves[j],!MouseManager.multiTouchEnabled&&touch.identifier!=this._curTouchID||(this.initEvent(touch,evt),this.check(this._stage,this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(evt);break;case"mouseout":TouchManager.I.stageMouseOut();break;case"mouseover":this._stage.event("mouseover",this._event.setTo("mouseover",this._stage,this._stage))}i++}}catch(e){throw this._eventList.length=0,e}this._eventList.length=0}},MouseManager.enabled=!0,MouseManager.multiTouchEnabled=!0,MouseManager._isTouchRespond=!1,MouseManager._isFirstTouch=!0,__static(MouseManager,["instance",function(){return this.instance=new MouseManager}]),MouseManager}()),TouchManager=function(){function TouchManager(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new Event}__class(TouchManager,"laya.events.TouchManager");var __proto=TouchManager.prototype;return __proto._clearTempArrs=function(){TouchManager._oldArr.length=0,TouchManager._newArr.length=0,TouchManager._tEleArr.length=0},__proto.getTouchFromArr=function(touchID,arr){for(var tTouchO,i=0,len=arr.length,i=0;i<len;i++)if((tTouchO=arr[i]).id==touchID)return tTouchO;return null},__proto.removeTouchFromArr=function(touchID,arr){for(var i=0,i=arr.length-1;0<=i;i--)arr[i].id==touchID&&arr.splice(i,1)},__proto.createTouchO=function(ele,touchID){var rst=Pool.getItem("TouchData")||{};return rst.id=touchID,rst.tar=ele,rst},__proto.onMouseDown=function(ele,touchID,isLeft){var tO,preDowns,preO,arrs;void 0===isLeft&&(isLeft=!1),this.enable&&(preO=this.getTouchFromArr(touchID,this.preOvers),arrs=this.getEles(ele,null,TouchManager._tEleArr),preO?preO.tar=ele:(tO=this.createTouchO(ele,touchID),this.preOvers.push(tO)),Browser.onMobile&&this.sendEvents(arrs,"mouseover",touchID),preDowns=isLeft?this.preDowns:this.preRightDowns,(preO=this.getTouchFromArr(touchID,preDowns))?preO.tar=ele:(tO=this.createTouchO(ele,touchID),preDowns.push(tO)),this.sendEvents(arrs,isLeft?"mousedown":"rightmousedown",touchID),this._clearTempArrs())},__proto.sendEvents=function(eles,type,touchID){void 0===touchID&&(touchID=0);var _target,tE,i=0,len=eles.length;for(this._event._stoped=!1,_target=eles[0],i=0;i<len;i++){if((tE=eles[i]).destroyed)return;if(tE.event(type,this._event.setTo(type,tE,_target)),this._event._stoped)break}},__proto.getEles=function(start,end,rst){for(rst?rst.length=0:rst=[];start&&start!=end;)rst.push(start),start=start.parent;return rst},__proto.checkMouseOutAndOverOfMove=function(eleNew,elePre,touchID){if(void 0===touchID&&(touchID=0),elePre!=eleNew){var tar,i=0;if(elePre.contains(eleNew))arrs=this.getEles(eleNew,elePre,TouchManager._tEleArr),this.sendEvents(arrs,"mouseover",touchID);else if(eleNew.contains(elePre))arrs=this.getEles(elePre,eleNew,TouchManager._tEleArr),this.sendEvents(arrs,"mouseout",touchID);else{(arrs=TouchManager._tEleArr).length=0;for(var arrs,tIndex,oldArr=this.getEles(elePre,null,TouchManager._oldArr),newArr=this.getEles(eleNew,null,TouchManager._newArr),len=oldArr.length,i=0;i<len;i++){if(tar=oldArr[i],0<=(tIndex=newArr.indexOf(tar))){newArr.splice(tIndex,newArr.length-tIndex);break}arrs.push(tar)}0<arrs.length&&this.sendEvents(arrs,"mouseout",touchID),0<newArr.length&&this.sendEvents(newArr,"mouseover",touchID)}}},__proto.onMouseMove=function(ele,touchID){var arrs,preO;this.enable&&((preO=this.getTouchFromArr(touchID,this.preOvers))?(this.checkMouseOutAndOverOfMove(ele,preO.tar),preO.tar=ele,arrs=this.getEles(ele,null,TouchManager._tEleArr)):(arrs=this.getEles(ele,null,TouchManager._tEleArr),this.sendEvents(arrs,"mouseover",touchID),this.preOvers.push(this.createTouchO(ele,touchID))),this.sendEvents(arrs,"mousemove",touchID),this._clearTempArrs())},__proto.getLastOvers=function(){return(TouchManager._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,TouchManager._tEleArr):(TouchManager._tEleArr.push(Laya.stage),TouchManager._tEleArr)},__proto.stageMouseOut=function(){var lastOvers=this.getLastOvers();this.preOvers.length=0,this.sendEvents(lastOvers,"mouseout",0)},__proto.onMouseUp=function(ele,touchID,isLeft){if(void 0===isLeft&&(isLeft=!1),this.enable){var preO,oldArr,len,tar,sendArr,preDowns,i=0,onMobile=Browser.onMobile,arrs=this.getEles(ele,null,TouchManager._tEleArr);if(this.sendEvents(arrs,isLeft?"mouseup":"rightmouseup",touchID),preDowns=isLeft?this.preDowns:this.preRightDowns,preO=this.getTouchFromArr(touchID,preDowns)){var now=Browser.now(),isDouble=now-this._lastClickTime<300;if(this._lastClickTime=now,ele==preO.tar)sendArr=arrs;else for(oldArr=this.getEles(preO.tar,null,TouchManager._oldArr),(sendArr=TouchManager._newArr).length=0,len=oldArr.length,i=0;i<len;i++)tar=oldArr[i],0<=arrs.indexOf(tar)&&sendArr.push(tar);0<sendArr.length&&this.sendEvents(sendArr,isLeft?"click":"rightclick",touchID),isLeft&&isDouble&&this.sendEvents(sendArr,"doubleclick",touchID),this.removeTouchFromArr(touchID,preDowns),preO.tar=null,Pool.recover("TouchData",preO)}(preO=this.getTouchFromArr(touchID,this.preOvers))&&onMobile&&((sendArr=this.getEles(preO.tar,null,sendArr))&&0<sendArr.length&&this.sendEvents(sendArr,"mouseout",touchID),this.removeTouchFromArr(touchID,this.preOvers),preO.tar=null,Pool.recover("TouchData",preO)),this._clearTempArrs()}},TouchManager._oldArr=[],TouchManager._newArr=[],TouchManager._tEleArr=[],__static(TouchManager,["I",function(){return this.I=new TouchManager}]),TouchManager}(),Filter=function(){function Filter(){this._action=null}__class(Filter,"laya.filters.Filter");var __proto=Filter.prototype;return Laya.imps(__proto,{"laya.filters.IFilter":!0}),__proto.callNative=function(sp){},__getset(0,__proto,"type",function(){return-1}),__getset(0,__proto,"action",function(){return this._action}),Filter.BLUR=16,Filter.COLOR=32,Filter.GLOW=8,Filter._filterStart=null,Filter._filterEnd=null,Filter._EndTarget=null,Filter._recycleScope=null,Filter._filter=null,Filter._useSrc=null,Filter._endSrc=null,Filter._useOut=null,Filter._endOut=null,Filter}(),ColorFilterAction=function(){function ColorFilterAction(){this.data=null}__class(ColorFilterAction,"laya.filters.ColorFilterAction");var __proto=ColorFilterAction.prototype;return Laya.imps(__proto,{"laya.filters.IFilterAction":!0}),__proto.apply=function(srcCanvas){var ctx=srcCanvas.ctx.ctx,canvas=srcCanvas.ctx.ctx.canvas;if(0==canvas.width||0==canvas.height)return canvas;for(var nData,canvas=ctx.getImageData(0,0,canvas.width,canvas.height),data=canvas.data,i=0,n=data.length;i<n;i+=4)nData=this.getColor(data[i],data[i+1],data[i+2],data[i+3]),0!=data[i+3]&&(data[i]=nData[0],data[i+1]=nData[1],data[i+2]=nData[2],data[i+3]=nData[3]);return ctx.putImageData(canvas,0,0),srcCanvas},__proto.getColor=function(red,green,blue,alpha){var mat,tempAlpha,rst=[];return this.data._mat&&this.data._alpha&&(mat=this.data._mat,tempAlpha=this.data._alpha,rst[0]=mat[0]*red+mat[1]*green+mat[2]*blue+mat[3]*alpha+tempAlpha[0],rst[1]=mat[4]*red+mat[5]*green+mat[6]*blue+mat[7]*alpha+tempAlpha[1],rst[2]=mat[8]*red+mat[9]*green+mat[10]*blue+mat[11]*alpha+tempAlpha[2],rst[3]=mat[12]*red+mat[13]*green+mat[14]*blue+mat[15]*alpha+tempAlpha[3]),rst},ColorFilterAction}(),Bezier=(function(){function Arith(){}__class(Arith,"laya.maths.Arith"),Arith.formatR=function(r){return r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI),r},Arith.isPOT=function(w,h){return 0<w&&0==(w&w-1)&&0<h&&0==(h&h-1)},Arith.setMatToArray=function(mat,array){mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty,array[0]=mat.a,array[1]=mat.b,array[4]=mat.c,array[5]=mat.d,array[12]=mat.tx,array[13]=mat.ty}}(),function(){function Bezier(){this._controlPoints=[new Point,new Point,new Point],this._calFun=this.getPoint2}__class(Bezier,"laya.maths.Bezier");var __proto=Bezier.prototype;return __proto._switchPoint=function(x,y){var tPoint=this._controlPoints.shift();tPoint.setTo(x,y),this._controlPoints.push(tPoint)},__proto.getPoint2=function(t,rst){var p1=this._controlPoints[0],p2=this._controlPoints[1],p3=this._controlPoints[2],lineX=Math.pow(1-t,2)*p1.x+2*t*(1-t)*p2.x+Math.pow(t,2)*p3.x,p1=Math.pow(1-t,2)*p1.y+2*t*(1-t)*p2.y+Math.pow(t,2)*p3.y;rst.push(lineX,p1)},__proto.getPoint3=function(t,rst){var p1=this._controlPoints[0],p2=this._controlPoints[1],p3=this._controlPoints[2],p4=this._controlPoints[3],lineX=Math.pow(1-t,3)*p1.x+3*p2.x*t*(1-t)*(1-t)+3*p3.x*t*t*(1-t)+p4.x*Math.pow(t,3),p1=Math.pow(1-t,3)*p1.y+3*p2.y*t*(1-t)*(1-t)+3*p3.y*t*t*(1-t)+p4.y*Math.pow(t,3);rst.push(lineX,p1)},__proto.insertPoints=function(count,rst){for(var i=NaN,dLen=1/(count=0<count?count:5),i=0;i<=1;i+=dLen)this._calFun(i,rst)},__proto.getBezierPoints=function(pList,inSertCount,count){void 0===inSertCount&&(inSertCount=5);var len,rst,i=0;if((len=pList.length)<2*((count=void 0===count?2:count)+1))return[];switch(rst=[],count){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=count;)this._controlPoints.push(new Point);for(i=0;i<2*count;i+=2)this._switchPoint(pList[i],pList[i+1]);for(i=2*count;i<len;i+=2)this._switchPoint(pList[i],pList[i+1]),i/2%count==0&&this.insertPoints(inSertCount,rst);return rst},__static(Bezier,["I",function(){return this.I=new Bezier}]),Bezier}()),GrahamScan=function(){function GrahamScan(){}return __class(GrahamScan,"laya.maths.GrahamScan"),GrahamScan.multiply=function(p1,p2,p0){return(p1.x-p0.x)*(p2.y-p0.y)-(p2.x-p0.x)*(p1.y-p0.y)},GrahamScan.dis=function(p1,p2){return(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y)},GrahamScan._getPoints=function(count,tempUse,rst){for(void 0===tempUse&&(tempUse=!1),GrahamScan._mPointList||(GrahamScan._mPointList=[]);GrahamScan._mPointList.length<count;)GrahamScan._mPointList.push(new Point);return(rst=rst||[]).length=0,tempUse?GrahamScan.getFrom(rst,GrahamScan._mPointList,count):GrahamScan.getFromR(rst,GrahamScan._mPointList,count),rst},GrahamScan.getFrom=function(rst,src,count){for(var i=0,i=0;i<count;i++)rst.push(src[i]);return rst},GrahamScan.getFromR=function(rst,src,count){for(var i=0,i=0;i<count;i++)rst.push(src.pop());return rst},GrahamScan.pListToPointList=function(pList,tempUse){for(var i=0,len=pList.length/2,rst=GrahamScan._getPoints(len,tempUse=void 0===tempUse?!1:tempUse,GrahamScan._tempPointList),i=0;i<len;i++)rst[i].setTo(pList[i+i],pList[i+i+1]);return rst},GrahamScan.pointListToPlist=function(pointList){for(var tPoint,i=0,len=pointList.length,rst=GrahamScan._temPList,i=rst.length=0;i<len;i++)tPoint=pointList[i],rst.push(tPoint.x,tPoint.y);return rst},GrahamScan.scanPList=function(pList){return Utils.copyArray(pList,GrahamScan.pointListToPlist(GrahamScan.scan(GrahamScan.pListToPointList(pList,!0))))},GrahamScan.scan=function(PointSet){var tmp,n,key,i=0,j=0,k=0,_tmpDic=(PointSet.length,{}),ch=GrahamScan._temArr;for(ch.length=0,i=PointSet.length-1;0<=i;i--)key=(tmp=PointSet[i]).x+"_"+tmp.y,_tmpDic.hasOwnProperty(key)||(_tmpDic[key]=!0,ch.push(tmp));for(n=ch.length,Utils.copyArray(PointSet,ch),i=1;i<n;i++)(PointSet[i].y<PointSet[k].y||PointSet[i].y==PointSet[k].y&&PointSet[i].x<PointSet[k].x)&&(k=i);for(tmp=PointSet[0],PointSet[0]=PointSet[k],PointSet[k]=tmp,i=1;i<n-1;i++){for(j=(k=i)+1;j<n;j++)(0<GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])||0==GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])&&GrahamScan.dis(PointSet[0],PointSet[j])<GrahamScan.dis(PointSet[0],PointSet[k]))&&(k=j);tmp=PointSet[i],PointSet[i]=PointSet[k],PointSet[k]=tmp}if((ch=GrahamScan._temArr).length=0,PointSet.length<3)return Utils.copyArray(ch,PointSet);for(ch.push(PointSet[0],PointSet[1],PointSet[2]),i=3;i<n;i++){for(;2<=ch.length&&0<=GrahamScan.multiply(PointSet[i],ch[ch.length-1],ch[ch.length-2]);)ch.pop();PointSet[i]&&ch.push(PointSet[i])}return ch},GrahamScan._mPointList=null,GrahamScan._tempPointList=[],GrahamScan._temPList=[],GrahamScan._temArr=[],GrahamScan}(),MathUtil=function(){function MathUtil(){}return __class(MathUtil,"laya.maths.MathUtil"),MathUtil.subtractVector3=function(l,r,o){o[0]=l[0]-r[0],o[1]=l[1]-r[1],o[2]=l[2]-r[2]},MathUtil.lerp=function(left,right,amount){return left*(1-amount)+right*amount},MathUtil.scaleVector3=function(f,b,e){e[0]=f[0]*b,e[1]=f[1]*b,e[2]=f[2]*b},MathUtil.lerpVector3=function(l,r,t,o){var ax=l[0],ay=l[1],l=l[2];o[0]=ax+t*(r[0]-ax),o[1]=ay+t*(r[1]-ay),o[2]=l+t*(r[2]-l)},MathUtil.lerpVector4=function(l,r,t,o){var ax=l[0],ay=l[1],az=l[2],l=l[3];o[0]=ax+t*(r[0]-ax),o[1]=ay+t*(r[1]-ay),o[2]=az+t*(r[2]-az),o[3]=l+t*(r[3]-l)},MathUtil.slerpQuaternionArray=function(a,Offset1,b,Offset2,t,out,Offset3){var sinom,scale0,ax=a[Offset1+0],ay=a[Offset1+1],az=a[Offset1+2],a=a[Offset1+3],Offset1=b[Offset2+0],by=b[Offset2+1],bz=b[Offset2+2],b=b[Offset2+3],Offset2=ax*Offset1+ay*by+az*bz+a*b;return Offset2<0&&(Offset2=-Offset2,Offset1=-Offset1,by=-by,bz=-bz,b=-b),Offset2=1e-6<1-Offset2?(Offset2=Math.acos(Offset2),sinom=Math.sin(Offset2),scale0=Math.sin((1-t)*Offset2)/sinom,Math.sin(t*Offset2)/sinom):(scale0=1-t,t),out[Offset3+0]=scale0*ax+Offset2*Offset1,out[Offset3+1]=scale0*ay+Offset2*by,out[Offset3+2]=scale0*az+Offset2*bz,out[Offset3+3]=scale0*a+Offset2*b,out},MathUtil.getRotation=function(x0,y0,x1,y1){return Math.atan2(y1-y0,x1-x0)/Math.PI*180},MathUtil.sortBigFirst=function(a,b){return a==b?0:a<b?1:-1},MathUtil.sortSmallFirst=function(a,b){return a==b?0:a<b?-1:1},MathUtil.sortNumBigFirst=function(a,b){return parseFloat(b)-parseFloat(a)},MathUtil.sortNumSmallFirst=function(a,b){return parseFloat(a)-parseFloat(b)},MathUtil.sortByKey=function(key,bigFirst,forceNum){var _sortFun;return void 0===forceNum&&(forceNum=!0),_sortFun=(bigFirst=void 0===bigFirst?!1:bigFirst)?forceNum?MathUtil.sortNumBigFirst:MathUtil.sortBigFirst:forceNum?MathUtil.sortNumSmallFirst:MathUtil.sortSmallFirst,function(a,b){return _sortFun(a[key],b[key])}},MathUtil}(),Matrix=function(){function Matrix(a,b,c,d,tx,ty){this.inPool=!1,this.bTransform=!1,void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===tx&&(tx=0),void 0===ty&&(ty=0),this.a=a=void 0===a?1:a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this._checkTransform()}__class(Matrix,"laya.maths.Matrix");var __proto=Matrix.prototype;return __proto.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},__proto._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},__proto.setTranslate=function(x,y){return this.tx=x,this.ty=y,this},__proto.translate=function(x,y){return this.tx+=x,this.ty+=y,this},__proto.scale=function(x,y){this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this.bTransform=!0},__proto.rotate=function(angle){var cos=Math.cos(angle),angle=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;this.a=a1*cos-this.b*angle,this.b=a1*angle+this.b*cos,this.c=c1*cos-this.d*angle,this.d=c1*angle+this.d*cos,this.tx=tx1*cos-this.ty*angle,this.ty=tx1*angle+this.ty*cos,this.bTransform=!0},__proto.skew=function(x,y){var x=Math.tan(x),y=Math.tan(y),a1=this.a,b1=this.b;return this.a+=y*this.c,this.b+=y*this.d,this.c+=x*a1,this.d+=x*b1,this},__proto.invertTransformPoint=function(out){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1,tx2=(c1*this.ty-d1*tx1)/n,tx1=-(a1*this.ty-b1*tx1)/n;return out.setTo(d1/n*out.x+-c1/n*out.y+tx2,-b1/n*out.x+a1/n*out.y+tx1)},__proto.transformPoint=function(out){return out.setTo(this.a*out.x+this.c*out.y+this.tx,this.b*out.x+this.d*out.y+this.ty)},__proto.transformPointN=function(out){return out.setTo(this.a*out.x+this.c*out.y,this.b*out.x+this.d*out.y)},__proto.transformPointArray=function(data,out){for(var len=data.length,i=0;i<len;i+=2){var x=data[i],y=data[i+1];out[i]=this.a*x+this.c*y+this.tx,out[i+1]=this.b*x+this.d*y+this.ty}return out},__proto.transformPointArrayScale=function(data,out){for(var len=data.length,i=0;i<len;i+=2){var x=data[i],y=data[i+1];out[i]=this.a*x+this.c*y,out[i+1]=this.b*x+this.d*y}return out},__proto.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},__proto.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},__proto.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},__proto.setTo=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},__proto.concat=function(matrix){var a=this.a,c=this.c,tx=this.tx;return this.a=a*matrix.a+this.b*matrix.c,this.b=a*matrix.b+this.b*matrix.d,this.c=c*matrix.a+this.d*matrix.c,this.d=c*matrix.b+this.d*matrix.d,this.tx=tx*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx*matrix.b+this.ty*matrix.d+matrix.ty,this},__proto.scaleEx=function(x,y){var ba=this.a,bb=this.b,bc=this.c,bd=this.d;0!==bb||0!==bc?(this.a=x*ba,this.b=x*bb,this.c=y*bc):(this.a=x*ba,this.b=0*bd,this.c=0*ba),this.d=y*bd,this.bTransform=!0},__proto.rotateEx=function(angle){var cos=Math.cos(angle),angle=Math.sin(angle),ba=this.a,bb=this.b,bc=this.c,bd=this.d;0!==bb||0!==bc?(this.a=cos*ba+angle*bc,this.b=cos*bb+angle*bd,this.c=-angle*ba+cos*bc,this.d=-angle*bb+cos*bd):(this.a=cos*ba,this.b=angle*bd,this.c=-angle*ba,this.d=cos*bd),this.bTransform=!0},__proto.clone=function(){var dec=Matrix.create();return dec.a=this.a,dec.b=this.b,dec.c=this.c,dec.d=this.d,dec.tx=this.tx,dec.ty=this.ty,dec.bTransform=this.bTransform,dec},__proto.copyTo=function(dec){return dec.a=this.a,dec.b=this.b,dec.c=this.c,dec.d=this.d,dec.tx=this.tx,dec.ty=this.ty,dec.bTransform=this.bTransform,dec},__proto.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},__proto.destroy=function(){var cache;this.inPool||(cache=Matrix._cache,this.inPool=!0,cache._length||(cache._length=0),(cache[cache._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1)},Matrix.mul=function(m1,m2,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,m1=m1.ty,ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,m2=m2.ty;return 0!==bb||0!==bc?(out.a=aa*ba+ab*bc,out.b=aa*bb+ab*bd,out.c=ac*ba+ad*bc,out.d=ac*bb+ad*bd,out.tx=ba*atx+bc*m1+btx,out.ty=bb*atx+bd*m1+m2):(out.a=aa*ba,out.b=ab*bd,out.c=ac*ba,out.d=ad*bd,out.tx=ba*atx+btx,out.ty=bd*m1+m2),out},Matrix.mul16=function(m1,m2,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,m1=m1.ty,ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,m2=m2.ty;return 0!==bb||0!==bc?(out[0]=aa*ba+ab*bc,out[1]=aa*bb+ab*bd,out[4]=ac*ba+ad*bc,out[5]=ac*bb+ad*bd,out[12]=ba*atx+bc*m1+btx,out[13]=bb*atx+bd*m1+m2):(out[0]=aa*ba,out[1]=ab*bd,out[4]=ac*ba,out[5]=ad*bd,out[12]=ba*atx+btx,out[13]=bd*m1+m2),out},Matrix.mulPre=function(m1,ba,bb,bc,bd,btx,bty,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,m1=m1.ty;return 0!==bb||0!==bc?(out.a=aa*ba+ab*bc,out.b=aa*bb+ab*bd,out.c=ac*ba+ad*bc,out.d=ac*bb+ad*bd,out.tx=ba*atx+bc*m1+btx,out.ty=bb*atx+bd*m1+bty):(out.a=aa*ba,out.b=ab*bd,out.c=ac*ba,out.d=ad*bd,out.tx=ba*atx+btx,out.ty=bd*m1+bty),out},Matrix.mulPos=function(m1,aa,ab,ac,ad,atx,aty,out){var ba=m1.a,bb=m1.b,bc=m1.c,bd=m1.d,btx=m1.tx,m1=m1.ty;return 0!==bb||0!==bc?(out.a=aa*ba+ab*bc,out.b=aa*bb+ab*bd,out.c=ac*ba+ad*bc,out.d=ac*bb+ad*bd,out.tx=ba*atx+bc*aty+btx,out.ty=bb*atx+bd*aty+m1):(out.a=aa*ba,out.b=ab*bd,out.c=ac*ba,out.d=ad*bd,out.tx=ba*atx+btx,out.ty=bd*aty+m1),out},Matrix.preMul=function(parent,self,out){var pa=parent.a,pb=parent.b,pc=parent.c,pd=parent.d,na=self.a,nb=self.b,nc=self.c,nd=self.d,ntx=self.tx,self=self.ty;return out.a=na*pa,out.b=out.c=0,out.d=nd*pd,out.tx=ntx*pa+parent.tx,out.ty=self*pd+parent.ty,0===nb&&0===nc&&0===pb&&0===pc||(out.a+=nb*pc,out.d+=nc*pb,out.b+=na*pb+nb*pd,out.c+=nc*pa+nd*pc,out.tx+=self*pc,out.ty+=ntx*pb),out},Matrix.preMulXY=function(parent,x,y,out){var pa=parent.a,pb=parent.b,pc=parent.c,pd=parent.d;return out.a=pa,out.b=pb,out.c=pc,out.d=pd,out.tx=x*pa+parent.tx+y*pc,out.ty=y*pd+parent.ty+x*pb,out},Matrix.create=function(){var cache=Matrix._cache,cache=cache._length?cache[--cache._length]:new Matrix;return cache.inPool=!1,cache},Matrix.EMPTY=new Matrix,Matrix.TEMP=new Matrix,Matrix._cache=[],Matrix}(),Point=function(){function Point(x,y){void 0===y&&(y=0),this.x=x=void 0===x?0:x,this.y=y}__class(Point,"laya.maths.Point");var __proto=Point.prototype;return __proto.setTo=function(x,y){return this.x=x,this.y=y,this},__proto.distance=function(x,y){return Math.sqrt((this.x-x)*(this.x-x)+(this.y-y)*(this.y-y))},__proto.toString=function(){return this.x+","+this.y},__proto.normalize=function(){var d=Math.sqrt(this.x*this.x+this.y*this.y);0<d&&(this.x*=d=1/d,this.y*=d)},Point.TEMP=new Point,Point.EMPTY=new Point,Point}(),Rectangle=function(){function Rectangle(x,y,width,height){void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),this.x=x=void 0===x?0:x,this.y=y,this.width=width,this.height=height}__class(Rectangle,"laya.maths.Rectangle");var __proto=Rectangle.prototype;return __proto.setTo=function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},__proto.copyFrom=function(source){return this.x=source.x,this.y=source.y,this.width=source.width,this.height=source.height,this},__proto.contains=function(x,y){return!(this.width<=0||this.height<=0)&&x>=this.x&&x<this.right&&y>=this.y&&y<this.bottom},__proto.intersects=function(rect){return!(rect.x>this.x+this.width||rect.x+rect.width<this.x||rect.y>this.y+this.height||rect.y+rect.height<this.y)},__proto.intersection=function(rect,out){return this.intersects(rect)?((out=out||new Rectangle).x=Math.max(this.x,rect.x),out.y=Math.max(this.y,rect.y),out.width=Math.min(this.right,rect.right)-out.x,out.height=Math.min(this.bottom,rect.bottom)-out.y,out):null},__proto.union=function(source,out){return out=out||new Rectangle,this.clone(out),source.width<=0||source.height<=0?out:(out.addPoint(source.x,source.y),out.addPoint(source.right,source.bottom),this)},__proto.clone=function(out){return(out=out||new Rectangle).x=this.x,out.y=this.y,out.width=this.width,out.height=this.height,out},__proto.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},__proto.equals=function(rect){return!(!rect||rect.x!==this.x||rect.y!==this.y||rect.width!==this.width||rect.height!==this.height)},__proto.addPoint=function(x,y){return this.x>x&&(this.width+=this.x-x,this.x=x),this.y>y&&(this.height+=this.y-y,this.y=y),this.width<x-this.x&&(this.width=x-this.x),this.height<y-this.y&&(this.height=y-this.y),this},__proto._getBoundPoints=function(){var rst=Rectangle._temB;return(rst.length=0)!=this.width&&0!=this.height&&rst.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),rst},__proto.isEmpty=function(){return this.width<=0||this.height<=0},__getset(0,__proto,"right",function(){return this.x+this.width}),__getset(0,__proto,"bottom",function(){return this.y+this.height}),Rectangle._getBoundPointS=function(x,y,width,height){var rst=Rectangle._temA;return(rst.length=0)!=width&&0!=height&&rst.push(x,y,x+width,y,x,y+height,x+width,y+height),rst},Rectangle._getWrapRec=function(pointList,rst){if(!pointList||pointList.length<1)return(rst||Rectangle.TEMP).setTo(0,0,0,0);rst=rst||new Rectangle;for(var minY,maxY,len=pointList.length,tPoint=Point.TEMP,minX=minY=99999,maxX=maxY=-minX,i=0;i<len;i+=2)tPoint.x=pointList[i],tPoint.y=pointList[i+1],minX=minX<tPoint.x?minX:tPoint.x,minY=minY<tPoint.y?minY:tPoint.y,maxX=maxX>tPoint.x?maxX:tPoint.x,maxY=maxY>tPoint.y?maxY:tPoint.y;return rst.setTo(minX,minY,maxX-minX,maxY-minY)},Rectangle.EMPTY=new Rectangle,Rectangle.TEMP=new Rectangle,Rectangle._temB=[],Rectangle._temA=[],Rectangle}(),SoundManager=function(){function SoundManager(){}return __class(SoundManager,"laya.media.SoundManager"),__getset(1,SoundManager,"useAudioMusic",function(){return SoundManager._useAudioMusic},function(value){SoundManager._useAudioMusic=value,SoundManager._musicClass=value?AudioSound:null}),__getset(1,SoundManager,"autoStopMusic",function(){return SoundManager._autoStopMusic},function(v){Laya.stage.off("blur",null,SoundManager._stageOnBlur),Laya.stage.off("focus",null,SoundManager._stageOnFocus),Laya.stage.off("visibilitychange",null,SoundManager._visibilityChange),(SoundManager._autoStopMusic=v)&&(Laya.stage.on("blur",null,SoundManager._stageOnBlur),Laya.stage.on("focus",null,SoundManager._stageOnFocus),Laya.stage.on("visibilitychange",null,SoundManager._visibilityChange))}),__getset(1,SoundManager,"muted",function(){return SoundManager._muted},function(value){value!=SoundManager._muted&&(value&&SoundManager.stopAllSound(),SoundManager.musicMuted=value,SoundManager._muted=value)}),__getset(1,SoundManager,"musicMuted",function(){return SoundManager._musicMuted},function(value){value!=SoundManager._musicMuted&&(value?(SoundManager._tMusic&&SoundManager._musicChannel&&!SoundManager._musicChannel.isStopped?SoundManager._musicChannel.pause():SoundManager._musicChannel=null,SoundManager._musicMuted=value):(SoundManager._musicMuted=value,SoundManager._tMusic&&SoundManager._musicChannel&&SoundManager._musicChannel.resume()))}),__getset(1,SoundManager,"soundMuted",function(){return SoundManager._soundMuted},function(value){SoundManager._soundMuted=value}),SoundManager.addChannel=function(channel){0<=SoundManager._channels.indexOf(channel)||(SoundManager._channels.push(channel),SoundManager.autoReleaseSound&&0!=SoundManager._notUsedCount&&SoundManager._notUsedUrls[channel.url]&&(delete SoundManager._notUsedUrls[channel.url],0==--SoundManager._notUsedCount)&&Laya.timer.clear(SoundManager,SoundManager.disposeSoundIfNotUsed))},SoundManager.removeChannel=function(channel){var channels=SoundManager._channels,i=channels.indexOf(channel);if(-1!=i&&(channels.splice(i,1),SoundManager.autoReleaseSound)){var url=channel.url,channel=SoundManager.defaultIntervals[url]||2e4;if(0<channel){for(var notUsed=!0,i=channels.length-1;0<=i;i--)if(channels[i].url==url){notUsed=!1;break}notUsed&&(SoundManager._notUsedUrls[url]=Date.now()+channel,0==SoundManager._notUsedCount++)&&Laya.timer.loop(1e4,SoundManager,SoundManager.disposeSoundIfNotUsed)}}},SoundManager.disposeSoundIfNotUsed=function(){var notUsedUrls=SoundManager._notUsedUrls;if(0!=SoundManager._notUsedCount){var url,now=Date.now();for(url in notUsedUrls)now>=notUsedUrls[url]&&(delete notUsedUrls[url],--SoundManager._notUsedCount,SoundManager.destroySound(url));if(0!=SoundManager._notUsedCount)return}Laya.timer.clear(SoundManager,SoundManager.disposeSoundIfNotUsed)},SoundManager._visibilityChange=function(){Laya.stage.isVisibility?SoundManager._stageOnFocus():SoundManager._stageOnBlur()},SoundManager._stageOnBlur=function(){SoundManager._isActive=!1,SoundManager._musicChannel&&!SoundManager._musicChannel.isStopped&&(SoundManager._blurPaused=!0,SoundManager._musicChannel.pause()),SoundManager.stopAllSound(),Laya.stage.once("mousedown",null,SoundManager._stageOnFocus)},SoundManager._recoverWebAudio=function(){WebAudioSound.ctx&&"running"!=WebAudioSound.ctx.state&&WebAudioSound.ctx.resume&&WebAudioSound.ctx.resume()},SoundManager._stageOnFocus=function(){SoundManager._isActive=!0,SoundManager._recoverWebAudio(),Laya.stage.off("mousedown",null,SoundManager._stageOnFocus),SoundManager._blurPaused&&SoundManager._musicChannel&&SoundManager._musicChannel.isStopped&&(SoundManager._blurPaused=!1,SoundManager._musicChannel.resume())},SoundManager.playSound=function(url,loops,complete,soundClass,startTime){if(void 0===loops&&(loops=1),void 0===startTime&&(startTime=0),!SoundManager._isActive||!url)return null;if(SoundManager._muted)return null;if(SoundManager._recoverWebAudio(),url==SoundManager._tMusic){if(SoundManager._musicMuted)return null}else{if(Render.isConchApp){var ext=Utils.getFileExtension(url);if("wav"!=ext&&"ogg"!=ext)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(SoundManager._soundMuted)return null}ext=SoundManager._pool[url];return soundClass=soundClass||SoundManager._soundClass,ext||((ext=new soundClass).load(url),SoundManager._pool[url]=ext),(soundClass=ext.play(startTime,loops))?(soundClass.url=url,soundClass.volume=url==SoundManager._tMusic?SoundManager.musicVolume:SoundManager.soundVolume,soundClass.completeHandler=complete,soundClass):null},SoundManager.destroySound=function(url){var tSound=SoundManager._pool[url];tSound&&(delete SoundManager._pool[url],tSound.dispose())},SoundManager.playMusic=function(url,loops,complete,startTime){return void 0===loops&&(loops=0),void 0===startTime&&(startTime=0),SoundManager._tMusic=url,SoundManager._musicChannel&&SoundManager._musicChannel.stop(),SoundManager._musicChannel=SoundManager.playSound(url,loops,complete,null,startTime)},SoundManager.stopSound=function(url){for(var channel,i=SoundManager._channels.length-1;0<=i;i--)(channel=SoundManager._channels[i]).url==url&&channel.stop()},SoundManager.stopAll=function(){SoundManager._tMusic=null;for(var i=0,i=SoundManager._channels.length-1;0<=i;i--)SoundManager._channels[i].stop()},SoundManager.stopAllSound=function(){for(var channel,i=0,i=SoundManager._channels.length-1;0<=i;i--)(channel=SoundManager._channels[i]).url!=SoundManager._tMusic&&channel.stop()},SoundManager.stopMusic=function(){SoundManager._musicChannel&&SoundManager._musicChannel.stop(),SoundManager._tMusic=null},SoundManager.setSoundVolume=function(volume,url){if(url)SoundManager._setVolume(url,volume);else{SoundManager.soundVolume=volume;for(var channel,i=0,i=SoundManager._channels.length-1;0<=i;i--)(channel=SoundManager._channels[i]).url!=SoundManager._tMusic&&(channel.volume=volume)}},SoundManager.setMusicVolume=function(volume){SoundManager.musicVolume=volume,SoundManager._setVolume(SoundManager._tMusic,volume)},SoundManager._setVolume=function(url,volume){for(var channel,i=SoundManager._channels.length-1;0<=i;i--)(channel=SoundManager._channels[i]).url==url&&(channel.volume=volume)},SoundManager.musicVolume=1,SoundManager.soundVolume=1,SoundManager.playbackRate=1,SoundManager._useAudioMusic=!0,SoundManager._muted=!1,SoundManager._soundMuted=!1,SoundManager._musicMuted=!1,SoundManager._tMusic=null,SoundManager._musicChannel=null,SoundManager._channels=[],SoundManager._autoStopMusic=!1,SoundManager._blurPaused=!1,SoundManager._isActive=!0,SoundManager._soundClass=null,SoundManager._musicClass=null,SoundManager.autoReleaseSound=!0,SoundManager._pool={},SoundManager.defaultIntervals={},SoundManager._notUsedUrls={},SoundManager._notUsedCount=0,SoundManager}(),LocalStorage=function(){var Storage;function LocalStorage(){}return __class(LocalStorage,"laya.net.LocalStorage"),LocalStorage.__init__=function(){LocalStorage._baseClass||(LocalStorage._baseClass=Storage).init(),LocalStorage.items=LocalStorage._baseClass.items,LocalStorage.support=LocalStorage._baseClass.support},LocalStorage.setItem=function(key,value){LocalStorage._baseClass.setItem(key,value)},LocalStorage.getItem=function(key){return LocalStorage._baseClass.getItem(key)},LocalStorage.setJSON=function(key,value){LocalStorage._baseClass.setJSON(key,value)},LocalStorage.getJSON=function(key){return LocalStorage._baseClass.getJSON(key)},LocalStorage.removeItem=function(key){LocalStorage._baseClass.removeItem(key)},LocalStorage.clear=function(){LocalStorage._baseClass.clear()},LocalStorage._baseClass=null,LocalStorage.items=null,LocalStorage.support=!1,LocalStorage.__init$=function(){Storage=function(){function Storage(){}return __class(Storage,""),Storage.init=function(){try{Storage.support=!0,Storage.items=window.localStorage,Storage.setItem("laya","1"),Storage.removeItem("laya")}catch(e){Storage.support=!1}Storage.support||console.log("LocalStorage is not supprot or browser is private mode.")},Storage.setItem=function(key,value){try{Storage.support&&Storage.items.setItem(key,value)}catch(e){console.warn("set localStorage failed",e)}},Storage.getItem=function(key){return Storage.support?Storage.items.getItem(key):null},Storage.setJSON=function(key,value){try{Storage.support&&Storage.items.setItem(key,JSON.stringify(value))}catch(e){console.warn("set localStorage failed",e)}},Storage.getJSON=function(key){return JSON.parse(Storage.support?Storage.items.getItem(key):null)},Storage.removeItem=function(key){Storage.support&&Storage.items.removeItem(key)},Storage.clear=function(){Storage.support&&Storage.items.clear()},Storage.items=null,Storage.support=!1,Storage}()},LocalStorage}(),TTFLoader=(function(){function ResourceVersion(){}__class(ResourceVersion,"laya.net.ResourceVersion"),ResourceVersion.enable=function(manifestFile,callback,type){void 0===type&&(type=2),laya.net.ResourceVersion.type=type,Laya.loader.load(manifestFile,Handler.create(null,ResourceVersion.onManifestLoaded,[callback]),null,"json"),URL.customFormat=ResourceVersion.addVersionPrefix},ResourceVersion.onManifestLoaded=function(callback,data){ResourceVersion.manifest=data,callback.run(),data||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},ResourceVersion.addVersionPrefix=function(originURL){return ResourceVersion.manifest&&ResourceVersion.manifest[originURL]?2==ResourceVersion.type?ResourceVersion.manifest[originURL]:ResourceVersion.manifest[originURL]+"/"+originURL:originURL},ResourceVersion.FOLDER_VERSION=1,ResourceVersion.FILENAME_VERSION=2,ResourceVersion.manifest=null,ResourceVersion.type=1}(),function(){function TTFLoader(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}__class(TTFLoader,"laya.net.TTFLoader");var __proto=TTFLoader.prototype;return __proto.load=function(fontPath){fontPath=(this._url=fontPath).split(".ttf")[0].split("/");this.fontName=fontPath[fontPath.length-1],Browser.window.conch?this._loadConch():Browser.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},__proto._loadConch=function(){this._http=new HttpRequest,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},__proto._onHttpLoaded=function(data){Browser.window.conch.setFontFaceFromBuffer(this.fontName,data),this._clearHttp(),this._complete()},__proto._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},__proto._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},__proto._complete=function(){Laya.timer.clear(this,this._complete),Laya.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},__proto._checkComplete=function(){RunDriver.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},__proto._loadWithFontFace=function(){var fontFace=new Browser.window.FontFace(this.fontName,"url('"+this._url+"')"),self=(Browser.window.document.fonts.add(fontFace),this);fontFace.loaded.then(function(){self._complete()}),fontFace.load()},__proto._createDiv=function(){this._div=Browser.createElement("div"),this._div.innerHTML="laya";var _style=this._div.style;_style.fontFamily=this.fontName,_style.position="absolute",_style.left="-100px",_style.top="-100px",Browser.document.body.appendChild(this._div)},__proto._loadWithCSS=function(){var _$this=this,fontStyle=Browser.createElement("style"),self=(fontStyle.type="text/css",Browser.document.body.appendChild(fontStyle),fontStyle.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=RunDriver.measureText("LayaTTFFont",this._fontTxt).width,this);fontStyle.onload=function(){Laya.timer.once(1e4,self,_$this._complete)},Laya.timer.loop(20,this,this._checkComplete),this._createDiv()},TTFLoader._testString="LayaTTFFont",TTFLoader}()),URL=function(){function URL(url){this._url=null,this._path=null,this._url=URL.formatURL(url),this._path=URL.getPath(url)}__class(URL,"laya.net.URL");var __proto=URL.prototype;return __getset(0,__proto,"path",function(){return this._path}),__getset(0,__proto,"url",function(){return this._url}),URL.formatURL=function(url,base){if(!url)return"null path";if(0<url.indexOf(":"))return url;var char1=(url=null!=URL.customFormat?URL.customFormat(url,base):url).charAt(0);if("."===char1)return URL.formatRelativePath((base||URL.basePath)+url);if("~"===char1)return URL.rootPath+url.substring(1);if("d"===char1){if(0===url.indexOf("data:image"))return url}else if("/"===char1)return url;return(base||URL.basePath)+url},URL.formatRelativePath=function(value){for(var parts=value.split("/"),i=0,len=parts.length;i<len;i++)".."==parts[i]&&(parts.splice(i-1,2),i-=2);return parts.join("/")},URL.isAbsolute=function(url){return 0<url.indexOf(":")||"/"==url.charAt(0)},URL.getPath=function(url){var ofs=url.lastIndexOf("/");return 0<ofs?url.substr(0,ofs+1):""},URL.getFileName=function(url){var ofs=url.lastIndexOf("/");return 0<ofs?url.substr(ofs+1):url},URL.version={},URL.basePath="",URL.rootPath="",URL.customFormat=function(url){var newUrl=URL.version[url];return!Render.isConchApp&&newUrl&&(url+="?v="+newUrl),url},URL}(),Render=function(){function Render(width,height){this._timeId=0;var style=Render._mainCanvas.source.style,style=(style.position="absolute",style.top=style.left="0px",style.background="#000000",Render._mainCanvas.source.id="layaCanvas",laya.renders.Render.isWebGL);Render._mainCanvas.source.width=width,Render._mainCanvas.source.height=height,style&&Render.WebGL.init(Render._mainCanvas,width,height),Browser.container.appendChild(Render._mainCanvas.source),Render._context=new RenderContext(width,height,style?null:Render._mainCanvas),Render._context.ctx.setIsMainContext(),Browser.window.requestAnimationFrame(function loop(stamp){Browser.window.requestAnimationFrame(loop);Laya.stage._loop()}),Laya.stage.on("visibilitychange",this,this._onVisibilitychange)}__class(Render,"laya.renders.Render");var __proto=Render.prototype;return __proto._onVisibilitychange=function(){Laya.stage.isVisibility?0!=this._timeId&&Browser.window.clearInterval(this._timeId):this._timeId=Browser.window.setInterval(this._enterFrame,1e3)},__proto._enterFrame=function(e){Laya.stage._loop()},__getset(1,Render,"context",function(){return Render._context}),__getset(1,Render,"canvas",function(){return Render._mainCanvas.source}),Render._context=null,Render._mainCanvas=null,Render.WebGL=null,Render.isConchNode=!1,Render.isConchApp=!1,Render.isConchWebGL=!1,Render.isWebGL=!1,Render.is3DMode=!1,Render.optimizeTextureMemory=function(url,texture){return!0},Render.__init$=function(){window.ConchRenderType=window.ConchRenderType||1,window.ConchRenderType|=window.conch?4:0,Render.isConchNode=5==(5&window.ConchRenderType),Render.isConchApp=4==(4&window.ConchRenderType),Render.isConchWebGL=6==window.ConchRenderType},Render}(),RenderContext=function(){function RenderContext(width,height,canvas){this.x=0,this.y=0,this._drawTexture=function(x,y,args){args[0].loaded&&this.ctx.drawTexture(args[0],args[1],args[2],args[3],args[4],x,y)},this._fillTexture=function(x,y,args){args[0].loaded&&this.ctx.fillTexture(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6],args[7])},this._drawTextureWithTransform=function(x,y,args){args[0].loaded&&this.ctx.drawTextureWithTransform(args[0],args[1],args[2],args[3],args[4],args[5],x,y,args[6])},this._fillQuadrangle=function(x,y,args){this.ctx.fillQuadrangle(args[0],args[1],args[2],args[3],args[4])},this._drawRect=function(x,y,args){var ctx=this.ctx;null!=args[4]&&(ctx.fillStyle=args[4],ctx.fillRect(x+args[0],y+args[1],args[2],args[3],null)),null!=args[5]&&(ctx.strokeStyle=args[5],ctx.lineWidth=args[6],ctx.strokeRect(x+args[0],y+args[1],args[2],args[3],args[6]))},this._drawPie=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[8]),ctx.beginPath(),Render.isWebGL?(ctx.movePath(args[0]+x,args[1]+y),ctx.moveTo(0,0)):ctx.moveTo(x+args[0],y+args[1]),ctx.arc(x+args[0],y+args[1],args[2],args[3],args[4]),ctx.closePath(),this._fillAndStroke(args[5],args[6],args[7],!0)},this._clipRect=function(x,y,args){this.ctx.clipRect(x+args[0],y+args[1],args[2],args[3])},this._fillRect=function(x,y,args){this.ctx.fillRect(x+args[0],y+args[1],args[2],args[3],args[4])},this._drawCircle=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[6]),Stat.drawCall++,ctx.beginPath(),Render.isWebGL&&ctx.movePath(args[0]+x,args[1]+y),ctx.arc(args[0]+x,args[1]+y,args[2],0,RenderContext.PI2),ctx.closePath(),this._fillAndStroke(args[3],args[4],args[5],!0)},this._fillCircle=function(x,y,args){Stat.drawCall++;var ctx=this.ctx;ctx.beginPath(),ctx.fillStyle=args[3],ctx.arc(args[0]+x,args[1]+y,args[2],0,RenderContext.PI2),ctx.fill()},this._setShader=function(x,y,args){this.ctx.setShader(args[0])},this._drawLine=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[6]),ctx.beginPath(),ctx.strokeStyle=args[4],ctx.lineWidth=args[5],Render.isWebGL?(ctx.movePath(x,y),ctx.moveTo(args[0],args[1]),ctx.lineTo(args[2],args[3])):(ctx.moveTo(x+args[0],y+args[1]),ctx.lineTo(x+args[2],y+args[3])),ctx.stroke()},this._drawLines=function(x,y,args){var ctx=this.ctx,points=(Render.isWebGL&&ctx.setPathId(args[5]),ctx.beginPath(),x+=args[0],y+=args[1],Render.isWebGL&&ctx.movePath(x,y),ctx.strokeStyle=args[3],ctx.lineWidth=args[4],args[2]),i=2,n=points.length;if(Render.isWebGL)for(ctx.moveTo(points[0],points[1]);i<n;)ctx.lineTo(points[i++],points[i++]);else for(ctx.moveTo(x+points[0],y+points[1]);i<n;)ctx.lineTo(x+points[i++],y+points[i++]);ctx.stroke()},this._drawLinesWebGL=function(x,y,args){this.ctx.drawLines(x+this.x+args[0],y+this.y+args[1],args[2],args[3],args[4])},this._drawCurves=function(x,y,args){this.ctx.drawCurves(x,y,args)},this._draw=function(x,y,args){args[0].call(null,this,x,y)},this._transformByMatrix=function(x,y,args){this.ctx.transformByMatrix(args[0])},this._setTransform=function(x,y,args){this.ctx.setTransform(args[0],args[1],args[2],args[3],args[4],args[5])},this._setTransformByMatrix=function(x,y,args){this.ctx.setTransformByMatrix(args[0])},this._save=function(x,y,args){this.ctx.save()},this._restore=function(x,y,args){this.ctx.restore()},this._translate=function(x,y,args){this.ctx.translate(args[0],args[1])},this._transform=function(x,y,args){this.ctx.translate(args[1]+x,args[2]+y);var mat=args[0];this.ctx.transform(mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty),this.ctx.translate(-x-args[1],-y-args[2])},this._rotate=function(x,y,args){this.ctx.translate(args[1]+x,args[2]+y),this.ctx.rotate(args[0]),this.ctx.translate(-x-args[1],-y-args[2])},this._scale=function(x,y,args){this.ctx.translate(args[2]+x,args[3]+y),this.ctx.scale(args[0],args[1]),this.ctx.translate(-x-args[2],-y-args[3])},this._alpha=function(x,y,args){this.ctx.globalAlpha*=args[0]},this._setAlpha=function(x,y,args){this.ctx.globalAlpha=args[0]},this._fillText=function(x,y,args){this.ctx.fillText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5])},this._strokeText=function(x,y,args){this.ctx.strokeText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6])},this._fillBorderText=function(x,y,args){this.ctx.fillBorderText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6],args[7])},this._blendMode=function(x,y,args){this.ctx.globalCompositeOperation=args[0]},this._beginClip=function(x,y,args){this.ctx.beginClip&&this.ctx.beginClip(x+args[0],y+args[1],args[2],args[3])},this._setIBVB=function(x,y,args){this.ctx.setIBVB(args[0]+x,args[1]+y,args[2],args[3],args[4],args[5],args[6],args[7])},this._fillTrangles=function(x,y,args){this.ctx.fillTrangles(args[0],args[1]+x,args[2]+y,args[3],args[4])},this._drawPath=function(x,y,args){for(var ctx=this.ctx,paths=(Render.isWebGL&&ctx.setPathId(-1),ctx.beginPath(),x+=args[0],y+=args[1],Render.isWebGL&&ctx.movePath(x,y),args[2]),i=0,n=paths.length;i<n;i++){var path=paths[i];switch(path[0]){case"moveTo":Render.isWebGL?ctx.moveTo(path[1],path[2]):ctx.moveTo(x+path[1],y+path[2]);break;case"lineTo":Render.isWebGL?ctx.lineTo(path[1],path[2]):ctx.lineTo(x+path[1],y+path[2]);break;case"arcTo":Render.isWebGL?ctx.arcTo(path[1],path[2],path[3],path[4],path[5]):ctx.arcTo(x+path[1],y+path[2],x+path[3],y+path[4],path[5]);break;case"closePath":ctx.closePath()}}var brush=args[3],brush=(null!=brush&&(ctx.fillStyle=brush.fillStyle,ctx.fill()),args[4]);null!=brush&&(ctx.strokeStyle=brush.strokeStyle,ctx.lineWidth=brush.lineWidth||1,ctx.lineJoin=brush.lineJoin,ctx.lineCap=brush.lineCap,ctx.miterLimit=brush.miterLimit,ctx.stroke())},this.drawPoly=function(x,y,args){this.ctx.drawPoly(x+this.x+args[0],y+this.y+args[1],args[2],args[3],args[4],args[5],args[6])},this._drawPoly=function(x,y,args){var ctx=this.ctx,points=args[2],i=2,n=points.length;if(Render.isWebGL)for(ctx.setPathId(args[6]),ctx.beginPath(),x+=args[0],y+=args[1],ctx.movePath(x,y),ctx.moveTo(points[0],points[1]);i<n;)ctx.lineTo(points[i++],points[i++]);else for(ctx.beginPath(),x+=args[0],y+=args[1],ctx.moveTo(x+points[0],y+points[1]);i<n;)ctx.lineTo(x+points[i++],y+points[i++]);ctx.closePath(),this._fillAndStroke(args[3],args[4],args[5],args[7])},this._drawSkin=function(x,y,args){var ctx,args=args[0];args&&(ctx=this.ctx,args.render(ctx,x,y))},this._drawParticle=function(x,y,args){this.ctx.drawParticle(x+this.x,y+this.y,args[0])},this._setFilters=function(x,y,args){this.ctx.setFilters(args)},canvas?this.ctx=canvas.getContext("2d"):(canvas=HTMLCanvas.create("3D"),this.ctx=RunDriver.createWebGLContext2D(canvas),canvas._setContext(this.ctx)),canvas.size(width,height),this.canvas=canvas}__class(RenderContext,"laya.renders.RenderContext");var __proto=RenderContext.prototype;return __proto.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},__proto.drawTexture=function(tex,x,y,width,height){tex.loaded&&this.ctx.drawTexture(tex,x,y,width,height,this.x,this.y)},__proto._drawTextures=function(x,y,args){args[0].loaded&&this.ctx.drawTextures(args[0],args[1],x+this.x,y+this.y)},__proto.drawTextureWithTransform=function(tex,x,y,width,height,m,alpha){tex.loaded&&this.ctx.drawTextureWithTransform(tex,x,y,width,height,m,this.x,this.y,alpha)},__proto.fillQuadrangle=function(tex,x,y,point4,m){this.ctx.fillQuadrangle(tex,x,y,point4,m)},__proto.drawCanvas=function(canvas,x,y,width,height){this.ctx.drawCanvas(canvas,x+this.x,y+this.y,width,height)},__proto.drawRect=function(x,y,width,height,color,lineWidth){void 0===lineWidth&&(lineWidth=1);var ctx=this.ctx;ctx.strokeStyle=color,ctx.lineWidth=lineWidth,ctx.strokeRect(x+this.x,y+this.y,width,height,lineWidth)},__proto._fillAndStroke=function(fillColor,strokeColor,lineWidth,isConvexPolygon){void 0===isConvexPolygon&&(isConvexPolygon=!1);var ctx=this.ctx;null!=fillColor&&(ctx.fillStyle=fillColor,Render.isWebGL?ctx.fill(isConvexPolygon):ctx.fill()),null!=strokeColor&&0<lineWidth&&(ctx.strokeStyle=strokeColor,ctx.lineWidth=lineWidth,ctx.stroke())},__proto.clipRect=function(x,y,width,height){this.ctx.clipRect(x+this.x,y+this.y,width,height)},__proto.fillRect=function(x,y,width,height,fillStyle){this.ctx.fillRect(x+this.x,y+this.y,width,height,fillStyle)},__proto.drawCircle=function(x,y,radius,color,lineWidth){void 0===lineWidth&&(lineWidth=1),Stat.drawCall++;var ctx=this.ctx;ctx.beginPath(),ctx.strokeStyle=color,ctx.lineWidth=lineWidth,ctx.arc(x+this.x,y+this.y,radius,0,RenderContext.PI2),ctx.stroke()},__proto.drawTriangles=function(x,y,args){if(Render.isWebGL)this.ctx.drawTriangles(args[0],x+args[1],y+args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9]);else for(var indices=args[5],i=0,len=indices.length,ctx=this.ctx,i=0;i<len;i+=3){var index0=2*indices[i],index1=2*indices[i+1],index2=2*indices[i+2];ctx.drawTriangle(args[0],args[3],args[4],index0,index1,index2,args[6],!0)}},__proto.fillCircle=function(x,y,radius,color){Stat.drawCall++;var ctx=this.ctx;ctx.beginPath(),ctx.fillStyle=color,ctx.arc(x+this.x,y+this.y,radius,0,RenderContext.PI2),ctx.fill()},__proto.setShader=function(shader){this.ctx.setShader(shader)},__proto.drawLine=function(fromX,fromY,toX,toY,color,lineWidth){void 0===lineWidth&&(lineWidth=1);var ctx=this.ctx;ctx.beginPath(),ctx.strokeStyle=color,ctx.lineWidth=lineWidth,ctx.moveTo(this.x+fromX,this.y+fromY),ctx.lineTo(this.x+toX,this.y+toY),ctx.stroke()},__proto.clear=function(){this.ctx.clear()},__proto.transformByMatrix=function(value){this.ctx.transformByMatrix(value)},__proto.setTransform=function(a,b,c,d,tx,ty){this.ctx.setTransform(a,b,c,d,tx,ty)},__proto.setTransformByMatrix=function(value){this.ctx.setTransformByMatrix(value)},__proto.save=function(){this.ctx.save()},__proto.restore=function(){this.ctx.restore()},__proto.translate=function(x,y){this.ctx.translate(x,y)},__proto.transform=function(a,b,c,d,tx,ty){this.ctx.transform(a,b,c,d,tx,ty)},__proto.rotate=function(angle){this.ctx.rotate(angle)},__proto.scale=function(scaleX,scaleY){this.ctx.scale(scaleX,scaleY)},__proto.alpha=function(value){this.ctx.globalAlpha*=value},__proto.setAlpha=function(value){this.ctx.globalAlpha=value},__proto.fillWords=function(words,x,y,font,color,underLine){this.ctx.fillWords(words,x,y,font,color,underLine=void 0===underLine?0:underLine)},__proto.fillBorderWords=function(words,x,y,font,fillColor,borderColor,lineWidth){this.ctx.fillBorderWords(words,x,y,font,fillColor,borderColor,lineWidth)},__proto.fillText=function(text,x,y,font,color,textAlign){this.ctx.fillText(text,x+this.x,y+this.y,font,color,textAlign)},__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){this.ctx.strokeText(text,x+this.x,y+this.y,font,color,lineWidth,textAlign)},__proto.blendMode=function(type){this.ctx.globalCompositeOperation=type},__proto.flush=function(){this.ctx.flush&&this.ctx.flush()},__proto.addRenderObject=function(o){this.ctx.addRenderObject(o)},__proto.beginClip=function(x,y,w,h){this.ctx.beginClip&&this.ctx.beginClip(x,y,w,h)},__proto.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},__proto.fillTrangles=function(x,y,args){this.ctx.fillTrangles(args[0],args[1],args[2],args[3],4<args.length?args[4]:null)},RenderContext.PI2=2*Math.PI,RenderContext}(),RenderSprite=function(){function RenderSprite(type,next){switch(this._next=next||RenderSprite.NORENDER,type){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=Filter._filter);case 69905:return void(this._fun=RenderSprite._initRenderFun)}this.onCreate(type)}__class(RenderSprite,"laya.renders.RenderSprite");var __proto=RenderSprite.prototype;return __proto.onCreate=function(type){},__proto._style=function(sprite,context,x,y){sprite._style.render(sprite,context,x,y);var next=this._next;next._fun.call(next,sprite,context,x,y)},__proto._no=function(sprite,context,x,y){},__proto._custom=function(sprite,context,x,y){sprite.customRender(context,x,y);var tf=sprite._style._tf;this._next._fun.call(this._next,sprite,context,x-tf.translateX,y-tf.translateY)},__proto._clip=function(sprite,context,x,y){var r,next=this._next;next!=RenderSprite.NORENDER&&(r=sprite._style.scrollRect,context.ctx.save(),context.ctx.clipRect(x,y,r.width,r.height),next._fun.call(next,sprite,context,x-r.x,y-r.y),context.ctx.restore())},__proto._blend=function(sprite,context,x,y){var style=sprite._style,style=(style.blendMode&&(context.ctx.globalCompositeOperation=style.blendMode),this._next);style._fun.call(style,sprite,context,x,y),context.ctx.globalCompositeOperation="source-over"},__proto._mask=function(sprite,context,x,y){var next=this._next,next=(next._fun.call(next,sprite,context,x,y),sprite.mask);next&&(context.ctx.globalCompositeOperation="destination-in",(0<next.numChildren||!next.graphics._isOnlyOne())&&(next.cacheAsBitmap=!0),next.render(context,x-sprite.pivotX,y-sprite.pivotY)),context.ctx.globalCompositeOperation="source-over"},__proto._graphics=function(sprite,context,x,y){var tf=sprite._style._tf,tf=(sprite._graphics&&sprite._graphics._render(sprite,context,x-tf.translateX,y-tf.translateY),this._next);tf._fun.call(tf,sprite,context,x,y)},__proto._image=function(sprite,context,x,y){var style=sprite._style;context.ctx.drawTexture2(x,y,style._tf.translateX,style._tf.translateY,sprite.transform,style.alpha,style.blendMode,sprite._graphics._one)},__proto._image2=function(sprite,context,x,y){var tf=sprite._style._tf;context.ctx.drawTexture2(x,y,tf.translateX,tf.translateY,sprite.transform,1,null,sprite._graphics._one)},__proto._alpha=function(sprite,context,x,y){var temp,alpha;(.01<(alpha=sprite._style.alpha)||sprite._needRepaint())&&(temp=context.ctx.globalAlpha,context.ctx.globalAlpha*=alpha,(alpha=this._next)._fun.call(alpha,sprite,context,x,y),context.ctx.globalAlpha=temp)},__proto._transform=function(sprite,context,x,y){var transform=sprite.transform,_next=this._next;transform&&_next!=RenderSprite.NORENDER?(context.save(),context.transform(transform.a,transform.b,transform.c,transform.d,transform.tx+x,transform.ty+y),_next._fun.call(_next,sprite,context,0,0),context.restore()):_next._fun.call(_next,sprite,context,x,y)},__proto._childs=function(sprite,context,x,y){var ele,style=sprite._style,tf=style._tf,childs=(x=x-tf.translateX+style.paddingLeft,y=y-tf.translateY+style.paddingTop,style._calculation&&(tf=sprite._getWords())&&(style=style)&&(style.stroke?context.fillBorderWords(tf,x,y,style.font,style.color,style.strokeColor,style.stroke):context.fillWords(tf,x,y,style.font,style.color,"none"!=style.textDecoration&&style.underLine?1:0)),sprite._childs),n=childs.length;if(sprite.viewport||sprite.optimizeScrollRect&&sprite._style.scrollRect)for(var _x,tf=sprite.viewport||sprite._style.scrollRect,left=tf.x,top=tf.y,right=tf.right,bottom=tf.bottom,_y=NaN,i=0;i<n;++i)(ele=childs[i]).visible&&(_x=ele._x)<right&&_x+ele.width>left&&(_y=ele._y)<bottom&&_y+ele.height>top&&ele.render(context,x,y);else for(var i=0;i<n;++i)(ele=childs[i])._style.visible&&ele.render(context,x,y)},__proto._canvas=function(sprite,context,x,y){var tx,_cacheCanvas=sprite._$P.cacheCanvas;_cacheCanvas?("bitmap"===_cacheCanvas.type?Stat.canvasBitmap++:Stat.canvasNormal++,tx=_cacheCanvas.ctx,sprite._needRepaint()||!tx?this._canvas_repaint(sprite,context,x,y):(_cacheCanvas=_cacheCanvas._cacheRec,context.drawCanvas(tx.canvas,x+_cacheCanvas.x,y+_cacheCanvas.y,_cacheCanvas.width,_cacheCanvas.height))):this._next._fun.call(this._next,sprite,context,x,y)},__proto._canvas_repaint=function(sprite,context,x,y){var _cacheCanvas=sprite._$P.cacheCanvas,_next=this._next;if(_cacheCanvas){var canvas,left,top,tRec,tx=_cacheCanvas.ctx,_repaint=sprite._needRepaint()||!tx,tCacheType=_cacheCanvas.type;if("bitmap"===tCacheType?Stat.canvasBitmap++:Stat.canvasNormal++,_repaint){_cacheCanvas._cacheRec||(_cacheCanvas._cacheRec=new Rectangle),Render.isWebGL&&"bitmap"!==tCacheType?_cacheCanvas._cacheRec.setTo(-sprite.pivotX,-sprite.pivotY,1,1):((tRec=sprite.getSelfBounds()).x=tRec.x-sprite.pivotX,tRec.y=tRec.y-sprite.pivotY,tRec.x=tRec.x-16,tRec.y=tRec.y-16,tRec.width=tRec.width+32,tRec.height=tRec.height+32,tRec.x=Math.floor(tRec.x+x)-x,tRec.y=Math.floor(tRec.y+y)-y,tRec.width=Math.floor(tRec.width),tRec.height=Math.floor(tRec.height),_cacheCanvas._cacheRec.copyFrom(tRec)),tRec=_cacheCanvas._cacheRec;var h,scrollRect,t,ctx,_repaint=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleX,scaleY=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleY;if(!Render.isWebGL){for(var chainScaleX=1,chainScaleY=1,tar=sprite;tar&&tar!=Laya.stage;)chainScaleX*=tar.scaleX,chainScaleY*=tar.scaleY,tar=tar.parent;Render.isWebGL?(chainScaleX<1&&(_repaint*=chainScaleX),chainScaleY<1&&(scaleY*=chainScaleY)):(1<chainScaleX&&(_repaint*=chainScaleX),1<chainScaleY&&(scaleY*=chainScaleY))}if(sprite.scrollRect&&(scrollRect=sprite.scrollRect,tRec.x-=scrollRect.x,tRec.y-=scrollRect.y),scrollRect=tRec.width*_repaint,h=tRec.height*scaleY,left=tRec.x,top=tRec.y,Render.isWebGL&&"bitmap"===tCacheType&&(2048<scrollRect||2048<h))return console.warn("cache bitmap size larger than 2048,cache ignored"),_cacheCanvas.ctx&&(Pool.recover("RenderContext",_cacheCanvas.ctx),_cacheCanvas.ctx.canvas.size(0,0),_cacheCanvas.ctx=null),void _next._fun.call(_next,sprite,context,x,y);(tx=tx||(_cacheCanvas.ctx=Pool.getItem("RenderContext")||new RenderContext(scrollRect,h,HTMLCanvas.create("AUTO")))).ctx.sprite=sprite,(canvas=tx.canvas).clear(),canvas.width==scrollRect&&canvas.height==h||canvas.size(scrollRect,h),"bitmap"===tCacheType?canvas.context.asBitmap=!0:"normal"===tCacheType&&(canvas.context.asBitmap=!1),1!=_repaint||1!=scaleY?((ctx=tx.ctx).save(),ctx.scale(_repaint,scaleY),!Render.isConchWebGL&&Render.isConchApp&&(t=sprite._$P.cf)&&ctx.setFilterMatrix&&ctx.setFilterMatrix(t._mat,t._alpha),_next._fun.call(_next,sprite,tx,-left,-top),ctx.restore()):(ctx=tx.ctx,!Render.isConchWebGL&&Render.isConchApp&&(t=sprite._$P.cf)&&ctx.setFilterMatrix&&ctx.setFilterMatrix(t._mat,t._alpha),_next._fun.call(_next,sprite,tx,-left,-top)),Render.isConchApp&&!Render.isConchWebGL||sprite._applyFilters(),sprite._$P.staticCache&&(_cacheCanvas.reCache=!1),Stat.canvasReCache++}else left=(tRec=_cacheCanvas._cacheRec).x,top=tRec.y,canvas=tx.canvas;context.drawCanvas(canvas,x+left,y+top,tRec.width,tRec.height)}else _next._fun.call(_next,sprite,tx,x,y)},RenderSprite.__init__=function(){for(var i=0,initRender=RunDriver.createRenderSprite(69905,null),i=(RenderSprite.renders.length=4096,0);i<4096;i++)RenderSprite.renders[i]=initRender;RenderSprite.renders[0]=RunDriver.createRenderSprite(0,null),function(value,o){for(var n=0,i=0;i<value.length;i++)n|=value[i],RenderSprite.renders[n]=o}([1,512,4,2],new RenderSprite(1,null)),RenderSprite.renders[513]=RunDriver.createRenderSprite(513,null),RenderSprite.renders[517]=new RenderSprite(517,null)},RenderSprite._initRenderFun=function(sprite,context,x,y){var type=sprite._renderType;(RenderSprite.renders[type]=RenderSprite._getTypeRender(type))._fun(sprite,context,x,y)},RenderSprite._getTypeRender=function(type){for(var rst=null,tType=2048;1<tType;)tType&type&&(rst=RunDriver.createRenderSprite(tType,rst)),tType>>=1;return rst},RenderSprite.IMAGE=1,RenderSprite.ALPHA=2,RenderSprite.TRANSFORM=4,RenderSprite.BLEND=8,RenderSprite.CANVAS=16,RenderSprite.FILTERS=32,RenderSprite.MASK=64,RenderSprite.CLIP=128,RenderSprite.STYLE=256,RenderSprite.GRAPHICS=512,RenderSprite.CUSTOM=1024,RenderSprite.CHILDS=2048,RenderSprite.INIT=69905,RenderSprite.renders=[],RenderSprite.NORENDER=new RenderSprite(0,null),RenderSprite}(),Context=function(){function Context(){this._repaint=!1}__class(Context,"laya.resource.Context");var __proto=Context.prototype;return __proto.replaceReset=function(){for(var key,i=0,len=Context.replaceKeys.length,i=0;i<len;i++)key=Context.replaceKeys[i],this[Context.newKeys[i]]=this[key]},__proto.replaceResotre=function(){this.__restore(),this.__reset()},__proto.setIsMainContext=function(){},__proto.drawTextures=function(tex,pos,tx,ty){Stat.drawCall+=pos.length/2;for(var w=tex.width,h=tex.height,i=0,sz=pos.length;i<sz;i+=2)this.drawTexture(tex,pos[i],pos[i+1],w,h,tx,ty)},__proto.drawCanvas=function(canvas,x,y,width,height){Stat.drawCall++,this.drawImage(canvas.source,x,y,width,height)},__proto.fillRect=function(x,y,width,height,style){Stat.drawCall++,style&&(this.fillStyle=style),this.__fillRect(x,y,width,height)},__proto.fillText=function(text,x,y,font,color,textAlign){Stat.drawCall++,3<arguments.length&&null!=font&&(this.font=font,this.fillStyle=color,this.textAlign=textAlign,this.textBaseline="top"),this.__fillText(text,x,y)},__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){Stat.drawCall++,this.font=font,this.fillStyle=fillColor,this.textBaseline="top",this.strokeStyle=borderColor,this.lineWidth=lineWidth,this.textAlign=textAlign,this.__strokeText(text,x,y),this.__fillText(text,x,y)},__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){Stat.drawCall++,3<arguments.length&&null!=font&&(this.font=font,this.strokeStyle=color,this.lineWidth=lineWidth,this.textAlign=textAlign,this.textBaseline="top"),this.__strokeText(text,x,y)},__proto.transformByMatrix=function(value){this.transform(value.a,value.b,value.c,value.d,value.tx,value.ty)},__proto.setTransformByMatrix=function(value){this.setTransform(value.a,value.b,value.c,value.d,value.tx,value.ty)},__proto.clipRect=function(x,y,width,height){Stat.drawCall++,this.beginPath(),this.rect(x,y,width,height),this.clip()},__proto.drawTexture=function(tex,x,y,width,height,tx,ty){Stat.drawCall++;var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x+tx,y+ty,width,height)},__proto.drawTextureWithTransform=function(tex,x,y,width,height,m,tx,ty,alpha){Stat.drawCall++;var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.save(),1!=alpha&&(this.globalAlpha*=alpha),m?(this.transform(m.a,m.b,m.c,m.d,m.tx+tx,m.ty+ty),this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x,y,width,height)):this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x+tx,y+ty,width,height),this.restore()},__proto.drawTexture2=function(x,y,pivotX,pivotY,m,alpha,blendMode,args2){var alphaChanged,temp,w,h,tex=args2[0];tex.loaded&&tex.bitmap&&tex.source&&(Stat.drawCall++,(alphaChanged=1!==alpha)&&(temp=this.globalAlpha,this.globalAlpha*=alpha),alpha=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height,m?(this.save(),this.transform(m.a,m.b,m.c,m.d,m.tx+x,m.ty+y),this.drawImage(tex.source,alpha[0]*w,alpha[1]*h,(alpha[2]-alpha[0])*w,(alpha[5]-alpha[3])*h,args2[1]-pivotX,args2[2]-pivotY,args2[3],args2[4]),this.restore()):this.drawImage(tex.source,alpha[0]*w,alpha[1]*h,(alpha[2]-alpha[0])*w,(alpha[5]-alpha[3])*h,args2[1]-pivotX+x,args2[2]-pivotY+y,args2[3],args2[4]),alphaChanged)&&(this.globalAlpha=temp)},__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){other.pat||(texture.uv!=Texture.DEF_UV&&((canvas=new HTMLCanvas("2D")).getContext("2d"),canvas.size(texture.width,texture.height),canvas.context.drawTexture(texture,0,0,texture.width,texture.height,0,0),texture=new Texture(canvas)),other.pat=this.createPattern(texture.bitmap.source,type));var canvas=x,type=y,x=0,y=0;offset&&(canvas+=offset.x%texture.width,type+=offset.y%texture.height,x-=offset.x%texture.width,y-=offset.y%texture.height),this.translate(canvas,type),this.fillRect(x,y,width,height,other.pat),this.translate(-canvas,-type)},__proto.drawTriangle=function(texture,vertices,uvs,index0,index1,index2,matrix,canvasPadding){var normX,dist,source=texture.bitmap,textureSource=source.source,textureWidth=texture.width,textureHeight=texture.height,sourceWidth=source.width,source=source.height,u0=uvs[index0]*sourceWidth,u1=uvs[index1]*sourceWidth,u2=uvs[index2]*sourceWidth,v0=uvs[index0+1]*source,v1=uvs[index1+1]*source,uvs=uvs[index2+1]*source,x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],index0=vertices[index0+1],index1=vertices[index1+1],vertices=vertices[index2+1];canvasPadding&&(canvasPadding=index0-(index2=(index0+index1+vertices)/3),x0=(centerX=(x0+x1+x2)/3)+(normX=x0-centerX)/(dist=Math.sqrt(normX*normX+canvasPadding*canvasPadding))*(dist+1),index0=index2+canvasPadding/dist*(dist+1),canvasPadding=index1-index2,x1=centerX+(normX=x1-centerX)/(dist=Math.sqrt(normX*normX+canvasPadding*canvasPadding))*(dist+1),index1=index2+canvasPadding/dist*(dist+1),canvasPadding=vertices-index2,x2=centerX+(normX=x2-centerX)/(dist=Math.sqrt(normX*normX+canvasPadding*canvasPadding))*(dist+1),vertices=index2+canvasPadding/dist*(dist+1)),this.save(),matrix&&this.transform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx,matrix.ty),this.beginPath(),this.moveTo(x0,index0),this.lineTo(x1,index1),this.lineTo(x2,vertices),this.closePath(),this.clip();var centerX=1/(u0*v1+v0*u2+u1*uvs-v1*u2-v0*u1-u0*uvs);this.transform((x0*v1+v0*x2+x1*uvs-v1*x2-v0*x1-x0*uvs)*centerX,(index0*v1+v0*vertices+index1*uvs-v1*vertices-v0*index1-index0*uvs)*centerX,(u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2)*centerX,(u0*index1+index0*u2+u1*vertices-index1*u2-index0*u1-u0*vertices)*centerX,(u0*v1*x2+v0*x1*u2+x0*u1*uvs-x0*v1*u2-v0*u1*x2-u0*x1*uvs)*centerX,(u0*v1*vertices+v0*index1*u2+index0*u1*uvs-index0*v1*u2-v0*u1*vertices-u0*index1*uvs)*centerX),this.drawImage(textureSource,texture.uv[0]*sourceWidth,texture.uv[1]*source,textureWidth,textureHeight,texture.uv[0]*sourceWidth,texture.uv[1]*source,textureWidth,textureHeight),this.restore()},__proto.flush=function(){return 0},__proto.fillWords=function(words,x,y,font,color,underLine){font&&(this.font=font),color&&(this.fillStyle=color);this.textBaseline="top",this.textAlign="left";for(var i=0,n=words.length;i<n;i++){var tHeight,dX,a=words[i];this.__fillText(a.char,a.x+x,a.y+y),1===underLine&&(tHeight=a.height,dX=(dX=.5*a.style.letterSpacing)||0,this.beginPath(),this.strokeStyle=color,this.lineWidth=1,this.moveTo(x+a.x-dX+.5,y+a.y+tHeight+.5),this.lineTo(x+a.x+a.width+dX+.5,y+a.y+tHeight+.5),this.stroke())}},__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){font&&(this.font=font),color&&(this.fillStyle=color),this.textBaseline="top",this.lineWidth=lineWidth,this.textAlign="left",this.strokeStyle=borderColor;for(var i=0,n=words.length;i<n;i++){var a=words[i];this.__strokeText(a.char,a.x+x,a.y+y),this.__fillText(a.char,a.x+x,a.y+y)}},__proto.destroy=function(){this.canvas.width=this.canvas.height=0},__proto.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},__proto.drawCurves=function(x,y,args){this.beginPath(),this.strokeStyle=args[3],this.lineWidth=args[4];for(var points=args[2],i=(x+=args[0],y+=args[1],this.moveTo(x+points[0],y+points[1]),2),n=points.length;i<n;)this.quadraticCurveTo(x+points[i++],y+points[i++],x+points[i++],y+points[i++]);this.stroke()},Context.__init__=function(to){var from=laya.resource.Context.prototype;(to=to||CanvasRenderingContext2D.prototype).inited||(to.inited=!0,to.__fillText=to.fillText,to.__fillRect=to.fillRect,to.__strokeText=to.strokeText,["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(i){to[i]=from[i]}))},Context.replaceCanvasGetSet=function(tar,key){var oldO=Object.getOwnPropertyDescriptor(tar,key);if(!oldO||!oldO.configurable)return!1;var tkey,newO={};for(tkey in oldO)"set"!=tkey&&(newO[tkey]=oldO[tkey]);var preFun=oldO.set;return newO.set=function(v){preFun.call(this,v);v=this.getContext("2d");v&&"__reset"in v&&v.__reset()},Object.defineProperty(tar,key,newO),!0},Context.replaceGetSet=function(tar,key){var oldO=Object.getOwnPropertyDescriptor(tar,key);if(!oldO||!oldO.configurable)return!1;var tkey,newO={};for(tkey in oldO)"set"!=tkey&&(newO[tkey]=oldO[tkey]);var preFun=oldO.set,dataKey="___"+key+"__";return Context.newKeys.push(dataKey),newO.set=function(v){v!=this[dataKey]&&(this[dataKey]=v,preFun.call(this,v))},Object.defineProperty(tar,key,newO),!0},Context._default=new Context,Context.newKeys=[],__static(Context,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),Context}(),ResourceManager=function(){function ResourceManager(name){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++ResourceManager._uniqueIDCounter,this._name=name||"Content Manager",ResourceManager._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,ResourceManager._resourceManagers.push(this),this._resources=[]}__class(ResourceManager,"laya.resource.ResourceManager");var __proto=ResourceManager.prototype;return Laya.imps(__proto,{"laya.resource.IDispose":!0}),__proto.getResourceByIndex=function(index){return this._resources[index]},__proto.getResourcesLength=function(){return this._resources.length},__proto.addResource=function(resource){return resource.resourceManager&&resource.resourceManager.removeResource(resource),-1===this._resources.indexOf(resource)&&((resource._resourceManager=this)._resources.push(resource),this.addSize(resource.memorySize),!0)},__proto.removeResource=function(resource){var index=this._resources.indexOf(resource);return-1!==index&&(this._resources.splice(index,1),resource._resourceManager=null,this._memorySize-=resource.memorySize,!0)},__proto.unload=function(){for(var tempResources=this._resources.slice(0,this._resources.length),i=0;i<tempResources.length;i++)tempResources[i].destroy();tempResources.length=0},__proto.dispose=function(){if(this===ResourceManager._systemResourceManager)throw new Error("systemResourceManager不能被释放！");ResourceManager._resourceManagers.splice(ResourceManager._resourceManagers.indexOf(this),1),ResourceManager._isResourceManagersSorted=!1;for(var tempResources=this._resources.slice(0,this._resources.length),i=0;i<tempResources.length;i++){var resource=tempResources[i];resource.resourceManager.removeResource(resource),resource.destroy()}tempResources.length=0},__proto.addSize=function(add){add&&(this.autoRelease&&0<add&&this._memorySize+add>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=add)},__proto.garbageCollection=function(reserveSize){var all=this._resources;(all=all.slice()).sort(function(a,b){if(a&&b)return a.released&&b.released?0:a.released?1:b.released?-1:a._lastUseFrameCount-b._lastUseFrameCount;throw new Error("a或b不能为空！")});for(var currentFrameCount=Stat.loopCount,i=0,n=all.length;i<n;i++){var resou=all[i];if(!(1<currentFrameCount-resou._lastUseFrameCount))return void(this._memorySize>=reserveSize&&(this._isOverflow=!0));if(resou.releaseResource(),this._memorySize<reserveSize)return void(this._isOverflow=!1)}},__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"name",function(){return this._name},function(value){!value&&""===value||this._name===value||(this._name=value,ResourceManager._isResourceManagersSorted=!1)}),__getset(0,__proto,"memorySize",function(){return this._memorySize}),__getset(1,ResourceManager,"systemResourceManager",function(){return ResourceManager._systemResourceManager}),ResourceManager.__init__=function(){ResourceManager.currentResourceManager=ResourceManager.systemResourceManager},ResourceManager.getLoadedResourceManagerByIndex=function(index){return ResourceManager._resourceManagers[index]},ResourceManager.getLoadedResourceManagersCount=function(){return ResourceManager._resourceManagers.length},ResourceManager.recreateContentManagers=function(force){void 0===force&&(force=!1);for(var temp=ResourceManager.currentResourceManager,i=0;i<ResourceManager._resourceManagers.length;i++){ResourceManager.currentResourceManager=ResourceManager._resourceManagers[i];for(var j=0;j<ResourceManager.currentResourceManager._resources.length;j++)ResourceManager.currentResourceManager._resources[j].releaseResource(force),ResourceManager.currentResourceManager._resources[j].activeResource(force)}ResourceManager.currentResourceManager=temp},ResourceManager.releaseContentManagers=function(force){void 0===force&&(force=!1);for(var temp=ResourceManager.currentResourceManager,i=0;i<ResourceManager._resourceManagers.length;i++){ResourceManager.currentResourceManager=ResourceManager._resourceManagers[i];for(var j=0;j<ResourceManager.currentResourceManager._resources.length;j++){var resource=ResourceManager.currentResourceManager._resources[j];resource.released||resource.releaseResource(force)}}ResourceManager.currentResourceManager=temp},ResourceManager._uniqueIDCounter=0,ResourceManager._isResourceManagersSorted=!1,ResourceManager._resourceManagers=[],__static(ResourceManager,["_systemResourceManager",function(){return this._systemResourceManager=new ResourceManager("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=ResourceManager._systemResourceManager}]),ResourceManager}(),Browser=(function(){function System(){}__class(System,"laya.system.System"),System.changeDefinition=function(name,classObj){Laya[name]=classObj,Laya._runScript(name+"=classObj")},System.__init__=function(){Render.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function Browser(){}return __class(Browser,"laya.utils.Browser"),__getset(1,Browser,"pixelRatio",function(){return Browser.__init__(),-1<Browser.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:RunDriver.getPixelRatio()}),__getset(1,Browser,"height",function(){return Browser.__init__(),(Laya.stage&&Laya.stage.canvasRotation?Browser.clientWidth:Browser.clientHeight)*Browser.pixelRatio}),__getset(1,Browser,"clientWidth",function(){return Browser.__init__(),Browser.window.innerWidth||Browser.document.body.clientWidth}),__getset(1,Browser,"window",function(){return Browser.__init__(),Browser._window}),__getset(1,Browser,"clientHeight",function(){return Browser.__init__(),Browser.window.innerHeight||Browser.document.body.clientHeight||Browser.document.documentElement.clientHeight}),__getset(1,Browser,"width",function(){return Browser.__init__(),(Laya.stage&&Laya.stage.canvasRotation?Browser.clientHeight:Browser.clientWidth)*Browser.pixelRatio}),__getset(1,Browser,"container",function(){return Browser.__init__(),Browser._container||((Browser._container=Browser.createElement("div")).id="layaContainer",Browser.document.body.appendChild(Browser._container)),Browser._container},function(value){Browser._container=value}),__getset(1,Browser,"document",function(){return Browser.__init__(),Browser._document}),Browser.__init__=function(){var $BS;Browser._window||(Browser._window=RunDriver.getWindow(),Browser._document=Browser.window.document,Browser._window.addEventListener("message",function(e){laya.utils.Browser._onMessage(e)},!1),Browser.document.__createElement=Browser.document.createElement,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){return window.setTimeout(c,1e3/60)},($BS=window.document.body.style)["-webkit-user-select"]="none",$BS["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",Browser.userAgent=Browser.window.navigator.userAgent,Browser.onIOS=!!(Browser.u=Browser.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),Browser.onMobile=-1<Browser.u.indexOf("Mobile"),Browser.onIPhone=-1<Browser.u.indexOf("iPhone"),Browser.onMac=-1<Browser.u.indexOf("Mac OS X"),Browser.onIPad=-1<Browser.u.indexOf("iPad"),Browser.onAndroid=-1<Browser.u.indexOf("Android")||-1<Browser.u.indexOf("Adr"),Browser.onWP=-1<Browser.u.indexOf("Windows Phone"),Browser.onQQBrowser=-1<Browser.u.indexOf("QQBrowser"),Browser.onMQQBrowser=-1<Browser.u.indexOf("MQQBrowser")||-1<Browser.u.indexOf("Mobile")&&-1<Browser.u.indexOf("QQ"),Browser.onIE=!!Browser.window.ActiveXObject||"ActiveXObject"in Browser.window,Browser.onWeiXin=-1<Browser.u.indexOf("MicroMessenger"),Browser.onPC=!Browser.onMobile,Browser.onSafari=-1<Browser.u.indexOf("Safari"),Browser.onFirefox=-1<Browser.u.indexOf("Firefox"),Browser.onEdge=-1<Browser.u.indexOf("Edge"),Browser.onMiniGame=-1<Browser.u.indexOf("MiniGame"),Browser.onLimixiu=-1<Browser.u.indexOf("limixiu"),Browser.httpProtocol="http:"==Browser.window.location.protocol,Browser.onMiniGame&&null==Browser.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),Browser.webAudioEnabled=!!(Browser.window.AudioContext||Browser.window.webkitAudioContext||Browser.window.mozAudioContext),Browser.soundType=Browser.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",Sound=Browser.webAudioEnabled?WebAudioSound:AudioSound,Browser.webAudioEnabled&&WebAudioSound.initWebAudio(),AudioSound._initMusicAudio(),Browser.enableTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,window.focus(),SoundManager._soundClass=Sound,SoundManager._musicClass=AudioSound,Render._mainCanvas=Render._mainCanvas||HTMLCanvas.create("2D"),Browser.canvas)||(Browser.canvas=HTMLCanvas.create("2D"),Browser.context=Browser.canvas.getContext("2d"))},Browser._onMessage=function(e){e.data&&"size"==e.data.name&&(Browser.window.innerWidth=e.data.width,Browser.window.innerHeight=e.data.height,Browser.window.__innerHeight=e.data.clientHeight,Browser.document.createEvent?((e=Browser.document.createEvent("HTMLEvents")).initEvent("resize",!1,!1),Browser.window.dispatchEvent(e)):console.warn("no document.createEvent"))},Browser.createElement=function(type){return Browser.__init__(),Browser.document.__createElement(type)},Browser.getElementById=function(type){return Browser.__init__(),Browser.document.getElementById(type)},Browser.removeElement=function(ele){ele&&ele.parentNode&&ele.parentNode.removeChild(ele)},Browser.now=function(){return RunDriver.now()},Browser._window=null,Browser._document=null,Browser._container=null,Browser.userAgent=null,Browser.u=null,Browser.onIOS=!1,Browser.onMac=!1,Browser.onMobile=!1,Browser.onIPhone=!1,Browser.onIPad=!1,Browser.onAndroid=!1,Browser.onWP=!1,Browser.onQQBrowser=!1,Browser.onMQQBrowser=!1,Browser.onSafari=!1,Browser.onFirefox=!1,Browser.onEdge=!1,Browser.onIE=!1,Browser.onWeiXin=!1,Browser.onMiniGame=!1,Browser.onLimixiu=!1,Browser.onPC=!1,Browser.httpProtocol=!1,Browser.webAudioEnabled=!1,Browser.soundType=null,Browser.enableTouch=!1,Browser.canvas=null,Browser.context=null,Browser.__init$=function(){},Browser}()),Byte=function(){function Byte(data){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,data?(this._u8d_=new Uint8Array(data),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}__class(Byte,"laya.utils.Byte");var __proto=Byte.prototype;return __proto.___resizeBuffer=function(len){try{var newByteView=new Uint8Array(len);null!=this._u8d_&&(this._u8d_.length<=len?newByteView.set(this._u8d_):newByteView.set(this._u8d_.subarray(0,len))),this._u8d_=newByteView,this._d_=new DataView(newByteView.buffer)}catch(err){throw"___resizeBuffer err:"+len}},__proto.getString=function(){return this.rUTF(this.getUint16())},__proto.getFloat32Array=function(start,len){len=(len=start+len)>this._length?this._length:len,start=new Float32Array(this._d_.buffer.slice(start,len));return this._pos_=len,start},__proto.getUint8Array=function(start,len){len=(len=start+len)>this._length?this._length:len,start=new Uint8Array(this._d_.buffer.slice(start,len));return this._pos_=len,start},__proto.getInt16Array=function(start,len){len=(len=start+len)>this._length?this._length:len,start=new Int16Array(this._d_.buffer.slice(start,len));return this._pos_=len,start},__proto.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var v=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,v},__proto.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var v=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,v},__proto.writeFloat32=function(value){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,value,this._xd_),this._pos_+=4},__proto.writeFloat64=function(value){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,value,this._xd_),this._pos_+=8},__proto.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var float=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,float},__proto.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var v=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,v},__proto.writeInt32=function(value){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,value,this._xd_),this._pos_+=4},__proto.writeUint32=function(value){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,value,this._xd_),this._pos_+=4},__proto.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var us=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,us},__proto.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var us=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,us},__proto.writeUint16=function(value){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,value,this._xd_),this._pos_+=2},__proto.writeInt16=function(value){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,value,this._xd_),this._pos_+=2},__proto.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},__proto.writeUint8=function(value){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,value),this._pos_++},__proto._getUInt8=function(pos){return this._d_.getUint8(pos)},__proto._getUint16=function(pos){return this._d_.getUint16(pos,this._xd_)},__proto._getMatrix=function(){return new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},__proto.rUTF=function(len){for(var c,c3,v=[],max=this._pos_+len,c2=0,f=String.fromCharCode,u=this._u8d_;this._pos_<max;)(c=u[this._pos_++])<128?0!=c&&v.push(f(c)):c<224?v.push(f((63&c)<<6|127&u[this._pos_++])):c<240?(c2=u[this._pos_++],v.push(f((31&c)<<12|(127&c2)<<6|127&u[this._pos_++]))):(c2=u[this._pos_++],c3=u[this._pos_++],v.push(f((15&c)<<18|(127&c2)<<12|c3<<6&127|127&u[this._pos_++]))),0;return v.join("")},__proto.getCustomString=function(len){for(var c2,v=[],ulen=0,c=0,f=String.fromCharCode,u=this._u8d_;0<len;)if((c=u[this._pos_])<128)v.push(f(c)),this._pos_++,len--;else for(ulen=c-128,this._pos_++,len-=ulen;0<ulen;)c=u[this._pos_++],c2=u[this._pos_++],v.push(f(c2<<8|c)),ulen--;return v.join("")},__proto.clear=function(){this._pos_=0,this.length=0},__proto.__getBuffer=function(){return this._d_.buffer},__proto.writeUTFBytes=function(value){for(var i=0,sz=(value+="").length;i<sz;i++){var c=value.charCodeAt(i);c<=127?this.writeByte(c):c<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|c>>6,128|63&c],this._pos_),this._pos_+=2):c<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|c>>12,128|c>>6&63,128|63&c],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|c>>18,128|c>>12&63,128|c>>6&63,128|63&c],this._pos_),this._pos_+=4)}},__proto.writeUTFString=function(value){var tPos=this.pos,value=(this.writeUint16(1),this.writeUTFBytes(value),this.pos-tPos-2);if(65536<=value)throw"writeUTFString byte len more than 65536";this._d_.setUint16(tPos,value,this._xd_)},__proto.readUTFString=function(){return this.readUTFBytes(this.getUint16())},__proto.getUTFString=function(){return this.readUTFString()},__proto.readUTFBytes=function(len){if(0==(len=void 0===len?-1:len))return"";var lastBytes=this.bytesAvailable;if(lastBytes<len)throw"readUTFBytes error - Out of bounds";return this.rUTF(len=0<len?len:lastBytes)},__proto.getUTFBytes=function(len){return this.readUTFBytes(len=void 0===len?-1:len)},__proto.writeByte=function(value){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,value),this._pos_+=1},__proto.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},__proto.getByte=function(){return this.readByte()},__proto.ensureWrite=function(lengthToEnsure){this._length<lengthToEnsure&&(this._length=lengthToEnsure),this._allocated_<lengthToEnsure&&(this.length=lengthToEnsure)},__proto.writeArrayBuffer=function(arraybuffer,offset,length){if(void 0===length&&(length=0),(offset=void 0===offset?0:offset)<0||length<0)throw"writeArrayBuffer error - Out of bounds";0==length&&(length=arraybuffer.byteLength-offset),this.ensureWrite(this._pos_+length);arraybuffer=new Uint8Array(arraybuffer);this._u8d_.set(arraybuffer.subarray(offset,offset+length),this._pos_),this._pos_+=length},__getset(0,__proto,"buffer",function(){var rstBuffer=this._d_.buffer;return rstBuffer.byteLength==this.length?rstBuffer:rstBuffer.slice(0,this.length)}),__getset(0,__proto,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(endianStr){this._xd_="littleEndian"==endianStr}),__getset(0,__proto,"length",function(){return this._length},function(value){this._allocated_<value?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(value,2*this._allocated_))):this._allocated_>value&&this.___resizeBuffer(this._allocated_=value),this._length=value}),__getset(0,__proto,"pos",function(){return this._pos_},function(value){this._pos_=value}),__getset(0,__proto,"bytesAvailable",function(){return this._length-this._pos_}),Byte.getSystemEndian=function(){var buffer;return Byte._sysEndian||(buffer=new ArrayBuffer(2),new DataView(buffer).setInt16(0,256,!0),Byte._sysEndian=256===new Int16Array(buffer)[0]?"littleEndian":"bigEndian"),Byte._sysEndian},Byte.BIG_ENDIAN="bigEndian",Byte.LITTLE_ENDIAN="littleEndian",Byte._sysEndian=null,Byte}(),CacheManager=function(){function CacheManager(){}return __class(CacheManager,"laya.utils.CacheManager"),CacheManager.regCacheByFunction=function(disposeFunction,getCacheListFunction){CacheManager.unRegCacheByFunction(disposeFunction,getCacheListFunction),CacheManager._cacheList.push({tryDispose:disposeFunction,getCacheList:getCacheListFunction})},CacheManager.unRegCacheByFunction=function(disposeFunction,getCacheListFunction){for(var i=0,len=CacheManager._cacheList.length,i=0;i<len;i++)if(CacheManager._cacheList[i].tryDispose==disposeFunction&&CacheManager._cacheList[i].getCacheList==getCacheListFunction)return void CacheManager._cacheList.splice(i,1)},CacheManager.forceDispose=function(){for(var i=0,len=CacheManager._cacheList.length,i=0;i<len;i++)CacheManager._cacheList[i].tryDispose(!0)},CacheManager.beginCheck=function(waitTime){Laya.timer.loop(waitTime=void 0===waitTime?15e3:waitTime,null,CacheManager._checkLoop)},CacheManager.stopCheck=function(){Laya.timer.clear(null,CacheManager._checkLoop)},CacheManager._checkLoop=function(){var cacheList=CacheManager._cacheList;if(!(cacheList.length<1))for(var tTime=Browser.now(),count=0,len=count=cacheList.length;0<count&&(cacheList[CacheManager._index=++CacheManager._index%len].tryDispose(!1),!(Browser.now()-tTime>CacheManager.loopTimeLimit));)count--},CacheManager.loopTimeLimit=2,CacheManager._cacheList=[],CacheManager._index=0,CacheManager}(),ClassUtils=function(){function ClassUtils(){}return __class(ClassUtils,"laya.utils.ClassUtils"),ClassUtils.regClass=function(className,classDef){ClassUtils._classMap[className]=classDef},ClassUtils.getRegClass=function(className){return ClassUtils._classMap[className]},ClassUtils.getInstance=function(className){var compClass=ClassUtils.getClass(className);return compClass?new compClass:(console.warn("[error] Undefined class:",className),null)},ClassUtils.createByJson=function(json,node,root,customHandler,instanceHandler){var props=(json="string"==typeof json?JSON.parse(json):json).props;if(!node&&!(node=instanceHandler?instanceHandler.runWith(json):ClassUtils.getInstance(props.runtime||json.type)))return null;var child=json.child;if(child)for(var i=0,n=child.length;i<n;i++){var tChild,data=child[i];"render"!==data.props.name&&"render"!==data.props.renderType||!node._$set_itemRender?"Graphic"==data.type?ClassUtils.addGraphicsToSprite(data,node):ClassUtils.isDrawType(data.type)?ClassUtils.addGraphicToSprite(data,node,!0):(tChild=ClassUtils.createByJson(data,null,root,customHandler,instanceHandler),"Script"==data.type?tChild.hasOwnProperty("owner")?tChild.owner=node:tChild.hasOwnProperty("target")&&(tChild.target=node):"mask"==data.props.renderType?node.mask=tChild:node.addChild(tChild)):node.itemRender=data}if(props)for(var prop in props){var value=props[prop];"var"===prop&&root?root[value]=node:value instanceof Array&&"function"==typeof node[prop]?node[prop].apply(node,value):node[prop]=value}return customHandler&&json.customProps&&customHandler.runWith([node,json]),node.created&&node.created(),node},ClassUtils.addGraphicsToSprite=function(graphicO,sprite){var graphics=graphicO.child;if(graphics&&!(graphics.length<1)){for(var g=ClassUtils._getGraphicsFromSprite(graphicO,sprite),sprite=0,oy=0,i=(graphicO.props&&(sprite=ClassUtils._getObjVar(graphicO.props,"x",0),oy=ClassUtils._getObjVar(graphicO.props,"y",0)),0!=sprite&&0!=oy&&g.translate(sprite,oy),0),len=graphics.length,i=0;i<len;i++)ClassUtils._addGraphicToGraphics(graphics[i],g);0!=sprite&&0!=oy&&g.translate(-sprite,-oy)}},ClassUtils.addGraphicToSprite=function(graphicO,sprite,isChild){isChild=(isChild=void 0===isChild?!1:isChild)?ClassUtils._getGraphicsFromSprite(graphicO,sprite):sprite.graphics;ClassUtils._addGraphicToGraphics(graphicO,isChild)},ClassUtils._getGraphicsFromSprite=function(dataO,sprite){var g,propsName,hitArea;if(!dataO||!dataO.props)return sprite.graphics;switch(propsName=dataO.props.renderType){case"hit":case"unHit":sprite.hitArea||(sprite.hitArea=new HitArea),(hitArea=sprite.hitArea)[propsName]||(hitArea[propsName]=new Graphics),g=hitArea[propsName]}return g=g||sprite.graphics},ClassUtils._getTransformData=function(propsO){(propsO.hasOwnProperty("pivotX")||propsO.hasOwnProperty("pivotY"))&&(m=m||new Matrix).translate(-ClassUtils._getObjVar(propsO,"pivotX",0),-ClassUtils._getObjVar(propsO,"pivotY",0));var m,sx=ClassUtils._getObjVar(propsO,"scaleX",1),sy=ClassUtils._getObjVar(propsO,"scaleY",1),rotate=ClassUtils._getObjVar(propsO,"rotation",0);ClassUtils._getObjVar(propsO,"skewX",0),ClassUtils._getObjVar(propsO,"skewY",0);return 1==sx&&1==sy&&0==rotate||((m=m||new Matrix).scale(sx,sy),m.rotate(.0174532922222222*rotate)),m},ClassUtils._addGraphicToGraphics=function(graphicO,graphic){var m,propsO=graphicO.props;propsO&&(graphicO=ClassUtils.DrawTypeDic[graphicO.type])&&(graphic=graphic,propsO=ClassUtils._getParams(propsO,graphicO[1],graphicO[2],graphicO[3]),!(m=ClassUtils._tM)&&1==ClassUtils._alpha||(graphic.save(),m&&graphic.transform(m),1==ClassUtils._alpha)||graphic.alpha(ClassUtils._alpha),graphic[graphicO[0]].apply(graphic,propsO),!m&&1==ClassUtils._alpha||graphic.restore())},ClassUtils._adptLineData=function(params){return params[2]=parseFloat(params[0])+parseFloat(params[2]),params[3]=parseFloat(params[1])+parseFloat(params[3]),params},ClassUtils._adptTextureData=function(params){return params[0]=Loader.getRes(params[0]),params},ClassUtils._adptLinesData=function(params){return params[2]=ClassUtils._getPointListByStr(params[2]),params},ClassUtils.isDrawType=function(type){return"Image"!=type&&ClassUtils.DrawTypeDic.hasOwnProperty(type)},ClassUtils._getParams=function(obj,params,xPos,adptFun){void 0===xPos&&(xPos=0),(rst=ClassUtils._temParam).length=params.length;for(var rst,m,i=0,len=params.length,i=0;i<len;i++)rst[i]=ClassUtils._getObjVar(obj,params[i][0],params[i][1]);return ClassUtils._alpha=ClassUtils._getObjVar(obj,"alpha",1),(m=ClassUtils._getTransformData(obj))?(m.translate(rst[xPos=xPos||0],rst[xPos+1]),rst[xPos]=rst[xPos+1]=0,ClassUtils._tM=m):ClassUtils._tM=null,rst=adptFun&&ClassUtils[adptFun]?ClassUtils[adptFun](rst):rst},ClassUtils._getPointListByStr=function(str){for(var pointArr=str.split(","),i=0,len=pointArr.length,i=0;i<len;i++)pointArr[i]=parseFloat(pointArr[i]);return pointArr},ClassUtils._getObjVar=function(obj,key,noValue){return obj.hasOwnProperty(key)?obj[key]:noValue},ClassUtils._temParam=[],ClassUtils._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},ClassUtils.getClass=function(className){className=ClassUtils._classMap[className]||className;return"string"==typeof className?Laya.__classmap[className]:className},ClassUtils._tM=null,ClassUtils._alpha=NaN,__static(ClassUtils,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),ClassUtils}(),Color=function(){function Color(str){if(this._color=[],"string"==typeof str){var len=(str="#"==(str=null===(this.strColor=str)?"#000000":str).charAt(0)?str.substr(1):str).length;if(3==len||4==len){for(var temp="",i=0;i<len;i++)temp+=str[i]+str[i];str=temp}var color=this.numColor=parseInt(str,16);if(8==str.length)return void(this._color=[parseInt(str.substr(0,2),16)/255,((16711680&color)>>16)/255,((65280&color)>>8)/255,(255&color)/255])}else color=this.numColor=str,this.strColor=Utils.toHexColor(color);this._color=[((16711680&color)>>16)/255,((65280&color)>>8)/255,(255&color)/255,1],this._color.__id=++Color._COLODID}return __class(Color,"laya.utils.Color"),Color._initDefault=function(){for(var i in Color._DEFAULT={},Color._COLOR_MAP)Color._SAVE[i]=Color._DEFAULT[i]=new Color(Color._COLOR_MAP[i]);return Color._DEFAULT},Color._initSaveMap=function(){for(var i in Color._SAVE_SIZE=0,Color._SAVE={},Color._DEFAULT)Color._SAVE[i]=Color._DEFAULT[i]},Color.create=function(str){var color=Color._SAVE[str+""];return null!=color?color:(Color._SAVE_SIZE<1e3||Color._initSaveMap(),Color._SAVE[str+""]=new Color(str))},Color._SAVE={},Color._SAVE_SIZE=0,Color._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},Color._DEFAULT=Color._initDefault(),Color._COLODID=1,Color}(),Dragging=(function(){function Dictionary(){this._values=[],this._keys=[]}__class(Dictionary,"laya.utils.Dictionary");var __proto=Dictionary.prototype;__proto.set=function(key,value){var index=this.indexOf(key);0<=index?this._values[index]=value:(this._keys.push(key),this._values.push(value))},__proto.indexOf=function(key){var index=this._keys.indexOf(key);return 0<=index?index:(key="string"==typeof key?Number(key):"number"==typeof key?key.toString():key,this._keys.indexOf(key))},__proto.get=function(key){key=this.indexOf(key);return key<0?null:this._values[key]},__proto.remove=function(key){key=this.indexOf(key);return 0<=key&&(this._keys.splice(key,1),this._values.splice(key,1),!0)},__proto.clear=function(){this._values.length=0,this._keys.length=0},__getset(0,__proto,"values",function(){return this._values}),__getset(0,__proto,"keys",function(){return this._keys})}(),function(){function Dragging(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}__class(Dragging,"laya.utils.Dragging");var __proto=Dragging.prototype;return __proto.start=function(target,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){void 0===ratio&&(ratio=.92),this.clearTimer(),this.target=target,this.area=area,this.hasInertia=hasInertia,this.elasticDistance=area?elasticDistance:0,this.elasticBackTime=elasticBackTime,this.data=data,this._disableMouseEvent=disableMouseEvent,this.ratio=ratio,1!=target.globalScaleX||1!=target.globalScaleY?this._parent=target.parent:this._parent=Laya.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,Laya.stage.on("mouseup",this,this.onStageMouseUp),Laya.stage.on("mouseout",this,this.onStageMouseUp),Laya.timer.frameLoop(1,this,this.loop)},__proto.clearTimer=function(){Laya.timer.clear(this,this.loop),Laya.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},__proto.stop=function(){this._dragging&&(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},__proto.loop=function(){var point=this._parent.getMousePoint(),mouseX=point.x,point=point.y,offsetX=mouseX-this._lastX,offsetY=point-this._lastY;if(this._clickOnly){if(!(1<Math.abs(offsetX*Laya.stage._canvasTransform.getScaleX())||1<Math.abs(offsetY*Laya.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),MouseManager.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(offsetX,offsetY);0==offsetX&&0==offsetY||(this._lastX=mouseX,this._lastY=point,this.target.x+=offsetX*this._elasticRateX,this.target.y+=offsetY*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},__proto.checkArea=function(){var offsetX;this.elasticDistance<=0?this.backToArea():(offsetX=this.target.x<this.area.x?this.area.x-this.target.x:this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0,this._elasticRateX=Math.max(0,1-offsetX/this.elasticDistance),offsetX=this.target.y<this.area.y?this.area.y-this.target.y:this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0,this._elasticRateY=Math.max(0,1-offsetX/this.elasticDistance))},__proto.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},__proto.onStageMouseUp=function(e){if(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),Laya.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var len=this._offsets.length,n=Math.min(len,6),m=this._offsets.length-n,i=len-1;m<i;i--)this._offsetY+=this._offsets[i--],this._offsetX+=this._offsets[i];this._offsetX=this._offsetX/n*2,this._offsetY=this._offsetY/n*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),Laya.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},__proto.checkElastic=function(){var obj,tx=NaN,ty=NaN;this.target.x<this.area.x?tx=this.area.x:this.target.x>this.area.x+this.area.width&&(tx=this.area.x+this.area.width),this.target.y<this.area.y?ty=this.area.y:this.target.y>this.area.y+this.area.height&&(ty=this.area.y+this.area.height),isNaN(tx)&&isNaN(ty)?this.clear():(obj={},isNaN(tx)||(obj.x=tx),isNaN(ty)||(obj.y=ty),this._tween=Tween.to(this.target,obj,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1))},__proto.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(Laya.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},__proto.clear=function(){var sp;this.target&&(this.clearTimer(),sp=this.target,this.target=null,this._parent=null,sp.event("dragend",this.data))},Dragging}()),Ease=function(){function Ease(){}return __class(Ease,"laya.utils.Ease"),Ease.linearNone=function(t,b,c,d){return c*t/d+b},Ease.linearIn=function(t,b,c,d){return c*t/d+b},Ease.linearInOut=function(t,b,c,d){return c*t/d+b},Ease.linearOut=function(t,b,c,d){return c*t/d+b},Ease.bounceIn=function(t,b,c,d){return c-Ease.bounceOut(d-t,0,c,d)+b},Ease.bounceInOut=function(t,b,c,d){return t<.5*d?.5*Ease.bounceIn(2*t,0,c,d)+b:.5*Ease.bounceOut(2*t-d,0,c,d)+.5*c+b},Ease.bounceOut=function(t,b,c,d){return(t/=d)<1/2.75?c*(7.5625*t*t)+b:t<2/2.75?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:t<2.5/2.75?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*t+.984375)+b},Ease.backIn=function(t,b,c,d,s){return c*(t/=d)*t*(((s=void 0===s?1.70158:s)+1)*t-s)+b},Ease.backInOut=function(t,b,c,d,s){return void 0===s&&(s=1.70158),(t/=.5*d)<1?.5*c*(t*t*((1+(s*=1.525))*t-s))+b:c/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+b},Ease.backOut=function(t,b,c,d,s){return c*((t=t/d-1)*t*(((s=void 0===s?1.70158:s)+1)*t+s)+1)+b},Ease.elasticIn=function(t,b,c,d,a,p){return 0==t?b:1==(t/=d)?b+c:(p=(p=void 0===p?0:p)||.3*d,c=!(a=void 0===a?0:a)||0<c&&a<c||c<0&&a<-c?(a=c,p/4):p/Ease.PI2*Math.asin(c/a),-(a*Math.pow(2,10*--t)*Math.sin((t*d-c)*Ease.PI2/p))+b)},Ease.elasticInOut=function(t,b,c,d,a,p){var s;return 0==t?b:2==(t/=.5*d)?b+c:(p=(p=void 0===p?0:p)||d*(.3*1.5),s=!(a=void 0===a?0:a)||0<c&&a<c||c<0&&a<-c?(a=c,p/4):p/Ease.PI2*Math.asin(c/a),t<1?a*Math.pow(2,10*--t)*Math.sin((t*d-s)*Ease.PI2/p)*-.5+b:a*Math.pow(2,-10*--t)*Math.sin((t*d-s)*Ease.PI2/p)*.5+c+b)},Ease.elasticOut=function(t,b,c,d,a,p){var s;return 0==t?b:1==(t/=d)?b+c:(p=(p=void 0===p?0:p)||.3*d,s=!(a=void 0===a?0:a)||0<c&&a<c||c<0&&a<-c?(a=c,p/4):p/Ease.PI2*Math.asin(c/a),a*Math.pow(2,-10*t)*Math.sin((t*d-s)*Ease.PI2/p)+c+b)},Ease.strongIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},Ease.strongInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t*t*t+b:.5*c*((t-=2)*t*t*t*t+2)+b},Ease.strongOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},Ease.sineInOut=function(t,b,c,d){return.5*-c*(Math.cos(Math.PI*t/d)-1)+b},Ease.sineIn=function(t,b,c,d){return-c*Math.cos(t/d*Ease.HALF_PI)+c+b},Ease.sineOut=function(t,b,c,d){return c*Math.sin(t/d*Ease.HALF_PI)+b},Ease.quintIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},Ease.quintInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t*t*t+b:.5*c*((t-=2)*t*t*t*t+2)+b},Ease.quintOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},Ease.quartIn=function(t,b,c,d){return c*(t/=d)*t*t*t+b},Ease.quartInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t*t+b:.5*-c*((t-=2)*t*t*t-2)+b},Ease.quartOut=function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b},Ease.cubicIn=function(t,b,c,d){return c*(t/=d)*t*t+b},Ease.cubicInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t*t+b:.5*c*((t-=2)*t*t+2)+b},Ease.cubicOut=function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},Ease.quadIn=function(t,b,c,d){return c*(t/=d)*t+b},Ease.quadInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*c*t*t+b:.5*-c*(--t*(t-2)-1)+b},Ease.quadOut=function(t,b,c,d){return-c*(t/=d)*(t-2)+b},Ease.expoIn=function(t,b,c,d){return 0==t?b:c*Math.pow(2,10*(t/d-1))+b-.001*c},Ease.expoInOut=function(t,b,c,d){return 0==t?b:t==d?b+c:(t/=.5*d)<1?.5*c*Math.pow(2,10*(t-1))+b:.5*c*(2-Math.pow(2,-10*--t))+b},Ease.expoOut=function(t,b,c,d){return t==d?b+c:c*(1-Math.pow(2,-10*t/d))+b},Ease.circIn=function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b},Ease.circInOut=function(t,b,c,d){return(t/=.5*d)<1?.5*-c*(Math.sqrt(1-t*t)-1)+b:.5*c*(Math.sqrt(1-(t-=2)*t)+1)+b},Ease.circOut=function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},Ease.HALF_PI=.5*Math.PI,Ease.PI2=2*Math.PI,Ease}(),HitArea=function(){function HitArea(){this._hit=null,this._unHit=null}__class(HitArea,"laya.utils.HitArea");var __proto=HitArea.prototype;return __proto.isHit=function(x,y){return!!HitArea.isHitGraphic(x,y,this.hit)&&!HitArea.isHitGraphic(x,y,this.unHit)},__proto.contains=function(x,y){return this.isHit(x,y)},__getset(0,__proto,"hit",function(){return this._hit||(this._hit=new Graphics),this._hit},function(value){this._hit=value}),__getset(0,__proto,"unHit",function(){return this._unHit||(this._unHit=new Graphics),this._unHit},function(value){this._unHit=value}),HitArea.isHitGraphic=function(x,y,graphic){if(graphic){var cmds=graphic.cmds;if(!cmds&&graphic._one&&((cmds=HitArea._cmds).length=1,cmds[0]=graphic._one),cmds)for(var cmd,i=0,len=cmds.length,i=0;i<len;i++)if(cmd=cmds[i]){var context=Render._context;switch(cmd.callee){case context._translate:case 6:x-=cmd[0],y-=cmd[1]}if(HitArea.isHitCmd(x,y,cmd))return!0}}return!1},HitArea.isHitCmd=function(x,y,cmd){if(!cmd)return!1;var context=Render._context,rst=!1;switch(cmd.callee){case context._drawRect:case 13:HitArea._rec.setTo(cmd[0],cmd[1],cmd[2],cmd[3]),rst=HitArea._rec.contains(x,y);break;case context._drawCircle:case context._fillCircle:case 14:rst=(x-=cmd[0])*x+(y-=cmd[1])*y<cmd[2]*cmd[2];break;case context._drawPoly:case 18:x-=cmd[0],y-=cmd[1],rst=HitArea.ptInPolygon(x,y,cmd[2])}return rst},HitArea.ptInPolygon=function(x,y,areaPoints){var p=HitArea._ptPoint;p.setTo(x,y);for(var nCross=0,len=areaPoints.length,i=0;i<len;i+=2){var p2y,p1x=areaPoints[i],p1y=areaPoints[i+1],p2x=areaPoints[(i+2)%len];p1y==(p2y=areaPoints[(i+3)%len])||p.y<Math.min(p1y,p2y)||p.y>=Math.max(p1y,p2y)||(p.y-p1y)*(p2x-p1x)/(p2y-p1y)+p1x>p.x&&nCross++}return nCross%2==1},HitArea._cmds=[],__static(HitArea,["_rec",function(){return this._rec=new Rectangle},"_ptPoint",function(){return this._ptPoint=new Point}]),HitArea}(),Pool=(function(){function HTMLChar(char,w,h,style){this.char=char,this.charNum=char.charCodeAt(0),this._x=this._y=0,this.width=w,this.height=h,this.style=style,this.isWord=!HTMLChar._isWordRegExp.test(char)}__class(HTMLChar,"laya.utils.HTMLChar");var __proto=HTMLChar.prototype;Laya.imps(__proto,{"laya.display.ILayout":!0}),__proto.setSprite=function(sprite){this._sprite=sprite},__proto.getSprite=function(){return this._sprite},__proto._isChar=function(){return!0},__proto._getCSSStyle=function(){return this.style},__getset(0,__proto,"width",function(){return this._w},function(value){this._w=value}),__getset(0,__proto,"x",function(){return this._x},function(value){this._sprite&&(this._sprite.x=value),this._x=value}),__getset(0,__proto,"y",function(){return this._y},function(value){this._sprite&&(this._sprite.y=value),this._y=value}),__getset(0,__proto,"height",function(){return this._h},function(value){this._h=value}),HTMLChar._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function Log(){}__class(Log,"laya.utils.Log"),Log.enable=function(){Log._logdiv||(Log._logdiv=Browser.window.document.createElement("div"),Browser.window.document.body.appendChild(Log._logdiv),Log._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},Log.toggle=function(){var style=Log._logdiv.style;"1px"==style.width?style.width=style.height="50%":style.width=style.height="1px"},Log.print=function(value){Log._logdiv&&(Log.maxCount<=Log._count&&Log.clear(),Log._count++,Log._logdiv.innerText+=value+"\n",Log._logdiv.scrollTop=Log._logdiv.scrollHeight)},Log.clear=function(){Log._logdiv.innerText="",Log._count=0},Log._logdiv=null,Log._count=0,Log.maxCount=20}(),function(){function Mouse(){}__class(Mouse,"laya.utils.Mouse"),__getset(1,Mouse,"cursor",function(){return Mouse._style.cursor},function(cursorStr){Mouse._style.cursor=cursorStr}),Mouse.hide=function(){"none"!=Mouse.cursor&&(Mouse._preCursor=Mouse.cursor,Mouse.cursor="none")},Mouse.show=function(){"none"==Mouse.cursor&&(Mouse.cursor=Mouse._preCursor||"auto")},Mouse._preCursor=null,__static(Mouse,["_style",function(){return this._style=Browser.document.body.style}])}(),function(){function Pool(){}return __class(Pool,"laya.utils.Pool"),Pool.getPoolBySign=function(sign){return Pool._poolDic[sign]||(Pool._poolDic[sign]=[])},Pool.clearBySign=function(sign){Pool._poolDic[sign]&&(Pool._poolDic[sign].length=0)},Pool.recover=function(sign,item){item.__InPool||(item.__InPool=!0,Pool.getPoolBySign(sign).push(item))},Pool.getItemByClass=function(sign,cls){sign=Pool.getPoolBySign(sign),sign=sign.length?sign.pop():new cls;return sign.__InPool=!1,sign},Pool.getItemByCreateFun=function(sign,createFun,caller){sign=Pool.getPoolBySign(sign),sign=sign.length?sign.pop():createFun.call(caller);return sign.__InPool=!1,sign},Pool.getItem=function(sign){sign=Pool.getPoolBySign(sign),sign=sign.length?sign.pop():null;return sign&&(sign.__InPool=!1),sign},Pool._poolDic={},Pool.InPoolSign="__InPool",Pool}()),Stat=function(){function Stat(){}return __class(Stat,"laya.utils.Stat"),__getset(1,Stat,"onclick",null,function(fn){Stat._sp&&Stat._sp.on("click",Stat._sp,fn),Stat._canvas&&(Stat._canvas.source.onclick=fn,Stat._canvas.source.style.pointerEvents="")}),Stat.show=function(x,y,mode){var index;void 0===x&&(x=0),void 0===y&&(y=0),void 0===mode&&(mode=0),Render.isConchApp&&!Render.isConchWebGL?Browser.window.conch.showFPS&&Browser.window.conch.showFPS(x,y):(Render.isConchWebGL||Browser.onMiniGame||Browser.onLimixiu||(Stat._useCanvas=!0),Stat._show=!0,Stat._fpsData.length=60,Stat._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},Stat._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},Stat._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},Stat._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},Render.isWebGL?(Stat._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},Render.is3DMode?(Stat._view[0].title="FPS(3D)",Stat._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},Stat._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},Stat._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==mode?(index=8,Stat._view[index++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},Stat._view[index++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},Stat._view[index++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}):2==mode&&(index=8,Stat._view[index++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},Stat._view[index++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},Stat._view[index++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},Stat._view[index++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},Stat._view[index++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},Stat._view[index++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},Stat._view[index++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2})):(Stat._view[0].title="FPS(WebGL)",Stat._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):Stat._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},Stat._useCanvas?Stat.createUIPre(x,y):Stat.createUI(x,y),Stat.enable())},Stat.createUIPre=function(x,y){var pixel=Browser.pixelRatio;Stat._width=130*pixel,Stat._vx=75*pixel,Stat._height=pixel*(12*Stat._view.length+3*pixel)+4,Stat._fontSize=12*pixel;for(var i=0;i<Stat._view.length;i++)Stat._view[i].x=4,Stat._view[i].y=i*Stat._fontSize+2*pixel;Stat._canvas||((Stat._canvas=new HTMLCanvas("2D")).size(Stat._width,Stat._height),(Stat._ctx=Stat._canvas.getContext("2d")).textBaseline="top",Stat._ctx.font=Stat._fontSize+"px Sans-serif",Stat._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+x+"px;top:"+y+"px;width:"+Stat._width/pixel+"px;height:"+Stat._height/pixel+"px;"),Stat._first=!0,Stat.loop(),Stat._first=!1,Browser.container.appendChild(Stat._canvas.source)},Stat.createUI=function(x,y){for(var stat=Stat._sp,pixel=Browser.pixelRatio,text=(stat||(stat=new Sprite,(Stat._leftText=new Text).pos(5,5),Stat._leftText.color="#ffffff",stat.addChild(Stat._leftText),(Stat._txt=new Text).pos(80*pixel,5),Stat._txt.color="#ffffff",stat.addChild(Stat._txt),Stat._sp=stat),stat.pos(x,y),""),i=0;i<Stat._view.length;i++)text+=Stat._view[i].title+"\n";Stat._leftText.text=text;x=138*pixel,y=pixel*(12*Stat._view.length+3*pixel)+4;Stat._txt.fontSize=Stat._fontSize*pixel,Stat._leftText.fontSize=Stat._fontSize*pixel,stat.size(x,y),stat.graphics.clear(),stat.graphics.setAlpha(.5),stat.graphics.drawRect(0,0,x,y,"#999999"),stat.graphics.setAlpha(1),Stat.loop()},Stat.enable=function(){Laya.timer.frameLoop(1,Stat,Stat.loop)},Stat.hide=function(){Stat._show=!1,Laya.timer.clear(Stat,Stat.loop),Stat._canvas&&Browser.removeElement(Stat._canvas.source)},Stat.clear=function(){Stat.trianglesFaces=Stat.drawCall=Stat.shaderCall=Stat.spriteCount=Stat.spriteRenderUseCacheCount=Stat.treeNodeCollision=Stat.treeSpriteCollision=Stat.canvasNormal=Stat.canvasBitmap=Stat.canvasReCache=0},Stat.loop=function(){Stat._count++;var count,timer=Browser.now();timer-Stat._timer<1e3||(count=Stat._count,Stat.FPS=Math.round(1e3*count/(timer-Stat._timer)),Stat._show&&(Stat.trianglesFaces=Math.round(Stat.trianglesFaces/count),Stat._useCanvas?(Stat.drawCall=Math.round(Stat.drawCall/count)-2,Stat.shaderCall=Math.round(Stat.shaderCall/count),Stat.spriteCount=Math.round(Stat.spriteCount/count)-1):(Stat.drawCall=Math.round(Stat.drawCall/count)-2,Stat.shaderCall=Math.round(Stat.shaderCall/count)-4,Stat.spriteCount=Math.round(Stat.spriteCount/count)-4),Stat.spriteRenderUseCacheCount=Math.round(Stat.spriteRenderUseCacheCount/count),Stat.canvasNormal=Math.round(Stat.canvasNormal/count),Stat.canvasBitmap=Math.round(Stat.canvasBitmap/count),Stat.canvasReCache=Math.ceil(Stat.canvasReCache/count),Stat.treeNodeCollision=Math.round(Stat.treeNodeCollision/count),Stat.treeSpriteCollision=Math.round(Stat.treeSpriteCollision/count),count=0<Stat.FPS?Math.floor(1e3/Stat.FPS).toString():" ",Stat._fpsStr=Stat.FPS+(Stat.renderSlow?" slow":"")+" "+count,Stat._spriteStr=Stat.spriteCount+(Stat.spriteRenderUseCacheCount?"/"+Stat.spriteRenderUseCacheCount:""),Stat._canvasStr=Stat.canvasReCache+"/"+Stat.canvasNormal+"/"+Stat.canvasBitmap,Stat.currentMemorySize=ResourceManager.systemResourceManager.memorySize,Stat._useCanvas?Stat.renderInfoPre():Stat.renderInfo(),Stat.clear()),Stat._count=0,Stat._timer=timer)},Stat.renderInfoPre=function(){if(Stat._canvas)for(var ctx=Stat._ctx,gl=(ctx.clearRect(Stat._first?0:Stat._vx,0,Stat._width,Stat._height),Render.WebGL.mainContext),i=0;i<Stat._view.length;i++){var one=Stat._view[i];Stat._first&&(ctx.fillStyle="white",ctx.fillText(one.title,one.x,one.y,null,null,null)),ctx.fillStyle=one.color;var value=-1;if((one=Stat._view[i]).varying){if(gl)switch(one.varying){case 1:value=gl.getParameter(gl[one.value]);break;case 2:value=gl.getExtension(one.value)}}else value=Stat[one.value];"M"==one.units&&(value=Math.floor(value/1048576*100)/100+" M"),"K"==one.units&&(value=Math.floor(value/1024*100)/100+" K"),"string"==one.units&&(value=value.match(/\d+\.?\d/i)),ctx.fillText(value+"",one.x+Stat._vx,one.y,null,null,null)}},Stat.renderInfo=function(){for(var text="",gl=Render.WebGL.mainContext,i=0;i<Stat._view.length;i++){var one=Stat._view[i],value=-1;if(one.varying){if(gl)switch(one.varying){case 1:value=gl.getParameter(gl[one.value]);break;case 2:value=gl.getExtension(one.value)}}else value=Stat[one.value];"M"==one.units&&(value=Math.floor(value/1048576*100)/100+" M"),"K"==one.units&&(value=Math.floor(value/1024*100)/100+" K"),text+=(value="string"==one.units?value.match(/\d+\.?\d/i):value)+"\n"}Stat._txt.text=text},Stat.FPS=0,Stat.loopCount=0,Stat.shaderCall=0,Stat.drawCall=0,Stat.trianglesFaces=0,Stat.spriteCount=0,Stat.spriteRenderUseCacheCount=0,Stat.treeNodeCollision=0,Stat.treeSpriteCollision=0,Stat.canvasNormal=0,Stat.canvasBitmap=0,Stat.canvasReCache=0,Stat.renderSlow=!1,Stat.currentMemorySize=0,Stat._fpsStr=null,Stat._canvasStr=null,Stat._spriteStr=null,Stat._fpsData=[],Stat._timer=0,Stat._count=0,Stat._view=[],Stat._fontSize=12,Stat._txt=null,Stat._leftText=null,Stat._sp=null,Stat._show=!1,Stat._useCanvas=!1,Stat._canvas=null,Stat._ctx=null,Stat._first=!1,Stat._vx=NaN,Stat._width=0,Stat._height=100,Stat}(),Timer=(function(){function StringKey(){this._strsToID={},this._idToStrs=[],this._length=0}__class(StringKey,"laya.utils.StringKey");var __proto=StringKey.prototype;__proto.add=function(str){var index=this._strsToID[str];return null!=index?index:(this._idToStrs[this._length]=str,this._strsToID[str]=this._length++)},__proto.getID=function(str){str=this._strsToID[str];return null==str?-1:str},__proto.getName=function(id){id=this._idToStrs[id];return null==id?void 0:id}}(),function(){var TimerHandler;function Timer(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}__class(Timer,"laya.utils.Timer");var __proto=Timer.prototype;return __proto._init=function(){Laya.timer&&Laya.timer.frameLoop(1,this,this._update)},__proto._now=function(){return Date.now()},__proto._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{for(var frame=this.currFrame=this.currFrame+this.scale,now=this._now(),timer=(this._delta=(now-this._lastTimer)*this.scale,this.currTimer=this.currTimer+this._delta),handlers=(this._lastTimer=now,this._handlers),i=this._count=0,n=handlers.length;i<n;i++)if(null!==(handler=handlers[i]).method){var t=handler.userFrame?frame:timer;if(t>=handler.exeTime)if(handler.repeat)if(handler.jumpFrame)for(;t>=handler.exeTime;)handler.exeTime+=handler.delay,handler.run(!1);else handler.exeTime+=handler.delay,handler.run(!1),t>handler.exeTime&&(handler.exeTime+=Math.ceil((t-handler.exeTime)/handler.delay)*handler.delay);else handler.run(!0)}else this._count++;(30<this._count||frame%200==0)&&this._clearHandlers();for(var laters=this._laters,i=0,n=laters.length-1;i<=n;i++){var handler=laters[i];null!==handler.method&&(delete this._map[handler.key],handler.run(!1)),this._recoverHandler(handler),i===n&&(n=laters.length-1)}laters.length=0}},__proto._clearHandlers=function(){for(var handlers=this._handlers,i=0,n=handlers.length;i<n;i++){var handler=handlers[i];null!==handler.method?this._temp.push(handler):this._recoverHandler(handler)}this._handlers=this._temp,this._temp=handlers,this._temp.length=0},__proto._recoverHandler=function(handler){this._map[handler.key]==handler&&delete this._map[handler.key],handler.recover()},__proto._create=function(useFrame,repeat,delay,caller,method,args,coverBefore){if(!delay)return method.apply(caller,args),null;if(coverBefore){var handler=this._getHandler(caller,method);if(handler)return handler.repeat=repeat,handler.userFrame=useFrame,handler.delay=delay,handler.caller=caller,handler.method=method,handler.args=args,handler.exeTime=delay+(useFrame?this.currFrame:this.currTimer+this._now()-this._lastTimer),handler}return(handler=TimerHandler.create()).repeat=repeat,handler.userFrame=useFrame,handler.delay=delay,handler.caller=caller,handler.method=method,handler.args=args,handler.exeTime=delay+(useFrame?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(handler),this._handlers.push(handler),handler},__proto._indexHandler=function(handler){var caller=handler.caller,method=handler.method,caller=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0,method=method.$_TID||(method.$_TID=1e5*this._mid++);handler.key=caller+method,this._map[handler.key]=handler},__proto.once=function(delay,caller,method,args,coverBefore){this._create(!1,!1,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore)},__proto.loop=function(delay,caller,method,args,coverBefore,jumpFrame){void 0===jumpFrame&&(jumpFrame=!1);delay=this._create(!1,!0,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore);delay&&(delay.jumpFrame=jumpFrame)},__proto.frameOnce=function(delay,caller,method,args,coverBefore){this._create(!0,!1,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore)},__proto.frameLoop=function(delay,caller,method,args,coverBefore){this._create(!0,!0,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore)},__proto.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+TimerHandler._freeCount},__proto.clear=function(caller,method){caller=this._getHandler(caller,method);caller&&(delete this._map[caller.key],caller.key=0,caller.clear())},__proto.clearAll=function(caller){if(caller)for(var i=0,n=this._handlers.length;i<n;i++){var handler=this._handlers[i];handler.caller===caller&&(delete this._map[handler.key],handler.key=0,handler.clear())}},__proto._getHandler=function(caller,method){caller=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0,method=method.$_TID||(method.$_TID=1e5*this._mid++);return this._map[caller+method]},__proto.callLater=function(caller,method,args){var handler;null==this._getHandler(caller,method)&&((handler=TimerHandler.create()).caller=caller,handler.method=method,handler.args=args,this._indexHandler(handler),this._laters.push(handler))},__proto.runCallLater=function(caller,method){caller=this._getHandler(caller,method);caller&&null!=caller.method&&(delete this._map[caller.key],caller.run(!0))},__proto.runTimer=function(caller,method){this.runCallLater(caller,method)},__getset(0,__proto,"delta",function(){return this._delta}),Timer.__init$=function(){TimerHandler=function(){function TimerHandler(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}__class(TimerHandler,"");var __proto=TimerHandler.prototype;return __proto.clear=function(){this.caller=null,this.method=null,this.args=null},__proto.recover=function(){this.clear(),this.args=TimerHandler._freeHandler,TimerHandler._freeHandler=this,TimerHandler._freeCount++},__proto.run=function(withClear){var caller=this.caller;if(caller&&caller.destroyed)return this.clear();var method=this.method,args=this.args;withClear&&this.clear(),null!=method&&(args?method.apply(caller,args):method.call(caller))},TimerHandler._freeHandler=null,TimerHandler._freeCount=0,TimerHandler.create=function(){var result=TimerHandler._freeHandler;return result?(TimerHandler._freeHandler=result.args,--TimerHandler._freeCount,result.args=null,result):new TimerHandler},TimerHandler}()},Timer}()),Tween=function(){function Tween(){this.gid=0}__class(Tween,"laya.utils.Tween");var __proto=Tween.prototype;return __proto.to=function(target,props,duration,ease,complete,delay,coverBefore){return this._create(target,props,duration,ease,complete,delay=void 0===delay?0:delay,coverBefore=void 0===coverBefore?!1:coverBefore,!0,!1,!0)},__proto.from=function(target,props,duration,ease,complete,delay,coverBefore){return this._create(target,props,duration,ease,complete,delay=void 0===delay?0:delay,coverBefore=void 0===coverBefore?!1:coverBefore,!1,!1,!0)},__proto._create=function(target,props,duration,ease,complete,delay,coverBefore,isTo,usePool,runNow){if(!target)throw new Error("Tween:target is null");this._target=target,this._duration=duration,this._ease=ease||props.ease||Tween.easeNone,this._complete=complete||props.complete,this._delay=delay,this._props=[],this._usedTimer=0,this._startTimer=Browser.now(),this._usedPool=usePool,this._delayParam=null,this.update=props.update;duration=target.$_GID||(target.$_GID=Utils.getGID());return Tween.tweenMap[duration]?(coverBefore&&Tween.clearTween(target),Tween.tweenMap[duration].push(this)):Tween.tweenMap[duration]=[this],runNow?delay<=0?this.firstStart(target,props,isTo):(this._delayParam=[target,props,isTo],Laya.scaleTimer.once(delay,this,this.firstStart,this._delayParam)):this._initProps(target,props,isTo),this},__proto.firstStart=function(target,props,isTo){this._delayParam=null,target.destroyed?this.clear():(this._initProps(target,props,isTo),this._beginLoop())},__proto._initProps=function(target,props,isTo){for(var p in props){var start,end;"number"==typeof target[p]&&(start=(isTo?target:props)[p],end=(isTo?props:target)[p],this._props.push([p,start,end-start]),isTo||(target[p]=start))}},__proto._beginLoop=function(){Laya.scaleTimer.frameLoop(1,this,this._doEase)},__proto._doEase=function(){this._updateEase(Browser.now())},__proto._updateEase=function(time){var target=this._target;if(target){if(target.destroyed)return Tween.clearTween(target);time=this._usedTimer=time-this._startTimer-this._delay;if(!(time<0)){if(time>=this._duration)return this.complete();for(var ratio=0<time?this._ease(time,0,1,this._duration):0,props=this._props,i=0,n=props.length;i<n;i++){var prop=props[i];target[prop[0]]=prop[1]+ratio*prop[2]}this.update&&this.update.run()}}},__proto.complete=function(){if(this._target){Laya.scaleTimer.runTimer(this,this.firstStart);for(var target=this._target,props=this._props,handler=this._complete,i=0,n=props.length;i<n;i++){var prop=props[i];target[prop[0]]=prop[1]+prop[2]}this.update&&this.update.run(),this.clear(),handler&&handler.run()}},__proto.pause=function(){Laya.scaleTimer.clear(this,this._beginLoop),Laya.scaleTimer.clear(this,this._doEase),Laya.scaleTimer.clear(this,this.firstStart);var dTime;(dTime=Browser.now()-this._startTimer-this._delay)<0&&(this._usedTimer=dTime)},__proto.setStartTime=function(startTime){this._startTimer=startTime},__proto.clear=function(){this._target&&(this._remove(),this._clear())},__proto._clear=function(){this.pause(),Laya.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,Pool.recover("tween",this))},__proto.recover=function(){this._usedPool=!0,this._clear()},__proto._remove=function(){var tweens=Tween.tweenMap[this._target.$_GID];if(tweens)for(var i=0,n=tweens.length;i<n;i++)if(tweens[i]===this){tweens.splice(i,1);break}},__proto.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=Browser.now(),this._delayParam)Laya.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var props=this._props,i=0,n=props.length;i<n;i++){var prop=props[i];this._target[prop[0]]=prop[1]}Laya.scaleTimer.once(this._delay,this,this._beginLoop)}},__proto.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Browser.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?Laya.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},__getset(0,__proto,"progress",null,function(v){v*=this._duration;this._startTimer=Browser.now()-this._delay-v}),Tween.to=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){return void 0===delay&&(delay=0),void 0===coverBefore&&(coverBefore=!1),void 0===autoRecover&&(autoRecover=!0),Pool.getItemByClass("tween",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,!0,autoRecover,!0)},Tween.from=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){return void 0===delay&&(delay=0),void 0===coverBefore&&(coverBefore=!1),void 0===autoRecover&&(autoRecover=!0),Pool.getItemByClass("tween",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,!1,autoRecover,!0)},Tween.clearAll=function(target){if(target&&target.$_GID){var tweens=Tween.tweenMap[target.$_GID];if(tweens){for(var i=0,n=tweens.length;i<n;i++)tweens[i]._clear();tweens.length=0}}},Tween.clear=function(tween){tween.clear()},Tween.clearTween=function(target){Tween.clearAll(target)},Tween.easeNone=function(t,b,c,d){return c*t/d+b},Tween.tweenMap={},Tween}(),Utils=function(){function Utils(){}return __class(Utils,"laya.utils.Utils"),Utils.toRadian=function(angle){return angle*Utils._pi2},Utils.toAngle=function(radian){return radian*Utils._pi},Utils.toHexColor=function(color){if(color<0||isNaN(color))return null;for(var str=color.toString(16);str.length<6;)str="0"+str;return"#"+str},Utils.getGID=function(){return Utils._gid++},Utils.concatArray=function(source,array){if(array){if(!source)return array;for(var i=0,len=array.length,i=0;i<len;i++)source.push(array[i])}return source},Utils.clearArray=function(array){return array&&(array.length=0),array},Utils.copyArray=function(source,array){if(source=source||[],array){source.length=array.length;for(var i=0,len=array.length,i=0;i<len;i++)source[i]=array[i]}return source},Utils.getGlobalRecByPoints=function(sprite,x0,y0,x1,y1){x0=new Point(x0,y0);return x0=sprite.localToGlobal(x0),y0=new Point(x1,y1),y0=sprite.localToGlobal(y0),Rectangle._getWrapRec([x0.x,x0.y,y0.x,y0.y])},Utils.getGlobalPosAndScale=function(sprite){return Utils.getGlobalRecByPoints(sprite,0,0,1,1)},Utils.bind=function(fun,scope){return fun.bind(scope)},Utils.measureText=function(txt,font){return RunDriver.measureText(txt,font)},Utils.updateOrder=function(array){if(!array||array.length<2)return!1;for(var key,c,i=1,j=0,len=array.length;i<len;){for(c=array[j=i],key=array[j]._zOrder;-1<--j&&array[j]._zOrder>key;)array[j+1]=array[j];array[j+1]=c,i++}var model=c.parent.conchModel;if(model)if(null!=model.updateZOrder)model.updateZOrder();else{for(i=0;i<len;i++)model.removeChild(array[i].conchModel);for(i=0;i<len;i++)model.addChildAt(array[i].conchModel,i)}return!0},Utils.transPointList=function(points,x,y){for(var i=0,len=points.length,i=0;i<len;i+=2)points[i]+=x,points[i+1]+=y},Utils.parseInt=function(str,radix){str=Browser.window.parseInt(str,radix=void 0===radix?0:radix);return isNaN(str)?0:str},Utils.getFileExtension=function(path){Utils._extReg.lastIndex=path.lastIndexOf(".");path=Utils._extReg.exec(path);return path&&1<path.length?path[1].toLowerCase():null},Utils.getTransformRelativeToWindow=function(coordinateSpace,x,y){var stage=Laya.stage,coordinateSpace=laya.utils.Utils.getGlobalPosAndScale(coordinateSpace),stage=stage._canvasTransform.clone(),canvasLeft=stage.tx,canvasTop=stage.ty,perpendicular=(stage.rotate(-Math.PI/180*Laya.stage.canvasDegree),stage.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY),Laya.stage.canvasDegree%180!=0),tx=NaN,ty=NaN,x=(perpendicular?(tx=y+coordinateSpace.y,ty=x+coordinateSpace.x,tx*=stage.d,ty*=stage.a,90==Laya.stage.canvasDegree?(tx=canvasLeft-tx,ty+=canvasTop):(tx+=canvasLeft,ty=canvasTop-ty)):(tx=x+coordinateSpace.x,ty=y+coordinateSpace.y,tx=tx*stage.a+canvasLeft,ty=ty*stage.d+canvasTop),NaN),y=NaN,y=perpendicular?(x=stage.d*coordinateSpace.height,stage.a*coordinateSpace.width):(x=stage.a*coordinateSpace.width,stage.d*coordinateSpace.height);return{x:tx,y:ty,scaleX:x,scaleY:y}},Utils.fitDOMElementInArea=function(dom,coordinateSpace,x,y,width,height){dom._fitLayaAirInitialized||(dom._fitLayaAirInitialized=!0,dom.style.transformOrigin=dom.style.webKittransformOrigin="left top",dom.style.position="absolute");coordinateSpace=Utils.getTransformRelativeToWindow(coordinateSpace,x,y);dom.style.transform=dom.style.webkitTransform="scale("+coordinateSpace.scaleX+","+coordinateSpace.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",dom.style.width=width+"px",dom.style.height=height+"px",dom.style.left=coordinateSpace.x+"px",dom.style.top=coordinateSpace.y+"px"},Utils.isOkTextureList=function(textureList){if(!textureList)return!1;for(var tTexture,i=0,len=textureList.length,i=0;i<len;i++)if(!(tTexture=textureList[i])||!tTexture.source)return!1;return!0},Utils.isOKCmdList=function(cmds){if(!cmds)return!1;for(var cmd,tex,i=0,len=cmds.length,context=Render._context,i=0;i<len;i++)switch((cmd=cmds[i]).callee){case context._drawTexture:case context._fillTexture:case context._drawTextureWithTransform:if(!(tex=cmd[0])||!tex.source)return!1}return!0},Utils._gid=1,Utils._pi=180/Math.PI,Utils._pi2=Math.PI/180,Utils._extReg=/\.(\w+)\??/g,Utils.parseXMLFromString=function(value){if(value=value.replace(/>\s+</g,"><"),-1<(value=(new DOMParser).parseFromString(value,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(value.firstChild.firstChild.textContent);return value},Utils}(),VectorGraphManager=function(){function VectorGraphManager(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Render.isWebGL&&CacheManager.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this))}__class(VectorGraphManager,"laya.utils.VectorGraphManager");var __proto=VectorGraphManager.prototype;return __proto.getId=function(){return this._id++},__proto.addShape=function(id,shape){this.shapeDic[id]=shape,this.useDic[id]||(this.useDic[id]=!0)},__proto.addLine=function(id,Line){this.shapeLineDic[id]=Line,this.shapeLineDic[id]||(this.shapeLineDic[id]=!0)},__proto.getShape=function(id){this._checkKey&&null!=this.useDic[id]&&(this.useDic[id]=!0)},__proto.deleteShape=function(id){this.shapeDic[id]&&(this.shapeDic[id]=null,delete this.shapeDic[id]),this.shapeLineDic[id]&&(this.shapeLineDic[id]=null,delete this.shapeLineDic[id]),null!=this.useDic[id]&&delete this.useDic[id]},__proto.getCacheList=function(){var str,list=[];for(str in this.shapeDic)list.push(this.shapeDic[str]);for(str in this.shapeLineDic)list.push(this.shapeLineDic[str]);return list},__proto.startDispose=function(key){for(var str in this.useDic)this.useDic[str]=!1;this._checkKey=!0},__proto.endDispose=function(){if(this._checkKey){for(var str in this.useDic)this.useDic[str]||this.deleteShape(str);this._checkKey=!1}},VectorGraphManager.getInstance=function(){return VectorGraphManager.instance=VectorGraphManager.instance||new VectorGraphManager},VectorGraphManager.instance=null,VectorGraphManager}(),WeakObject=function(){function WeakObject(){this._obj=null,this._obj=WeakObject.supportWeakMap?new Browser.window.WeakMap:{},WeakObject.supportWeakMap||WeakObject._maps.push(this)}__class(WeakObject,"laya.utils.WeakObject");var __proto=WeakObject.prototype;return __proto.set=function(key,value){var objKey;null!=key&&(WeakObject.supportWeakMap?("string"!=typeof(objKey=key)&&"number"!=typeof key||(objKey=(objKey=WeakObject._keys[key])||(WeakObject._keys[key]={k:key})),this._obj.set(objKey,value)):"string"==typeof key||"number"==typeof key?this._obj[key]=value:(key.$_GID||(key.$_GID=Utils.getGID()),this._obj[key.$_GID]=value))},__proto.get=function(key){var objKey;return null==key?null:WeakObject.supportWeakMap?(objKey="string"==typeof key||"number"==typeof key?WeakObject._keys[key]:key)?this._obj.get(objKey):null:"string"==typeof key||"number"==typeof key?this._obj[key]:this._obj[key.$_GID]},__proto.del=function(key){var objKey;null!=key&&(WeakObject.supportWeakMap?(objKey="string"==typeof key||"number"==typeof key?WeakObject._keys[key]:key)&&this._obj.delete(objKey):"string"==typeof key||"number"==typeof key?delete this._obj[key]:delete this._obj[this._obj.$_GID])},__proto.has=function(key){var objKey;return null!=key&&(WeakObject.supportWeakMap?(objKey="string"==typeof key||"number"==typeof key?WeakObject._keys[key]:key,this._obj.has(objKey)):"string"==typeof key||"number"==typeof key?null!=this._obj[key]:null!=this._obj[this._obj.$_GID])},WeakObject.__init__=function(){(WeakObject.supportWeakMap=null!=Browser.window.WeakMap)||Laya.timer.loop(WeakObject.delInterval,null,WeakObject.clearCache)},WeakObject.clearCache=function(){for(var i=0,n=WeakObject._maps.length;i<n;i++)WeakObject._maps[i]._obj={}},WeakObject.supportWeakMap=!1,WeakObject.delInterval=3e5,WeakObject._keys={},WeakObject._maps=[],__static(WeakObject,["I",function(){return this.I=new WeakObject}]),WeakObject}(),WordText=function(){function WordText(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}__class(WordText,"laya.utils.WordText");var __proto=WordText.prototype;return __proto.setText=function(txt){this.changed=!0,this._text=txt},__proto.toString=function(){return this._text},__proto.charCodeAt=function(i){return this._text?this._text.charCodeAt(i):NaN},__proto.charAt=function(i){return this._text?this._text.charAt(i):null},__getset(0,__proto,"length",function(){return this._text?this._text.length:0}),WordText}(),Node=function(){function Node(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,Node.__super.call(this),this._childs=Node.ARRAY_EMPTY,this._$P=Node.PROP_EMPTY,this.timer=Laya.scaleTimer,this.conchModel=Render.isConchNode?this.createConchModel():null}__class(Node,"laya.display.Node",EventDispatcher);var __proto=Node.prototype;return __proto._setBit=function(type,value){1==type&&this._getBit(type)!=value&&this._updateDisplayedInstage(),value?this._bits|=type:this._bits&=~type},__proto._getBit=function(type){return 0!=(this._bits&type)},__proto._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},__proto._setUpNoticeType=function(type){var ele=this;for(ele._setBit(type,!0),ele=ele.parent;ele;){if(ele._getBit(type))return;ele._setBit(type,!0),ele=ele.parent}},__proto.on=function(type,caller,listener,args){return"display"!==type&&"undisplay"!==type||this._getBit(1)||this._setUpNoticeType(1),this._createListener(type,caller,listener,args,!1)},__proto.once=function(type,caller,listener,args){return"display"!==type&&"undisplay"!==type||this._getBit(1)||this._setUpNoticeType(1),this._createListener(type,caller,listener,args,!0)},__proto.createConchModel=function(){return null},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(destroyChild?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},__proto.destroyChildren=function(){if(this._childs)for(var i=this._childs.length-1;-1<i;i--)this._childs[i].destroy(!0)},__proto.addChild=function(node){var index;return node&&!this.destroyed&&node!==this&&(node.zOrder&&this._set$P("hasZorder",!0),node._parent===this?(index=this.getChildIndex(node))!==this._childs.length-1&&(this._childs.splice(index,1),this._childs.push(node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,this._childs.length-1)),this._childChanged()):(node.parent&&node.parent.removeChild(node),this._childs===Node.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(node),this.conchModel&&this.conchModel.addChildAt(node.conchModel,this._childs.length-1),(node.parent=this)._childChanged())),node},__proto.addChildren=function(__args){for(var args=arguments,i=0,n=args.length;i<n;)this.addChild(args[i++])},__proto.addChildAt=function(node,index){if(!node||this.destroyed||node===this)return node;var oldIndex;if(node.zOrder&&this._set$P("hasZorder",!0),0<=index&&index<=this._childs.length)return node._parent===this?(oldIndex=this.getChildIndex(node),this._childs.splice(oldIndex,1),this._childs.splice(index,0,node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,index)),this._childChanged()):(node.parent&&node.parent.removeChild(node),this._childs===Node.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(index,0,node),this.conchModel&&this.conchModel.addChildAt(node.conchModel,index),node.parent=this),node;throw new Error("appendChildAt:The index is out of bounds")},__proto.getChildIndex=function(node){return this._childs.indexOf(node)},__proto.getChildByName=function(name){var nodes=this._childs;if(nodes)for(var i=0,n=nodes.length;i<n;i++){var node=nodes[i];if(node.name===name)return node}return null},__proto._get$P=function(key){return this._$P[key]},__proto._set$P=function(key,value){return this.destroyed||(this._$P===Node.PROP_EMPTY&&(this._$P={}),this._$P[key]=value),value},__proto.getChildAt=function(index){return this._childs[index]},__proto.setChildIndex=function(node,index){var childs=this._childs;if(index<0||index>=childs.length)throw new Error("setChildIndex:The index is out of bounds.");var oldIndex=this.getChildIndex(node);if(oldIndex<0)throw new Error("setChildIndex:node is must child of this object.");return childs.splice(oldIndex,1),childs.splice(index,0,node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,index)),this._childChanged(),node},__proto._childChanged=function(child){},__proto.removeChild=function(node){var index;return this._childs?(index=this._childs.indexOf(node),this.removeChildAt(index)):node},__proto.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},__proto.removeChildByName=function(name){name=this.getChildByName(name);return name&&this.removeChild(name),name},__proto.removeChildAt=function(index){var node=this.getChildAt(index);if(node){for(var last=this._childs.length-1,j=index;j<last;++j)this._childs[j]=this._childs[j+1];this._childs.length=last,this.conchModel&&this.conchModel.removeChild(node.conchModel),node.parent=null}return node},__proto.removeChildren=function(beginIndex,endIndex){if(void 0===beginIndex&&(beginIndex=0),void 0===endIndex&&(endIndex=2147483647),this._childs&&0<this._childs.length){var arr,childs=this._childs;0===beginIndex&&n<=endIndex?(arr=childs,this._childs=Node.ARRAY_EMPTY):arr=childs.splice(beginIndex,endIndex-beginIndex);for(var i=0,n=arr.length;i<n;i++)arr[i].parent=null,this.conchModel&&this.conchModel.removeChild(arr[i].conchModel)}return this},__proto.replaceChild=function(newNode,oldNode){var index=this._childs.indexOf(oldNode);return-1<index?(this._childs.splice(index,1,newNode),this.conchModel&&(this.conchModel.removeChild(oldNode.conchModel),this.conchModel.addChildAt(newNode.conchModel,index)),oldNode.parent=null,newNode.parent=this,newNode):null},__proto._updateDisplayedInstage=function(){var ele=this,stage=Laya.stage;for(this._displayedInStage=!1;ele;){if(ele._getBit(1)){this._displayedInStage=ele._displayedInStage;break}if(ele==stage||ele._displayedInStage){this._displayedInStage=!0;break}ele=ele.parent}},__proto._setDisplay=function(value){this._displayedInStage!==value&&((this._displayedInStage=value)?this.event("display"):this.event("undisplay"))},__proto._displayChild=function(node,display){var childs=node._childs;if(childs)for(var i=0,n=childs.length;i<n;i++){var child=childs[i];child._getBit(1)&&(0<child._childs.length?this._displayChild(child,display):child._setDisplay(display))}node._setDisplay(display)},__proto.contains=function(node){if(node===this)return!0;for(;node;){if(node.parent===this)return!0;node=node.parent}return!1},__proto.timerLoop=function(delay,caller,method,args,coverBefore,jumpFrame){this.timer.loop(delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore,jumpFrame=void 0===jumpFrame?!1:jumpFrame)},__proto.timerOnce=function(delay,caller,method,args,coverBefore){this.timer._create(!1,!1,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore)},__proto.frameLoop=function(delay,caller,method,args,coverBefore){this.timer._create(!0,!0,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore)},__proto.frameOnce=function(delay,caller,method,args,coverBefore){this.timer._create(!0,!1,delay,caller,method,args,coverBefore=void 0===coverBefore?!0:coverBefore)},__proto.clearTimer=function(caller,method){this.timer.clear(caller,method)},__getset(0,__proto,"numChildren",function(){return this._childs.length}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),__getset(0,__proto,"parent",function(){return this._parent},function(value){this._parent!==value&&(value?(this._parent=value,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),value.displayedInStage)&&this._displayChild(this,!0),value._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=value))}),__getset(0,__proto,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),Node.ARRAY_EMPTY=[],Node.PROP_EMPTY={},Node.NOTICE_DISPLAY=1,Node.MOUSEENABLE=2,Node}(),CSSStyle=function(_super){function CSSStyle(ower){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,CSSStyle.__super.call(this),this._padding=CSSStyle._PADDING,this._spacing=CSSStyle._SPACING,this._aligns=CSSStyle._ALIGNS,this._font=Font.EMPTY,this._ower=ower}__class(CSSStyle,"laya.display.css.CSSStyle",_super);var __proto=CSSStyle.prototype;return __proto.destroy=function(){this._ower=null,this._font=null,this._rect=null},__proto.inherit=function(src){this._font=src._font,this._spacing=src._spacing===CSSStyle._SPACING?CSSStyle._SPACING:src._spacing.slice(),this.lineHeight=src.lineHeight},__proto._widthAuto=function(){return 0!=(262144&this._type)},__proto.widthed=function(sprite){return 0!=(8&this._type)},__proto._calculation=function(type,value){if(value.indexOf("%")<0)return!1;var ower=this._ower,parent=ower.parent,rect=this._rect;function getValue(pw,w,nums){return pw*nums[0]+w*nums[1]+nums[2]}function onParentResize(type){var pw=parent.width,w=ower.width;rect.width&&(ower.width=getValue(pw,w,rect.width)),rect.height&&(ower.height=getValue(pw,w,rect.height)),rect.left&&(ower.x=getValue(pw,w,rect.left)),rect.top&&(ower.y=getValue(pw,w,rect.top))}null===rect&&(parent._getCSSStyle()._type|=524288,parent.on("resize",this,onParentResize),this._rect=rect={input:{}});var nums=value.split(" ");return nums[0]=parseFloat(nums[0])/100,1==nums.length?nums[1]=nums[2]=0:(nums[1]=parseFloat(nums[1])/100,nums[2]=parseFloat(nums[2])),rect[type]=nums,rect.input[type]=value,onParentResize(),!0},__proto.heighted=function(sprite){return 0!=(8192&this._type)},__proto.size=function(w,h){var ower=this._ower,resize=!1;-1!==w&&w!=this._ower.width&&(this._type|=8,this._ower.width=w,resize=!0),-1!==h&&h!=this._ower.height&&(this._type|=8192,this._ower.height=h,resize=!0),resize&&(ower._layoutLater(),524288&this._type)&&ower.event("resize",this)},__proto._getAlign=function(){return this._aligns[0]},__proto._getValign=function(){return this._aligns[1]},__proto._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},__proto._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new Font(this._font))},__proto.render=function(sprite,context,x,y){var w=sprite.width,h=sprite.height;x-=sprite.pivotX,y-=sprite.pivotY,this._bgground&&null!=this._bgground.color&&context.ctx.fillRect(x,y,w,h,this._bgground.color),this._border&&this._border.color&&context.drawRect(x,y,w,h,this._border.color.strColor,this._border.size)},__proto.getCSSStyle=function(){return this},__proto.cssText=function(text){this.attrs(CSSStyle.parseOneCSS(text,";"))},__proto.attrs=function(attrs){if(attrs)for(var i=0,n=attrs.length;i<n;i++){var attr=attrs[i];this[attr[0]]=attr[1]}},__proto.setTransform=function(value){"none"===value?this._tf=Style._TF_EMPTY:this.attrs(CSSStyle.parseOneCSS(value,","))},__proto.translate=function(x,y){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateX=x,this._tf.translateY=y},__proto.scale=function(x,y){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=x,this._tf.scaleY=y},__proto._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},__getset(0,__proto,"block",_super.prototype._$get_block,function(value){value?this._type|=1:this._type&=-2}),__getset(0,__proto,"valign",function(){return CSSStyle._valigndef[this._aligns[1]]},function(value){this._aligns===CSSStyle._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=CSSStyle._valigndef[value]}),__getset(0,__proto,"height",null,function(h){if(this._type|=8192,"string"==typeof h){if(this._calculation("height",h))return;h=parseInt(h)}this.size(-1,h)}),__getset(0,__proto,"width",null,function(w){if(this._type|=8,"string"==typeof w){var offset=w.indexOf("auto");if(0<=offset&&(this._type|=262144,w=w.substr(0,offset)),this._calculation("width",w))return;w=parseInt(w)}this.size(w,-1)}),__getset(0,__proto,"fontWeight",function(){return this._font.weight},function(value){this._createFont().weight=value}),__getset(0,__proto,"left",null,function(value){var ower=this._ower;if("string"==typeof value){if("center"===value?value="50% -50% 0":"right"===value&&(value="100% -100% 0"),this._calculation("left",value))return;value=parseInt(value)}ower.x=value}),__getset(0,__proto,"_translate",null,function(value){this.translate(value[0],value[1])}),__getset(0,__proto,"absolute",function(){return 0!=(4&this._type)}),__getset(0,__proto,"top",null,function(value){var ower=this._ower;if("string"==typeof value){if("middle"===value?value="50% -50% 0":"bottom"===value&&(value="100% -100% 0"),this._calculation("top",value))return;value=parseInt(value)}ower.y=value}),__getset(0,__proto,"align",function(){return CSSStyle._aligndef[this._aligns[0]]},function(value){this._aligns===CSSStyle._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=CSSStyle._aligndef[value]}),__getset(0,__proto,"bold",function(){return this._font.bold},function(value){this._createFont().bold=value}),__getset(0,__proto,"padding",function(){return this._padding},function(value){this._padding=value}),__getset(0,__proto,"leading",function(){return this._spacing[1]},function(d){"string"==typeof d&&(d=parseInt(d+"")),this._spacing===CSSStyle._SPACING&&(this._spacing=[0,0]),this._spacing[1]=d}),__getset(0,__proto,"lineElement",function(){return 0!=(65536&this._type)},function(value){value?this._type|=65536:this._type&=-65537}),__getset(0,__proto,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(value){this.lineElement=!1,"right"===value?this._type|=32768:this._type&=-32769}),__getset(0,__proto,"textDecoration",function(){return this._font.decoration},function(value){this._createFont().decoration=value}),__getset(0,__proto,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(type){"nowrap"===type&&(this._type|=131072),"none"===type&&(this._type&=-131073)}),__getset(0,__proto,"background",null,function(value){value?(this._bgground||(this._bgground={}),this._bgground.color=value,this._ower.conchModel&&this._ower.conchModel.bgColor(value),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),__getset(0,__proto,"wordWrap",function(){return 0==(131072&this._type)},function(value){value?this._type&=-131073:this._type|=131072}),__getset(0,__proto,"color",function(){return this._font.color},function(value){this._createFont().color=value}),__getset(0,__proto,"password",function(){return this._font.password},function(value){this._createFont().password=value}),__getset(0,__proto,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(value){"none"===value?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=value),this._ower.conchModel&&this._ower.conchModel.bgColor(value),this._ower._renderType|=256}),__getset(0,__proto,"font",function(){return this._font.toString()},function(value){this._createFont().set(value)}),__getset(0,__proto,"weight",null,function(value){this._createFont().weight=value}),__getset(0,__proto,"letterSpacing",function(){return this._spacing[0]},function(d){"string"==typeof d&&(d=parseInt(d+"")),this._spacing===CSSStyle._SPACING&&(this._spacing=[0,0]),this._spacing[0]=d}),__getset(0,__proto,"fontSize",function(){return this._font.size},function(value){this._createFont().size=value}),__getset(0,__proto,"italic",function(){return this._font.italic},function(value){this._createFont().italic=value}),__getset(0,__proto,"fontFamily",function(){return this._font.family},function(value){this._createFont().family=value}),__getset(0,__proto,"stroke",function(){return this._font.stroke[0]},function(value){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=value}),__getset(0,__proto,"strokeColor",function(){return this._font.stroke[1]},function(value){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=value}),__getset(0,__proto,"border",function(){return this._border?this._border.value:""},function(value){var i;"none"==value?this._border=null:(this._border||(this._border={}),value=(this._border.value=value).split(" "),this._border.color=Color.create(value[value.length-1]),1==value.length?(this._border.size=1,this._border.type="solid"):((i=0)<value[0].indexOf("px")?(this._border.size=parseInt(value[0]),i++):this._border.size=1,this._border.type=value[i],this._ower._renderType|=256))}),__getset(0,__proto,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(value){value?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==value?null:Color.create(value),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),__getset(0,__proto,"position",function(){return 4&this._type?"absolute":""},function(value){"absolute"==value?this._type|=4:this._type&=-5}),__getset(0,__proto,"display",null,function(value){switch(value){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),__getset(0,__proto,"paddingLeft",function(){return this.padding[3]}),__getset(0,__proto,"paddingTop",function(){return this.padding[0]}),__getset(0,__proto,"_scale",null,function(value){this._ower.scale(value[0],value[1])}),__getset(0,__proto,"_rotate",null,function(value){this._ower.rotation=value}),CSSStyle.parseOneCSS=function(text,clipWord){for(var valueArray,out=[],attrs=text.split(clipWord),i=0,n=attrs.length;i<n;i++){var attr=attrs[i],ofs=attr.indexOf(":"),name=attr.substr(0,ofs).replace(/^\s+|\s+$/g,"");if(0!=name.length){var value=attr.substr(ofs+1).replace(/^\s+|\s+$/g,""),one=[name,value];switch(name){case"italic":case"bold":one[1]="true"==value;break;case"line-height":one[0]="lineHeight",one[1]=parseInt(value);break;case"font-size":one[0]="fontSize",one[1]=parseInt(value);break;case"padding":1<(valueArray=value.split(" ")).length||(valueArray[1]=valueArray[2]=valueArray[3]=valueArray[0]),one[1]=[parseInt(valueArray[0]),parseInt(valueArray[1]),parseInt(valueArray[2]),parseInt(valueArray[3])];break;case"rotate":one[0]="_rotate",one[1]=parseFloat(value);break;case"scale":valueArray=value.split(" "),one[0]="_scale",one[1]=[parseFloat(valueArray[0]),parseFloat(valueArray[1])];break;case"translate":valueArray=value.split(" "),one[0]="_translate",one[1]=[parseInt(valueArray[0]),parseInt(valueArray[1])];break;default:(one[0]=CSSStyle._CSSTOVALUE[name])||(one[0]=name)}out.push(one)}}return out},CSSStyle.parseCSS=function(text,uri){for(var one;null!=(one=CSSStyle._parseCSSRegExp.exec(text));)CSSStyle.styleSheets[one[1]]=CSSStyle.parseOneCSS(one[2],";")},CSSStyle.EMPTY=new CSSStyle(null),CSSStyle._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},CSSStyle._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),CSSStyle._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},CSSStyle._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},CSSStyle.styleSheets={},CSSStyle.ALIGN_CENTER=1,CSSStyle.ALIGN_RIGHT=2,CSSStyle.VALIGN_MIDDLE=1,CSSStyle.VALIGN_BOTTOM=2,CSSStyle._CSS_BLOCK=1,CSSStyle._DISPLAY_NONE=2,CSSStyle._ABSOLUTE=4,CSSStyle._WIDTH_SET=8,CSSStyle._PADDING=[0,0,0,0],CSSStyle._RECT=[-1,-1,-1,-1],CSSStyle._SPACING=[0,0],CSSStyle._ALIGNS=[0,0,0],CSSStyle.ADDLAYOUTED=512,CSSStyle._NEWFONT=4096,CSSStyle._HEIGHT_SET=8192,CSSStyle._BACKGROUND_SET=16384,CSSStyle._FLOAT_RIGHT=32768,CSSStyle._LINE_ELEMENT=65536,CSSStyle._NOWARP=131072,CSSStyle._WIDTHAUTO=262144,CSSStyle._LISTERRESZIE=524288,CSSStyle}(Style),AudioSound=function(){function AudioSound(){this.url=null,this.audio=null,this.loaded=!1,AudioSound.__super.call(this)}__class(AudioSound,"laya.media.h5audio.AudioSound",EventDispatcher);var __proto=AudioSound.prototype;return __proto.dispose=function(){var ad=AudioSound._audioCache[this.url];ad&&(ad.src="",delete AudioSound._audioCache[this.url])},__proto.load=function(url){var ad,me;function onLoaded(){offs(),me.loaded=!0,me.event("complete")}function onErr(){ad.load=null,offs(),me.event("error")}function offs(){ad.removeEventListener("canplaythrough",onLoaded),ad.removeEventListener("error",onErr)}url=URL.formatURL(url),(this.url=url)==SoundManager._tMusic?(AudioSound._initMusicAudio(),(ad=AudioSound._musicAudio).src!=url&&(AudioSound._audioCache[ad.src]=null,ad=null)):ad=AudioSound._audioCache[url],ad&&2<=ad.readyState?this.event("complete"):(ad||(ad=url==SoundManager._tMusic?(AudioSound._initMusicAudio(),AudioSound._musicAudio):Browser.createElement("audio"),(AudioSound._audioCache[url]=ad).src=url),ad.addEventListener("canplaythrough",onLoaded),ad.addEventListener("error",onErr),((me=this).audio=ad).load?ad.load():onErr())},__proto.play=function(startTime,loops){if(void 0===startTime&&(startTime=0),void 0===loops&&(loops=0),!this.url)return null;var tAd,ad=this.url==SoundManager._tMusic?AudioSound._musicAudio:AudioSound._audioCache[this.url];if(!ad)return null;tAd=Pool.getItem("audio:"+this.url),Render.isConchApp?tAd||((tAd=Browser.createElement("audio")).src=this.url):this.url==SoundManager._tMusic?(AudioSound._initMusicAudio(),(tAd=AudioSound._musicAudio).src=this.url):tAd=tAd||ad.cloneNode(!0);ad=new AudioSoundChannel(tAd);return ad.url=this.url,ad.loops=loops,ad.startTime=startTime,ad.play(),SoundManager.addChannel(ad),ad},__getset(0,__proto,"duration",function(){var ad=AudioSound._audioCache[this.url];return ad?ad.duration:0}),AudioSound._initMusicAudio=function(){AudioSound._musicAudio||(AudioSound._musicAudio||(AudioSound._musicAudio=Browser.createElement("audio")),Render.isConchApp)||Browser.document.addEventListener("mousedown",AudioSound._makeMusicOK)},AudioSound._makeMusicOK=function(){Browser.document.removeEventListener("mousedown",AudioSound._makeMusicOK),AudioSound._musicAudio.src?AudioSound._musicAudio.play():(AudioSound._musicAudio.src="",AudioSound._musicAudio.load())},AudioSound._audioCache={},AudioSound._musicAudio=null,AudioSound}(),SoundChannel=function(){function SoundChannel(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,SoundChannel.__super.call(this)}__class(SoundChannel,"laya.media.SoundChannel",EventDispatcher);var __proto=SoundChannel.prototype;return __proto.play=function(){},__proto.stop=function(){},__proto.pause=function(){},__proto.resume=function(){},__proto.__runComplete=function(handler){handler&&handler.run()},__getset(0,__proto,"volume",function(){return 1},function(v){}),__getset(0,__proto,"position",function(){return 0}),__getset(0,__proto,"duration",function(){return 0}),SoundChannel}(),Sound=function(){function Sound(){Sound.__super.call(this)}__class(Sound,"laya.media.Sound",EventDispatcher);var __proto=Sound.prototype;return __proto.load=function(url){},__proto.play=function(startTime,loops){return void 0===startTime&&(startTime=0),void 0===loops&&(loops=0),null},__proto.dispose=function(){},__getset(0,__proto,"duration",function(){return 0}),Sound}(),WebAudioSound=function(){function WebAudioSound(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,WebAudioSound.__super.call(this)}__class(WebAudioSound,"laya.media.webaudio.WebAudioSound",EventDispatcher);var __proto=WebAudioSound.prototype;return __proto.load=function(url){this.url=url,this.audioBuffer=WebAudioSound._dataCache[url],this.audioBuffer?this._loaded(this.audioBuffer):(WebAudioSound.e.on("loaded:"+url,this,this._loaded),WebAudioSound.e.on("err:"+url,this,this._err),WebAudioSound.__loadingSound[url]||(WebAudioSound.__loadingSound[url]=!0,Laya.loader.load(url,Handler.create(this,this.onloaded),null,Loader.BUFFER,4,!1,null,!0)))},__proto.onloaded=function(data){data||this._err(),this._disposed?this._removeLoadEvents():(this.data=data,WebAudioSound.buffs.push({buffer:this.data,url:this.url}),WebAudioSound.decode())},__proto._err=function(){if(this._removeLoadEvents(),WebAudioSound.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){for(var tParams,i=0,toPlays=this.__toPlays,len=toPlays.length,i=0;i<len;i++)(tParams=toPlays[i])[2]&&!tParams[2].isStopped&&tParams[2].event("error");this.__toPlays.length=0}},__proto._loaded=function(audioBuffer){this._removeLoadEvents(),this._disposed||(this.audioBuffer=audioBuffer,WebAudioSound._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete"))},__proto._removeLoadEvents=function(){WebAudioSound.e.off("loaded:"+this.url,this,this._loaded),WebAudioSound.e.off("err:"+this.url,this,this._err)},__proto.__playAfterLoaded=function(){if(this.__toPlays){for(var tParams,i=0,toPlays=this.__toPlays,len=toPlays.length,i=0;i<len;i++)(tParams=toPlays[i])[2]&&!tParams[2].isStopped&&this.play(tParams[0],tParams[1],tParams[2]);this.__toPlays.length=0}},__proto.play=function(startTime,loops,channel){return void 0===startTime&&(startTime=0),void 0===loops&&(loops=0),channel=channel||new WebAudioSoundChannel,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([startTime,loops,channel]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),channel.url=this.url,channel.loops=loops,channel.audioBuffer=this.audioBuffer,channel.startTime=startTime,channel.play(),SoundManager.addChannel(channel),channel},__proto.dispose=function(){this._disposed=!0,delete WebAudioSound._dataCache[this.url],delete WebAudioSound.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},__getset(0,__proto,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),WebAudioSound.decode=function(){WebAudioSound.buffs.length<=0||WebAudioSound.isDecoding||(WebAudioSound.isDecoding=!0,WebAudioSound.tInfo=WebAudioSound.buffs.shift(),WebAudioSound.ctx.decodeAudioData(WebAudioSound.tInfo.buffer,WebAudioSound._done,WebAudioSound._fail))},WebAudioSound._done=function(audioBuffer){WebAudioSound.e.event("loaded:"+WebAudioSound.tInfo.url,audioBuffer),WebAudioSound.isDecoding=!1,WebAudioSound.decode()},WebAudioSound._fail=function(){WebAudioSound.e.event("err:"+WebAudioSound.tInfo.url,null),WebAudioSound.isDecoding=!1,WebAudioSound.decode()},WebAudioSound._playEmptySound=function(){if(null!=WebAudioSound.ctx){if(WebAudioSound._emptySource&&(WebAudioSound._emptySource.stop(),WebAudioSound._emptySource.disconnect(0),!WebAudioSoundChannel._tryCleanFailed))try{WebAudioSound._emptySource.buffer=null}catch(e){WebAudioSoundChannel._tryCleanFailed=!0}var source=WebAudioSound.ctx.createBufferSource();source.buffer=WebAudioSound._miniBuffer,source.connect(WebAudioSound.ctx.destination),source.start(0,0,0),WebAudioSound._emptySource=source}},WebAudioSound._unlock=function(){WebAudioSound._unlocked||(WebAudioSound._playEmptySound(),"running"==WebAudioSound.ctx.state&&(Browser.document.removeEventListener("mousedown",WebAudioSound._unlock,!0),Browser.document.removeEventListener("touchend",WebAudioSound._unlock,!0),Browser.document.removeEventListener("touchstart",WebAudioSound._unlock,!0),WebAudioSound._unlocked=!0))},WebAudioSound.initWebAudio=function(){"running"!=WebAudioSound.ctx.state&&(WebAudioSound._unlock(),Browser.document.addEventListener("mousedown",WebAudioSound._unlock,!0),Browser.document.addEventListener("touchend",WebAudioSound._unlock,!0),Browser.document.addEventListener("touchstart",WebAudioSound._unlock,!0))},WebAudioSound._emptySource=null,WebAudioSound._dataCache={},WebAudioSound.buffs=[],WebAudioSound.isDecoding=!1,WebAudioSound._unlocked=!1,WebAudioSound.tInfo=null,WebAudioSound.__loadingSound={},__static(WebAudioSound,["window",function(){return this.window=Browser.window},"webAudioEnabled",function(){return this.webAudioEnabled=WebAudioSound.window.AudioContext||WebAudioSound.window.webkitAudioContext||WebAudioSound.window.mozAudioContext},"ctx",function(){return this.ctx=WebAudioSound.webAudioEnabled?new(WebAudioSound.window.AudioContext||WebAudioSound.window.webkitAudioContext||WebAudioSound.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=WebAudioSound.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new EventDispatcher}]),WebAudioSound}(),HttpRequest=function(){function HttpRequest(){this._responseType=null,this._data=null,HttpRequest.__super.call(this),this._http=new Browser.window.XMLHttpRequest}__class(HttpRequest,"laya.net.HttpRequest",EventDispatcher);var __proto=HttpRequest.prototype;return __proto.send=function(url,data,method,responseType,headers){void 0===method&&(method="get"),this._responseType=responseType=void 0===responseType?"text":responseType,this._data=null;var _this=this,http=this._http;if(http.open(method,url,!0),headers)for(var i=0;i<headers.length;i++)http.setRequestHeader(headers[i++],headers[i]);else Render.isConchApp||(data&&"string"!=typeof data?http.setRequestHeader("Content-Type","application/json"):http.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));http.responseType="arraybuffer"!==responseType?"text":"arraybuffer",http.onerror=function(e){_this._onError(e)},http.onabort=function(e){_this._onAbort(e)},http.onprogress=function(e){_this._onProgress(e)},http.onload=function(e){_this._onLoad(e)},http.send(data)},__proto._onProgress=function(e){e&&e.lengthComputable&&this.event("progress",e.loaded/e.total)},__proto._onAbort=function(e){this.error("Request was aborted by user")},__proto._onError=function(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},__proto._onLoad=function(e){var http=this._http,status=void 0!==http.status?http.status:200;200===status||204===status||0===status?this.complete():this.error("["+http.status+"]"+http.statusText+":"+http.responseURL)},__proto.error=function(message){this.clear(),this.event("error",message)},__proto.complete=function(){this.clear();var flag=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=Utils.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){flag=!1,this.error(e.message)}flag&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},__proto.clear=function(){var http=this._http;http.onerror=http.onabort=http.onprogress=http.onload=null},__getset(0,__proto,"url",function(){return this._http.responseURL}),__getset(0,__proto,"http",function(){return this._http}),__getset(0,__proto,"data",function(){return this._data}),HttpRequest}(),Loader=function(){function Loader(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,Loader.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=0,this.realTime=!1}__class(Loader,"laya.net.Loader",EventDispatcher);var __proto=Loader.prototype;return __proto.load=function(url,type,cache,group,ignoreCache){if(void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),0===(this._url=url).indexOf("data:image")?this._type=type="image":this._type=type=type||this.getTypeFromUrl(url),this._cache=cache,this._data=null,!ignoreCache&&Loader.loadedMap[url])this._data=Loader.loadedMap[url],this.event("progress",1),this.event("complete",this._data);else if(group&&Loader.setGroup(url,group),null!=Loader.parserMap[type])this._customParse=!0,Loader.parserMap[type]instanceof laya.utils.Handler?Loader.parserMap[type].runWith(this):Loader.parserMap[type].call(null,this);else{if("image"===type||"htmlimage"===type||"nativeimage"===type)return this._loadImage(url);if("ttf"===type)return this._loadTTF(url);var contentType;switch(type){case"atlas":case"plf":contentType="json";break;case"font":contentType="xml";break;case"pkm":contentType="arraybuffer";break;default:contentType=type}Loader.preLoadedMap[url]?this.onLoaded(Loader.preLoadedMap[url]):MainResourcePool?MainResourcePool.load(url,this._onLoadedCallback,this.priority,this.realTime):(this._http||(this._http=new HttpRequest,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(url,null,"get",contentType))}},__proto.getTypeFromUrl=function(url){var type=Utils.getFileExtension(url);return type?Loader.typeMap[type]:(console.warn("Not recognize the resources suffix",url),"text")},__proto._loadTTF=function(url){url=URL.formatURL(url);var ttfLoader=new TTFLoader;ttfLoader.complete=Handler.create(this,this.onLoaded),ttfLoader.load(url)},__proto._loadImage=function(url){function clear(){image.onload=null,image.onerror=null,delete Loader.imgCache[url]}var _this,image,onload,onerror;MainResourcePool?MainResourcePool.load(url,this._onImageCallback,0,!0):(url=URL.formatURL(url),onload=function(){clear(),_this.onLoaded(image)},onerror=function(){clear(),_this.event("error","Load image failed")},"nativeimage"===(_this=this)._type?((image=new Browser.window.Image).crossOrigin="",image.onload=onload,image.onerror=onerror,image.src=url,Loader.imgCache[url]=image):new HTMLImage.create(url,{onload:onload,onerror:onerror,onCreate:function(img){image=img,Loader.imgCache[url]=img}}))},__proto._loadImageComplete=function(url,handle,res){var view;null==res?this.event("error","Load image failed"):(view=new DataView(res),res=new laya.webgl.resource.WebGLImage(new Uint8Array(res,8),url,0,!1,view.getUint32(0),view.getUint32(4)),this.onLoaded(res))},__proto._loadSound=function(url){var sound=new SoundManager._soundClass,_this=this;function clear(){sound.offAll()}sound.on("complete",this,function(){clear(),_this.onLoaded(sound)}),sound.on("error",this,function(){clear(),sound.dispose(),_this.event("error","Load sound failed")}),sound.load(url)},__proto.onProgress=function(value){"atlas"===this._type?this.event("progress",.3*value):this.event("progress",value)},__proto.onError=function(message){this.event("error",message)},__proto._loadedComplete=function(url,handle,res){if(null==res)this.event("error",url);else switch(this._type){case"atlas":case"plf":case"json":var bytes=new Byte(res);this.onLoaded(JSON.parse(bytes.readUTFBytes()));break;case"font":bytes=new Byte(res);this.onLoaded(Utils.parseXMLFromString(bytes.readUTFBytes()));break;default:this.onLoaded(res)}},__proto.onLoaded=function(data){var type=this._type;if("plf"==type)this.parsePLFData(data),this.complete(data);else if("image"===type){var tex=new Texture(data);tex.url=this._url,this.complete(tex)}else if("sound"===type||"htmlimage"===type||"nativeimage"===type)this.complete(data);else if("atlas"===type){if(!data.src&&!data._setContext){if(!this._data){if((this._data=data).meta&&data.meta.image)for(var toloadPics=data.meta.image.split(","),tex=0<=this._url.indexOf("/")?"/":"\\",tex=this._url.lastIndexOf(tex),folderPath=0<=tex?this._url.substr(0,tex+1):"",i=0,len=toloadPics.length;i<len;i++)toloadPics[i]=folderPath+toloadPics[i];else toloadPics=[this._url.replace(".json",".png")];toloadPics.reverse(),data.toLoads=toloadPics,data.pics=[]}return this.event("progress",.3+1/toloadPics.length*.6),this._loadImage(toloadPics.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(data),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var scaleRate,frames=this._data.frames,tex=this._url.split("?")[0],directory=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:tex.substring(0,tex.lastIndexOf("."))+"/",pics=this._data.pics,tex=URL.formatURL(this._url),map=Loader.atlasMap[tex]||(Loader.atlasMap[tex]=[]);map.dir=directory;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var name in scaleRate=parseFloat(this._data.meta.scale),frames){var tTexture,obj=frames[name],tPic=pics[obj.frame.idx||0],url=URL.formatURL(directory+name);tPic.scaleRate=scaleRate,tTexture=Texture.create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h),Loader.cacheRes(url,tTexture),Loader.keepCache(this._url,directory+name),tTexture.url=url,map.push(url)}else for(name in frames)tPic=pics[(obj=frames[name]).frame.idx||0],url=URL.formatURL(directory+name),Loader.cacheRes(url,Texture.create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h)),Loader.loadedMap[url].url=url,Loader.keepCache(this._url,directory+name),map.push(url);delete this._data.pics,this.complete(this._data)}else if("font"==type){if(!data.src)return this._data=data,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var tex=new BitmapFont,tArr=(tex.parseFont(this._data,data),this._url.split(".fnt")[0].split("/")),tArr=tArr[tArr.length-1];Text.registerBitmapFont(tArr,tex),this._data=tex,this.complete(this._data)}else"pkm"==type?(tArr=HTMLImage.create(data,this._url),(tex=new Texture(tArr)).url=this._url,this.complete(tex)):this.complete(data)},__proto.parsePLFData=function(plfData){var type,filePath,fileDic;for(type in plfData)for(filePath in type,fileDic=plfData[type])Loader.preLoadedMap[URL.formatURL(filePath)]=fileDic[filePath]},__proto.complete=function(data){this._data=data,this._customParse?this.event("loaded",data instanceof Array?[data]:data):(Loader._loaders.push(this),Loader._isWorking||Loader.checkNext())},__proto.endLoad=function(content){content&&(this._data=content),this._cache&&Loader.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"data",function(){return this._data}),__getset(0,__proto,"cache",function(){return this._cache}),__getset(0,__proto,"type",function(){return this._type}),Loader.checkNext=function(){Loader._isWorking=!0;for(var startTimer=Browser.now();Loader._startIndex<Loader._loaders.length;)if(Browser.now(),Loader._loaders[Loader._startIndex].endLoad(),Loader._startIndex++,Browser.now()-startTimer>Loader.maxTimeOut)return console.warn("loader callback cost a long time:"+(Browser.now()-startTimer)+" url="+Loader._loaders[Loader._startIndex-1].url),void Laya.timer.frameOnce(1,null,Loader.checkNext);Loader._loaders.length=0,Loader._startIndex=0,Loader._isWorking=!1},Loader.clearRes=function(url,forceDispose){if(null!=url){void 0===forceDispose&&(forceDispose=!1),url=URL.formatURL(url);var arr=Loader.getAtlas(url);if(arr){for(var i=0,n=arr.length;i<n;i++){var resUrl=arr[i],tex=Loader.getRes(resUrl);delete Loader.loadedMap[resUrl],Loader.clearCache(url.substring(URL.basePath.length),resUrl.substring(URL.basePath.length)),tex&&tex.destroy(forceDispose)}arr.length=0,delete Loader.atlasMap[url],delete Loader.loadedMap[url]}else{var res=Loader.loadedMap[url];res&&(delete Loader.loadedMap[url],res instanceof laya.resource.Texture)&&res.bitmap&&res.destroy(forceDispose)}}},Loader.clearTextureRes=function(url){url=URL.formatURL(url);var arr=laya.net.Loader.getAtlas(url),arr=arr&&0<arr.length?laya.net.Loader.getRes(arr[0]):laya.net.Loader.getRes(url);arr&&arr.bitmap&&(Render.isConchApp&&!Render.isConchWebGL?arr.bitmap.source.releaseTexture&&arr.bitmap.source.releaseTexture():null==arr.bitmap._atlaser&&arr.bitmap.releaseResource(!0))},Loader.getRes=function(url){return Loader.loadedMap[URL.formatURL(url)]},Loader.getAtlas=function(url){return Loader.atlasMap[URL.formatURL(url)]},Loader.cacheRes=function(url,data){url=URL.formatURL(url),null!=Loader.loadedMap[url]?console.warn("Resources already exist,is repeated loading:",url):Loader.loadedMap[url]=data},Loader.setGroup=function(url,group){Loader.groupMap[group]||(Loader.groupMap[group]=[]),Loader.groupMap[group].push(url)},Loader.clearResByGroup=function(group){if(Loader.groupMap[group]){for(var arr=Loader.groupMap[group],i=0,len=arr.length,i=0;i<len;i++)Loader.clearRes(arr[i]);arr.length=0}},Loader.keepCache=function(obj,url){var cache;obj&&url&&((cache=Loader.cacheSet[url])?-1==cache.indexOf(obj)&&cache.push(obj):Loader.cacheSet[url]=[obj])},Loader.clearCache=function(obj,url){var cache,last;obj&&url&&(cache=Loader.cacheSet[url])&&-1!==(obj=cache.indexOf(obj))&&(0==(last=cache.length-1)?(delete Loader.cacheSet[url],Loader.clearRes(url,!0)):(cache[obj]=cache[last],cache.length=last))},Loader.saveObject=function(url,value,recover){var args;value&&url&&((args=Loader.objectSet[url])?(console.warn("Loader.saveObject: "+url),args[0]=value,args[1]=recover):Loader.objectSet[url]=[value,recover,[]])},Loader.findObject=function(url){if(url){url=Loader.objectSet[url];if(url)return url[0]}return null},Loader.keepObject=function(obj,url){obj&&url&&(url=Loader.objectSet[url])&&-1===url[2].indexOf(obj)&&url[2].push(obj)},Loader.clearObject=function(obj,url){var args,array,last;obj&&url&&(args=Loader.objectSet[url])&&-1!==(obj=(array=args[2]).indexOf(obj))&&(0==(last=array.length-1)?(delete Loader.objectSet[url],args[1]&&args[1].call(null,args[0])):(array[obj]=array[last],array.length=last))},Loader.TEXT="text",Loader.JSON="json",Loader.XML="xml",Loader.BUFFER="arraybuffer",Loader.IMAGE="image",Loader.SOUND="sound",Loader.ATLAS="atlas",Loader.FONT="font",Loader.TTF="ttf",Loader.PLF="plf",Loader.PKM="pkm",Loader.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},Loader.parserMap={},Loader.groupMap={},Loader.maxTimeOut=100,Loader.loadedMap={},Loader.preLoadedMap={},Loader.atlasMap={},Loader._loaders=[],Loader._isWorking=!1,Loader._startIndex=0,Loader.imgCache={},Loader.cacheSet={},Loader.objectSet={},Loader}(),LoaderManager=function(){var ResInfo;function LoaderManager(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},LoaderManager.__super.call(this);for(var i=0;i<this._maxPriority;i++)this._resInfos[i]=[]}__class(LoaderManager,"laya.net.LoaderManager",EventDispatcher);var __proto=LoaderManager.prototype;return __proto.create=function(url,complete,progress,clas,params,priority,cache,group){if(void 0===priority&&(priority=1),void 0===cache&&(cache=!0),url instanceof Array){var progress2,items=url,itemCount=items.length,loadedCount=0;progress&&(progress2=Handler.create(progress.caller,progress.method,progress.args,!1));for(var i=0;i<itemCount;i++){var item=items[i];(item="string"==typeof item?items[i]={url:item}:item).progress=0}for(i=0;i<itemCount;i++){var item=items[i],progressHandler=progress?Handler.create(null,onProgress,[item],!1):null,completeHandler=progress||complete?Handler.create(null,onComplete,[item]):null;this._create(item.url,completeHandler,progressHandler,item.clas||clas,item.params||params,item.priority||priority,cache,item.group||group)}function onComplete(item,content){loadedCount++,item.progress=1,loadedCount===itemCount&&complete&&complete.run()}function onProgress(item,value){item.progress=value;for(var num=0,j=0;j<itemCount;j++)num+=items[j].progress;progress2.runWith(num/itemCount)}return!0}return this._create(url,complete,progress,clas,params,priority,cache,group)},__proto._create=function(url,complete,progress,clas,params,priority,cache,group){void 0===priority&&(priority=1),void 0===cache&&(cache=!0);var formarUrl=URL.formatURL(url),item=this.getRes(formarUrl);if(item)!item.hasOwnProperty("loaded")||item.loaded?(progress&&progress.runWith(1),complete&&complete.run()):complete&&Laya.loader._createListener(url,complete.caller,complete.method,complete.args,!0,!1);else{var extension=Utils.getFileExtension(url),creatItem=LoaderManager.createMap[extension];if(!creatItem)throw new Error("LoaderManager:unknown file("+url+") extension with: "+extension+".");clas=clas||creatItem[0];creatItem=creatItem[1];"atlas"==extension?this.load(url,complete,progress,creatItem,priority,cache):(clas===Texture&&(creatItem="htmlimage"),(item=clas?new clas:null).hasOwnProperty("_loaded")&&(item._loaded=!1),item._setUrl(url),group&&item._setGroup(group),this._createLoad(item,url,Handler.create(null,function(data){item&&!item.destroyed&&data&&item.onAsynLoaded.call(item,url,data,params),complete&&complete.run();Laya.loader.event(url)}),progress,creatItem,priority,!1,group,!0),cache&&this.cacheRes(formarUrl,item))}return item},__proto.load=function(url,complete,progress,type,priority,cache,group,ignoreCache){var content,info,_$this=this;return void 0===priority&&(priority=1),void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),url instanceof Array?this._loadAssets(url,complete,progress,type,priority,cache,group):(null!=(content=Loader.getRes(url))?Laya.timer.frameOnce(1,null,function(){progress&&progress.runWith(1),complete&&complete.runWith(content),_$this._loaderCount||_$this.event("complete")}):(info=LoaderManager._resMap[url])?(complete&&info._createListener("complete",complete.caller,complete.method,complete.args,!1,!1),progress&&info._createListener("progress",progress.caller,progress.method,progress.args,!1,!1)):((info=this._infoPool.length?this._infoPool.pop():new ResInfo).url=url,info.type=type,info.cache=cache,info.group=group,info.ignoreCache=ignoreCache,info.priority=priority,complete&&info.on("complete",complete.caller,complete.method,complete.args),progress&&info.on("progress",progress.caller,progress.method,progress.args),LoaderManager._resMap[url]=info,priority=priority<this._maxPriority?priority:this._maxPriority-1,this._resInfos[priority].push(info),this._next()),this)},__proto._createLoad=function(item,url,complete,progress,type,priority,cache,group,ignoreCache){var content,info,_$this=this;return void 0===priority&&(priority=1),void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),url instanceof Array?this._loadAssets(url,complete,progress,type,priority,cache,group):(null!=(content=Loader.getRes(url))?Laya.timer.frameOnce(1,null,function(){progress&&progress.runWith(1),complete&&complete.runWith(content),_$this._loaderCount||_$this.event("complete")}):(info=LoaderManager._resMap[url])?(complete&&info._createListener("complete",complete.caller,complete.method,complete.args,!1,!1),progress&&info._createListener("progress",progress.caller,progress.method,progress.args,!1,!1)):((info=this._infoPool.length?this._infoPool.pop():new ResInfo).url=url,info.clas=item,info.type=type,info.cache=cache,info.group=group,info.ignoreCache=ignoreCache,info.priority=priority,complete&&info.on("complete",complete.caller,complete.method,complete.args),progress&&info.on("progress",progress.caller,progress.method,progress.args),LoaderManager._resMap[url]=info,priority=priority<this._maxPriority?priority:this._maxPriority-1,this._resInfos[priority].push(info),this._next()),this)},__proto._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var i=0;i<this._maxPriority;i++)for(var infos=this._resInfos[i];0<infos.length;){var info=infos.shift();if(info)return this._doLoad(info)}this._loaderCount||this.event("complete")}},__proto._doLoad=function(resInfo){this._loaderCount++;var loader=this._loaders.length?this._loaders.pop():new Loader,_this=(loader.on("complete",null,onLoaded),loader.on("progress",null,function(num){resInfo.event("progress",num)}),loader.on("error",null,function(msg){onLoaded(null)}),this);function onLoaded(data){loader.offAll(),loader._data=null,loader._customParse=!1,_this._loaders.push(loader),_this._endLoad(resInfo,data instanceof Array?[data]:data),_this._loaderCount--,_this._next()}loader._class=resInfo.clas,1<resInfo.priority?(loader.priority=1800*resInfo.priority,loader.realTime=!1):(loader.priority=0,loader.realTime=!0),loader.load(resInfo.url,resInfo.type,resInfo.cache,resInfo.group,resInfo.ignoreCache)},__proto._endLoad=function(resInfo,content){var url=resInfo.url;if(null==content){var errorCount=this._failRes[url]||0;if(errorCount<this.retryNum)return console.warn("[warn]Retry to load:",url),this._failRes[url]=errorCount+1,void Laya.timer.once(this.retryDelay,this,this._addReTry,[resInfo],!1);console.warn("[error]Failed to load:",url),this.event("error",url)}this._failRes[url]&&(this._failRes[url]=0),delete LoaderManager._resMap[url],resInfo.event("complete",content),resInfo.offAll(),this._infoPool.push(resInfo)},__proto._addReTry=function(resInfo){this._resInfos[this._maxPriority-1].push(resInfo),this._next()},__proto.clearRes=function(url,forceDispose){Loader.clearRes(url,forceDispose=void 0===forceDispose?!1:forceDispose)},__proto.getRes=function(url){return Loader.getRes(url)},__proto.cacheRes=function(url,data){Loader.cacheRes(url,data)},__proto.clearTextureRes=function(url){Loader.clearTextureRes(url)},__proto.setGroup=function(url,group){Loader.setGroup(url,group)},__proto.clearResByGroup=function(group){Loader.clearResByGroup(group)},__proto.clearUnLoaded=function(){for(var i=0;i<this._maxPriority;i++){for(var infos=this._resInfos[i],j=infos.length-1;-1<j;j--){var info=infos[j];info&&(info.offAll(),this._infoPool.push(info))}infos.length=0}this._loaderCount=0,LoaderManager._resMap={}},__proto.cancelLoadByUrls=function(urls){if(urls)for(var i=0,n=urls.length;i<n;i++)this.cancelLoadByUrl(urls[i])},__proto.cancelLoadByUrl=function(url,complete){for(var i=0;i<this._maxPriority;i++)for(var infos=this._resInfos[i],j=infos.length-1;-1<j;j--){var info=infos[j];if(info&&info.url===url){complete&&info.off("complete",complete.caller,complete.method),complete&&info.hasListener("complete")||(infos[j]=null,info.offAll(),this._infoPool.push(info),delete LoaderManager._resMap[url]);break}}},__proto._loadAssets=function(arr,complete,progress,type,priority,cache,group){void 0===priority&&(priority=1),void 0===cache&&(cache=!0);for(var itemCount=arr.length,loadedCount=0,totalSize=0,items=[],success=!0,i=0;i<itemCount;i++){var item=arr[i],progressHandler=((item="string"==typeof item?{url:item,type:type,size:1,priority:priority}:item).size||(item.size=1),item.progress=0,totalSize+=item.size,items.push(item),progress?Handler.create(null,loadProgress,[item],!1):null),completeHandler=complete||progress?Handler.create(null,loadComplete,[item]):null;this.load(item.url,completeHandler,progressHandler,item.type,item.priority||1,cache,item.group||group)}function loadComplete(item,content){loadedCount++,item.progress=1,content||(success=!1),loadedCount===itemCount&&complete&&complete.runWith(success)}function loadProgress(item,value){if(null!=progress){item.progress=value;for(var num=0,j=0;j<items.length;j++){var item1=items[j];num+=item1.size*item1.progress}item=num/totalSize;progress.runWith(item)}}return this},LoaderManager.cacheRes=function(url,data){Loader.cacheRes(url,data)},LoaderManager._resMap={},__static(LoaderManager,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),LoaderManager.__init$=function(){ResInfo=function(){function ResInfo(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.priority=0,ResInfo.__super.call(this)}return __class(ResInfo,"",EventDispatcher),ResInfo}()},LoaderManager}(),Resource=(function(){function ColorFilter(mat){ColorFilter.__super.call(this),mat=mat||[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0],this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var j=0,z=0,i=0;i<20;i++)i%5!=4?this._mat[j++]=mat[i]:this._alpha[z++]=mat[i];this._action=RunDriver.createFilterAction(32),this._action.data=this}__class(ColorFilter,"laya.filters.ColorFilter",Filter);var __proto=ColorFilter.prototype;Laya.imps(__proto,{"laya.filters.IFilter":!0}),__proto.callNative=function(sp){sp._$P.cf=this;sp.conchModel&&sp.conchModel.setFilterMatrix&&sp.conchModel.setFilterMatrix(this._mat,this._alpha)},__getset(0,__proto,"type",function(){return 32}),__getset(0,__proto,"action",function(){return this._action})}(),function(){function Socket(host,port,byteClass){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===port&&(port=0),Socket.__super.call(this),this._byteClass=byteClass||Byte,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,host&&0<port&&port<65535&&this.connect(host,port)}__class(Socket,"laya.net.Socket",EventDispatcher);var __proto=Socket.prototype;__proto.connect=function(host,port){var url="ws://"+host+":"+port,url="https:"==Browser.window.location.protocol?"wss://"+host+":"+port:"ws://"+host+":"+port;this.connectByUrl(url)},__proto.connectByUrl=function(url){var _$this=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new Browser.window.WebSocket(url,this.protocols):this._socket=new Browser.window.WebSocket(url),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(e){_$this._onOpen(e)},this._socket.onmessage=function(msg){_$this._onMessage(msg)},this._socket.onclose=function(e){_$this._onClose(e)},this._socket.onerror=function(e){_$this._onError(e)}},__proto.cleanSocket=function(){try{this._socket.close()}catch(e){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},__proto.close=function(){if(null!=this._socket)try{this._socket.close()}catch(e){}},__proto._onOpen=function(e){this._connected=!0,this.event("open",e)},__proto._onMessage=function(msg){var pre;msg&&msg.data&&(msg=msg.data,this.disableInput&&msg||(0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0),pre=this._input.pos,this._addInputPosition||(this._addInputPosition=0),this._input.pos=this._addInputPosition,msg&&("string"==typeof msg?this._input.writeUTFBytes(msg):this._input.writeArrayBuffer(msg),this._addInputPosition=this._input.pos,this._input.pos=pre)),this.event("message",msg))},__proto._onClose=function(e){this._connected=!1,this.event("close",e)},__proto._onError=function(e){this.event("error",e)},__proto.send=function(data){this._socket.send(data)},__proto.flush=function(){if(this._output&&0<this._output.length){var evt;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(e){evt=e}this._output.endian=this.endian,this._output.clear(),evt&&this.event("error",evt)}},__getset(0,__proto,"input",function(){return this._input}),__getset(0,__proto,"output",function(){return this._output}),__getset(0,__proto,"connected",function(){return this._connected}),__getset(0,__proto,"endian",function(){return this._endian},function(value){this._endian=value,null!=this._input&&(this._input.endian=value),null!=this._output&&(this._output.endian=value)}),Socket.LITTLE_ENDIAN="littleEndian",Socket.BIG_ENDIAN="bigEndian"}(),function(){function Resource(){Resource.__super.call(this),this._$1__id=++Resource._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(Resource._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,ResourceManager.currentResourceManager&&ResourceManager.currentResourceManager.addResource(this)}__class(Resource,"laya.resource.Resource",EventDispatcher);var __proto=Resource.prototype;return Laya.imps(__proto,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),__proto._setUrl=function(url){var resList;this._url!==url&&(this._url&&((resList=Resource._urlResourcesMap[this._url]).splice(resList.indexOf(this),1),0===resList.length)&&delete Resource._urlResourcesMap[this._url],url&&((resList=Resource._urlResourcesMap[url])||(Resource._urlResourcesMap[url]=resList=[]),resList.push(this)),this._url=url)},__proto._getGroup=function(){return this._group},__proto._setGroup=function(value){var groupList;this._group!==value&&(this._group&&((groupList=Resource._groupResourcesMap[this._group]).splice(groupList.indexOf(this),1),0===groupList.length)&&delete Resource._groupResourcesMap[this._group],value&&((groupList=Resource._groupResourcesMap[value])||(Resource._groupResourcesMap[value]=groupList=[]),groupList.push(this)),this._group=value)},__proto._addReference=function(){this._referenceCount++},__proto._removeReference=function(){this._referenceCount--},__proto._clearReference=function(){this._referenceCount=0},__proto._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},__proto.recreateResource=function(){this.completeCreate()},__proto.disposeResource=function(){},__proto.activeResource=function(force){void 0===force&&(force=!1),this._lastUseFrameCount=Stat.loopCount,!this._destroyed&&this.__loaded&&(this._released||force)&&this.recreateResource()},__proto.releaseResource=function(force){return!(!(force=void 0===force||force)&&this.lock||this._released&&!force||(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),0))},__proto.onAsynLoaded=function(url,data,params){throw new Error("Resource: must override this function!")},__proto.destroy=function(){var resList;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete Resource._idResourcesMap[this.id],this._url&&((resList=Resource._urlResourcesMap[this._url])&&(resList.splice(resList.indexOf(this),1),0===resList.length)&&delete Resource._urlResourcesMap[this.url],Loader.clearRes(this._url),this.__loaded||RunDriver.cancelLoadByUrl(this._url)),this._group&&((resList=Resource._groupResourcesMap[this._group]).splice(resList.indexOf(this),1),0===resList.length)&&delete Resource._groupResourcesMap[this.url])},__proto.completeCreate=function(){this._released=!1,this.event("recovered",this)},__proto.dispose=function(){this.destroy()},__getset(0,__proto,"memorySize",function(){return this._memorySize},function(value){var offsetValue=value-this._memorySize;this._memorySize=value,this.resourceManager&&this.resourceManager.addSize(offsetValue)}),__getset(0,__proto,"_loaded",null,function(value){this.__loaded=value}),__getset(0,__proto,"loaded",function(){return this.__loaded}),__getset(0,__proto,"id",function(){return this._$1__id}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),__getset(0,__proto,"group",function(){return this._getGroup()},function(value){this._setGroup(value)}),__getset(0,__proto,"resourceManager",function(){return this._resourceManager}),__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"released",function(){return this._released}),__getset(0,__proto,"referenceCount",function(){return this._referenceCount}),Resource.getResourceByID=function(id){return Resource._idResourcesMap[id]},Resource.getResourceByURL=function(url,index){return void 0===index&&(index=0),null==Resource._urlResourcesMap[url]?null:Resource._urlResourcesMap[url][index]},Resource.getResourceCountByURL=function(url){return Resource._urlResourcesMap[url].length},Resource.destroyUnusedResources=function(group){var res;if(group){group=Resource._groupResourcesMap[group];if(group)for(var tempResouList=group.slice(),i=0,n=tempResouList.length;i<n;i++)(res=tempResouList[i]).lock||0!==res._referenceCount||res.destroy()}else for(var k in Resource._idResourcesMap)(res=Resource._idResourcesMap[k]).lock||0!==res._referenceCount||res.destroy()},Resource._uniqueIDCounter=0,Resource._idResourcesMap={},Resource._urlResourcesMap={},Resource._groupResourcesMap={},Resource}()),Texture=function(){function Texture(bitmap,uv){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,Texture.__super.call(this),bitmap&&null!=bitmap._addReference&&bitmap._addReference(),this.setTo(bitmap,uv)}__class(Texture,"laya.resource.Texture",EventDispatcher);var __proto=Texture.prototype;return __proto._setUrl=function(url){this.url=url},__proto.setTo=function(bitmap,uv){var _this,canvas;bitmap instanceof window.HTMLElement?(canvas=HTMLCanvas.create("2D",bitmap),this.bitmap=canvas):this.bitmap=bitmap,this.uv=uv||Texture.DEF_UV,bitmap&&(this._w=bitmap.width,this._h=bitmap.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w,(_this=this)._loaded?RunDriver.addToAtlas&&RunDriver.addToAtlas(_this):(canvas=bitmap)instanceof laya.resource.HTMLImage&&canvas.image&&canvas.image.addEventListener("load",function(e){RunDriver.addToAtlas&&RunDriver.addToAtlas(_this)},!1))},__proto.active=function(){this.bitmap&&this.bitmap.activeResource()},__proto.destroy=function(forceDispose){var temp;void 0===forceDispose&&(forceDispose=!1),this.bitmap&&0<this.bitmap.referenceCount&&(temp=this.bitmap,forceDispose?(Render.isConchApp&&temp.source&&temp.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,temp.dispose(),temp._clearReference()):(temp._removeReference(),0==temp.referenceCount&&(Render.isConchApp&&temp.source&&temp.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,temp.dispose())),this.url&&this===Laya.loader.getRes(this.url)&&Laya.loader.clearRes(this.url,forceDispose),this._loaded=!1)},__proto.load=function(url){var _$this=this,fileBitmap=(this._loaded=!1,url=URL.customFormat(url),this.bitmap||(this.bitmap=HTMLImage.create(url))),_this=(fileBitmap&&fileBitmap._addReference(),this);fileBitmap.onload=function(){fileBitmap.onload=null,_this._loaded=!0,_$this.sourceWidth=_$this._w=fileBitmap.width,_$this.sourceHeight=_$this._h=fileBitmap.height,_this.event("loaded",this),RunDriver.addToAtlas&&RunDriver.addToAtlas(_this)}},__proto.addTextureToAtlas=function(e){RunDriver.addTextureToAtlas(this)},__proto.getPixels=function(x,y,width,height){var temp;return Render.isConchApp?(temp=this.bitmap).source&&temp.source.getImageData?(temp=temp.source.getImageData(x,y,width,height),temp=new Uint8Array(temp),Array.from(temp)):null:Render.isWebGL?RunDriver.getTexturePixels(this,x,y,width,height):(Browser.canvas.size(width,height),Browser.canvas.clear(),Browser.context.drawTexture(this,-x,-y,this.width,this.height,0,0),Browser.context.getImageData(0,0,width,height).data)},__proto.onAsynLoaded=function(url,bitmap){bitmap&&bitmap._addReference(),this.setTo(bitmap,this.uv),this._loaded&&this.event("loaded",this)},__getset(0,__proto,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),__getset(0,__proto,"loaded",function(){return this._loaded}),__getset(0,__proto,"released",function(){return!this.bitmap||this.bitmap.released}),__getset(0,__proto,"width",function(){return this._w||(this.uv&&this.uv!==Texture.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width)},function(value){this._w=value,this.sourceWidth||(this.sourceWidth=value)}),__getset(0,__proto,"repeat",function(){return!Render.isWebGL||!this.bitmap||this.bitmap.repeat},function(value){value&&Render.isWebGL&&this.bitmap&&(this.bitmap.repeat=value)&&(this.bitmap.enableMerageInAtlas=!1)}),__getset(0,__proto,"height",function(){return this._h||(this.uv&&this.uv!==Texture.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height)},function(value){this._h=value,this.sourceHeight||(this.sourceHeight=value)}),__getset(0,__proto,"isLinearSampling",function(){return!Render.isWebGL||9728!=this.bitmap.minFifter},function(value){value||!Render.isWebGL||value||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1)}),Texture.moveUV=function(offsetX,offsetY,uv){for(var i=0;i<8;i+=2)uv[i]+=offsetX,uv[i+1]+=offsetY;return uv},Texture.create=function(source,x,y,width,height,offsetX,offsetY,sourceWidth,sourceHeight){void 0===offsetX&&(offsetX=0),void 0===offsetY&&(offsetY=0),void 0===sourceWidth&&(sourceWidth=0),void 0===sourceHeight&&(sourceHeight=0);var btex=source instanceof laya.resource.Texture,uv=btex?source.uv:Texture.DEF_UV,btex=btex?source.bitmap:source,bIsAtlas=RunDriver.isAtlas(btex);if(bIsAtlas){var atlaser=btex._atlaser,source=source._atlasID;if(-1==source)throw new Error("create texture error");btex=atlaser._inAtlasTextureBitmapValue[source],uv=atlaser._inAtlasTextureOriUVValue[source]}var atlaser=new Texture(btex,null),source=(btex.width&&x+width>btex.width&&(width=btex.width-x),btex.height&&y+height>btex.height&&(height=btex.height-y),atlaser.width=width,atlaser.height=height,atlaser.offsetX=offsetX,atlaser.offsetY=offsetY,atlaser.sourceWidth=sourceWidth||width,atlaser.sourceHeight=sourceHeight||height,1/btex.width),offsetX=1/btex.height,offsetY=atlaser.uv[0],sourceWidth=atlaser.uv[1],sourceHeight=atlaser.uv[4],v2=atlaser.uv[5],inAltasUVWidth=sourceHeight-offsetY,inAltasUVHeight=v2-sourceWidth,uv=Texture.moveUV(uv[0],uv[1],[x*=source,y*=offsetX,x+(width*=source),y,x+width,y+(height*=offsetX),x,y+height]),source=(atlaser.uv=[offsetY+uv[0]*inAltasUVWidth,sourceWidth+uv[1]*inAltasUVHeight,sourceHeight-(1-uv[2])*inAltasUVWidth,sourceWidth+uv[3]*inAltasUVHeight,sourceHeight-(1-uv[4])*inAltasUVWidth,v2-(1-uv[5])*inAltasUVHeight,offsetY+uv[6]*inAltasUVWidth,v2-(1-uv[7])*inAltasUVHeight],bIsAtlas&&atlaser.addTextureToAtlas(),btex.scaleRate);return source&&1!=source?(atlaser.sourceWidth/=source,atlaser.sourceHeight/=source,atlaser.width/=source,atlaser.height/=source,atlaser.scaleRate=source,atlaser.offsetX/=source,atlaser.offsetY/=source):atlaser.scaleRate=1,atlaser},Texture.createFromTexture=function(texture,x,y,width,height){var texScaleRate=texture.scaleRate,texScaleRate=(1!=texScaleRate&&(x*=texScaleRate,y*=texScaleRate,width*=texScaleRate,height*=texScaleRate),Rectangle.TEMP.setTo(x-texture.offsetX,y-texture.offsetY,width,height)),x=texScaleRate.intersection(Texture._rect1.setTo(0,0,texture.width,texture.height),Texture._rect2);return x?((y=Texture.create(texture,x.x,x.y,x.width,x.height,x.x-texScaleRate.x,x.y-texScaleRate.y,width,height)).bitmap._removeReference(),y):null},Texture.DEF_UV=[0,0,1,0,1,1,0,1],Texture.INV_UV=[0,1,1,1,1,0,0,0],Texture._rect1=new Rectangle,Texture._rect2=new Rectangle,Texture}(),TimeLine=function(){var tweenData;function TimeLine(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,TimeLine.__super.call(this)}__class(TimeLine,"laya.utils.TimeLine",EventDispatcher);var __proto=TimeLine.prototype;return __proto.to=function(target,props,duration,ease,offset){return this._create(target,props,duration,ease,offset=void 0===offset?0:offset,!0)},__proto.from=function(target,props,duration,ease,offset){return this._create(target,props,duration,ease,offset=void 0===offset?0:offset,!1)},__proto._create=function(target,props,duration,ease,offset,isTo){var tTweenData=Pool.getItemByClass("tweenData",tweenData);return tTweenData.isTo=isTo,tTweenData.type=0,tTweenData.target=target,tTweenData.duration=duration,tTweenData.data=props,tTweenData.startTime=this._startTime+offset,tTweenData.endTime=tTweenData.startTime+tTweenData.duration,tTweenData.ease=ease,this._startTime=Math.max(tTweenData.endTime,this._startTime),this._tweenDataList.push(tTweenData),this._startTimeSort=!0,this._endTimeSort=!0,this},__proto.addLabel=function(label,offset){var tTweenData=Pool.getItemByClass("tweenData",tweenData);return tTweenData.type=1,tTweenData.data=label,tTweenData.endTime=tTweenData.startTime=this._startTime+offset,this._labelDic||(this._labelDic={}),this._labelDic[label]=tTweenData,this._tweenDataList.push(tTweenData),this},__proto.removeLabel=function(label){var tTweenData;this._labelDic&&this._labelDic[label]&&((tTweenData=this._labelDic[label])&&-1<(tTweenData=this._tweenDataList.indexOf(tTweenData))&&this._tweenDataList.splice(tTweenData,1),delete this._labelDic[label])},__proto.gotoTime=function(time){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var tTween,tObject,p,tTweenDataCopyList,tTweenData;for(p in this._firstTweenDic)if(tObject=this._firstTweenDic[p])for(var tDataP in tObject)tObject.diyTarget.hasOwnProperty(tDataP)&&(tObject.diyTarget[tDataP]=tObject[tDataP]);for(p in this._tweenDic)(tTween=this._tweenDic[p]).clear(),delete this._tweenDic[p];this._index=0,this._gidIndex=0,this._currTime=time,this._lastTime=Browser.now(),null==this._endTweenDataList||this._endTimeSort?(this._endTimeSort=!1,this._endTweenDataList=tTweenDataCopyList=this._tweenDataList.concat(),tTweenDataCopyList.sort(function(paraA,paraB){return paraA.endTime>paraB.endTime?1:paraA.endTime<paraB.endTime?-1:0})):tTweenDataCopyList=this._endTweenDataList;for(var i=0,n=tTweenDataCopyList.length;i<n;i++)if(0==(tTweenData=tTweenDataCopyList[i]).type){if(!(time>=tTweenData.endTime))break;this._index=Math.max(this._index,i+1);var props=tTweenData.data;if(tTweenData.isTo)for(var tP in props)tTweenData.target[tP]=props[tP]}for(i=0,n=this._tweenDataList.length;i<n;i++)0==(tTweenData=this._tweenDataList[i]).type&&time>=tTweenData.startTime&&time<tTweenData.endTime&&(this._index=Math.max(this._index,i+1),this._gidIndex++,(tTween=Pool.getItemByClass("tween",Tween))._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,tTweenData.isTo,!0,!1),tTween.setStartTime(this._currTime-(time-tTweenData.startTime)),tTween._updateEase(this._currTime),tTween.gid=this._gidIndex,this._tweenDic[this._gidIndex]=tTween)}},__proto.gotoLabel=function(Label){null!=this._labelDic&&(Label=this._labelDic[Label])&&this.gotoTime(Label.startTime)},__proto.pause=function(){Laya.timer.clear(this,this._update)},__proto.resume=function(){this.play(this._currTime,this._loopKey)},__proto.play=function(timeOrLabel,loop){if(void 0===timeOrLabel&&(timeOrLabel=0),void 0===loop&&(loop=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(paraA,paraB){return paraA.startTime>paraB.startTime?1:paraA.startTime<paraB.startTime?-1:0});for(var i=0,n=this._tweenDataList.length;i<n;i++){var tTweenData=this._tweenDataList[i];if(null!=tTweenData&&0==tTweenData.type){var p,tTarget=tTweenData.target,gid=tTarget.$_GID||(tTarget.$_GID=Utils.getGID()),tSrcData=null;for(p in null==this._firstTweenDic[gid]?((tSrcData={}).diyTarget=tTarget,this._firstTweenDic[gid]=tSrcData):tSrcData=this._firstTweenDic[gid],tTweenData.data)null==tSrcData[p]&&(tSrcData[p]=tTarget[p])}}}"string"==typeof timeOrLabel?this.gotoLabel(timeOrLabel):this.gotoTime(timeOrLabel),this._loopKey=loop,this._lastTime=Browser.now(),Laya.timer.frameLoop(1,this,this._update)}},__proto._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var p in this._tweenDic)(tTween=this._tweenDic[p]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var tTween,tNow=Browser.now(),tFrameTime=tNow-this._lastTime,tCurrTime=this._currTime+=tFrameTime*this.scale;for(p in this._lastTime=tNow,this._tweenDic)(tTween=this._tweenDic[p])._updateEase(tCurrTime);0!=this._tweenDataList.length&&this._index<this._tweenDataList.length&&tCurrTime>=(tFrameTime=this._tweenDataList[this._index]).startTime&&(this._index++,0==tFrameTime.type?(this._gidIndex++,(tTween=Pool.getItemByClass("tween",Tween))._create(tFrameTime.target,tFrameTime.data,tFrameTime.duration,tFrameTime.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,tFrameTime.isTo,!0,!1),tTween.setStartTime(tCurrTime),tTween.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=tTween)._updateEase(tCurrTime)):this.event("label",tFrameTime.data))},__proto._animComplete=function(index){this._tweenDic[index]&&delete this._tweenDic[index]},__proto._complete=function(){this.event("complete")},__proto.reset=function(){if(this._labelDic)for(var p in this._labelDic)delete this._labelDic[p];for(p in this._tweenDic)this._tweenDic[p].clear(),delete this._tweenDic[p];for(p in this._firstTweenDic)delete this._firstTweenDic[p];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length)for(var i=0,len=this._tweenDataList.length,i=0;i<len;i++)this._tweenDataList[i]&&this._tweenDataList[i].destroy();this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,Laya.timer.clear(this,this._update)},__proto.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},__getset(0,__proto,"index",function(){return this._frameIndex},function(value){this._frameIndex=value,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),__getset(0,__proto,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),TimeLine.to=function(target,props,duration,ease,offset){return void 0===offset&&(offset=0),(new TimeLine).to(target,props,duration,ease,offset)},TimeLine.from=function(target,props,duration,ease,offset){return void 0===offset&&(offset=0),(new TimeLine).from(target,props,duration,ease,offset)},TimeLine.__init$=function(){tweenData=function(){function tweenData(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return __class(tweenData,""),tweenData.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,Pool.recover("tweenData",this)},tweenData}()},TimeLine}(),Sprite=function(_super){function Sprite(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,Sprite.__super.call(this),this._style=Style.EMPTY}__class(Sprite,"laya.display.Sprite",_super);var __proto=Sprite.prototype;return Laya.imps(__proto,{"laya.display.ILayout":!0}),__proto.createConchModel=function(){return new ConchNode},__proto.destroy=function(destroyChild){var mask;void 0===destroyChild&&(destroyChild=!0),this._releaseMem(),!this._destroyed&&(this.filters=null,mask=this.mask)&&(this.mask=null,mask.destroy(destroyChild)),_super.prototype.destroy.call(this,destroyChild),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},__proto.updateZOrder=function(){Utils.updateOrder(this._childs)&&this.repaint()},__proto.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},__proto.setBounds=function(bound){this._set$P("uBounds",bound)},__proto.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},__proto.getSelfBounds=function(){return this._$P.uBounds||(this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},__proto._boundPointsToParent=function(ifRotate){void 0===ifRotate&&(ifRotate=!1);var pX=0,pY=0,pList=(this._style&&(pX=this._style._tf.translateX,pY=this._style._tf.translateY,ifRotate=ifRotate||0!==this._style._tf.rotate,this._style.scrollRect)&&(pX+=this._style.scrollRect.x,pY+=this._style.scrollRect.y),this._getBoundPointsM(ifRotate));if(pList&&!(pList.length<1))if(8!=pList.length&&(pList=ifRotate?GrahamScan.scanPList(pList):Rectangle._getWrapRec(pList,Rectangle.TEMP)._getBoundPoints()),this.transform)for(var tPoint=Point.TEMP,i=0,len=pList.length,i=0;i<len;i+=2)tPoint.x=pList[i],tPoint.y=pList[i+1],this.toParentPoint(tPoint),pList[i]=tPoint.x,pList[i+1]=tPoint.y;else Utils.transPointList(pList,this._x-pX,this._y-pY);return pList},__proto.getGraphicBounds=function(realSize){return void 0===realSize&&(realSize=!1),this._graphics?this._graphics.getBounds(realSize):Rectangle.TEMP.setTo(0,0,0,0)},__proto._getBoundPointsM=function(ifRotate){if(void 0===ifRotate&&(ifRotate=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();var rst,rec;if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect)return rst=Utils.clearArray(this._$P.temBM),(rec=Rectangle.TEMP).copyFrom(this.scrollRect),Utils.concatArray(rst,rec._getBoundPoints()),rst;for(var child,pList=this._graphics?this._graphics.getBoundPoints():Utils.clearArray(this._$P.temBM),__childs=this._childs,i=0,n=__childs.length;i<n;i++)(child=__childs[i])instanceof laya.display.Sprite&&1==child.visible&&(child=child._boundPointsToParent(ifRotate))&&(pList=pList?Utils.concatArray(pList,child):child);return pList},__proto.getStyle=function(){return this._style===Style.EMPTY&&(this._style=new Style),this._style},__proto.setStyle=function(value){this._style=value},__proto._adjustTransform=function(){this._tfChanged=!1;var m,cx,cy,skx,tf=this._style._tf,sx=tf.scaleX,sy=tf.scaleY;return tf.rotate||1!==sx||1!==sy||tf.skewX||tf.skewY?((m=this._transform||(this._transform=Matrix.create())).bTransform=!0,skx=.0174532922222222*(tf.rotate-tf.skewX),tf=.0174532922222222*(tf.rotate+tf.skewY),cx=Math.cos(tf),tf=Math.sin(tf),cy=Math.sin(skx),skx=Math.cos(skx),m.a=sx*cx,m.b=sx*tf,m.c=-sy*cy,m.d=sy*skx,m.tx=m.ty=0):(this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5),m},__proto.pos=function(x,y,speedMode){if(void 0===speedMode&&(speedMode=!1),this._x!==x||this._y!==y){if(this.destroyed)return this;speedMode?(this._x=x,this._y=y,this.conchModel&&this.conchModel.pos(this._x,this._y),(speedMode=this._parent)&&0===speedMode._repaint&&(speedMode._repaint=1,speedMode.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())):(this.x=x,this.y=y)}return this},__proto.pivot=function(x,y){return this.pivotX=x,this.pivotY=y,this},__proto.size=function(width,height){return this.width=width,this.height=height,this},__proto.scale=function(scaleX,scaleY,speedMode){void 0===speedMode&&(speedMode=!1);var style=this.getStyle(),_tf=style._tf;if(_tf.scaleX!=scaleX||_tf.scaleY!=scaleY){if(this.destroyed)return this;speedMode?(style.setScale(scaleX,scaleY),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(scaleX,scaleY),this._renderType|=4,(_tf=this._parent)&&0===_tf._repaint&&(_tf._repaint=1,_tf.parentRepaint())):(this.scaleX=scaleX,this.scaleY=scaleY)}return this},__proto.skew=function(skewX,skewY){return this.skewX=skewX,this.skewY=skewY,this},__proto.render=function(context,x,y){Stat.spriteCount++,RenderSprite.renders[this._renderType]._fun(this,context,x+this._x,y+this._y),this._repaint=0},__proto.drawToCanvas=function(canvasWidth,canvasHeight,offsetX,offsetY){var canvas;return Render.isConchNode?(canvas=HTMLCanvas.create("2D"),new RenderContext(canvasWidth,canvasHeight,canvas).ctx.setCanvasType(1),this.conchModel.drawToCanvas(canvas.source,offsetX,offsetY),canvas):RunDriver.drawToCanvas(this,this._renderType,canvasWidth,canvasHeight,offsetX,offsetY)},__proto.customRender=function(context,x,y){this._renderType|=1024},__proto._applyFilters=function(){if(!Render.isWebGL){var _filters=this._$P.filters;if(_filters&&!(_filters.length<1))for(var i=0,n=_filters.length;i<n;i++)_filters[i].action.apply(this._$P.cacheCanvas)}},__proto._isHaveGlowFilter=function(){var len,i=0;if(this.filters)for(i=0;i<this.filters.length;i++)if(8==this.filters[i].type)return!0;for(i=0,len=this._childs.length;i<len;i++)if(this._childs[i]._isHaveGlowFilter())return!0;return!1},__proto.localToGlobal=function(point,createNewPoint){!0===(createNewPoint=void 0===createNewPoint?!1:createNewPoint)&&(point=new Point(point.x,point.y));for(var ele=this;ele&&ele!=Laya.stage;)point=ele.toParentPoint(point),ele=ele.parent;return point},__proto.globalToLocal=function(point,createNewPoint){(createNewPoint=void 0===createNewPoint?!1:createNewPoint)&&(point=new Point(point.x,point.y));for(var ele=this,list=[];ele&&ele!=Laya.stage;)list.push(ele),ele=ele.parent;for(var i=list.length-1;0<=i;)point=(ele=list[i]).fromParentPoint(point),i--;return point},__proto.toParentPoint=function(point){var scroll;return point&&(point.x-=this.pivotX,point.y-=this.pivotY,this.transform&&this._transform.transformPoint(point),point.x+=this._x,point.y+=this._y,scroll=this._style.scrollRect)&&(point.x-=scroll.x,point.y-=scroll.y),point},__proto.fromParentPoint=function(point){var scroll;return point&&(point.x-=this._x,point.y-=this._y,(scroll=this._style.scrollRect)&&(point.x+=scroll.x,point.y+=scroll.y),this.transform&&this._transform.invertTransformPoint(point),point.x+=this.pivotX,point.y+=this.pivotY),point},__proto.on=function(type,caller,listener,args){return 1!==this._mouseEnableState&&this.isMouseEvent(type)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(type,caller,listener,args,!1)):_super.prototype.on.call(this,type,caller,listener,args)},__proto.once=function(type,caller,listener,args){return 1!==this._mouseEnableState&&this.isMouseEvent(type)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(type,caller,listener,args,!0)):_super.prototype.once.call(this,type,caller,listener,args)},__proto._$2__onDisplay=function(){if(1!==this._mouseEnableState)for(var ele=(ele=this).parent;ele&&1!==ele._mouseEnableState&&!ele._getBit(2);)ele.mouseEnabled=!0,ele._setBit(2,!0),ele=ele.parent},__proto.loadImage=function(url,x,y,width,height,complete){var _$this=this;return void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),this.graphics.loadImage(url,x,y,width,height,function(tex){_$this.destroyed||(_$this.size(x+(width||tex.width),y+(height||tex.height)),_$this.repaint(),complete&&complete.runWith(tex))}),this},__proto.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},__proto._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},__proto._childChanged=function(child){this._childs.length?this._renderType|=2048:this._renderType&=-2049,child&&this._get$P("hasZorder")&&Laya.timer.callLater(this,this.updateZOrder),this.repaint()},__proto.parentRepaint=function(){var p=this._parent;p&&0===p._repaint&&(p._repaint=1,p.parentRepaint())},__proto.startDrag=function(area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){void 0===hasInertia&&(hasInertia=!1),void 0===elasticDistance&&(elasticDistance=0),void 0===elasticBackTime&&(elasticBackTime=300),void 0===disableMouseEvent&&(disableMouseEvent=!1),void 0===ratio&&(ratio=.92),this._$P.dragging||this._set$P("dragging",new Dragging),this._$P.dragging.start(this,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio)},__proto.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},__proto._releaseMem=function(){var cc;this._$P&&((cc=this._$P.cacheCanvas)&&cc.ctx&&(Pool.recover("RenderContext",cc.ctx),cc.ctx.canvas.size(0,0),cc.ctx=null),(cc=this._$P._filterCache)&&(cc.destroy(),cc.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null)},__proto._setDisplay=function(value){value||this._releaseMem(),_super.prototype._setDisplay.call(this,value)},__proto.hitTestPoint=function(x,y){var point=this.globalToLocal(Point.TEMP.setTo(x,y));return x=point.x,y=point.y,(this._$P.hitArea||(0<this._width&&0<this._height?Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds())).contains(x,y)},__proto.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))},__proto._getWords=function(){return null},__proto._addChildsToLayout=function(out){var words=this._getWords();if(null==words&&0==this._childs.length)return!1;if(words)for(var i=0,n=words.length;i<n;i++)out.push(words[i]);for(var i=0,length=this._childs.length;i<length;++i){var o=this._childs[i];o._style._enableLayout()&&o._addToLayout(out)}return!0},__proto._addToLayout=function(out){this._style.absolute||(this._style.block?out.push(this):this._addChildsToLayout(out)&&(this.x=this.y=0))},__proto._isChar=function(){return!1},__proto._getCSSStyle=function(){return this._style.getCSSStyle()},__proto._setAttributes=function(name,value){switch(name){case"x":this.x=parseFloat(value);break;case"y":this.y=parseFloat(value);break;case"width":this.width=parseFloat(value);break;case"height":this.height=parseFloat(value);break;default:this[name]=value}},__proto._layoutLater=function(){this.parent&&this.parent._layoutLater()},__getset(0,__proto,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(b){this._optimizeScrollRect!=b&&(this._optimizeScrollRect=b,this.conchModel)&&this.conchModel.optimizeScrollRect(b)}),__getset(0,__proto,"customRenderEnable",null,function(b){b&&(this._renderType|=1024,Render.isConchNode)&&(Sprite.CustomList.push(this),(b=new HTMLCanvas("2d"))._setContext(new CanvasRenderingContext2D),this.customContext=new RenderContext(0,0,b),b.context.setCanvasType&&b.context.setCanvasType(2),this.conchModel.custom(b.context))}),__getset(0,__proto,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(value){this.cacheAs=!value||this._$P.hasFilter?"none":"normal"}),__getset(0,__proto,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(value){var cacheCanvas=this._$P.cacheCanvas;value!==(cacheCanvas?cacheCanvas.type:"none")&&("none"!==value?(this._getBit(1)||this._setUpNoticeType(1),(cacheCanvas=cacheCanvas||this._set$P("cacheCanvas",Pool.getItemByClass("cacheCanvas",Object))).type=value,cacheCanvas.reCache=!0,this._renderType|=16,"bitmap"==value&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1)):this._$P._mask||(this._$P.hasFilter?this._set$P("cacheForFilters",!0):(cacheCanvas&&((value=cacheCanvas)&&value.ctx&&(Pool.recover("RenderContext",value.ctx),value.ctx.canvas.size(0,0),value.ctx=null),Pool.recover("cacheCanvas",cacheCanvas)),this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0))),this.repaint())}),__getset(0,__proto,"zOrder",function(){return this._zOrder},function(value){this._zOrder!=value&&(this._zOrder=value,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(value),this._parent)&&(value&&this._parent._set$P("hasZorder",!0),Laya.timer.callLater(this._parent,this.updateZOrder))}),__getset(0,__proto,"rotation",function(){return this._style._tf.rotate},function(value){var style=this.getStyle();style._tf.rotate!==value&&(style.setRotate(value),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(value),this._renderType|=4,style=this._parent)&&0===style._repaint&&(style._repaint=1,style.parentRepaint())}),__getset(0,__proto,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(value){this._width!==value&&(this._width=value,this.conchModel&&this.conchModel.size(value,this._height),this.repaint())}),__getset(0,__proto,"x",function(){return this._x},function(value){this._x===value||this.destroyed||(this._x=value,this.conchModel&&this.conchModel.pos(value,this._y),(value=this._parent)&&0===value._repaint&&(value._repaint=1,value.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint()))}),__getset(0,__proto,"globalScaleY",function(){for(var scale=1,ele=this;ele&&ele!==Laya.stage;)scale*=ele.scaleY,ele=ele.parent;return scale}),__getset(0,__proto,"hitArea",function(){return this._$P.hitArea},function(value){this._set$P("hitArea",value)}),__getset(0,__proto,"staticCache",function(){return this._$P.staticCache},function(value){this._set$P("staticCache",value),value||this.reCache()}),__getset(0,__proto,"texture",function(){return this._texture},function(value){this._texture!=value&&(this._texture=value,this.graphics.cleanByTexture(value,0,0))}),__getset(0,__proto,"y",function(){return this._y},function(value){this._y===value||this.destroyed||(this._y=value,this.conchModel&&this.conchModel.pos(this._x,value),(value=this._parent)&&0===value._repaint&&(value._repaint=1,value.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint()))}),__getset(0,__proto,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(value){this._height!==value&&(this._height=value,this.conchModel&&this.conchModel.size(this._width,value),this.repaint())}),__getset(0,__proto,"blendMode",function(){return this._style.blendMode},function(value){this.getStyle().blendMode=value,this.conchModel&&this.conchModel.blendMode(value),value&&"source-over"!=value?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),__getset(0,__proto,"scaleX",function(){return this._style._tf.scaleX},function(value){var style=this.getStyle();style._tf.scaleX!==value&&(style.setScaleX(value),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(value,style._tf.scaleY),this._renderType|=4,value=this._parent)&&0===value._repaint&&(value._repaint=1,value.parentRepaint())}),__getset(0,__proto,"scaleY",function(){return this._style._tf.scaleY},function(value){var style=this.getStyle();style._tf.scaleY!==value&&(style.setScaleY(value),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(style._tf.scaleX,value),this._renderType|=4,style=this._parent)&&0===style._repaint&&(style._repaint=1,style.parentRepaint())}),__getset(0,__proto,"stage",function(){return Laya.stage}),__getset(0,__proto,"skewX",function(){return this._style._tf.skewX},function(value){var style=this.getStyle();style._tf.skewX!==value&&(style.setSkewX(value),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(value,style._tf.skewY),this._renderType|=4,value=this._parent)&&0===value._repaint&&(value._repaint=1,value.parentRepaint())}),__getset(0,__proto,"scrollRect",function(){return this._style.scrollRect},function(value){this.getStyle().scrollRect=value,this.repaint(),value?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(value.x,value.y,value.width,value.height)):(this._renderType&=-129,this.conchModel&&(Sprite.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),__getset(0,__proto,"skewY",function(){return this._style._tf.skewY},function(value){var style=this.getStyle();style._tf.skewY!==value&&(style.setSkewY(value),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(style._tf.skewX,value),this._renderType|=4,style=this._parent)&&0===style._repaint&&(style._repaint=1,style.parentRepaint())}),__getset(0,__proto,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(value){this._tfChanged=!1,(this._transform=value)&&(this._x=value.tx,this._y=value.ty,value.tx=value.ty=0,this.conchModel)&&this.conchModel.transform(value.a,value.b,value.c,value.d,this._x,this._y),value?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),__getset(0,__proto,"pivotX",function(){return this._style._tf.translateX},function(value){this.getStyle().setTranslateX(value),this.conchModel&&this.conchModel.pivot(value,this._style._tf.translateY),this.repaint()}),__getset(0,__proto,"pivotY",function(){return this._style._tf.translateY},function(value){this.getStyle().setTranslateY(value),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,value),this.repaint()}),__getset(0,__proto,"alpha",function(){return this._style.alpha},function(value){this._style&&this._style.alpha!==value&&(value=value<0?0:1<value?1:value,this.getStyle().alpha=value,this.conchModel&&this.conchModel.alpha(value),1!==value?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),__getset(0,__proto,"visible",function(){return this._style.visible},function(value){this._style&&this._style.visible!==value&&(this.getStyle().visible=value,this.conchModel&&this.conchModel.visible(value),this.parentRepaint())}),__getset(0,__proto,"graphics",function(){return this._graphics||(this.graphics=RunDriver.createGraphics())},function(value){this._graphics&&(this._graphics._sp=null),(this._graphics=value)?(this._renderType&=-2,this._renderType|=512,(value._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(Sprite.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),__getset(0,__proto,"filters",function(){return this._$P.filters},function(value){value&&0===value.length&&(value=null),this._$P.filters!=value&&(this._set$P("filters",value?value.slice():null),Render.isConchApp&&(this.conchModel&&(Sprite.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters)&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this),Render.isWebGL&&(value&&value.length?this._renderType|=32:this._renderType&=-33),value&&0<value.length?(this._getBit(1)||this._setUpNoticeType(1),Render.isWebGL&&1==value.length&&value[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(Render.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),__getset(0,__proto,"parent",_super.prototype._$get_parent,function(value){Laya.superSet(Node,this,"parent",value),value&&this._getBit(2)&&this._$2__onDisplay()}),__getset(0,__proto,"mask",function(){return this._$P._mask},function(value){value&&this.mask&&this.mask._$P.maskParent||(value?(this.cacheAs="bitmap",this._set$P("_mask",value),value._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",value),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(value?value.conchModel:null),this._renderType|=64,this.parentRepaint())}),__getset(0,__proto,"mouseEnabled",function(){return 1<this._mouseEnableState},function(value){this._mouseEnableState=value?2:1}),__getset(0,__proto,"globalScaleX",function(){for(var scale=1,ele=this;ele&&ele!==Laya.stage;)scale*=ele.scaleX,ele=ele.parent;return scale}),__getset(0,__proto,"mouseX",function(){return this.getMousePoint().x}),__getset(0,__proto,"mouseY",function(){return this.getMousePoint().y}),Sprite.fromImage=function(url){return(new Sprite).loadImage(url)},Sprite._cachePool=[],Sprite.CustomList=[],__static(Sprite,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=window.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),Sprite}(Node),AudioSoundChannel=function(){function AudioSoundChannel(audio){this._audio=null,this._onEnd=null,this._resumePlay=null,AudioSoundChannel.__super.call(this),this._onEnd=Utils.bind(this.__onEnd,this),this._resumePlay=Utils.bind(this.__resumePlay,this),audio.addEventListener("ended",this._onEnd),this._audio=audio}__class(AudioSoundChannel,"laya.media.h5audio.AudioSoundChannel",SoundChannel);var __proto=AudioSoundChannel.prototype;return __proto.__onEnd=function(){1==this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),this.event("complete")):(0<this.loops&&this.loops--,this.startTime=0,this.play())},__proto.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,Browser.container.appendChild(this._audio),this._audio.play()}catch(e){this.event("error")}},__proto.play=function(){this.isStopped=!1;try{this._audio.playbackRate=SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(e){return void this._audio.addEventListener("canplay",this._resumePlay)}SoundManager.addChannel(this),Browser.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()},__proto.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&Render.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Browser.onIE||this._audio!=AudioSound._musicAudio&&Pool.recover("audio:"+this.url,this._audio),Browser.removeElement(this._audio),this._audio=null)},__proto.pause=function(){this.isStopped=!0,SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause()},__proto.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),"play"in this._audio)&&this._audio.play()},__getset(0,__proto,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,__proto,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,__proto,"volume",function(){return this._audio?this._audio.volume:1},function(v){this._audio&&(this._audio.volume=v)}),AudioSoundChannel}(),WebAudioSoundChannel=function(){function WebAudioSoundChannel(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=WebAudioSound.ctx,WebAudioSoundChannel.__super.call(this),this._onPlayEnd=Utils.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}__class(WebAudioSoundChannel,"laya.media.webaudio.WebAudioSoundChannel",SoundChannel);var __proto=WebAudioSoundChannel.prototype;return __proto.play=function(){var context,gain,bufferSource;SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer&&(context=this.context,gain=this.gain,bufferSource=context.createBufferSource(),(this.bufferSource=bufferSource).buffer=this.audioBuffer,bufferSource.connect(gain),gain&&gain.disconnect(),gain.connect(context.destination),bufferSource.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Browser.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(bufferSource.loop=!0),bufferSource.playbackRate.setTargetAtTime?bufferSource.playbackRate.setTargetAtTime(SoundManager.playbackRate,this.context.currentTime,.1):bufferSource.playbackRate.value=SoundManager.playbackRate,bufferSource.start(0,this.startTime),this._currentTime=0)},__proto.__onPlayEnd=function(){1==this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),this.event("complete")):(0<this.loops&&this.loops--,this.startTime=0,this.play())},__proto._clearBufferSource=function(){var sourceNode;this.bufferSource&&((sourceNode=this.bufferSource).stop?sourceNode.stop(0):sourceNode.noteOff(0),sourceNode.disconnect(0),sourceNode.onended=null,WebAudioSoundChannel._tryCleanFailed||this._tryClearBuffer(sourceNode),this.bufferSource=null)},__proto._tryClearBuffer=function(sourceNode){try{sourceNode.buffer=null}catch(e){WebAudioSoundChannel._tryCleanFailed=!0}},__proto.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null},__proto.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this)},__proto.resume=function(){this.startTime=this._pauseTime,this.play()},__getset(0,__proto,"position",function(){return this.bufferSource?(Browser.now()-this._startTime)/1e3+this.startTime:0}),__getset(0,__proto,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),__getset(0,__proto,"volume",function(){return this._volume},function(v){this.isStopped||(this._volume=v,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(v,this.context.currentTime,.1):this.gain.gain.value=v)}),WebAudioSoundChannel._tryCleanFailed=!1,WebAudioSoundChannel}(),Bitmap=function(){function Bitmap(){Bitmap.__super.call(this),this._w=0,this._h=0}__class(Bitmap,"laya.resource.Bitmap",Resource);var __proto=Bitmap.prototype;return __getset(0,__proto,"width",function(){return this._w}),__getset(0,__proto,"height",function(){return this._h}),__getset(0,__proto,"source",function(){return this._source}),Bitmap}(),AnimationPlayerBase=function(_super){function AnimationPlayerBase(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,AnimationPlayerBase.__super.call(this),this._interval=Config.animationInterval,this._setUpNoticeType(1)}__class(AnimationPlayerBase,"laya.display.AnimationPlayerBase",_super);var __proto=AnimationPlayerBase.prototype;return __proto.play=function(start,loop,name,showWarn){void 0===start&&(start=0),void 0===loop&&(loop=!0),void 0===name&&(name=""),void 0===showWarn&&(showWarn=!0),this._isPlaying=!0,this.index="string"==typeof start?this._getFrameByLabel(start):start,this.loop=loop,this._actionName=name,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},__proto._getFrameByLabel=function(label){for(var i=0,i=0;i<this._count;i++)if(this._labels[i]&&0<=this._labels[i].indexOf(label))return i;return 0},__proto._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},__proto._setControlNode=function(node){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=node)&&node!=this&&(node.on("display",this,this._checkResumePlaying),node.on("undisplay",this,this._checkResumePlaying))},__proto._setDisplay=function(value){_super.prototype._setDisplay.call(this,value),this._checkResumePlaying()},__proto._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},__proto.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},__proto.addLabel=function(label,index){this._labels||(this._labels={}),this._labels[index]||(this._labels[index]=[]),this._labels[index].push(label)},__proto.removeLabel=function(label){if(label){if(this._labels)for(var name in this._labels)this._removeLabelFromLabelList(this._labels[name],label)}else this._labels=null},__proto._removeLabelFromLabelList=function(list,label){if(list)for(var i=list.length-1;0<=i;i--)list[i]==label&&list.splice(i,1)},__proto.gotoAndStop=function(position){this.index="string"==typeof position?this._getFrameByLabel(position):position,this.stop()},__proto._displayToIndex=function(value){},__proto.clear=function(){this.stop(),this._labels=null},__getset(0,__proto,"interval",function(){return this._interval},function(value){this._interval!=value&&(this._frameRateChanged=!0,this._interval=value,this._isPlaying)&&0<value&&this.timerLoop(value,this,this._frameLoop,null,!0,!0)}),__getset(0,__proto,"isPlaying",function(){return this._isPlaying}),__getset(0,__proto,"index",function(){return this._index},function(value){if(this._index=value,this._displayToIndex(value),this._labels&&this._labels[value])for(var tArr=this._labels[value],i=0,len=tArr.length;i<len;i++)this.event("label",tArr[i])}),__getset(0,__proto,"count",function(){return this._count}),AnimationPlayerBase.WRAP_POSITIVE=0,AnimationPlayerBase.WRAP_REVERSE=1,AnimationPlayerBase.WRAP_PINGPONG=2,AnimationPlayerBase}(Sprite),Text=function(_super){function Text(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,Text.__super.call(this),this.overflow=Text.VISIBLE,this._style=new CSSStyle(this),this._style.wordWrap=!1}__class(Text,"laya.display.Text",_super);var __proto=Text.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._lines=null,this._words&&(this._words.length=0,this._words=null)},__proto._getBoundPointsM=function(ifRotate){void 0===ifRotate&&(ifRotate=!1);ifRotate=Rectangle.TEMP;return ifRotate.setTo(0,0,this.width,this.height),ifRotate._getBoundPoints()},__proto.getGraphicBounds=function(realSize){void 0===realSize&&(realSize=!1);realSize=Rectangle.TEMP;return realSize.setTo(0,0,this.width,this.height),realSize},__proto._getCSSStyle=function(){return this._style},__proto.lang=function(text,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10){if(text=Text.langPacks&&Text.langPacks[text]?Text.langPacks[text]:text,!(arguments.length<2))for(var i=0,n=arguments.length;i<n;i++)text=text.replace("{"+i+"}",arguments[i+1]);this._text=text},__proto._isPassWordMode=function(){var password=this._style.password;return password="prompt"in this&&this.prompt==this._text?!1:password},__proto._getPassWordTxt=function(txt){for(var word="",j=txt.length;0<j;j--)word+="●";return word},__proto.renderText=function(begin,visibleLineCount){for(var bitmapScale,tClipHeight,y,tempVAlign,graphics=this.graphics,ctxFont=(graphics.clear(!0),(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Browser.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font)),padding=(Browser.context.font=ctxFont,this.padding),startX=padding[3],textAlgin="left",lines=this._lines,lineHeight=this.leading+this._charSize.height,tCurrBitmapFont=this._currBitmapFont,startY=(tCurrBitmapFont&&(lineHeight=this.leading+tCurrBitmapFont.getMaxHeight()),padding[0]),style=(!tCurrBitmapFont&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(textAlgin="right",startX=this._width-padding[1]):"center"==this.align&&(textAlgin="center",startX=.5*this._width+padding[3]-padding[1])),0<this._height&&("middle"===(tempVAlign=this._textHeight>this._height?"top":this.valign)?startY=.5*(this._height-visibleLineCount*lineHeight)+padding[0]-padding[2]:"bottom"===tempVAlign&&(startY=this._height-visibleLineCount*lineHeight-padding[2])),this._style),password=(tCurrBitmapFont&&tCurrBitmapFont.autoScaleSize&&(bitmapScale=tCurrBitmapFont.fontSize/this.fontSize),this._clipPoint&&(graphics.save(),tCurrBitmapFont&&tCurrBitmapFont.autoScaleSize?(tClipHeight=tempVAlign=0,tempVAlign=this._width?this._width-padding[3]-padding[1]:this._textWidth,tClipHeight=this._height?this._height-padding[0]-padding[2]:this._textHeight,graphics.clipRect(padding[3],padding[0],tempVAlign*=bitmapScale,tClipHeight*=bitmapScale)):graphics.clipRect(padding[3],padding[0],this._width?this._width-padding[3]-padding[1]:this._textWidth,this._height?this._height-padding[0]-padding[2]:this._textHeight)),style.password),end=("prompt"in this&&this.prompt==this._text&&(password=!1),Math.min(this._lines.length,visibleLineCount+begin)||1),i=begin;i<end;i++){var _word,tWidth,word=lines[i];if(password)for(var len=word.length,word="",j=len;0<j;j--)word+="●";len=startX-(this._clipPoint?this._clipPoint.x:0),y=startY+lineHeight*i-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(textAlgin,len,y,i),tCurrBitmapFont?(tWidth=this.width,tCurrBitmapFont.autoScaleSize&&(tWidth=this.width*bitmapScale),tCurrBitmapFont.drawText(word,this,len,y,this.align,tWidth)):(Render.isWebGL?(this._words||(this._words=[]),(_word=this._words.length>i-begin?this._words[i-begin]:new WordText).setText(word)):_word=word,style.stroke?graphics.fillBorderText(_word,len,y,ctxFont,this.color,style.strokeColor,style.stroke,textAlgin):graphics.fillText(_word,len,y,ctxFont,this.color,textAlgin))}tCurrBitmapFont&&tCurrBitmapFont.autoScaleSize&&this.scale(tempVAlign=1/bitmapScale,tempVAlign),this._clipPoint&&graphics.restore(),this._startX=startX,this._startY=startY},__proto.drawUnderline=function(align,x,y,lineIndex){var lineWidth=this._lineWidths[lineIndex];switch(align){case"center":x-=lineWidth/2;break;case"right":x-=lineWidth}y+=this._charSize.height,this._graphics.drawLine(x,y,x+lineWidth,y,this.underlineColor||this.color,1)},__proto.typeset=function(){var lineCount,func;this._isChanged=!1,this._text?(Browser.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null,lineCount=this._lines.length,this.overflow!=Text.VISIBLE&&(func=this.overflow==Text.HIDDEN?Math.floor:Math.ceil,lineCount=Math.min(lineCount,func((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))),func=this.scrollY/(this._charSize.height+this.leading)|0,this.renderText(func,lineCount),this.repaint()):(this._clipPoint=null,this._textWidth=this._textHeight=0,this.graphics.clear(!0))},__proto.evalTextSize=function(){var nh=NaN,nw=Math.max.apply(this,this._lineWidths),nh=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2];nw==this._textWidth&&nh==this._textHeight||(this._textWidth=nw,this._textHeight=nh,this._width&&this._height)||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight)},__proto.checkEnabledViewportOrNot=function(){return this.overflow==Text.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},__proto.changeText=function(text){this._text!==text&&(this.lang(text+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},__proto.parseLines=function(text){for(var wordWrapWidth,measureResult,needWordWrapOrTruncate=this.wordWrap||this.overflow==Text.HIDDEN,lines=(needWordWrapOrTruncate&&(wordWrapWidth=this.getWordWrapWidth()),this._currBitmapFont?(this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight()):(measureResult=Browser.context.measureText(Text._testWord),Render.isConchApp&&0===measureResult.width&&0===measureResult.height&&(measureResult=Browser.context.measureText("W")),this._charSize.width=measureResult.width,this._charSize.height=measureResult.height||this.fontSize),text.replace(/\r\n/g,"\n").split("\n")),i=0,n=lines.length;i<n;i++){var line=lines[i];needWordWrapOrTruncate?this.parseLine(line,wordWrapWidth):(this._lineWidths.push(this.getTextWidth(line)),this._lines.push(line))}},__proto.parseLine=function(line,wordWrapWidth){Browser.context;var execResult,lines=this._lines,maybeIndex=0,wordWidth=NaN,startIndex=0;if((charsWidth=this.getTextWidth(line))<=wordWrapWidth)lines.push(line),this._lineWidths.push(charsWidth);else{charsWidth=this._charSize.width;for(var charsWidth,maybeIndex=Math.floor(wordWrapWidth/charsWidth),wordWidth=this.getTextWidth(line.substring(0,maybeIndex=0==maybeIndex?1:maybeIndex)),j=maybeIndex,m=line.length;j<m;j++)if(wordWrapWidth<(wordWidth+=charsWidth=this.getTextWidth(line.charAt(j))))if(this.wordWrap){var newLine=line.substring(startIndex,j);if(newLine.charCodeAt(newLine.length-1)<255?(execResult=/(?:\w|-)+$/.exec(newLine))&&(j=execResult.index+startIndex,0==execResult.index?j+=newLine.length:newLine=line.substring(startIndex,j)):Text.RightToLeft&&(execResult=/([\u0600-\u06FF])+$/.exec(newLine))&&(j=execResult.index+startIndex,0==execResult.index?j+=newLine.length:newLine=line.substring(startIndex,j)),lines.push(newLine),this._lineWidths.push(wordWidth-charsWidth),!((startIndex=j)+maybeIndex<m)){lines.push(line.substring(startIndex,m)),this._lineWidths.push(this.getTextWidth(lines[lines.length-1])),startIndex=-1;break}j+=maybeIndex,wordWidth=this.getTextWidth(line.substring(startIndex,j)),j--}else if(this.overflow==Text.HIDDEN)return lines.push(line.substring(0,j)),void this._lineWidths.push(this.getTextWidth(lines[lines.length-1]));this.wordWrap&&-1!=startIndex&&(lines.push(line.substring(startIndex,m)),this._lineWidths.push(this.getTextWidth(lines[lines.length-1])))}},__proto.getTextWidth=function(text){return this._currBitmapFont?this._currBitmapFont.getTextWidth(text):Browser.context.measureText(text).width},__proto.getWordWrapWidth=function(){var p=this.padding,w=NaN;return(w=(w=(w=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0?this.wordWrap?100:Browser.width:w)<=0?100:w)-p[3]-p[1]},__proto.getCharPoint=function(charIndex,out){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);for(var len=0,lines=this._lines,startIndex=0,i=0,n=lines.length;i<n;i++){if(charIndex<(len+=lines[i].length)){var line=i;break}startIndex=len}var ctxFont=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font,ctxFont=(Browser.context.font=ctxFont,this.getTextWidth(this._text.substring(startIndex,charIndex)));return(out||new Point).setTo(this._startX+ctxFont-(this._clipPoint?this._clipPoint.x:0),this._startY+line*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},__getset(0,__proto,"width",function(){return this._width||this.textWidth+this.padding[1]+this.padding[3]},function(value){value!=this._width&&(Laya.superSet(Sprite,this,"width",value),this.isChanged=!0)}),__getset(0,__proto,"textWidth",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textWidth}),__getset(0,__proto,"height",function(){return this._height||this.textHeight},function(value){value!=this._height&&(Laya.superSet(Sprite,this,"height",value),this.isChanged=!0)}),__getset(0,__proto,"textHeight",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textHeight}),__getset(0,__proto,"padding",function(){return this._getCSSStyle().padding},function(value){this._getCSSStyle().padding=value,this.isChanged=!0}),__getset(0,__proto,"bold",function(){return this._getCSSStyle().bold},function(value){this._getCSSStyle().bold=value,this.isChanged=!0}),__getset(0,__proto,"text",function(){return this._text||""},function(value){this._text!==value&&(this.lang(value+""),this.isChanged=!0,this.event("change"))}),__getset(0,__proto,"color",function(){return this._getCSSStyle().color},function(value){this._getCSSStyle().color!=value&&(this._getCSSStyle().color=value,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),__getset(0,__proto,"font",function(){return this._getCSSStyle().fontFamily},function(value){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),Text._bitmapFonts&&Text._bitmapFonts[value]&&(this._currBitmapFont=Text._bitmapFonts[value]),this._getCSSStyle().fontFamily=value,this.isChanged=!0}),__getset(0,__proto,"fontSize",function(){return this._getCSSStyle().fontSize},function(value){this._getCSSStyle().fontSize=value,this.isChanged=!0}),__getset(0,__proto,"italic",function(){return this._getCSSStyle().italic},function(value){this._getCSSStyle().italic=value,this.isChanged=!0}),__getset(0,__proto,"align",function(){return this._getCSSStyle().align},function(value){this._getCSSStyle().align=value,this.isChanged=!0}),__getset(0,__proto,"valign",function(){return this._getCSSStyle().valign},function(value){this._getCSSStyle().valign=value,this.isChanged=!0}),__getset(0,__proto,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(value){this._getCSSStyle().wordWrap=value,this.isChanged=!0}),__getset(0,__proto,"leading",function(){return this._getCSSStyle().leading},function(value){this._getCSSStyle().leading=value,this.isChanged=!0}),__getset(0,__proto,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(value){this._getCSSStyle().backgroundColor=value,this.isChanged=!0}),__getset(0,__proto,"borderColor",function(){return this._getCSSStyle().borderColor},function(value){this._getCSSStyle().borderColor=value,this.isChanged=!0}),__getset(0,__proto,"stroke",function(){return this._getCSSStyle().stroke},function(value){this._getCSSStyle().stroke=value,this.isChanged=!0}),__getset(0,__proto,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(value){this._getCSSStyle().strokeColor=value,this.isChanged=!0}),__getset(0,__proto,"isChanged",null,function(value){this._isChanged!==value&&(this._isChanged=value)&&Laya.timer.callLater(this,this.typeset)}),__getset(0,__proto,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(value){var maxScrollX,visibleLineCount;this.overflow!=Text.SCROLL||this.textWidth<this._width||!this._clipPoint||(value=value<this.padding[3]?this.padding[3]:value,maxScrollX=this._textWidth-this._width,visibleLineCount=this._height/(this._charSize.height+this.leading)|1,this._clipPoint.x=value=maxScrollX<value?maxScrollX:value,this.renderText(this._lastVisibleLineIndex,visibleLineCount))}),__getset(0,__proto,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(value){var maxScrollY,visibleLineCount;this.overflow!=Text.SCROLL||this.textHeight<this._height||!this._clipPoint||(value=value<this.padding[0]?this.padding[0]:value,maxScrollY=(value=(maxScrollY=this._textHeight-this._height)<value?maxScrollY:value)/(this._charSize.height+this.leading)|0,this._lastVisibleLineIndex=maxScrollY,visibleLineCount=1+(this._height/(this._charSize.height+this.leading)|0),this._clipPoint.y=value,this.renderText(maxScrollY,visibleLineCount))}),__getset(0,__proto,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),__getset(0,__proto,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),__getset(0,__proto,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),__getset(0,__proto,"underlineColor",function(){return this._underlineColor},function(value){this._underlineColor=value,this._isChanged=!0,this.typeset()}),Text.registerBitmapFont=function(name,bitmapFont){(Text._bitmapFonts=Text._bitmapFonts?Text._bitmapFonts:{})[name]=bitmapFont},Text.unregisterBitmapFont=function(name,destroy){var tBitmapFont;void 0===destroy&&(destroy=!0),Text._bitmapFonts&&Text._bitmapFonts[name]&&(tBitmapFont=Text._bitmapFonts[name],destroy&&tBitmapFont.destroy(),delete Text._bitmapFonts[name])},Text.setTextRightToLeft=function(){var style=Browser.canvas.source.style;style.display="none",style.position="absolute",style.direction="rtl",Render._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,Browser.document.body.appendChild(Browser.canvas.source)},Text.supportFont=function(font){Browser.context.font="10px sans-serif";var defaultFontWidth=Browser.context.measureText("abcji").width,font=(Browser.context.font="10px "+font,Browser.context.measureText("abcji").width);return console.log(defaultFontWidth,font),defaultFontWidth!==font},Text._testWord="游",Text.langPacks=null,Text.VISIBLE="visible",Text.SCROLL="scroll",Text.HIDDEN="hidden",Text.CharacterCache=!0,Text.RightToLeft=!1,Text._bitmapFonts=null,__static(Text,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),Text}(Sprite),Stage=function(_super){function Stage(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",Stage.__super.call(this),this.offset=new Point,this._canvasTransform=new Matrix,this._previousOrientation=Browser.window.orientation;var _$this=this,window=(this.transform=Matrix.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0,Browser.window),_this=this,state=(window.addEventListener("focus",function(){_$this._isFocused=!0,_this.event("focus"),_this.event("focuschange")}),window.addEventListener("blur",function(){_$this._isFocused=!1,_this.event("blur"),_this.event("focuschange"),_this._isInputting()&&(Input.inputElement.target.focus=!1)}),"visibilityState"),visibilityChange="visibilitychange",document=window.document;void 0!==document.hidden?(visibilityChange="visibilitychange",state="visibilityState"):void 0!==document.mozHidden?(visibilityChange="mozvisibilitychange",state="mozVisibilityState"):void 0!==document.msHidden?(visibilityChange="msvisibilitychange",state="msVisibilityState"):void 0!==document.webkitHidden&&(visibilityChange="webkitvisibilitychange",state="webkitVisibilityState"),window.document.addEventListener(visibilityChange,function(){"hidden"==Browser.document[state]?_this._setStageVisible(!1):_this._setStageVisible(!0)}),window.document.addEventListener("qbrowserVisibilityChange",function(e){_this._setStageVisible(!e.hidden)}),window.addEventListener("resize",function(){var orientation=Browser.window.orientation;null!=orientation&&orientation!=_$this._previousOrientation&&_this._isInputting()&&(Input.inputElement.target.focus=!1),_$this._previousOrientation=orientation,_this._isInputting()||_this._resetCanvas()}),window.addEventListener("orientationchange",function(e){_this._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Browser.onMobile&&this.on("mousedown",this,this._onmouseMove)}__class(Stage,"laya.display.Stage",_super);var __proto=Stage.prototype;return __proto._setStageVisible=function(value){this._isVisibility!=value&&(this._isVisibility=value,this._isVisibility||this._isInputting()&&(Input.inputElement.target.focus=!1),this.event("visibilitychange"))},__proto._isInputting=function(){return Browser.onMobile&&Input.isInputting},__proto._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)},__proto._resetCanvas=function(){var canvas;this.screenAdaptationEnabled&&((canvas=Render._mainCanvas).source.style,canvas.size(1,1),Laya.timer.once(100,this,this._changeCanvasSize))},__proto.setScreenSize=function(screenWidth,screenHeight){var rotation=!1,temp=("none"!==this._screenMode&&(rotation=(screenWidth/screenHeight<1?"vertical":"horizontal")!==this._screenMode)&&(temp=screenHeight,screenHeight=screenWidth,screenWidth=temp),this.canvasRotation=rotation,Render._mainCanvas),canvasStyle=temp.source.style,mat=this._canvasTransform.identity(),scaleMode=this._scaleMode,scaleX=screenWidth/this.designWidth,scaleY=screenHeight/this.designHeight,canvasWidth=this.designWidth,canvasHeight=this.designHeight,realWidth=screenWidth,realHeight=screenHeight,pixelRatio=Browser.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,scaleMode){case"noscale":scaleX=scaleY=1,realWidth=this.designWidth,realHeight=this.designHeight;break;case"showall":scaleX=scaleY=Math.min(scaleX,scaleY),canvasWidth=realWidth=Math.round(this.designWidth*scaleX),canvasHeight=realHeight=Math.round(this.designHeight*scaleY);break;case"noborder":scaleX=scaleY=Math.max(scaleX,scaleY),realWidth=Math.round(this.designWidth*scaleX),realHeight=Math.round(this.designHeight*scaleY);break;case"full":scaleX=scaleY=1,this._width=canvasWidth=screenWidth,this._height=canvasHeight=screenHeight;break;case"fixedwidth":scaleY=scaleX,this._height=canvasHeight=Math.round(screenHeight/scaleX);break;case"fixedheight":scaleX=scaleY,this._width=canvasWidth=Math.round(screenWidth/scaleY);break;case"fixedauto":screenWidth/screenHeight<this.designWidth/this.designHeight?(scaleY=scaleX,this._height=canvasHeight=Math.round(screenHeight/scaleX)):(scaleX=scaleY,this._width=canvasWidth=Math.round(screenWidth/scaleY))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,canvasWidth=canvasWidth+1&2147483646,canvasHeight=canvasHeight+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),scaleX*=this.scaleX,scaleY*=this.scaleY,1===scaleX&&1===scaleY?this.transform.identity():(this.transform.a=this._formatData(scaleX/(realWidth/canvasWidth)),this.transform.d=this._formatData(scaleY/(realHeight/canvasHeight)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),temp.size(canvasWidth,canvasHeight),RunDriver.changeWebGLSize(canvasWidth,canvasHeight),mat.scale(realWidth/canvasWidth/pixelRatio,realHeight/canvasHeight/pixelRatio),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(screenWidth-realWidth)/pixelRatio:this.offset.x=.5*(screenWidth-realWidth)/pixelRatio,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(screenHeight-realHeight)/pixelRatio:this.offset.y=.5*(screenHeight-realHeight)/pixelRatio,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),mat.translate(this.offset.x,this.offset.y),this.canvasDegree=0,rotation&&("horizontal"===this._screenMode?(mat.rotate(Math.PI/2),mat.translate(screenHeight/pixelRatio,0),this.canvasDegree=90):(mat.rotate(-Math.PI/2),mat.translate(0,screenWidth/pixelRatio),this.canvasDegree=-90)),mat.a=this._formatData(mat.a),mat.d=this._formatData(mat.d),mat.tx=this._formatData(mat.tx),mat.ty=this._formatData(mat.ty),canvasStyle.transformOrigin=canvasStyle.webkitTransformOrigin=canvasStyle.msTransformOrigin=canvasStyle.mozTransformOrigin=canvasStyle.oTransformOrigin="0px 0px 0px",canvasStyle.transform=canvasStyle.webkitTransform=canvasStyle.msTransform=canvasStyle.mozTransform=canvasStyle.oTransform="matrix("+mat.toString()+")",mat.translate(parseInt(canvasStyle.left)||0,parseInt(canvasStyle.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},__proto._formatData=function(value){return Math.abs(value)<1e-6?0:Math.abs(1-value)<.001?0<value?1:-1:value},__proto.getMousePoint=function(){return Point.TEMP.setTo(this.mouseX,this.mouseY)},__proto.repaint=function(){this._repaint=1},__proto.parentRepaint=function(){},__proto._loop=function(){return this.render(Render.context,0,0),!0},__proto._onmouseMove=function(e){this._mouseMoveTime=Browser.now()},__proto.getTimeFromFrameStart=function(){return Browser.now()-this._frameStartTime},__proto.render=function(context,x,y){if("sleep"===this._frameRate&&!Render.isConchApp){var now=Browser.now();if(!(1e3<=now-this._frameStartTime))return;this._frameStartTime=now}if(this._renderCount++,Render.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=Browser.now();var now="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),isDoubleLoop=this._renderCount%2==0;if(Stat.renderSlow=!now,now||isDoubleLoop||Render.isConchApp){Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update(),RunDriver.update3DLoop();var scene,i=0,n=0;if(Render.isConchNode)for(i=0,n=this._scenes.length;i<n;i++)(scene=this._scenes[i])&&scene._updateSceneConch();else for(i=0,n=this._scenes.length;i<n;i++)(scene=this._scenes[i])&&scene._updateScene();if(Render.isConchNode){for(var customList=Sprite.CustomList,i=0,n=customList.length;i<n;i++){var customItem=customList[i];customItem.customRender(customItem.customContext,0,0)}return}}Render.isConchNode||this.renderingEnabled&&(now||!isDoubleLoop||Render.isConchWebGL)&&(Render.isWebGL?(context.clear(),_super.prototype.render.call(this,context,x,y),Stat._show&&Stat._sp&&Stat._sp.render(context,x,y),RunDriver.clear(this._bgColor),RunDriver.beginFlush(),context.flush(),RunDriver.endFinish(),VectorGraphManager.instance&&VectorGraphManager.getInstance().endDispose()):(RunDriver.clear(this._bgColor),_super.prototype.render.call(this,context,x,y),Stat._show&&Stat._sp&&Stat._sp.render(context,x,y)))}else this._renderCount%5==0&&(Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update())},__proto._requestFullscreen=function(){var element=Browser.document.documentElement;element.requestFullscreen?element.requestFullscreen():element.mozRequestFullScreen?element.mozRequestFullScreen():element.webkitRequestFullscreen?element.webkitRequestFullscreen():element.msRequestFullscreen&&element.msRequestFullscreen()},__proto._fullScreenChanged=function(){Laya.stage.event("fullscreenchange")},__proto.exitFullscreen=function(){var document=Browser.document;document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},__getset(0,__proto,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),__getset(0,__proto,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),__getset(0,__proto,"frameRate",function(){return this._frameRate},function(value){if(this._frameRate=value,Render.isConchApp)switch(this._frameRate){case"slow":Browser.window.conch&&Browser.window.conchConfig.setSlowFrame&&Browser.window.conchConfig.setSlowFrame(!0);break;case"fast":Browser.window.conch&&Browser.window.conchConfig.setSlowFrame&&Browser.window.conchConfig.setSlowFrame(!1);break;case"mouse":Browser.window.conch&&Browser.window.conchConfig.setMouseFrame&&Browser.window.conchConfig.setMouseFrame(2e3);break;case"sleep":Browser.window.conch&&Browser.window.conchConfig.setLimitFPS&&Browser.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),__getset(0,__proto,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){this.designWidth=value,Laya.superSet(Sprite,this,"width",value),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"alignH",function(){return this._alignH},function(value){this._alignH=value,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"isFocused",function(){return this._isFocused}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){this.designHeight=value,Laya.superSet(Sprite,this,"height",value),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||Matrix.create()},_super.prototype._$set_transform),__getset(0,__proto,"isVisibility",function(){return this._isVisibility}),__getset(0,__proto,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),__getset(0,__proto,"scaleMode",function(){return this._scaleMode},function(value){this._scaleMode=value,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"alignV",function(){return this._alignV},function(value){this._alignV=value,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,__proto,"bgColor",function(){return this._bgColor},function(value){this._bgColor=value,this.conchModel&&this.conchModel.bgColor(value),Render.isWebGL&&(value?Stage._wgColor=Color.create(value)._color:Browser.onMiniGame||(Stage._wgColor=null)),Browser.onLimixiu?Stage._wgColor=Color.create(value)._color:Render.canvas.style.background=value||"none"}),__getset(0,__proto,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/this.clientScaleX)}),__getset(0,__proto,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/this.clientScaleY)}),__getset(0,__proto,"screenMode",function(){return this._screenMode},function(value){this._screenMode=value}),__getset(0,__proto,"visible",_super.prototype._$get_visible,function(value){this.visible!==value&&(Laya.superSet(Sprite,this,"visible",value),Render._mainCanvas.source.style.visibility=value?"visible":"hidden")}),__getset(0,__proto,"fullScreenEnabled",null,function(value){var document=Browser.document,canvas=Render.canvas;value?(canvas.addEventListener("mousedown",this._requestFullscreen),canvas.addEventListener("touchstart",this._requestFullscreen),document.addEventListener("fullscreenchange",this._fullScreenChanged),document.addEventListener("mozfullscreenchange",this._fullScreenChanged),document.addEventListener("webkitfullscreenchange",this._fullScreenChanged),document.addEventListener("msfullscreenchange",this._fullScreenChanged)):(canvas.removeEventListener("mousedown",this._requestFullscreen),canvas.removeEventListener("touchstart",this._requestFullscreen),document.removeEventListener("fullscreenchange",this._fullScreenChanged),document.removeEventListener("mozfullscreenchange",this._fullScreenChanged),document.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),document.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),Stage.SCALE_NOSCALE="noscale",Stage.SCALE_EXACTFIT="exactfit",Stage.SCALE_SHOWALL="showall",Stage.SCALE_NOBORDER="noborder",Stage.SCALE_FULL="full",Stage.SCALE_FIXED_WIDTH="fixedwidth",Stage.SCALE_FIXED_HEIGHT="fixedheight",Stage.SCALE_FIXED_AUTO="fixedauto",Stage.ALIGN_LEFT="left",Stage.ALIGN_RIGHT="right",Stage.ALIGN_CENTER="center",Stage.ALIGN_TOP="top",Stage.ALIGN_MIDDLE="middle",Stage.ALIGN_BOTTOM="bottom",Stage.SCREEN_NONE="none",Stage.SCREEN_HORIZONTAL="horizontal",Stage.SCREEN_VERTICAL="vertical",Stage.FRAME_FAST="fast",Stage.FRAME_SLOW="slow",Stage.FRAME_MOUSE="mouse",Stage.FRAME_SLEEP="sleep",Stage.FRAME_MOUSE_THREDHOLD=2e3,__static(Stage,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),Stage}(Sprite),FileBitmap=(function(){function SoundNode(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,SoundNode.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}__class(SoundNode,"laya.media.SoundNode",Sprite);var __proto=SoundNode.prototype;__proto._onParentChange=function(){this.target=this.parent},__proto.play=function(loops,complete){void 0===loops&&(loops=1),isNaN(loops)&&(loops=1),this.url&&(this.stop(),this._channel=SoundManager.playSound(this.url,loops,complete))},__proto.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},__proto._setPlayAction=function(tar,event,action,add){void 0===add&&(add=!0),this[action]&&tar&&(add?tar.on(event,this,this[action]):tar.off(event,this,this[action]))},__proto._setPlayActions=function(tar,events,action,add){if(void 0===add&&(add=!0),tar&&events)for(var eventArr=events.split(","),i=0,len=eventArr.length,i=0;i<len;i++)this._setPlayAction(tar,eventArr[i],action,add)},__getset(0,__proto,"playEvent",null,function(events){(this._playEvents=events)&&this._tar&&this._setPlayActions(this._tar,events,"play")}),__getset(0,__proto,"target",null,function(tar){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=tar,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),__getset(0,__proto,"stopEvent",null,function(events){(this._stopEvents=events)&&this._tar&&this._setPlayActions(this._tar,events,"stop")})}(),function(){function FileBitmap(){this._src=null,this._onload=null,this._onerror=null,FileBitmap.__super.call(this)}__class(FileBitmap,"laya.resource.FileBitmap",Bitmap);var __proto=FileBitmap.prototype;return __getset(0,__proto,"src",function(){return this._src},function(value){this._src=value}),__getset(0,__proto,"onload",null,function(value){}),__getset(0,__proto,"onerror",null,function(value){}),FileBitmap}()),HTMLCanvas=function(){function HTMLCanvas(type,canvas){this._is2D=!1,HTMLCanvas.__super.call(this);var o,_$this=this;this._source=this,"2D"!==type&&("AUTO"!==type||Render.isWebGL)||(this._is2D=!0,this._source=canvas||Browser.createElement("canvas"),this._w=this._source.width,this._h=this._source.height,(o=this).getContext=function(contextID,other){return _$this._ctx||((contextID=_$this._ctx=_$this._source.getContext(contextID,other))&&(contextID._canvas=o,Render.isFlash||Browser.onLimixiu||(contextID.size=function(w,h){})),contextID)}),this.lock=!0}__class(HTMLCanvas,"laya.resource.HTMLCanvas",Bitmap);var __proto=HTMLCanvas.prototype;return __proto.clear=function(){this._ctx&&this._ctx.clear()},__proto.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},__proto.release=function(){},__proto._setContext=function(context){this._ctx=context},__proto.getContext=function(contextID,other){return this._ctx||(this._ctx=HTMLCanvas._createContext(this))},__proto.getMemSize=function(){return 0},__proto.size=function(w,h){(this._w!=w||this._h!=h||this._source&&(this._source.width!=w||this._source.height!=h))&&(this._w=w,this._h=h,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(w,h),this._source)&&(this._source.height=h,this._source.width=w)},__proto.getCanvas=function(){return this._source},__proto.toBase64=function(type,encoderOptions,callBack){this._source&&(Render.isConchApp&&this._source.toBase64?this._source.toBase64(type,encoderOptions,callBack):(type=this._source.toDataURL(type,encoderOptions),callBack.call(this,type)))},__getset(0,__proto,"context",function(){return this._ctx}),__getset(0,__proto,"asBitmap",null,function(value){}),HTMLCanvas.create=function(type,canvas){return new HTMLCanvas(type,canvas)},HTMLCanvas.TYPE2D="2D",HTMLCanvas.TYPE3D="3D",HTMLCanvas.TYPEAUTO="AUTO",HTMLCanvas._createContext=null,HTMLCanvas}(),AnimationPlayerBase=(function(){function HTMLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas){throw HTMLSubImage.__super.call(this),new Error("不允许new！")}__class(HTMLSubImage,"laya.resource.HTMLSubImage",Bitmap),HTMLSubImage.create=function(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas){return void 0===allowMerageInAtlas&&(allowMerageInAtlas=!1),new HTMLSubImage}}(),function(_super){function Animation(){this._frames=null,this._url=null,Animation.__super.call(this),this._setControlNode(this)}__class(Animation,"laya.display.Animation",_super);var __proto=Animation.prototype;__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,destroyChild),this._frames=null,this._labels=null},__proto.play=function(start,loop,name,showWarn){void 0===start&&(start=0),void 0===loop&&(loop=!0),void 0===showWarn&&(showWarn=!0),(name=void 0===name?"":name)&&this._setFramesFromCache(name,showWarn),this._isPlaying=!0,this.index="string"==typeof start?this._getFrameByLabel(start):start,this.loop=loop,this._actionName=name,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},__proto._setFramesFromCache=function(name,showWarn){var tAniO;return void 0===showWarn&&(showWarn=!1),(name=this._url?this._url+"#"+name:name)&&Animation.framesMap[name]?((tAniO=Animation.framesMap[name])instanceof Array?(this._frames=Animation.framesMap[name],this._count=this._frames.length):(tAniO.nodeRoot&&(Animation.framesMap[name]=this._parseGraphicAnimationByData(tAniO),tAniO=Animation.framesMap[name]),this._frames=tAniO.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=tAniO.interval),this._labels=this._copyLabels(tAniO.labels)),!0):(showWarn&&console.log("ani not found:",name),!1)},__proto._copyLabels=function(labels){if(!labels)return null;var key,rst={};for(key in labels)rst[key]=Utils.copyArray([],labels[key]);return rst},__proto._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&_super.prototype._frameLoop.call(this)},__proto._displayToIndex=function(value){this._frames&&(this.graphics=this._frames[value])},__proto.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},__proto.loadImages=function(urls,cacheName){return void 0===cacheName&&(cacheName=""),this._url="",this._setFramesFromCache(cacheName)||(this.frames=Animation.framesMap[cacheName]||Animation.createFrames(urls,cacheName)),this},__proto.loadAtlas=function(url,loaded,cacheName){void 0===cacheName&&(cacheName=""),this._url="";var _this_=this;function onLoaded(loadUrl){url===loadUrl&&(_this_.frames=Animation.framesMap[cacheName]||Animation.createFrames(url,cacheName),loaded)&&loaded.run()}return _this_._setFramesFromCache(cacheName)||(Loader.getAtlas(url)?onLoaded(url):Laya.loader.load(url,Handler.create(null,onLoaded,[url]),null,"atlas")),this},__proto.loadAnimation=function(url,loaded,atlas){this._url=url;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,loaded&&loaded.run()):!atlas||Loader.getAtlas(atlas)?this._loadAnimationData(url,loaded,atlas):Laya.loader.load(atlas,Handler.create(this,this._loadAnimationData,[url,loaded,atlas]),null,"atlas"),this},__proto._loadAnimationData=function(url,loaded,atlas){var _this_,_$this=this;function onLoaded(loadUrl){if(Loader.getRes(loadUrl)&&url===loadUrl){var tAniO;if(Animation.framesMap[url+"#"])_this_._setFramesFromCache(_$this._actionName,!0),_$this.index=0;else{loadUrl=_this_._parseGraphicAnimation(Loader.getRes(url));if(!loadUrl)return;for(var defaultO,aniList=loadUrl.animationList,i=0,len=aniList.length,i=0;i<len;i++)tAniO=aniList[i],Animation.framesMap[url+"#"+tAniO.name]=tAniO,defaultO=defaultO||tAniO;defaultO&&(Animation.framesMap[url+"#"]=defaultO,_this_._setFramesFromCache(_$this._actionName,!0),_$this.index=0)}_$this._checkResumePlaying(),loaded&&loaded.run()}}atlas&&!Loader.getAtlas(atlas)?console.warn("atlas load fail:"+atlas):(_this_=this,Loader.getRes(url)?onLoaded(url):Laya.loader.load(url,Handler.create(null,onLoaded,[url]),null,"json"),Loader.clearRes(url))},__proto._parseGraphicAnimation=function(animationData){return GraphicAnimation.parseAnimationData(animationData)},__proto._parseGraphicAnimationByData=function(animationObject){return GraphicAnimation.parseAnimationByData(animationObject)},__getset(0,__proto,"frames",function(){return this._frames},function(value){(this._frames=value)&&(this._count=value.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),__getset(0,__proto,"autoPlay",null,function(value){value?this.play():this.stop()}),__getset(0,__proto,"source",null,function(value){-1<value.indexOf(".ani")?this.loadAnimation(value):-1<value.indexOf(".json")||-1<value.indexOf("als")||-1<value.indexOf("atlas")?this.loadAtlas(value):this.loadImages(value.split(","))}),__getset(0,__proto,"autoAnimation",null,function(value){this.play(0,!0,value,!1)}),Animation.createFrames=function(url,name){var arr,g,i=0,n=0;if("string"==typeof url){var atlas=Loader.getAtlas(url);if(atlas&&atlas.length)for(arr=[],i=0,n=atlas.length;i<n;i++)(g=new RunDriver.createGraphics).drawTexture(Loader.getRes(atlas[i]),0,0),arr.push(g)}else if(url instanceof Array)for(arr=[],i=0,n=url.length;i<n;i++)(g=new RunDriver.createGraphics).loadImage(url[i],0,0),arr.push(g);return name&&(Animation.framesMap[name]=arr),arr},Animation.clearCache=function(key){var val,key2=key+"#";for(val in Animation.framesMap)val!==key&&0!=val.indexOf(key2)||delete Animation.framesMap[val]},Animation.framesMap={}}(AnimationPlayerBase),function(_super){function FrameAnimation(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,FrameAnimation.__super.call(this),null==FrameAnimation._sortIndexFun&&(FrameAnimation._sortIndexFun=MathUtil.sortByKey("index",!1,!0))}__class(FrameAnimation,"laya.display.FrameAnimation",_super);var __proto=FrameAnimation.prototype;return __proto._setUp=function(targetDic,animationData){this._labels=null,this._animationNewFrames=null,this._targetDic=targetDic,this._animationData=animationData,this.interval=1e3/animationData.frameRate,animationData.parsed?(this._count=animationData.count,this._labels=animationData.labels,this._animationNewFrames=animationData.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),animationData.parsed=!0,animationData.labels=this._labels,animationData.count=this._count,animationData.animationNewFrames=this._animationNewFrames},__proto.clear=function(){_super.prototype.clear.call(this),this._targetDic=null,this._animationData=null},__proto._displayToIndex=function(value){if(this._animationData){(value=value<0?0:value)>this._count&&(value=this._count);for(var nodes=this._animationData.nodes,i=0,len=nodes.length,i=0;i<len;i++)this._displayNodeToFrame(nodes[i],value)}},__proto._displayNodeToFrame=function(node,frame,targetDic){var target=(targetDic=targetDic||this._targetDic)[node.target];if(target)for(var key,propFrames,frames=node.frames,keys=node.keys,i=0,len=keys.length,i=0;i<len;i++)propFrames=(propFrames=frames[key=keys[i]]).length>frame?propFrames[frame]:propFrames[propFrames.length-1],target[key]=propFrames},__proto._calculateDatas=function(){if(this._animationData){for(var tNode,nodes=this._animationData.nodes,i=0,len=nodes.length,i=this._count=0;i<len;i++)tNode=nodes[i],this._calculateNodeKeyFrames(tNode);this._count+=1}},__proto._calculateNodeKeyFrames=function(node){var key,tKeyFrames,keyFrames=node.keyframes,target=node.target;for(key in node.frames||(node.frames={}),node.keys?node.keys.length=0:node.keys=[],node.initValues||(node.initValues={}),keyFrames)tKeyFrames=keyFrames[key],node.frames[key]||(node.frames[key]=[]),this._targetDic&&this._targetDic[target]&&(node.initValues[key]=this._targetDic[target][key]),tKeyFrames.sort(FrameAnimation._sortIndexFun),node.keys.push(key),this._calculateNodePropFrames(tKeyFrames,node.frames[key],key,target)},__proto.resetToInitState=function(){if(this._targetDic&&this._animationData)for(var tNode,initValues,nodes=this._animationData.nodes,i=0,len=nodes.length,i=0;i<len;i++)if(initValues=(tNode=nodes[i]).initValues){var key,target=this._targetDic[tNode.target];if(target)for(key in initValues)target[key]=initValues[key]}},__proto._calculateNodePropFrames=function(keyframes,frames,key,target){var i=0,len=keyframes.length-1;for(frames.length=keyframes[len].index+1,i=0;i<len;i++)this._dealKeyFrame(keyframes[i]),this._calculateFrameValues(keyframes[i],keyframes[i+1],frames);0==len&&(frames[keyframes[0].index]=keyframes[0].value,this._animationNewFrames)&&(this._animationNewFrames[keyframes[0].index]=!0),this._dealKeyFrame(keyframes[i])},__proto._dealKeyFrame=function(keyFrame){keyFrame.label&&""!=keyFrame.label&&this.addLabel(keyFrame.label,keyFrame.index)},__proto._calculateFrameValues=function(startFrame,endFrame,result){var easeFun,i=0,start=startFrame.index,end=endFrame.index,startValue=startFrame.value,dValue=endFrame.value-startFrame.value,dLen=end-start;if(end>this._count&&(this._count=end),startFrame.tween)for(null==(easeFun=Ease[startFrame.tweenMethod])&&(easeFun=Ease.linearNone),i=start;i<end;i++)result[i]=easeFun(i-start,startValue,dValue,dLen),this._animationNewFrames&&(this._animationNewFrames[i]=!0);else for(i=start;i<end;i++)result[i]=startValue;this._animationNewFrames&&(this._animationNewFrames[startFrame.index]=!0,this._animationNewFrames[endFrame.index]=!0),result[endFrame.index]=endFrame.value},FrameAnimation._sortIndexFun=null,FrameAnimation}(AnimationPlayerBase)),Input=function(_super){function Input(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",Input.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=Text.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}__class(Input,"laya.display.Input",_super);var __proto=Input.prototype;return __proto.setSelection=function(startIndex,endIndex){this.focus=!0,laya.display.Input.inputElement.selectionStart=startIndex,laya.display.Input.inputElement.selectionEnd=endIndex},__proto._onUnDisplay=function(e){this.focus=!1},__proto._onMouseDown=function(e){this.focus=!0},__proto._syncInputTransform=function(){var inputElement=this.nativeInput,transform=Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),inputWid=this._width-this.padding[1]-this.padding[3],inputHei=this._height-this.padding[0]-this.padding[2];Render.isConchApp?(inputElement.setScale(transform.scaleX,transform.scaleY),inputElement.setSize(inputWid,inputHei),inputElement.setPos(transform.x,transform.y)):(Input.inputContainer.style.transform=Input.inputContainer.style.webkitTransform="scale("+transform.scaleX+","+transform.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",inputElement.style.width=inputWid+"px",inputElement.style.height=inputHei+"px",Input.inputContainer.style.left=transform.x+"px",Input.inputContainer.style.top=transform.y+"px")},__proto.select=function(){this.nativeInput.select()},__proto._setInputMethod=function(){Input.input.parentElement&&Input.inputContainer.removeChild(Input.input),Input.area.parentElement&&Input.inputContainer.removeChild(Input.area),Input.inputElement=this._multiline?Input.area:Input.input,Input.inputContainer.appendChild(Input.inputElement),Text.RightToLeft&&(Input.inputElement.style.direction="rtl")},__proto._focusIn=function(){laya.display.Input.isInputting=!0;var input=this.nativeInput,cssStyle=(this._focus=!0,input.style);cssStyle.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),input.readOnly=!this._editable,Render.isConchApp&&(input.setType(this._type),input.setForbidEdit(!this._editable)),input.maxLength=this._maxChars,this.padding;input.type=this._type,input.value=this._content,input.placeholder=this._prompt,Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.on("keydown",this,this._onKeyDown),(Laya.stage.focus=this).event("focus"),Browser.onPC&&input.focus(),Browser.onMiniGame||(this._text,this._text=null),this.typeset(),input.setColor(this._originColor),input.setFontSize(this.fontSize),input.setFontFace(Browser.onIPhone&&Text._fontFamilyMap[this.font]||this.font),Render.isConchApp&&input.setMultiAble&&input.setMultiAble(this._multiline),cssStyle.lineHeight=this.leading+this.fontSize+"px",cssStyle.fontStyle=this.italic?"italic":"normal",cssStyle.fontWeight=this.bold?"bold":"normal",cssStyle.textAlign=this.align,cssStyle.padding="0 0",this._syncInputTransform(),!Render.isConchApp&&Browser.onPC&&Laya.timer.frameLoop(1,this,this._syncInputTransform)},__proto._setPromptColor=function(){(Input.promptStyleDOM=Browser.getElementById("promptStyle"))||((Input.promptStyleDOM=Browser.createElement("style")).setAttribute("id","promptStyle"),Browser.document.head.appendChild(Input.promptStyleDOM)),Input.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},__proto._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(Laya.superSet(Text,this,"text",this._content),Laya.superSet(Text,this,"color",this._originColor)):(Laya.superSet(Text,this,"text",this._prompt),Laya.superSet(Text,this,"color",this._promptColor)),Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.focus=null,this.event("blur"),Render.isConchApp&&this.nativeInput.blur(),Browser.onPC&&Laya.timer.clear(this,this._syncInputTransform)},__proto._onKeyDown=function(e){13===e.keyCode&&(Browser.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},__proto.changeText=function(text){this._content=text,this._focus?(this.nativeInput.value=text||"",this.event("change")):_super.prototype.changeText.call(this,text)},__getset(0,__proto,"color",_super.prototype._$get_color,function(value){this._focus&&this.nativeInput.setColor(value),Laya.superSet(Text,this,"color",this._content?value:this._promptColor),this._originColor=value}),__getset(0,__proto,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(value){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),__getset(0,__proto,"multiline",function(){return this._multiline},function(value){this._multiline=value,this.valign=value?"top":"middle"}),__getset(0,__proto,"maxChars",function(){return this._maxChars},function(value){this._maxChars=value=value<=0?1e5:value}),__getset(0,__proto,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(value){Laya.superSet(Text,this,"color",this._originColor),value+="",this._focus?(this.nativeInput.value=value||"",this.event("change")):(this._multiline||(value=value.replace(/\r?\n/g,"")),(this._content=value)?Laya.superSet(Text,this,"text",value):(Laya.superSet(Text,this,"text",this._prompt),Laya.superSet(Text,this,"color",this.promptColor)))}),__getset(0,__proto,"nativeInput",function(){return this._multiline?Input.area:Input.input}),__getset(0,__proto,"prompt",function(){return this._prompt},function(value){!this._text&&value&&Laya.superSet(Text,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?Laya.superSet(Text,this,"text",this._text==this._prompt?value:this._text):Laya.superSet(Text,this,"text",value),this._prompt=Text.langPacks&&Text.langPacks[value]?Text.langPacks[value]:value}),__getset(0,__proto,"focus",function(){return this._focus},function(value){var input=this.nativeInput;this._focus!==value&&(value?(input.target?input.target._focusOut():this._setInputMethod(),(input.target=this)._focusIn()):(input.target=null,this._focusOut(),Browser.document.body.scrollTop=0,input.blur(),Render.isConchApp?input.setPos(-1e4,-1e4):Input.inputContainer.contains(input)&&Input.inputContainer.removeChild(input)))}),__getset(0,__proto,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(pattern){pattern?(-1<(pattern="[^"+pattern+"]").indexOf("^^")&&(pattern=pattern.replace("^^","")),this._restrictPattern=new RegExp(pattern,"g")):this._restrictPattern=null}),__getset(0,__proto,"editable",function(){return this._editable},function(value){this._editable=value,Render.isConchApp&&Input.input.setForbidEdit(!value)}),__getset(0,__proto,"promptColor",function(){return this._promptColor},function(value){this._promptColor=value,this._content||Laya.superSet(Text,this,"color",value)}),__getset(0,__proto,"type",function(){return this._type},function(value){this._getCSSStyle().password="password"==value,this._type=value,Render.isConchApp&&this.nativeInput.setType(value)}),__getset(0,__proto,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(value){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),__getset(0,__proto,"asPassword",function(){return this._getCSSStyle().password},function(value){this._getCSSStyle().password=value,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),Input.__init__=function(){Input._createInputElement(),Browser.onMobile&&Render.canvas.addEventListener(!Input.IOS_IFRAME||Browser.onMiniGame?"touchend":"click",Input._popupInputMethod)},Input._popupInputMethod=function(e){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},Input._createInputElement=function(){Input._initInput(Input.area=Browser.createElement("textarea")),Input._initInput(Input.input=Browser.createElement("input")),(Input.inputContainer=Browser.createElement("div")).style.position="absolute",Input.inputContainer.style.zIndex=1e5,Browser.container.appendChild(Input.inputContainer),Input.inputContainer.setPos=function(x,y){Input.inputContainer.style.left=x+"px",Input.inputContainer.style.top=y+"px"}},Input._initInput=function(input){var style=input.style;style.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",style.resize="none",style.backgroundColor="transparent",style.border="none",style.outline="none",style.zIndex=1,input.addEventListener("input",Input._processInputting),input.addEventListener("mousemove",Input._stopEvent),input.addEventListener("mousedown",Input._stopEvent),input.addEventListener("touchmove",Input._stopEvent),input.setFontFace=function(fontFace){input.style.fontFamily=fontFace},Render.isConchApp||(input.setColor=function(color){input.style.color=color},input.setFontSize=function(fontSize){input.style.fontSize=fontSize+"px"})},Input._processInputting=function(e){var value,input=laya.display.Input.inputElement.target;input&&(value=laya.display.Input.inputElement.value,input._restrictPattern&&(value=value.replace(/\u2006|\x27/g,""),input._restrictPattern.test(value))&&(value=value.replace(input._restrictPattern,""),laya.display.Input.inputElement.value=value),input._text=value,input.event("input"))},Input._stopEvent=function(e){"touchmove"==e.type&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},Input.TYPE_TEXT="text",Input.TYPE_PASSWORD="password",Input.TYPE_EMAIL="email",Input.TYPE_URL="url",Input.TYPE_NUMBER="number",Input.TYPE_RANGE="range",Input.TYPE_DATE="date",Input.TYPE_MONTH="month",Input.TYPE_WEEK="week",Input.TYPE_TIME="time",Input.TYPE_DATE_TIME="datetime",Input.TYPE_DATE_TIME_LOCAL="datetime-local",Input.TYPE_SEARCH="search",Input.input=null,Input.area=null,Input.inputElement=null,Input.inputContainer=null,Input.confirmButton=null,Input.promptStyleDOM=null,Input.inputHeight=45,Input.isInputting=!1,Input.stageMatrix=null,__static(Input,["IOS_IFRAME",function(){return this.IOS_IFRAME=Browser.onIOS&&Browser.window.top!=Browser.window.self}]),Input}(Text),HTMLImage=function(){function HTMLImage(src,def){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,HTMLImage.__super.call(this),this._init_(src,def)}__class(HTMLImage,"laya.resource.HTMLImage",FileBitmap);var __proto=HTMLImage.prototype;return __proto._init_=function(src,def){this._src=src,this._source=new Browser.window.Image,def&&(def.onload&&(this.onload=def.onload),def.onerror&&(this.onerror=def.onerror),def.onCreate)&&def.onCreate(this),0!=src.indexOf("data:image")&&(this._source.crossOrigin=""),src&&(this._source.src=src)},__proto.recreateResource=function(){var _this,_$this=this;if(""===this._src)throw new Error("src no null！");this._needReleaseAgain=!1,this._source?this._recreateLock||(this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()):(this._recreateLock=!0,(_this=this)._source=new Browser.window.Image,this._source.crossOrigin="",this._source.onload=function(){_this._needReleaseAgain?(_this._needReleaseAgain=!1,_this._source.onload=null,_this._source=null):(_this._source.onload=null,_this.memorySize=_$this._w*_$this._h*4,_this._recreateLock=!1,_this.completeCreate())},this._source.src=this._src)},__proto.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},__proto.onresize=function(){this._w=this._source.width,this._h=this._source.height},__getset(0,__proto,"onload",null,function(value){var _$this=this;this._onload=value,this._source&&(this._source.onload=null!=this._onload?function(){_$this.onresize(),_$this._onload()}:null)}),__getset(0,__proto,"onerror",null,function(value){var _$this=this;this._onerror=value,this._source&&(this._source.onerror=null!=this._onerror?function(){_$this._onerror()}:null)}),__getset(0,__proto,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(value){this._enableMerageInAtlas=value,Render.isConchApp&&this._source&&(this._source.enableMerageInAtlas=value)}),HTMLImage.create=function(src,def){return new HTMLImage(src,def)},HTMLImage}(),GraphicAnimation=(function(_super){function EffectAnimation(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,EffectAnimation.__super.call(this)}__class(EffectAnimation,"laya.display.EffectAnimation",_super);var __proto=EffectAnimation.prototype;__proto._onOtherBegin=function(effect){effect!=this&&this.stop()},__proto.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},__proto._onPlayAction=function(){this.play(0,!1)},__proto.play=function(start,loop,name,showWarn){void 0===start&&(start=0),void 0===loop&&(loop=!0),void 0===name&&(name=""),void 0===showWarn&&(showWarn=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,start,loop,name,showWarn))},__proto._recordInitData=function(){if(this._aniKeys)for(var key,i=0,len=this._aniKeys.length,i=0;i<len;i++)key=this._aniKeys[i],this._initData[key]=this._target[key]},__proto._displayToIndex=function(value){if(this._animationData){(value=value<0?0:value)>this._count&&(value=this._count);for(var nodes=this._animationData.nodes,i=0,len=1<(len=nodes.length)?1:len,i=0;i<len;i++)this._displayNodeToFrame(nodes[i],value)}},__proto._displayNodeToFrame=function(node,frame,targetDic){if(this._target)for(var key,propFrames,startFrame,tSecondFrame,target=this._target,frames=node.frames,keys=node.keys,i=0,len=keys.length,secondFrames=node.secondFrames,i=0;i<len;i++)propFrames=frames[key=keys[i]],startFrame=-1==(tSecondFrame=secondFrames[key])?this._initData[key]:frame<tSecondFrame?(startFrame=(tSecondFrame=node.keyframes[key])[0]).tween?(null==(startFrame=Ease[startFrame.tweenMethod])&&(startFrame=Ease.linearNone),tSecondFrame=tSecondFrame[1],startFrame(frame,this._initData[key],tSecondFrame.value-this._initData[key],tSecondFrame.index)):this._initData[key]:propFrames.length>frame?propFrames[frame]:propFrames[propFrames.length-1],target[key]=startFrame},__proto._calculateNodeKeyFrames=function(node){_super.prototype._calculateNodeKeyFrames.call(this,node);var key,tKeyFrames,keyFrames=node.keyframes,secondFrames=(node.target,{});for(key in node.secondFrames=secondFrames,keyFrames)(tKeyFrames=keyFrames[key]).length<=1?secondFrames[key]=-1:secondFrames[key]=tKeyFrames[1].index},__getset(0,__proto,"target",function(){return this._target},function(v){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=v,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),__getset(0,__proto,"playEvent",null,function(event){(this._playEvents=event)&&this.addEvent()}),__getset(0,__proto,"effectData",null,function(uiData){uiData&&(uiData=uiData.animations)&&uiData[0]&&(this._setUp({},uiData[0]),uiData[0].nodes)&&uiData[0].nodes[0]&&(this._aniKeys=uiData[0].nodes[0].keys)}),__getset(0,__proto,"effectClass",null,function(classStr){this._effectClass=ClassUtils.getClass(classStr),this._effectClass&&(classStr=this._effectClass.uiView)&&(classStr=classStr.animations)&&classStr[0]&&(this._setUp({},classStr[0]),classStr[0].nodes)&&classStr[0].nodes[0]&&(this._aniKeys=classStr[0].nodes[0].keys)}),EffectAnimation.EffectAnimationBegin="effectanimationbegin"}(AnimationPlayerBase),function(_super){var GraphicNode;function GraphicAnimation(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,GraphicAnimation.__super.call(this)}__class(GraphicAnimation,"laya.utils.GraphicAnimation",_super);var __proto=GraphicAnimation.prototype;return __proto._parseNodeList=function(uiView){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[uiView.compId]=uiView.props,uiView.compId&&this._nodeList.push(uiView.compId);var childs=uiView.child;if(childs)for(var i=0,len=childs.length,i=0;i<len;i++)this._parseNodeList(childs[i])},__proto._calGraphicData=function(aniData){if(this._setUp(null,aniData),this._createGraphicData(),this._nodeIDAniDic)for(var key in this._nodeIDAniDic)this._nodeIDAniDic[key]=null},__proto._createGraphicData=function(){for(var preGraphic,gList=[],i=0,len=this.count,animationDataNew=(animationDataNew=this._animationNewFrames)||[],i=0;i<len;i++)!animationDataNew[i]&&preGraphic||(preGraphic=this._createFrameGraphic(i)),gList.push(preGraphic);this._gList=gList},__proto._createFrameGraphic=function(frame){var g=RunDriver.createGraphics();return GraphicAnimation._rootMatrix||(GraphicAnimation._rootMatrix=new Matrix),this._updateNodeGraphic(this._rootNode,frame,GraphicAnimation._rootMatrix,g),g},__proto._updateNodeGraphic=function(node,frame,parentTransfrom,g,alpha){void 0===alpha&&(alpha=1);var tNodeG,tResultTransform,childs,tGraphicAlpha=(tNodeG=this._nodeGDic[node.compId]=this._getNodeGraphicData(node.compId,frame,this._nodeGDic[node.compId])).alpha*alpha;if(!(tGraphicAlpha<.01)&&(tNodeG.resultTransform||(tNodeG.resultTransform=Matrix.create()),tResultTransform=tNodeG.resultTransform,Matrix.mul(tNodeG.transform,parentTransfrom,tResultTransform),tNodeG.skin&&(alpha=this._getTextureByUrl(tNodeG.skin))&&(tResultTransform._checkTransform()?(g.drawTexture(alpha,0,0,tNodeG.width,tNodeG.height,tResultTransform,tGraphicAlpha),tNodeG.resultTransform=null):g.drawTexture(alpha,tResultTransform.tx,tResultTransform.ty,tNodeG.width,tNodeG.height,null,tGraphicAlpha)),childs=node.child))for(var i=0,len=childs.length,i=0;i<len;i++)this._updateNodeGraphic(childs[i],frame,tResultTransform,g,tGraphicAlpha)},__proto._updateNoChilds=function(tNodeG,g){var tTex,tTransform;tNodeG.skin&&(tTex=this._getTextureByUrl(tNodeG.skin))&&((tTransform=tNodeG.transform)._checkTransform(),!tTransform.bTransform?g.drawTexture(tTex,tTransform.tx,tTransform.ty,tNodeG.width,tNodeG.height,null,tNodeG.alpha):g.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height,tTransform.clone(),tNodeG.alpha))},__proto._updateNodeGraphic2=function(node,frame,g){var tNodeG=this._nodeGDic[node.compId]=this._getNodeGraphicData(node.compId,frame,this._nodeGDic[node.compId]);if(node.child){var onlyTranslate,childs,ifSave,tTransform=tNodeG.transform,hasTrans=(tTransform._checkTransform(),(onlyTranslate=!tTransform.bTransform)&&(0!=tTransform.tx||0!=tTransform.ty));if((ifSave=tTransform.bTransform||1!=tNodeG.alpha)&&g.save(),1!=tNodeG.alpha&&g.alpha(tNodeG.alpha),onlyTranslate?hasTrans&&g.translate(tTransform.tx,tTransform.ty):g.transform(tTransform.clone()),childs=node.child,tNodeG.skin&&(node=this._getTextureByUrl(tNodeG.skin))&&g.drawTexture(node,0,0,tNodeG.width,tNodeG.height),childs)for(var i=0,len=childs.length,i=0;i<len;i++)this._updateNodeGraphic2(childs[i],frame,g);ifSave?g.restore():onlyTranslate?hasTrans&&g.translate(-tTransform.tx,-tTransform.ty):g.transform(tTransform.clone().invert())}else this._updateNoChilds(tNodeG,g)},__proto._calculateNodeKeyFrames=function(node){_super.prototype._calculateNodeKeyFrames.call(this,node),this._nodeIDAniDic[node.target]=node},__proto.getNodeDataByID=function(nodeID){return this._nodeIDAniDic[nodeID]},__proto._getParams=function(obj,params,frame,obj2){for(var rst=GraphicAnimation._temParam,i=(rst.length=params.length,0),len=params.length,i=0;i<len;i++)rst[i]=this._getObjVar(obj,params[i][0],frame,params[i][1],obj2);return rst},__proto._getObjVar=function(obj,key,frame,noValue,obj2){if(obj.hasOwnProperty(key)){var vArr=obj[key];if(frame>=vArr.length&&(frame=vArr.length-1),null!=obj[key][frame])return obj[key][frame]}return obj2.hasOwnProperty(key)?obj2[key]:noValue},__proto._getNodeGraphicData=function(nodeID,frame,rst){(rst=rst||GraphicNode.create()).transform?rst.transform.identity():rst.transform=Matrix.create();var sx,sy,rotate,skewX,skewY,tex,aY,height,aX,px,py,node=this.getNodeDataByID(nodeID);return node&&(node=node.frames,frame=(node=this._getParams(node,GraphicAnimation._drawTextureCmd,frame,this._nodeDefaultProps[nodeID]))[0],height=nodeID=NaN,px=node[5],py=node[6],aX=node[13],aY=node[14],sx=node[7],sy=node[8],rotate=node[9],skewX=node[11],skewY=node[12],nodeID=node[3],height=node[4],0!=nodeID&&0!=height||(frame=null),-1==nodeID&&(nodeID=0),-1==height&&(height=0),rst.skin=frame,rst.width=nodeID,rst.height=height,frame&&((tex=this._getTextureByUrl(frame))?(nodeID=nodeID||tex.sourceWidth,height=height||tex.sourceHeight):console.warn("lost skin:",frame,",you may load pics first")),rst.alpha=node[10],tex=rst.transform,0!=aY&&(py=aY*height),0==(px=0!=aX?aX*nodeID:px)&&0==py||tex.translate(-px,-py),frame=null,(rotate||1!==sx||1!==sy||skewX||skewY)&&((frame=GraphicAnimation._tempMt).identity(),frame.bTransform=!0,aY=.0174532922222222*(rotate-skewX),height=.0174532922222222*(rotate+skewY),aX=Math.cos(height),nodeID=Math.sin(height),px=Math.sin(aY),py=Math.cos(aY),frame.a=sx*aX,frame.b=sx*nodeID,frame.c=-sy*px,frame.d=sy*py,frame.tx=frame.ty=0),(tex=frame?Matrix.mul(tex,frame,tex):tex).translate(node[1],node[2])),rst},__proto._getTextureByUrl=function(url){return Loader.getRes(url)},__proto.setAniData=function(uiView,aniName){if(uiView.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=uiView,this._parseNodeList(uiView);for(var tAniO,aniDic={},anilist=[],animations=uiView.animations,i=0,len=animations.length,i=0;i<len;i++)if(tAniO=animations[i],this._labels=null,(!aniName||aniName==tAniO.name)&&tAniO){try{this._calGraphicData(tAniO)}catch(e){console.warn("parse animation fail:"+tAniO.name+",empty animation created"),this._gList=[]}var frameO={};frameO.interval=1e3/tAniO.frameRate,frameO.frames=this._gList,frameO.labels=this._labels,frameO.name=tAniO.name,anilist.push(frameO),aniDic[tAniO.name]=frameO}this.animationList=anilist,this.animationDic=aniDic}GraphicAnimation._temParam.length=0},__proto.parseByData=function(aniData){var rootNode=aniData.nodeRoot,aniO=aniData.aniO;delete aniData.nodeRoot,delete aniData.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=rootNode,this._parseNodeList(rootNode),this._labels=null;try{this._calGraphicData(aniO)}catch(e){console.warn("parse animation fail:"+aniO.name+",empty animation created"),this._gList=[]}rootNode=aniData;return rootNode.interval=1e3/aniO.frameRate,rootNode.frames=this._gList,rootNode.labels=this._labels,rootNode.name=aniO.name,rootNode},__proto.setUpAniData=function(uiView){if(uiView.animations){for(var frameO,tAniO,aniDic={},anilist=[],animations=uiView.animations,i=0,len=animations.length,i=0;i<len;i++)(tAniO=animations[i])&&((frameO={}).name=tAniO.name,frameO.aniO=tAniO,frameO.nodeRoot=uiView,anilist.push(frameO),aniDic[tAniO.name]=frameO);this.animationList=anilist,this.animationDic=aniDic}},__proto._clear=function(){var key,tGNode;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(key in this._nodeGDic)(tGNode=this._nodeGDic[key])&&tGNode.recover();this._nodeGDic=null},GraphicAnimation.parseAnimationByData=function(animationObject){animationObject=(GraphicAnimation._I=GraphicAnimation._I?GraphicAnimation._I:new GraphicAnimation).parseByData(animationObject);return GraphicAnimation._I._clear(),animationObject},GraphicAnimation.parseAnimationData=function(aniData){return(GraphicAnimation._I=GraphicAnimation._I?GraphicAnimation._I:new GraphicAnimation).setUpAniData(aniData),(aniData={}).animationList=GraphicAnimation._I.animationList,aniData.animationDic=GraphicAnimation._I.animationDic,GraphicAnimation._I._clear(),aniData},GraphicAnimation._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],GraphicAnimation._temParam=[],GraphicAnimation._I=null,GraphicAnimation._rootMatrix=null,__static(GraphicAnimation,["_tempMt",function(){return this._tempMt=new Matrix}]),GraphicAnimation.__init$=function(){GraphicNode=function(){function GraphicNode(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return __class(GraphicNode,""),GraphicNode.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),Pool.recover("GraphicNode",this)},GraphicNode.create=function(){return Pool.getItemByClass("GraphicNode",GraphicNode)},GraphicNode}()},GraphicAnimation}(AnimationPlayerBase));Laya.__init([EventDispatcher,LoaderManager,Render,Browser,Timer,LocalStorage,TimeLine,GraphicAnimation])}(window,document,Laya),!function(Laya){Laya.un,Laya.uns,Laya.static;var __class=Laya.class;Laya.getset,Laya.__newvec;new(function(){function LayaMain(){}return __class(LayaMain,"LayaMain"),LayaMain}())}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(require,exports){"use strict";for(var i in Object.defineProperty(exports,"__esModule",{value:!0}),Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o)}}),!function(window,Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,Browser=(Laya.__newvec,laya.utils.Browser),EventDispatcher=(laya.events.Event,laya.events.EventDispatcher),HTMLImage=laya.resource.HTMLImage,Handler=laya.utils.Handler,Input=laya.display.Input,Loader=laya.net.Loader,LocalStorage=laya.net.LocalStorage,Render=(laya.maths.Matrix,laya.renders.Render),RunDriver=laya.utils.RunDriver,SoundChannel=laya.media.SoundChannel,SoundManager=laya.media.SoundManager,URL=laya.net.URL,Utils=laya.utils.Utils,MiniAdpter=function(){function MiniAdpter(){}return __class(MiniAdpter,"laya.wx.mini.MiniAdpter"),MiniAdpter.getJson=function(data){return JSON.parse(data)},MiniAdpter.init=function(isPosMsg,isSon){if(void 0===isPosMsg&&(isPosMsg=!1),void 0===isSon&&(isSon=!1),!(MiniAdpter._inited||(MiniAdpter._inited=!0,(MiniAdpter.window=window).navigator.userAgent.indexOf("MiniGame")<0))){MiniAdpter.isZiYu=isSon,MiniAdpter.isPosMsgYu=isPosMsg,MiniAdpter.EnvConfig={};try{laya.webgl.resource.WebGLCanvas.premulAlpha=!0}catch(e){}MiniAdpter.isZiYu||(MiniFileMgr.setNativeFileDir("/layaairGame"),MiniFileMgr.existDir(MiniFileMgr.fileNativeDir,Handler.create(MiniAdpter,MiniAdpter.onMkdirCallBack))),MiniAdpter.systemInfo=wx.getSystemInfoSync(),MiniAdpter.window.focus=function(){},Laya._getUrlPath=function(){},MiniAdpter.window.logtime=function(str){},MiniAdpter.window.alertTimeLog=function(str){},MiniAdpter.window.resetShareInfo=function(){},MiniAdpter.window.CanvasRenderingContext2D=function(){},MiniAdpter.window.CanvasRenderingContext2D.prototype=MiniAdpter.window.wx.createCanvas().getContext("2d").__proto__,MiniAdpter.window.document.body.appendChild=function(){},MiniAdpter.EnvConfig.pixelRatioInt=0,RunDriver.getPixelRatio=MiniAdpter.pixelRatio,MiniAdpter._preCreateElement=Browser.createElement,Browser.createElement=MiniAdpter.createElement,RunDriver.createShaderCondition=MiniAdpter.createShaderCondition,Utils.parseXMLFromString=MiniAdpter.parseXMLFromString,Input._createInputElement=MiniInput._createInputElement,MiniAdpter.EnvConfig.load=Loader.prototype.load,Loader.prototype.load=MiniLoader.prototype.load,Loader.prototype._loadImage=MiniImage.prototype._loadImage,(LocalStorage._baseClass=MiniLocalStorage).__init__(),MiniAdpter.onReciveData()}},MiniAdpter.onReciveData=function(){laya.wx.mini.MiniAdpter.isZiYu&&wx.onMessage(function(message){"opendatacontext"==message.isLoad?message.url&&(MiniFileMgr.ziyuFileData[message.url]=message.atlasdata,MiniFileMgr.ziyuFileTextureData[message.imgReadyUrl]=message.imgNativeUrl):"openJsondatacontext"==message.isLoad&&message.url&&(MiniFileMgr.ziyuFileData[message.url]=message.atlasdata)})},MiniAdpter.measureText=function(str){str=MiniAdpter._measureText(str);return str||(str={width:16},console.warn("-------微信获取文字宽度失败----等待修复---------")),str},MiniAdpter.getUrlEncode=function(url,type){return-1!=url.indexOf(".fnt")?"utf8":"arraybuffer"==type?"":"ascii"},MiniAdpter.downLoadFile=function(fileUrl,fileType,callBack,encoding){void 0===fileType&&(fileType=""),void 0===encoding&&(encoding="ascii"),MiniFileMgr.getFileInfo(fileUrl)?null!=callBack&&callBack.runWith([0]):MiniFileMgr.downLoadFile(fileUrl,fileType,callBack,encoding)},MiniAdpter.remove=function(fileUrl,callBack){MiniFileMgr.deleteFile("",fileUrl,callBack,"",0)},MiniAdpter.removeAll=function(){MiniFileMgr.deleteAll()},MiniAdpter.hasNativeFile=function(fileUrl){return MiniFileMgr.isLocalNativeFile(fileUrl)},MiniAdpter.getFileInfo=function(fileUrl){return MiniFileMgr.getFileInfo(fileUrl)},MiniAdpter.getFileList=function(){return MiniFileMgr.filesListObj},MiniAdpter.exitMiniProgram=function(){MiniAdpter.window.wx.exitMiniProgram()},MiniAdpter.onMkdirCallBack=function(errorCode,data){errorCode||(MiniFileMgr.filesListObj=JSON.parse(data.data))},MiniAdpter.pixelRatio=function(){if(!MiniAdpter.EnvConfig.pixelRatioInt)try{return MiniAdpter.EnvConfig.pixelRatioInt=MiniAdpter.systemInfo.pixelRatio,MiniAdpter.systemInfo.pixelRatio}catch(error){}return MiniAdpter.EnvConfig.pixelRatioInt},MiniAdpter.createElement=function(type){var _source;return"canvas"==type?(1==MiniAdpter.idx?MiniAdpter.isZiYu?(_source=sharedCanvas).style={}:_source=window.canvas:_source=window.wx.createCanvas(),MiniAdpter.idx++,_source):"textarea"==type||"input"==type?MiniAdpter.onCreateInput(type):"div"==type?((_source=MiniAdpter._preCreateElement(type)).contains=function(value){return null},_source.removeChild=function(value){},_source):MiniAdpter._preCreateElement(type)},MiniAdpter.onCreateInput=function(type){type=MiniAdpter._preCreateElement(type);return type.focus=MiniInput.wxinputFocus,type.blur=MiniInput.wxinputblur,type.style={},type.value=0,type.parentElement={},type.placeholder={},type.type={},type.setColor=function(value){},type.setType=function(value){},type.setFontFace=function(value){},type.addEventListener=function(value){},type.contains=function(value){return null},type.removeChild=function(value){},type},MiniAdpter.createShaderCondition=function(conditionScript){var _$this=this;return function(){return _$this[conditionScript.replace("this.","")]}},MiniAdpter.sendAtlasToOpenDataContext=function(url){if(!laya.wx.mini.MiniAdpter.isZiYu){var atlasJson=Loader.getRes(url);if(!atlasJson)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";var atlasJson={frames:atlasJson.frames,meta:atlasJson.meta},textureUrl=url.indexOf(".atlas")?url.replace(".atlas",".png"):url.replace(".json",".png"),fileMd5Name=MiniFileMgr.getFileInfo(textureUrl).md5,fileMd5Name=MiniFileMgr.getFileNativePath(fileMd5Name);if(!fileMd5Name)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:url,atlasdata:atlasJson,imgNativeUrl:fileMd5Name,imgReadyUrl:textureUrl,isLoad:"opendatacontext"})}},MiniAdpter.sendJsonDataToDataContext=function(url){if(!laya.wx.mini.MiniAdpter.isZiYu){var atlasJson=Loader.getRes(url);if(!atlasJson)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";wx.postMessage({url:url,atlasdata:atlasJson,isLoad:"openJsondatacontext"})}},MiniAdpter.EnvConfig=null,MiniAdpter.window=null,MiniAdpter._preCreateElement=null,MiniAdpter._inited=!1,MiniAdpter.systemInfo=null,MiniAdpter.isZiYu=!1,MiniAdpter.isPosMsgYu=!1,MiniAdpter.autoCacheFile=!0,MiniAdpter.minClearSize=5242880,MiniAdpter.AutoCacheDownFile=!1,MiniAdpter._measureText=null,MiniAdpter.parseXMLFromString=function(value){var rst;value=value.replace(/>\s+</g,"><");try{rst=(new window.Parser.DOMParser).parseFromString(value,"text/xml")}catch(error){throw"需要引入xml解析库文件"}return rst},MiniAdpter.idx=1,__static(MiniAdpter,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),MiniAdpter}(),MiniFileMgr=function(){function MiniFileMgr(){}return __class(MiniFileMgr,"laya.wx.mini.MiniFileMgr"),MiniFileMgr.isLocalNativeFile=function(url){for(var i=0,sz=MiniAdpter.nativefiles.length;i<sz;i++)if(-1!=url.indexOf(MiniAdpter.nativefiles[i]))return!0;return!1},MiniFileMgr.getFileInfo=function(fileUrl){fileUrl=MiniFileMgr.filesListObj[fileUrl];return null==fileUrl?null:fileUrl},MiniFileMgr.read=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType){void 0===encoding&&(encoding="ascill"),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),filePath=""==(readyUrl=void 0===readyUrl?"":readyUrl)||-1==readyUrl.indexOf("http://")&&-1==readyUrl.indexOf("https://")?filePath:MiniFileMgr.getFileNativePath(filePath),MiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function(data){null!=callBack&&callBack.runWith([0,data])},fail:function(data){data&&""!=readyUrl?MiniFileMgr.downFiles(readyUrl,encoding,callBack,readyUrl,isSaveFile,fileType):null!=callBack&&callBack.runWith([1])}})},MiniFileMgr.downFiles=function(fileUrl,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear){void 0===encoding&&(encoding="ascii"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.wxdown({url:fileUrl,success:function(data){200===data.statusCode?MiniFileMgr.readFile(data.tempFilePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear):null!=callBack&&callBack.runWith([1,data])},fail:function(data){null!=callBack&&callBack.runWith([1,data])}}).onProgressUpdate(function(data){null!=callBack&&callBack.runWith([2,data.progress])})},MiniFileMgr.readFile=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear){void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function(data){-1!=filePath.indexOf("http://")||-1!=filePath.indexOf("https://")?(MiniAdpter.autoCacheFile||isSaveFile)&&MiniFileMgr.copyFile(filePath,readyUrl,callBack,encoding,isAutoClear):null!=callBack&&callBack.runWith([0,data])},fail:function(data){data&&null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.downOtherFiles=function(fileUrl,callBack,readyUrl,isSaveFile,isAutoClear){void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.wxdown({url:fileUrl,success:function(data){200===data.statusCode&&((MiniAdpter.autoCacheFile||isSaveFile)&&-1==readyUrl.indexOf("wx.qlogo.cn")&&-1==readyUrl.indexOf(".php")?MiniFileMgr.copyFile(data.tempFilePath,readyUrl,callBack,"",isAutoClear):null!=callBack&&callBack.runWith([0,data.tempFilePath]))},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.downLoadFile=function(fileUrl,fileType,callBack,encoding){void 0===fileType&&(fileType=""),void 0===encoding&&(encoding="ascii"),window.navigator.userAgent.indexOf("MiniGame")<0?Laya.loader.load(fileUrl,callBack):"image"==fileType||"sound"==fileType?MiniFileMgr.downOtherFiles(fileUrl,callBack,fileUrl,!0,!1):MiniFileMgr.downFiles(fileUrl,encoding,callBack,fileUrl,!0,fileType,!1)},MiniFileMgr.copyFile=function(tempFilePath,readyUrl,callBack,encoding,isAutoClear){void 0===encoding&&(encoding=""),void 0===isAutoClear&&(isAutoClear=!0);var temp=tempFilePath.split("/"),tempFileName=temp[temp.length-1],temp=MiniFileMgr.getFileInfo(readyUrl),saveFilePath=MiniFileMgr.getFileNativePath(tempFileName),fileUseSize=MiniFileMgr.getCacheUseSize();temp?temp.readyUrl!=readyUrl?MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){isAutoClear&&52428800<=fileUseSize+4194304+data.size&&(data.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=data.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.deleteFile(tempFileName,readyUrl,callBack,encoding,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}}):null!=callBack&&callBack.runWith([0]):MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){isAutoClear&&52428800<=fileUseSize+4194304+data.size&&(data.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=data.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.fs.copyFile({srcPath:tempFilePath,destPath:saveFilePath,success:function(data2){MiniFileMgr.onSaveFile(readyUrl,tempFileName,!0,encoding,callBack,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.onClearCacheRes=function(){var key,memSize=MiniAdpter.minClearSize,tempFileListArr=[];for(key in MiniFileMgr.filesListObj)tempFileListArr.push(MiniFileMgr.filesListObj[key]);MiniFileMgr.sortOn(tempFileListArr,"time",16);for(var clearSize=0,i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];if(memSize<=clearSize)break;clearSize+=fileObj.size,MiniFileMgr.deleteFile("",fileObj.readyUrl)}},MiniFileMgr.sortOn=function(array,name,options){return 16==(options=void 0===options?0:options)?array.sort(function(a,b){return a[name]-b[name]}):18==options?array.sort(function(a,b){return b[name]-a[name]}):array.sort(function(a,b){return a[name]-b[name]})},MiniFileMgr.getFileNativePath=function(fileName){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+fileName},MiniFileMgr.deleteFile=function(tempFileName,readyUrl,callBack,encoding,fileSize){void 0===readyUrl&&(readyUrl=""),void 0===encoding&&(encoding=""),void 0===fileSize&&(fileSize=0);var fileObj=MiniFileMgr.getFileInfo(readyUrl),fileObj=MiniFileMgr.getFileNativePath(fileObj.md5);MiniFileMgr.fs.unlink({filePath:fileObj,success:function(data){var saveFilePath,isAdd=""!=tempFileName;""!=tempFileName?(saveFilePath=MiniFileMgr.getFileNativePath(tempFileName),MiniFileMgr.fs.copyFile({srcPath:tempFileName,destPath:saveFilePath,success:function(data){MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})):MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,fileSize)},fail:function(data){}})},MiniFileMgr.deleteAll=function(){var key,tempFileListArr=[];for(key in MiniFileMgr.filesListObj)tempFileListArr.push(MiniFileMgr.filesListObj[key]);for(var i=1,sz=tempFileListArr.length;i<sz;i++)MiniFileMgr.deleteFile("",tempFileListArr[i].readyUrl)},MiniFileMgr.onSaveFile=function(readyUrl,md5Name,isAdd,encoding,callBack,fileSize){void 0===isAdd&&(isAdd=!0),void 0===encoding&&(encoding=""),void 0===fileSize&&(fileSize=0);var fileurlkey=readyUrl;null==MiniFileMgr.filesListObj.fileUsedSize&&(MiniFileMgr.filesListObj.fileUsedSize=0),isAdd?(MiniFileMgr.getFileNativePath(md5Name),MiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl,size:fileSize,times:Browser.now(),encoding:encoding},MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)+fileSize,MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),!0),null!=callBack&&callBack.runWith([0])):MiniFileMgr.filesListObj[fileurlkey]&&(isAdd=parseInt(MiniFileMgr.filesListObj[fileurlkey].size),MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)-isAdd,delete MiniFileMgr.filesListObj[fileurlkey],MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),!1),null!=callBack)&&callBack.runWith([0])},MiniFileMgr.writeFilesList=function(fileurlkey,filesListStr,isAdd){MiniFileMgr.fs.writeFile({filePath:MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName,encoding:"utf8",data:filesListStr,success:function(data){},fail:function(data){}}),!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&wx.postMessage({url:fileurlkey,data:MiniFileMgr.filesListObj[fileurlkey],isLoad:"filenative",isAdd:isAdd})},MiniFileMgr.getCacheUseSize=function(){return MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize?MiniFileMgr.filesListObj.fileUsedSize:0},MiniFileMgr.existDir=function(dirPath,callBack){MiniFileMgr.fs.mkdir({dirPath:dirPath,success:function(data){null!=callBack&&callBack.runWith([0,{data:JSON.stringify({})}])},fail:function(data){-1!=data.errMsg.indexOf("file already exists")?MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",callBack):null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.readSync=function(filePath,encoding,callBack,readyUrl){void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl="");var filesListStr,readyUrl=MiniFileMgr.getFileNativePath(filePath);try{filesListStr=MiniFileMgr.fs.readFileSync(readyUrl,encoding),null!=callBack&&callBack.runWith([0,{data:filesListStr}])}catch(error){null!=callBack&&callBack.runWith([1])}},MiniFileMgr.setNativeFileDir=function(value){MiniFileMgr.fileNativeDir=wx.env.USER_DATA_PATH+value},MiniFileMgr.filesListObj={},MiniFileMgr.fileNativeDir=null,MiniFileMgr.fileListName="layaairfiles.txt",MiniFileMgr.ziyuFileData={},MiniFileMgr.ziyuFileTextureData={},MiniFileMgr.loadPath="",MiniFileMgr.DESCENDING=2,MiniFileMgr.NUMERIC=16,__static(MiniFileMgr,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),MiniFileMgr}(),MiniImage=function(){function MiniImage(){}return __class(MiniImage,"laya.wx.mini.MiniImage"),MiniImage.prototype._loadImage=function(url){var isTransformUrl,tempStr;MiniAdpter.isZiYu?MiniImage.onCreateImage(url,this,!0):(isTransformUrl=!1,MiniFileMgr.isLocalNativeFile(url)?-1==url.indexOf("http://")&&-1==url.indexOf("https://")||(""!=MiniFileMgr.loadPath?url=url.split(MiniFileMgr.loadPath)[1]:""!=(tempStr=""!=URL.rootPath?URL.rootPath:URL.basePath)&&(url=url.split(tempStr)[1])):(isTransformUrl=!0,url=URL.formatURL(url)),MiniFileMgr.getFileInfo(url)?MiniImage.onCreateImage(url,this,!isTransformUrl):-1==url.indexOf("http://")&&-1==url.indexOf("https://")||MiniAdpter.isZiYu?MiniImage.onCreateImage(url,this,!0):MiniFileMgr.downOtherFiles(url,new Handler(MiniImage,MiniImage.onDownImgCallBack,[url,this]),url))},MiniImage.onDownImgCallBack=function(sourceUrl,thisLoader,errorCode,tempFilePath){void 0===tempFilePath&&(tempFilePath=""),errorCode?thisLoader.onError(null):MiniImage.onCreateImage(sourceUrl,thisLoader,!1,tempFilePath)},MiniImage.onCreateImage=function(sourceUrl,thisLoader,isLocal,tempFilePath){var tempUrl,image;function clear(){image.onload=null,image.onerror=null,delete thisLoader.imgCache[sourceUrl]}void 0===isLocal&&(isLocal=!1),void 0===tempFilePath&&(tempFilePath=""),tempUrl=MiniAdpter.autoCacheFile?isLocal?MiniAdpter.isZiYu&&(tempUrl=URL.formatURL(sourceUrl),MiniFileMgr.ziyuFileTextureData[tempUrl])||sourceUrl:""!=tempFilePath?tempFilePath:(tempUrl=MiniFileMgr.getFileInfo(sourceUrl).md5,MiniFileMgr.getFileNativePath(tempUrl)):isLocal?sourceUrl:tempFilePath,null==thisLoader.imgCache&&(thisLoader.imgCache={});function onload(){clear(),thisLoader._url=URL.formatURL(thisLoader._url),thisLoader.onLoaded(image)}function onerror(){clear(),thisLoader.event("error","Load image failed")}"nativeimage"==thisLoader._type?((image=new Browser.window.Image).crossOrigin="",image.onload=onload,image.onerror=onerror,image.src=tempUrl,thisLoader.imgCache[sourceUrl]=image):new HTMLImage.create(tempUrl,{onload:onload,onerror:onerror,onCreate:function(img){image=img,thisLoader.imgCache[sourceUrl]=img}})},MiniImage}(),MiniInput=function(){function MiniInput(){}return __class(MiniInput,"laya.wx.mini.MiniInput"),MiniInput._createInputElement=function(){Input._initInput(Input.area=Browser.createElement("textarea")),Input._initInput(Input.input=Browser.createElement("input")),Input.inputContainer=Browser.createElement("div"),Input.inputContainer.style.position="absolute",Input.inputContainer.style.zIndex=1e5,Browser.container.appendChild(Input.inputContainer),Input.inputContainer.setPos=function(x,y){Input.inputContainer.style.left=x+"px",Input.inputContainer.style.top=y+"px"},Laya.stage.on("resize",null,MiniInput._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(res){window.dispatchEvent&&window.dispatchEvent("resize")}),SoundManager._soundClass=MiniSound,SoundManager._musicClass=MiniSound;var model=MiniAdpter.systemInfo.model,system=MiniAdpter.systemInfo.system;-1!=model.indexOf("iPhone")&&(Browser.onIPhone=!0,Browser.onIOS=!0,Browser.onIPad=!0,Browser.onAndroid=!1),-1==system.indexOf("Android")&&-1==system.indexOf("Adr")||(Browser.onAndroid=!0,Browser.onIPhone=!1,Browser.onIOS=!1,Browser.onIPad=!1)},MiniInput._onStageResize=function(){Laya.stage._canvasTransform.identity().scale(Browser.width/Render.canvas.width/RunDriver.getPixelRatio(),Browser.height/Render.canvas.height/RunDriver.getPixelRatio())},MiniInput.wxinputFocus=function(e){var _inputTarget=Input.inputElement.target;_inputTarget&&!_inputTarget.editable||(MiniAdpter.window.wx.offKeyboardConfirm(),MiniAdpter.window.wx.offKeyboardInput(),MiniAdpter.window.wx.showKeyboard({defaultValue:_inputTarget.text,maxLength:_inputTarget.maxChars,multiple:_inputTarget.multiline,confirmHold:!0,confirmType:"done",success:function(res){},fail:function(res){}}),MiniAdpter.window.wx.onKeyboardConfirm(function(res){res=res?res.value:"";_inputTarget.text=res,_inputTarget.event("input"),laya.wx.mini.MiniInput.inputEnter()}),MiniAdpter.window.wx.onKeyboardInput(function(res){res=res?res.value:"";_inputTarget.multiline||-1==res.indexOf("\n")?(_inputTarget.text=res,_inputTarget.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},MiniInput.inputEnter=function(){Input.inputElement.target.focus=!1},MiniInput.wxinputblur=function(){MiniInput.hideKeyboard()},MiniInput.hideKeyboard=function(){MiniAdpter.window.wx.offKeyboardConfirm(),MiniAdpter.window.wx.offKeyboardInput(),MiniAdpter.window.wx.hideKeyboard({success:function(res){console.log("隐藏键盘")},fail:function(res){console.log("隐藏键盘出错:"+(res?res.errMsg:""))}})},MiniInput}(),MiniLocalStorage=function(){function MiniLocalStorage(){}return __class(MiniLocalStorage,"laya.wx.mini.MiniLocalStorage"),MiniLocalStorage.__init__=function(){MiniLocalStorage.items=MiniLocalStorage},MiniLocalStorage.setItem=function(key,value){try{wx.setStorageSync(key,value)}catch(error){wx.setStorage({key:key,data:value})}},MiniLocalStorage.getItem=function(key){return wx.getStorageSync(key)},MiniLocalStorage.setJSON=function(key,value){MiniLocalStorage.setItem(key,value)},MiniLocalStorage.getJSON=function(key){return MiniLocalStorage.getItem(key)},MiniLocalStorage.removeItem=function(key){wx.removeStorageSync(key)},MiniLocalStorage.clear=function(){wx.clearStorageSync()},MiniLocalStorage.getStorageInfoSync=function(){try{var res=wx.getStorageInfoSync();return console.log(res.keys),console.log(res.currentSize),console.log(res.limitSize),res}catch(e){}return null},MiniLocalStorage.support=!0,MiniLocalStorage.items=null,MiniLocalStorage}(),MiniLoader=(function(){function MiniLocation(){}__class(MiniLocation,"laya.wx.mini.MiniLocation"),MiniLocation.__init__=function(){MiniAdpter.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition,MiniAdpter.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition,MiniAdpter.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch},MiniLocation.getCurrentPosition=function(success,error,options){var paramO;(paramO={success:function(res){null!=success&&success(res)}}).fail=error,MiniAdpter.window.wx.getLocation(paramO)},MiniLocation.watchPosition=function(success,error,options){var curWatchO;return MiniLocation._curID++,(curWatchO={}).success=success,curWatchO.error=error,MiniLocation._watchDic[MiniLocation._curID]=curWatchO,Laya.timer.loop(1e3,null,MiniLocation._myLoop),MiniLocation._curID},MiniLocation.clearWatch=function(id){delete MiniLocation._watchDic[id],MiniLocation._hasWatch()||Laya.timer.clear(null,MiniLocation._myLoop)},MiniLocation._hasWatch=function(){for(var key in MiniLocation._watchDic)if(MiniLocation._watchDic[key])return!0;return!1},MiniLocation._myLoop=function(){MiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError)},MiniLocation._mySuccess=function(res){var key,rst={};for(key in rst.coords=res,rst.timestamp=Browser.now(),MiniLocation._watchDic)MiniLocation._watchDic[key].success&&MiniLocation._watchDic[key].success(rst)},MiniLocation._myError=function(res){for(var key in MiniLocation._watchDic)MiniLocation._watchDic[key].error&&MiniLocation._watchDic[key].error(res)},MiniLocation._watchDic={},MiniLocation._curID=0}(),function(_super){function MiniAccelerator(){MiniAccelerator.__super.call(this)}__class(MiniAccelerator,"laya.wx.mini.MiniAccelerator",_super);var __proto=MiniAccelerator.prototype;__proto.on=function(type,caller,listener,args){return _super.prototype.on.call(this,type,caller,listener,args),MiniAccelerator.startListen(this.onDeviceOrientationChange),this},__proto.off=function(type,caller,listener,onceOnly){return void 0===onceOnly&&(onceOnly=!1),this.hasListener(type)||MiniAccelerator.stopListen(),_super.prototype.off.call(this,type,caller,listener,onceOnly)},MiniAccelerator.__init__=function(){try{var Acc=laya.device.motion.Accelerator;Acc&&(Acc.prototype.on=MiniAccelerator.prototype.on,Acc.prototype.off=MiniAccelerator.prototype.off)}catch(e){}},MiniAccelerator.startListen=function(callBack){if(MiniAccelerator._callBack=callBack,!MiniAccelerator._isListening){MiniAccelerator._isListening=!0;try{wx.onAccelerometerChange(MiniAccelerator.onAccelerometerChange)}catch(e){}}},MiniAccelerator.stopListen=function(){MiniAccelerator._isListening=!1;try{wx.stopAccelerometer({})}catch(e){}},MiniAccelerator.onAccelerometerChange=function(res){var e={};e.acceleration=res,e.accelerationIncludingGravity=res,e.rotationRate={},null!=MiniAccelerator._callBack&&MiniAccelerator._callBack(e)},MiniAccelerator._isListening=!1,MiniAccelerator._callBack=null}(EventDispatcher),function(){function MiniLoader(){MiniLoader.__super.call(this)}return __class(MiniLoader,"laya.wx.mini.MiniLoader",EventDispatcher),MiniLoader.prototype.load=function(url,type,cache,group,ignoreCache){void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1);var encoding,urlType;0===(this._url=url).indexOf("data:image")?this._type=type="image":this._type=type=type||this.getTypeFromUrl(url),this._cache=cache,this._data=null,!ignoreCache&&Loader.loadedMap[URL.formatURL(url)]?(this._data=Loader.loadedMap[URL.formatURL(url)],this.event("progress",1),this.event("complete",this._data)):null!=Loader.parserMap[type]?(this._customParse=!0,Loader.parserMap[type]instanceof laya.utils.Handler?Loader.parserMap[type].runWith(this):Loader.parserMap[type].call(null,this)):(encoding=MiniAdpter.getUrlEncode(url,type),urlType=Utils.getFileExtension(url),-1!=MiniLoader._fileTypeArr.indexOf(urlType)?MiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache):(MiniAdpter.isZiYu&&!MiniFileMgr.ziyuFileData[url]&&(url=URL.formatURL(url)),MiniAdpter.isZiYu&&MiniFileMgr.ziyuFileData[url]?(urlType=MiniFileMgr.ziyuFileData[url],this.onLoaded(urlType)):MiniFileMgr.getFileInfo(url)?((urlType=MiniFileMgr.getFileInfo(url)).encoding=null==urlType.encoding?"ascii":urlType.encoding,MiniFileMgr.readFile(url,urlType.encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]),url)):MiniFileMgr.isLocalNativeFile(url)?MiniFileMgr.read(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this])):(urlType=url,-1!=(url=URL.formatURL(url)).indexOf("http://")||-1!=url.indexOf("https://")?MiniAdpter.EnvConfig.load.call(this,urlType,type,cache,group,ignoreCache):MiniFileMgr.readFile(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]),url))))},MiniLoader.onReadNativeCallBack=function(encoding,url,type,cache,group,ignoreCache,thisLoader,errorCode,data){void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),(errorCode=void 0===errorCode?0:errorCode)?1==errorCode&&(console.log("-----------本地加载失败，尝试外网加载----"),MiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache)):(errorCode="json"==type||"atlas"==type?MiniAdpter.getJson(data.data):"xml"==type?Utils.parseXMLFromString(data.data):data.data,!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&"arraybuffer"!=type&&wx.postMessage({url:url,data:errorCode,isLoad:"filedata"}),thisLoader.onLoaded(errorCode))},__static(MiniLoader,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),MiniLoader}()),MiniSound=function(){function MiniSound(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,MiniSound.__super.call(this)}__class(MiniSound,"laya.wx.mini.MiniSound",EventDispatcher);var __proto=MiniSound.prototype;return __proto.load=function(url){var tempStr;MiniFileMgr.isLocalNativeFile(url)?-1==url.indexOf("http://")&&-1==url.indexOf("https://")||(""!=MiniFileMgr.loadPath?url=url.split(MiniFileMgr.loadPath)[1]:""!=(tempStr=""!=URL.rootPath?URL.rootPath:URL.basePath)&&(url=url.split(tempStr)[1])):url=URL.formatURL(url),this.url=url,this.readyUrl=url,MiniSound._audioCache[this.readyUrl]?this.event("complete"):(!MiniAdpter.autoCacheFile||!MiniFileMgr.getFileInfo(url))&&MiniAdpter.autoCacheFile?MiniFileMgr.downOtherFiles(url,Handler.create(this,this.onDownLoadCallBack,[url]),url):this.onDownLoadCallBack(url,0)},__proto.onDownLoadCallBack=function(sourceUrl,errorCode){errorCode?this.event("error"):(MiniAdpter.autoCacheFile?(errorCode=(errorCode=MiniFileMgr.getFileInfo(sourceUrl))&&errorCode.md5?(errorCode=errorCode.md5,MiniFileMgr.getFileNativePath(errorCode)):sourceUrl,this._sound=MiniSound._createSound(),this._sound.src=this.url=errorCode):(this._sound=MiniSound._createSound(),this._sound.src=sourceUrl),this._sound.onCanplay(MiniSound.bindToThis(this.onCanPlay,this)),this._sound.onError(MiniSound.bindToThis(this.onError,this)))},__proto.onError=function(error){try{console.log("-----1---------------minisound-----id:"+MiniSound._id),console.log(error)}catch(error){console.log("-----2---------------minisound-----id:"+MiniSound._id),console.log(error)}this.event("error"),this._sound.offError(null)},__proto.onCanPlay=function(){this.loaded=!0,this.event("complete"),this._sound.offCanplay(null)},__proto.play=function(startTime,loops){void 0===startTime&&(startTime=0),void 0===loops&&(loops=0),tSound=this.url==SoundManager._tMusic?MiniSound._musicAudio=MiniSound._musicAudio||MiniSound._createSound():MiniSound._audioCache[this.readyUrl]?MiniSound._audioCache[this.readyUrl]._sound:MiniSound._createSound(),MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(this.url)?(fileMd5Name=MiniFileMgr.getFileInfo(this.url).md5,tSound.src=this.url=MiniFileMgr.getFileNativePath(fileMd5Name)):tSound.src=this.url;var tSound,fileMd5Name=new MiniSoundChannel(tSound,this);return fileMd5Name.url=this.url,fileMd5Name.loops=loops,fileMd5Name.loop=0===loops,fileMd5Name.startTime=startTime,fileMd5Name.play(),SoundManager.addChannel(fileMd5Name),fileMd5Name},__proto.dispose=function(){var ad=MiniSound._audioCache[this.readyUrl];ad&&(ad.src="",ad._sound&&(ad._sound.destroy(),ad._sound=null,ad=null),delete MiniSound._audioCache[this.readyUrl])},__getset(0,__proto,"duration",function(){return this._sound.duration}),MiniSound._createSound=function(){return MiniSound._id++,MiniAdpter.window.wx.createInnerAudioContext()},MiniSound.bindToThis=function(fun,scope){return fun.bind(scope)},MiniSound._musicAudio=null,MiniSound._id=0,MiniSound._audioCache={},MiniSound}(),MiniSoundChannel=function(){function MiniSoundChannel(audio,miniSound){this._audio=null,this._onEnd=null,this._miniSound=null,MiniSoundChannel.__super.call(this),this._audio=audio,this._miniSound=miniSound,this._onEnd=MiniSoundChannel.bindToThis(this.__onEnd,this),audio.onEnded(this._onEnd)}__class(MiniSoundChannel,"laya.wx.mini.MiniSoundChannel",SoundChannel);var __proto=MiniSoundChannel.prototype;return __proto.__onEnd=function(){1==this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),this.event("complete")):(0<this.loops&&this.loops--,this.startTime=0,this.play())},__proto.play=function(){this.isStopped=!1,SoundManager.addChannel(this),this._audio.play()},__proto.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.offEnded(null),this._audio=null,this._miniSound=null,this._onEnd=null)},__proto.pause=function(){this.isStopped=!0,this._audio.pause()},__proto.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),this._audio.play())},__getset(0,__proto,"startTime",null,function(time){this._audio&&(this._audio.startTime=time)}),__getset(0,__proto,"autoplay",function(){return this._audio.autoplay},function(value){this._audio.autoplay=value}),__getset(0,__proto,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,__proto,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,__proto,"loop",function(){return this._audio.loop},function(value){this._audio.loop=value}),__getset(0,__proto,"volume",function(){return this._audio?this._audio.volume:1},function(v){this._audio&&(this._audio.volume=v)}),MiniSoundChannel.bindToThis=function(fun,scope){return fun.bind(scope)},MiniSoundChannel}()}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(require,exports){"use strict";for(var i in Object.defineProperty(exports,"__esModule",{value:!0}),Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o)}}),!function(Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec,Arith=laya.maths.Arith,Bezier=laya.maths.Bezier,Bitmap=laya.resource.Bitmap,Browser=laya.utils.Browser,Byte=laya.utils.Byte,Color=laya.utils.Color,Config=(laya.filters.ColorFilter,Laya.Config),Context=laya.resource.Context,Filter=(laya.events.Event,laya.filters.Filter),Graphics=laya.display.Graphics,HTMLCanvas=laya.resource.HTMLCanvas,HTMLImage=(laya.utils.HTMLChar,laya.resource.HTMLImage),HTMLSubImage=laya.resource.HTMLSubImage,Matrix=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),Point=laya.maths.Point,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderSprite=(laya.renders.RenderContext,laya.renders.RenderSprite),Resource=laya.resource.Resource,ResourceManager=laya.resource.ResourceManager,RunDriver=laya.utils.RunDriver,Sprite=laya.display.Sprite,Stage=laya.display.Stage,Stat=laya.utils.Stat,StringKey=laya.utils.StringKey,System=(laya.display.css.Style,laya.system.System),Text=laya.display.Text,Texture=laya.resource.Texture,Utils=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),VectorGraphManager=laya.utils.VectorGraphManager,FilterActionGL=(laya.utils.WordText,Laya.interface("laya.webgl.shapes.IShape"),Laya.interface("laya.webgl.submit.ISubmit"),Laya.interface("laya.webgl.text.ICharSegment"),Laya.interface("laya.webgl.canvas.save.ISaveData"),Laya.interface("laya.webgl.resource.IMergeAtlasBitmap"),Laya.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction"),function(){function FilterActionGL(){}__class(FilterActionGL,"laya.filters.webgl.FilterActionGL");var __proto=FilterActionGL.prototype;return Laya.imps(__proto,{"laya.filters.IFilterActionGL":!0}),__proto.setValue=function(shader){},__proto.setValueMix=function(shader){},__proto.apply3d=function(scope,sprite,context,x,y){return null},__proto.apply=function(srcCanvas){return null},__getset(0,__proto,"typeMix",function(){return 0}),FilterActionGL}()),ShaderValue=function(){function ShaderValue(){}return __class(ShaderValue,"laya.webgl.shader.ShaderValue"),ShaderValue}(),AtlasGrid=function(){var TexRowInfo,TexMergeTexSize;function AtlasGrid(width,height,atlasID){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new TexMergeTexSize,void 0===width&&(width=0),void 0===height&&(height=0),void 0===atlasID&&(atlasID=0),this._cells=null,this._rowInfo=null,this._init(width,height),this._atlasID=atlasID}__class(AtlasGrid,"laya.webgl.atlas.AtlasGrid");var __proto=AtlasGrid.prototype;return __proto.getAltasID=function(){return this._atlasID},__proto.setAltasID=function(atlasID){0<=atlasID&&(this._atlasID=atlasID)},__proto.addTex=function(type,width,height){var result=this._get(width,height);return 0!=result.ret&&(this._fill(result.x,result.y,width,height,type),this._texCount++),result},__proto._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},__proto._init=function(width,height){if(this._width=width,this._height=height,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=__newvec(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new TexRowInfo;return this._clear(),!0},__proto._get=function(width,height){var pFillInfo=new MergeFillInfo;if(!(width>=this._failSize.width&&height>=this._failSize.height))for(var rx=-1,nWidth=this._width,nHeight=this._height,pCellBox=this._cells,y=0;y<nHeight;y++)if(!(this._rowInfo[y].spaceCount<width))for(var x=0;x<nWidth;){var tm=3*(y*nWidth+x);if(0!=pCellBox[tm]||pCellBox[1+tm]<width||pCellBox[2+tm]<height);else{for(var rx=x,ry=y,xx=0;xx<width;xx++)if(pCellBox[3*xx+tm+2]<height){rx=-1;break}if(!(rx<0))return pFillInfo.ret=!0,pFillInfo.x=rx,pFillInfo.y=ry,pFillInfo}x+=pCellBox[1+tm]}return pFillInfo},__proto._fill=function(x,y,w,h,type){var nWidth=this._width,nHeghit=this._height;this._check(x+w<=nWidth&&y+h<=nHeghit);for(var yy=y;yy<h+y;++yy){this._check(this._rowInfo[yy].spaceCount>=w),this._rowInfo[yy].spaceCount-=w;for(var xx=0;xx<w;xx++){var tm=3*(x+yy*nWidth+xx);this._check(0==this._cells[tm]),this._cells[tm]=type,this._cells[1+tm]=w,this._cells[2+tm]=h}}if(0<x)for(yy=0;yy<h;++yy){for(var s=0,xx=x-1;0<=xx&&0==this._cells[3*((y+yy)*nWidth+xx)];--xx,++s);for(xx=s;0<xx;--xx)this._cells[3*((y+yy)*nWidth+x-xx)+1]=xx,this._check(0<xx)}if(0<y)for(xx=x;xx<x+w;++xx){for(s=0,yy=y-1;0<=yy&&0==this._cells[3*(xx+yy*nWidth)];--yy,s++);for(yy=s;0<yy;--yy)this._cells[3*(xx+(y-yy)*nWidth)+2]=yy,this._check(0<yy)}},__proto._check=function(ret){0==ret&&console.log("xtexMerger 错误啦")},__proto._clear=function(){for(var y=this._texCount=0;y<this._height;y++)this._rowInfo[y].spaceCount=this._width;for(var i=0;i<this._height;i++)for(var j=0;j<this._width;j++){var tm=3*(i*this._width+j);this._cells[tm]=0,this._cells[1+tm]=this._width-j,this._cells[2+tm]=this._width-i}this._failSize.width=this._width+1,this._failSize.height=this._height+1},AtlasGrid.__init$=function(){TexRowInfo=function(){function TexRowInfo(){this.spaceCount=0}return __class(TexRowInfo,""),TexRowInfo}(),TexMergeTexSize=function(){function TexMergeTexSize(){this.width=0,this.height=0}return __class(TexMergeTexSize,""),TexMergeTexSize}()},AtlasGrid}(),AtlasResourceManager=function(){function AtlasResourceManager(width,height,gridSize,maxTexNum){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=width,this._height=height,this._gridSize=gridSize,this._maxAtlaserCount=maxTexNum,this._gridNumX=width/gridSize,this._gridNumY=height/gridSize,this._curAtlasIndex=0,this._atlaserArray=[]}__class(AtlasResourceManager,"laya.webgl.atlas.AtlasResourceManager");var __proto=AtlasResourceManager.prototype;return __proto.setAtlasParam=function(width,height,gridSize,maxTexNum){if(1==this._setAtlasParam)return AtlasResourceManager._sid_=0,this._width=width,this._height=height,this._gridSize=gridSize,this._maxAtlaserCount=maxTexNum,this._gridNumX=width/gridSize,this._gridNumY=height/gridSize,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},__proto.pushData=function(texture){var n,offset,bitmap=texture.bitmap,nWebGLImageIndex=-1,curAtlas=null,i=0,altasIndex=0;for(i=0,n=this._atlaserArray.length;i<n&&(altasIndex=(this._curAtlasIndex+i)%n,-1==(nWebGLImageIndex=(curAtlas=this._atlaserArray[altasIndex]).findBitmapIsExist(bitmap)));i++);if(-1!=nWebGLImageIndex)return offsetX=(offset=curAtlas.InAtlasWebGLImagesOffsetValue[nWebGLImageIndex])[0],offsetY=offset[1],curAtlas.addToAtlas(texture,offsetX,offsetY),!0;this._setAtlasParam=!1;for(var nImageGridX=Math.ceil((texture.bitmap.width+2)/this._gridSize),nImageGridY=Math.ceil((texture.bitmap.height+2)/this._gridSize),bSuccess=!1,k=0;k<2;k++){for(var maxAtlaserCount=this._maxAtlaserCount,i=0;i<maxAtlaserCount;i++){altasIndex=(this._curAtlasIndex+i)%maxAtlaserCount,this._atlaserArray.length-1>=altasIndex||this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,AtlasResourceManager._sid_++));var atlas=this._atlaserArray[altasIndex],offsetX=0,offsetY=0,fillInfo=atlas.addTex(1,nImageGridX,nImageGridY);if(fillInfo.ret){offsetX=fillInfo.x*this._gridSize+1,offsetY=fillInfo.y*this._gridSize+1,bitmap.lock=!0,atlas.addToAtlasTexture(bitmap,offsetX,offsetY),atlas.addToAtlas(texture,offsetX,offsetY),bSuccess=!0,this._curAtlasIndex=altasIndex;break}}if(bSuccess)break;this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,AtlasResourceManager._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return bSuccess||console.log(">>>AtlasManager pushData error"),bSuccess},__proto.addToAtlas=function(tex){laya.webgl.atlas.AtlasResourceManager.instance.pushData(tex)},__proto.garbageCollection=function(){if(!0===this._needGC){for(var n=this._atlaserArray.length-this._maxAtlaserCount,i=0;i<n;i++)this._atlaserArray[i].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+n),this._atlaserArray.splice(0,n),this._needGC=!1}return!0},__proto.freeAll=function(){for(var i=0,n=this._atlaserArray.length;i<n;i++)this._atlaserArray[i].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},__proto.getAtlaserCount=function(){return this._atlaserArray.length},__proto.getAtlaserByIndex=function(index){return this._atlaserArray[index]},__getset(1,AtlasResourceManager,"instance",function(){return AtlasResourceManager._Instance=AtlasResourceManager._Instance?AtlasResourceManager._Instance:new AtlasResourceManager(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)}),__getset(1,AtlasResourceManager,"enabled",function(){return Config.atlasEnable}),__getset(1,AtlasResourceManager,"atlasLimitWidth",function(){return AtlasResourceManager._atlasLimitWidth},function(value){AtlasResourceManager._atlasLimitWidth=value}),__getset(1,AtlasResourceManager,"atlasLimitHeight",function(){return AtlasResourceManager._atlasLimitHeight},function(value){AtlasResourceManager._atlasLimitHeight=value}),AtlasResourceManager._enable=function(){Config.atlasEnable=!0},AtlasResourceManager._disable=function(){Config.atlasEnable=!1},AtlasResourceManager.__init__=function(){AtlasResourceManager.atlasTextureWidth=2048,AtlasResourceManager.atlasTextureHeight=2048,AtlasResourceManager.maxTextureCount=6,AtlasResourceManager.atlasLimitWidth=512,AtlasResourceManager.atlasLimitHeight=512},AtlasResourceManager._atlasLimitWidth=0,AtlasResourceManager._atlasLimitHeight=0,AtlasResourceManager.gridSize=16,AtlasResourceManager.atlasTextureWidth=0,AtlasResourceManager.atlasTextureHeight=0,AtlasResourceManager.maxTextureCount=0,AtlasResourceManager._atlasRestore=0,AtlasResourceManager.BOARDER_TYPE_NO=0,AtlasResourceManager.BOARDER_TYPE_RIGHT=1,AtlasResourceManager.BOARDER_TYPE_LEFT=2,AtlasResourceManager.BOARDER_TYPE_BOTTOM=4,AtlasResourceManager.BOARDER_TYPE_TOP=8,AtlasResourceManager.BOARDER_TYPE_ALL=15,AtlasResourceManager._sid_=0,AtlasResourceManager._Instance=null,AtlasResourceManager}(),MergeFillInfo=function(){function MergeFillInfo(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return __class(MergeFillInfo,"laya.webgl.atlas.MergeFillInfo"),MergeFillInfo}(),BlendMode=function(){function BlendMode(){}return __class(BlendMode,"laya.webgl.canvas.BlendMode"),BlendMode._init_=function(gl){BlendMode.fns=[BlendMode.BlendNormal,BlendMode.BlendAdd,BlendMode.BlendMultiply,BlendMode.BlendScreen,BlendMode.BlendOverlay,BlendMode.BlendLight,BlendMode.BlendMask,BlendMode.BlendDestinationOut],BlendMode.targetFns=[BlendMode.BlendNormalTarget,BlendMode.BlendAddTarget,BlendMode.BlendMultiplyTarget,BlendMode.BlendScreenTarget,BlendMode.BlendOverlayTarget,BlendMode.BlendLightTarget,BlendMode.BlendMask,BlendMode.BlendDestinationOut]},BlendMode.BlendNormal=function(gl){gl.blendFunc(1,771)},BlendMode.BlendAdd=function(gl){gl.blendFunc(1,1)},BlendMode.BlendMultiply=function(gl){gl.blendFunc(774,771)},BlendMode.BlendScreen=function(gl){gl.blendFunc(1,1)},BlendMode.BlendOverlay=function(gl){gl.blendFunc(1,769)},BlendMode.BlendLight=function(gl){gl.blendFunc(1,1)},BlendMode.BlendNormalTarget=function(gl){gl.blendFunc(1,771)},BlendMode.BlendAddTarget=function(gl){gl.blendFunc(1,772)},BlendMode.BlendMultiplyTarget=function(gl){gl.blendFunc(774,771)},BlendMode.BlendScreenTarget=function(gl){gl.blendFunc(1,1)},BlendMode.BlendOverlayTarget=function(gl){gl.blendFunc(1,769)},BlendMode.BlendLightTarget=function(gl){gl.blendFunc(1,1)},BlendMode.BlendMask=function(gl){gl.blendFunc(0,770)},BlendMode.BlendDestinationOut=function(gl){gl.blendFunc(0,0)},BlendMode.activeBlendFunction=null,BlendMode.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],BlendMode.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},BlendMode.NORMAL="normal",BlendMode.ADD="add",BlendMode.MULTIPLY="multiply",BlendMode.SCREEN="screen",BlendMode.LIGHT="light",BlendMode.OVERLAY="overlay",BlendMode.DESTINATIONOUT="destination-out",BlendMode.fns=[],BlendMode.targetFns=[],BlendMode}(),DrawStyle=function(){function DrawStyle(value){this._color=Color.create("black"),this.setValue(value)}__class(DrawStyle,"laya.webgl.canvas.DrawStyle");var __proto=DrawStyle.prototype;return __proto.setValue=function(value){value&&("string"==typeof value?this._color=Color.create(value):value instanceof laya.utils.Color&&(this._color=value))},__proto.reset=function(){this._color=Color.create("black")},__proto.equal=function(value){return"string"==typeof value?this._color.strColor===value:value instanceof laya.utils.Color&&this._color.numColor===value.numColor},__proto.toColorStr=function(){return this._color.strColor},DrawStyle.create=function(value){var color;if(value&&("string"==typeof value?color=Color.create(value):value instanceof laya.utils.Color&&(color=value),color))return color._drawStyle||(color._drawStyle=new DrawStyle(value));return laya.webgl.canvas.DrawStyle.DEFAULT},__static(DrawStyle,["DEFAULT",function(){return this.DEFAULT=new DrawStyle("#000000")}]),DrawStyle}(),Path=function(){function Path(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];WebGL.mainContext;this.ib=IndexBuffer2D.create(35048),this.vb=VertexBuffer2D.create(5)}__class(Path,"laya.webgl.canvas.Path");var __proto=Path.prototype;return __proto.addPoint=function(pointX,pointY){this.tempArray.push(pointX,pointY)},__proto.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},__proto.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},__proto.polygon=function(x,y,points,color,borderWidth,borderColor){return this.geomatrys.push(this._curGeomatry=x=new Polygon(x,y,points,color,borderWidth,borderColor)),color||(x.fill=!1),null==borderColor&&(x.borderWidth=0),x},__proto.setGeomtry=function(shape){this.geomatrys.push(this._curGeomatry=shape)},__proto.drawLine=function(x,y,points,width,color){var geo;return this.closePath?this.geomatrys.push(this._curGeomatry=geo=new LoopLine(x,y,points,width,color)):this.geomatrys.push(this._curGeomatry=geo=new Line(x,y,points,width,color)),geo.fill=!1,geo},__proto.update=function(){var si=this.ib._byteLength,len=this.geomatrys.length;this.offset=si;for(var i=this.geoStart;i<len;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=len,this.count=(this.ib._byteLength-si)/CONST3D2D.BYTES_PIDX},__proto.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},__proto.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},Path}(),SaveBase=function(){function SaveBase(){}__class(SaveBase,"laya.webgl.canvas.save.SaveBase");var __proto=SaveBase.prototype;return Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":!0}),__proto.isSaveMark=function(){return!1},__proto.restore=function(context){this._dataObj[this._valueName]=this._value,(SaveBase._cache[SaveBase._cache._length++]=this)._newSubmit&&(context._curSubmit=Submit.RENDERBASE,context._renderKey=0)},SaveBase._createArray=function(){var value=[];return value._length=0,value},SaveBase._init=function(){var namemap=SaveBase._namemap={1:"ALPHA",2:"fillStyle",8:"font",256:"lineWidth",512:"strokeStyle",8192:"_mergeID"};return namemap[1024]=namemap[2048]=namemap[4096]=[],namemap[16384]="textBaseline",namemap[32768]="textAlign",namemap[65536]="_nBlendType",namemap[1048576]="shader",namemap[2097152]="filters",namemap},SaveBase.save=function(context,type,dataObj,newSubmit){var cache;(context._saveMark._saveuse&type)!==type&&(context._saveMark._saveuse|=type,(cache=0<(cache=SaveBase._cache)._length?cache[--cache._length]:new SaveBase)._value=dataObj[cache._valueName=SaveBase._namemap[type]],cache._dataObj=dataObj,cache._newSubmit=newSubmit,(type=context._save)[type._length++]=cache)},SaveBase._cache=laya.webgl.canvas.save.SaveBase._createArray(),SaveBase._namemap=SaveBase._init(),SaveBase}(),SaveClipRect=function(){function SaveClipRect(){this._clipRect=new Rectangle}__class(SaveClipRect,"laya.webgl.canvas.save.SaveClipRect");var __proto=SaveClipRect.prototype;return Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":!0}),__proto.isSaveMark=function(){return!1},__proto.restore=function(context){context._clipRect=this._clipSaveRect,(SaveClipRect._cache[SaveClipRect._cache._length++]=this)._submitScissor.submitLength=context._submits._length-this._submitScissor.submitIndex,context._curSubmit=Submit.RENDERBASE,context._renderKey=0},SaveClipRect.save=function(context,submitScissor){var cache;131072!=(131072&context._saveMark._saveuse)&&(context._saveMark._saveuse|=131072,(cache=0<(cache=SaveClipRect._cache)._length?cache[--cache._length]:new SaveClipRect)._clipSaveRect=context._clipRect,context._clipRect=cache._clipRect.copyFrom(context._clipRect),cache._submitScissor=submitScissor,(submitScissor=context._save)[submitScissor._length++]=cache)},__static(SaveClipRect,["_cache",function(){return this._cache=SaveBase._createArray()}]),SaveClipRect}(),SaveClipRectStencil=function(){function SaveClipRectStencil(){this._contextX=0,this._contextY=0,this._clipRect=new Rectangle,this._rect=new Rectangle,this._matrix=new Matrix}__class(SaveClipRectStencil,"laya.webgl.canvas.save.SaveClipRectStencil");var __proto=SaveClipRectStencil.prototype;return Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":!0}),__proto.isSaveMark=function(){return!1},__proto.restore=function(context){SubmitStencil.restore(context,this._rect,this._saveMatrix,this._contextX,this._contextY),context._clipRect=this._clipSaveRect,context._curMat=this._saveMatrix,context._x=this._contextX,context._y=this._contextY,SaveClipRectStencil._cache[SaveClipRectStencil._cache._length++]=this,context._curSubmit=Submit.RENDERBASE},SaveClipRectStencil.save=function(context,submitStencil,x,y,width,height,clipX,clipY,clipWidth,clipHeight){var cache;262144!=(262144&context._saveMark._saveuse)&&(context._saveMark._saveuse|=262144,(cache=0<(cache=SaveClipRectStencil._cache)._length?cache[--cache._length]:new SaveClipRectStencil)._clipSaveRect=context._clipRect,cache._clipRect.setTo(clipX,clipY,clipWidth,clipHeight),context._clipRect=cache._clipRect,cache._rect.x=x,cache._rect.y=y,cache._rect.width=width,cache._rect.height=height,cache._contextX=context._x,cache._contextY=context._y,cache._saveMatrix=context._curMat,context._curMat.copyTo(cache._matrix),context._curMat=cache._matrix,cache._submitStencil=submitStencil,(clipX=context._save)[clipX._length++]=cache)},__static(SaveClipRectStencil,["_cache",function(){return this._cache=SaveBase._createArray()}]),SaveClipRectStencil}(),SaveMark=function(){function SaveMark(){this._saveuse=0}__class(SaveMark,"laya.webgl.canvas.save.SaveMark");var __proto=SaveMark.prototype;return Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":!0}),__proto.isSaveMark=function(){return!0},__proto.restore=function(context){context._saveMark=this._preSaveMark,SaveMark._no[SaveMark._no._length++]=this},SaveMark.Create=function(context){var no=SaveMark._no,no=0<no._length?no[--no._length]:new SaveMark;return no._saveuse=0,no._preSaveMark=context._saveMark,context._saveMark=no},__static(SaveMark,["_no",function(){return this._no=SaveBase._createArray()}]),SaveMark}(),SaveTransform=function(){function SaveTransform(){this._matrix=new Matrix}__class(SaveTransform,"laya.webgl.canvas.save.SaveTransform");var __proto=SaveTransform.prototype;return Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":!0}),__proto.isSaveMark=function(){return!1},__proto.restore=function(context){context._curMat=this._savematrix,SaveTransform._no[SaveTransform._no._length++]=this},SaveTransform.save=function(context){var _saveMark=context._saveMark;2048!=(2048&_saveMark._saveuse)&&(_saveMark._saveuse|=2048,(_saveMark=0<(_saveMark=SaveTransform._no)._length?_saveMark[--_saveMark._length]:new SaveTransform)._savematrix=context._curMat,context._curMat=context._curMat.copyTo(_saveMark._matrix),(context=context._save)[context._length++]=_saveMark)},__static(SaveTransform,["_no",function(){return this._no=SaveBase._createArray()}]),SaveTransform}(),SaveTranslate=function(){function SaveTranslate(){}__class(SaveTranslate,"laya.webgl.canvas.save.SaveTranslate");var __proto=SaveTranslate.prototype;return Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":!0}),__proto.isSaveMark=function(){return!1},__proto.restore=function(context){context._curMat;context._x=this._x,context._y=this._y,SaveTranslate._no[SaveTranslate._no._length++]=this},SaveTranslate.save=function(context){var no=SaveTranslate._no,no=0<no._length?no[--no._length]:new SaveTranslate,context=(no._x=context._x,no._y=context._y,context._save);context[context._length++]=no},__static(SaveTranslate,["_no",function(){return this._no=SaveBase._createArray()}]),SaveTranslate}(),RenderTargetMAX=function(){function RenderTargetMAX(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new Rectangle}__class(RenderTargetMAX,"laya.webgl.resource.RenderTargetMAX");var __proto=RenderTargetMAX.prototype;return __proto.setSP=function(sp){this._sp=sp},__proto.size=function(w,h){var _$this=this;this._width===w&&this._height===h?this.target.size(w,h):(this.repaint=!0,this._width=w,this._height=h,this.target?this.target.size(w,h):this.target=RenderTarget2D.create(w,h),this.target.hasListener("recovered")||this.target.on("recovered",this,function(e){Laya.timer.callLater(_$this._sp,_$this._sp.repaint)}))},__proto._flushToTarget=function(context,target){var worldScissorTest,preworldClipRect,preAlpha,preMatrix4,preMatrix,preFilters,preShaderDefines;target._destroy||(worldScissorTest=RenderState2D.worldScissorTest,preworldClipRect=RenderState2D.worldClipRect,RenderState2D.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,RenderState2D.worldScissorTest=!1,WebGL.mainContext.disable(3089),preAlpha=RenderState2D.worldAlpha,preMatrix4=RenderState2D.worldMatrix4,preMatrix=RenderState2D.worldMatrix,preFilters=RenderState2D.worldFilters,preShaderDefines=RenderState2D.worldShaderDefines,RenderState2D.worldMatrix=Matrix.EMPTY,RenderState2D.restoreTempArray(),RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY,RenderState2D.worldAlpha=1,RenderState2D.worldFilters=null,RenderState2D.worldShaderDefines=null,BaseShader.activeShader=null,target.start(),Config.showCanvasMark?target.clear(0,1,0,.3):target.clear(0,0,0,0),context.flush(),target.end(),BaseShader.activeShader=null,RenderState2D.worldAlpha=preAlpha,RenderState2D.worldMatrix4=preMatrix4,RenderState2D.worldMatrix=preMatrix,RenderState2D.worldFilters=preFilters,RenderState2D.worldShaderDefines=preShaderDefines,(RenderState2D.worldScissorTest=worldScissorTest)&&(context=RenderState2D.height-preworldClipRect.y-preworldClipRect.height,WebGL.mainContext.scissor(preworldClipRect.x,context,preworldClipRect.width,preworldClipRect.height),WebGL.mainContext.enable(3089)),RenderState2D.worldClipRect=preworldClipRect)},__proto.flush=function(context){this.repaint&&(this._flushToTarget(context,this.target),this.repaint=!1)},__proto.drawTo=function(context,x,y,width,height){context.drawTexture(this.target.getTexture(),x,y,width,height,0,0)},__proto.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},RenderTargetMAX}(),Shader2D=function(){function Shader2D(){this.ALPHA=1,this.shaderType=0,this.defines=new ShaderDefines2D}return __class(Shader2D,"laya.webgl.shader.d2.Shader2D"),Shader2D.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},Shader2D.__init__=function(){Shader.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Shader.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Shader.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Shader.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Shader.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Shader.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Shader.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Shader.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),Shader.preCompile2D(0,1,"attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",'precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',null),Shader.preCompile2D(0,2,"attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",'precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',null),Shader.preCompile2D(0,4,"attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}","precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",null),Shader.preCompile2D(0,256,"attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",'#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',null),Shader.preCompile2D(0,512,"attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}","precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",null)},Shader2D}(),ShaderDefines=function(){function ShaderDefines(name2int,int2name,int2nameMap){this._value=0,this._name2int=name2int,this._int2name=int2name,this._int2nameMap=int2nameMap}__class(ShaderDefines,"laya.webgl.shader.ShaderDefines");var __proto=ShaderDefines.prototype;return __proto.add=function(value){return"string"==typeof value&&(value=this._name2int[value]),this._value|=value,this._value},__proto.addInt=function(value){return this._value|=value,this._value},__proto.remove=function(value){return"string"==typeof value&&(value=this._name2int[value]),this._value&=~value,this._value},__proto.isDefine=function(def){return(this._value&def)===def},__proto.getValue=function(){return this._value},__proto.setValue=function(value){this._value=value},__proto.toNameDic=function(){var r=this._int2nameMap[this._value];return r||ShaderDefines._toText(this._value,this._int2name,this._int2nameMap)},ShaderDefines._reg=function(name,value,_name2int,_int2name){_int2name[_name2int[name]=value]=name},ShaderDefines._toText=function(value,_int2name,_int2nameMap){var r=_int2nameMap[value];if(r)return r;for(var d,name,o={},i=0;i<32&&!(value<(d=1<<i));i++)value&d&&(name=_int2name[d])&&(o[name]="");return _int2nameMap[value]=o},ShaderDefines._toInt=function(names,_name2int){for(var words=names.split("."),num=0,i=0,n=words.length;i<n;i++){var value=_name2int[words[i]];if(!value)throw new Error("Defines to int err:"+names+"/"+words[i]);num|=value}return num},ShaderDefines}(),SkinMesh=function(){function SkinMesh(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new Matrix}__class(SkinMesh,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var __proto=SkinMesh.prototype;return __proto.init=function(texture,vs,ps){var tHeight;vs?this._vs=vs:(this._vs=[],vs=texture.width,tHeight=texture.height,this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(vs,0,1,0,1,1,1,1),this._vs.push(vs,tHeight,1,1,1,1,1,1),this._vs.push(0,tHeight,0,1,1,1,1,1)),ps?this._ps=ps:(SkinMesh._defaultPS||(SkinMesh._defaultPS=[]).push(0,1,3,3,1,2),this._ps=SkinMesh._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=texture},__proto.init2=function(texture,vs,ps,verticles,uvs){this.transform&&(this.transform=null),ps?this._ps=ps:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=verticles,this._uvs=uvs,this.mEleNum=this._ps.length,this.mTexture=texture,(Render.isConchNode||Render.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},__proto._initMyData=function(){var vsI=0,vI=0,tempVLen=4*this._verticles.length,insertNew=(this._vs=SkinMesh._tempVS,!1);if((Render.isConchNode||Render.isConchApp||this._vs.length<tempVLen)&&(this._vs.length=tempVLen,insertNew=!0),SkinMesh._tVSLen=tempVLen,insertNew)for(;vsI<tempVLen;)this._vs[vsI]=this._verticles[vI],this._vs[vsI+1]=this._verticles[vI+1],this._vs[vsI+2]=this._uvs[vI],this._vs[vsI+3]=this._uvs[vI+1],this._vs[vsI+4]=1,this._vs[vsI+5]=1,this._vs[vsI+6]=1,this._vs[vsI+7]=1,vsI+=8,vI+=2;else for(;vsI<tempVLen;)this._vs[vsI]=this._verticles[vI],this._vs[vsI+1]=this._verticles[vI+1],this._vs[vsI+2]=this._uvs[vI],this._vs[vsI+3]=this._uvs[vI+1],vsI+=8,vI+=2},__proto.getData2=function(vb,ib,start){var tIB;this.mVBBuffer=vb,this.mIBBuffer=ib,this._initMyData(),vb.appendEx2(this._vs,Float32Array,SkinMesh._tVSLen,4),this._indexStart=ib._byteLength,(tIB=SkinMesh._tempIB).length<this._ps.length&&(tIB.length=this._ps.length);for(var i=0,n=this._ps.length;i<n;i++)tIB[i]=this._ps[i]+start;ib.appendEx2(tIB,Uint16Array,this._ps.length,2)},__proto.getData=function(vb,ib,start){if(this.mVBBuffer=vb,this.mIBBuffer=ib,vb.append(this.mVBData),this._indexStart=ib._byteLength,this.mIBData.start!=start){for(var i=0,n=this._ps.length;i<n;i++)this.mIBData[i]=this._ps[i]+start;this.mIBData.start=start}ib.append(this.mIBData)},__proto.render=function(context,x,y){var tempSubmit,tShaderValue,tArray;Render.isWebGL&&this.mTexture?(context._renderKey=0,context._shader2D.glTexture=null,SkinMeshBuffer.getInstance().addSkinMesh(this),tempSubmit=Submit.createShape(context,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Value2D.create(512,0)),this.transform||(this.transform=Matrix.EMPTY),this.transform.translate(x,y),Matrix.mul(this.transform,context._curMat,this._tempMatrix),this.transform.translate(-x,-y),tArray=(tShaderValue=tempSubmit.shaderValue).u_mmat2||RenderState2D.getMatrArray(),RenderState2D.mat2MatArray(this._tempMatrix,tArray),tShaderValue.textureHost=this.mTexture,tShaderValue.offsetX=0,tShaderValue.offsetY=0,tShaderValue.u_mmat2=tArray,tShaderValue.ALPHA=context._shader2D.ALPHA,context._submits[context._submits._length++]=tempSubmit):Render.isConchApp&&this.mTexture&&(this.transform||(this.transform=Matrix.EMPTY),context.setSkinMesh)&&context.setSkinMesh(x,y,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform)},SkinMesh._tempVS=[],SkinMesh._tempIB=[],SkinMesh._defaultPS=null,SkinMesh._tVSLen=0,SkinMesh}(),SkinMeshBuffer=function(){function SkinMeshBuffer(){this.ib=null,this.vb=null;WebGL.mainContext;this.ib=IndexBuffer2D.create(35048),this.vb=VertexBuffer2D.create(8)}__class(SkinMeshBuffer,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var __proto=SkinMeshBuffer.prototype;return __proto.addSkinMesh=function(skinMesh){skinMesh.getData2(this.vb,this.ib,this.vb._byteLength/32)},__proto.reset=function(){this.vb.clear(),this.ib.clear()},SkinMeshBuffer.getInstance=function(){return SkinMeshBuffer.instance=SkinMeshBuffer.instance||new SkinMeshBuffer},SkinMeshBuffer.instance=null,SkinMeshBuffer}(),BasePoly=function(){function BasePoly(x,y,width,height,edges,color,borderWidth,borderColor,round){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===round&&(round=0),this.x=x,this.y=y,this.width=width,this.height=height,this.edges=edges,this.color=color,this.borderWidth=borderWidth,this.borderColor=borderColor}__class(BasePoly,"laya.webgl.shapes.BasePoly");var __proto=BasePoly.prototype;return Laya.imps(__proto,{"laya.webgl.shapes.IShape":!0}),__proto.getData=function(ib,vb,start){},__proto.rebuild=function(points){},__proto.setMatrix=function(mat){},__proto.needUpdate=function(mat){return!0},__proto.sector=function(outVert,outIndex,start){var x=this.x,y=this.y,edges=this.edges,seg=(this.r1-this.r0)/edges,w=this.width,h=this.height,color=this.color,r=(color>>16&255)/255,g=(color>>8&255)/255,b=(255&color)/255;outVert.push(x,y,r,g,b);for(var i=0;i<edges+1;i++)outVert.push(x+Math.sin(seg*i+this.r0)*w,y+Math.cos(seg*i+this.r0)*h),outVert.push(r,g,b);for(i=0;i<edges;i++)outIndex.push(start,start+i+1,start+i+2)},__proto.createLine2=function(p,indices,lineWidth,len,outVertex,indexCount){var a1,p3y,c1,p3x,perp2x,c2,perp2y,points=p.concat(),result=outVertex,p=this.borderColor,r=(p>>16&255)/255,g=(p>>8&255)/255,b=(255&p)/255,length=points.length/2,iStart=len,w=lineWidth/2,p1x=points[0],p1y=points[1],p2x=points[2],p2y=points[3],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy);result.push(p1x-(perpx=perpx/dist*w)+this.x,p1y-(perpy=perpy/dist*w)+this.y,r,g,b,p1x+perpx+this.x,p1y+perpy+this.y,r,g,b);for(var i=1;i<length-1;i++)p1x=points[2*(i-1)],p1y=points[2*(i-1)+1],p2x=points[2*i],p2y=points[2*i+1],p3x=points[2*(i+1)],p3y=points[2*(i+1)+1],perpy=p1x-p2x,perp2y=p2x-p3x,c1=(-(perpx=(perpx=-(p1y-p2y))/(dist=Math.sqrt(perpx*perpx+perpy*perpy))*w)+p1x)*(-(perpy=perpy/dist*w)+p2y)-(-perpx+p2x)*(-perpy+p1y),c2=(-(perp2x=(perp2x=-(p2y-p3y))/(dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y))*w)+p3x)*(-(perp2y=perp2y/dist*w)+p2y)-(-perp2x+p2x)*(-perp2y+p3y),perp2y=(a1=-perpy+p1y-(-perpy+p2y))*(perp2x=-perp2x+p2x-(-perp2x+p3x))-(p3x=-perp2y+p3y-(-perp2y+p2y))*(p3y=-perpx+p2x-(-perpx+p1x)),Math.abs(perp2y)<.1?(perp2y+=10.1,result.push(p2x-perpx+this.x,p2y-perpy+this.y,r,g,b,p2x+perpx+this.x,p2y+perpy+this.y,r,g,b)):(p3y=(p3y*c2-perp2x*c1)/perp2y,perp2x=(p3x*c1-a1*c2)/perp2y,result.push(p3y+this.x,perp2x+this.y,r,g,b,p2x-(p3y-p2x)+this.x,p2y-(perp2x-p2y)+this.y,r,g,b));p1x=points[points.length-4],p1y=points[points.length-3],p2x=points[points.length-2],perpx=-(p1y-(p2y=points[points.length-1])),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),result.push(p2x-(perpx=perpx/dist*w)+this.x,p2y-(perpy=perpy/dist*w)+this.y,r,g,b,p2x+perpx+this.x,p2y+perpy+this.y,r,g,b);for(var groupLen=indexCount,i=1;i<groupLen;i++)indices.push(iStart+2*(i-1),iStart+2*(i-1)+1,iStart+2*i+1,iStart+2*i+1,iStart+2*i,iStart+2*(i-1));return result},__proto.createLine=function(p,indices,lineWidth,len){var a1,p3y,c1,p3x,perp2x,c2,perp2y,points=p.concat(),result=p,p=this.borderColor,r=(p>>16&255)/255,g=(p>>8&255)/255,b=(255&p)/255,length=(points.splice(0,5),points.length/5),iStart=len,w=lineWidth/2,p1x=points[0],p1y=points[1],p2x=points[5],p2y=points[6],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy);result.push(p1x-(perpx=perpx/dist*w),p1y-(perpy=perpy/dist*w),r,g,b,p1x+perpx,p1y+perpy,r,g,b);for(var i=1;i<length-1;i++)p1x=points[5*(i-1)],p1y=points[5*(i-1)+1],p2x=points[5*i],p2y=points[5*i+1],p3x=points[5*(i+1)],p3y=points[5*(i+1)+1],perpy=p1x-p2x,perp2y=p2x-p3x,c1=(-(perpx=(perpx=-(p1y-p2y))/(dist=Math.sqrt(perpx*perpx+perpy*perpy))*w)+p1x)*(-(perpy=perpy/dist*w)+p2y)-(-perpx+p2x)*(-perpy+p1y),c2=(-(perp2x=(perp2x=-(p2y-p3y))/(dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y))*w)+p3x)*(-(perp2y=perp2y/dist*w)+p2y)-(-perp2x+p2x)*(-perp2y+p3y),perp2y=(a1=-perpy+p1y-(-perpy+p2y))*(perp2x=-perp2x+p2x-(-perp2x+p3x))-(p3x=-perp2y+p3y-(-perp2y+p2y))*(p3y=-perpx+p2x-(-perpx+p1x)),Math.abs(perp2y)<.1?(perp2y+=10.1,result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b)):(p3y=(p3y*c2-perp2x*c1)/perp2y,perp2x=(p3x*c1-a1*c2)/perp2y,result.push(p3y,perp2x,r,g,b,p2x-(p3y-p2x),p2y-(perp2x-p2y),r,g,b));p1x=points[points.length-10],p1y=points[points.length-9],p2x=points[points.length-5],perpx=-(p1y-(p2y=points[points.length-4])),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),result.push(p2x-(perpx=perpx/dist*w),p2y-(perpy=perpy/dist*w),r,g,b,p2x+perpx,p2y+perpy,r,g,b);for(var groupLen=this.edges+1,i=1;i<groupLen;i++)indices.push(iStart+2*(i-1),iStart+2*(i-1)+1,iStart+2*i+1,iStart+2*i+1,iStart+2*i,iStart+2*(i-1));return result},__proto.createLoopLine=function(p,indices,lineWidth,len,outVertex,outIndex){var a1,p3y,c1,p3x,perp2x,c2,perp2y,points=p.concat(),result=outVertex||p,outVertex=this.borderColor,r=(outVertex>>16&255)/255,g=(outVertex>>8&255)/255,b=(255&outVertex)/255,p=(points.splice(0,5),[points[0],points[1]]),outVertex=[points[points.length-5],points[points.length-4]],midPointX=outVertex[0]+.5*(p[0]-outVertex[0]),p=outVertex[1]+.5*(p[1]-outVertex[1]),length=(points.unshift(midPointX,p,0,0,0),points.push(midPointX,p,0,0,0),points.length/5),iStart=len,w=lineWidth/2,p1x=points[0],p1y=points[1],p2x=points[5],p2y=points[6],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy);result.push(p1x-(perpx=perpx/dist*w),p1y-(perpy=perpy/dist*w),r,g,b,p1x+perpx,p1y+perpy,r,g,b);for(var i=1;i<length-1;i++)p1x=points[5*(i-1)],p1y=points[5*(i-1)+1],p2x=points[5*i],p2y=points[5*i+1],p3x=points[5*(i+1)],p3y=points[5*(i+1)+1],perpy=p1x-p2x,perp2y=p2x-p3x,c1=(-(perpx=(perpx=-(p1y-p2y))/(dist=Math.sqrt(perpx*perpx+perpy*perpy))*w)+p1x)*(-(perpy=perpy/dist*w)+p2y)-(-perpx+p2x)*(-perpy+p1y),c2=(-(perp2x=(perp2x=-(p2y-p3y))/(dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y))*w)+p3x)*(-(perp2y=perp2y/dist*w)+p2y)-(-perp2x+p2x)*(-perp2y+p3y),perp2y=(a1=-perpy+p1y-(-perpy+p2y))*(perp2x=-perp2x+p2x-(-perp2x+p3x))-(p3x=-perp2y+p3y-(-perp2y+p2y))*(p3y=-perpx+p2x-(-perpx+p1x)),Math.abs(perp2y)<.1?(perp2y+=10.1,result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b)):(p3y=(p3y*c2-perp2x*c1)/perp2y,perp2x=(p3x*c1-a1*c2)/perp2y,result.push(p3y,perp2x,r,g,b,p2x-(p3y-p2x),p2y-(perp2x-p2y),r,g,b));outIndex&&(indices=outIndex);for(var groupLen=this.edges+1,i=1;i<groupLen;i++)indices.push(iStart+2*(i-1),iStart+2*(i-1)+1,iStart+2*i+1,iStart+2*i+1,iStart+2*i,iStart+2*(i-1));return indices.push(iStart+2*(i-1),iStart+2*(i-1)+1,iStart+1,iStart+1,iStart,iStart+2*(i-1)),result},BasePoly}(),Earcut=function(){function Earcut(){}return __class(Earcut,"laya.webgl.shapes.Earcut"),Earcut.earcut=function(data,holeIndices,dim){dim=dim||2;var maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=Earcut.linkedList(data,0,outerLen,dim,!0),triangles=[];if(outerNode){if(hasHoles&&(outerNode=Earcut.eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){for(var minX=maxX=data[0],minY=maxY=data[1],i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),maxX<x&&(maxX=x),maxY<y&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?1/invSize:0}Earcut.earcutLinked(outerNode,triangles,dim,minX,minY,invSize)}return triangles},Earcut.linkedList=function(data,start,end,dim,clockwise){var i,last;if(clockwise===0<Earcut.signedArea(data,start,end,dim))for(i=start;i<end;i+=dim)last=Earcut.insertNode(i,data[i],data[i+1],last);else for(i=end-dim;start<=i;i-=dim)last=Earcut.insertNode(i,data[i],data[i+1],last);return last&&Earcut.equals(last,last.next)&&(Earcut.removeNode(last),last=last.next),last},Earcut.filterPoints=function(start,end){if(!start)return start;end=end||start;var again,p=start;do{if(again=!1,p.steiner||!Earcut.equals(p,p.next)&&0!==Earcut.area(p.prev,p,p.next))p=p.next;else{if(Earcut.removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end},Earcut.earcutLinked=function(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&Earcut.indexCurve(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?Earcut.isEarHashed(ear,minX,minY,invSize):Earcut.isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),Earcut.removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?(ear=Earcut.cureLocalIntersections(ear,triangles,dim),Earcut.earcutLinked(ear,triangles,dim,minX,minY,invSize,2)):2===pass&&Earcut.splitEarcut(ear,triangles,dim,minX,minY,invSize):Earcut.earcutLinked(Earcut.filterPoints(ear,null),triangles,dim,minX,minY,invSize,1);break}}},Earcut.isEar=function(ear){var a=ear.prev,b=ear,c=ear.next;if(0<=Earcut.area(a,b,c))return!1;for(var p=ear.next.next;p!==ear.prev;){if(Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=Earcut.area(p.prev,p,p.next))return!1;p=p.next}return!0},Earcut.isEarHashed=function(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(0<=Earcut.area(a,b,c))return!1;for(var minTX=(a.x<b.x?a.x<c.x?a:c:b.x<c.x?b:c).x,minTY=(a.y<b.y?a.y<c.y?a:c:b.y<c.y?b:c).y,maxTX=(a.x>b.x?a.x>c.x?a:c:b.x>c.x?b:c).x,maxTY=(a.y>b.y?a.y>c.y?a:c:b.y>c.y?b:c).y,minZ=Earcut.zOrder(minTX,minTY,minX,minY,invSize),maxZ=Earcut.zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.nextZ;p&&p.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=Earcut.area(p.prev,p,p.next))return!1;p=p.nextZ}for(p=ear.prevZ;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=Earcut.area(p.prev,p,p.next))return!1;p=p.prevZ}return!0},Earcut.cureLocalIntersections=function(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next}while(!Earcut.equals(a,b)&&Earcut.intersects(a,p,p.next,b)&&Earcut.locallyInside(a,b)&&Earcut.locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),Earcut.removeNode(p),Earcut.removeNode(p.next),p=start=b),(p=p.next)!==start);return p},Earcut.splitEarcut=function(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var c,b=a.next.next;b!==a.prev;){if(a.i!==b.i&&Earcut.isValidDiagonal(a,b))return c=Earcut.splitPolygon(a,b),a=Earcut.filterPoints(a,a.next),c=Earcut.filterPoints(c,c.next),Earcut.earcutLinked(a,triangles,dim,minX,minY,invSize),void Earcut.earcutLinked(c,triangles,dim,minX,minY,invSize);b=b.next}}while((a=a.next)!==start)},Earcut.eliminateHoles=function(data,holeIndices,outerNode,dim){for(var end,start,queue=[],i=0,len=holeIndices.length;i<len;i++)start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length,(start=Earcut.linkedList(data,start,end,dim,!1))===start.next&&(start.steiner=!0),queue.push(Earcut.getLeftmost(start));for(queue.sort(Earcut.compareX),i=0;i<queue.length;i++)Earcut.eliminateHole(queue[i],outerNode),outerNode=Earcut.filterPoints(outerNode,outerNode.next);return outerNode},Earcut.compareX=function(a,b){return a.x-b.x},Earcut.eliminateHole=function(hole,outerNode){(outerNode=Earcut.findHoleBridge(hole,outerNode))&&(outerNode=Earcut.splitPolygon(outerNode,hole),Earcut.filterPoints(outerNode,outerNode.next))},Earcut.findHoleBridge=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&qx<x){if((qx=x)===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}}while((p=p.next)!==outerNode);if(!m)return null;if(hx===qx)return m.prev;for(var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0,p=m.next;p!==stop;)hx>=p.x&&p.x>=mx&&hx!==p.x&&Earcut.pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&Earcut.locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m},Earcut.indexCurve=function(start,minX,minY,invSize){for(var p=start;null===p.z&&(p.z=Earcut.zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,(p=p.next)!==start;);p.prevZ.nextZ=null,p.prevZ=null,Earcut.sortLinked(p)},Earcut.sortLinked=function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,tail=list=null,numMerges=0;p;){for(numMerges++,q=p,i=pSize=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;0<pSize||0<qSize&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(p=(e=p).nextZ,pSize--):(q=(e=q).nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}}while(tail.nextZ=null,inSize*=2,1<numMerges);return list},Earcut.zOrder=function(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-minX)*invSize)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-minY)*invSize)|y<<8))|y<<4))|y<<2))|y<<1))<<1},Earcut.getLeftmost=function(start){for(var p=start,leftmost=start;p.x<leftmost.x&&(leftmost=p),(p=p.next)!==start;);return leftmost},Earcut.pointInTriangle=function(ax,ay,bx,by,cx,cy,px,py){return 0<=(cx-px)*(ay-py)-(ax-px)*(cy-py)&&0<=(ax-px)*(by-py)-(bx-px)*(ay-py)&&0<=(bx-px)*(cy-py)-(cx-px)*(by-py)},Earcut.isValidDiagonal=function(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!Earcut.intersectsPolygon(a,b)&&Earcut.locallyInside(a,b)&&Earcut.locallyInside(b,a)&&Earcut.middleInside(a,b)},Earcut.area=function(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)},Earcut.equals=function(p1,p2){return p1.x===p2.x&&p1.y===p2.y},Earcut.intersects=function(p1,q1,p2,q2){return!!(Earcut.equals(p1,q1)&&Earcut.equals(p2,q2)||Earcut.equals(p1,q2)&&Earcut.equals(p2,q1))||0<Earcut.area(p1,q1,p2)!=0<Earcut.area(p1,q1,q2)&&0<Earcut.area(p2,q2,p1)!=0<Earcut.area(p2,q2,q1)},Earcut.intersectsPolygon=function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&Earcut.intersects(p,p.next,a,b))return!0}while((p=p.next)!==a);return!1},Earcut.locallyInside=function(a,b){return Earcut.area(a.prev,a,a.next)<0?0<=Earcut.area(a,b,a.next)&&0<=Earcut.area(a,a.prev,b):Earcut.area(a,b,a.prev)<0||Earcut.area(a,a.next,b)<0},Earcut.middleInside=function(a,b){for(var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),(p=p.next)!==a;);return inside},Earcut.splitPolygon=function(a,b){var a2=new EarcutNode(a.i,a.x,a.y),b2=new EarcutNode(b.i,b.x,b.y),an=a.next,bp=b.prev;return(a.next=b).prev=a,(a2.next=an).prev=a2,(b2.next=a2).prev=b2,(bp.next=b2).prev=bp,b2},Earcut.insertNode=function(i,x,y,last){i=new EarcutNode(i,x,y);return last?(i.next=last.next,(i.prev=last).next.prev=i,last.next=i):(i.prev=i).next=i,i},Earcut.removeNode=function(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)},Earcut.signedArea=function(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum},Earcut}(),EarcutNode=function(){function EarcutNode(i,x,y){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return __class(EarcutNode,"laya.webgl.shapes.EarcutNode"),EarcutNode}(),Submit=(function(){function GeometryData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,shape){this.lineWidth=lineWidth,this.lineColor=lineColor,this.lineAlpha=lineAlpha,this.fillColor=fillColor,this.fillAlpha=fillAlpha,this.shape=shape,this.fill=fill}__class(GeometryData,"laya.webgl.shapes.GeometryData");var __proto=GeometryData.prototype;__proto.clone=function(){return new GeometryData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},__proto.getIndexData=function(){return null},__proto.getVertexData=function(){return null},__proto.destroy=function(){this.shape=null}}(),function(){function Vertex(p){p instanceof Float32Array?this.points=p:p instanceof Array&&(p.length,this.points=new Float32Array(p))}__class(Vertex,"laya.webgl.shapes.Vertex");var __proto=Vertex.prototype;Laya.imps(__proto,{"laya.webgl.shapes.IShape":!0}),__proto.getData=function(ib,vb,start){},__proto.needUpdate=function(mat){return!1},__proto.rebuild=function(points){},__proto.setMatrix=function(mat){}}(),function(){function Submit(renderType){this._renderType=renderType=void 0===renderType?1e4:renderType}__class(Submit,"laya.webgl.submit.Submit");var __proto=Submit.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0}),__proto.releaseRender=function(){var cache=Submit._cache;(cache[cache._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},__proto.getRenderType=function(){return this._renderType},__proto.renderSubmit=function(){if(0!==this._numEle){var _tex=this.shaderValue.textureHost;if(_tex){var source=_tex.source;if(!_tex.bitmap||!source)return 1;this.shaderValue.texture=source}this._vb.bind_upload(this._ib);_tex=WebGL.mainContext;this.shaderValue.upload(),BlendMode.activeBlendFunction!==this._blendFn&&(_tex.enable(3042),this._blendFn(_tex),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,_tex.drawElements(4,this._numEle,5123,this._startIdx)}return 1},Submit.__init__=function(){var s=Submit.RENDERBASE=new Submit(-1);s.shaderValue=new Value2D(0,0),s.shaderValue.ALPHA=-1234},Submit.createSubmit=function(context,ib,vb,pos,sv){var o=Submit._cache._length?Submit._cache[--Submit._cache._length]:new Submit,ib=(null==vb&&((vb=o._selfVb||(o._selfVb=VertexBuffer2D.create(-1))).clear(),pos=0),o._ib=ib,o._vb=vb,o._startIdx=pos*CONST3D2D.BYTES_PIDX,o._numEle=0,context._nBlendType),vb=(o._blendFn=(context._targets?BlendMode.targetFns:BlendMode.fns)[ib],o.shaderValue=sv,o.shaderValue.setValue(context._shader2D),context._shader2D.filters);return vb&&o.shaderValue.setFilters(vb),o},Submit.createShape=function(ctx,ib,vb,numEle,offset,sv){var o=Submit._cache._length?Submit._cache[--Submit._cache._length]:new Submit,ib=(o._ib=ib,o._vb=vb,o._numEle=numEle,o._startIdx=offset,o.shaderValue=sv,o.shaderValue.setValue(ctx._shader2D),ctx._nBlendType);return o._blendFn=(ctx._targets?BlendMode.targetFns:BlendMode.fns)[ib],o},Submit.TYPE_2D=1e4,Submit.TYPE_CANVAS=10003,Submit.TYPE_CMDSETRT=10004,Submit.TYPE_CUSTOM=10005,Submit.TYPE_BLURRT=10006,Submit.TYPE_CMDDESTORYPRERT=10007,Submit.TYPE_DISABLESTENCIL=10008,Submit.TYPE_OTHERIBVB=10009,Submit.TYPE_PRIMITIVE=10010,Submit.TYPE_RT=10011,Submit.TYPE_BLUR_RT=10012,Submit.TYPE_TARGET=10013,Submit.TYPE_CHANGE_VALUE=10014,Submit.TYPE_SHAPE=10015,Submit.TYPE_TEXTURE=10016,Submit.TYPE_FILLTEXTURE=10017,Submit.RENDERBASE=null,Submit._cache=((Submit._cache=[])._length=0,Submit._cache),Submit}()),SubmitCMD=function(){function SubmitCMD(){this.fun=null,this.args=null}__class(SubmitCMD,"laya.webgl.submit.SubmitCMD");var __proto=SubmitCMD.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0}),__proto.renderSubmit=function(){return this.fun.apply(null,this.args),1},__proto.getRenderType=function(){return 0},__proto.releaseRender=function(){var cache=SubmitCMD._cache;cache[cache._length++]=this},SubmitCMD.create=function(args,fun){var o=SubmitCMD._cache._length?SubmitCMD._cache[--SubmitCMD._cache._length]:new SubmitCMD;return o.fun=fun,o.args=args,o},SubmitCMD._cache=((SubmitCMD._cache=[])._length=0,SubmitCMD._cache),SubmitCMD}(),SubmitCMDScope=function(){function SubmitCMDScope(){this.variables={}}__class(SubmitCMDScope,"laya.webgl.submit.SubmitCMDScope");var __proto=SubmitCMDScope.prototype;return __proto.getValue=function(name){return this.variables[name]},__proto.addValue=function(name,value){return this.variables[name]=value},__proto.setValue=function(name,value){return this.variables.hasOwnProperty(name)?this.variables[name]=value:null},__proto.clear=function(){for(var key in this.variables)delete this.variables[key]},__proto.recycle=function(){this.clear(),SubmitCMDScope.POOL.push(this)},SubmitCMDScope.create=function(){return SubmitCMDScope.POOL.pop()||new SubmitCMDScope},SubmitCMDScope.POOL=[],SubmitCMDScope}(),SubmitOtherIBVB=function(){function SubmitOtherIBVB(){this.offset=0,this.startIndex=0,this._mat=Matrix.create()}__class(SubmitOtherIBVB,"laya.webgl.submit.SubmitOtherIBVB");var __proto=SubmitOtherIBVB.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0}),__proto.releaseRender=function(){var cache=SubmitOtherIBVB._cache;(cache[cache._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},__proto.getRenderType=function(){return 10009},__proto.renderSubmit=function(){var _tex=this._shaderValue.textureHost;if(_tex){var source=_tex.source;if(!_tex.bitmap||!source)return 1;this._shaderValue.texture=source}this._vb.bind_upload(this._ib);var _tex=RenderState2D.worldMatrix4,source=Matrix.TEMP,tmp=(Matrix.mulPre(this._mat,_tex[0],_tex[1],_tex[4],_tex[5],_tex[12],_tex[13],source),RenderState2D.worldMatrix4=SubmitOtherIBVB.tempMatrix4),tmp=(tmp[0]=source.a,tmp[1]=source.b,tmp[4]=source.c,tmp[5]=source.d,tmp[12]=source.tx,tmp[13]=source.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0,WebGL.mainContext);return BlendMode.activeBlendFunction!==this._blendFn&&(tmp.enable(3042),this._blendFn(tmp),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,tmp.drawElements(4,this._numEle,5123,this.startIndex),RenderState2D.worldMatrix4=_tex,BaseShader.activeShader=null,1},SubmitOtherIBVB.create=function(context,vb,ib,numElement,shader,shaderValue,startIndex,offset,type){void 0===type&&(type=0);var o=SubmitOtherIBVB._cache._length?SubmitOtherIBVB._cache[--SubmitOtherIBVB._cache._length]:new SubmitOtherIBVB,ib=(o._ib=ib,o._vb=vb,o._numEle=numElement,o._shader=shader,o._shaderValue=shaderValue,context._nBlendType);switch(o._blendFn=(context._targets?BlendMode.targetFns:BlendMode.fns)[ib],type){case 0:o.offset=0,o.startIndex=offset/(CONST3D2D.BYTES_PE*vb.vertexStride)*1.5,o.startIndex*=CONST3D2D.BYTES_PIDX;break;case 1:o.startIndex=startIndex,o.offset=offset}return o},SubmitOtherIBVB._cache=((SubmitOtherIBVB._cache=[])._length=0,SubmitOtherIBVB._cache),SubmitOtherIBVB.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SubmitOtherIBVB}(),SubmitScissor=function(){function SubmitScissor(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new Rectangle,this.screenRect=new Rectangle}__class(SubmitScissor,"laya.webgl.submit.SubmitScissor");var __proto=SubmitScissor.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0}),__proto._scissor=function(x,y,w,h){var m=RenderState2D.worldMatrix4,a=m[0],d=m[5],tx=m[12],m=m[13];return h*=d,!((w*=a)<1||h<1||(a=(x=x*a+tx)+w,tx=(y=y*d+m)+h,x<0&&(w=a-(x=0)),y<0&&(h=tx-(y=0)),d=RenderState2D.worldClipRect,x=Math.max(x,d.x),y=Math.max(y,d.y),w=Math.min(a,d.right)-x,h=Math.min(tx,d.bottom)-y,w<1)||h<1||(m=RenderState2D.worldScissorTest,this.screenRect.copyFrom(d),d.x=x,d.y=y,d.width=w,d.height=h,RenderState2D.worldScissorTest=!0,y=RenderState2D.height-y-h,WebGL.mainContext.scissor(x,y,w,h),WebGL.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),m?(y=RenderState2D.height-this.screenRect.y-this.screenRect.height,WebGL.mainContext.scissor(this.screenRect.x,y,this.screenRect.width,this.screenRect.height),WebGL.mainContext.enable(3089)):(WebGL.mainContext.disable(3089),RenderState2D.worldScissorTest=!1),d.copyFrom(this.screenRect),0))},__proto._scissorWithTagart=function(x,y,w,h){var b,screen,r;return!(w<1||h<1||(r=x+w,b=y+h,x<0&&(w=r-(x=0)),y<0&&(h=b-(y=0)),screen=RenderState2D.worldClipRect,x=Math.max(x,screen.x),y=Math.max(y,screen.y),w=Math.min(r,screen.right)-x,h=Math.min(b,screen.bottom)-y,w<1)||h<1||(r=RenderState2D.worldScissorTest,this.screenRect.copyFrom(screen),RenderState2D.worldScissorTest=!0,screen.x=x,screen.y=y,screen.width=w,screen.height=h,y=RenderState2D.height-y-h,WebGL.mainContext.scissor(x,y,w,h),WebGL.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),r?(y=RenderState2D.height-this.screenRect.y-this.screenRect.height,WebGL.mainContext.scissor(this.screenRect.x,y,this.screenRect.width,this.screenRect.height),WebGL.mainContext.enable(3089)):(WebGL.mainContext.disable(3089),RenderState2D.worldScissorTest=!1),screen.copyFrom(this.screenRect),0))},__proto.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},__proto.getRenderType=function(){return 0},__proto.releaseRender=function(){var cache=SubmitScissor._cache;(cache[cache._length++]=this).context=null},SubmitScissor.create=function(context){var o=SubmitScissor._cache._length?SubmitScissor._cache[--SubmitScissor._cache._length]:new SubmitScissor;return o.context=context,o},SubmitScissor._cache=((SubmitScissor._cache=[])._length=0,SubmitScissor._cache),SubmitScissor}(),SubmitStencil=function(){function SubmitStencil(){this.step=0,this.blendMode=null,this.level=0}__class(SubmitStencil,"laya.webgl.submit.SubmitStencil");var __proto=SubmitStencil.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0}),__proto.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},__proto.getRenderType=function(){return 0},__proto.releaseRender=function(){var cache=SubmitStencil._cache;cache[cache._length++]=this},__proto.do1=function(){var gl=WebGL.mainContext;gl.enable(2960),gl.clear(1024),gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(514,this.level,255),gl.stencilOp(7680,7680,7682)},__proto.do2=function(){var gl=WebGL.mainContext;gl.stencilFunc(514,this.level+1,255),gl.colorMask(!0,!0,!0,!0),gl.stencilOp(7680,7680,7680)},__proto.do3=function(){var gl=WebGL.mainContext;gl.colorMask(!0,!0,!0,!0),gl.stencilOp(7680,7680,7680),gl.clear(1024),gl.disable(2960)},__proto.do4=function(){var gl=WebGL.mainContext;0==this.level&&(gl.enable(2960),gl.clear(1024)),gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(519,0,255),gl.stencilOp(7680,7680,7682)},__proto.do5=function(){var gl=WebGL.mainContext;gl.stencilFunc(514,this.level,255),gl.colorMask(!0,!0,!0,!0),gl.stencilOp(7680,7680,7680)},__proto.do6=function(){var gl=WebGL.mainContext;BlendMode.targetFns[BlendMode.TOINT[this.blendMode]](gl)},__proto.do7=function(){var gl=WebGL.mainContext;gl.colorMask(!1,!1,!1,!1),gl.stencilOp(7680,7680,7683)},__proto.do8=function(){var gl=WebGL.mainContext;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(514,this.level,255),gl.stencilOp(7680,7680,7680)},SubmitStencil.restore=function(context,clip,m,_x,_y){var submitStencil,vb;(context._renderKey=0)<SubmitStencil._mask&&SubmitStencil._mask--,0==SubmitStencil._mask?(submitStencil=laya.webgl.submit.SubmitStencil.create(3),context.addRenderObject(submitStencil),context._curSubmit=Submit.RENDERBASE):(submitStencil=laya.webgl.submit.SubmitStencil.create(7),context.addRenderObject(submitStencil),(vb=context._vb)._byteLength,GlUtils.fillRectImgVb(vb,null,clip.x,clip.y,clip.width,clip.height,Texture.DEF_UV,m,_x,_y,0,0)?(context._shader2D.glTexture=null,(clip=context._curSubmit=Submit.createSubmit(context,context._ib,vb,(vb._byteLength-64)/32*3,Value2D.create(2,0))).shaderValue.ALPHA=1,context._submits[context._submits._length++]=clip,context._curSubmit._numEle+=6,context._curSubmit=Submit.RENDERBASE):alert("clipRect calc stencil rect error"),submitStencil=laya.webgl.submit.SubmitStencil.create(8),context.addRenderObject(submitStencil))},SubmitStencil.restore2=function(context,submit){var submitStencil;(context._renderKey=0)<SubmitStencil._mask&&SubmitStencil._mask--,0==SubmitStencil._mask?(submitStencil=laya.webgl.submit.SubmitStencil.create(3),context.addRenderObject(submitStencil),context._curSubmit=Submit.RENDERBASE):(submitStencil=laya.webgl.submit.SubmitStencil.create(7),context.addRenderObject(submitStencil),context._submits[context._submits._length++]=submit,submitStencil=laya.webgl.submit.SubmitStencil.create(8),context.addRenderObject(submitStencil))},SubmitStencil.create=function(step){var o=SubmitStencil._cache._length?SubmitStencil._cache[--SubmitStencil._cache._length]:new SubmitStencil;return 5==(o.step=step)&&++SubmitStencil._mask,o.level=SubmitStencil._mask,o},SubmitStencil._cache=((SubmitStencil._cache=[])._length=0,SubmitStencil._cache),SubmitStencil._mask=0,SubmitStencil}(),SubmitTarget=function(){function SubmitTarget(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}__class(SubmitTarget,"laya.webgl.submit.SubmitTarget");var __proto=SubmitTarget.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0}),__proto.renderSubmit=function(){this._vb.bind_upload(this._ib);var target=this.scope.getValue(this.proName);return target&&(this.shaderValue.texture=target.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[target.width,target.height]),this.shaderValue.upload(),this.blend(),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,WebGL.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},__proto.blend=function(){var gl;BlendMode.activeBlendFunction!==BlendMode.fns[this.blendType]&&((gl=WebGL.mainContext).enable(3042),BlendMode.fns[this.blendType](gl),BlendMode.activeBlendFunction=BlendMode.fns[this.blendType])},__proto.getRenderType=function(){return 0},__proto.releaseRender=function(){var cache=SubmitTarget._cache;(cache[cache._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},SubmitTarget.create=function(context,ib,vb,pos,sv,proName){var o=SubmitTarget._cache._length?SubmitTarget._cache[--SubmitTarget._cache._length]:new SubmitTarget;return o._ib=ib,o._vb=vb,o.proName=proName,o._startIdx=pos*CONST3D2D.BYTES_PIDX,o._numEle=0,o.blendType=context._nBlendType,o.shaderValue=sv,o.shaderValue.setValue(context._shader2D),o},SubmitTarget._cache=((SubmitTarget._cache=[])._length=0,SubmitTarget._cache),SubmitTarget}(),CharSegment=function(){function CharSegment(){this._sourceStr=null}__class(CharSegment,"laya.webgl.text.CharSegment");var __proto=CharSegment.prototype;return Laya.imps(__proto,{"laya.webgl.text.ICharSegment":!0}),__proto.textToSpit=function(str){this._sourceStr=str},__proto.getChar=function(i){return this._sourceStr.charAt(i)},__proto.getCharCode=function(i){return this._sourceStr.charCodeAt(i)},__proto.length=function(){return this._sourceStr.length},CharSegment}(),DrawText=function(){var CharValue;function DrawText(){}return __class(DrawText,"laya.webgl.text.DrawText"),DrawText.__init__=function(){DrawText._charsTemp=new Array,DrawText._drawValue=new CharValue,DrawText._charSeg=new CharSegment},DrawText.customCharSeg=function(charseg){DrawText._charSeg=charseg},DrawText.getChar=function(char,id,drawValue){char=WebGLCharImage.createOneChar(char,drawValue);return-1!=id&&(DrawText._charsCache[id]=char),char},DrawText._drawSlow=function(save,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine){var oneChar,htmlWord,drawValue=DrawText._drawValue.value(font,fillColor,borderColor,lineWidth,sx,sy,underLine),i=0,n=0,chars=DrawText._charsTemp,width=0,id=NaN;if(words)for(chars.length=words.length,i=0,n=words.length;i<n;i++)id=(htmlWord=words[i]).charNum+drawValue.txtID,chars[i]=oneChar=DrawText._charsCache[id]||DrawText.getChar(htmlWord.char,id,drawValue),oneChar.active();else{font=txt instanceof laya.utils.WordText?txt.toString():txt;if(Text.CharacterCache){DrawText._charSeg.textToSpit(font);for(fillColor=DrawText._charSeg.length(),i=0,n=chars.length=fillColor;i<n;i++)id=DrawText._charSeg.getCharCode(i)+drawValue.txtID,chars[i]=oneChar=DrawText._charsCache[id]||DrawText.getChar(DrawText._charSeg.getChar(i),id,drawValue),oneChar.active(),width+=oneChar.cw}else chars.length=0,(oneChar=DrawText.getChar(font,-1,drawValue)).active(),width+=oneChar.cw,chars[0]=oneChar}var dx=0;null!==textAlign&&"left"!==textAlign&&(dx=-("center"==textAlign?width/2:width));var texture,value,bdSz=NaN,saveLength=0;if(words)for(i=0,n=chars.length;i<n;i++)(oneChar=chars[i]).isSpace||(htmlWord=words[i],bdSz=oneChar.borderSize,texture=oneChar.texture,ctx._drawText(texture,x+dx+htmlWord.x*sx-bdSz,y+htmlWord.y*sy-bdSz,texture.width,texture.height,curMat,0,0,0,0));else{for(i=0,n=chars.length;i<n;i++)(oneChar=chars[i]).isSpace||(bdSz=oneChar.borderSize,texture=oneChar.texture,ctx._drawText(texture,x+dx-bdSz,y-bdSz,texture.width,texture.height,curMat,0,0,0,0),save&&((value=(value=save[saveLength++])||(save[saveLength-1]=[]))[0]=texture,value[1]=dx-bdSz,value[2]=-bdSz)),dx+=oneChar.cw;save&&(save.length=saveLength)}},DrawText._drawFast=function(save,ctx,curMat,x,y){for(var texture,value,i=0,n=save.length;i<n;i++)(texture=(value=save[i])[0]).active(),ctx._drawText(texture,x+value[1],y+value[2],texture.width,texture.height,curMat,0,0,0,0)},DrawText.drawText=function(ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,underLine){var sx,sy,t,tempTy;void 0===underLine&&(underLine=0),txt&&0===txt.length||words&&0===words.length||(sx=curMat.a,sy=curMat.d,!(!(1!==(sx=0===curMat.b&&0===curMat.c?sx:sy=1)||1!==sy)||!Laya.stage.transform)&&(t=Laya.stage.transform).a===sx&&t.d===sy?(t=(curMat=curMat.copyTo(WebGLContext2D._tmpMatrix)).tx,tempTy=curMat.ty,curMat.scale(1/sx,1/sy),curMat._checkTransform(),x=x*sx+(t-curMat.tx),y=y*sy+(tempTy-curMat.ty)):sx=sy=1,words?DrawText._drawSlow(null,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine):null===txt.toUpperCase?(t=sx+1e5*sy,(tempTy=txt).changed||tempTy.id!==t?(tempTy.id=t,tempTy.changed=!1,DrawText._drawSlow(tempTy.save,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine)):DrawText._drawFast(tempTy.save,ctx,curMat,x,y)):(t=txt+font.toString()+fillColor+borderColor+lineWidth+sx+sy+textAlign,tempTy=DrawText._textsCache[t],Text.CharacterCache?tempTy?DrawText._drawFast(tempTy,ctx,curMat,x,y):(DrawText._textsCache.__length||(DrawText._textsCache.__length=0),DrawText._textsCache.__length>Config.WebGLTextCacheCount&&((DrawText._textsCache={}).__length=0,DrawText._curPoolIndex=0),DrawText._textCachesPool[DrawText._curPoolIndex]?(tempTy=DrawText._textsCache[t]=DrawText._textCachesPool[DrawText._curPoolIndex]).length=0:DrawText._textCachesPool[DrawText._curPoolIndex]=tempTy=DrawText._textsCache[t]=[],DrawText._textsCache.__length++,DrawText._curPoolIndex++,DrawText._drawSlow(tempTy,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine)):DrawText._drawSlow(tempTy,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine)))},DrawText._charsTemp=null,DrawText._textCachesPool=[],DrawText._curPoolIndex=0,DrawText._charsCache={},DrawText._textsCache={},DrawText._drawValue=null,DrawText.d=[],DrawText._charSeg=null,DrawText.__init$=function(){CharValue=function(){function CharValue(){}return __class(CharValue,""),CharValue.prototype.value=function(font,fillColor,borderColor,lineWidth,scaleX,scaleY,underLine){this.font=font,this.fillColor=fillColor,this.borderColor=borderColor,this.lineWidth=lineWidth,this.scaleX=scaleX,this.scaleY=scaleY,this.underLine=underLine;font=font.toString()+scaleX+scaleY+lineWidth+(fillColor?fillColor.toLowerCase():" ")+(borderColor?borderColor.toLowerCase():" ")+underLine;return this.txtID=CharValue._keymap[font],this.txtID||(this.txtID=1e-7*++CharValue._keymapCount,CharValue._keymap[font]=this.txtID),this},CharValue.clear=function(){CharValue._keymap={},CharValue._keymapCount=1},CharValue._keymap={},CharValue._keymapCount=1,CharValue}()},DrawText}(),FontInContext=function(){function FontInContext(font){this._index=0,this._size=14,this._italic=-2,FontInContext._cache2=FontInContext._cache2||[],this.setFont(font||"14px Arial")}__class(FontInContext,"laya.webgl.text.FontInContext");var __proto=FontInContext.prototype;return __proto.setFont=function(value){var arr=FontInContext._cache2[value];if(arr)this._words=arr[0],this._size=arr[1];else{this._words=value.split(" ");for(var i=0,n=this._words.length;i<n;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),FontInContext._cache2[value]=[this._words,this._size]}this._text=null,this._italic=-2},__proto.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},__proto.hasType=function(name){for(var i=0,n=this._words.length;i<n;i++)if(this._words[i]===name)return i;return-1},__proto.removeType=function(name){for(var i=0,n=this._words.length;i<n;i++)if(this._words[i]===name){this._words.splice(i,1),this._index>i&&this._index--;break}this._text=null,this._italic=-2},__proto.copyTo=function(dec){return dec._text=this._text,dec._size=this._size,dec._index=this._index,dec._words=this._words.slice(),dec._italic=-2,dec},__proto.toString=function(){return this._text||(this._text=this._words.join(" "))},__getset(0,__proto,"size",function(){return this._size},function(value){this._size=value,this._words[this._index]=value+"px",this._text=null}),FontInContext.create=function(font){var r=FontInContext._cache[font];return r=r||(FontInContext._cache[font]=new FontInContext(font))},FontInContext.EMPTY=new FontInContext,FontInContext._cache={},FontInContext._cache2=null,FontInContext}(),CONST3D2D=function(){function CONST3D2D(){}return __class(CONST3D2D,"laya.webgl.utils.CONST3D2D"),CONST3D2D.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],CONST3D2D._TMPARRAY=[],CONST3D2D._OFFSETX=0,CONST3D2D._OFFSETY=0,__static(CONST3D2D,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),CONST3D2D}(),GlUtils=function(){function GlUtils(){}return __class(GlUtils,"laya.webgl.utils.GlUtils"),GlUtils.make2DProjection=function(width,height,depth){return[2/width,0,0,0,0,-2/height,0,0,0,0,2/depth,0,-1,1,0,1]},GlUtils.fillIBQuadrangle=function(buffer,count){if(65535/4<count)throw Error("IBQuadrangle count:"+count+" must<:"+Math.floor(65535/4));count=Math.floor(count),buffer._resizeBuffer(6*(count+1)*2,!1),buffer.byteLength=buffer.bufferLength;for(var bufferData=buffer.getUint16Array(),idx=0,i=0;i<count;i++)bufferData[idx++]=4*i,bufferData[idx++]=4*i+2,bufferData[idx++]=4*i+1,bufferData[idx++]=4*i,bufferData[idx++]=4*i+3,bufferData[idx++]=4*i+2;return buffer.setNeedUpload(),!0},GlUtils.expandIBQuadrangle=function(buffer,count){buffer.bufferLength>=6*count*2||GlUtils.fillIBQuadrangle(buffer,count)},GlUtils.mathCeilPowerOfTwo=function(value){return value--,value=(value=(value=(value=(value|=value>>1)|value>>2)|value>>4)|value>>8)|value>>16,++value},GlUtils.fillQuadrangleImgVb=function(vb,x,y,point4,uv,m,_x,_y){var tx,ty,vpos=16+(vb._byteLength>>2),vbdata=(vb.byteLength=vpos<<2,vb.getFloat32Array()),uv=(vbdata[2+(vpos-=16)]=uv[0],vbdata[3+vpos]=uv[1],vbdata[6+vpos]=uv[2],vbdata[7+vpos]=uv[3],vbdata[10+vpos]=uv[4],vbdata[11+vpos]=uv[5],vbdata[14+vpos]=uv[6],vbdata[15+vpos]=uv[7],m.a),b=m.b,c=m.c,d=m.d;return 1!==uv||0!==b||0!==c||1!==d?(m.bTransform=!0,tx=m.tx+_x,ty=m.ty+_y,vbdata[vpos]=(point4[0]+x)*uv+(point4[1]+y)*c+tx,vbdata[1+vpos]=(point4[0]+x)*b+(point4[1]+y)*d+ty,vbdata[4+vpos]=(point4[2]+x)*uv+(point4[3]+y)*c+tx,vbdata[5+vpos]=(point4[2]+x)*b+(point4[3]+y)*d+ty,vbdata[8+vpos]=(point4[4]+x)*uv+(point4[5]+y)*c+tx,vbdata[9+vpos]=(point4[4]+x)*b+(point4[5]+y)*d+ty,vbdata[12+vpos]=(point4[6]+x)*uv+(point4[7]+y)*c+tx,vbdata[13+vpos]=(point4[6]+x)*b+(point4[7]+y)*d+ty):(m.bTransform=!1,x+=m.tx+_x,y+=m.ty+_y,vbdata[vpos]=x+point4[0],vbdata[1+vpos]=y+point4[1],vbdata[4+vpos]=x+point4[2],vbdata[5+vpos]=y+point4[3],vbdata[8+vpos]=x+point4[4],vbdata[9+vpos]=y+point4[5],vbdata[12+vpos]=x+point4[6],vbdata[13+vpos]=y+point4[7]),vb._upload=!0},GlUtils.fillTranglesVB=function(vb,x,y,points,m,_x,_y){for(var tx,ty,vpos=(vb._byteLength>>2)+points.length,vbdata=(vb.byteLength=vpos<<2,vb.getFloat32Array()),len=(vpos-=points.length,points.length),a=m.a,b=m.b,c=m.c,d=m.d,i=0;i<len;i+=4)vbdata[vpos+i+2]=points[i+2],vbdata[vpos+i+3]=points[i+3],1!==a||0!==b||0!==c||1!==d?(m.bTransform=!0,tx=m.tx+_x,ty=m.ty+_y,vbdata[vpos+i]=(points[i]+x)*a+(points[i+1]+y)*c+tx,vbdata[vpos+i+1]=(points[i]+x)*b+(points[i+1]+y)*d+ty):(m.bTransform=!1,x+=m.tx+_x,y+=m.ty+_y,vbdata[vpos+i]=x+points[i],vbdata[vpos+i+1]=y+points[i+1]);return vb._upload=!0},GlUtils.copyPreImgVb=function(vb,dx,dy){for(var vpos=vb._byteLength>>2,vbdata=(vb.byteLength=vpos+16<<2,vb.getFloat32Array()),i=0,ci=vpos-16;i<4;i++)vbdata[vpos]=vbdata[ci]+dx,vbdata[++vpos]=vbdata[++ci]+dy,vbdata[++vpos]=vbdata[++ci],vbdata[++vpos]=vbdata[++ci],++vpos,++ci;vb._upload=!0},GlUtils.fillRectImgVb=function(vb,clip,x,y,width,height,uv,m,_x,_y,dx,dy,round){void 0===round&&(round=!1);var toBx,toBy,toEx,toEy,cBx,cBy,cEx,cEy,finalX,finalY,offsetX,offsetY,mType=1,a=m.a,b=m.b,c=m.c,d=m.d,useClip=clip&&clip.width<99999999;if(1!==a||0!==b||0!==c||1!==d?(m.bTransform=!0,0===b&&0===c&&(mType=23,toBx=a*x+(tx=m.tx+_x),toEx=a*(w0=width+x)+tx,toBy=d*y+(ty=m.ty+_y),toEy=d*(h0=height+y)+ty)):(m.bTransform=!(mType=23),toEx=(toBx=x+m.tx+_x)+width,toEy=(toBy=y+m.ty+_y)+height),useClip&&(cBx=clip.x,cBy=clip.y,cEx=clip.width+cBx,cEy=clip.height+cBy),1!==mType){if(Math.min(toBx,toEx)>=cEx)return!1;if(Math.min(toBy,toEy)>=cEy)return!1;if(Math.max(toEx,toBx)<=cBx)return!1;if(Math.max(toEy,toBy)<=cBy)return!1}var vpos=vb._byteLength>>2,vbdata=(vb.byteLength=16+vpos<<2,vb.getFloat32Array());switch(vbdata[2+vpos]=uv[0],vbdata[3+vpos]=uv[1],vbdata[6+vpos]=uv[2],vbdata[7+vpos]=uv[3],vbdata[10+vpos]=uv[4],vbdata[11+vpos]=uv[5],vbdata[14+vpos]=uv[6],vbdata[15+vpos]=uv[7],mType){case 1:var w0,h0,tx=m.tx+_x,ty=m.ty+_y,aw1=a*x,ch1=c*y,dh1=d*y,bw1=b*x,aw0=a*(w0=width+x),ch0=c*(h0=height+y),dh0=d*h0,bw0=b*w0;round?(finalX=aw1+ch1+tx,offsetX=Math.round(finalX)-finalX,finalY=dh1+bw1+ty,offsetY=Math.round(finalY)-finalY,vbdata[vpos]=finalX+offsetX,vbdata[1+vpos]=finalY+offsetY,vbdata[4+vpos]=aw0+ch1+tx+offsetX,vbdata[5+vpos]=dh1+bw0+ty+offsetY,vbdata[8+vpos]=aw0+ch0+tx+offsetX,vbdata[9+vpos]=dh0+bw0+ty+offsetY,vbdata[12+vpos]=aw1+ch0+tx+offsetX,vbdata[13+vpos]=dh0+bw1+ty+offsetY):(vbdata[vpos]=aw1+ch1+tx,vbdata[1+vpos]=dh1+bw1+ty,vbdata[4+vpos]=aw0+ch1+tx,vbdata[5+vpos]=dh1+bw0+ty,vbdata[8+vpos]=aw0+ch0+tx,vbdata[9+vpos]=dh0+bw0+ty,vbdata[12+vpos]=aw1+ch0+tx,vbdata[13+vpos]=dh0+bw1+ty);break;case 23:round?(finalX=toBx+dx,offsetX=Math.round(finalX)-finalX,finalY=toBy,offsetY=Math.round(finalY)-finalY,vbdata[vpos]=finalX+offsetX,vbdata[1+vpos]=finalY+offsetY,vbdata[4+vpos]=toEx+dx+offsetX,vbdata[5+vpos]=toBy+offsetY,vbdata[8+vpos]=toEx+offsetX,vbdata[9+vpos]=toEy+offsetY,vbdata[12+vpos]=toBx+offsetX,vbdata[13+vpos]=toEy+offsetY):(vbdata[vpos]=toBx+dx,vbdata[1+vpos]=toBy,vbdata[4+vpos]=toEx+dx,vbdata[5+vpos]=toBy,vbdata[8+vpos]=toEx,vbdata[9+vpos]=toEy,vbdata[12+vpos]=toBx,vbdata[13+vpos]=toEy)}return vb._upload=!0},GlUtils.fillLineVb=function(vb,clip,fx,fy,tx,ty,width,mat){var width=.5*width,data=GlUtils._fillLineArray,perpx=-(fy-ty),perpy=fx-tx,dist=Math.sqrt(perpx*perpx+perpy*perpy),dist=(perpy=perpy/dist*width,data[0]=fx-(perpx=perpx/dist*width),data[1]=fy-perpy,data[4]=fx+perpx,data[5]=fy+perpy,data[8]=tx+perpx,data[9]=ty+perpy,data[12]=tx-perpx,data[13]=ty-perpy,mat&&mat.transformPointArray(data,data),16+(vb._byteLength>>2));return vb.byteLength=dist<<2,vb.insertData(data,dist-16),!0},GlUtils._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],GlUtils}(),Mesh2D=(function(){function MatirxArray(){}__class(MatirxArray,"laya.webgl.utils.MatirxArray"),MatirxArray.ArrayMul=function(a,b,o){if(a)if(b)for(var ai0,ai1,ai2,ai3,i=0;i<4;i++)ai0=a[i],ai1=a[i+4],ai2=a[i+8],ai3=a[i+12],o[i]=ai0*b[0]+ai1*b[1]+ai2*b[2]+ai3*b[3],o[i+4]=ai0*b[4]+ai1*b[5]+ai2*b[6]+ai3*b[7],o[i+8]=ai0*b[8]+ai1*b[9]+ai2*b[10]+ai3*b[11],o[i+12]=ai0*b[12]+ai1*b[13]+ai2*b[14]+ai3*b[15];else MatirxArray.copyArray(a,o);else MatirxArray.copyArray(b,o)},MatirxArray.copyArray=function(f,t){if(f&&t)for(var i=0;i<f.length;i++)t[i]=f[i]}}(),function(){function Mesh2D(stride,vballoc,iballoc){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=stride,this._vb=new VertexBuffer2D(stride,35048),vballoc&&this._vb._resizeBuffer(vballoc,!1),this._ib=new IndexBuffer2D,iballoc&&this._ib._resizeBuffer(iballoc,!1)}__class(Mesh2D,"laya.webgl.utils.Mesh2D");var __proto=Mesh2D.prototype;return __proto.cloneWithNewVB=function(){var mesh=new Mesh2D(this._stride,0,0);return mesh._ib=this._ib,mesh._quadNum=this._quadNum,mesh._attribInfo=this._attribInfo,mesh},__proto.cloneWithNewVBIB=function(){var mesh=new Mesh2D(this._stride,0,0);return mesh._attribInfo=this._attribInfo,mesh},__proto.getVBW=function(){return this._vb.setNeedUpload(),this._vb},__proto.getVBR=function(){return this._vb},__proto.getIBR=function(){return this._ib},__proto.getIBW=function(){return this._ib.setNeedUpload(),this._ib},__proto.createQuadIB=function(QuadNum){this._quadNum=QuadNum,this._ib._resizeBuffer(6*QuadNum*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var bd=this._ib.getUint16Array(),idx=0,curvert=0,i=0;i<QuadNum;i++)bd[idx++]=curvert,bd[idx++]=curvert+2,bd[idx++]=curvert+1,bd[idx++]=curvert,bd[idx++]=curvert+3,bd[idx++]=curvert+2,curvert+=4;this._ib.setNeedUpload()},__proto.setAttributes=function(attribs){if(this._attribInfo=attribs,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},__proto.getEleNum=function(){return this._ib.getBuffer().byteLength/2},__proto.releaseMesh=function(){},__proto.destroy=function(){},__proto.clearVB=function(){this._vb.clear()},Mesh2D._gvaoid=0,Mesh2D}()),RenderState2D=function(){function RenderState2D(){}return __class(RenderState2D,"laya.webgl.utils.RenderState2D"),RenderState2D.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},RenderState2D.mat2MatArray=function(mat,matArray){var m4=matArray;return m4[0]=mat.a,m4[1]=mat.b,m4[2]=RenderState2D.EMPTYMAT4_ARRAY[2],m4[3]=RenderState2D.EMPTYMAT4_ARRAY[3],m4[4]=mat.c,m4[5]=mat.d,m4[6]=RenderState2D.EMPTYMAT4_ARRAY[6],m4[7]=RenderState2D.EMPTYMAT4_ARRAY[7],m4[8]=RenderState2D.EMPTYMAT4_ARRAY[8],m4[9]=RenderState2D.EMPTYMAT4_ARRAY[9],m4[10]=RenderState2D.EMPTYMAT4_ARRAY[10],m4[11]=RenderState2D.EMPTYMAT4_ARRAY[11],m4[12]=mat.tx,m4[13]=mat.ty,m4[14]=RenderState2D.EMPTYMAT4_ARRAY[14],m4[15]=RenderState2D.EMPTYMAT4_ARRAY[15],matArray},RenderState2D.restoreTempArray=function(){RenderState2D.TEMPMAT4_ARRAY[0]=1,RenderState2D.TEMPMAT4_ARRAY[1]=0,RenderState2D.TEMPMAT4_ARRAY[4]=0,RenderState2D.TEMPMAT4_ARRAY[5]=1,RenderState2D.TEMPMAT4_ARRAY[12]=0,RenderState2D.TEMPMAT4_ARRAY[13]=0},RenderState2D.clear=function(){RenderState2D.worldScissorTest=!1,RenderState2D.worldShaderDefines=null,RenderState2D.worldFilters=null,RenderState2D.worldAlpha=1,RenderState2D.worldClipRect.x=RenderState2D.worldClipRect.y=0,RenderState2D.worldClipRect.width=RenderState2D.width,RenderState2D.worldClipRect.height=RenderState2D.height,RenderState2D.curRenderTarget=null},RenderState2D._MAXSIZE=99999999,RenderState2D.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.worldAlpha=1,RenderState2D.worldScissorTest=!1,RenderState2D.worldFilters=null,RenderState2D.worldShaderDefines=null,RenderState2D.curRenderTarget=null,RenderState2D.width=0,RenderState2D.height=0,__static(RenderState2D,["worldMatrix",function(){return this.worldMatrix=new Matrix},"worldClipRect",function(){return this.worldClipRect=new Rectangle(0,0,99999999,99999999)}]),RenderState2D}(),ShaderCompile=function(){var ShaderNode,InlcudeFile;function ShaderCompile(name,vs,ps,nameMap,defs){var _$this=this;function _compile(script){var includefiles=[],top=new ShaderNode(includefiles);return _$this._compileToTree(top,script.split("\n"),0,includefiles,defs),top}var startTime=Browser.now();this._VS=_compile(vs),this._PS=_compile(ps),this._nameMap=nameMap,2<Browser.now()-startTime&&console.log("ShaderCompile use time:"+(Browser.now()-startTime)+"  size:"+vs.length+"/"+ps.length)}__class(ShaderCompile,"laya.webgl.utils.ShaderCompile");var __proto=ShaderCompile.prototype;return __proto._compileToTree=function(parent,lines,start,includefiles,defs){for(var node,preNode,text,name,ofs,noUseNode,n,i=0,j=0,i=start;i<lines.length;i++)if(!((text=lines[i]).length<1)&&0!==(ofs=text.indexOf("//"))){if(0<=ofs&&(text=text.substr(0,ofs)),node=noUseNode||new ShaderNode(includefiles),noUseNode=null,node.text=text,node.noCompile=!0,0<=(ofs=text.indexOf("#"))){for(name="#",j=ofs+1,n=text.length;j<n;j++){var c=text.charAt(j);if(" "===c||"\t"===c||"?"===c)break;name+=c}switch(node.name=name){case"#ifdef":case"#ifndef":if(node.src=text,node.noCompile=null!=text.match(/[!&|()=<>]/),node.noCompile?console.log("function():Boolean{return "+text.substr(ofs+node.name.length)+"}"):(words=text.replace(/^\s*/,"").split(/\s+/),node.setCondition(words[1],"#ifdef"===name?1:2),node.text="//"+node.text),node.setParent(parent),parent=node,defs)for(words=text.substr(j).split(ShaderCompile._splitToWordExps3),j=0;j<words.length;j++)(text=words[j]).length&&(defs[text]=!0);continue;case"#if":if(node.src=text,node.noCompile=!0,node.setParent(parent),parent=node,defs)for(words=text.substr(j).split(ShaderCompile._splitToWordExps3),j=0;j<words.length;j++)(text=words[j]).length&&"defined"!=text&&(defs[text]=!0);continue;case"#else":node.src=text,preNode=(parent=parent.parent).childs[parent.childs.length-1],node.noCompile=preNode.noCompile,node.noCompile||(node.condition=preNode.condition,node.conditionType=1==preNode.conditionType?2:1,node.text="//"+node.text+" "+preNode.text+" "+node.conditionType),node.setParent(parent),parent=node;continue;case"#endif":preNode=(parent=parent.parent).childs[parent.childs.length-1],node.noCompile=preNode.noCompile,node.noCompile||(node.text="//"+node.text),node.setParent(parent);continue;case"#include":var words=ShaderCompile.splitToWords(text,null),inlcudeFile=ShaderCompile.includes[words[1]];if(!inlcudeFile)throw"ShaderCompile error no this include file:"+words[1];if((ofs=words[0].indexOf("?"))<0){node.setParent(parent),text=inlcudeFile.getWith("with"==words[2]?words[3]:null),this._compileToTree(node,text.split("\n"),0,includefiles,defs),node.text="";continue}node.setCondition(words[0].substr(ofs+1),1),node.text=inlcudeFile.getWith("with"==words[2]?words[3]:null);break;case"#import":inlcudeFile=(words=ShaderCompile.splitToWords(text,null))[1],includefiles.push({node:node,file:ShaderCompile.includes[inlcudeFile],ofs:node.text.length});continue}}else{if((preNode=parent.childs[parent.childs.length-1])&&!preNode.name){0<includefiles.length&&ShaderCompile.splitToWords(text,preNode),noUseNode=node,preNode.text+="\n"+text;continue}0<includefiles.length&&ShaderCompile.splitToWords(text,node)}node.setParent(parent)}},__proto.createShader=function(define,shaderName,createShader){var defMap={},defineStr="";if(define)for(var i in define)defineStr+="#define "+i+"\n",defMap[i]=!0;var define=this._VS.toscript(defMap,[]),ps=this._PS.toscript(defMap,[]);return(createShader||Shader.create)(defineStr+define.join("\n"),defineStr+ps.join("\n"),shaderName,this._nameMap)},ShaderCompile._parseOne=function(attributes,uniforms,words,i,word,b){var one={type:ShaderCompile.shaderParamsMap[words[i+1]],name:words[i+2],size:isNaN(parseInt(words[i+3]))?1:parseInt(words[i+3])};return b&&("attribute"==word?attributes:uniforms).push(one),":"==words[i+3]&&(one.type=words[i+4],i+=2),i+=2},ShaderCompile.addInclude=function(fileName,txt){if(!txt||0===txt.length)throw new Error("add shader include file err:"+fileName);if(ShaderCompile.includes[fileName])throw new Error("add shader include file err, has add:"+fileName);ShaderCompile.includes[fileName]=new InlcudeFile(txt)},ShaderCompile.preGetParams=function(vs,ps){for(var text=[vs,ps],vs={},attributes=[],uniforms=[],definesInfo={},definesName=[],i=(vs.attributes=attributes,vs.uniforms=uniforms,vs.defines=definesInfo,0),s=0;s<2;s++){text[s]=text[s].replace(ShaderCompile._removeAnnotation,"");for(var words=text[s].match(ShaderCompile._reg),i=0,n=words.length;i<n;i++){var word=words[i];if("attribute"!=word&&"uniform"!=word){if("#define"==word)definesName[word=words[++i]]=1;else if("#ifdef"==word){var tempelse;definesInfo[tempelse=words[++i]]=definesInfo[tempelse]||[];for(i++;i<n;i++)if("attribute"!=(word=words[i])&&"uniform"!=word){if("#else"==word)for(i++;i<n;i++)if("attribute"!=(word=words[i])&&"uniform"!=word){if("#endif"==word)break}else i=ShaderCompile._parseOne(attributes,uniforms,words,i,word,!definesName[tempelse])}else i=ShaderCompile._parseOne(attributes,uniforms,words,i,word,definesName[tempelse])}}else i=ShaderCompile._parseOne(attributes,uniforms,words,i,word,!0)}}return vs},ShaderCompile.splitToWords=function(str,block){for(var c,word,out=[],ofs=-1,i=0,n=str.length;i<n;i++)if(c=str.charAt(i),0<=" \t=+-*/&%!<>()'\",;".indexOf(c)){if(0<=ofs&&1<i-ofs&&(word=str.substr(ofs,i-ofs),out.push(word)),'"'==c||"'"==c){var ofs2=str.indexOf(c,i+1);if(ofs2<0)throw"Sharder err:"+str;out.push(str.substr(i+1,ofs2-i-1)),i=ofs2}else"("==c&&block&&0<out.length&&"vec4;main;".indexOf(word=out[out.length-1]+";")<0&&(block.useFuns+=word);ofs=-1}else ofs<0&&(ofs=i);return ofs<n&&1<n-ofs&&(word=str.substr(ofs,n-ofs),out.push(word)),out},ShaderCompile.IFDEF_NO=0,ShaderCompile.IFDEF_YES=1,ShaderCompile.IFDEF_ELSE=2,ShaderCompile.IFDEF_PARENT=3,ShaderCompile._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),ShaderCompile._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),ShaderCompile._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),ShaderCompile.includes={},__static(ShaderCompile,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),ShaderCompile.__init$=function(){ShaderNode=function(){function ShaderNode(includefiles){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=includefiles}__class(ShaderNode,"");var __proto=ShaderNode.prototype;return __proto.setParent=function(parent){parent.childs.push(this),this.z=parent.z+1,this.parent=parent},__proto.setCondition=function(condition,type){condition&&(this.conditionType=type,condition=condition.replace(/(\s*$)/g,""),this.condition=function(){return this[condition]},this.condition.__condition=condition)},__proto.toscript=function(def,out){return this._toscript(def,out,++ShaderNode.__id)},__proto._toscript=function(def,out,id){if(!(this.childs.length<1)||this.text){out.length;if(this.condition){var ifdef=!!this.condition.call(def);if(!(ifdef=2===this.conditionType?!ifdef:ifdef))return out}if(this.text&&out.push(this.text),0<this.childs.length&&this.childs.forEach(function(o,index,arr){o._toscript(def,out,id)}),0<this.includefiles.length&&0<this.useFuns.length)for(var funsCode,i=0,n=this.includefiles.length;i<n;i++)this.includefiles[i].curUseID!=id&&0<(funsCode=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=id,out[0]=funsCode+out[0])}return out},ShaderNode.__id=1,ShaderNode}(),InlcudeFile=function(){function InlcudeFile(txt){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=txt;for(var begin=0,end=0;!((begin=txt.indexOf("#begin",begin))<0);){for(end=begin+5;;){if((end=txt.indexOf("#end",end))<0)break;if("i"!==txt.charAt(end+4))break;end+=5}if(end<0)throw"add include err,no #end:"+txt;var ofs=txt.indexOf("\n",begin),words=ShaderCompile.splitToWords(txt.substr(begin,ofs-begin),null);"code"==words[1]?this.codes[words[2]]=txt.substr(ofs+1,end-ofs-1):"function"==words[1]&&(ofs=txt.indexOf("function",begin),ofs+="function".length,this.funs[words[3]]=txt.substr(ofs+1,end-ofs-1),this.funnames+=words[3]+";"),begin=end+1}}__class(InlcudeFile,"");var __proto=InlcudeFile.prototype;return __proto.getWith=function(name){var r=name?this.codes[name]:this.script;if(r)return r;throw"get with error:"+name},__proto.getFunsScript=function(funsdef){var i,r="";for(i in this.funs)0<=funsdef.indexOf(i+";")&&(r+=this.funs[i]);return r},InlcudeFile}()},ShaderCompile}(),WebGL=function(){function WebGL(){}return __class(WebGL,"laya.webgl.WebGL"),WebGL._uint8ArraySlice=function(){for(var sz=this.length,dec=new Uint8Array(this.length),i=0;i<sz;i++)dec[i]=this[i];return dec},WebGL._float32ArraySlice=function(){for(var sz=this.length,dec=new Float32Array(this.length),i=0;i<sz;i++)dec[i]=this[i];return dec},WebGL._uint16ArraySlice=function(__arg){var dec,arg=arguments,sz=0,i=0;if(0===arg.length)for(sz=this.length,dec=new Uint16Array(sz),i=0;i<sz;i++)dec[i]=this[i];else if(2===arg.length){var start=arg[0],end=arg[1];if(start<end)for(sz=end-start,dec=new Uint16Array(sz),i=start;i<end;i++)dec[i-start]=this[i];else dec=new Uint16Array(0)}return dec},WebGL.expandContext=function(){var from=Context.prototype,to=CanvasRenderingContext2D.prototype;to.fillTrangles=from.fillTrangles,Buffer2D.__int__(null),to.setIBVB=function(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset){void 0===startIndex&&(startIndex=0),void 0===offset&&(offset=0),null===ib&&(this._ib=this._ib||IndexBuffer2D.QuadrangleIB,ib=this._ib,GlUtils.expandIBQuadrangle(ib,vb._byteLength/64+8)),this._setIBVB(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset)},to.fillTrangles=function(tex,x,y,points,m){this._curMat=this._curMat||Matrix.create(),this._vb=this._vb||VertexBuffer2D.create(),this._ib||(this._ib=IndexBuffer2D.create(),GlUtils.fillIBQuadrangle(this._ib,length/4));var vb=this._vb,length=points.length>>4,points=(GlUtils.fillTranglesVB(vb,x,y,points,m||this._curMat,0,0),GlUtils.expandIBQuadrangle(this._ib,vb._byteLength/64+8),new Value2D(1,0)),tex=(points.textureHost=tex,new Shader2X("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}"));vb._vertType=3,this._setIBVB(x,y,this._ib,vb,6*length,m,tex,points,0,0)}},WebGL.enable=function(){var action;return Browser.__init__(),Render.isConchApp&&!Render.isConchWebGL?(RunDriver.skinAniSprite=function(){return new SkinMesh},WebGL.expandContext(),!1):(RunDriver.getWebGLContext=function(canvas){for(var gl,names=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=0;i<names.length;i++){try{gl=canvas.getContext(names[i],{stencil:Config.isStencil,alpha:Config.isAlpha,antialias:Config.isAntialias,premultipliedAlpha:Config.premultipliedAlpha,preserveDrawingBuffer:Config.preserveDrawingBuffer})}catch(e){}if(gl)return gl}return null},null!=(WebGL.mainContext=RunDriver.getWebGLContext(Render._mainCanvas))&&(Render.isWebGL||(HTMLImage.create=function(src,def){return new WebGLImage(src,def)},HTMLSubImage.create=function(canvas,offsetX,offsetY,width,height,atlasImage,src){return new WebGLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src)},Render.WebGL=WebGL,Render.isWebGL=!0,DrawText.__init__(),RunDriver.createRenderSprite=function(type,next){return new RenderSprite3D(type,next)},RunDriver.createWebGLContext2D=function(c){return new WebGLContext2D(c)},RunDriver.changeWebGLSize=function(width,height){laya.webgl.WebGL.onStageResize(width,height)},RunDriver.createGraphics=function(){return new GraphicsGL},action=RunDriver.createFilterAction,RunDriver.createFilterAction=action||function(type){return new ColorFilterActionGL},RunDriver.clear=function(color){RenderState2D.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var ctx=Render.context.ctx,color=0==ctx._submits._length||Config.preserveDrawingBuffer?Color.create(color)._color:Stage._wgColor;color&&ctx.clearBG(color[0],color[1],color[2],color[3]),RenderState2D.clear()},RunDriver.addToAtlas=function(texture,force){void 0===force&&(force=!1);force=texture.bitmap;Render.optimizeTextureMemory(texture.url,texture)?Laya.__typeof(force,"laya.webgl.resource.IMergeAtlasBitmap")&&force.allowMerageInAtlas&&force.on("recovered",texture,texture.addTextureToAtlas):force.enableMerageInAtlas=!1},RunDriver.isAtlas=function(bitmap){return bitmap instanceof laya.webgl.atlas.AtlasWebGLCanvas},AtlasResourceManager._enable(),RunDriver.beginFlush=function(){for(var atlasResourceManager=AtlasResourceManager.instance,count=atlasResourceManager.getAtlaserCount(),i=0;i<count;i++){var atlerCanvas=atlasResourceManager.getAtlaserByIndex(i).texture;atlerCanvas._flashCacheImageNeedFlush&&RunDriver.flashFlushImage(atlerCanvas)}},RunDriver.drawToCanvas=function(sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){(canvasWidth<=0||canvasHeight<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),offsetX|=0,offsetY|=0;var renderTarget=RenderTarget2D.create(canvasWidth|=0,canvasHeight|=0,6408,5121,0,!1),_renderType=(renderTarget.start(),renderTarget.clear(0,0,0,0),Render.context.clear(),RenderSprite.renders[_renderType]._fun(sprite,Render.context,offsetX,RenderState2D.height-canvasHeight+offsetY),Render.context.flush(),renderTarget.end(),renderTarget.getData(0,0,canvasWidth,canvasHeight));if(renderTarget.recycle(),_renderType.byteLength==canvasWidth*canvasHeight*4)return(sprite=new WebGLCanvas)._canvas=Browser.createElement("canvas"),sprite.size(canvasWidth,canvasHeight),offsetX=sprite._canvas.getContext("2d"),Browser.canvas.size(canvasWidth,canvasHeight),(renderTarget=(offsetY=Browser.context).createImageData(canvasWidth,canvasHeight)).data.set(new Uint8ClampedArray(_renderType.buffer)),sprite._imgData=renderTarget,offsetY.putImageData(renderTarget,0,0),offsetX.save(),offsetX.translate(0,canvasHeight),offsetX.scale(1,-1),offsetX.drawImage(Browser.canvas.source,0,0),offsetX.restore(),sprite;console.log("drawToCanvas error: w:"+canvasWidth+",h:"+canvasHeight+",datalen:"+_renderType.byteLength)},RunDriver.createFilterAction=function(type){var action;return action=32===type?new ColorFilterActionGL:action},RunDriver.addTextureToAtlas=function(texture){texture._uvID++,AtlasResourceManager._atlasRestore++,texture.bitmap.enableMerageInAtlas&&AtlasResourceManager.instance.addToAtlas(texture)},RunDriver.getTexturePixels=function(value,x,y,width,height){Render.context.ctx.clear();for(var tIndex,tSprite=new Sprite,value=(tSprite.graphics.drawTexture(value,-x,-y),RenderTarget2D.create(width,height)),tUint8Array=(value.start(),value.clear(0,0,0,0),tSprite.render(Render.context,0,0),Render.context.ctx.flush(),value.end(),value.getData(0,0,width,height)),tArray=[],i=height-1;0<=i;i--)for(var j=0;j<width;j++)tArray.push(tUint8Array[tIndex=4*(i*width+j)]),tArray.push(tUint8Array[1+tIndex]),tArray.push(tUint8Array[2+tIndex]),tArray.push(tUint8Array[3+tIndex]);return tArray},RunDriver.skinAniSprite=function(){return new SkinMesh},HTMLCanvas.create=function(type,canvas){var ret=new WebGLCanvas;return ret._imgData=canvas,ret.flipY=!1,ret},Filter._filterStart=function(scope,sprite,context,x,y){var b=scope.getValue("bounds"),b=RenderTarget2D.create(b.width,b.height);b.start(),b.clear(0,0,0,0),scope.addValue("src",b),scope.addValue("ScissorTest",RenderState2D.worldScissorTest),RenderState2D.worldScissorTest&&((b=new Rectangle).copyFrom(context.ctx._clipRect),scope.addValue("clipRect",b),RenderState2D.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089))},Filter._filterEnd=function(scope,sprite,context,x,y){var b=scope.getValue("bounds"),b=(scope.getValue("src").end(),RenderTarget2D.create(b.width,b.height));b.start(),b.clear(0,0,0,0),scope.addValue("out",b),sprite._set$P("_filterCache",b),sprite._set$P("_isHaveGlowFilter",scope.getValue("_isHaveGlowFilter"))},Filter._EndTarget=function(scope,context){scope.getValue("src").recycle(),scope.getValue("out").end(),scope.getValue("ScissorTest")&&(RenderState2D.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),context.ctx.save(),scope=scope.getValue("clipRect"),context.ctx.clipRect(scope.x,scope.y,scope.width,scope.height))},Filter._useSrc=function(scope){var source=scope.getValue("out");source.end(),(source=scope.getValue("src")).start(),source.clear(0,0,0,0)},Filter._endSrc=function(scope){scope.getValue("src").end()},Filter._useOut=function(scope){var source=scope.getValue("src");source.end(),(source=scope.getValue("out")).start(),source.clear(0,0,0,0)},Filter._endOut=function(scope){scope.getValue("out").end()},Filter._recycleScope=function(scope){scope.recycle()},Filter._filter=function(sprite,context,x,y){var next=this._next;if(next){var filters=sprite.filters,len=filters.length;if(1==len&&32==filters[0].type)context.ctx.save(),context.ctx.setFilters([filters[0]]),next._fun.call(next,sprite,context,x,y),context.ctx.restore();else{var shaderValue,b,scope=SubmitCMDScope.create(),p=Point.TEMP,tMatrix=context.ctx._getTransformMatrix(),mat=Matrix.create(),tMatrix=(tMatrix.copyTo(mat),0),tHalfPadding=0,tIsHaveGlowFilter=!1,out=sprite._$P._filterCache||null;if(!out||sprite._repaint){tIsHaveGlowFilter=sprite._isHaveGlowFilter(),scope.addValue("_isHaveGlowFilter",tIsHaveGlowFilter),tIsHaveGlowFilter&&(tMatrix=50,tHalfPadding=25),(b=new Rectangle).copyFrom(sprite.getSelfBounds()),b.x+=sprite.x,b.y+=sprite.y,b.x-=sprite.pivotX+4,b.y-=sprite.pivotY+4;var tSX=b.x,tSY=b.y;if(b.width+=tMatrix+8,b.height+=tMatrix+8,p.x=b.x*mat.a+b.y*mat.c,p.y=b.y*mat.d+b.x*mat.b,b.x=p.x,b.y=p.y,p.x=b.width*mat.a+b.height*mat.c,p.y=b.height*mat.d+b.width*mat.b,b.width=p.x,b.height=p.y,b.width<=0||b.height<=0)return;out&&out.recycle(),scope.addValue("bounds",b);var submit=SubmitCMD.create([scope,sprite,context,0,0],Filter._filterStart),tSX=(context.addRenderObject(submit),context.ctx._renderKey=0,context.ctx._shader2D.glTexture=null,sprite.x-tSX+tHalfPadding),tSY=sprite.y-tSY+tHalfPadding;next._fun.call(next,sprite,context,tSX,tSY),submit=SubmitCMD.create([scope,sprite,context,0,0],Filter._filterEnd),context.addRenderObject(submit);for(var i=0;i<len;i++)0!=i&&(submit=SubmitCMD.create([scope],Filter._useSrc),context.addRenderObject(submit),shaderValue=Value2D.create(1,0),Matrix.TEMP.identity(),context.ctx.drawTarget(scope,0,0,b.width,b.height,Matrix.TEMP,"out",shaderValue,null,BlendMode.TOINT.overlay),submit=SubmitCMD.create([scope],Filter._useOut),context.addRenderObject(submit)),filters[i].action.apply3d(scope,sprite,context,0,0);submit=SubmitCMD.create([scope,context],Filter._EndTarget),context.addRenderObject(submit)}else{if((tIsHaveGlowFilter=sprite._$P._isHaveGlowFilter||!1)&&(tMatrix=50,tHalfPadding=25),(b=sprite.getBounds()).width<=0||b.height<=0)return;b.width+=tMatrix,b.height+=tMatrix,p.x=b.x*mat.a+b.y*mat.c,p.y=b.y*mat.d+b.x*mat.b,b.x=p.x,b.y=p.y,p.x=b.width*mat.a+b.height*mat.c,p.y=b.height*mat.d+b.width*mat.b,b.width=p.x,b.height=p.y,scope.addValue("out",out)}x=x-tHalfPadding-sprite.x,y=y-tHalfPadding-sprite.y,p.setTo(x,y),mat.transformPoint(p),x=p.x+b.x,y=p.y+b.y,shaderValue=Value2D.create(1,0),Matrix.TEMP.identity(),context.ctx.drawTarget(scope,x,y,b.width,b.height,Matrix.TEMP,"out",shaderValue,null,BlendMode.TOINT.overlay),submit=SubmitCMD.create([scope],Filter._recycleScope),context.addRenderObject(submit),mat.destroy()}}},Float32Array.prototype.slice||(Float32Array.prototype.slice=WebGL._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=WebGL._uint16ArraySlice),Uint8Array.prototype.slice)||(Uint8Array.prototype.slice=WebGL._uint8ArraySlice),!0))},WebGL.onStageResize=function(width,height){null!=WebGL.mainContext&&(WebGL.mainContext.viewport(0,0,width,height),RenderState2D.width=width,RenderState2D.height=height)},WebGL.onInvalidGLRes=function(){AtlasResourceManager.instance.freeAll(),ResourceManager.releaseContentManagers(!0),WebGL.doNodeRepaint(Laya.stage),WebGL.mainContext.viewport(0,0,RenderState2D.width,RenderState2D.height),Laya.stage.event("devicelost")},WebGL.doNodeRepaint=function(sprite){0==sprite.numChildren&&sprite.repaint();for(var i=0;i<sprite.numChildren;i++)WebGL.doNodeRepaint(sprite.getChildAt(i))},WebGL.init=function(canvas,width,height){WebGL.mainCanvas=canvas,HTMLCanvas._createContext=function(canvas){return new WebGLContext2D(canvas)},WebGLCanvas._createContext=function(canvas){return new WebGLContext2D(canvas)};var framePrecisionFormat,gl=laya.webgl.WebGL.mainContext;if(null!=gl.getShaderPrecisionFormat?(canvas=gl.getShaderPrecisionFormat(35633,36338),framePrecisionFormat=gl.getShaderPrecisionFormat(35632,36338),WebGL.shaderHighPrecision=!(!canvas.precision||!framePrecisionFormat.precision)):WebGL.shaderHighPrecision=!1,WebGL.compressAstc=gl.getExtension("WEBGL_compressed_texture_astc"),WebGL.compressAtc=gl.getExtension("WEBGL_compressed_texture_atc"),WebGL.compressEtc=gl.getExtension("WEBGL_compressed_texture_etc"),WebGL.compressEtc1=gl.getExtension("WEBGL_compressed_texture_etc1"),WebGL.compressPvrtc=gl.getExtension("WEBGL_compressed_texture_pvrtc"),WebGL.compressS3tc=gl.getExtension("WEBGL_compressed_texture_s3tc"),WebGL.compressS3tc_srgb=gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),gl.deleteTexture1=gl.deleteTexture,gl.deleteTexture=function(t){t==WebGLContext.curBindTexValue&&(WebGLContext.curBindTexValue=null),gl.deleteTexture1(t)},WebGL.onStageResize(width,height),null==WebGL.mainContext)throw new Error("webGL getContext err!");System.__init__(),AtlasResourceManager.__init__(),ShaderDefines2D.__init__(),Submit.__init__(),WebGLContext2D.__init__(),Value2D.__init__(),Shader2D.__init__(),Buffer2D.__int__(gl),BlendMode._init_(gl),Render.isConchApp&&conch.setOnInvalidGLRes(WebGL.onInvalidGLRes)},WebGL.compressAstc=null,WebGL.compressAtc=null,WebGL.compressEtc=null,WebGL.compressEtc1=null,WebGL.compressPvrtc=null,WebGL.compressS3tc=null,WebGL.compressS3tc_srgb=null,WebGL.mainCanvas=null,WebGL.mainContext=null,WebGL.antialias=!0,WebGL.shaderHighPrecision=!1,WebGL._bg_null=[0,0,0,0],WebGL}(),WebGLContext=function(){function WebGLContext(){}return __class(WebGLContext,"laya.webgl.WebGLContext"),WebGLContext.UseProgram=function(program){return WebGLContext._useProgram!==program&&(WebGL.mainContext.useProgram(program),WebGLContext._useProgram=program,!0)},WebGLContext.setDepthTest=function(gl,value){value!==WebGLContext._depthTest&&((WebGLContext._depthTest=value)?gl.enable(2929):gl.disable(2929))},WebGLContext.setDepthMask=function(gl,value){value!==WebGLContext._depthMask&&(WebGLContext._depthMask=value,gl.depthMask(value))},WebGLContext.setDepthFunc=function(gl,value){value!==WebGLContext._depthFunc&&(WebGLContext._depthFunc=value,gl.depthFunc(value))},WebGLContext.setBlend=function(gl,value){value!==WebGLContext._blend&&((WebGLContext._blend=value)?gl.enable(3042):gl.disable(3042))},WebGLContext.setBlendFunc=function(gl,sFactor,dFactor){sFactor===WebGLContext._sFactor&&dFactor===WebGLContext._dFactor||(WebGLContext._sFactor=sFactor,WebGLContext._dFactor=dFactor,gl.blendFunc(sFactor,dFactor))},WebGLContext.setCullFace=function(gl,value){value!==WebGLContext._cullFace&&((WebGLContext._cullFace=value)?gl.enable(2884):gl.disable(2884))},WebGLContext.setFrontFace=function(gl,value){value!==WebGLContext._frontFace&&(WebGLContext._frontFace=value,gl.frontFace(value))},WebGLContext.bindTexture=function(gl,target,texture){gl.bindTexture(target,texture),WebGLContext.curBindTexTarget=target,WebGLContext.curBindTexValue=texture},WebGLContext.DEPTH_BUFFER_BIT=256,WebGLContext.STENCIL_BUFFER_BIT=1024,WebGLContext.COLOR_BUFFER_BIT=16384,WebGLContext.POINTS=0,WebGLContext.LINES=1,WebGLContext.LINE_LOOP=2,WebGLContext.LINE_STRIP=3,WebGLContext.TRIANGLES=4,WebGLContext.TRIANGLE_STRIP=5,WebGLContext.TRIANGLE_FAN=6,WebGLContext.ZERO=0,WebGLContext.ONE=1,WebGLContext.SRC_COLOR=768,WebGLContext.ONE_MINUS_SRC_COLOR=769,WebGLContext.SRC_ALPHA=770,WebGLContext.ONE_MINUS_SRC_ALPHA=771,WebGLContext.DST_ALPHA=772,WebGLContext.ONE_MINUS_DST_ALPHA=773,WebGLContext.DST_COLOR=774,WebGLContext.ONE_MINUS_DST_COLOR=775,WebGLContext.SRC_ALPHA_SATURATE=776,WebGLContext.FUNC_ADD=32774,WebGLContext.BLEND_EQUATION=32777,WebGLContext.BLEND_EQUATION_RGB=32777,WebGLContext.BLEND_EQUATION_ALPHA=34877,WebGLContext.FUNC_SUBTRACT=32778,WebGLContext.FUNC_REVERSE_SUBTRACT=32779,WebGLContext.BLEND_DST_RGB=32968,WebGLContext.BLEND_SRC_RGB=32969,WebGLContext.BLEND_DST_ALPHA=32970,WebGLContext.BLEND_SRC_ALPHA=32971,WebGLContext.CONSTANT_COLOR=32769,WebGLContext.ONE_MINUS_CONSTANT_COLOR=32770,WebGLContext.CONSTANT_ALPHA=32771,WebGLContext.ONE_MINUS_CONSTANT_ALPHA=32772,WebGLContext.BLEND_COLOR=32773,WebGLContext.ARRAY_BUFFER=34962,WebGLContext.ELEMENT_ARRAY_BUFFER=34963,WebGLContext.ARRAY_BUFFER_BINDING=34964,WebGLContext.ELEMENT_ARRAY_BUFFER_BINDING=34965,WebGLContext.STREAM_DRAW=35040,WebGLContext.STATIC_DRAW=35044,WebGLContext.DYNAMIC_DRAW=35048,WebGLContext.BUFFER_SIZE=34660,WebGLContext.BUFFER_USAGE=34661,WebGLContext.CURRENT_VERTEX_ATTRIB=34342,WebGLContext.FRONT=1028,WebGLContext.BACK=1029,WebGLContext.CULL_FACE=2884,WebGLContext.FRONT_AND_BACK=1032,WebGLContext.BLEND=3042,WebGLContext.DITHER=3024,WebGLContext.STENCIL_TEST=2960,WebGLContext.DEPTH_TEST=2929,WebGLContext.SCISSOR_TEST=3089,WebGLContext.POLYGON_OFFSET_FILL=32823,WebGLContext.SAMPLE_ALPHA_TO_COVERAGE=32926,WebGLContext.SAMPLE_COVERAGE=32928,WebGLContext.NO_ERROR=0,WebGLContext.INVALID_ENUM=1280,WebGLContext.INVALID_VALUE=1281,WebGLContext.INVALID_OPERATION=1282,WebGLContext.OUT_OF_MEMORY=1285,WebGLContext.CW=2304,WebGLContext.CCW=2305,WebGLContext.LINE_WIDTH=2849,WebGLContext.ALIASED_POINT_SIZE_RANGE=33901,WebGLContext.ALIASED_LINE_WIDTH_RANGE=33902,WebGLContext.CULL_FACE_MODE=2885,WebGLContext.FRONT_FACE=2886,WebGLContext.DEPTH_RANGE=2928,WebGLContext.DEPTH_WRITEMASK=2930,WebGLContext.DEPTH_CLEAR_VALUE=2931,WebGLContext.DEPTH_FUNC=2932,WebGLContext.STENCIL_CLEAR_VALUE=2961,WebGLContext.STENCIL_FUNC=2962,WebGLContext.STENCIL_FAIL=2964,WebGLContext.STENCIL_PASS_DEPTH_FAIL=2965,WebGLContext.STENCIL_PASS_DEPTH_PASS=2966,WebGLContext.STENCIL_REF=2967,WebGLContext.STENCIL_VALUE_MASK=2963,WebGLContext.STENCIL_WRITEMASK=2968,WebGLContext.STENCIL_BACK_FUNC=34816,WebGLContext.STENCIL_BACK_FAIL=34817,WebGLContext.STENCIL_BACK_PASS_DEPTH_FAIL=34818,WebGLContext.STENCIL_BACK_PASS_DEPTH_PASS=34819,WebGLContext.STENCIL_BACK_REF=36003,WebGLContext.STENCIL_BACK_VALUE_MASK=36004,WebGLContext.STENCIL_BACK_WRITEMASK=36005,WebGLContext.VIEWPORT=2978,WebGLContext.SCISSOR_BOX=3088,WebGLContext.COLOR_CLEAR_VALUE=3106,WebGLContext.COLOR_WRITEMASK=3107,WebGLContext.UNPACK_ALIGNMENT=3317,WebGLContext.PACK_ALIGNMENT=3333,WebGLContext.MAX_TEXTURE_SIZE=3379,WebGLContext.MAX_VIEWPORT_DIMS=3386,WebGLContext.SUBPIXEL_BITS=3408,WebGLContext.RED_BITS=3410,WebGLContext.GREEN_BITS=3411,WebGLContext.BLUE_BITS=3412,WebGLContext.ALPHA_BITS=3413,WebGLContext.DEPTH_BITS=3414,WebGLContext.STENCIL_BITS=3415,WebGLContext.POLYGON_OFFSET_UNITS=10752,WebGLContext.POLYGON_OFFSET_FACTOR=32824,WebGLContext.TEXTURE_BINDING_2D=32873,WebGLContext.SAMPLE_BUFFERS=32936,WebGLContext.SAMPLES=32937,WebGLContext.SAMPLE_COVERAGE_VALUE=32938,WebGLContext.SAMPLE_COVERAGE_INVERT=32939,WebGLContext.NUM_COMPRESSED_TEXTURE_FORMATS=34466,WebGLContext.COMPRESSED_TEXTURE_FORMATS=34467,WebGLContext.DONT_CARE=4352,WebGLContext.FASTEST=4353,WebGLContext.NICEST=4354,WebGLContext.GENERATE_MIPMAP_HINT=33170,WebGLContext.BYTE=5120,WebGLContext.UNSIGNED_BYTE=5121,WebGLContext.SHORT=5122,WebGLContext.UNSIGNED_SHORT=5123,WebGLContext.INT=5124,WebGLContext.UNSIGNED_INT=5125,WebGLContext.FLOAT=5126,WebGLContext.DEPTH_COMPONENT=6402,WebGLContext.ALPHA=6406,WebGLContext.RGB=6407,WebGLContext.RGBA=6408,WebGLContext.LUMINANCE=6409,WebGLContext.LUMINANCE_ALPHA=6410,WebGLContext.UNSIGNED_SHORT_4_4_4_4=32819,WebGLContext.UNSIGNED_SHORT_5_5_5_1=32820,WebGLContext.UNSIGNED_SHORT_5_6_5=33635,WebGLContext.FRAGMENT_SHADER=35632,WebGLContext.VERTEX_SHADER=35633,WebGLContext.MAX_VERTEX_ATTRIBS=34921,WebGLContext.MAX_VERTEX_UNIFORM_VECTORS=36347,WebGLContext.MAX_VARYING_VECTORS=36348,WebGLContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,WebGLContext.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,WebGLContext.MAX_TEXTURE_IMAGE_UNITS=34930,WebGLContext.MAX_FRAGMENT_UNIFORM_VECTORS=36349,WebGLContext.SHADER_TYPE=35663,WebGLContext.DELETE_STATUS=35712,WebGLContext.LINK_STATUS=35714,WebGLContext.VALIDATE_STATUS=35715,WebGLContext.ATTACHED_SHADERS=35717,WebGLContext.ACTIVE_UNIFORMS=35718,WebGLContext.ACTIVE_ATTRIBUTES=35721,WebGLContext.SHADING_LANGUAGE_VERSION=35724,WebGLContext.CURRENT_PROGRAM=35725,WebGLContext.NEVER=512,WebGLContext.LESS=513,WebGLContext.EQUAL=514,WebGLContext.LEQUAL=515,WebGLContext.GREATER=516,WebGLContext.NOTEQUAL=517,WebGLContext.GEQUAL=518,WebGLContext.ALWAYS=519,WebGLContext.KEEP=7680,WebGLContext.REPLACE=7681,WebGLContext.INCR=7682,WebGLContext.DECR=7683,WebGLContext.INVERT=5386,WebGLContext.INCR_WRAP=34055,WebGLContext.DECR_WRAP=34056,WebGLContext.VENDOR=7936,WebGLContext.RENDERER=7937,WebGLContext.VERSION=7938,WebGLContext.NEAREST=9728,WebGLContext.LINEAR=9729,WebGLContext.NEAREST_MIPMAP_NEAREST=9984,WebGLContext.LINEAR_MIPMAP_NEAREST=9985,WebGLContext.NEAREST_MIPMAP_LINEAR=9986,WebGLContext.LINEAR_MIPMAP_LINEAR=9987,WebGLContext.TEXTURE_MAG_FILTER=10240,WebGLContext.TEXTURE_MIN_FILTER=10241,WebGLContext.TEXTURE_WRAP_S=10242,WebGLContext.TEXTURE_WRAP_T=10243,WebGLContext.TEXTURE_2D=3553,WebGLContext.TEXTURE=5890,WebGLContext.TEXTURE_CUBE_MAP=34067,WebGLContext.TEXTURE_BINDING_CUBE_MAP=34068,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_X=34069,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,WebGLContext.MAX_CUBE_MAP_TEXTURE_SIZE=34076,WebGLContext.TEXTURE0=33984,WebGLContext.TEXTURE1=33985,WebGLContext.TEXTURE2=33986,WebGLContext.TEXTURE3=33987,WebGLContext.TEXTURE4=33988,WebGLContext.TEXTURE5=33989,WebGLContext.TEXTURE6=33990,WebGLContext.TEXTURE7=33991,WebGLContext.TEXTURE8=33992,WebGLContext.TEXTURE9=33993,WebGLContext.TEXTURE10=33994,WebGLContext.TEXTURE11=33995,WebGLContext.TEXTURE12=33996,WebGLContext.TEXTURE13=33997,WebGLContext.TEXTURE14=33998,WebGLContext.TEXTURE15=33999,WebGLContext.TEXTURE16=34e3,WebGLContext.TEXTURE17=34001,WebGLContext.TEXTURE18=34002,WebGLContext.TEXTURE19=34003,WebGLContext.TEXTURE20=34004,WebGLContext.TEXTURE21=34005,WebGLContext.TEXTURE22=34006,WebGLContext.TEXTURE23=34007,WebGLContext.TEXTURE24=34008,WebGLContext.TEXTURE25=34009,WebGLContext.TEXTURE26=34010,WebGLContext.TEXTURE27=34011,WebGLContext.TEXTURE28=34012,WebGLContext.TEXTURE29=34013,WebGLContext.TEXTURE30=34014,WebGLContext.TEXTURE31=34015,WebGLContext.ACTIVE_TEXTURE=34016,WebGLContext.REPEAT=10497,WebGLContext.CLAMP_TO_EDGE=33071,WebGLContext.MIRRORED_REPEAT=33648,WebGLContext.FLOAT_VEC2=35664,WebGLContext.FLOAT_VEC3=35665,WebGLContext.FLOAT_VEC4=35666,WebGLContext.INT_VEC2=35667,WebGLContext.INT_VEC3=35668,WebGLContext.INT_VEC4=35669,WebGLContext.BOOL=35670,WebGLContext.BOOL_VEC2=35671,WebGLContext.BOOL_VEC3=35672,WebGLContext.BOOL_VEC4=35673,WebGLContext.FLOAT_MAT2=35674,WebGLContext.FLOAT_MAT3=35675,WebGLContext.FLOAT_MAT4=35676,WebGLContext.SAMPLER_2D=35678,WebGLContext.SAMPLER_CUBE=35680,WebGLContext.VERTEX_ATTRIB_ARRAY_ENABLED=34338,WebGLContext.VERTEX_ATTRIB_ARRAY_SIZE=34339,WebGLContext.VERTEX_ATTRIB_ARRAY_STRIDE=34340,WebGLContext.VERTEX_ATTRIB_ARRAY_TYPE=34341,WebGLContext.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,WebGLContext.VERTEX_ATTRIB_ARRAY_POINTER=34373,WebGLContext.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,WebGLContext.COMPILE_STATUS=35713,WebGLContext.LOW_FLOAT=36336,WebGLContext.MEDIUM_FLOAT=36337,WebGLContext.HIGH_FLOAT=36338,WebGLContext.LOW_INT=36339,WebGLContext.MEDIUM_INT=36340,WebGLContext.HIGH_INT=36341,WebGLContext.FRAMEBUFFER=36160,WebGLContext.RENDERBUFFER=36161,WebGLContext.RGBA4=32854,WebGLContext.RGB5_A1=32855,WebGLContext.RGB565=36194,WebGLContext.DEPTH_COMPONENT16=33189,WebGLContext.STENCIL_INDEX=6401,WebGLContext.STENCIL_INDEX8=36168,WebGLContext.DEPTH_STENCIL=34041,WebGLContext.RENDERBUFFER_WIDTH=36162,WebGLContext.RENDERBUFFER_HEIGHT=36163,WebGLContext.RENDERBUFFER_INTERNAL_FORMAT=36164,WebGLContext.RENDERBUFFER_RED_SIZE=36176,WebGLContext.RENDERBUFFER_GREEN_SIZE=36177,WebGLContext.RENDERBUFFER_BLUE_SIZE=36178,WebGLContext.RENDERBUFFER_ALPHA_SIZE=36179,WebGLContext.RENDERBUFFER_DEPTH_SIZE=36180,WebGLContext.RENDERBUFFER_STENCIL_SIZE=36181,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,WebGLContext.COLOR_ATTACHMENT0=36064,WebGLContext.DEPTH_ATTACHMENT=36096,WebGLContext.STENCIL_ATTACHMENT=36128,WebGLContext.DEPTH_STENCIL_ATTACHMENT=33306,WebGLContext.NONE=0,WebGLContext.FRAMEBUFFER_COMPLETE=36053,WebGLContext.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,WebGLContext.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,WebGLContext.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,WebGLContext.FRAMEBUFFER_UNSUPPORTED=36061,WebGLContext.FRAMEBUFFER_BINDING=36006,WebGLContext.RENDERBUFFER_BINDING=36007,WebGLContext.MAX_RENDERBUFFER_SIZE=34024,WebGLContext.INVALID_FRAMEBUFFER_OPERATION=1286,WebGLContext.UNPACK_FLIP_Y_WEBGL=37440,WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,WebGLContext.CONTEXT_LOST_WEBGL=37442,WebGLContext.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,WebGLContext.BROWSER_DEFAULT_WEBGL=37444,WebGLContext._useProgram=null,WebGLContext._depthTest=!0,WebGLContext._depthMask=!0,WebGLContext._blend=!1,WebGLContext._cullFace=!1,WebGLContext.curBindTexTarget=null,WebGLContext.curBindTexValue=null,__static(WebGLContext,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),WebGLContext}(),GraphicsGL=function(){function GraphicsGL(){GraphicsGL.__super.call(this)}__class(GraphicsGL,"laya.webgl.display.GraphicsGL",Graphics);var __proto=GraphicsGL.prototype;return __proto.setShader=function(shader){this._saveToCmd(Render.context._setShader,[shader])},__proto.setIBVB=function(x,y,ib,vb,numElement,shader){this._saveToCmd(Render.context._setIBVB,[x,y,ib,vb,numElement,shader])},__proto.drawParticle=function(x,y,ps){ps=RunDriver.createParticleTemplate2D(ps);ps.x=x,ps.y=y,this._saveToCmd(Render.context._drawParticle,[ps])},GraphicsGL}(),WebGLContext2D=function(){var ContextParams;function WebGLContext2D(c){this._x=0,this._y=0,this._id=++WebGLContext2D._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,WebGLContext2D.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=WebGLContext2D.MAXCLIPRECT,this.mOutPoint,this._canvas=c,this._canvas._addReference(),WebGLContext2D._contextcount++,Render.isFlash?(this._ib=IndexBuffer2D.create(35044),GlUtils.fillIBQuadrangle(this._ib,16)):this._ib=IndexBuffer2D.QuadrangleIB,this.clear()}__class(WebGLContext2D,"laya.webgl.canvas.WebGLContext2D",Context);var __proto=WebGLContext2D.prototype;return __proto.setIsMainContext=function(){this._isMain=!0},__proto.clearBG=function(r,g,b,a){var gl=WebGL.mainContext;gl.clearColor(r,g,b,a),gl.clear(16384)},__proto._getSubmits=function(){return this._submits},__proto._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},__proto.destroy=function(){--WebGLContext2D._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=IndexBuffer2D.QuadrangleIB&&this._ib.releaseResource()},__proto.clear=function(){this._submits||(this._other=ContextParams.DEFAULT,this._curMat=Matrix.create(),this._vb=VertexBuffer2D.create(-1),this._submits=[],this._save=[SaveMark.Create(this)],this._save.length=10,this._shader2D=new Shader2D,this._triangleMesh=MeshTexture.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=ContextParams.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=WebGLContext2D.MAXCLIPRECT,this._curSubmit=Submit.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=DrawStyle.DEFAULT;for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender(),this._submits[i]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},__proto.size=function(w,h){if(this._width!=w||this._height!=h)if(0==w||0==h){0!=this._vb._byteLength&&(this._width=w,this._height=h,this._vb.clear(),this._vb.upload());for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=w,this._height=h,this._targets&&this._targets.size(w,h),this._canvas.memorySize-=this._canvas.memorySize;0===w&&0===h&&this._releaseMem()},__proto._getTransformMatrix=function(){return this._curMat},__proto.translate=function(x,y){0===x&&0===y||(SaveTranslate.save(this),this._curMat.bTransform&&(SaveTransform.save(this),this._curMat.transformPointN(Point.TEMP.setTo(x,y)),x=Point.TEMP.x,y=Point.TEMP.y),this._x+=x,this._y+=y)},__proto.save=function(){this._save[this._save._length++]=SaveMark.Create(this)},__proto.restore=function(){var sz=this._save._length;if(!(sz<1))for(var i=sz-1;0<=i;i--){var o=this._save[i];if(o.restore(this),o.isSaveMark())return void(this._save._length=i)}},__proto._fillText=function(txt,words,x,y,fontStr,color,strokeColor,lineWidth,textAlign,underLine){void 0===underLine&&(underLine=0);var colorAdd,shader=this._shader2D,curShader=this._curSubmit.shaderValue,fontStr=fontStr?FontInContext.create(fontStr):this._other.font;AtlasResourceManager.enabled?shader.ALPHA!==curShader.ALPHA&&(shader.glTexture=null):(this._shader2D.defines.getValue(),colorAdd=color?Color.create(color)._color:shader.colorAdd,shader.ALPHA===curShader.ALPHA&&colorAdd===shader.colorAdd&&curShader.colorAdd===shader.colorAdd||(shader.glTexture=null,shader.colorAdd=colorAdd)),DrawText.drawText(this,txt,words,this._curMat,fontStr,textAlign||this._other.textAlign,color,strokeColor,lineWidth,x,y,underLine)},__proto.fillWords=function(words,x,y,fontStr,color,underLine){this._fillText(null,words,x,y,fontStr,color,null,-1,null,underLine)},__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){this._fillBorderText(null,words,x,y,font,color,borderColor,lineWidth,null)},__proto.fillText=function(txt,x,y,fontStr,color,textAlign){this._fillText(txt,null,x,y,fontStr,color,null,-1,textAlign)},__proto.strokeText=function(txt,x,y,fontStr,color,lineWidth,textAlign){this._fillText(txt,null,x,y,fontStr,null,color,lineWidth||1,textAlign)},__proto.fillBorderText=function(txt,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign){this._fillBorderText(txt,null,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign)},__proto._fillBorderText=function(txt,words,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign){var shader,curShader;AtlasResourceManager.enabled?(shader=this._shader2D,curShader=this._curSubmit.shaderValue,shader.ALPHA!==curShader.ALPHA&&(shader.glTexture=null),curShader=fontStr?(WebGLContext2D._fontTemp.setFont(fontStr),WebGLContext2D._fontTemp):this._other.font,DrawText.drawText(this,txt,words,this._curMat,curShader,textAlign||this._other.textAlign,fillColor,borderColor,lineWidth||1,x,y,0)):(this._fillText(txt,words,x,y,fontStr,null,borderColor,lineWidth||1,textAlign),this._fillText(txt,words,x,y,fontStr,fillColor,null,-1,textAlign))},__proto.fillRect=function(x,y,width,height,fillStyle){var vb=this._vb;GlUtils.fillRectImgVb(vb,this._clipRect,x,y,width,height,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)&&(this._renderKey=0,x=this._shader2D.fillStyle,fillStyle&&(this._shader2D.fillStyle=DrawStyle.create(fillStyle)),y=this._shader2D,width=this._curSubmit.shaderValue,y.fillStyle===width.fillStyle&&y.ALPHA===width.ALPHA||(y.glTexture=null,(height=this._curSubmit=Submit.createSubmit(this,this._ib,vb,(vb._byteLength-64)/32*3,Value2D.create(2,0))).shaderValue.color=y.fillStyle._color._color,height.shaderValue.ALPHA=y.ALPHA,this._submits[this._submits._length++]=height),this._curSubmit._numEle+=6,this._shader2D.fillStyle=x)},__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){if(texture.loaded&&texture.bitmap&&texture.source){var tTextureW,tx,ty,vb=this._vb,w=texture.bitmap.width,h=texture.bitmap.height,uv=texture.uv,ox=offset.x%texture.width,oy=offset.y%texture.height;if(w!=other.w||h!=other.h){if(!other.w&&!other.h)switch(other.oy=other.ox=0,type){case"repeat":other.width=width,other.height=height;break;case"repeat-x":other.width=width,oy<0?texture.height+oy>height?other.height=height:other.height=texture.height+oy:(other.oy=oy,texture.height+oy>height?other.height=height-oy:other.height=texture.height);break;case"repeat-y":ox<0?texture.width+ox>width?other.width=width:other.width=texture.width+ox:(other.ox=ox,texture.width+ox>width?other.width=width-ox:other.width=texture.width),other.height=height;break;case"no-repeat":ox<0?texture.width+ox>width?other.width=width:other.width=texture.width+ox:(other.ox=ox,texture.width+ox>width?other.width=width-ox:other.width=texture.width),oy<0?texture.height+oy>height?other.height=height:other.height=texture.height+oy:(other.oy=oy,texture.height+oy>height?other.height=height-oy:other.height=texture.height);break;default:other.width=width,other.height=height}other.w=w,other.h=h,other.uv=[0,0,other.width/w,0,other.width/w,other.height/h,0,other.height/h]}x+=other.ox,y+=other.oy,ox-=other.ox,oy-=other.oy,GlUtils.fillRectImgVb(vb,this._clipRect,x,y,other.width,other.height,other.uv,this._curMat,this._x,this._y,0,0)&&(this._renderKey=0,offset=SubmitTexture.create(this,this._ib,vb,(vb._byteLength-64)/32*3,Value2D.create(256,0)),(type=(this._submits[this._submits._length++]=offset).shaderValue).textureHost=texture,x=uv[0]*w,y=uv[1]*h,tTextureW=(uv[2]-uv[0])*w,uv=(uv[5]-uv[3])*h,tx=-ox/w,ty=-oy/h,type.u_TexRange[0]=x/w,type.u_TexRange[1]=tTextureW/w,type.u_TexRange[2]=y/h,type.u_TexRange[3]=uv/h,type.u_offset[0]=tx,type.u_offset[1]=ty,AtlasResourceManager.enabled&&!this._isMain&&offset.addTexture(texture,(vb._byteLength>>2)-16),(this._curSubmit=offset)._renderType=10017,offset._numEle+=6)}else this.sprite&&Laya.timer.callLater(this,this._repaintSprite)},__proto.setShader=function(shader){SaveBase.save(this,1048576,this._shader2D,!0),this._shader2D.shader=shader},__proto.setFilters=function(value){SaveBase.save(this,2097152,this._shader2D,!0),this._shader2D.filters=value,this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._drawCount++},__proto.drawTexture=function(tex,x,y,width,height,tx,ty){this._drawTextureM(tex,x,y,width,height,tx,ty,null,1)},__proto.addTextureVb=function(invb,x,y){for(var finalVB=this._curSubmit._vb||this._vb,vpos=finalVB._byteLength>>2,vbdata=(finalVB.byteLength=vpos+16<<2,finalVB.getFloat32Array()),i=0;i<16;i+=4)vbdata[vpos++]=invb[i]+x,vbdata[vpos++]=invb[i+1]+y,vbdata[vpos++]=invb[i+2],vbdata[vpos++]=invb[i+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),finalVB._upload=!0},__proto.willDrawTexture=function(tex,alpha){var rid,shader,preAlpha,curShader,webGLImg,vbSize;return tex.loaded&&tex.bitmap&&tex.source?((rid=(webGLImg=tex.bitmap).id+this._shader2D.ALPHA*alpha+10016)!=this._renderKey&&(preAlpha=(shader=this._shader2D).ALPHA,curShader=this._curSubmit.shaderValue,shader.ALPHA*=alpha,this._renderKey=rid,this._drawCount++,shader.glTexture=webGLImg,alpha=null,vbSize=(webGLImg=this._vb)._byteLength/32*3,alpha=SubmitTexture.create(this,this._ib,webGLImg,vbSize,Value2D.create(1,0)),(this._submits[this._submits._length++]=alpha).shaderValue.textureHost=tex,alpha._renderType=10016,alpha._preIsSameTextureShader=10016===this._curSubmit._renderType&&shader.ALPHA===curShader.ALPHA,this._curSubmit=alpha,shader.ALPHA=preAlpha),rid):(this.sprite&&Laya.timer.callLater(this,this._repaintSprite),0)},__proto.drawTextures=function(tex,pos,tx,ty){if(tex.loaded&&tex.bitmap&&tex.source){var pre=this._clipRect;if(this._clipRect=WebGLContext2D.MAXCLIPRECT,this._drawTextureM(tex,pos[0],pos[1],tex.width,tex.height,tx,ty,null,1)){if(this._clipRect=pre,Stat.drawCall++,!(pos.length<4)){for(var finalVB=this._curSubmit._vb||this._vb,sx=this._curMat.a,sy=this._curMat.d,i=2,sz=pos.length;i<sz;i+=2)GlUtils.copyPreImgVb(finalVB,(pos[i]-pos[i-2])*sx,(pos[i+1]-pos[i-1])*sy),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&Laya.timer.callLater(this,this._repaintSprite)},__proto._drawTextureM=function(tex,x,y,width,height,tx,ty,m,alpha){var finalVB,alphaBack,webGLImg,vbSize;return tex.loaded&&tex.source?(finalVB=this._curSubmit._vb||this._vb,webGLImg=tex.bitmap,x+=tx,y+=ty,this._drawCount++,(tx=webGLImg.id+this._shader2D.ALPHA*alpha+10016)!=this._renderKey&&(this._renderKey=tx,ty=this._curSubmit.shaderValue,alphaBack=(tx=this._shader2D).ALPHA,tx.ALPHA*=alpha,tx.glTexture=webGLImg,alpha=null,vbSize=(webGLImg=this._vb)._byteLength/32*3,alpha=SubmitTexture.create(this,this._ib,webGLImg,vbSize,Value2D.create(1,0)),(this._submits[this._submits._length++]=alpha).shaderValue.textureHost=tex,alpha._renderType=10016,alpha._preIsSameTextureShader=10016===this._curSubmit._renderType&&tx.ALPHA===ty.ALPHA,this._curSubmit=alpha,finalVB=this._curSubmit._vb||this._vb,tx.ALPHA=alphaBack),!!GlUtils.fillRectImgVb(finalVB,this._clipRect,x,y,width||tex.width,height||tex.height,tex.uv,m||this._curMat,this._x,this._y,0,0)&&(AtlasResourceManager.enabled&&!this._isMain&&this._curSubmit.addTexture(tex,(finalVB._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)):(this.sprite&&Laya.timer.callLater(this,this._repaintSprite),!1)},__proto._repaintSprite=function(){this.sprite&&this.sprite.repaint()},__proto._drawText=function(tex,x,y,width,height,m,tx,ty,dx,dy){var shader,vbSize,webGLImg=tex.bitmap,rid=(this._drawCount++,webGLImg.id+this._shader2D.ALPHA+10016),vb=(rid!=this._renderKey&&(this._renderKey=rid,rid=this._curSubmit.shaderValue,(shader=this._shader2D).glTexture=webGLImg,webGLImg=null,vbSize=(vb=this._vb)._byteLength/32*3,(webGLImg=AtlasResourceManager.enabled?SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(1,0)):SubmitTexture.create(this,this._ib,vb,vbSize,TextSV.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&shader.ALPHA===rid.ALPHA,(this._submits[this._submits._length++]=webGLImg).shaderValue.textureHost=tex,webGLImg._renderType=10016,this._curSubmit=webGLImg),tex.active(),this._curSubmit._vb||this._vb);GlUtils.fillRectImgVb(vb,this._clipRect,x+tx,y+ty,width||tex.width,height||tex.height,tex.uv,m||this._curMat,this._x,this._y,dx,dy,!0)&&(AtlasResourceManager.enabled&&!this._isMain&&this._curSubmit.addTexture(tex,(vb._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},__proto.drawTextureWithTransform=function(tex,x,y,width,height,transform,tx,ty,alpha){var curMat,prex,prey;transform?(curMat=this._curMat,prex=this._x,prey=this._y,0===tx&&0===ty||(this._x=tx*curMat.a+ty*curMat.c,this._y=ty*curMat.d+tx*curMat.b),transform&&curMat.bTransform?(Matrix.mul(transform,curMat,WebGLContext2D._tmpMatrix),(transform=WebGLContext2D._tmpMatrix)._checkTransform()):(this._x+=curMat.tx,this._y+=curMat.ty),this._drawTextureM(tex,x,y,width,height,0,0,transform,alpha),this._x=prex,this._y=prey):this._drawTextureM(tex,x,y,width,height,tx,ty,null,alpha)},__proto.fillQuadrangle=function(tex,x,y,point4,m){var t_tex,submit=this._curSubmit,vb=this._vb,shader=this._shader2D,curShader=submit.shaderValue;this._renderKey=0,tex.bitmap?(t_tex=tex.bitmap,shader.glTexture==t_tex&&shader.ALPHA===curShader.ALPHA||(shader.glTexture=t_tex,(submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,vb._byteLength/32*3,Value2D.create(1,0))).shaderValue.glTexture=t_tex,this._submits[this._submits._length++]=submit),GlUtils.fillQuadrangleImgVb(vb,x,y,point4,tex.uv,m||this._curMat,this._x,this._y)):(submit.shaderValue.fillStyle&&submit.shaderValue.fillStyle.equal(tex)&&shader.ALPHA===curShader.ALPHA||(shader.glTexture=null,(submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,vb._byteLength/32*3,Value2D.create(2,0))).shaderValue.defines.add(2),submit.shaderValue.fillStyle=DrawStyle.create(tex),this._submits[this._submits._length++]=submit),GlUtils.fillQuadrangleImgVb(vb,x,y,point4,Texture.DEF_UV,m||this._curMat,this._x,this._y)),submit._numEle+=6},__proto.drawTexture2=function(x,y,pivotX,pivotY,transform,alpha,blendMode,args){var curMat;0!=alpha&&(curMat=this._curMat,this._x=x*curMat.a+y*curMat.c,this._y=y*curMat.d+x*curMat.b,transform=transform&&(curMat.bTransform||transform.bTransform?(Matrix.mul(transform,curMat,WebGLContext2D._tmpMatrix),WebGLContext2D._tmpMatrix):(this._x+=transform.tx+curMat.tx,this._y+=transform.ty+curMat.ty,Matrix.EMPTY)),1!==alpha||blendMode?(y=this._shader2D.ALPHA,x=this._nBlendType,this._shader2D.ALPHA=alpha,blendMode&&(this._nBlendType=BlendMode.TOINT(blendMode)),this._drawTextureM(args[0],args[1]-pivotX,args[2]-pivotY,args[3],args[4],0,0,transform,1),this._shader2D.ALPHA=y,this._nBlendType=x):this._drawTextureM(args[0],args[1]-pivotX,args[2]-pivotY,args[3],args[4],0,0,transform,1),this._x=this._y=0)},__proto.drawCanvas=function(canvas,x,y,width,height){var submit,sx,src=canvas.context;this._renderKey=0,src._targets?(this._submits[this._submits._length++]=SubmitCanvas.create(src,0,null),this._curSubmit=Submit.RENDERBASE,src._targets.drawTo(this,x,y,width,height)):(submit=this._submits[this._submits._length++]=SubmitCanvas.create(src,this._shader2D.ALPHA,this._shader2D.filters),sx=width/canvas.width,canvas=height/canvas.height,submit=submit._matrix,this._curMat.copyTo(submit),1!=sx&&1!=canvas&&submit.scale(sx,canvas),sx=submit.tx,canvas=submit.ty,submit.tx=submit.ty=0,submit.transformPoint(Point.TEMP.setTo(x,y)),submit.translate(Point.TEMP.x+sx,Point.TEMP.y+canvas),this._curSubmit=Submit.RENDERBASE),Config.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=src._targets?"yellow":"green",this.strokeRect(x-1,y-1,width+2,height+2,1),this.strokeRect(x,y,width,height,1),this.restore())},__proto.drawTarget=function(scope,x,y,width,height,m,proName,shaderValue,uv,blend){void 0===blend&&(blend=-1);var vb=this._vb;GlUtils.fillRectImgVb(vb,this._clipRect,x,y,width,height,uv||Texture.DEF_UV,m||this._curMat,this._x,this._y,0,0)&&(this._renderKey=0,this._shader2D.glTexture=null,this._curSubmit.shaderValue,(x=this._curSubmit=SubmitTarget.create(this,this._ib,vb,(vb._byteLength-64)/32*3,shaderValue,proName)).blendType=-1==blend?this._nBlendType:blend,x.scope=scope,this._submits[this._submits._length++]=x,this._curSubmit._numEle+=6)},__proto.mixRGBandAlpha=function(color){return this._mixRGBandAlpha(color,this._shader2D.ALPHA)},__proto._mixRGBandAlpha=function(color,alpha){var a=(4278190080&color)>>>24;return 0!=a?a*=alpha:a=255*alpha,16777215&color|a<<24},__proto.drawTriangles=function(tex,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){if(!tex.loaded||!tex.source)return this.sprite&&Laya.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;tex.bitmap;var alpha=this._mixRGBandAlpha(4294967295,alpha),eleNum=(vertices.length,indices.length),submit=(this._renderKey=-1,this._curSubmit=SubmitTexture.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Value2D.create(1,0)));return submit.shaderValue.textureHost=tex,submit._renderType=10016,this._submits[this._submits._length++]=submit,matrix?(WebGLContext2D._tmpMatrix.a=matrix.a,WebGLContext2D._tmpMatrix.b=matrix.b,WebGLContext2D._tmpMatrix.c=matrix.c,WebGLContext2D._tmpMatrix.d=matrix.d,WebGLContext2D._tmpMatrix.tx=matrix.tx+x,WebGLContext2D._tmpMatrix.ty=matrix.ty+y,Matrix.mul(WebGLContext2D._tmpMatrix,this._curMat,WebGLContext2D._tmpMatrix)):(WebGLContext2D._tmpMatrix.a=this._curMat.a,WebGLContext2D._tmpMatrix.b=this._curMat.b,WebGLContext2D._tmpMatrix.c=this._curMat.c,WebGLContext2D._tmpMatrix.d=this._curMat.d,WebGLContext2D._tmpMatrix.tx=this._curMat.tx+x,WebGLContext2D._tmpMatrix.ty=this._curMat.ty+y),this._triangleMesh.addData(vertices,uvs,indices,WebGLContext2D._tmpMatrix,alpha,this),this._curSubmit._numEle+=eleNum,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},__proto.transform=function(a,b,c,d,tx,ty){SaveTransform.save(this),Matrix.mul(Matrix.TEMP.setTo(a,b,c,d,tx,ty),this._curMat,this._curMat),this._curMat._checkTransform()},__proto.setTransformByMatrix=function(value){value.copyTo(this._curMat)},__proto.transformByMatrix=function(value){SaveTransform.save(this),Matrix.mul(value,this._curMat,this._curMat),this._curMat._checkTransform()},__proto.rotate=function(angle){SaveTransform.save(this),this._curMat.rotateEx(angle)},__proto.scale=function(scaleX,scaleY){SaveTransform.save(this),this._curMat.scaleEx(scaleX,scaleY)},__proto.clipRect=function(x,y,width,height){var nPos,submit,maxx,minx,submitStencil0,miny;0!=this._curMat.b||0!=this._curMat.c?(this._renderKey=0,submitStencil0=SubmitStencil.create(4),this.addRenderObject(submitStencil0),nPos=(submitStencil0=this._vb)._byteLength>>2,GlUtils.fillRectImgVb(submitStencil0,null,x,y,width,height,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)?(this._shader2D.glTexture=null,(submit=this._curSubmit=Submit.createSubmit(this,this._ib,submitStencil0,(submitStencil0._byteLength-64)/32*3,Value2D.create(2,0))).shaderValue.ALPHA=1,this._submits[this._submits._length++]=submit,this._curSubmit._numEle+=6):alert("clipRect calc stencil rect error"),submit=SubmitStencil.create(5),this.addRenderObject(submit),submitStencil0=submitStencil0.getFloat32Array(),minx=Math.min(Math.min(Math.min(submitStencil0[nPos],submitStencil0[4+nPos]),submitStencil0[8+nPos]),submitStencil0[12+nPos]),maxx=Math.max(Math.max(Math.max(submitStencil0[nPos],submitStencil0[4+nPos]),submitStencil0[8+nPos]),submitStencil0[12+nPos]),miny=Math.min(Math.min(Math.min(submitStencil0[1+nPos],submitStencil0[5+nPos]),submitStencil0[9+nPos]),submitStencil0[13+nPos]),submitStencil0=Math.max(Math.max(Math.max(submitStencil0[1+nPos],submitStencil0[5+nPos]),submitStencil0[9+nPos]),submitStencil0[13+nPos]),SaveClipRectStencil.save(this,submit,x,y,width,height,minx,miny,maxx-minx,submitStencil0-miny)):(width*=this._curMat.a,height*=this._curMat.d,nPos=Point.TEMP,this._curMat.transformPoint(nPos.setTo(x,y)),width<0&&(nPos.x=nPos.x+width,width=-width),height<0&&(nPos.y=nPos.y+height,height=-height),this._renderKey=0,submit=this._curSubmit=SubmitScissor.create(this),(this._submits[this._submits._length++]=submit).submitIndex=this._submits._length,submit.submitLength=9999999,SaveClipRect.save(this,submit),minx=(maxx=this._clipRect).x,submitStencil0=maxx.y,miny=nPos.x+width,x=nPos.y+height,minx<nPos.x&&(maxx.x=nPos.x),submitStencil0<nPos.y&&(maxx.y=nPos.y),maxx.width=Math.min(miny,minx+maxx.width)-maxx.x,maxx.height=Math.min(x,submitStencil0+maxx.height)-maxx.y,this._shader2D.glTexture=null,submit.clipRect.copyFrom(maxx)),this._curSubmit=Submit.RENDERBASE},__proto.setIBVB=function(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset,type){if(void 0===startIndex&&(startIndex=0),void 0===offset&&(offset=0),void 0===type&&(type=0),null===ib&&(ib=Render.isFlash?((falshVB=vb)._selfIB||(falshVB._selfIB=IndexBuffer2D.create(35044)),falshVB._selfIB.clear(),falshVB._selfIB):this._ib,GlUtils.expandIBQuadrangle(ib,vb._byteLength/(4*vb.vertexStride*4))),!shaderValues||!shader)throw Error("setIBVB must input:shader shaderValues");var falshVB=SubmitOtherIBVB.create(this,vb,ib,numElement,shader,shaderValues,startIndex,offset,type);(mat=mat||Matrix.EMPTY).translate(x,y),Matrix.mul(mat,this._curMat,falshVB._mat),mat.translate(-x,-y),this._submits[this._submits._length++]=falshVB,this._curSubmit=Submit.RENDERBASE,this._renderKey=0},__proto.addRenderObject=function(o){this._submits[this._submits._length++]=o},__proto.fillTrangles=function(tex,x,y,points,m){var submit=this._curSubmit,vb=this._vb,shader=this._shader2D,curShader=submit.shaderValue,length=points.length>>4,t_tex=tex.bitmap;this._renderKey=0,shader.glTexture==t_tex&&shader.ALPHA===curShader.ALPHA||((submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,vb._byteLength/32*3,Value2D.create(1,0))).shaderValue.textureHost=tex,this._submits[this._submits._length++]=submit),GlUtils.fillTranglesVB(vb,x,y,points,m||this._curMat,this._x,this._y),submit._numEle+=6*length},__proto.submitElement=function(start,end){var renderList=this._submits;for(end<0&&(end=renderList._length);start<end;)start+=renderList[start].renderSubmit()},__proto.finish=function(){WebGL.mainContext.finish()},__proto.flush=function(){var maxNum=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(maxNum>this._ib.bufferLength/12&&GlUtils.expandIBQuadrangle(this._ib,maxNum),!this._isMain&&AtlasResourceManager.enabled&&AtlasResourceManager._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=AtlasResourceManager._atlasRestore;for(var renderList=this._submits,i=0,s=renderList._length;i<s;i++){var submit=renderList[i];10016===submit.getRenderType()&&submit.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),SkinMeshBuffer.instance&&SkinMeshBuffer.getInstance().reset();for(var i=0,sz=this.meshlist.length;i<sz;i++){var curm=this.meshlist[i];curm.canReuse?curm.releaseMesh():curm.destroy()}return this.meshlist.length=0,this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._triangleMesh=MeshTexture.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},__proto.setPathId=function(id){this.mId=id,-1!=this.mId&&(this.mHaveKey=!1,(id=VectorGraphManager.getInstance()).shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,id.shapeLineDic[this.mId])&&(this.mHaveLineKey=!0)},__proto.movePath=function(x,y){var _x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1+this._curMat.tx,y=this._curMat.b*_x1+this._curMat.d*_y1+this._curMat.ty,this.mX+=x,this.mY+=y},__proto.beginPath=function(){var tPath=this._getPath();tPath.tempArray.length=0,tPath.closePath=!1,this.mX=0,this.mY=0},__proto.closePath=function(){this._path.closePath=!0},__proto.fill=function(isConvexPolygon){void 0===isConvexPolygon&&(isConvexPolygon=!1);var tPath=this._getPath();this.drawPoly(0,0,tPath.tempArray,this.fillStyle._color.numColor,0,0,isConvexPolygon)},__proto.stroke=function(){var tShapeLine,tPath=this._getPath();0<this.lineWidth&&(-1==this.mId?tPath.drawLine(0,0,tPath.tempArray,this.lineWidth,this.strokeStyle._color.numColor):this.mHaveLineKey?((tShapeLine=VectorGraphManager.getInstance().shapeLineDic[this.mId]).rebuild(tPath.tempArray),tPath.setGeomtry(tShapeLine)):VectorGraphManager.getInstance().addLine(this.mId,tPath.drawLine(0,0,tPath.tempArray,this.lineWidth,this.strokeStyle._color.numColor)),tPath.update(),tShapeLine=[this.mX,this.mY],(tPath=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,tPath.shaderValue.u_pos=tShapeLine,tPath.shaderValue.u_mmat2=RenderState2D.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=tPath,this._renderKey=-1)},__proto.line=function(fromX,fromY,toX,toY,lineWidth,mat){var submit=this._curSubmit,vb=this._vb;GlUtils.fillLineVb(vb,this._clipRect,fromX,fromY,toX,toY,lineWidth,mat)&&(this._renderKey=0,fromX=this._shader2D,fromY=submit.shaderValue,fromX.strokeStyle===fromY.strokeStyle&&fromX.ALPHA===fromY.ALPHA||(fromX.glTexture=null,(submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,(vb._byteLength-64)/32*3,Value2D.create(2,0))).shaderValue.strokeStyle=fromX.strokeStyle,submit.shaderValue.mainID=2,submit.shaderValue.ALPHA=fromX.ALPHA,this._submits[this._submits._length++]=submit),submit._numEle+=6)},__proto.moveTo=function(x,y,b){void 0===b&&(b=!0);var _y1,tPath=this._getPath();b&&(b=x,_y1=y,x=this._curMat.a*b+this._curMat.c*_y1,y=this._curMat.b*b+this._curMat.d*_y1),tPath.addPoint(x,y)},__proto.lineTo=function(x,y,b){void 0===b&&(b=!0);var _y1,tPath=this._getPath();b&&(b=x,_y1=y,x=this._curMat.a*b+this._curMat.c*_y1,y=this._curMat.b*b+this._curMat.d*_y1),tPath.addPoint(x,y)},__proto.drawCurves=function(x,y,args){this.setPathId(-1),this.beginPath(),this.strokeStyle=args[3],this.lineWidth=args[4];for(var points=args[2],i=(x+=args[0],y+=args[1],this.movePath(x,y),this.moveTo(points[0],points[1]),2),n=points.length;i<n;)this.quadraticCurveTo(points[i++],points[i++],points[i++],points[i++]);this.stroke()},__proto.arcTo=function(x1,y1,x2,y2,r){if(-1==this.mId||!this.mHaveKey){var i=0,x=0,y=0,tPath=this._getPath(),dx=(this._curMat.copyTo(WebGLContext2D._tmpMatrix),WebGLContext2D._tmpMatrix.tx=WebGLContext2D._tmpMatrix.ty=0,WebGLContext2D._tempPoint.setTo(tPath.getEndPointX(),tPath.getEndPointY()),WebGLContext2D._tmpMatrix.invertTransformPoint(WebGLContext2D._tempPoint),WebGLContext2D._tempPoint.x-x1),dy=WebGLContext2D._tempPoint.y-y1,len1=Math.sqrt(dx*dx+dy*dy);if(!(len1<=1e-6)){var dx=dx/len1,dy=dy/len1,x2=x2-x1,y2=y2-y1,len2=Math.sqrt(x2*x2+y2*y2);if(!(len2<=1e-6)){var x2=x2/len2,y2=y2/len2,len2=dx+x2,ody=dy+y2,olen=Math.sqrt(len2*len2+ody*ody);if(!(olen<=1e-6))for(var len2=len2/olen,ody=ody/olen,olen=Math.acos(len2*dx+ody*dy),olen=Math.PI/2-olen,ptx1=(len1=r/Math.tan(olen))*dx+x1,pty1=len1*dy+y1,len1=Math.sqrt(len1*len1+r*r),orix=x1+len2*len1,oriy=y1+ody*len1,sinx=0,cosx=0,cvx=(cosx=(sinx=(r=0<=dx*y2-dy*x2?2*olen/WebGLContext2D.SEGNUM:2*-olen/WebGLContext2D.SEGNUM,Math.sin(r)),Math.cos(r)),x=this._curMat.a*ptx1+this._curMat.c*pty1,y=this._curMat.b*ptx1+this._curMat.d*pty1,x==this._path.getEndPointX()&&y==this._path.getEndPointY()||tPath.addPoint(x,y),ptx1-orix),cvy=pty1-oriy,i=0;i<WebGLContext2D.SEGNUM;i++){var cx=cvx*cosx+cvy*sinx,cy=-cvx*sinx+cvy*cosx,x=cx+orix,y=cy+oriy;x1=this._curMat.a*x+this._curMat.c*y,y=y1=this._curMat.b*x+this._curMat.d*y,(x=x1)==this._path.getEndPointX()&&y==this._path.getEndPointY()||tPath.addPoint(x,y),cvx=cx,cvy=cy}}}}},__proto.arc=function(cx,cy,r,startAngle,endAngle,counterclockwise,b){if(void 0===counterclockwise&&(counterclockwise=!1),void 0===b&&(b=!0),-1!=this.mId){var tShape=VectorGraphManager.getInstance().shapeDic[this.mId];if(tShape&&this.mHaveKey&&!tShape.needUpdate(this._curMat))return;cy=cx=0}var a,da=0,x=0,y=0,i=0,ndivs=0,da=endAngle-startAngle;if(counterclockwise)if(Math.abs(da)>=2*Math.PI)da=2*-Math.PI;else for(;0<da;)da-=2*Math.PI;else if(Math.abs(da)>=2*Math.PI)da=2*Math.PI;else for(;da<0;)da+=2*Math.PI;tShape=da/(ndivs=r<101?Math.max(10,da*r/5):r<201?Math.max(10,da*r/20):Math.max(10,da*r/40))/2,Math.abs(4/3*(1-Math.cos(tShape))/Math.sin(tShape));for(var tPath=this._getPath(),_x1=NaN,_y1=NaN,i=0;i<=ndivs;i++)a=startAngle+da*(i/ndivs),x=cx+Math.cos(a)*r,y=cy+Math.sin(a)*r,b&&(_x1=x,_y1=y,x=this._curMat.a*_x1+this._curMat.c*_y1,y=this._curMat.b*_x1+this._curMat.d*_y1),x==this._path.getEndPointX()&&y==this._path.getEndPointY()||tPath.addPoint(x,y);x=cx+Math.cos(endAngle)*r,y=cy+Math.sin(endAngle)*r,b&&(_x1=x,_y1=y,x=this._curMat.a*_x1+this._curMat.c*_y1,y=this._curMat.b*_x1+this._curMat.d*_y1),x==this._path.getEndPointX()&&y==this._path.getEndPointY()||tPath.addPoint(x,y)},__proto.quadraticCurveTo=function(cpx,cpy,x,y){for(var tBezier=Bezier.I,_x1=x,_y1=y,tArray=(x=this._curMat.a*_x1+this._curMat.c*_y1,y=this._curMat.b*_x1+this._curMat.d*_y1,_x1=cpx,_y1=cpy,cpx=this._curMat.a*_x1+this._curMat.c*_y1,cpy=this._curMat.b*_x1+this._curMat.d*_y1,tBezier.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),cpx,cpy,x,y],30,2)),i=0,n=tArray.length/2;i<n;i++)this.lineTo(tArray[2*i],tArray[2*i+1],!1);this.lineTo(x,y,!1)},__proto.rect=function(x,y,width,height){this._other=this._other.make(),this._other.path||(this._other.path=new Path),this._other.path.rect(x,y,width,height)},__proto.strokeRect=function(x,y,width,height,parameterLineWidth){var tW=.5*parameterLineWidth;this.line(x-tW,y,x+width+tW,y,parameterLineWidth,this._curMat),this.line(x+width,y,x+width,y+height,parameterLineWidth,this._curMat),this.line(x,y,x,y+height,parameterLineWidth,this._curMat),this.line(x-tW,y+height,x+width+tW,y+height,parameterLineWidth,this._curMat)},__proto.clip=function(){},__proto.drawPoly=function(x,y,points,color,lineWidth,boderColor,isConvexPolygon){void 0===isConvexPolygon&&(isConvexPolygon=!1),this._renderKey=0,this._shader2D.glTexture=null;var isConvexPolygon=this._getPath(),color=(-1==this.mId?isConvexPolygon.polygon(x,y,points,color,lineWidth||1,boderColor):this.mHaveKey?((tShape=VectorGraphManager.getInstance().shapeDic[this.mId]).setMatrix(this._curMat),tShape.rebuild(isConvexPolygon.tempArray),isConvexPolygon.setGeomtry(tShape)):(tShape=isConvexPolygon.polygon(x,y,points,color,lineWidth||1,boderColor),VectorGraphManager.getInstance().addShape(this.mId,tShape),tShape.setMatrix(this._curMat)),isConvexPolygon.update(),[this.mX,this.mY]),tShape=Submit.createShape(this,isConvexPolygon.ib,isConvexPolygon.vb,isConvexPolygon.count,isConvexPolygon.offset,Value2D.create(4,0));tShape.shaderValue.ALPHA=this._shader2D.ALPHA,tShape.shaderValue.u_pos=color,tShape.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=tShape,0<lineWidth&&(this.mHaveLineKey?((color=VectorGraphManager.getInstance().shapeLineDic[this.mId]).rebuild(isConvexPolygon.tempArray),isConvexPolygon.setGeomtry(color)):VectorGraphManager.getInstance().addShape(this.mId,isConvexPolygon.drawLine(x,y,points,lineWidth,boderColor)),isConvexPolygon.update(),(tShape=Submit.createShape(this,isConvexPolygon.ib,isConvexPolygon.vb,isConvexPolygon.count,isConvexPolygon.offset,Value2D.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,tShape.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=tShape)},__proto.drawParticle=function(x,y,pt){pt.x=x,pt.y=y,this._submits[this._submits._length++]=pt},__proto._getPath=function(){return this._path||(this._path=new Path)},__getset(0,__proto,"globalCompositeOperation",function(){return BlendMode.NAMES[this._nBlendType]},function(value){value=BlendMode.TOINT[value];null!=value&&this._nBlendType!==value&&(SaveBase.save(this,65536,this,!0),this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._nBlendType=value)}),__getset(0,__proto,"strokeStyle",function(){return this._shader2D.strokeStyle},function(value){this._shader2D.strokeStyle.equal(value)||(SaveBase.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=DrawStyle.create(value))}),__getset(0,__proto,"globalAlpha",function(){return this._shader2D.ALPHA},function(value){(value=Math.floor(1e3*value)/1e3)!=this._shader2D.ALPHA&&(SaveBase.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=value)}),__getset(0,__proto,"asBitmap",null,function(value){if(value){if(this._targets||(this._targets=new RenderTargetMAX),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),__getset(0,__proto,"fillStyle",function(){return this._shader2D.fillStyle},function(value){this._shader2D.fillStyle.equal(value)||(SaveBase.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=DrawStyle.create(value))}),__getset(0,__proto,"textAlign",function(){return this._other.textAlign},function(value){this._other.textAlign!==value&&(this._other=this._other.make(),SaveBase.save(this,32768,this._other,!1),this._other.textAlign=value)}),__getset(0,__proto,"lineWidth",function(){return this._other.lineWidth},function(value){this._other.lineWidth!==value&&(this._other=this._other.make(),SaveBase.save(this,256,this._other,!1),this._other.lineWidth=value)}),__getset(0,__proto,"textBaseline",function(){return this._other.textBaseline},function(value){this._other.textBaseline!==value&&(this._other=this._other.make(),SaveBase.save(this,16384,this._other,!1),this._other.textBaseline=value)}),__getset(0,__proto,"font",null,function(str){str!=this._other.font.toString()&&(this._other=this._other.make(),SaveBase.save(this,8,this._other,!1),this._other.font===FontInContext.EMPTY?this._other.font=new FontInContext(str):this._other.font.setFont(str))}),WebGLContext2D.__init__=function(){ContextParams.DEFAULT=new ContextParams},WebGLContext2D._tempPoint=new Point,WebGLContext2D._SUBMITVBSIZE=32e3,WebGLContext2D._MAXSIZE=99999999,WebGLContext2D._RECTVBSIZE=16,WebGLContext2D.MAXCLIPRECT=new Rectangle(0,0,99999999,99999999),WebGLContext2D._COUNT=0,WebGLContext2D._tmpMatrix=new Matrix,WebGLContext2D.SEGNUM=32,WebGLContext2D._contextcount=0,__static(WebGLContext2D,["_fontTemp",function(){return this._fontTemp=new FontInContext},"_drawStyleTemp",function(){return this._drawStyleTemp=new DrawStyle(null)}]),WebGLContext2D.__init$=function(){ContextParams=function(){function ContextParams(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=FontInContext.EMPTY}__class(ContextParams,"");var __proto=ContextParams.prototype;return __proto.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=FontInContext.EMPTY},__proto.make=function(){return this===ContextParams.DEFAULT?new ContextParams:this},ContextParams.DEFAULT=null,ContextParams}()},WebGLContext2D}(),Value2D=function(){function Value2D(mainID,subID){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,Value2D.__super.call(this),this.defines=new ShaderDefines2D,this.position=Value2D._POSITION,this.mainID=mainID,this.subID=subID,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=mainID|subID,this._inClassCache=Value2D._cache[this._cacheID],0<mainID&&!this._inClassCache&&(this._inClassCache=Value2D._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}__class(Value2D,"laya.webgl.shader.d2.value.Value2D",ShaderValue);var __proto=Value2D.prototype;return __proto.setValue=function(value){},__proto.refresh=function(){var size=this.size;return size[0]=RenderState2D.width,size[1]=RenderState2D.height,this.alpha=this.ALPHA*RenderState2D.worldAlpha,this.mmat=RenderState2D.worldMatrix4,this},__proto._ShaderWithCompile=function(){return Shader.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Shader2X.create)},__proto._withWorldShaderDefines=function(){var defs=RenderState2D.worldShaderDefines,sd=Shader.sharders[this.mainID|this.defines._value|defs.getValue()];if(!sd){var name,def={},dic=this.defines.toNameDic();for(name in dic)def[name]="";for(name in defs.toNameDic())def[name]="";sd=Shader.withCompile2D(0,this.mainID,def,this.mainID|this.defines._value|defs.getValue(),Shader2X.create)}var worldFilters=RenderState2D.worldFilters;if(worldFilters)for(var f,n=worldFilters.length,i=0;i<n;i++)(f=worldFilters[i])&&f.action.setValue(this);return sd},__proto.upload=function(){var params,renderstate2d=RenderState2D,sd=(this.alpha=this.ALPHA*renderstate2d.worldAlpha,RenderState2D.worldMatrix4!==RenderState2D.TEMPMAT4_ARRAY&&this.defines.add(128),WebGL.shaderHighPrecision&&this.defines.add(1024),renderstate2d.worldShaderDefines?this._withWorldShaderDefines():Shader.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile());this.size[0]=renderstate2d.width,this.size[1]=renderstate2d.height,this.mmat=renderstate2d.worldMatrix4,BaseShader.activeShader!==sd?sd._shaderValueWidth!==renderstate2d.width||sd._shaderValueHeight!==renderstate2d.height?(sd._shaderValueWidth=renderstate2d.width,sd._shaderValueHeight=renderstate2d.height):params=sd._params2dQuick2||sd._make2dQuick2():sd._shaderValueWidth!==renderstate2d.width||sd._shaderValueHeight!==renderstate2d.height?(sd._shaderValueWidth=renderstate2d.width,sd._shaderValueHeight=renderstate2d.height):params=sd._params2dQuick1||sd._make2dQuick1(),sd.upload(this,params)},__proto.setFilters=function(value){if(this.filters=value)for(var f,n=value.length,i=0;i<n;i++)(f=value[i])&&(this.defines.add(f.type),f.action.setValue(this))},__proto.clear=function(){this.defines.setValue(this.subID)},__proto.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},Value2D._initone=function(type,classT){Value2D._typeClass[type]=classT,Value2D._cache[type]=[],Value2D._cache[type]._length=0},Value2D.__init__=function(){Value2D._POSITION=[2,5126,!1,4*CONST3D2D.BYTES_PE,0],Value2D._TEXCOORD=[2,5126,!1,4*CONST3D2D.BYTES_PE,2*CONST3D2D.BYTES_PE],Value2D._initone(2,Color2dSV),Value2D._initone(4,PrimitiveSV),Value2D._initone(256,FillTextureSV),Value2D._initone(512,SkinSV),Value2D._initone(1,TextureSV),Value2D._initone(65,TextSV),Value2D._initone(9,TextureSV)},Value2D.create=function(mainType,subType){var types=Value2D._cache[mainType|subType];return types._length?types[--types._length]:new Value2D._typeClass[mainType|subType](subType)},Value2D._POSITION=null,Value2D._TEXCOORD=null,Value2D._cache=[],Value2D._typeClass=[],Value2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Value2D}(),RenderSprite3D=function(){function RenderSprite3D(type,next){RenderSprite3D.__super.call(this,type,next)}__class(RenderSprite3D,"laya.webgl.utils.RenderSprite3D",RenderSprite);var __proto=RenderSprite3D.prototype;return __proto.onCreate=function(type){switch(type){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},__proto._mask=function(sprite,context,x,y){var submitCMD,preBlendMode,tRect,tf,scope,shaderValue,uv,w,h,next=this._next,mask=sprite.mask;mask?(context.ctx.save(),preBlendMode=context.ctx.globalCompositeOperation,(tRect=new Rectangle).copyFrom(mask.getBounds()),tRect.width=Math.round(tRect.width),tRect.height=Math.round(tRect.height),tRect.x=Math.round(tRect.x),tRect.y=Math.round(tRect.y),0<tRect.width&&0<tRect.height&&(tf=sprite._style._tf,(scope=SubmitCMDScope.create()).addValue("bounds",tRect),submitCMD=SubmitCMD.create([scope,context],laya.webgl.utils.RenderSprite3D.tmpTarget),context.addRenderObject(submitCMD),mask.render(context,-tRect.x,-tRect.y),submitCMD=SubmitCMD.create([scope],laya.webgl.utils.RenderSprite3D.endTmpTarget),context.addRenderObject(submitCMD),context.ctx.save(),context.clipRect(x-tf.translateX+tRect.x,y-tf.translateY+tRect.y,tRect.width,tRect.height),next._fun.call(next,sprite,context,x,y),context.ctx.restore(),mask=SubmitStencil.create(6),preBlendMode=context.ctx.globalCompositeOperation,mask.blendMode="mask",context.addRenderObject(mask),Matrix.TEMP.identity(),shaderValue=Value2D.create(1,0),uv=Texture.INV_UV,w=tRect.width,h=tRect.height,(tRect.width<32||tRect.height<32)&&((uv=RenderSprite3D.tempUV)[0]=0,uv[1]=0,uv[2]=32<=tRect.width?1:tRect.width/32,uv[3]=0,uv[4]=32<=tRect.width?1:tRect.width/32,uv[5]=32<=tRect.height?1:tRect.height/32,uv[6]=0,uv[7]=32<=tRect.height?1:tRect.height/32,tRect.width=32<=tRect.width?tRect.width:32,tRect.height=32<=tRect.height?tRect.height:32,uv[1]*=-1,uv[3]*=-1,uv[5]*=-1,uv[7]*=-1,uv[1]+=1,uv[3]+=1,uv[5]+=1,uv[7]+=1),context.ctx.drawTarget(scope,x+tRect.x-tf.translateX,y+tRect.y-tf.translateY,w,h,Matrix.TEMP,"tmpTarget",shaderValue,uv,6),submitCMD=SubmitCMD.create([scope],laya.webgl.utils.RenderSprite3D.recycleTarget),context.addRenderObject(submitCMD),(mask=SubmitStencil.create(6)).blendMode=preBlendMode,context.addRenderObject(mask)),context.ctx.restore()):next._fun.call(next,sprite,context,x,y)},__proto._blend=function(sprite,context,x,y){var style=sprite._style,next=this._next;style.blendMode?(context.ctx.save(),context.ctx.globalCompositeOperation=style.blendMode,next._fun.call(next,sprite,context,x,y),context.ctx.restore()):next._fun.call(next,sprite,context,x,y)},__proto._transform=function(sprite,context,x,y){var ctx,m1,transform=sprite.transform,_next=this._next;transform&&_next!=RenderSprite.NORENDER?(ctx=context.ctx,sprite._style,transform.tx=x,transform.ty=y,m1=(ctx=ctx._getTransformMatrix()).clone(),Matrix.mul(transform,ctx,ctx),ctx._checkTransform(),transform.tx=transform.ty=0,_next._fun.call(_next,sprite,context,0,0),m1.copyTo(ctx),m1.destroy()):_next._fun.call(_next,sprite,context,x,y)},RenderSprite3D.tmpTarget=function(scope,context){var b=scope.getValue("bounds"),b=RenderTarget2D.create(b.width,b.height);b.start(),b.clear(0,0,0,0),scope.addValue("tmpTarget",b)},RenderSprite3D.endTmpTarget=function(scope){scope.getValue("tmpTarget").end()},RenderSprite3D.recycleTarget=function(scope){scope.getValue("tmpTarget").recycle(),scope.recycle()},__static(RenderSprite3D,["tempUV",function(){return this.tempUV=new Array(8)}]),RenderSprite3D}(),ColorFilterActionGL=function(){function ColorFilterActionGL(){this.data=null,ColorFilterActionGL.__super.call(this)}__class(ColorFilterActionGL,"laya.filters.webgl.ColorFilterActionGL",FilterActionGL);var __proto=ColorFilterActionGL.prototype;return Laya.imps(__proto,{"laya.filters.IFilterActionGL":!0}),__proto.setValue=function(shader){shader.colorMat=this.data._mat,shader.colorAlpha=this.data._alpha},__proto.apply3d=function(scope,sprite,context,x,y){var b=scope.getValue("bounds"),shaderValue=Value2D.create(1,0),tMatrix=(shaderValue.setFilters([this.data]),Matrix.TEMP);tMatrix.identity(),context.ctx.drawTarget(scope,0,0,b.width,b.height,tMatrix,"src",shaderValue)},ColorFilterActionGL}(),Atlaser=function(){function Atlaser(gridNumX,gridNumY,width,height,atlasID){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,Atlaser.__super.call(this,gridNumX,gridNumY,atlasID),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new AtlasWebGLCanvas,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=width,this._atlasCanvas.height=height,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}__class(Atlaser,"laya.webgl.atlas.Atlaser",AtlasGrid);var __proto=Atlaser.prototype;return __proto.computeUVinAtlasTexture=function(texture,oriUV,offsetX,offsetY){var _width=AtlasResourceManager.atlasTextureWidth,_height=AtlasResourceManager.atlasTextureHeight,u1=offsetX/_width,v1=offsetY/_height,offsetX=(offsetX+texture.bitmap.width)/_width,offsetY=(offsetY+texture.bitmap.height)/_height,_width=texture.bitmap.width/_width,_height=texture.bitmap.height/_height;texture.uv=[u1+oriUV[0]*_width,v1+oriUV[1]*_height,offsetX-(1-oriUV[2])*_width,v1+oriUV[3]*_height,offsetX-(1-oriUV[4])*_width,offsetY-(1-oriUV[5])*_height,u1+oriUV[6]*_width,offsetY-(1-oriUV[7])*_height]},__proto.findBitmapIsExist=function(bitmap){if(bitmap instanceof laya.webgl.resource.WebGLImage){var sUrl=bitmap.url,sUrl=this._InAtlasWebGLImagesKey[sUrl||bitmap.id];if(sUrl)return sUrl.offsetInfoID}return-1},__proto.addToAtlasTexture=function(mergeAtlasBitmap,offsetX,offsetY){var sUrl;mergeAtlasBitmap instanceof laya.webgl.resource.WebGLImage&&(sUrl=mergeAtlasBitmap.url,this._InAtlasWebGLImagesKey[sUrl||mergeAtlasBitmap.id]={bitmap:mergeAtlasBitmap,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([offsetX,offsetY])),this._atlasCanvas.texSubImage2D(offsetX,offsetY,mergeAtlasBitmap.atlasSource),mergeAtlasBitmap.clearAtlasSource()},__proto.addToAtlas=function(texture,offsetX,offsetY){texture._atlasID=this._inAtlasTextureKey.length;var oriUV=texture.uv.slice(),oriBitmap=texture.bitmap;this._inAtlasTextureKey.push(texture),this._inAtlasTextureOriUVValue.push(oriUV),this._inAtlasTextureBitmapValue.push(oriBitmap),this.computeUVinAtlasTexture(texture,oriUV,offsetX,offsetY),texture.bitmap=this._atlasCanvas},__proto.clear=function(){for(var i=0,n=this._inAtlasTextureKey.length;i<n;i++)this._inAtlasTextureKey[i].bitmap=this._inAtlasTextureBitmapValue[i],this._inAtlasTextureKey[i].uv=this._inAtlasTextureOriUVValue[i],this._inAtlasTextureKey[i]._atlasID=-1,this._inAtlasTextureKey[i].bitmap.lock=!1,this._inAtlasTextureKey[i].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},__proto.dispose=function(){this.clear(),this._atlasCanvas.destroy()},__getset(0,__proto,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),__getset(0,__proto,"texture",function(){return this._atlasCanvas}),__getset(0,__proto,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),Atlaser}(),ShaderDefines2D=function(){function ShaderDefines2D(){ShaderDefines2D.__super.call(this,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name,ShaderDefines2D.__int2nameMap)}return __class(ShaderDefines2D,"laya.webgl.shader.d2.ShaderDefines2D",ShaderDefines),ShaderDefines2D.__init__=function(){ShaderDefines2D.reg("TEXTURE2D",1),ShaderDefines2D.reg("COLOR2D",2),ShaderDefines2D.reg("PRIMITIVE",4),ShaderDefines2D.reg("GLOW_FILTER",8),ShaderDefines2D.reg("BLUR_FILTER",16),ShaderDefines2D.reg("COLOR_FILTER",32),ShaderDefines2D.reg("COLOR_ADD",64),ShaderDefines2D.reg("WORLDMAT",128),ShaderDefines2D.reg("FILLTEXTURE",256),ShaderDefines2D.reg("FSHIGHPRECISION",1024)},ShaderDefines2D.reg=function(name,value){ShaderDefines._reg(name,value,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name)},ShaderDefines2D.toText=function(value,int2name,int2nameMap){return ShaderDefines._toText(value,int2name,int2nameMap)},ShaderDefines2D.toInt=function(names){return ShaderDefines._toInt(names,ShaderDefines2D.__name2int)},ShaderDefines2D.TEXTURE2D=1,ShaderDefines2D.COLOR2D=2,ShaderDefines2D.PRIMITIVE=4,ShaderDefines2D.FILTERGLOW=8,ShaderDefines2D.FILTERBLUR=16,ShaderDefines2D.FILTERCOLOR=32,ShaderDefines2D.COLORADD=64,ShaderDefines2D.WORLDMAT=128,ShaderDefines2D.FILLTEXTURE=256,ShaderDefines2D.SKINMESH=512,ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION=1024,ShaderDefines2D.__name2int={},ShaderDefines2D.__int2name=[],ShaderDefines2D.__int2nameMap=[],ShaderDefines2D}(),Line=(function(){function Ellipse(x,y,width,height,color,borderWidth,borderColor){Ellipse.__super.call(this,x,y,width,height,40,color,borderWidth,borderColor)}__class(Ellipse,"laya.webgl.shapes.Ellipse",BasePoly)}(),function(){function Line(x,y,points,borderWidth,color){this._points=[],this.rebuild(points),Line.__super.call(this,x,y,0,0,0,color,borderWidth,color,0)}__class(Line,"laya.webgl.shapes.Line",BasePoly);var __proto=Line.prototype;return __proto.rebuild=function(points){for(var tCurrX,tCurrY,len=points.length,tLastX=(len!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(len/2-1)),this.mFloat32Array=new Float32Array(5*len)),this._points.length=0,-1),tLastY=-1,tLen=points.length/2,i=0;i<tLen;i++)tCurrX=points[2*i],tCurrY=points[2*i+1],(.01<Math.abs(tLastX-tCurrX)||.01<Math.abs(tLastY-tCurrY))&&this._points.push(tCurrX,tCurrY),tLastX=tCurrX,tLastY=tCurrY},__proto.getData=function(ib,vb,start){var indices=[],verts=[];0<this.borderWidth&&this.createLine2(this._points,indices,this.borderWidth,start,verts,this._points.length/2),this.mUint16Array.set(indices,0),this.mFloat32Array.set(verts,0),ib.append(this.mUint16Array),vb.append(this.mFloat32Array)},Line}()),LoopLine=function(){function LoopLine(x,y,points,width,color){this._points=[];for(var tCurrX=NaN,tCurrY=NaN,tLastX=-1,tLastY=-1,tLen=points.length/2-1,i=0;i<tLen;i++)tCurrX=points[2*i],tCurrY=points[2*i+1],(.01<Math.abs(tLastX-tCurrX)||.01<Math.abs(tLastY-tCurrY))&&this._points.push(tCurrX,tCurrY),tLastX=tCurrX,tLastY=tCurrY;tCurrX=points[2*tLen],tCurrY=points[2*tLen+1],tLastX=this._points[0],tLastY=this._points[1],(.01<Math.abs(tLastX-tCurrX)||.01<Math.abs(tLastY-tCurrY))&&this._points.push(tCurrX,tCurrY),LoopLine.__super.call(this,x,y,0,0,this._points.length/2,0,width,color)}__class(LoopLine,"laya.webgl.shapes.LoopLine",BasePoly);var __proto=LoopLine.prototype;return __proto.getData=function(ib,vb,start){if(0<this.borderWidth){for(var tCurrX,tCurrY,color=this.color,r=(color>>16&255)/255,g=(color>>8&255)/255,b=(255&color)/255,verts=[],color=[],tLen=Math.floor(this._points.length/2),i=0;i<tLen;i++)tCurrX=this._points[2*i],tCurrY=this._points[2*i+1],verts.push(this.x+tCurrX,this.y+tCurrY,r,g,b);this.createLoopLine(verts,color,this.borderWidth,start+verts.length/5),ib.append(new Uint16Array(color)),vb.append(new Float32Array(verts))}},__proto.createLoopLine=function(p,indices,lineWidth,len,outVertex,outIndex){p.length;var a1,p3y,c1,p3x,perp2x,c2,perp2y,points=p.concat(),result=outVertex||p,outVertex=this.borderColor,r=(outVertex>>16&255)/255,g=(outVertex>>8&255)/255,b=(255&outVertex)/255,p=[points[0],points[1]],outVertex=[points[points.length-5],points[points.length-4]],midPointX=outVertex[0]+.5*(p[0]-outVertex[0]),p=outVertex[1]+.5*(p[1]-outVertex[1]),length=(points.unshift(midPointX,p,0,0,0),points.push(midPointX,p,0,0,0),points.length/5),iStart=len,w=lineWidth/2,p1x=points[0],p1y=points[1],p2x=points[5],p2y=points[6],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy);result.push(p1x-(perpx=perpx/dist*w),p1y-(perpy=perpy/dist*w),r,g,b,p1x+perpx,p1y+perpy,r,g,b);for(var i=1;i<length-1;i++)p1x=points[5*(i-1)],p1y=points[5*(i-1)+1],p2x=points[5*i],p2y=points[5*i+1],p3x=points[5*(i+1)],p3y=points[5*(i+1)+1],perpy=p1x-p2x,perp2y=p2x-p3x,c1=(-(perpx=(perpx=-(p1y-p2y))/(dist=Math.sqrt(perpx*perpx+perpy*perpy))*w)+p1x)*(-(perpy=perpy/dist*w)+p2y)-(-perpx+p2x)*(-perpy+p1y),c2=(-(perp2x=(perp2x=-(p2y-p3y))/(dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y))*w)+p3x)*(-(perp2y=perp2y/dist*w)+p2y)-(-perp2x+p2x)*(-perp2y+p3y),perp2y=(a1=-perpy+p1y-(-perpy+p2y))*(perp2x=-perp2x+p2x-(-perp2x+p3x))-(p3x=-perp2y+p3y-(-perp2y+p2y))*(p3y=-perpx+p2x-(-perpx+p1x)),Math.abs(perp2y)<.1?(perp2y+=10.1,result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b)):(p3y=(p3y*c2-perp2x*c1)/perp2y,perp2x=(p3x*c1-a1*c2)/perp2y,result.push(p3y,perp2x,r,g,b,p2x-(p3y-p2x),p2y-(perp2x-p2y),r,g,b));outIndex&&(indices=outIndex);for(var groupLen=this.edges+1,i=1;i<groupLen;i++)indices.push(iStart+2*(i-1),iStart+2*(i-1)+1,iStart+2*i+1,iStart+2*i+1,iStart+2*i,iStart+2*(i-1));return indices.push(iStart+2*(i-1),iStart+2*(i-1)+1,iStart+1,iStart+1,iStart,iStart+2*(i-1)),result},LoopLine}(),Polygon=function(){function Polygon(x,y,points,color,borderWidth,borderColor){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=Matrix.create(),this._points=points.slice(0,points.length),Polygon.__super.call(this,x,y,0,0,this._points.length/2,color,borderWidth,borderColor)}__class(Polygon,"laya.webgl.shapes.Polygon",BasePoly);var __proto=Polygon.prototype;return __proto.rebuild=function(point){this._repaint||(this._points.length=0,this._points=this._points.concat(point))},__proto.setMatrix=function(mat){mat.copyTo(this._mat)},__proto.needUpdate=function(mat){return this._repaint=this._mat.a==mat.a&&this._mat.b==mat.b&&this._mat.c==mat.c&&this._mat.d==mat.d&&this._mat.tx==mat.tx&&this._mat.ty==mat.ty,!this._repaint},__proto.getData=function(ib,vb,start){var i=0,tArray=this._points,tLen=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=start){for(this._start=start,indices=[],tLen=this.earcutTriangles.length,i=0;i<tLen;i++)indices.push(this.earcutTriangles[i]+start);this.mUint16Array=new Uint16Array(indices)}}else{this._start=start;for(var indices=[],verts=[],vertsEarcut=[],color=this.color,r=(color>>16&255)/255,g=(color>>8&255)/255,b=(255&color)/255,tLen=Math.floor(tArray.length/2),i=0;i<tLen;i++)verts.push(this.x+tArray[2*i],this.y+tArray[2*i+1],r,g,b),vertsEarcut.push(this.x+tArray[2*i],this.y+tArray[2*i+1]);for(this.earcutTriangles=Earcut.earcut(vertsEarcut,null,2),tLen=this.earcutTriangles.length,i=0;i<tLen;i++)indices.push(this.earcutTriangles[i]+start);this.mUint16Array=new Uint16Array(indices),this.mFloat32Array=new Float32Array(verts)}ib.append(this.mUint16Array),vb.append(this.mFloat32Array)},Polygon}(),SubmitCanvas=function(){function SubmitCanvas(){this._matrix=new Matrix,this._matrix4=CONST3D2D.defaultMatrix4.concat(),SubmitCanvas.__super.call(this,1e4),this.shaderValue=new Value2D(0,0)}__class(SubmitCanvas,"laya.webgl.submit.SubmitCanvas",Submit);var __proto=SubmitCanvas.prototype;return __proto.renderSubmit=function(){var preAlpha,preMatrix4,preMatrix,preFilters,preWorldShaderDefines,v,m,m4,mout;return this._ctx_src._targets?this._ctx_src._targets.flush(this._ctx_src):(preAlpha=RenderState2D.worldAlpha,preMatrix4=RenderState2D.worldMatrix4,preMatrix=RenderState2D.worldMatrix,preFilters=RenderState2D.worldFilters,preWorldShaderDefines=RenderState2D.worldShaderDefines,v=this.shaderValue,m=this._matrix,m4=this._matrix4,mout=Matrix.TEMP,Matrix.mul(m,preMatrix,mout),m4[0]=mout.a,m4[1]=mout.b,m4[4]=mout.c,m4[5]=mout.d,m4[12]=mout.tx,m4[13]=mout.ty,RenderState2D.worldMatrix=mout.clone(),RenderState2D.worldMatrix4=m4,RenderState2D.worldAlpha=RenderState2D.worldAlpha*v.alpha,v.filters&&v.filters.length&&(RenderState2D.worldFilters=v.filters,RenderState2D.worldShaderDefines=v.defines),this._ctx_src.flush(),RenderState2D.worldAlpha=preAlpha,RenderState2D.worldMatrix4=preMatrix4,RenderState2D.worldMatrix.destroy(),RenderState2D.worldMatrix=preMatrix,RenderState2D.worldFilters=preFilters,RenderState2D.worldShaderDefines=preWorldShaderDefines),1},__proto.releaseRender=function(){var cache=SubmitCanvas._cache;this._ctx_src=null,cache[cache._length++]=this},__proto.getRenderType=function(){return 10003},SubmitCanvas.create=function(ctx_src,alpha,filters){var o=SubmitCanvas._cache._length?SubmitCanvas._cache[--SubmitCanvas._cache._length]:new SubmitCanvas,ctx_src=(o._ctx_src=ctx_src,o.shaderValue);return ctx_src.alpha=alpha,ctx_src.defines.setValue(0),filters&&filters.length&&ctx_src.setFilters(filters),o},SubmitCanvas._cache=((SubmitCanvas._cache=[])._length=0,SubmitCanvas._cache),SubmitCanvas}(),SubmitTexture=function(){function SubmitTexture(renderType){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,SubmitTexture.__super.call(this,renderType=void 0===renderType?1e4:renderType)}__class(SubmitTexture,"laya.webgl.submit.SubmitTexture",Submit);var __proto=SubmitTexture.prototype;return __proto.releaseRender=function(){var cache=SubmitTexture._cache;(cache[cache._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},__proto.addTexture=function(tex,vbpos){this._texsID[this._texs.length]=tex._uvID,this._texs.push(tex),this._vbPos.push(vbpos)},__proto.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var webGLImg=this.shaderValue.textureHost.bitmap;if(null!==webGLImg)for(var vbdata=this._vb.getFloat32Array(),i=0,s=this._texs.length;i<s;i++){var vbPos,tex=this._texs[i],newUV=(tex.active(),tex.uv);this._texsID[i]!==tex._uvID&&(this._texsID[i]=tex._uvID,vbdata[(vbPos=this._vbPos[i])+2]=newUV[0],vbdata[vbPos+3]=newUV[1],vbdata[vbPos+6]=newUV[2],vbdata[vbPos+7]=newUV[3],vbdata[vbPos+10]=newUV[4],vbdata[vbPos+11]=newUV[5],vbdata[vbPos+14]=newUV[6],vbdata[vbPos+15]=newUV[7],this._vb.setNeedUpload()),tex.bitmap!==webGLImg&&(this._isSameTexture=!1)}}},__proto.renderSubmit=function(){if(0===this._numEle)SubmitTexture._shaderSet=!1;else{var _tex=this.shaderValue.textureHost;if(_tex){var source=_tex.source;if(!_tex.bitmap||!source)return SubmitTexture._shaderSet=!1,1;this.shaderValue.texture=source}this._vb.bind_upload(this._ib);var gl=WebGL.mainContext;if(BlendMode.activeBlendFunction!==this._blendFn&&(gl.enable(3042),this._blendFn(gl),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&BaseShader.activeShader&&SubmitTexture._shaderSet?BaseShader.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),SubmitTexture._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var webGLImg=_tex.bitmap,index=0,shader=BaseShader.activeShader,i=0,s=this._texs.length;i<s;i++){var tex2=this._texs[i];tex2.bitmap===webGLImg&&i+1!==s||(shader.uploadTexture2D(tex2.source),gl.drawElements(4,6*(i-index+1),5123,this._startIdx+6*index*CONST3D2D.BYTES_PIDX),webGLImg=tex2.bitmap,index=i)}else gl.drawElements(4,this._numEle,5123,this._startIdx)}return 1},SubmitTexture.create=function(context,ib,vb,pos,sv){var o=SubmitTexture._cache._length?SubmitTexture._cache[--SubmitTexture._cache._length]:new SubmitTexture,ib=(null==vb&&((vb=o._selfVb||(o._selfVb=VertexBuffer2D.create(-1))).clear(),pos=0),o._ib=ib,o._vb=vb,o._startIdx=pos*CONST3D2D.BYTES_PIDX,o._numEle=0,context._nBlendType),vb=(o._blendFn=(context._targets?BlendMode.targetFns:BlendMode.fns)[ib],o.shaderValue=sv,o.shaderValue.setValue(context._shader2D),context._shader2D.filters);return vb&&o.shaderValue.setFilters(vb),o},SubmitTexture._cache=((SubmitTexture._cache=[])._length=0,SubmitTexture._cache),SubmitTexture._shaderSet=!0,SubmitTexture}(),MeshTexture=function(){function MeshTexture(){MeshTexture.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}__class(MeshTexture,"laya.webgl.utils.MeshTexture",Mesh2D);var __proto=MeshTexture.prototype;return __proto.addData=function(vertices,uvs,idx,matrix,rgba,ctx){for(var sz=vertices.length/2,f32pos=this._vb.needSize(sz*MeshTexture.const_stride)>>2,vbdata=this._vb.getFloat32Array(),ci=0,i=0;i<sz;i++){var x=vertices[ci],y=vertices[ci+1],x1=x*matrix.a+y*matrix.c+matrix.tx,x=x*matrix.b+y*matrix.d+matrix.ty;vbdata[f32pos++]=x1,vbdata[f32pos++]=x,vbdata[f32pos++]=uvs[ci],vbdata[f32pos++]=uvs[ci+1],ci+=2}this._vb.setNeedUpload();var vertN=this.vertNum;if(0<vertN){(sz=idx.length)>MeshTexture.tmpIdx.length&&(MeshTexture.tmpIdx=new Uint16Array(sz));for(var ii=0;ii<sz;ii++)MeshTexture.tmpIdx[ii]=idx[ii]+vertN;this._ib.appendU16Array(MeshTexture.tmpIdx,idx.length)}else this._ib.append(idx);this._ib.setNeedUpload(),this.vertNum+=sz,this.indexNum+=idx.length},__proto.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},__proto.destroy=function(){this._ib.destroy(),this._vb.destroy()},MeshTexture.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new MeshTexture},MeshTexture.const_stride=16,MeshTexture._POOL=[],__static(MeshTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),MeshTexture}(),BaseShader=function(){function BaseShader(){BaseShader.__super.call(this),this.lock=!0}return __class(BaseShader,"laya.webgl.shader.BaseShader",Resource),BaseShader.activeShader=null,BaseShader.bindShader=null,BaseShader}(),RenderTarget2D=function(_super){function RenderTarget2D(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===surfaceFormat&&(surfaceFormat=6408),void 0===surfaceType&&(surfaceType=5121),void 0===depthStencilFormat&&(depthStencilFormat=34041),void 0===mipMap&&(mipMap=!1),void 0===repeat&&(repeat=!1),void 0===minFifter&&(minFifter=-1),void 0===magFifter&&(magFifter=-1),this._type=1,this._w=width,this._h=height,this._surfaceFormat=surfaceFormat,this._surfaceType=surfaceType,this._depthStencilFormat=depthStencilFormat,Render.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=mipMap,this._repeat=repeat,this._minFifter=minFifter,this._magFifter=magFifter,this._createWebGLRenderTarget(),this.bitmap.lock=!0,RenderTarget2D.__super.call(this,this.bitmap,Texture.INV_UV)}__class(RenderTarget2D,"laya.webgl.resource.RenderTarget2D",_super);var __proto=RenderTarget2D.prototype;return Laya.imps(__proto,{"laya.resource.IDispose":!0}),__proto.getType=function(){return this._type},__proto.getTexture=function(){return this},__proto.size=function(w,h){this._w==w&&this._h==h||(this._w=w,this._h=h,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},__proto.release=function(){this.destroy()},__proto.recycle=function(){RenderTarget2D.POOL.push(this)},__proto.start=function(){var gl=WebGL.mainContext;return this._preRenderTarget=RenderState2D.curRenderTarget,RenderState2D.curRenderTarget=this,gl.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(gl.viewport(0,0,this._w,this._h),this._svWidth=RenderState2D.width,this._svHeight=RenderState2D.height,RenderState2D.width=this._w,RenderState2D.height=this._h,BaseShader.activeShader=null),this},__proto.clear=function(r,g,b,a){var gl=WebGL.mainContext,clearFlag=(gl.clearColor(r=void 0===r?0:r,g=void 0===g?0:g,b=void 0===b?0:b,a=void 0===a?1:a),16384);switch(this._depthStencilFormat){case 33189:clearFlag|=256;break;case 36168:clearFlag|=1024;break;case 34041:clearFlag=clearFlag|256|1024}gl.clear(clearFlag)},__proto.end=function(){var gl=WebGL.mainContext;gl.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,RenderState2D.curRenderTarget=this._preRenderTarget,1==this._type?(gl.viewport(0,0,this._svWidth,this._svHeight),RenderState2D.width=this._svWidth,RenderState2D.height=this._svHeight,BaseShader.activeShader=null):gl.viewport(0,0,Laya.stage.width,Laya.stage.height)},__proto.getData=function(x,y,width,height){var pixels,gl=WebGL.mainContext;return gl.bindFramebuffer(36160,this.bitmap.frameBuffer),36053===gl.checkFramebufferStatus(36160)?(pixels=new Uint8Array(this._w*this._h*4),gl.readPixels(x,y,width,height,this._surfaceFormat,this._surfaceType,pixels),gl.bindFramebuffer(36160,null),pixels):(gl.bindFramebuffer(36160,null),null)},__proto.destroy=function(foreDiposeTexture){void 0===foreDiposeTexture&&(foreDiposeTexture=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,_super.prototype.destroy.call(this))},__proto.dispose=function(){},__proto._createWebGLRenderTarget=function(){this.bitmap=new WebGLRenderTarget(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(e){this.event("recovered")})},__getset(0,__proto,"surfaceFormat",function(){return this._surfaceFormat}),__getset(0,__proto,"magFifter",function(){return this._magFifter}),__getset(0,__proto,"surfaceType",function(){return this._surfaceType}),__getset(0,__proto,"mipMap",function(){return this._mipMap}),__getset(0,__proto,"depthStencilFormat",function(){return this._depthStencilFormat}),__getset(0,__proto,"minFifter",function(){return this._minFifter}),__getset(0,__proto,"source",function(){return this._alreadyResolved?Laya.superGet(Texture,this,"source"):null}),RenderTarget2D.create=function(w,h,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){void 0===surfaceFormat&&(surfaceFormat=6408),void 0===surfaceType&&(surfaceType=5121),void 0===depthStencilFormat&&(depthStencilFormat=34041),void 0===mipMap&&(mipMap=!1),void 0===repeat&&(repeat=!1),void 0===minFifter&&(minFifter=-1),void 0===magFifter&&(magFifter=-1);var t=RenderTarget2D.POOL.pop();return(t=t||new RenderTarget2D(w,h)).bitmap&&t._w==w&&t._h==h&&t._surfaceFormat==surfaceFormat&&t._surfaceType==surfaceType&&t._depthStencilFormat==depthStencilFormat&&t._mipMap==mipMap&&t._repeat==repeat&&t._minFifter==minFifter&&t._magFifter==magFifter||(t._w=w,t._h=h,t._surfaceFormat=surfaceFormat,t._surfaceType=surfaceType,t._depthStencilFormat=depthStencilFormat,Render.isConchWebGL&&34041===t._depthStencilFormat&&(t._depthStencilFormat=33189),t._mipMap=mipMap,t._repeat=repeat,t._minFifter=minFifter,t._magFifter=magFifter,t.release(),t._createWebGLRenderTarget()),t},RenderTarget2D.TYPE2D=1,RenderTarget2D.TYPE3D=2,RenderTarget2D.POOL=[],RenderTarget2D}(Texture),Buffer=function(){function Buffer(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,Buffer.__super.call(this),Buffer._gl=WebGL.mainContext}__class(Buffer,"laya.webgl.utils.Buffer",Resource);var __proto=Buffer.prototype;return __proto._bind=function(){this.activeResource(),Buffer._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(Buffer._bindVertexBuffer=this._glBuffer),Buffer._gl.bindBuffer(this._bufferType,Buffer._bindActive[this._bufferType]=this._glBuffer),BaseShader.activeShader=null)},__proto.recreateResource=function(){this._glBuffer||(this._glBuffer=Buffer._gl.createBuffer()),this.completeCreate()},__proto.disposeResource=function(){this._glBuffer&&(WebGL.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},__getset(0,__proto,"bufferUsage",function(){return this._bufferUsage}),Buffer._gl=null,Buffer._bindActive={},Buffer._bindVertexBuffer=null,Buffer._enableAtributes=[],Buffer}(),SkinSV=function(){function SkinSV(type){this.texcoord=null,this.offsetX=300,this.offsetY=0,SkinSV.__super.call(this,512,0);var _vlen=8*CONST3D2D.BYTES_PE;this.position=[2,5126,!1,_vlen,0],this.texcoord=[2,5126,!1,_vlen,2*CONST3D2D.BYTES_PE],this.color=[4,5126,!1,_vlen,4*CONST3D2D.BYTES_PE]}return __class(SkinSV,"laya.webgl.shader.d2.skinAnishader.SkinSV",Value2D),SkinSV}(),Color2dSV=function(){function Color2dSV(args){Color2dSV.__super.call(this,2,0),this.color=[]}return __class(Color2dSV,"laya.webgl.shader.d2.value.Color2dSV",Value2D),Color2dSV.prototype.setValue=function(value){value.fillStyle&&(this.color=value.fillStyle._color._color),value.strokeStyle&&(this.color=value.strokeStyle._color._color)},Color2dSV}(),FillTextureSV=function(){function FillTextureSV(type){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=Value2D._TEXCOORD,FillTextureSV.__super.call(this,256,0)}__class(FillTextureSV,"laya.webgl.shader.d2.value.FillTextureSV",Value2D);var __proto=FillTextureSV.prototype;return __proto.setValue=function(vo){this.ALPHA=vo.ALPHA,vo.filters&&this.setFilters(vo.filters)},__proto.clear=function(){this.texture=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},FillTextureSV}(),TextureSV=function(){function TextureSV(subID){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=Value2D._TEXCOORD,TextureSV.__super.call(this,1,subID=void 0===subID?0:subID)}__class(TextureSV,"laya.webgl.shader.d2.value.TextureSV",Value2D);var __proto=TextureSV.prototype;return __proto.setValue=function(vo){this.ALPHA=vo.ALPHA,vo.filters&&this.setFilters(vo.filters)},__proto.clear=function(){this.texture=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},TextureSV}(),PrimitiveSV=function(){function PrimitiveSV(args){this.a_color=null,this.u_pos=[0,0],PrimitiveSV.__super.call(this,4,0),this.position=[2,5126,!1,5*CONST3D2D.BYTES_PE,0],this.a_color=[3,5126,!1,5*CONST3D2D.BYTES_PE,2*CONST3D2D.BYTES_PE]}return __class(PrimitiveSV,"laya.webgl.shader.d2.value.PrimitiveSV",Value2D),PrimitiveSV}(),AtlasWebGLCanvas=function(_super){function AtlasWebGLCanvas(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,AtlasWebGLCanvas.__super.call(this)}__class(AtlasWebGLCanvas,"laya.webgl.atlas.AtlasWebGLCanvas",_super);var __proto=AtlasWebGLCanvas.prototype;return __proto.recreateResource=function(){var gl=WebGL.mainContext,glTex=this._source=gl.createTexture(),preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,3553,glTex),gl.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),gl.texParameteri(3553,10241,9729),gl.texParameteri(3553,10240,9729),gl.texParameteri(3553,10242,33071),gl.texParameteri(3553,10243,33071),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),this.memorySize=this._w*this._h*4,this.completeCreate()},__proto.disposeResource=function(){this._source&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},__proto.texSubImage2D=function(xoffset,yoffset,bitmap){var bmData,preTarget,preTexture;Render.isFlash?(this._flashCacheImage||(this._flashCacheImage=HTMLImage.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h)),bmData=bitmap.bitmapdata,this._flashCacheImage._image.copyPixels(bmData,0,0,bmData.width,bmData.height,xoffset,yoffset),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)):(bmData=WebGL.mainContext,preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue,WebGLContext.bindTexture(bmData,3553,this._source),Render.isConchWebGL?(bitmap!==ConchTextCanvas&&(0<=xoffset-1&&bmData.texSubImage2DEx(!0,3553,0,xoffset-1,yoffset,6408,5121,bitmap),xoffset+1<=this._w&&bmData.texSubImage2DEx(!0,3553,0,xoffset+1,yoffset,6408,5121,bitmap),0<=yoffset-1&&bmData.texSubImage2DEx(!0,3553,0,xoffset,yoffset-1,6408,5121,bitmap),yoffset+1<=this._h)&&bmData.texSubImage2DEx(!0,3553,0,xoffset,yoffset+1,6408,5121,bitmap),bmData.texSubImage2DEx(!0,3553,0,xoffset,yoffset,6408,5121,bitmap)):(bmData.pixelStorei(37441,!0),0<=xoffset-1&&bmData.texSubImage2D(3553,0,xoffset-1,yoffset,6408,5121,bitmap),xoffset+1<=this._w&&bmData.texSubImage2D(3553,0,xoffset+1,yoffset,6408,5121,bitmap),0<=yoffset-1&&bmData.texSubImage2D(3553,0,xoffset,yoffset-1,6408,5121,bitmap),yoffset+1<=this._h&&bmData.texSubImage2D(3553,0,xoffset,yoffset+1,6408,5121,bitmap),bmData.texSubImage2D(3553,0,xoffset,yoffset,6408,5121,bitmap),bmData.pixelStorei(37441,!1)),preTarget&&preTexture&&WebGLContext.bindTexture(bmData,preTarget,preTexture))},__proto.texSubImage2DPixel=function(xoffset,yoffset,width,height,pixel){var gl=WebGL.mainContext,preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue,pixel=(WebGLContext.bindTexture(gl,3553,this._source),new Uint8Array(pixel.data));Render.isConchWebGL?gl.texSubImage2DEx(!0,3553,0,xoffset,yoffset,width,height,6408,5121,pixel):(gl.pixelStorei(37441,!0),gl.texSubImage2D(3553,0,xoffset,yoffset,width,height,6408,5121,pixel),gl.pixelStorei(37441,!1)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture)},__getset(0,__proto,"width",_super.prototype._$get_width,function(value){this._w=value}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){this._h=value}),AtlasWebGLCanvas}(Bitmap),WebGLCanvas=function(){function WebGLCanvas(){this.flipY=!0,this.alwaysChange=!1,WebGLCanvas.__super.call(this)}__class(WebGLCanvas,"laya.webgl.resource.WebGLCanvas",Bitmap);var __proto=WebGLCanvas.prototype;return __proto.getCanvas=function(){return this._canvas},__proto.clear=function(){this._ctx&&this._ctx.clear()},__proto.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},__proto._setContext=function(context){this._ctx=context},__proto.getContext=function(contextID,other){return this._ctx||(this._ctx=WebGLCanvas._createContext(this))},__proto.size=function(w,h){this._w==w&&this._h==h||(this._w=w,this._h=h,this._ctx&&this._ctx.size(w,h),this._canvas&&(this._canvas.height=h,this._canvas.width=w))},__proto.activeResource=function(force){void 0===force&&(force=!1),this._source||this.recreateResource()},__proto.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},__proto.disposeResource=function(){this._source&&!this.iscpuSource&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},__proto.createWebGlTexture=function(){var gl=WebGL.mainContext,glTex=(this._canvas,this._source=gl.createTexture()),preTarget=(this.iscpuSource=!1,WebGLContext.curBindTexTarget),preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,3553,glTex),gl.pixelStorei(37440,this.flipY?1:0),Render.isConchWebGL?gl.texImage2DEx(WebGLCanvas.premulAlpha,3553,0,6408,6408,5121,this._imgData):(WebGLCanvas.premulAlpha&&gl.pixelStorei(37441,!0),gl.texImage2D(3553,0,6408,6408,5121,this._imgData),WebGLCanvas.premulAlpha&&gl.pixelStorei(37441,!1)),gl.texParameteri(3553,10240,9729),gl.texParameteri(3553,10241,9729),gl.texParameteri(3553,10242,33071),gl.texParameteri(3553,10243,33071),gl.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture)},__proto.reloadCanvasData=function(){var gl=WebGL.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,3553,this._source),Render.isConchWebGL?gl.texImage2DEx(WebGLCanvas.premulAlpha,3553,0,6408,6408,5121,this._imgData):(WebGLCanvas.premulAlpha&&gl.pixelStorei(37441,!0),gl.texImage2D(3553,0,6408,6408,5121,this._imgData),WebGLCanvas.premulAlpha&&gl.pixelStorei(37441,!1)),gl.pixelStorei(37440,0),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture)},__proto.texSubImage2D=function(webglCanvas,xoffset,yoffset){var gl=WebGL.mainContext,preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,3553,this._source),Render.isConchWebGL?gl.texSubImage2DEx(!0,3553,0,xoffset,yoffset,6408,5121,webglCanvas._source):(gl.pixelStorei(37441,!0),gl.texSubImage2D(3553,0,xoffset,yoffset,6408,5121,webglCanvas._source),gl.pixelStorei(37441,!1)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture)},__proto.toBase64=function(type,encoderOptions,callBack){var base64Data=null;this._canvas&&(base64Data=this._canvas.toDataURL(type,encoderOptions)),callBack.call(this,base64Data)},__getset(0,__proto,"context",function(){return this._ctx}),__getset(0,__proto,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),__getset(0,__proto,"asBitmap",null,function(value){this._ctx&&(this._ctx.asBitmap=value)}),WebGLCanvas._createContext=null,WebGLCanvas.premulAlpha=!1,WebGLCanvas}(),WebGLCharImage=function(){function WebGLCharImage(content,drawValue){this.CborderSize=12,WebGLCharImage.__super.call(this),this.char=content,this.isSpace=" "===content,this.xs=drawValue.scaleX,this.ys=drawValue.scaleY,this.font=drawValue.font.toString(),this.fontSize=drawValue.font.size,this.fillColor=drawValue.fillColor,this.borderColor=drawValue.borderColor,this.lineWidth=drawValue.lineWidth,this.underLine=drawValue.underLine;var pCanvas,content=Render.isConchApp,drawValue=(content?((pCanvas=ConchTextCanvas)._source=ConchTextCanvas,pCanvas._source.canvas=ConchTextCanvas):pCanvas=Browser.canvas.source,this.canvas=pCanvas,this._enableMerageInAtlas=!0,this._ctx=content?pCanvas:this.canvas.getContext("2d",void 0),Utils.measureText(this.char,this.font));this.cw=drawValue.width*this.xs,this.ch=(drawValue.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new Texture(this)}__class(WebGLCharImage,"laya.webgl.resource.WebGLCharImage",Bitmap);var __proto=WebGLCharImage.prototype;return Laya.imps(__proto,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),__proto.active=function(){this.texture.active()},__proto.recreateResource=function(){var sFont,bIsConchApp=Render.isConchApp;this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),bIsConchApp?(bIsConchApp=this.fontSize,1==this.xs&&1==this.ys||(bIsConchApp=parseInt(bIsConchApp*(this.xs>this.ys?this.xs:this.ys)+"")),sFont=(sFont="normal 100 "+this.font).replace(WebGLCharImage._fontSizeReg,bIsConchApp),this.borderColor&&(sFont+=" 1 "+this.borderColor),this._ctx.font=sFont,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)):(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,Text.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor||"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor||"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine&&(this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1),bIsConchApp=this._ctx.measureText(this.char).width+1,this._ctx.lineTo(bIsConchApp,this.fontSize+1),this._ctx.stroke()),this._ctx.restore()),this.borderSize=this.CborderSize,this.completeCreate()},__proto.onresize=function(w,h){this._w=w,this._h=h,this._allowMerageInAtlas=!0},__proto.clearAtlasSource=function(){},__getset(0,__proto,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),__getset(0,__proto,"atlasSource",function(){return this.canvas}),__getset(0,__proto,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(value){this._enableMerageInAtlas=value}),WebGLCharImage.createOneChar=function(content,drawValue){return new WebGLCharImage(content,drawValue)},WebGLCharImage._fontSizeReg=new RegExp("\\d+(?=px)","g"),WebGLCharImage}(),WebGLRenderTarget=function(){function WebGLRenderTarget(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){void 0===surfaceFormat&&(surfaceFormat=6408),void 0===surfaceType&&(surfaceType=5121),void 0===depthStencilFormat&&(depthStencilFormat=34041),void 0===mipMap&&(mipMap=!1),void 0===repeat&&(repeat=!1),void 0===minFifter&&(minFifter=-1),void 0===magFifter&&(magFifter=1),WebGLRenderTarget.__super.call(this),this._w=width,this._h=height,this._surfaceFormat=surfaceFormat,this._surfaceType=surfaceType,this._depthStencilFormat=depthStencilFormat,Render.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=mipMap,this._repeat=repeat,this._minFifter=minFifter,this._magFifter=magFifter}__class(WebGLRenderTarget,"laya.webgl.resource.WebGLRenderTarget",Bitmap);var __proto=WebGLRenderTarget.prototype;return __proto.recreateResource=function(){var gl=WebGL.mainContext,preTarget=(this._frameBuffer||(this._frameBuffer=gl.createFramebuffer()),this._source||(this._source=gl.createTexture()),WebGLContext.curBindTexTarget),preTexture=WebGLContext.curBindTexValue,minFifter=(WebGLContext.bindTexture(gl,3553,this._source),gl.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null),this._minFifter),magFifter=this._magFifter,repeat=this._repeat?10497:33071,isPot=Arith.isPOT(this._w,this._h);if(isPot?(this._mipMap?-1===minFifter&&(minFifter=9987):-1===minFifter&&(minFifter=9729),-1===magFifter&&(magFifter=9729),gl.texParameteri(3553,10241,minFifter),gl.texParameteri(3553,10240,magFifter),gl.texParameteri(3553,10242,repeat),gl.texParameteri(3553,10243,repeat),this._mipMap&&gl.generateMipmap(3553)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(3553,10241,minFifter=-1===minFifter?9729:minFifter),gl.texParameteri(3553,10240,magFifter),gl.texParameteri(3553,10242,33071),gl.texParameteri(3553,10243,33071)),gl.bindFramebuffer(36160,this._frameBuffer),gl.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=gl.createRenderbuffer()),gl.bindRenderbuffer(36161,this._depthStencilBuffer),gl.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:gl.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:gl.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:gl.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}gl.bindFramebuffer(36160,null),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),gl.bindRenderbuffer(36161,null),isPot&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},__proto.disposeResource=function(){this._frameBuffer&&(WebGL.mainContext.deleteTexture(this._source),WebGL.mainContext.deleteFramebuffer(this._frameBuffer),WebGL.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},__getset(0,__proto,"depthStencilBuffer",function(){return this._depthStencilBuffer}),__getset(0,__proto,"frameBuffer",function(){return this._frameBuffer}),WebGLRenderTarget}(),WebGLSubImage=function(){function WebGLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src){this.offsetX=0,this.offsetY=0,WebGLSubImage.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=atlasImage,this.canvas=canvas,this._ctx=canvas.getContext("2d",void 0),this._w=width,this._h=height,this.offsetX=offsetX,this.offsetY=offsetY,this.src=src,this._enableMerageInAtlas=!0,AtlasResourceManager.enabled&&this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}__class(WebGLSubImage,"laya.webgl.resource.WebGLSubImage",Bitmap);var __proto=WebGLSubImage.prototype;return Laya.imps(__proto,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),__proto.size=function(w,h){this._w=w,this._h=h,this._ctx&&this._ctx.size(w,h),this.canvas&&(this.canvas.height=h,this.canvas.width=w)},__proto.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},__proto.createWebGlTexture=function(){var gl=WebGL.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var glTex=this._source=gl.createTexture(),preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue,glTex=(WebGLContext.bindTexture(gl,3553,glTex),Render.isConchWebGL?gl.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(gl.pixelStorei(37441,!0),gl.texImage2D(3553,0,6408,6408,5121,this.canvas),gl.pixelStorei(37441,!1)),this.minFifter),magFifter=this.magFifter,repeat=this.repeat?10497:33071,isPOT=Arith.isPOT(this.width,this.height);isPOT?(this.mipmap?-1===glTex&&(glTex=9987):-1===glTex&&(glTex=9729),gl.texParameteri(3553,10240,magFifter=-1===magFifter?9729:magFifter),gl.texParameteri(3553,10241,glTex),gl.texParameteri(3553,10242,repeat),gl.texParameteri(3553,10243,repeat),this.mipmap&&gl.generateMipmap(3553)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(3553,10241,glTex=-1===glTex?9729:glTex),gl.texParameteri(3553,10240,magFifter),gl.texParameteri(3553,10242,33071),gl.texParameteri(3553,10243,33071)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),this.canvas=null,isPOT&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},__proto.disposeResource=function(){AtlasResourceManager.enabled&&this._allowMerageInAtlas||!this._source||(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},__proto.clearAtlasSource=function(){},__getset(0,__proto,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),__getset(0,__proto,"atlasSource",function(){return this.canvas}),__getset(0,__proto,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(value){this._allowMerageInAtlas=value}),WebGLSubImage}(),Shader=function(){function Shader(vs,ps,saveName,nameMap){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,Shader.__super.call(this),!vs||!ps)throw"Shader Error";this._id=++Shader._count,this._vs=vs,this._ps=ps,this._nameMap=nameMap||{},null!=saveName&&(Shader.sharders[saveName]=this)}__class(Shader,"laya.webgl.shader.Shader",BaseShader);var __proto=Shader.prototype;return __proto.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},__proto.disposeResource=function(){WebGL.mainContext.deleteShader(this._vshader),WebGL.mainContext.deleteShader(this._pshader),WebGL.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},__proto._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var text=[this._vs,this._ps],gl=WebGL.mainContext;if(this._program=gl.createProgram(),this._vshader=Shader._createShader(gl,text[0],35633),this._pshader=Shader._createShader(gl,text[1],35632),gl.attachShader(this._program,this._vshader),gl.attachShader(this._program,this._pshader),gl.linkProgram(this._program),!Render.isConchApp&&!gl.getProgramParameter(this._program,35714))throw gl.getProgramInfoLog(this._program);for(var n,i=0,attribNum=0,attribNum=Render.isConchApp?gl.getProgramParameterEx(this._vs,this._ps,"",35721):gl.getProgramParameter(this._program,35721),i=0;i<attribNum;i++){var attrib=null,one={vartype:"attribute",glfun:null,ivartype:0,attrib:attrib=Render.isConchApp?gl.getActiveAttribEx(this._vs,this._ps,"",i):gl.getActiveAttrib(this._program,i),location:gl.getAttribLocation(this._program,attrib.name),name:attrib.name,type:attrib.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0};this._params.push(one)}var nUniformNum=0,nUniformNum=Render.isConchApp?gl.getProgramParameterEx(this._vs,this._ps,"",35718):gl.getProgramParameter(this._program,35718);for(i=0;i<nUniformNum;i++){var uniform=null,uniform=Render.isConchApp?gl.getActiveUniformEx(this._vs,this._ps,"",i):gl.getActiveUniform(this._program,i);0<(one={vartype:"uniform",glfun:null,ivartype:1,attrib:attrib,location:gl.getUniformLocation(this._program,uniform.name),name:uniform.name,type:uniform.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(one.name=one.name.substr(0,one.name.length-3),one.isArray=!0,one.location=gl.getUniformLocation(this._program,one.name)),this._params.push(one)}for(i=0,n=this._params.length;i<n;i++)if((one=this._params[i]).indexOfParams=i,one.index=1,one.value=[one.location,null],one.codename=one.name,one.name=this._nameMap[one.codename]||one.codename,(this._paramsMap[one.name]=one)._this=this,one.uploadedValue=[],"attribute"===one.vartype)one.fun=this._attribute;else switch(one.type){case 5124:one.fun=one.isArray?this._uniform1iv:this._uniform1i;break;case 5126:one.fun=one.isArray?this._uniform1fv:this._uniform1f;break;case 35664:one.fun=one.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:one.fun=one.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:one.fun=one.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:one.fun=this._uniform_sampler2D;break;case 35680:one.fun=this._uniform_samplerCube;break;case 35676:one.glfun=gl.uniformMatrix4fv,one.fun=this._uniformMatrix4fv;break;case 35670:one.fun=this._uniform1i;break;default:throw new Error("compile shader err!")}}},__proto.getUniform=function(name){return this._paramsMap[name]},__proto._attribute=function(one,value){var gl=WebGL.mainContext,enableAtributes=Buffer._enableAtributes,one=one.location;return enableAtributes[one]||gl.enableVertexAttribArray(one),gl.vertexAttribPointer(one,value[0],value[1],value[2],value[3],value[4]+this._offset),enableAtributes[one]=Buffer._bindVertexBuffer,1},__proto._uniform1f=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value?(WebGL.mainContext.uniform1f(one.location,uploadedValue[0]=value),1):0},__proto._uniform1fv=function(one,value){var uploadedValue;return value.length<4?(uploadedValue=one.uploadedValue)[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform1fv(one.location,value),uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3],1):0:(WebGL.mainContext.uniform1fv(one.location,value),1)},__proto._uniform_vec2=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]?(WebGL.mainContext.uniform2f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]),1):0},__proto._uniform_vec2v=function(one,value){var uploadedValue;return value.length<2?(uploadedValue=one.uploadedValue)[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform2fv(one.location,value),uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3],1):0:(WebGL.mainContext.uniform2fv(one.location,value),1)},__proto._uniform_vec3=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]?(WebGL.mainContext.uniform3f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]),1):0},__proto._uniform_vec3v=function(one,value){return WebGL.mainContext.uniform3fv(one.location,value),1},__proto._uniform_vec4=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform4f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]),1):0},__proto._uniform_vec4v=function(one,value){return WebGL.mainContext.uniform4fv(one.location,value),1},__proto._uniformMatrix2fv=function(one,value){return WebGL.mainContext.uniformMatrix2fv(one.location,!1,value),1},__proto._uniformMatrix3fv=function(one,value){return WebGL.mainContext.uniformMatrix3fv(one.location,!1,value),1},__proto._uniformMatrix4fv=function(one,value){return WebGL.mainContext.uniformMatrix4fv(one.location,!1,value),1},__proto._uniform1i=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value?(WebGL.mainContext.uniform1i(one.location,uploadedValue[0]=value),1):0},__proto._uniform1iv=function(one,value){return WebGL.mainContext.uniform1iv(one.location,value),1},__proto._uniform_ivec2=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]?(WebGL.mainContext.uniform2i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]),1):0},__proto._uniform_ivec2v=function(one,value){return WebGL.mainContext.uniform2iv(one.location,value),1},__proto._uniform_vec3i=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]?(WebGL.mainContext.uniform3i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]),1):0},__proto._uniform_vec3vi=function(one,value){return WebGL.mainContext.uniform3iv(one.location,value),1},__proto._uniform_vec4i=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform4i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]),1):0},__proto._uniform_vec4vi=function(one,value){return WebGL.mainContext.uniform4iv(one.location,value),1},__proto._uniform_sampler2D=function(one,value){var gl=WebGL.mainContext,uploadedValue=one.uploadedValue;return null==uploadedValue[0]?(uploadedValue[0]=this._curActTexIndex,gl.uniform1i(one.location,this._curActTexIndex),gl.activeTexture(Shader._TEXTURES[this._curActTexIndex]),WebGLContext.bindTexture(gl,3553,value),this._curActTexIndex++,1):(gl.activeTexture(Shader._TEXTURES[uploadedValue[0]]),WebGLContext.bindTexture(gl,3553,value),0)},__proto._uniform_samplerCube=function(one,value){var gl=WebGL.mainContext,uploadedValue=one.uploadedValue;return null==uploadedValue[0]?(uploadedValue[0]=this._curActTexIndex,gl.uniform1i(one.location,this._curActTexIndex),gl.activeTexture(Shader._TEXTURES[this._curActTexIndex]),WebGLContext.bindTexture(gl,34067,value),this._curActTexIndex++,1):(gl.activeTexture(Shader._TEXTURES[uploadedValue[0]]),WebGLContext.bindTexture(gl,34067,value),0)},__proto._noSetValue=function(one){console.log("no....:"+one.name)},__proto.uploadOne=function(name,value){this.activeResource(),WebGLContext.UseProgram(this._program);name=this._paramsMap[name];name.fun.call(this,name,value)},__proto.uploadTexture2D=function(value){Stat.shaderCall++;var gl=WebGL.mainContext;gl.activeTexture(33984),WebGLContext.bindTexture(gl,3553,value)},__proto.upload=function(shaderValue,params){(BaseShader.activeShader=BaseShader.bindShader=this)._lastUseFrameCount!==Stat.loopCount&&this.activeResource(),WebGLContext.UseProgram(this._program),this._reCompile?(params=this._params,this._reCompile=!1):params=params||this._params;WebGL.mainContext;for(var one,value,n=params.length,shaderCall=0,i=0;i<n;i++)null!==(value=shaderValue[(one=params[i]).name])&&(shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadArray=function(shaderValue,length,_bufferUsage){BaseShader.activeShader=this,(BaseShader.bindShader=this).activeResource(),WebGLContext.UseProgram(this._program);this._params;for(var value,one,shaderCall=0,i=length-2;0<=i;i-=2)(one=this._paramsMap[shaderValue[i]])&&null!=(value=shaderValue[i+1])&&(_bufferUsage&&_bufferUsage[one.name]&&_bufferUsage[one.name].bind(),shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.getParams=function(){return this._params},Shader.getShader=function(name){return Shader.sharders[name]},Shader.create=function(vs,ps,saveName,nameMap){return new Shader(vs,ps,saveName,nameMap)},Shader.withCompile=function(nameID,define,shaderName,createShader){if(shaderName&&Shader.sharders[shaderName])return Shader.sharders[shaderName];var pre=Shader._preCompileShader[2e-4*nameID];if(pre)return pre.createShader(define,shaderName,createShader);throw new Error("withCompile shader err!"+nameID)},Shader.withCompile2D=function(nameID,mainID,define,shaderName,createShader){if(shaderName&&Shader.sharders[shaderName])return Shader.sharders[shaderName];var pre=Shader._preCompileShader[2e-4*nameID+mainID];if(pre)return pre.createShader(define,shaderName,createShader);throw new Error("withCompile shader err!"+nameID+" "+mainID)},Shader.addInclude=function(fileName,txt){ShaderCompile.addInclude(fileName,txt)},Shader.preCompile=function(nameID,vs,ps,nameMap){nameID*=2e-4;Shader._preCompileShader[nameID]=new ShaderCompile(nameID,vs,ps,nameMap)},Shader.preCompile2D=function(nameID,mainID,vs,ps,nameMap){nameID=2e-4*nameID+mainID;Shader._preCompileShader[nameID]=new ShaderCompile(nameID,vs,ps,nameMap)},Shader._createShader=function(gl,str,type){type=gl.createShader(type);return gl.shaderSource(type,str),gl.compileShader(type),type},Shader._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],Shader._count=0,Shader._preCompileShader={},Shader.SHADERNAME2ID=2e-4,Shader.sharders=(Shader.sharders=[],Shader.sharders.length=32,Shader.sharders),__static(Shader,["nameKey",function(){return this.nameKey=new StringKey}]),Shader}(),Buffer2D=function(_super){function Buffer2D(){this._maxsize=0,this._upload=!0,this._uploadSize=0,Buffer2D.__super.call(this),this.lock=!0}__class(Buffer2D,"laya.webgl.utils.Buffer2D",_super);var __proto=Buffer2D.prototype;return __proto.needSize=function(sz){var old=this._byteLength;return sz&&((sz=this._byteLength+sz)<=this._buffer.byteLength||this._resizeBuffer(sz<<1,!0),this._byteLength=sz),old},__proto._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),Stat.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Buffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Buffer._gl.bufferSubData(this._bufferType,0,this._buffer)},__proto._bufferSubData=function(offset,dataStart,dataLength){void 0===offset&&(offset=0),void 0===dataStart&&(dataStart=0),void 0===dataLength&&(dataLength=0),this._maxsize=Math.max(this._maxsize,this._byteLength),Stat.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Buffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),dataStart||dataLength?(dataStart=this._buffer.slice(dataStart,dataLength),Buffer._gl.bufferSubData(this._bufferType,offset,dataStart)):Buffer._gl.bufferSubData(this._bufferType,offset,this._buffer)},__proto._checkArrayUse=function(){},__proto._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},__proto._bind_subUpload=function(offset,dataStart,dataLength){return void 0===offset&&(offset=0),void 0===dataStart&&(dataStart=0),void 0===dataLength&&(dataLength=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(offset,dataStart,dataLength),!0)},__proto._resizeBuffer=function(nsz,copy){return nsz<this._buffer.byteLength||(this.memorySize=nsz,copy&&this._buffer&&0<this._buffer.byteLength?(copy=new ArrayBuffer(nsz),new Uint8Array(copy).set(new Uint8Array(this._buffer),0),this._buffer=copy):this._buffer=new ArrayBuffer(nsz),this._checkArrayUse(),this._upload=!0),this},__proto.append=function(data){this._upload=!0;var n,byteLen=data.byteLength;data instanceof Uint8Array?(this._resizeBuffer(this._byteLength+byteLen,!0),n=new Uint8Array(this._buffer,this._byteLength)):data instanceof Uint16Array?(this._resizeBuffer(this._byteLength+byteLen,!0),n=new Uint16Array(this._buffer,this._byteLength)):data instanceof Float32Array&&(this._resizeBuffer(this._byteLength+byteLen,!0),n=new Float32Array(this._buffer,this._byteLength)),n.set(data,0),this._byteLength+=byteLen,this._checkArrayUse()},__proto.appendU16Array=function(data,len){this._resizeBuffer(this._byteLength+2*len,!0);for(var u=new Uint16Array(this._buffer,this._byteLength,len),i=0;i<len;i++)u[i]=data[i];this._byteLength+=2*len,this._checkArrayUse()},__proto.appendEx=function(data,type){this._upload=!0;var byteLen=data.byteLength;this._resizeBuffer(this._byteLength+byteLen,!0),new type(this._buffer,this._byteLength).set(data,0),this._byteLength+=byteLen,this._checkArrayUse()},__proto.appendEx2=function(data,type,dataLen,perDataLen){void 0===perDataLen&&(perDataLen=1),this._upload=!0;this._resizeBuffer(this._byteLength+(perDataLen=dataLen*perDataLen),!0);for(var n=new type(this._buffer,this._byteLength),i=0,i=0;i<dataLen;i++)n[i]=data[i];this._byteLength+=perDataLen,this._checkArrayUse()},__proto.getBuffer=function(){return this._buffer},__proto.setNeedUpload=function(){this._upload=!0},__proto.getNeedUpload=function(){return this._upload},__proto.upload=function(){var scuess=this._bind_upload();return Buffer._gl.bindBuffer(this._bufferType,null),Buffer._bindActive[this._bufferType]=null,BaseShader.activeShader=null,scuess},__proto.subUpload=function(offset,dataStart,dataLength){void 0===offset&&(offset=0),void 0===dataStart&&(dataStart=0),void 0===dataLength&&(dataLength=0);offset=this._bind_subUpload();return Buffer._gl.bindBuffer(this._bufferType,null),Buffer._bindActive[this._bufferType]=null,BaseShader.activeShader=null,offset},__proto.disposeResource=function(){_super.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},__proto.clear=function(){this._byteLength=0,this._upload=!0},__getset(0,__proto,"bufferLength",function(){return this._buffer.byteLength}),__getset(0,__proto,"byteLength",null,function(value){this._byteLength!==value&&(value<=this._buffer.byteLength||this._resizeBuffer(2*value+256,!0),this._byteLength=value)}),Buffer2D.__int__=function(gl){IndexBuffer2D.QuadrangleIB=IndexBuffer2D.create(35044),GlUtils.fillIBQuadrangle(IndexBuffer2D.QuadrangleIB,16)},Buffer2D.FLOAT32=4,Buffer2D.SHORT=2,Buffer2D}(Buffer),TextSV=(function(_super){function GlowSV(args){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,GlowSV.__super.call(this,9)}__class(GlowSV,"laya.webgl.shader.d2.value.GlowSV",_super);var __proto=GlowSV.prototype;__proto.setValue=function(vo){_super.prototype.setValue.call(this,vo)},__proto.clear=function(){_super.prototype.clear.call(this)}}(TextureSV),function(_super){function TextSV(args){TextSV.__super.call(this,64),this.defines.add(64)}__class(TextSV,"laya.webgl.shader.d2.value.TextSV",_super);var __proto=TextSV.prototype;return __proto.release=function(){(TextSV.pool[TextSV._length++]=this).clear()},__proto.clear=function(){_super.prototype.clear.call(this)},TextSV.create=function(){return TextSV._length?TextSV.pool[--TextSV._length]:new TextSV},TextSV.pool=[],TextSV._length=0,TextSV}(TextureSV)),Shader2X=function(_super){function Shader2X(vs,ps,saveName,nameMap){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,Shader2X.__super.call(this,vs,ps,saveName,nameMap)}__class(Shader2X,"laya.webgl.shader.d2.Shader2X",_super);var __proto=Shader2X.prototype;return __proto.upload2dQuick1=function(shaderValue){this.upload(shaderValue,this._params2dQuick1||this._make2dQuick1())},__proto._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var one,params=this._params,i=0,n=params.length;i<n;i++)one=params[i],(Render.isFlash||"size"!==one.name&&"position"!==one.name&&"texcoord"!==one.name)&&this._params2dQuick1.push(one)}return this._params2dQuick1},__proto.disposeResource=function(){_super.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},__proto.upload2dQuick2=function(shaderValue){this.upload(shaderValue,this._params2dQuick2||this._make2dQuick2())},__proto._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var one,params=this._params,i=0,n=params.length;i<n;i++)one=params[i],!Render.isFlash&&"size"===one.name||this._params2dQuick2.push(one)}return this._params2dQuick2},Shader2X.create=function(vs,ps,saveName,nameMap){return new Shader2X(vs,ps,saveName,nameMap)},Shader2X}(Shader),IndexBuffer2D=function(){function IndexBuffer2D(bufferUsage){this._uint8Array=null,this._uint16Array=null,void 0===bufferUsage&&(bufferUsage=35044),IndexBuffer2D.__super.call(this),this._bufferUsage=bufferUsage,this._bufferType=34963,Render.isFlash||(this._buffer=new ArrayBuffer(8))}__class(IndexBuffer2D,"laya.webgl.utils.IndexBuffer2D",Buffer2D);var __proto=IndexBuffer2D.prototype;return __proto._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},__proto.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},__proto.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},__proto.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},IndexBuffer2D.QuadrangleIB=null,IndexBuffer2D.create=function(bufferUsage){return new IndexBuffer2D(bufferUsage=void 0===bufferUsage?35044:bufferUsage)},IndexBuffer2D}(),VertexBuffer2D=function(_super){function VertexBuffer2D(vertexStride,bufferUsage){this._floatArray32=null,this._vertexStride=0,VertexBuffer2D.__super.call(this),this._vertexStride=vertexStride,this._bufferUsage=bufferUsage,this._bufferType=34962,Render.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}__class(VertexBuffer2D,"laya.webgl.utils.VertexBuffer2D",_super);var __proto=VertexBuffer2D.prototype;return __proto.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},__proto.bind=function(ibBuffer){ibBuffer&&ibBuffer._bind(),this._bind()},__proto.insertData=function(data,pos){this.getFloat32Array().set(data,pos),this._upload=!0},__proto.bind_upload=function(ibBuffer){ibBuffer._bind_upload()||ibBuffer._bind(),this._bind_upload()||this._bind()},__proto._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},__proto.disposeResource=function(){_super.prototype.disposeResource.call(this)},__proto.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},__getset(0,__proto,"vertexStride",function(){return this._vertexStride}),VertexBuffer2D.create=function(vertexStride,bufferUsage){return new VertexBuffer2D(vertexStride,bufferUsage=void 0===bufferUsage?35048:bufferUsage)},VertexBuffer2D}(Buffer2D),WebGLImage=function(){function WebGLImage(data,def,format,mipmap,width,height){this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===format&&(format=6408),void 0===mipmap&&(mipmap=!0),WebGLImage.__super.call(this,data,def),this._format=format,this._mipmap=mipmap,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof data?(this._url=data,this._src=data,this._image=new Browser.window.Image,def&&(def.onload&&(this.onload=def.onload),def.onerror&&(this.onerror=def.onerror),def.onCreate)&&def.onCreate(this),this._image.crossOrigin=data&&0==data.indexOf("data:")?null:"",data&&(this._image.src=data)):data instanceof ArrayBuffer?(this._src=def,this._url=this._src,(format=new Byte(data)).readUTFBytes(4),format.readUTFBytes(2),format.getInt16(),format.endian="bigEndian",this._w=format.getInt16(),this._h=format.getInt16(),format.getInt16(),format.getInt16(),this._image=new Uint8Array(data,format.pos),this._format=WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,AtlasResourceManager.enabled&&this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1):data instanceof Uint8Array?(this._src=def,this._url=this._src,this._w=width,this._h=height,this._image=data,this._format=data.byteLength/(width*height)==4?6408:6407):(this._src=def,this._url=this._src,this._image=data.source||data,this.onresize()),this._$5__enableMerageInAtlas=!0}__class(WebGLImage,"laya.webgl.resource.WebGLImage",HTMLImage);var __proto=WebGLImage.prototype;return Laya.imps(__proto,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),__proto._init_=function(src,def){},__proto._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var gl=WebGL.mainContext,glTex=this._source=gl.createTexture(),preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue,glTex=(WebGLContext.bindTexture(gl,3553,glTex),this.minFifter),magFifter=this.magFifter,repeat=this.repeat?10497:33071,isPot=Arith.isPOT(this._w,this._h);if(isPot?(this.mipmap?-1===glTex&&(glTex=9987):-1===glTex&&(glTex=9729),-1===magFifter&&(magFifter=9729),gl.texParameteri(3553,10241,glTex),gl.texParameteri(3553,10240,magFifter),gl.texParameteri(3553,10242,repeat),gl.texParameteri(3553,10243,repeat),this.mipmap&&gl.generateMipmap(3553)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(3553,10241,glTex=-1===glTex?9729:glTex),gl.texParameteri(3553,10240,magFifter),gl.texParameteri(3553,10242,33071),gl.texParameteri(3553,10243,33071)),Render.isConchWebGL)switch(this._format){case 6407:case 6408:gl.texImage2DEx(!0,3553,0,this._format,this._format,5121,this._image);break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:gl.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(gl.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?gl.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image):gl.texImage2D(3553,0,this._format,this._format,5121,this._image);break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:gl.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}gl.pixelStorei(37441,!1)}preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),this._image.onload=null,this._image=null,isPot&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},__proto.recreateResource=function(){var _this,_$this=this;null!=this._src&&""!==this._src&&(this._needReleaseAgain=!1,this._image?this._recreateLock||(this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()):(this._recreateLock=!0,(_this=this)._image=new Browser.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){_this._needReleaseAgain?(_this._needReleaseAgain=!1,_this._image.onload=null,_this._image=null):(_this._allowMerageInAtlas&&_this._enableMerageInAtlas?(_$this.memorySize=0,_$this._recreateLock=!1):_this._createWebGlTexture(),_this.completeCreate())},this._image.src=this._src))},__proto.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&WebGL.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},__proto.onresize=function(){this._w=this._image.width,this._h=this._image.height,AtlasResourceManager.enabled&&this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},__proto.clearAtlasSource=function(){this._image=null},__getset(0,__proto,"format",function(){return this._format}),__getset(0,__proto,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(value){this._$5__enableMerageInAtlas=value}),__getset(0,__proto,"mipmap",function(){return this._mipmap}),__getset(0,__proto,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),__getset(0,__proto,"atlasSource",function(){return this._image}),__getset(0,__proto,"onload",null,function(value){var _$this=this;this._onload=value,this._image&&(this._image.onload=null!=this._onload?function(){_$this.onresize(),_$this._onload()}:null)}),__getset(0,__proto,"onerror",null,function(value){var _$this=this;this._onerror=value,this._image&&(this._image.onerror=null!=this._onerror?function(){_$this._onerror()}:null)}),WebGLImage}();Laya.__init([DrawText,AtlasGrid,WebGLContext2D,ShaderCompile])}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(require,exports){"use strict";for(var i in Object.defineProperty(exports,"__esModule",{value:!0}),Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o)}}),!function(window,Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec,Arith=laya.maths.Arith,AtlasResourceManager=laya.webgl.atlas.AtlasResourceManager,BaseShader=laya.webgl.shader.BaseShader,Browser=laya.utils.Browser,Buffer=laya.webgl.utils.Buffer,Byte=laya.utils.Byte,ClassUtils=laya.utils.ClassUtils,Config=Laya.Config,EventDispatcher=(laya.events.Event,laya.events.EventDispatcher),Handler=laya.utils.Handler,Loader=laya.net.Loader,LoaderManager=laya.net.LoaderManager,Node=(laya.maths.MathUtil,laya.display.Node),Render=laya.renders.Render,RenderState2D=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),Resource=laya.resource.Resource,RunDriver=laya.utils.RunDriver,ShaderCompile=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),Sprite=laya.display.Sprite,Stat=laya.utils.Stat,StringKey=laya.utils.StringKey,URL=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),Utils=laya.utils.Utils,WebGL=laya.webgl.WebGL,WebGLContext=laya.webgl.WebGLContext,AnimationEvent=(laya.webgl.canvas.WebGLContext2D,Laya.interface("laya.d3.core.IClone"),Laya.interface("laya.d3.graphics.IVertex"),Laya.interface("laya.d3.core.render.IUpdate"),Laya.interface("laya.d3.core.scene.ITreeNode"),Laya.interface("laya.d3.core.render.IRenderable"),function(){function AnimationClipParser01(){}__class(AnimationClipParser01,"laya.d3.animation.AnimationClipParser01"),AnimationClipParser01.READ_DATA=function(){AnimationClipParser01._DATA.offset=AnimationClipParser01._reader.getUint32(),AnimationClipParser01._DATA.size=AnimationClipParser01._reader.getUint32()},AnimationClipParser01.READ_BLOCK=function(){for(var count=AnimationClipParser01._BLOCK.count=AnimationClipParser01._reader.getUint16(),blockStarts=AnimationClipParser01._BLOCK.blockStarts=[],blockLengths=AnimationClipParser01._BLOCK.blockLengths=[],i=0;i<count;i++)blockStarts.push(AnimationClipParser01._reader.getUint32()),blockLengths.push(AnimationClipParser01._reader.getUint32())},AnimationClipParser01.READ_STRINGS=function(){var offset=AnimationClipParser01._reader.getUint32(),count=AnimationClipParser01._reader.getUint16(),prePos=AnimationClipParser01._reader.pos;AnimationClipParser01._reader.pos=offset+AnimationClipParser01._DATA.offset;for(var i=0;i<count;i++)AnimationClipParser01._strings[i]=AnimationClipParser01._reader.readUTFString();AnimationClipParser01._reader.pos=prePos},AnimationClipParser01.parse=function(clip,reader){AnimationClipParser01._animationClip=clip;(AnimationClipParser01._reader=reader).__getBuffer();AnimationClipParser01.READ_DATA(),AnimationClipParser01.READ_BLOCK(),AnimationClipParser01.READ_STRINGS();for(var i=0,n=AnimationClipParser01._BLOCK.count;i<n;i++){var index=reader.getUint16(),blockName=AnimationClipParser01._strings[index],fn=AnimationClipParser01["READ_"+blockName];if(null==fn)throw new Error("model file err,no this function:"+index+" "+blockName);fn.call()}},AnimationClipParser01.READ_ANIMATIONS=function(){var i=0,j=0,reader=AnimationClipParser01._reader,buffer=reader.__getBuffer(),lengthTypes=[],lenghthTypeCount=reader.getUint8();for(lengthTypes.length=lenghthTypeCount,i=0;i<lenghthTypeCount;i++)lengthTypes[i]=reader.getUint16();var startTimeTypes=[],startTimeTypeCount=reader.getUint16();for(startTimeTypes.length=startTimeTypeCount,i=0;i<startTimeTypeCount;i++)startTimeTypes[i]=reader.getFloat32();var clip=AnimationClipParser01._animationClip,clipDur=(clip.name=AnimationClipParser01._strings[reader.getUint16()],clip._duration=reader.getFloat32()),nodeCount=(clip.islooping=!!reader.getByte(),clip._frameRate=reader.getInt16(),reader.getInt16()),nodes=clip._nodes=new Array;nodes.length=nodeCount;(clip._publicClipDatas=[]).length=nodeCount;for(var nodesMap=clip._nodesMap={},cachePropertyToNodeIndex=0,unCachePropertyToNodeIndex=0,i=0;i<nodeCount;i++){var node=nodes[i]=new KeyframeNode,pathLength=reader.getUint16(),path=node.path=[];for(path.length=pathLength,j=0;j<pathLength;j++)path[j]=AnimationClipParser01._strings[reader.getUint16()];var nodePath=path.join("/"),mapArray=nodesMap[nodePath],nodePath=(mapArray||(nodesMap[nodePath]=mapArray=[]),mapArray.push(node),reader.getInt16()),mapArray=(-1!==nodePath&&(node.componentType=AnimationClipParser01._strings[nodePath]),AnimationNode._propertyIndexDic[AnimationClipParser01._strings[reader.getUint16()]]);if(null==mapArray)throw new Error("AnimationClipParser01:unknown property name.");for(var nodePath=mapArray<4,nodePath=!nodePath||""===path[0],dataLength=((node._cacheProperty=nodePath)?cachePropertyToNodeIndex++:unCachePropertyToNodeIndex++,node.propertyNameID=mapArray,lengthTypes[reader.getUint8()]),keyFrames=(node.keyFrameWidth=dataLength/4,node.keyFrames=[]),keyframeCount=keyFrames.length=reader.getUint16(),lastKeyFrame=null,startTime=NaN,j=0;j<keyframeCount;j++){var keyFrame=keyFrames[j]=new Keyframe,startTime=keyFrame.startTime=startTimeTypes[reader.getUint16()],offset=reader.pos;keyFrame.inTangent=new Float32Array(buffer.slice(offset,offset+dataLength)),reader.pos+=dataLength,offset=reader.pos,keyFrame.outTangent=new Float32Array(buffer.slice(offset,offset+dataLength)),reader.pos+=dataLength,offset=reader.pos,keyFrame.data=new Float32Array(buffer.slice(offset,offset+dataLength)),reader.pos+=dataLength,lastKeyFrame&&(lastKeyFrame.next=keyFrame,lastKeyFrame.duration=startTime-lastKeyFrame.startTime),lastKeyFrame=keyFrame}keyFrame.next=null,keyFrame.duration=clipDur-startTime}var nodeToCachePropertyMap=clip._nodeToCachePropertyMap=new Int32Array(nodeCount),cachePropertyToNodeMap=clip._cachePropertyMap=new Int32Array(cachePropertyToNodeIndex),unCachePropertyToNodeMap=clip._unCachePropertyMap=new Int32Array(unCachePropertyToNodeIndex),cachePropertyToNodeIndex=unCachePropertyToNodeIndex=0;for(i=0;i<nodeCount;i++)(node=nodes[i])._cacheProperty?(nodeToCachePropertyMap[i]=cachePropertyToNodeIndex,cachePropertyToNodeMap[cachePropertyToNodeIndex++]=i):unCachePropertyToNodeMap[unCachePropertyToNodeIndex++]=i},AnimationClipParser01._animationClip=null,AnimationClipParser01._reader=null,AnimationClipParser01._strings=[],__static(AnimationClipParser01,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}(),function(){function AnimationClipParser02(){}__class(AnimationClipParser02,"laya.d3.animation.AnimationClipParser02"),AnimationClipParser02.READ_DATA=function(){AnimationClipParser02._DATA.offset=AnimationClipParser02._reader.getUint32(),AnimationClipParser02._DATA.size=AnimationClipParser02._reader.getUint32()},AnimationClipParser02.READ_BLOCK=function(){for(var count=AnimationClipParser02._BLOCK.count=AnimationClipParser02._reader.getUint16(),blockStarts=AnimationClipParser02._BLOCK.blockStarts=[],blockLengths=AnimationClipParser02._BLOCK.blockLengths=[],i=0;i<count;i++)blockStarts.push(AnimationClipParser02._reader.getUint32()),blockLengths.push(AnimationClipParser02._reader.getUint32())},AnimationClipParser02.READ_STRINGS=function(){var offset=AnimationClipParser02._reader.getUint32(),count=AnimationClipParser02._reader.getUint16(),prePos=AnimationClipParser02._reader.pos;AnimationClipParser02._reader.pos=offset+AnimationClipParser02._DATA.offset;for(var i=0;i<count;i++)AnimationClipParser02._strings[i]=AnimationClipParser02._reader.readUTFString();AnimationClipParser02._reader.pos=prePos},AnimationClipParser02.parse=function(clip,reader){AnimationClipParser02._animationClip=clip;(AnimationClipParser02._reader=reader).__getBuffer();AnimationClipParser02.READ_DATA(),AnimationClipParser02.READ_BLOCK(),AnimationClipParser02.READ_STRINGS();for(var i=0,n=AnimationClipParser02._BLOCK.count;i<n;i++){var index=reader.getUint16(),blockName=AnimationClipParser02._strings[index],fn=AnimationClipParser02["READ_"+blockName];if(null==fn)throw new Error("model file err,no this function:"+index+" "+blockName);fn.call()}},AnimationClipParser02.READ_ANIMATIONS=function(){var i=0,j=0,reader=AnimationClipParser02._reader,buffer=reader.__getBuffer(),lengthTypes=[],lenghthTypeCount=reader.getUint8();for(lengthTypes.length=lenghthTypeCount,i=0;i<lenghthTypeCount;i++)lengthTypes[i]=reader.getUint16();var startTimeTypes=[],startTimeTypeCount=reader.getUint16();for(startTimeTypes.length=startTimeTypeCount,i=0;i<startTimeTypeCount;i++)startTimeTypes[i]=reader.getFloat32();var clip=AnimationClipParser02._animationClip,clipDur=(clip.name=AnimationClipParser02._strings[reader.getUint16()],clip._duration=reader.getFloat32()),nodeCount=(clip.islooping=!!reader.getByte(),clip._frameRate=reader.getInt16(),reader.getInt16()),nodes=clip._nodes=new Array;nodes.length=nodeCount;(clip._publicClipDatas=[]).length=nodeCount;for(var nodesMap=clip._nodesMap={},cachePropertyToNodeIndex=0,unCachePropertyToNodeIndex=0,i=0;i<nodeCount;i++){var node=nodes[i]=new KeyframeNode,pathLength=reader.getUint16(),path=node.path=[];for(path.length=pathLength,j=0;j<pathLength;j++)path[j]=AnimationClipParser02._strings[reader.getUint16()];var nodePath=path.join("/"),mapArray=nodesMap[nodePath],nodePath=(mapArray||(nodesMap[nodePath]=mapArray=[]),mapArray.push(node),reader.getInt16()),mapArray=(-1!==nodePath&&(node.componentType=AnimationClipParser02._strings[nodePath]),AnimationNode._propertyIndexDic[AnimationClipParser02._strings[reader.getUint16()]]);if(null==mapArray)throw new Error("AnimationClipParser02:unknown property name.");for(var nodePath=mapArray<4,nodePath=!nodePath||""===path[0],dataLength=((node._cacheProperty=nodePath)?cachePropertyToNodeIndex++:unCachePropertyToNodeIndex++,node.propertyNameID=mapArray,lengthTypes[reader.getUint8()]),keyFrames=(node.keyFrameWidth=dataLength/4,node.keyFrames=[]),keyframeCount=keyFrames.length=reader.getUint16(),lastKeyFrame=null,startTime=NaN,j=0;j<keyframeCount;j++){var keyFrame=keyFrames[j]=new Keyframe,startTime=keyFrame.startTime=startTimeTypes[reader.getUint16()],offset=reader.pos;keyFrame.inTangent=new Float32Array(buffer.slice(offset,offset+dataLength)),reader.pos+=dataLength,offset=reader.pos,keyFrame.outTangent=new Float32Array(buffer.slice(offset,offset+dataLength)),reader.pos+=dataLength,offset=reader.pos,keyFrame.data=new Float32Array(buffer.slice(offset,offset+dataLength)),reader.pos+=dataLength,lastKeyFrame&&(lastKeyFrame.next=keyFrame,lastKeyFrame.duration=startTime-lastKeyFrame.startTime),lastKeyFrame=keyFrame}keyFrame.next=null,keyFrame.duration=clipDur-startTime}var eventCount=reader.getUint16();for(i=0;i<eventCount;i++){var params,event=new AnimationEvent,paramCount=(event.time=reader.getFloat32(),event.eventName=AnimationClipParser02._strings[reader.getUint16()],reader.getUint16());for(0<paramCount&&(event.params=params=[]),j=0;j<paramCount;j++)switch(reader.getByte()){case 0:params.push(!!reader.getByte());break;case 1:params.push(reader.getInt32());break;case 2:params.push(reader.getFloat32());break;case 3:params.push(AnimationClipParser02._strings[reader.getUint16()]);break;default:throw new Error("unknown type.")}clip.addEvent(event)}var nodeToCachePropertyMap=clip._nodeToCachePropertyMap=new Int32Array(nodeCount),cachePropertyToNodeMap=clip._cachePropertyMap=new Int32Array(cachePropertyToNodeIndex),unCachePropertyToNodeMap=clip._unCachePropertyMap=new Int32Array(unCachePropertyToNodeIndex),cachePropertyToNodeIndex=unCachePropertyToNodeIndex=0;for(i=0;i<nodeCount;i++)(node=nodes[i])._cacheProperty?(nodeToCachePropertyMap[i]=cachePropertyToNodeIndex,cachePropertyToNodeMap[cachePropertyToNodeIndex++]=i):unCachePropertyToNodeMap[unCachePropertyToNodeIndex++]=i},AnimationClipParser02._animationClip=null,AnimationClipParser02._reader=null,AnimationClipParser02._strings=[],__static(AnimationClipParser02,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}(),function(){function AnimationEvent(){this.time=NaN,this.eventName=null,this.params=null}return __class(AnimationEvent,"laya.d3.animation.AnimationEvent"),AnimationEvent}()),AnimationNode=function(){function AnimationNode(){this._childs=[],this.transform=new AnimationTransform3D(this)}__class(AnimationNode,"laya.d3.animation.AnimationNode");var __proto=AnimationNode.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.addChild=function(child){child._parent=this,child.transform.setParent(this.transform),this._childs.push(child)},__proto.removeChild=function(child){child=this._childs.indexOf(child);-1!==child&&this._childs.splice(child,1)},__proto.getChildByName=function(name){for(var i=0,n=this._childs.length;i<n;i++){var child=this._childs[i];if(child.name===name)return child}return null},__proto.getChildByIndex=function(index){return this._childs[index]},__proto.getChildCount=function(){return this._childs.length},__proto.cloneTo=function(destObject){var destNode=destObject;destNode.name=this.name;for(var i=0,n=this._childs.length;i<n;i++){var child=this._childs[i],destChild=child.clone(),child=(destNode.addChild(destChild),child.transform),destChild=destChild.transform;destChild.setLocalPosition(child.getLocalPosition()),destChild.setLocalRotation(child.getLocalRotation()),destChild.setLocalScale(child.getLocalScale()),destChild._localRotationEuler=child._localRotationEuler,destChild._setWorldMatrixIgnoreUpdate(child.getWorldMatrix())}},__proto.clone=function(){var dest=new this.constructor;return this.cloneTo(dest),dest},AnimationNode.__init__=function(){AnimationNode.registerAnimationNodeProperty("localPosition",AnimationNode._getLocalPosition,AnimationNode._setLocalPosition),AnimationNode.registerAnimationNodeProperty("localRotation",AnimationNode._getLocalRotation,AnimationNode._setLocalRotation),AnimationNode.registerAnimationNodeProperty("localScale",AnimationNode._getLocalScale,AnimationNode._setLocalScale),AnimationNode.registerAnimationNodeProperty("localRotationEuler",AnimationNode._getLocalRotationEuler,AnimationNode._setLocalRotationEuler),AnimationNode.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",AnimationNode._getParticleRenderSharedMaterialTintColor,AnimationNode._setParticleRenderSharedMaterialTintColor),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",AnimationNode._getMeshRenderSharedMaterialTilingOffset,AnimationNode._setMeshRenderSharedMaterialTilingOffset),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",AnimationNode._getMeshRenderSharedMaterialAlbedo,AnimationNode._setMeshRenderSharedMaterialAlbedo),AnimationNode.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",AnimationNode._getSkinnedMeshRenderSharedMaterialTilingOffset,AnimationNode._setSkinnedMeshRenderSharedMaterialTilingOffset),AnimationNode.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",AnimationNode._getSkinnedMeshRenderSharedMaterialAlbedo,AnimationNode._setSkinnedMeshRenderSharedMaterialAlbedo),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",AnimationNode._getMeshRenderSharedMaterialAlbedo,AnimationNode._setMeshRenderSharedMaterialAlbedo),AnimationNode.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",AnimationNode._getSkinnedMeshRenderSharedMaterialAlbedo,AnimationNode._setSkinnedMeshRenderSharedMaterialAlbedo),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",AnimationNode._getMeshRenderSharedMaterialIntensity,AnimationNode._setMeshRenderSharedMaterialIntensity),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",AnimationNode._getMeshRenderSharedMaterialAlpha,AnimationNode._setMeshRenderSharedMaterialAlpha),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",AnimationNode._getMeshRenderSharedMaterialAlphaColor,AnimationNode._setMeshRenderSharedMaterialAlphaColor),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",AnimationNode._getMeshRenderSharedMaterialBaseColor,AnimationNode._setMeshRenderSharedMaterialBaseColor),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",AnimationNode._getMeshRenderSharedMaterialDissolve,AnimationNode._setMeshRenderSharedMaterialDissolve),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",AnimationNode._getMeshRenderSharedMaterialDissolveSpeed,AnimationNode._setMeshRenderSharedMaterialDissolveSpeed),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",AnimationNode._getMeshRenderSharedMaterialMMultiplier,AnimationNode._setMeshRenderSharedMaterialMMultiplier),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",AnimationNode._getMeshRenderSharedMaterialBaseScrollSpeedX,AnimationNode._setMeshRenderSharedMaterialBaseScrollSpeedX),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",AnimationNode._getMeshRenderSharedMaterialBaseScrollSpeedY,AnimationNode._setMeshRenderSharedMaterialBaseScrollSpeedY),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",AnimationNode._getMeshRenderSharedMaterialSecondScrollSpeedX,AnimationNode._setMeshRenderSharedMaterialSecondScrollSpeedX),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",AnimationNode._getMeshRenderSharedMaterialSecondScrollSpeedY,AnimationNode._setMeshRenderSharedMaterialSecondScrollSpeedY),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",AnimationNode._getMeshRenderSharedMaterialDetailTilingOffset,AnimationNode._setMeshRenderSharedMaterialDetailTilingOffset),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",AnimationNode._getMeshRenderSharedMaterialDissolveTilingOffset,AnimationNode._setMeshRenderSharedMaterialDissolveTilingOffset),AnimationNode.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",AnimationNode._getMeshRenderSharedMaterialMaskTilingOffset,AnimationNode._setMeshRenderSharedMaterialMaskTilingOffset)},AnimationNode.registerAnimationNodeProperty=function(propertyName,getFunc,setFunc){if(AnimationNode._propertyIndexDic[propertyName])throw new Error("AnimationNode: this propertyName has registered.");AnimationNode._propertyIndexDic[propertyName]=AnimationNode._propertyIDCounter,AnimationNode._propertyGetFuncs[AnimationNode._propertyIDCounter]=getFunc,AnimationNode._propertySetFuncs[AnimationNode._propertyIDCounter]=setFunc,AnimationNode._propertyIDCounter++},AnimationNode._getLocalPosition=function(animationNode,sprite3D){return animationNode?animationNode.transform.getLocalPosition():sprite3D._transform.localPosition.elements},AnimationNode._setLocalPosition=function(animationNode,sprite3D,value){animationNode?animationNode.transform.setLocalPosition(value):((sprite3D=(animationNode=sprite3D._transform).localPosition).elements=value,animationNode.localPosition=sprite3D)},AnimationNode._getLocalRotation=function(animationNode,sprite3D){return animationNode?animationNode.transform.getLocalRotation():sprite3D._transform.localRotation.elements},AnimationNode._setLocalRotation=function(animationNode,sprite3D,value){animationNode?animationNode.transform.setLocalRotation(value):((sprite3D=(animationNode=sprite3D._transform).localRotation).elements=value,animationNode.localRotation=sprite3D)},AnimationNode._getLocalScale=function(animationNode,sprite3D){return animationNode?animationNode.transform.getLocalScale():sprite3D._transform.localScale.elements},AnimationNode._setLocalScale=function(animationNode,sprite3D,value){animationNode?animationNode.transform.setLocalScale(value):((sprite3D=(animationNode=sprite3D._transform).localScale).elements=value,animationNode.localScale=sprite3D)},AnimationNode._getLocalRotationEuler=function(animationNode,sprite3D){return animationNode?animationNode.transform.getLocalRotationEuler():sprite3D._transform.localRotationEuler.elements},AnimationNode._setLocalRotationEuler=function(animationNode,sprite3D,value){animationNode?animationNode.transform.setLocalRotationEuler(value):((sprite3D=(animationNode=sprite3D._transform).localRotationEuler).elements=value,animationNode.localRotationEuler=sprite3D)},AnimationNode._getMeshRenderSharedMaterialTilingOffset=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.tilingOffset.elements:null:sprite3D.meshRender.sharedMaterial.tilingOffset.elements},AnimationNode._setMeshRenderSharedMaterialTilingOffset=function(animationNode,sprite3D,value){var material,tilingOffset;animationNode?(animationNode=animationNode.transform._entity)&&((tilingOffset=(material=animationNode.owner.meshRender.material).tilingOffset).elements=value,material.tilingOffset=tilingOffset):((tilingOffset=(material=sprite3D.meshRender.material).tilingOffset).elements=value,material.tilingOffset=tilingOffset)},AnimationNode._getMeshRenderSharedMaterialAlbedo=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.albedoColor.elements:null:sprite3D.meshRender.sharedMaterial.albedoColor.elements},AnimationNode._setMeshRenderSharedMaterialAlbedo=function(animationNode,sprite3D,value){var material,albedo;animationNode?(animationNode=animationNode.transform._entity)&&((albedo=(material=animationNode.owner.meshRender.material).albedoColor).elements=value,material.albedoColor=albedo):((albedo=(material=sprite3D.meshRender.material).albedoColor).elements=value,material.albedoColor=albedo)},AnimationNode._getSkinnedMeshRenderSharedMaterialTilingOffset=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null:sprite3D.skinnedMeshRender.sharedMaterial.tilingOffset.elements},AnimationNode._setSkinnedMeshRenderSharedMaterialTilingOffset=function(animationNode,sprite3D,value){var material,tilingOffset;animationNode?(animationNode=animationNode.transform._entity)&&((tilingOffset=(material=animationNode.owner.skinnedMeshRender.material).tilingOffset).elements=value,material.tilingOffset=tilingOffset):((tilingOffset=(material=sprite3D.skinnedMeshRender.material).tilingOffset).elements=value,material.tilingOffset=tilingOffset)},AnimationNode._getSkinnedMeshRenderSharedMaterialAlbedo=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null:sprite3D.skinnedMeshRender.sharedMaterial.albedoColor.elements},AnimationNode._setSkinnedMeshRenderSharedMaterialAlbedo=function(animationNode,sprite3D,value){var material,albedo;animationNode?(animationNode=animationNode.transform._entity)&&((albedo=(material=animationNode.owner.skinnedMeshRender.material).albedoColor).elements=value,material.albedoColor=albedo):((albedo=(material=sprite3D.skinnedMeshRender.material).albedoColor).elements=value,material.albedoColor=albedo)},AnimationNode._getParticleRenderSharedMaterialTintColor=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.particleRender.sharedMaterial.tintColor.elements:null:sprite3D.particleRender.sharedMaterial.tintColor.elements},AnimationNode._setParticleRenderSharedMaterialTintColor=function(animationNode,sprite3D,value){var material,tintColor;animationNode?(animationNode=animationNode.transform._entity)&&((tintColor=(material=animationNode.owner.particleRender.material).tintColor).elements=value,material.tintColor=tintColor):((tintColor=(material=sprite3D.particleRender.material).tintColor).elements=value,material.tintColor=tintColor)},AnimationNode._getMeshRenderSharedMaterialAlphaColor=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.alphaColor.elements:null:sprite3D.meshRender.sharedMaterial.alphaColor.elements},AnimationNode._setMeshRenderSharedMaterialAlphaColor=function(animationNode,sprite3D,value){var material,alphaColor;animationNode?(animationNode=animationNode.transform._entity)&&((alphaColor=(material=animationNode.owner.meshRender.material).alphaColor).elements=value,material.alphaColor=alphaColor):((alphaColor=(material=sprite3D.meshRender.material).alphaColor).elements=value,material.alphaColor=alphaColor)},AnimationNode._getMeshRenderSharedMaterialBaseColor=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.baseColor.elements:null:sprite3D.meshRender.sharedMaterial.baseColor.elements},AnimationNode._setMeshRenderSharedMaterialBaseColor=function(animationNode,sprite3D,value){var material,baseColor;animationNode?(animationNode=animationNode.transform._entity)&&((baseColor=(material=animationNode.owner.meshRender.material).baseColor).elements=value,material.baseColor=baseColor):((baseColor=(material=sprite3D.meshRender.material).baseColor).elements=value,material.baseColor=baseColor)},AnimationNode._getMeshRenderSharedMaterialDissolve=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.dissolve:0:sprite3D.meshRender.sharedMaterial.dissolve},AnimationNode._setMeshRenderSharedMaterialDissolve=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.dissolve=value[0]):sprite3D.meshRender.material.dissolve=value[0]},AnimationNode._getMeshRenderSharedMaterialDissolveSpeed=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.dissolveSpeed:0:sprite3D.meshRender.sharedMaterial.dissolveSpeed},AnimationNode._setMeshRenderSharedMaterialDissolveSpeed=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.dissolveSpeed=value[0]):sprite3D.meshRender.material.dissolveSpeed=value[0]},AnimationNode._getMeshRenderSharedMaterialMMultiplier=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.mMultiplier:0:sprite3D.meshRender.sharedMaterial.mMultiplier},AnimationNode._setMeshRenderSharedMaterialMMultiplier=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.mMultiplier=value[0]):sprite3D.meshRender.material.mMultiplier=value[0]},AnimationNode._getMeshRenderSharedMaterialBaseScrollSpeedX=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.baseScrollSpeedX:0:sprite3D.meshRender.sharedMaterial.baseScrollSpeedX},AnimationNode._setMeshRenderSharedMaterialBaseScrollSpeedX=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.baseScrollSpeedX=value[0]):sprite3D.meshRender.material.baseScrollSpeedX=value[0]},AnimationNode._getMeshRenderSharedMaterialBaseScrollSpeedY=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.baseScrollSpeedY:0:sprite3D.meshRender.sharedMaterial.baseScrollSpeedY},AnimationNode._setMeshRenderSharedMaterialBaseScrollSpeedY=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.baseScrollSpeedY=value[0]):sprite3D.meshRender.material.baseScrollSpeedY=value[0]},AnimationNode._getMeshRenderSharedMaterialSecondScrollSpeedX=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.secondScrollSpeedX:0:sprite3D.meshRender.sharedMaterial.secondScrollSpeedX},AnimationNode._setMeshRenderSharedMaterialSecondScrollSpeedX=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.secondScrollSpeedX=value[0]):sprite3D.meshRender.material.secondScrollSpeedX=value[0]},AnimationNode._getMeshRenderSharedMaterialSecondScrollSpeedY=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.secondScrollSpeedY:0:sprite3D.meshRender.sharedMaterial.secondScrollSpeedY},AnimationNode._setMeshRenderSharedMaterialSecondScrollSpeedY=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.secondScrollSpeedY=value[0]):sprite3D.meshRender.material.secondScrollSpeedY=value[0]},AnimationNode._getMeshRenderSharedMaterialAlpha=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.alpha:0:sprite3D.meshRender.sharedMaterial.alpha},AnimationNode._setMeshRenderSharedMaterialAlpha=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.alpha=value[0]):sprite3D.meshRender.material.alpha=value[0]},AnimationNode._getMeshRenderSharedMaterialIntensity=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.intensity:0:sprite3D.meshRender.sharedMaterial.intensity},AnimationNode._setMeshRenderSharedMaterialIntensity=function(animationNode,sprite3D,value){animationNode?(animationNode=animationNode.transform._entity)&&(animationNode.owner.meshRender.material.intensity=value[0]):sprite3D.meshRender.material.intensity=value[0]},AnimationNode._getMeshRenderSharedMaterialDetailTilingOffset=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null:sprite3D.meshRender.sharedMaterial.detailTilingOffset.elements},AnimationNode._setMeshRenderSharedMaterialDetailTilingOffset=function(animationNode,sprite3D,value){var material,detailTilingOffset;animationNode?(animationNode=animationNode.transform._entity)&&((detailTilingOffset=(material=animationNode.owner.meshRender.material).detailTilingOffset).elements=value,material.detailTilingOffset=detailTilingOffset):((detailTilingOffset=(material=sprite3D.meshRender.material).detailTilingOffset).elements=value,material.detailTilingOffset=detailTilingOffset)},AnimationNode._getMeshRenderSharedMaterialDissolveTilingOffset=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null:sprite3D.meshRender.sharedMaterial.dissolveTilingOffset.elements},AnimationNode._setMeshRenderSharedMaterialDissolveTilingOffset=function(animationNode,sprite3D,value){var material,dissolveTilingOffset;animationNode?(animationNode=animationNode.transform._entity)&&((dissolveTilingOffset=(material=animationNode.owner.meshRender.material).dissolveTilingOffset).elements=value,material.dissolveTilingOffset=dissolveTilingOffset):((dissolveTilingOffset=(material=sprite3D.meshRender.material).dissolveTilingOffset).elements=value,material.dissolveTilingOffset=dissolveTilingOffset)},AnimationNode._getMeshRenderSharedMaterialMaskTilingOffset=function(animationNode,sprite3D){return animationNode?(animationNode=animationNode.transform._entity)?animationNode.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null:sprite3D.meshRender.sharedMaterial.maskTilingOffset.elements},AnimationNode._setMeshRenderSharedMaterialMaskTilingOffset=function(animationNode,sprite3D,value){var material,maskTilingOffset;animationNode?(animationNode=animationNode.transform._entity)&&((maskTilingOffset=(material=animationNode.owner.meshRender.material).maskTilingOffset).elements=value,material.maskTilingOffset=maskTilingOffset):((maskTilingOffset=(material=sprite3D.meshRender.material).maskTilingOffset).elements=value,material.maskTilingOffset=maskTilingOffset)},AnimationNode._propertyIDCounter=0,AnimationNode._propertyIndexDic={},AnimationNode._propertySetFuncs=[],AnimationNode._propertyGetFuncs=[],AnimationNode}(),Keyframe=function(){function Keyframe(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return __class(Keyframe,"laya.d3.animation.Keyframe"),Keyframe}(),KeyframeNode=function(){function KeyframeNode(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return __class(KeyframeNode,"laya.d3.animation.KeyframeNode"),KeyframeNode}(),Layer=(function(){function SplineCurvePositionVelocity(){this._tempVector30=new Vector3,this._tempVector31=new Vector3,this._tempVector32=new Vector3,this._a=new Vector3,this._b=new Vector3,this._c=new Vector3,this._d=new Vector3}__class(SplineCurvePositionVelocity,"laya.d3.core.glitter.SplineCurvePositionVelocity");var __proto=SplineCurvePositionVelocity.prototype;__proto.Init=function(position0,velocity0,position1,velocity1){position0.cloneTo(this._d),velocity0.cloneTo(this._c),Vector3.scale(position0,2,this._a),Vector3.scale(position1,2,this._tempVector30),Vector3.subtract(this._a,this._tempVector30,this._a),Vector3.add(this._a,velocity0,this._a),Vector3.add(this._a,velocity1,this._a),Vector3.scale(position1,3,this._b),Vector3.scale(position0,3,this._tempVector30),Vector3.subtract(this._b,this._tempVector30,this._b),Vector3.subtract(this._b,velocity1,this._b),Vector3.scale(velocity0,2,this._tempVector30),Vector3.subtract(this._b,this._tempVector30,this._b)},__proto.Slerp=function(t,out){Vector3.scale(this._a,t*t*t,this._tempVector30),Vector3.scale(this._b,t*t,this._tempVector31),Vector3.scale(this._c,t,this._tempVector32),Vector3.add(this._tempVector30,this._tempVector31,out),Vector3.add(out,this._tempVector32,out),Vector3.add(out,this._d,out)}}(),function(){function HeightMap(width,height,minHeight,maxHeight){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=width,this._h=height,this._minHeight=minHeight,this._maxHeight=maxHeight}__class(HeightMap,"laya.d3.core.HeightMap");var __proto=HeightMap.prototype;__proto._inBounds=function(row,col){return 0<=row&&row<this._h&&0<=col&&col<this._w},__proto.getHeight=function(row,col){return this._inBounds(row,col)?this._datas[row][col]:NaN},__getset(0,__proto,"width",function(){return this._w}),__getset(0,__proto,"height",function(){return this._h}),__getset(0,__proto,"maxHeight",function(){return this._maxHeight}),__getset(0,__proto,"minHeight",function(){return this._minHeight}),HeightMap.creatFromMesh=function(mesh,width,height,outCellSize){for(var vertices=[],indexs=[],submesheCount=mesh.getSubMeshCount(),i=0;i<submesheCount;i++){for(var subMesh=mesh.getSubMesh(i),vertexBuffer=subMesh._getVertexBuffer(),verts=vertexBuffer.getData(),subMeshVertices=[],j=0;j<verts.length;j+=vertexBuffer.vertexDeclaration.vertexStride/4){var position=new Vector3(verts[j+0],verts[j+1],verts[j+2]);subMeshVertices.push(position)}vertices.push(subMeshVertices);subMesh=subMesh._getIndexBuffer();indexs.push(subMesh.getData())}var boundingBox=mesh.boundingBox,minX=boundingBox.min.x,minZ=boundingBox.min.z,maxX=boundingBox.max.x,maxZ=boundingBox.max.z,minY=boundingBox.min.y,boundingBox=boundingBox.max.y,maxZ=maxZ-minZ,cellWidth=outCellSize.elements[0]=(maxX-minX)/(width-1),cellHeight=outCellSize.elements[1]=maxZ/(height-1),heightMap=new HeightMap(width,height,minY,boundingBox),ray=HeightMap._tempRay,maxX=ray.direction.elements,rayY=(maxX[0]=0,maxX[1]=-1,maxX[2]=0,boundingBox+.1);ray.origin.elements[1]=rayY;for(var h=0;h<height;h++){var posZ=minZ+h*cellHeight;heightMap._datas[h]=[];for(var w=0;w<width;w++){var rayOriE=ray.origin.elements,rayOriE=(rayOriE[0]=minX+w*cellWidth,rayOriE[2]=posZ,HeightMap._getPosition(ray,vertices,indexs));heightMap._datas[h][w]=rayOriE===Number.MAX_VALUE?NaN:rayY-rayOriE}}return heightMap},HeightMap.createFromImage=function(texture,minHeight,maxHeight){for(var textureWidth=texture.width,textureHeight=texture.height,heightMap=new HeightMap(textureWidth,textureHeight,minHeight,maxHeight),compressionRatio=(maxHeight-minHeight)/254,pixelsInfo=texture.getPixels(),index=0,h=0;h<textureHeight;h++)for(var colDatas=heightMap._datas[h]=[],w=0;w<textureWidth;w++){var r=pixelsInfo[index++],g=pixelsInfo[index++],b=pixelsInfo[index++],a=pixelsInfo[index++];colDatas[w]=255==r&&255==g&&255==b&&255==a?NaN:(r+g+b)/3*compressionRatio+minHeight}return heightMap},HeightMap._getPosition=function(ray,vertices,indexs){for(var closestIntersection=Number.MAX_VALUE,i=0;i<vertices.length;i++)for(var subMeshVertices=vertices[i],subMeshIndexes=indexs[i],j=0;j<subMeshIndexes.length;j+=3){var vertex1=subMeshVertices[subMeshIndexes[j+0]],vertex2=subMeshVertices[subMeshIndexes[j+1]],vertex3=subMeshVertices[subMeshIndexes[j+2]],vertex1=Picker.rayIntersectsTriangle(ray,vertex1,vertex2,vertex3);!isNaN(vertex1)&&vertex1<closestIntersection&&(closestIntersection=vertex1)}return closestIntersection},__static(HeightMap,["_tempRay",function(){return this._tempRay=new Ray(new Vector3,new Vector3)}])}(),function(){function Layer(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}__class(Layer,"laya.d3.core.Layer");var __proto=Layer.prototype;return __proto._binarySearchIndex=function(){for(var start=0,end=Layer._collsionTestList.length-1;start<=end;){var mid=Math.floor((start+end)/2),midValue=Layer._collsionTestList[mid];if(midValue==this._number)return mid;midValue>this._number?end=mid-1:start=mid+1}return start},__proto._addCollider=function(collider){0===this._colliders.length&&Layer._collsionTestList.splice(this._binarySearchIndex(),0,this._number),collider._isRigidbody?(this._colliders.unshift(collider),this._nonRigidbodyOffset++):this._colliders.push(collider)},__proto._removeCollider=function(collider){collider=this._colliders.indexOf(collider);collider<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(collider,1),0===this._colliders.length&&Layer._collsionTestList.splice(Layer._collsionTestList.indexOf(this._number),1)},__getset(0,__proto,"number",function(){return this._number}),__getset(0,__proto,"visible",function(){return this._visible},function(value){this._visible=value,Layer._visibleLayers=value?Layer._visibleLayers|this.mask:Layer._visibleLayers&~this.mask}),__getset(0,__proto,"mask",function(){return this._mask}),__getset(1,Layer,"visibleLayers",function(){return Layer._visibleLayers},function(value){Layer._visibleLayers=value;for(var i=0,n=Layer._layerList.length;i<n;i++){var layer=Layer._layerList[i];layer._visible=0!=(layer._mask&Layer._visibleLayers)}}),Layer.__init__=function(){Layer._layerList.length=31;for(var i=0;i<31;i++){var layer=new Layer;Layer._layerList[i]=layer,0===i?(layer.name="Default Layer",layer.visible=!0):(layer.name="Layer-"+i,layer.visible=!1),layer._number=i,layer._mask=Math.pow(2,i)}Layer.currentCreationLayer=Layer._layerList[0]},Layer.getLayerByNumber=function(number){if(number<0||30<number)throw new Error("无法返回指定Layer，该number超出范围！");return Layer._layerList[number]},Layer.getLayerByName=function(name){for(var i=0;i<31;i++)if(Layer._layerList[i].name===name)return Layer._layerList[i];throw new Error("无法返回指定Layer,该name不存在")},Layer.isVisible=function(mask){return 0!=(mask&Layer._currentCameraCullingMask&Layer._visibleLayers)},Layer._layerList=[],Layer._visibleLayers=2147483647,Layer._collsionTestList=[],Layer._currentCameraCullingMask=2147483647,Layer.maxCount=31,Layer.currentCreationLayer=null,Layer}()),FrameOverTime=(function(){function Burst(time,minCount,maxCount){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=time,this._minCount=minCount,this._maxCount=maxCount}__class(Burst,"laya.d3.core.particleShuriKen.module.Burst");var __proto=Burst.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){destObject._time=this._time,destObject._minCount=this._minCount,destObject._maxCount=this._maxCount},__proto.clone=function(){var destBurst=new this.constructor;return this.cloneTo(destBurst),destBurst},__getset(0,__proto,"time",function(){return this._time}),__getset(0,__proto,"minCount",function(){return this._minCount}),__getset(0,__proto,"maxCount",function(){return this._maxCount})}(),function(){function ColorOverLifetime(color){this._color=null,this.enbale=!1,this._color=color}__class(ColorOverLifetime,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var __proto=ColorOverLifetime.prototype;__proto.cloneTo=function(destObject){this._color.cloneTo(destObject._color),destObject.enbale=this.enbale},__proto.clone=function(){var destColor;switch(this._color.type){case 0:destColor=GradientColor.createByConstant(this._color.constant.clone());break;case 1:destColor=GradientColor.createByGradient(this._color.gradient.clone());break;case 2:destColor=GradientColor.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:destColor=GradientColor.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var destColorOverLifetime=new this.constructor(destColor);return destColorOverLifetime.enbale=this.enbale,destColorOverLifetime},__getset(0,__proto,"color",function(){return this._color})}(),function(){function Emission(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}__class(Emission,"laya.d3.core.particleShuriKen.module.Emission");var __proto=Emission.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),__proto._destroy=function(){this._bursts=null,this._destroyed=!0},__proto.getBurstsCount=function(){return this._bursts.length},__proto.getBurstByIndex=function(index){return this._bursts[index]},__proto.addBurst=function(burst){var burstsCount=this._bursts.length;if(0<burstsCount)for(var i=0;i<burstsCount;i++)this._bursts[i].time>burst.time&&this._bursts.splice(i,0,burst);this._bursts.push(burst)},__proto.removeBurst=function(burst){burst=this._bursts.indexOf(burst);-1!==burst&&this._bursts.splice(burst,1)},__proto.removeBurstByIndex=function(index){this._bursts.splice(index,1)},__proto.clearBurst=function(){this._bursts.length=0},__proto.cloneTo=function(destObject){var destBursts=destObject._bursts;destBursts.length=this._bursts.length;for(var i=0,n=this._bursts.length;i<n;i++){var destBurst=destBursts[i];destBurst?this._bursts[i].cloneTo(destBurst):destBursts[i]=this._bursts[i].clone()}destObject._emissionRate=this._emissionRate,destObject.enbale=this.enbale},__proto.clone=function(){var destEmission=new this.constructor;return this.cloneTo(destEmission),destEmission},__getset(0,__proto,"destroyed",function(){return this._destroyed}),__getset(0,__proto,"emissionRate",function(){return this._emissionRate},function(value){if(value<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=value})}(),function(){function FrameOverTime(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}__class(FrameOverTime,"laya.d3.core.particleShuriKen.module.FrameOverTime");var __proto=FrameOverTime.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){destObject._type=this._type,destObject._constant=this._constant,this._overTime.cloneTo(destObject._overTime),destObject._constantMin=this._constantMin,destObject._constantMax=this._constantMax,this._overTimeMin.cloneTo(destObject._overTimeMin),this._overTimeMax.cloneTo(destObject._overTimeMax)},__proto.clone=function(){var destFrameOverTime=new this.constructor;return this.cloneTo(destFrameOverTime),destFrameOverTime},__getset(0,__proto,"frameOverTimeData",function(){return this._overTime}),__getset(0,__proto,"constant",function(){return this._constant}),__getset(0,__proto,"type",function(){return this._type}),__getset(0,__proto,"frameOverTimeDataMin",function(){return this._overTimeMin}),__getset(0,__proto,"constantMin",function(){return this._constantMin}),__getset(0,__proto,"frameOverTimeDataMax",function(){return this._overTimeMax}),__getset(0,__proto,"constantMax",function(){return this._constantMax}),FrameOverTime.createByConstant=function(constant){var rotationOverLifetime=new FrameOverTime;return rotationOverLifetime._type=0,rotationOverLifetime._constant=constant,rotationOverLifetime},FrameOverTime.createByOverTime=function(overTime){var rotationOverLifetime=new FrameOverTime;return rotationOverLifetime._type=1,rotationOverLifetime._overTime=overTime,rotationOverLifetime},FrameOverTime.createByRandomTwoConstant=function(constantMin,constantMax){var rotationOverLifetime=new FrameOverTime;return rotationOverLifetime._type=2,rotationOverLifetime._constantMin=constantMin,rotationOverLifetime._constantMax=constantMax,rotationOverLifetime},FrameOverTime.createByRandomTwoOverTime=function(gradientFrameMin,gradientFrameMax){var rotationOverLifetime=new FrameOverTime;return rotationOverLifetime._type=3,rotationOverLifetime._overTimeMin=gradientFrameMin,rotationOverLifetime._overTimeMax=gradientFrameMax,rotationOverLifetime},FrameOverTime}()),GradientAngularVelocity=function(){function GradientAngularVelocity(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}__class(GradientAngularVelocity,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var __proto=GradientAngularVelocity.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){destObject._type=this._type,destObject._separateAxes=this._separateAxes,destObject._constant=this._constant,this._constantSeparate.cloneTo(destObject._constantSeparate),this._gradient.cloneTo(destObject._gradient),this._gradientX.cloneTo(destObject._gradientX),this._gradientY.cloneTo(destObject._gradientY),this._gradientZ.cloneTo(destObject._gradientZ),destObject._constantMin=this._constantMin,destObject._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(destObject._constantMinSeparate),this._constantMaxSeparate.cloneTo(destObject._constantMaxSeparate),this._gradientMin.cloneTo(destObject._gradientMin),this._gradientMax.cloneTo(destObject._gradientMax),this._gradientXMin.cloneTo(destObject._gradientXMin),this._gradientXMax.cloneTo(destObject._gradientXMax),this._gradientYMin.cloneTo(destObject._gradientYMin),this._gradientYMax.cloneTo(destObject._gradientYMax),this._gradientZMin.cloneTo(destObject._gradientZMin),this._gradientZMax.cloneTo(destObject._gradientZMax)},__proto.clone=function(){var destGradientAngularVelocity=new this.constructor;return this.cloneTo(destGradientAngularVelocity),destGradientAngularVelocity},__getset(0,__proto,"gradientZ",function(){return this._gradientZ}),__getset(0,__proto,"constant",function(){return this._constant}),__getset(0,__proto,"gradient",function(){return this._gradient}),__getset(0,__proto,"separateAxes",function(){return this._separateAxes}),__getset(0,__proto,"type",function(){return this._type}),__getset(0,__proto,"constantSeparate",function(){return this._constantSeparate}),__getset(0,__proto,"gradientX",function(){return this._gradientX}),__getset(0,__proto,"gradientY",function(){return this._gradientY}),__getset(0,__proto,"gradientW",function(){return this._gradientW}),__getset(0,__proto,"gradientMin",function(){return this._gradientMin}),__getset(0,__proto,"constantMin",function(){return this._constantMin}),__getset(0,__proto,"gradientMax",function(){return this._gradientMax}),__getset(0,__proto,"constantMax",function(){return this._constantMax}),__getset(0,__proto,"gradientWMin",function(){return this._gradientWMin}),__getset(0,__proto,"constantMinSeparate",function(){return this._constantMinSeparate}),__getset(0,__proto,"constantMaxSeparate",function(){return this._constantMaxSeparate}),__getset(0,__proto,"gradientXMin",function(){return this._gradientXMin}),__getset(0,__proto,"gradientXMax",function(){return this._gradientXMax}),__getset(0,__proto,"gradientWMax",function(){return this._gradientWMax}),__getset(0,__proto,"gradientYMin",function(){return this._gradientYMin}),__getset(0,__proto,"gradientYMax",function(){return this._gradientYMax}),__getset(0,__proto,"gradientZMin",function(){return this._gradientZMin}),__getset(0,__proto,"gradientZMax",function(){return this._gradientZMax}),GradientAngularVelocity.createByConstant=function(constant){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=0,gradientAngularVelocity._separateAxes=!1,gradientAngularVelocity._constant=constant,gradientAngularVelocity},GradientAngularVelocity.createByConstantSeparate=function(separateConstant){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=0,gradientAngularVelocity._separateAxes=!0,gradientAngularVelocity._constantSeparate=separateConstant,gradientAngularVelocity},GradientAngularVelocity.createByGradient=function(gradient){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=1,gradientAngularVelocity._separateAxes=!1,gradientAngularVelocity._gradient=gradient,gradientAngularVelocity},GradientAngularVelocity.createByGradientSeparate=function(gradientX,gradientY,gradientZ,gradientW){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=1,gradientAngularVelocity._separateAxes=!0,gradientAngularVelocity._gradientX=gradientX,gradientAngularVelocity._gradientY=gradientY,gradientAngularVelocity._gradientZ=gradientZ,gradientAngularVelocity._gradientW=gradientW,gradientAngularVelocity},GradientAngularVelocity.createByRandomTwoConstant=function(constantMin,constantMax){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=2,gradientAngularVelocity._separateAxes=!1,gradientAngularVelocity._constantMin=constantMin,gradientAngularVelocity._constantMax=constantMax,gradientAngularVelocity},GradientAngularVelocity.createByRandomTwoConstantSeparate=function(separateConstantMin,separateConstantMax){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=2,gradientAngularVelocity._separateAxes=!0,gradientAngularVelocity._constantMinSeparate=separateConstantMin,gradientAngularVelocity._constantMaxSeparate=separateConstantMax,gradientAngularVelocity},GradientAngularVelocity.createByRandomTwoGradient=function(gradientMin,gradientMax){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=3,gradientAngularVelocity._separateAxes=!1,gradientAngularVelocity._gradientMin=gradientMin,gradientAngularVelocity._gradientMax=gradientMax,gradientAngularVelocity},GradientAngularVelocity.createByRandomTwoGradientSeparate=function(gradientXMin,gradientXMax,gradientYMin,gradientYMax,gradientZMin,gradientZMax,gradientWMin,gradientWMax){var gradientAngularVelocity=new GradientAngularVelocity;return gradientAngularVelocity._type=3,gradientAngularVelocity._separateAxes=!0,gradientAngularVelocity._gradientXMin=gradientXMin,gradientAngularVelocity._gradientXMax=gradientXMax,gradientAngularVelocity._gradientYMin=gradientYMin,gradientAngularVelocity._gradientYMax=gradientYMax,gradientAngularVelocity._gradientZMin=gradientZMin,gradientAngularVelocity._gradientZMax=gradientZMax,gradientAngularVelocity._gradientWMin=gradientWMin,gradientAngularVelocity._gradientWMax=gradientWMax,gradientAngularVelocity},GradientAngularVelocity}(),GradientColor=function(){function GradientColor(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}__class(GradientColor,"laya.d3.core.particleShuriKen.module.GradientColor");var __proto=GradientColor.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){destObject._type=this._type,this._constant.cloneTo(destObject._constant),this._constantMin.cloneTo(destObject._constantMin),this._constantMax.cloneTo(destObject._constantMax),this._gradient.cloneTo(destObject._gradient),this._gradientMin.cloneTo(destObject._gradientMin),this._gradientMax.cloneTo(destObject._gradientMax)},__proto.clone=function(){var destGradientColor=new this.constructor;return this.cloneTo(destGradientColor),destGradientColor},__getset(0,__proto,"gradient",function(){return this._gradient}),__getset(0,__proto,"constant",function(){return this._constant}),__getset(0,__proto,"type",function(){return this._type}),__getset(0,__proto,"gradientMin",function(){return this._gradientMin}),__getset(0,__proto,"constantMin",function(){return this._constantMin}),__getset(0,__proto,"gradientMax",function(){return this._gradientMax}),__getset(0,__proto,"constantMax",function(){return this._constantMax}),GradientColor.createByConstant=function(constant){var gradientColor=new GradientColor;return gradientColor._type=0,gradientColor._constant=constant,gradientColor},GradientColor.createByGradient=function(gradient){var gradientColor=new GradientColor;return gradientColor._type=1,gradientColor._gradient=gradient,gradientColor},GradientColor.createByRandomTwoConstant=function(minConstant,maxConstant){var gradientColor=new GradientColor;return gradientColor._type=2,gradientColor._constantMin=minConstant,gradientColor._constantMax=maxConstant,gradientColor},GradientColor.createByRandomTwoGradient=function(minGradient,maxGradient){var gradientColor=new GradientColor;return gradientColor._type=3,gradientColor._gradientMin=minGradient,gradientColor._gradientMax=maxGradient,gradientColor},GradientColor}(),GradientSize=(function(){function GradientDataColor(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}__class(GradientDataColor,"laya.d3.core.particleShuriKen.module.GradientDataColor");var __proto=GradientDataColor.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.addAlpha=function(key,value){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==key&&(key=1,DEBUG)&&console.log("GradientDataColor warning:the forth key is  be force set to 1."),this._alphaElements[this._alphaCurrentLength++]=key,this._alphaElements[this._alphaCurrentLength++]=value):DEBUG&&console.log("GradientDataColor warning:data count must lessEqual than 4")},__proto.addRGB=function(key,value){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==key&&(key=1,DEBUG)&&console.log("GradientDataColor warning:the forth key is  be force set to 1."),this._rgbElements[this._rgbCurrentLength++]=key,this._rgbElements[this._rgbCurrentLength++]=value.x,this._rgbElements[this._rgbCurrentLength++]=value.y,this._rgbElements[this._rgbCurrentLength++]=value.z):DEBUG&&console.log("GradientDataColor warning:data count must lessEqual than 4")},__proto.cloneTo=function(destObject){var i=0,n=0,destAlphaElements=(destObject._alphaCurrentLength=this._alphaCurrentLength,destObject._alphaElements);for(destAlphaElements.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)destAlphaElements[i]=this._alphaElements[i];destObject._rgbCurrentLength=this._rgbCurrentLength;var destRGBElements=destObject._rgbElements;for(destRGBElements.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)destRGBElements[i]=this._rgbElements[i]},__proto.clone=function(){var destGradientDataColor=new this.constructor;return this.cloneTo(destGradientDataColor),destGradientDataColor},__getset(0,__proto,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),__getset(0,__proto,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function GradientDataInt(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}__class(GradientDataInt,"laya.d3.core.particleShuriKen.module.GradientDataInt");var __proto=GradientDataInt.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.add=function(key,value){this._currentLength<8?(6===this._currentLength&&1!==key&&(key=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=key,this._elements[this._currentLength++]=value):console.log("Warning:data count must lessEqual than 4")},__proto.cloneTo=function(destObject){destObject._currentLength=this._currentLength;var destElements=destObject._elements;destElements.length=this._elements.length;for(var i=0,n=this._elements.length;i<n;i++)destElements[i]=this._elements[i]},__proto.clone=function(){var destGradientDataInt=new this.constructor;return this.cloneTo(destGradientDataInt),destGradientDataInt},__getset(0,__proto,"gradientCount",function(){return this._currentLength/2})}(),function(){function GradientDataNumber(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}__class(GradientDataNumber,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var __proto=GradientDataNumber.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.add=function(key,value){this._currentLength<8?(6===this._currentLength&&1!==key&&(key=1,DEBUG)&&console.log("GradientDataNumber warning:the forth key is  be force set to 1."),this._elements[this._currentLength++]=key,this._elements[this._currentLength++]=value):DEBUG&&console.log("GradientDataNumber warning:data count must lessEqual than 4")},__proto.getKeyByIndex=function(index){return this._elements[2*index]},__proto.getValueByIndex=function(index){return this._elements[2*index+1]},__proto.getAverageValue=function(){for(var i=0,n=this._currentLength-2;i<n;i+=2){var subValue=this._elements[i+1];subValue+=this._elements[i+3],this._elements[i+2],this._elements[i]}return 0},__proto.cloneTo=function(destObject){destObject._currentLength=this._currentLength;var destElements=destObject._elements;destElements.length=this._elements.length;for(var i=0,n=this._elements.length;i<n;i++)destElements[i]=this._elements[i]},__proto.clone=function(){var destGradientDataNumber=new this.constructor;return this.cloneTo(destGradientDataNumber),destGradientDataNumber},__getset(0,__proto,"gradientCount",function(){return this._currentLength/2})}(),function(){function GradientDataVector2(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}__class(GradientDataVector2,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var __proto=GradientDataVector2.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.add=function(key,value){this._currentLength<8?(6===this._currentLength&&1!==key&&(key=1,DEBUG)&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1."),this._elements[this._currentLength++]=key,this._elements[this._currentLength++]=value.x,this._elements[this._currentLength++]=value.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},__proto.cloneTo=function(destObject){destObject._currentLength=this._currentLength;var destElements=destObject._elements;destElements.length=this._elements.length;for(var i=0,n=this._elements.length;i<n;i++)destElements[i]=this._elements[i]},__proto.clone=function(){var destGradientDataVector2=new this.constructor;return this.cloneTo(destGradientDataVector2),destGradientDataVector2},__getset(0,__proto,"gradientCount",function(){return this._currentLength/3})}(),function(){function GradientSize(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}__class(GradientSize,"laya.d3.core.particleShuriKen.module.GradientSize");var __proto=GradientSize.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.getMaxSizeInGradient=function(){var i=0,n=0,maxSize=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(i=0,n=this._gradientX.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientX.getValueByIndex(i));for(i=0,n=this._gradientY.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientY.getValueByIndex(i))}else for(i=0,n=this._gradient.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradient.getValueByIndex(i));break;case 1:maxSize=this._separateAxes?(maxSize=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),maxSize=Math.max(maxSize,this._constantMinSeparate.y),Math.max(maxSize,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(i=0,n=this._gradientXMin.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientXMin.getValueByIndex(i));for(i=0,n=this._gradientXMax.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientXMax.getValueByIndex(i));for(i=0,n=this._gradientYMin.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientYMin.getValueByIndex(i));for(i=0,n=this._gradientZMax.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientZMax.getValueByIndex(i))}else{for(i=0,n=this._gradientMin.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientMin.getValueByIndex(i));for(i=0,n=this._gradientMax.gradientCount;i<n;i++)maxSize=Math.max(maxSize,this._gradientMax.getValueByIndex(i))}}return maxSize},__proto.cloneTo=function(destObject){destObject._type=this._type,destObject._separateAxes=this._separateAxes,this._gradient.cloneTo(destObject._gradient),this._gradientX.cloneTo(destObject._gradientX),this._gradientY.cloneTo(destObject._gradientY),this._gradientZ.cloneTo(destObject._gradientZ),destObject._constantMin=this._constantMin,destObject._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(destObject._constantMinSeparate),this._constantMaxSeparate.cloneTo(destObject._constantMaxSeparate),this._gradientMin.cloneTo(destObject._gradientMin),this._gradientMax.cloneTo(destObject._gradientMax),this._gradientXMin.cloneTo(destObject._gradientXMin),this._gradientXMax.cloneTo(destObject._gradientXMax),this._gradientYMin.cloneTo(destObject._gradientYMin),this._gradientYMax.cloneTo(destObject._gradientYMax),this._gradientZMin.cloneTo(destObject._gradientZMin),this._gradientZMax.cloneTo(destObject._gradientZMax)},__proto.clone=function(){var destGradientSize=new this.constructor;return this.cloneTo(destGradientSize),destGradientSize},__getset(0,__proto,"gradientZ",function(){return this._gradientZ}),__getset(0,__proto,"gradient",function(){return this._gradient}),__getset(0,__proto,"separateAxes",function(){return this._separateAxes}),__getset(0,__proto,"type",function(){return this._type}),__getset(0,__proto,"gradientMin",function(){return this._gradientMin}),__getset(0,__proto,"constantMin",function(){return this._constantMin}),__getset(0,__proto,"gradientX",function(){return this._gradientX}),__getset(0,__proto,"gradientY",function(){return this._gradientY}),__getset(0,__proto,"gradientMax",function(){return this._gradientMax}),__getset(0,__proto,"constantMax",function(){return this._constantMax}),__getset(0,__proto,"constantMinSeparate",function(){return this._constantMinSeparate}),__getset(0,__proto,"constantMaxSeparate",function(){return this._constantMaxSeparate}),__getset(0,__proto,"gradientXMin",function(){return this._gradientXMin}),__getset(0,__proto,"gradientXMax",function(){return this._gradientXMax}),__getset(0,__proto,"gradientYMin",function(){return this._gradientYMin}),__getset(0,__proto,"gradientYMax",function(){return this._gradientYMax}),__getset(0,__proto,"gradientZMin",function(){return this._gradientZMin}),__getset(0,__proto,"gradientZMax",function(){return this._gradientZMax}),GradientSize.createByGradient=function(gradient){var gradientSize=new GradientSize;return gradientSize._type=0,gradientSize._separateAxes=!1,gradientSize._gradient=gradient,gradientSize},GradientSize.createByGradientSeparate=function(gradientX,gradientY,gradientZ){var gradientSize=new GradientSize;return gradientSize._type=0,gradientSize._separateAxes=!0,gradientSize._gradientX=gradientX,gradientSize._gradientY=gradientY,gradientSize._gradientZ=gradientZ,gradientSize},GradientSize.createByRandomTwoConstant=function(constantMin,constantMax){var gradientSize=new GradientSize;return gradientSize._type=1,gradientSize._separateAxes=!1,gradientSize._constantMin=constantMin,gradientSize._constantMax=constantMax,gradientSize},GradientSize.createByRandomTwoConstantSeparate=function(constantMinSeparate,constantMaxSeparate){var gradientSize=new GradientSize;return gradientSize._type=1,gradientSize._separateAxes=!0,gradientSize._constantMinSeparate=constantMinSeparate,gradientSize._constantMaxSeparate=constantMaxSeparate,gradientSize},GradientSize.createByRandomTwoGradient=function(gradientMin,gradientMax){var gradientSize=new GradientSize;return gradientSize._type=2,gradientSize._separateAxes=!1,gradientSize._gradientMin=gradientMin,gradientSize._gradientMax=gradientMax,gradientSize},GradientSize.createByRandomTwoGradientSeparate=function(gradientXMin,gradientXMax,gradientYMin,gradientYMax,gradientZMin,gradientZMax){var gradientSize=new GradientSize;return gradientSize._type=2,gradientSize._separateAxes=!0,gradientSize._gradientXMin=gradientXMin,gradientSize._gradientXMax=gradientXMax,gradientSize._gradientYMin=gradientYMin,gradientSize._gradientYMax=gradientYMax,gradientSize._gradientZMin=gradientZMin,gradientSize._gradientZMax=gradientZMax,gradientSize},GradientSize}()),GradientVelocity=function(){function GradientVelocity(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}__class(GradientVelocity,"laya.d3.core.particleShuriKen.module.GradientVelocity");var __proto=GradientVelocity.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){destObject._type=this._type,this._constant.cloneTo(destObject._constant),this._gradientX.cloneTo(destObject._gradientX),this._gradientY.cloneTo(destObject._gradientY),this._gradientZ.cloneTo(destObject._gradientZ),this._constantMin.cloneTo(destObject._constantMin),this._constantMax.cloneTo(destObject._constantMax),this._gradientXMin.cloneTo(destObject._gradientXMin),this._gradientXMax.cloneTo(destObject._gradientXMax),this._gradientYMin.cloneTo(destObject._gradientYMin),this._gradientYMax.cloneTo(destObject._gradientYMax),this._gradientZMin.cloneTo(destObject._gradientZMin),this._gradientZMax.cloneTo(destObject._gradientZMax)},__proto.clone=function(){var destGradientVelocity=new this.constructor;return this.cloneTo(destGradientVelocity),destGradientVelocity},__getset(0,__proto,"gradientZ",function(){return this._gradientZ}),__getset(0,__proto,"constant",function(){return this._constant}),__getset(0,__proto,"type",function(){return this._type}),__getset(0,__proto,"gradientXMax",function(){return this._gradientXMax}),__getset(0,__proto,"constantMin",function(){return this._constantMin}),__getset(0,__proto,"gradientX",function(){return this._gradientX}),__getset(0,__proto,"gradientY",function(){return this._gradientY}),__getset(0,__proto,"gradientXMin",function(){return this._gradientXMin}),__getset(0,__proto,"constantMax",function(){return this._constantMax}),__getset(0,__proto,"gradientYMin",function(){return this._gradientYMin}),__getset(0,__proto,"gradientYMax",function(){return this._gradientYMax}),__getset(0,__proto,"gradientZMin",function(){return this._gradientZMin}),__getset(0,__proto,"gradientZMax",function(){return this._gradientZMax}),GradientVelocity.createByConstant=function(constant){var gradientVelocity=new GradientVelocity;return gradientVelocity._type=0,gradientVelocity._constant=constant,gradientVelocity},GradientVelocity.createByGradient=function(gradientX,gradientY,gradientZ){var gradientVelocity=new GradientVelocity;return gradientVelocity._type=1,gradientVelocity._gradientX=gradientX,gradientVelocity._gradientY=gradientY,gradientVelocity._gradientZ=gradientZ,gradientVelocity},GradientVelocity.createByRandomTwoConstant=function(constantMin,constantMax){var gradientVelocity=new GradientVelocity;return gradientVelocity._type=2,gradientVelocity._constantMin=constantMin,gradientVelocity._constantMax=constantMax,gradientVelocity},GradientVelocity.createByRandomTwoGradient=function(gradientXMin,gradientXMax,gradientYMin,gradientYMax,gradientZMin,gradientZMax){var gradientVelocity=new GradientVelocity;return gradientVelocity._type=3,gradientVelocity._gradientXMin=gradientXMin,gradientVelocity._gradientXMax=gradientXMax,gradientVelocity._gradientYMin=gradientYMin,gradientVelocity._gradientYMax=gradientYMax,gradientVelocity._gradientZMin=gradientZMin,gradientVelocity._gradientZMax=gradientZMax,gradientVelocity},GradientVelocity}(),BaseShape=(function(){function RotationOverLifetime(angularVelocity){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=angularVelocity}__class(RotationOverLifetime,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var __proto=RotationOverLifetime.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){this._angularVelocity.cloneTo(destObject._angularVelocity),destObject.enbale=this.enbale},__proto.clone=function(){var destAngularVelocity;switch(this._angularVelocity.type){case 0:destAngularVelocity=this._angularVelocity.separateAxes?GradientAngularVelocity.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):GradientAngularVelocity.createByConstant(this._angularVelocity.constant);break;case 1:destAngularVelocity=this._angularVelocity.separateAxes?GradientAngularVelocity.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):GradientAngularVelocity.createByGradient(this._angularVelocity.gradient.clone());break;case 2:destAngularVelocity=this._angularVelocity.separateAxes?GradientAngularVelocity.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):GradientAngularVelocity.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:destAngularVelocity=this._angularVelocity.separateAxes?GradientAngularVelocity.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):GradientAngularVelocity.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var destRotationOverLifetime=new this.constructor(destAngularVelocity);return destRotationOverLifetime.enbale=this.enbale,destRotationOverLifetime},__getset(0,__proto,"angularVelocity",function(){return this._angularVelocity})}(),function(){function BaseShape(){this.enable=!1,this.randomDirection=!1}__class(BaseShape,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var __proto=BaseShape.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto._getShapeBoundBox=function(boundBox){throw new Error("BaseShape: must override it.")},__proto._getSpeedBoundBox=function(boundBox){throw new Error("BaseShape: must override it.")},__proto.generatePositionAndDirection=function(position,direction,rand,randomSeeds){throw new Error("BaseShape: must override it.")},__proto._calculateProceduralBounds=function(boundBox,emitterPosScale,minMaxBounds){this._getShapeBoundBox(boundBox);var min=boundBox.min,max=boundBox.max,min=(Vector3.multiply(min,emitterPosScale,min),Vector3.multiply(max,emitterPosScale,max),new BoundBox(new Vector3,new Vector3)),emitterPosScale=(this.randomDirection?(min.min=new Vector3(-1,-1,-1),min.max=new Vector3(1,1,1)):this._getSpeedBoundBox(min),new BoundBox(new Vector3,new Vector3)),max=emitterPosScale.min,emitterPosScale=emitterPosScale.max,minSpeedBound=(Vector3.scale(min.min,minMaxBounds.y,max),Vector3.scale(min.max,minMaxBounds.y,emitterPosScale),Vector3.add(boundBox.min,max,max),Vector3.add(boundBox.max,emitterPosScale,emitterPosScale),Vector3.min(boundBox.min,max,boundBox.min),Vector3.max(boundBox.max,max,boundBox.max),new BoundBox(new Vector3,new Vector3)),minSpeedMin=minSpeedBound.min,minSpeedMax=minSpeedBound.max;Vector3.scale(min.min,minMaxBounds.x,minSpeedMin),Vector3.scale(min.max,minMaxBounds.x,minSpeedMax),Vector3.min(minSpeedBound.min,minSpeedMax,max),Vector3.max(minSpeedBound.min,minSpeedMax,emitterPosScale),Vector3.min(boundBox.min,max,boundBox.min),Vector3.max(boundBox.max,max,boundBox.max)},__proto.cloneTo=function(destObject){destObject.enable=this.enable},__proto.clone=function(){var destShape=new this.constructor;return this.cloneTo(destShape),destShape},BaseShape}()),ShapeUtils=function(){function ShapeUtils(){}return __class(ShapeUtils,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),ShapeUtils._randomPointUnitArcCircle=function(arc,out,rand){var out=out.elements,angle=NaN,angle=rand?rand.getFloat()*arc:Math.random()*arc;out[0]=Math.cos(angle),out[1]=Math.sin(angle)},ShapeUtils._randomPointInsideUnitArcCircle=function(arc,out,rand){var outE=out.elements,arc=(ShapeUtils._randomPointUnitArcCircle(arc,out,rand),NaN),arc=rand?Math.pow(rand.getFloat(),.5):Math.pow(Math.random(),.5);outE[0]=outE[0]*arc,outE[1]=outE[1]*arc},ShapeUtils._randomPointUnitCircle=function(out,rand){var out=out.elements,angle=NaN,angle=rand?rand.getFloat()*Math.PI*2:Math.random()*Math.PI*2;out[0]=Math.cos(angle),out[1]=Math.sin(angle)},ShapeUtils._randomPointInsideUnitCircle=function(out,rand){var outE=out.elements,out=(ShapeUtils._randomPointUnitCircle(out),NaN),out=rand?Math.pow(rand.getFloat(),.5):Math.pow(Math.random(),.5);outE[0]=outE[0]*out,outE[1]=outE[1]*out},ShapeUtils._randomPointUnitSphere=function(out,rand){var out=out.elements,z=NaN,a=NaN,a=rand?(z=out[2]=2*rand.getFloat()-1,rand.getFloat()*Math.PI*2):(z=out[2]=2*Math.random()-1,Math.random()*Math.PI*2),rand=Math.sqrt(1-z*z);out[0]=rand*Math.cos(a),out[1]=rand*Math.sin(a)},ShapeUtils._randomPointInsideUnitSphere=function(out,rand){var outE=out.elements,out=(ShapeUtils._randomPointUnitSphere(out),NaN),out=rand?Math.pow(rand.getFloat(),1/3):Math.pow(Math.random(),1/3);outE[0]=outE[0]*out,outE[1]=outE[1]*out,outE[2]=outE[2]*out},ShapeUtils._randomPointInsideHalfUnitBox=function(out,rand){out=out.elements;rand?(out[0]=rand.getFloat()-.5,out[1]=rand.getFloat()-.5,out[2]=rand.getFloat()-.5):(out[0]=Math.random()-.5,out[1]=Math.random()-.5,out[2]=Math.random()-.5)},ShapeUtils}(),StartFrame=(function(){function SizeOverLifetime(size){this._size=null,this.enbale=!1,this._size=size}__class(SizeOverLifetime,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var __proto=SizeOverLifetime.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){this._size.cloneTo(destObject._size),destObject.enbale=this.enbale},__proto.clone=function(){var destSize;switch(this._size.type){case 0:destSize=this._size.separateAxes?GradientSize.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):GradientSize.createByGradient(this._size.gradient.clone());break;case 1:destSize=this._size.separateAxes?GradientSize.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):GradientSize.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:destSize=this._size.separateAxes?GradientSize.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):GradientSize.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var destSizeOverLifetime=new this.constructor(destSize);return destSizeOverLifetime.enbale=this.enbale,destSizeOverLifetime},__getset(0,__proto,"size",function(){return this._size})}(),function(){function StartFrame(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}__class(StartFrame,"laya.d3.core.particleShuriKen.module.StartFrame");var __proto=StartFrame.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){destObject._type=this._type,destObject._constant=this._constant,destObject._constantMin=this._constantMin,destObject._constantMax=this._constantMax},__proto.clone=function(){var destStartFrame=new this.constructor;return this.cloneTo(destStartFrame),destStartFrame},__getset(0,__proto,"constant",function(){return this._constant}),__getset(0,__proto,"type",function(){return this._type}),__getset(0,__proto,"constantMin",function(){return this._constantMin}),__getset(0,__proto,"constantMax",function(){return this._constantMax}),StartFrame.createByConstant=function(constant){var rotationOverLifetime=new StartFrame;return rotationOverLifetime._type=0,rotationOverLifetime._constant=constant,rotationOverLifetime},StartFrame.createByRandomTwoConstant=function(constantMin,constantMax){var rotationOverLifetime=new StartFrame;return rotationOverLifetime._type=1,rotationOverLifetime._constantMin=constantMin,rotationOverLifetime._constantMax=constantMax,rotationOverLifetime},StartFrame}()),PhasorSpriter3D=(function(){function TextureSheetAnimation(frame,startFrame){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new Vector2(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=frame,this._startFrame=startFrame}__class(TextureSheetAnimation,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var __proto=TextureSheetAnimation.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){this.tiles.cloneTo(destObject.tiles),destObject.type=this.type,destObject.randomRow=this.randomRow,this._frame.cloneTo(destObject._frame),this._startFrame.cloneTo(destObject._startFrame),destObject.cycles=this.cycles,destObject.enableUVChannels=this.enableUVChannels,destObject.enable=this.enable},__proto.clone=function(){var destFrame,destStartFrame;switch(this._frame.type){case 0:destFrame=FrameOverTime.createByConstant(this._frame.constant);break;case 1:destFrame=FrameOverTime.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:destFrame=FrameOverTime.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:destFrame=FrameOverTime.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:destStartFrame=StartFrame.createByConstant(this._startFrame.constant);break;case 1:destStartFrame=StartFrame.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var destTextureSheetAnimation=new this.constructor(destFrame,destStartFrame);return this.tiles.cloneTo(destTextureSheetAnimation.tiles),destTextureSheetAnimation.type=this.type,destTextureSheetAnimation.randomRow=this.randomRow,destTextureSheetAnimation.cycles=this.cycles,destTextureSheetAnimation.enableUVChannels=this.enableUVChannels,destTextureSheetAnimation.enable=this.enable,destTextureSheetAnimation},__getset(0,__proto,"frame",function(){return this._frame}),__getset(0,__proto,"startFrame",function(){return this._startFrame})}(),function(){function VelocityOverLifetime(velocity){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=velocity}__class(VelocityOverLifetime,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var __proto=VelocityOverLifetime.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.cloneTo=function(destObject){this._velocity.cloneTo(destObject._velocity),destObject.enbale=this.enbale,destObject.space=this.space},__proto.clone=function(){var destVelocity;switch(this._velocity.type){case 0:destVelocity=GradientVelocity.createByConstant(this._velocity.constant.clone());break;case 1:destVelocity=GradientVelocity.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:destVelocity=GradientVelocity.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:destVelocity=GradientVelocity.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var destVelocityOverLifetime=new this.constructor(destVelocity);return destVelocityOverLifetime.enbale=this.enbale,destVelocityOverLifetime.space=this.space,destVelocityOverLifetime},__getset(0,__proto,"velocity",function(){return this._velocity})}(),function(){function PhasorSpriter3D(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new ValusArray,this._vb=VertexBuffer3D.create(PhasorSpriter3D._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=IndexBuffer3D.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Shader3D.nameKey.getID("LINE"),this._shaderCompile=ShaderCompile3D._preCompileShader[this._sharderNameID]}__class(PhasorSpriter3D,"laya.d3.core.PhasorSpriter3D");var __proto=PhasorSpriter3D.prototype;return __proto.line=function(startPosition,startColor,endPosition,endColor){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(startPosition.x,startPosition.y,startPosition.z,startColor.x,startColor.y,startColor.z,startColor.w),this.addVertex(endPosition.x,endPosition.y,endPosition.z,endColor.x,endColor.y,endColor.z,endColor.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},__proto.circle=function(radius,numberOfPoints,r,g,b,a){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*numberOfPoints,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/numberOfPoints,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*radius,Math.cos(this._tempNumver0)*radius,0,r,g,b,a),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},__proto.plane=function(positionX,positionY,positionZ,width,height,r,g,b,a){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=width/2,this._tempNumver1=height/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(positionX-this._tempNumver0,positionY+this._tempNumver1,positionZ,r,g,b,a),this.addVertex(positionX+this._tempNumver0,positionY+this._tempNumver1,positionZ,r,g,b,a),this.addVertex(positionX-this._tempNumver0,positionY-this._tempNumver1,positionZ,r,g,b,a),this.addVertex(positionX+this._tempNumver0,positionY-this._tempNumver1,positionZ,r,g,b,a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},__proto.box=function(positionX,positionY,positionZ,width,height,depth,r,g,b,a){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=width/2,this._tempNumver1=height/2,this._tempNumver2=depth/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(positionX-this._tempNumver0,positionY+this._tempNumver1,positionZ+this._tempNumver2,r,g,b,a),this.addVertex(positionX+this._tempNumver0,positionY+this._tempNumver1,positionZ+this._tempNumver2,r,g,b,a),this.addVertex(positionX-this._tempNumver0,positionY-this._tempNumver1,positionZ+this._tempNumver2,r,g,b,a),this.addVertex(positionX+this._tempNumver0,positionY-this._tempNumver1,positionZ+this._tempNumver2,r,g,b,a),this.addVertex(positionX+this._tempNumver0,positionY+this._tempNumver1,positionZ-this._tempNumver2,r,g,b,a),this.addVertex(positionX-this._tempNumver0,positionY+this._tempNumver1,positionZ-this._tempNumver2,r,g,b,a),this.addVertex(positionX+this._tempNumver0,positionY-this._tempNumver1,positionZ-this._tempNumver2,r,g,b,a),this.addVertex(positionX-this._tempNumver0,positionY-this._tempNumver1,positionZ-this._tempNumver2,r,g,b,a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},__proto.cone=function(radius,length,Slices,r,g,b,a){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*Slices+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*Slices>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/Slices,this.addVertexIndex(0,length,0,r,g,b,a,this._tempUint0),this.addVertexIndex(0,0,0,r,g,b,a,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<Slices;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(radius*this._tempNumver2,0,radius*this._tempNumver3,r,g,b,a,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==Slices-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(radius*this._tempNumver2,0,radius*this._tempNumver3,r,g,b,a,this._tempUint0+(this._tempInt0+Slices)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==Slices-1?this.addIndexes(this._tempUint1+Slices+2):this.addIndexes(this._tempUint1+this._tempInt0+Slices+1),this.addIndexes(this._tempUint1+this._tempInt0+Slices),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},__proto.boundingBoxLine=function(minX,minY,minZ,maxX,maxY,maxZ,r,g,b,a){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(minX,maxY,maxZ,r,g,b,a),this.addVertex(maxX,maxY,maxZ,r,g,b,a),this.addVertex(minX,minY,maxZ,r,g,b,a),this.addVertex(maxX,minY,maxZ,r,g,b,a),this.addVertex(maxX,maxY,minZ,r,g,b,a),this.addVertex(minX,maxY,minZ,r,g,b,a),this.addVertex(maxX,minY,minZ,r,g,b,a),this.addVertex(minX,minY,minZ,r,g,b,a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},__proto.addVertex=function(x,y,z,r,g,b,a){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=x,this._vbData[this._posInVBData+1]=y,this._vbData[this._posInVBData+2]=z,this._vbData[this._posInVBData+3]=r,this._vbData[this._posInVBData+4]=g,this._vbData[this._posInVBData+5]=b,this._vbData[this._posInVBData+6]=a,this._posInVBData+=this._floatSizePerVer,this},__proto.addVertexIndex=function(x,y,z,r,g,b,a,index){return this._hasBegun||this.addVertexIndexException(),this._vbData[index]=x,this._vbData[index+1]=y,this._vbData[index+2]=z,this._vbData[index+3]=r,this._vbData[index+4]=g,this._vbData[index+5]=b,this._vbData[index+6]=a,(index+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=index),this},__proto.addIndexes=function(__indexes){var indexes=arguments;this._hasBegun||this.addVertexIndexException();for(var i=0;i<indexes.length;i++)this._ibData[this._posInIBData]=indexes[i],this._posInIBData++;return this},__proto.begin=function(primitive,camera){return this._hasBegun&&this.beginException0(),1!==primitive&&4!==primitive&&this.beginException1(),this._primitiveType=primitive,this._camera=camera,this._hasBegun=!0,this},__proto.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},__proto.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(PhasorSpriter3D._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),Stat.drawCall++,WebGL.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},__proto.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},__proto.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},__proto.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},__proto.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},__proto.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},__proto.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},__static(PhasorSpriter3D,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(28,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector4",1)])}]),PhasorSpriter3D}()),RenderElement=function(){function RenderElement(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++RenderElement._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new ValusArray}__class(RenderElement,"laya.d3.core.render.RenderElement");var __proto=RenderElement.prototype;return __proto.getDynamicBatchBakedVertexs=function(index){for(var index=this._renderObj._getVertexBuffer(index),bakedVertexes=index.getData().slice(),index=index.vertexDeclaration,positionOffset=index.getVertexElementByUsage(0).offset/4,normalOffset=index.getVertexElementByUsage(3).offset/4,transform=this._sprite3D.transform,worldMatrix=transform.worldMatrix,rotation=transform.rotation,vertexFloatCount=index.vertexStride/4,i=0,n=bakedVertexes.length;i<n;i+=vertexFloatCount){var posOffset=i+positionOffset,norOffset=i+normalOffset;Utils3D.transformVector3ArrayToVector3ArrayCoordinate(bakedVertexes,posOffset,worldMatrix,bakedVertexes,posOffset),Utils3D.transformVector3ArrayByQuat(bakedVertexes,norOffset,rotation,bakedVertexes,norOffset)}return bakedVertexes},__proto.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},__proto._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"renderObj",function(){return this._renderObj},function(value){this._renderObj!==value&&(this._renderObj=value)}),RenderElement._uniqueIDCounter=0,RenderElement}(),RenderQueue=function(){function RenderQueue(scene){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++RenderQueue._uniqueIDCounter,this._needSort=!1,this._scene=scene,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[]}__class(RenderQueue,"laya.d3.core.render.RenderQueue");var __proto=RenderQueue.prototype;return __proto._sortOpaqueFunc=function(a,b){var renderQueue;return a._render&&b._render?0==(renderQueue=a._material.renderQueue-b._material.renderQueue)?a._render._distanceForSort-b._render._distanceForSort:renderQueue:0},__proto._sortAlphaFunc=function(a,b){var renderQueue;return a._render&&b._render?0==(renderQueue=a._material.renderQueue-b._material.renderQueue)?b._render._distanceForSort-a._render._distanceForSort:renderQueue:0},__proto._begainRenderElement=function(state,renderObj,material){return!!renderObj._beforeRender(state)},__proto._sortAlpha=function(cameraPos){RenderQueue._cameraPosition=cameraPos,this._finalElements.sort(this._sortAlphaFunc)},__proto._sortOpaque=function(cameraPos){RenderQueue._cameraPosition=cameraPos,this._finalElements.sort(this._sortOpaqueFunc)},__proto._preRender=function(state){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},__proto._render=function(state,isTarget){for(var vbs,vertexBuffer,vertexDeclaration,shader,lastStateMaterial,lastStateOwner,loopCount=Stat.loopCount,scene=this._scene,camera=state.camera,forceUploadParams=(camera.id,!1),i=0,n=this._finalElements.length;i<n;i++){var renderObj,material,owner,renderElement=this._finalElements[i];if(null!=renderElement._onPreRenderFunction&&renderElement._onPreRenderFunction.call(renderElement._sprite3D,state),0===renderElement._type){if(state.owner=owner=renderElement._sprite3D,state.renderElement=renderElement,owner._preRenderUpdateComponents(state),renderObj=renderElement.renderObj,material=renderElement._material,this._begainRenderElement(state,renderObj,material)){if(vbs=renderObj._getVertexBuffers(),vertexDeclaration=(vertexBuffer=renderObj._getVertexBuffer(0)).vertexDeclaration,forceUploadParams=(shader=state._shader=material._getShader(scene._shaderDefineValue,vertexDeclaration.shaderDefineValue,owner._shaderDefineValue)).bind()||loopCount!==shader._uploadLoopCount,vbs){if(shader._uploadVertexBuffer!==vbs||forceUploadParams){for(var j=0;j<vbs.length;j++){var vb=vbs[j];shader.uploadAttributesX(vb.vertexDeclaration.shaderValues.data,vb)}shader._uploadVertexBuffer=vbs}}else shader._uploadVertexBuffer===vertexBuffer&&!forceUploadParams||(shader.uploadAttributes(vertexDeclaration.shaderValues.data,null),shader._uploadVertexBuffer=vertexBuffer);shader._uploadScene===scene&&!forceUploadParams||(shader.uploadSceneUniforms(scene._shaderValues.data),shader._uploadScene=scene),camera===shader._uploadCamera&&shader._uploadSprite3D===owner&&!forceUploadParams||(shader.uploadSpriteUniforms(owner._shaderValues.data),shader._uploadSprite3D=owner),camera===shader._uploadCamera&&!forceUploadParams||(shader.uploadCameraUniforms(camera._shaderValues.data),shader._uploadCamera=camera),shader._uploadMaterial===material&&!forceUploadParams||(material._upload(),shader._uploadMaterial=material),lastStateMaterial!==material?(material._setRenderStateBlendDepth(),material._setRenderStateFrontFace(isTarget,owner.transform),lastStateMaterial=material,lastStateOwner=owner):lastStateOwner!==owner&&(material._setRenderStateFrontFace(isTarget,owner.transform),lastStateOwner=owner),renderObj._render(state),shader._uploadLoopCount=loopCount}owner._postRenderUpdateComponents(state)}else 2===renderElement._type&&(renderElement.renderObj,state.owner=owner=renderElement._sprite3D,state.renderElement=renderElement,state._batchIndexStart=renderElement._tempBatchIndexStart,state._batchIndexEnd=renderElement._tempBatchIndexEnd,renderObj=renderElement.renderObj,material=renderElement._material,this._begainRenderElement(state,renderObj,material))&&(vertexDeclaration=(vertexBuffer=renderObj._getVertexBuffer(0)).vertexDeclaration,forceUploadParams=(shader=state._shader=material._getShader(scene._shaderDefineValue,vertexDeclaration.shaderDefineValue,owner._shaderDefineValue)).bind()||loopCount!==shader._uploadLoopCount,shader._uploadVertexBuffer===vertexBuffer&&!forceUploadParams||(shader.uploadAttributes(vertexDeclaration.shaderValues.data,null),shader._uploadVertexBuffer=vertexBuffer),shader._uploadScene===scene&&!forceUploadParams||(shader.uploadSceneUniforms(scene._shaderValues.data),shader._uploadScene=scene),camera===shader._uploadCamera&&shader._uploadSprite3D===owner&&!forceUploadParams||(shader.uploadSpriteUniforms(owner._shaderValues.data),shader._uploadSprite3D=owner),camera===shader._uploadCamera&&!forceUploadParams||(shader.uploadCameraUniforms(camera._shaderValues.data),shader._uploadCamera=camera),shader._uploadMaterial===material&&!forceUploadParams||(material._upload(),shader._uploadMaterial=material),lastStateMaterial!==material?(material._setRenderStateBlendDepth(),material._setRenderStateFrontFace(isTarget,owner.transform),lastStateMaterial=material,lastStateOwner=owner):lastStateOwner!==owner&&(material._setRenderStateFrontFace(isTarget,owner.transform),lastStateOwner=owner),renderObj._render(state),shader._uploadLoopCount=loopCount)}},__proto._renderShadow=function(state,isOnePSSM){for(var vertexBuffer,vertexDeclaration,shader,forceUploadParams,lastStateMaterial,lastStateOwner,loopCount=Stat.loopCount,scene=this._scene,camera=state.camera,i=0,n=this._finalElements.length;i<n;i++){var renderObj,owner,renderElement=this._finalElements[i];0===renderElement._type&&(state.owner=owner=renderElement._sprite3D,isOnePSSM||owner._projectionViewWorldUpdateCamera===camera&&owner._projectionViewWorldUpdateLoopCount===Stat.loopCount||(owner._render._renderUpdate(state._projectionViewMatrix),owner._projectionViewWorldUpdateLoopCount=Stat.loopCount,owner._projectionViewWorldUpdateCamera=camera),state.renderElement=renderElement,owner._preRenderUpdateComponents(state),renderObj=renderElement.renderObj,renderElement=renderElement._material,this._begainRenderElement(state,renderObj,null)&&(vertexDeclaration=(vertexBuffer=renderObj._getVertexBuffer(0)).vertexDeclaration,forceUploadParams=(shader=state._shader=renderElement._getShader(scene._shaderDefineValue,vertexDeclaration.shaderDefineValue,owner._shaderDefineValue)).bind()||loopCount!==shader._uploadLoopCount,shader._uploadVertexBuffer===vertexBuffer&&!forceUploadParams||(shader.uploadAttributes(vertexDeclaration.shaderValues.data,null),shader._uploadVertexBuffer=vertexBuffer),camera===shader._uploadCamera&&shader._uploadSprite3D===owner&&!forceUploadParams||(shader.uploadSpriteUniforms(owner._shaderValues.data),shader._uploadSprite3D=owner),camera===shader._uploadCamera&&!forceUploadParams||(shader.uploadCameraUniforms(camera._shaderValues.data),shader._uploadCamera=camera),shader._uploadMaterial===renderElement&&!forceUploadParams||(renderElement._upload(),shader._uploadMaterial=renderElement),shader._uploadRenderElement,lastStateMaterial!==renderElement?(renderElement._setRenderStateFrontFace(!1,owner.transform),lastStateMaterial=renderElement,lastStateOwner=owner):lastStateOwner!==owner&&(renderElement._setRenderStateFrontFace(!1,owner.transform),lastStateOwner=owner),renderObj._render(state),shader._uploadLoopCount=loopCount),owner._postRenderUpdateComponents(state))}},__proto._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},__proto._addRenderElement=function(renderElement){this._renderElements.push(renderElement),this._needSort=!0},__proto._addDynamicBatchElement=function(dynamicBatchElement){this._dynamicBatchCombineRenderElements.push(dynamicBatchElement)},__getset(0,__proto,"id",function(){return this._id}),RenderQueue._uniqueIDCounter=0,RenderQueue._cameraPosition=null,RenderQueue}(),RenderState=function(){function RenderState(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return __class(RenderState,"laya.d3.core.render.RenderState"),RenderState.clientWidth=0,RenderState.clientHeight=0,RenderState}(),OctreeNode=function(){function OctreeNode(scene,currentDepth){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new BoundSphere(new Vector3,0),this._corners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],this._boundingBoxCenter=new Vector3,this._children=__newvec(8),this._objects=[],this._tempBoundBoxCorners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],this._scene=scene,this._currentDepth=currentDepth}__class(OctreeNode,"laya.d3.core.scene.OctreeNode");var __proto=OctreeNode.prototype;return Laya.imps(__proto,{"laya.d3.core.scene.ITreeNode":!0}),__proto.init=function(center,treeSize){var min=new Vector3,max=new Vector3;Vector3.scale(treeSize,-.5,min),Vector3.scale(treeSize,.5,max),Vector3.add(min,center,min),Vector3.add(max,center,max),this.exactBox=new BoundBox(min,max),this.relaxBox=new BoundBox(min,max)},__proto.addTreeNode=function(render){1===Collision.boxContainsBox(this._relaxBox,render.boundingBox)?this.addNodeDown(render,0):this.addObject(render)},__proto.addChild=function(index){var max,child=this._children[index];return null==child&&(child=new OctreeNode(this._scene,this._currentDepth+1),(this._children[index]=child)._parent=this,Vector3.subtract(this._exactBox.max,this._exactBox.min,OctreeNode.tempSize),Vector3.multiply(OctreeNode.tempSize,OctreeNode._octreeSplit[index],OctreeNode.tempCenter),Vector3.add(this._exactBox.min,OctreeNode.tempCenter,OctreeNode.tempCenter),Vector3.scale(OctreeNode.tempSize,.25,OctreeNode.tempSize),index=new Vector3,max=new Vector3,Vector3.subtract(OctreeNode.tempCenter,OctreeNode.tempSize,index),Vector3.add(OctreeNode.tempCenter,OctreeNode.tempSize,max),child.exactBox=new BoundBox(index,max),Vector3.scale(OctreeNode.tempSize,OctreeNode.relax,OctreeNode.tempSize),index=new Vector3,max=new Vector3,Vector3.subtract(OctreeNode.tempCenter,OctreeNode.tempSize,index),Vector3.add(OctreeNode.tempCenter,OctreeNode.tempSize,max),child.relaxBox=new BoundBox(index,max)),child},__proto.addObject=function(object){(object._treeNode=this)._objects.push(object)},__proto.removeObject=function(object){return object._treeNode!=this?(console.log("OctreeNode::removeObject error"),!1):-1!==(object=this._objects.indexOf(object))&&(this._objects.splice(object,1),!0)},__proto.clearObject=function(){this._objects.length=0},__proto.addNodeUp=function(render,depth){this._parent&&1!==Collision.boxContainsBox(this._exactBox,render.boundingBox)?this._parent.addNodeUp(render,depth-1):this.addNodeDown(render,depth)},__proto.addNodeDown=function(render,depth){var childIndex;depth<this._scene.treeLevel&&(childIndex=this.inChildIndex(render.boundingBoxCenter),childIndex=this.addChild(childIndex),1===Collision.boxContainsBox(childIndex._relaxBox,render.boundingBox))?childIndex.addNodeDown(render,++depth):this.addObject(render)},__proto.inChildIndex=function(objectCenter){return 4*(objectCenter.z<this._boundingBoxCenter.z?0:1)+2*(objectCenter.y<this._boundingBoxCenter.y?0:1)+(objectCenter.x<this._boundingBoxCenter.x?0:1)},__proto.updateObject=function(render){1===Collision.boxContainsBox(this._relaxBox,render.boundingBox)?(this.removeObject(render),render._treeNode=null,this.addNodeDown(render,this._currentDepth)):this._parent&&(this.removeObject(render),render._treeNode=null,this._parent.addNodeUp(render,this._currentDepth-1))},__proto.cullingObjects=function(boundFrustum,testVisible,flags,cameraPosition,projectionView){for(var i=0,j=0,dynamicBatchManager=this._scene._dynamicBatchManager,i=0,n=this._objects.length;i<n;i++){var render=this._objects[i];if(Layer.isVisible(render._owner.layer.mask)&&render.enable&&(!testVisible||(Stat.treeSpriteCollision+=1,0!==boundFrustum.containsBoundSphere(render.boundingSphere)))){render._renderUpdate(projectionView),render._distanceForSort=Vector3.distance(render.boundingSphere.center,cameraPosition)+render.sortingFudge;for(var renderElements=render._renderElements,j=0,m=renderElements.length;j<m;j++){var renderElement=renderElements[j],staticBatch=renderElement._staticBatch;staticBatch&&staticBatch._material===renderElement._material?staticBatch._addBatchRenderElement(renderElement):(staticBatch=renderElement.renderObj).triangleCount<10&&1===staticBatch._vertexBufferCount&&staticBatch._getIndexBuffer()&&renderElement._material.renderQueue<2&&renderElement._canDynamicBatch&&!render._owner.isStatic?dynamicBatchManager._addPrepareRenderElement(renderElement):this._scene.getRenderQueue(renderElement._material.renderQueue)._addRenderElement(renderElement)}}}for(i=0;i<8;i++){var child=this._children[i];if(null!=child){var testVisibleChild=testVisible;if(testVisible){var type=boundFrustum.containsBoundBox(child._relaxBox);if(Stat.treeNodeCollision+=1,0===type)continue;testVisibleChild=2===type}child.cullingObjects(boundFrustum,testVisibleChild,flags,cameraPosition,projectionView)}}},__proto.cullingShadowObjects=function(lightBoundFrustum,splitShadowQueues,testVisible,flags,scene){for(var i=0,j=0,i=(this._scene._dynamicBatchManager,0),n=this._objects.length;i<n;i++){var baseRender=this._objects[i];if(baseRender.castShadow&&Layer.isVisible(baseRender._owner.layer.mask)&&baseRender.enable&&(!testVisible||0!==lightBoundFrustum[0].containsBoundSphere(baseRender.boundingSphere)))for(var k=1,kNum=lightBoundFrustum.length;k<kNum;k++){var shadowQueue=splitShadowQueues[k-1];if(0!==lightBoundFrustum[k].containsBoundSphere(baseRender.boundingSphere))for(var renderElements=baseRender._renderElements,j=0,m=renderElements.length;j<m;j++)shadowQueue._addRenderElement(renderElements[j])}}for(i=0;i<8;i++){var child=this._children[i];if(null!=child){var testVisibleChild=testVisible;if(testVisible){var type=lightBoundFrustum[0].containsBoundBox(child._relaxBox);if(0===type)continue;testVisibleChild=2===type}child.cullingShadowObjects(lightBoundFrustum,splitShadowQueues,testVisibleChild,flags,scene)}}},__proto.cullingShadowObjectsOnePSSM=function(lightBoundFrustum,splitShadowQueues,lightViewProjectMatrix,testVisible,flags,scene){for(var shadowQueue=splitShadowQueues[0],i=0,j=0,i=0,n=this._objects.length;i<n;i++){var baseRender=this._objects[i];if(baseRender.castShadow&&Layer.isVisible(baseRender._owner.layer.mask)&&baseRender.enable&&(!testVisible||0!==lightBoundFrustum.containsBoundSphere(baseRender.boundingSphere))){baseRender._renderUpdate(lightViewProjectMatrix);for(var renderElements=baseRender._renderElements,j=0,m=renderElements.length;j<m;j++)shadowQueue._addRenderElement(renderElements[j])}}for(i=0;i<8;i++){var child=this._children[i];if(null!=child){var testVisibleChild=testVisible;if(testVisible){var type=lightBoundFrustum.containsBoundBox(child._relaxBox);if(0===type)continue;testVisibleChild=2===type}child.cullingShadowObjectsOnePSSM(lightBoundFrustum,splitShadowQueues,lightViewProjectMatrix,testVisibleChild,flags,scene)}}},__proto.renderBoudingBox=function(linePhasor){this._renderBoudingBox(linePhasor);for(var i=0;i<8;++i){var pChild=this._children[i];pChild&&pChild.renderBoudingBox(linePhasor)}},__proto.buildAllChild=function(depth){if(depth<this._scene.treeLevel)for(var i=0;i<8;i++)this.addChild(i).buildAllChild(depth+1)},__proto._renderBoudingBox=function(linePhasor){},__getset(0,__proto,"exactBox",function(){return this._exactBox},function(value){this._exactBox=value,Vector3.add(value.min,value.max,this._boundingBoxCenter),Vector3.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),__getset(0,__proto,"relaxBox",function(){return this._relaxBox},function(value){(this._relaxBox=value).getCorners(this._corners),BoundSphere.createfromPoints(this._corners,this._boundingSphere)}),OctreeNode.debugMode=!1,OctreeNode.relax=1.15,OctreeNode.CHILDNUM=8,__static(OctreeNode,["tempVector0",function(){return this.tempVector0=new Vector3},"tempSize",function(){return this.tempSize=new Vector3},"tempCenter",function(){return this.tempCenter=new Vector3},"_octreeSplit",function(){return this._octreeSplit=[new Vector3(.25,.25,.25),new Vector3(.75,.25,.25),new Vector3(.25,.75,.25),new Vector3(.75,.75,.25),new Vector3(.25,.25,.75),new Vector3(.75,.25,.75),new Vector3(.25,.75,.75),new Vector3(.75,.75,.75)]}]),OctreeNode}(),Color$1=(function(){function SceneManager(){}__class(SceneManager,"laya.d3.core.scene.SceneManager")}(),__class(Color,"laya.d3.core.trail.module.Color",null,"Color$1"),Color.prototype.cloneTo=function(destObject){destObject._r=this._r,destObject._g=this._g,destObject._b=this._b,destObject._a=this._a},__static(Color,["RED",function(){return this.RED=new Color(1,0,0,1)},"GREEN",function(){return this.GREEN=new Color(0,1,0,1)},"BLUE",function(){return this.BLUE=new Color(0,0,1,1)},"CYAN",function(){return this.CYAN=new Color(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new Color(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new Color(1,0,1,1)},"GRAY",function(){return this.GRAY=new Color(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new Color(1,1,1,1)},"BLACK",function(){return this.BLACK=new Color(0,0,0,1)}]),Color);function Color(r,g,b,a){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===g&&(g=1),void 0===b&&(b=1),void 0===a&&(a=1),this._r=r=void 0===r?1:r,this._g=g,this._b=b,this._a=a}!function(){function Gradient(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}__class(Gradient,"laya.d3.core.trail.module.Gradient");var __proto=Gradient.prototype;__proto.setKeys=function(colorKeys,alphaKeys){this._colorKeys=colorKeys;for(var gradientAlphaKey,i=this.index=0;i<colorKeys.length;i++){var gradientColorKey,color=(gradientColorKey=colorKeys[i]).color;this._colorKeyData[this.index++]=color._r,this._colorKeyData[this.index++]=color._g,this._colorKeyData[this.index++]=color._b,this._colorKeyData[this.index++]=gradientColorKey.time}this._alphaKeys=alphaKeys;for(var j=this.index=0;j<alphaKeys.length;j++)gradientAlphaKey=alphaKeys[j],this._alphaKeyData[this.index++]=gradientAlphaKey.alpha,this._alphaKeyData[this.index++]=gradientAlphaKey.time},__proto.cloneTo=function(destObject){for(var i=0,j=0,cks=this.colorKeys,_cks=[],i=0,j=cks.length;i<j;i++){var _ck=new GradientColorKey;cks[i].cloneTo(_ck),_cks.push(_ck)}var aks=this.alphaKeys,_aks=[];for(i=0,j=aks.length;i<j;i++){var _ak=new GradientAlphaKey;aks[i].cloneTo(_ak),_aks.push(_ak)}destObject.setKeys(_cks,_aks)},__getset(0,__proto,"mode",function(){return this._mode},function(value){this._mode=value}),__getset(0,__proto,"colorKeys",function(){return this._colorKeys},function(values){this._colorKeys=values;for(var i=this.index=0;i<values.length;i++){var value=values[i],color=value.color;this._colorKeyData[this.index++]=color._r,this._colorKeyData[this.index++]=color._g,this._colorKeyData[this.index++]=color._b,this._colorKeyData[this.index++]=value.time}}),__getset(0,__proto,"alphaKeys",function(){return this._alphaKeys},function(values){this._alphaKeys=values;for(var i=this.index=0;i<values.length;i++){var value=values[i];this._alphaKeyData[this.index++]=value.alpha,this._alphaKeyData[this.index++]=value.time}})}();var GradientAlphaKey=function(){function GradientAlphaKey(alpha,time){this._alpha=NaN,this._time=NaN,void 0===time&&(time=0),this._alpha=alpha=void 0===alpha?0:alpha,this._time=time}__class(GradientAlphaKey,"laya.d3.core.trail.module.GradientAlphaKey");var __proto=GradientAlphaKey.prototype;return __proto.cloneTo=function(destObject){destObject.alpha=this.alpha,destObject.time=this.time},__getset(0,__proto,"alpha",function(){return this._alpha},function(value){this._alpha=value}),__getset(0,__proto,"time",function(){return this._time},function(value){this._time=value}),GradientAlphaKey}(),GradientColorKey=function(){function GradientColorKey(color,time){this._color=null,this._time=NaN,void 0===time&&(time=0),this._color=color||new Color$1,this._time=time}__class(GradientColorKey,"laya.d3.core.trail.module.GradientColorKey");var __proto=GradientColorKey.prototype;return __proto.cloneTo=function(destObject){this.color.cloneTo(destObject.color),destObject.time=this.time},__getset(0,__proto,"color",function(){return this._color},function(value){this._color=value}),__getset(0,__proto,"time",function(){return this._time},function(value){this._time=value}),GradientColorKey}(),VertexTrail=(function(){function GradientMode(){}__class(GradientMode,"laya.d3.core.trail.module.GradientMode"),GradientMode.Blend=0,GradientMode.Fixed=1}(),function(){function TextureMode(){}__class(TextureMode,"laya.d3.core.trail.module.TextureMode"),TextureMode.Stretch=0,TextureMode.Tile=1}(),function(){function TrailKeyFrame(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}__class(TrailKeyFrame,"laya.d3.core.trail.module.TrailKeyFrame"),TrailKeyFrame.prototype.cloneTo=function(destObject){destObject.time=this.time,destObject.inTangent=this.inTangent,destObject.outTangent=this.outTangent,destObject.value=this.value}}(),function(){function TrailRenderElement(owner){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new Vector3,this._curPosition=new Vector3,this._delVector3=new Vector3,this._lastFixedVertexPosition=new Vector3,this._pointAtoBVector3=new Vector3,this._pointA=new Vector3,this._pointB=new Vector3,this._owner=owner,this._id=TrailRenderElement.renderElementCount++,(0==this._id?owner._owner.transform.position:owner._curSubTrailFinishPosition).cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new VertexBuffer3D(VertexTrail.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new VertexBuffer3D(VertexTrail.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}__class(TrailRenderElement,"laya.d3.core.trail.TrailRenderElement");var __proto=TrailRenderElement.prototype;Laya.imps(__proto,{"laya.d3.core.render.IRenderable":!0}),__proto._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},__proto._addTrailByFirstPosition=function(firstPosition,secondPosition){Vector3.subtract(secondPosition,firstPosition,this._delVector3),Vector3.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Vector3.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Vector3.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(firstPosition),firstPosition.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},__proto._addTrailByNextPosition=function(position){Vector3.subtract(position,this._lastFixedVertexPosition,this._delVector3),Vector3.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Vector3.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Vector3.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=Vector3.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=MathUtils3D.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(position),position.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(position),this._virtualVerticesCount=2)},__proto._updateVerticesByPosition=function(position){this._pointe=position.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},__proto._updateVertexBuffer2=function(){for(var _uvIndex=0,_uvX=0,i=0,i=0,j=(this._verticesCount+this._virtualVerticesCount)/2;i<j;i++)_uvX=0==this._owner.textureMode?(this._VerticesToTailLength[i]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[i],this._vertices2[_uvIndex++]=1-_uvX,this._vertices2[_uvIndex++]=1-_uvX;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},__proto._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},__proto._updateDisappear=function(){for(var i=0,i=this._curDisappearIndex,j=(this._verticesCount+this._virtualVerticesCount)/2;i<j;i++)this._owner._curtime-this._everyGroupVertexBirthTime[i]>=this._owner.time+MathUtils3D.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2)&&(this._isDead=!0)},__proto._beforeRender=function(state){return this._camera=state.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead)&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),Vector3.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0)},__proto._render=function(state){this._isDead||(WebGL.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),Stat.drawCall++,Stat.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},__proto._getVertexBuffer=function(index){return 0===(index=void 0===index?0:index)?this._vertexBuffer1:1===index?this._vertexBuffer2:null},__proto._getVertexBuffers=function(){return this._vertexBuffers},__proto._getIndexBuffer=function(){return null},__proto.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},__proto._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},__getset(0,__proto,"_vertexBufferCount",function(){return this._vertexBuffers.length}),__getset(0,__proto,"triangleCount",function(){return 0}),TrailRenderElement.renderElementCount=0}(),function(){function VertexTrail(){}__class(VertexTrail,"laya.d3.core.trail.VertexTrail");var __proto=VertexTrail.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexTrail._vertexDeclaration1}),__getset(1,VertexTrail,"vertexDeclaration1",function(){return VertexTrail._vertexDeclaration1}),__getset(1,VertexTrail,"vertexDeclaration2",function(){return VertexTrail._vertexDeclaration2}),__static(VertexTrail,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new VertexDeclaration(32,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",41),new VertexElement(24,"single",33),new VertexElement(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new VertexDeclaration(4,[new VertexElement(0,"single",38)])}]),VertexTrail}()),DynamicBatch=function(){function DynamicBatch(vertexDeclaration){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=vertexDeclaration}__class(DynamicBatch,"laya.d3.graphics.DynamicBatch");var __proto=DynamicBatch.prototype;return Laya.imps(__proto,{"laya.d3.core.render.IRenderable":!0}),__proto._getVertexBuffer=function(index){return 0===(index=void 0===index?0:index)?this._vertexBuffer:null},__proto._getIndexBuffer=function(){return this._indexBuffer},__proto._getCombineRenderElementFromPool=function(view,projection,projectionView){var renderElement=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return renderElement||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=renderElement=new RenderElement,renderElement._sprite3D=new MeshSprite3D),renderElement._sprite3D._render._renderUpdate(projectionView),renderElement},__proto._getRenderElement=function(view,projection,projectionView){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*DynamicBatch.maxVertexCount),this._indexDatas=new Uint16Array(DynamicBatch.maxIndexCount),this._vertexBuffer=VertexBuffer3D.create(this._vertexDeclaration,DynamicBatch.maxVertexCount,35048),this._indexBuffer=IndexBuffer3D.create("ushort",DynamicBatch.maxIndexCount,35048));for(var curMerVerCount=this._merageElements.length=0,curIndexCount=0,i=0,n=this._combineRenderElements.length;i<n;i++){var renderElement=this._combineRenderElements[i],subVertexDatas=renderElement.getDynamicBatchBakedVertexs(0),subIndexDatas=renderElement.getBakedIndices(),isInvert=renderElement._sprite3D.transform._isFrontFaceInvert,indexOffset=curMerVerCount/(this._vertexDeclaration.vertexStride/4),indexStart=curIndexCount,indexEnd=indexStart+subIndexDatas.length,k=(renderElement._tempBatchIndexStart=indexStart,renderElement._tempBatchIndexEnd=indexEnd,this._indexDatas.set(subIndexDatas,curIndexCount),0);if(isInvert)for(k=indexStart;k<indexEnd;k+=3){this._indexDatas[k]=indexOffset+this._indexDatas[k];var index1=this._indexDatas[k+1],index2=this._indexDatas[k+2];this._indexDatas[k+1]=indexOffset+index2,this._indexDatas[k+2]=indexOffset+index1}else for(k=indexStart;k<indexEnd;k+=3)this._indexDatas[k]=indexOffset+this._indexDatas[k],this._indexDatas[k+1]=indexOffset+this._indexDatas[k+1],this._indexDatas[k+2]=indexOffset+this._indexDatas[k+2];curIndexCount+=subIndexDatas.length,this._vertexDatas.set(subVertexDatas,curMerVerCount),curMerVerCount+=subVertexDatas.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),i=this._combineRenderElementPoolIndex=0,n=this._materials.length;i<n;i++){var merageElement=this._getCombineRenderElementFromPool(view,projection,projectionView),renderElementStartIndex=(merageElement._type=2,merageElement._staticBatch=null,(merageElement.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[i]]._tempBatchIndexStart),renderElementEndIndex=i+1===this._materialToRenderElementsOffsets.length?curIndexCount:this._combineRenderElements[this._materialToRenderElementsOffsets[i+1]]._tempBatchIndexStart;merageElement._tempBatchIndexStart=renderElementStartIndex,merageElement._tempBatchIndexEnd=renderElementEndIndex,merageElement._material=this._materials[i],this._merageElements.push(merageElement)}},__proto._addCombineRenderObjTest=function(renderElement){var renderElement=renderElement.renderObj,indexCount=this._currentCombineIndexCount+renderElement._getIndexBuffer().indexCount,renderElement=this._currentCombineVertexCount+renderElement._getVertexBuffer().vertexCount;return!(DynamicBatch.maxVertexCount<renderElement||DynamicBatch.maxIndexCount<indexCount)},__proto._addCombineRenderObj=function(renderElement){var renderObj=renderElement.renderObj;this._combineRenderElements.push(renderElement),this._currentCombineIndexCount=this._currentCombineIndexCount+renderObj._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+renderObj._getVertexBuffer().vertexCount},__proto._addCombineMaterial=function(material){this._materials.push(material)},__proto._addMaterialToRenderElementOffset=function(offset){this._materialToRenderElementsOffsets.push(offset)},__proto._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},__proto._addToRenderQueue=function(scene,view,projection,projectionView){this._getRenderElement(view,projection,projectionView);for(var i=0,n=this._materials.length;i<n;i++)scene.getRenderQueue(this._materials[i].renderQueue)._addDynamicBatchElement(this._merageElements[i])},__proto._beforeRender=function(state){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},__proto._render=function(state){var indexCount=state._batchIndexEnd-state._batchIndexStart;WebGL.mainContext.drawElements(4,indexCount,5123,2*state._batchIndexStart),Stat.drawCall++,Stat.trianglesFaces+=indexCount/3},__proto._getVertexBuffers=function(){return null},__getset(0,__proto,"_vertexBufferCount",function(){return 1}),__getset(0,__proto,"triangleCount",function(){return this._indexBuffer.indexCount/3}),__getset(0,__proto,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),DynamicBatch.maxVertexCount=2e4,DynamicBatch.maxIndexCount=4e4,DynamicBatch.maxCombineTriangleCount=10,DynamicBatch}(),DynamicBatchManager=function(){function DynamicBatchManager(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}__class(DynamicBatchManager,"laya.d3.graphics.DynamicBatchManager");var __proto=DynamicBatchManager.prototype;return __proto.getDynamicBatch=function(_vertexDeclaration,number){var dynamicBatch,number=_vertexDeclaration.id.toString()+number;return this._dynamicBatches[number]?dynamicBatch=this._dynamicBatches[number]:this._dynamicBatches[number]=dynamicBatch=new DynamicBatch(_vertexDeclaration),dynamicBatch},__proto._garbageCollection=function(){for(var key in this._dynamicBatches)0===this._dynamicBatches[key].combineRenderElementsCount&&delete this._dynamicBatches[key]},__proto._addPrepareRenderElement=function(renderElement){this._prepareDynamicBatchCombineElements.push(renderElement)},__proto._finishCombineDynamicBatch=function(scene){this._prepareDynamicBatchCombineElements.sort(DynamicBatchManager._sortPrepareDynamicBatch);for(var lastMaterial,lastVertexDeclaration,curDynamicBatch,laterAddMaterial,laterAddRenderElement,lastBatchNumber=-1,lastCanMerage=!0,curbatchNumber=0,laterAddMatToElementOffset=-1,i=0,n=this._prepareDynamicBatchCombineElements.length;i<n;i++){var curRenderElement,curMaterial,curDeclaration=(curRenderElement=this._prepareDynamicBatchCombineElements[i]).renderObj._getVertexBuffer(0).vertexDeclaration,declarationChanged=lastVertexDeclaration!==curDeclaration,batchNumbrChanged=(declarationChanged&&(curbatchNumber=0,lastVertexDeclaration=curDeclaration),curbatchNumber!==lastBatchNumber);batchNumbrChanged&&(lastBatchNumber=curbatchNumber),(declarationChanged||batchNumbrChanged)&&(curDynamicBatch=this.getDynamicBatch(curDeclaration,curbatchNumber),lastMaterial=null),lastCanMerage?lastCanMerage=curDynamicBatch._addCombineRenderObjTest(curRenderElement)?(lastMaterial!==(curMaterial=curRenderElement._material)?(laterAddMaterial&&(scene.getRenderQueue(laterAddRenderElement._material.renderQueue)._addRenderElement(laterAddRenderElement),laterAddRenderElement=laterAddMaterial=null,laterAddMatToElementOffset=-1),laterAddMaterial=curMaterial,laterAddMatToElementOffset=curDynamicBatch.combineRenderElementsCount,laterAddRenderElement=curRenderElement,lastMaterial=curMaterial):laterAddMaterial?(declarationChanged=laterAddRenderElement.renderObj,batchNumbrChanged=curRenderElement.renderObj,declarationChanged._getVertexBuffer().vertexCount+batchNumbrChanged._getVertexBuffer().vertexCount>DynamicBatch.maxVertexCount||declarationChanged._getIndexBuffer().indexCount+batchNumbrChanged._getIndexBuffer().indexCount>DynamicBatch.maxIndexCount?(scene.getRenderQueue(laterAddRenderElement._material.renderQueue)._addRenderElement(laterAddRenderElement),laterAddMaterial=curMaterial,laterAddMatToElementOffset=curDynamicBatch.combineRenderElementsCount,laterAddRenderElement=curRenderElement):(curDynamicBatch._addCombineMaterial(laterAddMaterial),curDynamicBatch._addMaterialToRenderElementOffset(laterAddMatToElementOffset),curDynamicBatch._addCombineRenderObj(laterAddRenderElement),laterAddRenderElement=laterAddMaterial=null,laterAddMatToElementOffset=-1,curDynamicBatch._addCombineRenderObj(curRenderElement))):curDynamicBatch._addCombineRenderObj(curRenderElement),!0):(laterAddMaterial&&(scene.getRenderQueue(laterAddRenderElement._material.renderQueue)._addRenderElement(laterAddRenderElement),laterAddRenderElement=laterAddMaterial=null,laterAddMatToElementOffset=-1),curbatchNumber++,!1):(curDeclaration=this._prepareDynamicBatchCombineElements[i-1],curDynamicBatch._addMaterialToRenderElementOffset(curDynamicBatch.combineRenderElementsCount),lastMaterial=curDeclaration._material,curDynamicBatch._addCombineMaterial(lastMaterial),curDynamicBatch._addCombineRenderObj(curDeclaration),lastCanMerage=!0,lastMaterial!==(curMaterial=curRenderElement._material)?(laterAddMaterial=curMaterial,laterAddMatToElementOffset=curDynamicBatch.combineRenderElementsCount,laterAddRenderElement=curRenderElement):curDynamicBatch._addCombineRenderObj(curRenderElement),lastMaterial=curMaterial)}laterAddMaterial&&(scene.getRenderQueue(laterAddRenderElement._material.renderQueue)._addRenderElement(laterAddRenderElement),laterAddRenderElement=laterAddMaterial=null,laterAddMatToElementOffset=-1),this._prepareDynamicBatchCombineElements.length=0},__proto._clearRenderElements=function(){for(var key in this._dynamicBatches)this._dynamicBatches[key]._clearRenderElements()},__proto._addToRenderQueue=function(scene,view,projection,projectionView){for(var key in this._dynamicBatches){key=this._dynamicBatches[key];0<key.combineRenderElementsCount&&key._addToRenderQueue(scene,view,projection,projectionView)}},__proto.dispose=function(){this._dynamicBatches=null},DynamicBatchManager._sortPrepareDynamicBatch=function(a,b){return a._mainSortID-b._mainSortID},DynamicBatchManager}(),FrustumCulling=function(){function FrustumCulling(){}return __class(FrustumCulling,"laya.d3.graphics.FrustumCulling"),FrustumCulling.renderShadowObjectCulling=function(scene,lightFrustum,shadowQueues,lightViewProjectMatrix,nPSSMNum){for(var i=0,j=0,n=0,m=0,i=0,n=shadowQueues.length;i<n;i++){var quene=shadowQueues[i];quene&&quene._clearRenderElements()}var baseRender,shadowQueue,renderElements,frustumCullingObjects=scene._cullingRenders;if(1<nPSSMNum){for(i=0,n=scene._cullingRendersLength;i<n;i++)if((baseRender=frustumCullingObjects[i]).castShadow&&Layer.isVisible(baseRender._owner.layer.mask)&&baseRender.enable)for(var k=1,kNum=lightFrustum.length;k<kNum;k++)if(shadowQueue=shadowQueues[k-1],0!==lightFrustum[k].containsBoundSphere(baseRender.boundingSphere))for(j=0,m=(renderElements=baseRender._renderElements).length;j<m;j++)shadowQueue._addRenderElement(renderElements[j])}else for(i=0,n=scene._cullingRendersLength;i<n;i++)if((baseRender=frustumCullingObjects[i]).castShadow&&Layer.isVisible(baseRender._owner.layer.mask)&&baseRender.enable&&0!==lightFrustum[0].containsBoundSphere(baseRender.boundingSphere))for(baseRender._renderUpdate(lightViewProjectMatrix),shadowQueue=shadowQueues[0],j=0,m=(renderElements=baseRender._renderElements).length;j<m;j++)shadowQueue._addRenderElement(renderElements[j])},FrustumCulling.renderShadowObjectCullingOctree=function(scene,lightFrustum,quenesResult,lightViewProjectMatrix,nPSSMNum){for(var i=0,n=quenesResult.length;i<n;i++){var quene=quenesResult[i];quene&&quene._clearRenderElements()}1<nPSSMNum?scene.treeRoot.cullingShadowObjects(lightFrustum,quenesResult,!0,0,scene):scene.treeRoot.cullingShadowObjectsOnePSSM(lightFrustum[0],quenesResult,lightViewProjectMatrix,!0,0,scene)},FrustumCulling.renderObjectCulling=function(boundFrustum,scene,camera,view,projection,projectionView){for(var i=0,n=0,j=0,queues=scene._quenes,dynamicBatchManager=scene._dynamicBatchManager,frustumCullingObjects=scene._cullingRenders,i=0,n=queues.length;i<n;i++){var queue=queues[i];queue&&queue._clearRenderElements()}var staticBatchManagers=StaticBatchManager._staticBatchManagers;for(i=0,n=staticBatchManagers.length;i<n;i++)staticBatchManagers[i]._clearRenderElements();dynamicBatchManager._clearRenderElements();var cameraPosition=camera.transform.position;for(i=0,n=scene._cullingRendersLength;i<n;i++){var baseRender=frustumCullingObjects[i];if(Layer.isVisible(baseRender._owner.layer.mask)&&baseRender.enable&&0!==boundFrustum.containsBoundSphere(baseRender.boundingSphere)&&baseRender._renderUpdate(projectionView)){baseRender._distanceForSort=Vector3.distance(baseRender.boundingSphere.center,cameraPosition)+baseRender.sortingFudge;for(var renderElements=baseRender._renderElements,j=0,m=renderElements.length;j<m;j++){var renderElement=renderElements[j],staticBatch=renderElement._staticBatch;staticBatch&&staticBatch._material===renderElement._material?staticBatch._addBatchRenderElement(renderElement):(staticBatch=renderElement.renderObj).triangleCount<10&&1===staticBatch._vertexBufferCount&&staticBatch._getIndexBuffer()&&renderElement._material.renderQueue<2&&renderElement._canDynamicBatch&&!baseRender._owner.isStatic?dynamicBatchManager._addPrepareRenderElement(renderElement):scene.getRenderQueue(renderElement._material.renderQueue)._addRenderElement(renderElement)}}}for(i=0,n=staticBatchManagers.length;i<n;i++)staticBatchManagers[i]._addToRenderQueue(scene,view,projection,projectionView);dynamicBatchManager._finishCombineDynamicBatch(scene),dynamicBatchManager._addToRenderQueue(scene,view,projection,projectionView)},FrustumCulling.renderObjectCullingOctree=function(boundFrustum,scene,camera,view,projection,projectionView){for(var i=0,n=0,queues=scene._quenes,dynamicBatchManager=scene._dynamicBatchManager,i=0,n=queues.length;i<n;i++){var queue=queues[i];queue&&queue._clearRenderElements()}var staticBatchManagers=StaticBatchManager._staticBatchManagers;for(i=0,n=staticBatchManagers.length;i<n;i++)staticBatchManagers[i]._clearRenderElements();for(dynamicBatchManager._clearRenderElements(),scene._cullingRenders.length=0,scene.treeRoot.cullingObjects(boundFrustum,!0,0,camera.transform.position,projectionView),i=0,n=staticBatchManagers.length;i<n;i++)staticBatchManagers[i]._addToRenderQueue(scene,view,projection,projectionView);dynamicBatchManager._finishCombineDynamicBatch(scene),dynamicBatchManager._addToRenderQueue(scene,view,projection,projectionView)},FrustumCulling.renderObjectCullingNoBoundFrustum=function(scene,camera,view,projection,projectionView){for(var i=0,n=0,j=0,queues=scene._quenes,dynamicBatchManager=scene._dynamicBatchManager,frustumCullingObjects=scene._cullingRenders,i=0,n=queues.length;i<n;i++){var queue=queues[i];queue&&queue._clearRenderElements()}var staticBatchManagers=StaticBatchManager._staticBatchManagers;for(i=0,n=staticBatchManagers.length;i<n;i++)staticBatchManagers[i]._clearRenderElements();dynamicBatchManager._clearRenderElements();var cameraPosition=camera.transform.position;for(i=0,n=scene._cullingRendersLength;i<n;i++){var baseRender=frustumCullingObjects[i];if(Layer.isVisible(baseRender._owner.layer.mask)&&baseRender.enable){baseRender._renderUpdate(projectionView),baseRender._distanceForSort=Vector3.distance(baseRender.boundingSphere.center,cameraPosition)+baseRender.sortingFudge;for(var renderElements=baseRender._renderElements,j=0,m=renderElements.length;j<m;j++){var renderElement=renderElements[j],staticBatch=renderElement._staticBatch;staticBatch&&staticBatch._material===renderElement._material?staticBatch._addBatchRenderElement(renderElement):(staticBatch=renderElement.renderObj).triangleCount<10&&1===staticBatch._vertexBufferCount&&staticBatch._getIndexBuffer()&&renderElement._material.renderQueue<2&&renderElement._canDynamicBatch&&!baseRender._owner.isStatic?dynamicBatchManager._addPrepareRenderElement(renderElement):scene.getRenderQueue(renderElement._material.renderQueue)._addRenderElement(renderElement)}}}for(i=0,n=staticBatchManagers.length;i<n;i++)staticBatchManagers[i]._addToRenderQueue(scene,view,projection,projectionView);dynamicBatchManager._finishCombineDynamicBatch(scene),dynamicBatchManager._addToRenderQueue(scene,view,projection,projectionView)},FrustumCulling}(),StaticBatchManager=function(){function StaticBatchManager(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}__class(StaticBatchManager,"laya.d3.graphics.StaticBatchManager");var __proto=StaticBatchManager.prototype;return __proto._finishInit=function(){for(var key in this._staticBatches)this._staticBatches[key]._finishInit();this._initBatchRenderElements.length=0},__proto._initStaticBatchs=function(rootSprite){throw new Error("StaticBatchManager:must override this function.")},__proto._addInitBatchSprite=function(renderableSprite3D){for(var renderElements=renderableSprite3D._render._renderElements,i=0,n=renderElements.length;i<n;i++)this._initBatchRenderElements.push(renderElements[i])},__proto._clearRenderElements=function(){for(var key in this._staticBatches)this._staticBatches[key]._clearRenderElements()},__proto._garbageCollection=function(renderElement){var staticBatch=renderElement._staticBatch,initBatchRenderElements=staticBatch._initBatchRenderElements,renderElement=initBatchRenderElements.indexOf(renderElement);initBatchRenderElements.splice(renderElement,1),0===initBatchRenderElements.length&&(staticBatch.dispose(),delete this._staticBatches[staticBatch._key])},__proto._addToRenderQueue=function(scene,view,projection,projectionView){for(var key in this._staticBatches){key=this._staticBatches[key];0<key._batchRenderElements.length&&key._updateToRenderQueue(scene,projectionView)}},__proto.dispose=function(){this._staticBatches=null},StaticBatchManager._addToStaticBatchQueue=function(sprite3D){sprite3D instanceof laya.d3.core.RenderableSprite3D&&sprite3D._addToInitStaticBatchManager();for(var i=0,n=sprite3D.numChildren;i<n;i++)StaticBatchManager._addToStaticBatchQueue(sprite3D._childs[i])},StaticBatchManager.combine=function(staticBatchRoot,renderableSprite3Ds){var staticBatchManager,i=0,n=0;if(renderableSprite3Ds)for(i=0,n=renderableSprite3Ds.length;i<n;i++)renderableSprite3Ds[i]._addToInitStaticBatchManager();else staticBatchRoot&&StaticBatchManager._addToStaticBatchQueue(staticBatchRoot);for(i=0,n=StaticBatchManager._staticBatchManagers.length;i<n;i++)(staticBatchManager=StaticBatchManager._staticBatchManagers[i])._initStaticBatchs(staticBatchRoot),staticBatchManager._finishInit()},StaticBatchManager._staticBatchManagers=[],StaticBatchManager}(),StaticBatch=function(){function StaticBatch(key,manager,rootOwner){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=key,this._manager=manager,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=rootOwner}__class(StaticBatch,"laya.d3.graphics.StaticBatch");var __proto=StaticBatch.prototype;return Laya.imps(__proto,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),__proto._binarySearch=function(renderElement){for(var mid,start=0,end=this._batchRenderElements.length-1;start<=end;)mid=Math.floor((start+end)/2),this._compareBatchRenderElement(this._batchRenderElements[mid],renderElement)?end=mid-1:start=mid+1;return start},__proto._compareBatchRenderElement=function(a,b){throw new Error("StaticBatch:must override this function.")},__proto._getVertexDecLightMap=function(vertexDeclaration){return vertexDeclaration===VertexPositionNormalTextureSkinSTangent.vertexDeclaration?VertexPositionNormalTexture0Texture1SkinSTangent.vertexDeclaration:vertexDeclaration===VertexPositionNormalTextureSkin.vertexDeclaration?VertexPositionNormalTexture0Texture1Skin.vertexDeclaration:vertexDeclaration===VertexPositionNormalColorTextureSTangent.vertexDeclaration?VertexPositionNormalColorTexture0Texture1STangent.vertexDeclaration:vertexDeclaration===VertexPositionNTBTexture.vertexDeclaration?null:vertexDeclaration===VertexPositionNormalColorTexture.vertexDeclaration?VertexPositionNormalColorTexture0Texture1.vertexDeclaration:vertexDeclaration===VertexPositionNormalTextureSTangent.vertexDeclaration?VertexPositionNormalTexture0Texture1STangent.vertexDeclaration:vertexDeclaration===VertexPositionNormalTexture.vertexDeclaration?VertexPositionNormalTexture0Texture1.vertexDeclaration:vertexDeclaration===VertexPositionNormalTextureSkinTangent.vertexDeclaration?VertexPositionNormalTexture0Texture1SkinTangent.vertexDeclaration:vertexDeclaration===VertexPositionNormalTextureSkin.vertexDeclaration?VertexPositionNormalTexture0Texture1Skin.vertexDeclaration:vertexDeclaration===VertexPositionNormalColorTextureTangent.vertexDeclaration?VertexPositionNormalColorTexture0Texture1Tangent.vertexDeclaration:vertexDeclaration===VertexPositionNTBTexture.vertexDeclaration?null:vertexDeclaration===VertexPositionNormalColorTexture.vertexDeclaration?VertexPositionNormalColorTexture0Texture1.vertexDeclaration:vertexDeclaration===VertexPositionNormalTextureTangent.vertexDeclaration?VertexPositionNormalTexture0Texture1Tangent.vertexDeclaration:vertexDeclaration===VertexPositionNormalTexture.vertexDeclaration?VertexPositionNormalTexture0Texture1.vertexDeclaration:vertexDeclaration},__proto._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},__proto._addBatchRenderElement=function(renderElement){this._batchRenderElements.splice(this._binarySearch(renderElement),0,renderElement)},__proto._updateToRenderQueue=function(scene,projectionView){this._combineRenderElementPoolIndex=0,this._getRenderElement(scene.getRenderQueue(this._material.renderQueue)._renderElements,scene,projectionView)},__proto._getRenderElement=function(mergeElements,scene,projectionView){throw new Error("StaticBatch:must override this function.")},__proto._finishInit=function(){throw new Error("StaticBatch:must override this function.")},__proto._clearRenderElements=function(){this._batchRenderElements.length=0},__proto.dispose=function(){},__proto._getVertexBuffer=function(index){return void 0===index&&(index=0),null},__proto._getIndexBuffer=function(){return null},__proto._beforeRender=function(state){return!0},__proto._render=function(state){},__proto._getVertexBuffers=function(){return null},__getset(0,__proto,"_vertexBufferCount",function(){return 1}),__getset(0,__proto,"triangleCount",function(){return 0}),StaticBatch.combine=function(staticBatchRoot){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),StaticBatchManager.combine(staticBatchRoot)},StaticBatch.maxBatchVertexCount=65535,StaticBatch}(),VertexDeclaration=function(){function VertexDeclaration(vertexStride,vertexElements){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++VertexDeclaration._uniqueIDCounter,this._id>VertexDeclaration.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",VertexDeclaration.maxVertexDeclaration);this._shaderValues=new ValusArray,this._vertexElementsDic={},this._vertexStride=vertexStride,this._vertexElements=vertexElements;for(var i=0;i<vertexElements.length;i++){var vertexElement=vertexElements[i],attributeName=vertexElement.elementUsage,vertexElement=(this._vertexElementsDic[attributeName]=vertexElement,[VertexDeclaration._getTypeSize(vertexElement.elementFormat)/4,5126,!1,this._vertexStride,vertexElement.offset]);switch(this._shaderValues.setValue(attributeName,vertexElement),attributeName){case 1:this._addShaderDefine(ShaderCompile3D.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(ShaderCompile3D.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(ShaderCompile3D.SHADERDEFINE_UV1)}}}__class(VertexDeclaration,"laya.d3.graphics.VertexDeclaration");var __proto=VertexDeclaration.prototype;return __proto._addShaderDefine=function(value){this._shaderDefineValue|=value},__proto._removeShaderDefine=function(value){this._shaderDefineValue&=~value},__proto.getVertexElements=function(){return this._vertexElements.slice()},__proto.getVertexElementByUsage=function(usage){return this._vertexElementsDic[usage]},__proto.unBinding=function(){},__getset(0,__proto,"shaderDefineValue",function(){return this._shaderDefineValue}),__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"vertexStride",function(){return this._vertexStride}),__getset(0,__proto,"shaderValues",function(){return this._shaderValues}),VertexDeclaration._getTypeSize=function(format){switch(format){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},VertexDeclaration.getVertexStride=function(vertexElements){for(var curStride=0,i=0;i<vertexElements.Length;i++){var element=vertexElements[i],element=element.offset+VertexDeclaration._getTypeSize(element.elementFormat);curStride<element&&(curStride=element)}return curStride},VertexDeclaration._maxVertexDeclarationBit=1e3,VertexDeclaration._uniqueIDCounter=1,__static(VertexDeclaration,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),VertexDeclaration}(),VertexElement=function(){function VertexElement(offset,elementFormat,elementUsage){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=offset,this.elementFormat=elementFormat,this.elementUsage=elementUsage}return __class(VertexElement,"laya.d3.graphics.VertexElement"),VertexElement}(),VertexPosition=(function(){function VertexElementFormat(){}__class(VertexElementFormat,"laya.d3.graphics.VertexElementFormat"),VertexElementFormat.Single="single",VertexElementFormat.Vector2="vector2",VertexElementFormat.Vector3="vector3",VertexElementFormat.Vector4="vector4",VertexElementFormat.Color="color",VertexElementFormat.Byte4="byte4",VertexElementFormat.Short2="short2",VertexElementFormat.Short4="short4",VertexElementFormat.NormalizedShort2="normalizedshort2",VertexElementFormat.NormalizedShort4="normalizedshort4",VertexElementFormat.HalfVector2="halfvector2",VertexElementFormat.HalfVector4="halfvector4"}(),function(){function VertexElementUsage(){}__class(VertexElementUsage,"laya.d3.graphics.VertexElementUsage"),VertexElementUsage.POSITION0=0,VertexElementUsage.COLOR0=1,VertexElementUsage.TEXTURECOORDINATE0=2,VertexElementUsage.NORMAL0=3,VertexElementUsage.BINORMAL0=4,VertexElementUsage.TANGENT0=5,VertexElementUsage.BLENDINDICES0=6,VertexElementUsage.BLENDWEIGHT0=7,VertexElementUsage.DEPTH0=8,VertexElementUsage.FOG0=9,VertexElementUsage.POINTSIZE0=10,VertexElementUsage.SAMPLE0=11,VertexElementUsage.TESSELLATEFACTOR0=12,VertexElementUsage.COLOR1=13,VertexElementUsage.NEXTTEXTURECOORDINATE0=14,VertexElementUsage.TEXTURECOORDINATE1=15,VertexElementUsage.NEXTTEXTURECOORDINATE1=16,VertexElementUsage.CORNERTEXTURECOORDINATE0=17,VertexElementUsage.VELOCITY0=18,VertexElementUsage.STARTCOLOR0=19,VertexElementUsage.STARTSIZE=20,VertexElementUsage.AGEADDSCALE0=21,VertexElementUsage.STARTROTATION=22,VertexElementUsage.ENDCOLOR0=23,VertexElementUsage.STARTLIFETIME=24,VertexElementUsage.TIME0=33,VertexElementUsage.SHAPEPOSITIONSTARTLIFETIME=30,VertexElementUsage.DIRECTIONTIME=32,VertexElementUsage.SIZEROTATION0=27,VertexElementUsage.RADIUS0=28,VertexElementUsage.RADIAN0=29,VertexElementUsage.STARTSPEED=31,VertexElementUsage.RANDOM0=34,VertexElementUsage.RANDOM1=35,VertexElementUsage.SIMULATIONWORLDPOSTION=36,VertexElementUsage.SIMULATIONWORLDROTATION=37,VertexElementUsage.TEXTURECOORDINATE0X=38,VertexElementUsage.TEXTURECOORDINATE0X1=39,VertexElementUsage.TEXTURECOORDINATE0Y=40,VertexElementUsage.OFFSETVECTOR=41}(),function(){function VertexGlitter(position,textureCoordinate,time){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=position,this._textureCoordinate0=textureCoordinate,this._time=time}__class(VertexGlitter,"laya.d3.graphics.VertexGlitter");var __proto=VertexGlitter.prototype;Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate0}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"time",function(){return this._time}),__getset(0,__proto,"vertexDeclaration",function(){return VertexGlitter._vertexDeclaration}),__getset(1,VertexGlitter,"vertexDeclaration",function(){return VertexGlitter._vertexDeclaration}),__static(VertexGlitter,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(24,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector2",2),new VertexElement(20,"single",33)])}])}(),function(){function VertexParticle(cornerTextureCoordinate,position,velocity,startColor,endColor,sizeRotation,radius,radian,ageAddScale,time){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=cornerTextureCoordinate,this._position=position,this._velocity=velocity,this._startColor=startColor,this._endColor=endColor,this._sizeRotation=sizeRotation,this._radius=radius,this._radian=radian,this._ageAddScale=ageAddScale,this._time=time}__class(VertexParticle,"laya.d3.graphics.VertexParticle");var __proto=VertexParticle.prototype;Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"endColor",function(){return this._endColor}),__getset(0,__proto,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),__getset(0,__proto,"sizeRotation",function(){return this._sizeRotation}),__getset(0,__proto,"velocity",function(){return this._velocity}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"startColor",function(){return this._startColor}),__getset(0,__proto,"radius",function(){return this._radius}),__getset(0,__proto,"radian",function(){return this._radian}),__getset(0,__proto,"ageAddScale",function(){return this._ageAddScale}),__getset(0,__proto,"time",function(){return this._time}),__getset(0,__proto,"vertexDeclaration",function(){return VertexParticle._vertexDeclaration}),__getset(1,VertexParticle,"vertexDeclaration",function(){return VertexParticle._vertexDeclaration}),__static(VertexParticle,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(116,[new VertexElement(0,"vector4",17),new VertexElement(16,"vector3",0),new VertexElement(28,"vector3",18),new VertexElement(40,"vector4",19),new VertexElement(56,"vector4",23),new VertexElement(72,"vector3",27),new VertexElement(84,"vector2",28),new VertexElement(92,"vector4",29),new VertexElement(108,"single",24),new VertexElement(112,"single",33)])}])}(),function(){function VertexPosition(position){this._position=null,this._position=position}__class(VertexPosition,"laya.d3.graphics.VertexPosition");var __proto=VertexPosition.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPosition._vertexDeclaration}),__getset(1,VertexPosition,"vertexDeclaration",function(){return VertexPosition._vertexDeclaration}),__static(VertexPosition,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(12,[new VertexElement(0,"vector3",0)])}]),VertexPosition}()),VertexPositionNormal=function(){function VertexPositionNormal(position,normal){this._position=null,this._normal=null,this._position=position,this._normal=normal}__class(VertexPositionNormal,"laya.d3.graphics.VertexPositionNormal");var __proto=VertexPositionNormal.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormal._vertexDeclaration}),__getset(1,VertexPositionNormal,"vertexDeclaration",function(){return VertexPositionNormal._vertexDeclaration}),__static(VertexPositionNormal,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(24,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3)])}]),VertexPositionNormal}(),VertexPositionNormalColor=function(){function VertexPositionNormalColor(position,normal,color){this._position=null,this._normal=null,this._color=null,this._position=position,this._normal=normal,this._color=color}__class(VertexPositionNormalColor,"laya.d3.graphics.VertexPositionNormalColor");var __proto=VertexPositionNormalColor.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColor._vertexDeclaration}),__getset(1,VertexPositionNormalColor,"vertexDeclaration",function(){return VertexPositionNormalColor._vertexDeclaration}),__static(VertexPositionNormalColor,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1)])}]),VertexPositionNormalColor}(),VertexPositionNormalColorSkin=function(){function VertexPositionNormalColorSkin(position,normal,color,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=position,this._normal=normal,this._color=color,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorSkin,"laya.d3.graphics.VertexPositionNormalColorSkin");var __proto=VertexPositionNormalColorSkin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorSkin._vertexDeclaration}),__getset(1,VertexPositionNormalColorSkin,"vertexDeclaration",function(){return VertexPositionNormalColorSkin._vertexDeclaration}),__static(VertexPositionNormalColorSkin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(72,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6)])}]),VertexPositionNormalColorSkin}(),VertexPositionNormalColorSkinSTangent=function(){function VertexPositionNormalColorSkinSTangent(position,normal,color,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorSkinSTangent,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var __proto=VertexPositionNormalColorSkinSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorSkinSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorSkinSTangent,"vertexDeclaration",function(){return VertexPositionNormalColorSkinSTangent._vertexDeclaration}),__static(VertexPositionNormalColorSkinSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector4",5)])}]),VertexPositionNormalColorSkinSTangent}(),VertexPositionNormalColorSkinTangent=function(){function VertexPositionNormalColorSkinTangent(position,normal,color,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorSkinTangent,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var __proto=VertexPositionNormalColorSkinTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorSkinTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorSkinTangent,"vertexDeclaration",function(){return VertexPositionNormalColorSkinTangent._vertexDeclaration}),__static(VertexPositionNormalColorSkinTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(84,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector3",5)])}]),VertexPositionNormalColorSkinTangent}(),VertexPositionNormalColorSTangent=function(){function VertexPositionNormalColorSTangent(position,normal,color,tangent){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._tangent=tangent}__class(VertexPositionNormalColorSTangent,"laya.d3.graphics.VertexPositionNormalColorSTangent");var __proto=VertexPositionNormalColorSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorSTangent,"vertexDeclaration",function(){return VertexPositionNormalColorSTangent._vertexDeclaration}),__static(VertexPositionNormalColorSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector4",5)])}]),VertexPositionNormalColorSTangent}(),VertexPositionNormalColorTangent=function(){function VertexPositionNormalColorTangent(position,normal,color,tangent){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._tangent=tangent}__class(VertexPositionNormalColorTangent,"laya.d3.graphics.VertexPositionNormalColorTangent");var __proto=VertexPositionNormalColorTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTangent._vertexDeclaration}),__static(VertexPositionNormalColorTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(52,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector3",5)])}]),VertexPositionNormalColorTangent}(),VertexPositionNormalColorTexture=function(){function VertexPositionNormalColorTexture(position,normal,color,textureCoordinate){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate=textureCoordinate}__class(VertexPositionNormalColorTexture,"laya.d3.graphics.VertexPositionNormalColorTexture");var __proto=VertexPositionNormalColorTexture.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture._vertexDeclaration}),__getset(1,VertexPositionNormalColorTexture,"vertexDeclaration",function(){return VertexPositionNormalColorTexture._vertexDeclaration}),__static(VertexPositionNormalColorTexture,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(48,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2)])}]),VertexPositionNormalColorTexture}(),VertexPositionNormalColorTexture0Texture1=function(){function VertexPositionNormalColorTexture0Texture1(position,normal,color,textureCoordinate0,textureCoordinate1){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1}__class(VertexPositionNormalColorTexture0Texture1,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var __proto=VertexPositionNormalColorTexture0Texture1.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,VertexPositionNormalColorTexture0Texture1,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1._vertexDeclaration}),__static(VertexPositionNormalColorTexture0Texture1,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15)])}]),VertexPositionNormalColorTexture0Texture1}(),VertexPositionNormalColorTexture0Texture1Skin=function(){function VertexPositionNormalColorTexture0Texture1Skin(position,normal,color,textureCoordinate0,textureCoordinate1,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorTexture0Texture1Skin,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var __proto=VertexPositionNormalColorTexture0Texture1Skin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1Skin._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(1,VertexPositionNormalColorTexture0Texture1Skin,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1Skin._vertexDeclaration}),__static(VertexPositionNormalColorTexture0Texture1Skin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6)])}]),VertexPositionNormalColorTexture0Texture1Skin}(),VertexPositionNormalColorTexture0Texture1SkinSTangent=function(){function VertexPositionNormalColorTexture0Texture1SkinSTangent(position,normal,color,textureCoordinate0,textureCoordinate1,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorTexture0Texture1SkinSTangent,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var __proto=VertexPositionNormalColorTexture0Texture1SkinSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1SkinSTangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(1,VertexPositionNormalColorTexture0Texture1SkinSTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1SkinSTangent._vertexDeclaration}),__static(VertexPositionNormalColorTexture0Texture1SkinSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(104,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6),new VertexElement(88,"vector4",5)])}]),VertexPositionNormalColorTexture0Texture1SkinSTangent}(),VertexPositionNormalColorTexture0Texture1SkinTangent=function(){function VertexPositionNormalColorTexture0Texture1SkinTangent(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}__class(VertexPositionNormalColorTexture0Texture1SkinTangent,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var __proto=VertexPositionNormalColorTexture0Texture1SkinTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__proto.VertexPositionNormalColorTexture0SkinTangent=function(position,normal,color,textureCoordinate0,textureCoordinate1,tangent,blendIndex,blendWeight){this._position=position,this._normal=normal,this._color=color,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight},__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1SkinTangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(1,VertexPositionNormalColorTexture0Texture1SkinTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1SkinTangent._vertexDeclaration}),__static(VertexPositionNormalColorTexture0Texture1SkinTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(100,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6),new VertexElement(88,"vector3",5)])}]),VertexPositionNormalColorTexture0Texture1SkinTangent}(),VertexPositionNormalColorTexture0Texture1STangent=function(){function VertexPositionNormalColorTexture0Texture1STangent(position,normal,color,textureCoordinate0,textureCoordinate1,tangent){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent}__class(VertexPositionNormalColorTexture0Texture1STangent,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var __proto=VertexPositionNormalColorTexture0Texture1STangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1STangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,VertexPositionNormalColorTexture0Texture1STangent,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1STangent._vertexDeclaration}),__static(VertexPositionNormalColorTexture0Texture1STangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(72,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector4",5)])}]),VertexPositionNormalColorTexture0Texture1STangent}(),VertexPositionNormalColorTexture0Texture1Tangent=function(){function VertexPositionNormalColorTexture0Texture1Tangent(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}__class(VertexPositionNormalColorTexture0Texture1Tangent,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var __proto=VertexPositionNormalColorTexture0Texture1Tangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__proto.VertexPositionNormalColorTexture0Tangent=function(position,normal,color,textureCoordinate0,textureCoordinate1,tangent){this._position=position,this._normal=normal,this._color=color,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent},__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1Tangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,VertexPositionNormalColorTexture0Texture1Tangent,"vertexDeclaration",function(){return VertexPositionNormalColorTexture0Texture1Tangent._vertexDeclaration}),__static(VertexPositionNormalColorTexture0Texture1Tangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(68,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector2",15),new VertexElement(56,"vector3",5)])}]),VertexPositionNormalColorTexture0Texture1Tangent}(),VertexPositionNormalColorTextureSkin=function(){function VertexPositionNormalColorTextureSkin(position,normal,color,textureCoordinate,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate=textureCoordinate,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorTextureSkin,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var __proto=VertexPositionNormalColorTextureSkin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSkin._vertexDeclaration}),__getset(1,VertexPositionNormalColorTextureSkin,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSkin._vertexDeclaration}),__static(VertexPositionNormalColorTextureSkin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(80,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",7),new VertexElement(64,"vector4",6)])}]),VertexPositionNormalColorTextureSkin}(),VertexPositionNormalColorTextureSkinSTangent=function(){function VertexPositionNormalColorTextureSkinSTangent(position,normal,color,textureCoordinate,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate=textureCoordinate,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorTextureSkinSTangent,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var __proto=VertexPositionNormalColorTextureSkinSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSkinSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorTextureSkinSTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSkinSTangent._vertexDeclaration}),__static(VertexPositionNormalColorTextureSkinSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(96,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",7),new VertexElement(64,"vector4",6),new VertexElement(80,"vector4",5)])}]),VertexPositionNormalColorTextureSkinSTangent}(),VertexPositionNormalColorTextureSkinTangent=function(){function VertexPositionNormalColorTextureSkinTangent(position,normal,color,textureCoordinate,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate=textureCoordinate,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalColorTextureSkinTangent,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var __proto=VertexPositionNormalColorTextureSkinTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSkinTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorTextureSkinTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSkinTangent._vertexDeclaration}),__static(VertexPositionNormalColorTextureSkinTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(92,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",7),new VertexElement(64,"vector4",6),new VertexElement(80,"vector3",5)])}]),VertexPositionNormalColorTextureSkinTangent}(),VertexPositionNormalColorTextureSTangent=function(){function VertexPositionNormalColorTextureSTangent(position,normal,color,textureCoordinate,tangent){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate=textureCoordinate,this._tangent=tangent}__class(VertexPositionNormalColorTextureSTangent,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var __proto=VertexPositionNormalColorTextureSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorTextureSTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTextureSTangent._vertexDeclaration}),__static(VertexPositionNormalColorTextureSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(64,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector4",5)])}]),VertexPositionNormalColorTextureSTangent}(),VertexPositionNormalColorTextureTangent=function(){function VertexPositionNormalColorTextureTangent(position,normal,color,textureCoordinate,tangent){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=position,this._normal=normal,this._color=color,this._textureCoordinate=textureCoordinate,this._tangent=tangent}__class(VertexPositionNormalColorTextureTangent,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var __proto=VertexPositionNormalColorTextureTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"color",function(){return this._color}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalColorTextureTangent._vertexDeclaration}),__getset(1,VertexPositionNormalColorTextureTangent,"vertexDeclaration",function(){return VertexPositionNormalColorTextureTangent._vertexDeclaration}),__static(VertexPositionNormalColorTextureTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(60,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",1),new VertexElement(40,"vector2",2),new VertexElement(48,"vector3",5)])}]),VertexPositionNormalColorTextureTangent}(),VertexPositionNormalSTangent=function(){function VertexPositionNormalSTangent(position,normal,tangent){this._position=null,this._normal=null,this._tangent=null,this._position=position,this._normal=normal,this._tangent=tangent}__class(VertexPositionNormalSTangent,"laya.d3.graphics.VertexPositionNormalSTangent");var __proto=VertexPositionNormalSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalSTangent,"vertexDeclaration",function(){return VertexPositionNormalSTangent._vertexDeclaration}),__static(VertexPositionNormalSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector4",5)])}]),VertexPositionNormalSTangent}(),VertexPositionNormalTangent=function(){function VertexPositionNormalTangent(position,normal,tangent){this._position=null,this._normal=null,this._tangent=null,this._position=position,this._normal=normal,this._tangent=tangent}__class(VertexPositionNormalTangent,"laya.d3.graphics.VertexPositionNormalTangent");var __proto=VertexPositionNormalTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTangent._vertexDeclaration}),__getset(1,VertexPositionNormalTangent,"vertexDeclaration",function(){return VertexPositionNormalTangent._vertexDeclaration}),__static(VertexPositionNormalTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(36,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5)])}]),VertexPositionNormalTangent}(),VertexPositionNormalTexture=function(){function VertexPositionNormalTexture(position,normal,textureCoordinate){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate}__class(VertexPositionNormalTexture,"laya.d3.graphics.VertexPositionNormalTexture");var __proto=VertexPositionNormalTexture.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture._vertexDeclaration}),__getset(1,VertexPositionNormalTexture,"vertexDeclaration",function(){return VertexPositionNormalTexture._vertexDeclaration}),__static(VertexPositionNormalTexture,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(32,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2)])}]),VertexPositionNormalTexture}(),VertexPositionNormalTexture0Texture1=function(){function VertexPositionNormalTexture0Texture1(position,normal,textureCoordinate0,textureCoordinate1){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1}__class(VertexPositionNormalTexture0Texture1,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var __proto=VertexPositionNormalTexture0Texture1.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,VertexPositionNormalTexture0Texture1,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1._vertexDeclaration}),__static(VertexPositionNormalTexture0Texture1,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15)])}]),VertexPositionNormalTexture0Texture1}(),VertexPositionNormalTexture0Texture1Skin=function(){function VertexPositionNormalTexture0Texture1Skin(position,normal,textureCoordinate0,textureCoordinate1,blendIndex,blendWeight){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalTexture0Texture1Skin,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var __proto=VertexPositionNormalTexture0Texture1Skin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1Skin._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(1,VertexPositionNormalTexture0Texture1Skin,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1Skin._vertexDeclaration}),__static(VertexPositionNormalTexture0Texture1Skin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(72,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6)])}]),VertexPositionNormalTexture0Texture1Skin}(),VertexPositionNormalTexture0Texture1SkinSTangent=function(){function VertexPositionNormalTexture0Texture1SkinSTangent(position,normal,textureCoordinate0,textureCoordinate1,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalTexture0Texture1SkinSTangent,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var __proto=VertexPositionNormalTexture0Texture1SkinSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1SkinSTangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(1,VertexPositionNormalTexture0Texture1SkinSTangent,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1SkinSTangent._vertexDeclaration}),__static(VertexPositionNormalTexture0Texture1SkinSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector4",5)])}]),VertexPositionNormalTexture0Texture1SkinSTangent}(),VertexPositionNormalTexture0Texture1SkinTangent=function(){function VertexPositionNormalTexture0Texture1SkinTangent(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}__class(VertexPositionNormalTexture0Texture1SkinTangent,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var __proto=VertexPositionNormalTexture0Texture1SkinTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__proto.VertexPositionNormalTexture0SkinTangent=function(position,normal,textureCoordinate0,textureCoordinate1,tangent,blendIndex,blendWeight){this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight},__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1SkinTangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(1,VertexPositionNormalTexture0Texture1SkinTangent,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1SkinTangent._vertexDeclaration}),__static(VertexPositionNormalTexture0Texture1SkinTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(84,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",7),new VertexElement(56,"vector4",6),new VertexElement(72,"vector3",5)])}]),VertexPositionNormalTexture0Texture1SkinTangent}(),VertexPositionNormalTexture0Texture1STangent=function(){function VertexPositionNormalTexture0Texture1STangent(position,normal,textureCoordinate0,textureCoordinate1,tangent){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent}__class(VertexPositionNormalTexture0Texture1STangent,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var __proto=VertexPositionNormalTexture0Texture1STangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1STangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,VertexPositionNormalTexture0Texture1STangent,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1STangent._vertexDeclaration}),__static(VertexPositionNormalTexture0Texture1STangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector4",5)])}]),VertexPositionNormalTexture0Texture1STangent}(),VertexPositionNormalTexture0Texture1Tangent=function(){function VertexPositionNormalTexture0Texture1Tangent(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}__class(VertexPositionNormalTexture0Texture1Tangent,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var __proto=VertexPositionNormalTexture0Texture1Tangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__proto.VertexPositionNormalTexture0Tangent=function(position,normal,textureCoordinate0,textureCoordinate1,tangent){this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent},__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1Tangent._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(1,VertexPositionNormalTexture0Texture1Tangent,"vertexDeclaration",function(){return VertexPositionNormalTexture0Texture1Tangent._vertexDeclaration}),__static(VertexPositionNormalTexture0Texture1Tangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(52,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15),new VertexElement(40,"vector3",5)])}]),VertexPositionNormalTexture0Texture1Tangent}(),VertexPositionNormalTextureSkin=function(){function VertexPositionNormalTextureSkin(position,normal,textureCoordinate,blendIndex,blendWeight){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalTextureSkin,"laya.d3.graphics.VertexPositionNormalTextureSkin");var __proto=VertexPositionNormalTextureSkin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTextureSkin._vertexDeclaration}),__getset(1,VertexPositionNormalTextureSkin,"vertexDeclaration",function(){return VertexPositionNormalTextureSkin._vertexDeclaration}),__static(VertexPositionNormalTextureSkin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(64,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",7),new VertexElement(48,"vector4",6)])}]),VertexPositionNormalTextureSkin}(),VertexPositionNormalTextureSkinSTangent=function(){function VertexPositionNormalTextureSkinSTangent(position,normal,textureCoordinate,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalTextureSkinSTangent,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var __proto=VertexPositionNormalTextureSkinSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTextureSkinSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalTextureSkinSTangent,"vertexDeclaration",function(){return VertexPositionNormalTextureSkinSTangent._vertexDeclaration}),__static(VertexPositionNormalTextureSkinSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(80,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",7),new VertexElement(48,"vector4",6),new VertexElement(64,"vector4",5)])}]),VertexPositionNormalTextureSkinSTangent}(),VertexPositionNormalTextureSkinTangent=function(){function VertexPositionNormalTextureSkinTangent(position,normal,textureCoordinate,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNormalTextureSkinTangent,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var __proto=VertexPositionNormalTextureSkinTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTextureSkinTangent._vertexDeclaration}),__getset(1,VertexPositionNormalTextureSkinTangent,"vertexDeclaration",function(){return VertexPositionNormalTextureSkinTangent._vertexDeclaration}),__static(VertexPositionNormalTextureSkinTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(76,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",7),new VertexElement(48,"vector4",6),new VertexElement(64,"vector3",5)])}]),VertexPositionNormalTextureSkinTangent}(),VertexPositionNormalTextureSTangent=function(){function VertexPositionNormalTextureSTangent(position,normal,textureCoordinate,tangent){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate,this._tangent=tangent}__class(VertexPositionNormalTextureSTangent,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var __proto=VertexPositionNormalTextureSTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTextureSTangent._vertexDeclaration}),__getset(1,VertexPositionNormalTextureSTangent,"vertexDeclaration",function(){return VertexPositionNormalTextureSTangent._vertexDeclaration}),__static(VertexPositionNormalTextureSTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(48,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector4",5)])}]),VertexPositionNormalTextureSTangent}(),VertexPositionNormalTextureTangent=function(){function VertexPositionNormalTextureTangent(position,normal,textureCoordinate,tangent){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate,this._tangent=tangent}__class(VertexPositionNormalTextureTangent,"laya.d3.graphics.VertexPositionNormalTextureTangent");var __proto=VertexPositionNormalTextureTangent.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNormalTextureTangent._vertexDeclaration}),__getset(1,VertexPositionNormalTextureTangent,"vertexDeclaration",function(){return VertexPositionNormalTextureTangent._vertexDeclaration}),__static(VertexPositionNormalTextureTangent,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(44,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector3",5)])}]),VertexPositionNormalTextureTangent}(),VertexPositionNTBTexture=function(){function VertexPositionNTBTexture(position,normal,textureCoordinate){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate}__class(VertexPositionNTBTexture,"laya.d3.graphics.VertexPositionNTBTexture");var __proto=VertexPositionNTBTexture.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNTBTexture._vertexDeclaration}),__getset(1,VertexPositionNTBTexture,"vertexDeclaration",function(){return VertexPositionNTBTexture._vertexDeclaration}),__static(VertexPositionNTBTexture,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(56,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5),new VertexElement(36,"vector3",4),new VertexElement(48,"vector2",2)])}]),VertexPositionNTBTexture}(),VertexPositionNTBTexture0Texture1Skin=function(){function VertexPositionNTBTexture0Texture1Skin(position,normal,binormal,textureCoordinate0,textureCoordinate1,tangent,blendIndex,blendWeight){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=position,this._normal=normal,this._textureCoordinate0=textureCoordinate0,this._textureCoordinate1=textureCoordinate1,this._tangent=tangent,this._blendIndex=blendIndex,this._blendWeight=blendWeight}__class(VertexPositionNTBTexture0Texture1Skin,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var __proto=VertexPositionNTBTexture0Texture1Skin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"tangent",function(){return this._tangent}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNTBTexture0Texture1Skin._vertexDeclaration}),__getset(0,__proto,"textureCoordinate1",function(){return this._textureCoordinate1}),__getset(0,__proto,"blendIndex",function(){return this._blendIndex}),__getset(0,__proto,"blendWeight",function(){return this._blendWeight}),__getset(1,VertexPositionNTBTexture0Texture1Skin,"vertexDeclaration",function(){return VertexPositionNTBTexture0Texture1Skin._vertexDeclaration}),__static(VertexPositionNTBTexture0Texture1Skin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(96,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5),new VertexElement(36,"vector3",4),new VertexElement(48,"vector2",2),new VertexElement(56,"vector2",15),new VertexElement(64,"vector4",7),new VertexElement(80,"vector4",6)])}]),VertexPositionNTBTexture0Texture1Skin}(),VertexPositionNTBTextureSkin=function(){function VertexPositionNTBTextureSkin(position,normal,textureCoordinate){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=position,this._normal=normal,this._textureCoordinate=textureCoordinate}__class(VertexPositionNTBTextureSkin,"laya.d3.graphics.VertexPositionNTBTextureSkin");var __proto=VertexPositionNTBTextureSkin.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"textureCoordinate",function(){return this._textureCoordinate}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionNTBTextureSkin._vertexDeclaration}),__getset(1,VertexPositionNTBTextureSkin,"vertexDeclaration",function(){return VertexPositionNTBTextureSkin._vertexDeclaration}),__static(VertexPositionNTBTextureSkin,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(88,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector3",5),new VertexElement(36,"vector3",4),new VertexElement(48,"vector2",2),new VertexElement(56,"vector4",7),new VertexElement(72,"vector4",6)])}]),VertexPositionNTBTextureSkin}(),VertexPositionTexture0=(function(){function VertexPositionTerrain(position,normal,textureCoord0,textureCoord1){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=position,this._normal=normal,this._textureCoord0=textureCoord0,this._textureCoord1=textureCoord1}__class(VertexPositionTerrain,"laya.d3.graphics.VertexPositionTerrain");var __proto=VertexPositionTerrain.prototype;Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"normal",function(){return this._normal}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoord0",function(){return this._textureCoord0}),__getset(0,__proto,"textureCoord1",function(){return this._textureCoord1}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionTerrain._vertexDeclaration}),__getset(1,VertexPositionTerrain,"vertexDeclaration",function(){return VertexPositionTerrain._vertexDeclaration}),__static(VertexPositionTerrain,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(40,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector3",3),new VertexElement(24,"vector2",2),new VertexElement(32,"vector2",15)])}])}(),function(){function VertexPositionTexture0(position,textureCoordinate0){this._position=null,this._textureCoordinate0=null,this._position=position,this._textureCoordinate0=textureCoordinate0}__class(VertexPositionTexture0,"laya.d3.graphics.VertexPositionTexture0");var __proto=VertexPositionTexture0.prototype;return Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"position",function(){return this._position}),__getset(0,__proto,"textureCoordinate0",function(){return this._textureCoordinate0}),__getset(0,__proto,"vertexDeclaration",function(){return VertexPositionTexture0._vertexDeclaration}),__getset(1,VertexPositionTexture0,"vertexDeclaration",function(){return VertexPositionTexture0._vertexDeclaration}),__static(VertexPositionTexture0,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(20,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector2",2)])}]),VertexPositionTexture0}()),LoadModelV01=(function(){function VertexShurikenParticleBillboard(cornerTextureCoordinate,positionStartLifeTime,velocity,startColor,startSize,startRotation0,startRotation1,startRotation2,ageAddScale,time,startSpeed,randoms0,randoms1,simulationWorldPostion){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=cornerTextureCoordinate,this._positionStartLifeTime=positionStartLifeTime,this._velocity=velocity,this._startColor=startColor,this._startSize=startSize,this._startRotation0=startRotation0,this._startRotation1=startRotation1,this._startRotation2=startRotation2,this._startLifeTime=ageAddScale,this._time=time,this._startSpeed=startSpeed,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=simulationWorldPostion}__class(VertexShurikenParticleBillboard,"laya.d3.graphics.VertexShurikenParticleBillboard");var __proto=VertexShurikenParticleBillboard.prototype;Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),__getset(0,__proto,"random1",function(){return this._randoms1}),__getset(0,__proto,"startRotation2",function(){return this._startRotation2}),__getset(0,__proto,"positionStartLifeTime",function(){return this._positionStartLifeTime}),__getset(0,__proto,"velocity",function(){return this._velocity}),__getset(0,__proto,"random0",function(){return this._randoms0}),__getset(0,__proto,"startSize",function(){return this._startSize}),__getset(0,__proto,"startColor",function(){return this._startColor}),__getset(0,__proto,"startRotation0",function(){return this._startRotation0}),__getset(0,__proto,"startRotation1",function(){return this._startRotation1}),__getset(0,__proto,"startLifeTime",function(){return this._startLifeTime}),__getset(0,__proto,"time",function(){return this._time}),__getset(0,__proto,"startSpeed",function(){return this._startSpeed}),__getset(0,__proto,"simulationWorldPostion",function(){return this._simulationWorldPostion}),__getset(0,__proto,"vertexDeclaration",function(){return VertexShurikenParticleBillboard._vertexDeclaration}),__getset(1,VertexShurikenParticleBillboard,"vertexDeclaration",function(){return VertexShurikenParticleBillboard._vertexDeclaration}),__static(VertexShurikenParticleBillboard,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(152,[new VertexElement(0,"vector4",17),new VertexElement(16,"vector4",30),new VertexElement(32,"vector4",32),new VertexElement(48,"vector4",19),new VertexElement(64,"vector3",20),new VertexElement(76,"vector3",22),new VertexElement(88,"single",31),new VertexElement(92,"vector4",34),new VertexElement(108,"vector4",35),new VertexElement(124,"vector3",36),new VertexElement(136,"vector4",37)])}])}(),function(){function VertexShurikenParticleMesh(cornerTextureCoordinate,positionStartLifeTime,velocity,startColor,startSize,startRotation0,startRotation1,startRotation2,ageAddScale,time,startSpeed,randoms0,randoms1,simulationWorldPostion){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=cornerTextureCoordinate,this._positionStartLifeTime=positionStartLifeTime,this._velocity=velocity,this._startColor=startColor,this._startSize=startSize,this._startRotation0=startRotation0,this._startRotation1=startRotation1,this._startRotation2=startRotation2,this._startLifeTime=ageAddScale,this._time=time,this._startSpeed=startSpeed,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=simulationWorldPostion}__class(VertexShurikenParticleMesh,"laya.d3.graphics.VertexShurikenParticleMesh");var __proto=VertexShurikenParticleMesh.prototype;Laya.imps(__proto,{"laya.d3.graphics.IVertex":!0}),__getset(0,__proto,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),__getset(0,__proto,"velocity",function(){return this._velocity}),__getset(0,__proto,"position",function(){return this._positionStartLifeTime}),__getset(0,__proto,"random0",function(){return this._randoms0}),__getset(0,__proto,"startSize",function(){return this._startSize}),__getset(0,__proto,"startColor",function(){return this._startColor}),__getset(0,__proto,"startRotation0",function(){return this._startRotation0}),__getset(0,__proto,"startRotation1",function(){return this._startRotation1}),__getset(0,__proto,"random1",function(){return this._randoms1}),__getset(0,__proto,"startRotation2",function(){return this._startRotation2}),__getset(0,__proto,"startLifeTime",function(){return this._startLifeTime}),__getset(0,__proto,"time",function(){return this._time}),__getset(0,__proto,"startSpeed",function(){return this._startSpeed}),__getset(0,__proto,"simulationWorldPostion",function(){return this._simulationWorldPostion}),__getset(0,__proto,"vertexDeclaration",function(){return VertexShurikenParticleMesh._vertexDeclaration}),__getset(1,VertexShurikenParticleMesh,"vertexDeclaration",function(){return VertexShurikenParticleMesh._vertexDeclaration}),__static(VertexShurikenParticleMesh,["_vertexDeclaration",function(){return this._vertexDeclaration=new VertexDeclaration(172,[new VertexElement(0,"vector3",0),new VertexElement(12,"vector4",1),new VertexElement(28,"vector2",2),new VertexElement(36,"vector4",30),new VertexElement(52,"vector4",32),new VertexElement(68,"vector4",19),new VertexElement(84,"vector3",20),new VertexElement(96,"vector3",22),new VertexElement(108,"single",31),new VertexElement(112,"vector4",34),new VertexElement(128,"vector4",35),new VertexElement(144,"vector3",36),new VertexElement(156,"vector4",37)])}])}(),function(){function LoadModelV01(readData,version,mesh,materials,subMeshes,materialMap){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=mesh,this._materials=materials,this._subMeshes=subMeshes,this._materialMap=materialMap,this._version=version,this._onLoaded(readData)}__class(LoadModelV01,"laya.d3.loaders.LoadModelV01");var __proto=LoadModelV01.prototype;return __proto._onLoaded=function(readData){this._readData=readData,this.READ_BLOCK();for(var i=0;i<this._BLOCK.count;i++){var index=this._readData.getUint16(),blockName=this._strings[index],fn=this["READ_"+blockName];if(null==fn)throw new Error("model file err,no this function:"+index+" "+blockName);if(!fn.call(this))break}return this._mesh},__proto.onError=function(){},__proto._readString=function(){return this._strings[this._readData.getUint16()]},__proto.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},__proto.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},__proto.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var ofs=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var i=0;i<this._STRINGS.size;i++)this._strings[i]=this._readData.readUTFString();return this._readData.pos=ofs,!0},__proto.READ_MATERIAL=function(){var index=this._readData.getUint16(),url=(this._readString(),this._readString());return this._materials[index]="null"!==url?Loader.getRes(this._materialMap[url]):new BaseMaterial,!0},__proto.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var n,arrayBuffer=this._readData.__getBuffer(),i=0,bindPoseStart=this._readData.getUint32(),binPoseLength=this._readData.getUint32(),bindPoseStart=(new Float32Array(arrayBuffer.slice(bindPoseStart+this._DATA.offset,bindPoseStart+this._DATA.offset+binPoseLength)),this._readData.getUint32()),binPoseLength=this._readData.getUint32(),invGloBindPoseDatas=new Float32Array(arrayBuffer.slice(bindPoseStart+this._DATA.offset,bindPoseStart+this._DATA.offset+binPoseLength));for(this.mesh._inverseBindPoses=[],i=0,n=invGloBindPoseDatas.length;i<n;i+=16){var inverseGlobalBindPose=new Matrix4x4(invGloBindPoseDatas[i+0],invGloBindPoseDatas[i+1],invGloBindPoseDatas[i+2],invGloBindPoseDatas[i+3],invGloBindPoseDatas[i+4],invGloBindPoseDatas[i+5],invGloBindPoseDatas[i+6],invGloBindPoseDatas[i+7],invGloBindPoseDatas[i+8],invGloBindPoseDatas[i+9],invGloBindPoseDatas[i+10],invGloBindPoseDatas[i+11],invGloBindPoseDatas[i+12],invGloBindPoseDatas[i+13],invGloBindPoseDatas[i+14],invGloBindPoseDatas[i+15]);this.mesh._inverseBindPoses.push(inverseGlobalBindPose)}break;default:throw new Error("LoadModel:unknown version.")}return!0},__proto.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();for(var bufferAttribute=this._readString(),bufferAttribute=(this._shaderAttributes=bufferAttribute.match(LoadModelV01._attrReg),this._readData.getUint32()),ibsize=this._readData.getUint32(),vbofs=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),vbsize=this._readData.getUint32(),boneDicofs=this._readData.getUint32(),boneDicsize=this._readData.getUint32(),arrayBuffer=this._readData.__getBuffer(),submesh=new SubMesh(this._mesh),vertexDeclaration=this._getVertexDeclaration(),vb=VertexBuffer3D.create(vertexDeclaration,vbsize/vertexDeclaration.vertexStride,35044,!0),vertexDeclaration=vbofs+this._DATA.offset,vbofs=arrayBuffer.slice(vertexDeclaration,vertexDeclaration+vbsize),vertexElements=(vb.setData(new Float32Array(vbofs)),(submesh._vertexBuffer=vb).vertexDeclaration.getVertexElements()),i=0;i<vertexElements.length;i++)submesh._bufferUsage[vertexElements[i].elementUsage]=vb;vertexDeclaration=IndexBuffer3D.create("ushort",ibsize/2,35044,!0),vbsize=bufferAttribute+this._DATA.offset,vbofs=arrayBuffer.slice(vbsize,vbsize+ibsize),vertexDeclaration.setData(new Uint16Array(vbofs)),submesh._indexBuffer=vertexDeclaration,bufferAttribute=arrayBuffer.slice(boneDicofs+this._DATA.offset,boneDicofs+this._DATA.offset+boneDicsize);return submesh._boneIndicesList[0]=new Uint8Array(bufferAttribute),this._subMeshes.push(submesh),!0},__proto.READ_DATAAREA=function(){return!1},__proto._getVertexDeclaration=function(){for(var vertexDeclaration,position=!1,normal=!1,color=!1,texcoord0=!1,texcoord1=!1,tangent=!1,blendWeight=!1,blendIndex=!1,binormal=!1,i=0;i<this._shaderAttributes.length;i+=8)switch(this._shaderAttributes[i]){case"POSITION":position=!0;break;case"NORMAL":normal=!0;break;case"COLOR":color=!0;break;case"UV":texcoord0=!0;break;case"UV1":texcoord1=!0;break;case"BLENDWEIGHT":blendWeight=!0;break;case"BLENDINDICES":blendIndex=!0;break;case"TANGENT":tangent=!0;break;case"BINORMAL":binormal=!0}return position&&normal&&color&&texcoord0&&texcoord1&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalColorTexture0Texture1SkinTangent.vertexDeclaration:position&&normal&&color&&texcoord0&&texcoord1&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration:position&&normal&&texcoord0&&texcoord1&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalTexture0Texture1SkinTangent.vertexDeclaration:position&&normal&&texcoord0&&texcoord1&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalTexture0Texture1Skin.vertexDeclaration:position&&normal&&color&&texcoord0&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalColorTextureSkinTangent.vertexDeclaration:position&&normal&&color&&texcoord0&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalColorTextureSkin.vertexDeclaration:position&&normal&&tangent&&binormal&&texcoord0&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNTBTextureSkin.vertexDeclaration:position&&normal&&texcoord0&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalTextureSkinTangent.vertexDeclaration:position&&normal&&texcoord0&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalTextureSkin.vertexDeclaration:position&&normal&&color&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalColorSkinTangent.vertexDeclaration:position&&normal&&color&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalColorSkin.vertexDeclaration:position&&normal&&color&&texcoord0&&texcoord1&&tangent?vertexDeclaration=VertexPositionNormalColorTexture0Texture1Tangent.vertexDeclaration:position&&normal&&color&&texcoord0&&texcoord1?vertexDeclaration=VertexPositionNormalColorTexture0Texture1.vertexDeclaration:position&&normal&&texcoord0&&texcoord1&&tangent?vertexDeclaration=VertexPositionNormalTexture0Texture1Tangent.vertexDeclaration:position&&normal&&texcoord0&&texcoord1?vertexDeclaration=VertexPositionNormalTexture0Texture1.vertexDeclaration:position&&normal&&color&&texcoord0&&tangent?vertexDeclaration=VertexPositionNormalColorTextureTangent.vertexDeclaration:position&&normal&&texcoord0&&tangent&&binormal?vertexDeclaration=VertexPositionNTBTexture.vertexDeclaration:position&&normal&&color&&texcoord0?vertexDeclaration=VertexPositionNormalColorTexture.vertexDeclaration:position&&normal&&texcoord0&&tangent?vertexDeclaration=VertexPositionNormalTextureTangent.vertexDeclaration:position&&normal&&texcoord0?vertexDeclaration=VertexPositionNormalTexture.vertexDeclaration:position&&normal&&color&&tangent?vertexDeclaration=VertexPositionNormalColorTangent.vertexDeclaration:position&&normal&&color&&(vertexDeclaration=VertexPositionNormalColor.vertexDeclaration),vertexDeclaration},__getset(0,__proto,"mesh",function(){return this._mesh}),LoadModelV01._attrReg=new RegExp("(\\w+)|([:,;])","g"),LoadModelV01}()),LoadModelV02=function(){function LoadModelV02(){}return __class(LoadModelV02,"laya.d3.loaders.LoadModelV02"),LoadModelV02.parse=function(readData,version,mesh,materials,subMeshes,materialMap){LoadModelV02._mesh=mesh,LoadModelV02._materials=materials,LoadModelV02._subMeshes=subMeshes,LoadModelV02._materialMap=materialMap,LoadModelV02._version=version,LoadModelV02._readData=readData,LoadModelV02.READ_DATA(),LoadModelV02.READ_BLOCK(),LoadModelV02.READ_STRINGS();for(var i=0,n=LoadModelV02._BLOCK.count;i<n;i++){LoadModelV02._readData.pos=LoadModelV02._BLOCK.blockStarts[i];var index=LoadModelV02._readData.getUint16(),blockName=LoadModelV02._strings[index],fn=LoadModelV02["READ_"+blockName];if(null==fn)throw new Error("model file err,no this function:"+index+" "+blockName);fn.call()}LoadModelV02._strings.length=0,LoadModelV02._readData=null,LoadModelV02._version=null,LoadModelV02._mesh=null,LoadModelV02._materials=null,LoadModelV02._subMeshes=null,LoadModelV02._materialMap=null},LoadModelV02._readString=function(){return LoadModelV02._strings[LoadModelV02._readData.getUint16()]},LoadModelV02.READ_DATA=function(){LoadModelV02._DATA.offset=LoadModelV02._readData.getUint32(),LoadModelV02._DATA.size=LoadModelV02._readData.getUint32()},LoadModelV02.READ_BLOCK=function(){for(var count=LoadModelV02._BLOCK.count=LoadModelV02._readData.getUint16(),blockStarts=LoadModelV02._BLOCK.blockStarts=[],blockLengths=LoadModelV02._BLOCK.blockLengths=[],i=0;i<count;i++)blockStarts.push(LoadModelV02._readData.getUint32()),blockLengths.push(LoadModelV02._readData.getUint32())},LoadModelV02.READ_STRINGS=function(){var offset=LoadModelV02._readData.getUint32(),count=LoadModelV02._readData.getUint16(),prePos=LoadModelV02._readData.pos;LoadModelV02._readData.pos=offset+LoadModelV02._DATA.offset;for(var i=0;i<count;i++)LoadModelV02._strings[i]=LoadModelV02._readData.readUTFString();LoadModelV02._readData.pos=prePos},LoadModelV02.READ_MATERIAL=function(){LoadModelV02._readString(),LoadModelV02._readString();var url=LoadModelV02._readString();return""!==url&&LoadModelV02._materials.push(Loader.getRes(LoadModelV02._materialMap[url])),!0},LoadModelV02.READ_MESH=function(){LoadModelV02._readString();for(var n,arrayBuffer=LoadModelV02._readData.__getBuffer(),i=0,vertexBufferCount=LoadModelV02._readData.getInt16(),offset=LoadModelV02._DATA.offset,i=0;i<vertexBufferCount;i++){var vbStart=offset+LoadModelV02._readData.getUint32(),vbLength=LoadModelV02._readData.getUint32(),vbStart=new Float32Array(arrayBuffer.slice(vbStart,vbStart+vbLength)),vbLength=LoadModelV02._readString().match(LoadModelV02._attrReg),vbLength=LoadModelV02._getVertexDeclaration(vbLength),vbLength=VertexBuffer3D.create(vbLength,4*vbStart.length/vbLength.vertexStride,35044,!0);vbLength.setData(vbStart),LoadModelV02._mesh._vertexBuffers.push(vbLength)}var ibStart=offset+LoadModelV02._readData.getUint32(),ibLength=LoadModelV02._readData.getUint32(),ibStart=new Uint16Array(arrayBuffer.slice(ibStart,ibStart+ibLength)),ibLength=IndexBuffer3D.create("ushort",ibLength/2,35044,!0),boneNames=(ibLength.setData(ibStart),LoadModelV02._mesh._indexBuffer=ibLength,LoadModelV02._mesh._boneNames=[]),boneCount=LoadModelV02._readData.getUint16();for(boneNames.length=boneCount,i=0;i<boneCount;i++)boneNames[i]=LoadModelV02._strings[LoadModelV02._readData.getUint16()];var ibStart=LoadModelV02._readData.getUint32(),ibLength=LoadModelV02._readData.getUint32(),ibStart=(new Float32Array(arrayBuffer.slice(offset+ibStart,offset+ibStart+ibLength)),LoadModelV02._readData.getUint32()),ibLength=LoadModelV02._readData.getUint32(),invGloBindPoseDatas=new Float32Array(arrayBuffer.slice(offset+ibStart,offset+ibStart+ibLength));for(LoadModelV02._mesh._inverseBindPoses=[],i=0,n=invGloBindPoseDatas.length;i<n;i+=16){var inverseGlobalBindPose=new Matrix4x4(invGloBindPoseDatas[i+0],invGloBindPoseDatas[i+1],invGloBindPoseDatas[i+2],invGloBindPoseDatas[i+3],invGloBindPoseDatas[i+4],invGloBindPoseDatas[i+5],invGloBindPoseDatas[i+6],invGloBindPoseDatas[i+7],invGloBindPoseDatas[i+8],invGloBindPoseDatas[i+9],invGloBindPoseDatas[i+10],invGloBindPoseDatas[i+11],invGloBindPoseDatas[i+12],invGloBindPoseDatas[i+13],invGloBindPoseDatas[i+14],invGloBindPoseDatas[i+15]);LoadModelV02._mesh._inverseBindPoses.push(inverseGlobalBindPose)}return LoadModelV02._mesh._skinnedDatas=new Float32Array(16*invGloBindPoseDatas.length),!0},LoadModelV02.READ_SUBMESH=function(){var arrayBuffer=LoadModelV02._readData.__getBuffer(),submesh=new SubMesh(LoadModelV02._mesh),vbIndex=LoadModelV02._readData.getInt16(),vbStart=LoadModelV02._readData.getUint32(),vbLength=LoadModelV02._readData.getUint32(),vbIndex=(submesh._vertexBuffer=LoadModelV02._mesh._vertexBuffers[vbIndex],submesh._vertexStart=vbStart,submesh._vertexCount=vbLength,LoadModelV02._readData.getUint32()),vbStart=LoadModelV02._readData.getUint32(),vbLength=LoadModelV02._mesh._indexBuffer,offset=(submesh._indexBuffer=vbLength,submesh._indexStart=vbIndex,submesh._indexCount=vbStart,submesh._indices=new Uint16Array(vbLength.getData().buffer,2*vbIndex,vbStart),LoadModelV02._DATA.offset),subIndexBufferStart=submesh._subIndexBufferStart,subIndexBufferCount=submesh._subIndexBufferCount,vbLength=submesh._boneIndicesList,drawCount=LoadModelV02._readData.getUint16();subIndexBufferStart.length=drawCount,subIndexBufferCount.length=drawCount,vbLength.length=drawCount;for(var i=0;i<drawCount;i++){subIndexBufferStart[i]=LoadModelV02._readData.getUint32(),subIndexBufferCount[i]=LoadModelV02._readData.getUint32();var boneDicofs=LoadModelV02._readData.getUint32(),boneDicsize=LoadModelV02._readData.getUint32();submesh._boneIndicesList[i]=new Uint8Array(arrayBuffer.slice(offset+boneDicofs,offset+boneDicofs+boneDicsize))}return LoadModelV02._subMeshes.push(submesh),!0},LoadModelV02._getVertexDeclaration=function(shaderAttributes){for(var vertexDeclaration,position=!1,normal=!1,color=!1,texcoord0=!1,texcoord1=!1,tangent=!1,blendWeight=!1,blendIndex=!1,binormal=!1,i=0;i<shaderAttributes.length;i++)switch(shaderAttributes[i]){case"POSITION":position=!0;break;case"NORMAL":normal=!0;break;case"COLOR":color=!0;break;case"UV":texcoord0=!0;break;case"UV1":texcoord1=!0;break;case"BLENDWEIGHT":blendWeight=!0;break;case"BLENDINDICES":blendIndex=!0;break;case"TANGENT":tangent=!0;break;case"BINORMAL":binormal=!0}return position&&normal&&color&&texcoord0&&texcoord1&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalColorTexture0Texture1SkinTangent.vertexDeclaration:position&&normal&&color&&texcoord0&&texcoord1&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration:position&&normal&&texcoord0&&texcoord1&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalTexture0Texture1SkinTangent.vertexDeclaration:position&&normal&&texcoord0&&texcoord1&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalTexture0Texture1Skin.vertexDeclaration:position&&normal&&color&&texcoord0&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalColorTextureSkinTangent.vertexDeclaration:position&&normal&&color&&texcoord0&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalColorTextureSkin.vertexDeclaration:position&&normal&&texcoord0&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalTextureSkinTangent.vertexDeclaration:position&&normal&&texcoord0&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalTextureSkin.vertexDeclaration:position&&normal&&color&&blendWeight&&blendIndex&&tangent?vertexDeclaration=VertexPositionNormalColorSkinTangent.vertexDeclaration:position&&normal&&color&&blendWeight&&blendIndex?vertexDeclaration=VertexPositionNormalColorSkin.vertexDeclaration:position&&normal&&color&&texcoord0&&texcoord1&&tangent?vertexDeclaration=VertexPositionNormalColorTexture0Texture1Tangent.vertexDeclaration:position&&normal&&color&&texcoord0&&texcoord1?vertexDeclaration=VertexPositionNormalColorTexture0Texture1.vertexDeclaration:position&&normal&&texcoord0&&texcoord1&&tangent?vertexDeclaration=VertexPositionNormalTexture0Texture1Tangent.vertexDeclaration:position&&normal&&texcoord0&&texcoord1?vertexDeclaration=VertexPositionNormalTexture0Texture1.vertexDeclaration:position&&normal&&color&&texcoord0&&tangent?vertexDeclaration=VertexPositionNormalColorTextureTangent.vertexDeclaration:position&&normal&&texcoord0&&tangent&&binormal?vertexDeclaration=VertexPositionNTBTexture.vertexDeclaration:position&&normal&&color&&texcoord0?vertexDeclaration=VertexPositionNormalColorTexture.vertexDeclaration:position&&normal&&texcoord0&&tangent?vertexDeclaration=VertexPositionNormalTextureTangent.vertexDeclaration:position&&normal&&texcoord0?vertexDeclaration=VertexPositionNormalTexture.vertexDeclaration:position&&normal&&color&&tangent?vertexDeclaration=VertexPositionNormalColorTangent.vertexDeclaration:position&&normal&&color&&(vertexDeclaration=VertexPositionNormalColor.vertexDeclaration),vertexDeclaration},LoadModelV02._attrReg=new RegExp("(\\w+)|([:,;])","g"),LoadModelV02._strings=[],LoadModelV02._readData=null,LoadModelV02._version=null,LoadModelV02._mesh=null,LoadModelV02._materials=null,LoadModelV02._subMeshes=null,LoadModelV02._materialMap=null,__static(LoadModelV02,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),LoadModelV02}(),LoadModelV03=function(){function LoadModelV03(){}return __class(LoadModelV03,"laya.d3.loaders.LoadModelV03"),LoadModelV03.parse=function(readData,version,mesh,subMeshes,materialMap){LoadModelV03._mesh=mesh,LoadModelV03._subMeshes=subMeshes,LoadModelV03._materialMap=materialMap,LoadModelV03._version=version,LoadModelV03._readData=readData,LoadModelV03.READ_DATA(),LoadModelV03.READ_BLOCK(),LoadModelV03.READ_STRINGS();for(var i=0,n=LoadModelV03._BLOCK.count;i<n;i++){LoadModelV03._readData.pos=LoadModelV03._BLOCK.blockStarts[i];var index=LoadModelV03._readData.getUint16(),blockName=LoadModelV03._strings[index],fn=LoadModelV03["READ_"+blockName];if(null==fn)throw new Error("model file err,no this function:"+index+" "+blockName);fn.call()}LoadModelV03._strings.length=0,LoadModelV03._readData=null,LoadModelV03._version=null,LoadModelV03._mesh=null,LoadModelV03._subMeshes=null,LoadModelV03._materialMap=null},LoadModelV03._readString=function(){return LoadModelV03._strings[LoadModelV03._readData.getUint16()]},LoadModelV03.READ_DATA=function(){LoadModelV03._DATA.offset=LoadModelV03._readData.getUint32(),LoadModelV03._DATA.size=LoadModelV03._readData.getUint32()},LoadModelV03.READ_BLOCK=function(){for(var count=LoadModelV03._BLOCK.count=LoadModelV03._readData.getUint16(),blockStarts=LoadModelV03._BLOCK.blockStarts=[],blockLengths=LoadModelV03._BLOCK.blockLengths=[],i=0;i<count;i++)blockStarts.push(LoadModelV03._readData.getUint32()),blockLengths.push(LoadModelV03._readData.getUint32())},LoadModelV03.READ_STRINGS=function(){var offset=LoadModelV03._readData.getUint32(),count=LoadModelV03._readData.getUint16(),prePos=LoadModelV03._readData.pos;LoadModelV03._readData.pos=offset+LoadModelV03._DATA.offset;for(var i=0;i<count;i++)LoadModelV03._strings[i]=LoadModelV03._readData.readUTFString();LoadModelV03._readData.pos=prePos},LoadModelV03.READ_MESH=function(){LoadModelV03._readString();for(var n,arrayBuffer=LoadModelV03._readData.__getBuffer(),i=0,vertexBufferCount=LoadModelV03._readData.getInt16(),offset=LoadModelV03._DATA.offset,i=0;i<vertexBufferCount;i++){var vertexDeclaration,vbStart=offset+LoadModelV03._readData.getUint32(),vbLength=LoadModelV03._readData.getUint32(),vbStart=new Float32Array(arrayBuffer.slice(vbStart,vbStart+vbLength)),bufferAttribute=LoadModelV03._readString();switch(LoadModelV03._version){case"LAYAMODEL:03":vertexDeclaration=LoadModelV03._vertexDeclarationMap_Discard[bufferAttribute];break;case"LAYAMODEL:0301":vertexDeclaration=LoadModelV03._vertexDeclarationMap[bufferAttribute];break;default:throw new Error("LoadModelV03: unknown version.")}if(!vertexDeclaration)throw new Error("LoadModelV03: unknown vertexDeclaration.");vbLength=VertexBuffer3D.create(vertexDeclaration,4*vbStart.length/vertexDeclaration.vertexStride,35044,!0);vbLength.setData(vbStart),LoadModelV03._mesh._vertexBuffers.push(vbLength)}var ibStart=offset+LoadModelV03._readData.getUint32(),ibLength=LoadModelV03._readData.getUint32(),ibStart=new Uint16Array(arrayBuffer.slice(ibStart,ibStart+ibLength)),ibLength=IndexBuffer3D.create("ushort",ibLength/2,35044,!0),boneNames=(ibLength.setData(ibStart),LoadModelV03._mesh._indexBuffer=ibLength,LoadModelV03._mesh._boneNames=[]),boneCount=LoadModelV03._readData.getUint16();for(boneNames.length=boneCount,i=0;i<boneCount;i++)boneNames[i]=LoadModelV03._strings[LoadModelV03._readData.getUint16()];LoadModelV03._readData.pos+=8;var ibStart=LoadModelV03._readData.getUint32(),ibLength=LoadModelV03._readData.getUint32(),invGloBindPoseDatas=new Float32Array(arrayBuffer.slice(offset+ibStart,offset+ibStart+ibLength));for(LoadModelV03._mesh._inverseBindPoses=[],i=0,n=invGloBindPoseDatas.length;i<n;i+=16){var inverseGlobalBindPose=new Matrix4x4(invGloBindPoseDatas[i+0],invGloBindPoseDatas[i+1],invGloBindPoseDatas[i+2],invGloBindPoseDatas[i+3],invGloBindPoseDatas[i+4],invGloBindPoseDatas[i+5],invGloBindPoseDatas[i+6],invGloBindPoseDatas[i+7],invGloBindPoseDatas[i+8],invGloBindPoseDatas[i+9],invGloBindPoseDatas[i+10],invGloBindPoseDatas[i+11],invGloBindPoseDatas[i+12],invGloBindPoseDatas[i+13],invGloBindPoseDatas[i+14],invGloBindPoseDatas[i+15]);LoadModelV03._mesh._inverseBindPoses.push(inverseGlobalBindPose)}return LoadModelV03._mesh._skinnedDatas=new Float32Array(16*invGloBindPoseDatas.length),!0},LoadModelV03.READ_SUBMESH=function(){var arrayBuffer=LoadModelV03._readData.__getBuffer(),submesh=new SubMesh(LoadModelV03._mesh),vbIndex=LoadModelV03._readData.getInt16(),vbStart=LoadModelV03._readData.getUint32(),vbLength=LoadModelV03._readData.getUint32(),vbIndex=(submesh._vertexBuffer=LoadModelV03._mesh._vertexBuffers[vbIndex],submesh._vertexStart=vbStart,submesh._vertexCount=vbLength,LoadModelV03._readData.getUint32()),vbStart=LoadModelV03._readData.getUint32(),vbLength=LoadModelV03._mesh._indexBuffer,offset=(submesh._indexBuffer=vbLength,submesh._indexStart=vbIndex,submesh._indexCount=vbStart,submesh._indices=new Uint16Array(vbLength.getData().buffer,2*vbIndex,vbStart),LoadModelV03._DATA.offset),subIndexBufferStart=submesh._subIndexBufferStart,subIndexBufferCount=submesh._subIndexBufferCount,boneIndicesList=submesh._boneIndicesList,drawCount=LoadModelV03._readData.getUint16();subIndexBufferStart.length=drawCount,subIndexBufferCount.length=drawCount,boneIndicesList.length=drawCount;for(var i=0;i<drawCount;i++){subIndexBufferStart[i]=LoadModelV03._readData.getUint32(),subIndexBufferCount[i]=LoadModelV03._readData.getUint32();var boneDicofs=LoadModelV03._readData.getUint32(),boneDicsize=LoadModelV03._readData.getUint32();boneIndicesList[i]=new Uint8Array(arrayBuffer.slice(offset+boneDicofs,offset+boneDicofs+boneDicsize))}return LoadModelV03._subMeshes.push(submesh),!0},LoadModelV03._strings=[],LoadModelV03._readData=null,LoadModelV03._version=null,LoadModelV03._mesh=null,LoadModelV03._subMeshes=null,LoadModelV03._materialMap=null,__static(LoadModelV03,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTexture0Texture1SkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":VertexPositionNTBTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTexture0Texture1SkinTangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTextureSkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTextureSkin.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTextureSkinTangent.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTextureSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorSkinTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":VertexPositionNormalColorTexture0Texture1Tangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":VertexPositionNormalColorTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":VertexPositionNormalTexture0Texture1Tangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1":VertexPositionNormalTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":VertexPositionNormalColorTextureTangent.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":VertexPositionNTBTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":VertexPositionNormalColorTexture.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":VertexPositionNormalTextureTangent.vertexDeclaration,"POSITION,NORMAL,UV":VertexPositionNormalTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":VertexPositionNormalColorTangent.vertexDeclaration,"POSITION,NORMAL,COLOR":VertexPositionNormalColor.vertexDeclaration,"POSITION,NORMAL,TANGENT":VertexPositionNormalTangent.vertexDeclaration,"POSITION,NORMAL":VertexPositionNormal.vertexDeclaration,"POSITION,UV":VertexPositionTexture0.vertexDeclaration,POSITION:VertexPosition.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTexture0Texture1SkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":VertexPositionNTBTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTexture0Texture1SkinSTangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTexture0Texture1Skin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorTextureSkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorTextureSkin.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalTextureSkinSTangent.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalTextureSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":VertexPositionNormalColorSkinSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":VertexPositionNormalColorSkin.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":VertexPositionNormalColorTexture0Texture1STangent.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":VertexPositionNormalColorTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":VertexPositionNormalTexture0Texture1STangent.vertexDeclaration,"POSITION,NORMAL,UV,UV1":VertexPositionNormalTexture0Texture1.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":VertexPositionNormalColorTextureSTangent.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":VertexPositionNTBTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":VertexPositionNormalColorTexture.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":VertexPositionNormalTextureSTangent.vertexDeclaration,"POSITION,NORMAL,UV":VertexPositionNormalTexture.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":VertexPositionNormalColorSTangent.vertexDeclaration,"POSITION,NORMAL,COLOR":VertexPositionNormalColor.vertexDeclaration,"POSITION,NORMAL,TANGENT":VertexPositionNormalSTangent.vertexDeclaration,"POSITION,NORMAL":VertexPositionNormal.vertexDeclaration,"POSITION,UV":VertexPositionTexture0.vertexDeclaration,POSITION:VertexPosition.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),LoadModelV03}(),MeshReader=function(){function MeshReader(){}return __class(MeshReader,"laya.d3.loaders.MeshReader"),MeshReader.read=function(data,mesh,materials,subMeshes,materialMap){var readData=new Byte(data),version=(readData.pos=0,readData.readUTFString());switch(version){case"LAYAMODEL:01":case"LAYASKINANI:01":MeshReader._readVersion01(readData,version,mesh,materials,subMeshes,materialMap);break;case"LAYAMODEL:02":LoadModelV02.parse(readData,version,mesh,materials,subMeshes,materialMap);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":LoadModelV03.parse(readData,version,mesh,subMeshes,materialMap);break;default:throw new Error("MeshReader: unknown mesh version.")}mesh._setSubMeshes(subMeshes)},MeshReader._readVersion01=function(readData,version,mesh,materials,subMeshes,materialMap){new LoadModelV01(readData,version,mesh,materials,subMeshes,materialMap)},MeshReader}(),BoundBox=function(){function BoundBox(min,max){this.min=null,this.max=null,this.min=min,this.max=max}__class(BoundBox,"laya.d3.math.BoundBox");var __proto=BoundBox.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.getCorners=function(corners){corners.length=8;var mine=this.min.elements,maxe=this.max.elements,minX=mine[0],minY=mine[1],mine=mine[2],maxX=maxe[0],maxY=maxe[1],maxe=maxe[2];corners[0]=new Vector3(minX,maxY,maxe),corners[1]=new Vector3(maxX,maxY,maxe),corners[2]=new Vector3(maxX,minY,maxe),corners[3]=new Vector3(minX,minY,maxe),corners[4]=new Vector3(minX,maxY,mine),corners[5]=new Vector3(maxX,maxY,mine),corners[6]=new Vector3(maxX,minY,mine),corners[7]=new Vector3(minX,minY,mine)},__proto.toDefault=function(){this.min.toDefault(),this.max.toDefault()},__proto.cloneTo=function(destObject){this.min.cloneTo(destObject.min),this.max.cloneTo(destObject.max)},__proto.clone=function(){var dest=new this.constructor(new Vector3,new Vector3);return this.cloneTo(dest),dest},BoundBox.createfromPoints=function(points,out){if(null==points)throw new Error("points");var min=out.min,max=out.max,out=min.elements,out=(out[0]=Number.MAX_VALUE,out[1]=Number.MAX_VALUE,out[2]=Number.MAX_VALUE,max.elements);out[0]=-Number.MAX_VALUE,out[1]=-Number.MAX_VALUE,out[2]=-Number.MAX_VALUE;for(var i=0,n=points.length;i<n;++i)Vector3.min(min,points[i],min),Vector3.max(max,points[i],max)},BoundBox.merge=function(box1,box2,out){Vector3.min(box1.min,box2.min,out.min),Vector3.max(box1.max,box2.max,out.max)},BoundBox}(),BoundFrustum=function(){function BoundFrustum(matrix){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=matrix,this._near=new Plane(new Vector3),this._far=new Plane(new Vector3),this._left=new Plane(new Vector3),this._right=new Plane(new Vector3),this._top=new Plane(new Vector3),this._bottom=new Plane(new Vector3),BoundFrustum._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}__class(BoundFrustum,"laya.d3.math.BoundFrustum");var __proto=BoundFrustum.prototype;return __proto.equalsBoundFrustum=function(other){return this._matrix.equalsOtherMatrix(other.matrix)},__proto.equalsObj=function(obj){return obj instanceof laya.d3.math.BoundFrustum&&this.equalsBoundFrustum(obj)},__proto.getPlane=function(index){switch(index){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},__proto.getCorners=function(corners){BoundFrustum._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(corners[0]),BoundFrustum._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(corners[1]),BoundFrustum._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(corners[2]),BoundFrustum._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(corners[3]),BoundFrustum._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(corners[4]),BoundFrustum._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(corners[5]),BoundFrustum._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(corners[6]),BoundFrustum._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(corners[7])},__proto.containsPoint=function(point){for(var result=Plane.PlaneIntersectionType_Front,planeResult=Plane.PlaneIntersectionType_Front,i=0;i<6;i++){switch(i){case 0:planeResult=Collision.intersectsPlaneAndPoint(this._near,point);break;case 1:planeResult=Collision.intersectsPlaneAndPoint(this._far,point);break;case 2:planeResult=Collision.intersectsPlaneAndPoint(this._left,point);break;case 3:planeResult=Collision.intersectsPlaneAndPoint(this._right,point);break;case 4:planeResult=Collision.intersectsPlaneAndPoint(this._top,point);break;case 5:planeResult=Collision.intersectsPlaneAndPoint(this._bottom,point)}switch(planeResult){case Plane.PlaneIntersectionType_Back:return 0;case Plane.PlaneIntersectionType_Intersecting:result=Plane.PlaneIntersectionType_Intersecting}}return result!==Plane.PlaneIntersectionType_Intersecting?1:2},__proto.containsBoundBox=function(box){for(var plane,p=BoundFrustum._tempV30,n=BoundFrustum._tempV31,result=1,i=0;i<6;i++){if(plane=this.getPlane(i),this._getBoxToPlanePVertexNVertex(box,plane.normal,p,n),Collision.intersectsPlaneAndPoint(plane,p)===Plane.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(plane,n)===Plane.PlaneIntersectionType_Back&&(result=2)}return result},__proto.containsBoundSphere=function(sphere){for(var result=Plane.PlaneIntersectionType_Front,planeResult=Plane.PlaneIntersectionType_Front,i=0;i<6;i++){switch(i){case 0:planeResult=Collision.intersectsPlaneAndSphere(this._near,sphere);break;case 1:planeResult=Collision.intersectsPlaneAndSphere(this._far,sphere);break;case 2:planeResult=Collision.intersectsPlaneAndSphere(this._left,sphere);break;case 3:planeResult=Collision.intersectsPlaneAndSphere(this._right,sphere);break;case 4:planeResult=Collision.intersectsPlaneAndSphere(this._top,sphere);break;case 5:planeResult=Collision.intersectsPlaneAndSphere(this._bottom,sphere)}switch(planeResult){case Plane.PlaneIntersectionType_Back:return 0;case Plane.PlaneIntersectionType_Intersecting:result=Plane.PlaneIntersectionType_Intersecting}}return result!==Plane.PlaneIntersectionType_Intersecting?1:2},__proto._getBoxToPlanePVertexNVertex=function(box,planeNormal,outP,outN){var boxMin=box.min,boxMinE=boxMin.elements,box=box.max,boxMaxE=box.elements,planeNormal=planeNormal.elements,planeNorEX=planeNormal[0],planeNorEY=planeNormal[1],planeNormal=planeNormal[2],boxMin=(boxMin.cloneTo(outP),outP.elements),outP=(0<=planeNorEX&&(boxMin[0]=boxMaxE[0]),0<=planeNorEY&&(boxMin[1]=boxMaxE[1]),0<=planeNormal&&(boxMin[2]=boxMaxE[2]),box.cloneTo(outN),outN.elements);0<=planeNorEX&&(outP[0]=boxMinE[0]),0<=planeNorEY&&(outP[1]=boxMinE[1]),0<=planeNormal&&(outP[2]=boxMinE[2])},__getset(0,__proto,"top",function(){return this._top}),__getset(0,__proto,"matrix",function(){return this._matrix},function(matrix){this._matrix=matrix,BoundFrustum._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),__getset(0,__proto,"near",function(){return this._near}),__getset(0,__proto,"far",function(){return this._far}),__getset(0,__proto,"left",function(){return this._left}),__getset(0,__proto,"right",function(){return this._right}),__getset(0,__proto,"bottom",function(){return this._bottom}),BoundFrustum._getPlanesFromMatrix=function(m,np,fp,lp,rp,tp,bp){var m=m.elements,m11=m[0],m12=m[1],m13=m[2],m14=m[3],m21=m[4],m22=m[5],m23=m[6],m24=m[7],m31=m[8],m32=m[9],m33=m[10],m34=m[11],m41=m[12],m42=m[13],m43=m[14],m=m[15],nearNorE=np.normal.elements,nearNorE=(nearNorE[0]=m14+m13,nearNorE[1]=m24+m23,nearNorE[2]=m34+m33,np.distance=m+m43,np.normalize(),fp.normal.elements),np=(nearNorE[0]=m14-m13,nearNorE[1]=m24-m23,nearNorE[2]=m34-m33,fp.distance=m-m43,fp.normalize(),lp.normal.elements),m13=(np[0]=m14+m11,np[1]=m24+m21,np[2]=m34+m31,lp.distance=m+m41,lp.normalize(),rp.normal.elements),m23=(m13[0]=m14-m11,m13[1]=m24-m21,m13[2]=m34-m31,rp.distance=m-m41,rp.normalize(),tp.normal.elements),nearNorE=(m23[0]=m14-m12,m23[1]=m24-m22,m23[2]=m34-m32,tp.distance=m-m42,tp.normalize(),bp.normal.elements);nearNorE[0]=m14+m12,nearNorE[1]=m24+m22,nearNorE[2]=m34+m32,bp.distance=m+m42,bp.normalize()},BoundFrustum._get3PlaneInterPoint=function(p1,p2,p3){var p1Nor=p1.normal,p2Nor=p2.normal,p3Nor=p3.normal,p1Nor=(Vector3.cross(p2Nor,p3Nor,BoundFrustum._tempV30),Vector3.cross(p3Nor,p1Nor,BoundFrustum._tempV31),Vector3.cross(p1Nor,p2Nor,BoundFrustum._tempV32),Vector3.dot(p1Nor,BoundFrustum._tempV30)),p2Nor=Vector3.dot(p2Nor,BoundFrustum._tempV31),p3Nor=Vector3.dot(p3Nor,BoundFrustum._tempV32);return Vector3.scale(BoundFrustum._tempV30,-p1.distance/p1Nor,BoundFrustum._tempV33),Vector3.scale(BoundFrustum._tempV31,-p2.distance/p2Nor,BoundFrustum._tempV34),Vector3.scale(BoundFrustum._tempV32,-p3.distance/p3Nor,BoundFrustum._tempV35),Vector3.add(BoundFrustum._tempV33,BoundFrustum._tempV34,BoundFrustum._tempV36),Vector3.add(BoundFrustum._tempV35,BoundFrustum._tempV36,BoundFrustum._tempV37),BoundFrustum._tempV37},__static(BoundFrustum,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3},"_tempV33",function(){return this._tempV33=new Vector3},"_tempV34",function(){return this._tempV34=new Vector3},"_tempV35",function(){return this._tempV35=new Vector3},"_tempV36",function(){return this._tempV36=new Vector3},"_tempV37",function(){return this._tempV37=new Vector3}]),BoundFrustum}(),BoundSphere=function(){function BoundSphere(center,radius){this.center=null,this.radius=NaN,this.center=center,this.radius=radius}__class(BoundSphere,"laya.d3.math.BoundSphere");var __proto=BoundSphere.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.toDefault=function(){this.center.toDefault(),this.radius=0},__proto.intersectsRayDistance=function(ray){return Collision.intersectsRayAndSphereRD(ray,this)},__proto.intersectsRayPoint=function(ray,outPoint){return Collision.intersectsRayAndSphereRP(ray,this,outPoint)},__proto.cloneTo=function(destObject){this.center.cloneTo(destObject.center),destObject.radius=this.radius},__proto.clone=function(){var dest=new this.constructor(new Vector3,new Vector3);return this.cloneTo(dest),dest},BoundSphere.createFromSubPoints=function(points,start,count,out){if(null==points)throw new Error("points");if(start<0||start>=points.length)throw new Error("start"+start+"Must be in the range [0, "+(points.length-1)+"]");if(count<0||start+count>points.length)throw new Error("count"+count+"Must be in the range <= "+points.length+"}");var upperEnd=start+count,center=BoundSphere._tempVector3;center.elements[0]=0,center.elements[1]=0,center.elements[2]=0;for(var i=start;i<upperEnd;++i)Vector3.add(points[i],center,center);for(var outCenter=out.center,radius=(Vector3.scale(center,1/count,outCenter),0),i=start;i<upperEnd;++i){var distance=Vector3.distanceSquared(outCenter,points[i]);radius<distance&&(radius=distance)}out.radius=Math.sqrt(radius)},BoundSphere.createfromPoints=function(points,out){if(null==points)throw new Error("points");BoundSphere.createFromSubPoints(points,0,points.length,out)},__static(BoundSphere,["_tempVector3",function(){return this._tempVector3=new Vector3}]),BoundSphere}(),MathUtils3D=(function(){function ContainmentType(){}__class(ContainmentType,"laya.d3.math.ContainmentType"),ContainmentType.Disjoint=0,ContainmentType.Contains=1,ContainmentType.Intersects=2}(),function(){function MathUtils3D(){}return __class(MathUtils3D,"laya.d3.math.MathUtils3D"),MathUtils3D.isZero=function(v){return Math.abs(v)<MathUtils3D.zeroTolerance},MathUtils3D.nearEqual=function(n1,n2){return!!MathUtils3D.isZero(n1-n2)},MathUtils3D.fastInvSqrt=function(value){return MathUtils3D.isZero(value)?value:1/Math.sqrt(value)},__static(MathUtils3D,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),MathUtils3D}()),Matrix3x3=function(){function Matrix3x3(){var e=this.elements=new Float32Array(9);e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}__class(Matrix3x3,"laya.d3.math.Matrix3x3");var __proto=Matrix3x3.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.determinant=function(){var f=this.elements,a00=f[0],a01=f[1],a02=f[2],a10=f[3],a11=f[4],a12=f[5],a20=f[6],a21=f[7],f=f[8];return a00*(f*a11-a12*a21)+a01*(-f*a10+a12*a20)+a02*(a21*a10-a11*a20)},__proto.translate=function(trans,out){var out=out.elements,f=this.elements,trans=trans.elements,a00=f[0],a01=f[1],a02=f[2],a10=f[3],a11=f[4],a12=f[5],a20=f[6],a21=f[7],f=f[8],x=trans[0],trans=trans[1];out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a10,out[4]=a11,out[5]=a12,out[6]=x*a00+trans*a10+a20,out[7]=x*a01+trans*a11+a21,out[8]=x*a02+trans*a12+f},__proto.rotate=function(rad,out){var out=out.elements,f=this.elements,a00=f[0],a01=f[1],a02=f[2],a10=f[3],a11=f[4],a12=f[5],a20=f[6],a21=f[7],f=f[8],s=Math.sin(rad),rad=Math.cos(rad);out[0]=rad*a00+s*a10,out[1]=rad*a01+s*a11,out[2]=rad*a02+s*a12,out[3]=rad*a10-s*a00,out[4]=rad*a11-s*a01,out[5]=rad*a12-s*a02,out[6]=a20,out[7]=a21,out[8]=f},__proto.scale=function(scale,out){var out=out.elements,f=this.elements,scale=scale.elements,x=scale[0],scale=scale[1];out[0]=x*f[0],out[1]=x*f[1],out[2]=x*f[2],out[3]=scale*f[3],out[4]=scale*f[4],out[5]=scale*f[5],out[6]=f[6],out[7]=f[7],out[8]=f[8]},__proto.invert=function(out){var e=out.elements,f=this.elements,a00=f[0],a01=f[1],a02=f[2],a10=f[3],a11=f[4],a12=f[5],a20=f[6],a21=f[7],f=f[8],b01=f*a11-a12*a21,b11=-f*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;det||(out=null),e[0]=b01*(det=1/det),e[1]=(-f*a01+a02*a21)*det,e[2]=(a12*a01-a02*a11)*det,e[3]=b11*det,e[4]=(f*a00-a02*a20)*det,e[5]=(-a12*a00+a02*a10)*det,e[6]=b21*det,e[7]=(-a21*a00+a01*a20)*det,e[8]=(a11*a00-a01*a10)*det},__proto.transpose=function(out){var a02,a12,e=out.elements,f=this.elements;out===this?(out=f[1],a02=f[2],a12=f[5],e[1]=f[3],e[2]=f[6],e[3]=out,e[5]=f[7],e[6]=a02,e[7]=a12):(e[0]=f[0],e[1]=f[3],e[2]=f[6],e[3]=f[1],e[4]=f[4],e[5]=f[7],e[6]=f[2],e[7]=f[5],e[8]=f[8])},__proto.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},__proto.cloneTo=function(destObject){var i,s=this.elements,d=destObject.elements;if(s!==d)for(i=0;i<9;++i)d[i]=s[i]},__proto.clone=function(){var dest=new this.constructor;return this.cloneTo(dest),dest},Matrix3x3.createFromTranslation=function(trans,out){out.elements;trans=trans.elements;out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=trans[0],out[7]=trans[1],out[8]=1},Matrix3x3.createFromRotation=function(rad,out){var out=out.elements,s=Math.sin(rad),rad=Math.cos(rad);out[0]=rad,out[1]=s,out[2]=0,out[3]=-s,out[4]=rad,out[5]=0,out[6]=0,out[7]=0,out[8]=1},Matrix3x3.createFromScaling=function(scale,out){out=out.elements,scale=scale.elements;out[0]=scale[0],out[1]=0,out[2]=0,out[3]=0,out[4]=scale[1],out[5]=0,out[6]=0,out[7]=0,out[8]=1},Matrix3x3.createFromMatrix4x4=function(sou,out){out[0]=sou[0],out[1]=sou[1],out[2]=sou[2],out[3]=sou[4],out[4]=sou[5],out[5]=sou[6],out[6]=sou[8],out[7]=sou[9],out[8]=sou[10]},Matrix3x3.multiply=function(left,right,out){var out=out.elements,left=left.elements,right=right.elements,a00=left[0],a01=left[1],a02=left[2],a10=left[3],a11=left[4],a12=left[5],a20=left[6],a21=left[7],left=left[8],b00=right[0],b01=right[1],b02=right[2],b10=right[3],b11=right[4],b12=right[5],b20=right[6],b21=right[7],right=right[8];out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*left,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*left,out[6]=b20*a00+b21*a10+right*a20,out[7]=b20*a01+b21*a11+right*a21,out[8]=b20*a02+b21*a12+right*left},Matrix3x3.lookAt=function(eye,target,up,out){Vector3.subtract(eye,target,Matrix3x3._tempV30),Vector3.normalize(Matrix3x3._tempV30,Matrix3x3._tempV30),Vector3.cross(up,Matrix3x3._tempV30,Matrix3x3._tempV31),Vector3.normalize(Matrix3x3._tempV31,Matrix3x3._tempV31),Vector3.cross(Matrix3x3._tempV30,Matrix3x3._tempV31,Matrix3x3._tempV32);eye=Matrix3x3._tempV30.elements,target=Matrix3x3._tempV31.elements,up=Matrix3x3._tempV32.elements,out=out.elements;out[0]=target[0],out[3]=target[1],out[6]=target[2],out[1]=up[0],out[4]=up[1],out[7]=up[2],out[2]=eye[0],out[5]=eye[1],out[8]=eye[2]},Matrix3x3.DEFAULT=new Matrix3x3,__static(Matrix3x3,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3}]),Matrix3x3}(),Matrix4x4=function(){function Matrix4x4(m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44){void 0===m11&&(m11=1),void 0===m12&&(m12=0),void 0===m13&&(m13=0),void 0===m14&&(m14=0),void 0===m21&&(m21=0),void 0===m22&&(m22=1),void 0===m23&&(m23=0),void 0===m24&&(m24=0),void 0===m31&&(m31=0),void 0===m32&&(m32=0),void 0===m33&&(m33=1),void 0===m34&&(m34=0),void 0===m41&&(m41=0),void 0===m42&&(m42=0),void 0===m43&&(m43=0),void 0===m44&&(m44=1);var e=this.elements=new Float32Array(16);e[0]=m11,e[1]=m12,e[2]=m13,e[3]=m14,e[4]=m21,e[5]=m22,e[6]=m23,e[7]=m24,e[8]=m31,e[9]=m32,e[10]=m33,e[11]=m34,e[12]=m41,e[13]=m42,e[14]=m43,e[15]=m44}__class(Matrix4x4,"laya.d3.math.Matrix4x4");var __proto=Matrix4x4.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.getElementByRowColumn=function(row,column){if(row<0||3<row)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(column<0||3<column)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*row+column]},__proto.setElementByRowColumn=function(row,column,value){if(row<0||3<row)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(column<0||3<column)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*row+column]=value},__proto.equalsOtherMatrix=function(other){var e=this.elements,other=other.elements;return MathUtils3D.nearEqual(e[0],other[0])&&MathUtils3D.nearEqual(e[1],other[1])&&MathUtils3D.nearEqual(e[2],other[2])&&MathUtils3D.nearEqual(e[3],other[3])&&MathUtils3D.nearEqual(e[4],other[4])&&MathUtils3D.nearEqual(e[5],other[5])&&MathUtils3D.nearEqual(e[6],other[6])&&MathUtils3D.nearEqual(e[7],other[7])&&MathUtils3D.nearEqual(e[8],other[8])&&MathUtils3D.nearEqual(e[9],other[9])&&MathUtils3D.nearEqual(e[10],other[10])&&MathUtils3D.nearEqual(e[11],other[11])&&MathUtils3D.nearEqual(e[12],other[12])&&MathUtils3D.nearEqual(e[13],other[13])&&MathUtils3D.nearEqual(e[14],other[14])&&MathUtils3D.nearEqual(e[15],other[15])},__proto.decomposeTransRotScale=function(translation,rotation,scale){var rotationMatrix=Matrix4x4._tempMatrix4x4;return this.decomposeTransRotMatScale(translation,rotationMatrix,scale)?(Quaternion.createFromMatrix4x4(rotationMatrix,rotation),!0):(rotation.identity(),!1)},__proto.decomposeTransRotMatScale=function(translation,rotationMatrix,scale){var at,tempRightE,atE,e=this.elements,translation=translation.elements,rotationMatrix=rotationMatrix.elements,scale=scale.elements,translation=(translation[0]=e[12],translation[1]=e[13],translation[2]=e[14],e[0]),m12=e[1],m13=e[2],m21=e[4],m22=e[5],m23=e[6],m31=e[8],m32=e[9],e=e[10],sX=scale[0]=Math.sqrt(translation*translation+m12*m12+m13*m13),sY=scale[1]=Math.sqrt(m21*m21+m22*m22+m23*m23),sZ=scale[2]=Math.sqrt(m31*m31+m32*m32+e*e);return MathUtils3D.isZero(sX)||MathUtils3D.isZero(sY)||MathUtils3D.isZero(sZ)?(rotationMatrix[1]=rotationMatrix[2]=rotationMatrix[3]=rotationMatrix[4]=rotationMatrix[6]=rotationMatrix[7]=rotationMatrix[8]=rotationMatrix[9]=rotationMatrix[11]=rotationMatrix[12]=rotationMatrix[13]=rotationMatrix[14]=0,!(rotationMatrix[0]=rotationMatrix[5]=rotationMatrix[10]=rotationMatrix[15]=1)):((atE=(at=Matrix4x4._tempVector0).elements)[0]=m31/sZ,atE[1]=m32/sZ,atE[2]=e/sZ,(tempRightE=(atE=Matrix4x4._tempVector1).elements)[0]=translation/sX,tempRightE[1]=m12/sX,tempRightE[2]=m13/sX,Vector3.cross(at,atE,tempRightE=Matrix4x4._tempVector2),Vector3.cross(tempRightE,at,atE=Matrix4x4._tempVector1),rotationMatrix[3]=rotationMatrix[7]=rotationMatrix[11]=rotationMatrix[12]=rotationMatrix[13]=rotationMatrix[14]=0,rotationMatrix[15]=1,rotationMatrix[0]=atE.x,rotationMatrix[1]=atE.y,rotationMatrix[2]=atE.z,rotationMatrix[4]=tempRightE.x,rotationMatrix[5]=tempRightE.y,rotationMatrix[6]=tempRightE.z,rotationMatrix[8]=at.x,rotationMatrix[9]=at.y,rotationMatrix[10]=at.z,rotationMatrix[0]*translation+rotationMatrix[1]*m12+rotationMatrix[2]*m13<0&&(scale[0]=-sX),rotationMatrix[4]*m21+rotationMatrix[5]*m22+rotationMatrix[6]*m23<0&&(scale[1]=-sY),rotationMatrix[8]*m31+rotationMatrix[9]*m32+rotationMatrix[10]*e<0&&(scale[2]=-sZ),!0)},__proto.decomposeYawPitchRoll=function(yawPitchRoll){var yawPitchRoll=yawPitchRoll.elements,pitch=Math.asin(-this.elements[9]);yawPitchRoll[1]=pitch,Math.cos(pitch)>MathUtils3D.zeroTolerance?(yawPitchRoll[2]=Math.atan2(this.elements[1],this.elements[5]),yawPitchRoll[0]=Math.atan2(this.elements[8],this.elements[10])):(yawPitchRoll[2]=Math.atan2(-this.elements[4],this.elements[0]),yawPitchRoll[0]=0)},__proto.normalize=function(){var v=this.elements,c=v[0],d=v[1],e=v[2],g=Math.sqrt(c*c+d*d+e*e);g?1!=g&&(v[0]=c*(g=1/g),v[1]=d*g,v[2]=e*g):(v[0]=0,v[1]=0,v[2]=0)},__proto.transpose=function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},__proto.invert=function(out){var ae=this.elements,out=out.elements,a00=ae[0],a01=ae[1],a02=ae[2],a03=ae[3],a10=ae[4],a11=ae[5],a12=ae[6],a13=ae[7],a20=ae[8],a21=ae[9],a22=ae[10],a23=ae[11],a30=ae[12],a31=ae[13],a32=ae[14],ae=ae[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*ae-a23*a30,b09=a21*a32-a22*a31,b10=a21*ae-a23*a31,b11=a22*ae-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;0!==Math.abs(det)&&(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+ae*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-ae*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+ae*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det)},__proto.identity=function(){var e=this.elements;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1},__proto.cloneTo=function(destObject){var i,s=this.elements,d=destObject.elements;if(s!==d)for(i=0;i<16;++i)d[i]=s[i]},__proto.clone=function(){var dest=new this.constructor;return this.cloneTo(dest),dest},__proto.getTranslationVector=function(out){var me=this.elements,out=out.elements;out[0]=me[12],out[1]=me[13],out[2]=me[14]},__proto.setTranslationVector=function(translate){var me=this.elements,translate=translate.elements;me[12]=translate[0],me[13]=translate[1],me[14]=translate[2]},__proto.getForward=function(out){var me=this.elements,out=out.elements;out[0]=-me[8],out[1]=-me[9],out[2]=-me[10]},__proto.setForward=function(forward){var me=this.elements,forward=forward.elements;me[8]=-forward[0],me[9]=-forward[1],me[10]=-forward[2]},Matrix4x4.createRotationX=function(rad,out){var out=out.elements,s=Math.sin(rad),rad=Math.cos(rad);out[1]=out[2]=out[3]=out[4]=out[7]=out[8]=out[11]=out[12]=out[13]=out[14]=0,out[0]=out[15]=1,out[5]=out[10]=rad,out[6]=s,out[9]=-s},Matrix4x4.createRotationY=function(rad,out){var out=out.elements,s=Math.sin(rad),rad=Math.cos(rad);out[1]=out[3]=out[4]=out[6]=out[7]=out[9]=out[11]=out[12]=out[13]=out[14]=0,out[5]=out[15]=1,out[0]=out[10]=rad,out[2]=-s,out[8]=s},Matrix4x4.createRotationZ=function(rad,out){var out=out.elements,s=Math.sin(rad),rad=Math.cos(rad);out[2]=out[3]=out[6]=out[7]=out[8]=out[9]=out[11]=out[12]=out[13]=out[14]=0,out[10]=out[15]=1,out[0]=out[5]=rad,out[1]=s,out[4]=-s},Matrix4x4.createRotationYawPitchRoll=function(yaw,pitch,roll,result){Quaternion.createFromYawPitchRoll(yaw,pitch,roll,Matrix4x4._tempQuaternion),Matrix4x4.createRotationQuaternion(Matrix4x4._tempQuaternion,result)},Matrix4x4.createRotationAxis=function(axis,angle,result){var axis=axis.elements,x=axis[0],y=axis[1],axis=axis[2],cos=Math.cos(angle),angle=Math.sin(angle),xx=x*x,yy=y*y,zz=axis*axis,xy=x*y,xz=x*axis,yz=y*axis,result=result.elements;result[3]=result[7]=result[11]=result[12]=result[13]=result[14]=0,result[15]=1,result[0]=xx+cos*(1-xx),result[1]=xy-cos*xy+angle*axis,result[2]=xz-cos*xz-angle*y,result[4]=xy-cos*xy-angle*axis,result[5]=yy+cos*(1-yy),result[6]=yz-cos*yz+angle*x,result[8]=xz-cos*xz+angle*y,result[9]=yz-cos*yz-angle*x,result[10]=zz+cos*(1-zz)},Matrix4x4.createRotationQuaternion=function(rotation,result){var rotation=rotation.elements,result=result.elements,rotationX=rotation[0],rotationY=rotation[1],rotationZ=rotation[2],rotation=rotation[3],xx=rotationX*rotationX,yy=rotationY*rotationY,zz=rotationZ*rotationZ,xy=rotationX*rotationY,zw=rotationZ*rotation,zx=rotationZ*rotationX,yw=rotationY*rotation,rotationY=rotationY*rotationZ,rotationZ=rotationX*rotation;result[3]=result[7]=result[11]=result[12]=result[13]=result[14]=0,result[15]=1,result[0]=1-2*(yy+zz),result[1]=2*(xy+zw),result[2]=2*(zx-yw),result[4]=2*(xy-zw),result[5]=1-2*(zz+xx),result[6]=2*(rotationY+rotationZ),result[8]=2*(zx+yw),result[9]=2*(rotationY-rotationZ),result[10]=1-2*(yy+xx)},Matrix4x4.createTranslate=function(trans,out){trans=trans.elements,out=out.elements;out[4]=out[8]=out[1]=out[9]=out[2]=out[6]=out[3]=out[7]=out[11]=0,out[0]=out[5]=out[10]=out[15]=1,out[12]=trans[0],out[13]=trans[1],out[14]=trans[2]},Matrix4x4.createScaling=function(scale,out){scale=scale.elements,out=out.elements;out[0]=scale[0],out[5]=scale[1],out[10]=scale[2],out[1]=out[4]=out[8]=out[12]=out[9]=out[13]=out[2]=out[6]=out[14]=out[3]=out[7]=out[11]=0,out[15]=1},Matrix4x4.multiply=function(left,right,out){var i,ai0,ai1,ai2,ai3,e=out.elements,a=left.elements,b=right.elements;for(e===b&&(b=b.slice()),i=0;i<4;i++)ai0=a[i],ai1=a[i+4],ai2=a[i+8],ai3=a[i+12],e[i]=ai0*b[0]+ai1*b[1]+ai2*b[2]+ai3*b[3],e[i+4]=ai0*b[4]+ai1*b[5]+ai2*b[6]+ai3*b[7],e[i+8]=ai0*b[8]+ai1*b[9]+ai2*b[10]+ai3*b[11],e[i+12]=ai0*b[12]+ai1*b[13]+ai2*b[14]+ai3*b[15]},Matrix4x4.createFromQuaternion=function(rotation,out){var out=out.elements,rotation=rotation.elements,x=rotation[0],y=rotation[1],z=rotation[2],rotation=rotation[3],x2=x+x,y2=y+y,z2=z+z,x=x*x2,yx=y*x2,y=y*y2,zx=z*x2,zy=z*y2,z=z*z2,x2=rotation*x2,y2=rotation*y2,rotation=rotation*z2;out[0]=1-y-z,out[1]=yx+rotation,out[2]=zx-y2,out[3]=0,out[4]=yx-rotation,out[5]=1-x-z,out[6]=zy+x2,out[7]=0,out[8]=zx+y2,out[9]=zy-x2,out[10]=1-x-y,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1},Matrix4x4.createAffineTransformation=function(trans,rot,scale,out){var trans=trans.elements,rot=rot.elements,scale=scale.elements,out=out.elements,x=rot[0],y=rot[1],z=rot[2],rot=rot[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,x=x*z2,yy=y*y2,y=y*z2,z=z*z2,x2=rot*x2,y2=rot*y2,rot=rot*z2,z2=scale[0],sy=scale[1],scale=scale[2];out[0]=(1-(yy+z))*z2,out[1]=(xy+rot)*z2,out[2]=(x-y2)*z2,out[3]=0,out[4]=(xy-rot)*sy,out[5]=(1-(xx+z))*sy,out[6]=(y+x2)*sy,out[7]=0,out[8]=(x+y2)*scale,out[9]=(y-x2)*scale,out[10]=(1-(xx+yy))*scale,out[11]=0,out[12]=trans[0],out[13]=trans[1],out[14]=trans[2],out[15]=1},Matrix4x4.createLookAt=function(eye,target,up,out){var oE=out.elements,xaxis=Matrix4x4._tempVector0,yaxis=Matrix4x4._tempVector1,zaxis=Matrix4x4._tempVector2;Vector3.subtract(eye,target,zaxis),Vector3.normalize(zaxis,zaxis),Vector3.cross(up,zaxis,xaxis),Vector3.normalize(xaxis,xaxis),Vector3.cross(zaxis,xaxis,yaxis),out.identity(),oE[0]=xaxis.x,oE[4]=xaxis.y,oE[8]=xaxis.z,oE[1]=yaxis.x,oE[5]=yaxis.y,oE[9]=yaxis.z,oE[2]=zaxis.x,oE[6]=zaxis.y,oE[10]=zaxis.z,oE[12]=-Vector3.dot(xaxis,eye),oE[13]=-Vector3.dot(yaxis,eye),oE[14]=-Vector3.dot(zaxis,eye)},Matrix4x4.createPerspective=function(fov,aspect,near,far,out){var out=out.elements,fov=1/Math.tan(fov/2),nf=1/(near-far);out[0]=fov/aspect,out[5]=fov,out[10]=(far+near)*nf,out[11]=-1,out[14]=2*far*near*nf,out[1]=out[2]=out[3]=out[4]=out[6]=out[7]=out[8]=out[9]=out[12]=out[13]=out[15]=0},Matrix4x4.createOrthoOffCenterRH=function(left,right,bottom,top,near,far,out){var out=out.elements,lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[1]=out[2]=out[3]=out[4]=out[6]=out[7]=out[8]=out[9]=out[11]=0,out[15]=1,out[0]=-2*lr,out[5]=-2*bt,out[10]=2*nf,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=(far+near)*nf},Matrix4x4.translation=function(v3,out){v3=v3.elements,out=out.elements;out[0]=out[5]=out[10]=out[15]=1,out[12]=v3[0],out[13]=v3[1],out[14]=v3[2]},__static(Matrix4x4,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new Matrix4x4},"_tempVector0",function(){return this._tempVector0=new Vector3},"_tempVector1",function(){return this._tempVector1=new Vector3},"_tempVector2",function(){return this._tempVector2=new Vector3},"_tempQuaternion",function(){return this._tempQuaternion=new Quaternion},"DEFAULT",function(){return this.DEFAULT=new Matrix4x4},"ZERO",function(){return this.ZERO=new Matrix4x4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),Matrix4x4}(),Plane=(function(){function OrientedBoundBox(extents,transformation){this.extents=null,this.transformation=null,this.extents=extents,this.transformation=transformation}__class(OrientedBoundBox,"laya.d3.math.OrientedBoundBox");var __proto=OrientedBoundBox.prototype;__proto.getCorners=function(corners){var xve=OrientedBoundBox._tempV30.elements,yve=OrientedBoundBox._tempV31.elements,zve=OrientedBoundBox._tempV32.elements,extentsE=this.extents.elements,xve=(xve[0]=extentsE[0],xve[1]=xve[2]=0,yve[1]=extentsE[1],yve[0]=yve[2]=0,zve[2]=extentsE[2],zve[0]=zve[1]=0,Vector3.TransformNormal(OrientedBoundBox._tempV30,this.transformation,OrientedBoundBox._tempV30),Vector3.TransformNormal(OrientedBoundBox._tempV31,this.transformation,OrientedBoundBox._tempV31),Vector3.TransformNormal(OrientedBoundBox._tempV32,this.transformation,OrientedBoundBox._tempV32),OrientedBoundBox._tempV33);this.transformation.getTranslationVector(xve),corners.length=8,Vector3.add(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[0]),Vector3.add(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[1]),Vector3.subtract(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[2]),Vector3.subtract(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[3]),Vector3.add(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[4]),Vector3.add(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[5]),Vector3.subtract(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[6]),Vector3.subtract(xve,OrientedBoundBox._tempV30,OrientedBoundBox._tempV34),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV31,OrientedBoundBox._tempV34),Vector3.add(OrientedBoundBox._tempV34,OrientedBoundBox._tempV32,corners[7])},__proto.transform=function(mat){Matrix4x4.multiply(this.transformation,mat,this.transformation)},__proto.scale=function(scaling){Vector3.multiply(this.extents,scaling,this.extents)},__proto.translate=function(translation){this.transformation.getTranslationVector(OrientedBoundBox._tempV30),Vector3.add(OrientedBoundBox._tempV30,translation,OrientedBoundBox._tempV31),this.transformation.setTranslationVector(OrientedBoundBox._tempV31)},__proto.Size=function(out){Vector3.scale(this.extents,2,out)},__proto.getSize=function(out){var extentsE=this.extents.elements,extentsE=(OrientedBoundBox._tempV30.x=extentsE[0],OrientedBoundBox._tempV31.y=extentsE[1],OrientedBoundBox._tempV32.z=extentsE[2],Vector3.TransformNormal(OrientedBoundBox._tempV30,this.transformation,OrientedBoundBox._tempV30),Vector3.TransformNormal(OrientedBoundBox._tempV31,this.transformation,OrientedBoundBox._tempV31),Vector3.TransformNormal(OrientedBoundBox._tempV31,this.transformation,OrientedBoundBox._tempV32),out.elements);extentsE[0]=Vector3.scalarLength(OrientedBoundBox._tempV30),extentsE[1]=Vector3.scalarLength(OrientedBoundBox._tempV31),extentsE[2]=Vector3.scalarLength(OrientedBoundBox._tempV32)},__proto.getSizeSquared=function(out){var extentsE=this.extents.elements,extentsE=(OrientedBoundBox._tempV30.x=extentsE[0],OrientedBoundBox._tempV31.y=extentsE[1],OrientedBoundBox._tempV32.z=extentsE[2],Vector3.TransformNormal(OrientedBoundBox._tempV30,this.transformation,OrientedBoundBox._tempV30),Vector3.TransformNormal(OrientedBoundBox._tempV31,this.transformation,OrientedBoundBox._tempV31),Vector3.TransformNormal(OrientedBoundBox._tempV31,this.transformation,OrientedBoundBox._tempV32),out.elements);extentsE[0]=Vector3.scalarLengthSquared(OrientedBoundBox._tempV30),extentsE[1]=Vector3.scalarLengthSquared(OrientedBoundBox._tempV31),extentsE[2]=Vector3.scalarLengthSquared(OrientedBoundBox._tempV32)},__proto.getCenter=function(center){this.transformation.getTranslationVector(center)},__proto.containsPoint=function(point){var extentsE=this.extents.elements,extentsEX=extentsE[0],extentsEY=extentsE[1],extentsE=extentsE[2],point=(this.transformation.invert(OrientedBoundBox._tempM0),Vector3.transformCoordinate(point,OrientedBoundBox._tempM0,OrientedBoundBox._tempV30),OrientedBoundBox._tempV30.elements),_tempV30ex=Math.abs(point[0]),_tempV30ey=Math.abs(point[1]),point=Math.abs(point[2]);return MathUtils3D.nearEqual(_tempV30ex,extentsEX)&&MathUtils3D.nearEqual(_tempV30ey,extentsEY)&&MathUtils3D.nearEqual(point,extentsE)?2:_tempV30ex<extentsEX&&_tempV30ey<extentsEY&&point<extentsE?1:0},__proto.containsPoints=function(points){for(var extentse=this.extents.elements,extentsex=extentse[0],extentsey=extentse[1],extentsez=extentse[2],containsAll=(this.transformation.invert(OrientedBoundBox._tempM0),!0),containsAny=!1,i=0;i<points.length;i++){Vector3.transformCoordinate(points[i],OrientedBoundBox._tempM0,OrientedBoundBox._tempV30);var _tempV30e=OrientedBoundBox._tempV30.elements,_tempV30ex=Math.abs(_tempV30e[0]),_tempV30ey=Math.abs(_tempV30e[1]),_tempV30e=Math.abs(_tempV30e[2]);MathUtils3D.nearEqual(_tempV30ex,extentsex)&&MathUtils3D.nearEqual(_tempV30ey,extentsey)&&MathUtils3D.nearEqual(_tempV30e,extentsez)&&(containsAny=!0),_tempV30ex<extentsex&&_tempV30ey<extentsey&&_tempV30e<extentsez?containsAny=!0:containsAll=!1}return containsAll?1:containsAny?2:0},__proto.containsSphere=function(sphere,ignoreScale){void 0===ignoreScale&&(ignoreScale=!1);var tempV30ey,tempV32ex,tempV32ey,tempV32e,extentsE=this.extents.elements,extentsEX=extentsE[0],extentsEY=extentsE[1],extentsE=extentsE[2],sphereR=sphere.radius,sphere=(this.transformation.invert(OrientedBoundBox._tempM0),Vector3.transformCoordinate(sphere.center,OrientedBoundBox._tempM0,OrientedBoundBox._tempV30),NaN),sphere=ignoreScale?sphereR:(Vector3.scale(Vector3.UnitX,sphereR,OrientedBoundBox._tempV31),Vector3.TransformNormal(OrientedBoundBox._tempV31,OrientedBoundBox._tempM0,OrientedBoundBox._tempV31),Vector3.scalarLength(OrientedBoundBox._tempV31));return Vector3.scale(this.extents,-1,OrientedBoundBox._tempV32),Vector3.Clamp(OrientedBoundBox._tempV30,OrientedBoundBox._tempV32,this.extents,OrientedBoundBox._tempV33),sphere*sphere<Vector3.distanceSquared(OrientedBoundBox._tempV30,OrientedBoundBox._tempV33)?0:(sphereR=(ignoreScale=OrientedBoundBox._tempV30.elements)[0],tempV30ey=ignoreScale[1],ignoreScale=ignoreScale[2],tempV32ex=(tempV32e=OrientedBoundBox._tempV32.elements)[0],tempV32ey=tempV32e[1],tempV32e=tempV32e[2],tempV32ex+sphere<=sphereR&&sphereR<=extentsEX-sphere&&sphere<extentsEX-tempV32ex&&tempV32ey+sphere<=tempV30ey&&tempV30ey<=extentsEY-sphere&&sphere<extentsEY-tempV32ey&&tempV32e+sphere<=ignoreScale&&ignoreScale<=extentsE-sphere&&sphere<extentsE-tempV32e?1:2)},__proto.containsOrientedBoundBox=function(obb){var i=0,k=0,cornersCheck=(obb.getCorners(OrientedBoundBox._corners),this.containsPoints(OrientedBoundBox._corners));if(0!=cornersCheck)return cornersCheck;for(var dotNumber,sizeAe=this.extents.elements,sizeBe=(obb.extents.cloneTo(OrientedBoundBox._tempV35),OrientedBoundBox._tempV35.elements),i=(OrientedBoundBox._getRows(this.transformation,OrientedBoundBox._rows1),OrientedBoundBox._getRows(obb.transformation,OrientedBoundBox._rows2),0);i<4;i++)for(k=0;k<4;k++)3==i||3==k?(OrientedBoundBox._tempM0.setElementByRowColumn(i,k,0),OrientedBoundBox._tempM1.setElementByRowColumn(i,k,0)):(dotNumber=Vector3.dot(OrientedBoundBox._rows1[i],OrientedBoundBox._rows2[k]),OrientedBoundBox._tempM0.setElementByRowColumn(i,k,dotNumber),OrientedBoundBox._tempM1.setElementByRowColumn(i,k,Math.abs(dotNumber)));obb.getCenter(OrientedBoundBox._tempV34),this.getCenter(OrientedBoundBox._tempV36),Vector3.subtract(OrientedBoundBox._tempV34,OrientedBoundBox._tempV36,OrientedBoundBox._tempV30);var vsepAe=OrientedBoundBox._tempV31.elements,_tempV32e=(vsepAe[0]=Vector3.dot(OrientedBoundBox._tempV30,OrientedBoundBox._rows1[0]),vsepAe[1]=Vector3.dot(OrientedBoundBox._tempV30,OrientedBoundBox._rows1[1]),vsepAe[2]=Vector3.dot(OrientedBoundBox._tempV30,OrientedBoundBox._rows1[2]),OrientedBoundBox._tempV32.elements),_tempV33e=OrientedBoundBox._tempV33.elements;for(i=0;i<3;i++)if(_tempV32e[0]=OrientedBoundBox._tempM1.getElementByRowColumn(i,0),_tempV32e[1]=OrientedBoundBox._tempM1.getElementByRowColumn(i,1),_tempV32e[2]=OrientedBoundBox._tempM1.getElementByRowColumn(i,2),sizeAe[i]+Vector3.dot(OrientedBoundBox._tempV35,OrientedBoundBox._tempV32)<Math.abs(vsepAe[i]))return 0;for(k=0;k<3;k++)if(_tempV32e[0]=OrientedBoundBox._tempM1.getElementByRowColumn(0,k),_tempV32e[1]=OrientedBoundBox._tempM1.getElementByRowColumn(1,k),_tempV32e[2]=OrientedBoundBox._tempM1.getElementByRowColumn(2,k),_tempV33e[0]=OrientedBoundBox._tempM0.getElementByRowColumn(0,k),_tempV33e[1]=OrientedBoundBox._tempM0.getElementByRowColumn(1,k),_tempV33e[2]=OrientedBoundBox._tempM0.getElementByRowColumn(2,k),Vector3.dot(this.extents,OrientedBoundBox._tempV32)+sizeBe[k]<Math.abs(Vector3.dot(OrientedBoundBox._tempV31,OrientedBoundBox._tempV33)))return 0;for(i=0;i<3;i++)for(k=0;k<3;k++){var i1=(i+1)%3,i2=(i+2)%3,k1=(k+1)%3,k2=(k+2)%3;if(sizeAe[i1]*OrientedBoundBox._tempM1.getElementByRowColumn(i2,k)+sizeAe[i2]*OrientedBoundBox._tempM1.getElementByRowColumn(i1,k)+(sizeBe[k1]*OrientedBoundBox._tempM1.getElementByRowColumn(i,k2)+sizeBe[k2]*OrientedBoundBox._tempM1.getElementByRowColumn(i,k1))<Math.abs(vsepAe[i2]*OrientedBoundBox._tempM0.getElementByRowColumn(i1,k)-vsepAe[i1]*OrientedBoundBox._tempM0.getElementByRowColumn(i2,k)))return 0}return 2},__proto.containsLine=function(point1,point2){OrientedBoundBox._corners[0]=point1,OrientedBoundBox._corners[1]=point2;var extentsX,extentsY,_tempV33Y,_tempV33Z,_tempV34X,_tempV34Y,_tempV34e,_tempV32X,_tempV32Y,cornersCheck=this.containsPoints(OrientedBoundBox._corners);return 0!=cornersCheck?cornersCheck:(extentsX=(cornersCheck=this.extents.elements)[0],extentsY=cornersCheck[1],cornersCheck=cornersCheck[2],this.transformation.invert(OrientedBoundBox._tempM0),Vector3.transformCoordinate(point1,OrientedBoundBox._tempM0,OrientedBoundBox._tempV30),Vector3.transformCoordinate(point2,OrientedBoundBox._tempM0,OrientedBoundBox._tempV31),Vector3.add(OrientedBoundBox._tempV30,OrientedBoundBox._tempV31,OrientedBoundBox._tempV32),Vector3.scale(OrientedBoundBox._tempV32,.5,OrientedBoundBox._tempV32),Vector3.subtract(OrientedBoundBox._tempV30,OrientedBoundBox._tempV32,OrientedBoundBox._tempV33),point2=(point1=OrientedBoundBox._tempV33.elements)[0],_tempV33Y=point1[1],_tempV33Z=point1[2],_tempV34X=(_tempV34e=OrientedBoundBox._tempV34.elements)[0]=Math.abs(point1[0]),_tempV34Y=_tempV34e[1]=Math.abs(point1[1]),_tempV34e=_tempV34e[2]=Math.abs(point1[2]),_tempV32X=(point1=OrientedBoundBox._tempV32.elements)[0],_tempV32Y=point1[1],point1=point1[2],Math.abs(_tempV32X)>extentsX+_tempV34X||Math.abs(_tempV32Y)>extentsY+_tempV34Y||Math.abs(point1)>cornersCheck+_tempV34e||Math.abs(_tempV32Y*_tempV33Z-point1*_tempV33Y)>extentsY*_tempV34e+cornersCheck*_tempV34Y||Math.abs(_tempV32X*_tempV33Z-point1*point2)>extentsX*_tempV34e+cornersCheck*_tempV34X||Math.abs(_tempV32X*_tempV33Y-_tempV32Y*point2)>extentsX*_tempV34Y+extentsY*_tempV34X?0:2)},__proto.containsBoundBox=function(box){var i=0,k=0,min=box.min,max=box.max,box=(box.getCorners(OrientedBoundBox._corners),this.containsPoints(OrientedBoundBox._corners));if(0!=box)return box;Vector3.subtract(max,min,OrientedBoundBox._tempV30),Vector3.scale(OrientedBoundBox._tempV30,.5,OrientedBoundBox._tempV30),Vector3.add(min,OrientedBoundBox._tempV30,OrientedBoundBox._tempV30),Vector3.subtract(max,OrientedBoundBox._tempV30,OrientedBoundBox._tempV31);for(var sizeAe=this.extents.elements,sizeBe=OrientedBoundBox._tempV31.elements,i=(OrientedBoundBox._getRows(this.transformation,OrientedBoundBox._rows1),this.transformation.invert(OrientedBoundBox._tempM0),0);i<3;i++)for(k=0;k<3;k++)OrientedBoundBox._tempM1.setElementByRowColumn(i,k,Math.abs(OrientedBoundBox._tempM0.getElementByRowColumn(i,k)));this.getCenter(OrientedBoundBox._tempV35),Vector3.subtract(OrientedBoundBox._tempV30,OrientedBoundBox._tempV35,OrientedBoundBox._tempV32);var vsepAe=OrientedBoundBox._tempV31.elements,_tempV33e=(vsepAe[0]=Vector3.dot(OrientedBoundBox._tempV32,OrientedBoundBox._rows1[0]),vsepAe[1]=Vector3.dot(OrientedBoundBox._tempV32,OrientedBoundBox._rows1[1]),vsepAe[2]=Vector3.dot(OrientedBoundBox._tempV32,OrientedBoundBox._rows1[2]),OrientedBoundBox._tempV33.elements),_tempV34e=OrientedBoundBox._tempV34.elements;for(i=0;i<3;i++)if(_tempV33e[0]=OrientedBoundBox._tempM1.getElementByRowColumn(i,0),_tempV33e[1]=OrientedBoundBox._tempM1.getElementByRowColumn(i,1),_tempV33e[2]=OrientedBoundBox._tempM1.getElementByRowColumn(i,2),sizeAe[i]+Vector3.dot(OrientedBoundBox._tempV31,OrientedBoundBox._tempV33)<Math.abs(vsepAe[i]))return 0;for(k=0;k<3;k++)if(_tempV33e[0]=OrientedBoundBox._tempM1.getElementByRowColumn(0,k),_tempV33e[1]=OrientedBoundBox._tempM1.getElementByRowColumn(1,k),_tempV33e[2]=OrientedBoundBox._tempM1.getElementByRowColumn(2,k),_tempV34e[0]=OrientedBoundBox._tempM0.getElementByRowColumn(0,k),_tempV34e[1]=OrientedBoundBox._tempM0.getElementByRowColumn(1,k),_tempV34e[2]=OrientedBoundBox._tempM0.getElementByRowColumn(2,k),Vector3.dot(this.extents,OrientedBoundBox._tempV33)+sizeBe[k]<Math.abs(Vector3.dot(OrientedBoundBox._tempV31,OrientedBoundBox._tempV34)))return 0;for(i=0;i<3;i++)for(k=0;k<3;k++){var i1=(i+1)%3,i2=(i+2)%3,k1=(k+1)%3,k2=(k+2)%3;if(sizeAe[i1]*OrientedBoundBox._tempM1.getElementByRowColumn(i2,k)+sizeAe[i2]*OrientedBoundBox._tempM1.getElementByRowColumn(i1,k)+(sizeBe[k1]*OrientedBoundBox._tempM1.getElementByRowColumn(i,k2)+sizeBe[k2]*OrientedBoundBox._tempM1.getElementByRowColumn(i,k1))<Math.abs(vsepAe[i2]*OrientedBoundBox._tempM0.getElementByRowColumn(i1,k)-vsepAe[i1]*OrientedBoundBox._tempM0.getElementByRowColumn(i2,k)))return 0}return 2},__proto.intersectsRay=function(ray,out){Vector3.scale(this.extents,-1,OrientedBoundBox._tempV30),this.transformation.invert(OrientedBoundBox._tempM0),Vector3.TransformNormal(ray.direction,OrientedBoundBox._tempM0,OrientedBoundBox._ray.direction),Vector3.transformCoordinate(ray.origin,OrientedBoundBox._tempM0,OrientedBoundBox._ray.origin),OrientedBoundBox._boxBound1.min=OrientedBoundBox._tempV30,OrientedBoundBox._boxBound1.max=this.extents;ray=Collision.intersectsRayAndBoxRP(OrientedBoundBox._ray,OrientedBoundBox._boxBound1,out);return-1!==ray&&Vector3.transformCoordinate(out,this.transformation,out),ray},__proto._getLocalCorners=function(corners){corners.length=8;var extentsE=this.extents.elements;OrientedBoundBox._tempV30.x=extentsE[0],OrientedBoundBox._tempV31.y=extentsE[1],OrientedBoundBox._tempV32.z=extentsE[2],Vector3.add(OrientedBoundBox._tempV30,OrientedBoundBox._tempV31,OrientedBoundBox._tempV33),Vector3.add(OrientedBoundBox._tempV33,OrientedBoundBox._tempV32,corners[0]),Vector3.add(OrientedBoundBox._tempV30,OrientedBoundBox._tempV31,OrientedBoundBox._tempV33),Vector3.subtract(OrientedBoundBox._tempV33,OrientedBoundBox._tempV32,corners[1]),Vector3.subtract(OrientedBoundBox._tempV31,OrientedBoundBox._tempV30,OrientedBoundBox._tempV33),Vector3.subtract(OrientedBoundBox._tempV33,OrientedBoundBox._tempV30,corners[2]),Vector3.subtract(OrientedBoundBox._tempV31,OrientedBoundBox._tempV30,OrientedBoundBox._tempV33),Vector3.add(OrientedBoundBox._tempV33,OrientedBoundBox._tempV32,corners[3]),Vector3.subtract(OrientedBoundBox._tempV30,OrientedBoundBox._tempV31,OrientedBoundBox._tempV33),Vector3.add(OrientedBoundBox._tempV33,OrientedBoundBox._tempV32,corners[4]),Vector3.subtract(OrientedBoundBox._tempV30,OrientedBoundBox._tempV31,OrientedBoundBox._tempV33),Vector3.subtract(OrientedBoundBox._tempV33,OrientedBoundBox._tempV32,corners[5]),Vector3.scale(corners[0],-1,corners[6]),Vector3.subtract(OrientedBoundBox._tempV32,OrientedBoundBox._tempV30,OrientedBoundBox._tempV33),Vector3.subtract(OrientedBoundBox._tempV33,OrientedBoundBox._tempV31,corners[7])},__proto.equals=function(obb){return this.extents==obb.extents&&this.transformation==obb.transformation},__proto.cloneTo=function(destObject){this.extents.cloneTo(destObject.extents),this.transformation.cloneTo(destObject.transformation)},OrientedBoundBox.createByBoundBox=function(box,out){var min=box.min,box=box.max,min=(Vector3.subtract(box,min,OrientedBoundBox._tempV30),Vector3.scale(OrientedBoundBox._tempV30,.5,OrientedBoundBox._tempV30),Vector3.add(min,OrientedBoundBox._tempV30,OrientedBoundBox._tempV31),Vector3.subtract(box,OrientedBoundBox._tempV31,OrientedBoundBox._tempV32),Matrix4x4.translation(OrientedBoundBox._tempV31,OrientedBoundBox._tempM0),OrientedBoundBox._tempV32.clone()),box=OrientedBoundBox._tempM0.clone();out.extents=min,out.transformation=box},OrientedBoundBox.createByMinAndMaxVertex=function(min,max){return Vector3.subtract(max,min,OrientedBoundBox._tempV30),Vector3.scale(OrientedBoundBox._tempV30,.5,OrientedBoundBox._tempV30),Vector3.add(min,OrientedBoundBox._tempV30,OrientedBoundBox._tempV31),Vector3.subtract(max,OrientedBoundBox._tempV31,OrientedBoundBox._tempV32),Matrix4x4.translation(OrientedBoundBox._tempV31,OrientedBoundBox._tempM0),new OrientedBoundBox(OrientedBoundBox._tempV32,OrientedBoundBox._tempM0)},OrientedBoundBox._getRows=function(mat,out){out.length=3;var mat=mat.elements,row0e=out[0].elements,row0e=(row0e[0]=mat[0],row0e[1]=mat[1],row0e[2]=mat[2],out[1].elements),row0e=(row0e[0]=mat[4],row0e[1]=mat[5],row0e[2]=mat[6],out[2].elements);row0e[0]=mat[8],row0e[1]=mat[9],row0e[2]=mat[10]},OrientedBoundBox.getObbtoObbMatrix4x4=function(a,b,noMatrixScaleApplied,out){var at=a.transformation,bt=b.transformation;if(noMatrixScaleApplied){OrientedBoundBox._getRows(at,OrientedBoundBox._rows1),OrientedBoundBox._getRows(bt,OrientedBoundBox._rows2);for(var i=0;i<3;i++)for(var k=0;k<3;k++)out.setElementByRowColumn(i,k,Vector3.dot(OrientedBoundBox._rows2[i],OrientedBoundBox._rows1[k]));b.getCenter(OrientedBoundBox._tempV30),a.getCenter(OrientedBoundBox._tempV31),Vector3.subtract(OrientedBoundBox._tempV30,OrientedBoundBox._tempV31,OrientedBoundBox._tempV32);noMatrixScaleApplied=out.elements;noMatrixScaleApplied[12]=Vector3.dot(OrientedBoundBox._tempV32,OrientedBoundBox._rows1[0]),noMatrixScaleApplied[13]=Vector3.dot(OrientedBoundBox._tempV32,OrientedBoundBox._rows1[1]),noMatrixScaleApplied[14]=Vector3.dot(OrientedBoundBox._tempV32,OrientedBoundBox._rows1[2]),noMatrixScaleApplied[15]=1}else at.invert(OrientedBoundBox._tempM0),Matrix4x4.multiply(bt,OrientedBoundBox._tempM0,out)},OrientedBoundBox.merge=function(a,b,noMatrixScaleApplied){var ae=a.extents,at=a.transformation,a=(OrientedBoundBox.getObbtoObbMatrix4x4(a,b,noMatrixScaleApplied,OrientedBoundBox._tempM0),b._getLocalCorners(OrientedBoundBox._corners),Vector3.transformCoordinate(OrientedBoundBox._corners[0],OrientedBoundBox._tempM0,OrientedBoundBox._corners[0]),Vector3.transformCoordinate(OrientedBoundBox._corners[1],OrientedBoundBox._tempM0,OrientedBoundBox._corners[1]),Vector3.transformCoordinate(OrientedBoundBox._corners[2],OrientedBoundBox._tempM0,OrientedBoundBox._corners[2]),Vector3.transformCoordinate(OrientedBoundBox._corners[3],OrientedBoundBox._tempM0,OrientedBoundBox._corners[3]),Vector3.transformCoordinate(OrientedBoundBox._corners[4],OrientedBoundBox._tempM0,OrientedBoundBox._corners[4]),Vector3.transformCoordinate(OrientedBoundBox._corners[5],OrientedBoundBox._tempM0,OrientedBoundBox._corners[5]),Vector3.transformCoordinate(OrientedBoundBox._corners[6],OrientedBoundBox._tempM0,OrientedBoundBox._corners[6]),Vector3.transformCoordinate(OrientedBoundBox._corners[7],OrientedBoundBox._tempM0,OrientedBoundBox._corners[7]),Vector3.scale(ae,-1,OrientedBoundBox._boxBound1.min),ae.cloneTo(OrientedBoundBox._boxBound1.max),BoundBox.createfromPoints(OrientedBoundBox._corners,OrientedBoundBox._boxBound2),BoundBox.merge(OrientedBoundBox._boxBound2,OrientedBoundBox._boxBound1,OrientedBoundBox._boxBound3),OrientedBoundBox._boxBound3.min),noMatrixScaleApplied=OrientedBoundBox._boxBound3.max;Vector3.subtract(noMatrixScaleApplied,a,OrientedBoundBox._tempV30),Vector3.scale(OrientedBoundBox._tempV30,.5,OrientedBoundBox._tempV30),Vector3.add(a,OrientedBoundBox._tempV30,OrientedBoundBox._tempV32),Vector3.subtract(noMatrixScaleApplied,OrientedBoundBox._tempV32,ae),Vector3.transformCoordinate(OrientedBoundBox._tempV32,at,OrientedBoundBox._tempV33)},__static(OrientedBoundBox,["_tempV30",function(){return this._tempV30=new Vector3},"_tempV31",function(){return this._tempV31=new Vector3},"_tempV32",function(){return this._tempV32=new Vector3},"_tempV33",function(){return this._tempV33=new Vector3},"_tempV34",function(){return this._tempV34=new Vector3},"_tempV35",function(){return this._tempV35=new Vector3},"_tempV36",function(){return this._tempV36=new Vector3},"_tempM0",function(){return this._tempM0=new Matrix4x4},"_tempM1",function(){return this._tempM1=new Matrix4x4},"_corners",function(){return this._corners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3]},"_rows1",function(){return this._rows1=[new Vector3,new Vector3,new Vector3]},"_rows2",function(){return this._rows2=[new Vector3,new Vector3,new Vector3]},"_ray",function(){return this._ray=new Ray(new Vector3,new Vector3)},"_boxBound1",function(){return this._boxBound1=new BoundBox(new Vector3,new Vector3)},"_boxBound2",function(){return this._boxBound2=new BoundBox(new Vector3,new Vector3)},"_boxBound3",function(){return this._boxBound3=new BoundBox(new Vector3,new Vector3)}])}(),function(){function Plane(normal,d){this.normal=null,this.distance=NaN,void 0===d&&(d=0),this.normal=normal,this.distance=d}return __class(Plane,"laya.d3.math.Plane"),Plane.prototype.normalize=function(){var normalE=this.normal.elements,normalEX=normalE[0],normalEY=normalE[1],normalEZ=normalE[2],magnitude=1/Math.sqrt(normalEX*normalEX+normalEY*normalEY+normalEZ*normalEZ);normalE[0]=normalEX*magnitude,normalE[1]=normalEY*magnitude,normalE[2]=normalEZ*magnitude,this.distance*=magnitude},Plane.createPlaneBy3P=function(point1,point2,point3){var point1=point1.elements,point2=point2.elements,point3=point3.elements,x1=point2[0]-point1[0],y1=point2[1]-point1[1],point2=point2[2]-point1[2],x2=point3[0]-point1[0],y2=point3[1]-point1[1],point3=point3[2]-point1[2],yz=y1*point3-point2*y2,point2=point2*x2-x1*point3,point3=x1*y2-y1*x2,x1=1/Math.sqrt(yz*yz+point2*point2+point3*point3),y2=yz*x1,y1=point2*x1,x2=point3*x1,yz=Plane._TEMPVec3.elements,point2=(yz[0]=y2,yz[1]=y1,yz[2]=x2,-(y2*point1[0]+y1*point1[1]+x2*point1[2]));return new Plane(Plane._TEMPVec3,point2)},Plane.PlaneIntersectionType_Back=0,Plane.PlaneIntersectionType_Front=1,Plane.PlaneIntersectionType_Intersecting=2,__static(Plane,["_TEMPVec3",function(){return this._TEMPVec3=new Vector3}]),Plane}()),Quaternion=function(){function Quaternion(x,y,z,w){this.elements=new Float32Array(4),void 0===y&&(y=0),void 0===z&&(z=0),void 0===w&&(w=1),this.elements[0]=x=void 0===x?0:x,this.elements[1]=y,this.elements[2]=z,this.elements[3]=w}__class(Quaternion,"laya.d3.math.Quaternion");var __proto=Quaternion.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.scaling=function(scaling,out){var out=out.elements,f=this.elements;out[0]=f[0]*scaling,out[1]=f[1]*scaling,out[2]=f[2]*scaling,out[3]=f[3]*scaling},__proto.normalize=function(out){var out=out.elements,f=this.elements,x=f[0],y=f[1],z=f[2],f=f[3],len=x*x+y*y+z*z+f*f;0<len&&(len=1/Math.sqrt(len),out[0]=x*len,out[1]=y*len,out[2]=z*len,out[3]=f*len)},__proto.length=function(){var f=this.elements,x=f[0],y=f[1],z=f[2],f=f[3];return Math.sqrt(x*x+y*y+z*z+f*f)},__proto.rotateX=function(rad,out){var out=out.elements,f=this.elements,ax=(rad*=.5,f[0]),ay=f[1],az=f[2],f=f[3],bx=Math.sin(rad),rad=Math.cos(rad);out[0]=ax*rad+f*bx,out[1]=ay*rad+az*bx,out[2]=az*rad-ay*bx,out[3]=f*rad-ax*bx},__proto.rotateY=function(rad,out){var out=out.elements,f=this.elements,ax=(rad*=.5,f[0]),ay=f[1],az=f[2],f=f[3],by=Math.sin(rad),rad=Math.cos(rad);out[0]=ax*rad-az*by,out[1]=ay*rad+f*by,out[2]=az*rad+ax*by,out[3]=f*rad-ay*by},__proto.rotateZ=function(rad,out){var out=out.elements,f=this.elements,ax=(rad*=.5,f[0]),ay=f[1],az=f[2],f=f[3],bz=Math.sin(rad),rad=Math.cos(rad);out[0]=ax*rad+ay*bz,out[1]=ay*rad-ax*bz,out[2]=az*rad+f*bz,out[3]=f*rad-az*bz},__proto.getYawPitchRoll=function(out){Vector3.transformQuat(Vector3.ForwardRH,this,Quaternion.TEMPVector31),Vector3.transformQuat(Vector3.Up,this,Quaternion.TEMPVector32);var upe=Quaternion.TEMPVector32.elements,anglee=(Quaternion.angleTo(Vector3.ZERO,Quaternion.TEMPVector31,Quaternion.TEMPVector33),Quaternion.TEMPVector33.elements),upe=(anglee[0]==Math.PI/2?(anglee[1]=Quaternion.arcTanAngle(upe[2],upe[0]),anglee[2]=0):anglee[0]==-Math.PI/2?(anglee[1]=Quaternion.arcTanAngle(-upe[2],-upe[0]),anglee[2]=0):(Matrix4x4.createRotationY(-anglee[1],Quaternion.TEMPMatrix0),Matrix4x4.createRotationX(-anglee[0],Quaternion.TEMPMatrix1),Vector3.transformCoordinate(Quaternion.TEMPVector32,Quaternion.TEMPMatrix0,Quaternion.TEMPVector32),Vector3.transformCoordinate(Quaternion.TEMPVector32,Quaternion.TEMPMatrix1,Quaternion.TEMPVector32),anglee[2]=Quaternion.arcTanAngle(upe[1],-upe[0])),anglee[1]<=-Math.PI&&(anglee[1]=Math.PI),anglee[2]<=-Math.PI&&(anglee[2]=Math.PI),anglee[1]>=Math.PI&&anglee[2]>=Math.PI&&(anglee[1]=0,anglee[2]=0,anglee[0]=Math.PI-anglee[0]),out.elements);upe[0]=anglee[1],upe[1]=anglee[0],upe[2]=anglee[2]},__proto.invert=function(out){var out=out.elements,f=this.elements,a0=f[0],a1=f[1],a2=f[2],f=f[3],dot=a0*a0+a1*a1+a2*a2+f*f,dot=dot?1/dot:0;out[0]=-a0*dot,out[1]=-a1*dot,out[2]=-a2*dot,out[3]=f*dot},__proto.identity=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=1},__proto.fromArray=function(array,offset){this.elements[0]=array[(offset=void 0===offset?0:offset)+0],this.elements[1]=array[offset+1],this.elements[2]=array[offset+2],this.elements[3]=array[offset+3]},__proto.cloneTo=function(destObject){var i,s=this.elements,d=destObject.elements;if(s!==d)for(i=0;i<4;++i)d[i]=s[i]},__proto.clone=function(){var dest=new this.constructor;return this.cloneTo(dest),dest},__proto.equals=function(b){var ae=this.elements,b=b.elements;return MathUtils3D.nearEqual(ae[0],b[0])&&MathUtils3D.nearEqual(ae[1],b[1])&&MathUtils3D.nearEqual(ae[2],b[2])&&MathUtils3D.nearEqual(ae[3],b[3])},__proto.lengthSquared=function(){var x=this.elements[0],y=this.elements[1],z=this.elements[2],w=this.elements[3];return x*x+y*y+z*z+w*w},__getset(0,__proto,"x",function(){return this.elements[0]}),__getset(0,__proto,"y",function(){return this.elements[1]}),__getset(0,__proto,"z",function(){return this.elements[2]}),__getset(0,__proto,"w",function(){return this.elements[3]}),Quaternion.createFromYawPitchRoll=function(yaw,pitch,roll,out){var roll=.5*roll,pitch=.5*pitch,yaw=.5*yaw,sinRoll=Math.sin(roll),roll=Math.cos(roll),sinPitch=Math.sin(pitch),pitch=Math.cos(pitch),sinYaw=Math.sin(yaw),yaw=Math.cos(yaw),out=out.elements;out[0]=yaw*sinPitch*roll+sinYaw*pitch*sinRoll,out[1]=sinYaw*pitch*roll-yaw*sinPitch*sinRoll,out[2]=yaw*pitch*sinRoll-sinYaw*sinPitch*roll,out[3]=yaw*pitch*roll+sinYaw*sinPitch*sinRoll},Quaternion.multiply=function(left,right,out){var left=left.elements,right=right.elements,out=out.elements,lx=left[0],ly=left[1],lz=left[2],left=left[3],rx=right[0],ry=right[1],rz=right[2],right=right[3],b=lz*rx-lx*rz,c=lx*ry-ly*rx,d=lx*rx+ly*ry+lz*rz;out[0]=lx*right+rx*left+(ly*rz-lz*ry),out[1]=ly*right+ry*left+b,out[2]=lz*right+rz*left+c,out[3]=left*right-d},Quaternion.arcTanAngle=function(x,y){return 0==x?1==y?Math.PI/2:-Math.PI/2:0<x?Math.atan(y/x):x<0?0<y?Math.atan(y/x)+Math.PI:Math.atan(y/x)-Math.PI:0},Quaternion.angleTo=function(from,location,angle){Vector3.subtract(location,from,Quaternion.TEMPVector30),Vector3.normalize(Quaternion.TEMPVector30,Quaternion.TEMPVector30),angle.elements[0]=Math.asin(Quaternion.TEMPVector30.y),angle.elements[1]=Quaternion.arcTanAngle(-Quaternion.TEMPVector30.z,-Quaternion.TEMPVector30.x)},Quaternion.createFromAxisAngle=function(axis,rad,out){var out=out.elements,axis=axis.elements,s=(rad*=.5,Math.sin(rad));out[0]=s*axis[0],out[1]=s*axis[1],out[2]=s*axis[2],out[3]=Math.cos(rad)},Quaternion.createFromMatrix3x3=function(sou,out){var j,k,fRoot,out=out.elements,sou=sou.elements,fTrace=sou[0]+sou[4]+sou[8];0<fTrace?(fRoot=Math.sqrt(fTrace+1),out[3]=.5*fRoot,out[0]=(sou[5]-sou[7])*(fRoot=.5/fRoot),out[1]=(sou[6]-sou[2])*fRoot,out[2]=(sou[1]-sou[3])*fRoot):(sou[4]>sou[fTrace=0]&&(fTrace=1),j=((fTrace=sou[8]>sou[3*fTrace+fTrace]?2:fTrace)+1)%3,k=(fTrace+2)%3,fRoot=Math.sqrt(sou[3*fTrace+fTrace]-sou[3*j+j]-sou[3*k+k]+1),out[fTrace]=.5*fRoot,out[3]=(sou[3*j+k]-sou[3*k+j])*(fRoot=.5/fRoot),out[j]=(sou[3*j+fTrace]+sou[3*fTrace+j])*fRoot,out[k]=(sou[3*k+fTrace]+sou[3*fTrace+k])*fRoot)},Quaternion.createFromMatrix4x4=function(mat,out){var sqrt,half,mat=mat.elements,out=out.elements,scale=mat[0]+mat[5]+mat[10];0<scale?(sqrt=Math.sqrt(scale+1),out[3]=.5*sqrt,out[0]=(mat[6]-mat[9])*(sqrt=.5/sqrt),out[1]=(mat[8]-mat[2])*sqrt,out[2]=(mat[1]-mat[4])*sqrt):mat[0]>=mat[5]&&mat[0]>=mat[10]?(half=.5/(sqrt=Math.sqrt(1+mat[0]-mat[5]-mat[10])),out[0]=.5*sqrt,out[1]=(mat[1]+mat[4])*half,out[2]=(mat[2]+mat[8])*half,out[3]=(mat[6]-mat[9])*half):mat[5]>mat[10]?(sqrt=Math.sqrt(1+mat[5]-mat[0]-mat[10]),out[0]=(mat[4]+mat[1])*(half=.5/sqrt),out[1]=.5*sqrt,out[2]=(mat[9]+mat[6])*half,out[3]=(mat[8]-mat[2])*half):(sqrt=Math.sqrt(1+mat[10]-mat[0]-mat[5]),out[0]=(mat[8]+mat[2])*(half=.5/sqrt),out[1]=(mat[9]+mat[6])*half,out[2]=.5*sqrt,out[3]=(mat[1]-mat[4])*half)},Quaternion.slerp=function(left,right,t,out){var sinom,scale0,left=left.elements,right=right.elements,out=out.elements,ax=left[0],ay=left[1],az=left[2],left=left[3],bx=right[0],by=right[1],bz=right[2],right=right[3],cosom=ax*bx+ay*by+az*bz+left*right;return cosom<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,right=-right),cosom=1e-6<1-cosom?(cosom=Math.acos(cosom),sinom=Math.sin(cosom),scale0=Math.sin((1-t)*cosom)/sinom,Math.sin(t*cosom)/sinom):(scale0=1-t,t),out[0]=scale0*ax+cosom*bx,out[1]=scale0*ay+cosom*by,out[2]=scale0*az+cosom*bz,out[3]=scale0*left+cosom*right,out},Quaternion.lerp=function(left,right,t,out){var out=out.elements,left=left.elements,right=right.elements,ax=left[0],ay=left[1],az=left[2],left=left[3];out[0]=ax+t*(right[0]-ax),out[1]=ay+t*(right[1]-ay),out[2]=az+t*(right[2]-az),out[3]=left+t*(right[3]-left)},Quaternion.add=function(left,right,out){out=out.elements,left=left.elements,right=right.elements;out[0]=left[0]+right[0],out[1]=left[1]+right[1],out[2]=left[2]+right[2],out[3]=left[3]+right[3]},Quaternion.dot=function(left,right){left=left.elements,right=right.elements;return left[0]*right[0]+left[1]*right[1]+left[2]*right[2]+left[3]*right[3]},Quaternion.rotationLookAt=function(forward,up,out){Quaternion.lookAt(Vector3.ZERO,forward,up,out)},Quaternion.lookAt=function(eye,target,up,out){Matrix3x3.lookAt(eye,target,up,Quaternion._tempMatrix3x3),Quaternion.rotationMatrix(Quaternion._tempMatrix3x3,out)},Quaternion.invert=function(value,out){var vE=value.elements,out=out.elements,value=value.lengthSquared();MathUtils3D.isZero(value)||(out[0]=-vE[0]*(value=1/value),out[1]=-vE[1]*value,out[2]=-vE[2]*value,out[3]=vE[3]*value)},Quaternion.rotationMatrix=function(matrix3x3,out){var matrix3x3=matrix3x3.elements,m11=matrix3x3[0],m12=matrix3x3[1],m13=matrix3x3[2],m21=matrix3x3[3],m22=matrix3x3[4],m23=matrix3x3[5],m31=matrix3x3[6],m32=matrix3x3[7],matrix3x3=matrix3x3[8],out=out.elements,sqrt=NaN,half=NaN,scale=m11+m22+matrix3x3;0<scale?(sqrt=Math.sqrt(scale+1),out[3]=.5*sqrt,out[0]=(m23-m32)*(sqrt=.5/sqrt),out[1]=(m31-m13)*sqrt,out[2]=(m12-m21)*sqrt):m22<=m11&&matrix3x3<=m11?(half=.5/(sqrt=Math.sqrt(1+m11-m22-matrix3x3)),out[0]=.5*sqrt,out[1]=(m12+m21)*half,out[2]=(m13+m31)*half,out[3]=(m23-m32)*half):matrix3x3<m22?(sqrt=Math.sqrt(1+m22-m11-matrix3x3),out[0]=(m21+m12)*(half=.5/sqrt),out[1]=.5*sqrt,out[2]=(m32+m23)*half,out[3]=(m31-m13)*half):(sqrt=Math.sqrt(1+matrix3x3-m11-m22),out[0]=(m31+m13)*(half=.5/sqrt),out[1]=(m32+m23)*half,out[2]=.5*sqrt,out[3]=(m12-m21)*half)},Quaternion.DEFAULT=new Quaternion,__static(Quaternion,["TEMPVector30",function(){return this.TEMPVector30=new Vector3},"TEMPVector31",function(){return this.TEMPVector31=new Vector3},"TEMPVector32",function(){return this.TEMPVector32=new Vector3},"TEMPVector33",function(){return this.TEMPVector33=new Vector3},"TEMPMatrix0",function(){return this.TEMPMatrix0=new Matrix4x4},"TEMPMatrix1",function(){return this.TEMPMatrix1=new Matrix4x4},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new Matrix3x3},"NAN",function(){return this.NAN=new Quaternion(NaN,NaN,NaN,NaN)}]),Quaternion}(),Rand=function(){function Rand(seed){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=seed,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}__class(Rand,"laya.d3.math.Rand");var __proto=Rand.prototype;return __proto.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^(this._temp[0]^this._temp[0]>>>8),this.seeds[3]},__proto.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},__proto.getSignedFloat=function(){return 2*this.getFloat()-1},__getset(0,__proto,"seed",function(){return this.seeds[0]},function(seed){this.seeds[0]=seed,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),Rand.getFloatFromInt=function(v){return 1/8388607*(8388607&v)},Rand.getByteFromInt=function(v){return(8388607&v)>>>15},Rand}(),Ray=(function(){function RandX(seed){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(seed instanceof Array)||4!==seed.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|seed[0],this._state0L=0|seed[1],this._state1U=0|seed[2],this._state1L=0|seed[3]}__class(RandX,"laya.d3.math.RandX");var __proto=RandX.prototype;__proto.randomint=function(){var s1U=this._state0U,s1L=this._state0L,s0U=this._state1U,s0L=this._state1L,sumL=(s0L>>>0)+(s1L>>>0),resU=s0U+s1U+(sumL/2>>>31)>>>0,sumL=sumL>>>0,t1U=0,t1L=0;t1U=(s1U^=t1U=s1U<<23|(-512&s1L)>>>9)^(this._state0U=s0U),t1L=(s1L^=t1L=s1L<<23)^(this._state0L=s0L),t1U^=s1U>>>18;return t1L=t1L^(s1L>>>18|(262143&s1U)<<14)^(s0L>>>5|(31&s0U)<<27),this._state1U=t1U^=s0U>>>5,this._state1L=t1L,[resU,sumL]},__proto.random=function(){var t2=this.randomint(),t2U=t2[0],t2=0|(t2[1]>>>12|(4095&t2U)<<20);return RandX._CONVERTION_BUFFER.setUint32(0,1023<<20|t2U>>>12,!1),RandX._CONVERTION_BUFFER.setUint32(4,t2,!1),Rand._CONVERTION_BUFFER.getFloat64(0,!1)-1},__static(RandX,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new Rand([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function Ray(origin,direction){this.origin=null,this.direction=null,this.origin=origin,this.direction=direction}return __class(Ray,"laya.d3.math.Ray"),Ray}()),Vector2=function(){function Vector2(x,y){this.elements=new Float32Array(2),void 0===y&&(y=0);var v=this.elements;v[0]=x=void 0===x?0:x,v[1]=y}__class(Vector2,"laya.d3.math.Vector2");var __proto=Vector2.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.fromArray=function(array,offset){this.elements[0]=array[(offset=void 0===offset?0:offset)+0],this.elements[1]=array[offset+1]},__proto.cloneTo=function(destObject){var destObject=destObject.elements,s=this.elements;destObject[0]=s[0],destObject[1]=s[1]},__proto.clone=function(){var destVector2=new this.constructor;return this.cloneTo(destVector2),destVector2},__getset(0,__proto,"x",function(){return this.elements[0]},function(value){this.elements[0]=value}),__getset(0,__proto,"y",function(){return this.elements[1]},function(value){this.elements[1]=value}),Vector2.scale=function(a,b,out){out=out.elements,a=a.elements;out[0]=a[0]*b,out[1]=a[1]*b},__static(Vector2,["ZERO",function(){return this.ZERO=new Vector2(0,0)},"ONE",function(){return this.ONE=new Vector2(1,1)}]),Vector2}(),Vector3=function(){function Vector3(x,y,z){this.elements=new Float32Array(3),void 0===y&&(y=0),void 0===z&&(z=0);var v=this.elements;v[0]=x=void 0===x?0:x,v[1]=y,v[2]=z}__class(Vector3,"laya.d3.math.Vector3");var __proto=Vector3.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.fromArray=function(array,offset){this.elements[0]=array[(offset=void 0===offset?0:offset)+0],this.elements[1]=array[offset+1],this.elements[2]=array[offset+2]},__proto.cloneTo=function(destObject){var destObject=destObject.elements,s=this.elements;destObject[0]=s[0],destObject[1]=s[1],destObject[2]=s[2]},__proto.clone=function(){var destVector3=new this.constructor;return this.cloneTo(destVector3),destVector3},__proto.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},__proto.reset=function(x,y,z){this.elements[0]=x,this.elements[1]=y,this.elements[2]=z},__getset(0,__proto,"x",function(){return this.elements[0]},function(value){this.elements[0]=value}),__getset(0,__proto,"y",function(){return this.elements[1]},function(value){this.elements[1]=value}),__getset(0,__proto,"z",function(){return this.elements[2]},function(value){this.elements[2]=value}),Vector3.distanceSquared=function(value1,value2){var value1=value1.elements,value2=value2.elements,x=value1[0]-value2[0],y=value1[1]-value2[1],value1=value1[2]-value2[2];return x*x+y*y+value1*value1},Vector3.distance=function(value1,value2){var value1=value1.elements,value2=value2.elements,x=value1[0]-value2[0],y=value1[1]-value2[1],value1=value1[2]-value2[2];return Math.sqrt(x*x+y*y+value1*value1)},Vector3.min=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2])},Vector3.max=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2])},Vector3.transformQuat=function(source,rotation,out){var out=out.elements,source=source.elements,rotation=rotation.elements,x=source[0],y=source[1],source=source[2],qx=rotation[0],qy=rotation[1],qz=rotation[2],rotation=rotation[3],ix=rotation*x+qy*source-qz*y,iy=rotation*y+qz*x-qx*source,iz=rotation*source+qx*y-qy*x,x=-qx*x-qy*y-qz*source;out[0]=ix*rotation+x*-qx+iy*-qz-iz*-qy,out[1]=iy*rotation+x*-qy+iz*-qx-ix*-qz,out[2]=iz*rotation+x*-qz+ix*-qy-iy*-qx},Vector3.scalarLength=function(a){var a=a.elements,x=a[0],y=a[1],a=a[2];return Math.sqrt(x*x+y*y+a*a)},Vector3.scalarLengthSquared=function(a){var a=a.elements,x=a[0],y=a[1],a=a[2];return x*x+y*y+a*a},Vector3.normalize=function(s,out){var s=s.elements,out=out.elements,x=s[0],y=s[1],z=s[2],x=x*x+y*y+z*z;0<x&&(x=1/Math.sqrt(x),out[0]=s[0]*x,out[1]=s[1]*x,out[2]=s[2]*x)},Vector3.multiply=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2]},Vector3.scale=function(a,b,out){out=out.elements,a=a.elements;out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b},Vector3.lerp=function(a,b,t,out){var out=out.elements,a=a.elements,b=b.elements,ax=a[0],ay=a[1],a=a[2];out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=a+t*(b[2]-a)},Vector3.transformV3ToV3=function(vector,transform,result){var intermediate=Vector3._tempVector4,vector=(Vector3.transformV3ToV4(vector,transform,intermediate),intermediate.elements),transform=result.elements;transform[0]=vector[0],transform[1]=vector[1],transform[2]=vector[2]},Vector3.transformV3ToV4=function(vector,transform,result){var vector=vector.elements,vectorX=vector[0],vectorY=vector[1],vector=vector[2],transform=transform.elements,result=result.elements;result[0]=vectorX*transform[0]+vectorY*transform[4]+vector*transform[8]+transform[12],result[1]=vectorX*transform[1]+vectorY*transform[5]+vector*transform[9]+transform[13],result[2]=vectorX*transform[2]+vectorY*transform[6]+vector*transform[10]+transform[14],result[3]=vectorX*transform[3]+vectorY*transform[7]+vector*transform[11]+transform[15]},Vector3.TransformNormal=function(normal,transform,result){var normal=normal.elements,normalX=normal[0],normalY=normal[1],normal=normal[2],transform=transform.elements,result=result.elements;result[0]=normalX*transform[0]+normalY*transform[4]+normal*transform[8],result[1]=normalX*transform[1]+normalY*transform[5]+normal*transform[9],result[2]=normalX*transform[2]+normalY*transform[6]+normal*transform[10]},Vector3.transformCoordinate=function(coordinate,transform,result){var vectorElem=Vector3._tempVector4.elements,coordinate=coordinate.elements,coordinateX=coordinate[0],coordinateY=coordinate[1],coordinate=coordinate[2],transform=transform.elements,coordinateX=(vectorElem[0]=coordinateX*transform[0]+coordinateY*transform[4]+coordinate*transform[8]+transform[12],vectorElem[1]=coordinateX*transform[1]+coordinateY*transform[5]+coordinate*transform[9]+transform[13],vectorElem[2]=coordinateX*transform[2]+coordinateY*transform[6]+coordinate*transform[10]+transform[14],vectorElem[3]=1/(coordinateX*transform[3]+coordinateY*transform[7]+coordinate*transform[11]+transform[15]),result.elements);coordinateX[0]=vectorElem[0]*vectorElem[3],coordinateX[1]=vectorElem[1]*vectorElem[3],coordinateX[2]=vectorElem[2]*vectorElem[3]},Vector3.Clamp=function(value,min,max,out){var value=value.elements,x=value[0],y=value[1],value=value[2],min=min.elements,mineX=min[0],mineY=min[1],min=min[2],max=max.elements,maxeX=max[0],maxeY=max[1],max=max[2],out=out.elements,y=(y=maxeY<y?maxeY:y)<mineY?mineY:y,value=(value=max<value?max:value)<min?min:value;out[0]=(x=maxeX<x?maxeX:x)<mineX?mineX:x,out[1]=y,out[2]=value},Vector3.add=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2]},Vector3.subtract=function(a,b,o){o=o.elements,a=a.elements,b=b.elements;o[0]=a[0]-b[0],o[1]=a[1]-b[1],o[2]=a[2]-b[2]},Vector3.cross=function(a,b,o){var a=a.elements,b=b.elements,o=o.elements,ax=a[0],ay=a[1],a=a[2],bx=b[0],by=b[1],b=b[2];o[0]=ay*b-a*by,o[1]=a*bx-ax*b,o[2]=ax*by-ay*bx},Vector3.dot=function(a,b){a=a.elements,b=b.elements;return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},Vector3.equals=function(a,b){a=a.elements,b=b.elements;return MathUtils3D.nearEqual(Math.abs(a[0]),Math.abs(b[0]))&&MathUtils3D.nearEqual(Math.abs(a[1]),Math.abs(b[1]))&&MathUtils3D.nearEqual(Math.abs(a[2]),Math.abs(b[2]))},Vector3.ZERO=new Vector3(0,0,0),Vector3.ONE=new Vector3(1,1,1),Vector3.NegativeUnitX=new Vector3(-1,0,0),Vector3.UnitX=new Vector3(1,0,0),Vector3.UnitY=new Vector3(0,1,0),Vector3.UnitZ=new Vector3(0,0,1),Vector3.ForwardRH=new Vector3(0,0,-1),Vector3.ForwardLH=new Vector3(0,0,1),Vector3.Up=new Vector3(0,1,0),Vector3.NAN=new Vector3(NaN,NaN,NaN),__static(Vector3,["_tempVector4",function(){return this._tempVector4=new Vector4}]),Vector3}(),Vector4=function(){function Vector4(x,y,z,w){this.elements=new Float32Array(4),void 0===y&&(y=0),void 0===z&&(z=0),void 0===w&&(w=0);var v=this.elements;v[0]=x=void 0===x?0:x,v[1]=y,v[2]=z,v[3]=w}__class(Vector4,"laya.d3.math.Vector4");var __proto=Vector4.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto.fromArray=function(array,offset){this.elements[0]=array[(offset=void 0===offset?0:offset)+0],this.elements[1]=array[offset+1],this.elements[2]=array[offset+2],this.elements[3]=array[offset+3]},__proto.cloneTo=function(destObject){var destObject=destObject.elements,s=this.elements;destObject[0]=s[0],destObject[1]=s[1],destObject[2]=s[2],destObject[3]=s[3]},__proto.clone=function(){var destVector4=new this.constructor;return this.cloneTo(destVector4),destVector4},__proto.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},__proto.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},__getset(0,__proto,"x",function(){return this.elements[0]},function(value){this.elements[0]=value}),__getset(0,__proto,"y",function(){return this.elements[1]},function(value){this.elements[1]=value}),__getset(0,__proto,"z",function(){return this.elements[2]},function(value){this.elements[2]=value}),__getset(0,__proto,"w",function(){return this.elements[3]},function(value){this.elements[3]=value}),Vector4.lerp=function(a,b,t,out){var out=out.elements,a=a.elements,b=b.elements,ax=a[0],ay=a[1],az=a[2],a=a[3];out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out[3]=a+t*(b[3]-a)},Vector4.transformByM4x4=function(vector4,m4x4,out){var vector4=vector4.elements,vx=vector4[0],vy=vector4[1],vz=vector4[2],vector4=vector4[3],m4x4=m4x4.elements,out=out.elements;out[0]=vx*m4x4[0]+vy*m4x4[4]+vz*m4x4[8]+vector4*m4x4[12],out[1]=vx*m4x4[1]+vy*m4x4[5]+vz*m4x4[9]+vector4*m4x4[13],out[2]=vx*m4x4[2]+vy*m4x4[6]+vz*m4x4[10]+vector4*m4x4[14],out[3]=vx*m4x4[3]+vy*m4x4[7]+vz*m4x4[11]+vector4*m4x4[15]},Vector4.equals=function(a,b){a=a.elements,b=b.elements;return MathUtils3D.nearEqual(Math.abs(a[0]),Math.abs(b[0]))&&MathUtils3D.nearEqual(Math.abs(a[1]),Math.abs(b[1]))&&MathUtils3D.nearEqual(Math.abs(a[2]),Math.abs(b[2]))&&MathUtils3D.nearEqual(Math.abs(a[3]),Math.abs(b[3]))},Vector4.normalize=function(s,out){var se=s.elements,out=out.elements,s=s.length();0<s&&(out[0]=se[0]*s,out[1]=se[1]*s,out[2]=se[2]*s,out[3]=se[3]*s)},Vector4.add=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3]},Vector4.subtract=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3]},Vector4.multiply=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out[3]=a[3]*b[3]},Vector4.scale=function(a,b,out){out=out.elements,a=a.elements;out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b},Vector4.Clamp=function(value,min,max,out){var value=value.elements,x=value[0],y=value[1],z=value[2],value=value[3],min=min.elements,mineX=min[0],mineY=min[1],mineZ=min[2],min=min[3],max=max.elements,maxeX=max[0],maxeY=max[1],maxeZ=max[2],max=max[3],out=out.elements,y=(y=maxeY<y?maxeY:y)<mineY?mineY:y,z=(z=maxeZ<z?maxeZ:z)<mineZ?mineZ:z,value=(value=max<value?max:value)<min?min:value;out[0]=(x=maxeX<x?maxeX:x)<mineX?mineX:x,out[1]=y,out[2]=z,out[3]=value},Vector4.distanceSquared=function(value1,value2){var value1=value1.elements,value2=value2.elements,x=value1[0]-value2[0],y=value1[1]-value2[1],z=value1[2]-value2[2],value1=value1[3]-value2[3];return x*x+y*y+z*z+value1*value1},Vector4.distance=function(value1,value2){var value1=value1.elements,value2=value2.elements,x=value1[0]-value2[0],y=value1[1]-value2[1],z=value1[2]-value2[2],value1=value1[3]-value2[3];return Math.sqrt(x*x+y*y+z*z+value1*value1)},Vector4.dot=function(a,b){a=a.elements,b=b.elements;return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},Vector4.min=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out[3]=Math.min(a[3],b[3])},Vector4.max=function(a,b,out){out=out.elements,a=a.elements,b=b.elements;out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out[3]=Math.max(a[3],b[3])},__static(Vector4,["ZERO",function(){return this.ZERO=new Vector4},"ONE",function(){return this.ONE=new Vector4(1,1,1,1)},"UnitX",function(){return this.UnitX=new Vector4(1,0,0,0)},"UnitY",function(){return this.UnitY=new Vector4(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new Vector4(0,0,1,0)},"UnitW",function(){return this.UnitW=new Vector4(0,0,0,1)}]),Vector4}(),Viewport=function(){function Viewport(x,y,width,height){this.minDepth=0,this.maxDepth=1,this.x=x,this.y=y,this.width=width,this.height=height}__class(Viewport,"laya.d3.math.Viewport");var __proto=Viewport.prototype;return __proto.project=function(source,matrix,out){Vector3.transformV3ToV3(source,matrix,out);source=source.elements,matrix=matrix.elements,out=out.elements,source=source[0]*matrix[3]+source[1]*matrix[7]+source[2]*matrix[11]+matrix[15];1!==source&&(out[0]=out[0]/source,out[1]=out[1]/source,out[2]=out[2]/source),out[0]=.5*(out[0]+1)*this.width+this.x,out[1]=.5*(1-out[1])*this.height+this.y,out[2]=out[2]*(this.maxDepth-this.minDepth)+this.minDepth},__proto.unprojectFromMat=function(source,matrix,out){var source=source.elements,matrixEleme=matrix.elements,outEleme=out.elements,halfDepth=(outEleme[0]=(source[0]-this.x)/this.width*2-1,outEleme[1]=-((source[1]-this.y)/this.height*2-1),(this.maxDepth-this.minDepth)/2),source=(outEleme[2]=(source[2]-this.minDepth-halfDepth)/halfDepth,outEleme[0]*matrixEleme[3]+outEleme[1]*matrixEleme[7]+outEleme[2]*matrixEleme[11]+matrixEleme[15]);Vector3.transformV3ToV3(out,matrix,out),1!==source&&(outEleme[0]=outEleme[0]/source,outEleme[1]=outEleme[1]/source,outEleme[2]=outEleme[2]/source)},__proto.unprojectFromWVP=function(source,projection,view,world,out){Matrix4x4.multiply(projection,view,Viewport._tempMatrix4x4),world&&Matrix4x4.multiply(Viewport._tempMatrix4x4,world,Viewport._tempMatrix4x4),Viewport._tempMatrix4x4.invert(Viewport._tempMatrix4x4),this.unprojectFromMat(source,Viewport._tempMatrix4x4,out)},__static(Viewport,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new Matrix4x4}]),Viewport}(),SubMesh=function(){function SubMesh(mesh){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=mesh,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}__class(SubMesh,"laya.d3.resource.models.SubMesh");var __proto=SubMesh.prototype;return Laya.imps(__proto,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),__proto._getVertexBuffer=function(index){return 0===(index=void 0===index?0:index)?this._vertexBuffer:null},__proto._getIndexBuffer=function(){return this._indexBuffer},__proto._getStaticBatchBakedVertexs=function(batchOwnerTransform,owner){var uv1Element,result,vertexBuffer=this._vertexBuffer,vertexDeclaration=vertexBuffer.vertexDeclaration,positionOffset=vertexDeclaration.getVertexElementByUsage(0).offset/4,normalOffset=vertexDeclaration.getVertexElementByUsage(3).offset/4,lightmapScaleOffset=owner.meshRender.lightmapScaleOffset,i=0,n=0,bakedVertexFloatCount=0,lightingMapTexcoordOffset=0,uv0Offset=0,oriVertexFloatCount=0;if(lightmapScaleOffset)if(uv1Element=vertexDeclaration.getVertexElementByUsage(15))bakedVertexFloatCount=vertexDeclaration.vertexStride/4,bakedVertexes=0<this._vertexCount?vertexBuffer.getData().slice(this._vertexStart*bakedVertexFloatCount,(this._vertexStart+this._vertexCount)*bakedVertexFloatCount):vertexBuffer.getData().slice(),lightingMapTexcoordOffset=uv1Element.offset/4;else for(var bakedVertexFloatCount=(oriVertexFloatCount=vertexDeclaration.vertexStride/4)+2,bakedVertexes=this._vertexCount?new Float32Array(this._vertexCount*(vertexBuffer.vertexDeclaration.vertexStride/4+2)):new Float32Array(vertexBuffer.vertexCount*(vertexBuffer.vertexDeclaration.vertexStride/4+2)),lightingMapTexcoordOffset=(uv0Offset=vertexDeclaration.getVertexElementByUsage(2).offset/4)+2,oriVertexes=vertexBuffer.getData(),i=0,n=oriVertexes.length/oriVertexFloatCount;i<n;i++){for(var oriVertexOffset=0,oriVertexOffset=0<this._vertexCount?(this._vertexStart+i)*oriVertexFloatCount:i*oriVertexFloatCount,bakedVertexOffset=i*bakedVertexFloatCount,j=0,j=0;j<lightingMapTexcoordOffset;j++)bakedVertexes[bakedVertexOffset+j]=oriVertexes[oriVertexOffset+j];for(j=lightingMapTexcoordOffset;j<oriVertexFloatCount;j++)bakedVertexes[bakedVertexOffset+j+2]=oriVertexes[oriVertexOffset+j]}else bakedVertexFloatCount=vertexDeclaration.vertexStride/4,bakedVertexes=this._vertexCount?vertexBuffer.getData().slice(this._vertexStart*bakedVertexFloatCount,(this._vertexStart+this._vertexCount)*bakedVertexFloatCount):vertexBuffer.getData().slice();batchOwnerTransform?(batchOwnerTransform.worldMatrix.invert(vertexDeclaration=SubMesh._tempMatrix4x40),vertexBuffer=owner.transform.worldMatrix,Matrix4x4.multiply(vertexDeclaration,vertexBuffer,result=SubMesh._tempMatrix4x41)):result=owner.transform.worldMatrix;var rotation=SubMesh._tempQuaternion0;for(result.decomposeTransRotScale(SubMesh._tempVector30,rotation,SubMesh._tempVector31),i=0,n=bakedVertexes.length/bakedVertexFloatCount;i<n;i++){var posOffset=i*bakedVertexFloatCount+positionOffset,norOffset=i*bakedVertexFloatCount+normalOffset;Utils3D.transformVector3ArrayToVector3ArrayCoordinate(bakedVertexes,posOffset,result,bakedVertexes,posOffset),Utils3D.transformVector3ArrayByQuat(bakedVertexes,norOffset,rotation,bakedVertexes,norOffset),lightmapScaleOffset&&(posOffset=i*bakedVertexFloatCount+lightingMapTexcoordOffset,uv1Element?Utils3D.transformLightingMapTexcoordByUV1Array(bakedVertexes,posOffset,lightmapScaleOffset,bakedVertexes,posOffset):Utils3D.transformLightingMapTexcoordByUV0Array(oriVertexes,i*oriVertexFloatCount+uv0Offset,lightmapScaleOffset,bakedVertexes,posOffset))}return bakedVertexes},__proto._getVertexBuffers=function(){return null},__proto._beforeRender=function(state){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},__proto._render=function(state){var skinAnimationDatas,indexCount=0,renderElement=state.renderElement;if(1<this._indexCount){var boneIndicesListCount=this._boneIndicesList.length;if(1<boneIndicesListCount){for(var i=0;i<boneIndicesListCount;i++)(skinAnimationDatas=renderElement._skinAnimationDatas||this._skinAnimationDatas)&&(renderElement._shaderValue.setValue(0,skinAnimationDatas[i]),state._shader.uploadRenderElementUniforms(renderElement._shaderValue.data)),WebGL.mainContext.drawElements(4,this._subIndexBufferCount[i],5123,2*this._subIndexBufferStart[i]);Stat.drawCall+=boneIndicesListCount}else(skinAnimationDatas=renderElement._skinAnimationDatas||this._skinAnimationDatas)&&(renderElement._shaderValue.setValue(0,skinAnimationDatas[0]),state._shader.uploadRenderElementUniforms(renderElement._shaderValue.data)),WebGL.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),Stat.drawCall++;indexCount=this._indexCount}else indexCount=this._indexBuffer.indexCount,(skinAnimationDatas=renderElement._skinAnimationDatas||this._skinAnimationDatas)&&(renderElement._shaderValue.setValue(0,skinAnimationDatas[0]),state._shader.uploadRenderElementUniforms(renderElement._shaderValue.data)),WebGL.mainContext.drawElements(4,indexCount,5123,0),Stat.drawCall++;Stat.trianglesFaces+=indexCount/3},__proto.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},__proto.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},__getset(0,__proto,"_vertexBufferCount",function(){return 1}),__getset(0,__proto,"triangleCount",function(){return this._indexBuffer.indexCount/3}),__static(SubMesh,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempQuaternion0",function(){return this._tempQuaternion0=new Quaternion},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new Matrix4x4},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new Matrix4x4}]),SubMesh}(),ShaderDefines$1=(__class(ShaderDefines,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),ShaderDefines.prototype.registerDefine=function(name){var value=Math.pow(2,this.defineCounter++);return this.defines[value]=name,value},ShaderDefines);function ShaderDefines(shaderdefines){this.defineCounter=0,this.defines=null,shaderdefines?(this.defineCounter=shaderdefines.defineCounter,this.defines=shaderdefines.defines.slice()):(this.defineCounter=0,this.defines=[])}var ShaderInit3D=function(){function ShaderInit3D(){}return __class(ShaderInit3D,"laya.d3.shader.ShaderInit3D"),ShaderInit3D.__init__=function(){ShaderCompile3D._globalRegDefine("HIGHPRECISION",ShaderCompile3D.SHADERDEFINE_HIGHPRECISION),ShaderCompile3D._globalRegDefine("FOG",ShaderCompile3D.SHADERDEFINE_FOG),ShaderCompile3D._globalRegDefine("DIRECTIONLIGHT",ShaderCompile3D.SHADERDEFINE_DIRECTIONLIGHT),ShaderCompile3D._globalRegDefine("POINTLIGHT",ShaderCompile3D.SHADERDEFINE_POINTLIGHT),ShaderCompile3D._globalRegDefine("SPOTLIGHT",ShaderCompile3D.SHADERDEFINE_SPOTLIGHT),ShaderCompile3D._globalRegDefine("UV",ShaderCompile3D.SHADERDEFINE_UV0),ShaderCompile3D._globalRegDefine("COLOR",ShaderCompile3D.SHADERDEFINE_COLOR),ShaderCompile3D._globalRegDefine("UV1",ShaderCompile3D.SHADERDEFINE_UV1),ShaderCompile3D._globalRegDefine("CASTSHADOW",ParallelSplitShadowMap.SHADERDEFINE_CAST_SHADOW),ShaderCompile3D._globalRegDefine("SHADOWMAP_PSSM1",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1),ShaderCompile3D._globalRegDefine("SHADOWMAP_PSSM2",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2),ShaderCompile3D._globalRegDefine("SHADOWMAP_PSSM3",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3),ShaderCompile3D._globalRegDefine("SHADOWMAP_PCF_NO",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO),ShaderCompile3D._globalRegDefine("SHADOWMAP_PCF1",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1),ShaderCompile3D._globalRegDefine("SHADOWMAP_PCF2",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2),ShaderCompile3D._globalRegDefine("SHADOWMAP_PCF3",ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3),ShaderCompile3D._globalRegDefine("DEPTHFOG",ShaderCompile3D.SAHDERDEFINE_DEPTHFOG),Shader3D.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Shader3D.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),attributeMap={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},uniformMap={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var attributeMap,uniformMap,SIMPLE=Shader3D.nameKey.add("SIMPLE");shaderCompile=ShaderCompile3D.add(SIMPLE,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',attributeMap,uniformMap),StandardMaterial.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),StandardMaterial.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),StandardMaterial.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),StandardMaterial.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),StandardMaterial.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),StandardMaterial.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),StandardMaterial.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),StandardMaterial.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),StandardMaterial.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},ShaderInit3D}(),ValusArray=function(){function ValusArray(){this._data=null,this._data=[]}__class(ValusArray,"laya.d3.shader.ValusArray");var __proto=ValusArray.prototype;return __proto.setValue=function(name,value){this._data[name]=value},__getset(0,__proto,"data",function(){return this._data}),ValusArray}(),ParallelSplitShadowMap=function(){function ParallelSplitShadowMap(){}return ParallelSplitShadowMap.SHADERDEFINE_RECEIVE_SHADOW=1,ParallelSplitShadowMap.SHADERDEFINE_CAST_SHADOW=512,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM1=1024,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM2=2048,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PSSM3=4096,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF_NO=8192,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF1=16384,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF2=32768,ParallelSplitShadowMap.SHADERDEFINE_SHADOW_PCF3=65536,ParallelSplitShadowMap.MAX_PSSM_COUNT=3,ParallelSplitShadowMap}(),Picker=(function(){function ChunkInfo(){this.alphaMap=null,this.detailID=null,this.normalMap=null}__class(ChunkInfo,"laya.d3.terrain.unit.ChunkInfo")}(),function(){function DetailTextureInfo(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}__class(DetailTextureInfo,"laya.d3.terrain.unit.DetailTextureInfo")}(),function(){function MaterialInfo(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}__class(MaterialInfo,"laya.d3.terrain.unit.MaterialInfo")}(),function(){function Picker(){}return __class(Picker,"laya.d3.utils.Picker"),Picker.calculateCursorRay=function(point,viewPort,projectionMatrix,viewMatrix,world,out){var x=point.elements[0],point=point.elements[1],nearSource=Picker._tempVector30,nerSourceE=nearSource.elements,nerSourceE=(nerSourceE[0]=x,nerSourceE[1]=point,nerSourceE[2]=viewPort.minDepth,Picker._tempVector31),farSourceE=nerSourceE.elements,x=(farSourceE[0]=x,farSourceE[1]=point,farSourceE[2]=viewPort.maxDepth,out.origin),point=Picker._tempVector32,farSourceE=(viewPort.unprojectFromWVP(nearSource,projectionMatrix,viewMatrix,world,x),viewPort.unprojectFromWVP(nerSourceE,projectionMatrix,viewMatrix,world,point),out.direction.elements);farSourceE[0]=point.x-x.x,farSourceE[1]=point.y-x.y,farSourceE[2]=point.z-x.z,Vector3.normalize(out.direction,out.direction)},Picker.rayIntersectsPositionsAndIndices=function(ray,vertexDatas,vertexDeclaration,indices,outHitInfo){for(var position0,closestVertex1PositionIndex,trianglePositions,position1,vertexStrideFloatCount=vertexDeclaration.vertexStride/4,positionVertexElementOffset=vertexDeclaration.getVertexElementByUsage(0).offset/4,closestIntersection=Number.MAX_VALUE,closestTriangleVertexIndex1=-1,closestTriangleVertexIndex2=-1,closestTriangleVertexIndex3=-1,j=0;j<indices.length;j+=3){var vertex1=Picker._tempVector35,vertex1E=vertex1.elements,vertex1Index=indices[j]*vertexStrideFloatCount,vertex1PositionIndex=vertex1Index+positionVertexElementOffset,vertex1E=(vertex1E[0]=vertexDatas[vertex1PositionIndex],vertex1E[1]=vertexDatas[1+vertex1PositionIndex],vertex1E[2]=vertexDatas[2+vertex1PositionIndex],Picker._tempVector36),vertex1PositionIndex=vertex1E.elements,vertex2Index=indices[j+1]*vertexStrideFloatCount,vertex2PositionIndex=vertex2Index+positionVertexElementOffset,vertex1PositionIndex=(vertex1PositionIndex[0]=vertexDatas[vertex2PositionIndex],vertex1PositionIndex[1]=vertexDatas[1+vertex2PositionIndex],vertex1PositionIndex[2]=vertexDatas[2+vertex2PositionIndex],Picker._tempVector37),vertex2PositionIndex=vertex1PositionIndex.elements,vertex3Index=indices[j+2]*vertexStrideFloatCount,vertex3PositionIndex=vertex3Index+positionVertexElementOffset,vertex2PositionIndex=(vertex2PositionIndex[0]=vertexDatas[vertex3PositionIndex],vertex2PositionIndex[1]=vertexDatas[1+vertex3PositionIndex],vertex2PositionIndex[2]=vertexDatas[2+vertex3PositionIndex],laya.d3.utils.Picker.rayIntersectsTriangle(ray,vertex1,vertex1E,vertex1PositionIndex));!isNaN(vertex2PositionIndex)&&vertex2PositionIndex<closestIntersection&&(closestIntersection=vertex2PositionIndex,closestTriangleVertexIndex1=vertex1Index,closestTriangleVertexIndex2=vertex2Index,closestTriangleVertexIndex3=vertex3Index)}return closestIntersection!==Number.MAX_VALUE?(outHitInfo.distance=closestIntersection,Vector3.scale(ray.direction,closestIntersection,outHitInfo.position),Vector3.add(ray.origin,outHitInfo.position,outHitInfo.position),position0=(trianglePositions=outHitInfo.trianglePositions)[0],position1=trianglePositions[1],trianglePositions=trianglePositions[2],position0=position0.elements,position1=position1.elements,trianglePositions=trianglePositions.elements,position0[0]=vertexDatas[closestVertex1PositionIndex=closestTriangleVertexIndex1+positionVertexElementOffset],position0[1]=vertexDatas[closestVertex1PositionIndex+1],position0[2]=vertexDatas[closestVertex1PositionIndex+2],position1[0]=vertexDatas[position0=closestTriangleVertexIndex2+positionVertexElementOffset],position1[1]=vertexDatas[position0+1],position1[2]=vertexDatas[position0+2],trianglePositions[0]=vertexDatas[closestVertex1PositionIndex=closestTriangleVertexIndex3+positionVertexElementOffset],trianglePositions[1]=vertexDatas[closestVertex1PositionIndex+1],trianglePositions[2]=vertexDatas[closestVertex1PositionIndex+2],(position1=vertexDeclaration.getVertexElementByUsage(3))&&(position0=position1.offset/4,closestVertex1PositionIndex=(trianglePositions=outHitInfo.triangleNormals)[0],vertexDeclaration=trianglePositions[1],position1=trianglePositions[2],trianglePositions=closestVertex1PositionIndex.elements,closestVertex1PositionIndex=vertexDeclaration.elements,vertexDeclaration=position1.elements,trianglePositions[0]=vertexDatas[position1=closestTriangleVertexIndex1+position0],trianglePositions[1]=vertexDatas[position1+1],trianglePositions[2]=vertexDatas[position1+2],closestVertex1PositionIndex[0]=vertexDatas[trianglePositions=closestTriangleVertexIndex2+position0],closestVertex1PositionIndex[1]=vertexDatas[trianglePositions+1],closestVertex1PositionIndex[2]=vertexDatas[trianglePositions+2],vertexDeclaration[0]=vertexDatas[position1=closestTriangleVertexIndex3+position0],vertexDeclaration[1]=vertexDatas[position1+1],vertexDeclaration[2]=vertexDatas[position1+2]),!0):(outHitInfo.position.toDefault(),outHitInfo.distance=Number.MAX_VALUE,outHitInfo.trianglePositions[0].toDefault(),outHitInfo.trianglePositions[1].toDefault(),outHitInfo.trianglePositions[2].toDefault(),outHitInfo.triangleNormals[0].toDefault(),outHitInfo.triangleNormals[1].toDefault(),outHitInfo.triangleNormals[2].toDefault(),!1)},Picker.rayIntersectsTriangle=function(ray,vertex1,vertex2,vertex3){var edge1=Picker._tempVector30,edge2=Picker._tempVector31,vertex2=(Vector3.subtract(vertex2,vertex1,edge1),Vector3.subtract(vertex3,vertex1,edge2),Picker._tempVector32);return Vector3.cross(ray.direction,edge2,vertex2),(vertex3=Vector3.dot(edge1,vertex2))>-Number.MIN_VALUE&&vertex3<Number.MIN_VALUE||(vertex3=1/vertex3,Vector3.subtract(ray.origin,vertex1,vertex1=Picker._tempVector33),vertex2=Vector3.dot(vertex1,vertex2),(vertex2*=vertex3)<0)||1<vertex2||(Vector3.cross(vertex1,edge1,vertex1=Picker._tempVector34),edge1=Vector3.dot(ray.direction,vertex1),(edge1*=vertex3)<0)||1<vertex2+edge1||(ray=Vector3.dot(edge2,vertex1),(ray*=vertex3)<0)?Number.NaN:ray},__static(Picker,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempVector32",function(){return this._tempVector32=new Vector3},"_tempVector33",function(){return this._tempVector33=new Vector3},"_tempVector34",function(){return this._tempVector34=new Vector3},"_tempVector35",function(){return this._tempVector35=new Vector3},"_tempVector36",function(){return this._tempVector36=new Vector3},"_tempVector37",function(){return this._tempVector37=new Vector3}]),Picker}()),Size=(function(){function RaycastHit(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new Vector3,new Vector3,new Vector3],this.trianglePositions.length=3,this.triangleNormals=[new Vector3,new Vector3,new Vector3],this.triangleNormals.length=3,this.position=new Vector3}__class(RaycastHit,"laya.d3.utils.RaycastHit"),RaycastHit.prototype.cloneTo=function(dec){dec.distance=this.distance,this.trianglePositions[0].cloneTo(dec.trianglePositions[0]),this.trianglePositions[1].cloneTo(dec.trianglePositions[1]),this.trianglePositions[2].cloneTo(dec.trianglePositions[2]),this.triangleNormals[0].cloneTo(dec.triangleNormals[0]),this.triangleNormals[1].cloneTo(dec.triangleNormals[1]),this.triangleNormals[2].cloneTo(dec.triangleNormals[2]),this.position.cloneTo(dec.position),dec.sprite3D=this.sprite3D}}(),function(){function Size(width,height){this._width=0,this._height=0,this._width=width,this._height=height}__class(Size,"laya.d3.utils.Size");var __proto=Size.prototype;return __getset(0,__proto,"width",function(){return-1===this._width?RenderState.clientWidth:this._width}),__getset(0,__proto,"height",function(){return-1===this._height?RenderState.clientHeight:this._height}),__getset(1,Size,"fullScreen",function(){return new Size(-1,-1)}),Size}()),Utils3D=function(){function Utils3D(){}return __class(Utils3D,"laya.d3.utils.Utils3D"),Utils3D._rotationTransformScaleSkinAnimation=function(tx,ty,tz,qx,qy,qz,qw,sx,sy,sz,outArray,outOffset){var i,ai0,ai1,ai2,ai3,re=Utils3D._tempArray16_0,se=Utils3D._tempArray16_1,tse=Utils3D._tempArray16_2,x2=qx+qx,y2=qy+qy,z2=qz+qz,qx=qx*x2,yx=qy*x2,qy=qy*y2,zx=qz*x2,zy=qz*y2,qz=qz*z2,x2=qw*x2,y2=qw*y2,qw=qw*z2;for(re[15]=1,re[0]=1-qy-qz,re[1]=yx+qw,re[2]=zx-y2,re[4]=yx-qw,re[5]=1-qx-qz,re[6]=zy+x2,re[8]=zx+y2,re[9]=zy-x2,re[10]=1-qx-qy,se[15]=1,se[0]=sx,se[5]=sy,se[10]=sz,i=0;i<4;i++)ai0=re[i],ai1=re[i+4],ai2=re[i+8],ai3=re[i+12],tse[i]=ai0,tse[i+4]=ai1,tse[i+8]=ai2,tse[i+12]=ai0*tx+ai1*ty+ai2*tz+ai3;for(i=0;i<4;i++)ai0=tse[i],ai1=tse[i+4],ai2=tse[i+8],ai3=tse[i+12],outArray[i+outOffset]=ai0*se[0]+ai1*se[1]+ai2*se[2]+ai3*se[3],outArray[i+outOffset+4]=ai0*se[4]+ai1*se[5]+ai2*se[6]+ai3*se[7],outArray[i+outOffset+8]=ai0*se[8]+ai1*se[9]+ai2*se[10]+ai3*se[11],outArray[i+outOffset+12]=ai0*se[12]+ai1*se[13]+ai2*se[14]+ai3*se[15]},Utils3D._createNodeByJson=function(rootNode,nodeData,node,innerResouMap){if(!node)switch(nodeData.type){case"Sprite3D":node=new Sprite3D;break;case"MeshSprite3D":node=new MeshSprite3D;break;case"SkinnedMeshSprite3D":node=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":node=new ShuriKenParticle3D;break;case"TrailSprite3D":node=new TrailSprite3D;break;case"Terrain":node=new Terrain;break;case"Camera":node=new Camera;break;case"DirectionLight":node=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var props=nodeData.props;if(props)for(var key in props)node[key]=props[key];var customProps=nodeData.customProps,childData=(customProps&&(node instanceof laya.d3.core.Sprite3D?(node._parseBaseCustomProps(customProps),node._parseCustomProps(rootNode,innerResouMap,customProps,nodeData),node._parseCustomComponent(rootNode,innerResouMap,nodeData.components)):node._parseCustomProps(rootNode,innerResouMap,customProps,nodeData)),nodeData.child);if(childData)for(var i=0,n=childData.length;i<n;i++){var child=Utils3D._createNodeByJson(rootNode,childData[i],null,innerResouMap);node.addChild(child)}return node},Utils3D._computeBoneAndAnimationDatasByBindPoseMatrxix=function(bones,curData,inverGlobalBindPose,outBonesDatas,outAnimationDatas,boneIndexToMesh){for(var parentOffset,offset=0,matOffset=0,boneLength=bones.length,i=0;i<boneLength;offset+=bones[i].keyframeWidth,matOffset+=16,i++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(curData[offset+0],curData[offset+1],curData[offset+2],curData[offset+3],curData[offset+4],curData[offset+5],curData[offset+6],curData[offset+7],curData[offset+8],curData[offset+9],outBonesDatas,matOffset),0!=i&&(parentOffset=16*bones[i].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(outBonesDatas,parentOffset,outBonesDatas,matOffset,outBonesDatas,matOffset));var n=inverGlobalBindPose.length;for(i=0;i<n;i++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(outBonesDatas,16*boneIndexToMesh[i],inverGlobalBindPose[i],outAnimationDatas,16*i)},Utils3D._computeAnimationDatasByArrayAndMatrixFast=function(inverGlobalBindPose,bonesDatas,outAnimationDatas,boneIndexToMesh){for(var i=0,n=inverGlobalBindPose.length;i<n;i++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(bonesDatas,16*boneIndexToMesh[i],inverGlobalBindPose[i],outAnimationDatas,16*i)},Utils3D._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(bones,curData,inverGlobalBindPose,outBonesDatas,outAnimationDatas){for(var parentOffset,offset=0,matOffset=0,boneLength=bones.length,i=0;i<boneLength;offset+=bones[i].keyframeWidth,matOffset+=16,i++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(curData[offset+7],curData[offset+8],curData[offset+9],curData[offset+3],curData[offset+4],curData[offset+5],curData[offset+6],curData[offset+0],curData[offset+1],curData[offset+2],outBonesDatas,matOffset),0!=i&&(parentOffset=16*bones[i].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(outBonesDatas,parentOffset,outBonesDatas,matOffset,outBonesDatas,matOffset));var n=inverGlobalBindPose.length;for(i=0;i<n;i++){var arrayOffset=16*i;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(outBonesDatas,arrayOffset,inverGlobalBindPose[i],outAnimationDatas,arrayOffset)}},Utils3D._computeAnimationDatasByArrayAndMatrixFastOld=function(inverGlobalBindPose,bonesDatas,outAnimationDatas){for(var n=inverGlobalBindPose.length,i=0;i<n;i++){var arrayOffset=16*i;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(bonesDatas,arrayOffset,inverGlobalBindPose[i],outAnimationDatas,arrayOffset)}},Utils3D._computeRootAnimationData=function(bones,curData,animationDatas){for(var i=0,offset=0,matOffset=0,boneLength=bones.length;i<boneLength;offset+=bones[i].keyframeWidth,matOffset+=16,i++)laya.d3.utils.Utils3D.createAffineTransformationArray(curData[offset+0],curData[offset+1],curData[offset+2],curData[offset+3],curData[offset+4],curData[offset+5],curData[offset+6],curData[offset+7],curData[offset+8],curData[offset+9],animationDatas,matOffset)},Utils3D.transformVector3ArrayByQuat=function(sourceArray,sourceOffset,rotation,outArray,outOffset){var rotation=rotation.elements,x=sourceArray[sourceOffset],y=sourceArray[sourceOffset+1],sourceArray=sourceArray[sourceOffset+2],sourceOffset=rotation[0],qy=rotation[1],qz=rotation[2],rotation=rotation[3],ix=rotation*x+qy*sourceArray-qz*y,iy=rotation*y+qz*x-sourceOffset*sourceArray,iz=rotation*sourceArray+sourceOffset*y-qy*x,x=-sourceOffset*x-qy*y-qz*sourceArray;outArray[outOffset]=ix*rotation+x*-sourceOffset+iy*-qz-iz*-qy,outArray[outOffset+1]=iy*rotation+x*-qy+iz*-sourceOffset-ix*-qz,outArray[outOffset+2]=iz*rotation+x*-qz+ix*-qy-iy*-sourceOffset},Utils3D.mulMatrixByArray=function(leftArray,leftOffset,rightArray,rightOffset,outArray,outOffset){var i,ai0,ai1,ai2,ai3;if(outArray===rightArray){for(rightArray=Utils3D._tempArray16_3,i=0;i<16;++i)rightArray[i]=outArray[outOffset+i];rightOffset=0}for(i=0;i<4;i++)ai0=leftArray[leftOffset+i],ai1=leftArray[leftOffset+i+4],ai2=leftArray[leftOffset+i+8],ai3=leftArray[leftOffset+i+12],outArray[outOffset+i]=ai0*rightArray[rightOffset+0]+ai1*rightArray[rightOffset+1]+ai2*rightArray[rightOffset+2]+ai3*rightArray[rightOffset+3],outArray[outOffset+i+4]=ai0*rightArray[rightOffset+4]+ai1*rightArray[rightOffset+5]+ai2*rightArray[rightOffset+6]+ai3*rightArray[rightOffset+7],outArray[outOffset+i+8]=ai0*rightArray[rightOffset+8]+ai1*rightArray[rightOffset+9]+ai2*rightArray[rightOffset+10]+ai3*rightArray[rightOffset+11],outArray[outOffset+i+12]=ai0*rightArray[rightOffset+12]+ai1*rightArray[rightOffset+13]+ai2*rightArray[rightOffset+14]+ai3*rightArray[rightOffset+15]},Utils3D.mulMatrixByArrayFast=function(leftArray,leftOffset,rightArray,rightOffset,outArray,outOffset){for(var ai0,ai1,ai2,ai3,i=0;i<4;i++)ai0=leftArray[leftOffset+i],ai1=leftArray[leftOffset+i+4],ai2=leftArray[leftOffset+i+8],ai3=leftArray[leftOffset+i+12],outArray[outOffset+i]=ai0*rightArray[rightOffset+0]+ai1*rightArray[rightOffset+1]+ai2*rightArray[rightOffset+2]+ai3*rightArray[rightOffset+3],outArray[outOffset+i+4]=ai0*rightArray[rightOffset+4]+ai1*rightArray[rightOffset+5]+ai2*rightArray[rightOffset+6]+ai3*rightArray[rightOffset+7],outArray[outOffset+i+8]=ai0*rightArray[rightOffset+8]+ai1*rightArray[rightOffset+9]+ai2*rightArray[rightOffset+10]+ai3*rightArray[rightOffset+11],outArray[outOffset+i+12]=ai0*rightArray[rightOffset+12]+ai1*rightArray[rightOffset+13]+ai2*rightArray[rightOffset+14]+ai3*rightArray[rightOffset+15]},Utils3D.mulMatrixByArrayAndMatrixFast=function(leftArray,leftOffset,rightMatrix,outArray,outOffset){for(var ai0,ai1,ai2,ai3,rightMatrix=rightMatrix.elements,m11=rightMatrix[0],m12=rightMatrix[1],m13=rightMatrix[2],m14=rightMatrix[3],m21=rightMatrix[4],m22=rightMatrix[5],m23=rightMatrix[6],m24=rightMatrix[7],m31=rightMatrix[8],m32=rightMatrix[9],m33=rightMatrix[10],m34=rightMatrix[11],m41=rightMatrix[12],m42=rightMatrix[13],m43=rightMatrix[14],m44=rightMatrix[15],ai0LeftOffset=leftOffset,ai1LeftOffset=leftOffset+4,ai2LeftOffset=leftOffset+8,ai3LeftOffset=leftOffset+12,ai0OutOffset=outOffset,ai1OutOffset=outOffset+4,ai2OutOffset=outOffset+8,ai3OutOffset=outOffset+12,i=0;i<4;i++)ai0=leftArray[ai0LeftOffset+i],ai1=leftArray[ai1LeftOffset+i],ai2=leftArray[ai2LeftOffset+i],ai3=leftArray[ai3LeftOffset+i],outArray[ai0OutOffset+i]=ai0*m11+ai1*m12+ai2*m13+ai3*m14,outArray[ai1OutOffset+i]=ai0*m21+ai1*m22+ai2*m23+ai3*m24,outArray[ai2OutOffset+i]=ai0*m31+ai1*m32+ai2*m33+ai3*m34,outArray[ai3OutOffset+i]=ai0*m41+ai1*m42+ai2*m43+ai3*m44},Utils3D.createAffineTransformationArray=function(tX,tY,tZ,rX,rY,rZ,rW,sX,sY,sZ,outArray,outOffset){var x2=rX+rX,y2=rY+rY,z2=rZ+rZ,xx=rX*x2,xy=rX*y2,rX=rX*z2,yy=rY*y2,rY=rY*z2,rZ=rZ*z2,x2=rW*x2,y2=rW*y2,rW=rW*z2;outArray[outOffset+0]=(1-(yy+rZ))*sX,outArray[outOffset+1]=(xy+rW)*sX,outArray[outOffset+2]=(rX-y2)*sX,outArray[outOffset+3]=0,outArray[outOffset+4]=(xy-rW)*sY,outArray[outOffset+5]=(1-(xx+rZ))*sY,outArray[outOffset+6]=(rY+x2)*sY,outArray[outOffset+7]=0,outArray[outOffset+8]=(rX+y2)*sZ,outArray[outOffset+9]=(rY-x2)*sZ,outArray[outOffset+10]=(1-(xx+yy))*sZ,outArray[outOffset+11]=0,outArray[outOffset+12]=tX,outArray[outOffset+13]=tY,outArray[outOffset+14]=tZ,outArray[outOffset+15]=1},Utils3D.transformVector3ArrayToVector3ArrayCoordinate=function(source,sourceOffset,transform,result,resultOffset){var vectorElem=Utils3D._tempArray4_0,coordinateX=source[sourceOffset+0],coordinateY=source[sourceOffset+1],source=source[sourceOffset+2],sourceOffset=transform.elements;vectorElem[0]=coordinateX*sourceOffset[0]+coordinateY*sourceOffset[4]+source*sourceOffset[8]+sourceOffset[12],vectorElem[1]=coordinateX*sourceOffset[1]+coordinateY*sourceOffset[5]+source*sourceOffset[9]+sourceOffset[13],vectorElem[2]=coordinateX*sourceOffset[2]+coordinateY*sourceOffset[6]+source*sourceOffset[10]+sourceOffset[14],vectorElem[3]=1/(coordinateX*sourceOffset[3]+coordinateY*sourceOffset[7]+source*sourceOffset[11]+sourceOffset[15]),result[resultOffset+0]=vectorElem[0]*vectorElem[3],result[resultOffset+1]=vectorElem[1]*vectorElem[3],result[resultOffset+2]=vectorElem[2]*vectorElem[3]},Utils3D.transformLightingMapTexcoordByUV0Array=function(source,sourceOffset,lightingMapScaleOffset,result,resultOffset){lightingMapScaleOffset=lightingMapScaleOffset.elements;result[resultOffset+0]=source[sourceOffset+0]*lightingMapScaleOffset[0]+lightingMapScaleOffset[2],result[resultOffset+1]=(source[sourceOffset+1]-1)*lightingMapScaleOffset[1]+lightingMapScaleOffset[3]},Utils3D.transformLightingMapTexcoordByUV1Array=function(source,sourceOffset,lightingMapScaleOffset,result,resultOffset){lightingMapScaleOffset=lightingMapScaleOffset.elements;result[resultOffset+0]=source[sourceOffset+0]*lightingMapScaleOffset[0]+lightingMapScaleOffset[2],result[resultOffset+1]=1+source[sourceOffset+1]*lightingMapScaleOffset[1]+lightingMapScaleOffset[3]},Utils3D.getURLVerion=function(url){var index=url.indexOf("?");return 0<=index?url.substr(index):null},Utils3D._quaternionCreateFromYawPitchRollArray=function(yaw,pitch,roll,out){var roll=.5*roll,pitch=.5*pitch,yaw=.5*yaw,sinRoll=Math.sin(roll),roll=Math.cos(roll),sinPitch=Math.sin(pitch),pitch=Math.cos(pitch),sinYaw=Math.sin(yaw),yaw=Math.cos(yaw);out[0]=yaw*sinPitch*roll+sinYaw*pitch*sinRoll,out[1]=sinYaw*pitch*roll-yaw*sinPitch*sinRoll,out[2]=yaw*pitch*sinRoll-sinYaw*sinPitch*roll,out[3]=yaw*pitch*roll+sinYaw*sinPitch*sinRoll},Utils3D._createAffineTransformationArray=function(trans,rot,scale,outE){var x=rot[0],y=rot[1],z=rot[2],rot=rot[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,x=x*z2,yy=y*y2,y=y*z2,z=z*z2,x2=rot*x2,y2=rot*y2,rot=rot*z2,z2=scale[0],sy=scale[1],scale=scale[2];outE[0]=(1-(yy+z))*z2,outE[1]=(xy+rot)*z2,outE[2]=(x-y2)*z2,outE[3]=0,outE[4]=(xy-rot)*sy,outE[5]=(1-(xx+z))*sy,outE[6]=(y+x2)*sy,outE[7]=0,outE[8]=(x+y2)*scale,outE[9]=(y-x2)*scale,outE[10]=(1-(xx+yy))*scale,outE[11]=0,outE[12]=trans[0],outE[13]=trans[1],outE[14]=trans[2],outE[15]=1},Utils3D._mulMatrixArray=function(leftMatrixE,rightMatrix,outArray,outOffset){for(var ai0,ai1,ai2,ai3,rightMatrix=rightMatrix.elements,m11=rightMatrix[0],m12=rightMatrix[1],m13=rightMatrix[2],m14=rightMatrix[3],m21=rightMatrix[4],m22=rightMatrix[5],m23=rightMatrix[6],m24=rightMatrix[7],m31=rightMatrix[8],m32=rightMatrix[9],m33=rightMatrix[10],m34=rightMatrix[11],m41=rightMatrix[12],m42=rightMatrix[13],m43=rightMatrix[14],m44=rightMatrix[15],ai0OutOffset=outOffset,ai1OutOffset=outOffset+4,ai2OutOffset=outOffset+8,ai3OutOffset=outOffset+12,i=0;i<4;i++)ai0=leftMatrixE[i],ai1=leftMatrixE[i+4],ai2=leftMatrixE[i+8],ai3=leftMatrixE[i+12],outArray[ai0OutOffset+i]=ai0*m11+ai1*m12+ai2*m13+ai3*m14,outArray[ai1OutOffset+i]=ai0*m21+ai1*m22+ai2*m23+ai3*m24,outArray[ai2OutOffset+i]=ai0*m31+ai1*m32+ai2*m33+ai3*m34,outArray[ai3OutOffset+i]=ai0*m41+ai1*m42+ai2*m43+ai3*m44},Utils3D.getYawPitchRoll=function(quaternion,out){Utils3D.transformQuat(Vector3.ForwardRH,quaternion,Quaternion.TEMPVector31),Utils3D.transformQuat(Vector3.Up,quaternion,Quaternion.TEMPVector32);var quaternion=Quaternion.TEMPVector32.elements,anglee=(Utils3D.angleTo(Vector3.ZERO,Quaternion.TEMPVector31,Quaternion.TEMPVector33),Quaternion.TEMPVector33.elements);anglee[0]==Math.PI/2?(anglee[1]=Utils3D.arcTanAngle(quaternion[2],quaternion[0]),anglee[2]=0):anglee[0]==-Math.PI/2?(anglee[1]=Utils3D.arcTanAngle(-quaternion[2],-quaternion[0]),anglee[2]=0):(Matrix4x4.createRotationY(-anglee[1],Quaternion.TEMPMatrix0),Matrix4x4.createRotationX(-anglee[0],Quaternion.TEMPMatrix1),Vector3.transformCoordinate(Quaternion.TEMPVector32,Quaternion.TEMPMatrix0,Quaternion.TEMPVector32),Vector3.transformCoordinate(Quaternion.TEMPVector32,Quaternion.TEMPMatrix1,Quaternion.TEMPVector32),anglee[2]=Utils3D.arcTanAngle(quaternion[1],-quaternion[0])),anglee[1]<=-Math.PI&&(anglee[1]=Math.PI),anglee[2]<=-Math.PI&&(anglee[2]=Math.PI),anglee[1]>=Math.PI&&anglee[2]>=Math.PI&&(anglee[1]=0,anglee[2]=0,anglee[0]=Math.PI-anglee[0]),out[0]=anglee[1],out[1]=anglee[0],out[2]=anglee[2]},Utils3D.arcTanAngle=function(x,y){return 0==x?1==y?Math.PI/2:-Math.PI/2:0<x?Math.atan(y/x):x<0?0<y?Math.atan(y/x)+Math.PI:Math.atan(y/x)-Math.PI:0},Utils3D.angleTo=function(from,location,angle){Vector3.subtract(location,from,Quaternion.TEMPVector30),Vector3.normalize(Quaternion.TEMPVector30,Quaternion.TEMPVector30),angle.elements[0]=Math.asin(Quaternion.TEMPVector30.y),angle.elements[1]=Utils3D.arcTanAngle(-Quaternion.TEMPVector30.z,-Quaternion.TEMPVector30.x)},Utils3D.transformQuat=function(source,rotation,out){var out=out.elements,source=source.elements,x=source[0],y=source[1],source=source[2],qx=rotation[0],qy=rotation[1],qz=rotation[2],rotation=rotation[3],ix=rotation*x+qy*source-qz*y,iy=rotation*y+qz*x-qx*source,iz=rotation*source+qx*y-qy*x,x=-qx*x-qy*y-qz*source;out[0]=ix*rotation+x*-qx+iy*-qz-iz*-qy,out[1]=iy*rotation+x*-qy+iz*-qx-ix*-qz,out[2]=iz*rotation+x*-qz+ix*-qy-iy*-qx},Utils3D.quaterionNormalize=function(f,e){var x=f[0],y=f[1],z=f[2],f=f[3],len=x*x+y*y+z*z+f*f;0<len&&(len=1/Math.sqrt(len),e[0]=x*len,e[1]=y*len,e[2]=z*len,e[3]=f*len)},Utils3D.matrix4x4MultiplyFFF=function(a,b,e){var i,ai0,ai1,ai2,ai3;if(e===b)for(b=new Float32Array(16),i=0;i<16;++i)b[i]=e[i];for(i=0;i<4;i++)ai0=a[i],ai1=a[i+4],ai2=a[i+8],ai3=a[i+12],e[i]=ai0*b[0]+ai1*b[1]+ai2*b[2]+ai3*b[3],e[i+4]=ai0*b[4]+ai1*b[5]+ai2*b[6]+ai3*b[7],e[i+8]=ai0*b[8]+ai1*b[9]+ai2*b[10]+ai3*b[11],e[i+12]=ai0*b[12]+ai1*b[13]+ai2*b[14]+ai3*b[15]},Utils3D.matrix4x4MultiplyMFM=function(left,right,out){Utils3D.matrix4x4MultiplyFFF(left.elements,right,out.elements)},__static(Utils3D,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new Vector3},"_tempVector3_1",function(){return this._tempVector3_1=new Vector3},"_tempVector3_2",function(){return this._tempVector3_2=new Vector3},"_tempVector3_3",function(){return this._tempVector3_3=new Vector3},"_tempVector3_4",function(){return this._tempVector3_4=new Vector3},"_tempVector3_5",function(){return this._tempVector3_5=new Vector3},"_tempVector3_6",function(){return this._tempVector3_6=new Vector3},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),Utils3D}(),Laya3D=function(){function Laya3D(){}return __class(Laya3D,"Laya3D"),Laya3D._cancelLoadByUrl=function(url){Laya.loader.cancelLoadByUrl(url),Laya3D._innerFirstLevelLoaderManager.cancelLoadByUrl(url),Laya3D._innerSecondLevelLoaderManager.cancelLoadByUrl(url),Laya3D._innerThirdLevelLoaderManager.cancelLoadByUrl(url),Laya3D._innerFourthLevelLoaderManager.cancelLoadByUrl(url)},Laya3D._changeWebGLSize=function(width,height){WebGL.onStageResize(width,height),RenderState.clientWidth=width,RenderState.clientHeight=height},Laya3D.__init__=function(){var createMap=LoaderManager.createMap;createMap.lh=[Sprite3D,"SPRITE3DHIERARCHY"],createMap.ls=[Scene,"SPRITE3DHIERARCHY"],createMap.lm=[Mesh,"MESH"],createMap.lmat=[StandardMaterial,"MATERIAL"],createMap.jpg=[Texture2D,"nativeimage"],createMap.jpeg=[Texture2D,"nativeimage"],createMap.png=[Texture2D,"nativeimage"],createMap.pkm=[Texture2D,"arraybuffer"],createMap.raw=[DataTexture2D,"arraybuffer"],createMap.mipmaps=[DataTexture2D,"arraybuffer"],Loader.parserMap.SPRITE3DHIERARCHY=Laya3D._loadHierarchy,Loader.parserMap.MESH=Laya3D._loadMesh,Loader.parserMap.MATERIAL=Laya3D._loadMaterial,Loader.parserMap.TEXTURECUBE=Laya3D._loadTextureCube,Loader.parserMap.TERRAIN=Laya3D._loadTerrain,Laya3D._innerFirstLevelLoaderManager.on("error",null,Laya3D._eventLoadManagerError),Laya3D._innerSecondLevelLoaderManager.on("error",null,Laya3D._eventLoadManagerError),Laya3D._innerThirdLevelLoaderManager.on("error",null,Laya3D._eventLoadManagerError),Laya3D._innerFourthLevelLoaderManager.on("error",null,Laya3D._eventLoadManagerError)},Laya3D.READ_BLOCK=function(){return Laya3D._readData.pos+=4,!0},Laya3D.READ_DATA=function(){return Laya3D._DATA.offset=Laya3D._readData.getUint32(),Laya3D._DATA.size=Laya3D._readData.getUint32(),!0},Laya3D.READ_STRINGS=function(){var materialUrls=[],_STRINGS={offset:0,size:0};_STRINGS.offset=Laya3D._readData.getUint16(),_STRINGS.size=Laya3D._readData.getUint16(),Laya3D._readData.pos;Laya3D._readData.pos=_STRINGS.offset+Laya3D._DATA.offset;for(var i=0;i<_STRINGS.size;i++){var string=Laya3D._readData.readUTFString();-1===string.lastIndexOf(".lmat")&&-1===string.lastIndexOf(".lpbr")||materialUrls.push(string)}return materialUrls},Laya3D.formatRelativePath=function(base,value){var path;if("."===value.charAt(0)){for(var index,parts=(base+value).split("/"),i=0,len=parts.length;i<len;i++)".."==parts[i]&&0<(index=i-1)&&".."!==parts[index]&&(parts.splice(index,2),i-=2);path=parts.join("/")}else path=base+value;return path=null!=URL.customFormat?URL.customFormat(path,null):path},Laya3D._eventLoadManagerError=function(msg){Laya.loader.event("error",msg)},Laya3D._addHierarchyInnerUrls=function(urls,urlMap,urlVersion,hierarchyBasePath,path,clas){hierarchyBasePath=Laya3D.formatRelativePath(hierarchyBasePath,path);urlVersion&&(hierarchyBasePath+=urlVersion),urls.push({url:hierarchyBasePath,clas:clas}),urlMap[path]=hierarchyBasePath},Laya3D._getSprite3DHierarchyInnerUrls=function(node,firstLevelUrls,secondLevelUrls,fourthLelUrls,urlMap,urlVersion,hierarchyBasePath){var i=0,n=0;switch(node.type){case"Scene":for(var lightmaps=node.customProps.lightmaps,i=0,n=lightmaps.length;i<n;i++){var lightMap=lightmaps[i].replace(".exr",".png");Laya3D._addHierarchyInnerUrls(fourthLelUrls,urlMap,urlVersion,hierarchyBasePath,lightMap,Texture2D)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":if(node.instanceParams)(meshPath=node.instanceParams.loadPath)&&Laya3D._addHierarchyInnerUrls(firstLevelUrls,urlMap,urlVersion,hierarchyBasePath,meshPath,Mesh);else{(meshPath=(customProps=node.customProps).meshPath)&&Laya3D._addHierarchyInnerUrls(firstLevelUrls,urlMap,urlVersion,hierarchyBasePath,meshPath,Mesh);var materials=customProps.materials;if(materials)for(i=0,n=materials.length;i<n;i++){for(var mat=materials[i],clasPaths=mat.type.split("."),clas=Browser.window,j=0,length=clasPaths.length;j<length;++j)clas=clas[this.clasPaths[j]];if("function"!=typeof clas)throw"_getSprite3DHierarchyInnerUrls 错误: "+mat.type+" 不是类";Laya3D._addHierarchyInnerUrls(secondLevelUrls,urlMap,urlVersion,hierarchyBasePath,mat.path,clas)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var customProps,meshPath=(customProps=node.customProps).meshPath,meshPath=(meshPath&&Laya3D._addHierarchyInnerUrls(firstLevelUrls,urlMap,urlVersion,hierarchyBasePath,meshPath,Mesh),customProps.material);if(meshPath){clasPaths=meshPath.type.split("."),clas=Browser.window;for(j=0,length=clasPaths.length;j<length;++j)clas=clas[this.clasPaths[j]];Laya3D._addHierarchyInnerUrls(secondLevelUrls,urlMap,urlVersion,hierarchyBasePath,meshPath.path,clas)}else{meshPath=customProps.materialPath;meshPath?Laya3D._addHierarchyInnerUrls(secondLevelUrls,urlMap,urlVersion,hierarchyBasePath,meshPath,ShurikenParticleMaterial):(meshPath=customProps.texturePath)&&Laya3D._addHierarchyInnerUrls(fourthLelUrls,urlMap,urlVersion,hierarchyBasePath,meshPath,Texture2D)}break;case"Terrain":Laya3D._addHierarchyInnerUrls(fourthLelUrls,urlMap,urlVersion,hierarchyBasePath,node.customProps.dataPath,TerrainRes)}var k,components=node.components;for(k in components){var component=components[k];if("Animator"===k){var avatarPath=component.avatarPath,clipPaths=(avatarPath?Laya3D._addHierarchyInnerUrls(fourthLelUrls,urlMap,urlVersion,hierarchyBasePath,avatarPath,Avatar):(avatarPath=component.avatar)&&Laya3D._addHierarchyInnerUrls(fourthLelUrls,urlMap,urlVersion,hierarchyBasePath,avatarPath.path,Avatar),component.clipPaths);for(i=0,n=clipPaths.length;i<n;i++)Laya3D._addHierarchyInnerUrls(fourthLelUrls,urlMap,urlVersion,hierarchyBasePath,clipPaths[i],AnimationClip)}}var children=node.child;for(i=0,n=children.length;i<n;i++)Laya3D._getSprite3DHierarchyInnerUrls(children[i],firstLevelUrls,secondLevelUrls,fourthLelUrls,urlMap,urlVersion,hierarchyBasePath)},Laya3D._loadHierarchy=function(loader){loader.on("loaded",null,Laya3D._onHierarchylhLoaded,[loader,loader._class._getGroup()]),loader.load(loader.url,"json",!1,null,!0)},Laya3D._onHierarchylhLoaded=function(loader,group,lhData){var firstLevUrls,secondLevUrls,forthLevUrls,urlMap,url,weight,processCeil,urlVersion;loader._class.destroyed?loader.endLoad():(url=loader.url,urlVersion=Utils3D.getURLVerion(url),url=URL.getPath(url),Laya3D._getSprite3DHierarchyInnerUrls(lhData,firstLevUrls=[],secondLevUrls=[],forthLevUrls=[],urlMap={},urlVersion,url),Laya3D._onProcessChange(loader,0,weight=1/(url=(urlVersion=firstLevUrls.length+secondLevUrls.length+forthLevUrls.length)+1),1),0<forthLevUrls.length?(urlVersion=Handler.create(null,Laya3D._onProcessChange,[loader,weight,processCeil=urlVersion/url],!1),Laya3D._innerFourthLevelLoaderManager.create(forthLevUrls,Handler.create(null,Laya3D._onHierarchyInnerForthLevResouLoaded,[loader,group,urlVersion,lhData,urlMap,firstLevUrls,secondLevUrls,weight+processCeil*forthLevUrls.length,processCeil]),urlVersion,null,null,1,!0,group)):Laya3D._onHierarchyInnerForthLevResouLoaded(loader,group,null,lhData,urlMap,firstLevUrls,secondLevUrls,weight,processCeil))},Laya3D._onHierarchyInnerForthLevResouLoaded=function(loader,group,processHandler,lhData,urlMap,firstLevUrls,secondLevUrls,processOffset,processCeil){var process;loader._class.destroyed?loader.endLoad():(processHandler&&processHandler.recover(),0<secondLevUrls.length?(process=Handler.create(null,Laya3D._onProcessChange,[loader,processOffset,processCeil],!1),Laya3D._innerSecondLevelLoaderManager.create(secondLevUrls,Handler.create(null,Laya3D._onHierarchyInnerSecondLevResouLoaded,[loader,group,process,lhData,urlMap,firstLevUrls,processOffset+processCeil*secondLevUrls.length,processCeil]),processHandler,null,null,1,!0,group)):Laya3D._onHierarchyInnerSecondLevResouLoaded(loader,group,null,lhData,urlMap,firstLevUrls,processOffset,processCeil))},Laya3D._onHierarchyInnerSecondLevResouLoaded=function(loader,group,processHandler,lhData,urlMap,firstLevUrls,processOffset,processCeil){loader._class.destroyed?loader.endLoad():(processHandler&&processHandler.recover(),0<firstLevUrls.length?(processOffset=Handler.create(null,Laya3D._onProcessChange,[loader,processOffset,processCeil],!1),Laya3D._innerFirstLevelLoaderManager.create(firstLevUrls,Handler.create(null,Laya3D._onHierarchyInnerFirstLevResouLoaded,[loader,processOffset,lhData,urlMap]),processHandler,null,null,1,!0,group)):Laya3D._onHierarchyInnerFirstLevResouLoaded(loader,null,lhData,urlMap))},Laya3D._onHierarchyInnerFirstLevResouLoaded=function(loader,processHandler,lhData,urlMap){processHandler&&processHandler.recover(),loader.endLoad([lhData,urlMap])},Laya3D._loadTerrain=function(loader){loader.on("loaded",null,Laya3D._onTerrainLtLoaded,[loader,loader._class._getGroup()]),loader.load(loader.url,"json",!1,null,!0)},Laya3D._onTerrainLtLoaded=function(loader,group,ltData){if(loader._class.destroyed)loader.endLoad();else{for(var url=loader.url,urlVersion=Utils3D.getURLVerion(url),terrainBasePath=URL.getPath(url),textureURLs=[],urlMap={},i=0,n=0,url=ltData.heightData,heightMapURL=url.url,detailTextures=(formatUrl=Laya3D.formatRelativePath(terrainBasePath,heightMapURL),urlVersion&&(formatUrl+=urlVersion),heightMapURL=urlMap[heightMapURL]=formatUrl,ltData.detailTexture),i=0,n=detailTextures.length;i<n;i++)textureURLs.push({url:detailTextures[i].diffuse});var normalMaps=ltData.normalMap;for(i=0,n=normalMaps.length;i<n;i++)textureURLs.push({url:normalMaps[i]});var alphaMaps=ltData.alphaMap;for(i=0,n=alphaMaps.length;i<n;i++)textureURLs.push({url:alphaMaps[i],params:[!1,!1,6408,!0]});for(i=0,n=textureURLs.length;i<n;i++){var subUrl=textureURLs[i].url,formatUrl=Laya3D.formatRelativePath(terrainBasePath,subUrl);urlVersion&&(formatUrl+=urlVersion),textureURLs[i].url=formatUrl,urlMap[subUrl]=formatUrl}var texsUrlCount=textureURLs.length,totalProcessCount=texsUrlCount+2,weight=1/totalProcessCount,loadInfo=(Laya3D._onProcessChange(loader,0,weight,1),{heightMapLoaded:!1,texturesLoaded:!1}),hmProcessHandler=Handler.create(null,Laya3D._onProcessChange,[loader,weight,weight],!1),heightMapURL=(Laya3D._innerFourthLevelLoaderManager.create(heightMapURL,Handler.create(null,Laya3D._onTerrainHeightMapLoaded,[loader,hmProcessHandler,ltData,urlMap,loadInfo]),hmProcessHandler,null,[url.numX,url.numZ,url.bitType,url.value],1,!0,group),Handler.create(null,Laya3D._onProcessChange,[loader,2*weight,texsUrlCount/totalProcessCount],!1));Laya3D._innerFourthLevelLoaderManager.create(textureURLs,Handler.create(null,Laya3D._onTerrainTexturesLoaded,[loader,heightMapURL,ltData,urlMap,loadInfo]),heightMapURL,null,null,1,!0,group)}},Laya3D._onTerrainHeightMapLoaded=function(loader,processHandler,ltData,urlMap,loadInfo){loadInfo.heightMapLoaded=!0,loadInfo.texturesLoaded&&(loader.endLoad([ltData,urlMap]),processHandler.recover())},Laya3D._onTerrainTexturesLoaded=function(loader,processHandler,ltData,urlMap,loadInfo){loadInfo.texturesLoaded=!0,loadInfo.heightMapLoaded&&(loader.endLoad([ltData,urlMap]),processHandler.recover())},Laya3D._loadMesh=function(loader){loader.on("loaded",null,Laya3D._onMeshLmLoaded,[loader,loader._class._getGroup()]),loader.load(loader.url,"arraybuffer",!1,null,!0)},Laya3D._onMeshLmLoaded=function(loader,group,lmData){if(loader._class.destroyed)loader.endLoad();else{var urls,n,url=loader.url,urlVersion=Utils3D.getURLVerion(url),meshBasePath=URL.getPath(url),urlMap={},i=0;switch((Laya3D._readData=new Byte(lmData)).pos=0,Laya3D._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var dataOffset=Laya3D._readData.getUint32(),offset=(Laya3D._readData.pos=Laya3D._readData.pos+4,count=Laya3D._readData.getUint16(),Laya3D._readData.pos=Laya3D._readData.pos+8*count,Laya3D._readData.getUint32()),count=Laya3D._readData.getUint16();for(Laya3D._readData.pos=dataOffset+offset,urls=[],i=0;i<count;i++){var string=Laya3D._readData.readUTFString();-1!==string.lastIndexOf(".lmat")&&urls.push(string)}break;default:for(Laya3D.READ_BLOCK(),i=0;i<2;i++){var index=Laya3D._readData.getUint16(),blockName=Laya3D._strings[index],fn=Laya3D["READ_"+blockName];if(null==fn)throw new Error("model file err,no this function:"+index+" "+blockName);1===i?urls=fn.call():fn.call()}}for(i=0,n=urls.length;i<n;i++){var subUrl=urls[i],formatSubUrl=Laya3D.formatRelativePath(meshBasePath,subUrl);urlVersion&&(formatSubUrl+=urlVersion),urls[i]=formatSubUrl,urlMap[subUrl]=formatSubUrl}0<urls.length?(Laya3D._onProcessChange(loader,0,.5,1),url=Handler.create(null,Laya3D._onProcessChange,[loader,.5,.5],!1),Laya3D._innerSecondLevelLoaderManager.create(urls,Handler.create(null,Laya3D._onMeshMateialLoaded,[loader,url,lmData,urlMap]),url,null,null,1,!0,group)):loader.endLoad([lmData,urlMap])}},Laya3D._onMeshMateialLoaded=function(loader,processHandler,lmData,urlMap){loader.endLoad([lmData,urlMap]),processHandler.recover()},Laya3D._getMaterialTexturePath=function(path,urlVersion,materialBath){var extenIndex=path.length-4;return path.indexOf(".dds")!=extenIndex&&path.indexOf(".tga")!=extenIndex&&path.indexOf(".exr")!=extenIndex&&path.indexOf(".DDS")!=extenIndex&&path.indexOf(".TGA")!=extenIndex&&path.indexOf(".EXR")!=extenIndex||(path=path.substr(0,extenIndex)+".png"),path=Laya3D.formatRelativePath(materialBath,path),urlVersion&&(path+=urlVersion),path},Laya3D._loadMaterial=function(loader){loader.on("loaded",null,Laya3D._onMaterilLmatLoaded,[loader,loader._class._getGroup()]),loader.load(loader.url,"json",!1,null,!0)},Laya3D._onMaterilLmatLoaded=function(loader,group,lmatData){if(loader._class.destroyed)loader.endLoad();else{var formatSubUrl,url=loader.url,urlVersion=Utils3D.getURLVerion(url),materialBasePath=URL.getPath(url),urls=[],urlMap={},url=lmatData.customProps,version=lmatData.version;if(version)switch(version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var textures=lmatData.props.textures,i=0,n=textures.length;i<n;i++){var extenIndex,tex=textures[i],path=tex.path;path&&(extenIndex=path.length-4,path.indexOf(".exr")!=extenIndex&&path.indexOf(".EXR")!=extenIndex||(path=path.substr(0,extenIndex)+".png"),formatSubUrl=Laya3D.formatRelativePath(materialBasePath,path),urlVersion&&(formatSubUrl+=urlVersion),urls.push({url:formatSubUrl,params:tex.params}),urlMap[path]=formatSubUrl)}break;default:throw new Error("Laya3D:unkonwn version.")}else{var version=url.diffuseTexture.texture2D;version&&(formatSubUrl=Laya3D._getMaterialTexturePath(version,urlVersion,materialBasePath),urls.push(formatSubUrl),urlMap[version]=formatSubUrl),url.normalTexture&&(version=url.normalTexture.texture2D)&&(formatSubUrl=Laya3D._getMaterialTexturePath(version,urlVersion,materialBasePath),urls.push(formatSubUrl),urlMap[version]=formatSubUrl),url.specularTexture&&(version=url.specularTexture.texture2D)&&(formatSubUrl=Laya3D._getMaterialTexturePath(version,urlVersion,materialBasePath),urls.push(formatSubUrl),urlMap[version]=formatSubUrl),url.emissiveTexture&&(version=url.emissiveTexture.texture2D)&&(formatSubUrl=Laya3D._getMaterialTexturePath(version,urlVersion,materialBasePath),urls.push(formatSubUrl),urlMap[version]=formatSubUrl),url.ambientTexture&&(version=url.ambientTexture.texture2D)&&(formatSubUrl=Laya3D._getMaterialTexturePath(version,urlVersion,materialBasePath),urls.push(formatSubUrl),urlMap[version]=formatSubUrl),url.reflectTexture&&(version=url.reflectTexture.texture2D)&&(formatSubUrl=Laya3D._getMaterialTexturePath(version,urlVersion,materialBasePath),urls.push(formatSubUrl),urlMap[version]=formatSubUrl)}var url=urls.length,version=url+1,lmatWeight=1/version;Laya3D._onProcessChange(loader,0,lmatWeight,1),0<url?(lmatWeight=Handler.create(null,Laya3D._onProcessChange,[loader,lmatWeight,url/version],!1),Laya3D._innerFourthLevelLoaderManager.create(urls,Handler.create(null,Laya3D._onMateialTexturesLoaded,[loader,lmatWeight,lmatData,urlMap]),lmatWeight,Texture2D,null,1,!0,group)):Laya3D._onMateialTexturesLoaded(loader,null,lmatData,null)}},Laya3D._onMateialTexturesLoaded=function(loader,processHandler,lmatData,urlMap){loader.endLoad([lmatData,urlMap]),processHandler&&processHandler.recover()},Laya3D._loadTextureCube=function(loader){loader.on("loaded",null,Laya3D._onTextureCubeLtcLoaded,[loader]),loader.load(loader.url,"json",!1,null,!0)},Laya3D._onTextureCubeLtcLoaded=function(loader,ltcData){var ltcBasePath;loader._class.destroyed?loader.endLoad():(ltcBasePath=URL.getPath(loader.url),ltcBasePath=[Laya3D.formatRelativePath(ltcBasePath,ltcData.px),Laya3D.formatRelativePath(ltcBasePath,ltcData.nx),Laya3D.formatRelativePath(ltcBasePath,ltcData.py),Laya3D.formatRelativePath(ltcBasePath,ltcData.ny),Laya3D.formatRelativePath(ltcBasePath,ltcData.pz),Laya3D.formatRelativePath(ltcBasePath,ltcData.nz)],Laya3D._onProcessChange(loader,0,1/7,1),ltcData=Handler.create(null,Laya3D._onProcessChange,[loader,1/7,6/7],!1),Laya3D._innerFourthLevelLoaderManager.load(ltcBasePath,Handler.create(null,Laya3D._onTextureCubeImagesLoaded,[loader,ltcBasePath,ltcData]),ltcData,"nativeimage"))},Laya3D._onTextureCubeImagesLoaded=function(loader,urls,processHandler){var images=[];images.length=6;for(var i=0;i<6;i++){var url=urls[i];images[i]=Loader.getRes(url),Loader.clearRes(url)}loader.endLoad(images),processHandler.recover()},Laya3D._onProcessChange=function(loader,offset,weight,process){(process=offset+process*weight)<1&&loader.event("progress",process)},Laya3D.init=function(width,height,antialias,alpha,premultipliedAlpha,stencil){void 0===antialias&&(antialias=!1),void 0===alpha&&(alpha=!1),void 0===premultipliedAlpha&&(premultipliedAlpha=!0),void 0===stencil&&(stencil=!0),RunDriver.update3DLoop=function(){},RunDriver.cancelLoadByUrl=function(url){Laya3D._cancelLoadByUrl(url)},Config.isAntialias=antialias,Config.isAlpha=alpha,Config.premultipliedAlpha=premultipliedAlpha,Config.isStencil=stencil,WebGL.enable()?(RunDriver.changeWebGLSize=Laya3D._changeWebGLSize,Render.is3DMode=!0,Laya.init(width,height),Layer.__init__(),ShaderInit3D.__init__(),MeshSprite3D.__init__(),AnimationNode.__init__(),Laya3D.__init__(),AtlasResourceManager.maxTextureCount=2,(Laya3D.debugMode||OctreeNode.debugMode)&&(Laya3D._debugPhasorSprite=new PhasorSpriter3D)):alert("3D环境初始化失败，请重启后再打开游戏！")},Laya3D.HIERARCHY="SPRITE3DHIERARCHY",Laya3D.MESH="MESH",Laya3D.MATERIAL="MATERIAL",Laya3D.PBRMATERIAL="PBRMTL",Laya3D.TEXTURECUBE="TEXTURECUBE",Laya3D.TERRAIN="TERRAIN",Laya3D._readData=null,Laya3D._debugPhasorSprite=null,Laya3D.debugMode=!1,__static(Laya3D,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new LoaderManager},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new LoaderManager},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new LoaderManager},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new LoaderManager}]),Laya3D}(),AnimationTransform3D=function(){function AnimationTransform3D(owner){AnimationTransform3D.__super.call(this),this._owner=owner,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}__class(AnimationTransform3D,"laya.d3.animation.AnimationTransform3D",EventDispatcher);var __proto=AnimationTransform3D.prototype;return __proto._getlocalMatrix=function(){return this._localUpdate&&(Utils3D._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},__proto._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldTransform()}},__proto._setWorldMatrixAndUpdate=function(matrix){if(this._worldMatrix=matrix,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var locMat=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=locMat[i];else Utils3D.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},__proto._setWorldMatrixNoUpdate=function(matrix){this._worldMatrix=matrix},__proto._setWorldMatrixIgnoreUpdate=function(matrix){this._worldMatrix=matrix,this._worldUpdate=!1},__proto.getLocalPosition=function(){return this._localPosition},__proto.setLocalPosition=function(value){var entityTransform,entityPosition,entityPositionE;this._parent?(this._localPosition=value,this._localUpdate=!0,this._onWorldTransform()):(entityTransform=this._entity.owner._transform,(entityPositionE=(entityPosition=this._entity.localPosition).elements)[0]=value[0],entityPositionE[1]=value[1],entityPositionE[2]=value[2],entityTransform.localPosition=entityPosition)},__proto.getLocalRotation=function(){var eulerE;return this._localQuaternionUpdate&&(eulerE=this._localRotationEuler,Utils3D._quaternionCreateFromYawPitchRollArray(eulerE[1]/AnimationTransform3D._angleToRandin,eulerE[0]/AnimationTransform3D._angleToRandin,eulerE[2]/AnimationTransform3D._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1),this._localRotation},__proto.setLocalRotation=function(value){var entityTransform,entityRotation,entityRotationE;this._parent?(this._localRotation=value,Utils3D.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()):(entityTransform=this._entity.owner._transform,(entityRotationE=(entityRotation=this._entity.localRotation).elements)[0]=value[0],entityRotationE[1]=value[1],entityRotationE[2]=value[2],entityRotationE[3]=value[3],entityTransform.localRotation=entityRotation)},__proto.getLocalScale=function(){return this._localScale},__proto.setLocalScale=function(value){var entityTransform,entityScale,entityScaleE;this._parent?(this._localScale=value,this._localUpdate=!0,this._onWorldTransform()):(entityTransform=this._entity.owner._transform,(entityScaleE=(entityScale=this._entity.localScale).elements)[0]=value[0],entityScaleE[1]=value[1],entityScaleE[2]=value[2],entityTransform.localScale=entityScale)},__proto.getLocalRotationEuler=function(){var eulerE,localRotationEulerE;return this._locaEulerlUpdate&&(Utils3D.getYawPitchRoll(this._localRotation,AnimationTransform3D._tempVector3),(localRotationEulerE=this._localRotationEuler)[0]=(eulerE=AnimationTransform3D._tempVector3)[1]*AnimationTransform3D._angleToRandin,localRotationEulerE[1]=eulerE[0]*AnimationTransform3D._angleToRandin,localRotationEulerE[2]=eulerE[2]*AnimationTransform3D._angleToRandin,this._locaEulerlUpdate=!1),this._localRotationEuler},__proto.setLocalRotationEuler=function(value){var entityTransform,entityLocalRotationEuler,elements;this._parent?(Utils3D._quaternionCreateFromYawPitchRollArray(value[1]/AnimationTransform3D._angleToRandin,value[0]/AnimationTransform3D._angleToRandin,value[2]/AnimationTransform3D._angleToRandin,this._localRotation),this._localRotationEuler=value,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()):(entityTransform=this._entity.owner._transform,(elements=(entityLocalRotationEuler=this._entity.localRotationEuler).elements)[0]=value[0],elements[1]=value[1],elements[2]=value[2],entityTransform.localRotationEuler=entityLocalRotationEuler)},__proto.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)Utils3D.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var locMat=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=locMat[i];this._worldUpdate=!1}return this._worldMatrix},__proto.setParent=function(value){var parentChilds,index;this._parent!==value&&(this._parent&&(index=(parentChilds=this._parent._childs).indexOf(this),parentChilds.splice(index,1)),value&&(value._childs.push(this),value)&&this._onWorldTransform(),this._parent=value)},__static(AnimationTransform3D,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),AnimationTransform3D}(),Component3D=function(){function Component3D(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,Component3D.__super.call(this),this._destroyed=!1,this._id=Component3D._uniqueIDCounter,Component3D._uniqueIDCounter++}__class(Component3D,"laya.d3.component.Component3D",EventDispatcher);var __proto=Component3D.prototype;return Laya.imps(__proto,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),__proto._initialize=function(owner){this._owner=owner,this._enable=!0,this.started=!1,this._load(owner)},__proto._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},__proto._load=function(owner){},__proto._start=function(state){},__proto._update=function(state){},__proto._lateUpdate=function(state){},__proto._preRenderUpdate=function(state){},__proto._postRenderUpdate=function(state){},__proto._unload=function(owner){this.offAll()},__proto._cloneTo=function(dest){},__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),__getset(0,__proto,"owner",function(){return this._owner}),__getset(0,__proto,"enable",function(){return this._enable},function(value){this._enable!==value&&(this._enable=value,this.event("enablechanged",this._enable))}),__getset(0,__proto,"isSingleton",function(){return Component3D._isSingleton}),Component3D._isSingleton=!0,Component3D._uniqueIDCounter=1,Component3D}(),GeometryFilter=function(){function GeometryFilter(){this._destroyed=!1,GeometryFilter.__super.call(this),this._destroyed=!1}__class(GeometryFilter,"laya.d3.core.GeometryFilter",EventDispatcher);var __proto=GeometryFilter.prototype;return Laya.imps(__proto,{"laya.resource.IDestroy":!0}),__proto._destroy=function(){this.offAll(),this._destroyed=!0},__getset(0,__proto,"_isAsyncLoaded",function(){return!0}),__getset(0,__proto,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),__getset(0,__proto,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),__getset(0,__proto,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),GeometryFilter}(),BaseRender=function(){function BaseRender(owner){BaseRender.__super.call(this),this._id=++BaseRender._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new BoundBox(new Vector3,new Vector3),this._boundingBoxCenter=new Vector3,this._boundingSphere=new BoundSphere(new Vector3,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=owner,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}__class(BaseRender,"laya.d3.core.render.BaseRender",EventDispatcher);var __proto=BaseRender.prototype;return Laya.imps(__proto,{"laya.resource.IDestroy":!0}),__proto._changeMaterialReference=function(lastValue,value){lastValue&&lastValue._removeReference(),value._addReference()},__proto._getInstanceMaterial=function(material,index){var insMat=new material.constructor;return material.cloneTo(insMat),insMat.name=insMat.name+"(Instance)",this._materialsInstance[index]=!0,this._changeMaterialReference(this._materials[index],insMat),this._materials[index]=insMat},__proto._setShaderValuelightMap=function(lightMap){this._setShaderValueTexture(3,lightMap)},__proto._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},__proto._renderRenderableBoundBox=function(){var linePhasor=Laya3D._debugPhasorSprite,boundBox=this.boundingBox,corners=BaseRender._tempBoundBoxCorners;boundBox.getCorners(corners),linePhasor.line(corners[0],BaseRender._greenColor,corners[1],BaseRender._greenColor),linePhasor.line(corners[2],BaseRender._greenColor,corners[3],BaseRender._greenColor),linePhasor.line(corners[4],BaseRender._greenColor,corners[5],BaseRender._greenColor),linePhasor.line(corners[6],BaseRender._greenColor,corners[7],BaseRender._greenColor),linePhasor.line(corners[0],BaseRender._greenColor,corners[3],BaseRender._greenColor),linePhasor.line(corners[1],BaseRender._greenColor,corners[2],BaseRender._greenColor),linePhasor.line(corners[2],BaseRender._greenColor,corners[6],BaseRender._greenColor),linePhasor.line(corners[3],BaseRender._greenColor,corners[7],BaseRender._greenColor),linePhasor.line(corners[0],BaseRender._greenColor,corners[4],BaseRender._greenColor),linePhasor.line(corners[1],BaseRender._greenColor,corners[5],BaseRender._greenColor),linePhasor.line(corners[4],BaseRender._greenColor,corners[7],BaseRender._greenColor),linePhasor.line(corners[5],BaseRender._greenColor,corners[6],BaseRender._greenColor)},__proto._calculateBoundingSphere=function(){throw"BaseRender: must override it."},__proto._calculateBoundingBox=function(){throw"BaseRender: must override it."},__proto._setShaderValueTexture=function(shaderName,texture){this._owner._shaderValues.setValue(shaderName,texture)},__proto._setShaderValueMatrix4x4=function(shaderName,matrix4x4){this._owner._shaderValues.setValue(shaderName,matrix4x4?matrix4x4.elements:null)},__proto._setShaderValueColor=function(shaderIndex,color){this._owner._shaderValues.setValue(shaderIndex,color?color.elements:null)},__proto._setShaderValueBuffer=function(shaderIndex,buffer){this._owner._shaderValues.setValue(shaderIndex,buffer)},__proto._setShaderValueInt=function(shaderIndex,i){this._owner._shaderValues.setValue(shaderIndex,i)},__proto._setShaderValueBool=function(shaderIndex,b){this._owner._shaderValues.setValue(shaderIndex,b)},__proto._setShaderValueNumber=function(shaderIndex,number){this._owner._shaderValues.setValue(shaderIndex,number)},__proto._setShaderValueVector2=function(shaderIndex,vector2){this._owner._shaderValues.setValue(shaderIndex,vector2?vector2.elements:null)},__proto._addShaderDefine=function(value){this._owner._shaderDefineValue|=value},__proto._removeShaderDefine=function(value){this._owner._shaderDefineValue&=~value},__proto._renderUpdate=function(projectionView){return!0},__proto._applyLightMapParams=function(){var scene;0<=this._lightmapIndex&&(scene=this._owner.scene)&&(scene=scene.getlightmaps()[this._lightmapIndex])?(this._addShaderDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),scene.loaded?this._setShaderValuelightMap(scene):scene.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP)},__proto._updateOctreeNode=function(){var treeNode=this._treeNode;treeNode&&this._octreeNodeNeedChange&&(treeNode.updateObject(this),this._octreeNodeNeedChange=!1)},__proto._destroy=function(){this.offAll();for(var i=0,n=0,i=0,n=this._renderElements.length;i<n;i++)this._renderElements[i]._destroy();for(i=0,n=this._materials.length;i<n;i++)this._materials[i]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},__getset(0,__proto,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"material",function(){var material=this._materials[0];return material&&!this._materialsInstance[0]&&(material=this._getInstanceMaterial(material,0),this.event("materialchanged",[this,0,material])),this._materials[0]},function(value){this.sharedMaterial=value}),__getset(0,__proto,"sharedMaterial",function(){return this._materials[0]},function(value){var lastValue=this._materials[0];lastValue!==value&&(this._materials[0]=value,this._materialsInstance[0]=!1,this._changeMaterialReference(lastValue,value),this.event("materialchanged",[this,0,value]))}),__getset(0,__proto,"lightmapIndex",function(){return this._lightmapIndex},function(value){this._lightmapIndex=value,this._applyLightMapParams()}),__getset(0,__proto,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(value){this._lightmapScaleOffset=value,this._setShaderValueColor(2,value),this._addShaderDefine(RenderableSprite3D.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),__getset(0,__proto,"enable",function(){return this._enable},function(value){this._enable=value,this.event("enablechanged",[this,value])}),__getset(0,__proto,"materials",function(){for(var insMat,i=0,n=this._materials.length;i<n;i++)this._materialsInstance[i]||(insMat=this._getInstanceMaterial(this._materials[i],i),this.event("materialchanged",[this,i,insMat]));return this._materials.slice()},function(value){this.sharedMaterials=value}),__getset(0,__proto,"sharedMaterials",function(){return this._materials.slice()},function(value){if(!value)throw new Error("MeshRender: shadredMaterials value can't be null.");var len=value.length;this._materialsInstance.length=len;for(var i=0;i<len;i++){var lastValue=this._materials[i];lastValue!==value[i]&&(this._materialsInstance[i]=!1,this._changeMaterialReference(lastValue,value[i]),this.event("materialchanged",[this,i,value[i]]))}this._materials=value}),__getset(0,__proto,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),__getset(0,__proto,"boundingBoxCenter",function(){var boundBox;return this._boundingBoxCenterNeedChange&&(boundBox=this.boundingBox,Vector3.add(boundBox.min,boundBox.max,this._boundingBoxCenter),Vector3.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1),this._boundingBoxCenter}),__getset(0,__proto,"receiveShadow",function(){return this._receiveShadow},function(value){this._receiveShadow!==value&&((this._receiveShadow=value)?this._addShaderDefine(ParallelSplitShadowMap.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(ParallelSplitShadowMap.SHADERDEFINE_RECEIVE_SHADOW))}),__getset(0,__proto,"destroyed",function(){return this._destroyed}),BaseRender._uniqueIDCounter=0,__static(BaseRender,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3]},"_greenColor",function(){return this._greenColor=new Vector4(0,1,0,1)}]),BaseRender}(),Transform3D=function(){function Transform3D(owner){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,Transform3D.__super.call(this),this._localPosition=new Vector3,this._localRotation=new Quaternion(0,0,0,1),this._localScale=new Vector3(1,1,1),this._localRotationEuler=new Vector3,this._localMatrix=new Matrix4x4,this._position=new Vector3,this._rotation=new Quaternion(0,0,0,1),this._scale=new Vector3(1,1,1),this._worldMatrix=new Matrix4x4,this._forward=new Vector3,this._up=new Vector3,this._right=new Vector3,this._owner=owner,this._childs=[]}__class(Transform3D,"laya.d3.core.Transform3D",EventDispatcher);var __proto=Transform3D.prototype;return __proto._updateLocalMatrix=function(){var scaleOffsetPosition,rotationOffsetPosition,localRot,scalePivot;!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?Matrix4x4.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix):(Vector3.multiply(this.pivot,this._localScale,scalePivot=Transform3D._tempVector30),Vector3.subtract(scalePivot,this.pivot,scaleOffsetPosition=Transform3D._tempVector31),localRot=this.localRotation,Vector3.transformQuat(scalePivot,localRot,rotationOffsetPosition=Transform3D._tempVector32),Vector3.subtract(rotationOffsetPosition,scalePivot,rotationOffsetPosition),Vector3.subtract(this._localPosition,scaleOffsetPosition,scalePivot=Transform3D._tempVector33),Vector3.subtract(scalePivot,rotationOffsetPosition,scalePivot),Matrix4x4.createAffineTransformation(scalePivot,localRot,this._localScale,this._localMatrix))},__proto._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldPositionRotationTransform()}},__proto._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldPositionScaleTransform()}},__proto._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldPositionTransform()}},__proto._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldPositionRotationTransform()}},__proto._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldPositionScaleTransform()}},__proto._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._onWorldTransform()}},__proto.translate=function(translation,isLocal){(isLocal=void 0===isLocal?!0:isLocal)?(Matrix4x4.createFromQuaternion(this.localRotation,Transform3D._tempMatrix0),Vector3.transformCoordinate(translation,Transform3D._tempMatrix0,Transform3D._tempVector30),Vector3.add(this.localPosition,Transform3D._tempVector30,this._localPosition),this.localPosition=this._localPosition):(Vector3.add(this.position,translation,this._position),this.position=this._position)},__proto.rotate=function(rotation,isLocal,isRadian){void 0===isLocal&&(isLocal=!0),isRadian=(isRadian=void 0===isRadian?!0:isRadian)?rotation:(Vector3.scale(rotation,Math.PI/180,Transform3D._tempVector30),Transform3D._tempVector30),Quaternion.createFromYawPitchRoll(isRadian.y,isRadian.x,isRadian.z,Transform3D._tempQuaternion0),isLocal?(Quaternion.multiply(this._localRotation,Transform3D._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Quaternion.multiply(Transform3D._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},__proto.lookAt=function(target,up,isLocal){var eyeE,targetE=target.elements;(isLocal=void 0===isLocal?!1:isLocal)?(eyeE=this._localPosition.elements,Math.abs(eyeE[0]-targetE[0])<MathUtils3D.zeroTolerance&&Math.abs(eyeE[1]-targetE[1])<MathUtils3D.zeroTolerance&&Math.abs(eyeE[2]-targetE[2])<MathUtils3D.zeroTolerance||(Quaternion.lookAt(this._localPosition,target,up,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation)):(eyeE=(isLocal=this.position).elements,Math.abs(eyeE[0]-targetE[0])<MathUtils3D.zeroTolerance&&Math.abs(eyeE[1]-targetE[1])<MathUtils3D.zeroTolerance&&Math.abs(eyeE[2]-targetE[2])<MathUtils3D.zeroTolerance||(Quaternion.lookAt(isLocal,target,up,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation))},__getset(0,__proto,"_isFrontFaceInvert",function(){var scale=this.scale,isInvert=scale.x<0;return scale.y<0&&(isInvert=!isInvert),isInvert=scale.z<0?!isInvert:isInvert}),__getset(0,__proto,"owner",function(){return this._owner}),__getset(0,__proto,"localRotation",function(){var eulerE;return this._localQuaternionUpdate&&(eulerE=this._localRotationEuler.elements,Quaternion.createFromYawPitchRoll(eulerE[1]/Transform3D._angleToRandin,eulerE[0]/Transform3D._angleToRandin,eulerE[2]/Transform3D._angleToRandin,this._localRotation)),this._localRotation},function(value){this._localRotation=value,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),__getset(0,__proto,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?Matrix4x4.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(value){null===this._parent?value.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),Matrix4x4.multiply(this._localMatrix,value,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=value,this._worldUpdate=!1}),__getset(0,__proto,"worldNeedUpdate",function(){return this._worldUpdate}),__getset(0,__proto,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(value){this._localMatrix=value,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),__getset(0,__proto,"dummy",function(){return this._dummy},function(value){this._dummy!==value&&(this._dummy&&(this._dummy._entity=null),value&&(value._entity=this),this._dummy=value)}),__getset(0,__proto,"localPosition",function(){return this._localPosition},function(value){this._localPosition=value,this._localUpdate=!0,this._onWorldPositionTransform()}),__getset(0,__proto,"position",function(){var parentPosition;return this._positionUpdate&&(null!=this._parent?(parentPosition=this._parent.position,Vector3.multiply(this._localPosition,this._parent.scale,Transform3D._tempVector30),Vector3.transformQuat(Transform3D._tempVector30,this._parent.rotation,Transform3D._tempVector30),Vector3.add(parentPosition,Transform3D._tempVector30,this._position)):this._localPosition.cloneTo(this._position),this._positionUpdate=!1),this._position},function(value){var psX,psY,parentScaleE,invertScale,invertScaleE;null!=this._parent?(Vector3.subtract(value,this._parent.position,this._localPosition),psX=(parentScaleE=this._parent.scale.elements)[0],psY=parentScaleE[1],parentScaleE=parentScaleE[2],1===psX&&1===psY&&1===parentScaleE||((invertScaleE=(invertScale=Transform3D._tempVector30).elements)[0]=1/psX,invertScaleE[1]=1/psY,invertScaleE[2]=1/parentScaleE,Vector3.multiply(this._localPosition,invertScale,this._localPosition)),this._parent.rotation.invert(Transform3D._tempQuaternion0),Vector3.transformQuat(this._localPosition,Transform3D._tempQuaternion0,this._localPosition)):value.cloneTo(this._localPosition),this.localPosition=this._localPosition,this._position=value,this._positionUpdate=!1}),__getset(0,__proto,"localScale",function(){return this._localScale},function(value){this._localScale=value,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),__getset(0,__proto,"localRotationEuler",function(){var eulerE,localRotationEulerE;return this._locaEulerlUpdate&&(this._localRotation.getYawPitchRoll(Transform3D._tempVector30),eulerE=Transform3D._tempVector30.elements,(localRotationEulerE=this._localRotationEuler.elements)[0]=eulerE[1]*Transform3D._angleToRandin,localRotationEulerE[1]=eulerE[0]*Transform3D._angleToRandin,localRotationEulerE[2]=eulerE[2]*Transform3D._angleToRandin),this._localRotationEuler},function(value){this._localRotationEuler=value,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),__getset(0,__proto,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?Quaternion.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(value){null!=this._parent?(this._parent.rotation.invert(Transform3D._tempQuaternion0),Quaternion.multiply(value,Transform3D._tempQuaternion0,this._localRotation)):value.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=value,this._rotationUpdate=!1}),__getset(0,__proto,"scale",function(){return this._scaleUpdate&&(null!==this._parent?Vector3.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(value){var pScaleE,invPScaleE;null!==this._parent?(pScaleE=this._parent.scale.elements,(invPScaleE=Transform3D._tempVector30.elements)[0]=1/pScaleE[0],invPScaleE[1]=1/pScaleE[1],invPScaleE[2]=1/pScaleE[2],Vector3.multiply(value,Transform3D._tempVector30,this._localScale)):value.cloneTo(this._localScale),this.localScale=this._localScale,this._scale=value,this._scaleUpdate=!1}),__getset(0,__proto,"rotationEuler",null,function(value){Quaternion.createFromYawPitchRoll(value.y,value.x,value.z,this._rotation),this.rotation=this._rotation}),__getset(0,__proto,"forward",function(){var worldMatElem=this.worldMatrix.elements;return this._forward.elements[0]=-worldMatElem[8],this._forward.elements[1]=-worldMatElem[9],this._forward.elements[2]=-worldMatElem[10],this._forward}),__getset(0,__proto,"up",function(){var worldMatElem=this.worldMatrix.elements;return this._up.elements[0]=worldMatElem[4],this._up.elements[1]=worldMatElem[5],this._up.elements[2]=worldMatElem[6],this._up}),__getset(0,__proto,"right",function(){var worldMatElem=this.worldMatrix.elements;return this._right.elements[0]=worldMatElem[0],this._right.elements[1]=worldMatElem[1],this._right.elements[2]=worldMatElem[2],this._right}),__getset(0,__proto,"parent",function(){return this._parent},function(value){var parentChilds,index;this._parent!==value&&(this._parent&&(index=(parentChilds=this._parent._childs).indexOf(this),parentChilds.splice(index,1)),value&&(value._childs.push(this),value)&&this._onWorldTransform(),this._parent=value)}),__static(Transform3D,["_tempVector30",function(){return this._tempVector30=new Vector3},"_tempVector31",function(){return this._tempVector31=new Vector3},"_tempVector32",function(){return this._tempVector32=new Vector3},"_tempVector33",function(){return this._tempVector33=new Vector3},"_tempQuaternion0",function(){return this._tempQuaternion0=new Quaternion},"_tempMatrix0",function(){return this._tempMatrix0=new Matrix4x4},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),Transform3D}(),SubMeshRenderElement=(function(){function TransformUV(){this._rotation=0,this._matNeedUpdte=!1,TransformUV.__super.call(this),this._matrix=new Matrix4x4,this._offset=new Vector2,this._tiling=new Vector2(1,1)}__class(TransformUV,"laya.d3.core.TransformUV",EventDispatcher);var __proto=TransformUV.prototype;Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto._updateMatrix=function(){TransformUV._tempOffsetV3.elements[0]=this._offset.x,TransformUV._tempOffsetV3.elements[1]=this._offset.y,Quaternion.createFromYawPitchRoll(0,0,this._rotation,TransformUV._tempRotationQua),TransformUV._tempTitlingV3.elements[0]=this._tiling.x,TransformUV._tempTitlingV3.elements[1]=this._tiling.y,Matrix4x4.createAffineTransformation(TransformUV._tempOffsetV3,TransformUV._tempRotationQua,TransformUV._tempTitlingV3,this._matrix)},__proto.cloneTo=function(destObject){destObject._matrix=this._matrix.clone(),destObject._offset=this._offset.clone(),destObject._rotation=this._rotation,destObject._tiling=this._tiling.clone()},__proto.clone=function(){var dest=new this.constructor;return this.cloneTo(dest),dest},__getset(0,__proto,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),__getset(0,__proto,"tiling",function(){return this._tiling},function(value){this._tiling=value,this._matNeedUpdte=!0}),__getset(0,__proto,"offset",function(){return this._offset},function(value){this._offset=value,this._matNeedUpdte=!0}),__getset(0,__proto,"rotation",function(){return this._rotation},function(value){this._rotation=value,this._matNeedUpdte=!0}),__static(TransformUV,["_tempOffsetV3",function(){return this._tempOffsetV3=new Vector3(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new Quaternion},"_tempTitlingV3",function(){return this._tempTitlingV3=new Vector3(1,1,1)}])}(),function(_super){function BoxShape(){this.x=NaN,this.y=NaN,this.z=NaN,BoxShape.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}__class(BoxShape,"laya.d3.core.particleShuriKen.module.shape.BoxShape",_super);var __proto=BoxShape.prototype;__proto._getShapeBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=.5*-this.x,minE[1]=.5*-this.y,minE[2]=.5*-this.z,boundBox.max.elements);minE[0]=.5*this.x,minE[1]=.5*this.y,minE[2]=.5*this.z},__proto._getSpeedBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=0,minE[1]=0,minE[2]=0,boundBox.max.elements);minE[0]=0,minE[1]=1,minE[2]=0},__proto.generatePositionAndDirection=function(position,direction,rand,randomSeeds){var rpE=position.elements,rdE=direction.elements;rand?(rand.seed=randomSeeds[16],ShapeUtils._randomPointInsideHalfUnitBox(position,rand),randomSeeds[16]=rand.seed):ShapeUtils._randomPointInsideHalfUnitBox(position),rpE[0]=this.x*rpE[0],rpE[1]=this.y*rpE[1],rpE[2]=this.z*rpE[2],this.randomDirection?rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointUnitSphere(direction,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointUnitSphere(direction):(rdE[0]=0,rdE[1]=0,rdE[2]=1)},__proto.cloneTo=function(destObject){_super.prototype.cloneTo.call(this,destObject);destObject.x=this.x,destObject.y=this.y,destObject.z=this.z,destObject.randomDirection=this.randomDirection}}(BaseShape),function(_super){function CircleShape(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,CircleShape.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}__class(CircleShape,"laya.d3.core.particleShuriKen.module.shape.CircleShape",_super);var __proto=CircleShape.prototype;__proto._getShapeBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=minE[2]=-this.radius,minE[1]=0,boundBox.max.elements);minE[0]=minE[2]=this.radius,minE[1]=0},__proto._getSpeedBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=minE[1]=-1,minE[2]=0,boundBox.max.elements);minE[0]=minE[1]=1,minE[2]=0},__proto.generatePositionAndDirection=function(position,direction,rand,randomSeeds){var rpE=position.elements,positionPointE=CircleShape._tempPositionPoint.elements;rand?(rand.seed=randomSeeds[16],this.emitFromEdge?ShapeUtils._randomPointUnitArcCircle(this.arc,CircleShape._tempPositionPoint,rand):ShapeUtils._randomPointInsideUnitArcCircle(this.arc,CircleShape._tempPositionPoint,rand),randomSeeds[16]=rand.seed):this.emitFromEdge?ShapeUtils._randomPointUnitArcCircle(this.arc,CircleShape._tempPositionPoint):ShapeUtils._randomPointInsideUnitArcCircle(this.arc,CircleShape._tempPositionPoint),rpE[0]=-positionPointE[0],rpE[1]=positionPointE[1],rpE[2]=0,Vector3.scale(position,this.radius,position),this.randomDirection?rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointUnitSphere(direction,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointUnitSphere(direction):position.cloneTo(direction)},__proto.cloneTo=function(destObject){_super.prototype.cloneTo.call(this,destObject);destObject.radius=this.radius,destObject.arc=this.arc,destObject.emitFromEdge=this.emitFromEdge,destObject.randomDirection=this.randomDirection},__static(CircleShape,["_tempPositionPoint",function(){return this._tempPositionPoint=new Vector2}])}(BaseShape),function(_super){function ConeShape(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,ConeShape.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}__class(ConeShape,"laya.d3.core.particleShuriKen.module.shape.ConeShape",_super);var __proto=ConeShape.prototype;__proto._getShapeBoundBox=function(boundBox){var coneRadius2=this.radius+this.length*Math.sin(this.angle),coneLength=this.length*Math.cos(this.angle),minE=boundBox.min.elements,minE=(minE[0]=minE[1]=-coneRadius2,minE[2]=0,boundBox.max.elements);minE[0]=minE[1]=coneRadius2,minE[2]=coneLength},__proto._getSpeedBoundBox=function(boundBox){var sinA=Math.sin(this.angle),minE=boundBox.min.elements,boundBox=(minE[0]=minE[1]=-sinA,minE[2]=0,boundBox.max.elements);boundBox[0]=minE[1]=sinA,boundBox[2]=1},__proto.generatePositionAndDirection=function(position,direction,rand,randomSeeds){var directionPointE,rpE=position.elements,rdE=direction.elements,positionPointE=ConeShape._tempPositionPoint.elements,positionX=NaN,positionY=NaN,dirCosA=Math.cos(this.angle),dirSinA=Math.sin(this.angle);switch(this.emitType){case 0:rand?(rand.seed=randomSeeds[16],ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint,rand),randomSeeds[16]=rand.seed):ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint),positionX=positionPointE[0],positionY=positionPointE[1],rpE[0]=positionX*this.radius,rpE[1]=positionY*this.radius,rpE[2]=0,this.randomDirection?(rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint),directionPointE=ConeShape._tempDirectionPoint.elements,rdE[0]=directionPointE[0]*dirSinA,rdE[1]=directionPointE[1]*dirSinA):(rdE[0]=positionX*dirSinA,rdE[1]=positionY*dirSinA),rdE[2]=dirCosA;break;case 1:rand?(rand.seed=randomSeeds[16],ShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint,rand),randomSeeds[16]=rand.seed):ShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint),positionX=positionPointE[0],positionY=positionPointE[1],rpE[0]=positionX*this.radius,rpE[1]=positionY*this.radius,rpE[2]=0,this.randomDirection?(rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint),directionPointE=ConeShape._tempDirectionPoint.elements,rdE[0]=directionPointE[0]*dirSinA,rdE[1]=directionPointE[1]*dirSinA):(rdE[0]=positionX*dirSinA,rdE[1]=positionY*dirSinA),rdE[2]=dirCosA;break;case 2:rand?(rand.seed=randomSeeds[16],ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint,rand)):ShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint),positionX=positionPointE[0],positionY=positionPointE[1],rpE[0]=positionX*this.radius,rpE[1]=positionY*this.radius,rdE[rpE[2]=0]=positionX*dirSinA,rdE[1]=positionY*dirSinA,rdE[2]=dirCosA,Vector3.normalize(direction,direction),rand?(Vector3.scale(direction,this.length*rand.getFloat(),direction),randomSeeds[16]=rand.seed):Vector3.scale(direction,this.length*Math.random(),direction),Vector3.add(position,direction,position),this.randomDirection&&(rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointUnitSphere(direction,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointUnitSphere(direction));break;case 3:rand?(rand.seed=randomSeeds[16],ShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint,rand)):ShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint),positionX=positionPointE[0],positionY=positionPointE[1],rpE[0]=positionX*this.radius,rpE[1]=positionY*this.radius,rdE[rpE[2]=0]=positionX*dirSinA,rdE[1]=positionY*dirSinA,rdE[2]=dirCosA,Vector3.normalize(direction,direction),rand?(Vector3.scale(direction,this.length*rand.getFloat(),direction),randomSeeds[16]=rand.seed):Vector3.scale(direction,this.length*Math.random(),direction),Vector3.add(position,direction,position),this.randomDirection&&(rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointUnitSphere(direction,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointUnitSphere(direction));break;default:throw new Error("ConeShape:emitType is invalid.")}},__proto.cloneTo=function(destObject){_super.prototype.cloneTo.call(this,destObject);destObject.angle=this.angle,destObject.radius=this.radius,destObject.length=this.length,destObject.emitType=this.emitType,destObject.randomDirection=this.randomDirection},__static(ConeShape,["_tempPositionPoint",function(){return this._tempPositionPoint=new Vector2},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new Vector2}])}(BaseShape),function(_super){function HemisphereShape(){this.radius=NaN,this.emitFromShell=!1,HemisphereShape.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}__class(HemisphereShape,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",_super);var __proto=HemisphereShape.prototype;__proto._getShapeBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=minE[1]=minE[2]=-this.radius,boundBox.max.elements);minE[0]=minE[1]=this.radius,minE[2]=0},__proto._getSpeedBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=minE[1]=-1,minE[2]=0,boundBox.max.elements);minE[0]=minE[1]=minE[2]=1},__proto.generatePositionAndDirection=function(position,direction,rand,randomSeeds){var rpE=position.elements,z=(rand?(rand.seed=randomSeeds[16],this.emitFromShell?ShapeUtils._randomPointUnitSphere(position,rand):ShapeUtils._randomPointInsideUnitSphere(position,rand),randomSeeds[16]=rand.seed):this.emitFromShell?ShapeUtils._randomPointUnitSphere(position):ShapeUtils._randomPointInsideUnitSphere(position),Vector3.scale(position,this.radius,position),rpE[2]);z<0&&(rpE[2]=-1*z),this.randomDirection?rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointUnitSphere(direction,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointUnitSphere(direction):position.cloneTo(direction)},__proto.cloneTo=function(destObject){_super.prototype.cloneTo.call(this,destObject);destObject.radius=this.radius,destObject.emitFromShell=this.emitFromShell,destObject.randomDirection=this.randomDirection}}(BaseShape),function(_super){function SphereShape(){this.radius=NaN,this.emitFromShell=!1,SphereShape.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}__class(SphereShape,"laya.d3.core.particleShuriKen.module.shape.SphereShape",_super);var __proto=SphereShape.prototype;__proto._getShapeBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=minE[1]=minE[2]=-this.radius,boundBox.max.elements);minE[0]=minE[1]=minE[2]=this.radius},__proto._getSpeedBoundBox=function(boundBox){var minE=boundBox.min.elements,minE=(minE[0]=minE[1]=minE[2]=-1,boundBox.max.elements);minE[0]=minE[1]=minE[2]=1},__proto.generatePositionAndDirection=function(position,direction,rand,randomSeeds){rand?(rand.seed=randomSeeds[16],this.emitFromShell?ShapeUtils._randomPointUnitSphere(position,rand):ShapeUtils._randomPointInsideUnitSphere(position,rand),randomSeeds[16]=rand.seed):this.emitFromShell?ShapeUtils._randomPointUnitSphere(position):ShapeUtils._randomPointInsideUnitSphere(position),Vector3.scale(position,this.radius,position),this.randomDirection?rand?(rand.seed=randomSeeds[17],ShapeUtils._randomPointUnitSphere(direction,rand),randomSeeds[17]=rand.seed):ShapeUtils._randomPointUnitSphere(direction):position.cloneTo(direction)},__proto.cloneTo=function(destObject){_super.prototype.cloneTo.call(this,destObject);destObject.radius=this.radius,destObject.emitFromShell=this.emitFromShell,destObject.randomDirection=this.randomDirection}}(BaseShape),function(){function SubMeshRenderElement(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,SubMeshRenderElement.__super.call(this)}return __class(SubMeshRenderElement,"laya.d3.core.render.SubMeshRenderElement",RenderElement),SubMeshRenderElement}()),ShaderCompile3D=function(){function ShaderCompile3D(name,vs,ps,attributeMap,uniformMap,includeFiles){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=name,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[ParallelSplitShadowMap.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[RenderableSprite3D.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[RenderableSprite3D.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[BaseMaterial.SHADERDEFINE_ALPHATEST]="ALPHATEST";ShaderCompile3D.__super.call(this,name,vs,ps,null,{}),this._attributeMap=attributeMap;for(var key in uniformMap){var uniformParam=uniformMap[key];switch(uniformParam[1]){case 0:this._renderElementUniformMap[key]=uniformParam[0];break;case 1:this._materialUniformMap[key]=uniformParam[0];break;case 2:this._spriteUniformMap[key]=uniformParam[0];break;case 3:this._cameraUniformMap[key]=uniformParam[0];break;case 4:this._sceneUniformMap[key]=uniformParam[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}__class(ShaderCompile3D,"laya.d3.shader.ShaderCompile3D",ShaderCompile);var __proto=ShaderCompile3D.prototype;return __proto._definesToNameDic=function(value,int2Name){for(var d,name,o={},i=0;i<32&&!(value<(d=1<<i));i++)value&d&&(name=int2Name[d])&&(o[name]="");return o},__proto.withCompile=function(publicDefine,spriteDefine,materialDefine){var materialDefShaders,spriteDefShaders=this.sharders[publicDefine];if(spriteDefShaders)if(materialDefShaders=spriteDefShaders[spriteDefine]){if(shader=materialDefShaders[materialDefine])return shader}else materialDefShaders=spriteDefShaders[spriteDefine]=[];else materialDefShaders=(spriteDefShaders=this.sharders[publicDefine]=[])[spriteDefine]=[];var key,spriteDefShaders=this._definesToNameDic(publicDefine,ShaderCompile3D._globalInt2name),spriteDefGroup=this._definesToNameDic(spriteDefine,this._spriteInt2name),materialDefGroup=this._definesToNameDic(materialDefine,this._materialInt2name),defMap=(laya.d3.shader.ShaderCompile3D.debugMode&&"custom_particle_shader"==Shader3D.nameKey.getName(this._name)&&console.log("shaderCompile.precompileShaderWithShaderDefine(",publicDefine,",",spriteDefine,",",materialDefine,")"),{}),defineStr="";if(spriteDefShaders)for(key in spriteDefShaders)defineStr+="#define "+key+"\n",defMap[key]=!0;if(spriteDefGroup)for(key in spriteDefGroup)defineStr+="#define "+key+"\n",defMap[key]=!0;if(materialDefGroup)for(key in materialDefGroup)defineStr+="#define "+key+"\n",defMap[key]=!0;var publicDefine=this._VS.toscript(defMap,[]),spriteDefine=this._PS.toscript(defMap,[]),shader=Shader3D.create(defineStr+publicDefine.join("\n"),defineStr+spriteDefine.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap);return materialDefShaders[materialDefine]=shader},__proto.precompileShaderWithShaderDefine=function(publicDefine,spriteDefine,materialDefine){this.withCompile(publicDefine,spriteDefine,materialDefine)},__proto.addMaterialDefines=function(shaderdefines){var k,defines=shaderdefines.defines;for(k in defines){var name=defines[k],i=parseInt(k);this._materialInt2name[i]=name,this._materialName2Int[name]=i}},__proto.addSpriteDefines=function(shaderdefines){var k,defines=shaderdefines.defines;for(k in defines){var name=defines[k],i=parseInt(k);this._spriteInt2name[i]=name,this._spriteName2Int[name]=i}},__proto.getMaterialDefineByName=function(name){return this._materialName2Int[name]},__proto.registerMaterialDefine=function(name){var value=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[value]=name,this._materialName2Int[name]=value},__proto.registerSpriteDefine=function(name){var value=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[value]=name,this._spriteName2Int[name]=value},ShaderCompile3D._globalRegDefine=function(name,value){ShaderCompile3D._globalInt2name[value]=name},ShaderCompile3D.add=function(nameID,vs,ps,attributeMap,uniformMap){return laya.d3.shader.ShaderCompile3D._preCompileShader[nameID]=new ShaderCompile3D(nameID,vs,ps,attributeMap,uniformMap,ShaderCompile.includes)},ShaderCompile3D.get=function(name){return laya.d3.shader.ShaderCompile3D._preCompileShader[Shader3D.nameKey.getID(name)]},ShaderCompile3D._preCompileShader={},ShaderCompile3D._globalInt2name=[],ShaderCompile3D.debugMode=!1,ShaderCompile3D.SHADERDEFINE_HIGHPRECISION=1,ShaderCompile3D.SHADERDEFINE_FOG=4,ShaderCompile3D.SHADERDEFINE_DIRECTIONLIGHT=8,ShaderCompile3D.SHADERDEFINE_POINTLIGHT=16,ShaderCompile3D.SHADERDEFINE_SPOTLIGHT=32,ShaderCompile3D.SHADERDEFINE_UV0=64,ShaderCompile3D.SHADERDEFINE_COLOR=128,ShaderCompile3D.SHADERDEFINE_UV1=256,ShaderCompile3D.SAHDERDEFINE_DEPTHFOG=131072,ShaderCompile3D}(),MeshSprite3DStaticBatchManager=function(){function MeshSprite3DStaticBatchManager(){MeshSprite3DStaticBatchManager.__super.call(this)}__class(MeshSprite3DStaticBatchManager,"laya.d3.graphics.MeshSprite3DStaticBatchManager",StaticBatchManager);var __proto=MeshSprite3DStaticBatchManager.prototype;return __proto._getStaticBatch=function(rootOwner,vertexDeclaration,material,number){var staticBatch,number=rootOwner?rootOwner.id.toString()+material.id.toString()+vertexDeclaration.id.toString()+number.toString():material.id.toString()+vertexDeclaration.id.toString()+number.toString();return this._staticBatches[number]?staticBatch=this._staticBatches[number]:this._staticBatches[number]=staticBatch=new SubMeshStaticBatch(number,this,rootOwner,vertexDeclaration,material),staticBatch},__proto._initStaticBatchs=function(rootOwner){this._initBatchRenderElements.sort(MeshSprite3DStaticBatchManager._sortPrepareStaticBatch);for(var lastMaterial,lastVertexDeclaration,curStaticBatch,lastCanMerage=!1,batchNumber=0,i=0,n=this._initBatchRenderElements.length;i<n;i++){var oldStaticBatch,lastRenderObj,lastRenderElement,curRenderElement,renderElement=this._initBatchRenderElements[i],vb=renderElement.renderObj._getVertexBuffer(0);renderElement._sprite3D;lastVertexDeclaration===vb.vertexDeclaration&&lastMaterial===renderElement._material?lastCanMerage?curStaticBatch._addCombineBatchRenderObjTest(renderElement)?(oldStaticBatch=renderElement._staticBatch)!==curStaticBatch&&(oldStaticBatch&&oldStaticBatch._deleteCombineBatchRenderObj(renderElement),curStaticBatch._addCombineBatchRenderObj(renderElement)):(lastCanMerage=!1,batchNumber++):(lastRenderElement=(lastRenderObj=this._initBatchRenderElements[i-1]).renderObj,curRenderElement=renderElement.renderObj,lastCanMerage=!(65535<lastRenderElement._getVertexBuffer().vertexCount+curRenderElement._getVertexBuffer().vertexCount||(curStaticBatch=this._getStaticBatch(rootOwner,lastVertexDeclaration,lastMaterial,batchNumber),(oldStaticBatch=lastRenderObj._staticBatch)!==curStaticBatch&&(oldStaticBatch&&oldStaticBatch._deleteCombineBatchRenderObj(lastRenderObj),curStaticBatch._addCombineBatchRenderObj(lastRenderObj)),(oldStaticBatch=renderElement._staticBatch)!==curStaticBatch&&(oldStaticBatch&&oldStaticBatch._deleteCombineBatchRenderObj(renderElement),curStaticBatch._addCombineBatchRenderObj(renderElement)),0))):(lastCanMerage=!1,batchNumber=0),lastMaterial=renderElement._material,lastVertexDeclaration=vb.vertexDeclaration}},MeshSprite3DStaticBatchManager._sortPrepareStaticBatch=function(a,b){var aRender=a._render,bRender=b._render,lightMapIndexOffset=aRender.lightmapIndex-bRender.lightmapIndex;return 0==lightMapIndexOffset?0==(aRender=aRender.receiveShadow-bRender.receiveShadow)?0==(bRender=a._mainSortID-b._mainSortID)?a.renderObj.triangleCount-b.renderObj.triangleCount:bRender:aRender:lightMapIndexOffset},MeshSprite3DStaticBatchManager}(),SubMeshStaticBatch=function(){function SubMeshStaticBatch(key,manager,rootOwner,vertexDeclaration,material){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,SubMeshStaticBatch.__super.call(this,key,manager,rootOwner),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=vertexDeclaration,this._material=material}__class(SubMeshStaticBatch,"laya.d3.graphics.SubMeshStaticBatch",StaticBatch);var __proto=SubMeshStaticBatch.prototype;return __proto._compareBatchRenderElement=function(a,b){return a._batchIndexStart>b._batchIndexStart},__proto._addCombineBatchRenderObjTest=function(renderElement){var subMeshVertexCount=renderElement.renderObj._vertexCount;return!(65535<(0<subMeshVertexCount?this._currentCombineVertexCount+subMeshVertexCount:this._currentCombineVertexCount+renderElement.renderObj._getVertexBuffer().vertexCount))},__proto._addCombineBatchRenderObj=function(renderElement){var subMesh=renderElement.renderObj,subMeshVertexCount=subMesh._vertexCount;this._initBatchRenderElements.push(renderElement),renderElement._staticBatch=this,0<subMeshVertexCount?(this._currentCombineIndexCount+=subMesh._indexCount,this._currentCombineVertexCount+=subMeshVertexCount):(this._currentCombineIndexCount=this._currentCombineIndexCount+subMesh._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+subMesh._getVertexBuffer().vertexCount),this._needFinishCombine=!0},__proto._deleteCombineBatchRenderObj=function(renderElement){var subMesh=renderElement.renderObj,index=this._initBatchRenderElements.indexOf(renderElement);-1!==index&&(this._initBatchRenderElements.splice(index,1),renderElement._staticBatch=null,0<(index=subMesh._vertexCount)?(this._currentCombineIndexCount=this._currentCombineIndexCount-subMesh._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-index):(this._currentCombineIndexCount=this._currentCombineIndexCount-subMesh._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-subMesh._getVertexBuffer().vertexCount),this._needFinishCombine=!0)},__proto._finishInit=function(){if(this._needFinishCombine){var curMerVerCount=0,curIndexCount=0,vertexDatas=((0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex||this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture)&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration)),new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount)),indexDatas=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=VertexBuffer3D.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=IndexBuffer3D.create("ushort",this._currentCombineIndexCount,35044);for(var i=0,n=this._initBatchRenderElements.length;i<n;i++){var renderElement=this._initBatchRenderElements[i],subMesh=renderElement.renderObj,subVertexDatas=subMesh._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,renderElement._sprite3D),subIndexDatas=subMesh.getIndices(),isInvert=renderElement._sprite3D.transform._isFrontFaceInvert,indexOffset=curMerVerCount/(this._vertexDeclaration.vertexStride/4)-subMesh._vertexStart,subMesh=curIndexCount,indexEnd=subMesh+subIndexDatas.length,k=(renderElement._batchIndexStart=subMesh,renderElement._batchIndexEnd=indexEnd,indexDatas.set(subIndexDatas,curIndexCount),0);if(isInvert)for(k=subMesh;k<indexEnd;k+=3){indexDatas[k]=indexOffset+indexDatas[k];var index1=indexDatas[k+1],index2=indexDatas[k+2];indexDatas[k+1]=indexOffset+index2,indexDatas[k+2]=indexOffset+index1}else for(k=subMesh;k<indexEnd;k+=3)indexDatas[k]=indexOffset+indexDatas[k],indexDatas[k+1]=indexOffset+indexDatas[k+1],indexDatas[k+2]=indexOffset+indexDatas[k+2];curIndexCount+=subIndexDatas.length,vertexDatas.set(subVertexDatas,curMerVerCount),curMerVerCount+=subVertexDatas.length}this._vertexBuffer.setData(vertexDatas),this._indexBuffer.setData(indexDatas),this._needFinishCombine=!1}},__proto._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new SubMeshRenderElement)},__proto._getRenderElement=function(renderQueueElements,scene,projectionView){for(var count=this._batchRenderElements.length,canMerge=!0,i=0;i<count;i++){var renderElement,merageElement,lastRender,lastRenderElement,lightMapBatchOwnerIndices,batchOwnerIndex,batchOwner,render=(renderElement=this._batchRenderElements[i])._sprite3D._render;(canMerge=0!==i?(lastRender=(lastRenderElement=this._batchRenderElements[i-1])._sprite3D._render).lightmapIndex!==render.lightmapIndex||lastRender.receiveShadow!==render.receiveShadow||lastRenderElement._batchIndexEnd!==renderElement._batchIndexStart:canMerge)?((merageElement=this._getCombineRenderElementFromPool()).renderObj=this,merageElement._material=this._material,merageElement._batchIndexStart=renderElement._batchIndexStart,merageElement._batchIndexEnd=renderElement._batchIndexEnd,lastRender=render.lightmapIndex,void 0===(batchOwnerIndex=(lightMapBatchOwnerIndices=(lightMapBatchOwnerIndices=this._batchOwnerIndices[lastRenderElement=lastRender+1])||(this._batchOwnerIndices[lastRenderElement]=[]))[renderElement._render.receiveShadow?1:0])?(lightMapBatchOwnerIndices[render.receiveShadow?1:0]=this._batchOwners.length,(batchOwner=new MeshSprite3D(null,"StaticBatchMeshSprite3D"))._scene=scene,batchOwner._transform=this._rootOwner?this._rootOwner._transform:null,batchOwner._render.lightmapIndex=lastRender,batchOwner._render.receiveShadow=renderElement._render.receiveShadow,this._batchOwners.push(batchOwner)):batchOwner=this._batchOwners[batchOwnerIndex],batchOwner._render._renderUpdate(projectionView),merageElement._sprite3D=batchOwner,renderQueueElements.push(merageElement)):merageElement._batchIndexEnd=renderElement._batchIndexEnd}},__proto._beforeRender=function(state){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},__proto._render=function(state){var state=state.renderElement,batchIndexStart=state._batchIndexStart,state=state._batchIndexEnd-batchIndexStart;WebGL.mainContext.drawElements(4,state,5123,2*batchIndexStart),Stat.drawCall++,Stat.trianglesFaces+=state/3},__proto.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},__proto._getVertexBuffer=function(index){return void 0===index&&(index=0),this._vertexBuffer},SubMeshStaticBatch}(),ComponentNode=function(){function ComponentNode(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,ComponentNode.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}__class(ComponentNode,"laya.d3.core.ComponentNode",Node);var __proto=ComponentNode.prototype;return __proto.addComponent=function(type){var typeComponentIndex,index=this._componentsMap.indexOf(type);if(-1===index)typeComponentIndex=[],this._componentsMap.push(type),this._typeComponentsIndices.push(typeComponentIndex);else if(typeComponentIndex=this._typeComponentsIndices[index],this._components[typeComponentIndex[0]].isSingleton)throw new Error("无法单实例创建"+type+"组件，"+type+"组件已存在！");index=ClassUtils.getInstance(type);return typeComponentIndex.push(this._components.length),this._components.push(index),index instanceof laya.d3.component.Script&&this._scripts.push(index),index._initialize(this),index},__proto._removeComponent=function(mapIndex,index){var componentIndices=this._typeComponentsIndices[mapIndex],componentIndex=componentIndices[index],component=this._components[componentIndex];this._components.splice(componentIndex,1),component instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(component),1),componentIndices.splice(index,1),0===componentIndices.length&&(this._typeComponentsIndices.splice(mapIndex,1),this._componentsMap.splice(mapIndex,1));for(var i=0,n=this._componentsMap.length;i<n;i++)for(var j=(componentIndices=this._typeComponentsIndices[i]).length-1;0<=j;j--){var oldComponentIndex=componentIndices[j];if(!(componentIndex<oldComponentIndex))break;componentIndices[j]=--oldComponentIndex}component._destroy()},__proto.getComponentByType=function(type,typeIndex){void 0===typeIndex&&(typeIndex=0);type=this._componentsMap.indexOf(type);return-1===type?null:this._components[this._typeComponentsIndices[type][typeIndex]]},__proto.getComponentsByType=function(type,components){type=this._componentsMap.indexOf(type);if(-1===type)components.length=0;else{var typeComponents=this._typeComponentsIndices[type],count=typeComponents.length;components.length=count;for(var i=0;i<count;i++)components[i]=this._components[typeComponents[i]]}},__proto.getComponentByIndex=function(index){return this._components[index]},__proto.removeComponentByType=function(type,typeIndex){void 0===typeIndex&&(typeIndex=0);type=this._componentsMap.indexOf(type);-1!==type&&this._removeComponent(type,typeIndex)},__proto.removeComponentsByType=function(type){var mapIndex=this._componentsMap.indexOf(type);if(-1!==mapIndex)for(var componentIndices=this._typeComponentsIndices[mapIndex],i=0,n=componentIndices.length;i<n;componentIndices.length<n?n--:i++)this._removeComponent(mapIndex,i)},__proto.removeAllComponent=function(){for(var i=0,n=this._componentsMap.length;i<n;this._componentsMap.length<n?n--:i++)this.removeComponentsByType(this._componentsMap[i])},__proto._updateComponents=function(state){for(var i=0,n=this._components.length;i<n;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._update(state)}},__proto._lateUpdateComponents=function(state){for(var i=0;i<this._components.length;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._lateUpdate(state)}},__proto._preRenderUpdateComponents=function(state){for(var i=0;i<this._components.length;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._preRenderUpdate(state)}},__proto._postRenderUpdateComponents=function(state){for(var i=0;i<this._components.length;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._postRenderUpdate(state)}},ComponentNode}(),BaseMaterial=function(_super){function BaseMaterial(){BaseMaterial.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new ValusArray,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new Vector4(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}__class(BaseMaterial,"laya.d3.core.material.BaseMaterial",_super);var __proto=BaseMaterial.prototype;return Laya.imps(__proto,{"laya.d3.core.IClone":!0}),__proto._addShaderDefine=function(value){this._shaderDefineValue|=value},__proto._removeShaderDefine=function(value){this._shaderDefineValue&=~value},__proto._addDisablePublicShaderDefine=function(value){this._disablePublicShaderDefine|=value},__proto._removeDisablePublicShaderDefine=function(value){this._disablePublicShaderDefine&=~value},__proto._setBuffer=function(shaderIndex,buffer){this._shaderValues.setValue(shaderIndex,buffer),this._values[shaderIndex]=buffer},__proto._getBuffer=function(shaderIndex){return this._values[shaderIndex]},__proto._setMatrix4x4=function(shaderIndex,matrix4x4){this._shaderValues.setValue(shaderIndex,matrix4x4?matrix4x4.elements:null),this._values[shaderIndex]=matrix4x4},__proto._getMatrix4x4=function(shaderIndex){return this._values[shaderIndex]},__proto._setInt=function(shaderIndex,i){this._shaderValues.setValue(shaderIndex,i),this._values[shaderIndex]=i},__proto._getInt=function(shaderIndex){return this._values[shaderIndex]},__proto._setNumber=function(shaderIndex,number){this._shaderValues.setValue(shaderIndex,number),this._values[shaderIndex]=number},__proto._getNumber=function(shaderIndex){return this._values[shaderIndex]},__proto._setBool=function(shaderIndex,b){this._shaderValues.setValue(shaderIndex,b),this._values[shaderIndex]=b},__proto._getBool=function(shaderIndex){return this._values[shaderIndex]},__proto._setVector2=function(shaderIndex,vector2){this._shaderValues.setValue(shaderIndex,vector2?vector2.elements:null),this._values[shaderIndex]=vector2},__proto._getVector2=function(shaderIndex){return this._values[shaderIndex]},__proto._setColor=function(shaderIndex,color){this._shaderValues.setValue(shaderIndex,color?color.elements:null),this._values[shaderIndex]=color},__proto._getColor=function(shaderIndex){return this._values[shaderIndex]},__proto._setTexture=function(shaderIndex,texture){var lastValue=this._values[shaderIndex];this._values[shaderIndex]=texture,this._shaderValues.setValue(shaderIndex,texture),0<this.referenceCount&&(lastValue&&lastValue._removeReference(),texture)&&texture._addReference()},__proto._getTexture=function(shaderIndex){return this._values[shaderIndex]},__proto._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},__proto._getShader=function(sceneDefineValue,vertexDefineValue,spriteDefineValue){sceneDefineValue=(sceneDefineValue|vertexDefineValue)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(sceneDefineValue,spriteDefineValue,this._shaderDefineValue),this._shader},__proto._setRenderStateBlendDepth=function(){var gl=WebGL.mainContext;switch(WebGLContext.setDepthMask(gl,this.depthWrite),0===this.depthTest?WebGLContext.setDepthTest(gl,!1):(WebGLContext.setDepthTest(gl,!0),WebGLContext.setDepthFunc(gl,this.depthTest)),this.blend){case 0:WebGLContext.setBlend(gl,!1);break;case 1:WebGLContext.setBlend(gl,!0),WebGLContext.setBlendFunc(gl,this.srcBlend,this.dstBlend);break;case 2:WebGLContext.setBlend(gl,!0)}},__proto._setRenderStateFrontFace=function(isTarget,transform){var gl=WebGL.mainContext,forntFace=0;switch(this.cull){case 0:WebGLContext.setCullFace(gl,!1);break;case 1:WebGLContext.setCullFace(gl,!0),forntFace=isTarget?transform&&transform._isFrontFaceInvert?2305:2304:transform&&transform._isFrontFaceInvert?2304:2305,WebGLContext.setFrontFace(gl,forntFace);break;case 2:WebGLContext.setCullFace(gl,!0),forntFace=isTarget?transform&&transform._isFrontFaceInvert?2304:2305:transform&&transform._isFrontFaceInvert?2305:2304,WebGLContext.setFrontFace(gl,forntFace)}},__proto.onAsynLoaded=function(url,data,params){var jsonData=data[0],textureMap=data[1];switch(jsonData.version){case"LAYAMATERIAL:01":var key,i=0,n=0,props=jsonData.props;for(key in props)switch(key){case"vectors":for(var vectors=props[key],i=0,n=vectors.length;i<n;i++){var vector=vectors[i],vectorValue=vector.value;switch(vectorValue.length){case 2:this[vector.name]=new Vector2(vectorValue[0],vectorValue[1]);break;case 3:this[vector.name]=new Vector3(vectorValue[0],vectorValue[1],vectorValue[2]);break;case 4:this[vector.name]=new Vector4(vectorValue[0],vectorValue[1],vectorValue[2],vectorValue[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var textures=props[key];for(i=0,n=textures.length;i<n;i++){var texture=textures[i],path=texture.path;path&&(this[texture.name]=Loader.getRes(textureMap[path]))}break;case"defines":var defineNames=props[key];for(i=0,n=defineNames.length;i<n;i++){var define=this._shaderCompile.getMaterialDefineByName(defineNames[i]);this._addShaderDefine(define)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[key]=props[key];break;case"renderQueue":switch(props[key]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[key]=props[key]}break;case"LAYAMATERIAL:02":for(key in props=jsonData.props)switch(key){case"vectors":for(i=0,n=(vectors=props[key]).length;i<n;i++)switch((vectorValue=(vector=vectors[i]).value).length){case 2:this[vector.name]=new Vector2(vectorValue[0],vectorValue[1]);break;case 3:this[vector.name]=new Vector3(vectorValue[0],vectorValue[1],vectorValue[2]);break;case 4:this[vector.name]=new Vector4(vectorValue[0],vectorValue[1],vectorValue[2],vectorValue[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(i=0,n=(textures=props[key]).length;i<n;i++)(path=(texture=textures[i]).path)&&(this[texture.name]=Loader.getRes(textureMap[path]));break;case"defines":for(i=0,n=(defineNames=props[key]).length;i<n;i++)define=this._shaderCompile.getMaterialDefineByName(defineNames[i]),this._addShaderDefine(define);break;default:this[key]=props[key]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},__proto._addReference=function(){_super.prototype._addReference.call(this);for(var i=0,n=this._values.length;i<n;i++){var value=this._values[i];value&&value instanceof laya.d3.resource.BaseTexture&&value._addReference()}},__proto._removeReference=function(){_super.prototype._removeReference.call(this);for(var i=0,n=this._values.length;i<n;i++){var value=this._values[i];value&&value instanceof laya.d3.resource.BaseTexture&&value._removeReference()}},__proto.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},__proto.setShaderName=function(name){name=Shader3D.nameKey.getID(name);if(-1===name)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=ShaderCompile3D._preCompileShader[name]},__proto.cloneTo=function(destObject){destObject.name=this.name,destObject.cull=this.cull,destObject.blend=this.blend,destObject.srcBlend=this.srcBlend,destObject.dstBlend=this.dstBlend,destObject.srcBlendRGB=this.srcBlendRGB,destObject.dstBlendRGB=this.dstBlendRGB,destObject.srcBlendAlpha=this.srcBlendAlpha,destObject.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(destObject.blendConstColor),destObject.blendEquation=this.blendEquation,destObject.blendEquationRGB=this.blendEquationRGB,destObject.blendEquationAlpha=this.blendEquationAlpha,destObject.depthTest=this.depthTest,destObject.depthWrite=this.depthWrite,destObject.renderQueue=this.renderQueue,destObject._shader=this._shader,destObject._disablePublicShaderDefine=this._disablePublicShaderDefine,destObject._shaderDefineValue=this._shaderDefineValue;for(var i=0,destShaderValues=destObject._shaderValues,valueCount=(destObject._shaderValues.data.length=this._shaderValues.data.length,this._values.length),destValues=destObject._values,i=0,n=destValues.length=valueCount;i<n;i++){var v2,v4,value=this._values[i];value&&("number"==typeof value||"boolean"==typeof value?(destValues[i]=value,destShaderValues.data[i]=value):value instanceof laya.d3.math.Vector2?(v2=destValues[i]||(destValues[i]=new Vector2),value.cloneTo(v2),destShaderValues.data[i]=v2.elements):value instanceof laya.d3.math.Vector3?(v2=destValues[i]||(destValues[i]=new Vector3),value.cloneTo(v2),destShaderValues.data[i]=v2.elements):value instanceof laya.d3.math.Vector4?(v4=destValues[i]||(destValues[i]=new Vector4),value.cloneTo(v4),destShaderValues.data[i]=v4.elements):value instanceof laya.d3.math.Matrix4x4?(v4=destValues[i]||(destValues[i]=new Matrix4x4),value.cloneTo(v4),destShaderValues.data[i]=v4.elements):value instanceof laya.d3.resource.BaseTexture&&(destValues[i]=value,destShaderValues.data[i]=value))}},__proto.clone=function(){var destBaseMaterial=new this.constructor;return this.cloneTo(destBaseMaterial),destBaseMaterial},__getset(0,__proto,"alphaTestValue",function(){return this._getNumber(0)},function(value){this._setNumber(0,value)}),__getset(0,__proto,"alphaTest",function(){return this._alphaTest},function(value){(this._alphaTest=value)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),BaseMaterial.__init__=function(){BaseMaterial.SHADERDEFINE_ALPHATEST=BaseMaterial.shaderDefines.registerDefine("ALPHATEST")},BaseMaterial.RENDERQUEUE_OPAQUE=2e3,BaseMaterial.RENDERQUEUE_ALPHATEST=2450,BaseMaterial.RENDERQUEUE_TRANSPARENT=3e3,BaseMaterial.CULL_NONE=0,BaseMaterial.CULL_FRONT=1,BaseMaterial.CULL_BACK=2,BaseMaterial.BLEND_DISABLE=0,BaseMaterial.BLEND_ENABLE_ALL=1,BaseMaterial.BLEND_ENABLE_SEPERATE=2,BaseMaterial.BLENDPARAM_ZERO=0,BaseMaterial.BLENDPARAM_ONE=1,BaseMaterial.BLENDPARAM_SRC_COLOR=768,BaseMaterial.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,BaseMaterial.BLENDPARAM_DST_COLOR=774,BaseMaterial.BLENDPARAM_ONE_MINUS_DST_COLOR=775,BaseMaterial.BLENDPARAM_SRC_ALPHA=770,BaseMaterial.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,BaseMaterial.BLENDPARAM_DST_ALPHA=772,BaseMaterial.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,BaseMaterial.BLENDPARAM_SRC_ALPHA_SATURATE=776,BaseMaterial.BLENDEQUATION_ADD=0,BaseMaterial.BLENDEQUATION_SUBTRACT=1,BaseMaterial.BLENDEQUATION_REVERSE_SUBTRACT=2,BaseMaterial.DEPTHTEST_OFF=0,BaseMaterial.DEPTHTEST_NEVER=512,BaseMaterial.DEPTHTEST_LESS=513,BaseMaterial.DEPTHTEST_EQUAL=514,BaseMaterial.DEPTHTEST_LEQUAL=515,BaseMaterial.DEPTHTEST_GREATER=516,BaseMaterial.DEPTHTEST_NOTEQUAL=517,BaseMaterial.DEPTHTEST_GEQUAL=518,BaseMaterial.DEPTHTEST_ALWAYS=519,BaseMaterial.SHADERDEFINE_ALPHATEST=1,BaseMaterial.ALPHATESTVALUE=0,__static(BaseMaterial,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1}]),BaseMaterial}(Resource),BaseTexture=function(){function BaseTexture(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,BaseTexture.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}__class(BaseTexture,"laya.d3.resource.BaseTexture",Resource);var __proto=BaseTexture.prototype;return __getset(0,__proto,"width",function(){return this._width}),__getset(0,__proto,"repeat",function(){return this._repeat},function(value){this._repeat!==value&&(this._repeat=value,this._source)&&(value=WebGL.mainContext,WebGLContext.bindTexture(value,this._type,this._source),Arith.isPOT(this._width,this._height)&&this._repeat?(value.texParameteri(this._type,10242,10497),value.texParameteri(this._type,10243,10497)):(value.texParameteri(this._type,10242,33071),value.texParameteri(this._type,10243,33071)))}),__getset(0,__proto,"height",function(){return this._height}),__getset(0,__proto,"magFifter",function(){return this._magFifter},function(value){(this._magFifter=value)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(value)}),__getset(0,__proto,"wrapModeV",function(){return this._wrapModeV}),__getset(0,__proto,"size",function(){return this._size}),__getset(0,__proto,"wrapModeU",function(){return this._wrapModeU}),__getset(0,__proto,"mipmap",function(){return this._mipmap},function(value){this._mipmap=value,this._mipmap!=value&&this._conchTexture&&this._conchTexture.setMipMap(value)}),__getset(0,__proto,"minFifter",function(){return this._minFifter},function(value){this._minFifter=value,this._minFifter!=value&&this._conchTexture&&this._conchTexture.setMinFifter(value)}),__getset(0,__proto,"format",function(){return this._format}),__getset(0,__proto,"source",function(){return this.activeResource(),this._source}),__getset(0,__proto,"defaulteTexture",function(){return SolidColorTexture2D.grayTexture}),BaseTexture.WARPMODE_REPEAT=0,BaseTexture.WARPMODE_CLAMP=1,BaseTexture}(),BaseMesh=function(){function BaseMesh(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,BaseMesh.__super.call(this),this._boundingBoxCorners=__newvec(8,null)}__class(BaseMesh,"laya.d3.resource.models.BaseMesh",Resource);var __proto=BaseMesh.prototype;return __proto._getPositions=function(){throw new Error("未Override,请重载该属性！")},__proto._generateBoundingObject=function(){this._boundingSphere=new BoundSphere(new Vector3,0),BoundSphere.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new BoundBox(new Vector3,new Vector3),BoundBox.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},__proto.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},__proto.getRenderElement=function(index){throw new Error("未Override,请重载该属性！")},__getset(0,__proto,"subMeshCount",function(){return this._subMeshCount}),__getset(0,__proto,"boundingBox",function(){return this._boundingBox}),__getset(0,__proto,"boundingBoxCorners",function(){return this._boundingBoxCorners}),__getset(0,__proto,"boundingSphere",function(){return this._boundingSphere}),BaseMesh}(),MeshFilter=(function(){function Script(){Script.__super.call(this)}__class(Script,"laya.d3.component.Script",Component3D);var __proto=Script.prototype;__proto.onTriggerEnter=function(other){},__proto.onTriggerExit=function(other){},__proto.onTriggerStay=function(other){},__getset(0,__proto,"isSingleton",function(){return Script._isSingleton}),Script._isSingleton=!1}(),function(_super){function MeshFilter(owner){this._owner=null,this._sharedMesh=null,MeshFilter.__super.call(this),this._owner=owner}__class(MeshFilter,"laya.d3.core.MeshFilter",_super);var __proto=MeshFilter.prototype;return __proto._sharedMeshLoaded=function(){this.event("loaded")},__proto._destroy=function(){_super.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},__getset(0,__proto,"sharedMesh",function(){return this._sharedMesh},function(value){var lastValue=this._sharedMesh;lastValue&&lastValue._removeReference(),(this._sharedMesh=value)._addReference(),this.event("meshchanged",[this,lastValue,value]),value.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),__getset(0,__proto,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),__getset(0,__proto,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),__getset(0,__proto,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),__getset(0,__proto,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),MeshFilter}(GeometryFilter)),MeshRender=function(){function MeshRender(owner){MeshRender.__super.call(this,owner),owner.meshFilter.on("meshchanged",this,this._onMeshChanged)}__class(MeshRender,"laya.d3.core.MeshRender",BaseRender);var __proto=MeshRender.prototype;return __proto._onMeshChanged=function(meshFilter,oldMesh,mesh){mesh.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:mesh.once("loaded",this,this._onMeshLoaed)},__proto._onMeshLoaed=function(sender,enable){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},__proto._calculateBoundingSphereByInitSphere=function(boundSphere){var maxScale=NaN,transform=this._owner.transform,scaleE=transform.scale.elements,scaleX=Math.abs(scaleE[0]),scaleY=Math.abs(scaleE[1]),scaleE=Math.abs(scaleE[2]),maxScale=scaleY<=scaleX&&scaleE<=scaleX?scaleX:scaleE<=scaleY?scaleY:scaleE;Vector3.transformCoordinate(boundSphere.center,transform.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=boundSphere.radius*maxScale},__proto._calculateBoundBoxByInitCorners=function(corners){for(var worldMat=this._owner.transform.worldMatrix,i=0;i<8;i++)Vector3.transformCoordinate(corners[i],worldMat,BaseRender._tempBoundBoxCorners[i]);BoundBox.createfromPoints(BaseRender._tempBoundBoxCorners,this._boundingBox)},__proto._calculateBoundingSphere=function(){var sharedMesh=this._owner.meshFilter.sharedMesh;null==sharedMesh||null==sharedMesh.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(sharedMesh.boundingSphere)},__proto._calculateBoundingBox=function(){var sharedMesh=this._owner.meshFilter.sharedMesh;null==sharedMesh||null==sharedMesh.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(sharedMesh.boundingBoxCorners)},__proto._renderUpdate=function(projectionView){var transform=this._owner.transform;return transform?(this._setShaderValueMatrix4x4(0,transform.worldMatrix),transform=this._owner.getProjectionViewWorldMatrix(projectionView),this._setShaderValueMatrix4x4(1,transform)):(this._setShaderValueMatrix4x4(0,Matrix4x4.DEFAULT),this._setShaderValueMatrix4x4(1,projectionView)),Laya3D.debugMode&&this._renderRenderableBoundBox(),!0},MeshRender}(),Scene=function(_super){function Scene(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,Scene.__super.call(this),this._renderState=new RenderState,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new ValusArray,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new DynamicBatchManager,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new Vector3(.7,.7,.7),this.ambientColor=new Vector3(.212,.227,.259),WebGL.shaderHighPrecision&&this.addShaderDefine(ShaderCompile3D.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}__class(Scene,"laya.d3.core.scene.Scene",_super);var __proto=Scene.prototype;return Laya.imps(__proto,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),__proto._setUrl=function(url){this._url=url},__proto._getGroup=function(){return this._group},__proto._setGroup=function(value){this._group=value},__proto._display=function(){Laya.stage._scenes.push(this),Laya.stage._scenes.sort(Scene._sortScenes);for(var i=0,n=this._childs.length;i<n;i++){var spr=this._childs[i];spr.active&&spr._activeHierarchy()}},__proto._unDisplay=function(){var scenes=Laya.stage._scenes;scenes.splice(scenes.indexOf(this),1);for(var i=0,n=this._childs.length;i<n;i++){var spr=this._childs[i];spr.active&&spr._inActiveHierarchy()}},__proto._addChild3D=function(sprite3D){sprite3D.transform._onWorldTransform(),sprite3D._setBelongScene(this),this.displayedInStage&&sprite3D.active&&sprite3D._activeHierarchy()},__proto._removeChild3D=function(sprite3D){sprite3D.transform.parent=null,this.displayedInStage&&sprite3D.active&&sprite3D._inActiveHierarchy(),sprite3D._setUnBelongScene()},__proto.initOctree=function(width,height,depth,center,level){void 0===level&&(level=6),this.treeSize=new Vector3(width,height,depth),this.treeLevel=level,this.treeRoot=new OctreeNode(this,0),this.treeRoot.init(center,this.treeSize)},__proto._prepareUpdateToRenderState=function(gl,state){state.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,state.scene=this},__proto._prepareSceneToRender=function(state){var lightCount=this._lights.length;if(0<lightCount)for(var renderLightCount=0,i=0;i<lightCount&&!(this._lights[i]._prepareToScene(state)&&++renderLightCount>=this._enableLightCount);i++);},__proto._updateChilds=function(state){for(var i=0,n=this._childs.length;i<n;++i)this._childs[i]._update(state)},__proto._preRenderScene=function(gl,state,boundFrustum){var iNum,view=state._viewMatrix,projection=state._projectionMatrix,projectionView=state._projectionViewMatrix,i=0,camera=state.camera;for(camera.useOcclusionCulling?this.treeRoot?FrustumCulling.renderObjectCullingOctree(boundFrustum,this,camera,view,projection,projectionView):FrustumCulling.renderObjectCulling(boundFrustum,this,camera,view,projection,projectionView):FrustumCulling.renderObjectCullingNoBoundFrustum(this,camera,view,projection,projectionView),i=0,iNum=this._quenes.length;i<iNum;i++)this._quenes[i]&&this._quenes[i]._preRender(state)},__proto._clear=function(gl,state){var viewport=state._viewport,camera=state.camera,vpX=viewport.x,vpY=camera.renderTargetSize.height-viewport.y-viewport.height,vpWidth=viewport.width,vpHeight=viewport.height,flag=(gl.viewport(vpX,vpY,vpWidth,vpHeight),256),renderTarget=camera.renderTarget;switch(camera.clearFlag){case 0:var clearColorE,clearColor=camera.clearColor;if(clearColor&&(gl.enable(3089),gl.scissor(vpX,vpY,vpWidth,vpHeight),clearColorE=clearColor.elements,gl.clearColor(clearColorE[0],clearColorE[1],clearColorE[2],clearColorE[3]),flag|=16384),renderTarget)switch(clearColor||(flag=16384),renderTarget.depthStencilFormat){case 33189:flag|=256;break;case 36168:flag|=1024;break;case 34041:flag=flag|256|1024}gl.clear(flag),clearColor&&gl.disable(3089);break;case 1:case 2:if(renderTarget)switch(flag=16384,renderTarget.depthStencilFormat){case 33189:flag|=256;break;case 36168:flag|=1024;break;case 34041:flag=flag|256|1024}gl.clear(flag);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},__proto._renderScene=function(gl,state){for(var n,queue,sky,camera=state.camera,i=0,i=0;i<2;i++)(queue=this._quenes[i])&&(camera.renderTarget?queue._render(state,!0):queue._render(state,!1));for(1===camera.clearFlag&&(sky=camera.sky)&&(WebGLContext.setCullFace(gl,!1),WebGLContext.setDepthFunc(gl,515),WebGLContext.setDepthMask(gl,!1),sky._render(state),WebGLContext.setDepthFunc(gl,513),WebGLContext.setDepthMask(gl,!0)),i=2,n=this._quenes.length;i<n;i++)(queue=this._quenes[i])&&(queue._sortAlpha(state.camera.transform.position),camera.renderTarget?queue._render(state,!0):queue._render(state,!1))},__proto._set3DRenderConfig=function(gl){gl.disable(3042),WebGLContext._blend=!1,gl.blendFunc(770,771),WebGLContext._sFactor=770,WebGLContext._dFactor=771,gl.disable(2929),WebGLContext._depthTest=!1,gl.enable(2884),WebGLContext._cullFace=!0,gl.depthMask(1),WebGLContext._depthMask=!0,gl.frontFace(2304),WebGLContext._frontFace=2304},__proto._set2DRenderConfig=function(gl){WebGLContext.setBlend(gl,!0),WebGLContext.setBlendFunc(gl,1,771),WebGLContext.setDepthTest(gl,!1),WebGLContext.setCullFace(gl,!1),WebGLContext.setDepthMask(gl,!0),WebGLContext.setFrontFace(gl,2305),gl.viewport(0,0,RenderState2D.width,RenderState2D.height)},__proto._parseCustomProps=function(rootNode,innerResouMap,customProps,nodeData){var lightMapsData=nodeData.customProps.lightmaps,lightMapCount=lightMapsData.length,lightmaps=this._lightmaps;lightmaps.length=lightMapCount;for(var i=0;i<lightMapCount;i++)lightmaps[i]=Loader.getRes(innerResouMap[lightMapsData[i].replace(".exr",".png")]);this.setlightmaps(lightmaps);var ambientColorData=nodeData.customProps.ambientColor,ambientColorData=(ambientColorData&&(this.ambientColor=new Vector3(ambientColorData[0],ambientColorData[1],ambientColorData[2])),nodeData.customProps.fogColor);ambientColorData&&(this.fogColor=new Vector3(ambientColorData[0],ambientColorData[1],ambientColorData[2]))},__proto._addLight=function(light){this._lights.indexOf(light)<0&&this._lights.push(light)},__proto._removeLight=function(light){light=this._lights.indexOf(light);0<=light&&this._lights.splice(light,1)},__proto._updateScene=function(){var renderState=this._renderState;this._prepareUpdateToRenderState(WebGL.mainContext,renderState),this._updateComponents(renderState),this._updateChilds(renderState),this._lateUpdateComponents(renderState),this._time+=renderState.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},__proto._updateSceneConch=function(){var renderState=this._renderState;this._prepareUpdateToRenderState(WebGL.mainContext,renderState),this._updateComponents(renderState),this._lateUpdateComponents(renderState),this._prepareSceneToRender(renderState);for(var i=0,n=this._cameraPool.length;i<n;i++){var camera=this._cameraPool[i];(renderState.camera=camera)._prepareCameraToRender()}},__proto._preRenderShadow=function(state,lightFrustum,shdowQueues,lightViewProjectMatrix,nPSSMNum){this.treeRoot?FrustumCulling.renderShadowObjectCullingOctree(this,lightFrustum,shdowQueues,lightViewProjectMatrix,nPSSMNum):FrustumCulling.renderShadowObjectCulling(this,lightFrustum,shdowQueues,lightViewProjectMatrix,nPSSMNum);for(var i=0,iNum=shdowQueues.length;i<iNum;i++)shdowQueues[i]&&shdowQueues[i]._preRender(state)},__proto._renderShadowMap=function(gl,state,sceneCamera){var renderTarget,shadowQuene,lightCamera,parallelSplitShadowMap=this.parallelSplitShadowMaps[0],pssmNum=(parallelSplitShadowMap._calcAllLightCameraInfo(sceneCamera),parallelSplitShadowMap.PSSMNum);if(this._preRenderShadow(state,parallelSplitShadowMap._lightCulling,parallelSplitShadowMap._shadowQuenes,parallelSplitShadowMap._lightVPMatrix[0],pssmNum),this.addShaderDefine(ParallelSplitShadowMap.SHADERDEFINE_CAST_SHADOW),1<pssmNum)for(var i=0;i<pssmNum;i++)renderTarget=parallelSplitShadowMap.getRenderTarget(i+1),parallelSplitShadowMap.beginRenderTarget(i+1),gl.clearColor(1,1,1,1),gl.clear(16640),gl.viewport(0,0,renderTarget.width,renderTarget.height),state.camera=lightCamera=parallelSplitShadowMap.getLightCamera(i),lightCamera._prepareCameraToRender(),lightCamera._prepareCameraViewProject(lightCamera.viewMatrix,lightCamera.projectionMatrix),state._projectionViewMatrix=parallelSplitShadowMap._lightVPMatrix[i+1],(shadowQuene=parallelSplitShadowMap._shadowQuenes[i])._preRender(state),shadowQuene._renderShadow(state,!1),parallelSplitShadowMap.endRenderTarget(i+1);else renderTarget=parallelSplitShadowMap.getRenderTarget(1),parallelSplitShadowMap.beginRenderTarget(1),gl.clearColor(1,1,1,1),gl.clear(16640),gl.viewport(0,0,renderTarget.width,renderTarget.height),state.camera=lightCamera=parallelSplitShadowMap.getLightCamera(0),lightCamera._prepareCameraToRender(),lightCamera._prepareCameraViewProject(lightCamera.viewMatrix,lightCamera.projectionMatrix),state._projectionViewMatrix=parallelSplitShadowMap._lightVPMatrix[0],(shadowQuene=parallelSplitShadowMap._shadowQuenes[0])._preRender(state),shadowQuene._renderShadow(state,!0),parallelSplitShadowMap.endRenderTarget(1);this.removeShaderDefine(ParallelSplitShadowMap.SHADERDEFINE_CAST_SHADOW)},__proto.addTreeNode=function(renderObj){this.treeRoot.addTreeNode(renderObj)},__proto.removeTreeNode=function(renderObj){this.treeSize&&renderObj._treeNode&&renderObj._treeNode.removeObject(renderObj)},__proto.setlightmaps=function(value){this._lightmaps=value;for(var i=0,n=this._renderableSprite3Ds.length;i<n;i++)this._renderableSprite3Ds[i]._render._applyLightMapParams()},__proto.getlightmaps=function(){return this._lightmaps},__proto.addChildAt=function(node,index){if(!(node instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!node||this.destroyed||node===this)return node;var oldIndex;if(node.zOrder&&this._set$P("hasZorder",!0),0<=index&&index<=this._childs.length)return node._parent===this?(oldIndex=this.getChildIndex(node),this._childs.splice(oldIndex,1),this._childs.splice(index,0,node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,index)),this._childChanged()):(node.parent&&node.parent.removeChild(node),this._childs===Node.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(index,0,node),this.conchModel&&this.conchModel.addChildAt(node.conchModel,index),(node.parent=this)._addChild3D(node)),node;throw new Error("appendChildAt:The index is out of bounds")},__proto.addChild=function(node){var index;if(node instanceof laya.d3.core.Sprite3D)return node&&!this.destroyed&&node!==this&&(node.zOrder&&this._set$P("hasZorder",!0),node._parent===this?(index=this.getChildIndex(node))!==this._childs.length-1&&(this._childs.splice(index,1),this._childs.push(node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,this._childs.length-1)),this._childChanged()):(node.parent&&node.parent.removeChild(node),this._childs===Node.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(node),this.conchModel&&this.conchModel.addChildAt(node.conchModel,this._childs.length-1),(node.parent=this)._childChanged(),this._addChild3D(node))),node;throw new Error("Sprite3D:Node type must Sprite3D.")},__proto.removeChildAt=function(index){var node=this.getChildAt(index);return node&&(this._removeChild3D(node),this._childs.splice(index,1),this.conchModel&&this.conchModel.removeChild(node.conchModel),node.parent=null),node},__proto.removeChildren=function(beginIndex,endIndex){if(void 0===beginIndex&&(beginIndex=0),void 0===endIndex&&(endIndex=2147483647),this._childs&&0<this._childs.length){var arr,childs=this._childs;0===beginIndex&&n<=endIndex?(arr=childs,this._childs=Node.ARRAY_EMPTY):arr=childs.splice(beginIndex,endIndex-beginIndex);for(var i=0,n=arr.length;i<n;i++)this._removeChild3D(arr[i]),arr[i].parent=null,this.conchModel&&this.conchModel.removeChild(arr[i].conchModel)}return this},__proto.addFrustumCullingObject=function(renderObject){this.treeRoot?this.addTreeNode(renderObject):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(renderObject):this._cullingRenders[this._cullingRendersLength]=renderObject,renderObject._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},__proto.removeFrustumCullingObject=function(renderObject){var indexInSceneFrustumCullingObjects,endRender;this.treeRoot?this.removeTreeNode(renderObject):(this._cullingRendersLength--,(indexInSceneFrustumCullingObjects=renderObject._indexInSceneFrustumCullingObjects)!==this._cullingRendersLength&&(endRender=this._cullingRenders[this._cullingRendersLength],(this._cullingRenders[indexInSceneFrustumCullingObjects]=endRender)._indexInSceneFrustumCullingObjects=indexInSceneFrustumCullingObjects,renderObject._indexInSceneFrustumCullingObjects=-1))},__proto.getRenderQueue=function(index){return index<3e3?this._quenes[1]||(this._quenes[1]=new RenderQueue(this)):this._quenes[2]||(this._quenes[2]=new RenderQueue(this))},__proto.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new RenderQueue(this)},__proto.addShaderDefine=function(define){this._shaderDefineValue|=define},__proto.removeShaderDefine=function(define){this._shaderDefineValue&=~define},__proto.addScript=function(type){return this._addComponent(type)},__proto.getScriptByType=function(type,typeIndex){return this._getComponentByType(type,typeIndex=void 0===typeIndex?0:typeIndex)},__proto.getScriptsByType=function(type,scripts){this._getComponentsByType(type,scripts)},__proto.getScriptByIndex=function(index){return this._getComponentByIndex(index)},__proto.removeScriptByType=function(type,typeIndex){this._removeComponentByType(type,typeIndex=void 0===typeIndex?0:typeIndex)},__proto.removeScriptsByType=function(type){this._removeComponentByType(type)},__proto.removeAllScript=function(){this._removeAllComponent()},__proto.render=function(context,x,y){(Render._context.ctx._renderKey=0)<this._childs.length&&context.addRenderObject(this)},__proto.renderSubmit=function(){var camera,gl=WebGL.mainContext,renderState=this._renderState,i=(this._set3DRenderConfig(gl),this._prepareSceneToRender(this._renderState),0),n=0;if(Laya3D.debugMode||OctreeNode.debugMode)for(i=0,n=this._cameraPool.length;i<n;i++)camera=this._cameraPool[i],Laya3D._debugPhasorSprite.begin(1,camera),camera.activeInHierarchy&&camera._renderCamera(gl,renderState,this),Laya3D._debugPhasorSprite.end();else for(i=0,n=this._cameraPool.length;i<n;i++)(camera=this._cameraPool[i]).activeInHierarchy&&camera._renderCamera(gl,renderState,this);return this._set2DRenderConfig(gl),1},__proto.onAsynLoaded=function(url,data,params){var json=data[0];if("Scene"!==json.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");data=data[1];Utils3D._createNodeByJson(this,json,this,data),this.event("hierarchyloaded",[this]),this.__loaded=!0},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this.destroyed||(_super.prototype.destroy.call(this,destroyChild),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,Loader.clearRes(this.url),this.loaded)||Laya3D._cancelLoadByUrl(this.url)},__proto.getRenderType=function(){return 0},__proto.releaseRender=function(){},__proto._addComponent=function(type){var typeComponentIndex,index=this._componentsMap.indexOf(type);if(-1===index)typeComponentIndex=[],this._componentsMap.push(type),this._typeComponentsIndices.push(typeComponentIndex);else if(typeComponentIndex=this._typeComponentsIndices[index],this._components[typeComponentIndex[0]].isSingleton)throw new Error("无法单实例创建"+type+"组件，"+type+"组件已存在！");index=ClassUtils.getInstance(type);typeComponentIndex.push(this._components.length),this._components.push(index);return index._initialize(this),index},__proto._removeComponent=function(mapIndex,index){var componentIndices=this._typeComponentsIndices[mapIndex],componentIndex=componentIndices[index],component=this._components[componentIndex];this._components.splice(componentIndex,1),componentIndices.splice(index,1),0===componentIndices.length&&(this._typeComponentsIndices.splice(mapIndex,1),this._componentsMap.splice(mapIndex,1));for(var i=0,n=this._componentsMap.length;i<n;i++)for(var j=(componentIndices=this._typeComponentsIndices[i]).length-1;0<=j;j--){var oldComponentIndex=componentIndices[j];if(!(componentIndex<oldComponentIndex))break;componentIndices[j]=--oldComponentIndex}component._destroy()},__proto._getComponentByType=function(type,typeIndex){void 0===typeIndex&&(typeIndex=0);type=this._componentsMap.indexOf(type);return-1===type?null:this._components[this._typeComponentsIndices[type][typeIndex]]},__proto._getComponentsByType=function(type,components){type=this._componentsMap.indexOf(type);if(-1===type)components.length=0;else{var typeComponents=this._typeComponentsIndices[type],count=typeComponents.length;components.length=count;for(var i=0;i<count;i++)components[i]=this._components[typeComponents[i]]}},__proto._getComponentByIndex=function(index){return this._components[index]},__proto._removeComponentByType=function(type,typeIndex){void 0===typeIndex&&(typeIndex=0);type=this._componentsMap.indexOf(type);-1!==type&&this._removeComponent(type,typeIndex)},__proto._removeComponentsByType=function(type){var mapIndex=this._componentsMap.indexOf(type);if(-1!==mapIndex)for(var componentIndices=this._typeComponentsIndices[mapIndex],i=0,n=componentIndices.length;i<n;componentIndices.length<n?n--:i++)this._removeComponent(mapIndex,i)},__proto._removeAllComponent=function(){for(var i=0,n=this._componentsMap.length;i<n;this._componentsMap.length<n?n--:i++)this._removeComponentsByType(this._componentsMap[i])},__proto._updateComponents=function(state){for(var i=0,n=this._components.length;i<n;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._update(state)}},__proto._lateUpdateComponents=function(state){for(var i=0;i<this._components.length;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._lateUpdate(state)}},__proto._preRenderUpdateComponents=function(state){for(var i=0;i<this._components.length;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._preRenderUpdate(state)}},__proto._postRenderUpdateComponents=function(state){for(var i=0;i<this._components.length;i++){var component=this._components[i];component.started||(component._start(state),component.started=!0),component.enable&&component._postRenderUpdate(state)}},__getset(0,__proto,"_loaded",null,function(value){this.__loaded=value}),__getset(0,__proto,"fogColor",function(){return this._fogColor},function(value){this._fogColor=value,this._shaderValues.setValue(0,value.elements)}),__getset(0,__proto,"enableFog",function(){return this._enableFog},function(value){this._enableFog!==value&&((this._enableFog=value)?(this.addShaderDefine(ShaderCompile3D.SHADERDEFINE_FOG),this.removeShaderDefine(ShaderCompile3D.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(ShaderCompile3D.SHADERDEFINE_FOG))}),__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"loaded",function(){return this.__loaded}),__getset(0,__proto,"enableDepthFog",function(){return this._enableDepthFog},function(v){this._enableDepthFog!=v&&((this._enableDepthFog=v)?(this.addShaderDefine(ShaderCompile3D.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(ShaderCompile3D.SHADERDEFINE_FOG)):this.removeShaderDefine(ShaderCompile3D.SAHDERDEFINE_DEPTHFOG))}),__getset(0,__proto,"fogStart",function(){return this._fogStart},function(value){this._fogStart=value,this._shaderValues.setValue(1,value)}),__getset(0,__proto,"fogRange",function(){return this._fogRange},function(value){this._fogRange=value,this._shaderValues.setValue(2,value)}),__getset(0,__proto,"ambientColor",function(){return this._ambientColor},function(value){this._ambientColor=value,this._shaderValues.setValue(21,value.elements)}),__getset(0,__proto,"scene",function(){return this}),__getset(0,__proto,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),Scene._sortScenes=function(a,b){var stageChildren;return a.parent===Laya.stage&&b.parent===Laya.stage?(stageChildren=Laya.stage._childs).indexOf(a)-stageChildren.indexOf(b):a.parent!==Laya.stage&&b.parent!==Laya.stage?Scene._sortScenes(a.parent,b.parent):a.parent===Laya.stage?-1:1},Scene.load=function(url){return Laya.loader.create(url,null,null,Scene)},Scene.FOGCOLOR=0,Scene.FOGSTART=1,Scene.FOGRANGE=2,Scene.LIGHTDIRECTION=3,Scene.LIGHTDIRCOLOR=4,Scene.POINTLIGHTPOS=5,Scene.POINTLIGHTRANGE=6,Scene.POINTLIGHTATTENUATION=7,Scene.POINTLIGHTCOLOR=8,Scene.SPOTLIGHTPOS=9,Scene.SPOTLIGHTDIRECTION=10,Scene.SPOTLIGHTSPOT=11,Scene.SPOTLIGHTRANGE=12,Scene.SPOTLIGHTATTENUATION=13,Scene.SPOTLIGHTCOLOR=14,Scene.SHADOWDISTANCE=15,Scene.SHADOWLIGHTVIEWPROJECT=16,Scene.SHADOWMAPPCFOFFSET=17,Scene.SHADOWMAPTEXTURE1=18,Scene.SHADOWMAPTEXTURE2=19,Scene.SHADOWMAPTEXTURE3=20,Scene.AMBIENTCOLOR=21,Scene.TIME=22,Scene}(Sprite),Sprite3D=function(){function Sprite3D(name){Sprite3D.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new Matrix4x4,this._shaderValues=new ValusArray,this._colliders=[],this._id=++Sprite3D._uniqueIDCounter,this._transform=new Transform3D(this),this.name=name||"Sprite3D-"+Sprite3D._nameNumberCounter++,this.layer=Layer.currentCreationLayer,this.active=!0}__class(Sprite3D,"laya.d3.core.Sprite3D",ComponentNode);var __proto=Sprite3D.prototype;return Laya.imps(__proto,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),__proto._setUrl=function(url){this._url=url},__proto._getGroup=function(){return this._group},__proto._setGroup=function(value){this._group=value},__proto._addChild3D=function(sprite3D){sprite3D.transform.parent=this.transform,this._hierarchyAnimator&&(sprite3D._hierarchyAnimator||sprite3D._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(sprite3D,!0,[sprite3D.name])),this._scene&&(sprite3D._setBelongScene(this._scene),this._activeInHierarchy)&&sprite3D._active&&sprite3D._activeHierarchy()},__proto._removeChild3D=function(sprite3D){sprite3D.transform.parent=null,this._scene&&(this._activeInHierarchy&&sprite3D._active&&sprite3D._inActiveHierarchy(),sprite3D._setUnBelongScene()),this._hierarchyAnimator&&(sprite3D._hierarchyAnimator==this._hierarchyAnimator&&sprite3D._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(sprite3D,!1,[sprite3D.name]))},__proto._parseBaseCustomProps=function(customProps){var loccalPosition=this.transform.localPosition,loccalPosition=(customProps.translate?(loccalPosition.fromArray(customProps.translate),loccalPosition.x*=100,loccalPosition.y*=100,loccalPosition.z*=100):loccalPosition.elements.fill(0),this.transform.localPosition=loccalPosition,this.transform.localRotation),loccalPosition=(customProps.rotation?loccalPosition.fromArray(customProps.rotation):loccalPosition.fromArray([0,0,0,-1]),this.transform.localRotation=loccalPosition,this.transform.localScale),loccalPosition=(customProps.scale?loccalPosition.fromArray(customProps.scale):loccalPosition.elements.fill(1),this.transform.localScale=loccalPosition,customProps.layer);null!=loccalPosition&&(this.layer=Layer.getLayerByNumber(loccalPosition))},__proto._parseCustomComponent=function(rootNode,innerResouMap,componentsData){for(var k in componentsData){var component=componentsData[k];switch(k){case"Animator":for(var animator=this.addComponent(Animator),clipPaths=(component.avatarPath?animator.avatar=Loader.getRes(innerResouMap[component.avatarPath]):(avatarData=component.avatar)&&(animator.avatar=Loader.getRes(innerResouMap[avatarData.path]),avatarData=avatarData.linkSprites)&&rootNode.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[animator,avatarData]),component.clipPaths),clipCount=clipPaths.length,i=0;i<clipCount;i++)animator.addClip(Loader.getRes(innerResouMap[clipPaths[i]]));animator.clip=Loader.getRes(innerResouMap[clipPaths[0]]);var avatarData=component.playOnWake;void 0!==avatarData&&(animator.playOnWake=avatarData);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var sphereCollider=this.addComponent(SphereCollider),center=(sphereCollider.isTrigger=component.isTrigger,sphereCollider.center);center.fromArray(component.center),sphereCollider.center=center,sphereCollider.radius=component.radius;break;case"BoxCollider":center=this.addComponent(BoxCollider),sphereCollider=(center.isTrigger=component.isTrigger,center.center.fromArray(component.center),center.size);sphereCollider.fromArray(component.size),center.size=sphereCollider;break;case"MeshCollider":this.addComponent(MeshCollider)}}},__proto._onRootNodeHierarchyLoaded=function(animator,linkSprites){for(var k in linkSprites){for(var nodeOwner=this,path=linkSprites[k],j=0,m=path.length;j<m;j++){var p=path[j];if(""===p)break;if(!(nodeOwner=nodeOwner.getChildByName(p)))break}nodeOwner&&animator.linkSprite3DToAvatarNode(k,nodeOwner)}},__proto._setHierarchyAnimator=function(animator,parentAnimator){this._changeHierarchyAnimator(animator);for(var i=0,n=this._childs.length;i<n;i++){var child=this._childs[i];child._hierarchyAnimator==parentAnimator&&child._setHierarchyAnimator(animator,parentAnimator)}},__proto._clearHierarchyAnimator=function(animator,parentAnimator){this._changeHierarchyAnimator(parentAnimator);for(var i=0,n=this._childs.length;i<n;i++){var child=this._childs[i];child._hierarchyAnimator==animator&&child._clearHierarchyAnimator(animator,parentAnimator)}},__proto._getAnimatorToLinkSprite3D=function(sprite3D,isLink,path){var animator=this.getComponentByType(Animator);animator&&(animator.avatar?animator.avatar._version||sprite3D._setAnimatorToLinkAvatar(animator,isLink):sprite3D._setAnimatorToLinkSprite3DNoAvatar(animator,isLink,path)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D&&(path.unshift(this._parent.name),(animator=this._parent)._hierarchyAnimator)&&animator._getAnimatorToLinkSprite3D(sprite3D,isLink,path)},__proto._setAnimatorToLinkSprite3DNoAvatar=function(animator,isLink,path){for(var i=0,n=0,i=0,n=animator.getClipCount();i<n;i++)animator._handleSpriteOwnersBySprite(i,isLink,path,this);for(i=0,n=this._childs.length;i<n;i++){var child=this._childs[i],index=path.length;path.push(child.name),child._setAnimatorToLinkSprite3DNoAvatar(animator,isLink,path),path.splice(index,1)}},__proto._changeHierarchyAnimator=function(animator){this._hierarchyAnimator=animator},__proto._isLinkSpriteToAnimationNode=function(animator,node,isLink){var nodeIndex=animator._avatarNodes.indexOf(node),cacheSpriteToNodesMap=animator._cacheSpriteToNodesMap;isLink?(this._transform.dummy=node.transform,animator._cacheNodesToSpriteMap[nodeIndex]=cacheSpriteToNodesMap.length,cacheSpriteToNodesMap.push(nodeIndex)):(this._transform.dummy=null,isLink=animator._cacheNodesToSpriteMap[nodeIndex],animator._cacheNodesToSpriteMap[nodeIndex]=null,cacheSpriteToNodesMap.splice(isLink,1))},__proto._setBelongScene=function(scene){this._scene=scene;for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._setBelongScene(scene)},__proto._setUnBelongScene=function(){this._scene=null;for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._setUnBelongScene()},__proto._activeHierarchy=function(){var i=0,n=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),i=0,n=this._colliders.length;i<n;i++)this._layer._addCollider(this._colliders[i]);for(this.event("activeinhierarchychanged",!0),i=0,n=this._childs.length;i<n;i++){var child=this._childs[i];child._active&&child._activeHierarchy()}},__proto._inActiveHierarchy=function(){var i=0,n=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),i=0,n=this._colliders.length;i<n;i++){var col=this._colliders[i];col._clearCollsionMap(),this._layer._removeCollider(col)}for(this.event("activeinhierarchychanged",!1),i=0,n=this._childs.length;i<n;i++){var child=this._childs[i];child._active&&child._inActiveHierarchy()}},__proto.addComponent=function(type){var typeComponentIndex,index=this._componentsMap.indexOf(type);if(-1===index)typeComponentIndex=[],this._componentsMap.push(type),this._typeComponentsIndices.push(typeComponentIndex);else if(typeComponentIndex=this._typeComponentsIndices[index],this._components[typeComponentIndex[0]].isSingleton)throw new Error("无法单实例创建"+type+"组件，"+type+"组件已存在！");index=ClassUtils.getInstance(type);if(typeComponentIndex.push(this._components.length),this._components.push(index),index instanceof laya.d3.component.physics.Collider)this.getComponentByType(Rigidbody)&&(index._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(index),this._colliders.push(index);else if(index instanceof laya.d3.component.Animator){type=index;this._setHierarchyAnimator(type,this._parent?this._parent._hierarchyAnimator:null),this._setAnimatorToLinkSprite3DNoAvatar(type,!0,[])}else if(index instanceof laya.d3.component.Rigidbody)for(var i=0,n=this._colliders.length;i<n;i++)this._colliders[i]._setIsRigidbody(!0);return index instanceof laya.d3.component.Script&&this._scripts.push(index),index._initialize(this),index},__proto._removeComponent=function(mapIndex,index){var i=0,n=0,componentIndices=this._typeComponentsIndices[mapIndex],componentIndex=componentIndices[index],component=this._components[componentIndex];if(component instanceof laya.d3.component.physics.Collider){var colliderComponent=component;this._activeInHierarchy&&this._layer._removeCollider(colliderComponent),this._colliders.splice(this._colliders.indexOf(colliderComponent),1)}else if(component instanceof laya.d3.component.Animator)this._clearHierarchyAnimator(component,this._parent?this._parent._hierarchyAnimator:null);else if(component instanceof laya.d3.component.Rigidbody)for(i=0,n=this._colliders.length;i<n;i++){var k,collider=this._colliders[i],runtimeCollisonMap=(collider._setIsRigidbody(!1),collider._runtimeCollisonMap),runtimeCollisonTestMap=collider._runtimeCollisonTestMap;for(k in runtimeCollisonMap)delete runtimeCollisonTestMap[k]}for(this._components.splice(componentIndex,1),component instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(component),1),componentIndices.splice(index,1),0===componentIndices.length&&(this._typeComponentsIndices.splice(mapIndex,1),this._componentsMap.splice(mapIndex,1)),i=0,n=this._componentsMap.length;i<n;i++)for(var j=(componentIndices=this._typeComponentsIndices[i]).length-1;0<=j;j--){var oldComponentIndex=componentIndices[j];if(!(componentIndex<oldComponentIndex))break;componentIndices[j]=--oldComponentIndex}component._destroy()},__proto._clearSelfRenderObjects=function(){},__proto._addSelfRenderObjects=function(){},__proto._parseCustomProps=function(rootNode,innerResouMap,customProps,nodeData){},__proto._updateChilds=function(state){var n=this._childs.length;if(0!==n)for(var i=0;i<n;++i)this._childs[i]._update(state)},__proto._getSortID=function(renderElement,material){return 1e3*material.id+renderElement._getVertexBuffer().vertexDeclaration.id},__proto._update=function(state){(state.owner=this)._activeInHierarchy&&(this._updateComponents(state),this._lateUpdateComponents(state),Stat.spriteCount++,this._childs.length)&&this._updateChilds(state)},__proto.getProjectionViewWorldMatrix=function(projectionViewMatrix){return Matrix4x4.multiply(projectionViewMatrix,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},__proto.loadHierarchy=function(url){this.addChild(laya.d3.core.Sprite3D.load(url))},__proto.addChildAt=function(node,index){if(!(node instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!node||this.destroyed||node===this)return node;var oldIndex;if(node.zOrder&&this._set$P("hasZorder",!0),0<=index&&index<=this._childs.length)return node._parent===this?(oldIndex=this.getChildIndex(node),this._childs.splice(oldIndex,1),this._childs.splice(index,0,node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,index)),this._childChanged()):(node.parent&&node.parent.removeChild(node),this._childs===Node.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(index,0,node),this.conchModel&&this.conchModel.addChildAt(node.conchModel,index),(node.parent=this)._addChild3D(node)),node;throw new Error("appendChildAt:The index is out of bounds")},__proto.addChild=function(node){var index;if(node instanceof laya.d3.core.Sprite3D)return node&&!this.destroyed&&node!==this&&(node.zOrder&&this._set$P("hasZorder",!0),node._parent===this?(index=this.getChildIndex(node))!==this._childs.length-1&&(this._childs.splice(index,1),this._childs.push(node),this.conchModel&&(this.conchModel.removeChild(node.conchModel),this.conchModel.addChildAt(node.conchModel,this._childs.length-1)),this._childChanged()):(node.parent&&node.parent.removeChild(node),this._childs===Node.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(node),this.conchModel&&this.conchModel.addChildAt(node.conchModel,this._childs.length-1),(node.parent=this)._childChanged(),this._addChild3D(node))),node;throw new Error("Sprite3D:Node type must Sprite3D.")},__proto.removeChildAt=function(index){var node=this.getChildAt(index);return node&&(this._removeChild3D(node),this._childs.splice(index,1),this.conchModel&&this.conchModel.removeChild(node.conchModel),node.parent=null),node},__proto.removeChildren=function(beginIndex,endIndex){if(void 0===beginIndex&&(beginIndex=0),void 0===endIndex&&(endIndex=2147483647),this._childs&&0<this._childs.length){var arr,childs=this._childs;0===beginIndex&&n<=endIndex?(arr=childs,this._childs=Node.ARRAY_EMPTY):arr=childs.splice(beginIndex,endIndex-beginIndex);for(var i=0,n=arr.length;i<n;i++)this._removeChild3D(arr[i]),arr[i].parent=null,this.conchModel&&this.conchModel.removeChild(arr[i].conchModel)}return this},__proto.onAsynLoaded=function(url,data,params){var json=data[0];if("Sprite3D"!==json.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");data=data[1];Utils3D._createNodeByJson(this,json,this,data),this.event("hierarchyloaded",[this]),this.__loaded=!0},__proto.cloneTo=function(destObject){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");for(var destSprite3D=destObject,destObject=(destSprite3D.name=this.name,destSprite3D._destroyed=this._destroyed,destSprite3D.timer=this.timer,destSprite3D._$P=this._$P,destSprite3D.active=this._active,destSprite3D.transform.localPosition),destObject=(this.transform.localPosition.cloneTo(destObject),destSprite3D.transform.localPosition=destObject,destSprite3D.transform.localRotation),destObject=(this.transform.localRotation.cloneTo(destObject),destSprite3D.transform.localRotation=destObject,destSprite3D.transform.localScale),i=(this.transform.localScale.cloneTo(destObject),destSprite3D.transform.localScale=destObject,destSprite3D.isStatic=this.isStatic,0),n=0,i=0,n=this._componentsMap.length;i<n;i++){var destComponent=destSprite3D.addComponent(this._componentsMap[i]);this._components[i]._cloneTo(destComponent)}for(i=0,n=this._childs.length;i<n;i++)destSprite3D.addChild(this._childs[i].clone());var destAnimator=destSprite3D.getComponentByType(Animator);if(destAnimator){var destLinkSpritesData=destAnimator._linkSpritesData;if(destLinkSpritesData)for(var k in destLinkSpritesData){for(var path=destLinkSpritesData[k],sp=destSprite3D,j=0,m=path.length;j<m&&(sp=sp.getChildByName(path[j]));j++);sp&&(k=destAnimator._avatarNodeMap[k],sp._isLinkSpriteToAnimationNode(destAnimator,k,!0))}}},__proto.clone=function(){var destSprite3D=new this.constructor;return this.cloneTo(destSprite3D),destSprite3D},__proto.destroy=function(destroyChild){if(void 0===destroyChild&&(destroyChild=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,destroyChild);for(var i=0,i=0,n=this._components.length;i<n;i++)this._components[i]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,Loader.clearRes(this.url),this.loaded||Laya3D._cancelLoadByUrl(this.url)}},__proto._handleSpriteToAvatar=function(animator,isLink){animator._avatarNodes;var node=animator._avatarNodeMap[this.name];node&&node.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(animator,node,isLink)},__proto._setAnimatorToLinkAvatar=function(animator,isLink){this._handleSpriteToAvatar(animator,isLink);for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._setAnimatorToLinkAvatar(animator,isLink)},__getset(0,__proto,"activeInHierarchy",function(){return this._activeInHierarchy}),__getset(0,__proto,"_loaded",null,function(value){this.__loaded=value}),__getset(0,__proto,"active",function(){return this._active},function(value){this._active!==value&&(this._active=value,this._parent)&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(value?this._activeHierarchy():this._inActiveHierarchy())}),__getset(0,__proto,"componentsCount",function(){return this._components.length}),__getset(0,__proto,"loaded",function(){return this.__loaded}),__getset(0,__proto,"id",function(){return this._id}),__getset(0,__proto,"url",function(){return this._url}),__getset(0,__proto,"layer",function(){return this._layer},function(value){if(this._layer!==value){if(!value)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var i=0,n=this._colliders.length;if(this._layer)for(i=0;i<n;i++)this._layer._removeCollider(this._colliders[i]);for(i=0;i<n;i++)value._addCollider(this._colliders[i])}this._layer=value,this.event("layerchanged",value)}}),__getset(0,__proto,"scene",function(){return this._scene}),__getset(0,__proto,"transform",function(){return this._transform}),Sprite3D.instantiate=function(original,parent,worldPositionStays,position,rotation){void 0===worldPositionStays&&(worldPositionStays=!0);var destSprite3D=original.clone(),parent=(parent&&parent.addChild(destSprite3D),destSprite3D.transform);return worldPositionStays?(worldPositionStays=parent.worldMatrix,original.transform.worldMatrix.cloneTo(worldPositionStays),parent.worldMatrix=worldPositionStays):(position&&(parent.position=position),rotation&&(parent.rotation=rotation)),destSprite3D},Sprite3D.load=function(url){return Laya.loader.create(url,null,null,Sprite3D)},Sprite3D.WORLDMATRIX=0,Sprite3D.MVPMATRIX=1,Sprite3D._uniqueIDCounter=0,Sprite3D._nameNumberCounter=0,Sprite3D}(),Shader3D=function(){function Shader3D(vs,ps,attributeMap,sceneUniformMap,cameraUniformMap,spriteUniformMap,materialUniformMap,renderElementUniformMap){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],Shader3D.__super.call(this),!vs||!ps)throw"Shader Error";this._id=++Shader3D._count,this._vs=vs,this._ps=ps,this._attributeMap=attributeMap,this._sceneUniformMap=sceneUniformMap,this._cameraUniformMap=cameraUniformMap,this._spriteUniformMap=spriteUniformMap,this._materialUniformMap=materialUniformMap,this._renderElementUniformMap=renderElementUniformMap,this.recreateResource()}__class(Shader3D,"laya.d3.shader.Shader3D",BaseShader);var __proto=Shader3D.prototype;return __proto.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},__proto.disposeResource=function(){WebGL.mainContext.deleteShader(this._vshader),WebGL.mainContext.deleteShader(this._pshader),WebGL.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},__proto._compile=function(){if(this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var text=[this._vs,this._ps],gl=WebGL.mainContext;if(this._program=gl.createProgram(),this._vshader=Shader3D._createShader(gl,text[0],35633),this._pshader=Shader3D._createShader(gl,text[1],35632),gl.attachShader(this._program,this._vshader),gl.attachShader(this._program,this._pshader),gl.linkProgram(this._program),!Render.isConchApp&&ShaderCompile3D.debugMode&&!gl.getProgramParameter(this._program,35714))throw gl.getProgramInfoLog(this._program);for(var i=0,n=0,attribNum=0,attribNum=Render.isConchApp?gl.getProgramParameterEx(this._vs,this._ps,"",35721):gl.getProgramParameter(this._program,35721),i=0;i<attribNum;i++){var attrib=null,one={vartype:"attribute",ivartype:0,attrib:attrib=Render.isConchApp?gl.getActiveAttribEx(this._vs,this._ps,"",i):gl.getActiveAttrib(this._program,i),location:gl.getAttribLocation(this._program,attrib.name),name:attrib.name,type:attrib.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0};this._attributeParams.push(one)}var nUniformNum=0,nUniformNum=Render.isConchApp?gl.getProgramParameterEx(this._vs,this._ps,"",35718):gl.getProgramParameter(this._program,35718);for(i=0;i<nUniformNum;i++){var uniform=null,uniform=Render.isConchApp?gl.getActiveUniformEx(this._vs,this._ps,"",i):gl.getActiveUniform(this._program,i);0<(one={vartype:"uniform",ivartype:1,attrib:attrib,location:gl.getUniformLocation(this._program,uniform.name),name:uniform.name,type:uniform.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(one.name=one.name.substr(0,one.name.length-3),one.isArray=!0,one.location=gl.getUniformLocation(this._program,one.name)),this._uniformParams.push(one)}for(i=0,n=this._attributeParams.length;i<n;i++)(one=this._attributeParams[i]).indexOfParams=i,one.index=1,one.value=[one.location,null],one.codename=one.name,one.name=null!=this._attributeMap[one.codename]?this._attributeMap[one.codename]:one.codename,this._attributeParamsMap.push(one.name),this._attributeParamsMap.push(one),one._this=this,one.uploadedValue=[],one.fun=this._attribute;for(i=0,n=this._uniformParams.length;i<n;i++)switch((one=this._uniformParams[i]).indexOfParams=i,one.index=1,one.value=[one.location,null],one.codename=one.name,null!=this._sceneUniformMap[one.codename]?(one.name=this._sceneUniformMap[one.codename],this._sceneUniformParamsMap.push(one.name),this._sceneUniformParamsMap.push(one)):null!=this._cameraUniformMap[one.codename]?(one.name=this._cameraUniformMap[one.codename],this._cameraUniformParamsMap.push(one.name),this._cameraUniformParamsMap.push(one)):null!=this._spriteUniformMap[one.codename]?(one.name=this._spriteUniformMap[one.codename],this._spriteUniformParamsMap.push(one.name),this._spriteUniformParamsMap.push(one)):null!=this._materialUniformMap[one.codename]?(one.name=this._materialUniformMap[one.codename],this._materialUniformParamsMap.push(one.name),this._materialUniformParamsMap.push(one)):null!=this._renderElementUniformMap[one.codename]?(one.name=this._renderElementUniformMap[one.codename],this._renderElementUniformParamsMap.push(one.name),this._renderElementUniformParamsMap.push(one)):console.log("Shader:can't find uinform name:"+one.codename+" in shader file."),one._this=this,one.uploadedValue=[],one.type){case 5124:one.fun=one.isArray?this._uniform1iv:this._uniform1i;break;case 5126:one.fun=one.isArray?this._uniform1fv:this._uniform1f;break;case 35664:one.fun=one.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:one.fun=one.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:one.fun=one.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:one.fun=this._uniform_sampler2D;break;case 35680:one.fun=this._uniform_samplerCube;break;case 35676:one.fun=this._uniformMatrix4fv;break;case 35670:one.fun=this._uniform1i;break;case 35674:one.fun=this._uinformMatrix2fv;break;case 35675:one.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},__proto._attribute=function(one,value){var gl=WebGL.mainContext,enableAtributes=Buffer._enableAtributes,one=one.location;return enableAtributes[one]||gl.enableVertexAttribArray(one),gl.vertexAttribPointer(one,value[0],value[1],value[2],value[3],value[4]),enableAtributes[one]=Buffer._bindVertexBuffer,1},__proto._uniform1f=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value?(WebGL.mainContext.uniform1f(one.location,uploadedValue[0]=value),1):0},__proto._uniform1fv=function(one,value){var uploadedValue;return value.length<4?(uploadedValue=one.uploadedValue)[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform1fv(one.location,value),uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3],1):0:(WebGL.mainContext.uniform1fv(one.location,value),1)},__proto._uniform_vec2=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]?(WebGL.mainContext.uniform2f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]),1):0},__proto._uniform_vec2v=function(one,value){var uploadedValue;return value.length<2?(uploadedValue=one.uploadedValue)[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform2fv(one.location,value),uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3],1):0:(WebGL.mainContext.uniform2fv(one.location,value),1)},__proto._uniform_vec3=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]?(WebGL.mainContext.uniform3f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]),1):0},__proto._uniform_vec3v=function(one,value){return WebGL.mainContext.uniform3fv(one.location,value),1},__proto._uniform_vec4=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform4f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]),1):0},__proto._uniform_vec4v=function(one,value){return WebGL.mainContext.uniform4fv(one.location,value),1},__proto._uniformMatrix2fv=function(one,value){return WebGL.mainContext.uniformMatrix2fv(one.location,!1,value),1},__proto._uniformMatrix3fv=function(one,value){return WebGL.mainContext.uniformMatrix3fv(one.location,!1,value),1},__proto._uniformMatrix4fv=function(one,value){return WebGL.mainContext.uniformMatrix4fv(one.location,!1,value),1},__proto._uinformMatrix2fv=function(one,value){return WebGL.mainContext.uniformMatrix2fv(one.location,!1,value),1},__proto._uinformMatrix3fv=function(one,value){return WebGL.mainContext.uniformMatrix3fv(one.location,!1,value),1},__proto._uniform1i=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value?(WebGL.mainContext.uniform1i(one.location,uploadedValue[0]=value),1):0},__proto._uniform1iv=function(one,value){return WebGL.mainContext.uniform1iv(one.location,value),1},__proto._uniform_ivec2=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]?(WebGL.mainContext.uniform2i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]),1):0},__proto._uniform_ivec2v=function(one,value){return WebGL.mainContext.uniform2iv(one.location,value),1},__proto._uniform_vec3i=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]?(WebGL.mainContext.uniform3i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]),1):0},__proto._uniform_vec3vi=function(one,value){return WebGL.mainContext.uniform3iv(one.location,value),1},__proto._uniform_vec4i=function(one,value){var uploadedValue=one.uploadedValue;return uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]?(WebGL.mainContext.uniform4i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]),1):0},__proto._uniform_vec4vi=function(one,value){return WebGL.mainContext.uniform4iv(one.location,value),1},__proto._uniform_sampler2D=function(one,texture){var texture=texture.source||texture.defaulteTexture.source,gl=WebGL.mainContext,uploadedValue=one.uploadedValue;if(null!=uploadedValue[0])return gl.activeTexture(Shader3D._TEXTURES[uploadedValue[0]]),texture&&WebGLContext.bindTexture(gl,3553,texture),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return uploadedValue[0]=this._curActTexIndex,gl.uniform1i(one.location,this._curActTexIndex),gl.activeTexture(Shader3D._TEXTURES[this._curActTexIndex]),texture&&WebGLContext.bindTexture(gl,3553,texture),this._curActTexIndex++,1},__proto._uniform_samplerCube=function(one,texture){var texture=texture.source||texture.defaulteTexture.source,gl=WebGL.mainContext,uploadedValue=one.uploadedValue;if(null!=uploadedValue[0])return gl.activeTexture(Shader3D._TEXTURES[uploadedValue[0]]),texture?WebGLContext.bindTexture(gl,34067,texture):WebGLContext.bindTexture(gl,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return uploadedValue[0]=this._curActTexIndex,gl.uniform1i(one.location,this._curActTexIndex),gl.activeTexture(Shader3D._TEXTURES[this._curActTexIndex]),texture?WebGLContext.bindTexture(gl,34067,texture):WebGLContext.bindTexture(gl,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},__proto._noSetValue=function(one){console.log("no....:"+one.name)},__proto.bind=function(){return BaseShader.activeShader=this,(BaseShader.bindShader=this).activeResource(),WebGLContext.UseProgram(this._program)},__proto.uploadAttributes=function(attributeShaderValue,_bufferUsage){for(var value,one,shaderCall=0,i=0,n=this._attributeParamsMap.length;i<n;i+=2)one=this._attributeParamsMap[i+1],null!=(value=attributeShaderValue[this._attributeParamsMap[i]])&&(_bufferUsage&&_bufferUsage[one.name]&&_bufferUsage[one.name].bind(),shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadAttributesX=function(attributeShaderValue,vb){for(var value,one,shaderCall=0,i=0,n=this._attributeParamsMap.length;i<n;i+=2)one=this._attributeParamsMap[i+1],null!=(value=attributeShaderValue[this._attributeParamsMap[i]])&&(vb._bind(),shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadSceneUniforms=function(shaderValue){for(var value,one,shaderCall=0,i=0,n=this._sceneUniformParamsMap.length;i<n;i+=2)one=this._sceneUniformParamsMap[i+1],null!=(value=shaderValue[this._sceneUniformParamsMap[i]])&&(shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadCameraUniforms=function(shaderValue){for(var value,one,shaderCall=0,i=0,n=this._cameraUniformParamsMap.length;i<n;i+=2)one=this._cameraUniformParamsMap[i+1],null!=(value=shaderValue[this._cameraUniformParamsMap[i]])&&(shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadSpriteUniforms=function(shaderValue){for(var value,one,shaderCall=0,i=0,n=this._spriteUniformParamsMap.length;i<n;i+=2)one=this._spriteUniformParamsMap[i+1],null!=(value=shaderValue[this._spriteUniformParamsMap[i]])&&(shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadMaterialUniforms=function(shaderValue){for(var value,one,shaderCall=0,i=0,n=this._materialUniformParamsMap.length;i<n;i+=2)one=this._materialUniformParamsMap[i+1],null!=(value=shaderValue[this._materialUniformParamsMap[i]])&&(shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},__proto.uploadRenderElementUniforms=function(shaderValue){for(var value,one,shaderCall=0,i=0,n=this._renderElementUniformParamsMap.length;i<n;i+=2)one=this._renderElementUniformParamsMap[i+1],null!=(value=shaderValue[this._renderElementUniformParamsMap[i]])&&(shaderCall+=one.fun.call(this,one,value));Stat.shaderCall+=shaderCall},Shader3D.create=function(vs,ps,attributeMap,sceneUniformMap,cameraUniformMap,spriteUniformMap,materialUniformMap,renderElementUniformMap){return new Shader3D(vs,ps,attributeMap,sceneUniformMap,cameraUniformMap,spriteUniformMap,materialUniformMap,renderElementUniformMap)},Shader3D.addInclude=function(fileName,txt){ShaderCompile.addInclude(fileName,txt)},Shader3D._createShader=function(gl,str,type){type=gl.createShader(type);if(gl.shaderSource(type,str),gl.compileShader(type),ShaderCompile3D.debugMode&&!gl.getShaderParameter(type,35713))throw gl.getShaderInfoLog(type);return type},Shader3D.PERIOD_RENDERELEMENT=0,Shader3D.PERIOD_MATERIAL=1,Shader3D.PERIOD_SPRITE=2,Shader3D.PERIOD_CAMERA=3,Shader3D.PERIOD_SCENE=4,Shader3D._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],Shader3D._count=0,__static(Shader3D,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new StringKey}]),Shader3D}(),StandardMaterial=function(_super){function StandardMaterial(){this._transformUV=null,StandardMaterial.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new Vector3(.6,.6,.6)),this._setColor(10,new Vector3(1,1,1)),this._setColor(11,new Vector4(1,1,1,8)),this._setColor(12,new Vector3(1,1,1)),this._setColor(7,new Vector4(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new Vector4(1,1,0,0)),this.renderMode=1}__class(StandardMaterial,"laya.d3.core.material.StandardMaterial",_super);var __proto=StandardMaterial.prototype;return __proto.disableLight=function(){this._addDisablePublicShaderDefine(ShaderCompile3D.SHADERDEFINE_POINTLIGHT|ShaderCompile3D.SHADERDEFINE_SPOTLIGHT|ShaderCompile3D.SHADERDEFINE_DIRECTIONLIGHT)},__proto.disableFog=function(){this._addDisablePublicShaderDefine(ShaderCompile3D.SHADERDEFINE_FOG)},__proto.onAsynLoaded=function(url,data,params){var jsonData=data[0];if(jsonData.version)_super.prototype.onAsynLoaded.call(this,url,data,params);else{var prop,url=data[1],props=jsonData.props;for(prop in props)this[prop]=props[prop];StandardMaterial._parseStandardMaterial(url,this,jsonData),this._endLoaded()}},__proto.cloneTo=function(destObject){_super.prototype.cloneTo.call(this,destObject);this._transformUV&&(destObject._transformUV=this._transformUV.clone())},__getset(0,__proto,"ambientColor",function(){return this._getColor(9)},function(value){this._setColor(9,value)}),__getset(0,__proto,"ambientTexture",function(){return this._getTexture(5)},function(value){value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,value)}),__getset(0,__proto,"renderMode",null,function(value){switch(value){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(StandardMaterial.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(value)}),__getset(0,__proto,"reflectColor",function(){return this._getColor(12)},function(value){this._setColor(12,value)}),__getset(0,__proto,"tilingOffset",function(){return this._getColor(15)},function(value){var valueE;value&&(1!=(valueE=value.elements)[0]||1!=valueE[1]||0!=valueE[2]||0!=valueE[3])?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET),this._setColor(15,value)}),__getset(0,__proto,"albedo",function(){return this._getColor(7)},function(value){this._setColor(7,value)}),__getset(0,__proto,"diffuseColor",function(){return this._getColor(10)},function(value){this._setColor(10,value)}),__getset(0,__proto,"albedoColor",function(){return this._getColor(7)},function(value){this._setColor(7,value)}),__getset(0,__proto,"specularColor",function(){return this._getColor(11)},function(value){this._setColor(11,value)}),__getset(0,__proto,"diffuseTexture",function(){return this._getTexture(1)},function(value){value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,value)}),__getset(0,__proto,"normalTexture",function(){return this._getTexture(2)},function(value){value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,value)}),__getset(0,__proto,"specularTexture",function(){return this._getTexture(3)},function(value){value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,value)}),__getset(0,__proto,"emissiveTexture",function(){return this._getTexture(4)},function(value){value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,value)}),__getset(0,__proto,"reflectTexture",function(){return this._getTexture(6)},function(value){value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,value)}),__getset(0,__proto,"transformUV",function(){return this._transformUV},function(value){this._transformUV=value,this._setMatrix4x4(13,value.matrix),value?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,value.matrix.elements,0)}),StandardMaterial.__init__=function(){StandardMaterial.SHADERDEFINE_DIFFUSEMAP=StandardMaterial.shaderDefines.registerDefine("DIFFUSEMAP"),StandardMaterial.SHADERDEFINE_NORMALMAP=StandardMaterial.shaderDefines.registerDefine("NORMALMAP"),StandardMaterial.SHADERDEFINE_SPECULARMAP=StandardMaterial.shaderDefines.registerDefine("SPECULARMAP"),StandardMaterial.SHADERDEFINE_EMISSIVEMAP=StandardMaterial.shaderDefines.registerDefine("EMISSIVEMAP"),StandardMaterial.SHADERDEFINE_AMBIENTMAP=StandardMaterial.shaderDefines.registerDefine("AMBIENTMAP"),StandardMaterial.SHADERDEFINE_REFLECTMAP=StandardMaterial.shaderDefines.registerDefine("REFLECTMAP"),StandardMaterial.SHADERDEFINE_UVTRANSFORM=StandardMaterial.shaderDefines.registerDefine("UVTRANSFORM"),StandardMaterial.SHADERDEFINE_TILINGOFFSET=StandardMaterial.shaderDefines.registerDefine("TILINGOFFSET"),StandardMaterial.SHADERDEFINE_ADDTIVEFOG=StandardMaterial.shaderDefines.registerDefine("ADDTIVEFOG")},StandardMaterial.load=function(url){return Laya.loader.create(url,null,null,StandardMaterial)},StandardMaterial._parseStandardMaterial=function(textureMap,material,json){var json=json.customProps,ambientColorValue=json.ambientColor,ambientColorValue=(material.ambientColor=new Vector3(ambientColorValue[0],ambientColorValue[1],ambientColorValue[2]),json.diffuseColor),ambientColorValue=(material.diffuseColor=new Vector3(ambientColorValue[0],ambientColorValue[1],ambientColorValue[2]),json.specularColor),ambientColorValue=(material.specularColor=new Vector4(ambientColorValue[0],ambientColorValue[1],ambientColorValue[2],ambientColorValue[3]),json.reflectColor),ambientColorValue=(material.reflectColor=new Vector3(ambientColorValue[0],ambientColorValue[1],ambientColorValue[2]),json.albedoColor),ambientColorValue=(ambientColorValue&&(material.albedo=new Vector4(ambientColorValue[0],ambientColorValue[1],ambientColorValue[2],ambientColorValue[3])),json.diffuseTexture.texture2D),ambientColorValue=(ambientColorValue&&(material.diffuseTexture=Loader.getRes(textureMap[ambientColorValue])),json.normalTexture.texture2D),ambientColorValue=(ambientColorValue&&(material.normalTexture=Loader.getRes(textureMap[ambientColorValue])),json.specularTexture.texture2D),ambientColorValue=(ambientColorValue&&(material.specularTexture=Loader.getRes(textureMap[ambientColorValue])),json.emissiveTexture.texture2D),ambientColorValue=(ambientColorValue&&(material.emissiveTexture=Loader.getRes(textureMap[ambientColorValue])),json.ambientTexture.texture2D),ambientColorValue=(ambientColorValue&&(material.ambientTexture=Loader.getRes(textureMap[ambientColorValue])),json.reflectTexture.texture2D);ambientColorValue&&(material.reflectTexture=Loader.getRes(textureMap[ambientColorValue]))},StandardMaterial.RENDERMODE_OPAQUE=1,StandardMaterial.RENDERMODE_OPAQUEDOUBLEFACE=2,StandardMaterial.RENDERMODE_CUTOUT=3,StandardMaterial.RENDERMODE_CUTOUTDOUBLEFACE=4,StandardMaterial.RENDERMODE_TRANSPARENT=13,StandardMaterial.RENDERMODE_TRANSPARENTDOUBLEFACE=14,StandardMaterial.RENDERMODE_ADDTIVE=15,StandardMaterial.RENDERMODE_ADDTIVEDOUBLEFACE=16,StandardMaterial.RENDERMODE_DEPTHREAD_TRANSPARENT=5,StandardMaterial.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,StandardMaterial.RENDERMODE_DEPTHREAD_ADDTIVE=7,StandardMaterial.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,StandardMaterial.RENDERMODE_NONDEPTH_TRANSPARENT=9,StandardMaterial.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,StandardMaterial.RENDERMODE_NONDEPTH_ADDTIVE=11,StandardMaterial.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,StandardMaterial.SHADERDEFINE_DIFFUSEMAP=0,StandardMaterial.SHADERDEFINE_NORMALMAP=0,StandardMaterial.SHADERDEFINE_SPECULARMAP=0,StandardMaterial.SHADERDEFINE_EMISSIVEMAP=0,StandardMaterial.SHADERDEFINE_AMBIENTMAP=0,StandardMaterial.SHADERDEFINE_REFLECTMAP=0,StandardMaterial.SHADERDEFINE_UVTRANSFORM=0,StandardMaterial.SHADERDEFINE_TILINGOFFSET=0,StandardMaterial.SHADERDEFINE_ADDTIVEFOG=0,StandardMaterial.DIFFUSETEXTURE=1,StandardMaterial.NORMALTEXTURE=2,StandardMaterial.SPECULARTEXTURE=3,StandardMaterial.EMISSIVETEXTURE=4,StandardMaterial.AMBIENTTEXTURE=5,StandardMaterial.REFLECTTEXTURE=6,StandardMaterial.ALBEDO=7,StandardMaterial.UVANIAGE=8,StandardMaterial.MATERIALAMBIENT=9,StandardMaterial.MATERIALDIFFUSE=10,StandardMaterial.MATERIALSPECULAR=11,StandardMaterial.MATERIALREFLECT=12,StandardMaterial.UVMATRIX=13,StandardMaterial.UVAGE=14,StandardMaterial.TILINGOFFSET=15,__static(StandardMaterial,["defaultMaterial",function(){var material=new StandardMaterial;return material.lock=!0,this.defaultMaterial=material},"shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1(BaseMaterial.shaderDefines)}]),StandardMaterial}(BaseMaterial),IndexBuffer3D=function(_super){function IndexBuffer3D(indexType,indexCount,bufferUsage,canRead){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===bufferUsage&&(bufferUsage=35044),void 0===canRead&&(canRead=!1),IndexBuffer3D.__super.call(this),this._indexType=indexType,this._indexCount=indexCount,this._bufferUsage=bufferUsage,this._bufferType=34963,this._canRead=canRead;if("ushort"==indexType)this._indexTypeByteCount=2;else{if("ubyte"!=indexType)throw new Error("unidentification index type.");this._indexTypeByteCount=1}bufferUsage=this._indexTypeByteCount*indexCount,this._byteLength=bufferUsage,this._bind(),Buffer._gl.bufferData(this._bufferType,bufferUsage,this._bufferUsage),canRead?("ushort"==indexType?this._buffer=new Uint16Array(indexCount):"ubyte"==indexType&&(this._buffer=new Uint8Array(indexCount)),this.memorySize=2*bufferUsage):this.memorySize=bufferUsage}__class(IndexBuffer3D,"laya.d3.graphics.IndexBuffer3D",_super);var __proto=IndexBuffer3D.prototype;return __proto.setData=function(data,bufferOffset,dataStartIndex,dataCount){void 0===bufferOffset&&(bufferOffset=0),void 0===dataStartIndex&&(dataStartIndex=0),void 0===dataCount&&(dataCount=4294967295);var byteCount=0;if("ushort"==this._indexType?(byteCount=2,0===dataStartIndex&&4294967295===dataCount||(data=new Uint16Array(data.buffer,dataStartIndex*byteCount,dataCount))):"ubyte"==this._indexType&&(byteCount=1,0===dataStartIndex&&4294967295===dataCount||(data=new Uint8Array(data.buffer,dataStartIndex*byteCount,dataCount))),this._bind(),Buffer._gl.bufferSubData(this._bufferType,bufferOffset*byteCount,data),this._canRead)if(0!==bufferOffset||0!==dataStartIndex||4294967295!==dataCount){byteCount=this._buffer.length-bufferOffset;byteCount<dataCount&&(dataCount=byteCount);for(var i=0;i<dataCount;i++)this._buffer[bufferOffset+i]=data[i]}else this._buffer=data},__proto.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},__proto.disposeResource=function(){_super.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},__getset(0,__proto,"indexType",function(){return this._indexType}),__getset(0,__proto,"indexTypeByteCount",function(){return this._indexTypeByteCount}),__getset(0,__proto,"indexCount",function(){return this._indexCount}),__getset(0,__proto,"canRead",function(){return this._canRead}),IndexBuffer3D.INDEXTYPE_UBYTE="ubyte",IndexBuffer3D.INDEXTYPE_USHORT="ushort",IndexBuffer3D.create=function(indexType,indexCount,bufferUsage,canRead){return new IndexBuffer3D(indexType,indexCount,bufferUsage=void 0===bufferUsage?35044:bufferUsage,canRead=void 0===canRead?!1:canRead)},IndexBuffer3D}(Buffer),VertexBuffer3D=function(_super){function VertexBuffer3D(vertexDeclaration,vertexCount,bufferUsage,canRead){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===canRead&&(canRead=!1),VertexBuffer3D.__super.call(this),this._vertexDeclaration=vertexDeclaration,this._vertexCount=vertexCount,this._bufferUsage=bufferUsage,this._bufferType=34962,this._canRead=canRead,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*vertexCount,this._bind(),Buffer._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),canRead&&(this._buffer=new Float32Array(this._byteLength/4))}__class(VertexBuffer3D,"laya.d3.graphics.VertexBuffer3D",_super);var __proto=VertexBuffer3D.prototype;return __proto.bindWithIndexBuffer=function(ib){ib&&ib._bind(),this._bind()},__proto.setData=function(data,bufferOffset,dataStartIndex,dataCount){if(void 0===bufferOffset&&(bufferOffset=0),void 0===dataCount&&(dataCount=4294967295),0===(dataStartIndex=void 0===dataStartIndex?0:dataStartIndex)&&4294967295===dataCount||(data=new Float32Array(data.buffer,4*dataStartIndex,dataCount)),this._bind(),Buffer._gl.bufferSubData(this._bufferType,4*bufferOffset,data),this._canRead)if(0!==bufferOffset||0!==dataStartIndex||4294967295!==dataCount){dataStartIndex=this._buffer.length-bufferOffset;dataStartIndex<dataCount&&(dataCount=dataStartIndex);for(var i=0;i<dataCount;i++)this._buffer[bufferOffset+i]=data[i]}else this._buffer=data},__proto.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},__proto.disposeResource=function(){for(var gl=WebGL.mainContext,elements=this._vertexDeclaration.getVertexElements(),enableAtributes=Buffer._enableAtributes,i=0,n=elements.length;i<n;i++)enableAtributes[i]===this._glBuffer&&(gl.disableVertexAttribArray(i),enableAtributes[i]=null);_super.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},__getset(0,__proto,"vertexDeclaration",function(){return this._vertexDeclaration}),__getset(0,__proto,"vertexCount",function(){return this._vertexCount}),__getset(0,__proto,"canRead",function(){return this._canRead}),VertexBuffer3D.create=function(vertexDeclaration,vertexCount,bufferUsage,canRead){return new VertexBuffer3D(vertexDeclaration,vertexCount,bufferUsage=void 0===bufferUsage?35044:bufferUsage,canRead=void 0===canRead?!1:canRead)},VertexBuffer3D}(Buffer),DataTexture2D=function(){function DataTexture2D(){this.simLodInfo=null,this._src=null,this._buffer=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,DataTexture2D.__super.call(this),this._type=3553}__class(DataTexture2D,"laya.d3.resource.DataTexture2D",BaseTexture);var __proto=DataTexture2D.prototype;return __proto.genDebugMipmaps=function(){var ret=[];return ret.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),ret.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),ret.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),ret.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),ret.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),ret.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),ret.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),ret.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),ret.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),ret.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),ret},__proto._onTextureLoaded=function(buff){},__proto._createWebGlTexture=function(){if(!this._buffer&&!this._mipmaps)throw"create GLTextur err:no data";var gl=WebGL.mainContext,glTexture=(gl.getExtension("EXT_shader_texture_lod"),this._source=gl.createTexture()),w=this._width,h=this._height,preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue;if(WebGLContext.bindTexture(gl,this._type,glTexture),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var infoi=0;gl.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var i=0;i<this._mipmaps.length;i++){if(this._mipmaps[i].byteLength!=cw*ch*4)throw"mipmap size error  level:"+i;gl.texSubImage2D(this._type,0,DataTexture2D.simLodRect[infoi++],DataTexture2D.simLodRect[infoi++],DataTexture2D.simLodRect[infoi++],DataTexture2D.simLodRect[infoi++],6408,5121,new Uint8Array(this._mipmaps[i]))}this.minFifter=9729,this.magFifter=9729}else{var cw=this._width,ch=this._height,infoi=0;for(gl.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),i=0;i<this._mipmaps.length;i++){if(this._mipmaps[i].byteLength!=cw*ch*4)throw"mipmap size error  level:"+i;gl.texImage2D(this._type,i,6408,cw,ch,0,6408,5121,new Uint8Array(this._mipmaps[i])),(cw/=2)<1&&(cw=1),(ch/=2)<1&&(ch=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else{glTexture=this._buffer.byteLength/(w*h)==4?6408:6407;this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),gl.texImage2D(this._type,0,glTexture,w,h,0,glTexture,5121,this._buffer)}var glTexture=this._minFifter,magFifter=this._magFifter,wrapModeU=0==this._wrapModeU?10497:33071,wrapModeV=0==this._wrapModeV?10497:33071,isPot=Arith.isPOT(w,h);isPot?(this._mipmap||this._mipmaps?-1===glTexture&&(glTexture=9987):-1===glTexture&&(glTexture=9729),-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,glTexture),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,wrapModeU),gl.texParameteri(this._type,10243,wrapModeV),this._mipmap&&gl.generateMipmap(this._type)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,glTexture=-1===glTexture?9729:glTexture),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,33071),gl.texParameteri(this._type,10243,33071)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),this.src&&0<this.src.length&&(this._buffer=null),this.memorySize=isPot?w*h*4*(1+1/3):w*h*4,this._recreateLock=!1},__proto.recreateResource=function(){(this._buffer||null!=this._src&&""!==this._src)&&(this._needReleaseAgain=!1,this._buffer||this._mipmaps?this._recreateLock||(this._createWebGlTexture(),this.completeCreate()):this._recreateLock=!0)},__proto.onAsynLoaded=function(url,data,params){var imgdata;(imgdata=params?params[0].call(this,data):imgdata)&&(this._width=imgdata.width,this._height=imgdata.height,this._buffer=imgdata.data),this._src=url,this._size=new Size(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},__proto.getPixels=function(){return new Uint8Array(this._buffer)},__proto.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this.memorySize=0)},__getset(0,__proto,"src",function(){return this._src}),DataTexture2D.create=function(data,w,h,magfilter,minfilter,mipmap){if(void 0===magfilter&&(magfilter=9729),void 0===minfilter&&(minfilter=9729),void 0===mipmap&&(mipmap=!0),!data||data.byteLength<w*h*4)throw"DataTexture2D create error";var ret=new DataTexture2D;return ret._buffer=data,ret._width=w,ret._height=h,ret._mipmap=mipmap,ret._magFifter=magfilter,ret._minFifter=minfilter,ret._size=new Size(ret._width,ret._height),ret._conchTexture?alert("怎么给runtime传递datatexture数据"):ret.activeResource(),ret},DataTexture2D.load=function(url,w,h,magfilter,minfilter){if(void 0===w&&(w=0),void 0===h&&(h=0),void 0===magfilter&&(magfilter=9729),void 0===minfilter&&(minfilter=9729),"mipmaps"===Utils.getFileExtension(url)){var ret=Laya.loader.create(url,null,null,DataTexture2D,[function(data){this._mipmaps=[];var szinfo=new Uint32Array(data),validw=(this._width=szinfo[0],512);if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,validw=1024),this._width!=validw)throw console.error("现在只支持512x256的环境贴图。当前的是"+szinfo[0]),"现在只支持512x256的环境贴图。当前的是"+szinfo[0];this._height=szinfo[1];for(var curw=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,curh=this._height,cursz=8;;){var curbufsz=curw*curh*4;if(cursz+curbufsz>data.byteLength)throw"load mipmaps data size error ";var tbuf=new Uint8Array(data,cursz,curbufsz);if(this._mipmaps.push(tbuf),cursz+=curbufsz,1==curw&&1==curh)break;(curw/=2)<1&&(curw=1),(curh/=2)<1&&(curh=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){ret.simLodInfo=new Float32Array(40);for(var i=0;i<ret.simLodInfo.length;)ret.simLodInfo[i]=(DataTexture2D.simLodRect[i]+.5)/1024,ret.simLodInfo[++i]=(DataTexture2D.simLodRect[i]+.5)/256,ret.simLodInfo[++i]=Math.max(DataTexture2D.simLodRect[i]-1,.1)/1024,ret.simLodInfo[++i]=Math.max(DataTexture2D.simLodRect[i]-1.5,.1)/256,i++}return ret}if("number"==typeof w)return Laya.loader.create(url,null,null,DataTexture2D,[function(data){return this._width=w,this._height=h,this._buffer=data,null}]);if("function"==typeof w)return Laya.loader.create(url,null,null,DataTexture2D,[w]);throw new Error("unknown params.")},DataTexture2D.lodasatlas=!1,__static(DataTexture2D,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),DataTexture2D}(),Mesh=(function(){function PrimitiveMesh(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,PrimitiveMesh.__super.call(this)}__class(PrimitiveMesh,"laya.d3.resource.models.PrimitiveMesh",BaseMesh);var __proto=PrimitiveMesh.prototype;Laya.imps(__proto,{"laya.d3.core.render.IRenderable":!0}),__proto._getVertexBuffer=function(index){return 0===(index=void 0===index?0:index)?this._vertexBuffer:null},__proto._getVertexBuffers=function(){return null},__proto._getIndexBuffer=function(){return this._indexBuffer},__proto._getPositions=function(){for(var positionElement,vertices=[],vertexElements=this._vertexBuffer.vertexDeclaration.getVertexElements(),j=0,j=0;j<vertexElements.length;j++){var vertexElement=vertexElements[j];if("vector3"===vertexElement.elementFormat&&0===vertexElement.elementUsage){positionElement=vertexElement;break}}var verticesData=this._vertexBuffer.getData();for(j=0;j<verticesData.length;j+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var ofset=j+positionElement.offset/4,ofset=new Vector3(verticesData[ofset+0],verticesData[ofset+1],verticesData[ofset+2]);vertices.push(ofset)}return vertices},__proto.getRenderElement=function(index){return this},__proto.getRenderElementsCount=function(){return 1},__proto.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},__proto._beforeRender=function(state){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},__proto._render=function(state){WebGL.mainContext.drawElements(4,this._numberIndices,5123,0),Stat.drawCall++,Stat.trianglesFaces+=this._numberIndices/3},__getset(0,__proto,"_vertexBufferCount",function(){return 1}),__getset(0,__proto,"triangleCount",function(){return this._indexBuffer.indexCount/3})}(),function(){function Mesh(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,Mesh.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}__class(Mesh,"laya.d3.resource.models.Mesh",BaseMesh);var __proto=Mesh.prototype;return __proto._getPositions=function(){var positionElement,vertexElement,verticesData,vertices=[],i=0,j=0,ofset=0;if(0!==this._vertexBuffers.length)for(var vertexBufferCount=this._vertexBuffers.length,i=0;i<vertexBufferCount;i++){for(vertexElements=(vertexBuffer=this._vertexBuffers[i]).vertexDeclaration.getVertexElements(),j=0;j<vertexElements.length;j++)if("vector3"===(vertexElement=vertexElements[j]).elementFormat&&0===vertexElement.elementUsage){positionElement=vertexElement;break}for(verticesData=vertexBuffer.getData(),j=0;j<verticesData.length;j+=vertexBuffer.vertexDeclaration.vertexStride/4)ofset=j+positionElement.offset/4,vertices.push(new Vector3(verticesData[ofset+0],verticesData[ofset+1],verticesData[ofset+2]))}else{var submesheCount=this._subMeshes.length;for(i=0;i<submesheCount;i++){for(var vertexBuffer,vertexElements=(vertexBuffer=this._subMeshes[i]._getVertexBuffer()).vertexDeclaration.getVertexElements(),j=0;j<vertexElements.length;j++)if("vector3"===(vertexElement=vertexElements[j]).elementFormat&&0===vertexElement.elementUsage){positionElement=vertexElement;break}for(verticesData=vertexBuffer.getData(),j=0;j<verticesData.length;j+=vertexBuffer.vertexDeclaration.vertexStride/4)ofset=j+positionElement.offset/4,vertices.push(new Vector3(verticesData[ofset+0],verticesData[ofset+1],verticesData[ofset+2]))}}return vertices},__proto._setSubMeshes=function(subMeshes){this._subMeshes=subMeshes,this._subMeshCount=subMeshes.length;for(var i=0;i<this._subMeshCount;i++)subMeshes[i]._indexInMesh=i;this._positions=this._getPositions(),this._generateBoundingObject()},__proto.onAsynLoaded=function(url,data,params){var bufferData=data[0],data=data[1];MeshReader.read(bufferData,this,this._materials,this._subMeshes,data),this.completeCreate(),this._endLoaded()},__proto.getSubMesh=function(index){return this._subMeshes[index]},__proto.getSubMeshCount=function(){return this._subMeshes.length},__proto.getRenderElementsCount=function(){return this._subMeshes.length},__proto.getRenderElement=function(index){return this._subMeshes[index]},__proto.disposeResource=function(){for(var i=0;i<this._subMeshes.length;i++)this._subMeshes[i].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},__getset(0,__proto,"materials",function(){return this._materials.slice()}),__getset(0,__proto,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),Mesh.load=function(url){return Laya.loader.create(url,null,null,Mesh)},Mesh}()),SolidColorTexture2D=(function(){function RenderTexture(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===surfaceFormat&&(surfaceFormat=6408),void 0===surfaceType&&(surfaceType=5121),void 0===depthStencilFormat&&(depthStencilFormat=33189),void 0===mipMap&&(mipMap=!1),void 0===repeat&&(repeat=!1),void 0===minFifter&&(minFifter=-1),void 0===magFifter&&(magFifter=-1),RenderTexture.__super.call(this),this._type=3553,this._width=width,this._height=height,this._size=new Size(width,height),this._surfaceFormat=surfaceFormat,this._surfaceType=surfaceType,this._depthStencilFormat=depthStencilFormat,Render.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=mipMap,this._repeat=repeat,this._minFifter=minFifter,this._magFifter=magFifter,this.activeResource(),this._alreadyResolved=!0}__class(RenderTexture,"laya.d3.resource.RenderTexture",BaseTexture);var __proto=RenderTexture.prototype;__proto.recreateResource=function(){var gl=WebGL.mainContext,preTarget=(this._frameBuffer=gl.createFramebuffer(),this._source=gl.createTexture(),WebGLContext.curBindTexTarget),preTexture=WebGLContext.curBindTexValue,minFifter=(WebGLContext.bindTexture(gl,this._type,this._source),gl.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null),this._minFifter),magFifter=this._magFifter,repeat=this._repeat?10497:33071;if(Arith.isPOT(this._width,this._height)?(this._mipmap?-1===minFifter&&(minFifter=9987):-1===minFifter&&(minFifter=9729),-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,minFifter),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,repeat),gl.texParameteri(this._type,10243,repeat),this._mipmap&&gl.generateMipmap(this._type)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,minFifter=-1===minFifter?9729:minFifter),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,33071),gl.texParameteri(this._type,10243,33071)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),gl.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(36161,this._depthStencilBuffer),gl.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),gl.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:gl.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:gl.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:gl.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}gl.framebufferTexture2D(36160,36064,3553,this._source,0),gl.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},__proto.start=function(){WebGL.mainContext.bindFramebuffer(36160,this.frameBuffer),(RenderTexture._currentRenderTarget=this)._alreadyResolved=!1},__proto.end=function(){WebGL.mainContext.bindFramebuffer(36160,null),RenderTexture._currentRenderTarget=null,this._alreadyResolved=!0},__proto.getData=function(x,y,width,height){var pixels,gl=WebGL.mainContext;return gl.bindFramebuffer(36160,this._frameBuffer),36053===gl.checkFramebufferStatus(36160)?(pixels=new Uint8Array(this._width*this._height*4),gl.readPixels(x,y,width,height,this._surfaceFormat,this._surfaceType,pixels),gl.bindFramebuffer(36160,null),pixels):(gl.bindFramebuffer(36160,null),null)},__proto.disposeResource=function(){var gl;this._frameBuffer&&((gl=WebGL.mainContext).deleteTexture(this._source),gl.deleteFramebuffer(this._frameBuffer),gl.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},__getset(0,__proto,"surfaceFormat",function(){return this._surfaceFormat}),__getset(0,__proto,"surfaceType",function(){return this._surfaceType}),__getset(0,__proto,"depthStencilFormat",function(){return this._depthStencilFormat}),__getset(0,__proto,"source",function(){return this._alreadyResolved?Laya.superGet(BaseTexture,this,"source"):null}),__getset(0,__proto,"depthStencilBuffer",function(){return this._depthStencilBuffer}),__getset(0,__proto,"frameBuffer",function(){return this._frameBuffer}),RenderTexture._currentRenderTarget=null}(),function(){function SolidColorTexture2D(color){this._color=null,this._pixels=null,SolidColorTexture2D.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new Size(this.width,this.height),this._color=color,this._pixels=new Uint8Array([255*color.x,255*color.y,255*color.z,255*color.w])}__class(SolidColorTexture2D,"laya.d3.resource.SolidColorTexture2D",BaseTexture);var __proto=SolidColorTexture2D.prototype;return __proto._createWebGlTexture=function(){var gl=WebGL.mainContext,glTex=this._source=gl.createTexture(),w=this._width,h=this._height,preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue,glTex=(WebGLContext.bindTexture(gl,this._type,glTex),gl.texImage2D(this._type,0,6408,w,h,0,6408,5121,this._pixels),this._minFifter),magFifter=this._magFifter,repeat=this._repeat?10497:33071,isPot=Arith.isPOT(w,h);isPot?(this._mipmap?-1===glTex&&(glTex=9987):-1===glTex&&(glTex=9729),-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,glTex),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,repeat),gl.texParameteri(this._type,10243,repeat),this._mipmap&&gl.generateMipmap(this._type)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,glTex=-1===glTex?9729:glTex),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,33071),gl.texParameteri(this._type,10243,33071)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),this.memorySize=isPot?w*h*4*(1+1/3):w*h*4},__proto.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},__proto.disposeResource=function(){this._source&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},__static(SolidColorTexture2D,["magentaTexture",function(){var texture=new SolidColorTexture2D(new Vector4(1,0,1,1));return texture.lock=!0,this.magentaTexture=texture},"grayTexture",function(){var texture=new SolidColorTexture2D(new Vector4(.5,.5,.5,1));return texture.lock=!0,this.grayTexture=texture}]),SolidColorTexture2D}()),Texture2D=function(){function Texture2D(canRead,reapeat,format,mipmap){this._canRead=!1,this._image=null,this._pixels=null,void 0===canRead&&(canRead=!1),void 0===reapeat&&(reapeat=!0),void 0===format&&(format=6408),void 0===mipmap&&(mipmap=!0),Texture2D.__super.call(this),this._type=3553,this._repeat=reapeat,this._canRead=canRead,this._format=format,this._mipmap=mipmap}__class(Texture2D,"laya.d3.resource.Texture2D",BaseTexture);var __proto=Texture2D.prototype;return __proto._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var gl=WebGL.mainContext,glTexture=this._source=gl.createTexture(),w=this._width,h=this._height,preTarget=WebGLContext.curBindTexTarget,preTexture=WebGLContext.curBindTexValue;switch(WebGLContext.bindTexture(gl,this._type,glTexture),this._format){case 6407:case 6408:this._canRead?gl.texImage2D(this._type,0,this._format,w,h,0,this._format,5121,this._pixels):this._image instanceof laya.webgl.resource.WebGLImage?gl.texImage2D(this._type,0,this._image._format,w,h,0,this._image._format,5121,this._image.atlasSource):gl.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:gl.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image)}var glTexture=this._minFifter,magFifter=this._magFifter,repeat=this._repeat?10497:33071,wrapModeU=0==this._wrapModeU?10497:33071,wrapModeV=0==this._wrapModeV?10497:33071,isPot=Arith.isPOT(w,h);isPot?(this._mipmap?-1===glTexture&&(glTexture=9987):-1===glTexture&&(glTexture=9729),-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,glTexture),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,repeat),gl.texParameteri(this._type,10243,repeat),gl.texParameteri(this._type,10242,wrapModeU),gl.texParameteri(this._type,10243,wrapModeV),this._mipmap&&gl.generateMipmap(this._type)):(-1===magFifter&&(magFifter=9729),gl.texParameteri(this._type,10241,glTexture=-1===glTexture?9729:glTexture),gl.texParameteri(this._type,10240,magFifter),gl.texParameteri(this._type,10242,33071),gl.texParameteri(this._type,10243,33071)),preTarget&&preTexture&&WebGLContext.bindTexture(gl,preTarget,preTexture),this._image.onload=null,this._image=null,this.memorySize=isPot?w*h*4*(1+1/3):w*h*4},__proto.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},__proto.onAsynLoaded=function(url,data,params){var canRead;switch(params&&(void 0!==(canRead=params[0])&&(this._canRead=canRead),void 0!==(canRead=params[1])&&(this._repeat=canRead),void 0!==(canRead=params[2])&&(this._format=canRead),void 0!==(canRead=params[3])&&(this._mipmap=canRead),void 0!==(canRead=params.wrapModeU)&&(this._wrapModeU=canRead),void 0!==(canRead=params.wrapModeV))&&(this._wrapModeV=canRead),this._format){case 6407:case 6408:var w=(this._image=data).width,h=data.height;this._width=w,this._height=h,this._size=new Size(w,h),this._canRead&&(Render.isConchApp?data instanceof window.HTMLElement&&(this._pixels=new Uint8Array(data.getImageData(0,0,w,h))):(Browser.canvas.size(w,h),Browser.canvas.clear(),Browser.context.drawImage(data,0,0,w,h),this._pixels=new Uint8Array(Browser.context.getImageData(0,0,w,h).data.buffer)));break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:w=new Byte(data);w.readUTFBytes(4),w.readUTFBytes(2),w.getInt16(),w.endian="bigEndian",this._width=w.getInt16(),this._height=w.getInt16(),this._size=new Size(this._width,this._height),w.getInt16(),w.getInt16();this._image=new Uint8Array(data,w.pos)}this.recreateResource(),this._endLoaded()},__proto.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},__proto.disposeResource=function(){this._source&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},__getset(0,__proto,"_src",function(){return this.url}),__getset(0,__proto,"src",function(){return this.url}),Texture2D.load=function(url){return Laya.loader.create(url,null,null,Texture2D)},Texture2D}(),BaseCamera=function(_super){function BaseCamera(nearPlane,farPlane){BaseCamera.__super.call(this),void 0===nearPlane&&(nearPlane=.3),void 0===farPlane&&(farPlane=1e3),this._tempVector3=new Vector3,this._position=new Vector3,this._up=new Vector3,this._forward=new Vector3,this._right=new Vector3,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=Size.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=nearPlane,this._farPlane=farPlane,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),Laya.stage.on("resize",this,this._onScreenSizeChanged)}__class(BaseCamera,"laya.d3.core.BaseCamera",_super);var __proto=BaseCamera.prototype;return __proto._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var tempCamera,cameraPool=this.scene._cameraPool,n=cameraPool.length-1,i=0;i<n;i++)cameraPool[i].renderingOrder>cameraPool[n].renderingOrder&&(tempCamera=cameraPool[i],cameraPool[i]=cameraPool[n],cameraPool[n]=tempCamera)},__proto._calculateProjectionMatrix=function(){},__proto._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},__proto._prepareCameraToRender=function(){Layer._currentCameraCullingMask=this.cullingMask;var cameraSV=this._shaderValues;cameraSV.setValue(0,this.transform.position.elements),cameraSV.setValue(5,this.forward.elements),cameraSV.setValue(6,this.up.elements)},__proto._prepareCameraViewProject=function(viewMatrix,projectMatrix){var cameraSV=this._shaderValues;cameraSV.setValue(1,viewMatrix.elements),cameraSV.setValue(2,projectMatrix.elements)},__proto._renderCamera=function(gl,state,scene){},__proto.addLayer=function(layer){29!==layer.number&&30!=layer.number&&(this.cullingMask=this.cullingMask|layer.mask)},__proto.removeLayer=function(layer){29!==layer.number&&30!=layer.number&&(this.cullingMask=this.cullingMask&~layer.mask)},__proto.addAllLayers=function(){this.cullingMask=2147483647},__proto.removeAllLayers=function(){this.cullingMask=0|Layer.getLayerByNumber(29).mask|Layer.getLayerByNumber(30).mask},__proto.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},__proto.moveForward=function(distance){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=distance,this.transform.translate(this._tempVector3)},__proto.moveRight=function(distance){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=distance,this.transform.translate(this._tempVector3)},__proto.moveVertical=function(distance){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=distance,this.transform.translate(this._tempVector3,!1)},__proto._addSelfRenderObjects=function(){var cameraPool=this.scene._cameraPool,cmaeraCount=cameraPool.length;if(0<cmaeraCount){for(var i=cmaeraCount-1;0<=i;i--)if(this.renderingOrder<=cameraPool[i].renderingOrder){cameraPool.splice(i+1,0,this);break}}else cameraPool.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},__proto._clearSelfRenderObjects=function(){var cameraPool=this.scene._cameraPool;cameraPool.splice(cameraPool.indexOf(this),1)},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,Laya.stage.off("resize",this,this._onScreenSizeChanged),_super.prototype.destroy.call(this,destroyChild)},__getset(0,__proto,"sky",function(){return this._sky},function(value){(this._sky=value)._ownerCamera=this}),__getset(0,__proto,"forward",function(){var worldMatrixe=this.transform.worldMatrix.elements,forwarde=this._forward.elements;return forwarde[0]=-worldMatrixe[8],forwarde[1]=-worldMatrixe[9],forwarde[2]=-worldMatrixe[10],this._forward}),__getset(0,__proto,"position",function(){var worldMatrixe=this.transform.worldMatrix.elements,positione=this._position.elements;return positione[0]=worldMatrixe[12],positione[1]=worldMatrixe[13],positione[2]=worldMatrixe[14],this._position}),__getset(0,__proto,"renderTarget",function(){return this._renderTarget},function(value){null!=(this._renderTarget=value)&&(this._renderTargetSize=value.size)}),__getset(0,__proto,"up",function(){var worldMatrixe=this.transform.worldMatrix.elements,upe=this._up.elements;return upe[0]=worldMatrixe[4],upe[1]=worldMatrixe[5],upe[2]=worldMatrixe[6],this._up}),__getset(0,__proto,"right",function(){var worldMatrixe=this.transform.worldMatrix.elements,righte=this._right.elements;return righte[0]=worldMatrixe[0],righte[1]=worldMatrixe[1],righte[2]=worldMatrixe[2],this._right}),__getset(0,__proto,"renderTargetSize",function(){return this._renderTargetSize},function(value){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=value,this._calculateProjectionMatrix()}),__getset(0,__proto,"fieldOfView",function(){return this._fieldOfView},function(value){this._fieldOfView=value,this._calculateProjectionMatrix()}),__getset(0,__proto,"nearPlane",function(){return this._nearPlane},function(value){this._nearPlane=value,this._calculateProjectionMatrix()}),__getset(0,__proto,"farPlane",function(){return this._farPlane},function(vaule){this._farPlane=vaule,this._calculateProjectionMatrix()}),__getset(0,__proto,"orthographic",function(){return this._orthographic},function(vaule){this._orthographic=vaule,this._calculateProjectionMatrix()}),__getset(0,__proto,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(vaule){this._orthographicVerticalSize=vaule,this._calculateProjectionMatrix()}),__getset(0,__proto,"renderingOrder",function(){return this._renderingOrder},function(value){this._renderingOrder=value,this._sortCamerasByRenderingOrder()}),BaseCamera.CAMERAPOS=0,BaseCamera.VIEWMATRIX=1,BaseCamera.PROJECTMATRIX=2,BaseCamera.VPMATRIX=3,BaseCamera.VPMATRIX_NO_TRANSLATE=4,BaseCamera.CAMERADIRECTION=5,BaseCamera.CAMERAUP=6,BaseCamera.ENVIRONMENTDIFFUSE=7,BaseCamera.ENVIRONMENTSPECULAR=8,BaseCamera.SIMLODINFO=9,BaseCamera.DIFFUSEIRRADMATR=10,BaseCamera.DIFFUSEIRRADMATG=11,BaseCamera.DIFFUSEIRRADMATB=12,BaseCamera.HDREXPOSURE=13,BaseCamera.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",BaseCamera.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",BaseCamera.CLEARFLAG_SOLIDCOLOR=0,BaseCamera.CLEARFLAG_SKY=1,BaseCamera.CLEARFLAG_DEPTHONLY=2,BaseCamera.CLEARFLAG_NONE=3,__static(BaseCamera,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new Matrix4x4(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new Matrix4x4},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new Matrix4x4}]),BaseCamera}(Sprite3D),RenderableSprite3D=function(_super){function RenderableSprite3D(name){this._render=null,this._geometryFilter=null,RenderableSprite3D.__super.call(this,name)}__class(RenderableSprite3D,"laya.d3.core.RenderableSprite3D",_super);var __proto=RenderableSprite3D.prototype;return __proto._addToInitStaticBatchManager=function(){},__proto._setBelongScene=function(scene){_super.prototype._setBelongScene.call(this,scene),scene._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},__proto._setUnBelongScene=function(){var renderableSprite3Ds=this._scene._renderableSprite3Ds,index=renderableSprite3Ds.indexOf(this);renderableSprite3Ds.splice(index,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),_super.prototype._setUnBelongScene.call(this)},__proto._update=function(state){(state.owner=this)._activeInHierarchy&&(this._updateComponents(state),this._render._updateOctreeNode(),this._lateUpdateComponents(state),Stat.spriteCount++,this._childs.length)&&this._updateChilds(state)},__proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._render._destroy(),this._render=null},RenderableSprite3D.__init__=function(){RenderableSprite3D.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=RenderableSprite3D.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),RenderableSprite3D.SAHDERDEFINE_LIGHTMAP=RenderableSprite3D.shaderDefines.registerDefine("LIGHTMAP")},RenderableSprite3D.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,RenderableSprite3D.SAHDERDEFINE_LIGHTMAP=4,RenderableSprite3D.LIGHTMAPSCALEOFFSET=2,RenderableSprite3D.LIGHTMAP=3,__static(RenderableSprite3D,["shaderDefines",function(){return this.shaderDefines=new ShaderDefines$1}]),RenderableSprite3D}(Sprite3D),Camera=function(){function Camera(aspectRatio,nearPlane,farPlane){void 0===aspectRatio&&(aspectRatio=0),void 0===nearPlane&&(nearPlane=.3),void 0===farPlane&&(farPlane=1e3),this._viewMatrix=new Matrix4x4,this._projectionMatrix=new Matrix4x4,this._projectionViewMatrix=new Matrix4x4,this._viewport=new Viewport(0,0,0,0),this._normalizedViewport=new Viewport(0,0,1,1),this._aspectRatio=aspectRatio,this._boundFrustumUpdate=!0,this._boundFrustum=new BoundFrustum(Matrix4x4.DEFAULT),Camera.__super.call(this,nearPlane,farPlane),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}__class(Camera,"laya.d3.core.Camera",BaseCamera);var __proto=Camera.prototype;return __proto._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},__proto._parseCustomProps=function(rootNode,innerResouMap,customProps,json){var color=customProps.clearColor,color=(this.clearColor=new Vector4(color[0],color[1],color[2],color[3]),customProps.viewport);this.normalizedViewport=new Viewport(color[0],color[1],color[2],color[3])},__proto._calculateProjectionMatrix=function(){var halfWidth,halfHeight;this._useUserProjectionMatrix||(this._orthographic?(halfWidth=this.orthographicVerticalSize*this.aspectRatio*.5,halfHeight=.5*this.orthographicVerticalSize,Matrix4x4.createOrthoOffCenterRH(-halfWidth,halfWidth,-halfHeight,halfHeight,this.nearPlane,this.farPlane,this._projectionMatrix)):Matrix4x4.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix)),this._boundFrustumUpdate=!0},__proto._update=function(state){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,state)},__proto._renderCamera=function(gl,state,scene){scene.parallelSplitShadowMaps[0]&&scene._renderShadowMap(gl,state,this),(state.camera=this)._prepareCameraToRender(),scene._preRenderUpdateComponents(state),viewMat=state._viewMatrix=this.viewMatrix;var viewMat,projectMat,renderTar=this._renderTarget;renderTar?(renderTar.start(),Matrix4x4.multiply(BaseCamera._invertYScaleMatrix,this._projectionMatrix,BaseCamera._invertYProjectionMatrix),Matrix4x4.multiply(BaseCamera._invertYScaleMatrix,this.projectionViewMatrix,BaseCamera._invertYProjectionViewMatrix),projectMat=state._projectionMatrix=BaseCamera._invertYProjectionMatrix,state._projectionViewMatrix=BaseCamera._invertYProjectionViewMatrix):(projectMat=state._projectionMatrix=this._projectionMatrix,state._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(viewMat,projectMat),state._viewport=this.viewport,scene._preRenderScene(gl,state,this.boundFrustum),scene._clear(gl,state),scene._renderScene(gl,state),scene._postRenderUpdateComponents(state),renderTar&&renderTar.end()},__proto.viewportPointToRay=function(point,out){Picker.calculateCursorRay(point,this.viewport,this._projectionMatrix,this.viewMatrix,null,out)},__proto.normalizedViewportPointToRay=function(point,out){var finalPoint=Camera._tempVector20,vp=this.viewport,point=point.elements,vpPosE=finalPoint.elements;vpPosE[0]=point[0]*vp.width,vpPosE[1]=point[1]*vp.height,Picker.calculateCursorRay(finalPoint,this.viewport,this._projectionMatrix,this.viewMatrix,null,out)},__proto.worldToViewportPoint=function(position,out){Matrix4x4.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(position,this._projectionViewMatrix,out);position=out.elements;position[0]=position[0]/Laya.stage.clientScaleX,position[1]=position[1]/Laya.stage.clientScaleY},__proto.worldToNormalizedViewportPoint=function(position,out){Matrix4x4.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(position,this._projectionViewMatrix,out);position=out.elements;position[0]=position[0]/Laya.stage.clientScaleX,position[1]=position[1]/Laya.stage.clientScaleY},__proto.convertScreenCoordToOrthographicCoord=function(source,out){var clientWidth,clientHeight,ratioX,ratioY,oE;return!!this._orthographic&&(clientWidth=RenderState.clientWidth,clientHeight=RenderState.clientHeight,ratioX=this.orthographicVerticalSize*this.aspectRatio/clientWidth,ratioY=this.orthographicVerticalSize/clientHeight,source=source.elements,(oE=out.elements)[0]=(-clientWidth/2+source[0])*ratioX,oE[1]=(clientHeight/2-source[1])*ratioY,oE[2]=(this.nearPlane-this.farPlane)*(source[2]+1)/2-this.nearPlane,Vector3.transformCoordinate(out,this.transform.worldMatrix,out),!0)},__getset(0,__proto,"projectionViewMatrix",function(){return Matrix4x4.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),__getset(0,__proto,"aspectRatio",function(){var vp;return 0===this._aspectRatio?(vp=this.viewport).width/vp.height:this._aspectRatio},function(value){if(value<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=value,this._calculateProjectionMatrix()}),__getset(0,__proto,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),__getset(0,__proto,"needViewport",function(){var nVp=this.normalizedViewport;return 0===nVp.x&&0===nVp.y&&1===nVp.width&&1===nVp.height}),__getset(0,__proto,"viewport",function(){var nVp,sizeW,size;return this._viewportExpressedInClipSpace&&(nVp=this._normalizedViewport,sizeW=(size=this.renderTargetSize).width,size=size.height,this._viewport.x=nVp.x*sizeW,this._viewport.y=nVp.y*size,this._viewport.width=nVp.width*sizeW,this._viewport.height=nVp.height*size),this._viewport},function(value){if(null!=this.renderTarget&&(value.x<0||value.y<0||0==value.width||0==value.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=value,this._calculateProjectionMatrix()}),__getset(0,__proto,"normalizedViewport",function(){var vp,sizeW,size;return this._viewportExpressedInClipSpace||(vp=this._viewport,sizeW=(size=this.renderTargetSize).width,size=size.height,this._normalizedViewport.x=vp.x/sizeW,this._normalizedViewport.y=vp.y/size,this._normalizedViewport.width=vp.width/sizeW,this._normalizedViewport.height=vp.height/size),this._normalizedViewport},function(value){value.x<0&&(value.x=0,console.warn("Camera: viewport.x must large than 0.0.")),value.y<0&&(value.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<value.x+value.width&&(value.width=1-value.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<value.y+value.height&&(value.height=1-value.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=value,this._calculateProjectionMatrix()}),__getset(0,__proto,"projectionMatrix",function(){return this._projectionMatrix},function(value){this._projectionMatrix=value,this._useUserProjectionMatrix=!0}),__getset(0,__proto,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),__static(Camera,["_tempVector20",function(){return this._tempVector20=new Vector2}]),Camera}(),MeshSprite3D=function(_super){function MeshSprite3D(mesh,name){MeshSprite3D.__super.call(this,name),this._geometryFilter=new MeshFilter(this),this._render=new MeshRender(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),mesh&&(this._geometryFilter.sharedMesh=mesh)instanceof laya.d3.resource.models.Mesh&&(mesh.loaded?this._render.sharedMaterials=mesh.materials:mesh.once("loaded",this,this._applyMeshMaterials))}__class(MeshSprite3D,"laya.d3.core.MeshSprite3D",_super);var __proto=MeshSprite3D.prototype;return __proto._changeRenderObjectByMesh=function(index){var renderObjects=this._render._renderElements,renderElement=renderObjects[index];(renderElement=renderElement||(renderObjects[index]=new SubMeshRenderElement))._render=this._render;renderObjects=(renderObjects=this._render.sharedMaterials[index])||StandardMaterial.defaultMaterial,index=this._geometryFilter.sharedMesh.getRenderElement(index);return renderElement._mainSortID=this._getSortID(index,renderObjects),renderElement._sprite3D=this,renderElement.renderObj=index,renderElement._material=renderObjects,renderElement},__proto._changeRenderObjectByMaterial=function(index,material){var renderElement=this._render._renderElements[index],index=(material=material||StandardMaterial.defaultMaterial,this._geometryFilter.sharedMesh.getRenderElement(index));return renderElement._mainSortID=this._getSortID(index,material),renderElement._sprite3D=this,renderElement.renderObj=index,renderElement._material=material,renderElement},__proto._changeRenderObjectsByMesh=function(){var renderElementsCount=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=renderElementsCount;for(var i=0;i<renderElementsCount;i++)this._changeRenderObjectByMesh(i)},__proto._onMeshChanged=function(meshFilter){meshFilter=meshFilter.sharedMesh;meshFilter.loaded?this._changeRenderObjectsByMesh():meshFilter.once("loaded",this,this._onMeshLoaded)},__proto._onMeshLoaded=function(sender){sender===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},__proto._onMaterialChanged=function(meshRender,index,material){index<this._render._renderElements.length&&this._changeRenderObjectByMaterial(index,material)},__proto._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},__proto._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},__proto._parseCustomProps=function(rootNode,innerResouMap,customProps,json){var meshPath,mesh,render=this.meshRender,lightmapIndex=customProps.lightmapIndex,lightmapIndex=(null!=lightmapIndex&&(render.lightmapIndex=lightmapIndex),customProps.lightmapScaleOffset);if(lightmapIndex&&(render.lightmapScaleOffset=new Vector4(lightmapIndex[0],lightmapIndex[1],lightmapIndex[2],lightmapIndex[3])),json.instanceParams)(meshPath=json.instanceParams.loadPath)&&(mesh=Loader.getRes(innerResouMap[meshPath]),(this.meshFilter.sharedMesh=mesh).loaded?render.sharedMaterials=mesh.materials:mesh.once("loaded",this,this._applyMeshMaterials));else{(meshPath=customProps.meshPath)&&(mesh=Loader.getRes(innerResouMap[meshPath]),this.meshFilter.sharedMesh=mesh);var materials=customProps.materials;if(materials){var sharedMaterials=render.sharedMaterials,materialCount=materials.length;sharedMaterials.length=materialCount;for(var i=0;i<materialCount;i++)sharedMaterials[i]=Loader.getRes(innerResouMap[materials[i].path]);render.sharedMaterials=sharedMaterials}}},__proto._applyMeshMaterials=function(mesh){for(var shaderMaterials=this._render.sharedMaterials,meshMaterials=mesh.materials,i=0,n=meshMaterials.length;i<n;i++)shaderMaterials[i]||(shaderMaterials[i]=meshMaterials[i]);this._render.sharedMaterials=shaderMaterials},__proto._addToInitStaticBatchManager=function(){MeshSprite3D._staticBatchManager._addInitBatchSprite(this)},__proto.cloneTo=function(destObject){var meshSprite3D=destObject,meshRender=(meshSprite3D._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh,this._render),meshSprite3D=meshSprite3D._render,lightmapScaleOffset=(meshSprite3D.enable=meshRender.enable,meshSprite3D.sharedMaterials=meshRender.sharedMaterials,meshSprite3D.castShadow=meshRender.castShadow,meshRender.lightmapScaleOffset);lightmapScaleOffset&&(meshSprite3D.lightmapScaleOffset=lightmapScaleOffset.clone()),meshSprite3D.lightmapIndex=meshRender.lightmapIndex,meshSprite3D.receiveShadow=meshRender.receiveShadow,meshSprite3D.sortingFudge=meshRender.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,destObject)},__proto.destroy=function(destroyChild){var mesh;void 0===destroyChild&&(destroyChild=!0),this.destroyed||(null==(mesh=this.meshFilter.sharedMesh)||mesh.loaded||mesh.off("loaded",this,this._applyMeshMaterials),_super.prototype.destroy.call(this,destroyChild),this._geometryFilter._destroy())},__getset(0,__proto,"meshFilter",function(){return this._geometryFilter}),__getset(0,__proto,"meshRender",function(){return this._render}),MeshSprite3D.__init__=function(){StaticBatchManager._staticBatchManagers.push(MeshSprite3D._staticBatchManager)},MeshSprite3D.load=function(url){return Laya.loader.create(url,null,null,MeshSprite3D)},__static(MeshSprite3D,["_staticBatchManager",function(){return this._staticBatchManager=new MeshSprite3DStaticBatchManager}]),MeshSprite3D}(RenderableSprite3D)}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(require,exports){"use strict";for(var i in Object.defineProperty(exports,"__esModule",{value:!0}),Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o)}}),!function(Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,CSSStyle=(Laya.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),ClassUtils=laya.utils.ClassUtils,HTMLChar=(laya.events.Event,laya.utils.HTMLChar),Loader=laya.net.Loader,Rectangle=(laya.display.Node,laya.maths.Rectangle),Render=laya.renders.Render,Sprite=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),Stat=laya.utils.Stat,Text=laya.display.Text,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils,HTMLParse=function(){function HTMLParse(){}return __class(HTMLParse,"laya.html.utils.HTMLParse"),HTMLParse.parse=function(ower,xmlString,url){xmlString=(xmlString="<root>"+(xmlString=xmlString.replace(/<br>/g,"<br/>"))+"</root>").replace(HTMLParse.spacePattern,HTMLParse.char255);xmlString=Utils.parseXMLFromString(xmlString);HTMLParse._parseXML(ower,xmlString.childNodes[0].childNodes,url)},HTMLParse._parseXML=function(parent,xml,url,href){var node,nodeName,txt,i=0,n=0;if(xml.join||xml.item)for(i=0,n=xml.length;i<n;++i)HTMLParse._parseXML(parent,xml[i],url,href);else if(3==xml.nodeType)parent instanceof laya.html.dom.HTMLDivElement?(null==xml.nodeName&&(xml.nodeName="#text"),nodeName=xml.nodeName.toLowerCase(),0<(txt=xml.textContent.replace(/^\s+|\s+$/g,"")).length&&(node=ClassUtils.getInstance(nodeName))&&(parent.addChild(node),node.innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern," "))):0<(txt=xml.textContent.replace(/^\s+|\s+$/g,"")).length&&(parent.innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern," "));else if("#comment"!=(nodeName=xml.nodeName.toLowerCase()))if(node=ClassUtils.getInstance(nodeName)){(node=parent.addChild(node)).URI=url,node.href=href;var attributes=xml.attributes;if(attributes&&0<attributes.length)for(i=0,n=attributes.length;i<n;++i){var attribute=attributes[i],attrName=attribute.nodeName,attribute=attribute.value;node._setAttributes(attrName,attribute)}HTMLParse._parseXML(node,xml.childNodes,url,node.href)}else HTMLParse._parseXML(parent,xml.childNodes,url,href)},HTMLParse.char255=String.fromCharCode(255),HTMLParse.spacePattern=/&nbsp;|&#160;/g,HTMLParse.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),HTMLParse}(),Layout=function(){function Layout(){}return __class(Layout,"laya.html.utils.Layout"),Layout.later=function(element){null==Layout._will&&(Layout._will=[],Laya.stage.frameLoop(1,null,function(){if(!(Layout._will.length<1)){for(var i=0;i<Layout._will.length;i++)laya.html.utils.Layout.layout(Layout._will[i]);Layout._will.length=0}})),Layout._will.push(element)},Layout.layout=function(element){if(!element||!element._style)return null;if(0==(512&element._style._type))return null;element.getStyle()._type&=-513;var arr=Layout._multiLineLayout(element);return Render.isConchApp&&element.layaoutCallNative&&element.layaoutCallNative(),arr},Layout._multiLineLayout=function(element){if(Text.RightToLeft)return Layout._multiLineLayout2(element);var oneLayout,curPadding,htmlWord,elements=new Array,i=(element._addChildsToLayout(elements),0),n=elements.length,style=element._getCSSStyle(),letterSpacing=style.letterSpacing,leading=style.leading,lineHeight=style.lineHeight,widthAuto=style._widthAuto()||!style.wordWrap,width=widthAuto?999999:element.width,maxWidth=(element.height,0),exWidth=style.italic?style.fontSize/3:0,align=style._getAlign(),valign=style._getValign(),endAdjust=0!==valign||0!==align||0!=lineHeight,x=0,y=0,w=0,h=0,lines=new Array,curLine=lines[0]=new LayoutLine,newLine=!1,nextNewline=!1,tWordWidth=(curLine.h=0,style.italic&&(width-=style.fontSize/3),0),tLineFirstKey=!0;function addLine(){curLine.y=y,y+=curLine.h+leading,0==curLine.h&&(y+=lineHeight),curLine.mWidth=tWordWidth,tWordWidth=0,curLine=new LayoutLine,lines.push(curLine),curLine.h=0,newLine=!(tLineFirstKey=!(x=0))}for(i=0;i<n;i++)if(null==(oneLayout=elements[i]))tLineFirstKey||(x+=Layout.DIV_ELEMENT_PADDING),curLine.wordStartIndex=curLine.elements.length;else if(tLineFirstKey=!1,oneLayout instanceof laya.html.dom.HTMLBrElement)addLine(),curLine.y=y;else{if(oneLayout._isChar()){if((htmlWord=oneLayout).isWord)newLine=nextNewline||"\n"===htmlWord.char,curLine.wordStartIndex=curLine.elements.length;else{if(0<lines.length&&width<x+w&&0<curLine.wordStartIndex){var tLineWord=curLine.elements.length-curLine.wordStartIndex+1;curLine.elements.length=curLine.wordStartIndex,i-=tLineWord,addLine();continue}newLine=!1,tWordWidth+=htmlWord.width}w=htmlWord.width+letterSpacing,h=htmlWord.height,nextNewline=!1,(newLine=newLine||width<x+w)&&addLine(),curLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height)}else tLineWord=oneLayout._getCSSStyle(),htmlWord=oneLayout,curPadding=tLineWord.padding,0!==tLineWord._getCssFloat()&&(endAdjust=!0),newLine=nextNewline||tLineWord.lineElement,w=htmlWord.width*htmlWord._style._tf.scaleX+curPadding[1]+curPadding[3]+letterSpacing,h=htmlWord.height*htmlWord._style._tf.scaleY+curPadding[0]+curPadding[2],nextNewline=tLineWord.lineElement,(newLine=newLine||width<x+w&&tLineWord.wordWrap)&&addLine();curLine.elements.push(oneLayout),curLine.h=Math.max(curLine.h,h),oneLayout.x=x,oneLayout.y=y,x+=w,curLine.w=x-letterSpacing,curLine.y=y,maxWidth=Math.max(x+exWidth,maxWidth)}if(y=curLine.y+curLine.h,endAdjust){var tY=0,tWidth=width;for(widthAuto&&0<element.width&&(tWidth=element.width),i=0,n=lines.length;i<n;i++)lines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight),tY+=Math.max(lineHeight,lines[i].h+leading);y=tY}return widthAuto&&(element.width=maxWidth),y>element.height&&(element.height=y),[maxWidth,y]},Layout._multiLineLayout2=function(element){var oneLayout,curPadding,htmlWord,elements=new Array,i=(element._addChildsToLayout(elements),0),n=elements.length,style=element._getCSSStyle(),letterSpacing=style.letterSpacing,leading=style.leading,lineHeight=style.lineHeight,widthAuto=style._widthAuto()||!style.wordWrap,width=widthAuto?999999:element.width,maxWidth=(element.height,0),exWidth=style.italic?style.fontSize/3:0,align=2-style._getAlign(),valign=style._getValign(),endAdjust=0!==valign||0!=align||0!=lineHeight,x=0,y=0,w=0,h=0,lines=new Array,curLine=lines[0]=new LayoutLine,newLine=!1,nextNewline=!1,tWordWidth=(curLine.h=0,style.italic&&(width-=style.fontSize/3),0),tLineFirstKey=!0;function addLine(){curLine.y=y,y+=curLine.h+leading,0==curLine.h&&(y+=lineHeight),curLine.mWidth=tWordWidth,tWordWidth=0,curLine=new LayoutLine,lines.push(curLine),curLine.h=0,newLine=!(tLineFirstKey=!(x=0))}for(i=0;i<n;i++)if(null==(oneLayout=elements[i]))tLineFirstKey||(x+=Layout.DIV_ELEMENT_PADDING),curLine.wordStartIndex=curLine.elements.length;else if(tLineFirstKey=!1,oneLayout instanceof laya.html.dom.HTMLBrElement)addLine(),curLine.y=y;else{if(oneLayout._isChar()){if((htmlWord=oneLayout).isWord)newLine=nextNewline||"\n"===htmlWord.char,curLine.wordStartIndex=curLine.elements.length;else{if(0<lines.length&&width<x+w&&0<curLine.wordStartIndex){var tLineWord=curLine.elements.length-curLine.wordStartIndex+1;curLine.elements.length=curLine.wordStartIndex,i-=tLineWord,addLine();continue}newLine=!1,tWordWidth+=htmlWord.width}w=htmlWord.width+letterSpacing,h=htmlWord.height,nextNewline=!1,(newLine=newLine||width<x+w)&&addLine(),curLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height)}else tLineWord=oneLayout._getCSSStyle(),htmlWord=oneLayout,curPadding=tLineWord.padding,0!==tLineWord._getCssFloat()&&(endAdjust=!0),newLine=nextNewline||tLineWord.lineElement,w=htmlWord.width*htmlWord._style._tf.scaleX+curPadding[1]+curPadding[3]+letterSpacing,h=htmlWord.height*htmlWord._style._tf.scaleY+curPadding[0]+curPadding[2],nextNewline=tLineWord.lineElement,(newLine=newLine||width<x+w&&tLineWord.wordWrap)&&addLine();curLine.elements.push(oneLayout),curLine.h=Math.max(curLine.h,h),oneLayout.x=x,oneLayout.y=y,x+=w,curLine.w=x-letterSpacing,curLine.y=y,maxWidth=Math.max(x+exWidth,maxWidth)}if(y=curLine.y+curLine.h,endAdjust){for(var tY=0,tWidth=width,i=0,n=lines.length;i<n;i++)lines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight),tY+=Math.max(lineHeight,lines[i].h+leading);y=tY}for(widthAuto&&(element.width=maxWidth),y>element.height&&(element.height=y),i=0,n=lines.length;i<n;i++)lines[i].revertOrder(width);return[maxWidth,y]},Layout._will=null,Layout.DIV_ELEMENT_PADDING=0,Layout}(),LayoutLine=function(){function LayoutLine(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}__class(LayoutLine,"laya.html.utils.LayoutLine");var __proto=LayoutLine.prototype;return __proto.updatePos=function(left,width,lineNum,dy,align,valign,lineHeight){var w=0,dx=(0<this.elements.length&&(w=(one=this.elements[this.elements.length-1]).x+one.width-this.elements[0].x),0),ddy=NaN;1===align&&(dx=(width-w)/2),2===align&&(dx=width-w),0!==lineHeight&&0==valign&&(valign=1);for(var i=0,n=this.elements.length;i<n;i++){var one,tCSSStyle=(one=this.elements[i])._getCSSStyle();switch(0!==dx&&(one.x+=dx),tCSSStyle._getValign()){case 0:one.y=dy;break;case 1:var tMinTextHeight=0,tMinTextHeight=((tMinTextHeight=99999!=this.minTextHeight?this.minTextHeight:tMinTextHeight)+lineHeight)/2,tMinTextHeight=Math.max(tMinTextHeight,this.h),ddy=(0 instanceof laya.html.dom.HTMLImageElement,dy+tMinTextHeight-one.height);one.y=ddy;break;case 2:one.y=dy+(lineHeight-one.height)}}},__proto.revertOrder=function(width){var one;if(0<this.elements.length)for(var i=0,len=this.elements.length,i=0;i<len;i++)(one=this.elements[i]).x=width-one.x-one.width},LayoutLine}(),HTMLElement=function(_super){function HTMLElement(){this.URI=null,this._href=null,HTMLElement.__super.call(this),this._text=HTMLElement._EMPTYTEXT,this.setStyle(new CSSStyle(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}__class(HTMLElement,"laya.html.dom.HTMLElement",_super);var __proto=HTMLElement.prototype;return __proto.layaoutCallNative=function(){var n=0;if(this._childs&&0<(n=this._childs.length))for(var i=0;i<n;i++)this._childs[i].layaoutCallNative&&this._childs[i].layaoutCallNative();var word=this._getWords();word?laya.html.dom.HTMLElement.fillWords(this,word,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},__proto.appendChild=function(c){return this.addChild(c)},__proto._getWords2=function(){var txt=this._text.text;if(!txt||0===txt.length)return null;var realWords,drawWords,i=0,n=0;if(this._text.drawWords)drawWords=this._text.drawWords;else{for(n=(realWords=txt.split(" ")).length-1,drawWords=[],i=0;i<n;i++)drawWords.push(realWords[i]," ");0<=n&&drawWords.push(realWords[n]),this._text.drawWords=drawWords}var words=this._text.words;if(!words||words.length!==drawWords.length){null===words&&(this._text.words=words=[]),words.length=drawWords.length;for(var style=this.style,fontStr=style.font,i=0,n=drawWords.length;i<n;i++){var tSprite,size=Utils.measureText(drawWords[i],fontStr),size=words[i]=new HTMLChar(drawWords[i],size.width,size.height||style.fontSize,style);1<size.char.length&&(size.charNum=size.char),this.href&&(tSprite=new Sprite,this.addChild(tSprite),size.setSprite(tSprite))}}return words},__proto._getWords=function(){if(!Text.CharacterCache)return this._getWords2();var txt=this._text.text;if(!txt||0===txt.length)return null;var words=this._text.words;if(!words||words.length!==txt.length){null===words&&(this._text.words=words=[]),words.length=txt.length;for(var style=this.style,fontStr=style.font,i=0,n=txt.length;i<n;i++){var tSprite,size=Utils.measureText(txt.charAt(i),fontStr),size=words[i]=new HTMLChar(txt.charAt(i),size.width,size.height||style.fontSize,style);this.href&&(tSprite=new Sprite,this.addChild(tSprite),size.setSprite(tSprite))}}return words},__proto.showLinkSprite=function(){var words=this._text.words;if(words)for(var tSprite,tHtmlChar,tLinkSpriteList=[],i=0;i<words.length;i++)tHtmlChar=words[i],(tSprite=new Sprite).graphics.drawRect(0,0,tHtmlChar.width,tHtmlChar.height,"#ff0000"),tSprite.width=tHtmlChar.width,tSprite.height=tHtmlChar.height,this.addChild(tSprite),tLinkSpriteList.push(tSprite)},__proto._layoutLater=function(){var style=this.style;512&style._type||(style.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&style.block?(Layout.later(this),style._type|=512):this.parent&&this.parent._layoutLater())},__proto._setAttributes=function(name,value){switch(name){case"style":return void this.style.cssText(value);case"class":return void(this.className=value)}_super.prototype._setAttributes.call(this,name,value)},__proto.updateHref=function(){if(null!=this._href){var words=this._getWords();if(words)for(var tHTMLChar,tSprite,i=0;i<words.length;i++)(tSprite=(tHTMLChar=words[i]).getSprite())&&(tSprite.size(tHTMLChar.width,tHTMLChar.height),tSprite.on("click",this,this.onLinkHandler))}},__proto.onLinkHandler=function(e){if("click"===e.type)for(var target=this;target;)target.event("link",[this.href]),target=target.parent},__proto.formatURL=function(url){return this.URI?URL.formatURL(url,this.URI?this.URI.path:null):url},__getset(0,__proto,"href",function(){return this._href},function(url){null!=(this._href=url)&&(this._getCSSStyle().underLine=1,this.updateHref())}),__getset(0,__proto,"color",null,function(value){this.style.color=value}),__getset(0,__proto,"onClick",null,function(value){Laya._runScript("fn=function(event){"+value+";}"),this.on("click",this,void 0)}),__getset(0,__proto,"id",null,function(value){HTMLDocument.document.setElementById(value,this)}),__getset(0,__proto,"innerTEXT",function(){return this._text.text},function(value){this.text=value}),__getset(0,__proto,"style",function(){return this._style}),__getset(0,__proto,"text",function(){return this._text.text},function(value){this._text==HTMLElement._EMPTYTEXT?this._text={text:value,words:null}:(this._text.text=value,this._text.words&&(this._text.words.length=0)),Render.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),__getset(0,__proto,"parent",_super.prototype._$get_parent,function(value){var p;value instanceof laya.html.dom.HTMLElement&&(p=value,this.URI||(this.URI=p.URI),this.style.inherit(p.style)),Laya.superSet(Sprite,this,"parent",value)}),__getset(0,__proto,"className",null,function(value){this.style.attrs(HTMLDocument.document.styleSheets["."+value])}),HTMLElement.fillWords=function(ele,words,x,y,font,color,underLine){ele.graphics.clear();for(var i=0,n=words.length;i<n;i++){var a=words[i];ele.graphics.fillText(a.char,a.x+x,a.y+y,font,color,"left",underLine)}},HTMLElement._EMPTYTEXT={text:null,words:null},HTMLElement}(Sprite),HTMLDivElement=(function(){function HTMLBrElement(){HTMLBrElement.__super.call(this),this.style.lineElement=!0,this.style.block=!0}__class(HTMLBrElement,"laya.html.dom.HTMLBrElement",HTMLElement)}(),function(_super){function HTMLDivElement(){this.contextHeight=NaN,this.contextWidth=NaN,HTMLDivElement.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}__class(HTMLDivElement,"laya.html.dom.HTMLDivElement",_super);var __proto=HTMLDivElement.prototype;return __proto.appendHTML=function(text){HTMLParse.parse(this,text,this.URI),this.layout()},__proto._addChildsToLayout=function(out){var words=this._getWords();if(null==words&&0==this._childs.length)return!1;words&&words.forEach(function(o){out.push(o)});for(var tFirstKey=!0,i=0,len=this._childs.length;i<len;i++){var o=this._childs[i];tFirstKey?tFirstKey=!1:out.push(null),o._addToLayout(out)}return!0},__proto._addToLayout=function(out){this.layout()},__proto.layout=function(){var tArray,tRectangle;this.style&&(this.style._type|=512,tArray=Layout.layout(this))&&(this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new Rectangle),(tRectangle=this._$P.mHtmlBounds).x=tRectangle.y=0,tRectangle.width=this.contextWidth=tArray[0],tRectangle.height=this.contextHeight=tArray[1],this.setBounds(tRectangle))},__getset(0,__proto,"height",function(){return this._height||this.contextHeight},_super.prototype._$set_height),__getset(0,__proto,"innerHTML",null,function(text){this.destroyChildren(),this.appendHTML(text)}),__getset(0,__proto,"width",function(){return this._width||this.contextWidth},function(value){var changed=!1,changed=0===value?value!=this._width:value!=this.width;Laya.superSet(HTMLElement,this,"width",value),changed&&this.layout()}),HTMLDivElement}(HTMLElement)),HTMLDocument=function(){function HTMLDocument(){this.all=new Array,this.styleSheets=CSSStyle.styleSheets,HTMLDocument.__super.call(this)}__class(HTMLDocument,"laya.html.dom.HTMLDocument",HTMLElement);var __proto=HTMLDocument.prototype;return __proto.getElementById=function(id){return this.all[id]},__proto.setElementById=function(id,e){this.all[id]=e},__static(HTMLDocument,["document",function(){return this.document=new HTMLDocument}]),HTMLDocument}();(function(){function HTMLImageElement(){this._tex=null,this._url=null,this._renderArgs=[],HTMLImageElement.__super.call(this),this.style.block=!0}__class(HTMLImageElement,"laya.html.dom.HTMLImageElement",HTMLElement);var __proto=HTMLImageElement.prototype;__proto._addToLayout=function(out){this._style.absolute||out.push(this)},__proto.render=function(context,x,y){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(Stat.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,context.ctx.drawTexture2(x,y,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},__proto.layaoutCallNative=function(){var n=0;if(this._childs&&0<(n=this._childs.length))for(var i=0;i<n;i++)this._childs[i].layaoutCallNative&&this._childs[i].layaoutCallNative()},__getset(0,__proto,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(value){this._width!==value&&(this._width=value,this._style.width=value,this.repaint())}),__getset(0,__proto,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(value){this._height!==value&&(this._height=value,this._style.height=value,this.repaint())}),__proto.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),Loader.clearCache(this,this._url),this._tex=null),HTMLElement.prototype.destroy.call(this)},__proto.onloaded=function(){var style=this._style;style.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),style.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),Render.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},__getset(0,__proto,"src",null,function(url){var tex;url=this.formatURL(url),this._url!=url&&(null!=this._tex&&(Loader.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=url,Loader.keepCache(this,url),(tex=this._tex=Loader.getRes(url))||(this._tex=tex=Laya.loader.create(url,null,null,Texture)),tex.loaded?this.onloaded():tex.once("loaded",this,this.onloaded))})})(),function(_super){function HTMLLinkElement(){this.type=null,HTMLLinkElement.__super.call(this),this.visible=!1}__class(HTMLLinkElement,"laya.html.dom.HTMLLinkElement",_super);var __proto=HTMLLinkElement.prototype;__proto._onload=function(data){"text/css"===this.type&&CSSStyle.parseCSS(data,this.URI)},__getset(0,__proto,"href",_super.prototype._$get_href,function(url){var _$this=this,l=(url=this.formatURL(url),this.URI=new URL(url),new Loader);l.once("complete",null,function(data){_$this._onload(data)}),l.load(url,"text")}),HTMLLinkElement._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(HTMLElement),function(_super){function HTMLStyleElement(){HTMLStyleElement.__super.call(this),this.visible=!1}__class(HTMLStyleElement,"laya.html.dom.HTMLStyleElement",_super),__getset(0,HTMLStyleElement.prototype,"text",_super.prototype._$get_text,function(value){CSSStyle.parseCSS(value,null)})}(HTMLElement),function(_super){function HTMLIframeElement(){HTMLIframeElement.__super.call(this),this._getCSSStyle().valign="middle"}__class(HTMLIframeElement,"laya.html.dom.HTMLIframeElement",_super),__getset(0,HTMLIframeElement.prototype,"href",_super.prototype._$get_href,function(url){var _$this=this,l=(url=this.formatURL(url),new Loader);l.once("complete",null,function(data){var pre=_$this.URI;_$this.URI=new URL(url),_$this.innerHTML=data,pre&&(_$this.URI=pre)}),l.load(url,"text")})}(HTMLDivElement)}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(require,exports){"use strict";for(var i in Object.defineProperty(exports,"__esModule",{value:!0}),Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o)}}),!function(Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,Animation=(Laya.__newvec,laya.display.Animation),ClassUtils=(laya.utils.Browser,laya.utils.ClassUtils),ColorFilter=laya.filters.ColorFilter,Ease=laya.utils.Ease,Event=laya.events.Event,Font=(laya.events.EventDispatcher,laya.display.css.Font),FrameAnimation=laya.display.FrameAnimation,Graphics=laya.display.Graphics,Handler=laya.utils.Handler,Input=laya.display.Input,Loader=laya.net.Loader,Point=(laya.display.Node,laya.maths.Point),Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,Sprite=laya.display.Sprite,Text=laya.display.Text,Texture=laya.resource.Texture,Tween=laya.utils.Tween,Utils=laya.utils.Utils,WeakObject=laya.utils.WeakObject,LayoutStyle=(Laya.interface("laya.ui.IItem"),Laya.interface("laya.ui.ISelect"),Laya.interface("laya.ui.IRender"),Laya.interface("laya.ui.IComponent"),Laya.interface("laya.ui.IBox","IComponent"),function(){function LayoutStyle(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return __class(LayoutStyle,"laya.ui.LayoutStyle"),__static(LayoutStyle,["EMPTY",function(){return this.EMPTY=new LayoutStyle}]),LayoutStyle}()),Styles=function(){function Styles(){}return __class(Styles,"laya.ui.Styles"),Styles.labelColor="#000000",Styles.buttonStateNum=3,Styles.scrollBarMinNum=15,Styles.scrollBarDelayTime=500,__static(Styles,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),Styles}(),UIUtils=function(){function UIUtils(){}return __class(UIUtils,"laya.ui.UIUtils"),UIUtils.fillArray=function(arr,str,type){var temp=arr.concat();if(str)for(var a=str.split(","),i=0,n=Math.min(temp.length,a.length);i<n;i++){var value=a[i];temp[i]="true"==value||"false"!=value&&value,null!=type&&(temp[i]=type(value))}return temp},UIUtils.toColor=function(color){return Utils.toHexColor(color)},UIUtils.gray=function(traget,isGray){(isGray=void 0===isGray?!0:isGray)?UIUtils.addFilter(traget,UIUtils.grayFilter):UIUtils.clearFilter(traget,ColorFilter)},UIUtils.addFilter=function(target,filter){var filters=target.filters||[];filters.push(filter),target.filters=filters},UIUtils.clearFilter=function(target,filterType){var filters=target.filters;if(null!=filters&&0<filters.length){for(var i=filters.length-1;-1<i;i--){var filter=filters[i];Laya.__typeof(filter,filterType)&&filters.splice(i,1)}target.filters=filters}},UIUtils._getReplaceStr=function(word){return UIUtils.escapeSequence[word]},UIUtils.adptString=function(str){return str.replace(/\\(\w)/g,UIUtils._getReplaceStr)},UIUtils.getBindFun=function(value){var temp,fun=UIUtils._funMap.get(value);return null==fun&&(temp=(temp='"'+value+'"').replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'),fun=Laya._runScript("(function(data){if(data==null)return;with(data){try{\nreturn "+temp+"\n}catch(e){}}})"),UIUtils._funMap.set(value,fun)),fun},__static(UIUtils,["grayFilter",function(){return this.grayFilter=new ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new WeakObject}]),UIUtils}(),UIConfig=function(){function UIConfig(){}return __class(UIConfig,"UIConfig"),UIConfig.touchScrollEnable=!0,UIConfig.mouseWheelEnable=!0,UIConfig.showButtons=!0,UIConfig.popupBgColor="#000000",UIConfig.popupBgAlpha=.5,UIConfig.closeDialogOnSide=!0,UIConfig}(),AutoBitmap=function(_super){function AutoBitmap(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,AutoBitmap.__super.call(this),this._weakKeys=[]}__class(AutoBitmap,"laya.ui.AutoBitmap",_super);var __proto=AutoBitmap.prototype;return __proto.destroy=function(){if(Loader.clearObject(this,this._weakKey),this._weakKeys){for(var i=0,length=this._weakKeys.length;i<length;++i)Loader.clearObject(this,this._weakKeys[i]);this._weakKeys=null}_super.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},__proto._setChanged=function(){this._isChanged||(this._isChanged=!0,Laya.timer.callLater(this,this.changeSource))},__proto.changeSource=function(){this._isChanged=!1;var source=this._source;if(source&&source.bitmap){var width=this.width,height=this.height,sizeGrid=this._sizeGrid,sw=source.sourceWidth,sh=source.sourceHeight;if(!sizeGrid||sw===width&&sh===height)this.cleanByTexture(source,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,width,height);else{Loader.clearObject(this,this._weakKey),source.$_GID||(source.$_GID=Utils.getGID());var key=source.$_GID+"."+width+"."+height+"."+sizeGrid.join("."),cmds=Loader.findObject(key);if(Utils.isOKCmdList(cmds))return this._weakKey=key,Loader.keepObject(this,this._weakKey),void(this.cmds=cmds);this.clear();var clipWidth,t,weakKey,cmds=sizeGrid[0],right=sizeGrid[1],bottom=sizeGrid[2],left=sizeGrid[3],sizeGrid=sizeGrid[4],needClip=!1;height==sh&&(cmds=bottom=0),width<(left=width==sw?right=0:left)+right&&(clipWidth=width,needClip=!0,width=left+right,this.save(),this.clipRect(0,0,clipWidth,height)),left&&cmds&&(t=AutoBitmap.getTexture(source,0,0,left,cmds),weakKey=this._weakKeys[0],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[0]=t.weakKey),this.drawTexture(t,0,0,left,cmds)):(Loader.clearObject(this,weakKey),this._weakKeys[0]="")),right&&cmds&&(t=AutoBitmap.getTexture(source,sw-right,0,right,cmds),weakKey=this._weakKeys[1],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[1]=t.weakKey),this.drawTexture(t,width-right,0,right,cmds)):(Loader.clearObject(this,weakKey),this._weakKeys[1]="")),left&&bottom&&(t=AutoBitmap.getTexture(source,0,sh-bottom,left,bottom),weakKey=this._weakKeys[2],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[2]=t.weakKey),this.drawTexture(t,0,height-bottom,left,bottom)):(Loader.clearObject(this,weakKey),this._weakKeys[2]="")),right&&bottom&&(t=AutoBitmap.getTexture(source,sw-right,sh-bottom,right,bottom),weakKey=this._weakKeys[3],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[3]=t.weakKey),this.drawTexture(t,width-right,height-bottom,right,bottom)):(Loader.clearObject(this,weakKey),this._weakKeys[3]="")),cmds&&(t=AutoBitmap.getTexture(source,left,0,sw-left-right,cmds),weakKey=this._weakKeys[4],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[4]=t.weakKey),this.drawBitmap(sizeGrid,t,left,0,width-left-right,cmds)):(Loader.clearObject(this,weakKey),this._weakKeys[4]="")),bottom&&(t=AutoBitmap.getTexture(source,left,sh-bottom,sw-left-right,bottom),weakKey=this._weakKeys[5],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[5]=t.weakKey),this.drawBitmap(sizeGrid,t,left,height-bottom,width-left-right,bottom)):(Loader.clearObject(this,weakKey),this._weakKeys[5]="")),left&&(t=AutoBitmap.getTexture(source,0,cmds,left,sh-cmds-bottom),weakKey=this._weakKeys[6],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[6]=t.weakKey),this.drawBitmap(sizeGrid,t,0,cmds,left,height-cmds-bottom)):(Loader.clearObject(this,weakKey),this._weakKeys[6]="")),right&&(t=AutoBitmap.getTexture(source,sw-right,cmds,right,sh-cmds-bottom),weakKey=this._weakKeys[7],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[7]=t.weakKey),this.drawBitmap(sizeGrid,t,width-right,cmds,right,height-cmds-bottom)):(Loader.clearObject(this,weakKey),this._weakKeys[7]="")),t=AutoBitmap.getTexture(source,left,cmds,sw-left-right,sh-cmds-bottom),weakKey=this._weakKeys[8],t?(weakKey!=t.weakKey&&(Loader.clearObject(this,weakKey),Loader.keepObject(this,t.weakKey),this._weakKeys[8]=t.weakKey),this.drawBitmap(sizeGrid,t,left,cmds,width-left-right,height-cmds-bottom)):(Loader.clearObject(this,weakKey),this._weakKeys[8]=""),needClip&&this.restore(),this.autoCacheCmd&&!Render.isConchApp&&(Loader.saveObject(key,this.cmds,null),this._weakKey=key,Loader.keepObject(this,this._weakKey))}this._repaint()}},__proto.drawBitmap=function(repeat,tex,x,y,width,height){void 0===height&&(height=0),(width=void 0===width?0:width)<.1||height<.1||(!repeat||tex.width==width&&tex.height==height?this.drawTexture(tex,x,y,width,height):this.fillTexture(tex,x,y,width,height))},__proto.clear=function(recoverCmds){void 0===recoverCmds&&(recoverCmds=!0),_super.prototype.clear.call(this,!1)},__getset(0,__proto,"sizeGrid",function(){return this._sizeGrid},function(value){this._sizeGrid=value,this._setChanged()}),__getset(0,__proto,"width",function(){return this._width||(this._source?this._source.sourceWidth:0)},function(value){this._width!=value&&(this._width=value,this._setChanged())}),__getset(0,__proto,"height",function(){return this._height||(this._source?this._source.sourceHeight:0)},function(value){this._height!=value&&(this._height=value,this._setChanged())}),__getset(0,__proto,"source",function(){return this._source},function(value){value?(this._source=value,this._setChanged()):(this._source=null,this.clear())}),AutoBitmap.getTexture=function(tex,x,y,width,height){width<=0&&(width=1),height<=0&&(height=1),tex.$_GID||(tex.$_GID=Utils.getGID());var key=tex.$_GID+"."+x+"."+y+"."+width+"."+height,texture=Loader.findObject(key);return texture&&texture.source||(texture=Texture.createFromTexture(tex,x,y,width,height))&&(Loader.saveObject(key,texture),texture.weakKey=key),texture},AutoBitmap}(Graphics),Component=(function(){function UIEvent(){UIEvent.__super.call(this)}__class(UIEvent,"laya.ui.UIEvent",Event),UIEvent.SHOW_TIP="showtip",UIEvent.HIDE_TIP="hidetip"}(),function(_super){function Component(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,Component.__super.call(this),this._layout=LayoutStyle.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}__class(Component,"laya.ui.Component",_super);var __proto=Component.prototype;return Laya.imps(__proto,{"laya.ui.IComponent":!0}),__proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},__proto.preinitialize=function(){},__proto.createChildren=function(){},__proto.initialize=function(){},__proto.callLater=function(method,args){Laya.timer.callLater(this,method,args)},__proto.runCallLater=function(method){Laya.timer.runCallLater(this,method)},__proto.commitMeasure=function(){},__proto.changeSize=function(){this.event("resize")},__proto.getLayout=function(){return this._layout===LayoutStyle.EMPTY&&(this._layout=new LayoutStyle),this._layout},__proto._setLayoutEnabled=function(value){this._layout&&this._layout.enable!=value&&(this._layout.enable=value,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent)&&this.onAdded()},__proto.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},__proto.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},__proto.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},__proto.resetLayoutX=function(){var parent,layout=this._layout;isNaN(layout.anchorX)||(this.pivotX=layout.anchorX*this.width),this.layoutEnabled&&(parent=this.parent)&&(isNaN(layout.centerX)?isNaN(layout.left)?isNaN(layout.right)||(this.x=Math.round(parent.width-this.displayWidth-layout.right+this.pivotX*this.scaleX)):(this.x=Math.round(layout.left+this.pivotX*this.scaleX),isNaN(layout.right)||(this.width=(parent._width-layout.left-layout.right)/(this.scaleX||.01))):this.x=Math.round(.5*(parent.width-this.displayWidth)+layout.centerX+this.pivotX*this.scaleX))},__proto.resetLayoutY=function(){var parent,layout=this._layout;isNaN(layout.anchorY)||(this.pivotY=layout.anchorY*this.height),this.layoutEnabled&&(parent=this.parent)&&(isNaN(layout.centerY)?isNaN(layout.top)?isNaN(layout.bottom)||(this.y=Math.round(parent.height-this.displayHeight-layout.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(layout.top+this.pivotY*this.scaleY),isNaN(layout.bottom)||(this.height=(parent._height-layout.top-layout.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(parent.height-this.displayHeight)+layout.centerY+this.pivotY*this.scaleY))},__proto.onMouseOver=function(e){Laya.stage.event("showtip",this._toolTip)},__proto.onMouseOut=function(e){Laya.stage.event("hidetip",this._toolTip)},__getset(0,__proto,"displayWidth",function(){return this.width*this.scaleX}),__getset(0,__proto,"width",function(){return this._width||this.measureWidth},function(value){this._width!=value&&(this._width=value,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),__getset(0,__proto,"measureWidth",function(){var max=0;this.commitMeasure();for(var i=this.numChildren-1;-1<i;i--){var comp=this.getChildAt(i);comp.visible&&(max=Math.max(comp.x+comp.width*comp.scaleX,max))}return max}),__getset(0,__proto,"displayHeight",function(){return this.height*this.scaleY}),__getset(0,__proto,"height",function(){return this._height||this.measureHeight},function(value){this._height!=value&&(this._height=value,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),__getset(0,__proto,"dataSource",function(){return this._dataSource},function(value){for(var prop in this._dataSource=value,this._dataSource)this.hasOwnProperty(prop)&&"function"!=typeof this[prop]&&(this[prop]=this._dataSource[prop])}),__getset(0,__proto,"scaleY",_super.prototype._$get_scaleY,function(value){Laya.superGet(Sprite,this,"scaleY")!=value&&(Laya.superSet(Sprite,this,"scaleY",value),this.callLater(this.changeSize),this._layout.enable)&&this.resetLayoutY()}),__getset(0,__proto,"measureHeight",function(){var max=0;this.commitMeasure();for(var i=this.numChildren-1;-1<i;i--){var comp=this.getChildAt(i);comp.visible&&(max=Math.max(comp.y+comp.height*comp.scaleY,max))}return max}),__getset(0,__proto,"scaleX",_super.prototype._$get_scaleX,function(value){Laya.superGet(Sprite,this,"scaleX")!=value&&(Laya.superSet(Sprite,this,"scaleX",value),this.callLater(this.changeSize),this._layout.enable)&&this.resetLayoutX()}),__getset(0,__proto,"top",function(){return this._layout.top},function(value){value!=this._layout.top&&(this.getLayout().top=value,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,__proto,"bottom",function(){return this._layout.bottom},function(value){value!=this._layout.bottom&&(this.getLayout().bottom=value,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,__proto,"left",function(){return this._layout.left},function(value){value!=this._layout.left&&(this.getLayout().left=value,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,__proto,"right",function(){return this._layout.right},function(value){value!=this._layout.right&&(this.getLayout().right=value,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,__proto,"centerX",function(){return this._layout.centerX},function(value){value!=this._layout.centerX&&(this.getLayout().centerX=value,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,__proto,"centerY",function(){return this._layout.centerY},function(value){value!=this._layout.centerY&&(this.getLayout().centerY=value,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,__proto,"anchorX",function(){return this._layout.anchorX},function(value){value!=this._layout.anchorX&&(this.getLayout().anchorX=value,this._setLayoutEnabled(!0)),this.resetLayoutX()}),__getset(0,__proto,"anchorY",function(){return this._layout.anchorY},function(value){value!=this._layout.anchorY&&(this.getLayout().anchorY=value,this._setLayoutEnabled(!0)),this.resetLayoutY()}),__getset(0,__proto,"tag",function(){return this._tag},function(value){this._tag=value}),__getset(0,__proto,"toolTip",function(){return this._toolTip},function(value){this._toolTip!=value&&(null!=(this._toolTip=value)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),__getset(0,__proto,"comXml",function(){return this._comXml},function(value){this._comXml=value}),__getset(0,__proto,"gray",function(){return this._gray},function(value){value!==this._gray&&(this._gray=value,UIUtils.gray(this,value))}),__getset(0,__proto,"disabled",function(){return this._disabled},function(value){value!==this._disabled&&(this.gray=this._disabled=value,this.mouseEnabled=!value)}),Component}(Sprite)),DialogManager=function(){function DialogManager(){this.lockLayer=null,this.popupEffect=function(dialog){dialog.scale(1,1),Tween.from(dialog,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Ease.backOut,Handler.create(this,this.doOpen,[dialog]))},this.closeEffect=function(dialog,type){Tween.to(dialog,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Ease.strongOut,Handler.create(this,this.doClose,[dialog,type]))},DialogManager.__super.call(this),this.maskLayer=new Sprite,this.popupEffectHandler=Handler.create(this,this.popupEffect,null,!1),this.closeEffectHandler=Handler.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,Laya.stage.addChild(this),Laya.stage.on("resize",this,this._onResize),UIConfig.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}__class(DialogManager,"laya.ui.DialogManager",Sprite);var __proto=DialogManager.prototype;return __proto._closeOnSide=function(){var dialog=this.getChildAt(this.numChildren-1);dialog instanceof laya.ui.Dialog&&dialog.close("side")},__proto.setLockView=function(value){this.lockLayer||(this.lockLayer=new Box,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(Laya.stage.width,Laya.stage.height)),this.lockLayer.removeChildren(),value&&(value.centerX=value.centerY=0,this.lockLayer.addChild(value))},__proto._onResize=function(e){var width=this.maskLayer.width=Laya.stage.width,height=this.maskLayer.height=Laya.stage.height;this.lockLayer&&this.lockLayer.size(width,height),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,width,height,UIConfig.popupBgColor),this.maskLayer.alpha=UIConfig.popupBgAlpha;for(var i=this.numChildren-1;-1<i;i--){var item=this.getChildAt(i);item.popupCenter&&this._centerDialog(item)}},__proto._centerDialog=function(dialog){dialog.x=Math.round((Laya.stage.width-dialog.width>>1)+dialog.pivotX),dialog.y=Math.round((Laya.stage.height-dialog.height>>1)+dialog.pivotY)},__proto.open=function(dialog,closeOther,showEffect){void 0===showEffect&&(showEffect=!1),(closeOther=void 0===closeOther?!1:closeOther)&&this._closeAll(),dialog.popupCenter&&this._centerDialog(dialog),this.addChild(dialog),(dialog.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),showEffect&&null!=dialog.popupEffect?dialog.popupEffect.runWith(dialog):this.doOpen(dialog),this.event("open")},__proto.doOpen=function(dialog){dialog.onOpened()},__proto.lock=function(value){this.lockLayer&&(value?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},__proto.close=function(dialog,type,showEffect){(showEffect=void 0===showEffect?!1:showEffect)&&null!=dialog.closeEffect?dialog.closeEffect.runWith([dialog,type]):this.doClose(dialog,type),this.event("close")},__proto.doClose=function(dialog,type){dialog.removeSelf(),dialog.isModal&&this._checkMask(),dialog.closeHandler&&dialog.closeHandler.runWith(type),dialog.onClosed(type)},__proto.closeAll=function(){this._closeAll(),this.event("close")},__proto._closeAll=function(){for(var i=this.numChildren-1;-1<i;i--){var item=this.getChildAt(i);item&&null!=item.close&&this.doClose(item)}},__proto.getDialogsByGroup=function(group){for(var arr=[],i=this.numChildren-1;-1<i;i--){var item=this.getChildAt(i);item&&item.group===group&&arr.push(item)}return arr},__proto.closeByGroup=function(group){for(var arr=[],i=this.numChildren-1;-1<i;i--){var item=this.getChildAt(i);item&&item.group===group&&(item.close(),arr.push(item))}return arr},__proto._checkMask=function(){this.maskLayer.removeSelf();for(var i=this.numChildren-1;-1<i;i--){var dialog=this.getChildAt(i);if(dialog&&dialog.isModal)return void this.addChildAt(this.maskLayer,i)}},DialogManager}(),Box=function(_super){function Box(){Box.__super.call(this)}__class(Box,"laya.ui.Box",_super);var __proto=Box.prototype;return Laya.imps(__proto,{"laya.ui.IBox":!0}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){for(var name in this._dataSource=value){var comp=this.getChildByName(name);comp?comp.dataSource=value[name]:this.hasOwnProperty(name)&&"function"!=typeof this[name]&&(this[name]=value[name])}}),Box}(Component),Button=function(_super){function Button(skin,label){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,Button.__super.call(this),this._labelColors=Styles.buttonLabelColors,this._stateNum=Styles.buttonStateNum,void 0===label&&(label=""),this.skin=skin,this.label=label}__class(Button,"laya.ui.Button",_super);var __proto=Button.prototype;return Laya.imps(__proto,{"laya.ui.ISelect":!0}),__proto.destroy=function(destroyChild){Loader.clearCache(this,this._skin),Loader.clearObject(this,this._weakKey),_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(destroyChild),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap},__proto.createText=function(){this._text||(this._text=new Text,this._text.overflow=Text.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},__proto.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},__proto.onMouse=function(e){!1===this.toggle&&this._selected||("click"===e.type?(this.toggle&&(this.selected=!this._selected),this._clickHandler&&this._clickHandler.run()):this._selected||(this.state=Button.stateMap[e.type]))},__proto.changeClips=function(){var img=Loader.getRes(this._skin);if(img){Loader.clearObject(this,this._weakKey);var width=img.sourceWidth,height=img.sourceHeight/this._stateNum,key=(img.$_GID||(img.$_GID=Utils.getGID()),img.$_GID+"-"+this._stateNum),clips=Loader.findObject(key);if(clips=Utils.isOkTextureList(clips)?clips:null)this._weakKey=key,Loader.keepObject(this,this._weakKey),this._sources=clips;else{if(this._sources=[],1===this._stateNum)this._sources.push(img);else for(var i=0;i<this._stateNum;i++){var texture=Texture.createFromTexture(img,0,height*i,width,height);this._sources.push(texture)}Loader.saveObject(key,this._sources),this._weakKey=key,Loader.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||width,this._bitmap.height=this._height||height,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=width)}else console.log("lose skin",this._skin)},__proto.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var index=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[index]),this.label&&(this._text.color=this._labelColors[index],this._strokeColors)&&(this._text.strokeColor=this._strokeColors[index])},__proto._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},__getset(0,__proto,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(value){this.createText(),this._text.strokeColor=value}),__getset(0,__proto,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(Loader.clearCache(this,this._skin),this._skin=value,Loader.keepCache(this,this._skin),this.callLater(this.changeClips),this._setStateChanged())}),__getset(0,__proto,"state",function(){return this._state},function(value){this._state!=value&&(this._state=value,this._setStateChanged())}),__getset(0,__proto,"text",function(){return this.createText(),this._text}),__getset(0,__proto,"stateNum",function(){return this._stateNum},function(value){"string"==typeof value&&(value=parseInt(value)),this._stateNum!=value&&(this._stateNum=value<1?1:3<value?3:value,this.callLater(this.changeClips))}),__getset(0,__proto,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(value){this._strokeColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String),this._setStateChanged()}),__getset(0,__proto,"labelColors",function(){return this._labelColors.join(",")},function(value){this._labelColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String),this._setStateChanged()}),__getset(0,__proto,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),__getset(0,__proto,"label",function(){return this._text?this._text.text:null},function(value){(this._text||value)&&(this.createText(),this._text.text!=value)&&(value&&!this._text.parent&&this.addChild(this._text),this._text.text=(value+"").replace(/\\n/g,"\n"),this._setStateChanged())}),__getset(0,__proto,"selected",function(){return this._selected},function(value){this._selected!=value&&(this._selected=value,this.state=this._selected?2:0,this.event("change"))}),__getset(0,__proto,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(value){this.createText(),this._text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number)}),__getset(0,__proto,"labelSize",function(){return this.createText(),this._text.fontSize},function(value){this.createText(),this._text.fontSize=value}),__getset(0,__proto,"labelStroke",function(){return this.createText(),this._text.stroke},function(value){this.createText(),this._text.stroke=value}),__getset(0,__proto,"labelBold",function(){return this.createText(),this._text.bold},function(value){this.createText(),this._text.bold=value}),__getset(0,__proto,"labelFont",function(){return this.createText(),this._text.font},function(value){this.createText(),this._text.font=value}),__getset(0,__proto,"labelAlign",function(){return this.createText(),this._text.align},function(value){this.createText(),this._text.align=value}),__getset(0,__proto,"clickHandler",function(){return this._clickHandler},function(value){this._clickHandler=value}),__getset(0,__proto,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Component,this,"width",value),this._autoSize&&(this._bitmap.width=value,this._text)&&(this._text.width=value)}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Component,this,"height",value),this._autoSize&&(this._bitmap.height=value,this._text)&&(this._text.height=value)}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)||"string"==typeof value?this.label=value+"":Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(value){this._bitmap._offset=value?UIUtils.fillArray([1,1],value,Number):[]}),__static(Button,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),Button}(Component),Clip=function(_super){function Clip(url,clipX,clipY){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,Clip.__super.call(this),void 0===clipY&&(clipY=1),this._clipX=clipX=void 0===clipX?1:clipX,this._clipY=clipY,this.skin=url}__class(Clip,"laya.ui.Clip",_super);var __proto=Clip.prototype;return __proto.destroy=function(destroyChild){Loader.clearCache(this,this._skin),Loader.clearObject(this,this._weakKey),void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},__proto.dispose=function(){this.destroy(!0),Laya.loader.clearRes(this._skin)},__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap},__proto._onDisplay=function(e){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},__proto.changeClip=function(){var img;this._clipChanged=!1,this._skin&&((img=Loader.getRes(this._skin))?this.loadComplete(this._skin,img):Laya.loader.load(this._skin,Handler.create(this,this.loadComplete,[this._skin])))},__proto.loadComplete=function(url,img){if(url===this._skin&&img){Loader.clearObject(this,this._weakKey);var w=this._clipWidth||Math.ceil(img.sourceWidth/this._clipX),h=this._clipHeight||Math.ceil(img.sourceHeight/this._clipY),url=this._skin+w+h,clips=Loader.findObject(url);if(clips=Utils.isOkTextureList(clips)?clips:null)this._weakKey=url,Loader.keepObject(this,this._weakKey),this._sources=clips;else{this._sources=[];for(var i=0;i<this._clipY;i++)for(var j=0;j<this._clipX;j++){var texture=Texture.createFromTexture(img,w*j,h*i,w,h);this._sources.push(texture)}Loader.saveObject(url,this._sources),this._weakKey=url,Loader.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},__proto.play=function(from,to){void 0===from&&(from=0),void 0===to&&(to=-1),this._isPlaying=!0,this.index=from,this._toIndex=to,this._index++,Laya.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},__proto._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},__proto.stop=function(){this._isPlaying=!1,Laya.timer.clear(this,this._loop),this.event("complete")},__proto._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},__getset(0,__proto,"interval",function(){return this._interval},function(value){this._interval!=value&&(this._interval=value,this._isPlaying)&&this.play()}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(Loader.clearCache(this,this._skin),(this._skin=value)?(Loader.keepCache(this,this._skin),this._setClipChanged()):this._bitmap.source=null)}),__getset(0,__proto,"sources",function(){return this._sources},function(value){this._sources=value,this.index=this._index,this.event("loaded")}),__getset(0,__proto,"clipX",function(){return this._clipX},function(value){this._clipX=value||1,this._setClipChanged()}),__getset(0,__proto,"clipY",function(){return this._clipY},function(value){this._clipY=value||1,this._setClipChanged()}),__getset(0,__proto,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),__getset(0,__proto,"clipWidth",function(){return this._clipWidth},function(value){this._clipWidth=value,this._setClipChanged()}),__getset(0,__proto,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"group",function(){return this._group},function(value){value&&this._skin&&Loader.setGroup(this._skin,value),this._group=value}),__getset(0,__proto,"clipHeight",function(){return this._clipHeight},function(value){this._clipHeight=value,this._setClipChanged()}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Component,this,"width",value),this._bitmap.width=value}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Component,this,"height",value),this._bitmap.height=value}),__getset(0,__proto,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),__getset(0,__proto,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),__getset(0,__proto,"index",function(){return this._index},function(value){this._index=value,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[value]),this.event("change")}),__getset(0,__proto,"autoPlay",function(){return this._autoPlay},function(value){this._autoPlay!=value&&((this._autoPlay=value)?this.play():this.stop())}),__getset(0,__proto,"isPlaying",function(){return this._isPlaying},function(value){this._isPlaying=value}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)&&Math.floor(value)==value||"string"==typeof value?this.index=parseInt(value):Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"bitmap",function(){return this._bitmap}),Clip}(Component),ColorPicker=function(_super){function ColorPicker(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,ColorPicker.__super.call(this)}__class(ColorPicker,"laya.ui.ColorPicker",_super);var __proto=ColorPicker.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._colorPanel&&this._colorPanel.destroy(destroyChild),this._colorButton&&this._colorButton.destroy(destroyChild),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},__proto.createChildren=function(){this.addChild(this._colorButton=new Button),this._colorPanel=new Box,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new Sprite),this._colorPanel.addChild(this._colorBlock=new Sprite),this._colorPanel.addChild(this._colorInput=new Input)},__proto.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},__proto.onPanelMouseDown=function(e){e.stopPropagation()},__proto.changePanel=function(){this._panelChanged=!1;for(var g=this._colorPanel.graphics,mainColors=(g.clear(),g.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(g=this._colorTiles.graphics).clear(),[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935]),i=0;i<12;i++)for(var j=0;j<20;j++){var color=0,color=0===j?mainColors[i]:1===j?0:51*(((3*i+j/6)%3<<0)+3*(i/6<<0))<<16|j%6*51<<8|(i<<0)%6*51,color=UIUtils.toColor(color),x=(this._colors.push(color),j*this._gridSize),y=i*this._gridSize;g.drawRect(x,y,this._gridSize,this._gridSize,color,"#000000")}},__proto.onColorButtonClick=function(e){this._colorPanel.parent?this.close():this.open()},__proto.open=function(){var p=this.localToGlobal(new Point),px=p.x+this._colorPanel.width<=Laya.stage.width?p.x:Laya.stage.width-this._colorPanel.width,py=(py=p.y+this._colorButton.height)+this._colorPanel.height<=Laya.stage.height?py:p.y-this._colorPanel.height;this._colorPanel.pos(px,py),this._colorPanel.zOrder=1001,Laya._currentStage.addChild(this._colorPanel),Laya.stage.on("mousedown",this,this.removeColorBox)},__proto.close=function(){Laya.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},__proto.removeColorBox=function(e){this.close()},__proto.onColorFieldKeyDown=function(e){13==e.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),e.stopPropagation())},__proto.onColorInputChange=function(e){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},__proto.onColorTilesClick=function(e){this.selectedColor=this.getColorByMouse(),this.close()},__proto.onColorTilesMouseMove=function(e){this._colorInput.focus=!1;var color=this.getColorByMouse();this._colorInput.text=color,this.drawBlock(color)},__proto.getColorByMouse=function(){var point=this._colorTiles.getMousePoint(),x=Math.floor(point.x/this._gridSize),point=Math.floor(point.y/this._gridSize);return this._colors[20*point+x]},__proto.drawBlock=function(color){var g=this._colorBlock.graphics,showColor=(g.clear(),color||"#ffffff");g.drawRect(0,0,50,20,showColor,this._borderColor),color||g.drawLine(0,0,50,20,"#ff0000")},__proto.changeColor=function(){var g=this.graphics,showColor=(g.clear(),this._selectedColor||"#000000");g.drawRect(0,0,this._colorButton.width,this._colorButton.height,showColor)},__proto._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},__getset(0,__proto,"inputBgColor",function(){return this._inputBgColor},function(value){this._inputBgColor=value,this._setPanelChanged()}),__getset(0,__proto,"selectedColor",function(){return this._selectedColor},function(value){this._selectedColor!=value&&(this._selectedColor=this._colorInput.text=value,this.drawBlock(value),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",Event.EMPTY.setTo("change",this,this)))}),__getset(0,__proto,"skin",function(){return this._colorButton.skin},function(value){this._colorButton.skin=value,this.changeColor()}),__getset(0,__proto,"bgColor",function(){return this._bgColor},function(value){this._bgColor=value,this._setPanelChanged()}),__getset(0,__proto,"borderColor",function(){return this._borderColor},function(value){this._borderColor=value,this._setPanelChanged()}),__getset(0,__proto,"inputColor",function(){return this._inputColor},function(value){this._inputColor=value,this._setPanelChanged()}),ColorPicker}(Component),ComboBox=function(_super){function ComboBox(skin,labels){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,ComboBox.__super.call(this),this._itemColors=Styles.comboBoxItemColors,this.skin=skin,this.labels=labels}__class(ComboBox,"laya.ui.ComboBox",_super);var __proto=ComboBox.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._button&&this._button.destroy(destroyChild),this._list&&this._list.destroy(destroyChild),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},__proto.createChildren=function(){this.addChild(this._button=new Button),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},__proto._createList=function(){this._list=new List,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},__proto._setListEvent=function(list){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=Handler.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},__proto.onListDown=function(e){e.stopPropagation()},__proto.onScrollBarDown=function(e){e.stopPropagation()},__proto.onButtonMouseDown=function(e){this.callLater(this.switchTo,[!this._isOpen])},__proto.changeList=function(){this._listChanged=!1;var labelWidth=this.width-2,labelColor=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:labelWidth,height:this._itemHeight,fontSize:this._itemSize,color:labelColor}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},__proto.onlistItemMouse=function(e,index){var box,e=e.type;"mouseover"===e||"mouseout"===e?this._isCustomList||(box=this._list.getCell(index))&&(box=box.getChildByName("label"))&&("mouseover"===e?(box.bgColor=this._itemColors[0],box.color=this._itemColors[1]):(box.bgColor=null,box.color=this._itemColors[2])):"click"===e&&(this.selectedIndex=index,this.isOpen=!1)},__proto.switchTo=function(value){this.isOpen=value},__proto.changeOpen=function(){this.isOpen=!this._isOpen},__proto.changeItem=function(){this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,this._isCustomList||((g=this._list.graphics).clear(),g.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]));for(var g,a=this._list.array||[],i=a.length=0,n=this._labels.length;i<n;i++)a.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=a},__proto.changeSelected=function(){this._button.label=this.selectedLabel},__proto._onStageMouseWheel=function(e){this._list&&!this._list.contains(e.target)&&this.removeList(null)},__proto.removeList=function(e){Laya.stage.off("mousedown",this,this.removeList),Laya.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},__getset(0,__proto,"selectedIndex",function(){return this._selectedIndex},function(value){this._selectedIndex!=value&&(this._selectedIndex=value,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[Event.EMPTY.setTo("change",this,this)]),this._selectHandler)&&this._selectHandler.runWith(this._selectedIndex)}),__getset(0,__proto,"measureHeight",function(){return this._button.height}),__getset(0,__proto,"skin",function(){return this._button.skin},function(value){this._button.skin!=value&&(this._button.skin=value,this._listChanged=!0)}),__getset(0,__proto,"measureWidth",function(){return this._button.width}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Component,this,"width",value),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),__getset(0,__proto,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(value){this.selectedIndex=this._labels.indexOf(value)}),__getset(0,__proto,"labels",function(){return this._labels.join(",")},function(value){0<this._labels.length&&(this.selectedIndex=-1),value?this._labels=value.split(","):this._labels.length=0,this._itemChanged=!0}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Component,this,"height",value),this._button.height=this._height}),__getset(0,__proto,"selectHandler",function(){return this._selectHandler},function(value){this._selectHandler=value}),__getset(0,__proto,"visibleNum",function(){return this._visibleNum},function(value){this._visibleNum=value,this._listChanged=!0}),__getset(0,__proto,"labelBold",function(){return this._button.text.bold},function(value){this._button.text.bold=value}),__getset(0,__proto,"itemColors",function(){return String(this._itemColors)},function(value){this._itemColors=UIUtils.fillArray(this._itemColors,value,String),this._listChanged=!0}),__getset(0,__proto,"itemSize",function(){return this._itemSize},function(value){this._itemSize=value,this._listChanged=!0}),__getset(0,__proto,"scrollBar",function(){return this.list.scrollBar}),__getset(0,__proto,"isOpen",function(){return this._isOpen},function(value){var py;this._isOpen!=value&&(this._isOpen=value,this._button.selected=this._isOpen,this._isOpen?(this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem(),py=(py=(value=this.localToGlobal(Point.TEMP.setTo(0,0))).y+this._button.height)+this._listHeight<=Laya.stage.height?py:value.y-this._listHeight,this._list.pos(value.x,py),this._list.zOrder=1001,Laya._currentStage.addChild(this._list),Laya.stage.once("mousedown",this,this.removeList),Laya.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex):this._list&&this._list.removeSelf())}),__getset(0,__proto,"scrollBarSkin",function(){return this._scrollBarSkin},function(value){this._scrollBarSkin=value}),__getset(0,__proto,"sizeGrid",function(){return this._button.sizeGrid},function(value){this._button.sizeGrid=value}),__getset(0,__proto,"button",function(){return this._button}),__getset(0,__proto,"list",function(){return this._list||this._createList(),this._list},function(value){value&&(value.removeSelf(),this._isCustomList=!0,this._list=value,this._setListEvent(value),this._itemHeight=value.getCell(0).height+value.spaceY)}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)&&Math.floor(value)==value||"string"==typeof value?this.selectedIndex=parseInt(value):value instanceof Array?this.labels=value.join(","):Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"labelColors",function(){return this._button.labelColors},function(value){this._button.labelColors!=value&&(this._button.labelColors=value)}),__getset(0,__proto,"labelPadding",function(){return this._button.text.padding.join(",")},function(value){this._button.text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number)}),__getset(0,__proto,"labelSize",function(){return this._button.text.fontSize},function(value){this._button.text.fontSize=value}),__getset(0,__proto,"labelFont",function(){return this._button.text.font},function(value){this._button.text.font=value}),__getset(0,__proto,"stateNum",function(){return this._button.stateNum},function(value){this._button.stateNum=value}),ComboBox}(Component),ScrollBar=function(_super){function ScrollBar(skin){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,ScrollBar.__super.call(this),this._showButtons=UIConfig.showButtons,this._touchScrollEnable=UIConfig.touchScrollEnable,this._mouseWheelEnable=UIConfig.mouseWheelEnable,this.skin=skin,this.max=1}__class(ScrollBar,"laya.ui.ScrollBar",_super);var __proto=ScrollBar.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this.stopScroll(),this.target=null,_super.prototype.destroy.call(this,destroyChild),this.upButton&&this.upButton.destroy(destroyChild),this.downButton&&this.downButton.destroy(destroyChild),this.slider&&this.slider.destroy(destroyChild),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},__proto.createChildren=function(){this.addChild(this.slider=new Slider),this.addChild(this.upButton=new Button),this.addChild(this.downButton=new Button)},__proto.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},__proto.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},__proto.onButtonMouseDown=function(e){e=e.currentTarget===this.upButton;this.slide(e),Laya.timer.once(Styles.scrollBarDelayTime,this,this.startLoop,[e]),Laya.stage.once("mouseup",this,this.onStageMouseUp)},__proto.startLoop=function(isUp){Laya.timer.frameLoop(1,this,this.slide,[isUp])},__proto.slide=function(isUp){isUp?this.value-=this._scrollSize:this.value+=this._scrollSize},__proto.onStageMouseUp=function(e){Laya.timer.clear(this,this.startLoop),Laya.timer.clear(this,this.slide)},__proto.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},__proto.changeSize=function(){_super.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},__proto.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},__proto.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},__proto.setScroll=function(min,max,value){this.runCallLater(this.changeSize),this.slider.setSlider(min,max,value),this.slider.bar.visible=0<max,!this._hide&&this.autoHide&&(this.visible=!1)},__proto.onTargetMouseWheel=function(e){this.value-=e.delta*this._scrollSize,this.target=this._target},__proto.onTargetMouseDown=function(e){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new Point),this._lastPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY),Laya.timer.clear(this,this.tweenMove),Tween.clearTween(this),Laya.stage.once("mouseup",this,this.onStageMouseUp2),Laya.stage.once("mouseout",this,this.onStageMouseUp2),Laya.timer.frameLoop(1,this,this.loop)},__proto.loop=function(){var mouseY=Laya.stage.mouseY,mouseX=Laya.stage.mouseX;if(this._lastOffset=this.isVertical?mouseY-this._lastPoint.y:mouseX-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?Laya.stage._canvasTransform.getScaleY():Laya.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=mouseX,this._lastPoint.y=mouseY,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},__proto.onStageMouseUp2=function(e){if(Laya.stage.off("mouseup",this,this.onStageMouseUp2),Laya.stage.off("mouseout",this,this.onStageMouseUp2),Laya.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?Tween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver)):this._value>this.max&&Tween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));else if(this._offsets){this._offsets.length<1&&(this._offsets[0]=this.isVertical?Laya.stage.mouseY-this._lastPoint.y:Laya.stage.mouseX-this._lastPoint.x);for(var dis,offset=0,n=Math.min(this._offsets.length,3),i=0;i<n;i++)offset+=this._offsets[this._offsets.length-1-i];this._lastOffset=offset/n,(offset=Math.abs(this._lastOffset))<2?this.event("end"):(60<offset&&(this._lastOffset=0<this._lastOffset?60:-60),dis=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240))),Laya.timer.frameLoop(1,this,this.tweenMove,[dis]))}},__proto.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&Tween.to(this,{alpha:0},500),this.event("end")},__proto.tweenMove=function(maxDistance){this._lastOffset*=this.rollRatio;var tarSpeed=NaN;0<maxDistance&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,tarSpeed=.5*-(this.min-maxDistance-this.value),this._lastOffset>tarSpeed&&(this._lastOffset=tarSpeed)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,tarSpeed=.5*-(this.max+maxDistance-this.value),this._lastOffset<tarSpeed)&&(this._lastOffset=tarSpeed)),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1&&(Laya.timer.clear(this,this.tweenMove),this._isElastic?this._value<this.min?Tween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver)):this._value>this.max?Tween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver)):this.elasticOver():(this.event("end"),!this.hide&&this.autoHide&&Tween.to(this,{alpha:0},500)))},__proto.stopScroll=function(){this.onStageMouseUp2(null),Laya.timer.clear(this,this.tweenMove),Tween.clearTween(this)},__getset(0,__proto,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),__getset(0,__proto,"max",function(){return this.slider.max},function(value){this.slider.max=value}),__getset(0,__proto,"showButtons",function(){return this._showButtons},function(value){this._showButtons=value,this.callLater(this.changeScrollBar)}),__getset(0,__proto,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),__getset(0,__proto,"min",function(){return this.slider.min},function(value){this.slider.min=value}),__getset(0,__proto,"value",function(){return this._value},function(v){v!==this._value&&(this._value=v,this._isElastic||(this.slider._value!=v&&(this.slider._value=v,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler)&&this.changeHandler.runWith(this._value)}),__getset(0,__proto,"isVertical",function(){return this.slider.isVertical},function(value){this.slider.isVertical=value}),__getset(0,__proto,"sizeGrid",function(){return this.slider.sizeGrid},function(value){this.slider.sizeGrid=value}),__getset(0,__proto,"scrollSize",function(){return this._scrollSize},function(value){this._scrollSize=value}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)||"string"==typeof value?this.value=Number(value):Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"thumbPercent",function(){return this._thumbPercent},function(value){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),this._thumbPercent=value=1<=value?.99:value,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*value,Styles.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*value,Styles.scrollBarMinNum))}),__getset(0,__proto,"target",function(){return this._target},function(value){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=value)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable)&&this._target.on("mousedown",this,this.onTargetMouseDown)}),__getset(0,__proto,"hide",function(){return this._hide},function(value){this._hide=value,this.visible=!value}),__getset(0,__proto,"touchScrollEnable",function(){return this._touchScrollEnable},function(value){this._touchScrollEnable=value,this.target=this._target}),__getset(0,__proto,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(value){this._mouseWheelEnable=value,this.target=this._target}),__getset(0,__proto,"tick",function(){return this.slider.tick},function(value){this.slider.tick=value}),ScrollBar}(Component),Slider=function(_super){function Slider(skin){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,Slider.__super.call(this),this.skin=skin}__class(Slider,"laya.ui.Slider",_super);var __proto=Slider.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._bg&&this._bg.destroy(destroyChild),this._bar&&this._bar.destroy(destroyChild),this._progress&&this._progress.destroy(destroyChild),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},__proto.createChildren=function(){this.addChild(this._bg=new Image),this.addChild(this._bar=new Button)},__proto.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},__proto.onBarMouseDown=function(e){this._globalSacle||(this._globalSacle=new Point),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=Laya.stage.mouseX,this._ty=Laya.stage.mouseY,Laya.stage.on("mousemove",this,this.mouseMove),Laya.stage.once("mouseup",this,this.mouseUp),Laya.stage.once("mouseout",this,this.mouseUp),this.showValueText()},__proto.showValueText=function(){var label;this.showLabel&&(label=laya.ui.Slider.label,this.addChild(label),label.textField.changeText(this._value+""),this.isVertical?(label.x=this._bar.x+20,label.y=.5*(this._bar.height-label.height)+this._bar.y):(label.y=this._bar.y-20,label.x=.5*(this._bar.width-label.width)+this._bar.x))},__proto.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},__proto.mouseUp=function(e){Laya.stage.off("mousemove",this,this.mouseMove),Laya.stage.off("mouseup",this,this.mouseUp),Laya.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},__proto.mouseMove=function(e){var oldValue=this._value,pow=(this.isVertical?(this._bar.y+=(Laya.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(Laya.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=Laya.stage.mouseX,this._ty=Laya.stage.mouseY,Math.pow(10,(this._tick+"").length-1));this._value=Math.round(Math.round(this._value/this._tick)*this._tick*pow)/pow,this._value!=oldValue&&this.sendChangeEvent(),this.showValueText()},__proto.sendChangeEvent=function(type){this.event(type=void 0===type?"change":type),this.changeHandler&&this.changeHandler.runWith(this._value)},__proto.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},__proto.changeSize=function(){_super.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},__proto.setSlider=function(min,max,value){this._value=-1,this._min=min,this._max=min<max?max:min,this.value=value<min?min:max<value?max:value},__proto.changeValue=function(){var pow=Math.pow(10,(this._tick+"").length-1),pow=(this._value=Math.round(Math.round(this._value/this._tick)*this._tick*pow)/pow,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value,this._max-this._min);0===pow&&(pow=1),this.isVertical?(this._bar.y=(this._value-this._min)/pow*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/pow*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},__proto.onBgMouseDown=function(e){var point=this._bg.getMousePoint();this.isVertical?this.value=point.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=point.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},__getset(0,__proto,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),value=this._skin.replace(".png","$progress.png"),Loader.getRes(value)&&(this._progress||(this.addChild(this._progress=new Image),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=value),this.setBarPoint(),this.callLater(this.changeValue))}),__getset(0,__proto,"allowClickBack",function(){return this._allowClickBack},function(value){this._allowClickBack!=value&&((this._allowClickBack=value)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),__getset(0,__proto,"max",function(){return this._max},function(value){this._max!=value&&(this._max=value,this.callLater(this.changeValue))}),__getset(0,__proto,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),__getset(0,__proto,"tick",function(){return this._tick},function(value){this._tick!=value&&(this._tick=value,this.callLater(this.changeValue))}),__getset(0,__proto,"sizeGrid",function(){return this._bg.sizeGrid},function(value){this._bg.sizeGrid=value,this._bar.sizeGrid=value,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),__getset(0,__proto,"min",function(){return this._min},function(value){this._min!=value&&(this._min=value,this.callLater(this.changeValue))}),__getset(0,__proto,"value",function(){return this._value},function(num){var oldValue;this._value!=num&&(oldValue=this._value,this._value=num,this.changeValue(),this._value!=oldValue)&&this.sendChangeEvent()}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)||"string"==typeof value?this.value=Number(value):Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"bar",function(){return this._bar}),__static(Slider,["label",function(){return this.label=new Label}]),Slider}(Component),Image=function(_super){function Image(skin){this._bitmap=null,this._skin=null,this._group=null,Image.__super.call(this),this.skin=skin}__class(Image,"laya.ui.Image",_super);var __proto=Image.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),_super.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,Loader.clearCache(this,this._skin)},__proto.dispose=function(){this.destroy(!0),Loader.clearCache(this,this._skin)},__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap},__proto.setSource=function(url,img){url===this._skin&&img&&(this.source=img,this.onCompResize())},__getset(0,__proto,"source",function(){return this._bitmap.source},function(value){this._bitmap&&(this._bitmap.source=value,this.event("loaded"),this.repaint())}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"string"==typeof(this._dataSource=value)?this.skin=value:Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"measureHeight",function(){return this._bitmap.height}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(Loader.clearCache(this,this._skin),(this._skin=value)?(Loader.keepCache(this,this._skin),(value=Loader.getRes(value))?(this.source=value,this.onCompResize()):Laya.loader.load(this._skin,Handler.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)):this.source=null)}),__getset(0,__proto,"group",function(){return this._group},function(value){value&&this._skin&&Loader.setGroup(this._skin,value),this._group=value}),__getset(0,__proto,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"measureWidth",function(){return this._bitmap.width}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Component,this,"width",value),this._bitmap.width=0==value?1e-7:value}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Component,this,"height",value),this._bitmap.height=0==value?1e-7:value}),Image}(Component),Label=function(_super){function Label(text){this._tf=null,Label.__super.call(this),void 0===text&&(text=""),Font.defaultColor=Styles.labelColor,this.text=text}__class(Label,"laya.ui.Label",_super);var __proto=Label.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._tf=null},__proto.createChildren=function(){this.addChild(this._tf=new Text)},__proto.changeText=function(text){this._tf.changeText(text)},__getset(0,__proto,"padding",function(){return this._tf.padding.join(",")},function(value){this._tf.padding=UIUtils.fillArray(Styles.labelPadding,value,Number)}),__getset(0,__proto,"bold",function(){return this._tf.bold},function(value){this._tf.bold=value}),__getset(0,__proto,"align",function(){return this._tf.align},function(value){this._tf.align=value}),__getset(0,__proto,"text",function(){return this._tf.text},function(value){this._tf.text!=value&&(value=value&&UIUtils.adptString(value+""),this._tf.text=value,this.event("change"),this._width&&this._height||this.onCompResize())}),__getset(0,__proto,"italic",function(){return this._tf.italic},function(value){this._tf.italic=value}),__getset(0,__proto,"wordWrap",function(){return this._tf.wordWrap},function(value){this._tf.wordWrap=value}),__getset(0,__proto,"font",function(){return this._tf.font},function(value){this._tf.font=value}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)||"string"==typeof value?this.text=value+"":Laya.superSet(Component,this,"dataSource",value)}),__getset(0,__proto,"color",function(){return this._tf.color},function(value){this._tf.color=value}),__getset(0,__proto,"valign",function(){return this._tf.valign},function(value){this._tf.valign=value}),__getset(0,__proto,"leading",function(){return this._tf.leading},function(value){this._tf.leading=value}),__getset(0,__proto,"fontSize",function(){return this._tf.fontSize},function(value){this._tf.fontSize=value}),__getset(0,__proto,"bgColor",function(){return this._tf.bgColor},function(value){this._tf.bgColor=value}),__getset(0,__proto,"borderColor",function(){return this._tf.borderColor},function(value){this._tf.borderColor=value}),__getset(0,__proto,"stroke",function(){return this._tf.stroke},function(value){this._tf.stroke=value}),__getset(0,__proto,"strokeColor",function(){return this._tf.strokeColor},function(value){this._tf.strokeColor=value}),__getset(0,__proto,"textField",function(){return this._tf}),__getset(0,__proto,"measureWidth",function(){return this._tf.width}),__getset(0,__proto,"measureHeight",function(){return this._tf.height}),__getset(0,__proto,"width",function(){return this._width||this._tf.text?Laya.superGet(Component,this,"width"):0},function(value){Laya.superSet(Component,this,"width",value),this._tf.width=value}),__getset(0,__proto,"height",function(){return this._height||this._tf.text?Laya.superGet(Component,this,"height"):0},function(value){Laya.superSet(Component,this,"height",value),this._tf.height=value}),__getset(0,__proto,"overflow",function(){return this._tf.overflow},function(value){this._tf.overflow=value}),__getset(0,__proto,"underline",function(){return this._tf.underline},function(value){this._tf.underline=value}),__getset(0,__proto,"underlineColor",function(){return this._tf.underlineColor},function(value){this._tf.underlineColor=value}),Label}(Component),ProgressBar=function(_super){function ProgressBar(skin){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,ProgressBar.__super.call(this),this.skin=skin}__class(ProgressBar,"laya.ui.ProgressBar",_super);var __proto=ProgressBar.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._bg&&this._bg.destroy(destroyChild),this._bar&&this._bar.destroy(destroyChild),this._bg=this._bar=null,this.changeHandler=null},__proto.createChildren=function(){this.addChild(this._bg=new Image),this.addChild(this._bar=new Image)},__proto.changeValue=function(){var left,grid,sw;this.sizeGrid?(grid=this.sizeGrid.split(","),left=Number(grid[3]),grid=Number(grid[1]),sw=(this.width-left-grid)*this._value,this._bar.width=left+grid+sw,this._bar.visible=this._bar.width>left+grid):this._bar.width=this.width*this._value},__getset(0,__proto,"measureHeight",function(){return this._bg.height}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),__getset(0,__proto,"measureWidth",function(){return this._bg.width}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Component,this,"height",value),this._bg.height=this._height,this._bar.height=this._height}),__getset(0,__proto,"bar",function(){return this._bar}),__getset(0,__proto,"value",function(){return this._value},function(num){this._value!=num&&(this._value=num=1<num?1:num<0?0:num,this.callLater(this.changeValue),this.event("change"),this.changeHandler)&&this.changeHandler.runWith(num)}),__getset(0,__proto,"bg",function(){return this._bg}),__getset(0,__proto,"sizeGrid",function(){return this._bg.sizeGrid},function(value){this._bg.sizeGrid=this._bar.sizeGrid=value}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Component,this,"width",value),this._bg.width=this._width,this.callLater(this.changeValue)}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)||"string"==typeof value?this.value=Number(value):Laya.superSet(Component,this,"dataSource",value)}),ProgressBar}(Component),View=(function(){function TipManager(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,TipManager.__super.call(this),this._tipBox=new Component,this._tipBox.addChild(this._tipText=new Text),this._tipText.x=this._tipText.y=5,this._tipText.color=TipManager.tipTextColor,this._defaultTipHandler=this._showDefaultTip,Laya.stage.on("showtip",this,this._onStageShowTip),Laya.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}__class(TipManager,"laya.ui.TipManager",Component);var __proto=TipManager.prototype;__proto._onStageHideTip=function(e){Laya.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},__proto._onStageShowTip=function(data){Laya.timer.once(TipManager.tipDelay,this,this._showTip,[data],!0)},__proto._showTip=function(tip){var text;"string"==typeof tip?(text=String(tip),Boolean(text)&&this._defaultTipHandler(text)):tip instanceof laya.utils.Handler?tip.run():"function"==typeof tip&&tip.apply(),Laya.stage.on("mousemove",this,this._onStageMouseMove),Laya.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},__proto._onStageMouseDown=function(e){this.closeAll()},__proto._onStageMouseMove=function(e){this._showToStage(this,TipManager.offsetX,TipManager.offsetY)},__proto._showToStage=function(dis,offX,offY){void 0===offX&&(offX=0),void 0===offY&&(offY=0);var rec=dis.getBounds();dis.x=Laya.stage.mouseX+offX,dis.y=Laya.stage.mouseY+offY,dis.x+rec.width>Laya.stage.width&&(dis.x-=rec.width+offX),dis.y+rec.height>Laya.stage.height&&(dis.y-=rec.height+offY)},__proto.closeAll=function(){Laya.timer.clear(this,this._showTip),Laya.stage.off("mousemove",this,this._onStageMouseMove),Laya.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},__proto.showDislayTip=function(tip){this.addChild(tip),this._showToStage(this),Laya._currentStage.addChild(this)},__proto._showDefaultTip=function(text){this._tipText.text=text;text=this._tipBox.graphics;text.clear(),text.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,TipManager.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),Laya._currentStage.addChild(this)},__getset(0,__proto,"defaultTipHandler",function(){return this._defaultTipHandler},function(value){this._defaultTipHandler=value}),TipManager.offsetX=10,TipManager.offsetY=15,TipManager.tipTextColor="#ffffff",TipManager.tipBackColor="#111111",TipManager.tipDelay=200}(),function(){var DataWatcher;function View(){this._idMap=null,this._aniList=null,this._watchMap={},View.__super.call(this)}__class(View,"laya.ui.View",Box);var __proto=View.prototype;return __proto.createView=function(uiView){if(uiView.animations&&!this._idMap&&(this._idMap={}),View.createComp(uiView,this,this),uiView.animations){for(var tAni,tAniO,anilist=[],animations=uiView.animations,i=0,len=animations.length,i=0;i<len;i++){switch(tAni=new FrameAnimation,tAniO=animations[i],tAni._setUp(this._idMap,tAniO),(this[tAniO.name]=tAni)._setControlNode(this),tAniO.action){case 1:tAni.play(0,!1);break;case 2:tAni.play(0,!0)}anilist.push(tAni)}this._aniList=anilist}0<this._width&&null==uiView.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},__proto.onEvent=function(type,event){},__proto.loadUI=function(path){path=View.uiMap[path];path&&this.createView(path)},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,destroyChild)},__proto.changeData=function(key){var arr=this._watchMap[key];if(arr){console.log("change",key);for(var i=0,n=arr.length;i<n;i++)arr[i].exe(this)}},View._regs=function(){for(var key in View.uiClassMap)ClassUtils.regClass(key,View.uiClassMap[key])},View.createComp=function(uiView,comp,view,dataMap){if(!(comp=comp||View.getCompInstance(uiView)))return console.warn("can not create:"+uiView.type),null;var child=uiView.child;if(child)for(var isList=comp instanceof laya.ui.List,i=0,n=child.length;i<n;i++){var arr,tChild,node=child[i];!comp.hasOwnProperty("itemRender")||"render"!=node.props.name&&"render"!==node.props.renderType?"Graphic"==node.type?ClassUtils.addGraphicsToSprite(node,comp):ClassUtils.isDrawType(node.type)?ClassUtils.addGraphicToSprite(node,comp,!0):(isList?(tChild=View.createComp(node,null,view,arr=[]),arr.length&&(tChild._$bindData=arr)):tChild=View.createComp(node,null,view,dataMap),"Script"==node.type?"owner"in tChild?tChild.owner=comp:"target"in tChild&&(tChild.target=comp):"mask"==node.props.renderType||"mask"==node.props.name?comp.mask=tChild:tChild instanceof laya.display.Sprite&&comp.addChild(tChild)):comp.itemRender=node}var prop,props=uiView.props;for(prop in props){var value=props[prop];View.eventDic[prop]?value&&view&&comp.on(prop,view,view.onEvent,[value]):View.setCompValue(comp,prop,value,view,dataMap)}return Laya.__typeof(comp,"laya.ui.IItem")&&comp.initItems(),uiView.compId&&view&&view._idMap&&(view._idMap[uiView.compId]=comp),comp},View.setCompValue=function(comp,prop,value,view,dataMap){if("string"==typeof value&&-1<value.indexOf("${"))if(View._sheet=View._sheet?View._sheet:ClassUtils.getClass("laya.data.Table")){if(dataMap)dataMap.push(comp,prop,value);else if(view){-1==value.indexOf("].")&&(value=value.replace(".","[0]."));for(var one,watcher=new DataWatcher(comp,prop,value),str=(watcher.exe(view),value.replace(/\[.*?\]\./g,"."));null!=(one=View._parseWatchData.exec(str));){for(var key1=one[1];null!=(temp=View._parseKeyWord.exec(key1));){var temp=temp[0],arr=view._watchMap[temp]||(view._watchMap[temp]=[]);arr.push(watcher),View._sheet.I.notifer.on(temp,view,view.changeData,[temp])}(arr=view._watchMap[key1]||(view._watchMap[key1]=[])).push(watcher),View._sheet.I.notifer.on(key1,view,view.changeData,[key1])}}}else console.warn("Can not find class Sheet");else"var"===prop&&view?view[value]=comp:"onClick"==prop?(dataMap=Laya._runScript("(function(){"+value+"})"),comp.on("click",view,dataMap)):comp[prop]="true"===value||"false"!==value&&value},View.getCompInstance=function(json){var runtime=json.props?json.props.runtime:null,runtime=runtime?View.viewClassMap[runtime]||View.uiClassMap[runtime]||Laya.__classmap[runtime]:View.uiClassMap[json.type];return json.props&&json.props.hasOwnProperty("renderType")&&"instance"==json.props.renderType?runtime.instance:runtime?new runtime:null},View.regComponent=function(key,compClass){View.uiClassMap[key]=compClass,ClassUtils.regClass(key,compClass)},View.regViewRuntime=function(key,compClass){View.viewClassMap[key]=compClass},View.uiMap={},View.viewClassMap={},View._sheet=null,__static(View,["uiClassMap",function(){return this.uiClassMap={ViewStack:ViewStack,LinkButton:Button,TextArea:TextArea,ColorPicker:ColorPicker,Box:Box,Button:Button,CheckBox:CheckBox,Clip:Clip,ComboBox:ComboBox,Component:Component,HScrollBar:HScrollBar,HSlider:HSlider,Image:Image,Label:Label,List:List,Panel:Panel,ProgressBar:ProgressBar,Radio:Radio,RadioGroup:RadioGroup,ScrollBar:ScrollBar,Slider:Slider,Tab:Tab,TextInput:TextInput,View:View,VScrollBar:VScrollBar,VSlider:VSlider,Tree:Tree,HBox:HBox,VBox:VBox,Sprite:Sprite,Animation:Animation,Text:Text,FontClip:FontClip}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),View.__init$=function(){View._regs(),DataWatcher=function(){function DataWatcher(comp,prop,value){this.comp=null,this.prop=null,this.value=null,this.comp=comp,this.prop=prop,this.value=value}return __class(DataWatcher,""),DataWatcher.prototype.exe=function(view){var fun=UIUtils.getBindFun(this.value);this.comp[this.prop]=fun.call(this,view)},DataWatcher}()},View}()),CheckBox=function(_super){function CheckBox(skin,label){CheckBox.__super.call(this,skin,label=void 0===label?"":label)}__class(CheckBox,"laya.ui.CheckBox",_super);var __proto=CheckBox.prototype;return __proto.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},__proto.initialize=function(){_super.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"boolean"==typeof(this._dataSource=value)?this.selected=value:"string"==typeof value?this.selected="true"===value:Laya.superSet(Button,this,"dataSource",value)}),CheckBox}(Button),LayoutBox=function(){function LayoutBox(){this._space=0,this._align="none",this._itemChanged=!1,LayoutBox.__super.call(this)}__class(LayoutBox,"laya.ui.LayoutBox",Box);var __proto=LayoutBox.prototype;return __proto.addChild=function(child){return child.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,child)},__proto.onResize=function(e){this._setItemChanged()},__proto.addChildAt=function(child,index){return child.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,child,index)},__proto.removeChild=function(child){return child.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,child)},__proto.removeChildAt=function(index){return this.getChildAt(index).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,index)},__proto.refresh=function(){this._setItemChanged()},__proto.changeItems=function(){this._itemChanged=!1},__proto.sortItem=function(items){items&&items.sort(function(a,b){return a.y-b.y})},__proto._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},__getset(0,__proto,"space",function(){return this._space},function(value){this._space=value,this._setItemChanged()}),__getset(0,__proto,"align",function(){return this._align},function(value){this._align=value,this._setItemChanged()}),LayoutBox}(),FontClip=function(_super){function FontClip(skin,sheet){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,FontClip.__super.call(this),skin&&(this.skin=skin),sheet&&(this.sheet=sheet)}__class(FontClip,"laya.ui.FontClip",_super);var __proto=FontClip.prototype;return __proto.createChildren=function(){this._bitmap=new AutoBitmap,this.on("loaded",this,this._onClipLoaded)},__proto._onClipLoaded=function(){this.callLater(this.changeValue)},__proto.changeValue=function(){var texture;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),texture=this._sources[0]))){var isHorizontal="horizontal"===this._direction,dX=(isHorizontal?(this._wordsW=this._valueArr.length*(texture.sourceWidth+this.spaceX),this._wordsH=texture.sourceHeight):(this._wordsW=texture.sourceWidth,this._wordsH=(texture.sourceHeight+this.spaceY)*this._valueArr.length),0);if(this._width)switch(this._align){case"center":dX=.5*(this._width-this._wordsW);break;case"right":dX=this._width-this._wordsW;break;default:dX=0}for(var i=0,sz=this._valueArr.length;i<sz;i++){var index=this._indexMap[this._valueArr.charAt(i)];this.sources[index]&&(texture=this.sources[index],isHorizontal?this.graphics.drawTexture(texture,dX+i*(texture.sourceWidth+this.spaceX),0,texture.sourceWidth,texture.sourceHeight):this.graphics.drawTexture(texture,0+dX,i*(texture.sourceHeight+this.spaceY),texture.sourceWidth,texture.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),_super.prototype.destroy.call(this,destroyChild)},__getset(0,__proto,"sheet",function(){return this._sheet},function(value){var arr=(this._sheet=value+="").split(" ");this._clipX=String(arr[0]).length,this.clipY=arr.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var line=arr[i].split(""),j=0,n=line.length;j<n;j++)this._indexMap[line[j]]=i*this._clipX+j}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Clip,this,"height",value),this.callLater(this.changeValue)}),__getset(0,__proto,"direction",function(){return this._direction},function(value){this._direction=value,this.callLater(this.changeValue)}),__getset(0,__proto,"value",function(){return this._valueArr||""},function(value){this._valueArr=value+="",this.callLater(this.changeValue)}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Clip,this,"width",value),this.callLater(this.changeValue)}),__getset(0,__proto,"spaceX",function(){return this._spaceX},function(value){this._spaceX=value,"horizontal"===this._direction&&this.callLater(this.changeValue)}),__getset(0,__proto,"spaceY",function(){return this._spaceY},function(value){this._spaceY=value,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),__getset(0,__proto,"align",function(){return this._align},function(v){this._align=v,this.callLater(this.changeValue)}),__getset(0,__proto,"measureWidth",function(){return this._wordsW}),__getset(0,__proto,"measureHeight",function(){return this._wordsH}),FontClip}(Clip),List=function(_super){function List(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new Point,List.__super.call(this)}__class(List,"laya.ui.List",_super);var __proto=List.prototype;return Laya.imps(__proto,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),this._content&&this._content.destroy(destroyChild),this._scrollBar&&this._scrollBar.destroy(destroyChild),laya.ui.Component.prototype.destroy.call(this,destroyChild),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},__proto.createChildren=function(){this.addChild(this._content=new Box)},__proto.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=Laya.superGet(Box,this,"cacheAs")),Laya.superSet(Box,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},__proto.onScrollEnd=function(){Laya.superSet(Box,this,"cacheAs",this._$P.cacheAs)},__proto._removePreScrollBar=function(){var preNode=this.removeChildByName("scrollBar");preNode&&preNode.destroy(!0)},__proto.changeCells=function(){var listWidth,listHeight,cell,cellWidth;this._cellChanged=!1,this._itemRender&&(this.scrollBar=this.getChildByName("scrollBar"),cellWidth=(cell=this._getOneCell()).width+this._spaceX||1,cell=cell.height+this._spaceY||1,0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/cellWidth):Math.ceil(this._width/cellWidth)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/cell):Math.round(this._height/cell)),listWidth=this._width||cellWidth*this.repeatX-this._spaceX,listHeight=this._height||cell*this.repeatY-this._spaceY,this._cellSize=this._isVertical?cell:cellWidth,this._cellOffset=this._isVertical?cell*Math.max(this._repeatY2,this._repeatY)-listHeight-this._spaceY:cellWidth*Math.max(this._repeatX2,this._repeatX)-listWidth-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=listHeight:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=listWidth),this.setContentSize(listWidth,listHeight),cell=this._isVertical?this.repeatX:this.repeatY,cellWidth=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0),this._createItems(0,cell,cellWidth),this._createdLine=cellWidth,this._array)&&(this.array=this._array,this.runCallLater(this.renderItems))},__proto._getOneCell=function(){if(0===this._cells.length){var item=this.createItem();if(this._offset.setTo(item.x,item.y),this.cacheContent)return item;this._cells.push(item)}return this._cells[0]},__proto._createItems=function(startY,numX,numY){var box=this._content,cell=this._getOneCell(),cellWidth=cell.width+this._spaceX,cellHeight=cell.height+this._spaceY;if(this.cacheContent){var cacheBox=new Box;cacheBox.cacheAsBitmap=!0,cacheBox.pos((this._isVertical?0:startY)*cellWidth,(this._isVertical?startY:0)*cellHeight),this._content.addChild(cacheBox),this._content.optimizeScrollRect=!0,box=cacheBox}else{for(var arr=[],i=this._cells.length-1;-1<i;i--){var item=this._cells[i];item.removeSelf(),arr.push(item)}this._cells.length=0}for(var k=startY;k<numY;k++)for(var l=0;l<numX;l++)(cell=arr&&arr.length?arr.pop():this.createItem()).x=(this._isVertical?l:k)*cellWidth-box.x,cell.y=(this._isVertical?k:l)*cellHeight-box.y,cell.name="item"+(k*numX+l),box.addChild(cell),this.addCell(cell)},__proto.createItem=function(){var arr=[],box="function"==typeof this._itemRender?new this._itemRender:View.createComp(this._itemRender,null,null,arr);if(0==arr.length&&box._watchMap){var name,watchMap=box._watchMap;for(name in watchMap)for(var a=watchMap[name],i=0;i<a.length;i++){var watcher=a[i];arr.push(watcher.comp,watcher.prop,watcher.value)}}return arr.length&&(box._$bindData=arr),box},__proto.addCell=function(cell){cell.on("click",this,this.onCellMouse),cell.on("rightclick",this,this.onCellMouse),cell.on("mouseover",this,this.onCellMouse),cell.on("mouseout",this,this.onCellMouse),cell.on("mousedown",this,this.onCellMouse),cell.on("mouseup",this,this.onCellMouse),this._cells.push(cell)},__proto.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var count=0,count=0,i=0;i<1e4;i++){var cell=this.getChildByName("item"+i);if(!cell)break;this.addCell(cell),count++}this.repeatY=count}},__proto.setContentSize=function(width,height){this._content.width=width,this._content.height=height,!this._scrollBar&&0==this._offset.x&&0==this._offset.y||(this._content.scrollRect||(this._content.scrollRect=new Rectangle),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,width,height),this._content.scrollRect=this._content.scrollRect),this.event("resize")},__proto.onCellMouse=function(e){"mousedown"===e.type&&(this._isMoved=!1);var cell=e.currentTarget,index=this._startIndex+this._cells.indexOf(cell);index<0||("click"===e.type||"rightclick"===e.type?this.selectEnable&&!this._isMoved?this.selectedIndex=index:this.changeCellState(cell,!0,0):"mouseover"!==e.type&&"mouseout"!==e.type||this._selectedIndex===index||this.changeCellState(cell,"mouseover"===e.type,0),this.mouseHandler&&this.mouseHandler.runWith([e,index]))},__proto.changeCellState=function(cell,visable,index){cell=cell.getChildByName("selectBox");cell&&(this.selectEnable=!0,cell.visible=visable,cell.index=index)},__proto.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},__proto.onScrollBarChange=function(e){this.runCallLater(this.changeCells);var scrollValue=this._scrollBar.value,lineX=this._isVertical?this.repeatX:this.repeatY,lineY=this._isVertical?this.repeatY:this.repeatX,scrollLine=Math.floor(scrollValue/this._cellSize);if(this.cacheContent)this._createdLine-scrollLine<(num=lineY+1)&&(this._createItems(this._createdLine,lineX,this._createdLine+num),this.renderItems(this._createdLine*lineX,0),this._createdLine+=num);else{var down,toIndex,scrollLine=scrollLine*lineX,num=0;scrollLine>this._startIndex?(num=scrollLine-this._startIndex,toIndex=this._startIndex+lineX*(lineY+1),this._isMoved=down=!0):scrollLine<this._startIndex&&(num=this._startIndex-scrollLine,toIndex=this._startIndex-1,this._isMoved=!(down=!1));for(var i=0;i<num;i++){var cell,cellIndex=down?(cell=this._cells.shift(),this._cells[this._cells.length]=cell,toIndex+i):(cell=this._cells.pop(),this._cells.unshift(cell),toIndex-i),pos=Math.floor(cellIndex/lineX)*this._cellSize;this._isVertical?cell.y=pos:cell.x=pos,this.renderItem(cell,cellIndex)}this._startIndex=scrollLine,this.changeSelectStatus()}lineY=this._content.scrollRect;this._isVertical?(lineY.y=scrollValue-this._offset.y,lineY.x=-this._offset.x):(lineY.y=-this._offset.y,lineY.x=scrollValue-this._offset.x),this._content.scrollRect=lineY},__proto.posCell=function(cell,cellIndex){var lineX;this._scrollBar&&(lineX=this._isVertical?this.repeatX:this.repeatY,this._isVertical?this.repeatY:this.repeatX,cellIndex=Math.floor(cellIndex/lineX)*this._cellSize,this._isVertical?cell.y=cellIndex:cell.x=cellIndex)},__proto.changeSelectStatus=function(){for(var i=0,n=this._cells.length;i<n;i++)this.changeCellState(this._cells[i],this._selectedIndex===this._startIndex+i,1)},__proto.renderItems=function(from,to){for(var i=from=void 0===from?0:from,n=(to=void 0===to?0:to)||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},__proto.renderItem=function(cell,index){this._array&&0<=index&&index<this._array.length?(cell.visible=!0,cell._$bindData?(cell._dataSource=this._array[index],this._bindData(cell,this._array[index])):cell.dataSource=this._array[index],this.cacheContent||this.posCell(cell,index),this.hasListener("render")&&this.event("render",[cell,index]),this.renderHandler&&this.renderHandler.runWith([cell,index])):(cell.visible=!1,cell.dataSource=null)},__proto._bindData=function(cell,data){for(var arr=cell._$bindData,i=0,n=arr.length;i<n;i++){var ele=arr[i++],prop=arr[i++],value=arr[i],value=UIUtils.getBindFun(value);ele[prop]=value.call(this,data)}},__proto.refresh=function(){this.array=this._array},__proto.getItem=function(index){return-1<index&&index<this._array.length?this._array[index]:null},__proto.changeItem=function(index,source){-1<index&&index<this._array.length&&(this._array[index]=source,index>=this._startIndex)&&index<this._startIndex+this._cells.length&&this.renderItem(this.getCell(index),index)},__proto.setItem=function(index,source){this.changeItem(index,source)},__proto.addItem=function(souce){this._array.push(souce),this.array=this._array},__proto.addItemAt=function(souce,index){this._array.splice(index,0,souce),this.array=this._array},__proto.deleteItem=function(index){this._array.splice(index,1),this.array=this._array},__proto.getCell=function(index){return this.runCallLater(this.changeCells),-1<index&&this._cells?this._cells[(index-this._startIndex)%this._cells.length]:null},__proto.scrollTo=function(index){var numX;this._scrollBar?(numX=this._isVertical?this.repeatX:this.repeatY,this._scrollBar.value=Math.floor(index/numX)*this._cellSize):this.startIndex=index},__proto.tweenTo=function(index,time,complete){var numX;void 0===time&&(time=200),this._scrollBar?(numX=this._isVertical?this.repeatX:this.repeatY,Tween.to(this._scrollBar,{value:Math.floor(index/numX)*this._cellSize},time,null,complete,0,!0)):(this.startIndex=index,complete&&complete.run())},__proto._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},__proto.commitMeasure=function(){this.runCallLater(this.changeCells)},__getset(0,__proto,"cacheAs",_super.prototype._$get_cacheAs,function(value){Laya.superSet(Box,this,"cacheAs",value),this._scrollBar&&(this._$P.cacheAs=null,"none"!==value?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),__getset(0,__proto,"content",function(){return this._content}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){value!=this._height&&(Laya.superSet(Box,this,"height",value),this._setCellChanged())}),__getset(0,__proto,"itemRender",function(){return this._itemRender},function(value){if(this._itemRender!=value){this._itemRender=value;for(var i=this._cells.length-1;-1<i;i--)this._cells[i].destroy();this._cells.length=0,this._setCellChanged()}}),__getset(0,__proto,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(value){this._removePreScrollBar();var scrollBar=new VScrollBar;scrollBar.name="scrollBar",scrollBar.right=0,value&&" "!=value&&(scrollBar.skin=value),this.scrollBar=scrollBar,this.addChild(scrollBar),this._setCellChanged()}),__getset(0,__proto,"page",function(){return this._page},function(value){this._page=value,this._array&&(this._page=0<value?value:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),__getset(0,__proto,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(value){this._removePreScrollBar();var scrollBar=new HScrollBar;scrollBar.name="scrollBar",scrollBar.bottom=0,value&&" "!=value&&(scrollBar.skin=value),this.scrollBar=scrollBar,this.addChild(scrollBar),this._setCellChanged()}),__getset(0,__proto,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(value){this._repeatX=value,this._setCellChanged()}),__getset(0,__proto,"scrollBar",function(){return this._scrollBar},function(value){this._scrollBar!=value&&(this._scrollBar=value)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){value!=this._width&&(Laya.superSet(Box,this,"width",value),this._setCellChanged())}),__getset(0,__proto,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(value){this._repeatY=value,this._setCellChanged()}),__getset(0,__proto,"spaceX",function(){return this._spaceX},function(value){this._spaceX=value,this._setCellChanged()}),__getset(0,__proto,"spaceY",function(){return this._spaceY},function(value){this._spaceY=value,this._setCellChanged()}),__getset(0,__proto,"selectedIndex",function(){return this._selectedIndex},function(value){this._selectedIndex!=value&&(this._selectedIndex=value,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(value),this.startIndex=this._startIndex)}),__getset(0,__proto,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(value){this.selectedIndex=this._array.indexOf(value)}),__getset(0,__proto,"length",function(){return this._array?this._array.length:0}),__getset(0,__proto,"selection",function(){return this.getCell(this._selectedIndex)},function(value){this.selectedIndex=this._startIndex+this._cells.indexOf(value)}),__getset(0,__proto,"startIndex",function(){return this._startIndex},function(value){this._startIndex=0<value?value:0,this.callLater(this.renderItems)}),__getset(0,__proto,"array",function(){return this._array},function(value){this.runCallLater(this.changeCells),this._array=value||[];var numX,numY,value=this._array.length;this.totalPage=Math.ceil(value/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<value?this._selectedIndex:value-1,this.startIndex=this._startIndex,this._scrollBar&&(this._scrollBar.stopScroll(),numX=this._isVertical?this.repeatX:this.repeatY,numY=this._isVertical?this.repeatY:this.repeatX,value=Math.ceil(value/numX),1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=numY/value,this._scrollBar.setScroll(0,(value-numY)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content)}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)&&Math.floor(value)==value||"string"==typeof value?this.selectedIndex=parseInt(value):value instanceof Array?this.array=value:Laya.superSet(Box,this,"dataSource",value)}),__getset(0,__proto,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),List}(Box),HScrollBar=function(_super){function HScrollBar(){HScrollBar.__super.call(this)}return __class(HScrollBar,"laya.ui.HScrollBar",_super),HScrollBar.prototype.initialize=function(){_super.prototype.initialize.call(this),this.slider.isVertical=!1},HScrollBar}(ScrollBar),Panel=function(_super){function Panel(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,Panel.__super.call(this),this.width=this.height=100}__class(Panel,"laya.ui.Panel",_super);var __proto=Panel.prototype;return __proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),laya.ui.Component.prototype.destroy.call(this,destroyChild),this._content&&this._content.destroy(destroyChild),this._vScrollBar&&this._vScrollBar.destroy(destroyChild),this._hScrollBar&&this._hScrollBar.destroy(destroyChild),this._vScrollBar=null,this._hScrollBar=null,this._content=null},__proto.destroyChildren=function(){this._content.destroyChildren()},__proto.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new Box)},__proto.addChild=function(child){return child.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(child)},__proto.onResize=function(){this._setScrollChanged()},__proto.addChildAt=function(child,index){return child.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(child,index)},__proto.removeChild=function(child){return child.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(child)},__proto.removeChildAt=function(index){return this.getChildAt(index).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(index)},__proto.removeChildren=function(beginIndex,endIndex){return this._content.removeChildren(beginIndex=void 0===beginIndex?0:beginIndex,endIndex=void 0===endIndex?2147483647:endIndex),this._setScrollChanged(),this},__proto.getChildAt=function(index){return this._content.getChildAt(index)},__proto.getChildByName=function(name){return this._content.getChildByName(name)},__proto.getChildIndex=function(child){return this._content.getChildIndex(child)},__proto.changeScroll=function(){this._scrollChanged=!1;var contentW=this.contentWidth||1,contentH=this.contentHeight||1,vscroll=this._vScrollBar,hscroll=this._hScrollBar,vShow=vscroll&&contentH>this._height,hShow=hscroll&&contentW>this._width,showWidth=vShow?this._width-vscroll.width:this._width,showHeight=hShow?this._height-hscroll.height:this._height;vscroll&&(vscroll.x=this._width-vscroll.width,vscroll.y=0,vscroll.height=this._height-(hShow?hscroll.height:0),vscroll.scrollSize=Math.max(.033*this._height,1),vscroll.thumbPercent=showHeight/contentH,vscroll.setScroll(0,contentH-showHeight,vscroll.value)),hscroll&&(hscroll.x=0,hscroll.y=this._height-hscroll.height,hscroll.width=this._width-(vShow?vscroll.width:0),hscroll.scrollSize=Math.max(.033*this._width,1),hscroll.thumbPercent=showWidth/contentW,hscroll.setScroll(0,contentW-showWidth,hscroll.value))},__proto.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},__proto.setContentSize=function(width,height){var content=this._content;content.width=width,content.height=height,content.scrollRect||(content.scrollRect=new Rectangle),content.scrollRect.setTo(0,0,width,height),content.scrollRect=content.scrollRect},__proto.onScrollBarChange=function(scrollBar){var start,rect=this._content.scrollRect;rect&&(start=Math.round(scrollBar.value),scrollBar.isVertical?rect.y=start:rect.x=start,this._content.scrollRect=rect)},__proto.scrollTo=function(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.vScrollBar&&(this.vScrollBar.value=y),this.hScrollBar&&(this.hScrollBar.value=x)},__proto.refresh=function(){this.changeScroll()},__proto.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=Laya.superGet(Box,this,"cacheAs")),Laya.superSet(Box,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},__proto.onScrollEnd=function(){Laya.superSet(Box,this,"cacheAs",this._$P.cacheAs)},__proto._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},__getset(0,__proto,"numChildren",function(){return this._content.numChildren}),__getset(0,__proto,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(value){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new HScrollBar),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=value}),__getset(0,__proto,"contentWidth",function(){for(var max=0,i=this._content.numChildren-1;-1<i;i--)var comp=this._content.getChildAt(i),max=Math.max(comp.x+comp.width*comp.scaleX,max);return max}),__getset(0,__proto,"contentHeight",function(){for(var max=0,i=this._content.numChildren-1;-1<i;i--)var comp=this._content.getChildAt(i),max=Math.max(comp.y+comp.height*comp.scaleY,max);return max}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Box,this,"width",value),this._setScrollChanged()}),__getset(0,__proto,"hScrollBar",function(){return this._hScrollBar}),__getset(0,__proto,"content",function(){return this._content}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Box,this,"height",value),this._setScrollChanged()}),__getset(0,__proto,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(value){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new VScrollBar),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=value}),__getset(0,__proto,"vScrollBar",function(){return this._vScrollBar}),__getset(0,__proto,"cacheAs",_super.prototype._$get_cacheAs,function(value){Laya.superSet(Box,this,"cacheAs",value),this._$P.cacheAs=null,"none"!==value?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),Panel}(Box),HSlider=function(){function HSlider(skin){HSlider.__super.call(this,skin),this.isVertical=!1}return __class(HSlider,"laya.ui.HSlider",Slider),HSlider}(),UIGroup=function(_super){function UIGroup(labels,skin){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,UIGroup.__super.call(this),this.skin=skin,this.labels=labels}__class(UIGroup,"laya.ui.UIGroup",_super);var __proto=UIGroup.prototype;return Laya.imps(__proto,{"laya.ui.IItem":!0}),__proto.preinitialize=function(){this.mouseEnabled=!0},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),laya.ui.Component.prototype.destroy.call(this,destroyChild),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},__proto.addItem=function(item,autoLayOut){void 0===autoLayOut&&(autoLayOut=!0);var preItem,index=this._items.length;return item.name="item"+index,this.addChild(item),this.initItems(),autoLayOut&&0<index?(preItem=this._items[index-1],"horizontal"==this._direction?item.x=preItem.x+preItem.width+this._space:item.y=preItem.y+preItem.height+this._space):autoLayOut&&(item.x=0,item.y=0),index},__proto.delItem=function(item,autoLayOut){void 0===autoLayOut&&(autoLayOut=!0);var index=this._items.indexOf(item);if(-1!=index){var display=item;this.removeChild(display);for(var i=index+1,n=this._items.length;i<n;i++){var child=this._items[i];child.name="item"+(i-1),autoLayOut&&("horizontal"==this._direction?child.x-=display.width+this._space:child.y-=display.height+this._space)}this.initItems(),-1<this._selectedIndex&&(item=0,item=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=item)}},__proto.initItems=function(){this._items||(this._items=[]);for(var i=this._items.length=0;i<1e4;i++){var item=this.getChildByName("item"+i);if(null==item)break;this._items.push(item),item.selected=i===this._selectedIndex,item.clickHandler=Handler.create(this,this.itemClick,[i],!1)}},__proto.itemClick=function(index){this.selectedIndex=index},__proto.setSelect=function(index,selected){this._items&&-1<index&&index<this._items.length&&(this._items[index].selected=selected)},__proto.createItem=function(skin,label){return null},__proto.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var left=0,i=0,n=this._items.length;i<n;i++){var btn=this._items[i];this._skin&&(btn.skin=this._skin),this._labelColors&&(btn.labelColors=this._labelColors),this._labelSize&&(btn.labelSize=this._labelSize),this._labelStroke&&(btn.labelStroke=this._labelStroke),this._labelStrokeColor&&(btn.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(btn.strokeColors=this._strokeColors),this._labelBold&&(btn.labelBold=this._labelBold),this._labelPadding&&(btn.labelPadding=this._labelPadding),this._labelAlign&&(btn.labelAlign=this._labelAlign),this._stateNum&&(btn.stateNum=this._stateNum),this._labelFont&&(btn.labelFont=this._labelFont),"horizontal"===this._direction?(btn.y=0,btn.x=left,left+=btn.width+this._space):(btn.x=0,btn.y=left,left+=btn.height+this._space)}this.changeSize()},__proto.commitMeasure=function(){this.runCallLater(this.changeLabels)},__proto._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},__getset(0,__proto,"labelStrokeColor",function(){return this._labelStrokeColor},function(value){this._labelStrokeColor!=value&&(this._labelStrokeColor=value,this._setLabelChanged())}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(this._skin=value,this._setLabelChanged())}),__getset(0,__proto,"selectedIndex",function(){return this._selectedIndex},function(value){this._selectedIndex!=value&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=value,this.setSelect(value,!0),this.event("change"),this.selectHandler)&&this.selectHandler.runWith(this._selectedIndex)}),__getset(0,__proto,"labels",function(){return this._labels},function(value){if(this._labels!=value){if(this._labels=value,this.removeChildren(),this._setLabelChanged(),this._labels)for(var a=this._labels.split(","),i=0,n=a.length;i<n;i++){var item=this.createItem(this._skin,a[i]);item.name="item"+i,this.addChild(item)}this.initItems()}}),__getset(0,__proto,"strokeColors",function(){return this._strokeColors},function(value){this._strokeColors!=value&&(this._strokeColors=value,this._setLabelChanged())}),__getset(0,__proto,"labelColors",function(){return this._labelColors},function(value){this._labelColors!=value&&(this._labelColors=value,this._setLabelChanged())}),__getset(0,__proto,"labelStroke",function(){return this._labelStroke},function(value){this._labelStroke!=value&&(this._labelStroke=value,this._setLabelChanged())}),__getset(0,__proto,"labelSize",function(){return this._labelSize},function(value){this._labelSize!=value&&(this._labelSize=value,this._setLabelChanged())}),__getset(0,__proto,"stateNum",function(){return this._stateNum},function(value){this._stateNum!=value&&(this._stateNum=value,this._setLabelChanged())}),__getset(0,__proto,"labelBold",function(){return this._labelBold},function(value){this._labelBold!=value&&(this._labelBold=value,this._setLabelChanged())}),__getset(0,__proto,"labelFont",function(){return this._labelFont},function(value){this._labelFont!=value&&(this._labelFont=value,this._setLabelChanged())}),__getset(0,__proto,"labelPadding",function(){return this._labelPadding},function(value){this._labelPadding!=value&&(this._labelPadding=value,this._setLabelChanged())}),__getset(0,__proto,"direction",function(){return this._direction},function(value){this._direction=value,this._setLabelChanged()}),__getset(0,__proto,"space",function(){return this._space},function(value){this._space=value,this._setLabelChanged()}),__getset(0,__proto,"items",function(){return this._items}),__getset(0,__proto,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(value){this.selectedIndex=this._items.indexOf(value)}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){"number"==typeof(this._dataSource=value)&&Math.floor(value)==value||"string"==typeof value?this.selectedIndex=parseInt(value):value instanceof Array?this.labels=value.join(","):Laya.superSet(Box,this,"dataSource",value)}),UIGroup}(Box),Radio=function(_super){function Radio(skin,label){this._value=null,Radio.__super.call(this,skin,label=void 0===label?"":label)}__class(Radio,"laya.ui.Radio",_super);var __proto=Radio.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._value=null},__proto.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},__proto.initialize=function(){_super.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},__proto.onClick=function(e){this.selected=!0},__getset(0,__proto,"value",function(){return null!=this._value?this._value:this.label},function(obj){this._value=obj}),Radio}(Button),Tree=function(_super){function Tree(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,Tree.__super.call(this),this.width=this.height=200}__class(Tree,"laya.ui.Tree",_super);var __proto=Tree.prototype;return Laya.imps(__proto,{"laya.ui.IRender":!0}),__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),laya.ui.Component.prototype.destroy.call(this,destroyChild),this._list&&this._list.destroy(destroyChild),this._list=null,this._source=null,this._renderHandler=null},__proto.createChildren=function(){this.addChild(this._list=new List),this._list.renderHandler=Handler.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},__proto.onListChange=function(e){this.event("change")},__proto.getArray=function(){var item,$each_item,arr=[];for($each_item in this._source)item=this._source[$each_item],this.getParentOpenStatus(item)&&(item.x=this._spaceLeft*this.getDepth(item),arr.push(item));return arr},__proto.getDepth=function(item,num){return void 0===num&&(num=0),null==item.nodeParent?num:this.getDepth(item.nodeParent,num+1)},__proto.getParentOpenStatus=function(item){item=item.nodeParent;return null==item||!!item.isOpen&&(null==item.nodeParent||this.getParentOpenStatus(item))},__proto.renderItem=function(cell,index){var arrow,item=cell.dataSource;item&&(cell.left=item.x,(arrow=cell.getChildByName("arrow"))&&(item.hasChild?(arrow.visible=!0,arrow.index=item.isOpen?1:0,arrow.tag=index,arrow.off("click",this,this.onArrowClick),arrow.on("click",this,this.onArrowClick)):arrow.visible=!1),(arrow=cell.getChildByName("folder"))&&(2==arrow.clipY?arrow.index=item.isDirectory?0:1:arrow.index=item.isDirectory?item.isOpen?1:0:2),this._renderHandler)&&this._renderHandler.runWith([cell,index])},__proto.onArrowClick=function(e){e=e.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event("open"),this._list.array=this.getArray()},__proto.setItemState=function(index,isOpen){this._list.array[index]&&(this._list.array[index].isOpen=isOpen,this._list.array=this.getArray())},__proto.fresh=function(){this._list.array=this.getArray(),this.repaint()},__proto.parseXml=function(xml,source,nodeParent,isRoot){var list=xml.childNodes,childCount=list.length;if(!isRoot){var $each_attrs,obj={},list2=xml.attributes;for($each_attrs in list2){var prop=(attrs=list2[$each_attrs]).nodeName,attrs=attrs.nodeValue;obj[prop]="true"==attrs||"false"!=attrs&&attrs}obj.nodeParent=nodeParent,0<childCount&&(obj.isDirectory=!0),obj.hasChild=0<childCount,source.push(obj)}for(var i=0;i<childCount;i++){var node=list[i];this.parseXml(node,source,obj,!1)}},__proto.parseOpenStatus=function(oldSource,newSource){for(var i=0,n=newSource.length;i<n;i++){var newItem=newSource[i];if(newItem.isDirectory)for(var j=0,m=oldSource.length;j<m;j++){var oldItem=oldSource[j];if(oldItem.isDirectory&&this.isSameParent(oldItem,newItem)&&newItem.label==oldItem.label){newItem.isOpen=oldItem.isOpen;break}}}},__proto.isSameParent=function(item1,item2){return null==item1.nodeParent&&null==item2.nodeParent||null!=item1.nodeParent&&null!=item2.nodeParent&&item1.nodeParent.label==item2.nodeParent.label&&this.isSameParent(item1.nodeParent,item2.nodeParent)},__proto.filter=function(key){var result;Boolean(key)?(this.getFilterSource(this._source,result=[],key),this._list.array=result):this._list.array=this.getArray()},__proto.getFilterSource=function(array,result,key){var item,$each_item;for($each_item in key=key.toLocaleLowerCase(),array)!(item=array[$each_item]).isDirectory&&-1<String(item.label).toLowerCase().indexOf(key)&&(item.x=0,result.push(item)),item.child&&0<item.child.length&&this.getFilterSource(item.child,result,key)},__getset(0,__proto,"spaceBottom",function(){return this._list.spaceY},function(value){this._list.spaceY=value}),__getset(0,__proto,"keepStatus",function(){return this._keepStatus},function(value){this._keepStatus=value}),__getset(0,__proto,"itemRender",function(){return this._list.itemRender},function(value){this._list.itemRender=value}),__getset(0,__proto,"array",function(){return this._list.array},function(value){this._keepStatus&&this._list.array&&value&&this.parseOpenStatus(this._list.array,value),this._source=value,this._list.array=this.getArray()}),__getset(0,__proto,"mouseHandler",function(){return this._list.mouseHandler},function(value){this._list.mouseHandler=value}),__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){this._dataSource=value,Laya.superSet(Box,this,"dataSource",value)}),__getset(0,__proto,"source",function(){return this._source}),__getset(0,__proto,"scrollBar",function(){return this._list.scrollBar}),__getset(0,__proto,"list",function(){return this._list}),__getset(0,__proto,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(value){this._list.vScrollBarSkin=value}),__getset(0,__proto,"renderHandler",function(){return this._renderHandler},function(value){this._renderHandler=value}),__getset(0,__proto,"selectedIndex",function(){return this._list.selectedIndex},function(value){this._list.selectedIndex=value}),__getset(0,__proto,"spaceLeft",function(){return this._spaceLeft},function(value){this._spaceLeft=value}),__getset(0,__proto,"selectedItem",function(){return this._list.selectedItem},function(value){this._list.selectedItem=value}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Box,this,"width",value),this._list.width=value}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Box,this,"height",value),this._list.height=value}),__getset(0,__proto,"xml",null,function(value){var arr=[];this.parseXml(value.childNodes[0],arr,null,!0),this.array=arr}),__getset(0,__proto,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),Tree}(Box),ViewStack=function(_super){function ViewStack(){this._items=null,this._selectedIndex=0,ViewStack.__super.call(this),this._setIndexHandler=Handler.create(this,this.setIndex,null,!1)}__class(ViewStack,"laya.ui.ViewStack",_super);var __proto=ViewStack.prototype;return Laya.imps(__proto,{"laya.ui.IItem":!0}),__proto.setItems=function(views){this.removeChildren();for(var index=0,i=0,n=views.length;i<n;i++){var item=views[i];item&&(item.name="item"+index,this.addChild(item),index++)}this.initItems()},__proto.addItem=function(view){view.name="item"+this._items.length,this.addChild(view),this.initItems()},__proto.initItems=function(){this._items=[];for(var i=0;i<1e4;i++){var item=this.getChildByName("item"+i);if(null==item)break;this._items.push(item),item.visible=i==this._selectedIndex}},__proto.setSelect=function(index,selected){this._items&&-1<index&&index<this._items.length&&(this._items[index].visible=selected)},__proto.setIndex=function(index){this.selectedIndex=index},__getset(0,__proto,"dataSource",_super.prototype._$get_dataSource,function(value){if("number"==typeof(this._dataSource=value)&&Math.floor(value)==value||"string"==typeof value)this.selectedIndex=parseInt(value);else for(var prop in this._dataSource)this.hasOwnProperty(prop)&&(this[prop]=this._dataSource[prop])}),__getset(0,__proto,"selectedIndex",function(){return this._selectedIndex},function(value){this._selectedIndex!=value&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=value,this.setSelect(this._selectedIndex,!0))}),__getset(0,__proto,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(value){this.selectedIndex=this._items.indexOf(value)}),__getset(0,__proto,"items",function(){return this._items}),__getset(0,__proto,"setIndexHandler",function(){return this._setIndexHandler},function(value){this._setIndexHandler=value}),ViewStack}(Box),VScrollBar=function(){function VScrollBar(){VScrollBar.__super.call(this)}return __class(VScrollBar,"laya.ui.VScrollBar",ScrollBar),VScrollBar}(),TextInput=function(_super){function TextInput(text){this._bg=null,this._skin=null,TextInput.__super.call(this),this.text=text=void 0===text?"":text,this.skin=this.skin}__class(TextInput,"laya.ui.TextInput",_super);var __proto=TextInput.prototype;return __proto.preinitialize=function(){this.mouseEnabled=!0},__proto.destroy=function(destroyChild){Loader.clearCache(this,this._skin),_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._bg&&this._bg.destroy(),this._bg=null},__proto.createChildren=function(){this.addChild(this._tf=new Input),this._tf.padding=Styles.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},__proto._onFocus=function(){this.event("focus",this)},__proto._onBlur=function(){this.event("blur",this)},__proto._onInput=function(){this.event("input",this)},__proto._onEnter=function(){this.event("enter",this)},__proto.initialize=function(){this.width=128,this.height=22},__proto.select=function(){this._tf.select()},__proto.setSelection=function(startIndex,endIndex){this._tf.setSelection(startIndex,endIndex)},__getset(0,__proto,"text",_super.prototype._$get_text,function(value){this._tf.text!=value&&(this._tf.text=value+="",this.event("change"))}),__getset(0,__proto,"bg",function(){return this._bg},function(value){this.graphics=this._bg=value}),__getset(0,__proto,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(value){this._tf.inputElementYAdjuster=value}),__getset(0,__proto,"multiline",function(){return this._tf.multiline},function(value){this._tf.multiline=value}),__getset(0,__proto,"skin",function(){return this._skin},function(value){this._skin!=value&&(Loader.clearCache(this,this._skin),this._skin=value,this._bg||(this.graphics=this._bg=new AutoBitmap),Loader.keepCache(this,this._skin),this._bg.source=Loader.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height)&&(this._bg.height=this._height)}),__getset(0,__proto,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(value){this._bg||(this.graphics=this._bg=new AutoBitmap),this._bg.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number)}),__getset(0,__proto,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(value){this._tf.inputElementXAdjuster=value}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(Label,this,"width",value),this._bg&&(this._bg.width=value)}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(Label,this,"height",value),this._bg&&(this._bg.height=value)}),__getset(0,__proto,"editable",function(){return this._tf.editable},function(value){this._tf.editable=value}),__getset(0,__proto,"restrict",function(){return this._tf.restrict},function(pattern){this._tf.restrict=pattern}),__getset(0,__proto,"prompt",function(){return this._tf.prompt},function(value){this._tf.prompt=value}),__getset(0,__proto,"promptColor",function(){return this._tf.promptColor},function(value){this._tf.promptColor=value}),__getset(0,__proto,"maxChars",function(){return this._tf.maxChars},function(value){this._tf.maxChars=value}),__getset(0,__proto,"focus",function(){return this._tf.focus},function(value){this._tf.focus=value}),__getset(0,__proto,"type",function(){return this._tf.type},function(value){this._tf.type=value}),__getset(0,__proto,"asPassword",function(){return this._tf.asPassword},function(value){this._tf.asPassword=value}),TextInput}(Label),VSlider=function(){function VSlider(){VSlider.__super.call(this)}return __class(VSlider,"laya.ui.VSlider",Slider),VSlider}(),Dialog=function(_super){function Dialog(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,Dialog.__super.call(this)}__class(Dialog,"laya.ui.Dialog",_super);var __proto=Dialog.prototype;return __proto.initialize=function(){this.popupEffect=Dialog.manager.popupEffectHandler,this.closeEffect=Dialog.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},__proto._dealDragArea=function(){var dragTarget=this.getChildByName("drag");dragTarget&&(this.dragArea=dragTarget.x+","+dragTarget.y+","+dragTarget.width+","+dragTarget.height,dragTarget.removeSelf())},__proto._onClick=function(e){var btn=e.target;if(btn)switch(btn.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(btn.name)}},__proto.show=function(closeOther,showEffect){this._open(!1,closeOther=void 0===closeOther?!1:closeOther,showEffect=void 0===showEffect?!0:showEffect)},__proto.popup=function(closeOther,showEffect){this._open(!0,closeOther=void 0===closeOther?!1:closeOther,showEffect=void 0===showEffect?!0:showEffect)},__proto._open=function(modal,closeOther,showEffect){Dialog.manager.lock(!1),this.isModal=modal,Dialog.manager.open(this,closeOther,showEffect)},__proto.onOpened=function(){},__proto.close=function(type,showEffect){Dialog.manager.close(this,type,showEffect=void 0===showEffect?!0:showEffect)},__proto.onClosed=function(type){},__proto._onMouseDown=function(e){var point=this.getMousePoint();this._dragArea.contains(point.x,point.y)?this.startDrag():this.stopDrag()},__getset(0,__proto,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(value){value?(value=UIUtils.fillArray([0,0,0,0],value,Number),this._dragArea=new Rectangle(value[0],value[1],value[2],value[3]),this.on("mousedown",this,this._onMouseDown)):(this._dragArea=null,this.off("mousedown",this,this._onMouseDown))}),__getset(0,__proto,"isPopup",function(){return null!=this.parent}),__getset(0,__proto,"zOrder",_super.prototype._$get_zOrder,function(value){Laya.superSet(View,this,"zOrder",value),Dialog.manager._checkMask()}),__getset(1,Dialog,"manager",function(){return Dialog._manager=Dialog._manager||new DialogManager},function(value){Dialog._manager=value}),Dialog.setLockView=function(view){Dialog.manager.setLockView(view)},Dialog.lock=function(value){Dialog.manager.lock(value)},Dialog.closeAll=function(){Dialog.manager.closeAll()},Dialog.getDialogsByGroup=function(group){return Dialog.manager.getDialogsByGroup(group)},Dialog.closeByGroup=function(group){return Dialog.manager.closeByGroup(group)},Dialog.CLOSE="close",Dialog.CANCEL="cancel",Dialog.SURE="sure",Dialog.NO="no",Dialog.OK="ok",Dialog.YES="yes",Dialog._manager=null,Dialog}(View),HBox=function(_super){function HBox(){HBox.__super.call(this)}__class(HBox,"laya.ui.HBox",_super);var __proto=HBox.prototype;return __proto.sortItem=function(items){items&&items.sort(function(a,b){return a.x-b.x})},__proto.changeItems=function(){this._itemChanged=!1;for(var items=[],maxHeight=0,i=0,n=this.numChildren;i<n;i++){var item=this.getChildAt(i);item&&item.layoutEnabled&&(items.push(item),maxHeight=this._height||Math.max(maxHeight,item.height*item.scaleY))}this.sortItem(items);for(var left=0,i=0,n=items.length;i<n;i++)(item=items[i]).x=left,left+=item.width*item.scaleX+this._space,"top"==this._align?item.y=0:"middle"==this._align?item.y=.5*(maxHeight-item.height*item.scaleY):"bottom"==this._align&&(item.y=maxHeight-item.height*item.scaleY);this.changeSize()},__getset(0,__proto,"height",_super.prototype._$get_height,function(value){this._height!=value&&(Laya.superSet(LayoutBox,this,"height",value),this.callLater(this.changeItems))}),HBox.NONE="none",HBox.TOP="top",HBox.MIDDLE="middle",HBox.BOTTOM="bottom",HBox}(LayoutBox),VBox=function(_super){function VBox(){VBox.__super.call(this)}__class(VBox,"laya.ui.VBox",_super);var __proto=VBox.prototype;return __proto.changeItems=function(){this._itemChanged=!1;for(var items=[],maxWidth=0,i=0,n=this.numChildren;i<n;i++){var item=this.getChildAt(i);item&&item.layoutEnabled&&(items.push(item),maxWidth=this._width||Math.max(maxWidth,item.width*item.scaleX))}this.sortItem(items);for(var top=0,i=0,n=items.length;i<n;i++)(item=items[i]).y=top,top+=item.height*item.scaleY+this._space,"left"==this._align?item.x=0:"center"==this._align?item.x=.5*(maxWidth-item.width*item.scaleX):"right"==this._align&&(item.x=maxWidth-item.width*item.scaleX);this.changeSize()},__getset(0,__proto,"width",_super.prototype._$get_width,function(value){this._width!=value&&(Laya.superSet(LayoutBox,this,"width",value),this.callLater(this.changeItems))}),VBox.NONE="none",VBox.LEFT="left",VBox.CENTER="center",VBox.RIGHT="right",VBox}(LayoutBox),RadioGroup=function(){function RadioGroup(){RadioGroup.__super.call(this)}return __class(RadioGroup,"laya.ui.RadioGroup",UIGroup),RadioGroup.prototype.createItem=function(skin,label){return new Radio(skin,label)},RadioGroup}(),Tab=function(){function Tab(){Tab.__super.call(this)}return __class(Tab,"laya.ui.Tab",UIGroup),Tab.prototype.createItem=function(skin,label){return new Button(skin,label)},Tab}(),TextArea=function(_super){function TextArea(text){this._vScrollBar=null,this._hScrollBar=null,TextArea.__super.call(this,text=void 0===text?"":text)}__class(TextArea,"laya.ui.TextArea",_super);var __proto=TextArea.prototype;return __proto.destroy=function(destroyChild){_super.prototype.destroy.call(this,destroyChild=void 0===destroyChild?!0:destroyChild),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},__proto.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},__proto.onVBarChanged=function(e){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},__proto.onHBarChanged=function(e){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},__proto.changeScroll=function(){var vShow=this._vScrollBar&&0<this._tf.maxScrollY,hShow=this._hScrollBar&&0<this._tf.maxScrollX,showWidth=vShow?this._width-this._vScrollBar.width:this._width,showHeight=hShow?this._height-this._hScrollBar.height:this._height,padding=this._tf.padding||Styles.labelPadding;this._tf.width=showWidth,this._tf.height=showHeight,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-padding[2],this._vScrollBar.y=padding[1],this._vScrollBar.height=this._height-(hShow?this._hScrollBar.height:0)-padding[1]-padding[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=showHeight/Math.max(this._tf.textHeight,showHeight),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=vShow),this._hScrollBar&&(this._hScrollBar.x=padding[0],this._hScrollBar.y=this._height-this._hScrollBar.height-padding[3],this._hScrollBar.width=this._width-(vShow?this._vScrollBar.width:0)-padding[0]-padding[2],this._hScrollBar.scrollSize=Math.max(.033*showWidth,1),this._hScrollBar.thumbPercent=showWidth/Math.max(this._tf.textWidth,showWidth),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=hShow)},__proto.scrollTo=function(y){this.commitMeasure(),this._tf.scrollY=y},__getset(0,__proto,"scrollY",function(){return this._tf.scrollY}),__getset(0,__proto,"width",_super.prototype._$get_width,function(value){Laya.superSet(TextInput,this,"width",value),this.callLater(this.changeScroll)}),__getset(0,__proto,"hScrollBar",function(){return this._hScrollBar}),__getset(0,__proto,"height",_super.prototype._$get_height,function(value){Laya.superSet(TextInput,this,"height",value),this.callLater(this.changeScroll)}),__getset(0,__proto,"maxScrollX",function(){return this._tf.maxScrollX}),__getset(0,__proto,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(value){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new VScrollBar),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=value}),__getset(0,__proto,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(value){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new HScrollBar),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=value}),__getset(0,__proto,"vScrollBar",function(){return this._vScrollBar}),__getset(0,__proto,"maxScrollY",function(){return this._tf.maxScrollY}),__getset(0,__proto,"scrollX",function(){return this._tf.scrollX}),TextArea}(TextInput);!function(){function AsynDialog(){this._uiView=null,this.isCloseOther=!1,AsynDialog.__super.call(this)}__class(AsynDialog,"laya.ui.AsynDialog",Dialog);var __proto=AsynDialog.prototype;__proto.createView=function(uiView){this._uiView=uiView},__proto._open=function(modal,closeOther,showEffect){this.isModal=modal,this.isCloseOther=closeOther,Dialog.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},__proto.onCreated=function(){this.createUI(),this.onOpen()},__proto.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},__proto.onOpen=function(){Dialog.manager.open(this,this.isCloseOther),Dialog.manager.lock(!1)},__proto.close=function(type,showEffect){void 0===showEffect&&(showEffect=!0),Dialog.manager.close(this),this.onClose()},__proto.onClose=function(){},__proto.destroy=function(destroyChild){void 0===destroyChild&&(destroyChild=!0),laya.ui.View.prototype.destroy.call(this,destroyChild),this._uiView=null,this.onDestroy()},__proto.onDestroy=function(){}}();Laya.__init([View])}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(require,exports){"use strict";for(var i in Object.defineProperty(exports,"__esModule",{value:!0}),Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o)}}),!function(){"use strict";var l=void 0,aa=this;function r(c,d){var e,a=c.split("."),b=aa;a[0]in b||!b.execScript||b.execScript("var "+a[0]);for(;a.length&&(e=a.shift());)a.length||d===l?b=b[e]||(b[e]={}):b[e]=d}var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function v(c){for(var e,f,g,h,k,m,n,s,x,d=c.length,a=0,b=Number.POSITIVE_INFINITY,p=0;p<d;++p)c[p]>a&&(a=c[p]),c[p]<b&&(b=c[p]);for(e=1<<a,f=new(t?Uint32Array:Array)(e),g=1,h=0,k=2;g<=a;){for(p=0;p<d;++p)if(c[p]===g){for(n=h,s=m=0;s<g;++s)m=m<<1|1&n,n>>=1;for(x=g<<16|p,s=m;s<e;s+=k)f[s]=x;++h}++g,h<<=1,k<<=1}return[f,a,b]}function w(c,d){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=t?new Uint8Array(c):c,this.m=!1,this.i=y,this.r=!1,(d?(d.index&&(this.a=d.index),d.bufferSize&&(this.h=d.bufferSize),d.bufferType&&(this.i=d.bufferType),d.resize):(d={},0))&&(this.r=d.resize),this.i){case A:this.b=32768,this.c=new(t?Uint8Array:Array)(32768+this.h+258);break;case y:this.b=0,this.c=new(t?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}for(var A=0,y=1,B_t=A,B_s=y,G=(w.prototype.k=function(){for(;!this.m;){var c=C(this,3);switch(1&c&&(this.m=!0),c>>>=1){case 0:var d=this.input,a=this.a,b=this.c,e=this.b,f=d.length,g=l,k=b.length,m=l;if(this.d=this.f=0,f<=a+1)throw Error("invalid uncompressed block header: LEN");if(g=d[a++]|d[a++]<<8,f<=a+1)throw Error("invalid uncompressed block header: NLEN");if(g===~(d[a++]|d[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+g>d.length)throw Error("input buffer is broken");switch(this.i){case A:for(;e+g>b.length;){if(g-=m=k-e,t)b.set(d.subarray(a,a+m),e),e+=m,a+=m;else for(;m--;)b[e++]=d[a++];this.b=e,b=this.e(),e=this.b}break;case y:for(;e+g>b.length;)b=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(t)b.set(d.subarray(a,a+g),e),e+=g,a+=g;else for(;g--;)b[e++]=d[a++];this.a=a,this.b=e,this.c=b;break;case 1:this.j(ba,ca);break;case 2:for(var S,U,M,V,f=C(this,5)+257,p=C(this,5)+1,s=C(this,4)+4,x=new(t?Uint8Array:Array)(D.length),u=l,F=l,z=l,q=l,q=0;q<s;++q)x[D[q]]=C(this,3);if(!t)for(q=s,s=x.length;q<s;++q)x[D[q]]=0;for(S=v(x),u=new(t?Uint8Array:Array)(f+p),q=0,V=f+p;q<V;)switch(M=E(this,S),M){case 16:for(z=3+C(this,2);z--;)u[q++]=F;break;case 17:for(z=3+C(this,3);z--;)u[q++]=0;F=0;break;case 18:for(z=11+C(this,7);z--;)u[q++]=0;F=0;break;default:F=u[q++]=M}p=v(t?u.subarray(0,f):u.slice(0,f)),U=v(t?u.subarray(f):u.slice(f)),this.j(p,U);break;default:throw Error("unknown BTYPE: "+c)}}return this.n()},[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D=t?new Uint16Array(G):G,G=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I=t?new Uint16Array(G):G,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],K=t?new Uint8Array(G):G,G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],da=t?new Uint16Array(G):G,G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=t?new Uint8Array(G):G,O=new(t?Uint8Array:Array)(288),P=0,fa=O.length;P<fa;++P)O[P]=P<=143?8:P<=255?9:P<=279?7:8;for(var ba=v(O),Q=new(t?Uint8Array:Array)(30),R=0,ga=Q.length;R<ga;++R)Q[R]=5;var ca=v(Q);function C(c,d){for(var h,a=c.f,b=c.d,e=c.input,f=c.a,g=e.length;b<d;){if(g<=f)throw Error("input buffer is broken");a|=e[f++]<<b,b+=8}return h=a&(1<<d)-1,c.f=a>>>d,c.d=b-d,c.a=f,h}function E(c,d){for(var a=c.f,b=c.d,e=c.input,f=c.a,g=e.length,h=d[0],k=d[1];b<k&&!(g<=f);)a|=e[f++]<<b,b+=8;if(b<(h=(d=h[a&(1<<k)-1])>>>16))throw Error("invalid code length: "+h);return c.f=a>>h,c.d=b-h,c.a=f,65535&d}function W(c,d){var a,b;if(this.input=c,this.a=0,(d?(d.index&&(this.a=d.index),d.verify):(d={},0))&&(this.A=d.verify),a=c[this.a++],b=c[this.a++],(15&a)!==ha)throw Error("unsupported compression method");if(this.method=ha,0!=((a<<8)+b)%31)throw Error("invalid fcheck flag:"+((a<<8)+b)%31);if(32&b)throw Error("fdict flag is not supported");this.q=new w(c,{index:this.a,bufferSize:d.bufferSize,bufferType:d.bufferType,resize:d.resize})}w.prototype.j=function(c,d){var a=this.c,b=this.b;this.o=c;for(var f,g,h,k,e=a.length-258;256!==(f=E(this,c));)if(f<256)e<=b&&(this.b=b,a=this.e(),b=this.b),a[b++]=f;else for(k=I[g=f-257],0<K[g]&&(k+=C(this,K[g])),f=E(this,d),h=da[f],0<N[f]&&(h+=C(this,N[f])),e<=b&&(this.b=b,a=this.e(),b=this.b);k--;)a[b]=a[b++-h];for(;8<=this.d;)this.d-=8,this.a--;this.b=b},w.prototype.w=function(c,d){var a=this.c,b=this.b;this.o=c;for(var f,g,h,k,e=a.length;256!==(f=E(this,c));)if(f<256)e<=b&&(e=(a=this.e()).length),a[b++]=f;else for(k=I[g=f-257],0<K[g]&&(k+=C(this,K[g])),f=E(this,d),h=da[f],0<N[f]&&(h+=C(this,N[f])),e<b+k&&(e=(a=this.e()).length);k--;)a[b]=a[b++-h];for(;8<=this.d;)this.d-=8,this.a--;this.b=b},w.prototype.e=function(){var a,b,c=new(t?Uint8Array:Array)(this.b-32768),d=this.b-32768,e=this.c;if(t)c.set(e.subarray(32768,c.length));else for(a=0,b=c.length;a<b;++a)c[a]=e[a+32768];if(this.g.push(c),this.l+=c.length,t)e.set(e.subarray(d,32768+d));else for(a=0;a<32768;++a)e[a]=e[d+a];return this.b=32768,e},w.prototype.z=function(c){var d,a=this.input.length/this.a+1|0,g=this.input,h=this.c;return c&&("number"==typeof c.p&&(a=c.p),"number"==typeof c.u)&&(a+=c.u),g=a<2?(c=(g.length-this.a)/this.o[2]/2*258|0)<h.length?h.length+c:h.length<<1:h.length*a,t?(d=new Uint8Array(g)).set(h):d=h,this.c=d},w.prototype.n=function(){var b,f,g,h,k,c=0,d=this.c,a=this.g,e=new(t?Uint8Array:Array)(this.l+(this.b-32768));if(0===a.length)return t?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(f=0,g=a.length;f<g;++f)for(h=0,k=(b=a[f]).length;h<k;++h)e[c++]=b[h];for(f=32768,g=this.b;f<g;++f)e[c++]=d[f];return this.g=[],this.buffer=e},w.prototype.v=function(){var c,d=this.b;return t?this.r?(c=new Uint8Array(d)).set(this.c.subarray(0,d)):c=this.c.subarray(0,d):(this.c.length>d&&(this.c.length=d),c=this.c),this.buffer=c},W.prototype.k=function(){var c=this.input,d=this.q.k();if(this.a=this.q.a,this.A){var c=(c[this.a++]<<24|c[this.a++]<<16|c[this.a++]<<8|c[this.a++])>>>0,b=d;if("string"==typeof b){for(var e=b.split(""),f=0,g=e.length;f<g;f++)e[f]=(255&e[f].charCodeAt(0))>>>0;b=e}for(var n,h=1,k=0,m=b.length,p=0;0<m;){for(m-=n=1024<m?1024:m;k+=h+=b[p++],--n;);h%=65521,k%=65521}if(c!=(k<<16|h)>>>0)throw Error("invalid adler-32 checksum")}return d};var Y,Z,$,ia,ha=8,X=(r("Zlib.Inflate",W),r("Zlib.Inflate.prototype.decompress",W.prototype.k),{ADAPTIVE:B_s,BLOCK:B_t});if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;for($=0,ia=Y.length;$<ia;++$)r("Zlib.Inflate.BufferType."+(Z=Y[$]),X[Z])}.call(this),!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).msgpack=t()}(function(){return function t(r,e,n){function i(f,u){if(!e[f]){if(!r[f]){var a="function"==typeof require&&require;if(!u&&a)return a(f,!0);if(o)return o(f,!0);u=new Error("Cannot find module '"+f+"'");throw u.code="MODULE_NOT_FOUND",u}a=e[f]={exports:{}};r[f][0].call(a.exports,function(t){var e=r[f][1][t];return i(e||t)},a,a.exports,t,r,e,n)}return e[f].exports}for(var o="function"==typeof require&&require,f=0;f<n.length;f++)i(n[f]);return i}({1:[function(t,r,e){e.encode=t("./encode").encode,e.decode=t("./decode").decode,e.Encoder=t("./encoder").Encoder,e.Decoder=t("./decoder").Decoder,e.createCodec=t("./ext").createCodec,e.codec=t("./codec").codec},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(t,r,e){!function(Buffer){function t(t){return t&&t.isBuffer&&t}r.exports=t(void 0!==Buffer&&Buffer)||t(this.Buffer)||t("undefined"!=typeof window&&window.Buffer)||this.Buffer}.call(this,t("buffer").Buffer)},{buffer:29}],3:[function(t,r,e){e.copy=function(t,r,e,n){r=r||0;var i,o=(n=n||0===n?n:this.length)-(e=e||0);if(t===this&&e<r&&r<n)for(i=o-1;0<=i;i--)t[i+r]=this[i+e];else for(i=0;i<o;i++)t[i+r]=this[i+e];return o},e.toString=function(t,r,e){var n=this,i=0|r;e=e||n.length;for(var o="",f=0;i<e;)!((f=n[i++])<128)&&(192==(224&f)?f=(31&f)<<6|63&n[i++]:224==(240&f)?f=(15&f)<<12|(63&n[i++])<<6|63&n[i++]:240==(248&f)&&(f=(7&f)<<18|(63&n[i++])<<12|(63&n[i++])<<6|63&n[i++]),65536<=f)?(f-=65536,o+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):o+=String.fromCharCode(f);return o},e.write=function(t,r){for(var o,e=this,n=r||(r|=0),i=t.length,f=0;f<i;)(o=t.charCodeAt(f++))<128?e[n++]=o:(o<2048?e[n++]=192|o>>>6:(o<55296||57343<o?e[n++]=224|o>>>12:(o=65536+(o-55296<<10|t.charCodeAt(f++)-56320),e[n++]=240|o>>>18,e[n++]=128|o>>>12&63),e[n++]=128|o>>>6&63),e[n++]=128|63&o);return n-r}},{}],4:[function(t,r,e){function n(t){return new Array(t)}var o=t("./bufferish");(e=r.exports=n(0)).alloc=n,e.concat=o.concat,e.from=function(t){if(!o.isBuffer(t)&&o.isView(t))t=o.Uint8Array.from(t);else if(o.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return o.from.call(e,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(t)}},{"./bufferish":8}],5:[function(t,r,e){function n(t){return new Buffer(t)}var o=t("./bufferish"),Buffer=o.global;(e=r.exports=o.hasBuffer?n(0):[]).alloc=o.hasBuffer&&Buffer.alloc||n,e.concat=o.concat,e.from=function(t){if(!o.isBuffer(t)&&o.isView(t))t=o.Uint8Array.from(t);else if(o.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return o.from.call(e,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return Buffer.from&&1!==Buffer.from.length?Buffer.from(t):new Buffer(t)}},{"./bufferish":8}],6:[function(t,r,e){function n(t,r,e,n){var o=a.isBuffer(this),f=a.isBuffer(t);return o&&f?this.copy(t,r,e,n):c||o||f||!a.isView(this)||!a.isView(t)?u.copy.call(this,t,r,e,n):(o=e||null!=n?i.call(this,e,n):this,t.set(o,r),o.length)}function i(t,r){var e=this.slice||!c&&this.subarray;return e?e.call(this,t,r):(e=a.alloc.call(this,r-t),n.call(this,e,0,t,r),e)}var u=t("./buffer-lite"),a=(e.copy=n,e.slice=i,e.toString=function(t,r,e){return(!s&&a.isBuffer(this)?this:u).toString.apply(this,arguments)},e.write=function(t){return function(){return(this[t]||u[t]).apply(this,arguments)}}("write"),t("./bufferish")),e=a.global,s=a.hasBuffer&&"TYPED_ARRAY_SUPPORT"in e,c=s&&!e.TYPED_ARRAY_SUPPORT},{"./buffer-lite":3,"./bufferish":8}],7:[function(t,r,e){function n(t){return new Uint8Array(t)}var o=t("./bufferish");(e=r.exports=o.hasArrayBuffer?n(0):[]).alloc=n,e.concat=o.concat,e.from=function(t){if(o.isView(t)){var r=t.byteOffset,n=t.byteLength;(t=t.buffer).byteLength!==n&&(t.slice?t=t.slice(r,r+n):(t=new Uint8Array(t)).byteLength!==n&&(t=Array.prototype.slice.call(t,r,r+n)))}else{if("string"==typeof t)return o.from.call(e,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(t)}},{"./bufferish":8}],8:[function(t,r,e){function i(t){return a(this).alloc(t)}function a(t){return d(t)?g:y(t)?b:p(t)?v:h?g:l?b:v}function s(){return!1}function c(t,r){return t="[object "+t+"]",function(e){return null!=e&&{}.toString.call(r?e[r]:e)===t}}var Buffer=e.global=t("./buffer-global"),h=e.hasBuffer=Buffer&&!!Buffer.isBuffer,l=e.hasArrayBuffer="undefined"!=typeof ArrayBuffer,p=e.isArray=t("isarray"),d=(e.isArrayBuffer=l?function(t){return t instanceof ArrayBuffer||E(t)}:s,e.isBuffer=h?Buffer.isBuffer:s),y=e.isView=l?ArrayBuffer.isView||c("ArrayBuffer","buffer"):s,v=(e.alloc=i,e.concat=function(t,r){r||(r=0,Array.prototype.forEach.call(t,function(t){r+=t.length}));var f=this!==e&&this||t[0],u=i.call(f,r),a=0;return Array.prototype.forEach.call(t,function(t){a+=w.copy.call(t,u,a)}),u},e.from=function(t){return"string"==typeof t?function(t){var r=3*t.length,e=i.call(this,r),t=w.write.call(e,t);return e=r!==t?w.slice.call(e,0,t):e}.call(this,t):a(this).from(t)},e.Array=t("./bufferish-array")),g=e.Buffer=t("./bufferish-buffer"),b=e.Uint8Array=t("./bufferish-uint8array"),w=e.prototype=t("./bufferish-proto"),E=c("ArrayBuffer")},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(t,r,e){function n(t){return this instanceof n?(this.options=t,void this.init()):new n(t)}function a(t){return new n(t)}var s=t("isarray"),c=(e.createCodec=a,e.install=function(t){for(var r in t)n.prototype[r]=function(t,r){return t&&r?function(){return t.apply(this,arguments),r.apply(this,arguments)}:t||r}(n.prototype[r],t[r])},e.filter=function(t){return s(t)?function(t){function r(t,r){return r(t)}return t=t.slice(),function(e){return t.reduce(r,e)}}(t):t},t("./bufferish"));n.prototype.init=function(){var t=this.options;return t&&t.uint8array&&(this.bufferish=c.Uint8Array),this},e.preset=a({preset:!0})},{"./bufferish":8,isarray:34}],10:[function(t,r,e){t("./read-core"),t("./write-core"),e.codec={preset:t("./codec-base").preset}},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(t,r,e){function n(t){if(!(this instanceof n))return new n(t);t&&(this.options=t).codec&&((t=this.codec=t.codec).bufferish&&(this.bufferish=t.bufferish))}e.DecodeBuffer=n;e=t("./read-core").preset;t("./flex-buffer").FlexDecoder.mixin(n.prototype),n.prototype.codec=e,n.prototype.fetch=function(){return this.codec.decode(this)}},{"./flex-buffer":21,"./read-core":22}],12:[function(t,r,e){e.decode=function(t,r){return(r=new i(r)).write(t),r.read()};var i=t("./decode-buffer").DecodeBuffer},{"./decode-buffer":11}],13:[function(t,r,e){function n(t){return this instanceof n?void o.call(this,t):new n(t)}e.Decoder=n;var e=t("event-lite"),o=t("./decode-buffer").DecodeBuffer;n.prototype=new o,e.mixin(n.prototype),n.prototype.decode=function(t){arguments.length&&this.write(t),this.flush()},n.prototype.push=function(t){this.emit("data",t)},n.prototype.end=function(t){this.decode(t),this.emit("end")}},{"./decode-buffer":11,"event-lite":31}],14:[function(t,r,e){function n(t){if(!(this instanceof n))return new n(t);t&&(this.options=t).codec&&((t=this.codec=t.codec).bufferish&&(this.bufferish=t.bufferish))}e.EncodeBuffer=n;e=t("./write-core").preset;t("./flex-buffer").FlexEncoder.mixin(n.prototype),n.prototype.codec=e,n.prototype.write=function(t){this.codec.encode(this,t)}},{"./flex-buffer":21,"./write-core":25}],15:[function(t,r,e){e.encode=function(t,r){return(r=new i(r)).write(t),r.read()};var i=t("./encode-buffer").EncodeBuffer},{"./encode-buffer":14}],16:[function(t,r,e){function n(t){return this instanceof n?void o.call(this,t):new n(t)}e.Encoder=n;var e=t("event-lite"),o=t("./encode-buffer").EncodeBuffer;n.prototype=new o,e.mixin(n.prototype),n.prototype.encode=function(t){this.write(t),this.emit("data",this.read())},n.prototype.end=function(t){arguments.length&&this.encode(t),this.flush(),this.emit("end")}},{"./encode-buffer":14,"event-lite":31}],17:[function(t,r,e){e.ExtBuffer=function n(t,r){return this instanceof n?(this.buffer=i.from(t),void(this.type=r)):new n(t,r)};var i=t("./bufferish")},{"./bufferish":8}],18:[function(t,r,e){function i(r){return(a=a||t("./encode").encode)(r)}function o(t){return t.valueOf()}function f(t){(t=RegExp.prototype.toString.call(t).split("/")).shift();var r=[t.pop()];return r.unshift(t.join("/")),r}function u(t){var e,r={};for(e in h)r[e]=t[e];return r}e.setExtPackers=function(t){t.addExtPacker(14,Error,[u,i]),t.addExtPacker(1,EvalError,[u,i]),t.addExtPacker(2,RangeError,[u,i]),t.addExtPacker(3,ReferenceError,[u,i]),t.addExtPacker(4,SyntaxError,[u,i]),t.addExtPacker(5,TypeError,[u,i]),t.addExtPacker(6,URIError,[u,i]),t.addExtPacker(10,RegExp,[f,i]),t.addExtPacker(11,Boolean,[o,i]),t.addExtPacker(12,String,[o,i]),t.addExtPacker(13,Date,[Number,i]),t.addExtPacker(15,Number,[o,i]),"undefined"!=typeof Uint8Array&&(t.addExtPacker(17,Int8Array,c),t.addExtPacker(18,Uint8Array,c),t.addExtPacker(19,Int16Array,c),t.addExtPacker(20,Uint16Array,c),t.addExtPacker(21,Int32Array,c),t.addExtPacker(22,Uint32Array,c),t.addExtPacker(23,Float32Array,c),"undefined"!=typeof Float64Array&&t.addExtPacker(24,Float64Array,c),"undefined"!=typeof Uint8ClampedArray&&t.addExtPacker(25,Uint8ClampedArray,c),t.addExtPacker(26,ArrayBuffer,c),t.addExtPacker(29,DataView,c)),s.hasBuffer&&t.addExtPacker(27,Buffer,s.from)};var a,s=t("./bufferish"),Buffer=s.global,c=s.Uint8Array.from,h={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./encode":15}],19:[function(t,r,e){function i(r){return(s=s||t("./decode").decode)(r)}function o(t){return RegExp.apply(null,t)}function f(t){return function(r){var n,e=new t;for(n in h)e[n]=r[n];return e}}function u(t){return function(r){return new t(r)}}function a(t){return new Uint8Array(t).buffer}e.setExtUnpackers=function(t){t.addExtUnpacker(14,[i,f(Error)]),t.addExtUnpacker(1,[i,f(EvalError)]),t.addExtUnpacker(2,[i,f(RangeError)]),t.addExtUnpacker(3,[i,f(ReferenceError)]),t.addExtUnpacker(4,[i,f(SyntaxError)]),t.addExtUnpacker(5,[i,f(TypeError)]),t.addExtUnpacker(6,[i,f(URIError)]),t.addExtUnpacker(10,[i,o]),t.addExtUnpacker(11,[i,u(Boolean)]),t.addExtUnpacker(12,[i,u(String)]),t.addExtUnpacker(13,[i,u(Date)]),t.addExtUnpacker(15,[i,u(Number)]),"undefined"!=typeof Uint8Array&&(t.addExtUnpacker(17,u(Int8Array)),t.addExtUnpacker(18,u(Uint8Array)),t.addExtUnpacker(19,[a,u(Int16Array)]),t.addExtUnpacker(20,[a,u(Uint16Array)]),t.addExtUnpacker(21,[a,u(Int32Array)]),t.addExtUnpacker(22,[a,u(Uint32Array)]),t.addExtUnpacker(23,[a,u(Float32Array)]),"undefined"!=typeof Float64Array&&t.addExtUnpacker(24,[a,u(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&t.addExtUnpacker(25,u(Uint8ClampedArray)),t.addExtUnpacker(26,a),t.addExtUnpacker(29,[a,u(DataView)])),c.hasBuffer&&t.addExtUnpacker(27,u(Buffer))};var s,c=t("./bufferish"),Buffer=c.global,h={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./decode":12}],20:[function(t,r,e){t("./read-core"),t("./write-core"),e.createCodec=t("./codec-base").createCodec},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(t,r,e){function n(){if(!(this instanceof n))return new n}function i(){if(!(this instanceof i))return new i}function u(){throw new Error("method not implemented: write()")}function a(){throw new Error("method not implemented: fetch()")}function s(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function c(t){(this.buffers||(this.buffers=[])).push(t)}function h(){return(this.buffers||(this.buffers=[])).shift()}function l(t){return function(r){for(var e in t)r[e]=t[e];return r}}e.FlexDecoder=n,e.FlexEncoder=i;var p=t("./bufferish"),v="BUFFER_SHORTAGE";n.mixin=l({bufferish:p,write:function(t){var r=this.offset?p.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=r?t?this.bufferish.concat([r,t]):r:t,this.offset=0},fetch:a,flush:function(){for(;this.offset<this.buffer.length;){var t,r=this.offset;try{t=this.fetch()}catch(t){if(t&&t.message!=v)throw t;this.offset=r;break}this.push(t)}},push:c,pull:h,read:s,reserve:function(t){var r=this.offset;if((t=r+t)>this.buffer.length)throw new Error(v);return this.offset=t,r},offset:0}),n.mixin(n.prototype),i.mixin=l({bufferish:p,write:u,fetch:function(){var r,t=this.start;if(t<this.offset)return r=this.start=this.offset,p.prototype.slice.call(this.buffer,t,r)},flush:function(){for(;this.start<this.offset;){var t=this.fetch();t&&this.push(t)}},push:c,pull:function(){var t=this.buffers||(this.buffers=[]),r=1<t.length?this.bufferish.concat(t):t[0];return t.length=0,r},read:s,reserve:function(t){var r=0|t;if(this.buffer){var e=this.buffer.length,n=0|this.offset,i=n+r;if(i<e)return this.offset=i,n;this.flush(),t=Math.max(t,Math.min(2*e,this.maxBufferSize))}return t=Math.max(t,this.minBufferSize),this.buffer=this.bufferish.alloc(t),this.start=0,this.offset=r,0},send:function(t){var r=t.length;r>this.minBufferSize?(this.flush(),this.push(t)):(r=this.reserve(r),p.prototype.copy.call(t,this.buffer,r))},maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}),i.mixin(i.prototype)},{"./bufferish":8}],22:[function(t,r,e){function n(t){var e=c.getReadToken(t);return function(t){var r=s(t),n=e[r];if(n)return n(t);throw new Error("Invalid type: "+(r&&"0x"+r.toString(16)))}}function i(){var t=this.options;return this.decode=n(t),t&&t.preset&&a.setExtUnpackers(this),this}var u=t("./ext-buffer").ExtBuffer,a=t("./ext-unpacker"),s=t("./read-format").readUint8,c=t("./read-token"),h=t("./codec-base");h.install({addExtUnpacker:function(t,r){(this.extUnpackers||(this.extUnpackers=[]))[t]=h.filter(r)},getExtUnpacker:function(t){return(this.extUnpackers||(this.extUnpackers=[]))[t]||function(r){return new u(r,t)}},init:i}),e.preset=i.call(h.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(t,r,e){function i(t,r){for(var n={},i=new Array(r),o=new Array(r),f=t.codec.decode,e=0;e<r;e++)i[e]=f(t),o[e]=f(t);for(e=0;e<r;e++)n[i[e]]=o[e];return n}function o(t,r){for(var n=new Map,i=new Array(r),o=new Array(r),f=t.codec.decode,e=0;e<r;e++)i[e]=f(t),o[e]=f(t);for(e=0;e<r;e++)n.set(i[e],o[e]);return n}function f(t,r){for(var e=new Array(r),n=t.codec.decode,i=0;i<r;i++)e[i]=n(t);return e}function u(t,r){var e=t.reserve(r);return _.toString.call(t.buffer,"utf-8",e,e+r)}function a(t,r){var e=t.reserve(r),t=_.slice.call(t.buffer,e,e+r);return k.from(t)}function s(t,r){var e=t.reserve(r),t=_.slice.call(t.buffer,e,e+r);return k.Uint8Array.from(t).buffer}function c(t,r){var e=t.reserve(r+1),n=t.buffer[e++],r=e+r,o=t.codec.getExtUnpacker(n);if(o)return o(_.slice.call(t.buffer,e,r));throw new Error("Invalid ext type: "+(n&&"0x"+n.toString(16)))}function h(t){var r=t.reserve(1);return t.buffer[r]}function l(t){var r=t.reserve(1),t=t.buffer[r];return 128&t?t-256:t}function p(t){var r=t.reserve(2),t=t.buffer;return t[r++]<<8|t[r]}function d(t){var r=t.reserve(2),t=t.buffer,t=t[r++]<<8|t[r];return 32768&t?t-65536:t}function y(t){var r=t.reserve(4),t=t.buffer;return 16777216*t[r++]+(t[r++]<<16)+(t[r++]<<8)+t[r]}function v(t){var r=t.reserve(4),t=t.buffer;return t[r++]<<24|t[r++]<<16|t[r++]<<8|t[r]}function g(t,r){return function(e){var n=e.reserve(t);return r.call(e.buffer,n,S)}}function b(t){return new P(this,t).toNumber()}function w(t){return new R(this,t).toNumber()}function E(t){return new P(this,t)}function A(t){return new R(this,t)}function m(t){return B.read(this,t,!1,23,4)}function x(t){return B.read(this,t,!1,52,8)}var B=t("ieee754"),U=t("int64-buffer"),P=U.Uint64BE,R=U.Int64BE,k=(e.getReadFormat=function(t){var r=k.hasArrayBuffer&&t&&t.binarraybuffer,e=t&&t.int64;return{map:T&&t&&t.usemap?o:i,array:f,str:u,bin:r?s:a,ext:c,uint8:h,uint16:p,uint32:y,uint64:g(8,e?E:b),int8:l,int16:d,int32:v,int64:g(8,e?A:w),float32:g(4,m),float64:g(8,x)}},e.readUint8=h,t("./bufferish")),_=t("./bufferish-proto"),T="undefined"!=typeof Map,S=!0},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(t,r,e){function i(t){for(var e=new Array(256),r=0;r<=127;r++)e[r]=f(r);for(r=128;r<=143;r++)e[r]=a(r-128,t.map);for(r=144;r<=159;r++)e[r]=a(r-144,t.array);for(r=160;r<=191;r++)e[r]=a(r-160,t.str);for(e[192]=f(null),e[193]=null,e[194]=f(!1),e[195]=f(!0),e[196]=u(t.uint8,t.bin),e[197]=u(t.uint16,t.bin),e[198]=u(t.uint32,t.bin),e[199]=u(t.uint8,t.ext),e[200]=u(t.uint16,t.ext),e[201]=u(t.uint32,t.ext),e[202]=t.float32,e[203]=t.float64,e[204]=t.uint8,e[205]=t.uint16,e[206]=t.uint32,e[207]=t.uint64,e[208]=t.int8,e[209]=t.int16,e[210]=t.int32,e[211]=t.int64,e[212]=a(1,t.ext),e[213]=a(2,t.ext),e[214]=a(4,t.ext),e[215]=a(8,t.ext),e[216]=a(16,t.ext),e[217]=u(t.uint8,t.str),e[218]=u(t.uint16,t.str),e[219]=u(t.uint32,t.str),e[220]=u(t.uint16,t.array),e[221]=u(t.uint32,t.array),e[222]=u(t.uint16,t.map),e[223]=u(t.uint32,t.map),r=224;r<=255;r++)e[r]=f(r-256);return e}function f(t){return function(){return t}}function u(t,r){return function(e){var n=t(e);return r(e,n)}}function a(t,r){return function(e){return r(e,t)}}var s=t("./read-format");e.getReadToken=function(t){var r=s.getReadFormat(t);return(t&&t.useraw?function(t){var r,e=i(t).slice();for(e[217]=e[196],e[218]=e[197],e[219]=e[198],r=160;r<=191;r++)e[r]=a(r-160,t.bin);return e}:i)(r)}},{"./read-format":23}],25:[function(t,r,e){function n(t){var e=s.getWriteType(t);return function(t,r){var n=e[typeof r];if(!n)throw new Error('Unsupported type "'+typeof r+'": '+r);n(t,r)}}function i(){var t=this.options;return this.encode=n(t),t&&t.preset&&a.setExtPackers(this),this}var u=t("./ext-buffer").ExtBuffer,a=t("./ext-packer"),s=t("./write-type"),c=t("./codec-base");c.install({addExtPacker:function(t,r,e){function n(r){return e&&(r=e(r)),new u(r,t)}e=c.filter(e);var i=r.name;i&&"Object"!==i?(this.extPackers||(this.extPackers={}))[i]=n:(this.extEncoderList||(this.extEncoderList=[])).unshift([r,n])},getExtPacker:function(t){var r=this.extPackers||(this.extPackers={}),e=t.constructor;if(t=e&&e.name&&r[e.name])return t;for(var i=this.extEncoderList||(this.extEncoderList=[]),o=i.length,f=0;f<o;f++){var u=i[f];if(e===u[0])return u[1]}},init:i}),e.preset=i.call(c.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(t,r,e){function o(){var t=w.slice();return t[196]=u(196),t[197]=a(197),t[198]=s(198),t[199]=u(199),t[200]=a(200),t[201]=s(201),t[202]=c(202,4,x.writeFloatBE||p,!0),t[203]=c(203,8,x.writeDoubleBE||d,!0),t[204]=u(204),t[205]=a(205),t[206]=s(206),t[207]=c(207,8,h),t[208]=u(208),t[209]=a(209),t[210]=s(210),t[211]=c(211,8,l),t[217]=u(217),t[218]=a(218),t[219]=s(219),t[220]=a(220),t[221]=s(221),t[222]=a(222),t[223]=s(223),t}function u(t){return function(r,e){var n=r.reserve(2),r=r.buffer;r[n++]=t,r[n]=e}}function a(t){return function(r,e){var n=r.reserve(3),r=r.buffer;r[n++]=t,r[n++]=e>>>8,r[n]=e}}function s(t){return function(r,e){var n=r.reserve(5),r=r.buffer;r[n++]=t,r[n++]=e>>>24,r[n++]=e>>>16,r[n++]=e>>>8,r[n]=e}}function c(t,r,e,n){return function(i,o){var f=i.reserve(r+1);i.buffer[f++]=t,e.call(i.buffer,o,f,n)}}function h(t,r){new g(this,r,t)}function l(t,r){new b(this,r,t)}function p(t,r){y.write(this,t,r,!1,23,4)}function d(t,r){y.write(this,t,r,!1,52,8)}var y=t("ieee754"),v=t("int64-buffer"),g=v.Uint64BE,b=v.Int64BE,w=t("./write-uint8").uint8,E=t("./bufferish"),Buffer=E.global,m=E.hasBuffer&&"TYPED_ARRAY_SUPPORT"in Buffer&&!Buffer.TYPED_ARRAY_SUPPORT,x=E.hasBuffer&&Buffer.prototype||{};e.getWriteToken=function(t){return(t&&t.uint8array?function(){var t=o();return t[202]=c(202,4,p),t[203]=c(203,8,d),t}:m||E.hasBuffer&&t&&t.safe?function(){var t=w.slice();return t[196]=c(196,1,Buffer.prototype.writeUInt8),t[197]=c(197,2,Buffer.prototype.writeUInt16BE),t[198]=c(198,4,Buffer.prototype.writeUInt32BE),t[199]=c(199,1,Buffer.prototype.writeUInt8),t[200]=c(200,2,Buffer.prototype.writeUInt16BE),t[201]=c(201,4,Buffer.prototype.writeUInt32BE),t[202]=c(202,4,Buffer.prototype.writeFloatBE),t[203]=c(203,8,Buffer.prototype.writeDoubleBE),t[204]=c(204,1,Buffer.prototype.writeUInt8),t[205]=c(205,2,Buffer.prototype.writeUInt16BE),t[206]=c(206,4,Buffer.prototype.writeUInt32BE),t[207]=c(207,8,h),t[208]=c(208,1,Buffer.prototype.writeInt8),t[209]=c(209,2,Buffer.prototype.writeInt16BE),t[210]=c(210,4,Buffer.prototype.writeInt32BE),t[211]=c(211,8,l),t[217]=c(217,1,Buffer.prototype.writeUInt8),t[218]=c(218,2,Buffer.prototype.writeUInt16BE),t[219]=c(219,4,Buffer.prototype.writeUInt32BE),t[220]=c(220,2,Buffer.prototype.writeUInt16BE),t[221]=c(221,4,Buffer.prototype.writeUInt32BE),t[222]=c(222,2,Buffer.prototype.writeUInt16BE),t[223]=c(223,4,Buffer.prototype.writeUInt32BE),t}:o)()}},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(t,r,e){var i=t("isarray"),o=t("int64-buffer"),f=o.Uint64BE,u=o.Int64BE,a=t("./bufferish"),s=t("./bufferish-proto"),c=t("./write-token"),h=t("./write-uint8").uint8,l=t("./ext-buffer").ExtBuffer,p="undefined"!=typeof Uint8Array,d="undefined"!=typeof Map,y=[];y[1]=212,y[2]=213,y[4]=214,y[8]=215,y[16]=216,e.getWriteType=function(t){function w(t,r){var e;return null===r?A(t,r):I(r)?Y(t,r):i(r)?function(t,r){var e=r.length;_[e<16?144+e:e<=65535?220:221](t,e);for(var i=t.codec.encode,o=0;o<e;o++)i(t,r[o])}(t,r):f.isUint64BE(r)?function(t,r){_[207](t,r.toArray())}(t,r):u.isInt64BE(r)?function(t,r){_[211](t,r.toArray())}(t,r):(r=(e=t.codec.getExtPacker(r))?e(r):r)instanceof l?function(t,r){var e=r.buffer,n=e.length;_[y[n]||(n<255?199:n<=65535?200:201)](t,n),h[r.type](t),t.send(e)}(t,r):void D(t,r)}function A(t,r){_[192](t,r)}function x(t,r){var e=r.length;_[e<255?196:e<=65535?197:198](t,e),t.send(r)}function P(t,r){var e=Object.keys(r),n=e.length,o=(_[n<16?128+n:n<=65535?222:223](t,n),t.codec.encode);e.forEach(function(e){o(t,e),o(t,r[e])})}var _=c.getWriteToken(t),T=t&&t.useraw,S=p&&t&&t.binarraybuffer,I=S?a.isArrayBuffer:a.isBuffer,Y=S?function(t,r){x(t,new Uint8Array(r))}:x,D=d&&t&&t.usemap?function(t,r){if(!(r instanceof Map))return P(t,r);var e=r.size,i=(_[e<16?128+e:e<=65535?222:223](t,e),t.codec.encode);r.forEach(function(r,e,n){i(t,e),i(t,r)})}:P;return{boolean:function(t,r){_[r?195:194](t,r)},function:A,number:function(t,r){var n=0|r;return r!==n?void _[203](t,r):void _[-32<=n&&n<=127?255&n:0<=n?n<=255?204:n<=65535?205:206:-128<=n?208:-32768<=n?209:210](t,n)},object:T?function(t,r){return I(r)?function(t,r){var e=r.length;_[e<32?160+e:e<=65535?218:219](t,e),t.send(r)}(t,r):void w(t,r)}:w,string:function(t){return function(r,e){var n=e.length,o=(r.offset=r.reserve(5+3*n),r.buffer),f=t(n),u=r.offset+f,n=s.write.call(o,e,u),e=t(n);f!==e&&s.copy.call(o,o,u+e-f,u,u+n),_[1===e?160+n:e<=3?215+e:219](r,n),r.offset+=n}}(T?function(t){return t<32?1:t<=65535?3:5}:function(t){return t<32?1:t<=255?2:t<=65535?3:5}),symbol:A,undefined:A}}},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(t,r,e){for(var i=e.uint8=new Array(256),o=0;o<=255;o++)i[o]=function(t){return function(r){var e=r.reserve(1);r.buffer[e]=t}}(o)},{}],29:[function(t,r,e){!function(r){"use strict";function i(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,r){if(i()<r)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r)).__proto__=Buffer.prototype:(t=null===t?new Buffer(r):t).length=r,t}function Buffer(t,r,e){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,r,e);if("number"!=typeof t)return f(this,t,r,e);if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return s(this,t)}function f(t,r,e,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?function(t,r,e,n){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===e&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,e):new Uint8Array(r,e,n),Buffer.TYPED_ARRAY_SUPPORT?(t=r).__proto__=Buffer.prototype:t=h(t,r),t}(t,r,e,n):"string"==typeof r?function(t,r,e){var n;if(Buffer.isEncoding(e="string"==typeof e&&""!==e?e:"utf8"))return n=0|v(r,e),t=(r=(t=o(t,n)).write(r,e))!==n?t.slice(0,r):t;throw new TypeError('"encoding" must be a valid string encoding')}(t,r,e):function(t,r){{var e;if(Buffer.isBuffer(r))return e=0|d(r.length),0!==(t=o(t,e)).length&&r.copy(t,0,0,e),t}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||function(t){return t!=t}(r.length)?o(t,0):h(t,r);if("Buffer"===r.type&&Q(r.data))return h(t,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,r)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function s(t,r){if(u(r),t=o(t,r<0?0:0|d(r)),!Buffer.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)t[e]=0;return t}function h(t,r){var e=r.length<0?0:0|d(r.length);t=o(t,e);for(var n=0;n<e;n+=1)t[n]=255&r[n];return t}function d(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function v(t,r){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;var e=(t="string"!=typeof t?""+t:t).length;if(0===e)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return X(t).length;default:if(n)return q(t).length;r=(""+r).toLowerCase(),n=!0}}function g(t,r,e){var n=!1;if((r=void 0===r||r<0?0:r)>this.length)return"";if((e=void 0===e||e>this.length?this.length:e)<=0)return"";if((e>>>=0)<=(r>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return function(t,r,e){var n=t.length;(!e||e<0||n<e)&&(e=n);for(var i="",o=r=!r||r<0?0:r;o<e;++o)i+=function(t){return t<16?"0"+t.toString(16):t.toString(16)}(t[o]);return i}(this,r,e);case"utf8":case"utf-8":return k(this,r,e);case"ascii":return function(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(127&t[i]);return n}(this,r,e);case"latin1":case"binary":return function(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(t[i]);return n}(this,r,e);case"base64":return function(t,r,e){return 0===r&&e===t.length?Z.fromByteArray(t):Z.fromByteArray(t.slice(r,e))}(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,r,e){var n=t[r];t[r]=t[e],t[e]=n}function w(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):2147483647<e?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,(e=(e=isNaN(e)?i?0:t.length-1:e)<0?t.length+e:e)>=t.length){if(i)return-1;e=t.length-1}else if(e<0){if(!i)return-1;e=0}if("string"==typeof r&&(r=Buffer.from(r,n)),Buffer.isBuffer(r))return 0===r.length?-1:E(t,r,e,n,i);if("number"==typeof r)return r&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,r,e):E(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer")}function E(t,r,e,n,i){function o(t,r){return 1===f?t[r]:t.readUInt16BE(r*f)}var f=1,u=t.length,a=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;u/=f=2,a/=2,e/=2}if(i)for(var c=-1,s=e;s<u;s++)if(o(t,s)===o(r,-1===c?0:s-c)){if(s-(c=-1===c?s:c)+1===a)return c*f}else-1!==c&&(s-=s-c),c=-1;else for(s=e=u<e+a?u-a:e;0<=s;s--){for(var h=!0,l=0;l<a;l++)if(o(t,s+l)!==o(r,l)){h=!1;break}if(h)return s}return-1}function x(t,r,e,n){return G(function(t){for(var r=[],e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r}(r),t,e,n)}function P(t,r,e,n){return G(function(t,r){for(var e,n,o=[],f=0;f<t.length&&!((r-=2)<0);++f)e=t.charCodeAt(f),n=e>>8,o.push(e%256),o.push(n);return o}(r,t.length-e),t,e,n)}function k(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var a,s,c,h,o=t[i],f=null,u=239<o?4:223<o?3:191<o?2:1;if(i+u<=e)switch(u){case 1:o<128&&(f=o);break;case 2:128==(192&(a=t[i+1]))&&127<(h=(31&o)<<6|63&a)&&(f=h);break;case 3:a=t[i+1],s=t[i+2],128==(192&a)&&128==(192&s)&&2047<(h=(15&o)<<12|(63&a)<<6|63&s)&&(h<55296||57343<h)&&(f=h);break;case 4:a=t[i+1],s=t[i+2],c=t[i+3],128==(192&a)&&128==(192&s)&&128==(192&c)&&65535<(h=(15&o)<<18|(63&a)<<12|(63&s)<<6|63&c)&&h<1114112&&(f=h)}null===f?(f=65533,u=1):65535<f&&(n.push((f-=65536)>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=u}return function(t){var r=t.length;if(r<=$)return String.fromCharCode.apply(String,t);for(var e="",n=0;n<r;)e+=String.fromCharCode.apply(String,t.slice(n,n+=$));return e}(n)}function C(t,r,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(e<t+r)throw new RangeError("Trying to access beyond buffer length")}function D(t,r,e,n,i,o){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<r||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range")}function O(t,r,e,n){r<0&&(r=65535+r+1);for(var i=0,o=Math.min(t.length-e,2);i<o;++i)t[e+i]=(r&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function L(t,r,e,n){r<0&&(r=4294967295+r+1);for(var i=0,o=Math.min(t.length-e,4);i<o;++i)t[e+i]=r>>>8*(n?i:3-i)&255}function M(t,r,e,n){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function N(t,r,e,n,i){return i||M(t,0,e,4),K.write(t,r,e,n,23,4),e+4}function F(t,r,e,n,i){return i||M(t,0,e,8),K.write(t,r,e,n,52,8),e+8}function q(t,r){r=r||1/0;for(var e,n=t.length,i=null,o=[],f=0;f<n;++f){if(55295<(e=t.charCodeAt(f))&&e<57344){if(!i){if(56319<e){-1<(r-=3)&&o.push(239,191,189);continue}if(f+1===n){-1<(r-=3)&&o.push(239,191,189);continue}i=e;continue}if(e<56320){-1<(r-=3)&&o.push(239,191,189),i=e;continue}e=65536+(i-55296<<10|e-56320)}else i&&-1<(r-=3)&&o.push(239,191,189);if(i=null,e<128){if(--r<0)break;o.push(e)}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128)}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return o}function X(t){return Z.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(tt,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i)r[i+e]=t[i];return i}var Z=t("base64-js"),K=t("ieee754"),Q=t("isarray"),$=(e.Buffer=Buffer,e.SlowBuffer=function(t){return Buffer.alloc(+(t=+t!=t?0:t))},e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==r.TYPED_ARRAY_SUPPORT?r.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=i(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,r,e){return f(null,t,r,e)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0}),Buffer.alloc=function(t,r,e){return function(t,r,e,n){return u(r),!(r<=0)&&void 0!==e?"string"==typeof n?o(t,r).fill(e,n):o(t,r).fill(e):o(t,r)}(null,t,r,e)},Buffer.allocUnsafe=function(t){return s(null,t)},Buffer.allocUnsafeSlow=function(t){return s(null,t)},Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer)},Buffer.compare=function(t,r){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i)if(t[i]!==r[i]){e=t[i],n=r[i];break}return e<n?-1:n<e?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,r){if(!Q(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);if(void 0===r)for(e=r=0;e<t.length;++e)r+=t[e].length;for(var n=Buffer.allocUnsafe(r),i=0,e=0;e<t.length;++e){var o=t[e];if(!Buffer.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},Buffer.byteLength=v,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)b(this,r,r+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)b(this,r,r+3),b(this,r+1,r+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)b(this,r,r+7),b(this,r+1,r+6),b(this,r+2,r+5),b(this,r+3,r+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0==t?"":0===arguments.length?k(this,0,t):g.apply(this,arguments)},Buffer.prototype.equals=function(t){if(Buffer.isBuffer(t))return this===t||0===Buffer.compare(this,t);throw new TypeError("Argument must be a Buffer")},Buffer.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return 0<this.length&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r)&&(t+=" ... "),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,r,e,n,i){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),(r=void 0===r?0:r)<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&e<=r)return 0;if(i<=n)return-1;if(e<=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),f=(e>>>=0)-(r>>>=0),u=Math.min(o,f),a=this.slice(n,i),s=t.slice(r,e),c=0;c<u;++c)if(a[c]!==s[c]){o=a[c],f=s[c];break}return o<f?-1:f<o?1:0},Buffer.prototype.includes=function(t,r,e){return-1!==this.indexOf(t,r,e)},Buffer.prototype.indexOf=function(t,r,e){return w(this,t,r,e,!0)},Buffer.prototype.lastIndexOf=function(t,r,e){return w(this,t,r,e,!1)},Buffer.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(e)?(e|=0,void 0===n&&(n="utf8")):(n=e,e=void 0)}var i=this.length-r;if((void 0===e||i<e)&&(e=i),0<t.length&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o=!1;;)switch(n){case"hex":return function(t,r,e,n){e=Number(e)||0;var i=t.length-e;if((!n||i<(n=Number(n)))&&(n=i),(i=r.length)%2!=0)throw new TypeError("Invalid hex string");i/2<n&&(n=i/2);for(var f=0;f<n;++f){var u=parseInt(r.substr(2*f,2),16);if(isNaN(u))return f;t[e+f]=u}return f}(this,t,r,e);case"utf8":case"utf-8":return function(t,r,e,n){return G(q(r,t.length-e),t,e,n)}(this,t,r,e);case"ascii":return x(this,t,r,e);case"latin1":case"binary":return x(this,t,r,e);case"base64":return function(t,r,e,n){return G(X(r),t,e,n)}(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},4096),tt=(Buffer.prototype.slice=function(t,r){var e=this.length;if((t=~~t)<0?(t+=e)<0&&(t=0):e<t&&(t=e),(r=void 0===r?e:~~r)<0?(r+=e)<0&&(r=0):e<r&&(r=e),r<t&&(r=t),Buffer.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,r)).__proto__=Buffer.prototype;else for(var i=r-t,n=new Buffer(i,void 0),o=0;o<i;++o)n[o]=this[o+t];return n},Buffer.prototype.readUIntLE=function(t,r,e){t|=0,r|=0,e||C(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n},Buffer.prototype.readUIntBE=function(t,r,e){t|=0,r|=0,e||C(t,r,this.length);for(var n=this[t+--r],i=1;0<r&&(i*=256);)n+=this[t+--r]*i;return n},Buffer.prototype.readUInt8=function(t,r){return r||C(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,r){return r||C(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,r){return r||C(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,r){return r||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,r){return r||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,r,e){t|=0,r|=0,e||C(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*r)),n},Buffer.prototype.readIntBE=function(t,r,e){t|=0,r|=0,e||C(t,r,this.length);for(var n=r,i=1,o=this[t+--n];0<n&&(i*=256);)o+=this[t+--n]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*r)),o},Buffer.prototype.readInt8=function(t,r){return r||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,r){r||C(t,2,this.length);r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,r){r||C(t,2,this.length);r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,r){return r||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,r){return r||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,r){return r||C(t,4,this.length),K.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,r){return r||C(t,4,this.length),K.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,r){return r||C(t,8,this.length),K.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,r){return r||C(t,8,this.length),K.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,r,e,n){t=+t,r|=0,e|=0,n||D(this,t,r,e,Math.pow(2,8*e)-1,0);var o=1,f=0;for(this[r]=255&t;++f<e&&(o*=256);)this[r+f]=t/o&255;return r+e},Buffer.prototype.writeUIntBE=function(t,r,e,n){t=+t,r|=0,e|=0,n||D(this,t,r,e,Math.pow(2,8*e)-1,0);var o=e-1,f=1;for(this[r+o]=255&t;0<=--o&&(f*=256);)this[r+o]=t/f&255;return r+e},Buffer.prototype.writeUInt8=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},Buffer.prototype.writeUInt16LE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):O(this,t,r,!0),r+2},Buffer.prototype.writeUInt16BE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):O(this,t,r,!1),r+2},Buffer.prototype.writeUInt32LE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):L(this,t,r,!0),r+4},Buffer.prototype.writeUInt32BE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):L(this,t,r,!1),r+4},Buffer.prototype.writeIntLE=function(t,r,e,n){t=+t,r|=0,n||D(this,t,r,e,(n=Math.pow(2,8*e-1))-1,-n);var o=0,f=1,u=0;for(this[r]=255&t;++o<e&&(f*=256);)t<0&&0===u&&0!==this[r+o-1]&&(u=1),this[r+o]=(t/f>>0)-u&255;return r+e},Buffer.prototype.writeIntBE=function(t,r,e,n){t=+t,r|=0,n||D(this,t,r,e,(n=Math.pow(2,8*e-1))-1,-n);var o=e-1,f=1,u=0;for(this[r+o]=255&t;0<=--o&&(f*=256);)t<0&&0===u&&0!==this[r+o+1]&&(u=1),this[r+o]=(t/f>>0)-u&255;return r+e},Buffer.prototype.writeInt8=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&(t=t<0?255+t+1:t),r+1},Buffer.prototype.writeInt16LE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):O(this,t,r,!0),r+2},Buffer.prototype.writeInt16BE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):O(this,t,r,!1),r+2},Buffer.prototype.writeInt32LE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):L(this,t,r,!0),r+4},Buffer.prototype.writeInt32BE=function(t,r,e){return t=+t,r|=0,e||D(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):L(this,t,r,!1),r+4},Buffer.prototype.writeFloatLE=function(t,r,e){return N(this,t,r,!0,e)},Buffer.prototype.writeFloatBE=function(t,r,e){return N(this,t,r,!1,e)},Buffer.prototype.writeDoubleLE=function(t,r,e){return F(this,t,r,!0,e)},Buffer.prototype.writeDoubleBE=function(t,r,e){return F(this,t,r,!1,e)},Buffer.prototype.copy=function(t,r,e,n){if(e=e||0,n||0===n||(n=this.length),r>=t.length&&(r=t.length),(n=0<n&&n<e?e:n)===e)return 0;if(0===t.length||0===this.length)return 0;if((r=r||0)<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var i,o=(n=t.length-r<n-e?t.length-r+e:n)-e;if(this===t&&e<r&&r<n)for(i=o-1;0<=i;--i)t[i+r]=this[i+e];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+r]=this[i+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),r);return o},Buffer.prototype.fill=function(t,r,e,n){if("string"==typeof t){var i;if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),1===t.length&&(i=t.charCodeAt(0))<256&&(t=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(!(e<=r))if(r>>>=0,e=void 0===e?this.length:e>>>0,"number"==typeof(t=t||0))for(o=r;o<e;++o)this[o]=t;else for(var f=Buffer.isBuffer(t)?t:q(new Buffer(t,n).toString()),u=f.length,o=0;o<e-r;++o)this[o+r]=f[o%u];return this},/[^+\/0-9A-Za-z-_]/g)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":30,ieee754:32,isarray:34}],30:[function(t,r,e){"use strict";function n(t){var r=t.length;if(0<r%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[r-2]?2:"="===t[r-1]?1:0}function u(t,r,e){for(var n,i=[],o=r;o<e;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(function(t){return s[t>>18&63]+s[t>>12&63]+s[t>>6&63]+s[63&t]}(n));return i.join("")}e.byteLength=function(t){return 3*t.length/4-n(t)},e.toByteArray=function(t){for(var o,a=t.length,f=n(t),u=new h(3*a/4-f),i=0<f?a-4:a,s=0,r=0;r<i;r+=4)o=c[t.charCodeAt(r)]<<18|c[t.charCodeAt(r+1)]<<12|c[t.charCodeAt(r+2)]<<6|c[t.charCodeAt(r+3)],u[s++]=o>>16&255,u[s++]=o>>8&255,u[s++]=255&o;return 2===f?(o=c[t.charCodeAt(r)]<<2|c[t.charCodeAt(r+1)]>>4,u[s++]=255&o):1===f&&(o=c[t.charCodeAt(r)]<<10|c[t.charCodeAt(r+1)]<<4|c[t.charCodeAt(r+2)]>>2,u[s++]=o>>8&255,u[s++]=255&o),u},e.fromByteArray=function(t){for(var r,e=t.length,n=e%3,i="",o=[],f=16383,a=0,c=e-n;a<c;a+=f)o.push(u(t,a,c<a+f?c:a+f));return 1==n?(r=t[e-1],i=(i+=s[r>>2])+s[r<<4&63]+"=="):2==n&&(r=(t[e-2]<<8)+t[e-1],i=(i=(i+=s[r>>10])+s[r>>4&63])+s[r<<2&63]+"="),o.push(i),o.join("")};for(var s=[],c=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,d=l.length;p<d;++p)s[p]=l[p],c[l.charCodeAt(p)]=p;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],31:[function(t,r,e){!function(t){function e(t){for(var r in s)t[r]=s[r];return t}function o(t,r){var n,i=this;if(arguments.length){if(r){if(n=u(i,t,!0)){if(!(n=n.filter(function(t){return t!==r&&t.originalListener!==r})).length)return o.call(i,t);i[a][t]=n}}else if((n=i[a])&&(delete n[t],!Object.keys(n).length))return o.call(i)}else delete i[a];return i}function u(t,r,e){if(!e||t[a])return(e=t[a]||(t[a]={}))[r]||(e[r]=[])}void 0!==r&&(r.exports=t);var a="listeners",s={on:function(t,r){return u(this,t).push(r),this},once:function(t,r){function e(){o.call(n,t,e),r.apply(this,arguments)}var n=this;return e.originalListener=r,u(n,t).push(e),n},off:o,emit:function(t,r){var a,s,o=this,f=u(o,t,!0);return!!f&&(1===(a=arguments.length)?f.forEach(function(t){t.call(o)}):2===a?f.forEach(function(t){t.call(o,r)}):(s=Array.prototype.slice.call(arguments,1),f.forEach(function(t){t.apply(o,s)})),!!f.length)}};e(t.prototype),t.mixin=e}(function n(){if(!(this instanceof n))return new n})},{}],32:[function(t,r,e){e.read=function(t,r,e,n,i){var o,f,u=8*i-n-1,a=(1<<u)-1,s=a>>1,c=-7,h=e?i-1:0,l=e?-1:1,i=t[r+h];for(h+=l,o=i&(1<<-c)-1,i>>=-c,c+=u;0<c;o=256*o+t[r+h],h+=l,c-=8);for(f=o&(1<<-c)-1,o>>=-c,c+=n;0<c;f=256*f+t[r+h],h+=l,c-=8);if(0===o)o=1-s;else{if(o===a)return f?NaN:1/0*(i?-1:1);f+=Math.pow(2,n),o-=s}return(i?-1:1)*f*Math.pow(2,o-n)},e.write=function(t,r,e,n,i,o){var f,u,s=8*o-i-1,c=(1<<s)-1,h=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,o=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(u=isNaN(r)?1:0,f=c):(f=Math.floor(Math.log(r)/Math.LN2),r*(n=Math.pow(2,-f))<1&&(f--,n*=2),2<=(r+=1<=f+h?l/n:l*Math.pow(2,1-h))*n&&(f++,n/=2),c<=f+h?(u=0,f=c):1<=f+h?(u=(r*n-1)*Math.pow(2,i),f+=h):(u=r*Math.pow(2,h-1)*Math.pow(2,i),f=0));8<=i;t[e+p]=255&u,p+=d,u/=256,i-=8);for(f=f<<i|u,s+=i;0<s;t[e+p]=255&f,p+=d,f/=256,s-=8);t[e+p-d]|=128*o}},{}],33:[function(t,r,e){!function(Buffer){!function(e){function o(t,r,n){function i(t,r,e,n){return this instanceof i?function(t,r,e,n,i){var o;E&&A&&(r instanceof A&&(r=new E(r)),n instanceof A)&&(n=new E(n)),r||e||n||g?(s(r,e)||(o=g||Array,i=e,n=r,e=0,r=new o(8)),t.buffer=r,t.offset=e|=0,b!=typeof n&&("string"==typeof n?function(t,r,e,n){var i=0,o=e.length,f=0,u=0;"-"===e[0]&&i++;for(var a=i;i<o;){var s=parseInt(e[i++],n);if(!(0<=s))break;u=u*n+s,f=f*n+Math.floor(u/B),u%=B}a&&(f=~f,u?u=B-u:f++),k(t,r+T,f),k(t,r+S,u)}(r,e,n,i||10):s(n,i)?c(r,e,n,i):"number"==typeof i?(k(r,e+T,n),k(r,e+S,i)):0<n?O(r,e,n):n<0?L(r,e,n):c(r,e,m,0))):t.buffer=h(m,0)}(this,t,r,e,n):new i(t,r,e,n)}function P(){var t=this.buffer,r=this.offset,e=_(t,r+T),t=_(t,r+S);return n||(e|=0),e?e*B+t:t}function k(t,r,e){t[r+D]=255&e,t[r+C]=255&(e>>=8),t[r+Y]=255&(e>>=8),t[r+I]=255&(e>>=8)}function _(t,r){return 16777216*t[r+I]+(t[r+Y]<<16)+(t[r+C]<<8)+t[r+D]}var T=r?0:4,S=r?4:0,I=r?0:3,Y=r?1:2,C=r?2:1,D=r?3:0,O=r?l:d,L=r?p:y,r=i.prototype,N="is"+t,F="_"+N;return r.buffer=void 0,r.offset=0,r[F]=!0,r.toNumber=P,r.toString=function(t){var r=this.buffer,e=this.offset,i=_(r,e+T),o=_(r,e+S),f="";for((r=!n&&2147483648&i)&&(i=~i,o=B-o),t=t||10;;){var a=i%t*B+o,i=Math.floor(i/t),o=Math.floor(a/t),f=(a%t).toString(t)+f;if(!i&&!o)break}return f=r?"-"+f:f},r.toJSON=P,r.toArray=f,w&&(r.toBuffer=u),E&&(r.toArrayBuffer=a),i[N]=function(t){return!(!t||!t[F])},e[t]=i}function f(t){var r=this.buffer,e=this.offset;return g=null,!1!==t&&0===e&&8===r.length&&x(r)?r:h(r,e)}function u(t){var r=this.buffer,e=this.offset;return g=w,!1!==t&&0===e&&8===r.length&&Buffer.isBuffer(r)?r:(c(t=new w(8),0,r,e),t)}function a(t){var r=this.buffer,e=this.offset,n=r.buffer;return g=E,!1!==t&&0===e&&n instanceof A&&8===n.byteLength?n:(c(t=new E(8),0,r,e),t.buffer)}function s(t,r){var e=t&&t.length;return r|=0,e&&r+8<=e&&"string"!=typeof t[r]}function c(t,r,e,n){r|=0,n|=0;for(var i=0;i<8;i++)t[r++]=255&e[n++]}function h(t,r){return Array.prototype.slice.call(t,r,r+8)}function l(t,r,e){for(var n=r+8;r<n;)t[--n]=255&e,e/=256}function p(t,r,e){var n=r+8;for(e++;r<n;)t[--n]=255&-e^255,e/=256}function d(t,r,e){for(var n=r+8;r<n;)t[r++]=255&e,e/=256}function y(t,r,e){var n=r+8;for(e++;r<n;)t[r++]=255&-e^255,e/=256}var g,b="undefined",w=b!=typeof Buffer&&Buffer,E=b!=typeof Uint8Array&&Uint8Array,A=b!=typeof ArrayBuffer&&ArrayBuffer,m=[0,0,0,0,0,0,0,0],x=Array.isArray||function(t){return!!t&&"[object Array]"==Object.prototype.toString.call(t)},B=4294967296;o("Uint64BE",!0,!0),o("Int64BE",!0,!1),o("Uint64LE",!1,!0),o("Int64LE",!1,!1)}("object"==typeof e&&"string"!=typeof e.nodeName?e:this||{})}.call(this,t("buffer").Buffer)},{buffer:29}],34:[function(t,r,e){var n={}.toString;r.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}]},{},[1])(1)}),this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])});return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),DNLMarkerError=function(){function DNLMarkerError(message,scanLines){this.message=message,this.scanLines=scanLines}return(DNLMarkerError.prototype=new Error).name="DNLMarkerError",DNLMarkerError.constructor=DNLMarkerError}(),EOIMarkerError=function(){function EOIMarkerError(message){this.message=message}return(EOIMarkerError.prototype=new Error).name="EOIMarkerError",EOIMarkerError.constructor=EOIMarkerError}(),JpegImage=function(){var dctZigZag=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),dctCos1=4017,dctSin1=799,dctCos3=3406,dctSin3=2276,dctCos6=1567,dctSin6=3784,dctSqrt2=5793,dctSqrt1d2=2896;function JpegImage(_a){var _a=void 0===_a?{}:_a,_c=_a.decodeTransform,_a=_a.colorTransform,_a=void 0===_a?-1:_a;this._decodeTransform=void 0===_c?null:_c,this._colorTransform=_a}function getBlockBufferOffset(component,row,col){return 64*((component.blocksPerLine+1)*row+col)}function decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successivePrev,successive,parseDNLMarker){void 0===parseDNLMarker&&(parseDNLMarker=!1);var mcusPerLine=frame.mcusPerLine,progressive=frame.progressive,startOffset=offset,bitsData=0,bitsCount=0;function readBit(){if(0<bitsCount)return bitsData>>--bitsCount&1;if(255===(bitsData=data[offset++])){var nextByte=data[offset++];if(nextByte){if(220===nextByte&&parseDNLMarker){offset+=2;var scanLines=data[offset++]<<8|data[offset++];if(0<scanLines&&scanLines!==frame.scanLines)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",scanLines)}else if(217===nextByte)throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data");throw new Error("unexpected marker "+(bitsData<<8|nextByte).toString(16))}}return bitsData>>>(bitsCount=7)}function decodeHuffman(tree){for(var node=tree;;){if("number"==typeof(node=node[readBit()]))return node;if("object"!=typeof node)throw new Error("invalid huffman sequence")}}function receive(length){for(var n=0;0<length;)n=n<<1|readBit(),length--;return n}function receiveAndExtend(length){var n;return 1===length?1===readBit()?1:-1:1<<length-1<=(n=receive(length))?n:n+(-1<<length)+1}var eobrun=0;var successiveACNextValue,successiveACState=0;for(var component,j,k,n,fileMarker,h,v,componentsLength=components.length,decodeFn=progressive?0===spectralStart?0===successivePrev?function(component,offset){var t=0===(t=decodeHuffman(component.huffmanTableDC))?0:receiveAndExtend(t)<<successive;component.blockData[offset]=component.pred+=t}:function(component,offset){component.blockData[offset]|=readBit()<<successive}:0===successivePrev?function(component,offset){if(0<eobrun)eobrun--;else for(var k=spectralStart,e=spectralEnd;k<=e;){var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,rs=rs>>4;if(0==s){if(rs<15){eobrun=receive(rs)+(1<<rs)-1;break}k+=16}else{rs=dctZigZag[k+=rs];component.blockData[offset+rs]=receiveAndExtend(s)*(1<<successive),k++}}}:function(component,offset){for(var rs,k=spectralStart,e=spectralEnd,r=0;k<=e;){var offsetZ=offset+dctZigZag[k],sign=component.blockData[offsetZ]<0?-1:1;switch(successiveACState){case 0:if(r=(rs=decodeHuffman(component.huffmanTableAC))>>4,0==(rs=15&rs))successiveACState=r<15?(eobrun=receive(r)+(1<<r),4):(r=16,1);else{if(1!=rs)throw new Error("invalid ACn encoding");successiveACNextValue=receiveAndExtend(rs),successiveACState=r?2:3}continue;case 1:case 2:component.blockData[offsetZ]?component.blockData[offsetZ]+=sign*(readBit()<<successive):0===--r&&(successiveACState=2===successiveACState?3:0);break;case 3:component.blockData[offsetZ]?component.blockData[offsetZ]+=sign*(readBit()<<successive):(component.blockData[offsetZ]=successiveACNextValue<<successive,successiveACState=0);break;case 4:component.blockData[offsetZ]&&(component.blockData[offsetZ]+=sign*(readBit()<<successive))}k++}4===successiveACState&&0===--eobrun&&(successiveACState=0)}:function(component,offset){for(var t=0===(t=decodeHuffman(component.huffmanTableDC))?0:receiveAndExtend(t),k=(component.blockData[offset]=component.pred+=t,1);k<64;){var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,rs=rs>>4;if(0==s){if(rs<15)break;k+=16}else{rs=dctZigZag[k+=rs];component.blockData[offset+rs]=receiveAndExtend(s),k++}}},mcu=0,mcuExpected=1===componentsLength?components[0].blocksPerLine*components[0].blocksPerColumn:mcusPerLine*frame.mcusPerColumn;mcu<mcuExpected;){for(var mcuToRead=resetInterval?Math.min(mcuExpected-mcu,resetInterval):mcuExpected,i=0;i<componentsLength;i++)components[i].pred=0;if(eobrun=0,1===componentsLength)for(component=components[0],n=0;n<mcuToRead;n++)!function(component,decode,mcu){decode(component,getBlockBufferOffset(component,mcu/component.blocksPerLine|0,mcu%component.blocksPerLine))}(component,decodeFn,mcu),mcu++;else for(n=0;n<mcuToRead;n++){for(i=0;i<componentsLength;i++)for(h=(component=components[i]).h,v=component.v,j=0;j<v;j++)for(k=0;k<h;k++)!function(component,decode,mcu,row,col){decode(component,getBlockBufferOffset(component,(mcu/mcusPerLine|0)*component.v+row,mcu%mcusPerLine*component.h+col))}(component,decodeFn,mcu,j,k);mcu++}bitsCount=0,(fileMarker=findNextFileMarker(data,offset))&&fileMarker.invalid&&(warn("decodeScan - unexpected MCU data, current marker is: "+fileMarker.invalid),offset=fileMarker.offset);var marker=fileMarker&&fileMarker.marker;if(!marker||marker<=65280)throw new Error("marker was not found");if(!(65488<=marker&&marker<=65495))break;offset+=2}return(fileMarker=findNextFileMarker(data,offset))&&fileMarker.invalid&&(warn("decodeScan - unexpected Scan data, current marker is: "+fileMarker.invalid),offset=fileMarker.offset),offset-startOffset}function buildComponentData(frame,component){for(var blocksPerLine=component.blocksPerLine,blocksPerColumn=component.blocksPerColumn,computationBuffer=new Int16Array(64),blockRow=0;blockRow<blocksPerColumn;blockRow++)for(var blockCol=0;blockCol<blocksPerLine;blockCol++)!function(component,blockBufferOffset,p){var v0,v1,v2,v3,v4,v5,v6,v7,p0,p1,p2,p3,p4,p5,p6,p7,t,qt=component.quantizationTable,blockData=component.blockData;if(!qt)throw new Error("missing required Quantization Table.");for(var row=0;row<64;row+=8)p0=blockData[blockBufferOffset+row],p1=blockData[blockBufferOffset+row+1],p2=blockData[blockBufferOffset+row+2],p3=blockData[blockBufferOffset+row+3],p4=blockData[blockBufferOffset+row+4],p5=blockData[blockBufferOffset+row+5],p6=blockData[blockBufferOffset+row+6],p7=blockData[blockBufferOffset+row+7],p0*=qt[row],0==(p1|p2|p3|p4|p5|p6|p7)?(p[row]=t=dctSqrt2*p0+512>>10,p[row+1]=t,p[row+2]=t,p[row+3]=t,p[row+4]=t,p[row+5]=t,p[row+6]=t,p[row+7]=t):(p1*=qt[row+1],p2*=qt[row+2],p3*=qt[row+3],p4*=qt[row+4],p5*=qt[row+5],p6*=qt[row+6],p7*=qt[row+7],v1=(v0=(v0=dctSqrt2*p0+128>>8)+(v1=dctSqrt2*p4+128>>8)+1>>1)-v1,t=(v2=p2)*dctSin6+(v3=p6)*dctCos6+128>>8,v2=v2*dctCos6-v3*dctSin6+128>>8,v6=(v4=(v4=dctSqrt1d2*(p1-p7)+128>>8)+(v6=p5<<4)+1>>1)-v6,v5=(v7=(v7=dctSqrt1d2*(p1+p7)+128>>8)+(v5=p3<<4)+1>>1)-v5,v3=(v0=v0+(v3=t)+1>>1)-v3,v2=(v1=v1+v2+1>>1)-v2,t=v4*dctSin3+v7*dctCos3+2048>>12,v4=v4*dctCos3-v7*dctSin3+2048>>12,v7=t,t=v5*dctSin1+v6*dctCos1+2048>>12,v5=v5*dctCos1-v6*dctSin1+2048>>12,v6=t,p[row]=v0+v7,p[row+7]=v0-v7,p[row+1]=v1+v6,p[row+6]=v1-v6,p[row+2]=v2+v5,p[row+5]=v2-v5,p[row+3]=v3+v4,p[row+4]=v3-v4);for(var col=0;col<8;++col)p0=p[col],0==((p1=p[col+8])|(p2=p[col+16])|(p3=p[col+24])|(p4=p[col+32])|(p5=p[col+40])|(p6=p[col+48])|(p7=p[col+56]))?(blockData[blockBufferOffset+col]=t=(t=dctSqrt2*p0+8192>>14)<-2040?0:2024<=t?255:t+2056>>4,blockData[blockBufferOffset+col+8]=t,blockData[blockBufferOffset+col+16]=t,blockData[blockBufferOffset+col+24]=t,blockData[blockBufferOffset+col+32]=t,blockData[blockBufferOffset+col+40]=t,blockData[blockBufferOffset+col+48]=t,blockData[blockBufferOffset+col+56]=t):(t=(v2=p2)*dctSin6+(v3=p6)*dctCos6+2048>>12,v2=v2*dctCos6-v3*dctSin6+2048>>12,v3=t,v6=(v4=(v4=dctSqrt1d2*(p1-p7)+2048>>12)+(v6=p5)+1>>1)-v6,v5=(v7=(v7=dctSqrt1d2*(p1+p7)+2048>>12)+(v5=p3)+1>>1)-v5,t=v4*dctSin3+v7*dctCos3+2048>>12,v4=v4*dctCos3-v7*dctSin3+2048>>12,v7=t,t=v5*dctSin1+v6*dctCos1+2048>>12,v5=v5*dctCos1-v6*dctSin1+2048>>12,p1=(p1=(v1=(v1=(v0=4112+((v0=dctSqrt2*p0+2048>>12)+(v1=dctSqrt2*p4+2048>>12)+1>>1))-v1)+v2+1>>1)+(v6=t))<16?0:4080<=p1?255:p1>>4,p2=(p2=(v2=v1-v2)+v5)<16?0:4080<=p2?255:p2>>4,p3=(p3=(v3=(v0=v0+v3+1>>1)-v3)+v4)<16?0:4080<=p3?255:p3>>4,p4=(p4=v3-v4)<16?0:4080<=p4?255:p4>>4,p5=(p5=v2-v5)<16?0:4080<=p5?255:p5>>4,p6=(p6=v1-v6)<16?0:4080<=p6?255:p6>>4,p7=(p7=v0-v7)<16?0:4080<=p7?255:p7>>4,blockData[blockBufferOffset+col]=p0=(p0=v0+v7)<16?0:4080<=p0?255:p0>>4,blockData[blockBufferOffset+col+8]=p1,blockData[blockBufferOffset+col+16]=p2,blockData[blockBufferOffset+col+24]=p3,blockData[blockBufferOffset+col+32]=p4,blockData[blockBufferOffset+col+40]=p5,blockData[blockBufferOffset+col+48]=p6,blockData[blockBufferOffset+col+56]=p7)}(component,getBlockBufferOffset(component,blockRow,blockCol),computationBuffer);return component.blockData}function findNextFileMarker(data,currentPos,startPos){function peekUint16(pos){return data[pos]<<8|data[pos+1]}var maxPos=data.length-1,newPos=(startPos=void 0===startPos?currentPos:startPos)<currentPos?startPos:currentPos;if(maxPos<=currentPos)return null;startPos=peekUint16(currentPos);if(65472<=startPos&&startPos<=65534)return{invalid:null,marker:startPos,offset:currentPos};for(var newMarker=peekUint16(newPos);!(65472<=newMarker&&newMarker<=65534);){if(++newPos>=maxPos)return null;newMarker=peekUint16(newPos)}return{invalid:startPos.toString(16),marker:newMarker,offset:newPos}}return JpegImage.prototype={width:0,height:0,parse:function(data,_a){var _a=(void 0===_a?{}:_a).dnlScanLines,dnlScanLines=void 0===_a?null:_a;function readUint16(){var value=data[offset]<<8|data[offset+1];return offset+=2,value}var frame,resetInterval,offset=0,jfif=null,adobe=null,numSOSMarkers=0,quantizationTables=[],huffmanTablesAC=[],huffmanTablesDC=[],fileMarker=readUint16();if(65496!==fileMarker)throw new Error("SOI not found");fileMarker=readUint16();markerLoop:for(;65497!==fileMarker;){switch(fileMarker){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var appData=function(){var length=readUint16(),fileMarker=((fileMarker=findNextFileMarker(data,length=offset+length-2,offset))&&fileMarker.invalid&&(warn("readDataBlock - incorrect length, current marker is: "+fileMarker.invalid),length=fileMarker.offset),data.subarray(offset,length));return offset+=fileMarker.length,fileMarker}();65504===fileMarker&&74===appData[0]&&70===appData[1]&&73===appData[2]&&70===appData[3]&&0===appData[4]&&(jfif={version:{major:appData[5],minor:appData[6]},densityUnits:appData[7],xDensity:appData[8]<<8|appData[9],yDensity:appData[10]<<8|appData[11],thumbWidth:appData[12],thumbHeight:appData[13],thumbData:appData.subarray(14,14+3*appData[12]*appData[13])}),65518===fileMarker&&65===appData[0]&&100===appData[1]&&111===appData[2]&&98===appData[3]&&101===appData[4]&&(adobe={version:appData[5]<<8|appData[6],flags0:appData[7]<<8|appData[8],flags1:appData[9]<<8|appData[10],transformCode:appData[11]});break;case 65499:for(var quantizationTablesEnd=readUint16()+offset-2;offset<quantizationTablesEnd;){var quantizationTableSpec=data[offset++],tableData=new Uint16Array(64);if(quantizationTableSpec>>4==0)for(j=0;j<64;j++)tableData[dctZigZag[j]]=data[offset++];else{if(quantizationTableSpec>>4!=1)throw new Error("DQT - invalid table spec");for(j=0;j<64;j++)tableData[dctZigZag[j]]=readUint16()}quantizationTables[15&quantizationTableSpec]=tableData}break;case 65472:case 65473:case 65474:if(frame)throw new Error("Only single frame JPEGs supported");readUint16(),(frame={}).extended=65473===fileMarker,frame.progressive=65474===fileMarker,frame.precision=data[offset++];for(var appData=readUint16(),componentsCount=(frame.scanLines=dnlScanLines||appData,frame.samplesPerLine=readUint16(),frame.components=[],frame.componentIds={},data[offset++]),maxH=0,maxV=0,i=0;i<componentsCount;i++){var componentId=data[offset],h=data[offset+1]>>4,v=15&data[offset+1],qId=(maxH<h&&(maxH=h),maxV<v&&(maxV=v),data[offset+2]),h=frame.components.push({h:h,v:v,quantizationId:qId,quantizationTable:null});frame.componentIds[componentId]=h-1,offset+=3}frame.maxH=maxH,frame.maxV=maxV,!function(frame){for(var mcusPerLine=Math.ceil(frame.samplesPerLine/8/frame.maxH),mcusPerColumn=Math.ceil(frame.scanLines/8/frame.maxV),i=0;i<frame.components.length;i++){component=frame.components[i];var blocksPerLine=Math.ceil(Math.ceil(frame.samplesPerLine/8)*component.h/frame.maxH),blocksPerColumn=Math.ceil(Math.ceil(frame.scanLines/8)*component.v/frame.maxV),blocksPerLineForMcu=mcusPerLine*component.h,blocksPerColumnForMcu=mcusPerColumn*component.v;component.blockData=new Int16Array(64*blocksPerColumnForMcu*(1+blocksPerLineForMcu)),component.blocksPerLine=blocksPerLine,component.blocksPerColumn=blocksPerColumn}frame.mcusPerLine=mcusPerLine,frame.mcusPerColumn=mcusPerColumn}(frame);break;case 65476:var huffmanLength=readUint16();for(i=2;i<huffmanLength;){for(var huffmanTableSpec=data[offset++],codeLengths=new Uint8Array(16),codeLengthSum=0,j=0;j<16;j++,offset++)codeLengthSum+=codeLengths[j]=data[offset];var huffmanValues=new Uint8Array(codeLengthSum);for(j=0;j<codeLengthSum;j++,offset++)huffmanValues[j]=data[offset];i+=17+codeLengthSum,(huffmanTableSpec>>4==0?huffmanTablesDC:huffmanTablesAC)[15&huffmanTableSpec]=function(codeLengths,values){for(var j,k=0,code=[],length=16;0<length&&!codeLengths[length-1];)length--;code.push({children:[],index:0});for(var q,p=code[0],i=0;i<length;i++){for(j=0;j<codeLengths[i];j++){for((p=code.pop()).children[p.index]=values[k];0<p.index;)p=code.pop();for(p.index++,code.push(p);code.length<=i;)code.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q;k++}i+1<length&&(code.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q)}return code[0].children}(codeLengths,huffmanValues)}break;case 65501:readUint16(),resetInterval=readUint16();break;case 65498:var parseDNLMarker=1==++numSOSMarkers&&!dnlScanLines,selectorsCount=(readUint16(),data[offset++]),components=[];for(i=0;i<selectorsCount;i++){var componentIndex=frame.componentIds[data[offset++]],component=frame.components[componentIndex],componentIndex=data[offset++];component.huffmanTableDC=huffmanTablesDC[componentIndex>>4],component.huffmanTableAC=huffmanTablesAC[15&componentIndex],components.push(component)}var spectralStart=data[offset++],spectralEnd=data[offset++],successiveApproximation=data[offset++];try{var processed=decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successiveApproximation>>4,15&successiveApproximation,parseDNLMarker);offset+=processed}catch(ex){if(ex instanceof DNLMarkerError)return warn(ex.message+" -- attempting to re-parse the JPEG image."),this.parse(data,{dnlScanLines:ex.scanLines});if(ex instanceof EOIMarkerError){warn(ex.message+" -- ignoring the rest of the image data.");break markerLoop}throw ex}break;case 65500:offset+=4;break;case 65535:255!==data[offset]&&offset--;break;default:if(255===data[offset-3]&&192<=data[offset-2]&&data[offset-2]<=254){offset-=3;break}spectralStart=findNextFileMarker(data,offset-2);if(spectralStart&&spectralStart.invalid){warn("JpegImage.parse - unexpected data, current marker is: "+spectralStart.invalid),offset=spectralStart.offset;break}throw new Error("unknown marker "+fileMarker.toString(16))}fileMarker=readUint16()}for(this.width=frame.samplesPerLine,this.height=frame.scanLines,this.jfif=jfif,this.adobe=adobe,this.components=[],i=0;i<frame.components.length;i++){var quantizationTable=quantizationTables[(component=frame.components[i]).quantizationId];quantizationTable&&(component.quantizationTable=quantizationTable),this.components.push({output:buildComponentData(0,component),scaleX:component.h/frame.maxH,scaleY:component.v/frame.maxV,blocksPerLine:component.blocksPerLine,blocksPerColumn:component.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(width,height,reserved,alphaChannel){void 0===reserved&&(reserved=0);for(var component,componentScaleX,componentScaleY,blocksPerScanline,x,y,j,k,index,output,scaleX=this.width/width,scaleY=this.height/height,offset=0,numComponents=this.components.length,rowBytes=width*numComponents,needAlpha=null!=(alphaChannel=void 0===alphaChannel?null:alphaChannel),dataLength=(rowBytes=3==numComponents?needAlpha?4*width:4*(rowBytes+3>>2):rowBytes)*height,result=new ArrayBuffer(dataLength+reserved),data=new Uint8ClampedArray(result,reserved),xScaleBlockOffset=new Uint32Array(width),step=needAlpha?4:numComponents,i=0;i<numComponents;i++){for(componentScaleX=(component=this.components[i]).scaleX*scaleX,componentScaleY=component.scaleY*scaleY,output=component.output,blocksPerScanline=component.blocksPerLine+1<<3,x=0;x<width;x++)xScaleBlockOffset[x]=(4294967288&(j=0|x*componentScaleX))<<3|7&j;for(y=0;y<height;y++)for(index=blocksPerScanline*(4294967288&(j=0|y*componentScaleY))|(7&j)<<3,offset=rowBytes*y+i,x=0;x<width;x++,offset+=step)data[offset]=output[index+xScaleBlockOffset[x]]}if(needAlpha)for(offset=3,k=y=0;y<height;y++)for(x=0;x<width;x++,offset+=4)data[offset]=alphaChannel[k++];var transform=this._decodeTransform;if(transform=4===numComponents?transform||new Int32Array([-256,255,-256,255,-256,255,-256,255]):transform)if(3==numComponents&&needAlpha)for(i=0;i<dataLength;){for(k=j=0;j<numComponents;j++,i++,k+=2)data[i]=(data[i]*transform[k]>>8)+transform[k+1];i++}else for(i=0;i<dataLength;)for(k=j=0;j<numComponents;j++,i++,k+=2)data[i]=(data[i]*transform[k]>>8)+transform[k+1];return data},get _isColorConversionNeeded(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0!==this._colorTransform:1===this._colorTransform},_convertYccToRgb:function(data,needAlpha,width,height){for(var Y,Cb,Cr,step=needAlpha?4:3,rowBytes=4*(width*step+3>>2),i=0,y=0;y<height;++y)for(var i=rowBytes*y,x=0;x<width;++x)Y=data[i],Cb=data[i+1],Cr=data[i+2],data[i]=Y-179.456+1.402*Cr,data[i+1]=Y+135.459-.344*Cb-.714*Cr,data[i+2]=Y-226.816+1.772*Cb,i+=step;return data},_convertYcckToRgb:function(data){for(var Y,Cb,Cr,k,offset=0,i=0,length=data.length;i<length;i+=4)Y=data[i],Cb=data[i+1],Cr=data[i+2],k=data[i+3],data[offset++]=Cb*(-660635669420364e-19*Cb+.000437130475926232*Cr-54080610064599e-18*Y+.00048449797120281*k-.154362151871126)-122.67195406894+Cr*(-.000957964378445773*Cr+.000817076911346625*Y-.00477271405408747*k+1.53380253221734)+Y*(.000961250184130688*Y-.00266257332283933*k+.48357088451265)+k*(-.000336197177618394*k+.484791561490776),data[offset++]=107.268039397724+Cb*(219927104525741e-19*Cb-.000640992018297945*Cr+.000659397001245577*Y+.000426105652938837*k-.176491792462875)+Cr*(-.000778269941513683*Cr+.00130872261408275*Y+.000770482631801132*k-.151051492775562)+Y*(.00126935368114843*Y-.00265090189010898*k+.25802910206845)+k*(-.000318913117588328*k-.213742400323665),data[offset++]=Cb*(-.000570115196973677*Cb-263409051004589e-19*Cr+.0020741088115012*Y-.00288260236853442*k+.814272968359295)-20.810012546947+Cr*(-153496057440975e-19*Cr-.000132689043961446*Y+.000560833691242812*k-.195152027534049)+Y*(.00174418132927582*Y-.00255243321439347*k+.116935020465145)+k*(-.000343531996510555*k+.24165260232407);return data.subarray(0,offset)},_convertYcckToCmyk:function(data){for(var Y,Cb,Cr,i=0,length=data.length;i<length;i+=4)Y=data[i],Cb=data[i+1],Cr=data[i+2],data[i]=434.456-Y-1.402*Cr,data[i+1]=119.541-Y+.344*Cb+.714*Cr,data[i+2]=481.816-Y-1.772*Cb;return data},_convertCmykToRgb:function(data){for(var c,m,y,k,offset=0,i=0,length=data.length;i<length;i+=4)c=data[i]*(1/255),m=data[i+1]*(1/255),y=data[i+2]*(1/255),k=data[i+3]*(1/255),data[offset++]=255+c*(-4.387332384609988*c+54.48615194189176*m+18.82290502165302*y+212.25662451639585*k-285.2331026137004)+m*(1.7149763477362134*m-5.6096736904047315*y-17.873870861415444*k-5.497006427196366)+y*(-2.5217340131683033*y-21.248923337353073*k+17.5119270841813)-k*(21.86122147463605*k+189.48180835922747),data[offset++]=255+c*(8.841041422036149*c+60.118027045597366*m+6.871425592049007*y+31.159100130055922*k-79.2970844816548)+m*(-15.310361306967817*m+17.575251261109482*y+131.35250912493976*k-190.9453302588951)+y*(4.444339102852739*y+9.8632861493405*k-24.86741582555878)-k*(20.737325471181034*k+187.80453709719578),data[offset++]=255+c*(.8842522430003296*c+8.078677503112928*m+30.89978309703729*y-.23883238689178934*k-14.183576799673286)+m*(10.49593273432072*m+63.02378494754052*y+50.606957656360734*k-112.23884253719248)+y*(.03296041114873217*y+115.60384449646641*k-193.58209356861505)-k*(22.33816807309886*k+180.12613974708367);return data.subarray(0,offset)},getData:function(width,height,forceRGB,reserved,alphaChannel){if(void 0===forceRGB&&(forceRGB=!1),void 0===reserved&&(reserved=0),void 0===alphaChannel&&(alphaChannel=null),4<this.numComponents)throw new Error("Unsupported color mode");var data=this._getLinearizedBlockData(width,height,reserved,alphaChannel);if(1===this.numComponents&&forceRGB){for(var x,offset,rowBytes=4*(3*width+3>>2),rgbData=new Uint8ClampedArray(rowBytes*height),i=0,y=0;y<height;++y)for(offset=y*rowBytes,x=0;x<width;++x){var grayColor=data[i++];rgbData[offset++]=grayColor,rgbData[offset++]=grayColor,rgbData[offset++]=grayColor}return rgbData}if(3===this.numComponents&&this._isColorConversionNeeded)return this._convertYccToRgb(data,null!=alphaChannel,width,height);if(4===this.numComponents){if(this._isColorConversionNeeded)return forceRGB?this._convertYcckToRgb(data):this._convertYcckToCmyk(data);if(forceRGB)return this._convertCmykToRgb(data)}return data}},JpegImage}(),ByteStream=(!function(){var l=void 0,aa=this;function r(c,d){var e,a=c.split("."),b=aa;a[0]in b||!b.execScript||b.execScript("var "+a[0]);for(;a.length&&(e=a.shift());)a.length||d===l?b=b[e]||(b[e]={}):b[e]=d}var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function v(c){for(var e,f,g,h,k,m,n,s,x,d=c.length,a=0,b=Number.POSITIVE_INFINITY,p=0;p<d;++p)c[p]>a&&(a=c[p]),c[p]<b&&(b=c[p]);for(e=1<<a,f=new(t?Uint32Array:Array)(e),g=1,h=0,k=2;g<=a;){for(p=0;p<d;++p)if(c[p]===g){for(n=h,s=m=0;s<g;++s)m=m<<1|1&n,n>>=1;for(x=g<<16|p,s=m;s<e;s+=k)f[s]=x;++h}++g,h<<=1,k<<=1}return[f,a,b]}function w(c,d){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=t?new Uint8Array(c):c,this.m=!1,this.i=y,this.r=!1,(d?(d.index&&(this.a=d.index),d.bufferSize&&(this.h=d.bufferSize),d.bufferType&&(this.i=d.bufferType),d.resize):(d={},0))&&(this.r=d.resize),this.i){case A:this.b=32768,this.c=new(t?Uint8Array:Array)(32768+this.h+258);break;case y:this.b=0,this.c=new(t?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}for(var A=0,y=1,B_t=A,B_s=y,G=(w.prototype.k=function(){for(;!this.m;){var c=C(this,3);switch(1&c&&(this.m=!0),c>>>=1){case 0:var d=this.input,a=this.a,b=this.c,e=this.b,f=d.length,g=l,k=b.length,m=l;if(this.d=this.f=0,f<=a+1)throw Error("invalid uncompressed block header: LEN");if(g=d[a++]|d[a++]<<8,f<=a+1)throw Error("invalid uncompressed block header: NLEN");if(g===~(d[a++]|d[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+g>d.length)throw Error("input buffer is broken");switch(this.i){case A:for(;e+g>b.length;){if(g-=m=k-e,t)b.set(d.subarray(a,a+m),e),e+=m,a+=m;else for(;m--;)b[e++]=d[a++];this.b=e,b=this.e(),e=this.b}break;case y:for(;e+g>b.length;)b=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(t)b.set(d.subarray(a,a+g),e),e+=g,a+=g;else for(;g--;)b[e++]=d[a++];this.a=a,this.b=e,this.c=b;break;case 1:this.j(ba,ca);break;case 2:for(var S,U,M,V,f=C(this,5)+257,p=C(this,5)+1,s=C(this,4)+4,x=new(t?Uint8Array:Array)(D.length),u=l,F=l,z=l,q=l,q=0;q<s;++q)x[D[q]]=C(this,3);if(!t)for(q=s,s=x.length;q<s;++q)x[D[q]]=0;for(S=v(x),u=new(t?Uint8Array:Array)(f+p),q=0,V=f+p;q<V;)switch(M=E(this,S),M){case 16:for(z=3+C(this,2);z--;)u[q++]=F;break;case 17:for(z=3+C(this,3);z--;)u[q++]=0;F=0;break;case 18:for(z=11+C(this,7);z--;)u[q++]=0;F=0;break;default:F=u[q++]=M}p=v(t?u.subarray(0,f):u.slice(0,f)),U=v(t?u.subarray(f):u.slice(f)),this.j(p,U);break;default:throw Error("unknown BTYPE: "+c)}}return this.n()},[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D=t?new Uint16Array(G):G,G=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I=t?new Uint16Array(G):G,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],K=t?new Uint8Array(G):G,G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],da=t?new Uint16Array(G):G,G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=t?new Uint8Array(G):G,O=new(t?Uint8Array:Array)(288),P=0,fa=O.length;P<fa;++P)O[P]=P<=143?8:P<=255?9:P<=279?7:8;for(var ba=v(O),Q=new(t?Uint8Array:Array)(30),R=0,ga=Q.length;R<ga;++R)Q[R]=5;var ca=v(Q);function C(c,d){for(var h,a=c.f,b=c.d,e=c.input,f=c.a,g=e.length;b<d;){if(g<=f)throw Error("input buffer is broken");a|=e[f++]<<b,b+=8}return h=a&(1<<d)-1,c.f=a>>>d,c.d=b-d,c.a=f,h}function E(c,d){for(var a=c.f,b=c.d,e=c.input,f=c.a,g=e.length,h=d[0],k=d[1];b<k&&!(g<=f);)a|=e[f++]<<b,b+=8;if(b<(h=(d=h[a&(1<<k)-1])>>>16))throw Error("invalid code length: "+h);return c.f=a>>h,c.d=b-h,c.a=f,65535&d}function W(c,d){var a,b;if(this.input=c,this.a=0,(d?(d.index&&(this.a=d.index),d.verify):(d={},0))&&(this.A=d.verify),a=c[this.a++],b=c[this.a++],(15&a)!==ha)throw Error("unsupported compression method");if(this.method=ha,0!=((a<<8)+b)%31)throw Error("invalid fcheck flag:"+((a<<8)+b)%31);if(32&b)throw Error("fdict flag is not supported");this.q=new w(c,{index:this.a,bufferSize:d.bufferSize,bufferType:d.bufferType,resize:d.resize})}w.prototype.j=function(c,d){var a=this.c,b=this.b;this.o=c;for(var f,g,h,k,e=a.length-258;256!==(f=E(this,c));)if(f<256)e<=b&&(this.b=b,a=this.e(),b=this.b),a[b++]=f;else for(k=I[g=f-257],0<K[g]&&(k+=C(this,K[g])),f=E(this,d),h=da[f],0<N[f]&&(h+=C(this,N[f])),e<=b&&(this.b=b,a=this.e(),b=this.b);k--;)a[b]=a[b++-h];for(;8<=this.d;)this.d-=8,this.a--;this.b=b},w.prototype.w=function(c,d){var a=this.c,b=this.b;this.o=c;for(var f,g,h,k,e=a.length;256!==(f=E(this,c));)if(f<256)e<=b&&(e=(a=this.e()).length),a[b++]=f;else for(k=I[g=f-257],0<K[g]&&(k+=C(this,K[g])),f=E(this,d),h=da[f],0<N[f]&&(h+=C(this,N[f])),e<b+k&&(e=(a=this.e()).length);k--;)a[b]=a[b++-h];for(;8<=this.d;)this.d-=8,this.a--;this.b=b},w.prototype.e=function(){var a,b,c=new(t?Uint8Array:Array)(this.b-32768),d=this.b-32768,e=this.c;if(t)c.set(e.subarray(32768,c.length));else for(a=0,b=c.length;a<b;++a)c[a]=e[a+32768];if(this.g.push(c),this.l+=c.length,t)e.set(e.subarray(d,32768+d));else for(a=0;a<32768;++a)e[a]=e[d+a];return this.b=32768,e},w.prototype.z=function(c){var d,a=this.input.length/this.a+1|0,g=this.input,h=this.c;return c&&("number"==typeof c.p&&(a=c.p),"number"==typeof c.u)&&(a+=c.u),g=a<2?(c=(g.length-this.a)/this.o[2]/2*258|0)<h.length?h.length+c:h.length<<1:h.length*a,t?(d=new Uint8Array(g)).set(h):d=h,this.c=d},w.prototype.n=function(){var b,f,g,h,k,c=0,d=this.c,a=this.g,e=new(t?Uint8Array:Array)(this.l+(this.b-32768));if(0===a.length)return t?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(f=0,g=a.length;f<g;++f)for(h=0,k=(b=a[f]).length;h<k;++h)e[c++]=b[h];for(f=32768,g=this.b;f<g;++f)e[c++]=d[f];return this.g=[],this.buffer=e},w.prototype.v=function(){var c,d=this.b;return t?this.r?(c=new Uint8Array(d)).set(this.c.subarray(0,d)):c=this.c.subarray(0,d):(this.c.length>d&&(this.c.length=d),c=this.c),this.buffer=c},W.prototype.k=function(){var c=this.input,d=this.q.k();if(this.a=this.q.a,this.A){var c=(c[this.a++]<<24|c[this.a++]<<16|c[this.a++]<<8|c[this.a++])>>>0,b=d;if("string"==typeof b){for(var e=b.split(""),f=0,g=e.length;f<g;f++)e[f]=(255&e[f].charCodeAt(0))>>>0;b=e}for(var n,h=1,k=0,m=b.length,p=0;0<m;){for(m-=n=1024<m?1024:m;k+=h+=b[p++],--n;);h%=65521,k%=65521}if(c!=(k<<16|h)>>>0)throw Error("invalid adler-32 checksum")}return d};var Y,Z,$,ia,ha=8,X=(r("Zlib.Inflate",W),r("Zlib.Inflate.prototype.decompress",W.prototype.k),{ADAPTIVE:B_s,BLOCK:B_t});if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;for($=0,ia=Y.length;$<ia;++$)r("Zlib.Inflate.BufferType."+(Z=Y[$]),X[Z])}.call(this),!function(window){"use strict";var g_buffer=new Uint8Array(8),g_view=new DataView(g_buffer.buffer);function serialize(data){var pow32=4294967296,array=new Uint8Array(128),length=0;return append(data),array.subarray(0,length);function append(data){switch(typeof data){case"undefined":appendNull();break;case"boolean":!function(data){appendByte(data?195:194)}(data);break;case"number":!function(data){{var hi;isFinite(data)&&Math.floor(data)===data?0<=data&&data<=127||data<0&&-32<=data?appendByte(data):0<data&&data<=255?appendBytes([204,data]):-128<=data&&data<=127?appendBytes([208,data]):0<data&&data<=65535?appendBytes([205,data>>>8,data]):-32768<=data&&data<=32767?appendBytes([209,data>>>8,data]):0<data&&data<=4294967295?appendBytes([206,data>>>24,data>>>16,data>>>8,data]):-2147483648<=data&&data<=2147483647?appendBytes([210,data>>>24,data>>>16,data>>>8,data]):0<data&&data<=0x10000000000000000?appendBytes([211,(hi=data/pow32)>>>24,hi>>>16,hi>>>8,hi,(hi=data%pow32)>>>24,hi>>>16,hi>>>8,hi]):-0x8000000000000000<=data&&data<=0x8000000000000000?(appendByte(211),appendInt64(data)):appendBytes(data<0?[211,128,0,0,0,0,0,0,0]:[207,255,255,255,255,255,255,255,255]):(g_view.setFloat64(0,data),appendByte(203),appendBytes(g_buffer))}}(data);break;case"string":!function(data){var data=function(str){for(var ascii=!0,length=str.length,x=0;x<length;x++)if(127<str.charCodeAt(x)){ascii=!1;break}for(var i=0,bytes=new Uint8Array(str.length*(ascii?1:4)),ci=0;ci!==length;ci++){var c=str.charCodeAt(ci);if(c<128)bytes[i++]=c;else{if(c<2048)bytes[i++]=c>>6|192;else{if(55295<c&&c<56320){if(++ci>=length)throw new Error("UTF-8 encode: incomplete surrogate pair");var c2=str.charCodeAt(ci);if(c2<56320||57343<c2)throw new Error("UTF-8 encode: second surrogate character 0x"+c2.toString(16)+" at index "+ci+" out of range");c=65536+((1023&c)<<10)+(1023&c2),bytes[i++]=c>>18|240,bytes[i++]=c>>12&63|128}else bytes[i++]=c>>12|224;bytes[i++]=c>>6&63|128}bytes[i++]=63&c|128}}return ascii?bytes:bytes.subarray(0,i)}(data),length=data.length;length<=31?appendByte(160+length):appendBytes(length<=255?[217,length]:length<=65535?[218,length>>>8,length]:[219,length>>>24,length>>>16,length>>>8,length]);appendBytes(data)}(data);break;case"object":(null===data?appendNull:data instanceof Date?function(data){var sec=data.getTime()/1e3;{var ns;0===data.getMilliseconds()&&0<=sec&&sec<4294967296?appendBytes([214,255,sec>>>24,sec>>>16,sec>>>8,sec]):0<=sec&&sec<17179869184?appendBytes([215,255,(ns=1e6*data.getMilliseconds())>>>22,ns>>>14,ns>>>6,ns<<2>>>0|sec/pow32,sec>>>24,sec>>>16,sec>>>8,sec]):(appendBytes([199,12,255,(ns=1e6*data.getMilliseconds())>>>24,ns>>>16,ns>>>8,ns]),appendInt64(sec))}}:Array.isArray(data)?appendArray:data instanceof Uint8Array||data instanceof Uint8ClampedArray?function(data){var length=data.length;appendBytes(length<=15?[196,length]:length<=65535?[197,length>>>8,length]:[198,length>>>24,length>>>16,length>>>8,length]);appendBytes(data)}:data instanceof Int8Array||data instanceof Int16Array||data instanceof Uint16Array||data instanceof Int32Array||data instanceof Uint32Array||data instanceof Float32Array||data instanceof Float64Array?appendArray:function(data){var key,length=0;for(key in data)length++;length<=15?appendByte(128+length):appendBytes(length<=65535?[222,length>>>8,length]:[223,length>>>24,length>>>16,length>>>8,length]);for(key in data)append(key),append(data[key])})(data)}}function appendNull(){appendByte(192)}function appendArray(data){var length=data.length;length<=15?appendByte(144+length):appendBytes(length<=65535?[220,length>>>8,length]:[221,length>>>24,length>>>16,length>>>8,length]);for(var index=0;index<length;index++)append(data[index])}function appendByte(byte){if(array.length<length+1){for(var newLength=2*array.length;newLength<length+1;)newLength*=2;var newArray=new Uint8Array(newLength);newArray.set(array),array=newArray}array[length]=byte,length++}function appendBytes(bytes){if(array.length<length+bytes.length){for(var newLength=2*array.length;newLength<length+bytes.length;)newLength*=2;var newArray=new Uint8Array(newLength);newArray.set(array),array=newArray}array.set(bytes,length),length+=bytes.length}function appendInt64(value){var hi,lo=0<=value?(hi=value/pow32,value%pow32):(value++,hi=~(hi=Math.abs(value)/pow32),~(lo=Math.abs(value)%pow32));appendBytes([hi>>>24,hi>>>16,hi>>>8,hi,lo>>>24,lo>>>16,lo>>>8,lo])}}function deserialize(array){var pow32=4294967296,pos=0;if("object"!=typeof array||void 0===array.length)throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");array instanceof Uint8Array||(array=new Uint8Array(array));var data=read();return array.length,data;function read(){var byte=array[pos++];if(0<=byte&&byte<=127)return byte;if(128<=byte&&byte<=143)return readMap(byte-128);if(144<=byte&&byte<=159)return readArray(byte-144);if(160<=byte&&byte<=191)return readStr(byte-160);if(192===byte)return null;if(193===byte)throw new Error("Invalid byte code 0xc1 found.");if(194===byte)return!1;if(195===byte)return!0;if(196===byte)return readBin(-1,1);if(197===byte)return readBin(-1,2);if(198===byte)return readBin(-1,4);if(199===byte)return readExt(-1,1);if(200===byte)return readExt(-1,2);if(201===byte)return readExt(-1,4);if(202===byte)return readFloat(4);if(203===byte)return readFloat(8);if(204===byte)return readUInt(1);if(205===byte)return readUInt(2);if(206===byte)return readUInt(4);if(207===byte)return readUInt(8);if(208===byte)return readInt(1);if(209===byte)return readInt(2);if(210===byte)return readInt(4);if(211===byte)return readInt(8);if(212===byte)return readExt(1);if(213===byte)return readExt(2);if(214===byte)return readExt(4);if(215===byte)return readExt(8);if(216===byte)return readExt(16);if(217===byte)return readStr(-1,1);if(218===byte)return readStr(-1,2);if(219===byte)return readStr(-1,4);if(220===byte)return readArray(-1,2);if(221===byte)return readArray(-1,4);if(222===byte)return readMap(-1,2);if(223===byte)return readMap(-1,4);if(224<=byte&&byte<=255)return byte-256;throw new Error("Invalid byte value "+byte+" in the MessagePack binary data : Expecting a range of 0 to 255. This is not a byte array.")}function readInt(size){for(var byte,value=0,first=!0;0<size--;)first?(value+=127&(byte=array[pos++]),128&byte&&(value-=128),first=!1):value=(value*=256)+array[pos++];return value}function readUInt(size){for(var value=0;0<size--;)value=(value*=256)+array[pos++];return value}function readFloat(size){for(var i=0;i<size;)g_buffer[i++]=array[pos++];return 4===size?g_view.getFloat32(0,!1):8===size?g_view.getFloat64(0,!1):void 0}function readBin(size,lengthSize){size<0&&(size=readUInt(lengthSize));lengthSize=new Uint8Array(array.buffer.slice(array.byteOffset+pos,array.byteOffset+pos+size));return pos+=size,lengthSize}function readMap(size,lengthSize){size<0&&(size=readUInt(lengthSize));for(var data={};0<size--;)data[read()]=read();return data}function readArray(size,lengthSize){size<0&&(size=readUInt(lengthSize));for(var data=new Array(size),i=0;i<size;)data[i++]=read();return data}function readStr(size,lengthSize){size<0&&(size=readUInt(lengthSize));lengthSize=pos;return pos+=size,function(bytes,start,length){var i=start,str=[];length+=start;for(;i<length;){var c=bytes[i++];if(127<c)if(191<c&&c<224){if(length<=i)throw new Error("UTF-8 decode: incomplete 2-byte sequence");c=(31&c)<<6|63&bytes[i++]}else if(223<c&&c<240){if(length<=i+1)throw new Error("UTF-8 decode: incomplete 3-byte sequence");c=(15&c)<<12|(63&bytes[i++])<<6|63&bytes[i++]}else{if(!(239<c&&c<248))throw new Error("UTF-8 decode: unknown multibyte start 0x"+c.toString(16)+" at index "+(i-1));if(length<=i+2)throw new Error("UTF-8 decode: incomplete 4-byte sequence");c=(7&c)<<18|(63&bytes[i++])<<12|(63&bytes[i++])<<6|63&bytes[i++]}if(c<=65535)str.push(c);else{if(!(c<=1114111))throw new Error("UTF-8 decode: code point 0x"+c.toString(16)+" exceeds UTF-16 reach");str.push((c-=65536)>>10|55296),str.push(1023&c|56320)}}return String.fromCharCode.apply(String,str)}(array,lengthSize,size)}function readExt(size,lengthSize){size<0&&(size=readUInt(lengthSize));lengthSize=readUInt(1),size=readBin(size);return 255===lengthSize?function(data){if(4===data.length)return sec=(data[0]<<24>>>0)+(data[1]<<16>>>0)+(data[2]<<8>>>0)+data[3],new Date(1e3*sec);if(8===data.length)var ns=(data[0]<<22>>>0)+(data[1]<<14>>>0)+(data[2]<<6>>>0)+(data[3]>>>2),sec=(3&data[3])*pow32+(data[4]<<24>>>0)+(data[5]<<16>>>0)+(data[6]<<8>>>0)+data[7];else{if(12!==data.length)throw new Error("Invalid data length for a date value.");ns=(data[0]<<24>>>0)+(data[1]<<16>>>0)+(data[2]<<8>>>0)+data[3],sec=(pos-=8,readInt(8))}return new Date(1e3*sec+ns/1e6)}(size):{type:lengthSize,data:size}}}var msgpack={serialize:serialize,deserialize:deserialize,encode:serialize,decode:deserialize};window.msgpack=msgpack,"function"==typeof define&&define.amd&&define("msgpack",[],function(){return msgpack})}(this),!function(base){!function(background){var InitCommand=function(){function InitCommand(){this.enableCache=!1,this.enableCheck=!1,this.host=""}return InitCommand.prototype.type=function(){return InitCommand.opcode},InitCommand.prototype.readTo=function(tuple,args){var offset=0;this.enableCache=tuple[offset++],this.enableCheck=tuple[+offset],this.host=tuple[2]},InitCommand.prototype.writeTo=function(args){var result=[];return result.push(this.enableCache),result.push(this.enableCheck),result.push(this.host),result},InitCommand.opcode=0,InitCommand}(),InitCommand=(background.InitCommand=InitCommand,function(){function InitCompleteCommand(){}return InitCompleteCommand.prototype.type=function(){return InitCompleteCommand.opcode},InitCompleteCommand.prototype.readTo=function(tuple,args){this.status=tuple[0]},InitCompleteCommand.prototype.writeTo=function(args){var result=[];return result.push(this.status),result},InitCompleteCommand.opcode=1,InitCompleteCommand}()),InitCommand=(background.InitCompleteCommand=InitCommand,function(){function LoadCompleteCommand(){}return LoadCompleteCommand.prototype.type=function(){return LoadCompleteCommand.opcode},LoadCompleteCommand.prototype.readTo=function(tuple,args){var offset=0,offset=(this.url=tuple[offset++],this.status=tuple[+offset],tuple[2]);0!=offset&&(this.bytes=args[offset])},LoadCompleteCommand.prototype.writeTo=function(args){var result=[];return result.push(this.url),result.push(this.status),null!=this.bytes?(result.push(args.length),args.push(this.bytes)):result.push(0),result},LoadCompleteCommand.opcode=3,LoadCompleteCommand}()),InitCommand=(background.LoadCompleteCommand=InitCommand,function(){function LoadCommand(){}return LoadCommand.prototype.type=function(){return LoadCommand.opcode},LoadCommand.prototype.readTo=function(tuple,args){var offset=0;this.url=tuple[+offset],this.uncompress=tuple[1]},LoadCommand.prototype.writeTo=function(args){var result=[];return result.push(this.url),result.push(this.uncompress),result},LoadCommand.opcode=2,LoadCommand}()),InitCommand=(background.LoadCommand=InitCommand,function(){function DecodeCommand(){}return DecodeCommand.prototype.type=function(){return DecodeCommand.opcode},DecodeCommand.prototype.readTo=function(tuple,args){var offset=0,offset=(this.url=tuple[offset++],this.uncompress=tuple[offset++],tuple[+offset]);if(0!=offset){var index=tuple[3];this.content=[];for(var limit=index+offset;index<limit;++index)this.content.push(args[index])}},DecodeCommand.prototype.writeTo=function(args){var result=[];if(result.push(this.url),result.push(this.uncompress),null!=this.content&&0!=this.content.length){result.push(this.content.length),result.push(args.length);for(var _i=0,_a=this.content;_i<_a.length;_i++){var bytes=_a[_i];args.push(bytes)}}else result.push(0);return result},DecodeCommand.opcode=4,DecodeCommand}()),InitCommand=(background.DecodeCommand=InitCommand,function(){function DecodeCompleteCommand(){}return DecodeCompleteCommand.prototype.type=function(){return DecodeCompleteCommand.opcode},DecodeCompleteCommand.prototype.readTo=function(tuple,args){var offset=0,offset=(this.url=tuple[+offset],tuple[1]);0!=offset&&(this.bytes=args[offset])},DecodeCompleteCommand.prototype.writeTo=function(args){var result=[];return result.push(this.url),null!=this.bytes?(result.push(args.length),args.push(this.bytes)):result.push(0),result},DecodeCompleteCommand.opcode=5,DecodeCompleteCommand}());background.DecodeCompleteCommand=InitCommand}(base.background||(base.background={}))}(base=base||{}),!function(utils){var ArrayUtils=function(){function ArrayUtils(){}return ArrayUtils.copy=function(source,sourceOffset,target,targetOffset,length){if(source.length<sourceOffset+length)return!1;if(target.length<targetOffset+length)return!1;for(;length--;)target[targetOffset++]=source[sourceOffset++];return!0},ArrayUtils.insertAt=function(array,index,obj){if(array.push(obj),!(index<0))for(var j=array.length-1;index<j;--j)obj=array[j],array[j]=array[j-1],array[j-1]=obj},ArrayUtils.removeAt=function(array,index){var last=array.length-1;if(last<index)return null;for(var obj=array[index],j=index;j<last;++j)array[j]=array[j+1];return array.length=last,obj},ArrayUtils.remove=function(array,obj){obj=array.indexOf(obj);if(-1===obj)return-1;for(var last=array.length-1,j=obj;j<last;++j)array[j]=array[j+1];return array.length=last,obj},ArrayUtils.removeRange=function(array,index,count,result){var last=array.length-count;if(last<index&&(last=index),null!=(result=void 0===result?null:result))for(var size=index+count>array.length?array.length:index+count,i=index;i<size;++i)result[i-index]=array[i];for(var j=index;j<last;++j)array[j]=array[j+count];array.length=last},ArrayUtils.removeAll=function(array,obj){for(var index=0;-1!=(index=array.indexOf(obj,index));){for(var last=array.length-1,j=index;j<last;++j)array[j]=array[j+1];array.length=last}},ArrayUtils.unsafeRemoveAt=function(array,index){var obj,last=array.length-1;return last<index?null:(obj=array[index],array[index]=array[last],array.length=last,obj)},ArrayUtils.unsafeRemove=function(array,obj){var last,obj=array.indexOf(obj);return-1===obj?-1:(last=array.length-1,array[obj]=array[last],array.length=last,obj)},ArrayUtils.disturb=function(array){for(var i=array.length-1;0<=i;--i){var temp,upper=i+1,upper=Math.floor(Math.random()*upper)%upper;i!=upper&&(temp=array[i],array[i]=array[upper],array[upper]=temp)}return array},ArrayUtils.random=function(array,offset){var size=array.length-(offset=void 0===offset?0:offset);return array[Math.floor(Math.random()*size)%size+offset]},ArrayUtils.randomIndex=function(array,offset){array=array.length-(offset=void 0===offset?0:offset);return Math.floor(Math.random()*array)%array+offset},ArrayUtils.reverse=function(array){for(var l=0,r=array.length-1;l<r;++l,--r){var temp=array[l];array[l]=array[r],array[r]=temp}},ArrayUtils}();utils.ArrayUtils=ArrayUtils}(utils=utils||{}),!function(base){!function(background){var ArrayUtils=utils.ArrayUtils,ActorProxy=function(){function ActorProxy(worker){var _this=this;this.onMessage=function(message){var args=message.data;if(0!=args.length)for(var commands=msgpack.decode(new Uint8Array(args[0])),length=commands.length,i=0;i<length;++i)for(var command=commands[i],type=command[0],opcode=new _this._opcodes[type],handlers=(opcode.readTo(command[1],args),_this._opcodeHandlers[type]),length_1=handlers.length,i_1=0;i_1<length_1;++i_1)handlers[i_1](opcode)},this.onUpdate=function(){var commandBuffer;0!=_this._list.length&&(commandBuffer=msgpack.encode(_this._list).buffer,_this._args[0]=commandBuffer,_this._worker.postMessage(_this._args,_this._args),_this._args=new Array(1),_this._list.length=0)},this._worker=worker,this._args=new Array(1),this._list=new Array,this._worker.onmessage=this.onMessage,this._opcodeHandlers=[],this._opcodes=[]}return ActorProxy.prototype.registerOpcode=function(type,command){this._opcodes[type]=command},ActorProxy.prototype.addCommandHandler=function(type,handler){var handlers=this._opcodeHandlers[type];null==handlers&&(handlers=new Array,this._opcodeHandlers[type]=handlers),-1==handlers.indexOf(handler)&&handlers.push(handler)},ActorProxy.prototype.removeCommandHandler=function(type,handler){type=this._opcodeHandlers[type];null!=type&&ArrayUtils.remove(type,handler)},ActorProxy.prototype.sendCommand=function(command){var tuple=command.writeTo(this._args);this._list.push([command.type(),tuple]),this.onUpdate()},ActorProxy}();background.ActorProxy=ActorProxy}(base.background||(base.background={}))}(base=base||{}),!function(utils){var ByteStream=function(){function ByteStream(){}return ByteStream.prototype.bytesAvailable=function(){return this.length-this.cursor},ByteStream.prototype.getUint8=function(){return this.input[this.cursor++]},ByteStream.prototype.getUint16=function(){var result=this.view.getUint16(this.cursor,this.littleEndian);return this.cursor+=2,result},ByteStream.prototype.getUint32=function(){var result=this.view.getUint32(this.cursor,this.littleEndian);return this.cursor+=4,result},ByteStream.prototype.getUTF=function(size){for(var result=new Array(size),i=0;i<size;++i)result[i]=String.fromCharCode(this.input[this.cursor++]);return result.join("")},ByteStream.prototype.getBytes=function(size){var result=new Uint8Array(this.input.buffer,this.input.byteOffset+this.cursor,size);return this.cursor+=size,result},ByteStream.prototype.skip=function(size){this.cursor+=size},ByteStream.prototype.open=function(input,littleEndian){void 0===littleEndian&&(littleEndian=!1),this.cursor=0,this.length=input.byteLength,this.input=input,this.view=new DataView(input.buffer),this.littleEndian=littleEndian},ByteStream.prototype.close=function(){this.input=null,this.view=null},ByteStream}();utils.ByteStream=ByteStream}(utils=utils||{}),utils.ByteStream),PngFileEntry=function(){function PngFileEntry(){this.segments=[]}return PngFileEntry.allocEntry=function(){var result;return null!=PngFileEntry._freeEntry?(result=this._freeEntry,this._freeEntry=this._freeEntry.next):result=new PngFileEntry,result},PngFileEntry.freeEntry=function(entry){entry.next=this._freeEntry,(PngFileEntry._freeEntry=entry).palette=null,entry.segments.length=0,entry.transparency=null},PngFileEntry}(),PngDecoder=function(){function PngDecoder(){}return PngDecoder.init=function(){PngDecoder.sectionHandlers={IHDR:PngDecoder.handlerIHDR,PLTE:PngDecoder.handlerPLTE,IDAT:PngDecoder.handlerIDAT,tRNS:PngDecoder.handlerTRNS}},PngDecoder.handlerIHDR=function(entry,stream,chunkSize){entry.width=stream.getUint32(),entry.height=stream.getUint32(),entry.bits=stream.getUint8(),entry.colorType=stream.getUint8(),entry.compressionMethod=stream.getUint8(),entry.filterMethod=stream.getUint8(),entry.interlaceMethod=stream.getUint8()},PngDecoder.handlerPLTE=function(entry,stream,chunkSize){entry.palette=stream.getBytes(chunkSize)},PngDecoder.handlerIDAT=function(entry,stream,chunkSize){entry.segments.push(stream.getBytes(chunkSize))},PngDecoder.handlerTRNS=function(entry,stream,chunkSize){entry.transparency=stream.getBytes(chunkSize)},PngDecoder.handlerICCP=function(entry,stream,chunkSize){for(var pos=stream.cursor,codes=[],code=stream.getUint8();codes.push(String.fromCharCode(code)),0!=(code=stream.getUint8()););codes.join(""),stream.getUint8();chunkSize-=stream.cursor-pos;stream.getBytes(chunkSize)},PngDecoder.decodePalette=function(entry){for(var palette=entry.palette,transparency=entry.transparency,length=palette.length,result=new Uint8Array(length/3*4),offset=0,cursor=0,size=transparency.byteLength,index=0;offset<length;)result[cursor++]=palette[offset++],result[cursor++]=palette[offset++],result[cursor++]=palette[offset++],result[cursor++]=index<size?transparency[index++]:255;return result},PngDecoder.mergeSegments=function(segments){for(var byteLength=0,_i=0,segments_1=segments;_i<segments_1.length;_i++)byteLength+=(segment=segments_1[_i]).byteLength;for(var bytes=new Uint8Array(byteLength),offset=0,_a=0,segments_2=segments;_a<segments_2.length;_a++){var segment=segments_2[_a];bytes.set(segment,offset),offset+=segment.length}return new Zlib.Inflate(bytes).decompress()},PngDecoder.calcPixelBytes=function(entry){var channels=3;return 4&entry.colorType&&(channels=4),channels=3==entry.colorType&&entry.transparency?4:channels},PngDecoder.calcIndexBytes=function(entry){var channels=1;switch(entry.colorType){case 2:channels=3;break;case 4:channels=2;break;case 6:channels=4}return 7+channels*entry.bits>>3},PngDecoder.decodePixels=function(entry){return 0==entry.interlaceMethod?this.notInterlaceMethod(entry):null},PngDecoder.notInterlaceMethod=function(entry){for(var bytes=PngDecoder.mergeSegments(entry.segments),length=bytes.byteLength,height=entry.height,pixelBytes=PngDecoder.calcIndexBytes(entry),rowBytes=Math.floor((length-height)/height),rowOffset=rowBytes+1,i=0,cursor=0,a=0,b=0,c=0,p=0,pa=0,pb=0,pc=0;cursor<length;)switch(bytes[cursor++]){case 0:cursor+=rowBytes;break;case 1:for(cursor+=pixelBytes,i=pixelBytes;i<rowBytes;++i,++cursor)bytes[cursor]=(bytes[cursor]+bytes[cursor-pixelBytes])%256;break;case 2:if(1!=cursor)for(i=0;i<rowBytes;++i,++cursor)bytes[cursor]=(bytes[cursor]+bytes[cursor-rowOffset])%256;break;case 3:if(1==cursor)for(cursor+=pixelBytes,i=pixelBytes;i<rowBytes;++i,++cursor)bytes[cursor]=(bytes[cursor]+(bytes[cursor-pixelBytes]>>1))%256;else{for(i=0;i<pixelBytes;++i,++cursor)bytes[cursor]=(bytes[cursor]+(bytes[cursor-rowOffset]>>1))%256;for(i=pixelBytes;i<rowBytes;++i,++cursor)bytes[cursor]=(bytes[cursor]+(bytes[cursor-pixelBytes]+bytes[cursor-rowOffset]>>1))%256}break;case 4:if(1==pixelBytes)if(1==cursor)for(a=bytes[cursor++],i=1;i<rowBytes;++i,++cursor)a=bytes[cursor]=(bytes[cursor]+(0<a?a:0))%256;else for((pa=p=b=bytes[cursor-rowOffset])<0&&(pa=-pa),(pc=p)<0&&(pc=-pc),a=bytes[cursor]=bytes[cursor]+(!(p<=0)&&0<=pc?b:0),cursor++,i=1;i<rowBytes;++i,++cursor)(pa=(p=a+(b=bytes[cursor-rowOffset])-(c=bytes[cursor-rowOffset-1]))-a)<0&&(pa=-pa),(pb=p-b)<0&&(pb=-pb),(pc=p-c)<0&&(pc=-pc),a=bytes[cursor]=(bytes[cursor]+(pa<=pb&&pa<=pc?a:pb<=pc?b:c))%256;else if(1==cursor)for(cursor+=pixelBytes,b=c=0,i=pixelBytes;i<rowBytes;++i,++cursor)(pa=(p=(a=bytes[cursor-pixelBytes])+b-c)-a)<0&&(pa=-pa),(pb=p-b)<0&&(pb=-pb),(pc=p-c)<0&&(pc=-pc),bytes[cursor]=(bytes[cursor]+(pa<=pb&&pa<=pc?a:pb<=pc?b:c))%256;else{for(i=0;i<pixelBytes;++i,++cursor)(pa=(p=(a=0)+(b=bytes[cursor-rowOffset])-(c=0))-a)<0&&(pa=-pa),(pb=p-b)<0&&(pb=-pb),(pc=p-c)<0&&(pc=-pc),bytes[cursor]=(bytes[cursor]+(pa<=pb&&pa<=pc?a:pb<=pc?b:c))%256;for(i=pixelBytes;i<rowBytes;++i,++cursor)(pa=(p=(a=bytes[cursor-pixelBytes])+(b=bytes[cursor-rowOffset])-(c=bytes[cursor-rowOffset-pixelBytes]))-a)<0&&(pa=-pa),(pb=p-b)<0&&(pb=-pb),(pc=p-c)<0&&(pc=-pc),bytes[cursor]=(bytes[cursor]+(pa<=pb&&pa<=pc?a:pb<=pc?b:c))%256}break;default:console.log("解析出错："+entry.width+", "+entry.height+", "+pixelBytes),console.log(bytes.byteLength)}return bytes},PngDecoder.decode=function(data){var entry=PngFileEntry.allocEntry(),stream=new ByteStream;for(stream.open(data),stream.skip(8);0<stream.bytesAvailable();){var chunkSize=stream.getUint32(),section=stream.getUTF(4),section=PngDecoder.sectionHandlers[section];null!=section?section(entry,stream,chunkSize):stream.skip(chunkSize),stream.getUint32()}stream.close();var pixels=PngDecoder.decodePixels(entry);if(null==pixels)return null;var cursor=0,offset=0,width=entry.width,height=entry.height,data=new ArrayBuffer(width*height*PngDecoder.calcPixelBytes(entry)+8),result=new Uint8Array(data,8),view=new DataView(data,0,8);switch(view.setUint32(0,width),view.setUint32(4,height),entry.colorType){case 3:PngDecoder.fromPalette(entry,pixels,result);break;case 2:switch(entry.bits){case 8:for(var y=0;y<height;++y){offset++;for(var x=0;x<width;++x)result[cursor++]=pixels[offset++],result[cursor++]=pixels[offset++],result[cursor++]=pixels[offset++]}break;case 16:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x)result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2,result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2,result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2}}break;case 6:switch(entry.bits){case 8:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x)result[cursor++]=pixels[offset++],result[cursor++]=pixels[offset++],result[cursor++]=pixels[offset++],result[cursor++]=pixels[offset++]}break;case 16:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x)result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2,result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2,result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2,result[cursor++]=(pixels[offset]<<8|pixels[offset+1])/65535*255,offset+=2}}break;default:console.error("未支持的类型："+entry.colorType+", "+entry.bits)}return PngFileEntry.freeEntry(entry),data},PngDecoder.fromPalette=function(entry,pixels,result){var cursor=0,offset=0,width=entry.width,height=entry.height,palette=entry.palette;if(null!=entry.transparency)switch(palette=PngDecoder.decodePalette(entry),entry.bits){case 1:for(var y=0;y<height;++y){offset++;for(var x=0;x<width;++x){var index=4*(1&pixels[offset+(x>>3)]);result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2],result[cursor++]=palette[index+3]}offset+=width+7>>3}break;case 2:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=4*(3&pixels[offset+(x>>2)]);result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2],result[cursor++]=palette[index+3]}offset+=width+3>>2}break;case 4:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=4*(15&pixels[offset+(x>>1)]);result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2],result[cursor++]=palette[index+3]}offset+=width+1>>1}break;case 8:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=4*pixels[offset++];result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2],result[cursor++]=palette[index+3]}}}else switch(entry.bits){case 1:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=3*(1&pixels[offset+(x>>3)]);result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2]}offset+=width+7>>3}break;case 2:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=3*(3&pixels[offset+(x>>2)]);result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2]}offset+=width+3>>2}break;case 4:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=3*(15&pixels[offset+(x>>1)]);result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2]}offset+=width+1>>1}break;case 8:for(y=0;y<height;++y){offset++;for(x=0;x<width;++x){index=3*pixels[offset++];result[cursor++]=palette[index],result[cursor++]=palette[index+1],result[cursor++]=palette[index+2]}}}},PngDecoder.sectionHandlers={},PngDecoder}(),ActorProxy=(!function(base){!function(background){!function(system){var FileDecodeSystem=function(){function FileDecodeSystem(){}return FileDecodeSystem.init=function(){PngDecoder.init()},FileDecodeSystem.inflateBuffer=function(buffer){buffer=new Zlib.Inflate(new Uint8Array(buffer)).decompress();return buffer.buffer.slice(buffer.byteOffset,buffer.byteLength)},FileDecodeSystem.decodeImage=function(stream,alphaChannel){var h,p;return void 0===alphaChannel&&(alphaChannel=null),this.isPng(stream)?PngDecoder.decode(stream):((p=new JpegImage).parse(stream),stream=p.width,h=p.height,p=p.getData(stream,h,!0,8,alphaChannel),(alphaChannel=new DataView(p.buffer)).setUint32(0,stream),alphaChannel.setUint32(4,h),p.buffer)},FileDecodeSystem.isPng=function(buffer){for(var header=FileDecodeSystem.PngHeader,i=0;i<8;++i)if(buffer[i]!=header[i])return!1;return!0},FileDecodeSystem.PngHeader=new Uint8Array([137,80,78,71,13,10,26,10]),FileDecodeSystem}();system.FileDecodeSystem=FileDecodeSystem}(background.system||(background.system={}))}(base.background||(base.background={}))}(base=base||{}),base.background.ActorProxy),InitCommand=base.background.InitCommand,InitCompleteCommand=base.background.InitCompleteCommand,FileDecodeSystem=base.background.system.FileDecodeSystem,DecodeCommand=base.background.DecodeCommand,DecodeCompleteCommand=base.background.DecodeCompleteCommand,actor=(console.log("routine init"),FileDecodeSystem.init(),new ActorProxy(self)),__extends=(actor.registerOpcode(InitCommand.opcode,InitCommand),actor.registerOpcode(InitCompleteCommand.opcode,InitCompleteCommand),actor.registerOpcode(DecodeCommand.opcode,DecodeCommand),actor.registerOpcode(DecodeCompleteCommand.opcode,DecodeCompleteCommand),actor.addCommandHandler(InitCommand.opcode,function(_){var command=new InitCompleteCommand;command.status=0,actor.sendCommand(command)}),actor.addCommandHandler(DecodeCommand.opcode,function(command){var buffer,alpha,url=command.url,uncompress=command.uncompress,command=command.content,uncompress=(1===uncompress?buffer=FileDecodeSystem.inflateBuffer(command[0]):(uncompress=url.toLowerCase()).lastIndexOf(".png")==uncompress.length-4||uncompress.lastIndexOf(".jpg")==uncompress.length-4?buffer=FileDecodeSystem.decodeImage(new Uint8Array(command[0])):uncompress.lastIndexOf(".til")==uncompress.length-4&&((uncompress=new ByteStream).open(new Uint8Array(command[0])),uncompress.getUint16(),alpha=uncompress.getBytes(uncompress.getUint32()),uncompress.getUint16(),buffer=FileDecodeSystem.decodeImage(uncompress.getBytes(uncompress.getUint32()),new Zlib.Inflate(alpha).decompress())),command.length=0,new DecodeCompleteCommand);uncompress.url=url,uncompress.bytes=buffer,actor.sendCommand(uncompress)}),this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])}))(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),config={game_id:"2",game_pkg:"lmfbs1_mhdlxyx_M",partner_id:"4",is_auth:!1,from:null},PARTNER_SDK=(window.config=config,mainSDK()),HOST="https://sdk.api.l2i.cc",user_game_info=null,this_order_id=null,game_ver="";function mainSDK(){var callbacks={};return{order_data:{},init:function(ops,callback){game_ver=ops&&ops.game_ver?ops.game_ver:0,console.log("new[SDK]CP调用init接口",ops);var ops=wx.getStorageSync("plat_uuid")?0:(ops=this.uuid(16,32),wx.setStorageSync("plat_uuid",ops),1),idfv=(wx.getStorageSync("plat_idfv")||(idfv=this.uuid(16,32),wx.setStorageSync("plat_idfv",idfv)),wx.getLaunchOptionsSync()),scene=idfv.scene||"",queryStr=(console.log("[SDK]小游戏启动参数",idfv),console.log("[SDK]小游戏is_new",ops),ops&&idfv.query&&idfv.query.ad_code&&wx.setStorageSync("plat_ad_code",idfv.query.ad_code),JSON.stringify(idfv.query));ops&&"{}"!=queryStr&&wx.setStorageSync("plat_wx_query",JSON.stringify(idfv.query)),idfv.query&&idfv.query.from&&""!=idfv.query.from?(ops&&wx.setStorageSync("plat_from",idfv.query.from),config.from=idfv.query.from):(queryStr=wx.getStorageSync("plat_from"))||""==queryStr||(config.from=queryStr),this.log("start",{install:ops,scene:scene}),wx.showShareMenu(),game_ver&&this.checkGameVersion(game_ver,function(data){callback&&callback(data)})},login:function(callback){console.log("new[SDK]调起登录");var self=this;callbacks.login="function"==typeof callback?callback:null,config.is_auth?wx.getSetting({success:function(res){var button;res.authSetting["scope.userInfo"]?(console.log("[SDK]获得授权设置：已授权"),self.do_login()):(console.log("[SDK]获得授权设置：未授权"),wx.hideLoading({}),(res=wx.getSystemInfoSync()).screenWidth,res.screenHeight,(button=wx.createUserInfoButton({type:"text",text:"授权登录游戏",withCredentials:!1,style:{top:res.windowHeight/2+res.windowHeight/4,left:res.windowWidth/2-100,width:200,height:40,lineHeight:40,backgroundColor:"#07c160",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}})).show(),button.onTap(function(res){console.log(res),wxShowLoading({title:"正在登录游戏"}),"getUserInfo:ok"==res.errMsg?self.do_login({head_img:res.userInfo.avatarUrl||"",nick_name:res.userInfo.nickName||""}):self.do_login(),button.destroy()}))},fail:function(){console.log("[SDK]获得授权设置：失败"),self.do_login()}}):(console.log("[SDK]授权登录"+config.is_auth),self.do_login())},do_login:function(info){var self=this;wx.login({success:function(res){var public_data;console.log("微信登录成功返回"+JSON.stringify(res)),res.code?((public_data=self.getPublicData()).mo=1,public_data.code=res.code,public_data.nick_name=info?info.nick_name:"",public_data.head_img=info?info.head_img:"",config.is_auth?wx.getUserInfo({success:function(res6){var encryptedData=res6.encryptedData,iv=res6.iv,res6=res6.signature;public_data.encryptedData=encryptedData,public_data.iv=iv,public_data.signature=res6,wx.request({url:HOST+"/partner/auth",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:public_data,success:function(res){if(console.log("new[SDK]登录结果："),console.log(res),200==res.statusCode){res=res.data;if(res.state){var userData={userid:res.data.user_id,account:res.data.nick_name,token:res.data.token};try{wx.setStorageSync("plat_sdk_token",res.data.sdk_token),wx.setStorageSync("plat_uid",res.data.user_id),wx.setStorageSync("plat_username",res.data.username),wx.setStorageSync("wx_openid",res.data.openid),wx.getStorageSync("plat_ad_code")||""==res.data.ad_code||wx.setStorageSync("plat_ad_code",res.data.ad_code),res.data.ext&&wx.setStorageSync("plat_session_key",res.data.ext)}catch(e){}callbacks.login&&callbacks.login(0,userData)}else callbacks.login&&callbacks.login(1,{errMsg:res.msg})}else callbacks.login&&callbacks.login(1,{errMsg:"请求平台服务器失败！#1"})},fail:function(res){callbacks.login&&callbacks.login(1,{errMsg:res.errMsg})}})},fail:function(res6){callbacks.login&&callbacks.login(1,{errMsg:res6.errMsg})}}):wx.request({url:HOST+"/partner/auth",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:public_data,success:function(res){if(console.log("new[SDK]登录结果："),console.log(res),200==res.statusCode){res=res.data;if(res.state){var userData={userid:res.data.user_id,account:res.data.nick_name,token:res.data.token};try{wx.setStorageSync("plat_sdk_token",res.data.sdk_token),wx.setStorageSync("plat_uid",res.data.user_id),wx.setStorageSync("plat_username",res.data.username),wx.setStorageSync("wx_openid",res.data.openid),wx.getStorageSync("plat_ad_code")||""==res.data.ad_code||wx.setStorageSync("plat_ad_code",res.data.ad_code),res.data.ext&&wx.setStorageSync("plat_session_key",res.data.ext)}catch(e){}callbacks.login&&callbacks.login(0,userData)}else callbacks.login&&callbacks.login(1,{errMsg:res.msg})}else callbacks.login&&callbacks.login(1,{errMsg:"请求平台服务器失败！#2"})}})):callbacks.login&&callbacks.login(1,{errMsg:res.errMsg})},fail:function(res){console.log("微信登录失败"+JSON.stringify(res)),(-1<res.errMsg.indexOf("auth deny")||-1<res.errMsg.indexOf("auth denied"))&&callbacks.login&&callbacks.login(1,{errMsg:res.errMsg})}})},checkGameVersion:function(game_ver,callback){console.log("[SDK]检查游戏版本");wx.getStorageSync("plat_sdk_token");wx.request({url:HOST+"/game/min/?ac=checkGameVersion",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:game_ver},success:function(res){console.log("[SDK]获取游戏版本结果"),console.log(res),200==res.statusCode&&(res=res.data).state?callback&&callback(res.data):callback&&callback({develop:0})},fail:function(res){console.log(res)}})},pay:function(data,callback){var self=this;wx.checkSession({success:function(){self.startPay(data,callback)},fail:function(){console.log("[SDK]session过期需要重新登录"),self.login({},function(){self.startPay(data,callback)})}})},startPay:function(data,callback){console.log("[SDK]调起支付，CP传值："),console.log(data);var sysInfo,self=this,callback=(callbacks.pay="function"==typeof callback?callback:null,wx.getStorageSync("plat_sdk_token")),session_key=wx.getStorageSync("plat_session_key");callback&&session_key?(sysInfo=wx.getSystemInfoSync(),data={cpbill:data.cpbill,productid:data.productid,productname:data.productname,productdesc:data.productdesc,serverid:data.serverid,servername:data.servername,roleid:data.roleid,rolename:data.rolename,rolelevel:data.rolelevel,price:data.price,extension:data.extension,sdk_token:callback,session_key:session_key,platform:sysInfo.platform},self.order_data=data,(callback=self.getPublicData()).order_data=JSON.stringify(data),wx.request({url:HOST+"/partner/order",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:callback,success:function(res){console.log("[SDK]完成创建订单"),console.log(res),200==res.statusCode?(res=res.data).state?void 0===wx.requestPayment?"android"==sysInfo.platform||"windows"==sysInfo.platform||"devtools"==sysInfo.platform?res.data.is_android_pay?self.kfPay(res.data):self.gamePay(res.data):res.data.is_ios_pay?1==res.data.ios_pay_type&&self.kfPay(res.data):wx.showModal({title:"支付提示",content:"很抱歉，由于苹果政策，暂时不能支付，安卓手机不受影响",confirmText:"我知道了",showCancel:!1}):self.minPay(res.data):callbacks.pay&&callbacks.pay(1,{errMsg:res.msg}):callbacks.login&&callbacks.login(1,{errMsg:"请求平台服务器失败！#3"})}})):callbacks.pay&&callbacks.pay(1,{errMsg:"用户未登录，支付失败！"})},gamePay:function(data){var self=this;data.buyQuantity<=data.balance?(console.log("[SDK]游戏币充值直接扣除"),wx.showModal({title:"支付提示",content:"您还有"+data.balance+"个游戏币未消费，本次支付将扣除"+data.buyQuantity+"游戏币",showCancel:!1,confirmText:"我知道了",success:function(){self.gameGoPay(data)}})):(console.log("[SDK]调起米大师支付"),console.log(data),wx.requestMidasPayment({mode:"game",env:data.env,offerId:data.offerId,currencyType:data.currencyType,platform:data.platform,buyQuantity:data.buyQuantity,zoneId:data.zoneId,success:function(res){"requestMidasPayment:ok"==res.errMsg&&self.gameGoPay(data)},fail:function(res){-1!==res.errMsg.indexOf("用户取消")?callbacks.pay&&callbacks.pay(2,{errMsg:"用户取消支付"}):callbacks.pay&&callbacks.pay(1,{errMsg:"支付失败:"+res.errMsg+"("+res.errCode+")"})},complete:function(res){}}))},kfPay:function(data){this_order_id=data.orderId,wx.showModal({title:"支付提示",content:'进入客服会话，点击右下角小卡片或输入"cz"或"充值"获取支付链接',showCancel:!1,confirmText:"我知道了",success:function(){wx.openCustomerServiceConversation({showMessageCard:!0,sendMessageTitle:"不用点这个卡片",sendMessageImg:"https://static.357pk.net/uploads/2109/weixin_pay_img1.png"})}})},gameGoPay:function(data,retry){console.log("[SDK]米大师支付完毕，通知服务器发货");var self=this,session_key=wx.getStorageSync("plat_session_key");wx.request({url:HOST+"/partner/pay/"+config.partner_id+"/"+config.game_pkg+"/",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{order_id:data.orderId,time:data.time,sign:data.sign,session_key:session_key},success:function(res){console.log("[SDK]米大师支付结果"),console.log(res),200==res.statusCode&&(1==res.data.state?(res={cpOrderNo:self.order_data.cpbill,orderNo:data.orderId,amount:self.order_data.price,extension:self.order_data.extension},callbacks.pay&&callbacks.pay(0,res)):callbacks.pay&&callbacks.pay(1,{errMsg:"支付失败"}))},fail:function(){}})},logCreateRole:function(data){var uid=wx.getStorageSync("plat_uid"),username=wx.getStorageSync("plat_username"),postData={};postData.user_id=uid,postData.user_name=username,postData.role_id=data.roleid,postData.role_lev=data.rolelevel,postData.role_name=data.rolename,postData.server_id=data.serverid,data.roleid&&data.serverid&&(user_game_info={role_id:data.roleid,server_id:data.serverid}),this.log("create",postData)},logEnterGame:function(data){var uid=wx.getStorageSync("plat_uid"),username=wx.getStorageSync("plat_username"),postData={};postData.user_id=uid,postData.user_name=username,postData.role_id=data.roleid,postData.role_lev=data.rolelevel,postData.role_name=data.rolename,postData.server_id=data.serverid,data.roleid&&data.serverid&&(user_game_info={role_id:data.roleid,server_id:data.serverid}),this.log("enter",postData)},logRoleUpLevel:function(data){var uid=wx.getStorageSync("plat_uid"),username=wx.getStorageSync("plat_username"),postData={};postData.user_id=uid,postData.user_name=username,postData.role_id=data.roleid,postData.role_lev=data.rolelevel,postData.role_name=data.rolename,postData.server_id=data.serverid,data.roleid&&data.serverid&&(user_game_info={role_id:data.roleid,server_id:data.serverid}),this.log("levelup",postData)},uuid:function(radix,len){var i,r,chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid=[];if(radix=radix||chars.length,len)for(i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];else for(uuid[8]=uuid[13]=uuid[18]=uuid[23]="-",uuid[14]="4",i=0;i<36;i++)uuid[i]||(r=0|16*Math.random(),uuid[i]=chars[19==i?3&r|8:r]);return uuid.join("")},getPublicData:function(){var system=wx.getSystemInfoSync(),uuid=wx.getStorageSync("plat_uuid"),idfv=wx.getStorageSync("plat_idfv"),ad_code=wx.getStorageSync("plat_ad_code"),wx_openid=wx.getStorageSync("wx_openid"),wx_query=wx.getStorageSync("plat_wx_query");return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,ad_code:ad_code,uuid:uuid,idfv:idfv,dname:system.model,mac:"0000",net_type:0==system.wifiSignal?"4G":"WIFI",os_ver:system.system,sdk_ver:system.version,game_ver:game_ver,device:"android"==system.platform?1:2,is_from_min:1,wx_openid:wx_openid,wx_query:wx_query}},log:function(type,data){var key,public_data=this.getPublicData();for(key in data)public_data[key]=data[key];console.log("[SDK]上报数据："+type),console.log(public_data),wx.request({url:HOST+"/partner/h5Log/?type="+type+"&data="+encodeURIComponent(JSON.stringify(public_data))})},getDate:function(){var date=new Date;return date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate()},downloadClient:function(){var msg="微端-不用点这个卡片-"+wx.getStorageSync("wx_openid");wx.showModal({title:"微端下载提示",content:"进入客服会话，点击右下角小卡片获取微端下载链接",showCancel:!1,confirmText:"我知道了",success:function(){wx.openCustomerServiceConversation({showMessageCard:!0,sendMessageTitle:msg,sendMessageImg:"https://static.357pk.net/uploads/2109/weixin_download_img2.jpg"})}})},checkMsg:function(msg,callback){console.log("[SDK]查看文本是否有违规内容");var sdk_token=wx.getStorageSync("plat_sdk_token");wx.request({url:HOST+"/game/min/?ac=msgCheck",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:sdk_token,content:msg},success:function(res){console.log("[SDK]查看文本是否有违规内容结果返回:"),callback&&callback(0==res.data.code?1:0,res.data.msg)}})},checkMsgV2:function(msg,callback){console.log("[SDK]查看文本是否有违规内容");var sdk_token=wx.getStorageSync("plat_sdk_token");wx.request({url:HOST+"/game/min/?ac=msgCheckV2",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:sdk_token,content:msg,scene:1},success:function(res){console.log("[SDK]查看文本是否有违规内容结果返回:"),callback&&callback(0==res.data.code?1:0,res.data.msg)}})},sendMessage:function(template_id,data,callback){console.log("[SDK]发送订阅消息");var sdk_token=wx.getStorageSync("plat_sdk_token");wx.request({url:HOST+"/game/min/?ac=sendMessage",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:sdk_token,template_id:template_id,data:data},success:function(res){console.log("[SDK]订阅消息发送成功"),callback&&callback(0==res.data.code?1:0,res.data.msg)}})},videoAdvert:function(advert_type,callback){wx.request({url:HOST+"/?method=user.gameConfig",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:config.game_pkg,partner_id:config.partner_id},success:function(res){var res=res.data.data.weixin_advert_id,videoAdv=null,return_data={};if(wx.createRewardedVideoAd){(videoAdv=wx.createRewardedVideoAd({adUnitId:res})).show().catch(function(){console.log("激励视频 广告显示成功");videoAdv.load().then(function(){return videoAdv.show()}).catch(function(err){console.log("激励视频 广告显示失败")}),return_data={advert_type:advert_type,status:"adShow"},callback&&callback(return_data)}),videoAdv.onError(function(err){console.log(err)});try{videoAdv.closeHandler&&(videoAdv.offClose(videoAdv.closeHandler),console.log("videoAdv.offClose卸载成功"))}catch(e){console.log("videoAdv.offClose 卸载失败"),console.error(e)}videoAdv.closeHandler=function(res){videoAdv&&(videoAdv.offClose(),return_data=res&&res.isEnded||void 0===res?(console.log("正常播放结束，需要下发奖励"),{advert_type:advert_type,status:"adReWord"}):(console.log("播放退出，不下发奖励"),{advert_type:advert_type,status:"adClose"}),callback)&&callback(return_data)},videoAdv.onClose(videoAdv.closeHandler)}}})},getGameConfig:function(callback){console.log("[SDK]获取游戏配置"),wx.request({url:HOST+"/?method=user.gameConfig",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:config.game_pkg,partner_id:config.partner_id},success:function(res){var data=res.data.data,res=(console.log("[SDK]获取游戏配置成功"),console.log(res.data),{pay_switch:data.pay_switch,game_ver:data.game_ver});callback&&callback(res)}})},getUserZhuanduanInfo:function(callback){console.log("[SDK]获取用户转端信息");var sdk_token=wx.getStorageSync("plat_sdk_token");wx.request({url:HOST+"/?method=user.getUserZhuanduanInfo",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:sdk_token},success:function(res){res=res.data.data,console.log("[SDK]获取用户转端信息成功"),res={download_url:res.download_url,password:res.password,service_qq:res.service_qq,username:res.username,is_show:res.is_show};callback&&callback(res)}})},openService:function(){wx.openCustomerServiceConversation()}}}function run(method,data,callback){method in PARTNER_SDK&&PARTNER_SDK[method](data,callback)}exports.init=function(data,callback){run("init",data,callback)},exports.login=function(callback){run("login","",callback)},exports.pay=function(data,callback){run("pay",data,callback)},exports.logCreateRole=function(serverId,serverName,roleId,roleName,roleLevel){run("logCreateRole",{serverid:serverId,servername:serverName,roleid:roleId,rolename:roleName,rolelevel:roleLevel})},exports.logEnterGame=function(serverId,serverName,roleId,roleName,roleLevel){run("logEnterGame",{serverid:serverId,servername:serverName,roleid:roleId,rolename:roleName,rolelevel:roleLevel})},exports.logRoleUpLevel=function(serverId,serverName,roleId,roleName,roleLevel){run("logRoleUpLevel",{serverid:serverId,servername:serverName,roleid:roleId,rolename:roleName,rolelevel:roleLevel})},exports.downloadClient=function(){run("downloadClient")},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run("getPublicData")},exports.checkMsg=function(data,callback){run("checkMsg",data,callback)},exports.checkMsgV2=function(data,callback){run("checkMsgV2",data,callback)},exports.sendMessage=function(template_id,data,callback){run("sendMessage",template_id,data,callback)},exports.videoAdvert=function(advert_type,callback){run("videoAdvert",advert_type,callback)},exports.getGameConfig=function(callback){run("getGameConfig",callback)},exports.getUserZhuanduanInfo=function(callback){run("getUserZhuanduanInfo",callback)},exports.openService=function(){run("openService")};var WeChatUI,__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])});return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),JpegError=(window.NONAGE_TEXT="1、本游戏是一款休闲放置的仙侠游戏，适用于年满16周岁及以上的用户，建议未成年人在家长的监护下使用该游戏产品。\n<br/><br/>2、本游戏基于侠客修仙故事为背景，人物和场景丰富多样，画面风格靓丽，有绚丽的特效来烘托游戏氛围；游戏主要玩法为休闲放置关机，\n也需要玩家参与多人对抗，玩法具有一定的策性与趣味性：游戏中有基于玩家与陌生人聊天的社交系统，社交系统的管理遵循相关法律法规。\n<br/><br/>3、本游戏中有用户实名认证系统，认证为未成年人的用户将接受以下管理：游戏中部分玩法和道具需要付费。未满8周岁的用户不能付费；\n8周岁以上未满16周岁的未成年人用户，单次充值金额不得超过50元人民币，每月充值金额累计不得超过200元；人民币16周岁以上的未成年人用户，\n单次充值金额不得超过100元人民币，每月充值金额累计不得超过400元人民币。未成年人用户，仅可在周五、周六、周日或法定节假日20:00~21:00期间可以登录游戏，时间段外不允许登录\n<br/><br/>4、本游戏以玄幻修仙为主题，在多人协作的竞技有助于锻炼玩家的独立思考能力、空间感知能力和逻辑思维能力；酷炫的角色技能与特效，\n将带给用户良好的视觉享受与游戏代入感；基于团队竞技的协作玩法可以提升玩家的沟通能力、团队协作能力和大局观，鼓励玩家互帮互助、\n维持良好的社群关系。",window.IS_WECHAT=!0,window.userData=null,window.MainRun=null,window.MainResourcePool=null,window.name="",window.loadView=null,window.QCSDK=PARTNER_SDK,window.MainResetStage=null,window.MainCode=null,window.loadScript=function(){},ask_pay=function(roleId,roleName,roleLevel,roleCareer,productId,price){QCSDK.pay(payInfo,callback)},player_create=function(roleId,roleName,roleLevel){QCSDK.logCreateRole(userData.selected_server.server_id,userData.selected_server.name,roleId,roleName,roleLevel)},player_login=function(roleId,roleName,roleLevel){QCSDK.logEnterGame(userData.selected_server.server_id,userData.selected_server.name,roleId,roleName,roleLevel)},player_level_up=function(roleId,roleName,roleLevel){QCSDK.logRoleUpLevel(userData.selected_server.server_id,userData.selected_server.name,roleId,roleName,roleLevel)},record_step=function(step,roleId){var serverTmpId=0,step=(1===userData.newregister&&(serverTmpId=userData.selected_server.server_id),3<step&&(serverTmpId=userData.selected_server.server_id),serverTmpId=base64_encode("game/node/"+userData.channel+"/"+serverTmpId+"/"+userData.package+"/"+step+"/"+userData.account+"/"+userData.sign+"/"+roleId+"/"+userData.mac),new Laya.HttpRequest);step.send(WeChatUI.Config.backstage_url+serverTmpId,null,"get"),step.once(Laya.Event.COMPLETE,this,function(data){})},req_server_list=function(){},showProgressInterface=function(curIndex,maxCount,value,str){window.loadView&&window.loadView.upProgress(str)},updateTotalProgress=function(time){-2==time&&window.loadView&&window.loadView.destroy()},reqRecordError=function(error){},player_share=function(roleId,callBack){QCSDK.share(type)},player_realname=function(callBack){},player_follow=function(roleId,callBack){},player_bindphone=function(callBack){},firstEnterGameScene=function(){},openLogin=function(){Laya.loader.load("res/atlas/login.atlas",Laya.Handler.create(null,function(){var login=new WeChatUI.Login;Laya.stage.addChild(login)}))},window.base64_encode=function(str){for(var c1,c2,c3,base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,len=str.length,strin="";i<len;){if(c1=255&str.charCodeAt(i++),i==len){strin=(strin+=base64EncodeChars.charAt(c1>>2))+base64EncodeChars.charAt((3&c1)<<4)+"==";break}if(c2=str.charCodeAt(i++),i==len){strin=(strin=(strin+=base64EncodeChars.charAt(c1>>2))+base64EncodeChars.charAt((3&c1)<<4|(240&c2)>>4))+base64EncodeChars.charAt((15&c2)<<2)+"=";break}c3=str.charCodeAt(i++),strin=(strin=(strin=(strin+=base64EncodeChars.charAt(c1>>2))+base64EncodeChars.charAt((3&c1)<<4|(240&c2)>>4))+base64EncodeChars.charAt((15&c2)<<2|(192&c3)>>6))+base64EncodeChars.charAt(63&c3)}return strin},window.nameGenerator={familyNames:["赵","蒋","孔","柏","鲁","酆","滕","皮","和","米","熊","席","梅","樊","经","郁","程","甄","井","车","宁","景","印","卓","闻","冉","边","柴","向","都","欧","晁","曾","查","万俟","澹台","","钟离","寸","翠","富察","税","泰","求","旁","禾","冒","悟","苟","佼","旷","叔","焉","肇","徭","郯","锁","磨","同","卷","斯","户","寒","揭","弥","塔","腾","濯","驹","鲜","门","载","修","五","丘","让","零","励","原","竹","南宫","后","百里","壤驷","鲜于","公良","钱","沈","曹","水","韦","鲍","殷","卞","穆","贝","纪","季","盛","胡","房","单","嵇","段","侯","仇","詹","宿","蔺","莘","宰","扈","瞿","古","耿","勾","毋","司马","公冶","宇文","贰","狂","费莫","荤","秘","羽","崇","保","宏","随","玄","遇","圣","戏","资","蛮","邗","钟","完","闭","少","祈","阿","琦","潮","沐","骑","粟","盈","声","信","令","义","尧","谌","粘","考","百","赏","况","钦","乐正","锺离","孙","韩","严","窦","昌","史","齐","萧","明","舒","麻","林","凌","裘","杭","邢","家","富","宓","栾","束","白","屠","党","郦","燕","阎","易","满","沃","敖","沙","荆","上官","宗政","长孙","皇","辟","蹇","靖","亥","用","栋","功","类","乘","偶","御","可","合","汗","邛","机","瓮","止","谬","丹","才","析","素","闪","镜","茂","貊","栗","庆","漫","闽","将","礼","依","招","萨","妫","福","伯","亢","鄢","漆雕","盖","开","李","杨","华","章","马","唐","毕","康","尹","臧","屈","强","刁","霍","缪","洪","滑","封","巫","蓬","暴","龙","怀","蒙","翟","雍","冀","充","慎","弘","利","融","乜","红","欧阳","濮阳","慕容","侨","典","称","绪","绍","占","告","委","抄","庚","卯","裔","前","夫","智","仍","孛","剑","盘","弭","戢","蹉","表","无","桥","赤","长","始","似","英","虎","豆","喜","犁","北","旗","慈","犹","续","邝","纳","言","佴","缑","汝","公西","逯","光","周","朱","金","云","苗","费","郝","伍","姚","计","项","贾","锺","虞","包","裴","芮","乌","全","甘","叶","蒲","池","谭","却","僪","慕","戈","匡","蔚","冷","养","游","夏侯","淳于","司徒","彤","良","诺","愈","以","真","休","钊","定","务","俟","延","由","仆","尔","九","乾","虢","铎","刀","睢","赧","聊","书","板","紫","僧","星","澄","兰","肥","帛","及","力","守","军","孝","介","达","覃","泉","第五","佘","帅","法","巫马","库","频","化","敏","友","植","咎","镇","凭","衷","帖","隋","斛","疏","冼","浮","源","学","斐","青","隐","南","潭","檀","鹿","官","普","贸","坚","行","理","承","忻","辜","老","佟","牟","微生","闫","端木","郏","瑞","郑","尤","陶","潘","花","岑","安","元","湛","成","董","娄","邱","支","应","左","荣","储","巴","班","历","司","从","阳","劳","桑","尚","茹","庾","文","夔","辛","须","权","闻人","太叔","召","端","芒","多","牢","森","翦","谏","嬴","莱","捷","答","环","塞","藩","悉","哀","罕","蒿","玉","牵","种","顿","姓","愚","独","柔","仙","天","謇","藤","雀","布","建","勤","勇","奉","伦","市","六","初","清","爱","商","羊舌","楚","逢","眭","王","许","姜","葛","方","薛","常","卜","汪","戴","梁","危","骆","柯","宗","石","翁","靳","弓","仰","戎","韶","鄂","逄","桂","农","习","终","寇","隆","阚","丰","逮","东方","申屠","有","赫","苦","繁","买","斋","闾","锐","呼","校","拱","乙","矫","敛","邸","进","刑","洛","茆","线","浑","涂","说","吾","本","千","刚","隽","接","纵","枝","野","衣","营","革","汉","敬","卿","所","鄞","楼","德","年","西门","海","晋","子车","阴","泥","冯","何","戚","奚","俞","雷","乐","顾","祁","谈","杜","江","高","昝","丁","崔","荀","汲","牧","秋","祖","郜","索","胥","姬","濮","温","宦","暨","广","师","那","巢","盍","赫连","公孙","舜","实","其","戊","但","释","漆","皋","大","么","兆","允","赛","受","府","笃","俎","淦","菅","针","恽","肖","次","寻","性","诗","奇","宇","波","渠","检","禽","藏","巨","改","练","恭","问","苑","战","城","卑","笪","东门","归","谷梁","督","薄","运","陈","吕","谢","范","任","贺","于","孟","毛","宋","阮","童","夏","管","宣","吉","羊","邴","隗","仲","武","黎","咸","能","申","牛","别","艾","居","禄","巩","简","关","益","皇甫","仲孙","甫","京","朴","巧","奕","贵","闳","威","抗","丑","甲","昔","泷","掌","厚","仵","洋","苌","箕","势","己","错","展","雪","嘉","拜","祭","碧","奈","生","飞","宝","望","兴","尉","仪","永","杞","迟","区","过","谯","左丘","呼延","宰父","仉","厉","摩","褚","施","邹","彭","袁","倪","时","平","禹","茅","蓝","颜","蔡","卢","贲","钮","於","糜","山","伊","符","蓟","籍","苍","扶","寿","庄","鱼","衡","阙","厍","饶","蒯","桓","尉迟","令狐","丛","集","中","回","枚","姒","代","在","昂","祢","丙","留","侍","袭","首","仁","圭","邶","树","庹","世","泣","念","出","霜","扬","佛","酒","速","风","折","节","钞","希","亓","士","母","辉","剧","候","局","麦","哈","梁丘","南门","夹谷","司寇","稽","伟","卫","张","喻","郎","柳","汤","傅","狄","庞","闵","郭","田","莫","邓","龚","惠","松","谷","宫","刘","溥","赖","双","堵","通","晏","容","步","东","聂","空","相","公","公羊","轩辕","岳","象","夕","毓","撒","朋","贯","歧","律","綦","畅","尾","度","衅","员","业","夷","郸","桐","绳","仝","潜","夙","不","烟","善","陀","淡","禚","春","登","宜","银","道","睦","旅","堂","位","第","宛","台","曲","墨","琴","东郭","拓跋","亓官","闾丘","铁"],symbols:["℡","°","i","◤","♛","じ","▃","╋","ㄨ","﹏","☆","╮","╰","う","━","卐","※","∝","★","≡ ","╩","╓","╗","╚","◥","¤","№","§","∮","√","◆","▔","◢","◣","、","·","≡","╝","╔","╬","═","┠","┨","┯","┷","┏","┓","┗","┛","┳","⊥","『","↑","↓","→","←","↘","↙","♀","♂","┇","┅","∵","∴","‖","︱","︳","囧","⊙","●","○","⊕","◎","Θ"],commonPrefix:["囚心","路人","北眼","心刺","曾将","够钟","灼热","闭关","荒年","放生","凉薄","放弃","逆光","疲惫","指忘","拥有","像你","悬崖","裸钻","顾忌","毁梦","念你","鈊疼","神经","隐藏","暖伴","揪心","猫九","兲蛋","溺毙","陌忘","刺痛","溺爱","柠檬","奢望","怨我","断爱","浅亡","梦你","矫情","落墨","沉世","静谧","忆白","奢求","归处","七眠","怪癖","怀抱","北海","归人","浪屿","倔强","旧城","微酒","搁浅","淡别","淡网","苦酒","酒客","刺青","闷热","强挽","浪咖","平庸","寄曲","耳熟","半醉","绺欢","闹巷","远思","厌烦","荒途","带刺","心稳","落潮","逞笑","孤友","秋暮","固执","难挨","伪善","配角","热水","迎夏","梦魇","懦弱","爱惜","北觅","东寻","戒躁","消逝","过客","无畏","长安","征途","心抑","现实","拒丧","魇九","另类","旧故","难处","深腻","寒潮","听孤","薄荷","幼稚","清晓","风尘","诉说","舌味","自赎","亵渎","辞取","纵行","凉墨","善变","哑巴","贪生","砒霜","寡言","忘羡","偏执","败类","任性","大牌","识趣","无憾","取悦","沉醉","普通","皆叹","惦念","微笑","夜声","若久","強荵","爱笑","放手","邂逅","玩家","九夜","芈妖","血煞","良辰","君赋","抬举","闲云","念旧","清明","河图","玩具","悲凉","孤者","柠凉","卷鬓","热吻","笑脸","散落","厌世","贪世","世俗","倒带","叛逆","脆弱","孤身","孤刺","禁锢","深碍","遣心","丑态","游魂","情丝","依赖","空城","浪潮","转角","独瘾","皱眉","囚鸟","烫嘴","断点","衬心","妄念","夏末","猫弦","情伤","救赎","失意","傀儡","痞爺","啊呸","默念","孤傲","孤城","葬訫","孤岛","墨凉","陌路","彼岸","初遇","余醉","深巷","青稚","情殇","纪年","嫑脸","顾念","墨残","凉城","墨染","浅夏","藍調","孤痞","孤寡","孤心","怣梦","余欢","錯過","残忆","失語","槿城","殇泪","呆橘","腻歪","死撑","凉心","陌殇","葬爱","北暖","倾寒","青冢","暮雨","绝戀","蔸蔸","累勒","菰犭虫","无心","墨痕","木兮","陌然","浅歌"],manPrefix:["难酬","孤檠","乞讨","狗带","杀青","热欲","对手","抽离","贪新","蜜酒","体味","爱囚","无碍","荣光","利刃","认怂","刃白","拂扇","侠骨","烟海","话梗","对味","命硬","烟徒","犊子","乞丐","驼背","魔王","绅士","狂神","单杀","孽徒","逆战","亡屍","雅痞"],manSuffix:["玮桦","嘉明","禹锡","智涛","磊贯","嘉恩","启儒","帆松","荣衡","锡杭","成炫","颖禹","鹏儒","亮尧","清瑄","烽狄","衡龙","梁羲","经崴","思彬","帆少","善颖","少靖","兆威","仲盛","道道","谦瀚","金树","旭伟","鹏航","杭喜","锡河","以飞","秋海","广振","衡民","正滨","钧清","宸靖","腾镇","绍龙","朗杭","景坤","宏刚","泽广","兆澄","衡林","隽盛","卫杰","海升","廷宇","金喜","熙雷","健栋","道宸","恒元","品中","俊宗","权敬","炫奕","敬辰","喜飞","以枫","城麟","君伊","朗玮","雷子","隆克","荣敬","建钢","林瀚","诚敬","威春","基键","威成","旭国","嘉彬","衡渝","彪弘","锋友","杰渝","树鸿","震谦","宏平","岳才","宏新","羲若","思泰","群祥","仁建","以儒","滨禹","钢顺","桂畅","然峰","锦楚","昌皓","汉群","斌春","麟广","逸振","雨军","良杭","仁格","利坤","杰禹","田熙","宥峰","炎峰","信俊","威尧","希峻","然阳","光阳","廷颂","晨宸","楠宸","学绍","言青","金琛","迅贤","迅鑫","熙钧","汉正","若佳","勤城","锦杭","泽毅","信贯","浩勇","君威","尧力","铭勇","骏旭","信炎","靖仲","宸尧","绍霆","彪森","光锡","敬诚","经羲","廷劲","翰生","腾岩","兴信","青烽","健裕","辰畅","以曦","弘广","若敬","森亦","汉寒","大新","学思","鹏立","迅坤","锌宁","宸宸","毅旭","翔翔","润炎","钧桂","宏百","骏成","泽恒","承德","颖新","森伊","仁雷","梁朋","超昌","晏铭","楚朗","炎然","霏琛","雷善","雷君","梁臣","榕茂","畅心","畅慧","学浚","威绍","武翔","聪升","健锦","蓝江","汉利","澄田","奕明","森建","凯炎","司弘","国宁","颂春","俊畅","伦翔","元曦","克顺","蓝宇","炎敬","品聪","楠泽","祥朝","汉瑄","弘彪","楠颂","青纶","庆辉","山绍","君建","安云","智宇","峰启","浩宏","才聪","朋元","楠朋","彪勤","嘉家","侨蓝","颂楠","恩伟","才亮","田锌","力杉","颂希","锋振","茂河","曦健","言皓","承树","楚嘉","泰刚","林浩","群彪","同松","祖贤","雷威","升恒","天慧","成健","骏颖","达秋","洋奕","秦腾","钧源","成鸣","龙才","慧恒","敬顺","逸纯","骏奕","金栋","良品","平嘉","生锦","中哲","俊阳","畅亚","澄驰","哲江","京鑫","劲才","鹏栋","虹聪","广权","宥帆","利翰","帆恩","臣彬","彪成","波烽","烽经","飞绍","品杰","彪天","霆伟","喜曦","利恒","子大","飞翔","宏经","庆以","超春","旭亦","坚云","博森","岳世","山启","道田","学梁","光国","权西","伟京","鸿松","启旭","维权","青康","皇基","利大","兆皇","伦朗","纯彬","言学","兆刚","民贤","家基","豪斌","狄杰","豪盛","慧皓","志渝","臣信","冠翰","少劲","庆烽","若然","瀚锋","浩林","梁经","宇骏","隽喜","宏炎","金宗","经子","敬学","润郴","瀚辰","廷嘉","卫源","润文","光基","伦茂","田栋","家成","中经","彬平","良鹏","霖永","树仁","颂杜","浩锌","汉秦","杉曦","百山","恩生","德泽","聪峰","剑楚","正寒","树华","剑劲","仁岳","虹劲","思世","卫恩","思绍","绍杉","然凌","昌君","雨广","玮隽","澄蓝","桂阳","翔风","树朋","云谦","逸俊","靖蓝","鸣以","克钢","思钧","曦树","熙彬","茂云","希维","寒东","亮澄","百谦","博颖","豪星","宇聪","纯康","磊崴","仁青","鸣广","星颂","朗卓","谦坚","信杉","琛朋","纯炎","广刚","振若","亚尊","汉隽","云群","力雷","良伦","锋霆","品麟","麟刚","鸿伟","茂骏","宇嘉","平凯","贤森","雷道","尊广","镇元","伟麟","海元","帆雨","彦健","友隽","卓军","威维","弘锌","元钧","震尧","迅嘉","涛健","格凌","皇祖","齐盛","信钧","光隆","昌宇","春子","心仁","凯国","品霖","冠传","武志","振祥","经智","信若","廷波","以聪","德颂","云崴","雷锡","正钢","德晏","仲润","绍旭","军蓝","霏朋","西奕","彦元","宏城","然臣","康俊","翰飞","灿桂","华泽","钧哲","驹乐","秦才","凌正","翔聪","祖庆","风杉","熙群","凌劲","廷成","利义","禹翔","民锌","敬锦","力祥","波泽","力驹","玮亚","学昌","博田","道哲","寒永","仁云","剑迅","田廷","勤宏","信青","儒秋","子建","佳秋","亮鹏","林腾","崴成","臣星","杰亦","世品","超峰","茂基","毅信","司羲","凌茂","希权","达以","以元","磊宸","泽康","田涛","源隆","京友","震洋","东剑","榕亚","键渝","磊彬","锋威","朗成","波峰","榕武","曦宥","青伦","恒贯","世才","佑曦","弘桂","裕青","郴榕","力佳","奕隽","汉弘","坤宇","磊雨","霏麟","新钢","嘉朗","明志","健达","宏源","清豪","雷雄","纶祥","世元","浩嘉","劲宇","格茂","仲钧","品诚","梁升","斌航","平百","驰伦","品江","勇佳","迅刚","泽迅","宏中","亮飞","武树","浩武","维林","元友","杰楚","权乐","海基","兆汉","浩朝","祖滨","楠齐","亮隽","键大","瑄奕","光桂","武刚","春达","梁虹","利琛","亦国","宁玮","成畅","大军","瑄隽","世宸","岳成","铭鸣","迅旭","骏超","宇云","松狄","庆杉","恒郴","波键","家泽","亚宏","冠伦","虹贤","泽青","基亚","世琛","靖天","金东","圣华","博恩","克宇","朋安","克威","杰哲","驰子","建城","言鸿","麟思","少琛","劲海","东勇","润栋","朝狄","禹克","秋翔","平圣","树琛","逸源","以纯","强皇","恩朝","狄雷","维瑄","百德","锋彬","基亦","侨基","心秦","驹畅","武皇","鸿志","天文","旭武","皇斌","寒西","宏聪","宇金","刚群","尊曦","学宇","奇滨","光良","俊康","杰维","西翦","翰刚","雄麟","瀚钢","奕尧","景驹","希金","品强","天鹏","贯学","东俊","麟大","凯敬","宇阳","晏毅","若绍","锦超","阳中","宗伊","浚坤","锌瑄","明翰","传光","群永","正梁","顺冠","嘉浩","以桂","飞城","麟同","信广","廷西","锡义","喜才","才康","岩诚","岩春","田西","佳锦","希哲","建琛","纶驹","诚磊","鸿儒","森钧","光品","奕键","迅克","云京","光逸","桦乐","浩康","国卫","羲飞","涛凌","纶承","宗同","狄同","尊斌","翦磊","仁盛","承仲","航羲","渝翦","麟柏","斌生","光钧","志雨","言隽","伦凌","裕世","翔以","亦君","健豪","羲品","利国","春百","亮旭","朝兆","海伟","鸣炎","启鸣","强铭","帆民","荣梁","岳畅","弘圣","亚峻","毅司","成传","聪尊","家源","天翦","君鸣","熙金","信生","晨明","同杉","承豪","西尊","安皓","以恩","朗宗","栋驹","谦玮","汉新","心镇","朋杉","崴武","隆宥","雷飞","霏皓","言盛","云维","尧祥","大经","斌杜","隽凯","勤以","豪豪","道键","力以","兴德","伦敬","嘉旭","华晏","维聪","振纯","剑振","航伊","伟山","剑利","源杉","岩卫","仲鑫","同泽","以达","琛正","广民","浩世","喜武","儒瀚","羲宇","源杰","俊祥","春传","钢泽","杉力","麟震","才百","鸿兆","翰杜","旭俊","杜辉","敬桦","旭坤","纯翔","侨力","安润","雷经","国宇","顺佳","升海","宁秦","文百","涛天","成新","义少","品鸣","华瀚","文崴","彪雄","坤侨","寒河","亚景","维蓝","博辰","清仲","若贯","凯宸","家达","凯翦","希熙","弘儒","汉锌","楚启","若林","杭禹","蓝弘","彪树","健洋","涛翔","腾辉","仁森","斌虹","皓臣","灿琛","平华","家华","帆衡","浚玮","品建","哲斌","茂剑","泽嘉","奕勇","毅迅","学恩","乐源","彬伊","恒奇","世天","友雨","超启","锦恩","春纯","乐桦","镇建","仁群","奕志","雄隆","臣崴","田卫","以迅","劲凯","伊彬","明杜","朋渝","润劲","翦宏","雷东","秦寒","楚佑","栋泽","佑秋","海京","卫力","熙勤","京玮","诚泰","正楚","阳树","友澄","禹祥","仁希","贤百","锋少","岩彬","兴腾","心顺","龙伊","阳勤","中豪","格键","峰智","树中","宇中","伟林","儒彦","子伟","铭群","滨友","江毅","靖盛","灿维","明羲","喜劲","庆玮","锋霏","源东","楚龙","洋栋","凌汉","辉侨","齐松","绍海","乐裕","东克","辉宸","彬超","泽坤","绍云","鹏亮","逸鹏","虹祖","树林","熙晨","仁刚","嘉伊","桦钧","皇泽","清元","世贤","正霏","嘉洋","航宇","哲友","汉盛","霖国","杜郴","亦迅","华伦","玉琛","恩郴","承田","达炎","翦瀚","亚谦","力翔","超尊","烽泽","同劲","健桦","兴羲","风裕","滨乐","天克","诚卫","宗道","嘉志","司品","司狄","贯民","言锦","亚同","品钢","启彬","杰大","金儒","雷磊","驹卫","贯航","源谦","桂生","景言","泰畅","凯峰","昌嘉","炫涛","琛浩","雄磊","润迅","伟坚","宁浩","瑄卫","亮若","源辰","颂江","威颂","松键","朗信","皓司","鸣泽","雷洋","奇树","伦成","超纶","民震","雨琛","杰君","威喜","阳源","畅雷","云峻","冠郴","廷皇","达晏","然城","刚博","兆希","祥勇","协然","生鹏","然宸","军鹏","君思","俊东","旭道","云渝","朝源","喜广","杰雷","岳辉","振霆","威朗","源波","松仲","靖松","军启","武虹","炎剑","刚峰","雄岩","梁军","瀚炎","协霆","榕华","伊晨","达岳","晨咏","友梁","金杉","勇斌","亦盛","道世","朗朗","冠群","弘浩","迅安","敬翦","青广","良良","松同","光田","凯彪","辰成","奇茂","绍平","亦恩","祥宏","中枫","岩迅","齐思","霖驹","毅翰","金炫","河正","友平","佑纯","刚子","栋力","伊鸿","渝帆","廷彦","家良","铭龙","劲宏","杭杭","炎辉","森生","岳康","朗旭","佳兆","鸿俊","谦蓝","磊镇","廷晨","源蓝","少剑","朋梁","道广","贤雨","霏锋","靖维","冠升","青峻","浩狄","滨洋","绍钢","琛群","清鑫","泽铭","楚颂","梁辰","隆滨","靖威","达祥","逸靖","山喜","灿栋","然慧","靖翦","峰刚","利瑄","剑梁","秋皓","伦田","洋树","颖曦","勇恩","杰昌","树咏","齐昌","震昌","伟梁","以信","奕旭","贯朋","东宇","杭业","纶崴","麟佳","霖鑫","润诚","景颖","骏楚","国尊","鸿信","麟森","汉西","瀚光","磊豪","辰力","新勇","心达","友航","锡彬","金迅","晏俊","力青","百品","勇武","顺荣","京尊","平霆","恩安","俊启","隽元","阳友","平杰","泽亚","聪齐","鹏君","格衡","业隽","纶林","雷乐","盛秦","磊烽","滨雨","协嘉","力超","霆宇","风民","亦东","达佳","秦翔","业彦","","嘉明","禹锡","智涛","磊贯","嘉恩","启儒","帆松","玮桦","荣衡","锡杭","成炫","颖禹","鹏儒","亮尧","清瑄","烽狄","衡龙","梁羲","经崴","思彬","帆少","善颖","少靖","兆威","仲盛","道道","谦瀚","金树","旭伟","鹏航","杭喜","锡河","以飞","秋海","广振","衡民","正滨","钧清","宸靖","腾镇","绍龙","朗杭","景坤","宏刚","泽广","兆澄","衡林","隽盛","卫杰","海升","廷宇","金喜","熙雷","健栋","道宸","恒元","品中","俊宗","权敬","炫奕","敬辰","喜飞","以枫","城麟","君伊","朗玮","雷子","隆克","荣敬","建钢","林瀚","诚敬","威春","基键","威成","旭国","嘉彬","衡渝","彪弘","锋友","杰渝","树鸿","震谦","宏平","岳才","宏新","羲若","思泰","群祥","仁建","以儒","滨禹","钢顺","桂畅","然峰","锦楚","昌皓","汉群","斌春","麟广","逸振","雨军","良杭","仁格","利坤","杰禹","田熙","宥峰","炎峰","信俊","威尧","希峻","然阳","光阳","廷颂","晨宸","楠宸","学绍","言青","金琛","迅贤","迅鑫","熙钧","汉正","若佳","勤城","锦杭","泽毅","信贯","浩勇","君威","尧力","铭勇","骏旭","信炎","靖仲","宸尧","绍霆","彪森","光锡","敬诚","经羲","廷劲","翰生","腾岩","兴信","青烽","健裕","辰畅","以曦","弘广","若敬","森亦","汉寒","大新","学思","鹏立","迅坤","锌宁","宸宸","毅旭","翔翔","润炎","钧桂","宏百","骏成","泽恒","承德","颖新","森伊","仁雷","梁朋","超昌","晏铭","楚朗","炎然","霏琛","雷善","雷君","梁臣","榕茂","畅心","畅慧","学浚","威绍","武翔","聪升","健锦","蓝江","汉利","澄田","奕明","森建","凯炎","司弘","国宁","颂春","俊畅","伦翔","元曦","克顺","蓝宇","炎敬","品聪","楠泽","祥朝","伦翔","汉瑄","弘彪","楠颂","青纶","庆辉","山绍","君建","安云","智宇","峰启","浩宏","才聪","朋元","楠朋","彪勤","嘉家","侨蓝","颂楠","恩伟","才亮","田锌","力杉","颂希","锋振","茂河","曦健","言皓","承树","楚嘉","泰刚","林浩","群彪","同松","祖贤","雷威","升恒","天慧","成健","骏颖","达秋","洋奕","秦腾","钧源","成鸣","龙才","慧恒","敬顺","逸纯","骏奕","金栋","良品","平嘉","生锦","中哲","俊阳","畅亚","澄驰","哲江","京鑫","劲才","鹏栋","虹聪","广权","宥帆","利翰","帆恩","臣彬","彪成","波烽","烽经","飞绍","品杰","彪天","霆伟","喜曦","利恒","子大","飞翔","宏经","庆以","超春","旭亦","坚云","博森","岳世","山启","道田","学梁","光国","权西","伟京","鸿松","启旭","维权","青康","皇基","利大","兆皇","伦朗","纯彬","言学","兆刚","民贤","家基","豪斌","狄杰","豪盛","慧皓","志渝","臣信","冠翰","少劲","庆烽","若然","瀚锋","浩林","梁经","宇骏","隽喜","宏炎","金宗","经子","敬学","润郴","瀚辰","廷嘉","卫源","润文","光基","伦茂","田栋","家成","中经","彬平","良鹏","霖永","树仁","颂杜","浩锌","汉秦","杉曦","百山","恩生","德泽","聪峰","剑楚","正寒","树华","剑劲","仁岳","虹劲","思世","卫恩","思绍","绍杉","然凌","昌君","雨广","玮隽","澄蓝","桂阳","翔风","树朋","云谦","逸俊","靖蓝","鸣以","克钢","思钧","曦树","熙彬","茂云","希维","寒东","亮澄","百谦","博颖","豪星","宇聪","纯康","磊崴","仁青","鸣广","星颂","朗卓","谦坚","信杉","琛朋","纯炎","广刚","振若","亚尊","汉隽","云群","力雷","良伦","锋霆","品麟","麟刚","鸿伟","茂骏","宇嘉","平凯","贤森","雷道","尊广","镇元","伟麟","海元","帆雨","彦健","友隽","卓军","威维","弘锌","元钧","震尧","迅嘉","涛健","格凌","皇祖","齐盛","信钧","光隆","昌宇","春子","心仁","凯国","品霖","冠传","武志","振祥","经智","信若","廷波","以聪","德颂","云崴","雷锡","正钢","德晏","仲润","绍旭","军蓝","霏朋","西奕","彦元","宏城","然臣","康俊","翰飞","灿桂","华泽","钧哲","驹乐","秦才","凌正","翔聪","祖庆","风杉","熙群","凌劲","廷成","利义","禹翔","民锌","敬锦","力祥","波泽","力驹","玮亚","学昌","博田","道哲","寒永","仁云","剑迅","田廷","勤宏","信青","儒秋","子建","佳秋","亮鹏","林腾","崴成","臣星","杰亦","世品","超峰","茂基","毅信","司羲","凌茂","希权","达以","以元","磊宸","泽康","田涛","源隆","京友","震洋","东剑","榕亚","键渝","磊彬","锋威","朗成","波峰","榕武","曦宥","青伦","恒贯","世才","佑曦","弘桂","裕青","郴榕","力佳","奕隽","汉弘","坤宇","磊雨","霏麟","新钢","嘉朗","明志","健达","宏源","清豪","雷雄","纶祥","世元","浩嘉","劲宇","格茂","仲钧","品诚","梁升","斌航","平百","驰伦","品江","勇佳","迅刚","泽迅","宏中","亮飞","武树","浩武","维林","元友","杰楚","权乐","海基","兆汉","浩朝","祖滨","楠齐","亮隽","键大","瑄奕","光桂","武刚","春达","梁虹","利琛","亦国","宁玮","成畅","大军","瑄隽","世宸","岳成","铭鸣","迅旭","骏超","宇云","松狄","庆杉","恒郴"],womanPrefix:["槿栀","素颜","眼眸","薄姬","大妞","妤梦","湉晨","妩媚","涟漪","旖旎","南笙","沧颜","凝眸","花逝","颜汐","浅沫","琉璃","春野","棠绾","南音","初柚","倩影","烈女","泪眼","莺语","清悦","温婉","挽发","诱惑","情愫","浊泪","浅笑","流苏","晴栀","槿城","花葬","夏墨","余笙","鎖惢","旧梦","喵喵","心奴","浅梦","清樱","柠栀","冷眸","冷颜"],womanSuffix:["碧莹","笑凌","南汐","希菲","雨瑶","蕾盈","雪如","桂映","颖嘉","颖滢","彤月","婷姬","萱琪","勤香","舒晶","毓碧","向姬","采菁","素洁","琼涵","卉映","美儿","寒念","雨娇","青澜","岚桦","语绮","可馨","诗卿","怡聪","清雁","飞淑","露丹","馨友","佩柔","乐凌","雅筠","忆梵","锦寒","婵寒","雪菲","贤海","瑾丽","红迎","淑睿","诗馨","丽琦","影汐","雪馥","宜妍","宛素","艺雨","影凌","安妍","咏雪","雪松","乐蕾","凌凡","璐舒","可倩","阳香","枫雅","婵艺","雯思","艺婷","梵友","融阳","苇红","丽梦","颖婷","萱诗","咏晓","雅静","艺华","容惠","雪夏","凡南","瑶嘉","月蓓","风松","莺艺","迎叶","娜英","绮萱","芹雨","欣华","筠霜","娜双","玉馨","欣阳","雯茗","安宛","娇英","娴安","洁月","熙瑶","平雪","菱含","婷宇","姬儿","翠菡","清烁","婉姣","萱梵","菲琳","晓颖","萱琦","红蕊","菱汐","婉小","青滢","代容","佩艺","燕静","颖婵","涵易","欢思","香荔","月凡","雪翠","媚伊","聪丝","娜锦","彩寒","娇寒","松舒","香颖","芹萱","晓兰","平勤","凌媚","爽融","岚菲","秀丹","小沫","柔婵","蓝忆","婷瑾","含儿","娇雅","思毓","依曼","琳洋","佳清","采蕊","玲晶","霜含","媚琼","菱阳","瑗婷","沫寒","蕊霜","黛涵","彩萱","若舒","夏毓","姬美","欢仪","媚晴","蕊菲","蕊如","夏苛","晶璧","丽馥","琦凌","美玉","聪慧","瑶雅","新瑶","怜素","晶蓝","雯兰","雯雪","涵新","瑶菲","莹晓","婷菱","咏南","贤汐","玉萱","晶华","惠清","蓝聪","绮容","友欢","莎友","霜雅","彤碧","蓝澜","馨初","琰瑞","凡盈","佩丝","文妍","芳媚","南蕊","瑶盼","瑞沛","亦初","冰蕊","夏熙","晶曼","玉汐","洁柔","逸初","芬晴","宛菡","菲盈","瑾瑞","熙玉","妍菲","琬晓","贤亦","瑾飞","涵桂","风秀","风沫","雯菱","筠琦","萱静","念荷","玉依","琪淑","盈玉","梦咏","静淑","毓睿","慕瑶","羽翠","涵菱","嘉文","娜琼","咏洋","霞碧","华欢","采园","希莎","书雨","娇玉","寒欣","以乐","代颖","映元","初清","希琪","念璧","亦丹","馨贤","念沫","怡婉","馥锦","红雪","娇琪","涵雁","迎熙","亦乐","茗彤","笑柳","迎静","玲仪","飞涵","聪茗","琳慕","舒艺","婕姣","风雪","涵华","梦雪","园霞","荷慧","燕雨","珊妮","莹汐","露慕","南瑶","宜惠","含亦","诗瑶","荔妍","雅璐","瑗聪","蕾熙","小媚","儿颖","巧玲","慧笑","文新","勤蓝","晶平","茗叶","静书","珊华","香希","凡荔","芙婷","瑶静","洋海","曼叶","卿惠","初菡","雨荔","滢慧","贝婷","宇瑞","梦锦","婷迎","代馨","冰笑","妮岚","姬汐","澜琰","妙珊","慧贤","南婉","骅菁","小念","夏贤","安珊","苑琰","馨小","倩琳","寒风","希怜","洋睿","迎羽","霞莉","莎清","怜琳","以勤","飞梦","娴琼","婕念","聪萱","叶水","婷凡","蓝飘","馨璐","柔莉","佩忆","艺莹","静露","宛汐","娇芬","芳蕾","桂叶","妍如","映馨","咏骅","思夏","琳怜","瑾萱","风叶","秀诗","丹璧","彤珊","逸锦","淑芹","婷翠","锦聪","姣熙","惜眉","睿璧","贤娅","飞风","素宛","蓝易","贝芹","初骅","芳雁","璐妙","婉露","娅瑶","芬亦","华岚","欢怜","丝秀","眉荔","易乐","水琪","琳雪","伊姣","巧雪","娅玉","黛蓝","晴霜","露香","飞华","英瑶","晶怜","凡迎","琳莎","巧白","双宛","仪容","晓惠","佳儿","影涵","仪儿","青宝","菱秀","逸娇","诗羽","霜欣","丽娜","桦桂","琬枫","容聪","岚卿","琪希","逸语","冰卉","菁阳","荷雨","菲丹","娅彦","媚汐","琳夏","叶平","菡红","仪毓","姬怡","容英","影风","欣怡","香妍","娴怜","苇芬","沛青","蕊忆","霜艺","晓晴","柳素","芳蓝","筠白","筠静","菡夏","妍莎","海蓝","娅晴","彤莎","玉媚","勤红","琴佩","颖骅","菱海","影代","沫瑶","烁琴","晓璧","诗梦","妍苛","霜南","怡燕","梦璧","希佩","代晶","羽彤","宝柳","冬凡","梦容","如荔","南嘉","美友","苇以","岚彦","凡冰","蓝欢","叶宛","惠婵","淑采","姣蕾","菁毓","霜芙","小诗","海阳","英念","琬熙","贤佩","红菲","慕姣","采莹","彤萱","沛雪","素菲","瑞迎","聪风","寒桦","霞仪","玉冬","风彤","莺珊","儿儿","佳琬","语晓","飞蓓","诗晴","蓉茜","霜华","琳小","莺丹","雅娜","叶璐","翠笑","贤雪","卿语","希容","凌素","香含","蓝贤","儿雪","伊丽","艺风","惠易","逸宇","逸梦","洋仪","瑞怜","亦佳","飘佩","燕瑶","骅绮","宛欣","芙聪","雨书","琼芳","亦念","琴笑","翠宇","琴融","翠薇","若怡","枫丹","初翠","语静","雅小","妮柔","惜文","曼小","萱莺","宜佩","易晶","卿友","萱红","安红","琪黛","蓝枫","珊仪","荷萱","萱滢","双梦","香易","馨雪","飘雅","风冰","蕾琦","怜冰","晴松","桦素","宇夏","娜美","燕琳","慧艺","黛烁","影菡","莎露","婵苛","柳姣","婷盼","琴琼","梦欣","玉荔","柔诗","曼红","妙香","桂凡","寒友","寒晶","代桃","文骅","贤白","宇倩","茜馥","蓓琪","可雁","如颖","采笑","莺蓉","凌海","清娴","菲容","薇骅","涵梵","影芙","盼青","馥露","曼怜","安凡","玲柔","妍仪","苛柳","绮琴","冬汐","雅文","蓉初","黛念","霞苑","映贝","涵舒","涵琰","雁雯","妮凡","彦融","荔颖","睿苛","菡盼","芳晶","黛媛","雨桂","卉晶","馨琦","凌笑","安若","蕊锦","芳雪","翠桃","卿馨","怡采","冬涵","夏雪","玲珊","初蓉","友娜","双萱","萱玉","如瑶","慧爽","若秀","飞叶","蕾爽","英柳","如婵","秀若","彩烁","念忆","霞晴","骅芙","芳英","叶代","舒宛","宛瑶","茗贝","艺琪","雁小","宝菲","瑶梦","娇语","迎玉","菡乐","芹怜","沛美","聪涵","琰佳","如雅","霞代","慧瑶","宝媚","苛蓉","红颖","蓝烁","芹依","爽雁","雪桂","以绮","黛飞","雪华","苛水","琦菡","丹婷","娴黛","友凌","婕惠","菁翠","丝菡","婕枫","汐友","毓琰","涵荔","含娜","琦映","蕊慧","燕芳","飘叶","滢菁","松洁","水灵","娇雅","馨骅","梦姬","萱菡","水巧","夏馨","茗琦","霞澜","友丹","睿馨","瑾晴","丝卿","琼宇","岚双","桃淑","芳萱","希小","巧娅","惠宇","飞菱","琪岚","欣蓝","冰芙","蕾如","琼可","妙亦","梵毓","桃可","枫荷","黛冬","岚蓉","月洁","巧彤","曼芙","爽雅","沛枫","仪雪","岚丽","希碧","英雨","卿锦","芹诗","雯菁","琪丝","松蕾","芬若","芹绮","梦勤","雨骅","翠亦","蓉媚","咏雅","芙容","艺南","英彦","曼娜","亦燕","颖夏","怜苇","慧盼","冰荷","芙瑾","绮萱","水曼","燕惠","儿飘","宜菲","倩绮","青宛","霞芹","妮彩","菲蓝","影洁","晶蕊","嘉霞","聪苑","友莹","姬琳","双雪","熙媚","洋玉","苇菡","舒舒","沛诗","雅代","琪夏","夏灵","熙静","娅苛","沫霞","宝聪","容娅","骅冬","芹盼","慕岚","澜冬","瑶仪","南琳","彩乐","惜菲","新慧","宛雅","雅蕊","映安","沛汐","松秀","南沛","迎飞","彤采","颖露","梦雨","香嘉","乐舒","琰惜","苛沫","琳南","燕荔","丹慕","莉若","迎诗","洋馨","蕾贤","念婷","园思","贤颖","欣柳","素儿","雁婉","苛婕","飘霞","诗伊","翠汐","采倩","柳晶","筠玛","蕊希","华琳","馥凌","黛友","惜采","冬艺","秀锦","妙娅","忆茗","宇儿","蕊丹","荔锦","慕琳","婉如","聪艺","桦滢","晴南","霞菡","荷莺","毓芳","琴筠","希叶","月雪","蕊媚","沛薇","咏柔","雅飘","佩如","琰夏","婵汐","雯琳","含贝","娅涵","馨水","桂婵","水馨","飘贤","莉影","馥菱","馨锦","锦菲","蓉琴","凌沫","晶涵","岚爽","馨嘉","琼琦","秀姣","寒桂","菁洋","儿毓","娴爽","荷素","笑蓓","以莎","菲洋","涵婕","希桂","宜雪","凡寒","荷妙","莉逸","琴茜","雪静","瑶晶","桦灵","素美","茜芹","爽依","嘉红","佩月","诗宛","茜素","妍丽","彦小","瑗飞","颖羽","烁水","娇咏","青阳","琼亦","琦贤","新玉","含玲","晓静","蓝苑","蓉希","叶慧","清诗","玛丽","阳影","凌彤","丹书","琪语","妮艺","妮蓝","兰卿","如怡","盼菁","宛兰","娜宜","枫莹","阳舒","枫忆","以烁","毓晶","霜素","夏菲","丝雪","迎雅","冰芬","梦盼","沫惠","爽伊","夏茗","雪洁","宛汐","熙卉","语婵","霞冬","毓萱","汐含","婉涵","宜熙","菲如","颖苛","玉月","雪瑗","香华","宇如","琬蓉","彤婉","瑶夏","清雪","玲易","锦妙","秀慧","烁静","菲小","文岚","熙珊","盼兰","映珊","茜蓝","可瑞","澜彤","菱艺","忆园","冰碧","妍惠","曼若","娇黛","雅蓉","琬冰","梵海","雅莎","梦彤","贤安","容依","梦宜","雅婉","洁婉","慧咏","思熙","婵媚","诗素","晴婵","莎岚","玉荷","荷绮","欢叶","羽忆","柳清","海玉","雨佳","新冰","依筠","乐念","静菡","荷芬","盼宛","玉雯","菁婷","滢妮","勤素","伊勤","羽霞","艺丝","容妍","洁梵","素思","娅香","佳秀","希馨","采晓","冰平","黛梵","寒梦","向冬","瑞宛","岚茜","晓玲","乐霜","柳熙","怜玲","玲琳","骅馥","娅青","卉清","易涵","兰蕾","灵依","咏黛","瑞聪","希媚","桦羽","玉巧","小飞","以婉","欢蕊","锦芬","飞香","素佩","红书","如宛","馨清","文沛","晓苛","婷卉","初红","桦沫","莎梦","琰华","珊苛","伊兰","友影","茗姬","瑞晓","琳丹","娇菁","汐雯","婉飘","菲玛","碧静","翠琼","聪红","嘉曼","佳英","琪梦","笑颖","睿雨","希芙","瑗芹","蓓含","丝曼","易华","宜媚","桦琳","伊薇","宇碧","逸婕","忆涵","元以","沛南","燕慕","丹惠","琳婕","瑾影","若晓","苇慕","瑾婵","向咏","羽玛","宜雅","阳容","婵英","蓉若","瑶红","元琪","欢雪","雪白","清梦","希静","夏蓉","玉盼","茗思","华娴","新妍","枫雨","雪娴","绮桃","玉容","思逸","忆姣","琴卉","媚怡","萱慕","迎洋","叶沛","苇睿","梵书","宇芳","芹希","美书","静芙","雪莎","梵柳","琪露","琪玉","怡佳","婷骅","含晶","曼露","怜迎","馥芙","妙绮","念筠","澜笑","慧希","逸元","如沫","绮南","念佳","嘉瑾","霜宜","盼涵","含彦","汐海","娜儿","琪瑗","蓝璐","烁彤","菲安","骅睿","怜儿","松雅","含菁","乐兰","茗珊","惠霜","艺羽","姬冰","沫桦","娇琳","梦彩","亦涵","娅绮","彤欣","瑶菲","菁琰","彦贤","丝媚","茜英","文蓓","夏怜","怜菱","莎冬","霜菡","璧岚","碧艺","芳冬","以新","薇蓝","亦菲","乐芬","沛芳","妙松","娴华","莎宇","熙蓓"],descs:["渡劫成功晋升天仙","领取了88888元宝礼包","渡劫成功晋升玄仙","渡劫成功晋升仙君","渡劫成功晋升地仙","领取了99999元宝礼包"],familyArr:new Array(2),symbolArr:new Array(3),tops:[112,140,168,196,224],items:new Array,destroyed:!1,destory:function(){}},function(){function JpegError(msg){this.message="JPEG error: "+msg}return(JpegError.prototype=new Error).name="JpegError",JpegError.constructor=JpegError}()),DNLMarkerError=function(){function DNLMarkerError(message,scanLines){this.message=message,this.scanLines=scanLines}return(DNLMarkerError.prototype=new Error).name="DNLMarkerError",DNLMarkerError.constructor=DNLMarkerError}(),EOIMarkerError=function(){function EOIMarkerError(message){this.message=message}return(EOIMarkerError.prototype=new Error).name="EOIMarkerError",EOIMarkerError.constructor=EOIMarkerError}(),JpegImage=function(){var dctZigZag=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),dctCos1=4017,dctSin1=799,dctCos3=3406,dctSin3=2276,dctCos6=1567,dctSin6=3784,dctSqrt2=5793,dctSqrt1d2=2896;function JpegImage(_a){var _a=void 0===_a?{}:_a,_c=_a.decodeTransform,_a=_a.colorTransform,_a=void 0===_a?-1:_a;this._decodeTransform=void 0===_c?null:_c,this._colorTransform=_a}function getBlockBufferOffset(component,row,col){return 64*((component.blocksPerLine+1)*row+col)}function decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successivePrev,successive,parseDNLMarker){void 0===parseDNLMarker&&(parseDNLMarker=!1);var mcusPerLine=frame.mcusPerLine,progressive=frame.progressive,startOffset=offset,bitsData=0,bitsCount=0;function readBit(){if(0<bitsCount)return bitsData>>--bitsCount&1;if(255===(bitsData=data[offset++])){var nextByte=data[offset++];if(nextByte){if(220===nextByte&&parseDNLMarker){offset+=2;var scanLines=data[offset++]<<8|data[offset++];if(0<scanLines&&scanLines!==frame.scanLines)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",scanLines)}else if(217===nextByte)throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data");throw new JpegError("unexpected marker "+(bitsData<<8|nextByte).toString(16))}}return bitsData>>>(bitsCount=7)}function decodeHuffman(tree){for(var node=tree;;){if("number"==typeof(node=node[readBit()]))return node;if("object"!=typeof node)throw new JpegError("invalid huffman sequence")}}function receive(length){for(var n=0;0<length;)n=n<<1|readBit(),length--;return n}function receiveAndExtend(length){var n;return 1===length?1===readBit()?1:-1:1<<length-1<=(n=receive(length))?n:n+(-1<<length)+1}var eobrun=0;var successiveACNextValue,successiveACState=0;for(var component,j,k,n,fileMarker,h,v,componentsLength=components.length,decodeFn=progressive?0===spectralStart?0===successivePrev?function(component,offset){var t=0===(t=decodeHuffman(component.huffmanTableDC))?0:receiveAndExtend(t)<<successive;component.blockData[offset]=component.pred+=t}:function(component,offset){component.blockData[offset]|=readBit()<<successive}:0===successivePrev?function(component,offset){if(0<eobrun)eobrun--;else for(var k=spectralStart,e=spectralEnd;k<=e;){var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,rs=rs>>4;if(0==s){if(rs<15){eobrun=receive(rs)+(1<<rs)-1;break}k+=16}else{rs=dctZigZag[k+=rs];component.blockData[offset+rs]=receiveAndExtend(s)*(1<<successive),k++}}}:function(component,offset){for(var rs,k=spectralStart,e=spectralEnd,r=0;k<=e;){var offsetZ=offset+dctZigZag[k],sign=component.blockData[offsetZ]<0?-1:1;switch(successiveACState){case 0:if(r=(rs=decodeHuffman(component.huffmanTableAC))>>4,0==(rs=15&rs))successiveACState=r<15?(eobrun=receive(r)+(1<<r),4):(r=16,1);else{if(1!=rs)throw new JpegError("invalid ACn encoding");successiveACNextValue=receiveAndExtend(rs),successiveACState=r?2:3}continue;case 1:case 2:component.blockData[offsetZ]?component.blockData[offsetZ]+=sign*(readBit()<<successive):0===--r&&(successiveACState=2===successiveACState?3:0);break;case 3:component.blockData[offsetZ]?component.blockData[offsetZ]+=sign*(readBit()<<successive):(component.blockData[offsetZ]=successiveACNextValue<<successive,successiveACState=0);break;case 4:component.blockData[offsetZ]&&(component.blockData[offsetZ]+=sign*(readBit()<<successive))}k++}4===successiveACState&&0===--eobrun&&(successiveACState=0)}:function(component,offset){for(var t=0===(t=decodeHuffman(component.huffmanTableDC))?0:receiveAndExtend(t),k=(component.blockData[offset]=component.pred+=t,1);k<64;){var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,rs=rs>>4;if(0==s){if(rs<15)break;k+=16}else{rs=dctZigZag[k+=rs];component.blockData[offset+rs]=receiveAndExtend(s),k++}}},mcu=0,mcuExpected=1===componentsLength?components[0].blocksPerLine*components[0].blocksPerColumn:mcusPerLine*frame.mcusPerColumn;mcu<mcuExpected;){for(var mcuToRead=resetInterval?Math.min(mcuExpected-mcu,resetInterval):mcuExpected,i=0;i<componentsLength;i++)components[i].pred=0;if(eobrun=0,1===componentsLength)for(component=components[0],n=0;n<mcuToRead;n++)!function(component,decode,mcu){decode(component,getBlockBufferOffset(component,mcu/component.blocksPerLine|0,mcu%component.blocksPerLine))}(component,decodeFn,mcu),mcu++;else for(n=0;n<mcuToRead;n++){for(i=0;i<componentsLength;i++)for(h=(component=components[i]).h,v=component.v,j=0;j<v;j++)for(k=0;k<h;k++)!function(component,decode,mcu,row,col){decode(component,getBlockBufferOffset(component,(mcu/mcusPerLine|0)*component.v+row,mcu%mcusPerLine*component.h+col))}(component,decodeFn,mcu,j,k);mcu++}bitsCount=0,(fileMarker=findNextFileMarker(data,offset))&&fileMarker.invalid&&(warn("decodeScan - unexpected MCU data, current marker is: "+fileMarker.invalid),offset=fileMarker.offset);var marker=fileMarker&&fileMarker.marker;if(!marker||marker<=65280)throw new JpegError("marker was not found");if(!(65488<=marker&&marker<=65495))break;offset+=2}return(fileMarker=findNextFileMarker(data,offset))&&fileMarker.invalid&&(warn("decodeScan - unexpected Scan data, current marker is: "+fileMarker.invalid),offset=fileMarker.offset),offset-startOffset}function buildComponentData(frame,component){for(var blocksPerLine=component.blocksPerLine,blocksPerColumn=component.blocksPerColumn,computationBuffer=new Int16Array(64),blockRow=0;blockRow<blocksPerColumn;blockRow++)for(var blockCol=0;blockCol<blocksPerLine;blockCol++)!function(component,blockBufferOffset,p){var v0,v1,v2,v3,v4,v5,v6,v7,p0,p1,p2,p3,p4,p5,p6,p7,t,qt=component.quantizationTable,blockData=component.blockData;if(!qt)throw new JpegError("missing required Quantization Table.");for(var row=0;row<64;row+=8)p0=blockData[blockBufferOffset+row],p1=blockData[blockBufferOffset+row+1],p2=blockData[blockBufferOffset+row+2],p3=blockData[blockBufferOffset+row+3],p4=blockData[blockBufferOffset+row+4],p5=blockData[blockBufferOffset+row+5],p6=blockData[blockBufferOffset+row+6],p7=blockData[blockBufferOffset+row+7],p0*=qt[row],0==(p1|p2|p3|p4|p5|p6|p7)?(p[row]=t=dctSqrt2*p0+512>>10,p[row+1]=t,p[row+2]=t,p[row+3]=t,p[row+4]=t,p[row+5]=t,p[row+6]=t,p[row+7]=t):(p1*=qt[row+1],p2*=qt[row+2],p3*=qt[row+3],p4*=qt[row+4],p5*=qt[row+5],p6*=qt[row+6],p7*=qt[row+7],v1=(v0=(v0=dctSqrt2*p0+128>>8)+(v1=dctSqrt2*p4+128>>8)+1>>1)-v1,t=(v2=p2)*dctSin6+(v3=p6)*dctCos6+128>>8,v2=v2*dctCos6-v3*dctSin6+128>>8,v6=(v4=(v4=dctSqrt1d2*(p1-p7)+128>>8)+(v6=p5<<4)+1>>1)-v6,v5=(v7=(v7=dctSqrt1d2*(p1+p7)+128>>8)+(v5=p3<<4)+1>>1)-v5,v3=(v0=v0+(v3=t)+1>>1)-v3,v2=(v1=v1+v2+1>>1)-v2,t=v4*dctSin3+v7*dctCos3+2048>>12,v4=v4*dctCos3-v7*dctSin3+2048>>12,v7=t,t=v5*dctSin1+v6*dctCos1+2048>>12,v5=v5*dctCos1-v6*dctSin1+2048>>12,v6=t,p[row]=v0+v7,p[row+7]=v0-v7,p[row+1]=v1+v6,p[row+6]=v1-v6,p[row+2]=v2+v5,p[row+5]=v2-v5,p[row+3]=v3+v4,p[row+4]=v3-v4);for(var col=0;col<8;++col)p0=p[col],0==((p1=p[col+8])|(p2=p[col+16])|(p3=p[col+24])|(p4=p[col+32])|(p5=p[col+40])|(p6=p[col+48])|(p7=p[col+56]))?(blockData[blockBufferOffset+col]=t=(t=dctSqrt2*p0+8192>>14)<-2040?0:2024<=t?255:t+2056>>4,blockData[blockBufferOffset+col+8]=t,blockData[blockBufferOffset+col+16]=t,blockData[blockBufferOffset+col+24]=t,blockData[blockBufferOffset+col+32]=t,blockData[blockBufferOffset+col+40]=t,blockData[blockBufferOffset+col+48]=t,blockData[blockBufferOffset+col+56]=t):(t=(v2=p2)*dctSin6+(v3=p6)*dctCos6+2048>>12,v2=v2*dctCos6-v3*dctSin6+2048>>12,v3=t,v6=(v4=(v4=dctSqrt1d2*(p1-p7)+2048>>12)+(v6=p5)+1>>1)-v6,v5=(v7=(v7=dctSqrt1d2*(p1+p7)+2048>>12)+(v5=p3)+1>>1)-v5,t=v4*dctSin3+v7*dctCos3+2048>>12,v4=v4*dctCos3-v7*dctSin3+2048>>12,v7=t,t=v5*dctSin1+v6*dctCos1+2048>>12,v5=v5*dctCos1-v6*dctSin1+2048>>12,p1=(p1=(v1=(v1=(v0=4112+((v0=dctSqrt2*p0+2048>>12)+(v1=dctSqrt2*p4+2048>>12)+1>>1))-v1)+v2+1>>1)+(v6=t))<16?0:4080<=p1?255:p1>>4,p2=(p2=(v2=v1-v2)+v5)<16?0:4080<=p2?255:p2>>4,p3=(p3=(v3=(v0=v0+v3+1>>1)-v3)+v4)<16?0:4080<=p3?255:p3>>4,p4=(p4=v3-v4)<16?0:4080<=p4?255:p4>>4,p5=(p5=v2-v5)<16?0:4080<=p5?255:p5>>4,p6=(p6=v1-v6)<16?0:4080<=p6?255:p6>>4,p7=(p7=v0-v7)<16?0:4080<=p7?255:p7>>4,blockData[blockBufferOffset+col]=p0=(p0=v0+v7)<16?0:4080<=p0?255:p0>>4,blockData[blockBufferOffset+col+8]=p1,blockData[blockBufferOffset+col+16]=p2,blockData[blockBufferOffset+col+24]=p3,blockData[blockBufferOffset+col+32]=p4,blockData[blockBufferOffset+col+40]=p5,blockData[blockBufferOffset+col+48]=p6,blockData[blockBufferOffset+col+56]=p7)}(component,getBlockBufferOffset(component,blockRow,blockCol),computationBuffer);return component.blockData}function findNextFileMarker(data,currentPos,startPos){function peekUint16(pos){return data[pos]<<8|data[pos+1]}var maxPos=data.length-1,newPos=(startPos=void 0===startPos?currentPos:startPos)<currentPos?startPos:currentPos;if(maxPos<=currentPos)return null;startPos=peekUint16(currentPos);if(65472<=startPos&&startPos<=65534)return{invalid:null,marker:startPos,offset:currentPos};for(var newMarker=peekUint16(newPos);!(65472<=newMarker&&newMarker<=65534);){if(++newPos>=maxPos)return null;newMarker=peekUint16(newPos)}return{invalid:startPos.toString(16),marker:newMarker,offset:newPos}}return JpegImage.prototype={width:0,height:0,parse:function(data,_a){var _a=(void 0===_a?{}:_a).dnlScanLines,dnlScanLines=void 0===_a?null:_a;function readUint16(){var value=data[offset]<<8|data[offset+1];return offset+=2,value}var frame,resetInterval,offset=0,jfif=null,adobe=null,numSOSMarkers=0,quantizationTables=[],huffmanTablesAC=[],huffmanTablesDC=[],fileMarker=readUint16();if(65496!==fileMarker)throw new JpegError("SOI not found");fileMarker=readUint16();markerLoop:for(;65497!==fileMarker;){switch(fileMarker){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var appData=function(){var length=readUint16(),fileMarker=((fileMarker=findNextFileMarker(data,length=offset+length-2,offset))&&fileMarker.invalid&&(warn("readDataBlock - incorrect length, current marker is: "+fileMarker.invalid),length=fileMarker.offset),data.subarray(offset,length));return offset+=fileMarker.length,fileMarker}();65504===fileMarker&&74===appData[0]&&70===appData[1]&&73===appData[2]&&70===appData[3]&&0===appData[4]&&(jfif={version:{major:appData[5],minor:appData[6]},densityUnits:appData[7],xDensity:appData[8]<<8|appData[9],yDensity:appData[10]<<8|appData[11],thumbWidth:appData[12],thumbHeight:appData[13],thumbData:appData.subarray(14,14+3*appData[12]*appData[13])}),65518===fileMarker&&65===appData[0]&&100===appData[1]&&111===appData[2]&&98===appData[3]&&101===appData[4]&&(adobe={version:appData[5]<<8|appData[6],flags0:appData[7]<<8|appData[8],flags1:appData[9]<<8|appData[10],transformCode:appData[11]});break;case 65499:for(var quantizationTablesEnd=readUint16()+offset-2;offset<quantizationTablesEnd;){var quantizationTableSpec=data[offset++],tableData=new Uint16Array(64);if(quantizationTableSpec>>4==0)for(j=0;j<64;j++)tableData[dctZigZag[j]]=data[offset++];else{if(quantizationTableSpec>>4!=1)throw new JpegError("DQT - invalid table spec");for(j=0;j<64;j++)tableData[dctZigZag[j]]=readUint16()}quantizationTables[15&quantizationTableSpec]=tableData}break;case 65472:case 65473:case 65474:if(frame)throw new JpegError("Only single frame JPEGs supported");readUint16(),(frame={}).extended=65473===fileMarker,frame.progressive=65474===fileMarker,frame.precision=data[offset++];for(var appData=readUint16(),componentsCount=(frame.scanLines=dnlScanLines||appData,frame.samplesPerLine=readUint16(),frame.components=[],frame.componentIds={},data[offset++]),maxH=0,maxV=0,i=0;i<componentsCount;i++){var componentId=data[offset],h=data[offset+1]>>4,v=15&data[offset+1],qId=(maxH<h&&(maxH=h),maxV<v&&(maxV=v),data[offset+2]),h=frame.components.push({h:h,v:v,quantizationId:qId,quantizationTable:null});frame.componentIds[componentId]=h-1,offset+=3}frame.maxH=maxH,frame.maxV=maxV,!function(frame){for(var mcusPerLine=Math.ceil(frame.samplesPerLine/8/frame.maxH),mcusPerColumn=Math.ceil(frame.scanLines/8/frame.maxV),i=0;i<frame.components.length;i++){component=frame.components[i];var blocksPerLine=Math.ceil(Math.ceil(frame.samplesPerLine/8)*component.h/frame.maxH),blocksPerColumn=Math.ceil(Math.ceil(frame.scanLines/8)*component.v/frame.maxV),blocksPerLineForMcu=mcusPerLine*component.h,blocksPerColumnForMcu=mcusPerColumn*component.v;component.blockData=new Int16Array(64*blocksPerColumnForMcu*(1+blocksPerLineForMcu)),component.blocksPerLine=blocksPerLine,component.blocksPerColumn=blocksPerColumn}frame.mcusPerLine=mcusPerLine,frame.mcusPerColumn=mcusPerColumn}(frame);break;case 65476:var huffmanLength=readUint16();for(i=2;i<huffmanLength;){for(var huffmanTableSpec=data[offset++],codeLengths=new Uint8Array(16),codeLengthSum=0,j=0;j<16;j++,offset++)codeLengthSum+=codeLengths[j]=data[offset];var huffmanValues=new Uint8Array(codeLengthSum);for(j=0;j<codeLengthSum;j++,offset++)huffmanValues[j]=data[offset];i+=17+codeLengthSum,(huffmanTableSpec>>4==0?huffmanTablesDC:huffmanTablesAC)[15&huffmanTableSpec]=function(codeLengths,values){for(var j,k=0,code=[],length=16;0<length&&!codeLengths[length-1];)length--;code.push({children:[],index:0});for(var q,p=code[0],i=0;i<length;i++){for(j=0;j<codeLengths[i];j++){for((p=code.pop()).children[p.index]=values[k];0<p.index;)p=code.pop();for(p.index++,code.push(p);code.length<=i;)code.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q;k++}i+1<length&&(code.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q)}return code[0].children}(codeLengths,huffmanValues)}break;case 65501:readUint16(),resetInterval=readUint16();break;case 65498:var parseDNLMarker=1==++numSOSMarkers&&!dnlScanLines,selectorsCount=(readUint16(),data[offset++]),components=[];for(i=0;i<selectorsCount;i++){var componentIndex=frame.componentIds[data[offset++]],component=frame.components[componentIndex],componentIndex=data[offset++];component.huffmanTableDC=huffmanTablesDC[componentIndex>>4],component.huffmanTableAC=huffmanTablesAC[15&componentIndex],components.push(component)}var spectralStart=data[offset++],spectralEnd=data[offset++],successiveApproximation=data[offset++];try{var processed=decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successiveApproximation>>4,15&successiveApproximation,parseDNLMarker);offset+=processed}catch(ex){if(ex instanceof DNLMarkerError)return warn(ex.message+" -- attempting to re-parse the JPEG image."),this.parse(data,{dnlScanLines:ex.scanLines});if(ex instanceof EOIMarkerError){warn(ex.message+" -- ignoring the rest of the image data.");break markerLoop}throw ex}break;case 65500:offset+=4;break;case 65535:255!==data[offset]&&offset--;break;default:if(255===data[offset-3]&&192<=data[offset-2]&&data[offset-2]<=254){offset-=3;break}spectralStart=findNextFileMarker(data,offset-2);if(spectralStart&&spectralStart.invalid){warn("JpegImage.parse - unexpected data, current marker is: "+spectralStart.invalid),offset=spectralStart.offset;break}throw new JpegError("unknown marker "+fileMarker.toString(16))}fileMarker=readUint16()}for(this.width=frame.samplesPerLine,this.height=frame.scanLines,this.jfif=jfif,this.adobe=adobe,this.components=[],i=0;i<frame.components.length;i++){var quantizationTable=quantizationTables[(component=frame.components[i]).quantizationId];quantizationTable&&(component.quantizationTable=quantizationTable),this.components.push({output:buildComponentData(0,component),scaleX:component.h/frame.maxH,scaleY:component.v/frame.maxV,blocksPerLine:component.blocksPerLine,blocksPerColumn:component.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(width,height,needAlpha,reserved,alphaChannel){void 0===needAlpha&&(needAlpha=!1),void 0===reserved&&(reserved=0),void 0===alphaChannel&&(alphaChannel=null);var component,componentScaleX,componentScaleY,blocksPerScanline,x,i,j,k,index,output,scaleX=this.width/width,scaleY=this.height/height,offset=0,numComponents=this.components.length,dataLength=width*height*numComponents,result=(3==numComponents&&needAlpha&&(dataLength=width*height*4),new ArrayBuffer(dataLength+reserved)),data=new Uint8ClampedArray(result,reserved),xScaleBlockOffset=new Uint32Array(width);if(3==numComponents&&needAlpha){for(i=0;i<numComponents;i++){for(componentScaleX=(component=this.components[i]).scaleX*scaleX,componentScaleY=component.scaleY*scaleY,offset=i,output=component.output,blocksPerScanline=component.blocksPerLine+1<<3,x=0;x<width;x++)xScaleBlockOffset[x]=(4294967288&(j=0|x*componentScaleX))<<3|7&j;for(y=0;y<height;y++)for(index=blocksPerScanline*(4294967288&(j=0|y*componentScaleY))|(7&j)<<3,x=0;x<width;x++)data[offset]=output[index+xScaleBlockOffset[x]],offset+=4}if(offset=3,null!=alphaChannel)for(var i_1=0,y=0;y<height;y++)for(x=0;x<width;x++)data[offset]=alphaChannel[i_1++],offset+=4;else for(y=0;y<height;y++)for(x=0;x<width;x++)data[offset]=255,offset+=4}else for(i=0;i<numComponents;i++){for(componentScaleX=(component=this.components[i]).scaleX*scaleX,componentScaleY=component.scaleY*scaleY,offset=i,output=component.output,blocksPerScanline=component.blocksPerLine+1<<3,x=0;x<width;x++)xScaleBlockOffset[x]=(4294967288&(j=0|x*componentScaleX))<<3|7&j;for(y=0;y<height;y++)for(index=blocksPerScanline*(4294967288&(j=0|y*componentScaleY))|(7&j)<<3,x=0;x<width;x++)data[offset]=output[index+xScaleBlockOffset[x]],offset+=numComponents}var transform=this._decodeTransform;if(transform=4===numComponents?transform||new Int32Array([-256,255,-256,255,-256,255,-256,255]):transform)if(3==numComponents&&needAlpha)for(i=0;i<dataLength;){for(k=j=0;j<numComponents;j++,i++,k+=2)data[i]=(data[i]*transform[k]>>8)+transform[k+1];i++}else for(i=0;i<dataLength;)for(k=j=0;j<numComponents;j++,i++,k+=2)data[i]=(data[i]*transform[k]>>8)+transform[k+1];return data},get _isColorConversionNeeded(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0!==this._colorTransform:1===this._colorTransform},_convertYccToRgb:function(data,needAlpha){var Y,Cb,Cr,i,length;if(needAlpha=void 0===needAlpha?!1:needAlpha)for(i=0,length=data.length;i<length;i+=3)Y=data[i],Cb=data[i+1],Cr=data[i+2],data[i]=Y-179.456+1.402*Cr,data[i+1]=Y+135.459-.344*Cb-.714*Cr,data[i+2]=Y-226.816+1.772*Cb,i++;else for(i=0,length=data.length;i<length;i+=3)Y=data[i],Cb=data[i+1],Cr=data[i+2],data[i]=Y-179.456+1.402*Cr,data[i+1]=Y+135.459-.344*Cb-.714*Cr,data[i+2]=Y-226.816+1.772*Cb;return data},_convertYcckToRgb:function(data){for(var Y,Cb,Cr,k,offset=0,i=0,length=data.length;i<length;i+=4)Y=data[i],Cb=data[i+1],Cr=data[i+2],k=data[i+3],data[offset++]=Cb*(-660635669420364e-19*Cb+.000437130475926232*Cr-54080610064599e-18*Y+.00048449797120281*k-.154362151871126)-122.67195406894+Cr*(-.000957964378445773*Cr+.000817076911346625*Y-.00477271405408747*k+1.53380253221734)+Y*(.000961250184130688*Y-.00266257332283933*k+.48357088451265)+k*(-.000336197177618394*k+.484791561490776),data[offset++]=107.268039397724+Cb*(219927104525741e-19*Cb-.000640992018297945*Cr+.000659397001245577*Y+.000426105652938837*k-.176491792462875)+Cr*(-.000778269941513683*Cr+.00130872261408275*Y+.000770482631801132*k-.151051492775562)+Y*(.00126935368114843*Y-.00265090189010898*k+.25802910206845)+k*(-.000318913117588328*k-.213742400323665),data[offset++]=Cb*(-.000570115196973677*Cb-263409051004589e-19*Cr+.0020741088115012*Y-.00288260236853442*k+.814272968359295)-20.810012546947+Cr*(-153496057440975e-19*Cr-.000132689043961446*Y+.000560833691242812*k-.195152027534049)+Y*(.00174418132927582*Y-.00255243321439347*k+.116935020465145)+k*(-.000343531996510555*k+.24165260232407);return data.subarray(0,offset)},_convertYcckToCmyk:function(data){for(var Y,Cb,Cr,i=0,length=data.length;i<length;i+=4)Y=data[i],Cb=data[i+1],Cr=data[i+2],data[i]=434.456-Y-1.402*Cr,data[i+1]=119.541-Y+.344*Cb+.714*Cr,data[i+2]=481.816-Y-1.772*Cb;return data},_convertCmykToRgb:function(data){for(var c,m,y,k,offset=0,i=0,length=data.length;i<length;i+=4)c=data[i]*(1/255),m=data[i+1]*(1/255),y=data[i+2]*(1/255),k=data[i+3]*(1/255),data[offset++]=255+c*(-4.387332384609988*c+54.48615194189176*m+18.82290502165302*y+212.25662451639585*k-285.2331026137004)+m*(1.7149763477362134*m-5.6096736904047315*y-17.873870861415444*k-5.497006427196366)+y*(-2.5217340131683033*y-21.248923337353073*k+17.5119270841813)-k*(21.86122147463605*k+189.48180835922747),data[offset++]=255+c*(8.841041422036149*c+60.118027045597366*m+6.871425592049007*y+31.159100130055922*k-79.2970844816548)+m*(-15.310361306967817*m+17.575251261109482*y+131.35250912493976*k-190.9453302588951)+y*(4.444339102852739*y+9.8632861493405*k-24.86741582555878)-k*(20.737325471181034*k+187.80453709719578),data[offset++]=255+c*(.8842522430003296*c+8.078677503112928*m+30.89978309703729*y-.23883238689178934*k-14.183576799673286)+m*(10.49593273432072*m+63.02378494754052*y+50.606957656360734*k-112.23884253719248)+y*(.03296041114873217*y+115.60384449646641*k-193.58209356861505)-k*(22.33816807309886*k+180.12613974708367);return data.subarray(0,offset)},getData:function(width,height,forceRGB,needAlpha,reserved,alphaChannel){if(void 0===forceRGB&&(forceRGB=!1),void 0===needAlpha&&(needAlpha=!1),void 0===reserved&&(reserved=0),void 0===alphaChannel&&(alphaChannel=null),4<this.numComponents)throw new JpegError("Unsupported color mode");var data=this._getLinearizedBlockData(width,height,needAlpha,reserved,alphaChannel);if(1===this.numComponents&&forceRGB){for(var dataLength=data.length,rgbData=new Uint8ClampedArray(3*dataLength),offset=0,i=0;i<dataLength;i++){var grayColor=data[i];rgbData[offset++]=grayColor,rgbData[offset++]=grayColor,rgbData[offset++]=grayColor}return rgbData}if(3===this.numComponents&&this._isColorConversionNeeded)return this._convertYccToRgb(data,needAlpha);if(4===this.numComponents){if(this._isColorConversionNeeded)return forceRGB?this._convertYcckToRgb(data):this._convertYcckToCmyk(data);if(forceRGB)return this._convertCmykToRgb(data)}return data}},JpegImage}(),pack=(!function(WeChatUI){var Config=function(){function Config(){}return Object.defineProperty(Config,"backstage_url",{get:function(){return DEBUG?this.ts_backstage:this.dev_backstage},enumerable:!0,configurable:!0}),Object.defineProperty(Config,"notice_url",{get:function(){return DEBUG?this.ts_notice:this.dev_notice},enumerable:!0,configurable:!0}),Config.dev_backstage="https://api.s1.l2i.cc/game.php/",Config.ts_backstage="https://api.s1.l2i.cc/game.php/",Config.dev_notice="https://api.s1.l2i.cc:82/Notice/noticeList",Config.ts_notice="https://api.s1.l2i.cc:82/Notice/noticeList",Config}();WeChatUI.Config=Config}(WeChatUI=WeChatUI||{}),!function(WeChatUI){var View=laya.ui.View,LoadingViewUI=function(_super){function LoadingViewUI(){return _super.call(this)||this}return __extends(LoadingViewUI,_super),LoadingViewUI.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),_super.prototype.createChildren.call(this),this.createView(WeChatUI.LoadingViewUI.uiView)},LoadingViewUI.uiView={type:"View",props:{width:720,height:1280,centerX:0},child:[{type:"Image",props:{y:-140,x:-120,var:"bgImg",skin:"login/loading_bj.jpg"}},{type:"Box",props:{y:1040,x:0,width:720,var:"proDiv",name:"proDiv",height:240},child:[{type:"Image",props:{y:-37,x:107,width:506,var:"progressBg1",skin:"login/progress_jz_jdt1_0.png",height:26}},{type:"Image",props:{y:5,x:107,width:506,var:"progressBg2",skin:"login/progress_jz_jdt1_0.png",height:26}},{type:"Image",props:{y:-31,x:121,width:478,var:"progressBar1",skin:"login/progress_jz_jdt_1.png",height:14}},{type:"Image",props:{y:11,x:121,width:478,var:"progressBar2",skin:"login/progress_jz_jdt_1.png",height:14}},{type:"Text",props:{y:-75,x:0,width:720,var:"proLabel",text:"正在进入场景......",strokeColor:"#ffffff",stroke:2,fontSize:24,font:"SimHei",color:"#581a1a",align:"center"}},{type:"Text",props:{y:-36,x:0,width:720,var:"proLabel1",text:"10/100%",strokeColor:"#581A1A",stroke:3,fontSize:24,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:6,x:0,width:720,var:"proLabel2",text:"10/100%",strokeColor:"#581A1A",stroke:3,fontSize:24,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:51,x:0,width:720,text:"首次加载耗时较长，再等等就好了哦~",strokeColor:"#000000",stroke:2,fontSize:24,font:"SimHei",color:"#8cff9f",align:"center"}},{type:"Text",props:{y:94,x:0,width:720,text:"抵制不良游戏，拒绝盗版游戏。注意自我保护，谨防受骗上当。",strokeColor:"#021224",stroke:2,fontSize:20,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:125,x:0,width:720,text:"适度游戏益脑，沉迷游戏伤身。合理安排时间，享受健康生活。",strokeColor:"#021224",stroke:2,fontSize:20,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:165,x:0,width:720,var:"txt1",text:"审批文号：新广出审[2018]453号，著作权人：成都贪玩蛇科技有限公司，",strokeColor:"#021224",stroke:2,fontSize:18,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:195,x:0,width:720,var:"txt2",text:"出版单位：北京畅元国讯科技有限公司，出版物号：ISBN 978-7-498-03918",strokeColor:"#021224",stroke:2,fontSize:18,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:222,x:0,width:720,var:"verTxt",text:"游戏版本：",strokeColor:"#021224",stroke:2,fontSize:18,font:"SimHei",color:"#FFFFFF",align:"center"}}]}]},LoadingViewUI}(View),LoadingViewUI=(WeChatUI.LoadingViewUI=LoadingViewUI,function(_super){function LoginViewUI(){return _super.call(this)||this}return __extends(LoginViewUI,_super),LoginViewUI.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),_super.prototype.createChildren.call(this),this.createView(WeChatUI.LoginViewUI.uiView)},LoginViewUI.uiView={type:"View",props:{width:720,height:1280,centerX:0},child:[{type:"Image",props:{y:-140,x:-120,skin:"login/image_xfy_bg2.jpg"}},{type:"Image",props:{y:913,x:124,var:"serverBtn",skin:"login/btn_xfy_xq.png"}},{type:"Button",props:{y:1e3,x:188,var:"loginBtn",stateNum:1,skin:"login/btn_xfy_dlyx.png"}},{type:"Image",props:{y:925,x:155,var:"stateImg",skin:"login/image_xfy_ct.png"}},{type:"Image",props:{y:49,x:541,var:"notice",skin:"login/bth_gonggao.png"}},{type:"Label",props:{y:1126,x:0,wordWrap:!0,width:720,text:"抵制不良游戏，拒绝盗版游戏。注意自我保护，谨防受骗上当。",strokeColor:"#021224",stroke:2,leading:6,height:22,fontSize:22,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Label",props:{y:926,x:210,width:300,var:"serverName",fontSize:30,font:"SimHei",color:"#51628D",align:"center"}},{type:"Label",props:{y:926,x:496,width:100,var:"huanqu",valign:"middle",text:"换区>",height:30,fontSize:30,font:"SimHei",color:"#51628D",align:"center"}},{type:"Label",props:{y:1200,x:0,wordWrap:!0,width:720,text:"著作权人：镇江微端网络科技有限公司 出版单位：上海都玩网络科技有限公司",strokeColor:"#021224",stroke:2,fontSize:16,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Label",props:{y:1230,x:0,wordWrap:!0,width:720,text:"审批文号：新广出审【2016】2609号 出版物号：ISBN ：ISBN 978-7-7979-1212-9",strokeColor:"#021224",stroke:2,fontSize:16,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Label",props:{y:1156,x:0,wordWrap:!0,width:720,text:"适度游戏益脑，沉迷游戏伤身。合理安排时间，享受健康生活。",strokeColor:"#021224",stroke:2,leading:6,height:22,fontSize:22,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Text",props:{y:1260,x:10,width:720,var:"verText",text:"游戏版本：",strokeColor:"#021224",stroke:2,fontSize:18,font:"SimHei",color:"#FFFFFF",align:"center"}},{type:"Label",props:{y:727,x:0,wordWrap:!0,width:720,visible:!1,var:"prompt",text:"当前服务器正在维护中",strokeColor:"#021224",stroke:2,leading:6,height:36,fontSize:36,font:"SimHei",color:"#ff3333",align:"center"}},{type:"Box",props:{y:-140,x:-120,width:960,visible:!1,var:"serverBox",height:1560},child:[{type:"Image",props:{y:0,x:0,width:960,var:"serverBG",skin:"login/image_common_zz.png",sizeGrid:"1,1,1,1",height:1560,alpha:.7}},{type:"Image",props:{y:290,x:142,skin:"login/image_xfy_xfbg.png",mouseThrough:!1,mouseEnabled:!0}},{type:"Image",props:{y:322,x:763,var:"closeSever",stateNum:1,skin:"login/btn_tongyong_13.png"}},{type:"Panel",props:{y:430,x:198,width:182,var:"serverPanel",vScrollBarSkin:"login/image_common_zz.png",height:695},child:[{type:"Tab",props:{y:0,x:0,var:"serverGroup",strokeColors:"#666699,#ffffff",stateNum:2,skin:"login/serverGroup.png",selectedIndex:0,labelStroke:2,labelSize:26,labelFont:"SimHei",labelColors:"#ffffff,#996633",direction:"vertical"}}]},{type:"List",props:{y:429,x:398,width:352,var:"serverList",vScrollBarSkin:"login/image_common_zz.png",repeatX:1,height:692},child:[{type:"Button",props:{y:0,x:0,var:"serverItem",stateNum:1,skin:"login/btn_xfy_fwq.png",renderType:"render"},child:[{type:"Label",props:{y:19,x:0,wordWrap:!0,width:352,var:"itemServerName",text:"已有角色",name:"itemServerName",height:22,fontSize:22,font:"SimHei",color:"#564674",align:"center"}},{type:"Image",props:{y:12,x:21,var:"itemServerState",skin:"login/image_xfy_ct.png",name:"itemServerState"}}]}]},{type:"Label",props:{y:717,x:120,wordWrap:!0,width:720,visible:!1,text:"当前服务器正在维护中",strokeColor:"#021224",stroke:2,leading:6,height:36,fontSize:36,font:"SimHei",color:"#ff3333",align:"center"}},{type:"Label",props:{y:1202,x:382,width:196,text:"点击空白处退出",name:"ExitPromptText",height:28,fontSize:28,font:"SimHei",color:"#CACACA"}}]},{type:"Box",props:{y:0,x:0,width:720,visible:!1,var:"noticeBox",height:1280},child:[{type:"Image",props:{y:-140,x:-120,width:960,var:"noticeBG",skin:"login/image_common_zz.png",sizeGrid:"1,1,1,1",height:1560,alpha:.7}},{type:"Image",props:{y:182,x:25,skin:"login/image_xfy_gg.png",mouseThrough:!1,mouseEnabled:!0}},{type:"Image",props:{y:213,x:645,var:"closeNotice",stateNum:1,skin:"login/btn_tongyong_13.png"}},{type:"Tab",props:{y:976,x:60,var:"noticeTab",strokeColors:"#9e4c65,#ffffff,#fffff,#9e4c65",stateNum:2,skin:"login/noticeBtn2.png",labels:"label1,label2",labelStroke:2,labelSize:26,labelFont:"SimHei",labelColors:"#ffffff,#9e4c65,#9e4c65,#fffff",direction:"horizontal"}},{type:"Label",props:{y:252,x:245,width:220,var:"noticeTitle",text:"公告",height:28,fontSize:28,font:"SimHei",color:"#666699",bold:!0,align:"center"}},{type:"Label",props:{y:1093,x:254,width:196,text:"点击空白处退出",height:28,fontSize:28,font:"SimHei",color:"#CACACA"}},{type:"Panel",props:{y:323,x:79,width:560,var:"noticePanel",vScrollBarSkin:"login/image_common_zz.png",height:610},child:[{type:"HTMLDivElement",props:{y:0,x:0,width:560,var:"noticeContent",innerHTML:"htmlText",height:886}}]}]},{type:"Box",props:{y:0,x:0,width:720,visible:!1,var:"nonageBox",height:1280},child:[{type:"Image",props:{y:-140,x:-120,width:960,var:"nonageBG",skin:"login/image_common_zz.png",sizeGrid:"1,1,1,1",height:1560,alpha:.7}},{type:"Image",props:{y:182,x:22,skin:"login/xfy_gxbg.png",mouseThrough:!1,mouseEnabled:!0}},{type:"Image",props:{y:213,x:639,var:"closeNonage",stateNum:1,skin:"login/btn_tongyong_13.png"}},{type:"Label",props:{y:252,x:245,width:220,var:"nonageTitle",text:"适龄提示",name:"titleLittle",height:28,fontSize:28,font:"SimHei",color:"#666699",bold:!0,align:"center"}},{type:"Label",props:{y:1093,x:254,width:196,text:"点击空白处退出",height:28,fontSize:28,font:"SimHei",color:"#CACACA"}},{type:"HTMLDivElement",props:{y:318,x:74,width:560,var:"nonageContent",innerHTML:"htmlText",height:700}}]},{type:"Image",props:{y:50,x:647,var:"nonage",skin:"login/img_slts_16.png"}}]},LoginViewUI}(View));WeChatUI.LoginViewUI=LoadingViewUI}(WeChatUI=WeChatUI||{}),!function(WeChatUI){var Loading=function(_super){function Loading(){var _this=_super.call(this)||this;return _this.maxProgress=9,_this.init(),_this.onEven(),_this}return __extends(Loading,_super),Loading.prototype.init=function(){this.verTxt.text="游戏版本："+gameVersion,(loadView=this).centerY=0,this.nowProgress=0,this.nowProgress2=0,this.maxWidth=this.progressBar1.width,this.progressBar1.width=this.progressBar2.width=0,this.proLabel1.text=this.proLabel2.text="0%",this.upProgress("加载主程序....."),wx.loadSubpackage({name:"wechat_main",success:function(res){console.log("分包加载成功   ",res),Laya.URL.basePath="http://192.168.31.223:8901/bin",enterGame(userData)},fail:function(res){console.log("分包加载失败   ",res)}}).onProgressUpdate(function(res){console.log("下载进度",res.progress),console.log("已经下载的数据长度",res.totalBytesWritten),console.log("预期需要下载的数据总长度",res.totalBytesExpectedToWrite)}),Laya.timer.loop(100,this,this.upProgress2)},Loading.prototype.upProgress=function(text){var p;this.nowProgress!=this.maxProgress&&(this.nowProgress++,this.nowProgress2=0,p=this.nowProgress/this.maxProgress,this.progressBar2.width=p*this.maxWidth,this.proLabel2.text=Math.floor(100*p)+"%",this.proLabel.text=text,this.nowProgress==this.maxProgress)&&Laya.timer.once(1e4,this,this.open)},Loading.prototype.upProgress2=function(){this.nowProgress2<99&&(this.nowProgress2++,this.progressBar1.width=this.nowProgress2/100*this.maxWidth,this.proLabel1.text=this.nowProgress2+"%")},Loading.prototype.open=function(){this.destroy(),MainResetStage()},Loading.prototype.onEven=function(){},Loading.prototype.destroy=function(){Laya.timer.clearAll(this),loadView=null,_super.prototype.destroy.call(this,!0)},Loading}(WeChatUI.LoadingViewUI);WeChatUI.Loading=Loading}(WeChatUI=WeChatUI||{}),"8891"),cdn="https://h5test.s1.l2i.cc/wx",tsCdn="https://h5test.s1.l2i.cc/wx",devCdn="https://h5test.s1.l2i.cc/wx";!function(WeChatUI){var Event=Laya.Event,Login=function(_super){function Login(){var _this=_super.call(this)||this;return _this.sdkLoginNumber=3,_this.gameLoginNumber=3,_this.init(),_this.onEven(),_this}return __extends(Login,_super),Login.prototype.init=function(){var _this=this;this.sdkLoginNumber=3,this.gameLoginNumber=3,this.prompt.visible=!1,this.centerY=0,this.verText.text="游戏版本："+gameVersion,QCSDK.init({game_ver:gameVersion},function(data){cdn=1==data.develop?tsCdn:devCdn,console.log("kkk sdk初始化完成  调起sdk登录"),QCSDK.login(_this.sdkLoginBack.bind(_this))}),this.serverPanel.vScrollBar.visible=!1,this.noticePanel.vScrollBar.visible=!1,this.serverList._scrollBar.visible=!1,this.serverGroup.selectHandler=Laya.Handler.create(this,this.choose,null,!1),this.serverList.renderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.serverList.selectHandler=Laya.Handler.create(this,this.chooseServer,null,!1),this.serverList.selectEnable=!0,this.noticeContent.color=this.nonageContent.color="#666699",this.noticeContent.style.fontSize=this.nonageContent.style.fontSize=22,this.noticeContent.style.fontFamily=this.nonageContent.style.fontFamily="SimHei",this.noticeContent.style.lineHeight=this.nonageContent.style.lineHeight=26,this.nonageContent.innerHTML=NONAGE_TEXT,this.nonageTitle.text="适龄提示",this.noticeTab.selectHandler=Laya.Handler.create(this,this.chooseNotice,null,!1)},Login.prototype.sdkLoginBack=function(status,data){var j;console.log("kkk sdk 登录返回："+status),0==status?((j={partner_id:4,game_pkg:"lmfbs1_mhdlxyx_M",platform:"minGame"}).user_id=data.userid,j.token=data.token,data=encodeURIComponent(JSON.stringify(j)),(j=new Laya.HttpRequest).send(WeChatUI.Config.backstage_url+"game/login/"+pack+"/"+data,null,"get"),j.once(Laya.Event.COMPLETE,this,this.loginCallBack.bind(this))):(this.sdkLoginNumber--,0<this.sdkLoginNumber?QCSDK.login(this.sdkLoginBack.bind(this)):(this.prompt.text="SDK 登陆失败，CODE:"+status,this.prompt.visible=!0))},Login.prototype.loginCallBack=function(data){var JiaData,server;(data=JSON.parse(data))?200===data.errCode?(JiaData=new WeChatUI.UserData,server=(data=data.data).s,JiaData.account=data.user.openId,JiaData.uid=data.user.openId,JiaData.channel=data.channel,JiaData.package=data.package,JiaData.mac="",data.cdn&&""!=data.cdn?JiaData.cdn=data.cdn:JiaData.cdn=cdn,JiaData.rvtype=0,JiaData.newregister=data.newregister,JiaData.sign=data.sign,server={server_id:server.server_id,name:server.name,server_num:parseInt(server.server_num),channel_num:parseInt(server.channel_num),server_addr:server.server_addr,server_port:parseInt(server.server_port),status:parseInt(server.status),tick:parseInt(server.tick),sign:server.sign,package:parseInt(data.package),cdn:""},JiaData.selected_server=server,userData=JiaData,console.log("kk",userData),1==userData.newregister?this.login():(this.upSelectedServer(),this.serverName.visible=this.serverBtn.visible=this.stateImg.visible=this.huanqu.visible=this.notice.visible=this.nonage.visible=this.loginBtn.visible=!0,this.getNotice())):(this.gameLoginNumber--,0<this.gameLoginNumber?QCSDK.login(this.sdkLoginBack.bind(this)):(this.prompt.text="游戏服登陆失败，CODE:"+data.errCode,this.prompt.visible=!0)):(this.gameLoginNumber--,0<this.gameLoginNumber?QCSDK.login(this.sdkLoginBack.bind(this)):(this.prompt.text="游戏服登陆失败，返回数据为空",this.prompt.visible=!0))},Login.prototype.onEven=function(){this.serverBtn.on(Event.CLICK,this,this.openDialog,[0]),this.closeSever.on(Event.CLICK,this,this.closeDialog,[0]),this.serverBG.on(Event.CLICK,this,this.closeDialog,[0]),this.nonage.on(Event.CLICK,this,this.openDialog,[1]),this.closeNonage.on(Event.CLICK,this,this.closeDialog,[1]),this.nonageBG.on(Event.CLICK,this,this.closeDialog,[1]),this.notice.on(Event.CLICK,this,this.openDialog,[2]),this.closeNotice.on(Event.CLICK,this,this.closeDialog,[2]),this.noticeBG.on(Event.CLICK,this,this.closeDialog,[2]),this.loginBtn.on(Event.CLICK,this,this.login)},Login.prototype.openDialog=function(type){0==type?(this.serverPanel.visible=!1,this.serverList.visible=!1,this.serverBox.visible=!0,this.req_server_list()):1==type?this.nonageBox.visible=!0:2==type&&this.openNotice(0)},Login.prototype.closeDialog=function(type){0==type?this.serverBox.visible=!1:1==type?this.nonageBox.visible=!1:2==type&&(this.noticeBox.visible=!1)},Login.prototype.login=function(){var loading=new WeChatUI.Loading;Laya.stage.addChild(loading),this.destroy()},Login.prototype.choose=function(index){this.serverList.array=this.serverArr[index]},Login.prototype.chooseServer=function(index){userData.selected_server=this.serverArr[this.serverGroup.selectedIndex][index],this.upSelectedServer(),this.serverBox.visible=!1},Login.prototype.onListRender=function(item,index){var label=item.getChildByName("itemServerName"),item=item.getChildByName("itemServerState"),index=this.serverArr[this.serverGroup.selectedIndex][index];label.text=index.name,2===index.status?item.skin="login/image_xfy_ct.png":1===index.status?item.skin="login/image_xfy_fm.png":-1===index.status&&(item.skin="login/image_xfy_wh.png")},Login.prototype.req_server_list=function(){var str=base64_encode("game/allServer/"+userData.channel+"/"+userData.package+"/"+userData.account+"/"+userData.rvtype+"/"+userData.sign),hppt=new Laya.HttpRequest;hppt.send(WeChatUI.Config.backstage_url+str,null,"get"),hppt.once(Laya.Event.COMPLETE,this,this.serverListBack)},Login.prototype.serverListBack=function(data){if((data=JSON.parse(data)).errCode){for(var i=0;i<data.z.length;i++)this.serverGroupArr=0!=i?this.serverGroupArr+","+data.z[i]:""+data.z[i];this.serverArr=data.s,this.serverGroup.labels=this.serverGroupArr,this.serverGroup.selectedIndex=0,this.serverList.array=this.serverArr[0],this.serverPanel.visible=!0,this.serverList.visible=!0}},Login.prototype.upSelectedServer=function(){this.serverName.text=userData.selected_server.name,2===userData.selected_server.status?this.stateImg.skin="login/image_xfy_ct.png":1===userData.selected_server.status?this.stateImg.skin="login/image_xfy_fm.png":-1===userData.selected_server.status&&(this.stateImg.skin="login/image_xfy_wh.png")},Login.prototype.getNotice=function(){var data={groupId:GROUP_ID},hppt=new Laya.HttpRequest;hppt.send(WeChatUI.Config.notice_url,data,"post"),hppt.once(Laya.Event.COMPLETE,this,this.noticeBack)},Login.prototype.noticeBack=function(data){if(0!=(data=JSON.parse(data)).code)this.noticeData=[{title:"公告",contents:"暂无公告",version:0}];else if(this.noticeData=data.data,0==this.noticeData.length)this.noticeData=[{title:"公告",contents:"暂无公告",version:0}];else{for(var openIndex=-1,i=0;i<this.noticeData.length&&3!=i;i++){this.noticTitles=0==i?this.noticeData[i].title:this.noticTitles+","+this.noticeData[i].title;var ver=Number(localStorage.getItem("NoticeVersion"+i));null==ver&&(ver=-1),-1==openIndex&&ver<this.noticeData[i].version&&(openIndex=i)}1!=userData.newregister&&-1!=openIndex&&(this.openNotice(openIndex),localStorage.setItem("NoticeVersion"+openIndex,this.noticeData[openIndex].version+""))}},Login.prototype.chooseNotice=function(index){this.noticeContent.innerHTML=this.htmlDecodeByRegExp(this.noticeData[index].contents),this.noticeTitle.text=this.noticeData[index].title},Login.prototype.openNotice=function(index){this.noticeBox.visible=!0,this.noticeData.length<2?this.noticeTab.visible=!1:(this.noticeTab.labels=this.noticTitles,this.noticeTab.visible=!0,this.noticeTab.selectedIndex=index,2==this.noticeData.length?this.noticeTab.skin="login/noticeBtn2.png":this.noticeTab.skin="login/noticeBtn3.png"),this.noticeContent.innerHTML=this.htmlDecodeByRegExp(this.noticeData[index].contents),this.noticeTitle.text=this.noticeData[index].title},Login.prototype.htmlDecodeByRegExp=function(str){return 0==str.length?"":str.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&mdash;/g,"——")},Login.prototype.destroy=function(){this.closeSever.off(Event.CLICK,this,this.closeDialog),this.serverBG.off(Event.CLICK,this,this.closeDialog),this.closeNonage.off(Event.CLICK,this,this.closeDialog),this.nonageBG.off(Event.CLICK,this,this.closeDialog),this.closeNotice.off(Event.CLICK,this,this.closeDialog),this.noticeBG.off(Event.CLICK,this,this.closeDialog),this.serverBtn.off(Event.CLICK,this,this.openDialog),this.nonage.off(Event.CLICK,this,this.openDialog),this.notice.off(Event.CLICK,this,this.openDialog),this.loginBtn.off(Event.CLICK,this,this.login),this.serverGroup.selectHandler.clear(),this.serverGroup.selectHandler=null,this.serverList.renderHandler.clear(),this.serverList.renderHandler=null,this.serverList.selectHandler.clear(),this.serverList.selectHandler=null,this.noticeTab.selectHandler.clear(),this.noticeTab.selectHandler=null,_super.prototype.destroy.call(this,!0)},Login}(WeChatUI.LoginViewUI);function onLoadedComplete(){var login=new Login;Laya.stage.addChild(login)}WeChatUI.Login=Login,Laya.MiniAdpter.init(),Laya.init(720,1280,Laya.WebGL),Laya.stage.scaleMode=laya.display.Stage.SCALE_FIXED_AUTO,Laya.stage.screenMode=Laya.Stage.SCREEN_NONE,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,Laya.loader.load("res/atlas/login.atlas",Laya.Handler.create(null,onLoadedComplete))}(WeChatUI=WeChatUI||{}),function(WeChatUI){function ServerInfo(){}function NoticeData(){}WeChatUI.UserData=function(){},WeChatUI.ServerInfo=ServerInfo;WeChatUI.NoticeData=NoticeData}(WeChatUI=WeChatUI||{});