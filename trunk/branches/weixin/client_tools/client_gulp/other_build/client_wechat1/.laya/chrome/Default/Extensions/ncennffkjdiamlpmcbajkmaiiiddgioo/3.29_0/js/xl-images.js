!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){var n=function(){};function i(e){var t=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(t+=performance.now()),"xxxxxxxxxxxxxxx".replace(/[x]/g,function(e){var n=(t+36*Math.random())%36|0;return t=Math.floor(t/36),rc=("x"===e?n:3&n|8).toString(36),Math.random()>.5?rc:rc.toUpperCase()})+e}n.prototype.attachEvent=function(e,t,n,i){if(this[t]||(this[t]=[]),!(this[t]instanceof Array))return!1;for(var a=0;a<this[t].length;a++)if(this[t][a].o==e&&this[t][a].f==n)return!0;return this[t].push({o:e,f:n,t:i}),!0},n.prototype.detachEvent=function(e,t,n){if(!(this[t]&&this[t]instanceof Array))return!1;for(var i=0;i<this[t].length;i++)if(this[t][i].o==e&&this[t][i].f==n)return this[t].splice(i,1),0==this[t].length&&delete this[t],!0;return!1},n.prototype.fireEvent=function(e){if(!(this[e]&&this[e]instanceof Array))return!1;for(var t=[].slice.call(arguments),n=this[e].slice(0),i=!1,a=0;a<n.length&&("number"==typeof n[a].t?n[a].f.delayApply(n[a].t,n[a].o,t.slice(1)):i|=n[a].f.apply(n[a].o,t.slice(1)),!i);a++);return i},e.exports={EventContainer:n,generalWebPeerId:i,getWebPeerId:function(e,t){chrome.storage.local.get("__XLWebPeerId__",function(n){if(n&&n.__XLWebPeerId__)t(n.__XLWebPeerId__);else{var a=i(e);chrome.storage.local.set({__XLWebPeerId__:a}),t(a)}})},versionCompare:function(e,t){var n=e.split("."),i=t.split("."),a=Math.min(n.length,i.length),r=null;for(let e=0;e<a;e++){if(n[e]<i[e]){r=-1;break}if(n[e]>i[e]){r=1;break}e===a&&n[e]===i[e]&&(r=0)}return r},Ajax:function(e){(e=e||{}).data=e.data||{};var t=e.jsonp?jsonp(e):t(e);function t(e){e.type=(e.type||"GET").toUpperCase(),e.data=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(e.data);var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState){var n=t.status;if(n>=200&&n<300){var i="",a=t.getResponseHeader("Content-type");i=-1!==a.indexOf("xml")&&t.responseXML?t.responseXML:-1!==a.toLowerCase().indexOf("application/json")?JSON.parse(t.responseText):t.responseText,e.success&&e.success(i)}else e.error&&e.error(n)}},"GET"==e.type?(e.data.length>0?t.open(e.type,e.url+"?"+e.data,!0):t.open(e.type,e.url,!0),t.send(null)):(t.open(e.type,e.url,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.send(e.data))}}}},function(e,t,n){e.exports=n(2)},function(e,t,n){var i,a,r,s,l,{stat:o}=n(3);i=/\s+/,a="ncennffkjdiamlpmcbajkmaiiiddgioo",r="",s={addClass(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(i).forEach(function(t){return e.classList.add(t)}):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}},toogleClass(e,t){(" "+(e.getAttribute("class")||"")+" ").indexOf(" "+t+" ")<0?this.addClass(e,t):this.removeClass(e,t)},hasClass:(e,t)=>0!=(t=t||"").replace(/\s/g,"").length&&new RegExp(" "+t+" ").test(" "+e.className+" "),removeClass(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(i).forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{for(var n=" "+(e.getAttribute("class")||"")+" ",a=" "+t+" ";n.indexOf(a)>=0;)n=n.replace(a," ");(n=n.trim())?e.setAttribute("class",n):e.removeAttribute("class")}},request:(e,t="GET")=>new Promise((n,i)=>{var a=new XMLHttpRequest;a.onload=function(e){var t=a.response,i=this.getResponseHeader("content-type")||"其他";n({type:i,data:t})},a.onerror=(e=>{i(e)}),a.open(t,e),a.send()}),debounce(e,t){let n=null;return function(){let i=this,a=arguments;n&&clearTimeout(n),n=setTimeout(function(){e.apply(i,a)},t)}}},(l=function(e){this.config=Object.assign({},this.config,e),this.render()}).prototype.config={min:0,max:100,value:0,range:!1,disabled:!1,theme:"#009688",step:1},l.prototype.render=function(e){var t=this.config,n=document.createElement("div");if(n.className="xl-slider",t.step<1&&(t.step=1),t.max<t.min&&(t.max=t.min+t.step),t.range){t.value="object"==typeof t.value?t.value:[t.min,t.value];var i=Math.min(t.value[0],t.value[1]),a=Math.max(t.value[0],t.value[1]);t.value[0]=i>t.min?i:t.min,t.value[1]=a>t.min?a:t.min,t.value[0]=t.value[0]>t.max?t.max:t.value[0],t.value[1]=t.value[1]>t.max?t.max:t.value[1];var r=Math.floor((t.value[0]-t.min)/(t.max-t.min)*100),s=Math.floor((t.value[1]-t.min)/(t.max-t.min)*100),l=s-r+"%";r+="%",s+="%"}else"object"==typeof t.value&&(t.value=Math.min.apply(null,t.value)),t.value<t.min&&(t.value=t.min),t.value>t.max&&(t.value=t.max),l=Math.floor((t.value-t.min)/(t.max-t.min)*100)+"%";var o=t.disabled?"#c2c2c2":t.theme,c=`<div class="xl-slider-bar" style="background:${o};width:${l};left:${r||0};"></div>\n       <div class="xl-slider-wrap" style="left:${r||l};">\n        <div class="xl-slider-wrap-btn" style="border: 2px solid ${o};"></div>\n        <div class="xl-slider-wrap-value">${t.range?t.value[0]:t.value}</div>\n       </div>\n      ${t.range?`<div class="xl-slider-wrap" style="left: ${s};">\n             <div class="xl-slider-wrap-btn" style="border: 2px solid ${o};"></div>\n             <div class="xl-slider-wrap-value">${t.value[1]}</div>\n            </div>`:""}\n       </div>`;n.innerHTML=c,this.container=document.querySelector(t.elem),this.container.appendChild(n),this.sliderInner=this.container.querySelector(".xl-slider"),this.sliderBar=this.container.querySelector(".xl-slider-bar"),this.sliderBtnWrap=this.container.querySelectorAll(".xl-slider-wrap"),t.range?(this.sliderBtnWrap[0].dataset.value=t.value[0],this.sliderBtnWrap[1].dataset.value=t.value[1]):this.sliderBtnWrap[0].dataset.value=t.value,this.slide()},l.prototype.slide=function(e,t,n){var i=this,a=i.config,r=i.sliderInner,s=function(){return r.offsetWidth},l=i.sliderBtnWrap,o=0,c=100,d=1,u=100/((a.max-a.min)/Math.ceil(a.step)),h=function(e,t){if(e=function(e){return(e=Math.ceil(e)*u>100?Math.ceil(e)*u:Math.round(e)*u)>100?100:e}(e),0===t?o=e:c=e,!(c-o<=0)){l[t].style.left=e+"%",l[t].style.zIndex=d++;var n=f(l[0].offsetLeft),r=a.range?f(l[1].offsetLeft):0;n=n>100?100:n,r=r>100?100:r;var s=Math.min(n,r),h=Math.abs(r-n);i.sliderBar.style.width=h+"%",i.sliderBar.style.left=s+"%";var p=a.min+Math.round((a.max-a.min)*e/100);if(l[t].dataset.value=p,v(t,p),a.range){var m=[+l[0].dataset.value,+l[1].dataset.value];m[0]>m[1]&&m.reverse()}a.change&&a.change(a.range?m:p)}},f=function(e){var t=e/s()*100/u,n=Math.round(t)*u;return e==s()&&(n=Math.ceil(t)*u),n},v=function(e,t){var n=l[e].querySelector(".xl-slider-wrap-value");n.innerText=t;var a=l[1].querySelector(".xl-slider-wrap-value").getBoundingClientRect(),s=l[0].querySelector(".xl-slider-wrap-value").getBoundingClientRect(),o=a.left-s.left-s.width,c=r.getBoundingClientRect();if(o<5||o<0){var d=i.container.querySelector(`.xl-slider-temp-value${e}`);d||((d=document.createElement("div")).className=`xl-slider-temp-value${e}`,d.innerText=t,r.appendChild(d),n.style.visibility="hidden"),d.style.left=0===e?a.left-a.width/2-c.left-5+"px":s.right+a.width/2-c.left+5+"px",d.innerText=t}else{minDistance=0;var u=i.container.querySelector(".xl-slider-temp-value0"),h=i.container.querySelector(".xl-slider-temp-value1");u&&(r.removeChild(u),l[0].querySelector(".xl-slider-wrap-value").style.visibility="visible"),h&&(r.removeChild(h),l[1].querySelector(".xl-slider-wrap-value").style.visibility="visible")}};if("set"===e)return h(t,n);i.sliderBtnWrap.forEach((e,t)=>{var n=e.querySelector(".xl-slider-wrap-btn");n.addEventListener("mousedown",function(e){e=e||window.event;var i=n.parentNode.offsetLeft,a=e.clientX;!function(e,t){var n=document.getElementById("LAY-slider-moving");if(!n){var i=document.createElement("div");i.id="LAY-slider-moving",i.className="xl-auxiliar-moving",document.body.appendChild(i),n=document.getElementById("LAY-slider-moving")}var a=function(){t&&t(),n.parentNode.removeChild(n)};n.addEventListener("mousemove",e),n.addEventListener("mouseup",a),n.addEventListener("mouseleave",a)}(function(e){e=e||window.event;var n=i+e.clientX-a;n<0&&(n=0),n>s()&&(n=s());var r=n/s()*100/u;h(r,t),e.preventDefault()},function(){})})}),r.addEventListener("click",function(e){var t,n=this.getBoundingClientRect(),i=e.clientX-n.left;i<0&&(i=0),i>s()&&(i=s());var r=i/s()*100/u;t=a.range&&Math.abs(i-l[0].offsetLeft)>Math.abs(i-l[1].offsetLeft)?1:0,h(r,t),e.preventDefault()})},l.prototype.onChange=function(e){this.config.change=s.debounce(e,100)},l.prototype.setValue=function(e,t){return this.config.value=e,this.slide("set",e,t||0)},window.onload=function(){var e=document.querySelector("#selected"),t=document.querySelector("#total"),n=document.querySelector("#pictureWrap"),i=document.querySelector("#pictureType"),c=document.querySelector(".xl-button"),d=!0,u=0,h=0,f=[],v=[],p=[{type:"默认",key:"all",count:0,select:d},{type:"JPEG",key:"JPEG",count:0,select:!1},{type:"PNG",key:"PNG",count:0,select:!1},{type:"GIF",key:"GIF",count:0,select:!1},{type:"其他",key:"other",count:0,select:!1}],m=[];function g(a){m=a.filter(e=>(e.select=d,!(/^data:/.test(e.src)||e.naturalWidth<=1||e.naturalHeight<=1))),p[0].count=m.length,x(n,!0),y(i);var g=new l({elem:"#widthSlider",min:0,max:u,value:[0,u],range:!0,theme:"#2670ea"}),C=new l({elem:"#heightSlider",min:0,max:h,value:[0,h],range:!0,theme:"#2670ea"});f=[0,u],v=[0,h],g.onChange(t=>{f=t;var i=b({width:t,height:v});e.textContent=i.length,x(n)}),C.onChange(t=>{v=t;var i=b({width:f,height:t});e.textContent=i.length,x(n)}),t.textContent="总共"+p[0].count+"个",e.textContent=b().length,n.addEventListener("click",t=>{!function(t){if(t&&"LI"===t.tagName){s.toogleClass(t,"is-checked"),s.toogleClass(t,"is-disabled");var n=t.dataset.id;m[n].select=!m[n].select,e.textContent=b().length}}(t.target)}),i.addEventListener("click",t=>{!function(t){if(t&&["SPAN","SUP"].includes(t.tagName)){var a=t;if("SUP"===t.tagName&&(a=t.parentNode),!s.hasClass(a,"is-disabled")){s.toogleClass(a,"is-checked");var r=a.dataset.id;if(p[r].select=!p[r].select,"0"===r){if(p[r].select){var l=i.querySelectorAll("span");[...l].slice(1).forEach((e,t)=>{s.removeClass(e,"is-checked"),p[t+1].select=!1})}}else if(p[r].select){var l=i.querySelectorAll("span");s.removeClass(l[0],"is-checked"),p[0].select=!1}e.textContent=b({width:f,height:v}).length,x(n)}}}(t.target)}),c.addEventListener("click",e=>{s.hasClass(c,"disable")||function(e){if(e.length){chrome.extension.sendMessage({name:"xl_download_multi",referurl:r,urls:e.map(e=>e.src).filter(e=>0===e.indexOf("http"))});var t=p.filter(e=>e.select).map(e=>e.key);o(1022,933,`value1=${e.length}&value2=${p[0].count}&value5=${t.join(",")}&value6=(${f.join("-")})*(${v.join("-")})`)}else alert("请选择您需要下载的图片! ")}(b())}),o(1022,932)}function y(e){var t=document.createDocumentFragment();p.forEach((e,n)=>{var i=document.createElement("span");i.dataset.id=n,e.select&&s.addClass(i,"is-checked"),i.innerHTML=e.type+(e.count?` <sup>${e.count}</sup>`:""),t.appendChild(i)}),e.innerHTML="",e.appendChild(t)}function x(e,t=!1){if(e)if(t){var n=document.createDocumentFragment();m.forEach((e,t)=>{var i=document.createElement("li"),r=document.createElement("img"),l=document.createElement("p");-1===e.src.indexOf("?")?r.src=e.src+`?${a}=${Date.now()}`:r.src=e.src+`&${a}=${Date.now()}`,e.select&&s.addClass(i,"is-checked");let o=e.naturalWidth,c=e.naturalHeight;(o>250||c>250)&&(o>c?c=(o=o>250?250:o)/(e.naturalWidth/e.naturalHeight):(c=c>250?250:c,o=e.naturalWidth/e.naturalHeight*c)),r.width=o,r.height=c,e.naturalWidth>u&&(u=e.naturalWidth),e.naturalHeight>h&&(h=e.naturalHeight),l.textContent=`${e.naturalWidth}x${e.naturalHeight}`,i.appendChild(r),i.appendChild(l),i.dataset.id=t,n.appendChild(i)}),e.innerHTML="",m.length&&e.appendChild(n)}else{var i=e.querySelectorAll("li img");m.forEach((e,t)=>{if(i&&i[t]){var n=i[t].parentNode;e.select?(s.removeClass(n,"hidden"),s.removeClass(n,"is-disabled"),s.addClass(n,"is-checked")):(s.addClass(n,"hidden"),s.addClass(n,"is-disabled"),s.removeClass(n,"is-checked"))}})}}function b(e){var t=p.filter(e=>e.select).map(e=>e.type);const n=t.includes("默认");var i=m.filter(i=>{var a=!!n||t.includes(i.type),r=i.select,s=i.select;return e&&e.width&&(r=e.width[0]<=i.naturalWidth&&i.naturalWidth<=e.width[1]),e&&e.height&&(s=e.height[0]<=i.naturalHeight&&i.naturalHeight<=e.height[1]),i.select=r&&s&&a,i.select});return i.length?s.removeClass(c,"disable"):s.addClass(c,"disable"),i}!function(){let e=new URL(location.href);do{if(!e||!e.searchParams)break;let t=e.searchParams.get("tabId");if(!t)break;if(t=Number(t),isNaN(t))break;chrome.tabs.get(t,e=>{if(!e)return;r=e.url,chrome.tabs.onRemoved.addListener(function(e,n){e===t&&window.close()});let n="("+function(){let e=[];for(let t of document.images)t.src&&e.push({src:t.src,width:t.width,height:t.height,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight});return e}.toString()+")()";chrome.tabs.executeScript(t,{code:n},e=>{e=e?e[0]:[];let t={},n=[];for(let i of e)t[i.src]||(t[i.src]=!0,n.push(i));g(n)})})}while(0)}(),window.xlMultiPicUpdateDetail=function(e){!function(e,t){var n=m.filter(t=>e.indexOf(t.src)>-1),a=t.find(e=>"content-type"===e.name||"Content-Type"===e.name);if(n)for(let t of n){var r=a?a.value.split("/")[1].toLocaleUpperCase():"其他";"JPG"===r&&(r="JPEG");var s=p.find(e=>e.type===r);if(s){var l=t.src.slice(t.src.lastIndexOf(".")+1),o=r.toLocaleLowerCase(),c=l.toLocaleLowerCase();c!==o&&("jpg"===c&&"jpeg"===o?t.src=t.src:t.src+="."+o)}else r=e.indexOf("gif")>-1?"GIF":"其他",s=p.find(e=>e.type===r);t.type=r,s.count+=1,y(i)}}(e.url,e.responseHeaders)}}},function(e,t,n){var{getWebPeerId:i,Ajax:a}=n(0),{XLNativeMessage:r}=n(4),s=void 0,l=function(e,t,n,i,r,l,o){var c="http://stat.download.xunlei.com:8099/?xlbtid=1&aid="+e+"&id="+t+"&peerid="+r+"&userid=&referfrom=100001&OS=win&OSversion="+l+"&productname=ThunderX&productversion="+i+"&value3="+s+"&value4="+o;n&&n.length>0&&(c+="&"+n),a({url:c,type:"GET",success:function(e){},error:function(e){}})},o=function(e,t,n){r.postMessage("GetThunderInfo",[],void 0,function(a,r,s){if(a){var o=r[0].peerId,c=r[0].osVersion,d=r[0].thunderVersion,u=r[0].parentProcess;l(e,t,n,d,o,c,u)}else i("Q",function(i){l(e,t,n,"",i,"","")})})};e.exports={stat:function(e,t,n){s?o(e,t,n):a({url:chrome.extension.getURL("manifest.json"),type:"GET",success:function(i){s=i.version,o(e,t,n)},error:function(e){}})}}},function(e,t,n){var{EventContainer:i}=n(0);function a(){this.nativePort=null,this.eventContainer=new i,this.selfQuit=!1,this.callbackMap={},this.callbackIdIndex=1,this.disconnectTimer=void 0}a.prototype={onNativeMessage:function(e){var t=e.callbackId;if(t){var n=this.callbackMap[t];n&&(n.f.apply(n.o,[!0,e.result,e.paramters]),delete this.callbackMap[t])}this.eventContainer.fireEvent("OnNativeMessage",e)},onDisconnect:function(){if(this.nativePort=null,this.callbackMap)for(let t in this.callbackMap)if(t){var e=this.callbackMap[t];e&&(e.f.apply(e.o,[!1]),delete this.callbackMap[t])}this.eventContainer.fireEvent("OnDisconnect",this.selfQuit)},attachConnectEvent:function(e,t){this.eventContainer.attachEvent(e,"OnConnect",t)},attachDisconnectEvent:function(e,t){this.eventContainer.attachEvent(e,"OnDisconnect",t)},attachNativeMessage:function(e,t){this.eventContainer.attachEvent(e,"OnNativeMessage",t)},postMessage:function(e,t,n,i){var a=!0;do{if(null==this.nativePort&&this.connect(),!this.nativePort){a=!1;break}var r=void 0;i&&(r=this.callbackIdIndex++);var s={funcName:e,paramters:t,callbackId:r};try{this.nativePort.postMessage(s)}catch(e){a=!1;break}i&&(this.callbackMap[r]={o:n,f:i}),this.delayDisconnect()}while(0);return a||i&&i.apply(n,[!1]),a},sendQuit:function(){this.nativePort&&(this.selfQuit=!0,this.postMessage("ChromeQuit",[]),this.nativePort=null),this.disconnectTimer&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0)},isConnected:function(){return!!this.nativePort},delayDisconnect:function(){var e=this;this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=setTimeout(function(){e.disconnectTimer=void 0,e.sendQuit()},5e3)},connect:function(){var e=!1;do{if(this.nativePort){e=!0;break}if(this.nativePort=chrome.runtime.connectNative("com.xunlei.thunder"),null==this.nativePort){this.eventContainer.fireEvent("OnConnect",!1);break}var t=this;this.nativePort.onMessage.addListener(function(e){t.onNativeMessage(e)}),this.nativePort.onDisconnect.addListener(function(){if(chrome.runtime.lastError){let e=chrome.runtime.lastError.message;e&&e.toLowerCase()==="Access to the specified native messaging host is forbidden.".toLowerCase()&&(t.selfQuit=!1)}t.onDisconnect()}),this.eventContainer.fireEvent("OnConnect",!0),e=!0,this.delayDisconnect()}while(0);return e}};var r=new a;e.exports={XLNativeMessage:r}}]);
//# sourceMappingURL=xl-images.js.map