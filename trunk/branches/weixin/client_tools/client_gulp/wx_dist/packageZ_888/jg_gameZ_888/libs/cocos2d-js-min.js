!function(s,o,t){function a(t,e){if(!(r=o[t])){var i=s[t];if(!i)return;var n={},r=o[t]={exports:n};i[0](function(t){return a(i[1][t]||t)},r,n)}return r.exports}for(var e=0;e<t.length;e++)a(t[e])}({1:[function(t,e,i){e.exports={1001:"cocos2d: removeAction: Target not found",1002:"cc.ActionManager.removeActionByTag(): an invalid tag",1003:"cc.ActionManager.removeActionByTag(): target must be non-null",1004:"cc.ActionManager.getActionByTag(): an invalid tag",1005:"cocos2d : getActionByTag(tag = %s): Action not found",1006:"[Action step]. override me",1007:"[Action update]. override me",1008:"cocos2d: FiniteTimeAction#reverse: Implement me",1009:"cc.EaseElastic.reverse(): it should be overridden in subclass.",1010:"cc.IntervalAction: reverse not implemented.",1011:"cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.",1012:"cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.",1013:"The speed parameter error",1014:"The repeat parameter error",1015:"parameters should not be ending with null in Javascript",1016:"cc.RotateTo.reverse(): it should be overridden in subclass.",1019:"Failed to construct, Sequence construction needs two or more actions.",1020:"Failed to construct, Spawn construction needs two or more actions.",1021:"cc.Speed.initWithAction(): action must be non nil",1022:"cc.Follow.initWithAction(): followedNode must be non nil",1023:"cc.ActionEase.initWithAction(): action must be non nil",1024:"Invalid configuration. It must at least have one control point",1025:"cc.Sequence.initWithTwoActions(): arguments must all be non nil",1026:"cc.RepeatForever.initWithAction(): action must be non null",1027:"cc.Spawn.initWithTwoActions(): arguments must all be non null",1028:"cc.ReverseTime.initWithAction(): action must be non null",1029:"cc.ReverseTime.initWithAction(): the action was already passed in.",1030:"cc.Animate.initWithAnimation(): animation must be non-NULL",1031:"Illegal parameter get passed in cc.tween: %s.",1100:"Expected 'data' dict, but not found. Config file: %s",1101:"Please load the resource first : %s",1200:"cocos2d: Director: Error in gettimeofday",1201:"cocos2d: Director: unrecognized projection",1203:"cocos2d: Director: Error in gettimeofday",1204:"running scene should not null",1205:"the scene should not null",1206:"loadScene: The scene index to load (%s) is out of range.",1207:"loadScene: Unknown name type to load: '%s'",1208:"loadScene: Failed to load scene '%s' because '%s' is already being loaded.",1209:"loadScene: Can not load the scene '%s' because it was not in the build settings before playing.",1210:"Failed to preload '%s', %s",1211:"loadScene: The scene index to load (%s) is out of range.",1212:"loadScene: Unknown name type to load: '%s'",1213:"loadScene: Failed to load scene '%s' because '%s' is already loading",1214:"loadScene: Can not load the scene '%s' because it was not in the build settings before playing.",1215:"Failed to preload '%s', %s",1216:"Director.runSceneImmediate: scene is not valid",1300:"element type is wrong!",1400:"'%s' is deprecated, please use '%s' instead.",1404:"cc.spriteFrameCache is removed, please use cc.loader to load and cache sprite frames of atlas format.",1405:"The '%s' has been removed, please use '%s' instead.",1406:"'%s.%s' is removed",1408:"'%s' is not support in the '%s', please use '%s' instead.",1502:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",1503:"cc.Scheduler.pauseTarget():target should be non-null",1504:"cc.Scheduler.resumeTarget():target should be non-null",1505:"cc.Scheduler.isTargetPaused():target should be non-null",1506:"warning: you CANNOT change update priority in scheduled function",1507:'CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %s to %s"',1508:"Argument callback must not be empty",1509:"Argument target must be non-nullptr",1510:"cc.Scheduler: Illegal target which doesn't have uuid or instanceId.",1511:"cc.Scheduler: pause state of the scheduled task doesn't match the element pause state in Scheduler, the given paused state will be ignored.",1513:"cc.Scheduler: scheduler stopped using `__instanceId` as id since v2.0, you should do scheduler.enableForTarget(target) before all scheduler API usage on target",1605:"child already added. It can't be added again",1606:"child must be non-null",1610:"cocos2d: removeChildByTag(tag = %s): child not found!",1612:"cc.Node.stopActionBy(): argument tag an invalid tag",1613:"cc.Node.getActionByTag(): argument tag is an invalid tag",1617:"child must be non-null",1618:"cc.Node.runAction(): action must be non-null",1619:"callback function must be non-null",1620:"interval must be positive",1623:"Set '%s' to normal node (not persist root node).",1624:"Replacing with the same sgNode",1625:"The replacement sgNode should not contain any child.",1626:"Should not set alpha via 'color', set 'opacity' please.",1627:"Not support for asynchronous creating node in SG",1632:"Node name can not include '/'.",1633:"Internal error, should not remove unknown node from parent.",1634:"addChild: The child to add must be instance of cc.Node, not %s.",1635:"reorderChild: this child is not in children list.",1636:"Node's zIndex value can't be greater than cc.macro.MAX_ZINDEX, setting to the maximum value",1637:"Node's zIndex value can't be smaller than cc.macro.MIN_ZINDEX, setting to the minimum value",1638:"Private node's zIndex can't be set, it will keep cc.macro.MIN_ZINDEX as its value",1639:"cc.Action is deprecated now, please use cc.TweenAction instead",1800:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",1801:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",1802:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",1803:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",1900:"Invalid parameter.",2e3:"Don't call this method if the event is for touch.",2200:"Resolution not valid",2201:"should set resolutionPolicy",2300:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",2400:"WebGL error %s",2602:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",2603:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",2606:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",2607:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",2608:"%s is null, please check.",2609:"cc.Sprite.initWithFile(): filename should be non-null",2610:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",2614:"cc.Sprite.addChild(): child should be non-null",2616:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",2617:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",2618:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",2619:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",2623:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",2625:"too many tiles, only 16384 tiles will be show",2626:"Unrecognized fill type in bar fill",2627:"Can not generate quad",2628:"%s does not exist",2712:"Invalid spriteFrameName",3005:"cocos2d: '%s' id=%s %s x %s",3006:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",3007:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",3103:"cc.Texture.addImage(): path should be non-null",3112:"cc.Texture.addImage(): path should be non-null",3113:"NSInternalInconsistencyException",3116:"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures",3117:"Mimpap texture only works in POT textures",3119:"Lazy init texture with image element failed due to image loading failure: %s",3120:"Loading texture from '%s' with unsupported type: '%s'. Add '%s' into 'cc.macro.SUPPORT_TEXTURE_FORMATS' please.",3300:"Rect width exceeds maximum margin: %s",3400:"Rect height exceeds maximum margin: %s",3500:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",3501:"Invalid listener type!",3502:"Can't set fixed priority with scene graph based listener.",3503:"Invalid parameters.",3504:"listener must be a cc.EventListener object when adding a fixed priority listener",3505:"The listener has been registered, please don't register it again.",3506:"Unsupported listener target.",3507:"Invalid scene graph priority!",3508:"If program goes here, there should be event in dispatch.",3509:"_inDispatch should be 1 here.",3510:"%s's scene graph node not contains in the parent's children",3511:"event is undefined",3600:"cc.Class will automatically call super constructor of %s, you should not call it manually.",3601:"The editor property 'playOnFocus' should be used with 'executeInEditMode' in class '%s'",3602:"Unknown editor property '%s' in class '%s'.",3603:"Use 'cc.Float' or 'cc.Integer' instead of 'cc.Number' please.",3604:"Can only indicate one type attribute for %s.",3605:"The default value of %s is not instance of %s.",3606:"No needs to indicate the '%s' attribute for %s, which its default value is type of %s.",3607:"The default value of %s must be an empty string.",3608:"The type of %s must be cc.String, not String.",3609:"The type of %s must be cc.Boolean, not Boolean.",3610:"The type of %s must be cc.Float or cc.Integer, not Number.",3611:"Can not indicate the '%s' attribute for %s, which its default value is type of %s.",3612:"%s Just set the default value to 'new %s()' and it will be handled properly.",3613:"'No need to use 'serializable: false' or 'editorOnly: true' for the getter of '%s.%s', every getter is actually non-serialized.",3614:"Should not define constructor for cc.Component %s.",3615:"Each script can have at most one Component.",3616:"Should not specify class name %s for Component which defines in project.",3617:"Can not instantiate CCClass '%s' with arguments.",3618:"ctor of '%s' can not be another CCClass",3619:"ctor of '%s' must be function type",3620:"this._super declared in '%s.%s' but no super method defined",3621:"Unknown type of %s.%s, maybe you want is '%s'.",3622:"Unknown type of %s.%s, property should be defined in 'properties' or 'ctor'",3623:"Can not use 'editor' attribute, '%s' not inherits from Components.",3624:"'%s' overrided '%s' but '%s' is defined as 'false' so the super method will not be called. You can set '%s' to null to disable this warning.",3625:"[isChildClassOf] superclass should be function type, not",3626:"Can't remove '%s' because '%s' depends on it.",3627:"Should not add renderer component (%s) to a Canvas node.",3628:"Should not add %s to a node which size is already used by its other component.",3633:"Properties function of '%s' should return an object!",3634:"Disallow to use '.' in property name",3635:"Default array must be empty, set default value of %s.%s to [], and initialize in 'onLoad' or 'ctor' please. (just like 'this.%s = [...];')",3636:"Do not set default value to non-empty object, unless the object defines its own 'clone' function. Set default value of %s.%s to null or {}, and initialize in 'onLoad' or 'ctor' please. (just like 'this.%s = {foo: bar};')",3637:"Can not declare %s.%s, it is already defined in the prototype of %s",3638:"'%s': the getter of '%s' is already defined!",3639:"Can not apply the specified attribute to the getter of '%s.%s', attribute index: %s",3640:"'%s': the setter of '%s' is already defined!",3641:"Can not construct %s because it contains object property.",3642:"Cannot define %s.%s because static member name can not be '%s'.",3643:"Can not define a member called 'constructor' in the class '%s', please use 'ctor' instead.",3644:"Please define 'type' parameter of %s.%s as the actual constructor.",3645:"Please define 'type' parameter of %s.%s as the constructor of %s.",3646:"Unknown 'type' parameter of %s.%sï¼š%s",3647:"The length of range array must be equal or greater than 2",3648:"Can not declare %s.%s method, it is already defined in the properties of %s.",3649:"CCClass %s have conflict between its ctor and __ctor__.",3651:'Can not call `_super` or `prototype.ctor` in ES6 Classes "%s", use `super` instead please.',3652:"Failed to `new %s()` under the hood, %s\nIt is used for getting default values declared in TypeScript in the first place.\nPlease ensure the constructor can be called during the script's initialization.",3653:'Please do not specifiy "default" attribute in decorator of "%s" property in "%s" class.  \nDefault value must be initialized at their declaration:\n \n// Before:\n@property({\n  type: cc.Integer\n  default: 0  // <--\n})\nmyProp;\n// After:\n@property({\n  type: cc.Integer\n})\nmyProp = 0;   // <--',3654:'Please specifiy a default value for "%s.%s" at its declaration:\n \n// Before:\n@property(...)\nmyProp;\n// After:\n@property(...)\nmyProp = 0;',3655:'Can not specifiy "get" or "set"  attribute in decorator for "%s" property in "%s" class.  \nPlease use:\n \n@property(...)\nget %s () {\n    ...\n}\n@property\nset %s (value) {\n    ...\n}',3656:"The default value of %s.%s must be an empty string.",3700:"internal error: _prefab is undefined",3701:"Failed to load prefab asset for node '%s'",3800:"The target can not be made persist because it's not a cc.Node or it doesn't have _id property.",3801:"The node can not be made persist because it's not under root node.",3802:"The node can not be made persist because it's not in current scene.",3803:"The target can not be made persist because it's not a cc.Node or it doesn't have _id property.",3804:"getComponent: Type must be non-nil",3805:"Can't add component '%s' because %s already contains the same component.",3806:"Can't add component '%s' to %s because it conflicts with the existing '%s' derived component.",3807:"addComponent: Failed to get class '%s'",3808:"addComponent: Should not add component ('%s') when the scripts are still loading.",3809:"addComponent: The component to add must be a constructor",3810:"addComponent: The component to add must be child class of cc.Component",3811:"_addComponentAt: The component to add must be a constructor",3812:"_addComponentAt: Index out of range",3813:"removeComponent: Component must be non-nil",3814:"Argument must be non-nil",3815:"Component not owned by this entity",3816:"Node '%s' is already activating",3817:"Sorry, the component of '%s' which with an index of %s is corrupted! It has been removed.",3818:"Failed to read or parse project.json",3819:"Warning: target element is not a DIV or CANVAS",3820:"The renderer doesn't support the renderMode %s",3821:"Cannot change hierarchy while activating or deactivating the parent.",3900:"Invalid clip to add",3901:"Invalid clip to remove",3902:"clip is defaultClip, set force to true to force remove clip and animation state",3903:"animation state is playing, set force to true to force stop and remove clip and animation state",3904:"motion path of target [%s] in prop [%s] frame [%s] is not valid",3905:"sprite frames must be an Array.",3906:"Can't find easing type [%s]",3907:"animator not added or already removed",3912:"already-playing",4e3:"Sorry, the cc.Font has been modified from Raw Asset to Asset. Please load the font asset before using.",4003:"Label font size can't be shirnked less than 0!",4004:"force notify all fonts loaded!",4011:"Property spriteFrame of Font '%s' is invalid. Using system font instead.",4012:"The texture of Font '%s' must be already loaded on JSB. Using system font instead.",4013:"Sorry, lineHeight of system font not supported on JSB.",4200:"MaskType: IMAGE_STENCIL only support WebGL mode.",4201:"The alphaThreshold invalid in Canvas Mode.",4202:"The inverted invalid in Canvas Mode.",4300:"can not found the %s page.",4400:"Invalid RichText img tag! The sprite frame name can't be found in the ImageAtlas!",4600:"Script attached to '%s' is missing or invalid.",4700:"The dom control is not created!",4800:"unknown asset type",4901:"loadRes: should not specify the extname in %s %s",4902:"No need to release non-cached asset.",4903:"Can not get class '%s'",4914:"Resources url '%s' does not exist.",4915:"Pack indices and data do not match in size",4916:"Failed to download package for %s",4920:"Sorry, you shouldn't use id as item identity any more, please use url or uuid instead, the current id is being set as url: (%s)",4921:"Invalid pipe or invalid index provided!",4922:"The pipe to be inserted is already in the pipeline!",4923:"Uuid Loader: Parse asset [ %s ] failed : %s",4924:"JSON Loader: Input item doesn't contain string content",4925:"Uuid Loader: Deserialize asset [ %s ] failed : %s",4926:"Audio Downloader: no web audio context.",4927:"Audio Downloader: audio not supported on this browser!",4928:"Load %s failed!",4929:"Load Webp ( %s ) failed",4930:"Load image ( %s ) failed",4931:"Download Uuid: can not find type of raw asset[ %s ]: %s",4932:'Since v1.10, for any atlas ("%s") in the "resources" directory, it is not possible to find the contained SpriteFrames via `loadRes`, `getRes` or `releaseRes`. Load the SpriteAtlas first and then use `spriteAtlas.getSpriteFrame(name)` instead please.',4933:"Download Font [ %s ] failed, using Arial or system default font instead",5e3:"object already destroyed",5001:"object not yet destroyed",5100:"Not a plist file!",5200:"Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option",5201:"browser don't support web audio",5202:"This feature supports WebGL render mode only.",5300:"Type of target to deserialize not matched with data: target is %s, data is %s",5301:"Can not find script '%s'",5302:"Can not find class '%s'",5402:"cc.js.addon called on non-object:",5403:"cc.js.mixin: arguments must be type object:",5404:"The base class to extend from must be non-nil",5405:"The class to extend must be non-nil",5406:"Class should be extended before assigning any prototype members.",5500:"'notify' can not be used in 'get/set' !",5501:"'notify' must be used with 'default' !",5502:"Invalid url of %s.%s",5503:"The 'url' attribute of '%s.%s' is undefined when loading script.",5504:"The 'url' type of '%s.%s' must be child class of cc.RawAsset.",5505:"The 'url' type of '%s.%s' must not be child class of cc.Asset, otherwise you should use 'type: %s' instead.",5506:"Can not specify 'type' attribute for '%s.%s', because its 'url' is already defined.",5507:"The 'default' attribute of '%s.%s' must be an array",5508:"Invalid type of %s.%s",5509:"The 'type' attribute of '%s.%s' must be child class of cc.Asset, otherwise you should use 'url: %s' instead",5510:"The 'type' attribute of '%s.%s' can not be 'Number', use cc.Float or cc.Integer instead please.",5511:"The 'type' attribute of '%s.%s' is undefined when loading script",5512:"Can not serialize '%s.%s' because the specified type is anonymous, please provide a class name or set the 'serializable' attribute of '%s.%s' to 'false'.",5513:"The 'default' value of '%s.%s' should not be used with a 'get' function.",5514:"The 'default' value of '%s.%s' should not be used with a 'set' function.",5515:"The 'default' value of '%s.%s' can not be an constructor. Set default to null please.",5516:"Property '%s.%s' must define at least one of 'default', 'get' or 'set'.",5517:"'%s.%s' hides inherited property '%s.%s'. To make the current property override that implementation, add the `override: true` attribute please.",5601:"Can not get current scene.",5602:"Scene is destroyed",5603:"reference node is destroyed",5700:"no %s or %s on %s",5800:"%s.lerp not yet implemented.",5801:"%s.clone not yet implemented.",5802:"%s.equals not yet implemented.",5900:"MotionStreak only support WebGL mode.",5901:"cc.MotionStreak.getOpacity has not been supported.",5902:"cc.MotionStreak.setOpacity has not been supported.",6e3:"Custom should not be false if file is not specified.",6001:"The new %s must not be NaN",6017:"Incomplete or corrupt PNG file",6018:"Invalid filter algorithm: %s",6019:"Invalid byte order value.",6020:"You forgot your towel!",6021:"Unknown Field Tag: %s",6022:"Too many bits requested",6023:"No bits requested",6024:"Cannot recover from missing StripByteCounts",6025:"Cannot handle sub-byte bits per sample",6026:"Cannot handle sub-byte bits per pixel",6027:"Palette image missing color map",6028:"Unknown Photometric Interpretation: %s",6029:"Unkown error",6030:"cc.ParticleSystem: error decoding or ungzipping textureImageData",6031:"cc.ParticleSystem: unknown image format with Data",6032:"cc.ParticleSystem.initWithDictionary() : error loading the texture",6400:"asset.url is not usable in core process",6402:"AssetLibrary has already been initialized!",6500:"Widget target must be one of the parent nodes of it",6600:"collider not added or already removed",6601:"Can't find testFunc for (%s, $s).",6700:"Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time.",6800:"Callback of event must be non-nil",6801:"The message must be provided",6900:"The thing you want to instantiate must be an object",6901:"The thing you want to instantiate is nil",6902:"The thing you want to instantiate is destroyed",6903:"The instantiate method for given asset do not implemented",6904:"Can not instantiate array",6905:"Can not instantiate DOM element",7e3:"Failed to init asset's raw path.",7001:"Should not load '%s' from script dynamically, unless it is placed in the 'resources' folder.",7002:"Sorry can not load '%s' because it is not placed in the 'resources' folder.",7003:"Failed to init builtin asset's raw path.",7100:"%s already defined in Enum.",7101:"Sorry, 'cc.Enum' not available on this platform, please report this error here: https://github.com/cocos-creator/engine/issues/new",7200:"Method 'initWithTMXFile' is no effect now, please set property 'tmxAsset' instead.",7201:"Method 'initWithXML' is no effect now, please set property 'tmxAsset' instead.",7202:"Add component TiledLayer into node failed.",7203:"Property 'mapLoaded' is unused now. Please write the logic to the callback 'start'.",7210:"TMX Hexa zOrder not supported",7211:"TMX invalid value",7215:"cocos2d: Warning: TMX Layer %s has no tiles",7216:"cocos2d: TMXFormat: Unsupported TMX version: %s",7217:"cocos2d: TMXFomat: Unsupported orientation: %s",7218:"cc.TMXMapInfo.parseXMLFile(): unsupported compression method",7219:"cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported",7221:"cc.TMXMapInfo.parseXMLFile(): Texture '%s' not found.",7222:"Parse %s failed.",7236:"cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released",7237:"cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released",7238:"cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released",7239:"cc.TMXLayer.setTileGID(): invalid gid: %s",7240:"cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released",7241:"cc.TiledMap.initWithXML(): Map not found. Please check the filename.",7401:"Failed to set _defaultArmatureIndex for '%s' because the index is out of range.",7402:"Failed to set _animationIndex for '%s' because the index is out of range.",7501:"Failed to set _defaultSkinIndex for '%s' because the index is out of range.",7502:"Failed to set _animationIndex for '%s' because its skeletonData is invalid.",7503:"Failed to set _animationIndex for '%s' because the index is out of range.",7504:"Can not render dynamic created SkeletonData",7505:"Invalid type of atlasFile, atlas should be registered as raw asset.",7506:"Failed to load spine atlas '$s'",7507:"Please re-import '%s' because its textures is not initialized! (This workflow will be improved in the future.)",7508:"The atlas asset of '%s' is not exists!",7509:"Spine: Animation not found: %s",7510:"Spine: Animation not found: %s",7600:"The context of RenderTexture is invalid.",7601:"cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;",7602:"Could not attach texture to the framebuffer",7603:"clearDepth isn't supported on Cocos2d-Html5",7604:"saveToFile isn't supported on Cocos2d-Html5",7605:"newCCImage isn't supported on Cocos2d-Html5",7700:"On the web is always keep the aspect ratio",7701:"Can't know status",7702:"Video player's duration is not ready to get now!",7800:"Web does not support loading",7801:"Web does not support query history",7802:"Web does not support query history",7803:"The current browser does not support the GoBack",7804:"The current browser does not support the GoForward",7805:"Web does not support zoom",7900:"cc.math.Matrix3.assign(): current matrix equals matIn",7901:"cc.math.mat4Assign(): pOut equals pIn",7902:"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix",7903:"cc.math.Matrix4 equal: pMat1 and pMat2 are same object.",7904:"cc.math.Matrix4.extractPlane: Invalid plane index",7905:"cc.math.mat4Assign(): pOut equals pIn",7906:"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix",7907:"cc.math.Matrix4 equals: pMat1 and pMat2 are same object.",7908:"Invalid matrix mode specified",7909:"current quaternion is an invalid value",8e3:"Can't handle this field type or size",8001:"No bytes requested",8002:"Too many bytes requested",8003:"Missing StripByteCounts!",8103:"cc.GLProgram.link(): Cannot link invalid program",8104:"cocos2d: ERROR: Failed to link program: %s",8105:"cocos2d: cc.shaderCache._loadDefaultShader, error shader type",8106:"Please load the resource firset : %s",8107:"cc.GLProgram.getUniformLocationForName(): uniform name should be non-null",8108:"cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized",8109:"modelView matrix is undefined.",8200:"Please set node's active instead of rigidbody's enabled.",8300:"Should only one camera exists, please check your project.",8301:"Camera does not support Canvas Mode.",8400:"Wrong type arguments, 'filePath' must be a String.",8401:"Since 1.10, `%s` accept %s instance directly, not a URL string. Please directly reference the %s object in your script, or load %s by loader first. Don't use %s's URL anymore.",9e3:"Stencil manager does not support level bigger than %d in this device.",9001:"Stencil manager is already empty, cannot pop any mask.",9100:"LabelAtlas '%s' cannot be loaded, raw texture does not exist.",9101:"LabelAtlas '%s' cannot be loaded, fnt data does not exist.",9102:"Program not support highp precision, will change to mediump.",9103:"%s : Failed to set property [%s], property not found.",9104:"%s : Failed to define [%s], define not found.",9105:"%s : Failed to set property [%s], property length not correct.",9106:"%s : Set property [%s] warning : should transform object to ArrayBuffer.",9107:"%s : illegal property: [%s], myabe defined an unused property;",9200:"cc.view.enableAntiAlias is deprecated now, please use cc.Texture2D.setFilters instead","0100":"%s not yet implemented."}},{}],2:[function(t,e,i){"use strict";t("../core/platform/CCClass");var n=t("../core/utils/misc");cc.Action=cc.Class({name:"cc.Action",ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.logID(1006)},update:function(t){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Class({name:"cc.FiniteTimeAction",extends:cc.Action,ctor:function(){this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Class({name:"cc.Speed",extends:cc.Action,ctor:function(t,e){this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(cc.errorID(1021),!1)},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Follow=cc.Class({name:"cc.Follow",extends:cc.Action,ctor:function(t,e){this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,e=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,e),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)return cc.errorID(1022),!1;var i=this,t=(e=e||cc.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!(0===e.width&&0===e.height),i._boundaryFullyCovered=!1,cc.winSize);return i._fullScreenSize=cc.v2(t.width,t.height),i._halfScreenSize=i._fullScreenSize.mul(.5),i._boundarySet&&(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary&&(i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2),i.topBoundary<i.bottomBoundary&&(i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2),i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary&&(i._boundaryFullyCovered=!0)),!0},step:function(t){var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),e=e.sub(i),i=this.target.parent.convertToNodeSpaceAR(e.add(this._halfScreenSize));this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(n.clampf(i.x,this.leftBoundary,this.rightBoundary),n.clampf(i.y,this.bottomBoundary,this.topBoundary)):this.target.setPosition(i.x,i.y)},isDone:function(){return!this._followedNode.activeInHierarchy},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)}},{"../core/platform/CCClass":189,"../core/utils/misc":264}],3:[function(t,e,i){"use strict";function h(t,e){return t[Math.min(t.length-1,Math.max(e,0))]}function s(t){for(var e=[],i=t.length-1;0<=i;i--)e.push(cc.v2(t[i].x,t[i].y));return e}function n(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.v2(t[i].x,t[i].y));return e}cc.CardinalSplineTo=cc.Class({name:"cc.CardinalSplineTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._points=[],this._deltaT=0,this._tension=0,this._previousPosition=null,this._accumulatedDiff=null,void 0!==i&&cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return e&&0!==e.length?!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0):(cc.errorID(1024),!1)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,n(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.v2(this.target.x,this.target.y),this._accumulatedDiff=cc.v2(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i,n,r,s,o,a,c=this._points,l=(t=1===t?(i=c.length-1,1):(t-(e=this._deltaT)*(i=0|t/e))/e,e=h(c,i-1),o=h(c,+i),s=h(c,i+1),c=h(c,i+2),i=this._tension,l=(i=(1-i)/2)*(2*(r=(t=t)*t)-(n=r*t)-t),a=i*(r-n)+(2*n-3*r+1),t=i*(n-2*r+t)+(-2*n+3*r),i*=n-r,n=e.x*l+o.x*a+s.x*t+c.x*i,r=e.y*l+o.y*a+s.y*t+c.y*i,cc.v2(n,r));cc.macro.ENABLE_STACKABLE_ACTIONS&&(o=this.target.x-this._previousPosition.x,a=this.target.y-this._previousPosition.y,0==o&&0===a||(o=(s=this._accumulatedDiff).x+o,a=s.y+a,s.x=o,s.y=a,l.x+=o,l.y+=a)),this.updatePosition(l)},reverse:function(){var t=s(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineBy=cc.Class({name:"cc.CardinalSplineBy",extends:cc.CardinalSplineTo,ctor:function(t,e,i){this._startPosition=cc.v2(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.x,this._startPosition.y=t.y},reverse:function(){for(var t,e=this._points.slice(),i=e[0],n=1;n<e.length;++n)t=e[n],e[n]=t.sub(i),i=t;var r=s(e),i=r[r.length-1];r.pop(),i.x=-i.x,i.y=-i.y,r.unshift(i);for(n=1;n<r.length;++n)(t=r[n]).x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,i=r[n]=t;return cc.cardinalSplineBy(this._duration,r,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,t=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=t,this.target.setPosition(i,t)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,n(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CatmullRomTo=cc.Class({name:"cc.CatmullRomTo",extends:cc.CardinalSplineTo,ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,n(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomBy=cc.Class({name:"cc.CatmullRomBy",extends:cc.CardinalSplineBy,ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,n(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)}},{}],4:[function(h,u,_){"use strict";cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};var t={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return e}},e=(cc.easeExponentialIn=function(){return t},{easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return t}}),i=(cc.easeExponentialOut=function(){return e},{easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return i}}),n=(cc.easeExponentialInOut=function(){return i},{easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return r}}),r=(cc.easeSineIn=function(){return n},{easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return n}}),s=(cc.easeSineOut=function(){return r},{easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return s}}),o=(cc.easeSineInOut=function(){return s},{easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return a}}),a=(cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:o},{easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return o}});function c(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:a},cc.easeElasticInOut=function(t){return{_period:t=t||.3,easing:function(t){var e,i=this._period;return 0===t||1===t?t:(t*=2,e=(i=i||(this._period=.3*1.5))/4,--t<0?-.5*Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI*2/i)*.5+1)},reverse:function(){return cc.easeElasticInOut(this._period)}}};var l={easing:function(t){return 1-c(1-t)},reverse:function(){return d}},d=(cc.easeBounceIn=function(){return l},{easing:c,reverse:function(){return l}}),f=(cc.easeBounceOut=function(){return d},{easing:function(t){t=t<.5?.5*(1-c(1-(t*=2))):.5*c(2*t-1)+.5;return t},reverse:function(){return f}}),p=(cc.easeBounceInOut=function(){return f},{easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return m}}),m=(cc.easeBackIn=function(){return p},{easing:function(t){return--t*t*(2.70158*t+1.70158)+1},reverse:function(){return p}}),y=(cc.easeBackOut=function(){return m},{easing:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)/2:(t-=2)*t*((1+e)*t+e)/2+1},reverse:function(){return y}}),g=(cc.easeBackInOut=function(){return y},cc.easeBezierAction=function(e,i,n,r){return{easing:function(t){return Math.pow(1-t,3)*e+3*t*Math.pow(1-t,2)*i+3*Math.pow(t,2)*(1-t)*n+Math.pow(t,3)*r},reverse:function(){return cc.easeBezierAction(r,n,i,e)}}},{easing:function(t){return Math.pow(t,2)},reverse:function(){return g}}),v=(cc.easeQuadraticActionIn=function(){return g},{easing:function(t){return-t*(t-2)},reverse:function(){return v}}),x=(cc.easeQuadraticActionOut=function(){return v},{easing:function(t){return(t*=2)<1?t*t*.5:-.5*(--t*(t-2)-1)},reverse:function(){return x}}),b=(cc.easeQuadraticActionInOut=function(){return x},{easing:function(t){return t*t*t*t},reverse:function(){return b}}),A=(cc.easeQuarticActionIn=function(){return b},{easing:function(t){return-(--t*t*t*t-1)},reverse:function(){return A}}),C=(cc.easeQuarticActionOut=function(){return A},{easing:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},reverse:function(){return C}}),S=(cc.easeQuarticActionInOut=function(){return C},{easing:function(t){return t*t*t*t*t},reverse:function(){return S}}),T=(cc.easeQuinticActionIn=function(){return S},{easing:function(t){return--t*t*t*t*t+1},reverse:function(){return T}}),w=(cc.easeQuinticActionOut=function(){return T},{easing:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},reverse:function(){return w}}),E=(cc.easeQuinticActionInOut=function(){return w},{easing:function(t){return-1*(Math.sqrt(1-t*t)-1)},reverse:function(){return E}}),M=(cc.easeCircleActionIn=function(){return E},{easing:function(t){return--t,Math.sqrt(1-t*t)},reverse:function(){return M}}),I=(cc.easeCircleActionOut=function(){return M},{easing:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},reverse:function(){return I}}),B=(cc.easeCircleActionInOut=function(){return I},{easing:function(t){return t*t*t},reverse:function(){return B}}),R=(cc.easeCubicActionIn=function(){return B},{easing:function(t){return--t*t*t+1},reverse:function(){return R}}),P=(cc.easeCubicActionOut=function(){return R},{easing:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},reverse:function(){return P}});cc.easeCubicActionInOut=function(){return P}},{}],5:[function(t,e,i){"use strict";cc.ActionInstant=cc.Class({name:"cc.ActionInstant",extends:cc.FiniteTimeAction,isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.Class({name:"cc.Show",extends:cc.ActionInstant,update:function(t){for(var e=this.target.getComponentsInChildren(cc.RenderComponent),i=0;i<e.length;++i)e[i].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.Class({name:"cc.Hide",extends:cc.ActionInstant,update:function(t){for(var e=this.target.getComponentsInChildren(cc.RenderComponent),i=0;i<e.length;++i)e[i].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.Class({name:"cc.ToggleVisibility",extends:cc.ActionInstant,update:function(t){for(var e=this.target.getComponentsInChildren(cc.RenderComponent),i=0;i<e.length;++i){var n=e[i];n.enabled=!n.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.Class({name:"cc.RemoveSelf",extends:cc.ActionInstant,ctor:function(t){this._isNeedCleanUp=!0,void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.DestroySelf=cc.Class({name:"cc.DestroySelf",extends:cc.ActionInstant,update:function(){this.target.destroy()},reverse:function(){return new cc.DestroySelf},clone:function(){return new cc.DestroySelf}}),cc.destroySelf=function(){return new cc.DestroySelf},cc.FlipX=cc.Class({name:"cc.FlipX",extends:cc.ActionInstant,ctor:function(t){this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.Class({name:"cc.FlipY",extends:cc.ActionInstant,ctor:function(t){this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.Class({name:"cc.Place",extends:cc.ActionInstant,ctor:function(t,e){this._x=0,void(this._y=0)!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.CallFunc=cc.Class({name:"cc.CallFunc",extends:cc.ActionInstant,ctor:function(t,e,i){this._selectorTarget=null,this._function=null,this._data=null,this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)}},{}],6:[function(t,e,i){"use strict";function a(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n}cc.ActionInterval=cc.Class({name:"cc.ActionInterval",extends:cc.FiniteTimeAction,ctor:function(t){this.MAX_VALUE=2,this._elapsed=0,this._firstTick=!1,this._easeList=null,this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this._repeatMethod=!1,this._speedMethod=!1,void 0!==t&&cc.ActionInterval.prototype.initWithDuration.call(this,t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;t=(t=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7))<1?t:1;this.update(0<t?t:0),this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(t){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(t){return t<=0?cc.logID(1013):(this._speedMethod=!0,this._speed*=t),this},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?cc.logID(1014):(this._repeatMethod=!0,this._timesForRepeat*=t),this},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.Class({name:"cc.Sequence",extends:cc.ActionInterval,ctor:function(t){this._actions=[],this._split=null,this._last=0,this._reversed=!1;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(0<=i&&null==e[i]&&cc.logID(1015),0<=i){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Sequence._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}}else cc.errorID(1019)},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1025),!1;var i=t._duration,n=e._duration,i=(i*=t._repeatMethod?t._timesForRepeat:1)+(n*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i=0,n=this._split,r=this._actions,s=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===i&&1===s&&this._reversed&&(r[1].update(0),r[1].stop())):(e=(i=1)===n?1:(t-n)/(1-n),-1===s&&(r[0].startWithTarget(this.target),r[0].update(1),r[0].stop()),0===s&&(r[0].update(1),r[0].stop())),t=r[i],s===i&&t.isDone()||(s!==i&&t.startWithTarget(this.target),e*=t._timesForRepeat,t.update(1<e?e%1:e),this._last=i)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1019),null;var i=e.length-1,n=(0<=i&&null==e[i]&&cc.logID(1015),null);if(0<=i)for(var n=e[0],r=1;r<=i;r++)e[r]&&(n=cc.Sequence._actionOneTwo(n,e[r]));return n},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.Class({name:"cc.Repeat",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,(this._innerAction=t)instanceof cc.ActionInstant&&(this._actionInstant=!0,--this._times),!(this._total=0))},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(r<=t){for(;r<t&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=1<r?1:r;1<=t&&this._total<n&&(e.update(1),this._total++),this._actionInstant||(this._total===n?e.stop():e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.RepeatForever=cc.Class({name:"cc.RepeatForever",extends:cc.ActionInterval,ctor:function(t){this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){return t?(this._innerAction=t,!0):(cc.errorID(1026),!1)},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.Class({name:"cc.Spawn",extends:cc.ActionInterval,ctor:function(t){this._one=null,this._two=null;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(0<=i&&null==e[i]&&cc.logID(1015),0<=i){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Spawn._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}}else cc.errorID(1020)},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1027),!1;var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,r<n?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1020),null;0<e.length&&null==e[e.length-1]&&cc.logID(1015);for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.Class({name:"cc.RotateTo",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){this._startAngle=0,this._dstAngle=0,void(this._angle=0)!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngle=e,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var t=t.angle%360,e=cc.RotateTo._reverse?this._dstAngle-t:this._dstAngle+t;180<e&&(e-=360),e<-180&&(e+=360),this._startAngle=t,this._angle=cc.RotateTo._reverse?e:-e},reverse:function(){cc.logID(1016)},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._angle*t)}}),cc.rotateTo=function(t,e){return new cc.RotateTo(t,e)},cc.RotateBy=cc.Class({name:"cc.RotateBy",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){e*=cc.RotateBy._reverse?1:-1,this._deltaAngle=0,void(this._startAngle=0)!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaAngle=e,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaAngle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngle=t.angle},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._deltaAngle*t)},reverse:function(){var t=new cc.RotateBy;return t.initWithDuration(this._duration,-this._deltaAngle),this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e){return new cc.RotateBy(t,e)},cc.MoveBy=cc.Class({name:"cc.MoveBy",extends:cc.ActionInterval,ctor:function(t,e,i){this._positionDelta=cc.v2(0,0),this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),void 0!==e&&cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,s;t=this._computeEaseTime(t),this.target&&(e=this._positionDelta.x*t,t=this._positionDelta.y*t,i=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(n=this.target.x,r=this.target.y,s=this._previousPosition,i.x=i.x+n-s.x,i.y=i.y+r-s.y,e+=i.x,t+=i.y,s.x=e,s.y=t,this.target.setPosition(e,t)):this.target.setPosition(i.x+e,i.y+t))},reverse:function(){var t=new cc.MoveBy(this._duration,cc.v2(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveTo=cc.Class({name:"cc.MoveTo",extends:cc.MoveBy,ctor:function(t,e,i){this._endPosition=cc.v2(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.x,this._positionDelta.y=this._endPosition.y-t.y}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.SkewTo=cc.Class({name:"cc.SkewTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._skewX=0,this._skewY=0,this._startSkewX=0,this._startSkewY=0,this._endSkewX=0,this._endSkewY=0,this._deltaX=0,void(this._deltaY=0)!==i&&cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,180<this._deltaX&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,180<this._deltaY&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewBy=cc.Class({name:"cc.SkewBy",extends:cc.SkewTo,ctor:function(t,e,i){void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.JumpBy=cc.Class({name:"cc.JumpBy",extends:cc.ActionInterval,ctor:function(t,e,i,n,r){this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),this._delta=cc.v2(0,0),this._height=0,void(this._jumps=0)!==n&&cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,s;t=this._computeEaseTime(t),this.target&&(e=t*this._jumps%1,e=4*this._height*e*(1-e),e+=this._delta.y*t,t=this._delta.x*t,i=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(n=this.target.x,r=this.target.y,s=this._previousPosition,i.x=i.x+n-s.x,i.y=i.y+r-s.y,t+=i.x,e+=i.y,s.x=t,s.y=e,this.target.setPosition(t,e)):this.target.setPosition(i.x+t,i.y+e))},reverse:function(){var t=new cc.JumpBy(this._duration,cc.v2(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpTo=cc.Class({name:"cc.JumpTo",extends:cc.JumpBy,ctor:function(t,e,i,n,r){this._endPosition=cc.v2(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.BezierBy=cc.Class({name:"cc.BezierBy",extends:cc.ActionInterval,ctor:function(t,e){this._config=[],this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),e&&cc.BezierBy.prototype.initWithDuration.call(this,t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){for(var t=new cc.BezierBy,e=(this._cloneDecoration(t),[]),i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.v2(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,s,o;t=this._computeEaseTime(t),this.target&&(e=(o=this._config)[0].x,i=o[1].x,n=o[2].x,r=o[0].y,s=o[1].y,o=o[2].y,e=a(0,e,i,n,t),i=a(0,r,s,o,t),n=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(r=this.target.x,s=this.target.y,o=this._previousPosition,n.x=n.x+r-o.x,n.y=n.y+s-o.y,e+=n.x,i+=n.y,o.x=e,o.y=i,this.target.setPosition(e,i)):this.target.setPosition(n.x+e,n.y+i))},reverse:function(){var t=this._config,e=t[0].x,i=t[0].y,n=t[1].x,r=t[1].y,s=t[2].x,t=t[2].y,n=[cc.v2(n-s,r-t),cc.v2(e-s,i-t),cc.v2(-s,-t)],r=new cc.BezierBy(this._duration,n);return this._cloneDecoration(r),this._reverseEaseList(r),r}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierTo=cc.Class({name:"cc.BezierTo",extends:cc.BezierBy,ctor:function(t,e){this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var t=this._startPosition,e=this._toConfig,i=this._config;i[0]=e[0].sub(t),i[1]=e[1].sub(t),i[2]=e[2].sub(t)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.ScaleTo=cc.Class({name:"cc.ScaleTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._scaleX=1,this._scaleY=1,this._startScaleX=1,this._startScaleY=1,this._endScaleX=0,this._endScaleY=0,this._deltaX=0,void(this._deltaY=0)!==e&&cc.ScaleTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleBy=cc.Class({name:"cc.ScaleBy",extends:cc.ScaleTo,startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.Blink=cc.Class({name:"cc.Blink",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._originalState=!1,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){var e;t=this._computeEaseTime(t),this.target&&!this.isDone()&&(e=1/this._times,this.target.opacity=e/2<t%e?255:0)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.FadeTo=cc.Class({name:"cc.FadeTo",extends:cc.ActionInterval,ctor:function(t,e){this._toOpacity=0,void(this._fromOpacity=0)!==e&&cc.FadeTo.prototype.initWithDuration.call(this,t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeIn=cc.Class({name:"cc.FadeIn",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.Class({name:"cc.FadeOut",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.Class({name:"cc.TintTo",extends:cc.ActionInterval,ctor:function(t,e,i,n){this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),e instanceof cc.Color&&(n=e.b,i=e.g,e=e.r),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo,e=(this._cloneDecoration(t),this._to);return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&(this.target.color=cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintBy=cc.Class({name:"cc.TintBy",extends:cc.ActionInterval,ctor:function(t,e,i,n){this._deltaR=0,this._deltaG=0,this._deltaB=0,this._fromR=0,this._fromG=0,void(this._fromB=0)!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);t=t.color;this._fromR=t.r,this._fromG=t.g,this._fromB=t.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.DelayTime=cc.Class({name:"cc.DelayTime",extends:cc.ActionInterval,update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.Class({name:"cc.ReverseTime",extends:cc.ActionInterval,ctor:function(t){this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){return t?t===this._other?(cc.errorID(1029),!1):!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(cc.errorID(1028),!1)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.TargetedAction=cc.Class({name:"cc.TargetedAction",extends:cc.ActionInterval,ctor:function(t,e){this._action=null,this._forcedTarget=null,e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)}},{}],7:[function(t,e,i){"use strict";t("../core/platform/CCClass");function n(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}var r=t("../core/platform/js");cc.ActionManager=function(){this._hashTargets=r.createMap(!0),this._arrayTargets=[],this._currentTarget=null,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},cc.ActionManager.prototype={constructor:cc.ActionManager,_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},_getElement:function(t,e){var i=this._elementPool.pop();return(i=i||new n).target=t,i.paused=!!e,i},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,e,i){var n;t&&e?((n=this._hashTargets[e._id])?n.actions||(n.actions=[]):(n=this._getElement(e,i),this._hashTargets[e._id]=n,this._arrayTargets.push(n)),n.actions.push(t),t.startWithTarget(e)):cc.errorID(1e3)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=r.createMap(!0)},removeAllActionsFromTarget:function(t,e){null==t||(t=this._hashTargets[t._id])&&(t.actions.length=0,this._deleteHashElement(t))},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e._id];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1),i.actionIndex>=n&&i.actionIndex--;break}}else cc.logID(1001)}},_removeActionByTag:function(t,e,i){for(var n=0,r=e.actions.length;n<r;++n){var s=e.actions[n];if(s&&s.getTag()===t&&(!i||s.getOriginalTarget()===i)){this._removeActionAtIndex(n,e);break}}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1002);var i=this._hashTargets;if(e){var n=i[e._id];n&&this._removeActionByTag(t,n,e)}else for(var r in i){r=i[r];this._removeActionByTag(t,r)}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1004);var i=this._hashTargets[e._id];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.logID(1005,t)}return null},getNumberOfRunningActionsInTarget:function(t){t=this._hashTargets[t._id];return t&&t.actions?t.actions.length:0},pauseTarget:function(t){t=this._hashTargets[t._id];t&&(t.paused=!0)},resumeTarget:function(t){t=this._hashTargets[t._id];t&&(t.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions[t];e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target._id]){delete this._hashTargets[t.target._id];for(var i=this._arrayTargets,n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}this._putElement(t),e=!0}return e},update:function(t){for(var e,i,n=this._arrayTargets,r=0;r<n.length;r++){if(this._currentTarget=n[r],!(e=this._currentTarget).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)e.currentAction=e.actions[e.actionIndex],e.currentAction&&(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()&&(e.currentAction.stop(),i=e.currentAction,e.currentAction=null,this.removeAction(i)),e.currentAction=null);e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}}},{"../core/platform/CCClass":189,"../core/platform/js":209}],8:[function(t,e,i){"use strict";t("./CCActionManager"),t("./CCAction"),t("./CCActionInterval"),t("./CCActionInstant"),t("./CCActionEase"),t("./CCActionCatmullRom"),t("./tween")},{"./CCAction":2,"./CCActionCatmullRom":3,"./CCActionEase":4,"./CCActionInstant":5,"./CCActionInterval":6,"./CCActionManager":7,"./tween":9}],9:[function(h,u,_){"use strict";var l=h("../animation/bezier"),d=0,n=cc.Class({name:"cc.TweenAction",extends:cc.ActionInterval,ctor:function(t,e,i){this._opts=i=i||Object.create(null),this._props=Object.create(null),i.progress=i.progress||this.progress,i.easing&&"string"==typeof i.easing&&(n=i.easing,i.easing=cc.easing[n],i.easing||cc.warnID(1031,n));var n,r,s=this._opts.relative;for(r in e){var o,a=e[r],c=void 0,l=void 0;void 0!==a.value&&(a.easing||a.progress)&&("string"==typeof a.easing?(c=cc.easing[a.easing])||cc.warnID(1031,a.easing):c=a.easing,l=a.progress,a=a.value),"number"==typeof a||a.lerp&&(!s||a.add||a.mul)&&a.clone?((o=Object.create(null)).value=a,o.easing=c,o.progress=l,this._props[r]=o):cc.warn("Can not animate "+r+" property, because it do not have [lerp, (add|mul), clone] function.")}this._originProps=e,this.initWithDuration(t)},clone:function(){var t=new n(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e,i=!!this._opts.relative,n=this._props;for(e in n){var r=t[e],s=n[e];"number"==typeof r?(s.start=r,s.current=r,s.end=i?r+s.value:s.value):(s.start=r.clone(),s.current=r.clone(),s.end=i?(r.add||r.mul).call(r,s.value):s.value)}},update:function(t){var e=this._opts,i=t,n=(e.easing&&(i=e.easing(t)),this.target);if(n){var r,s=this._props,o=this._opts.progress;for(r in s){var a=s[r],c=a.easing?a.easing(t):i,a=a.current=(a.progress||o)(a.start,a.end,a.current,c);n[r]=a}}},progress:function(t,e,i,n){return"number"==typeof t?i=t+(e-t)*n:t.lerp(e,n,i),i}}),e=cc.Class({name:"cc.SetAction",extends:cc.ActionInstant,ctor:function(t){this._props={},void 0!==t&&this.init(t)},init:function(t){for(var e in t)this._props[e]=t[e];return!0},update:function(){var t,e=this._props,i=this.target;for(t in e)i[t]=e[t]},clone:function(){var t=new e;return t.init(this._props),t}});function r(t){this._actions=[],this._finalAction=null,this._target=t,this._tag=cc.Action.TAG_INVALID}r.stopAll=function(){cc.director.getActionManager().removeAllActions()},r.stopAllByTag=function(t){cc.director.getActionManager().removeActionByTag(t)},r.stopAllByTarget=function(t){cc.director.getActionManager().removeAllActionsFromTarget(t)},r.prototype.then=function(t){return t instanceof cc.Action?this._actions.push(t.clone()):this._actions.push(t._union()),this},r.prototype.target=function(t){return this._target=t,this},r.prototype.start=function(){var t=this._target;return t?t instanceof cc.Object&&!t.isValid?void 0:(this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=this._union(),void 0===t._id&&(t._id=++d),this._finalAction.setTag(this._tag),cc.director.getActionManager().addAction(this._finalAction,t,!1),this):(cc.warn("Please set target to tween first"),this)},r.prototype.stop=function(){return this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this},r.prototype.tag=function(t){return this._tag=t,this},r.prototype.clone=function(t){var e=this._union();return cc.tween(t).then(e.clone())},r.prototype.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},r.prototype._union=function(){var t=this._actions;return t=1===t.length?t[0]:cc.sequence(t)},Object.assign(r.prototype,{bezierTo:function(t,e,i,n,r){var s=e.x,o=e.y,a=i.x,c=i.y;return(r=r||Object.create(null)).progress=function(t,e,i,n){return i.x=(0,l.bezier)(t.x,s,a,e.x,n),i.y=(0,l.bezier)(t.y,o,c,e.y,n),i},this.to(t,{position:n},r)},bezierBy:function(t,e,i,n,r){var s=e.x,o=e.y,a=i.x,c=i.y;return(r=r||Object.create(null)).progress=function(t,e,i,n){var r=t.x,t=t.y;return i.x=(0,l.bezier)(r,s+r,a+r,e.x,n),i.y=(0,l.bezier)(t,o+t,c+t,e.y,n),i},this.by(t,{position:n},r)},flipX:function(){var t=this;return this.call(function(){t._target.scaleX*=-1},this)},flipY:function(){var t=this;return this.call(function(){t._target.scaleY*=-1},this)},blink:function(t,e,i){var r=1/e;return(i=i||Object.create(null)).progress=function(t,e,i,n){return 1<=n?t:r/2<n%r?255:0},this.to(t,{opacity:1},i)}});var s=[];function t(n){return function(){s.length=0;for(var t=arguments.length,e=0;e<t;e++){var i=s[e]=arguments[e];i instanceof r&&(s[e]=i._union())}return n.apply(this,s)}}for(var i={to:function(t,e,i){return(i=i||Object.create(null)).relative=!1,new n(t,e,i)},by:function(t,e,i){return(i=i||Object.create(null)).relative=!0,new n(t,e,i)},set:function(t){return new e(t)},delay:cc.delayTime,call:cc.callFunc,hide:cc.hide,show:cc.show,removeSelf:cc.removeSelf,sequence:t(cc.sequence),parallel:t(cc.spawn)},f={repeat:cc.repeat,repeatForever:function(t){return cc.repeat(t,1e9)},reverseTime:cc.reverseTime},o=Object.keys(i),a=0;a<o.length;a++)!function(t){var e=o[t];r.prototype[e]=function(){var t=i[e].apply(this,arguments);return this._actions.push(t),this}}(a);for(var o=Object.keys(f),c=0;c<o.length;c++)!function(t){var s=o[t];r.prototype[s]=function(){for(var t=this._actions,e=arguments[arguments.length-1],i=arguments.length-1,n=(e instanceof cc.Tween?e=e._union():e instanceof cc.Action||(e=t[t.length-1],--t.length,i+=1),[e]),r=0;r<i;r++)n.push(arguments[r]);return e=f[s].apply(this,n),t.push(e),this}}(c);cc.tween=function(t){return new r(t)},cc.Tween=r},{"../animation/bezier":15}],10:[function(t,e,a){"use strict";var i=cc.js,n=t("./playable"),r=t("./animation-curves"),_=r.EventAnimCurve,d=r.EventInfo,f=t("./types").WrapModeMask,p=t("../core/utils/binary-search").binarySearchEpsilon;function s(t,e){n.call(this),this.target=t,this.animation=e,this._anims=new i.array.MutableForwardIterator([])}i.extend(s,n);r=s.prototype;function o(t,e){var i=e.clip,h=(e.duration=i.duration,e.speed=i.speed,e.wrapMode=i.wrapMode,e.frameRate=i.sample,(e.wrapMode&f.Loop)===f.Loop?e.repeatCount=1/0:e.repeatCount=1,e.curves=i.createCurves(e,t)),n=i.events;if(n)for(var r,s=0,u=n.length;s<u;s++){r||((r=new _).target=t,h.push(r));var o=n[s],a=o.frame/e.duration,c=void 0,l=p(r.ratios,a);0<=l?c=r.events[l]:(c=new d,r.ratios.push(a),r.events.push(c)),c.add(o.func,o.params)}}r.playState=function(t,e){t.clip&&(t.curveLoaded||o(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},r.stopStatesExcept=function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];n!==t&&this.stopState(n)}},r.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t),t._setEventTarget(this.animation)},r.removeAnimation=function(t){var e=this._anims.array.indexOf(t);0<=e?(this._anims.fastRemoveAt(e),0===this._anims.array.length&&this.stop()):cc.errorID(3907),t.animator=null},r.sample=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].sample()},r.stopState=function(t){t&&t.stop()},r.pauseState=function(t){t&&t.pause()},r.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},r.setStateTime=function(t,e){if(void 0!==e)t&&(t.setTime(e),t.sample());else{e=t;for(var i=this._anims.array,n=0;n<i.length;++n){var r=i[n];r.setTime(e),r.sample()}}},r.onStop=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].stop()},r.onPause=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.pause(),i.animator=null}},r.onResume=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.animator=this,i.resume()}},r._reloadClip=function(t){o(this.target,t)},e.exports=s},{"../core/utils/binary-search":256,"./animation-curves":12,"./playable":19,"./types":20}],11:[function(t,e,r){"use strict";var i=t("./types").WrapMode,n=t("./animation-curves"),m=n.DynamicAnimCurve,y=n.quickFindIndex,g=t("./motion-path-helper").sampleMotionPaths,v=t("../core/utils/binary-search").binarySearchEpsilon,a=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:cc.Float},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:i.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.errorID(3905),null;for(var i=new a,n=(i.sample=e||i.sample,i._duration=t.length/i.sample,[]),r=1/i.sample,s=0,o=t.length;s<o;s++)n[s]={frame:s*r,value:t[s]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:n}}},i}},onLoad:function(){this._duration=Number.parseFloat(this.duration),this.speed=Number.parseFloat(this.speed),this.wrapMode=Number.parseInt(this.wrapMode),this.frameRate=Number.parseFloat(this.sample)},createPropCurve:function(t,e,i){var h=[],u=t instanceof cc.Node&&"position"===e,n=new m;n.target=t,n.prop=e;for(var r=0,_=i.length;r<_;r++){var s=i[r],o=s.frame/this.duration,o=(n.ratios.push(o),u&&h.push(s.motionPath),s.value),o=(n.values.push(o),s.curve);if(o){if("string"==typeof o){n.types.push(o);continue}if(Array.isArray(o)){o[0]===o[1]&&o[2]===o[3]?n.types.push(m.Linear):n.types.push(m.Bezier(o));continue}}n.types.push(m.Linear)}u&&g(h,n,this.duration,this.sample,t);for(var a,d,c=n.ratios,f=!0,l=1,p=c.length;l<p;l++)if(a=c[l]-c[l-1],1===l)d=a;else if(1e-6<Math.abs(a-d)){f=!1;break}n._findFrameIndex=f?y:v;e=n.values[0];return null==e||n._lerp||("number"==typeof e?n._lerp=m.prototype._lerpNumber:e instanceof cc.Quat?n._lerp=m.prototype._lerpQuat:e instanceof cc.Vec2||e instanceof cc.Vec3?n._lerp=m.prototype._lerpVector:e.lerp&&(n._lerp=m.prototype._lerpObject)),n},createTargetCurves:function(t,e,i){var n=e.props,r=e.comps;if(n)for(var s in n){var h=n[s],s=this.createPropCurve(t,s,h);i.push(s)}if(r)for(var o in r){var a=t.getComponent(o);if(a){var c,l=r[o];for(c in l){var u=l[c],u=this.createPropCurve(a,c,u);i.push(u)}}}},createCurves:function(t,e){var i,n=this.curveData,r=n.paths,s=[];for(i in this.createTargetCurves(e,n,s),r){var o,a=cc.find(i,e);a&&(o=r[i],this.createTargetCurves(a,o,s))}return s}});cc.AnimationClip=e.exports=a},{"../core/utils/binary-search":256,"./animation-curves":12,"./motion-path-helper":18,"./types":20}],12:[function(t,e,o){"use strict";var a=t("./bezier").bezierByTime,_=t("../core/utils/binary-search").binarySearchEpsilon,d=t("./types").WrapModeMask,f=t("./types").WrappedInfo;function l(t,e){var i;return"string"==typeof e?(i=cc.easing[e])?t=i(t):cc.errorID(3906,e):Array.isArray(e)&&(t=a(e,t)),t}t=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:void 0});function i(){this.events=[]}var n,r,s=cc.Class({name:"cc.DynamicAnimCurve",extends:t,ctor:function(){this._cachedIndex=0},properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:_,_lerp:void 0,_lerpNumber:function(t,e,i){return t+(e-t)*i},_lerpObject:function(t,e,i){return t.lerp(e,i)},_lerpQuat:(r=cc.quat(),function(t,e,i){return t.lerp(e,i,r)}),_lerpVector:(n=cc.v3(),function(t,e,i){return t.lerp(e,i,n)}),sample:function(t,e,i){var n,r,s,o=this.values,a=this.ratios,c=a.length;0!==c&&(r=!0,(n=this._cachedIndex)<0&&0<(n=~n)&&n<a.length&&(s=a[n-1],n=a[n],s<e&&e<n&&(r=!1)),r&&(this._cachedIndex=this._findFrameIndex(a,e)),r=(s=this._cachedIndex)<0?(s=~s)<=0?o[0]:c<=s?o[c-1]:(n=o[s-1],this._lerp?(c=(e-(r=a[s-1]))/(a[s]-r),(e=this.types[s-1])&&(c=l(c,e)),a=o[s],this._lerp(n,a,c)):n):o[s],this.target[this.prop]=r)}}),c=(s.Linear=null,s.Bezier=function(t){return t},i.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},cc.Class({name:"cc.EventAnimCurve",extends:t,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new f}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&--t,0|t},sample:function(h,u,t){var e=this.ratios.length,i=t.getWrappedInfo(t.time,this._wrappedInfo),n=i.direction,r=_(this.ratios,i.ratio);if(r<0&&(r=~r-1,n<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=NaN),i.frameIndex=r,!this._lastWrappedInfo)return this._fireEvent(r),void(this._lastWrappedInfo=new f(i));var s=t.wrapMode,o=this._wrapIterations(i.iterations),t=this._lastWrappedInfo,a=this._wrapIterations(t.iterations),c=t.frameIndex,t=t.direction,l=-1!==a&&o!==a;if(c===r&&l&&1===e)this._fireEvent(0);else if(c!==r||l){n=t;do{if(c!==r){if(-1===n&&0===c&&0<r?((s&d.PingPong)===d.PingPong?n*=-1:c=e,a++):1===n&&c===e-1&&r<e-1&&((s&d.PingPong)===d.PingPong?n*=-1:c=-1,a++),c===r)break;if(o<a)break}}while(c+=n,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[c]),c!==r&&-1<c&&c<e)}this._lastWrappedInfo.set(i)},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid)for(var i=this.target._components,n=0;n<e.length;n++)for(var r=e[n],s=r.func,o=0;o<i.length;o++){var a=i[o],c=a[s];c&&c.apply(a,r.params)}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;e=e.getWrappedInfo(t,this._wrappedInfo),t=e.direction,e=_(this.ratios,e.ratio);e<0&&(e=~e-1,t<0&&(e+=1),this._ignoreIndex=e)}}));e.exports={AnimCurve:t,DynamicAnimCurve:s,EventAnimCurve:c,EventInfo:i,computeRatioByType:l,quickFindIndex:function(t,e){var i=t.length-1;if(0==i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];return r<e?~t.length:(t=(e=(e-n)/(r-n))/(1/i))-(r=0|t)<1e-6?r:1+r-t<1e-6?1+r:~(1+r)}}},{"../core/utils/binary-search":256,"./bezier":15,"./types":20}],13:[function(t,e,i){"use strict";var n=cc.js,r=cc.Class({ctor:function(){this._anims=new n.array.MutableForwardIterator([]),this._delayEvents=[],cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];n._isPlaying&&!n._isPaused&&n.update(t)}for(var r=this._delayEvents,s=0;s<r.length;s++){var o=r[s];o.target[o.func].apply(o.target,o.args)}r.length=0},destruct:function(){},addAnimation:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},removeAnimation:function(t){t=this._anims.array.indexOf(t);0<=t?this._anims.fastRemoveAt(t):cc.errorID(3907)},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i})}});cc.AnimationManager=e.exports=r},{}],14:[function(t,e,h){"use strict";var i=cc.js,n=t("./playable"),t=t("./types"),c=t.WrappedInfo,r=t.WrapMode,l=t.WrapModeMask;function s(t,e){n.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new c,this._lastWrappedInfo=null,this._process=o,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=r.Normal,this.time=0,this._target=null,this._lastframeEventOn=!1,this.emit=function(){for(var t=new Array(arguments.length),e=0,i=t.length;e<i;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)}}i.extend(s,n);t=s.prototype;function o(){var t,e=this.sample();this._lastframeEventOn&&(t=this._lastWrappedInfo||(this._lastWrappedInfo=new c(e)),1<this.repeatCount&&(0|e.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(e)),e.stopped&&(this.stop(),this.emit("finished",this))}function a(){for(var t=this.time,e=this.duration,i=(e<t?0===(t%=e)&&(t=e):t<0&&0!==(t%=e)&&(t+=e),t/e),n=this.curves,r=0,s=n.length;r<s;r++)n[r].sample(t,i,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=i),(0<this.time&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i)}t._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},t.on=function(t,e,i){return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),this._target.on(t,e,i)):null},t.once=function(t,e,i){var n;return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),(n=this)._target.once(t,function(t){e.call(i,t),n._lastframeEventOn=!1})):null},t.off=function(t,e,i){this._target&&this._target.isValid&&("lastframe"===t&&(this._target.hasEventListener(t)||(this._lastframeEventOn=!1)),this._target.off(t,e,i))},t._setEventTarget=function(t){this._target=t},t.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},t.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},t.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},t.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},t.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;for(var e=this.curves,i=0,n=e.length;i<n;i++){var r=e[i];r.onTimeChangedManually&&r.onTimeChangedManually(t,this)}},t.update=function(t){0<this._delayTime&&(this._delayTime-=t,0<this._delayTime)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},t._needRevers=function(t){var e=this.wrapMode,i=!1;return(e&l.PingPong)===l.PingPong&&(t-(0|t)==0&&0<t&&--t,1&t&&(i=!i)),i=(e&l.Reverse)===l.Reverse?!i:i},t.getWrappedInfo=function(t,e){e=e||new c;var i=!1,n=this.duration,r=this.repeatCount,s=0<t?t/n:-t/n,r=(r<=s&&(i=!0,t=(r=0===(r=(s=r)-(0|r))?1:r)*n*(0<t?1:-1)),n<t?t=0==(r=t%n)?n:r:t<0&&0!==(t%=n)&&(t+=n),!1),o=this._wrapMode&l.ShouldWrap,a=(r=o?this._needRevers(s):r)?-1:1;return this.speed<0&&(a*=-1),e.ratio=(t=o&&r?n-t:t)/n,e.time=t,e.direction=a,e.stopped=i,e.iterations=s,e},t.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),e=this.curves,i=0,n=e.length;i<n;i++)e[i].sample(t.time,t.ratio,this);return t},i.get(t,"clip",function(){return this._clip}),i.get(t,"name",function(){return this._name}),i.obsolete(t,"AnimationState.length","duration"),i.getset(t,"curveLoaded",function(){return 0<this.curves.length},function(){this.curves.length=0}),i.getset(t,"wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&l.Loop?this.repeatCount=1/0:this.repeatCount=1}),i.getset(t,"repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t;var e=this._wrapMode&l.ShouldWrap,i=(this.wrapMode&l.Reverse)===l.Reverse;this._process=1/0!==t||e||i?o:a}),i.getset(t,"delay",function(){return this._delay},function(t){this._delayTime=this._delay=t}),cc.AnimationState=e.exports=s},{"./playable":19,"./types":20}],15:[function(t,e,i){"use strict";var h=Math.cos,u=Math.acos,_=Math.max,d=2*Math.PI,f=Math.sqrt;function p(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}e.exports={bezier:function(t,e,i,n,r){var s=1-r;return s*(s*(t+(3*e-t)*r)+3*i*r*r)+n*r*r*r},bezierByTime:function(t,e){var e=function(t,e){var i,n,r=+e,s=e-t[0],o=3*r,a=3*s,t=3*(e-t[2]),t=1/3*(s=(o-6*s+t)*(e=1/(a-r-t+(e-1)))),o=1/3*(3*(a=(a-o)*e)-s*s);if((r=(a=(s=(2*s*s*s-9*s*a+27*(r*e))/27)/2)*a+(l=1/3*o)*l*l)<0)return l=f((e=1/3*-o)*e*e),e=u((o=-s/(2*l))<-1?-1:1<o?1:o),i=(s=2*p(l))*h(e*(1/3))-t,n=s*h((e+d)*(1/3))-t,o=s*h((e+2*d)*(1/3))-t,0<=i&&i<=1?0<=n&&n<=1?0<=o&&o<=1?_(i,n,o):_(i,n):0<=o&&o<=1?_(i,o):i:0<=n&&n<=1?0<=o&&o<=1?_(n,o):n:o;if(0==r)return n=-(c=a<0?p(-a):-p(a))-t,0<=(i=2*c-t)&&i<=1?0<=n&&n<=1?_(i,n):i:n;var c,l=f(r);return i=(c=p(-a+l))-p(a+l)-t}(t,e),i=t[1];return((1-e)*(i+(t[3]-i)*e)*3+e*e)*e}}},{}],16:[function(t,e,i){"use strict";var n={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2)},bounceIn:function(t){return 1-n.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*n.bounceIn(2*t):.5*n.bounceOut(2*t-1)+.5},smooth:function(t){return t<=0?0:1<=t?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:1<=t?1:t*t*t*(t*(6*t-15)+10)}};function r(e,i){return function(t){return t<.5?i(2*t)/2:e(2*t-1)/2+.5}}n.quadOutIn=r(n.quadIn,n.quadOut),n.cubicOutIn=r(n.cubicIn,n.cubicOut),n.quartOutIn=r(n.quartIn,n.quartOut),n.quintOutIn=r(n.quintIn,n.quintOut),n.sineOutIn=r(n.sineIn,n.sineOut),n.expoOutIn=r(n.expoIn,n.expoOut),n.circOutIn=r(n.circIn,n.circOut),n.backOutIn=r(n.backIn,n.backOut),n.bounceIn=function(t){return 1-n.bounceOut(1-t)},n.bounceInOut=function(t){return t<.5?.5*n.bounceIn(2*t):.5*n.bounceOut(2*t-1)+.5},n.bounceOutIn=r(n.bounceIn,n.bounceOut),cc.easing=e.exports=n},{}],17:[function(t,e,i){"use strict";t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":10,"./animation-clip":11,"./animation-curves":12,"./animation-manager":13,"./animation-state":14,"./bezier":15,"./easing":16,"./motion-path-helper":18,"./types":20}],18:[function(t,e,n){"use strict";var G=t("./animation-curves").DynamicAnimCurve,z=t("./animation-curves").computeRatioByType,i=t("./bezier").bezier,U=t("../core/utils/binary-search").binarySearchEpsilon,W=cc.v2;function H(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function s(){this.start=W(),this.end=W(),this.startCtrlPoint=W(),this.endCtrlPoint=W()}H.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t=1;t<this.points.length;t++){var e,i=this.points[t-1],n=this.points[t];(e=new s).start=i.pos,e.startCtrlPoint=i.out,e.end=n.pos,e.endCtrlPoint=n.in,this.beziers.push(e),this.length+=e.getLength()}for(var r=0,t=0;t<this.beziers.length;t++)e=this.beziers[t],this.ratios[t]=e.getLength()/this.length,this.progresses[t]=r+=this.ratios[t];return this.beziers},s.prototype.getPointAt=function(t){t=this.getUtoTmapping(t);return this.getPoint(t)},s.prototype.getPoint=function(t){var e=i(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),t=i(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new W(e,t)},s.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},s.prototype.getLengths=function(t){if(t=t||(this.__arcLengthDivisions||200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),s=W(),o=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),s.x=r.x-e.x,s.y=r.y-e.y,o+=s.mag(),n.push(o),r=e;return this.cacheArcLengths=n},s.prototype.getUtoTmapping=function(t,e){for(var i,n=this.getLengths(),r=0,s=n.length,o=e||t*n[s-1],a=0,c=s-1;a<=c;)if((i=n[r=Math.floor(a+(c-a)/2)]-o)<0)a=r+1;else{if(!(0<i)){c=r;break}c=r-1}if(n[r=c]===o)return r/(s-1);e=n[r];return(r+(o-e)/(n[r+1]-e))/(s-1)},e.exports={sampleMotionPaths:function(h,t,u,_,d){function f(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:W(t[2],t[3]),pos:W(t[0],t[1]),out:W(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}var e=t.values=t.values.map(function(t){return t=Array.isArray(t)?2===t.length?cc.v2(t[0],t[1]):cc.v3(t[0],t[1],t[2]):t});if(0!==h.length&&0!==e.length){for(var p=!1,m=0;m<h.length;m++){var y=h[m];if(y&&!function(t){if(Array.isArray(t)){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return}return 1}}(y)&&(cc.errorID(3904,d?d.name:"","position",m),y=null),y&&0<y.length){p=!0;break}}if(p&&1!==e.length){for(var g=t.types,i=t.ratios,v=t.values=[],x=t.types=[],b=t.ratios=[],A=0,C=G.Linear,n=0,S=h.length;n<S-1;n++){var T=h[n],w=i[n],E=i[n+1]-w,M=e[n],I=e[n+1],B=g[n],R=[],r=A/E,P=1/(E*u*_);if(T&&0<T.length){var D=[];D.push(f(M));for(var s=0,L=T.length;s<L;s++){var V=f(T[s]);D.push(V)}D.push(f(I));for(var o,O,F,a,c,l=new H(D),N=(l.computeBeziers(),l.progresses);1e-6<1-r;)c=(a=z(a=r,B))<0?(F=(0-a)*(o=l.beziers[0]).getLength(),O=o.start.sub(o.endCtrlPoint).normalize(),o.start.add(O.mul(F))):1<a?(F=(a-1)*(o=l.beziers[l.beziers.length-1]).getLength(),O=o.end.sub(o.startCtrlPoint).normalize(),o.end.add(O.mul(F))):(a=(a-=0<(c=(c=U(N,a))<0?~c:c)?N[c-1]:0)/l.ratios[c],l.beziers[c].getPointAt(a)),R.push(c),r+=P}else for(;1e-6<1-r;)a=z(a=r,B),R.push(M.lerp(I,a)),r+=P;for(C="constant"===B?B:G.Linear,s=0,L=R.length;s<L;s++)k(R[s],C,w+A+P*s*E);A=1e-6<Math.abs(r-1)?(r-1)*E:0}i[i.length-1]!==b[b.length-1]&&k(e[e.length-1],C,i[i.length-1])}}function k(t,e,i){v.push(t),x.push(e),b.push(i)}},Curve:H,Bezier:s}},{"../core/utils/binary-search":256,"./animation-curves":12,"./bezier":15}],19:[function(t,e,i){"use strict";var n=cc.js,r=t("../core/CCDebug");function s(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}function o(){}t=s.prototype;n.get(t,"isPlaying",function(){return this._isPlaying},!0),n.get(t,"isPaused",function(){return this._isPaused},!0);t.onPlay=o,t.onPause=o,t.onResume=o,t.onStop=o,t.onError=o,t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(r.getError(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=s},{"../core/CCDebug":27}],20:[function(t,e,i){"use strict";var n={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},r=cc.Enum({Default:0,Normal:1,Reverse:n.Reverse,Loop:n.Loop,LoopReverse:n.Loop|n.Reverse,PingPong:n.PingPong,PingPongReverse:n.PingPong|n.Reverse});function s(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.WrapMode=r,s.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.exports={WrapModeMask:n,WrapMode:r,WrappedInfo:s}},{}],21:[function(t,e,h){"use strict";function n(t){r.call(this),this._shouldRecycleOnEnded=!1,this._src=t,this._element=null,this.id=0,this._volume=1,this._loop=!1,this._nextTime=0,this._state=n.State.INITIALZING,this._onended=function(){this._state=n.State.STOPPED,this.emit("ended")}.bind(this)}var i,r=t("../core/event/event-target"),s=t("../core/platform/CCSys"),o=t("../core/assets/CCAudioClip").LoadMode,a=!1,c=[],l=(cc.js.extend(n,r),n.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2,STOPPED:3},(t=n.prototype)._bindEnded=function(t){t=t||this._onended;var e=this._element;this._src&&e instanceof HTMLAudioElement?e.addEventListener("ended",t):e.onended=t},t._unbindEnded=function(){var t=this._element;t instanceof HTMLAudioElement?t.removeEventListener("ended",this._onended):t&&(t.onended=null)},t._onLoaded=function(){this._createElement(),this.setVolume(this._volume),this.setLoop(this._loop),0!==this._nextTime&&this.setCurrentTime(this._nextTime),this.getState(!1)===n.State.PLAYING?this.play():this._state=n.State.INITIALZING},t._createElement=function(){var t=this._src._nativeAsset;t instanceof HTMLAudioElement?(this._element||(this._element=document.createElement("audio")),this._element.src=t.src):this._element=new l(t,this)},t.play=function(){this._state=n.State.PLAYING,this._element&&(this._bindEnded(),this._element.play(),this._touchToPlay())},t._touchToPlay=function(){var t;this._src&&this._src.loadMode===o.DOM_AUDIO&&this._element.paused&&c.push({instance:this,offset:0,audio:this._element}),a||(a=!0,t="ontouchend"in window?"touchend":"mousedown",cc.game.canvas.addEventListener(t,function(){for(var t;t=c.pop();)t.audio.play(t.offset)}))},t.destroy=function(){this._element=null},t.pause=function(){this._element&&this.getState()===n.State.PLAYING&&(this._unbindEnded(),this._element.pause(),this._state=n.State.PAUSED)},t.resume=function(){this._element&&this.getState()===n.State.PAUSED&&(this._bindEnded(),this._element.play(),this._state=n.State.PLAYING)},t.stop=function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(t){}for(var t=0;t<c.length;t++)if(c[t].instance===this){c.splice(t,1);break}this._unbindEnded(),this.emit("stop"),this._state=n.State.STOPPED}},t.setLoop=function(t){this._loop=t,this._element&&(this._element.loop=t)},t.getLoop=function(){return this._loop},t.setVolume=function(t){this._volume=t,this._element&&(this._element.volume=t)},t.getVolume=function(){return this._volume},t.setCurrentTime=function(e){if(this._element){this._nextTime=0,this._unbindEnded(),this._bindEnded(function(){this._bindEnded()}.bind(this));try{this._element.currentTime=e}catch(t){var i=this._element;i.addEventListener&&i.addEventListener("loadedmetadata",function t(){i.removeEventListener("loadedmetadata",t),i.currentTime=e})}}else this._nextTime=e},t.getCurrentTime=function(){return this._element?this._element.currentTime:0},t.getDuration=function(){return this._element?this._element.duration:0},t.getState=function(t){return(t=void 0===t?!0:t)&&this._forceUpdatingState(),this._state},t._forceUpdatingState=function(){var t=this._element;t&&(n.State.PLAYING===this._state&&t.paused?this._state=n.State.STOPPED:n.State.STOPPED!==this._state||t.paused||(this._state=n.State.PLAYING))},Object.defineProperty(t,"src",{get:function(){return this._src},set:function(i){var t;return this._unbindEnded(),i?(this._src=i).loaded?this._onLoaded():(t=this,i.once("load",function(){i===t._src&&t._onLoaded()}),cc.loader.load({url:i.nativeUrl,skips:["Loader"]},function(t,e){t?cc.error(t):i.loaded||(i._nativeAsset=e)})):(this._src=null,this._element instanceof l?this._element=null:this._element&&(this._element.src=""),this._state=n.State.INITIALZING),i},enumerable:!0,configurable:!0}),Object.defineProperty(t,"paused",{get:function(){return!this._element||this._element.paused},enumerable:!0,configurable:!0}),i=cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE||cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU||cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?.01:0,function(t,e){this._audio=e,this._context=s.__audioSupport.context,this._buffer=t,this._gainObj=this._context.createGain(),this.volume=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currentTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)});(t=l.prototype).play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e,i=this._context.createBufferSource(),n=(i.buffer=this._buffer,i.connect(this._gainObj),i.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t),this._buffer.duration),r=t;this._loop?i.start?i.start(0,r):i.notoGrainOn?i.noteGrainOn(0,r):i.noteOn(0,r):(n=n-t,i.start?i.start(0,r,n):i.noteGrainOn?i.noteGrainOn(0,r,n):i.noteOn(0,r,n)),(this._currentSource=i).onended=this._endCallback,i.context.state&&"suspended"!==i.context.state||0!==this._context.currentTime||(e=this,clearTimeout(this._currentTimer),this._currentTimer=setTimeout(function(){0===e._context.currentTime&&c.push({instance:e._audio,offset:t,audio:e})},10)),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&"interrupted"===i.context.state&&i.context.resume()},t.pause=function(){var t;clearTimeout(this._currentTimer),this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,t=this._currentSource,this._currentSource=null,this._startTime=-1,t&&t.stop(0))},Object.defineProperty(t,"paused",{get:function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loop",{get:function(){return this._loop},set:function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(e){if(this._volume=e,this._gainObj.gain.setTargetAtTime)try{this._gainObj.gain.setTargetAtTime(e,this._context.currentTime,i)}catch(t){this._gainObj.gain.setTargetAtTime(e,this._context.currentTime,.01)}else this._gainObj.gain.value=e;s.os===s.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play())},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentTime",{get:function(){return this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration),this.playedLength},set:function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"duration",{get:function(){return this._buffer.duration},enumerable:!0,configurable:!0}),e.exports=cc.Audio=n},{"../core/assets/CCAudioClip":35,"../core/event/event-target":115,"../core/platform/CCSys":198}],22:[function(t,e,n){"use strict";function s(t){function e(){var t;r(this.id)&&(delete c[this.id],t=n.indexOf(this.id),cc.js.array.fastRemoveAt(n,t)),(t=this)._shouldRecycleOnEnded&&(t._finishCallback=null,t.off("ended"),t.off("stop"),t.src=null,h.includes(t)||(h.length<32?h.push(t):t.destroy()),t._shouldRecycleOnEnded=!1)}var i=d++,n=(n=l[t])||(l[t]=[]);return u._maxAudioInstance<=n.length&&(t=n.shift(),r(t).stop()),(t=h.pop()||new a).on("ended",function(){this._finishCallback&&this._finishCallback(),e.call(this)},t),t.on("stop",e,t),t.id=i,c[i]=t,n.push(i),t}function r(t){return c[t]}function o(t){return void 0===t?t=1:"string"==typeof t&&(t=Number.parseFloat(t)),t}var a=t("./CCAudio"),_=t("../core/assets/CCAudioClip"),i=cc.js,d=0,c=i.createMap(!0),l={},h=[],u={AudioState:a.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:c,play:function(t,e,i){var n,r=t;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),n=s(r=t),_._loadByUrl(r,function(t,e){e&&(n.src=e)});else{if(!t)return;r=t.nativeUrl,(n=s(r)).src=t}return n._shouldRecycleOnEnded=!0,n.setLoop(e||!1),i=o(i),n.setVolume(i),n.play(),n.id},setLoop:function(t,e){t=r(t);t&&t.setLoop&&t.setLoop(e)},isLoop:function(t){t=r(t);return!(!t||!t.getLoop)&&t.getLoop()},setVolume:function(t,e){t=r(t);t&&t.setVolume(e)},getVolume:function(t){t=r(t);return t?t.getVolume():1},setCurrentTime:function(t,e){t=r(t);return!!t&&(t.setCurrentTime(e),!0)},getCurrentTime:function(t){t=r(t);return t?t.getCurrentTime():0},getDuration:function(t){t=r(t);return t?t.getDuration():0},getState:function(t){t=r(t);return t?t.getState():this.AudioState.ERROR},setFinishCallback:function(t,e){t=r(t);t&&(t._finishCallback=e)},pause:function(t){t=r(t);return!!t&&(t.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var t in c){var e=c[t];e.getState()===a.State.PLAYING&&(this._pauseIDCache.push(t),e.pause())}},resume:function(t){t=r(t);t&&t.resume()},resumeAll:function(){for(var t=0;t<this._pauseIDCache.length;++t){var e=this._pauseIDCache[t],e=r(e);e&&e.resume()}this._pauseIDCache.length=0},stop:function(t){t=r(t);return!!t&&(t.stop(),!0)},stopAll:function(){for(var t in c){t=c[t];t&&t.stop()}},setMaxAudioInstance:function(t){this._maxAudioInstance=t},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var e=t;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),e=t;else{if(!t)return;e=t.nativeUrl}var i=l[e];if(i)for(;0<i.length;){var n=i.pop(),r=c[n];r&&(r.stop(),delete c[n])}},uncacheAll:function(){var t,e;for(e in this.stopAll(),c)(t=c[e])&&t.destroy();for(;t=h.pop();)t.destroy();c=i.createMap(!0),l={}},getProfile:function(t){},preload:function(t,e){cc.warn("`cc.audioEngine.preload` is deprecated, use `cc.loader.loadRes(url, cc.AudioClip)` instead please."),cc.loader.load(t,e&&function(t){t||e()})},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t},_breakCache:null,_break:function(){for(var t in this._breakCache=[],c){var e=c[t];e.getState()===a.State.PLAYING&&(this._breakCache.push(t),e.pause())}},_restore:function(){if(this._breakCache){for(;0<this._breakCache.length;){var t=this._breakCache.pop(),t=r(t);t&&t.resume&&t.resume()}this._breakCache=null}},_music:{id:-1,loop:!1,volume:1},_effect:{volume:1,pauseCache:[]},playMusic:function(t,e){var i=this._music;return this.stop(i.id),i.id=this.play(t,e,i.volume),i.loop=e,i.id},stopMusic:function(){this.stop(this._music.id)},pauseMusic:function(){return this.pause(this._music.id),this._music.id},resumeMusic:function(){return this.resume(this._music.id),this._music.id},getMusicVolume:function(){return this._music.volume},setMusicVolume:function(t){t=o(t);var e=this._music;return e.volume=t,this.setVolume(e.id,e.volume),e.volume},isMusicPlaying:function(){return this.getState(this._music.id)===this.AudioState.PLAYING},playEffect:function(t,e){return this.play(t,e||!1,this._effect.volume)},setEffectsVolume:function(t){t=o(t);var e,i=this._music.id;for(e in this._effect.volume=t,c){var n=c[e];n&&n.id!==i&&u.setVolume(e,t)}},getEffectsVolume:function(){return this._effect.volume},pauseEffect:function(t){return this.pause(t)},pauseAllEffects:function(){var t,e=this._music.id,i=this._effect;for(t in i.pauseCache.length=0,c){var n=c[t];n&&n.id!==e&&n.getState()===this.AudioState.PLAYING&&(i.pauseCache.push(t),n.pause())}},resumeEffect:function(t){this.resume(t)},resumeAllEffects:function(){for(var t=this._effect.pauseCache,e=0;e<t.length;++e){var i=t[e],i=c[i];i&&i.resume()}},stopEffect:function(t){return this.stop(t)},stopAllEffects:function(){var t,e=this._music.id;for(t in c){var i=c[t];i&&i.id!==e&&i.getState()===u.AudioState.PLAYING&&i.stop()}}};e.exports=cc.audioEngine=u},{"../core/assets/CCAudioClip":35,"./CCAudio":21}],23:[function(t,e,i){"use strict";var n={name:"Jacob__Codec"};n.Base64=t("./base64"),n.GZip=t("./gzip"),n.unzip=function(){return n.GZip.gunzip.apply(n.GZip,arguments)},n.unzipBase64=function(){var e=n.Base64.decode.apply(n.Base64,arguments);try{return n.GZip.gunzip.call(n.GZip,e)}catch(t){return e.slice(7)}},n.unzipBase64AsArray=function(t,e){e=e||1;for(var i,n=this.unzipBase64(t),r=[],s=0,o=n.length/e;s<o;s++)for(r[s]=0,i=e-1;0<=i;--i)r[s]+=n.charCodeAt(s*e+i)<<8*i;return r},n.unzipAsArray=function(t,e){e=e||1;for(var i,n=this.unzip(t),r=[],s=0,o=n.length/e;s<o;s++)for(r[s]=0,i=e-1;0<=i;--i)r[s]+=n.charCodeAt(s*e+i)<<8*i;return r},cc.codec=e.exports=n},{"./base64":24,"./gzip":25}],24:[function(t,e,i){"use strict";var l=t("../core/utils/misc").BASE64_VALUES,t={name:"Jacob__Codec__Base64",decode:function(t){var e,i,n,r,s,o,a=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)n=l[t.charCodeAt(c++)],e=(15&(r=l[t.charCodeAt(c++)]))<<4|(s=l[t.charCodeAt(c++)])>>2,i=(3&s)<<6|(o=l[t.charCodeAt(c++)]),a.push(String.fromCharCode(n<<2|r>>4)),64!==s&&a.push(String.fromCharCode(e)),64!==o&&a.push(String.fromCharCode(i));return a=a.join("")},decodeAsArray:function(t,e){for(var i,n=this.decode(t),r=[],s=0,o=n.length/e;s<o;s++)for(r[s]=0,i=e-1;0<=i;--i)r[s]+=n.charCodeAt(s*e+i)<<8*i;return r}};e.exports=t},{"../core/utils/misc":264}],25:[function(t,e,i){"use strict";function p(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(p.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0}p.gunzip=function(t){return t.constructor===Array||(t.constructor,String),new p(t).gunzip()[0][0]},p.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},p.LITERALS=288,p.NAMEMAX=256,p.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],p.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],p.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],p.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},p.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},p.prototype.byteAlign=function(){this.bb=1},p.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},p.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return e=t?p.bitReverse[e]>>8-t:e},p.prototype.flushBuffer=function(){this.bIdx=0},p.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},p.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},p.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,0<=(t=this.IsPat()))e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(0<=(t=this.IsPat()))e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},p.prototype.CreateTree=function(t,e,i,n){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},p.prototype.DecodeValue=function(t){for(var e,i,n=0,r=t[n];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,i=0;i<e;i++)if(t[i]===r){n=i;break}}else{if(!(32768&r.b0))return r.b0;r=t[++n]}return-1},p.prototype.DeflateLoop=function(){do{var t,h=this.readBit(),e=this.readBits(2);if(0===e)for(this.byteAlign(),t=this.readByte(),t|=this.readByte()<<8,o=this.readByte(),65535&(t^~(o|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");t--;)i=this.readByte(),this.addBuffer(i);else if(1===e)for(;;)if(23<(n=p.bitReverse[this.readBits(7)]>>1)?199<(n=n<<1|this.readBit())?n=(n-=128)<<1|this.readBit():143<(n-=48)&&(n+=136):n+=256,n<256)this.addBuffer(n);else{if(256===n)break;for(n-=257,c=this.readBits(p.cplext[n])+p.cplens[n],n=p.bitReverse[this.readBits(5)]>>3,8<p.cpdext[n]?(l=this.readBits(8),l|=this.readBits(p.cpdext[n]-8)<<8):l=this.readBits(p.cpdext[n]),l+=p.cpdist[n],n=0;n<c;n++){var i=this.buf32k[this.bIdx-l&32767];this.addBuffer(i)}}else if(2===e){var n,r=new Array(320),s=257+this.readBits(5),o=1+this.readBits(5),u=4+this.readBits(4);for(n=0;n<19;n++)r[n]=0;for(n=0;n<u;n++)r[p.border[n]]=this.readBits(3);for(c=this.distanceTree.length,a=0;a<c;a++)this.distanceTree[a]=new p.HufNode;if(this.CreateTree(this.distanceTree,19,r,0))return this.flushBuffer(),1;for(var _,d=s+o,a=0;a<d;)if((n=this.DecodeValue(this.distanceTree))<16)r[a++]=n;else if(16===n){if(d<a+(n=3+this.readBits(2)))return this.flushBuffer(),1;for(_=a?r[a-1]:0;n--;)r[a++]=_}else{if(d<a+(n=17===n?3+this.readBits(3):11+this.readBits(7)))return this.flushBuffer(),1;for(;n--;)r[a++]=0}for(c=this.literalTree.length,a=0;a<c;a++)this.literalTree[a]=new p.HufNode;if(this.CreateTree(this.literalTree,s,r,0))return this.flushBuffer(),1;for(c=this.literalTree.length,a=0;a<c;a++)this.distanceTree[a]=new p.HufNode;var c,l,f=new Array;for(a=s;a<r.length;a++)f[a-s]=r[a];if(this.CreateTree(this.distanceTree,o,f,0))return this.flushBuffer(),1;for(;;)if(256<=(n=this.DecodeValue(this.literalTree))){if(0===(n-=256))break;for(n--,c=this.readBits(p.cplext[n])+p.cplens[n],n=this.DecodeValue(this.distanceTree),8<p.cpdext[n]?(l=this.readBits(8),l|=this.readBits(p.cpdext[n]-8)<<8):l=this.readBits(p.cpdext[n]),l+=p.cpdist[n];c--;){i=this.buf32k[this.bIdx-l&32767];this.addBuffer(i)}}else this.addBuffer(n)}}while(!h);return this.flushBuffer(),this.byteAlign(),0},p.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},p.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var t=this.readByte(),e=(t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),e=((e|=this.readByte()<<8)|this.readByte()<<16|this.readByte()<<24,this.readByte()),i=((e|=this.readByte()<<8)|this.readByte()<<16|this.readByte()<<24,this.readByte()),n=(i|=this.readByte()<<8,this.readByte());for(n|=this.readByte()<<8,s=0,this.nameBuf=[];i--;){var r=this.readByte();"/"===r|":"===r?s=0:s<p.NAMEMAX-1&&(this.nameBuf[s++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var s=0;s<n;)r=this.readByte(),s++;8==t&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},p.prototype.skipdir=function(){var t,e,i,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,this.readByte(),this.readByte(),t=this.readByte(),t=(t=(t|=this.readByte()<<8)|this.readByte()<<16)|this.readByte()<<24),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],e=0;e<this.len;e++)this.readByte();if(8&this.gpflags)for(e=0,this.nameBuf=[];i=this.readByte();)(e="7"!==i&&":"!==i?e:0)<p.NAMEMAX-1&&(this.nameBuf[e++]=i);if(16&this.gpflags)for(;i=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),t=this.readByte(),t=(t=(t|=this.readByte()<<8)|this.readByte()<<16)|this.readByte()<<24,this.modeZIP&&this.nextFile()},e.exports=p},{}],26:[function(t,e,i){"use strict";!function(){function Q(t){throw t}var $=void 0,tt=!0,o=this;function t(t,e){var i,n=t.split("."),r=o;n[0]in r||!r.execScript||r.execScript("var "+n[0]);for(;n.length&&(i=n.shift());)n.length||e===$?r=r[i]||(r[i]={}):r[i]=e}var et="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function a(t){if("string"==typeof t){for(var e=t.split(""),i=0,n=e.length;i<n;i++)e[i]=(255&e[i].charCodeAt(0))>>>0;t=e}for(var r,s=1,o=0,a=t.length,c=0;0<a;){for(a-=r=1024<a?1024:a;o+=s+=t[c++],--r;);s%=65521,o%=65521}return(o<<16|s)>>>0}function it(t,e){this.index="number"==typeof e?e:0,this.i=0,this.buffer=t instanceof(et?Uint8Array:Array)?t:new(et?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&Q(Error("invalid index")),this.buffer.length<=this.index&&this.f()}it.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(et?Uint8Array:Array)(i<<1);if(et)n.set(e);else for(t=0;t<i;++t)n[t]=e[t];return this.buffer=n},it.prototype.d=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.i,a=r[s];if(i&&1<e&&(t=8<e?(_[255&t]<<24|_[t>>>8&255]<<16|_[t>>>16&255]<<8|_[t>>>24&255])>>32-e:_[t]>>8-e),e+o<8)a=a<<e|t,o+=e;else for(n=0;n<e;++n)a=a<<1|t>>e-n-1&1,8==++o&&(o=0,r[s++]=_[a],a=0,s===r.length&&(r=this.f()));r[s]=a,this.buffer=r,this.i=o,this.index=s},it.prototype.finish=function(){var t=this.buffer,e=this.index;return 0<this.i&&(t[e]<<=8-this.i,t[e]=_[t[e]],e++),et?t.subarray(0,e):(t.length=e,t)};for(var n=new(et?Uint8Array:Array)(256),c=0;c<256;++c){for(var l=u=c,h=7,u=u>>>1;u;u>>>=1)l=l<<1|1&u,--h;n[c]=(l<<h&255)>>>0}var _=n;function S(t){this.buffer=new(et?Uint16Array:Array)(2*t),this.length=0}function v(t){for(var e,i,n,r,s,o,h,a,u=t.length,c=0,_=Number.POSITIVE_INFINITY,l=0;l<u;++l)t[l]>c&&(c=t[l]),t[l]<_&&(_=t[l]);for(e=1<<c,i=new(et?Uint32Array:Array)(e),n=1,r=0,s=2;n<=c;){for(l=0;l<u;++l)if(t[l]===n){for(h=r,a=o=0;a<n;++a)o=o<<1|1&h,h>>=1;for(a=o;a<e;a+=s)i[a]=n<<16|l;++r}++n,r<<=1,s<<=1}return[i,c,_]}function d(t,e){this.h=nt,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=et&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(et?Uint8Array:Array)(32768))}et&&new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),S.prototype.getParent=function(t){return 2*((t-2)/4|0)},S.prototype.push=function(t,e){var i,n,r=this.buffer,s=this.length;for(r[this.length++]=e,r[this.length++]=t;0<s&&(i=this.getParent(s),r[s]>r[i]);)n=r[s],r[s]=r[i],r[i]=n,n=r[s+1],r[s+1]=r[i+1],r[i+1]=n,s=i;return this.length},S.prototype.pop=function(){var t,e,i,n=this.buffer,r=n[0],s=n[1];for(this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],i=0;!((e=2*i+2)>=this.length)&&(e+2<this.length&&n[e+2]>n[e]&&(e+=2),n[e]>n[i]);)t=n[i],n[i]=n[e],n[e]=t,t=n[i+1],n[i+1]=n[e+1],n[e+1]=t,i=e;return{index:s,value:r,length:this.length}};for(var nt=2,f={NONE:0,r:1,j:nt,N:3},rt=[],e=0;e<288;e++)switch(tt){case e<=143:rt.push([e+48,8]);break;case e<=255:rt.push([e-144+400,9]);break;case e<=279:rt.push([e-256,7]);break;case e<=287:rt.push([e-280+192,8]);break;default:Q("invalid literal: "+e)}function E(t,e){this.length=t,this.G=e}d.prototype.n=function(){var h,u,_,d=this.input;switch(this.h){case 0:for(u=0,_=d.length;u<_;){var f,p,m=y=et?d.subarray(u,u+65535):d.slice(u,u+65535),y=(u+=y.length)===_,g=$,t=this.a,e=this.b;if(et){for(t=new Uint8Array(this.a.buffer);t.length<=e+m.length+5;)t=new Uint8Array(t.length<<1);t.set(this.a)}if(t[e++]=0|(y?1:0),f=65536+~(y=m.length)&65535,t[e++]=255&y,t[e++]=y>>>8&255,t[e++]=255&f,t[e++]=f>>>8&255,et)t.set(m,e),e+=m.length,t=t.subarray(0,e);else{for(g=0,p=m.length;g<p;++g)t[e++]=m[g];t.length=e}this.b=e,this.a=t}break;case 1:for(var v,x=new it(new Uint8Array(this.a.buffer),this.b),b=(x.d(1,1,tt),x.d(1,2,tt),st(this,d)),A=0,C=b.length;A<C;A++)if(v=b[A],it.prototype.d.apply(x,rt[v]),256<v)x.d(b[++A],b[++A],tt),x.d(b[++A],5),x.d(b[++A],b[++A],tt);else if(256===v)break;this.a=x.finish(),this.b=this.a.length;break;case nt:var S,T,w,E,M,I,B,R,P,D,i,L,n=new it(new Uint8Array(this.a),this.b),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=Array(19),F=nt;for(n.d(1,1,tt),n.d(F,2,tt),S=st(this,d),F=at(M=ot(this.L,15)),j=at(I=ot(this.K,7)),T=286;257<T&&0===M[T-1];T--);for(w=30;1<w&&0===I[w-1];w--);for(var N,r,k,s,o,G=T,z=w,a=new(et?Uint32Array:Array)(G+z),c=new(et?Uint32Array:Array)(316),U=new(et?Uint8Array:Array)(19),l=N=0;l<G;l++)a[N++]=M[l];for(l=0;l<z;l++)a[N++]=I[l];if(!et)for(l=0,k=U.length;l<k;++l)U[l]=0;for(l=s=0,k=a.length;l<k;l+=N){for(N=1;l+N<k&&a[l+N]===a[l];++N);if(r=N,0===a[l])if(r<3)for(;0<r--;)U[c[s++]=0]++;else for(;0<r;)(o=r-3<(o=r<138?r:138)&&o<r?r-3:o)<=10?(c[s++]=17,c[s++]=o-3,U[17]++):(c[s++]=18,c[s++]=o-11,U[18]++),r-=o;else if(c[s++]=a[l],U[a[l]]++,--r<3)for(;0<r--;)c[s++]=a[l],U[a[l]]++;else for(;0<r;)r-3<(o=r<6?r:6)&&o<r&&(o=r-3),c[s++]=16,c[s++]=o-3,U[16]++,r-=o}for(h=et?c.subarray(0,s):c.slice(0,s),B=ot(U,7),i=0;i<19;i++)O[i]=B[V[i]];for(E=19;4<E&&0===O[E-1];E--);for(R=at(B),n.d(T-257,5,tt),n.d(w-1,5,tt),n.d(E-4,4,tt),i=0;i<E;i++)n.d(O[i],3,tt);for(i=0,L=h.length;i<L;i++)if(P=h[i],n.d(R[P],B[P],tt),16<=P){switch(i++,P){case 16:D=2;break;case 17:D=3;break;case 18:D=7;break;default:Q("invalid code: "+P)}n.d(h[i],D,tt)}for(var W,H,F=[F,M],j=[j,I],X=F[0],Y=F[1],q=j[0],J=j[1],Z=0,K=S.length;Z<K;++Z)if(W=S[Z],n.d(X[W],Y[W],tt),256<W)n.d(S[++Z],S[++Z],tt),H=S[++Z],n.d(q[H],J[H],tt),n.d(S[++Z],S[++Z],tt);else if(256===W)break;this.a=n.finish(),this.b=this.a.length;break;default:Q("invalid compression type")}return this.a};for(var p,m=[],y=3;y<=258;y++)p=function(){var t=y;switch(tt){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:Q("invalid length: "+t)}}(),m[y]=p[2]<<24|p[1]<<16|p[0];var M=et?new Uint32Array(m):m;function st(a,t){function c(t,e){var i,n,r,s=t.G,o=[],a=0,c=M[t.length];switch(o[a++]=65535&c,o[a++]=c>>16&255,o[a++]=c>>24,tt){case 1===s:i=[0,s-1,0];break;case 2===s:i=[1,s-2,0];break;case 3===s:i=[2,s-3,0];break;case 4===s:i=[3,s-4,0];break;case s<=6:i=[4,s-5,1];break;case s<=8:i=[5,s-7,1];break;case s<=12:i=[6,s-9,2];break;case s<=16:i=[7,s-13,2];break;case s<=24:i=[8,s-17,3];break;case s<=32:i=[9,s-25,3];break;case s<=48:i=[10,s-33,4];break;case s<=64:i=[11,s-49,4];break;case s<=96:i=[12,s-65,5];break;case s<=128:i=[13,s-97,5];break;case s<=192:i=[14,s-129,6];break;case s<=256:i=[15,s-193,6];break;case s<=384:i=[16,s-257,7];break;case s<=512:i=[17,s-385,7];break;case s<=768:i=[18,s-513,8];break;case s<=1024:i=[19,s-769,8];break;case s<=1536:i=[20,s-1025,9];break;case s<=2048:i=[21,s-1537,9];break;case s<=3072:i=[22,s-2049,10];break;case s<=4096:i=[23,s-3073,10];break;case s<=6144:i=[24,s-4097,11];break;case s<=8192:i=[25,s-6145,11];break;case s<=12288:i=[26,s-8193,12];break;case s<=16384:i=[27,s-12289,12];break;case s<=24576:i=[28,s-16385,13];break;case s<=32768:i=[29,s-24577,13];break;default:Q("invalid distance")}for(c=i,o[a++]=c[0],o[+a]=c[1],o[5]=c[2],n=0,r=o.length;n<r;++n)h[m++]=o[n];u[o[0]]++,g[o[3]]++,y=t.length+e-1,l=null}var e,_,i,d,n,r,f,l,s,p={},h=et?new Uint16Array(2*t.length):[],m=0,y=0,u=new(et?Uint32Array:Array)(286),g=new(et?Uint32Array:Array)(30),v=a.w;if(!et){for(i=0;i<=285;)u[i++]=0;for(i=0;i<=29;)g[i++]=0}for(u[256]=1,e=0,_=t.length;e<_;++e){for(i=n=0,d=3;i<d&&e+i!==_;++i)n=n<<8|t[e+i];if(p[n]===$&&(p[n]=[]),r=p[n],!(0<y--)){for(;0<r.length&&32768<e-r[0];)r.shift();if(_<=e+3){for(l&&c(l,-1),i=0,d=_-e;i<d;++i)s=t[e+i],h[m++]=s,++u[s];break}if(0<r.length){var x,b=$,A=0,o=$,C=$,S=$,T=t.length,C=0,w=r.length;t:for(;C<w;C++){if(x=r[w-C-1],(o=3)<A){for(S=A;3<S;S--)if(t[x+S-1]!==t[e+S-1])continue t;o=A}for(;o<258&&e+o<T&&t[x+o]===t[e+o];)++o;if(A<o&&(b=x,A=o),258===o)break}f=new E(A,e-b),l?l.length<f.length?(s=t[e-1],h[m++]=s,++u[s],c(f,0)):c(l,-1):f.length<v?l=f:c(f,0)}else l?c(l,-1):(s=t[e],h[m++]=s,++u[s])}r.push(e)}return h[m++]=256,u[256]++,a.L=u,a.K=g,et?h.subarray(0,m):h}function ot(h,t){var e,u,_,i,d,f=h.length,p=new S(572),m=new(et?Uint8Array:Array)(f);if(!et)for(i=0;i<f;i++)m[i]=0;for(i=0;i<f;++i)0<h[i]&&p.push(i,h[i]);if(e=Array(p.length/2),u=new(et?Uint32Array:Array)(p.length/2),1===e.length)return m[p.pop().index]=1,m;for(i=0,d=p.length/2;i<d;++i)e[i]=p.pop(),u[i]=e[i].value;var n,r,s,y,g,o=u.length,a=new(et?Uint16Array:Array)(t),c=new(et?Uint8Array:Array)(t),v=new(et?Uint8Array:Array)(o),l=Array(t),x=Array(t),b=Array(t),A=(1<<t)-o,C=1<<t-1;for(a[t-1]=o,r=0;r<t;++r)A<C?c[r]=0:(c[r]=1,A-=C),A<<=1,a[t-2-r]=(a[t-1-r]/2|0)+o;for(a[0]=c[0],l[0]=Array(a[0]),x[0]=Array(a[0]),r=1;r<t;++r)a[r]>2*a[r-1]+c[r]&&(a[r]=2*a[r-1]+c[r]),l[r]=Array(a[r]),x[r]=Array(a[r]);for(n=0;n<o;++n)v[n]=t;for(s=0;s<a[t-1];++s)l[t-1][s]=u[s],x[t-1][s]=s;for(n=0;n<t;++n)b[n]=0;for(1===c[t-1]&&(--v[0],++b[t-1]),r=t-2;0<=r;--r){for(n=0,g=b[r+1],s=0;s<a[r];s++)(y=l[r+1][g]+l[r+1][g+1])>u[n]?(l[r][s]=y,x[r][s]=o,g+=2):(l[r][s]=u[n],x[r][s]=n,++n);b[r]=0,1===c[r]&&function t(e){var i=x[e][b[e]];i===o?(t(e+1),t(e+1)):--v[i],++b[e]}(r)}for(_=v,i=0,d=e.length;i<d;++i)m[e[i].index]=_[i];return m}function at(t){for(var e,i,n=new(et?Uint16Array:Array)(t.length),r=[],s=[],o=0,a=0,c=t.length;a<c;a++)r[t[a]]=1+(0|r[t[a]]);for(a=1,c=16;a<=c;a++)s[a]=o,1<<a<(o+=0|r[a])&&Q("overcommitted"),o<<=1;for(o<65536&&Q("undercommitted"),a=0,c=t.length;a<c;a++)for(o=s[t[a]],s[t[a]]+=1,e=n[a]=0,i=t[a];e<i;e++)n[a]=n[a]<<1|1&o,o>>>=1;return n}function x(t,e){this.input=t,this.a=new(et?Uint8Array:Array)(32768),this.h=s.j;var i,n={};for(i in(e?"number"!=typeof e.compressionType:e={})||(this.h=e.compressionType),e)n[i]=e[i];n.outputBuffer=this.a,this.z=new d(this.input,n)}var s=f;function r(t,e){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=et?new Uint8Array(t):t,this.s=!1,this.m=A,this.B=!1,e?(e.index&&(this.c=e.index),e.bufferSize&&(this.l=e.bufferSize),e.bufferType&&(this.m=e.bufferType),e.resize&&(this.B=e.resize)):e={},this.m){case b:this.b=32768,this.a=new(et?Uint8Array:Array)(32768+this.l+258);break;case A:this.b=0,this.a=new(et?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:Q(Error("invalid inflate mode"))}}x.prototype.n=function(){var t,e,i=0,n=this.a,r=Y;if(r===Y?e=Math.LOG2E*Math.log(32768)-8:Q(Error("invalid compression method")),n[i++]=e=e<<4|r,r===Y)switch(this.h){case s.NONE:t=0;break;case s.r:t=1;break;case s.j:t=2;break;default:Q(Error("unsupported compression type"))}else Q(Error("invalid compression method"));return n[i++]=(r=t<<6|0)|31-(256*e+r)%31,e=a(this.input),this.z.b=i,i=(n=this.z.n()).length,et&&((n=new Uint8Array(n.buffer)).length<=i+4&&(this.a=new Uint8Array(n.length+4),this.a.set(n),n=this.a),n=n.subarray(0,i+4)),n[i++]=e>>24&255,n[i++]=e>>16&255,n[i++]=e>>8&255,n[i++]=255&e,n},t("Zlib.Deflate",x),t("Zlib.Deflate.compress",function(t,e){return new x(t,e).n()}),t("Zlib.Deflate.CompressionType",s),t("Zlib.Deflate.CompressionType.NONE",s.NONE),t("Zlib.Deflate.CompressionType.FIXED",s.r),t("Zlib.Deflate.CompressionType.DYNAMIC",s.j);for(var b=0,A=1,f={D:b,C:A},i=(r.prototype.p=function(){for(;!this.s;){var h=g(this,3);switch(1&h&&(this.s=tt),h>>>=1){case 0:var t=this.input,e=this.c,i=this.a,n=this.b,r=$,u=i.length,s=$;switch(this.e=this.g=0,(c=t[e++])===$&&Q(Error("invalid uncompressed block header: LEN (first byte)")),r=c,(c=t[e++])===$&&Q(Error("invalid uncompressed block header: LEN (second byte)")),r|=c<<8,(c=t[e++])===$&&Q(Error("invalid uncompressed block header: NLEN (first byte)")),l=c,(c=t[e++])===$&&Q(Error("invalid uncompressed block header: NLEN (second byte)")),r===~(l|=c<<8)&&Q(Error("invalid uncompressed block header: length verify")),e+r>t.length&&Q(Error("input buffer is broken")),this.m){case b:for(;n+r>i.length;){if(r-=s=u-n,et)i.set(t.subarray(e,e+s),n),n+=s,e+=s;else for(;s--;)i[n++]=t[e++];this.b=n,i=this.f(),n=this.b}break;case A:for(;n+r>i.length;)i=this.f({v:2});break;default:Q(Error("invalid inflate mode"))}if(et)i.set(t.subarray(e,e+r),n),n+=r,e+=r;else for(;r--;)i[n++]=t[e++];this.c=e,this.b=n,this.a=i;break;case 1:this.o(L,N);break;case 2:o=f=d=_=y=m=l=c=a=void 0;var _,d,f,o,a=this,p=function(t,e,i){for(var n,r,s,o=0;o<t;)switch(n=k(this,e),n){case 16:for(s=3+g(this,2);s--;)i[o++]=r;break;case 17:for(s=3+g(this,3);s--;)i[o++]=0;r=0;break;case 18:for(s=11+g(this,7);s--;)i[o++]=0;r=0;break;default:r=i[o++]=n}return i},c=g(a,5)+257,l=g(a,5)+1,m=g(a,4)+4,y=new(et?Uint8Array:Array)(C.length);for(o=0;o<m;++o)y[C[o]]=g(a,3);_=v(y),d=new(et?Uint8Array:Array)(c),f=new(et?Uint8Array:Array)(l),a.o(v(p.call(a,c,_,d)),v(p.call(a,l,_,f)));break;default:Q(Error("unknown BTYPE: "+h))}}return this.t()},[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C=et?new Uint16Array(i):i,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],T=et?new Uint16Array(i):i,i=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],w=et?new Uint8Array(i):i,i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],I=et?new Uint16Array(i):i,i=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=et?new Uint8Array(i):i,R=new(et?Uint8Array:Array)(288),P=0,D=R.length;P<D;++P)R[P]=P<=143?8:P<=255?9:P<=279?7:8;for(var L=v(R),V=new(et?Uint8Array:Array)(30),O=0,F=V.length;O<F;++O)V[O]=5;var N=v(V);function g(t,e){for(var i,n=t.g,r=t.e,s=t.input,o=t.c;r<e;)(i=s[o++])===$&&Q(Error("input buffer is broken")),n|=i<<r,r+=8;return i=n&(1<<e)-1,t.g=n>>>e,t.e=r-e,t.c=o,i}function k(t,e){for(var i,n=t.g,r=t.e,s=t.input,o=t.c,a=e[0],c=e[1];r<c;)(i=s[o++])===$&&Q(Error("input buffer is broken")),n|=i<<r,r+=8;return e=a[n&(1<<c)-1],t.g=n>>(a=e>>>16),t.e=r-a,t.c=o,65535&e}function G(t,e){var i,n;this.input=t,this.c=0,e?(e.index&&(this.c=e.index),e.verify&&(this.M=e.verify)):e={},i=t[this.c++],n=t[this.c++],(15&i)===Y?this.method=Y:Q(Error("unsupported compression method")),0!=((i<<8)+n)%31&&Q(Error("invalid fcheck flag:"+((i<<8)+n)%31)),32&n&&Q(Error("fdict flag is not supported")),this.A=new r(t,{index:this.c,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}r.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length-258;256!==(r=k(this,t));)if(r<256)c<=n&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(a=T[s=r-257],0<w[s]&&(a+=g(this,w[s])),r=k(this,e),o=I[r],0<B[r]&&(o+=g(this,B[r])),c<=n&&(this.b=n,i=this.f(),n=this.b);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},r.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length;256!==(r=k(this,t));)if(r<256)c<=n&&(c=(i=this.f()).length),i[n++]=r;else for(a=T[s=r-257],0<w[s]&&(a+=g(this,w[s])),r=k(this,e),o=I[r],0<B[r]&&(o+=g(this,B[r])),c<n+a&&(c=(i=this.f()).length);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},r.prototype.f=function(){var t,e,i=new(et?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(et)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,et)r.set(r.subarray(n,32768+n));else for(t=0;t<32768;++t)r[t]=r[n+t];return this.b=32768,r},r.prototype.J=function(t){var e,i=this.input.length/this.c+1|0,n=this.input,r=this.a;return t&&("number"==typeof t.v&&(i=t.v),"number"==typeof t.F&&(i+=t.F)),n=i<2?(t=(n.length-this.c)/this.u[2]/2*258|0)<r.length?r.length+t:r.length<<1:r.length*i,et?(e=new Uint8Array(n)).set(r):e=r,this.a=e},r.prototype.t=function(){var t,e,i,n,r,s=0,o=this.a,a=this.k,c=new(et?Uint8Array:Array)(this.q+(this.b-32768));if(0===a.length)return et?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=a.length;e<i;++e)for(n=0,r=(t=a[e]).length;n<r;++n)c[s++]=t[n];for(e=32768,i=this.b;e<i;++e)c[s++]=o[e];return this.k=[],this.buffer=c},r.prototype.H=function(){var t,e=this.b;return et?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},G.prototype.p=function(){var t=this.input,e=this.A.p();return this.c=this.A.c,this.M&&((t[this.c++]<<24|t[this.c++]<<16|t[this.c++]<<8|t[this.c++])>>>0!==a(e)&&Q(Error("invalid adler-32 checksum"))),e},t("Zlib.Inflate",G),t("Zlib.Inflate.BufferType",f),f.ADAPTIVE=f.C,f.BLOCK=f.D,t("Zlib.Inflate.prototype.decompress",G.prototype.p);et&&new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),et&&new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),et&&new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),et&&new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);et&&new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);for(var z=new(et?Uint8Array:Array)(288),U=0,W=z.length;U<W;++U)z[U]=U<=143?8:U<=255?9:U<=279?7:8;v(z);for(var H=new(et?Uint8Array:Array)(30),j=0,X=H.length;j<X;++j)H[j]=5;v(H);var Y=8}.call(window);var n=window.Zlib;n.Deflate=n.Deflate,n.Deflate.compress=n.Deflate.compress,n.Inflate=n.Inflate,n.Inflate.BufferType=n.Inflate.BufferType,n.Inflate.prototype.decompress=n.Inflate.prototype.decompress,e.exports=n},{}],27:[function(t,e,h){"use strict";var n,i=t("./platform/utils"),r=t("../../DebugInfos")||{};cc.log=cc.warn=cc.error=cc.assert=console.log.bind?console.log.bind(console):console.log;function s(){return function(){var t=r[arguments[0]]||"unknown id";if(1===arguments.length)return t;if(2===arguments.length)return cc.js.formatStr(t,arguments[1]);var e=cc.js.shiftArguments.apply(null,arguments);return cc.js.formatStr.apply(null,[t].concat(e))}}cc._throw=function(t){i.callInNextTick(function(){throw t})};var o=s(),a=(cc.logID=function(){cc.log(o.apply(null,arguments))},s()),c=(cc.warnID=function(){cc.warn(a.apply(null,arguments))},s()),u=(cc.errorID=function(){cc.error(c.apply(null,arguments))},s()),l=(cc.assertID=function(t){t||cc.assert(!1,u.apply(null,cc.js.shiftArguments.apply(null,arguments)))},cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}));e.exports=cc.debug={DebugMode:l,_resetDebugSetting:function(t){var i;cc.log=cc.warn=cc.error=cc.assert=function(){},t!==l.NONE&&(t>l.ERROR?(i=function(t){var e,i;cc.game.canvas&&(n||((e=document.createElement("Div")).setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",cc.game.canvas.height),(i=e.style).zIndex="99999",i.position="absolute",i.top=i.left="0",(n=document.createElement("textarea")).setAttribute("rows","20"),n.setAttribute("cols","30"),n.setAttribute("disabled","true"),(i=n.style).backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin=0,e.appendChild(n),cc.game.canvas.parentNode.appendChild(e)),n.value=n.value+t+"\r\n",n.scrollTop=n.scrollHeight)},cc.error=function(){i("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(t,e){!t&&e&&(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),i("ASSERT: "+e))},t!==l.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){i("WARN :  "+cc.js.formatStr.apply(null,arguments))}),t===l.INFO_FOR_WEB_PAGE&&(cc.log=function(){i(cc.js.formatStr.apply(null,arguments))})):console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t)throw e=e&&cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),new Error(e)}),t!==l.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===l.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)}))},getError:s(),isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config.showFPS=!!t)}}},{"../../DebugInfos":1,"./platform/utils":213}],28:[function(t,e,a){"use strict";var i=t("./event/event-target"),h=t("./load-pipeline/auto-release-utils"),n=t("./component-scheduler"),r=t("./node-activator"),u=t("./platform/CCObject"),_=t("./CCGame"),c=t("./renderer"),s=t("./event-manager"),o=t("./CCScheduler");cc.Director=function(){i.call(this),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._lastUpdate=0,this._deltaTime=0,this._startTime=0,this._maxParticleDeltaTime=0,this._scheduler=null,this._compScheduler=null,this._nodeActivator=null,this._actionManager=null;var t=this;_.on(_.EVENT_SHOW,function(){t._lastUpdate=performance.now()}),_.once(_.EVENT_ENGINE_INITED,this.init,this)},cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new o,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,o.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new n,this._nodeActivator=new r,s&&s.setEnabled(!0),cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,o.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,o.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,o.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc.Physics3DManager?(this._physics3DManager=new cc.Physics3DManager,this._scheduler.scheduleUpdate(this._physics3DManager,o.PRIORITY_SYSTEM,!1)):this._physics3DManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this)},calculateDeltaTime:function(t){t=t||performance.now(),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,1<this._deltaTime&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:function(t){var e=_.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,e=n.top+window.pageYOffset-e.clientTop,r=i._devicePixelRatio*(t.x-r),e=i._devicePixelRatio*(e+n.height-t.y);return i._isRotated?cc.v2(i._viewportRect.width-e,r):cc.v2(r,e)},convertToUI:function(t){var e=_.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,e=n.top+window.pageYOffset-e.clientTop,s=cc.v2(0,0);return i._isRotated?(s.x=r+t.y/i._devicePixelRatio,s.y=e+n.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(s.x=r+t.x*i._devicePixelRatio,s.y=e+n.height-t.y*i._devicePixelRatio),s},end:function(){this._purgeDirectorInNextLoop=!0},getWinSize:function(){return cc.size(cc.winSize)},getWinSizeInPixels:function(){return cc.size(cc.winSize)},pause:function(){this._paused||(this._paused=!0)},purgeCachedData:function(){cc.loader.releaseAll()},purgeDirector:function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),s&&s.setEnabled(!1),cc.isValid(this._scene)&&this._scene.destroy(),this._scene=null,cc.renderer.clear(),cc.AssetLibrary.resetBuiltins(),cc.game.pause(),cc.loader.releaseAll()},reset:function(){this.purgeDirector(),s&&s.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),cc.game.resume()},runSceneImmediate:function(t,e,i){cc.assertID(t instanceof cc.Scene,1216),console.time("InitScene"),t._load(),console.timeEnd("InitScene"),console.time("AttachPersist");for(var n=Object.keys(_._persistRootNodes).map(function(t){return _._persistRootNodes[t]}),r=0;r<n.length;r++){var s,o=n[r],a=t.getChildByUuid(o.uuid);a?(s=a.getSiblingIndex(),a._destroyImmediate(),t.insertChild(o,s)):o.parent=t}console.timeEnd("AttachPersist");var c=this._scene,l=(console.time("AutoRelease"),c&&c.autoReleaseAssets&&c.dependAssets);h.autoRelease(l,t.dependAssets,n),console.timeEnd("AutoRelease"),console.time("Destroy"),cc.isValid(c)&&c.destroy(),this._scene=null,u._deferredDestroy(),console.timeEnd("Destroy"),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,console.time("Activate"),t._activate(),console.timeEnd("Activate"),cc.game.resume(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assertID(t,1205),cc.assertID(t instanceof cc.Scene,1216),t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,i)},this)},_getSceneUuid:function(t){var e=_._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://")||(t="/"+t);for(var i=0;i<e.length;i++){var n=e[i];if(n.url.endsWith(t))return n}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.errorID(1206,t)}else cc.errorID(1207,t);return null},loadScene:function(t,e,i){if(this._loadingScene)return cc.warnID(1208,t,this._loadingScene),!1;var n=this._getSceneUuid(t);return n?(n=n.uuid,this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(n,e,i),!0):(cc.errorID(1209,t),!1)},preloadScene:function(i,t,n){void 0===n&&(n=t,t=null);var e=this._getSceneUuid(i);e?(this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,i),cc.loader.load({uuid:e.uuid,type:"uuid"},t,function(t,e){t&&cc.errorID(1210,i,t.message),n&&n(t,e)})):(e='Can not preload the scene "'+i+'" because it is not in the build settings.',n(new Error(e)),cc.error("preloadScene: "+e))},_loadSceneByUuid:function(r,s,o,t){console.time("LoadScene "+r),cc.AssetLibrary.loadAsset(r,function(t,e){console.timeEnd("LoadScene "+r);var i,n=cc.director;if(n._loadingScene="",t)t="Failed to load scene: "+t,cc.error(t);else{if(e instanceof cc.SceneAsset)return(i=e.scene)._id=e._uuid,i._name=e._name,void n.runSceneImmediate(i,o,s);t="The asset "+r+" is not a scene",cc.error(t)}s&&s(t)})},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setDepthTest:function(t){cc.Camera.main&&(cc.Camera.main.depth=!!t)},setClearColor:function(t){cc.Camera.main&&(cc.Camera.main.backgroundColor=t)},getRunningScene:function(){return this._scene},getScene:function(){return this._scene},getAnimationInterval:function(){return 1e3/_.getFrameRate()},setAnimationInterval:function(t){_.setFrameRate(Math.round(1e3/t))},getDeltaTime:function(){return this._deltaTime},getTotalTime:function(){return performance.now()-this._startTime},getTotalFrames:function(){return this._totalFrames},isPaused:function(){return this._paused},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getPhysics3DManager:function(){return this._physics3DManager},startAnimation:function(){cc.game.resume()},stopAnimation:function(){cc.game.pause()},_resetDeltaTime:function(){this._lastUpdate=performance.now(),this._deltaTime=0},mainLoop:function(t){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):(this.calculateDeltaTime(t),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this._compScheduler.clearup(),this.emit(cc.Director.EVENT_AFTER_UPDATE),u._deferredDestroy()),this.emit(cc.Director.EVENT_BEFORE_DRAW),c.render(this._scene,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_DRAW),s.frameUpdateListeners(),this._totalFrames++)},__fastOn:function(t,e,i){this.on(t,e,i)},__fastOff:function(t,e,i){this.off(t,e,i)}},cc.js.addon(cc.Director.prototype,i.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_draw",cc.Director.EVENT_AFTER_VISIT="director_before_draw",cc.Director.EVENT_BEFORE_DRAW="director_before_draw",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.Director.EVENT_BEFORE_PHYSICS="director_before_physics",cc.Director.EVENT_AFTER_PHYSICS="director_after_physics",cc.director=new cc.Director,e.exports=cc.director},{"./CCGame":29,"./CCScheduler":33,"./component-scheduler":72,"./event-manager":113,"./event/event-target":115,"./load-pipeline/auto-release-utils":140,"./node-activator":161,"./platform/CCObject":195,"./renderer":220}],29:[function(t,e,i){"use strict";var n=t("./event/event-target"),o=(t("../audio/CCAudioEngine"),t("./CCDebug")),s=t("./renderer/index.js"),a=t("../core/renderer/utils/dynamic-atlas/manager"),c={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(t){this.config.frameRate=t,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},getFrameRate:function(){return this.config.frameRate},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),cc.director._resetDeltaTime(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var t in c._persistRootNodes)c.removePersistRootNode(c._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),c.pause(),cc.AssetLibrary._loadBuiltins(function(){c.onStart(),c.emit(c.EVENT_RESTART)})})},end:function(){close()},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED))},_loadPreviewScript:function(t){t()},_prepareFinished:function(t){var e=this;this._initEngine(),this._setAnimFrame(),cc.AssetLibrary._loadBuiltins(function(){console.log("Cocos Creator v"+cc.ENGINE_VERSION),e._prepared=!0,e._runMainLoop(),e.emit(e.EVENT_GAME_INITED),t&&t()})},eventTargetOn:n.prototype.on,eventTargetOnce:n.prototype.once,on:function(t,e,i,n){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOn(t,e,i,n)},once:function(t,e,i){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOnce(t,e,i)},prepare:function(e){var t,i=this;this._prepared?e&&e():(t=this.config.jsList)&&0<t.length?cc.loader.load(t,function(t){if(t)throw new Error(JSON.stringify(t));i._loadPreviewScript(function(){i._prepareFinished(e)})}):this._loadPreviewScript(function(){i._prepareFinished(e)})},run:function(t,e){this._initConfig(t),this.onStart=e,this.prepare(c.onStart&&c.onStart.bind(c))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i))if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==i)return void cc.warnID(3802)}else t.parent=i;(this._persistRootNodes[e]=t)._persistNode=!0}}else cc.warnID(3800)},removePersistRootNode:function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=performance.now();var t=c.config.frameRate;this._frameTime=1e3/t,cc.director._maxParticleDeltaTime=this._frameTime/1e3*2,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=performance.now(),i=Math.max(0,c._frameTime-(e-c._lastTime)),n=window.setTimeout(function(){t()},i);return c._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var e,i,t,n,r,s;this._prepared&&(t=(e=this).config,n=cc.director,r=!0,s=t.frameRate,o.setDisplayStats(t.showFPS),i=function(t){e._paused||(e._intervalId=window.requestAnimFrame(i),30===s&&(r=!r)||n.mainLoop(t))},e._intervalId=window.requestAnimFrame(i),e._paused=!1)},_initConfig:function(t){"number"!=typeof t.debugMode&&(t.debugMode=0),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||2<e||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=1!==e&&!!t.showFPS,this._sceneInfos=t.scenes||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],o._resetDebugSetting(t.debugMode),this.config=t,this._configLoaded=!0},_determineRenderType:function(){var t=this.config,t=parseInt(t.renderMode)||0,e=(this.renderType=this.RENDER_TYPE_CANVAS,!1);if(0===t?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,e=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,e=!0):1===t&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,e=!0):2===t&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,e=!0),!e)throw new Error(o.getError(3820,t))},_initRenderer:function(){var t,e,i,n,r;this._rendererInitialized||("CANVAS"===(r=(r=this.config.id)instanceof HTMLElement?r:document.querySelector(r)||document.querySelector("#"+r)).tagName?(t=r.width,e=r.height,this.canvas=i=r,this.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==r.tagName&&cc.warnID(3819),t=r.clientWidth,e=r.clientHeight,this.canvas=i=document.createElement("CANVAS"),this.container=n=document.createElement("DIV"),r.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,r="gameCanvas",-1<(" "+(n=i).className+" ").indexOf(" "+r+" ")||(n.className&&(n.className+=" "),n.className+=r),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL&&(r={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS},s.initWebGL(i,r),this._renderContext=s.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&a&&(a.enabled=!0)),this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,s.initCanvas(i),this._renderContext=s.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this._rendererInitialized=!0)},_initEvents:function(){var e,t=window,s=(this.config.registerSystemEvent&&cc.internal.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden"),!1);function i(){s||(s=!0,c.emit(c.EVENT_HIDE))}function n(t,e,i,n,r){s&&(s=!1,c.emit(c.EVENT_SHOW,t,e,i,n,r))}if(e)for(var r=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],o=0;o<r.length;o++)document.addEventListener(r[o],function(t){(document[e]||t.hidden?i:n)()});else t.addEventListener("blur",i),t.addEventListener("focus",n);-1<navigator.userAgent.indexOf("MicroMessenger")&&(t.onfocus=n),"onpageshow"in window&&"onpagehide"in window&&(t.addEventListener("pagehide",i),t.addEventListener("pageshow",n),document.addEventListener("pagehide",i),document.addEventListener("pageshow",n)),this.on(c.EVENT_HIDE,function(){c.pause()}),this.on(c.EVENT_SHOW,function(){c.resume()})}};n.call(c),cc.js.addon(c,n.prototype),cc.game=e.exports=c},{"../audio/CCAudioEngine":22,"../core/renderer/utils/dynamic-atlas/manager":223,"./CCDebug":27,"./event/event-target":115,"./renderer/index.js":220}],30:[function(t,e,n){"use strict";function l(){}function u(t,e){0!==t&&(tt&&cc.warn("`cc.Node.skewX/Y` is deprecated since v2.2.1, please use 3D node instead.",""),tt=!1)}function _(t,e){var i=t.getLocation(),n=this.owner;return!!n._hitTest(i,this)&&(e.type=c.TOUCH_START,e.touch=t,e.bubbles=!0,n.dispatchEvent(e),!0)}function d(t,e){var i=this.owner;e.type=c.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)}function f(t,e){var i=t.getLocation(),n=this.owner;n._hitTest(i,this)?e.type=c.TOUCH_END:e.type=c.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)}function y(t,e){t.getLocation();var i=this.owner;e.type=c.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)}function g(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=c.MOUSE_DOWN,t.bubbles=!0,i.dispatchEvent(t))}function v(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))this._previousIn||(et&&et._mouseListener&&(t.type=c.MOUSE_LEAVE,et.dispatchEvent(t),et._mouseListener._previousIn=!1),et=this.owner,t.type=c.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=c.MOUSE_MOVE,t.bubbles=!0,i.dispatchEvent(t);else{if(!this._previousIn)return;t.type=c.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,et=null}t.stopPropagation()}function x(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=c.MOUSE_UP,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())}function b(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=c.MOUSE_WHEEL,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())}var p=t("./value-types"),A=t("./utils/base-node"),C=t("./utils/prefab-helper"),S=t("./utils/trans-pool").NodeMemPool,i=t("./utils/affine-transform"),a=t("./event-manager"),T=t("./platform/CCMacro"),w=t("./platform/js"),E=(t("./event/event"),t("./event/event-target")),r=t("./renderer/render-flow"),M=cc.Object.Flags.Destroying,I=Math.PI/180,s=!!cc.ActionManager,B=new p.Vec3,R=new p.Quat,P=new p.Vec3,D=new p.Vec3,L=new p.Quat,V=new p.Quat,O=new p.Vec3,F=new p.Vec3,N=new p.Vec3,k=new p.Vec3,G=new p.Vec3,z=new p.Quat,U=new p.Quat,W=new p.Vec3,H=new p.Quat,j=new p.Vec3,X=new p.Quat,Y=new p.Vec3,q=new p.Vec3,J=new p.Quat,Z=new p.Quat,m=(new p.Quat,cc.mat4()),K=new p.Vec3,o=new Array(16),t=(o.length=0,cc.Enum({DEBUG:31})),h=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,TRS:7,RS:6,TRSS:15,PHYSICS_POSITION:16,PHYSICS_SCALE:32,PHYSICS_ROTATION:64,PHYSICS_TRS:112,PHYSICS_RS:96,ALL_POSITION:17,ALL_SCALE:34,ALL_ROTATION:68,ALL_TRS:119,ALL:65535}),c=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"}),Q=[c.TOUCH_START,c.TOUCH_MOVE,c.TOUCH_END,c.TOUCH_CANCEL],$=[c.MOUSE_DOWN,c.MOUSE_ENTER,c.MOUSE_MOVE,c.MOUSE_LEAVE,c.MOUSE_UP,c.MOUSE_WHEEL],tt=!0,et=null;function it(t,e){if(e){for(var i,n=0,r=null,s=t;s&&cc.Node.isNode(s);s=s._parent,++n)s.getComponent(e)&&(i={index:n,node:s},r?r.push(i):r=[i]);return r}return null}function nt(t,e){if(t._objFlags&M)return 1;var i=0;if(t._bubblingListeners)for(;i<e.length;++i)if(t._bubblingListeners.hasEventListener(e[i]))return 1;if(t._capturingListeners)for(;i<e.length;++i)if(t._capturingListeners.hasEventListener(e[i]))return 1}function rt(t){var e=t.groupIndex;return e=0===e&&t.parent?rt(t.parent):e}function st(t){var e=rt(t);t._cullingMask=1<<e;for(var i=0;i<t._children.length;i++)st(t._children[i])}function ot(){var t,e,i,n,r,s,o;this._localMatDirty&h.TRSS&&(t=(e=this._matrix).m,p.Trs.toMat4(e,this._trs),(this._skewX||this._skewY)&&(e=t[0],i=t[1],n=t[4],r=t[5],s=Math.tan(this._skewX*I),o=Math.tan(this._skewY*I),1/0===s&&(s=99999999),t[0]=e+n*(o=1/0===o?99999999:o),t[1]=i+r*o,t[4]=n+e*s,t[5]=r+i*s),this._localMatDirty&=~h.TRSS,this._worldMatDirty=!0)}function at(){var t,e,i,n,r,s,o,a,c,l=this._localMatDirty;l&h.TRSS&&(t=this._matrix.m,e=this._trs,l&(h.RS|h.SKEW)&&(l=-this._eulerAngles.z,c=this._skewX||this._skewY,i=e[7],n=e[8],l||c?(o=s=0,a=r=1,l&&(l=l*I,o=Math.sin(l),r=a=Math.cos(l),s=-o),t[0]=r*=i,t[1]=s*=i,t[4]=o*=n,t[5]=a*=n,c&&(l=t[0],r=t[1],s=t[4],o=t[5],a=Math.tan(this._skewX*I),c=Math.tan(this._skewY*I),1/0===a&&(a=99999999),t[0]=l+s*(c=1/0===c?99999999:c),t[1]=r+o*c,t[4]=s+l*a,t[5]=o+r*a)):(t[0]=i,t[1]=0,t[4]=0,t[5]=n)),t[12]=e[0],t[13]=e[1],this._localMatDirty&=~h.TRSS,this._worldMatDirty=!0)}function ct(){var t;this._localMatDirty&h.TRSS&&this._updateLocalMatrix(),this._parent?(t=this._parent._worldMatrix,p.Mat4.mul(this._worldMatrix,t,this._matrix)):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1}function lt(){this._localMatDirty&h.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1}function ht(t,e,i){var e=e.m,i=i.m,t=t.m,n=e[0],r=e[1],s=e[4],o=e[5],h=e[12],e=e[13],a=i[0],c=i[1],l=i[4],u=i[5],_=i[12],i=i[13];0!==r||0!==s?(t[0]=a*n+c*s,t[1]=a*r+c*o,t[4]=l*n+u*s,t[5]=l*r+u*o,t[12]=n*_+s*i+h,t[13]=r*_+o*i+e):(t[0]=a*n,t[1]=c*o,t[4]=l*n,t[5]=u*o,t[12]=n*_+h,t[13]=o*i+e)}var ut=p.Mat4.mul,A={name:"cc.Node",extends:A,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:void 0,_scale:void 0,_trs:null,_eulerAngles:cc.Vec3,_skewX:0,_skewY:0,_zIndex:{default:void 0,type:cc.Integer},_localZOrder:{default:0,serializable:!1},_is3DNode:!1,_groupIndex:{default:0,formerlySerializedAs:"groupIndex"},groupIndex:{get:function(){return this._groupIndex},set:function(t){this._groupIndex=t,st(this),this.emit(c.GROUP_CHANGED,this)}},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t)}},x:{get:function(){return this._trs[0]},set:function(t){var e=this._trs;t!==e[0]&&(e[0]=t,this.setLocalDirty(h.ALL_POSITION),1&this._eventMask&&this.emit(c.POSITION_CHANGED))}},y:{get:function(){return this._trs[1]},set:function(t){var e=this._trs;t!==e[1]&&(e[1]=t,this.setLocalDirty(h.ALL_POSITION),1&this._eventMask&&this.emit(c.POSITION_CHANGED))}},z:{get:function(){return this._trs[2]},set:function(t){var e=this._trs;t!==e[2]&&(e[2]=t,this.setLocalDirty(h.ALL_POSITION),this._renderFlag|=r.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(c.POSITION_CHANGED))}},rotation:{get:function(){return cc.warn("`cc.Node.rotation` is deprecated since v2.1.0, please use `-angle` instead. (`this.node.rotation` -> `-this.node.angle`)"),-this.angle},set:function(t){cc.warn("`cc.Node.rotation` is deprecated since v2.1.0, please set `-angle` instead. (`this.node.rotation = x` -> `this.node.angle = -x`)"),this.angle=-t}},angle:{get:function(){return this._eulerAngles.z},set:function(t){p.Vec3.set(this._eulerAngles,0,0,t),p.Trs.fromAngleZ(this._trs,t),this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED)}},rotationX:{get:function(){return cc.warn("`cc.Node.rotationX` is deprecated since v2.1.0, please use `eulerAngles.x` instead. (`this.node.rotationX` -> `this.node.eulerAngles.x`)"),this._eulerAngles.x},set:function(t){cc.warn("`cc.Node.rotationX` is deprecated since v2.1.0, please set `eulerAngles` instead. (`this.node.rotationX = x` -> `this.node.is3DNode = true; this.node.eulerAngles = cc.v3(x, 0, 0)`"),this._eulerAngles.x!==t&&(this._eulerAngles.x=t,this._eulerAngles.x===this._eulerAngles.y?p.Trs.fromAngleZ(this._trs,-t):p.Trs.fromEulerNumber(this._trs,t,this._eulerAngles.y,0),this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED))}},rotationY:{get:function(){return cc.warn("`cc.Node.rotationY` is deprecated since v2.1.0, please use `eulerAngles.y` instead. (`this.node.rotationY` -> `this.node.eulerAngles.y`)"),this._eulerAngles.y},set:function(t){cc.warn("`cc.Node.rotationY` is deprecated since v2.1.0, please set `eulerAngles` instead. (`this.node.rotationY = y` -> `this.node.is3DNode = true; this.node.eulerAngles = cc.v3(0, y, 0)`"),this._eulerAngles.y!==t&&(this._eulerAngles.y=t,this._eulerAngles.x===this._eulerAngles.y?p.Trs.fromAngleZ(this._trs,-t):p.Trs.fromEulerNumber(this._trs,this._eulerAngles.x,t,0),this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED))}},eulerAngles:{get:function(){return p.Trs.toEuler(this._eulerAngles,this._trs)},set:function(t){p.Trs.fromEuler(this._trs,t),this.setLocalDirty(h.ALL_ROTATION),this._renderFlag|=r.FLAG_TRANSFORM,4&this._eventMask&&this.emit(c.ROTATION_CHANGED)}},quat:{get:function(){var t=this._trs;return new p.Quat(t[3],t[4],t[5],t[6])},set:function(t){this.setRotation(t)}},scale:{get:function(){return this._trs[7]},set:function(t){this.setScale(t)}},scaleX:{get:function(){return this._trs[7]},set:function(t){this._trs[7]!==t&&(this._trs[7]=t,this.setLocalDirty(h.ALL_SCALE),2&this._eventMask&&this.emit(c.SCALE_CHANGED))}},scaleY:{get:function(){return this._trs[8]},set:function(t){this._trs[8]!==t&&(this._trs[8]=t,this.setLocalDirty(h.ALL_SCALE),2&this._eventMask&&this.emit(c.SCALE_CHANGED))}},scaleZ:{get:function(){return this._trs[9]},set:function(t){this._trs[9]!==t&&(this._trs[9]=t,this.setLocalDirty(h.ALL_SCALE),this._renderFlag|=r.FLAG_TRANSFORM,2&this._eventMask&&this.emit(c.SCALE_CHANGED))}},skewX:{get:function(){return this._skewX},set:function(t){u(t),this._skewX=t,this.setLocalDirty(h.SKEW)}},skewY:{get:function(){return this._skewY},set:function(t){u(t),this._skewY=t,this.setLocalDirty(h.SKEW)}},opacity:{get:function(){return this._opacity},set:function(t){t=cc.misc.clampf(t,0,255),this._opacity!==t&&(this._opacity=t,this._renderFlag|=r.FLAG_OPACITY_COLOR)},range:[0,255]},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.set(t),this._renderFlag|=r.FLAG_COLOR,32&this._eventMask&&this.emit(c.COLOR_CHANGED,t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;e.x!==t&&(e.x=t,16&this._eventMask&&this.emit(c.ANCHOR_CHANGED))}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;e.y!==t&&(e.y=t,16&this._eventMask&&this.emit(c.ANCHOR_CHANGED))}},width:{get:function(){return this._contentSize.width},set:function(t){t!==this._contentSize.width&&(this._contentSize.width=t,8&this._eventMask&&this.emit(c.SIZE_CHANGED))}},height:{get:function(){return this._contentSize.height},set:function(t){t!==this._contentSize.height&&(this._contentSize.height=t,8&this._eventMask&&this.emit(c.SIZE_CHANGED))}},zIndex:{get:function(){return this._localZOrder>>16},set:function(t){t>T.MAX_ZINDEX?(cc.warnID(1636),t=T.MAX_ZINDEX):t<T.MIN_ZINDEX&&(cc.warnID(1637),t=T.MIN_ZINDEX),this.zIndex!==t&&(this._localZOrder=65535&this._localZOrder|t<<16,this.emit(c.SIBLING_ORDER_CHANGED),this._onSiblingIndexChanged())}},is3DNode:{get:function(){return this._is3DNode},set:function(t){this._is3DNode=t,this._update3DFunction()}},up:{get:function(){return p.Vec3.transformQuat(j,p.Vec3.UP,this.getWorldRotation(X)).clone()}},right:{get:function(){return p.Vec3.transformQuat(j,p.Vec3.RIGHT,this.getWorldRotation(X)).clone()}},forward:{get:function(){return p.Vec3.transformQuat(j,p.Vec3.FORWARD,this.getWorldRotation(X)).clone()}}},ctor:function(){this._reorderChildDirty=!1,this._widget=null,this._renderComponent=null,this._capturingListeners=null,this._bubblingListeners=null,this._touchListener=null,this._mouseListener=null,this._initDataFromPool(),this._eventMask=0,this._cullingMask=1,this._childArrivalOrder=1,this._renderFlag=r.FLAG_TRANSFORM|r.FLAG_OPACITY_COLOR},statics:{EventType:c,_LocalDirtyFlag:h,isNode:function(t){return t instanceof _t&&(t.constructor===_t||!(t instanceof cc.Scene))},BuiltinGroupIndex:t},_onSiblingIndexChanged:function(){this._parent&&this._parent._delaySort()},_onPreDestroy:function(){this._onPreDestroyBase();s&&cc.director.getActionManager().removeAllActionsFromTarget(this),et===this&&(et=null),(this._touchListener||this._mouseListener)&&(a.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null)),this._backDataIntoPool(),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_onPostActivated:function(t){var e=s?cc.director.getActionManager():null;t?(this._renderFlag|=r.FLAG_WORLD_TRANSFORM,e&&e.resumeTarget(this),a.resumeTarget(this),this._checkListenerMask()):(e&&e.pauseTarget(this),a.pauseTarget(this))},_onHierarchyChanged:function(t){this._updateOrderOfArrival(),st(this),this._parent&&this._parent._delaySort(),this._renderFlag|=r.FLAG_WORLD_TRANSFORM,this._onHierarchyChangedBase(t),cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0),t&&this._activeInHierarchy&&this._checkListenerMask()},_update3DFunction:function(){this._is3DNode?(this._updateLocalMatrix=ot,this._calculWorldMatrix=ct,this._mulMat=ut):(this._updateLocalMatrix=at,this._calculWorldMatrix=lt,this._mulMat=ht),this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged(),this._renderFlag|=r.FLAG_TRANSFORM,this._localMatDirty=h.ALL},_initDataFromPool:function(){this._spaceInfo||(this._spaceInfo=S.pop());var t=this._spaceInfo,t=(this._matrix=cc.mat4(t.localMat),p.Mat4.identity(this._matrix),this._worldMatrix=cc.mat4(t.worldMat),p.Mat4.identity(this._worldMatrix),this._localMatDirty=h.ALL,this._worldMatDirty=!0,this._trs=this._spaceInfo.trs);t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=1,t[7]=1,t[8]=1,t[9]=1},_backDataIntoPool:function(){S.push(this._spaceInfo),this._matrix=null,this._worldMatrix=null,this._trs=null,this._spaceInfo=null},_toEuler:function(){var t;this.is3DNode?p.Trs.toEuler(this._eulerAngles,this._trs):(t=Math.asin(this._trs[5])/I*2,p.Vec3.set(this._eulerAngles,0,0,t))},_fromEuler:function(){this.is3DNode?p.Trs.fromEuler(this._trs,this._eulerAngles):p.Trs.fromAngleZ(this._trs,this._eulerAngles.z)},_upgrade_1x_to_2x:function(){this._is3DNode&&this._update3DFunction();var t,e=this._trs;e?(t=e,e=this._trs=this._spaceInfo.trs,11===t.length?e.set(t.subarray(1)):e.set(t)):e=this._trs=this._spaceInfo.trs,void 0!==this._zIndex&&(this._localZOrder=this._zIndex<<16,this._zIndex=void 0),this._fromEuler(),0!==this._localZOrder&&(this._zIndex=(4294901760&this._localZOrder)>>16),this._color.a<255&&255===this._opacity&&(this._opacity=this._color.a,this._color.a=255)},_onBatchCreated:function(){for(var t=this._prefab,e=(t&&t.sync&&t.root===this&&C.syncWithPrefab(this),this._upgrade_1x_to_2x(),this._updateOrderOfArrival(),this._cullingMask=1<<rt(this),this._activeInHierarchy||(s&&cc.director.getActionManager().pauseTarget(this),a.pauseTarget(this)),this._children),i=0,n=e.length;i<n;i++)e[i]._onBatchCreated();0<e.length&&(this._renderFlag|=r.FLAG_CHILDREN)},_onBatchRestored:function(){this._upgrade_1x_to_2x(),this._cullingMask=1<<rt(this),this._activeInHierarchy||((t=cc.director.getActionManager())&&t.pauseTarget(this),a.pauseTarget(this));for(var t,e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchRestored();0<e.length&&(this._renderFlag|=r.FLAG_CHILDREN)},_checkListenerMask:function(){var t;this._touchListener?(t=this._touchListener.mask=it(this,cc.Mask),this._mouseListener&&(this._mouseListener.mask=t)):this._mouseListener&&(this._mouseListener.mask=it(this,cc.Mask))},_checknSetupSysEvent:function(t){var e=!1,i=!1;return-1!==Q.indexOf(t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:it(this,cc.Mask),onTouchBegan:_,onTouchMoved:d,onTouchEnded:f,onTouchCancelled:y}),a.addListener(this._touchListener,this),e=!0),i=!0):-1!==$.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:it(this,cc.Mask),onMouseDown:g,onMouseMove:v,onMouseUp:x,onMouseScroll:b}),a.addListener(this._mouseListener,this),e=!0),i=!0),e&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||a.pauseTarget(this)},this,0,0,0,!1),i},on:function(t,e,i,n){if(this._checknSetupSysEvent(t))return this._onDispatch(t,e,i,n);switch(t){case c.POSITION_CHANGED:this._eventMask|=1;break;case c.SCALE_CHANGED:this._eventMask|=2;break;case c.ROTATION_CHANGED:this._eventMask|=4;break;case c.SIZE_CHANGED:this._eventMask|=8;break;case c.ANCHOR_CHANGED:this._eventMask|=16;break;case c.COLOR_CHANGED:this._eventMask|=32}return this._bubblingListeners||(this._bubblingListeners=new E),this._bubblingListeners.on(t,e,i)},once:function(t,e,i,n){(this._checknSetupSysEvent(t)&&n?this._capturingListeners=this._capturingListeners||new E:this._bubblingListeners=this._bubblingListeners||new E).once(t,e,i)},_onDispatch:function(t,e,i,n){var r;{if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e)return r=null,(r=n?this._capturingListeners=this._capturingListeners||new E:this._bubblingListeners=this._bubblingListeners||new E).hasEventListener(t,e,i)||(r.on(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800)}},off:function(t,e,i,n){var r=-1!==Q.indexOf(t),s=!r&&-1!==$.indexOf(t);if(r||s)this._offDispatch(t,e,i,n),r?this._touchListener&&!nt(this,Q)&&(a.removeListener(this._touchListener),this._touchListener=null):s&&this._mouseListener&&!nt(this,$)&&(a.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners)if(this._bubblingListeners.off(t,e,i),!this._bubblingListeners.hasEventListener(t))switch(t){case c.POSITION_CHANGED:this._eventMask&=-2;break;case c.SCALE_CHANGED:this._eventMask&=-3;break;case c.ROTATION_CHANGED:this._eventMask&=-5;break;case c.SIZE_CHANGED:this._eventMask&=-9;break;case c.ANCHOR_CHANGED:this._eventMask&=-17;break;case c.COLOR_CHANGED:this._eventMask&=-33}},_offDispatch:function(t,e,i,n){"boolean"==typeof i?(n=i,i=void 0):n=!!n,e?(n=n?this._capturingListeners:this._bubblingListeners)&&(n.off(t,e,i),i&&i.__eventTargets&&w.array.fastRemove(i.__eventTargets,this)):(this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t))},targetOff:function(t){var e=this._bubblingListeners;e&&(e.targetOff(t),1&this._eventMask&&!e.hasEventListener(c.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!e.hasEventListener(c.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!e.hasEventListener(c.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!e.hasEventListener(c.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!e.hasEventListener(c.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!e.hasEventListener(c.COLOR_CHANGED)&&(this._eventMask&=-33)),this._capturingListeners&&this._capturingListeners.targetOff(t),t&&t.__eventTargets&&w.array.fastRemove(t.__eventTargets,this),this._touchListener&&!nt(this,Q)&&(a.removeListener(this._touchListener),this._touchListener=null),this._mouseListener&&!nt(this,$)&&(a.removeListener(this._mouseListener),this._mouseListener=null)},hasEventListener:function(t){var e=!1;return e=!(e=this._bubblingListeners?this._bubblingListeners.hasEventListener(t):e)&&this._capturingListeners?this._capturingListeners.hasEventListener(t):e},emit:function(t,e,i,n,r,s){this._bubblingListeners&&this._bubblingListeners.emit(t,e,i,n,r,s)},dispatchEvent:function(t){!function(t,e){var i,n;for(e.target=t,o.length=0,t._getCapturingTargets(e.type,o),e.eventPhase=1,n=o.length-1;0<=n;--n)if((i=o[n])._capturingListeners&&((e.currentTarget=i)._capturingListeners.emit(e.type,e,o),e._propagationStopped))return o.length=0;if(o.length=0,e.eventPhase=2,(e.currentTarget=t)._capturingListeners&&t._capturingListeners.emit(e.type,e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.emit(e.type,e),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,o),e.eventPhase=3,n=0;n<o.length;++n)if((i=o[n])._bubblingListeners&&((e.currentTarget=i)._bubblingListeners.emit(e.type,e),e._propagationStopped))return o.length=0;o.length=0}(this,t),o.length=0},pauseSystemEvents:function(t){a.pauseTarget(this,t)},resumeSystemEvents:function(t){a.resumeTarget(this,t)},_hitTest:function(h,t){var u=this._contentSize.width,_=this._contentSize.height,e=Y,i=q,d=cc.Camera.findCamera(this);if(d?d.getScreenToWorldPoint(h,e):e.set(h),this._updateWorldMatrix(),!p.Mat4.invert(m,this._worldMatrix))return!1;p.Vec2.transformMat4(i,e,m),i.x+=this._anchorPoint.x*u,i.y+=this._anchorPoint.y*_;var n=!1;if(0<=i.x&&0<=i.y&&i.x<=u&&i.y<=_&&(n=!0,t&&t.mask))for(var r=t.mask,s=this,f=r?r.length:0,o=0,a=0;s&&a<f;++o,s=s.parent){var c=r[a];if(o===c.index){if(s!==c.node){r.length=a;break}var l=s.getComponent(cc.Mask);if(l&&l._enabled&&!l._hitTest(e)){n=!1;break}a++}else if(o>c.index){r.length=a;break}}return n},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i._capturingListeners&&i._capturingListeners.hasEventListener(t)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i._bubblingListeners&&i._bubblingListeners.hasEventListener(t)&&e.push(i),i=i.parent},runAction:s?function(t){var e;if(this.active)return cc.assertID(t,1618),e=cc.director.getActionManager(),e._suppressDeprecation||(e._suppressDeprecation=!0,cc.warnID(1639)),e.addAction(t,this,!1),t}:l,pauseAllActions:s?function(){cc.director.getActionManager().pauseTarget(this)}:l,resumeAllActions:s?function(){cc.director.getActionManager().resumeTarget(this)}:l,stopAllActions:s?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:l,stopAction:s?function(t){cc.director.getActionManager().removeAction(t)}:l,stopActionByTag:s?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:l,getActionByTag:s?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:s?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},getPosition:function(t){return t=t||new p.Vec3,p.Trs.toPosition(t,this._trs)},setPosition:function(t,e,i){i=void 0===e?(n=t.x,e=t.y,t.z||0):(n=t,i||0);var n,t=this._trs;t[0]===n&&t[1]===e&&t[2]===i||(t[0]=n,t[1]=e,t[2]=i,this.setLocalDirty(h.ALL_POSITION),this._renderFlag|=r.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(c.POSITION_CHANGED))},getScale:function(t){return void 0!==t?p.Trs.toScale(t,this._trs):(cc.errorID(1400,"cc.Node.getScale","cc.Node.scale or cc.Node.getScale(cc.Vec3)"),this._trs[7])},setScale:function(t,e,i){t&&"number"!=typeof t?(e=t.y,i=void 0===t.z?1:t.z,t=t.x):void 0!==t&&void 0===e?i=e=t:void 0===i&&(i=1);var n=this._trs;n[7]===t&&n[8]===e&&n[9]===i||(n[7]=t,n[8]=e,n[9]=i,this.setLocalDirty(h.ALL_SCALE),this._renderFlag|=r.FLAG_TRANSFORM,2&this._eventMask&&this.emit(c.SCALE_CHANGED))},getRotation:function(t){return t instanceof p.Quat?p.Trs.toRotation(t,this._trs):(cc.warn("`cc.Node.getRotation()` is deprecated since v2.1.0, please use `-cc.Node.angle` instead. (`this.node.getRotation()` -> `-this.node.angle`)"),-this.angle)},setRotation:function(t,e,i,n){var r;"number"==typeof t&&void 0===e?(cc.warn("`cc.Node.setRotation(degree)` is deprecated since v2.1.0, please set `-cc.Node.angle` instead. (`this.node.setRotation(x)` -> `this.node.angle = -x`)"),this.angle=-t):(r=t,void 0===e&&(r=t.x,e=t.y,i=t.z,n=t.w),(t=this._trs)[3]===r&&t[4]===e&&t[5]===i&&t[6]===n||(t[3]=r,t[4]=e,t[5]=i,t[6]=n,this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED)))},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}8&this._eventMask&&this.emit(c.SIZE_CHANGED)},getAnchorPoint:function(){return cc.v2(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.setLocalDirty(h.ALL_POSITION),16&this._eventMask&&this.emit(c.ANCHOR_CHANGED)},_invTransformPoint:function(t,e){this._parent?this._parent._invTransformPoint(t,e):p.Vec3.copy(t,e);e=this._trs;return p.Trs.toPosition(P,e),p.Vec3.sub(t,t,P),p.Trs.toRotation(L,e),p.Quat.conjugate(V,L),p.Vec3.transformQuat(t,t,V),p.Trs.toScale(P,e),p.Vec3.inverseSafe(D,P),p.Vec3.mul(t,t,D),t},getWorldPosition:function(t){p.Trs.toPosition(t,this._trs);for(var e,i=this._parent;i;)e=i._trs,p.Trs.toScale(B,e),p.Vec3.mul(t,t,B),p.Trs.toRotation(R,e),p.Vec3.transformQuat(t,t,R),p.Trs.toPosition(B,e),p.Vec3.add(t,t,B),i=i._parent;return t},setWorldPosition:function(t){var e=this._trs;this._parent?this._parent._invTransformPoint(O,t):p.Vec3.copy(O,t),p.Trs.fromPosition(e,O),this.setLocalDirty(h.ALL_POSITION),1&this._eventMask&&this.emit(c.POSITION_CHANGED)},getWorldRotation:function(t){p.Trs.toRotation(J,this._trs),p.Quat.copy(t,J);for(var e=this._parent;e;)p.Trs.toRotation(J,e._trs),p.Quat.mul(t,J,t),e=e._parent;return t},setWorldRotation:function(t){this._parent?(this._parent.getWorldRotation(Z),p.Quat.conjugate(Z,Z),p.Quat.mul(Z,Z,t)):p.Quat.copy(Z,t),p.Trs.fromRotation(this._trs,Z),this.setLocalDirty(h.ALL_ROTATION)},getWorldScale:function(t){p.Trs.toScale(F,this._trs),p.Vec3.copy(t,F);for(var e=this._parent;e;)p.Trs.toScale(F,e._trs),p.Vec3.mul(t,t,F),e=e._parent;return t},setWorldScale:function(t){this._parent?(this._parent.getWorldScale(N),p.Vec3.div(N,t,N)):p.Vec3.copy(N,t),p.Trs.fromScale(this._trs,N),this.setLocalDirty(h.ALL_SCALE)},getWorldRT:function(t){for(var e=k,i=z,n=this._trs,r=(p.Trs.toPosition(e,n),p.Trs.toRotation(i,n),this._parent);r;)n=r._trs,p.Trs.toScale(G,n),p.Vec3.mul(e,e,G),p.Trs.toRotation(U,n),p.Vec3.transformQuat(e,e,U),p.Trs.toPosition(G,n),p.Vec3.add(e,e,G),p.Quat.mul(i,U,i),r=r._parent;return p.Mat4.fromRT(t,i,e),t},lookAt:function(t,e){this.getWorldPosition(W),p.Vec3.sub(W,W,t),p.Vec3.normalize(W,W),p.Quat.fromViewUp(H,W,e),this.setWorldRotation(H)},_updateLocalMatrix:at,_calculWorldMatrix:function(){this._localMatDirty&h.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1},_mulMat:ht,_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();for(var t=this._children,e=0,i=t.length;e<i;e++)t[e]._worldMatDirty=!0}},setLocalDirty:function(t){this._localMatDirty|=t,this._worldMatDirty=!0,t===h.ALL_POSITION||t===h.POSITION?this._renderFlag|=r.FLAG_WORLD_TRANSFORM:this._renderFlag|=r.FLAG_TRANSFORM},setWorldDirty:function(){this._worldMatDirty=!0},getLocalMatrix:function(t){return this._updateLocalMatrix(),p.Mat4.copy(t,this._matrix)},getWorldMatrix:function(t){return this._updateWorldMatrix(),p.Mat4.copy(t,this._worldMatrix)},convertToNodeSpaceAR:function(t,e){return this._updateWorldMatrix(),p.Mat4.invert(m,this._worldMatrix),t instanceof cc.Vec2?(e=e||new cc.Vec2,p.Vec2.transformMat4(e,t,m)):(e=e||new cc.Vec3,p.Vec3.transformMat4(e,t,m))},convertToWorldSpaceAR:function(t,e){return this._updateWorldMatrix(),t instanceof cc.Vec2?(e=e||new cc.Vec2,p.Vec2.transformMat4(e,t,this._worldMatrix)):(e=e||new cc.Vec3,p.Vec3.transformMat4(e,t,this._worldMatrix))},convertToNodeSpace:function(t){this._updateWorldMatrix(),p.Mat4.invert(m,this._worldMatrix);var e=new cc.Vec2;return p.Vec2.transformMat4(e,t,m),e.x+=this._anchorPoint.x*this._contentSize.width,e.y+=this._anchorPoint.y*this._contentSize.height,e},convertToWorldSpace:function(t){this._updateWorldMatrix();t=new cc.Vec2(t.x-this._anchorPoint.x*this._contentSize.width,t.y-this._anchorPoint.y*this._contentSize.height);return p.Vec2.transformMat4(t,t,this._worldMatrix)},getNodeToParentTransform:function(t){t=t||i.identity(),this._updateLocalMatrix();var e=this._contentSize;return K.x=-this._anchorPoint.x*e.width,K.y=-this._anchorPoint.y*e.height,p.Mat4.copy(m,this._matrix),p.Mat4.transform(m,m,K),i.fromMat4(t,m)},getNodeToParentTransformAR:function(t){return t=t||i.identity(),this._updateLocalMatrix(),i.fromMat4(t,this._matrix)},getNodeToWorldTransform:function(t){t=t||i.identity(),this._updateWorldMatrix();var e=this._contentSize;return K.x=-this._anchorPoint.x*e.width,K.y=-this._anchorPoint.y*e.height,p.Mat4.copy(m,this._worldMatrix),p.Mat4.transform(m,m,K),i.fromMat4(t,m)},getNodeToWorldTransformAR:function(t){return t=t||i.identity(),this._updateWorldMatrix(),i.fromMat4(t,this._worldMatrix)},getParentToNodeTransform:function(t){return t=t||i.identity(),this._updateLocalMatrix(),p.Mat4.invert(m,this._matrix),i.fromMat4(t,m)},getWorldToNodeTransform:function(t){return t=t||i.identity(),this._updateWorldMatrix(),p.Mat4.invert(m,this._worldMatrix),i.fromMat4(t,m)},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getBoundingBox:function(){this._updateLocalMatrix();var t=this._contentSize.width,e=this._contentSize.height,t=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return t.transformMat4(t,this._matrix)},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo()):this.getBoundingBox()},_getBoundingBoxTo:function(){var t=this._contentSize.width,e=this._contentSize.height,i=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);if(this._calculWorldMatrix(),i.transformMat4(i,this._worldMatrix),!this._children)return i;for(var n=this._children,r=0;r<n.length;r++){var s=n[r];s&&s.active&&((s=s._getBoundingBoxTo())&&i.union(i,s))}return i},_updateOrderOfArrival:function(){var t=this._parent?++this._parent._childArrivalOrder:0;this._localZOrder=4294901760&this._localZOrder|t,this.emit(c.SIBLING_ORDER_CHANGED)},addChild:function(t,e,i){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,void 0!==e&&(t.zIndex=e),void 0!==i&&(t.name=i)},cleanup:function(){s&&cc.director.getActionManager().removeAllActionsFromTarget(this),a.removeListeners(this);for(var t,e=this._children.length,i=0;i<e;++i)(t=this._children[i])&&t.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;this._childArrivalOrder=1;for(var e=0,i=t.length;e<i;e++)(r=t[e])._updateOrderOfArrival();if(a._setDirtyForNode(this),1<t.length){for(var n,r,s=1,o=t.length;s<o;s++){for(r=t[s],n=s-1;0<=n&&r._localZOrder<t[n]._localZOrder;)t[n+1]=t[n],n--;t[n+1]=r}this.emit(c.CHILD_REORDER,this)}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_restoreProperties:!1,onRestore:!1},_t=cc.Class(A),t=_t.prototype;w.getset(t,"position",t.getPosition,t.setPosition,!1,!0),cc.Node=e.exports=_t},{"./event-manager":113,"./event/event":116,"./event/event-target":115,"./platform/CCMacro":194,"./platform/js":209,"./renderer/render-flow":221,"./utils/affine-transform":254,"./utils/base-node":255,"./utils/prefab-helper":267,"./utils/trans-pool":273,"./value-types":279}],31:[function(t,e,i){"use strict";var n=t("./CCNode"),r=t("./renderer/render-flow"),s=(cc.Object.Flags.HideInHierarchy,n._LocalDirtyFlag),t=cc.Class({name:"cc.PrivateNode",extends:n,properties:{x:{get:function(){return this._originPos.x},set:function(t){var e=this._originPos;t!==e.x&&(e.x=t,this._posDirty(!0))},override:!0},y:{get:function(){return this._originPos.y},set:function(t){var e=this._originPos;t!==e.y&&(e.y=t,this._posDirty(!0))},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX},set:function(){cc.warnID(1638)},override:!0},showInEditor:{default:!1,editorOnly:!0,override:!0}},ctor:function(t){this._localZOrder=cc.macro.MIN_ZINDEX<<16,this._originPos=cc.v2()},_posDirty:function(t){this.setLocalDirty(s.POSITION),this._renderFlag|=r.FLAG_TRANSFORM,!0===t&&1&this._eventMask&&this.emit(n.EventType.POSITION_CHANGED)},_updateLocalMatrix:function(){var t;this._localMatDirty&&((t=this.parent)&&(this._trs[0]=this._originPos.x-(t._anchorPoint.x-.5)*t._contentSize.width,this._trs[1]=this._originPos.y-(t._anchorPoint.y-.5)*t._contentSize.height),this._super())},getPosition:function(){return new cc.Vec2(this._originPos)},setPosition:function(t,e){void 0===e&&(e=(t=t.x).y);var i=this._originPos;i.x===t&&i.y===e||(i.x=t,i.y=e,this._posDirty(!0))},setParent:function(t){var e=this._parent;this._super(t),e!==t&&(e&&e.off(n.EventType.ANCHOR_CHANGED,this._posDirty,this),t&&t.on(n.EventType.ANCHOR_CHANGED,this._posDirty,this))},_updateOrderOfArrival:function(){}});cc.js.getset(t.prototype,"parent",t.prototype.getParent,t.prototype.setParent),cc.js.getset(t.prototype,"position",t.prototype.getPosition,t.prototype.setPosition),cc.PrivateNode=e.exports=t},{"./CCNode":30,"./renderer/render-flow":221}],32:[function(t,e,i){"use strict";cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{_is3DNode:{default:!0,override:!0},autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){if(cc.Object.prototype.destroy.call(this))for(var t=this._children,e=0;e<t.length;++e)t[e].active=!1;this._active=!1,this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),e.exports=cc.Scene},{"./CCNode":30}],33:[function(t,n,r){"use strict";function o(t,e,i,n){this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=n}function a(t,e,i,n){this.list=t,this.entry=e,this.target=i,this.callback=n}function h(t,e,i,n,r,s){var o=this;o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=n,o.currentTimerSalvaged=r,o.paused=s}var e=t("./platform/js"),t=t("./platform/id-generater"),_=new t("Scheduler"),s=[],c=(o.get=function(t,e,i,n){var r=s.pop();return r?(r.target=t,r.priority=e,r.paused=i,r.markedForDeletion=n):r=new o(t,e,i,n),r},o.put=function(t){s.length<20&&(t.target=null,s.push(t))},[]),l=(a.get=function(t,e,i,n){var r=c.pop();return r?(r.list=t,r.entry=e,r.target=i,r.callback=n):r=new a(t,e,i,n),r},a.put=function(t){c.length<20&&(t.list=t.entry=t.target=t.callback=null,c.push(t))},[]);function u(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}h.get=function(t,e,i,n,r,s){var o=l.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=n,o.currentTimerSalvaged=r,o.paused=s):o=new h(t,e,i,n,r,s),o},h.put=function(t){l.length<20&&(t.timers=t.target=t.currentTimer=null,l.push(t))};var t=u.prototype,i=(t.initWithCallback=function(t,e,i,n,r,s){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=n,this._delay=s,this._useDelay=0<this._delay,this._repeat=r,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(t){this._interval=t},t.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},[]);u.get=function(){return i.pop()||new u},u.put=function(t){i.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,i.push(t))},cc.Scheduler=function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=e.createMap(!0),this._hashForTimers=e.createMap(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(t){delete this._hashForTimers[t.target._id];for(var e=this._arrayForTimers,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1);break}h.put(t)},_removeUpdateFromHash:function(t){var t=t.target._id,e=this._hashForUpdates[t];if(e){for(var i=e.list,n=e.entry,r=0,s=i.length;r<s;r++)if(i[r]===n){i.splice(r,1);break}delete this._hashForUpdates[t],o.put(n),a.put(e)}},_priorityIn:function(t,e,i){for(var n=0;n<t.length;n++)if(i<t[n].priority)return void t.splice(n,0,e);t.push(e)},_appendIn:function(t,e){t.push(e)},enableForTarget:function(t){t._id||(t.__instanceId?cc.warnID(1513):t._id=_.getNewId())},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,i,n;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),o=0,i=(e=this._updatesNegList).length;o<i;o++)(n=e[o]).paused||n.markedForDeletion||n.target.update(t);for(o=0,i=(e=this._updates0List).length;o<i;o++)(n=e[o]).paused||n.markedForDeletion||n.target.update(t);for(o=0,i=(e=this._updatesPosList).length;o<i;o++)(n=e[o]).paused||n.markedForDeletion||n.target.update(t);for(var r,s=this._arrayForTimers,o=0;o<s.length;o++){if(r=s[o],this._currentTarget=r,this._currentTargetSalvaged=!1,!r.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;++r.timerIndex)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(t),r.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--o)}for(o=0,e=this._updatesNegList;o<e.length;)(n=e[o]).markedForDeletion?this._removeUpdateFromHash(n):o++;for(o=0,e=this._updates0List;o<e.length;)(n=e[o]).markedForDeletion?this._removeUpdateFromHash(n):o++;for(o=0,e=this._updatesPosList;o<e.length;)(n=e[o]).markedForDeletion?this._removeUpdateFromHash(n):o++;this._updateHashLocked=!1,this._currentTarget=null},schedule:function(t,e,i,n,l,r){"function"!=typeof t&&(a=t,t=e,e=a),4!==arguments.length&&5!==arguments.length||(r=!!n,n=cc.macro.REPEAT_FOREVER,l=0),cc.assertID(e,1502);var s,o,a=e._id,c=(a||(e.__instanceId?(cc.warnID(1513),a=e._id=e.__instanceId):cc.errorID(1510)),this._hashForTimers[a]);if(c?c.paused!==r&&cc.warnID(1511):(c=h.get(null,e,0,null,null,r),this._arrayForTimers.push(c),this._hashForTimers[a]=c),null==c.timers)c.timers=[];else for(o=0;o<c.timers.length;++o)if((s=c.timers[o])&&t===s._callback)return cc.logID(1507,s.getInterval(),i),void(s._interval=i);(s=u.get()).initWithCallback(this,t,e,i,n,l),c.timers.push(s),this._currentTarget===c&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(t,e,i){var n=t._id,r=(n||(t.__instanceId?(cc.warnID(1513),n=t._id=t.__instanceId):cc.errorID(1510)),this._hashForUpdates[n]);if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(t)}var s,r=o.get(t,e,i,!1);0===e?(s=this._updates0List,this._appendIn(s,r)):(s=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,r,e)),this._hashForUpdates[n]=a.get(s,r,t,null)},unschedule:function(t,e){if(e&&t){var i=e._id,n=(i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510)),this._hashForTimers[i]);if(n)for(var r=n.timers,s=0,o=r.length;s<o;s++){var a=r[s];if(t===a._callback)return a!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(s,1),u.put(a),n.timerIndex>=s&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}},unscheduleUpdate:function(t){var e;t&&((e=t._id)||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),(t=this._hashForUpdates[e])&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry)))},unscheduleAllForTarget:function(t){if(t){var e=t._id,e=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]);if(e){var i=e.timers;-1<i.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0);for(var n=0,r=i.length;n<r;n++)u.put(i[n]);i.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){for(var e,i,n=this._arrayForTimers,r=n.length-1;0<=r;r--)e=n[r],this.unscheduleAllForTarget(e.target);var s=0;if(t<0)for(r=0;r<this._updatesNegList.length;)s=this._updatesNegList.length,(i=this._updatesNegList[r])&&i.priority>=t&&this.unscheduleUpdate(i.target),s==this._updatesNegList.length&&r++;if(t<=0)for(r=0;r<this._updates0List.length;)s=this._updates0List.length,(i=this._updates0List[r])&&this.unscheduleUpdate(i.target),s==this._updates0List.length&&r++;for(r=0;r<this._updatesPosList.length;)s=this._updatesPosList.length,(i=this._updatesPosList[r])&&i.priority>=t&&this.unscheduleUpdate(i.target),s==this._updatesPosList.length&&r++},isScheduled:function(t,e){cc.assertID(t,1508),cc.assertID(e,1509);var i=e._id,e=(i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510)),this._hashForTimers[i]);if(!e)return!1;if(null==e.timers)return!1;for(var n=e.timers,r=0;r<n.length;++r)if(t===n[r]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){for(var e,i,n=[],r=this._arrayForTimers,s=0,o=r.length;s<o;s++)(e=r[s])&&(e.paused=!0,n.push(e.target));if(t<0)for(s=0;s<this._updatesNegList.length;s++)(i=this._updatesNegList[s])&&i.priority>=t&&(i.paused=!0,n.push(i.target));if(t<=0)for(s=0;s<this._updates0List.length;s++)(i=this._updates0List[s])&&(i.paused=!0,n.push(i.target));for(s=0;s<this._updatesPosList.length;s++)(i=this._updatesPosList[s])&&i.priority>=t&&(i.paused=!0,n.push(i.target));return n},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assertID(t,1503);var e=t._id,t=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]),t=(t&&(t.paused=!0),this._hashForUpdates[e]);t&&(t.entry.paused=!0)},resumeTarget:function(t){cc.assertID(t,1504);var e=t._id,t=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]),t=(t&&(t.paused=!1),this._hashForUpdates[e]);t&&(t.entry.paused=!1)},isTargetPaused:function(t){cc.assertID(t,1505);var e=t._id,t=(e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),this._hashForTimers[e]);if(t)return t.paused;t=this._hashForUpdates[e];return!!t&&t.entry.paused}},cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1,n.exports=cc.Scheduler},{"./platform/id-generater":205,"./platform/js":209}],34:[function(t,e,i){"use strict";t=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:t,ctor:function(){this.loaded=!0,this.url=""},properties:{nativeUrl:{get:function(){if(this._native){var t,e=this._native;if(47===e.charCodeAt(0))return e.slice(1);if(cc.AssetLibrary)return t=cc.AssetLibrary.getLibUrlNoExt(this._uuid,!0),46===e.charCodeAt(0)?t+e:t+"/"+e;cc.errorID(6400)}return""},visible:!1},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset},set:function(t){this._$nativeAsset=t}}},statics:{deserialize:!1,preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl},serialize:!1,createNode:null,_setRawAsset:function(t,e){this._native=!1!==e?t||void 0:"/"+t}}),e.exports=cc.Asset},{"./CCRawAsset":42}],35:[function(t,e,i){"use strict";var n=t("./CCAsset"),t=t("../event/event-target"),r=cc.Enum({WEB_AUDIO:0,DOM_AUDIO:1}),s=cc.Class({name:"cc.AudioClip",extends:n,mixins:[t],ctor:function(){this.loaded=!1,this._audio=null},properties:{loadMode:{default:r.WEB_AUDIO,type:r},_nativeAsset:{get:function(){return this._audio},set:function(t){t instanceof cc.AudioClip?this._audio=t._nativeAsset:this._audio=t,this._audio&&(this.loaded=!0,this.emit("load"))},override:!0}},statics:{LoadMode:r,_loadByUrl:function(i,n){var r=cc.loader.getItem(i)||cc.loader.getItem(i+"?useDom=1");r&&r.complete?r._owner instanceof s?n(null,r._owner):n(null,r.content):cc.loader.load(i,function(t,e){if(t)return n(t);r=cc.loader.getItem(i)||cc.loader.getItem(i+"?useDom=1"),n(null,r.content)})}},destroy:function(){cc.audioEngine.uncache(this),this._super()}});cc.AudioClip=s,e.exports=s},{"../event/event-target":115,"./CCAsset":34}],36:[function(t,e,i){"use strict";function s(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0}function o(t){this._letterDefinitions={},this._texture=t}o.prototype={constructor:o,addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t,e={};for(t in this._letterDefinitions){var i=new s;cc.js.mixin(i,this._letterDefinitions[t]),e[t]=i}return e},getTexture:function(){return this._texture},getLetter:function(t){return this._letterDefinitions[t]},getLetterDefinitionForChar:function(t){t=t.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(t)?this._letterDefinitions[t]:null},clear:function(){this._letterDefinitions={}}};var n=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null,_fontDefDictionary:null},onLoad:function(){var t=this.spriteFrame,t=(!this._fontDefDictionary&&t&&(this._fontDefDictionary=new o(t._texture)),this._fntConfig);if(t){var e,i=t.fontDefDictionary;for(e in i){var n=new s,r=i[e].rect;n.offsetX=i[e].xOffset,n.offsetY=i[e].yOffset,n.w=r.width,n.h=r.height,n.u=r.x,n.v=r.y,n.textureID=0,n.valid=!0,n.xAdvance=i[e].xAdvance,this._fontDefDictionary.addLetterDefinitions(e,n)}}}});cc.BitmapFont=n,cc.BitmapFont.FontLetterDefinition=s,cc.BitmapFont.FontAtlas=o,e.exports=n},{}],37:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.BufferAsset",extends:cc.Asset,ctor:function(){this._buffer=null},properties:{_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t},override:!0},buffer:function(){return this._buffer}}});cc.BufferAsset=e.exports=n},{}],38:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=e.exports=n},{}],39:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.JsonAsset",extends:cc.Asset,properties:{json:null}});e.exports=cc.JsonAsset=n},{}],40:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont,onLoad:function(){this.spriteFrame?this._fntConfig?this._super():cc.warnID(9101,this.name):cc.warnID(9100,this.name)}});cc.LabelAtlas=n,e.exports=n},{}],41:[function(e,t,i){"use strict";var n=cc.Enum({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),n=cc.Class({name:"cc.Prefab",extends:cc.Asset,ctor:function(){this._createFunction=null,this._instantiatedTimes=0},properties:{data:null,optimizationPolicy:n.AUTO,asyncLoadAssets:!1,readonly:{default:!1,editorOnly:!0}},statics:{OptimizationPolicy:n,OptimizationPolicyThreshold:3},createNode:!1,compileCreateFunction:function(){var t=e("../platform/instantiate-jit");this._createFunction=t.compile(this.data)},_doInstantiate:function(t){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},_instantiate:function(){var t;return this.data._prefab._synced=!0,t=this.data._instantiate(),++this._instantiatedTimes,t},destroy:function(){this.data&&this.data.destroy(),this._super()}});cc.Prefab=t.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":207}],42:[function(t,e,i){"use strict";var n=t("../platform/CCObject"),r=t("../platform/js");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})}}),r.value(cc.RawAsset,"isRawAssetType",function(t){return r.isChildClassOf(t,cc.RawAsset)&&!r.isChildClassOf(t,cc.Asset)}),r.value(cc.RawAsset,"wasRawAssetType",function(t){return t===cc.Texture2D||t===cc.AudioClip||t===cc.ParticleAsset||t===cc.Asset}),e.exports=cc.RawAsset},{"../platform/CCObject":195,"../platform/js":209}],43:[function(t,e,i){"use strict";var s=(n=t("../../renderer/gfx"))&&n.__esModule?n:{default:n};var o=t("../renderer"),n=t("./CCTexture2D"),t=cc.Enum({RB_FMT_D24S8:s.default.RB_FMT_D24S8,RB_FMT_S8:s.default.RB_FMT_S8,RB_FMT_D16:s.default.RB_FMT_D16}),n=cc.Class({name:"cc.RenderTexture",extends:n,statics:{DepthStencilFormat:t},ctor:function(){this._framebuffer=null},initWithSize:function(t,e,i){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var n,r={colors:[this._texture]};this._depthStencilBuffer&&this._depthStencilBuffer.destroy(),i&&(n=new s.default.RenderBuffer(o.device,i,t,e),i===s.default.RB_FMT_D24S8?r.depthStencil=n:i===s.default.RB_FMT_S8?r.stencil=n:i===s.default.RB_FMT_D16&&(r.depth=n)),this._depthStencilBuffer=n,this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=new s.default.FrameBuffer(o.device,t,e,r),this._packable=!1,this.loaded=!0,this.emit("load")},updateSize:function(t,e){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var i=this._depthStencilBuffer;i&&i.update(this.width,this.height),this._framebuffer._width=t,this._framebuffer._height=e},drawTextureAt:function(t,e,i){t._image&&0!==t._image.width&&this._texture.updateSubImage({x:e,y:i,image:t._image,width:t.width,height:t.height,level:0,flipY:!1,premultiplyAlpha:t._premultiplyAlpha})},readPixels:function(t,e,i,n,r){if(!this._framebuffer||!this._texture)return t;e=e||0,i=i||0;var n=n||this.width,r=r||this.height,s=(t=t||new Uint8Array(n*r*4),cc.game._renderContext),o=s.getParameter(s.FRAMEBUFFER_BINDING);return s.bindFramebuffer(s.FRAMEBUFFER,this._framebuffer.getHandle()),s.readPixels(e,i,n,r,s.RGBA,s.UNSIGNED_BYTE,t),s.bindFramebuffer(s.FRAMEBUFFER,o),t},destroy:function(){this._super(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null)}});cc.RenderTexture=e.exports=n},{"../../renderer/gfx":312,"../renderer":220,"./CCTexture2D":50}],44:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=n,e.exports=n},{}],45:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Script",extends:cc.Asset}),r=(cc._Script=n,cc.Class({name:"cc.JavaScript",extends:n})),r=(cc._JavaScript=r,cc.Class({name:"cc.CoffeeScript",extends:n})),r=(cc._CoffeeScript=r,cc.Class({name:"cc.TypeScript",extends:n}));cc._TypeScript=r},{}],46:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);return 0<t.length&&(t=this._spriteFrames[t[0]])?t.getTexture():null},getSpriteFrame:function(t){var e=this._spriteFrames[t];return e?(e.name||(e.name=t),e):null},getSpriteFrames:function(){var t,e=[];for(t in this._spriteFrames)e.push(this.getSpriteFrame(t));return e}});cc.SpriteAtlas=n,e.exports=n},{}],47:[function(t,e,i){"use strict";var s=t("../event/event-target"),n=t("../utils/texture-util"),y=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],r=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[s],properties:{_textureSetter:{set:function(t){t&&(this._texture!==t&&this._refreshTexture(t),this._textureFilename=t.url)}},insetTop:{get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]=t,this._texture&&this._calculateSlicedUV()}},insetBottom:{get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]=t,this._texture&&this._calculateSlicedUV()}},insetLeft:{get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]=t,this._texture&&this._calculateSlicedUV()}},insetRight:{get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]=t,this._texture&&this._calculateSlicedUV()}}},ctor:function(){s.call(this);var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];this._rect=null,this.uv=[],this._texture=null,this._original=null,this._offset=null,this._originalSize=null,this._rotated=!1,this._flipX=!1,this._flipY=!1,this.vertices=null,this._capInsets=[0,0,0,0],this.uvSliced=[],this._textureFilename="",void 0!==t&&this.setTexture(t,e,i,n,r)},textureLoaded:function(){return this._texture&&this._texture.loaded},onTextureLoaded:function(t,e){return this.textureLoaded()?(t.call(e),!0):(this.once("load",t,e),this.ensureLoadTexture(),!1)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t,this._texture&&this._calculateUV()},isFlipX:function(){return this._flipX},isFlipY:function(){return this._flipY},setFlipX:function(t){this._flipX=t,this._texture&&this._calculateUV()},setFlipY:function(t){this._flipY=t,this._texture&&this._calculateUV()},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_textureLoadedCallback:function(){var t,e=this,i=this._texture;i&&(t=i.width,i=i.height,e._rect?e._checkRect(e._texture):e._rect=cc.rect(0,0,t,i),e._originalSize||e.setOriginalSize(cc.size(t,i)),e._offset||e.setOffset(cc.v2(0,0)),e._calculateUV(),e.emit("load"))},_refreshTexture:function(t){(this._texture=t).loaded?this._textureLoadedCallback():t.once("load",this._textureLoadedCallback,this)},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new r(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,i,n,r){this._rect=e||null,n?this.setOffset(n):this._offset=null,r?this.setOriginalSize(r):this._originalSize=null,this._rotated=i||!1;e=t;return"string"==typeof e&&e&&(this._textureFilename=e,this._loadTexture()),e instanceof cc.Texture2D&&this._texture!==e&&this._refreshTexture(e),!0},_loadTexture:function(){var t;this._textureFilename&&(t=n.loadImage(this._textureFilename),this._refreshTexture(t))},ensureLoadTexture:function(){this._texture?this._texture.loaded||(this._refreshTexture(this._texture),n.postLoadTexture(this._texture)):this._textureFilename&&this._loadTexture()},_checkRect:function(t){var e=this._rect,i=e.x,n=e.y;this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.width&&cc.errorID(3300,t.url+"/"+this.name,i,t.width),n>t.height&&cc.errorID(3400,t.url+"/"+this.name,n,t.height)},_flipXY:function(t){var e;this._flipX&&(e=t[0],t[0]=t[1],t[1]=e,e=t[2],t[2]=t[3],t[3]=e),this._flipY&&(e=t[0],t[0]=t[2],t[2]=e,e=t[1],t[1]=t[3],t[3]=e)},_calculateSlicedUV:function(){var t=this._rect,e=this._texture.width,i=this._texture.height,n=this._capInsets[0],r=this._capInsets[2],r=t.width-n-r,s=this._capInsets[1],o=this._capInsets[3],h=t.height-s-o,a=this.uvSliced;if(a.length=0,this._rotated){y[0].u=t.x/e,y[1].u=(t.x+o)/e,y[2].u=(t.x+o+h)/e,y[3].u=(t.x+t.height)/e,y[3].v=t.y/i,y[2].v=(t.y+n)/i,y[1].v=(t.y+n+r)/i,y[0].v=(t.y+t.width)/i,this._flipXY(y);for(var c=0;c<4;++c)for(var u=y[c],l=0;l<4;++l){var _=y[3-l];a.push({u:u.u,v:_.v})}}else{y[0].u=t.x/e,y[1].u=(t.x+n)/e,y[2].u=(t.x+n+r)/e,y[3].u=(t.x+t.width)/e,y[3].v=t.y/i,y[2].v=(t.y+s)/i,y[1].v=(t.y+s+h)/i,y[0].v=(t.y+t.height)/i,this._flipXY(y);for(var d=0;d<4;++d)for(var f=y[d],p=0;p<4;++p){var m=y[p];a.push({u:m.u,v:f.v})}}},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_calculateUV:function(){var t,e,i,n=this._rect,r=this._texture,s=this.uv,o=r.width,a=r.height,c=(this._rotated?(r=0===o?0:n.x/o,i=0===o?0:(n.x+n.height)/o,e=0===a?0:(n.y+n.width)/a,t=0===a?0:n.y/a,s[0]=r,s[1]=t,s[2]=r,s[3]=e,s[4]=i,s[5]=t,s[6]=i,s[7]=e):(r=0===o?0:n.x/o,t=0===o?0:(n.x+n.width)/o,i=0===a?0:(n.y+n.height)/a,e=0===a?0:n.y/a,s[0]=r,s[1]=i,s[2]=t,s[3]=i,s[4]=r,s[5]=e,s[6]=t,s[7]=e),this._flipX&&(n=s[0],s[0]=s[2],s[2]=n,n=s[1],s[1]=s[3],s[3]=n,n=s[4],s[4]=s[6],s[6]=n,n=s[5],s[5]=s[7],s[7]=n),this._flipY&&(i=s[0],s[0]=s[4],s[4]=i,i=s[1],s[1]=s[5],s[5]=i,i=s[2],s[2]=s[6],s[6]=i,i=s[3],s[3]=s[7],s[7]=i),this.vertices);if(c){c.nu.length=0;for(var l=c.nv.length=0;l<c.u.length;l++)c.nu[l]=c.u[l]/o,c.nv[l]=c.v[l]/a}this._calculateSlicedUV()},_serialize:!1,_deserialize:function(t,e){var i=t.rect,i=(i&&(this._rect=new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name,t.capInsets),i=(i&&(this._capInsets[0]=i[0],this._capInsets[1]=i[1],this._capInsets[2]=i[2],this._capInsets[3]=i[3]),this.vertices=t.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[]),t.texture);i&&e.result.push(this,"_textureSetter",i)}}),t=r.prototype;t.copyWithZone=t.clone,t.copy=t.clone,t.initWithTexture=t.setTexture,cc.SpriteFrame=r,e.exports=r},{"../assets/CCAsset":34,"../event/event-target":115,"../utils/texture-util":272}],48:[function(t,e,i){"use strict";t=t("./CCFont"),t=cc.Class({name:"cc.TTFFont",extends:t,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"},override:!0}}});cc.TTFFont=e.exports=t},{"./CCFont":38}],49:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TextAsset",extends:cc.Asset,properties:{text:""},toString:function(){return this.text}});e.exports=cc.TextAsset=n},{}],50:[function(t,r,h){"use strict";var e=(e=t("../../renderer/gfx"))&&e.__esModule?e:{default:e};var u=t("../event/event-target"),s=t("../renderer"),_=(t("../platform/CCClass"),new(t("../platform/id-generater"))("Tex")),d=1024,f=cc.Enum({RGB565:e.default.TEXTURE_FMT_R5_G6_B5,RGB5A1:e.default.TEXTURE_FMT_R5_G5_B5_A1,RGBA4444:e.default.TEXTURE_FMT_R4_G4_B4_A4,RGB888:e.default.TEXTURE_FMT_RGB8,RGBA8888:e.default.TEXTURE_FMT_RGBA8,RGBA32F:e.default.TEXTURE_FMT_RGBA32F,A8:e.default.TEXTURE_FMT_A8,I8:e.default.TEXTURE_FMT_L8,AI8:e.default.TEXTURE_FMT_L8_A8,RGB_PVRTC_2BPPV1:e.default.TEXTURE_FMT_RGB_PVRTC_2BPPV1,RGBA_PVRTC_2BPPV1:e.default.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,RGB_A_PVRTC_2BPPV1:d++,RGB_PVRTC_4BPPV1:e.default.TEXTURE_FMT_RGB_PVRTC_4BPPV1,RGBA_PVRTC_4BPPV1:e.default.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,RGB_A_PVRTC_4BPPV1:+d,RGB_ETC1:e.default.TEXTURE_FMT_RGB_ETC1,RGBA_ETC1:1026,RGB_ETC2:e.default.TEXTURE_FMT_RGB_ETC2,RGBA_ETC2:e.default.TEXTURE_FMT_RGBA_ETC2}),c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),l=cc.Enum({LINEAR:9729,NEAREST:9728}),o={9728:0,9729:1},i=[],n={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,genMipmaps:void 0,images:void 0,image:void 0,flipY:void 0,premultiplyAlpha:void 0};function a(){for(var t in n)n[t]=void 0;return i.length=0,n.images=i,n}var p=cc.Class({name:"cc.Texture2D",extends:t("../assets/CCAsset"),mixins:[u],properties:{_nativeAsset:{get:function(){return this._image},set:function(t){t._compressed&&t._data?this.initWithData(t._data,this._format,t.width,t.height):this.initWithElement(t)},override:!0},_format:f.RGBA8888,_premultiplyAlpha:!1,_flipY:!1,_minFilter:l.LINEAR,_magFilter:l.LINEAR,_mipFilter:l.LINEAR,_wrapS:c.CLAMP_TO_EDGE,_wrapT:c.CLAMP_TO_EDGE,_genMipmaps:!1,genMipmaps:{get:function(){return this._genMipmaps},set:function(t){var e;this._genMipmaps!==t&&((e=a()).genMipmaps=t,this.update(e))}},_packable:!0,packable:{get:function(){return this._packable},set:function(t){this._packable=t}}},statics:{PixelFormat:f,WrapMode:c,Filter:l,_FilterIndex:o,extnames:[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm"]},ctor:function(){this._id=_.getNewId(),this.loaded=!1,this.width=0,this.height=0,this._hashDirty=!0,this._hash=0,this._texture=null},getImpl:function(){return this._texture},getId:function(){return this._id},toString:function(){return this.url||""},update:function(t){var e;t&&(e=!1,void 0!==t.width&&(this.width=t.width),void 0!==t.height&&(this.height=t.height),void 0!==t.minFilter&&(this._minFilter=t.minFilter,t.minFilter=o[t.minFilter]),void 0!==t.magFilter&&(this._magFilter=t.magFilter,t.magFilter=o[t.magFilter]),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter,t.mipFilter=o[t.mipFilter]),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format),void 0!==t.flipY&&(this._flipY=t.flipY,e=!0),void 0!==t.premultiplyAlpha&&(this._premultiplyAlpha=t.premultiplyAlpha,e=!0),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps),e&&this._image&&(t.image=this._image),t.images&&0<t.images.length?this._image=t.images[0]:void 0!==t.image&&(this._image=t.image,t.images||(i.length=0,t.images=i),t.images.push(t.image)),this._texture&&this._texture.update(t),this._hashDirty=!0)},initWithElement:function(t){var e;t&&((this._image=t).complete||t instanceof HTMLCanvasElement?this.handleLoadedTexture():(e=this,t.addEventListener("load",function(){e.handleLoadedTexture()}),t.addEventListener("error",function(t){cc.warnID(3119,t.message)})))},initWithData:function(t,e,i,n){var r=a();return r.image=t,r.images=[r.image],r.genMipmaps=this._genMipmaps,r.premultiplyAlpha=this._premultiplyAlpha,r.flipY=this._flipY,r.minFilter=o[this._minFilter],r.magFilter=o[this._magFilter],r.wrapS=this._wrapS,r.wrapT=this._wrapT,r.format=this._getGFXPixelFormat(e),r.width=i,r.height=n,this._texture?this._texture.update(r):this._texture=new s.Texture2D(s.device,r),this.width=i,this.height=n,this._checkPackable(),this.loaded=!0,this.emit("load"),!0},getHtmlElementObj:function(){return this._image},destroy:function(){this._packable&&cc.dynamicAtlasManager&&cc.dynamicAtlasManager.deleteAtlasTexture(this),this._image=null,this._texture&&this._texture.destroy(),this._super()},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},handleLoadedTexture:function(){var t;this._image&&this._image.width&&this._image.height&&(this.width=this._image.width,this.height=this._image.height,(t=a()).image=this._image,t.images=[t.image],t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._getGFXPixelFormat(this._format),t.premultiplyAlpha=this._premultiplyAlpha,t.flipY=this._flipY,t.minFilter=o[this._minFilter],t.magFilter=o[this._magFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,this._texture?this._texture.update(t):this._texture=new s.Texture2D(s.device,t),this._checkPackable(),this.loaded=!0,this.emit("load"),cc.macro.CLEANUP_IMAGE_CACHE&&this._image instanceof HTMLImageElement&&this._clearImage())},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._image=null,this._texture&&this._texture.destroy()},setWrapMode:function(t,e){var i;this._wrapS===t&&this._wrapT===e||((i=a()).wrapS=t,i.wrapT=e,this.update(i))},setFilters:function(t,e){var i;this._minFilter===t&&this._magFilter===e||((i=a()).minFilter=t,i.magFilter=e,this.update(i))},setFlipY:function(t){var e;this._flipY!==t&&((e=a()).flipY=t,this.update(e))},setPremultiplyAlpha:function(t){var e;this._premultiplyAlpha!==t&&((e=a()).premultiplyAlpha=t,this.update(e))},_checkPackable:function(){var t,e,i=cc.dynamicAtlasManager;i&&(this._isCompressed()?this._packable=!1:(t=this.width,e=this.height,!this._image||t>i.maxFrameSize||e>i.maxFrameSize||this._getHash()!==i.Atlas.DEFAULT_HASH?this._packable=!1:this._image&&this._image instanceof HTMLCanvasElement&&(this._packable=!0)))},_getOpts:function(){var t=a();return t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._format,t.premultiplyAlpha=this._premultiplyAlpha,t.anisotropy=this._anisotropy,t.flipY=this._flipY,t.minFilter=o[this._minFilter],t.magFilter=o[this._magFilter],t.mipFilter=o[this._mipFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,t},_getGFXPixelFormat:function(t){return t===f.RGBA_ETC1?t=f.RGB_ETC1:t===f.RGB_A_PVRTC_4BPPV1?t=f.RGB_PVRTC_4BPPV1:t===f.RGB_A_PVRTC_2BPPV1&&(t=f.RGB_PVRTC_2BPPV1),t},_resetUnderlyingMipmaps:function(t){var e=this._getOpts();e.images=t||[null],this._texture?this._texture.update(e):this._texture=new s.Texture2D(s.device,e)},_serialize:!1,_deserialize:function(t,h){var e=cc.renderer.device,t=t.split(","),i=t[0];if(i){for(var n=i.split("_"),r="",s="",u=999,_=this._format,d=cc.macro.SUPPORT_TEXTURE_FORMATS,o=0;o<n.length;o++){var a=n[o].split("@"),c=a[0],c=p.extnames[c.charCodeAt(0)-48]||c,l=d.indexOf(c);-1!==l&&l<u?(a=a[1]?parseInt(a[1]):this._format,(".pvr"!==c||e.ext("WEBGL_compressed_texture_pvrtc"))&&(a!==f.RGB_ETC1&&a!==f.RGBA_ETC1||e.ext("WEBGL_compressed_texture_etc1"))&&(a!==f.RGB_ETC2&&a!==f.RGBA_ETC2||e.ext("WEBGL_compressed_texture_etc"))&&(".webp"===c&&!cc.sys.capabilities.webp||(u=l,s=c,_=a))):r=r||c}s?(this._setRawAsset(s),this._format=_):(this._setRawAsset(r),cc.warnID(3120,h.customEnv.url,r,r))}8===t.length&&(this._minFilter=parseInt(t[1]),this._magFilter=parseInt(t[2]),this._wrapS=parseInt(t[3]),this._wrapT=parseInt(t[4]),this._premultiplyAlpha=49===t[5].charCodeAt(0),this._genMipmaps=49===t[6].charCodeAt(0),this._packable=49===t[7].charCodeAt(0))},_getHash:function(){if(!this._hashDirty)return this._hash;var t=this._genMipmaps?1:0,e=this._premultiplyAlpha?1:0,i=this._flipY?1:0,n=this._minFilter===l.LINEAR?1:2,r=this._magFilter===l.LINEAR?1:2,s=this._wrapS===c.REPEAT?1:this._wrapS===c.CLAMP_TO_EDGE?2:3,o=this._wrapT===c.REPEAT?1:this._wrapT===c.CLAMP_TO_EDGE?2:3,a=this._format;this._image;return this._hash=Number(""+n+r+a+s+o+t+e+i),this._hashDirty=!1,this._hash},_isCompressed:function(){return this._format<f.A8||this._format>f.RGBA32F},_clearImage:function(){cc.loader.removeItem(this._image.id||this._image.src),this._image.src=""}});cc.Texture2D=r.exports=p},{"../../renderer/gfx":312,"../assets/CCAsset":34,"../event/event-target":115,"../platform/CCClass":189,"../platform/id-generater":205,"../renderer":220}],51:[function(t,e,i){"use strict";t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCScripts"),t("./CCSceneAsset"),t("./CCSpriteFrame"),t("./CCTexture2D"),t("./CCRenderTexture"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas"),t("./CCTextAsset"),t("./CCJsonAsset"),t("./CCBufferAsset"),t("./material")},{"./CCAsset":34,"./CCAudioClip":35,"./CCBitmapFont":36,"./CCBufferAsset":37,"./CCFont":38,"./CCJsonAsset":39,"./CCLabelAtlas":40,"./CCPrefab":41,"./CCRawAsset":42,"./CCRenderTexture":43,"./CCSceneAsset":44,"./CCScripts":45,"./CCSpriteAtlas":46,"./CCSpriteFrame":47,"./CCTTFFont":48,"./CCTextAsset":49,"./CCTexture2D":50,"./material":58}],52:[function(t,e,i){"use strict";var n=(n=t("../CCAsset"))&&n.__esModule?n:{default:n},r=t("./effect-parser");t=cc.Class({name:"cc.EffectAsset",extends:n.default,ctor:function(){this._effect=null},properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){for(var t=cc.renderer._forward._programLib,e=0;e<this.shaders.length;e++)t.define(this.shaders[e]);this._initEffect()}},_initEffect:function(){this._effect||(this._effect=(0,r.parseEffect)(this),Object.freeze(this._effect))},getInstantiatedEffect:function(){return this._initEffect(),this._effect.clone()},getEffect:function(){return this._initEffect(),this._effect}});e.exports=cc.EffectAsset=t},{"../CCAsset":34,"./effect-parser":55}],53:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../CCAsset"),a=t("../CCTexture2D"),c=a.PixelFormat,r=t("./CCEffectAsset"),l=t("../../utils/texture-util"),h=cc.gfx,t=cc.Enum({SPRITE:"2d-sprite",GRAY_SPRITE:"2d-gray-sprite",UNLIT:"unlit"}),s=cc.Class({name:"cc.Material",extends:n,ctor:function(){this._manualHash=!1,this._dirty=!0,this._effect=null},properties:{_defines:{default:void 0,type:Object},_props:{default:void 0,type:Object},_effectAsset:{type:r,default:null},_techniqueIndex:0,_techniqueData:Object,effectName:void 0,effectAsset:{get:function(){return this._effectAsset},set:function(t){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&((this._effectAsset=t)?this._effect=this._effectAsset.getInstantiatedEffect():cc.error("Can not set an empty effect asset."))}},effect:{get:function(){return this._effect}},techniqueIndex:{get:function(){return this._techniqueIndex},set:function(t){this._techniqueIndex=t,this._effect.switchTechnique(t)}}},statics:{getBuiltinMaterial:function(t){return cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Material:cc.AssetLibrary.getBuiltin("material","builtin-"+t)},BUILTIN_NAME:t,createWithBuiltin:function(t,e){void 0===e&&(e=0);t=cc.AssetLibrary.getBuiltin("effect","builtin-"+t);return s.create(t,e)},create:function(t,e){if(void 0===e&&(e=0),!t)return null;var i=new s;return i.effectAsset=t,i.techniqueIndex=e,i}},setProperty:function(t,e,i,n){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){if("string"==typeof i&&(i=parseInt(i)),e instanceof a){var r=e.getPixelFormat(),r=r===c.RGBA_ETC1||r===c.RGB_A_PVRTC_4BPPV1||r===c.RGB_A_PVRTC_2BPPV1,s="CC_USE_ALPHA_ATLAS_"+t,o=this.getDefine(s,i);if((r||o)&&this.define(s,r),!e.loaded)return e.once("load",function(){this._effect.setProperty(t,e,i)},this),void l.postLoadTexture(e)}this._effect.setProperty(t,e,i,n)}},getProperty:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getProperty(t,e)},define:function(t,e,i,n){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&("string"==typeof i&&(i=parseInt(i)),this._effect.define(t,e,i,n))},getDefine:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getDefine(t,e)},setCullMode:function(t,e){void 0===t&&(t=h.CULL_BACK),this._effect.setCullMode(t,e)},setDepth:function(t,e,i,n){void 0===i&&(i=h.DS_FUNC_LESS),this._effect.setDepth(t=void 0===t?!1:t,e=void 0===e?!1:e,i,n)},setBlend:function(t,e,i,n,r,s,o,a,c){void 0===e&&(e=h.BLEND_FUNC_ADD),void 0===i&&(i=h.BLEND_SRC_ALPHA),void 0===n&&(n=h.BLEND_ONE_MINUS_SRC_ALPHA),void 0===r&&(r=h.BLEND_FUNC_ADD),void 0===s&&(s=h.BLEND_SRC_ALPHA),void 0===o&&(o=h.BLEND_ONE_MINUS_SRC_ALPHA),this._effect.setBlend(t=void 0===t?!1:t,e,i,n,r,s,o,a=void 0===a?4294967295:a,c)},setStencilEnabled:function(t,e){void 0===t&&(t=h.STENCIL_INHERIT),this._effect.setStencilEnabled(t,e)},setStencil:function(t,e,i,n,r,s,o,a,c){void 0===t&&(t=h.STENCIL_INHERIT),void 0===e&&(e=h.DS_FUNC_ALWAYS),void 0===r&&(r=h.STENCIL_OP_KEEP),void 0===s&&(s=h.STENCIL_OP_KEEP),void 0===o&&(o=h.STENCIL_OP_KEEP),this._effect.setStencil(t,e,i=void 0===i?0:i,n=void 0===n?255:n,r,s,o,a=void 0===a?255:a,c)},updateHash:function(t){this._manualHash=t,this._effect&&this._effect.updateHash(t)},getHash:function(){return this._manualHash||this._effect&&this._effect.getHash()},onLoad:function(){if(this.effectAsset=this._effectAsset,this._effect){this._techniqueIndex&&this._effect.switchTechnique(this._techniqueIndex),this._techniqueData=this._techniqueData||{};var t=this._techniqueData;for(e in t){var e,i=t[e=parseInt(e)];if(i){for(var n in i.defines)this.define(n,i.defines[n],e);for(var r in i.props)this.setProperty(r,i.props[r],e)}}}}});i.default=s,cc.Material=s,e.exports=i.default},{"../../utils/texture-util":272,"../CCAsset":34,"../CCTexture2D":50,"./CCEffectAsset":52}],54:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=(t=t("../../../renderer/core/pass"))&&t.__esModule?t:{default:t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r,o=cc.gfx,a=((t=c.prototype)._createPassProp=function(t,e){var i,n=e._properties[t];if(n)return i=Object.create(null),i.name=t,i.type=n.type,n.value instanceof Float32Array?i.value=new Float32Array(n.value):i.value=n.value,e._properties[t]=i},t._setPassProperty=function(t,e,i,n){var r=i._properties.hasOwnProperty(t);if(r){if(r.value===e)return}else r=this._createPassProp(t,i);return this._dirty=!0,s.default.prototype.setProperty.call(i,t,e,n)},t.setProperty=function(t,e,i,n){var r=!1,s=this.passes,o=0,a=s.length;void 0!==i&&(a=(o=i)+1);for(var c=o;c<a;c++)this._setPassProperty(t,e,s[c],n)&&(r=!0);r||cc.warnID(9103,this.name,t)},t.getProperty=function(t,e){var i=this.passes;if(!(e>=i.length)){var n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++){var o=i[s].getProperty(t);if(void 0!==o)return o}}},t.define=function(t,e,i,n){var r=!1,s=this.passes,o=0,a=s.length;void 0!==i&&(a=(o=i)+1);for(var c=o;c<a;c++)s[c].define(t,e,n)&&(r=!0);r||cc.warnID(9104,this.name,t)},t.getDefine=function(t,e){var i=this.passes;if(!(e>=i.length)){var n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++){var o=i[s].getDefine(t);if(void 0!==o)return o}}},t.setCullMode=function(t,e){void 0===t&&(t=o.CULL_BACK);var i=this.passes,n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++)i[s].setCullMode(t);this._dirty=!0},t.setDepth=function(t,e,i,n){var r=this.passes,s=0,o=r.length;void 0!==n&&(o=(s=n)+1);for(var a=s;a<o;a++)r[a].setDepth(t,e,i);this._dirty=!0},t.setBlend=function(t,e,i,n,r,h,u,_,s){var o=this.passes,a=0,c=o.length;void 0!==s&&(c=(a=s)+1);for(var l=a;l<c;l++)o[l].setBlend(t,e,i,n,r,h,u,_);this._dirty=!0},t.setStencilEnabled=function(t,e){void 0===t&&(t=o.STENCIL_INHERIT);var i=this.passes,n=0,r=i.length;void 0!==e&&(r=(n=e)+1);for(var s=n;s<r;s++)i[s].setStencilEnabled(t);this._dirty=!0},t.setStencil=function(t,e,i,n,r,s,o,a,c){var h=this.passes,u=0,_=h.length;void 0!==c&&(_=(u=c)+1);for(var l=u;l<_;l++){var d=h[l];d.setStencilFront(t,e,i,n,r,s,o,a),d.setStencilBack(t,e,i,n,r,s,o,a)}this._dirty=!0},t=c,(a=[{key:"name",get:function(){return this._name}},{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return[]}}])&&n(t.prototype,a),r&&n(t,r),c);function c(){this._dirty=!0,this._name="",this._technique=null}i.default=a,cc.EffectBase=a,e.exports=i.default},{"../../../renderer/core/pass":303}],55:[function(t,r,e){"use strict";e.__esModule=!0,e.parseEffect=function(t){var e=function(t){for(var e=t.techniques.length,i=new Array(e),n=0;n<e;++n){for(var r=t.techniques[n],h=r.name||n,u=r.passes.length,_=new Array(u),s=0;s<u;++s){var o=r.passes[s],a=o.name||s,c=t.name+"-"+h+"-"+a,l=o.stage||"opaque",d=function(t,e){var i,n=e.properties||{},r=v(e.program);for(i in n)(function(e){if(!r.uniforms.find(function(t){return t.name===e}))cc.warnID(9107,t.name,e)})(i);var s={};return r.uniforms.forEach(function(t){var e=t.name,i=s[e]=Object.assign({},t),e=n[e],e=(m.enums2default[t.type],e?e.type===y.default.PARAM_TEXTURE_2D?null:e.type===y.default.PARAM_INT||e.type===y.default.PARAM_FLOAT?Array.isArray(e.value)?e.value[0]:e.value:new Float32Array(e.value):m.enums2default[t.type]);i.value=e}),s}(t,o),f=function(t){var e={};return v(t.program).defines.forEach(function(t){e[t.name]=m.enums2default[t.type]}),e}(o),a=_[s]=new p.default(a,c,o.program,l,d,f),c=(o.rasterizerState&&a.setCullMode(o.rasterizerState.cullMode),o.blendState&&o.blendState.targets[0]),l=(c&&a.setBlend(c.blend,c.blendEq,c.blendSrc,c.blendDst,c.blendAlphaEq,c.blendSrcAlpha,c.blendDstAlpha,c.blendColor),o.depthStencilState);l&&(a.setDepth(l.depthTest,l.depthWrite,l.depthFunc),a.setStencilFront(l.stencilTest,l.stencilFuncFront,l.stencilRefFront,l.stencilMaskFront,l.stencilFailOpFront,l.stencilZFailOpFront,l.stencilZPassOpFront,l.stencilWriteMaskFront),a.setStencilBack(l.stencilTest,l.stencilFuncBack,l.stencilRefBack,l.stencilMaskBack,l.stencilFailOpBack,l.stencilZFailOpBack,l.stencilZPassOpBack,l.stencilWriteMaskBack))}i[n]=new g.default(h,_)}return i}(t);return new i.default(t.name,e,0,t)};var p=n(t("../../../renderer/core/pass")),m=t("../../../renderer/types"),y=n(t("../../../renderer/enums")),i=n(t("./effect")),g=n(t("../../../renderer/core/technique"));function n(t){return t&&t.__esModule?t:{default:t}}function v(t){return cc.renderer._forward._programLib.getTemplate(t)}},{"../../../renderer/core/pass":303,"../../../renderer/core/technique":305,"../../../renderer/enums":307,"../../../renderer/types":335,"./effect":57}],56:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=n(t("../../../renderer/murmurhash2_gc")),s=n(t("./utils")),t=n(t("./effect-base"));function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(i){return function(){var t,e=o(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}cc.gfx;t=function(i){var t,e;n=i,(t=o).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n,c(o);function o(t){var e=i.call(this)||this;return e._effect=void 0,e._passes=[],e._stagePasses={},e._hash=0,e.init(t),e}t=o,(n=[{key:"effect",get:function(){return this._effect}},{key:"name",get:function(){return this._effect&&this._effect.name+" (variant)"}},{key:"passes",get:function(){return this._passes}},{key:"stagePasses",get:function(){return this._stagePasses}}])&&a(t.prototype,n),e&&a(t,e);var n=o.prototype;return n._onEffectChanged=function(){},n.init=function(t){if(t instanceof o&&(t=t.effect),this._effect=t,this._dirty=!0,t)for(var e=t.passes,i=this._passes,n=(i.length=0,this._stagePasses={}),r=0;r<e.length;r++){var s=i[r]=Object.setPrototypeOf({},e[r]);s._properties=Object.setPrototypeOf({},e[r]._properties),s._defines=Object.setPrototypeOf({},e[r]._defines),n[s._stage]||(n[s._stage]=[]),n[s._stage].push(s)}},n.updateHash=function(t){},n.getHash=function(){if(!this._dirty)return this._hash;this._dirty=!1;var t="",e=(t+=s.default.serializePasses(this._passes),this._effect);return e&&(t+=s.default.serializePasses(e.passes)),this._hash=(0,r.default)(t,666),this.updateHash(this._hash),this._hash},o}(t.default);i.default=t,cc.EffectVariant=t,e.exports=i.default},{"../../../renderer/murmurhash2_gc":330,"./effect-base":54,"./utils":61}],57:[function(t,e,i){"use strict";function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(i){return function(){var t,e=n(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=n(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.__esModule=!0,i.default=void 0;t=function(s){var t,e;i=s,(t=n).prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i,o(n);function n(t,e,i,n){var r=s.call(this)||this;return r._techniques=[],r._asset=null,r.init(t,e,i,n,!0),r}t=n,(i=[{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return this._technique.passes}}])&&r(t.prototype,i),e&&r(t,e);var i=n.prototype;return i.init=function(t,e,i,n,r){this._name=t,this._techniques=e,this._technique=e[i],this._asset=n},i.switchTechnique=function(t){t>=this._techniques.length?cc.warn("Can not switch to technique with index ["+t+"]"):this._technique=this._techniques[t]},i.clear=function(){this._techniques=[]},i.clone=function(){for(var t=[],e=0;e<this._techniques.length;e++)t.push(this._techniques[e].clone());var i=this._techniques.indexOf(this._technique);return new n(this._name,t,i,this._asset)},n}(((t=t("./effect-base"))&&t.__esModule?t:{default:t}).default);i.default=t,cc.Effect=t,e.exports=i.default},{"./effect-base":54}],58:[function(t,e,i){"use strict";t("./CCEffectAsset"),t("./CCMaterial"),t("./material-variant")},{"./CCEffectAsset":52,"./CCMaterial":53,"./material-variant":60}],59:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r,n,s=o(t("./utils")),t=o(t("../../utils/pool"));function o(t){return t&&t.__esModule?t:{default:t}}function h(i){return function(){var t,e=a(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(t=r.call.apply(r,[this].concat(i))||this).enabled=!1,t._pool={},t}r=t.default,l=r,(n=c).prototype=Object.create(l.prototype),(n.prototype.constructor=n).__proto__=l,h(c),(n=c.prototype).get=function(t,e){var i,n,r=this._pool;if(t instanceof cc.MaterialVariant){if(!t._owner)return t._owner=e,t;if(t._owner===e)return t;t=t.material}return!this.enabled||r[i=t.effectAsset._uuid]&&(n=s.default.serializeDefines(t._effect._defines)+s.default.serializeTechniques(t._effect._techniques),n=r[i][n]&&r[i][n].pop()),n?this.count--:((n=new cc.MaterialVariant(t))._name=t._name+" (Instance)",n._uuid=t._uuid),n._owner=e,n},n.put=function(t){var e,i,n;this.enabled&&t._owner&&((e=this._pool)[i=t.effectAsset._uuid]||(e[i]={}),n=s.default.serializeDefines(t._effect._defines)+s.default.serializeTechniques(t._effect._techniques),e[i][n]||(e[i][n]=[]),this.count>this.maxSize||(this._clean(t),e[i][n].push(t),this.count++))},n.clear=function(){this._pool={},this.count=0},n._clean=function(t){t._owner=null};var l=new c;t.default.register("material",l),i.default=l,e.exports=i.default},{"../../utils/pool":266,"./utils":61}],60:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=n(t("./CCMaterial")),o=n(t("./effect-variant")),a=n(t("./material-pool"));function n(t){return t&&t.__esModule?t:{default:t}}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=(0,cc._decorator.ccclass)("cc.MaterialVariant")(t=function(i){var t,e,n;e=i,(t=r).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e,l(r);function r(t){var e=i.call(this)||this;return e._owner=null,e._material=null,e.init(t),e}return r.createWithBuiltin=function(t,e){return r.create(s.default.getBuiltinMaterial(t),e)},r.create=function(t,e){return t?a.default.get(t,e):null},t=r,(e=[{key:"uuid",get:function(){return this._material.uuid}},{key:"owner",get:function(){return this._owner}},{key:"material",get:function(){return this._material}}])&&c(t.prototype,e),n&&c(t,n),r.prototype.init=function(t){this._effect=new o.default(t.effect),this._effectAsset=t._effectAsset,this._material=t},r}(s.default))||t;i.default=t,cc.MaterialVariant=t,e.exports=i.default},{"./CCMaterial":53,"./effect-variant":56,"./material-pool":59}],61:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=(t=t("../../../renderer/enums"))&&t.__esModule?t:{default:t};function o(t){var e,i="";for(e in t)i+=e+t[e];return i}function a(t){var e,i="";for(e in t){var n=t[e],r=n.value;r&&(n.type===s.default.PARAM_TEXTURE_2D||n.type===s.default.PARAM_TEXTURE_CUBE?i+=r._id+";":i+=r.toString()+";")}return i}i.default={serializeDefines:o,serializePasses:function(t){for(var e,i,n,r="",s=0;s<t.length;s++)r+=(e=t[s],n=i=void 0,n=e._programName+e._cullMode,e._blend&&(n+=e._blendEq+e._blendAlphaEq+e._blendSrc+e._blendDst+e._blendSrcAlpha+e._blendDstAlpha+e._blendColor),e._depthTest&&(n+=e._depthWrite+e._depthFunc),e._stencilTest&&(n+=e._stencilFuncFront+e._stencilRefFront+e._stencilMaskFront+e._stencilFailOpFront+e._stencilZFailOpFront+e._stencilZPassOpFront+e._stencilWriteMaskFront+e._stencilFuncBack+e._stencilRefBack+e._stencilMaskBack+e._stencilFailOpBack+e._stencilZFailOpBack+e._stencilZPassOpBack+e._stencilWriteMaskBack),i||(n+=a(e._properties)),n+=o(e._defines));return r},serializeUniforms:a},e.exports=i.default},{"../../../renderer/enums":307}],62:[function(t,e,i){"use strict";t("../CCNode").EventType;var x=56,b=7,o=cc.Enum({ONCE:0,ON_WINDOW_RESIZE:1,ALWAYS:2});var A=cc.Vec2.ZERO,C=cc.Vec2.ONE;function a(t,e){var h,u,i,n,r,s,o,a,c,l,_,d=e._target,f=(d?function(t,h,e,i){for(var n=t._parent.scaleX,r=t._parent.scaleY,s=0,o=0,a=t._parent;;){if(s+=a.x,o+=a.y,!(a=a._parent))return e.x=e.y=0,i.x=i.y=1;if(a===h)break;var c=a.scaleX,l=a.scaleY;s*=c,o*=l,n*=c,r*=l}i.x=0!==n?1/n:1,i.y=0!==r?1/r:1,e.x=-s,e.y=-o}(t,h=d,u=A,i=C):h=t._parent,(f=h)instanceof cc.Scene?cc.visibleRect:f._contentSize),p=h._anchorPoint,m=h instanceof cc.Scene,y=t.x,g=t.y,v=t._anchorPoint;e._alignFlags&x&&(r=f.width,a=m?(o=cc.visibleRect.left.x,cc.visibleRect.right.x):(o=-p.x*r)+r,o+=e._isAbsLeft?e._left:e._left*r,a-=e._isAbsRight?e._right:e._right*r,d&&(o=(o+=u.x)*i.x,a=(a+=u.x)*i.x),c=v.x,(s=t.scaleX)<0&&(c=1-c,s=-s),y=e.isStretchWidth?(l=a-o,0!==s&&(t.width=l/s),o+c*l):(l=t.width*s,e.isAlignHorizontalCenter?(s=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*r,r=(.5-p.x)*f.width,d&&(s*=i.x,r=(r+=u.x)*i.x),r+(c-.5)*l+s):e.isAlignLeft?o+c*l:a+(c-1)*l)),e._alignFlags&b&&(r=f.height,s=m?(n=cc.visibleRect.bottom.y,cc.visibleRect.top.y):(n=-p.y*r)+r,n+=e._isAbsBottom?e._bottom:e._bottom*r,s-=e._isAbsTop?e._top:e._top*r,d&&(n=(n+=u.y)*i.y,s=(s+=u.y)*i.y),o=v.y,(a=t.scaleY)<0&&(o=1-o,a=-a),g=e.isStretchHeight?(_=s-n,0!==a&&(t.height=_/a),n+o*_):(_=t.height*a,e.isAlignVerticalCenter?(c=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*r,l=(.5-p.y)*f.height,d&&(c*=i.y,l=(l+=u.y)*i.y),l+(o-.5)*_+c):e.isAlignBottom?n+o*_:s+(o-1)*_)),t.setPosition(y,g)}function r(){var t=cc.director.getScene();if(t){if(n.isAligning=!0,n._nodesOrderDirty)c.length=0,function t(e){for(var i=e._widget,n=(i&&(a(e,i),i.alignMode!==o.ALWAYS?i.enabled=!1:c.push(i)),e._children),r=0;r<n.length;r++){var s=n[r];s._active&&t(s)}}(t),n._nodesOrderDirty=!1;else{var e,i=n._activeWidgetsIterator;for(i.i=0;i.i<c.length;++i.i)a((e=c[i.i]).node,e)}n.isAligning=!1}}var c=[];var n=cc._widgetManager=e.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(c),init:function(t){t.on(cc.Director.EVENT_AFTER_UPDATE,r);t=this.onResized.bind(this);window.addEventListener("resize",t),window.addEventListener("orientationchange",t)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t)},onResized:function(){var t=cc.director.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){for(var e=cc.Node.isNode(t)&&t.getComponent(cc.Widget),i=(e&&e.alignMode===o.ON_WINDOW_RESIZE&&(e.enabled=!0),t._children),n=0;n<i.length;n++){var r=i[n];this.refreshWidgetOnResized(r)}},updateAlignment:function t(e){var i=e._parent,n=(cc.Node.isNode(i)&&t(i),e._widget||e.getComponent(cc.Widget));n&&i&&a(e,n)},AlignMode:o}},{"../CCNode":30}],63:[function(t,h,u){"use strict";var s=t("../value-types"),_=t("../geom-utils"),d=t("../utils/affine-transform"),n=t("../renderer/index"),f=t("../renderer/render-flow"),i=t("../CCGame"),p=null,p=t("../../renderer/scene/camera"),o=cc.mat4(),r=cc.mat4(),e=cc.v3(),m=cc.v3(),a=cc.v3(),c=[],l=null;function y(){var t,e;l&&(t=l.getNode(),e=cc.game.canvas,t.z=e.height/1.1566,t.x=e.width/2,t.y=e.height/2)}var t=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4}),g=cc.Enum({OPAQUE:1,TRANSPARENT:2}),t=cc.Class({name:"cc.Camera",extends:cc.Component,ctor:function(){var t;i.renderType!==i.RENDER_TYPE_CANVAS?((t=new p).setStages(["opaque"]),t.dirty=!0,this._inited=!1,this._camera=t):this._inited=!0},editor:!1,properties:{_cullingMask:4294967295,_clearFlags:t.DEPTH|t.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,_alignWithScreen:!0,zoomRatio:{get:function(){return this._zoomRatio},set:function(t){this._zoomRatio=t},tooltip:!1},fov:{get:function(){return this._fov},set:function(t){this._fov=t},tooltip:!1},orthoSize:{get:function(){return this._orthoSize},set:function(t){this._orthoSize=t},tooltip:!1},nearClip:{get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._updateClippingpPlanes()},tooltip:!1},farClip:{get:function(){return this._farClip},set:function(t){this._farClip=t,this._updateClippingpPlanes()},tooltip:!1},ortho:{get:function(){return this._ortho},set:function(t){this._ortho=t,this._updateProjection()},tooltip:!1},rect:{get:function(){return this._rect},set:function(t){this._rect=t,this._updateRect()},tooltip:!1},cullingMask:{get:function(){return this._cullingMask},set:function(t){this._cullingMask=t,this._updateCameraMask()},tooltip:!1},clearFlags:{get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&this._camera.setClearFlags(t)},tooltip:!1},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor.equals(t)||(this._backgroundColor.set(t),this._updateBackgroundColor())},tooltip:!1},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&this._camera.setPriority(t)},tooltip:!1},targetTexture:{get:function(){return this._targetTexture},set:function(t){this._targetTexture=t,this._updateTargetTexture()},tooltip:!1},renderStages:{get:function(){return this._renderStages},set:function(t){this._renderStages=t,this._updateStages()},tooltip:!1},alignWithScreen:{get:function(){return this._alignWithScreen},set:function(t){this._alignWithScreen=t}},_is3D:{get:function(){return this.node&&this.node._is3DNode}}},statics:{main:null,cameras:c,ClearFlags:t,findCamera:function(t){for(var e=0,i=c.length;e<i;e++){var n=c[e];if(n.containsNode(t))return n}return null},_findRendererCamera:function(t){for(var e=n.scene._cameras,i=0;i<e._count;i++)if(e._data[i]._cullingMask&t._cullingMask)return e._data[i];return null},_setupDebugCamera:function(){var t,e;l||i.renderType!==i.RENDER_TYPE_CANVAS&&(t=new p,(l=t).setStages(["opaque"]),t.setFov(60*Math.PI/180),t.setNear(.1),t.setFar(4096),t.dirty=!0,t.cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,t.setPriority(cc.macro.MAX_ZINDEX),t.setClearFlags(0),t.setColor(0,0,0,0),e=new cc.Node,t.setNode(e),y(),cc.view.on("design-resolution-changed",y),n.scene.addCamera(t))}},_updateCameraMask:function(){var t;this._camera&&(t=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG),this._camera.cullingMask=t)},_updateBackgroundColor:function(){var t;this._camera&&(t=this._backgroundColor,this._camera.setColor(t.r/255,t.g/255,t.b/255,t.a/255))},_updateTargetTexture:function(){var t;this._camera&&(t=this._targetTexture,this._camera.setFrameBuffer(t?t._framebuffer:null))},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip))},_updateProjection:function(){var t;this._camera&&(t=this._ortho?1:0,this._camera.setType(t))},_updateRect:function(){var t;this._camera&&(t=this._rect,this._camera.setRect(t.x,t.y,t.width,t.height))},_updateStages:function(){var t=this._renderStages,e=[];t&g.OPAQUE&&e.push("opaque"),t&g.TRANSPARENT&&e.push("transparent"),this._camera.setStages(e)},_init:function(){var t;this._inited||(this._inited=!0,(t=this._camera)&&(t.setNode(this.node),t.setClearFlags(this._clearFlags),t.setPriority(this._depth),this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages(),this._updateRect(),this.beforeDraw()))},onLoad:function(){this._init()},onEnable:function(){i.renderType!==i.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),n.scene.addCamera(this._camera)),c.push(this)},onDisable:function(){i.renderType!==i.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),n.scene.removeCamera(this._camera)),cc.js.array.remove(c,this)},getScreenToWorldMatrix2D:function(t){return this.getWorldToScreenMatrix2D(t),s.Mat4.invert(t,t),t},getWorldToScreenMatrix2D:function(t){this.node.getWorldRT(o);var e=this.zoomRatio,i=o.m,e=(i[0]*=e,i[1]*=e,i[4]*=e,i[5]*=e,i[12]),n=i[13],r=cc.visibleRect.center;return i[12]=r.x-(i[0]*e+i[4]*n),i[13]=r.y-(i[1]*e+i[5]*n),t!==o&&s.Mat4.copy(t,o),t},getScreenToWorldPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3,this._camera.screenToWorld(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2,this.getScreenToWorldMatrix2D(o),s.Vec2.transformMat4(e,t,o)),e},getWorldToScreenPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3,this._camera.worldToScreen(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2,this.getWorldToScreenMatrix2D(o),s.Vec2.transformMat4(e,t,o)),e},getRay:function(t){return cc.geomUtils?(s.Vec3.set(a,t.x,t.y,1),this._camera.screenToWorld(m,a,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(s.Vec3.set(a,t.x,t.y,-1),this._camera.screenToWorld(e,a,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(e),_.Ray.fromPoints(new _.Ray,e,m)):t},containsNode:function(t){return t._cullingMask&this.cullingMask},render:function(t){if(!(t=t||cc.director.getScene()))return null;this.node.getWorldMatrix(o),this.beforeDraw(),f.render(t),n._forward.renderCamera(this._camera,n.scene)},_onAlignWithScreen:function(){var t=cc.game.canvas.height/cc.view._scaleY,e=(this._targetTexture&&(t=cc.visibleRect.height),this._fov*cc.macro.RAD);this.node.z=t/(2*Math.tan(e/2)),e=2*Math.atan(Math.tan(e/2)/this.zoomRatio),this._camera.setFov(e),this._camera.setOrthoHeight(t/2/this.zoomRatio),this.node.setRotation(0,0,0,1)},beforeDraw:function(){var t;this._camera&&(this._alignWithScreen?this._onAlignWithScreen():(t=this._fov*cc.macro.RAD,t=2*Math.atan(Math.tan(t/2)/this.zoomRatio),this._camera.setFov(t),this._camera.setOrthoHeight(this._orthoSize/this.zoomRatio)),this._camera.dirty=!0)}});cc.js.mixin(t.prototype,{getNodeToCameraTransform:function(t){var e=d.identity();return t.getWorldMatrix(r),this.containsNode(t)&&(this.getWorldToCameraMatrix(o),s.Mat4.mul(r,r,o)),d.fromMat4(e,r),e},getCameraToWorldPoint:function(t,e){return this.getScreenToWorldPoint(t,e)},getWorldToCameraPoint:function(t,e){return this.getWorldToScreenPoint(t,e)},getCameraToWorldMatrix:function(t){return this.getScreenToWorldMatrix2D(t)},getWorldToCameraMatrix:function(t){return this.getWorldToScreenMatrix2D(t)}}),h.exports=cc.Camera=t},{"../../renderer/scene/camera":332,"../CCGame":29,"../geom-utils":123,"../renderer/index":220,"../renderer/render-flow":221,"../utils/affine-transform":254,"../value-types":279}],64:[function(t,e,i){"use strict";cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height},type:cc.Size}},resetInEditor:!1});var n=cc.Class({name:"cc.BoxCollider",extends:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=e.exports=n},{}],65:[function(t,e,i){"use strict";cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}}},resetInEditor:!1});var n=cc.Class({name:"cc.CircleCollider",extends:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=e.exports=n},{}],66:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Collider",extends:cc.Component,properties:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=e.exports=n},{}],67:[function(t,e,i){"use strict";var D=(n=t("../value-types/vec2"))&&n.__esModule?n:{default:n};var s=t("./CCContact"),h=s.CollisionType,o=t("../CCNode").EventType,L=new D.default;var n=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(t){if(this.enabled){for(var e=this._colliders,i=0,n=e.length;i<n;i++)this.updateCollider(e[i]);var r=this._contacts,s=[];for(i=0,n=r.length;i<n;i++){var o=r[i].updateState();o!==h.None&&s.push([o,r[i]])}for(i=0,n=s.length;i<n;i++){var a=s[i];this._doCollide(a[0],a[1])}this.drawColliders()}},_doCollide:function(t,e){var i;switch(t){case h.CollisionEnter:i="onCollisionEnter";break;case h.CollisionStay:i="onCollisionStay";break;case h.CollisionExit:i="onCollisionExit"}for(var n,r=e.collider1,s=e.collider2,o=r.node._components,a=s.node._components,c=0,l=o.length;c<l;c++)(n=o[c])[i]&&n[i](s,r);for(c=0,l=a.length;c<l;c++)(n=a[c])[i]&&n[i](r,s)},shouldCollide:function(t,e){var t=t.node,e=e.node,i=cc.game.collisionMatrix;return t!==e&&i[t.groupIndex][e.groupIndex]},initCollider:function(t){var e;t.world||((e=t.world={}).aabb=cc.rect(),e.preAabb=cc.rect(),e.matrix=cc.mat4(),e.radius=0,t instanceof cc.BoxCollider?(e.position=null,e.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(e.position=null,e.points=t.points.map(function(t){return cc.v2(t.x,t.y)})):t instanceof cc.CircleCollider&&(e.position=cc.v2(),e.points=null))},updateCollider:function(t){var e,h,i,u,_,d,f=t.offset,n=t.world,r=n.aabb,p=n.matrix,s=(t.node.getWorldMatrix(p),n.preAabb);if(s.x=r.x,s.y=r.y,s.width=r.width,s.height=r.height,t instanceof cc.BoxCollider){var s=t.size,s=(r.x=f.x-s.width/2,r.y=f.y-s.height/2,r.width=s.width,r.height=s.height,n.points),m=s[0],y=s[1],g=s[2],s=s[3],v=(e=p,C=m,a=y,A=g,h=s,i=(o=r).x,c=o.y,v=o.width,o=o.height,u=(e=e.m)[0],_=e[1],x=e[4],b=e[5],d=u*i+x*c+e[12],i=_*i+b*c+e[13],c=u*v,e=_*v,u=x*o,_=b*o,a.x=d,a.y=i,A.x=c+d,A.y=e+i,C.x=u+d,C.y=_+i,h.x=c+u+d,h.y=e+_+i,Math.min(m.x,y.x,g.x,s.x)),x=Math.min(m.y,y.y,g.y,s.y),b=Math.max(m.x,y.x,g.x,s.x),o=Math.max(m.y,y.y,g.y,s.y);r.x=v,r.y=x,r.width=b-v,r.height=o-x}else if(t instanceof cc.CircleCollider){D.default.transformMat4(L,t.offset,p),n.position.x=L.x,n.position.y=L.y;var a=p.m,A=a[12],C=a[13],c=(a[12]=a[13]=0,L.x=t.radius,L.y=0,D.default.transformMat4(L,L,p),Math.sqrt(L.x*L.x+L.y*L.y));n.radius=c,r.x=n.position.x-c,r.y=n.position.y-c,r.width=2*c,r.height=2*c,a[12]=A,a[13]=C}else if(t instanceof cc.PolygonCollider){for(var S=t.points,T=n.points,w=(T.length=S.length,1e6),E=1e6,M=-1e6,I=-1e6,l=0,B=S.length;l<B;l++){T[l]||(T[l]=cc.v2()),L.x=S[l].x+f.x,L.y=S[l].y+f.y,D.default.transformMat4(L,L,p);var R=L.x,P=L.y;M<(T[l].x=R)&&(M=R),R<w&&(w=R),I<(T[l].y=P)&&(I=P),P<E&&(E=P)}r.x=w,r.y=E,r.width=M-w,r.height=I-E}},addCollider:function(t){var e=this._colliders;if(-1===e.indexOf(t)){for(var i=0,n=e.length;i<n;i++){var r=e[i];this.shouldCollide(t,r)&&(r=new s(t,r),this._contacts.push(r))}e.push(t),this.initCollider(t)}t.node.on(o.GROUP_CHANGED,this.onNodeGroupChanged,this)},removeCollider:function(t){var e=this._colliders,i=e.indexOf(t);if(0<=i){e.splice(i,1);for(var n=this._contacts,r=n.length-1;0<=r;r--){var s=n[r];s.collider1!==t&&s.collider2!==t||(s.touching&&this._doCollide(h.CollisionExit,s),n.splice(r,1))}t.node.off(o.GROUP_CHANGED,this.onNodeGroupChanged,this)}else cc.errorID(6600)},onNodeGroupChanged:function(t){for(var e=t.getComponents(cc.Collider),i=0,n=e.length;i<n;i++){var r=e[i];cc.PhysicsCollider&&r instanceof cc.PhysicsCollider||(this.removeCollider(r),this.addCollider(r))}},drawColliders:function(){if(this._enabledDebugDraw){this._checkDebugDrawValid();for(var t=this._debugDrawer,e=(t.clear(),this._colliders),i=0,n=e.length;i<n;i++){var r=e[i];if(t.strokeColor=cc.Color.WHITE,r instanceof cc.BoxCollider||r instanceof cc.PolygonCollider){var s=r.world.points;if(0<s.length){t.moveTo(s[0].x,s[0].y);for(var o=1;o<s.length;o++)t.lineTo(s[o].x,s[o].y);t.close(),t.stroke()}}else r instanceof cc.CircleCollider&&(t.circle(r.world.position.x,r.world.position.y,r.world.radius),t.stroke());this.enabledDrawBoundingBox&&(r=r.world.aabb,t.strokeColor=cc.Color.BLUE,t.moveTo(r.xMin,r.yMin),t.lineTo(r.xMin,r.yMax),t.lineTo(r.xMax,r.yMax),t.lineTo(r.xMax,r.yMin),t.close(),t.stroke())}}},_checkDebugDrawValid:function(){var t;this._debugDrawer&&this._debugDrawer.isValid||((t=new cc.Node("COLLISION_MANAGER_DEBUG_DRAW")).zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics))}});cc.js.getset(n.prototype,"enabledDebugDraw",function(){return this._enabledDebugDraw},function(t){t&&!this._enabledDebugDraw?(this._checkDebugDrawValid(),this._debugDrawer.node.active=!0):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(!0),this._debugDrawer.node.active=!1),this._enabledDebugDraw=t}),cc.CollisionManager=e.exports=n},{"../CCNode":30,"../value-types/vec2":288,"./CCContact":68}],68:[function(t,e,i){"use strict";var o=t("./CCIntersection"),n=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});function r(t,e){this.collider1=t,this.collider2=e,this.touching=!1;var i=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,n=e instanceof cc.BoxCollider||e instanceof cc.PolygonCollider,r=t instanceof cc.CircleCollider,s=e instanceof cc.CircleCollider;i&&n?this.testFunc=o.polygonPolygon:r&&s?this.testFunc=o.circleCircle:i&&s?this.testFunc=o.polygonCircle:r&&n?(this.testFunc=o.polygonCircle,this.collider1=e,this.collider2=t):cc.errorID(6601,cc.js.getClassName(t),cc.js.getClassName(e))}r.prototype.test=function(){var t=this.collider1.world,e=this.collider2.world;return!!t.aabb.intersects(e.aabb)&&(this.testFunc===o.polygonPolygon?this.testFunc(t.points,e.points):this.testFunc===o.circleCircle?this.testFunc(t,e):this.testFunc===o.polygonCircle&&this.testFunc(t.points,e))},r.prototype.updateState=function(){var t=this.test(),e=n.None;return t&&!this.touching?(this.touching=!0,e=n.CollisionEnter):t&&this.touching?e=n.CollisionStay:!t&&this.touching&&(this.touching=!1,e=n.CollisionExit),e},r.CollisionType=n,e.exports=r},{"./CCIntersection":69}],69:[function(t,e,i){"use strict";var n={};function o(t,e,i,n){var r=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),n=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!=n){i=r/n,e=s/n;if(0<=i&&i<=1&&0<=e&&e<=1)return!0}return!1}function c(t,e,i){for(var n=i.length,r=0;r<n;++r)if(o(t,e,i[r],i[(r+1)%n]))return!0;return!1}function l(t,e){for(var i=!1,h=t.x,n=t.y,r=e.length,s=0,o=r-1;s<r;o=s++){var a=e[s].x,c=e[s].y,u=e[o].x,l=e[o].y;n<c!=n<l&&h<(u-a)*(n-c)/(l-c)+a&&(i=!i)}return i}function s(t,e,i,n){var r=(o=i.x-e.x)*o+(a=i.y-e.y)*a,s=((t.x-e.x)*o+(t.y-e.y)*a)/r,n=n?!r||s<0?e:1<s?i:cc.v2(e.x+s*o,e.y+s*a):cc.v2(e.x+s*o,e.y+s*a),o=t.x-n.x,a=t.y-n.y;return Math.sqrt(o*o+a*a)}n.lineLine=o,n.lineRect=function(t,e,i){var n=new cc.Vec2(i.x,i.y),r=new cc.Vec2(i.x,i.yMax),s=new cc.Vec2(i.xMax,i.yMax),i=new cc.Vec2(i.xMax,i.y);return!!o(t,e,n,r)||(!!o(t,e,r,s)||(!!o(t,e,s,i)||!!o(t,e,i,n)))},n.linePolygon=c,n.rectRect=function(t,e){var i=t.x,n=t.y,r=t.x+t.width,t=t.y+t.height,s=e.x,o=e.y,a=e.x+e.width,e=e.y+e.height;return i<=a&&s<=r&&n<=e&&o<=t},n.rectPolygon=function(t,e){var i,n,r=new cc.Vec2(t.x,t.y),s=new cc.Vec2(t.x,t.yMax),o=new cc.Vec2(t.xMax,t.yMax),a=new cc.Vec2(t.xMax,t.y);if(c(r,s,e))return!0;if(c(s,o,e))return!0;if(c(o,a,e))return!0;if(c(a,r,e))return!0;for(i=0,n=e.length;i<n;++i)if(l(e[i],t))return!0;return!!l(r,e)||(!!l(s,e)||(!!l(o,e)||!!l(a,e)))},n.polygonPolygon=function(t,e){for(var i=0,n=t.length;i<n;++i)if(c(t[i],t[(i+1)%n],e))return!0;for(i=0,n=e.length;i<n;++i)if(l(e[i],t))return!0;for(i=0,n=t.length;i<n;++i)if(l(t[i],e))return!0;return!1},n.circleCircle=function(t,e){return t.position.sub(e.position).mag()<t.radius+e.radius},n.polygonCircle=function(t,e){var i=e.position;if(l(i,t))return!0;for(var n=0,r=t.length;n<r;n++)if(s(i,0===n?t[t.length-1]:t[n-1],t[n],!0)<e.radius)return!0;return!1},n.pointInPolygon=l,n.pointLineDistance=s,cc.Intersection=e.exports=n},{}],70:[function(t,e,i){"use strict";cc.Collider.Polygon=cc.Class({properties:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var n=cc.Class({name:"cc.PolygonCollider",extends:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=e.exports=n},{}],71:[function(t,e,i){"use strict";t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider")},{"./CCBoxCollider":64,"./CCCircleCollider":65,"./CCCollider":66,"./CCCollisionManager":67,"./CCPolygonCollider":70}],72:[function(t,h,u){"use strict";t("./platform/CCClass");var e=t("./platform/CCObject").Flags,i=t("./platform/js").array,n=e.IsStartCalled,r=e.IsOnEnableCalled;e.IsEditorOnEnableCalled;function s(t,e){for(var i=e.constructor._executionOrder,n=e._id,r=0,s=t.length-1,o=s>>>1;r<=s;o=r+s>>>1){var a=t[o],c=a.constructor._executionOrder;if(i<c)s=o-1;else if(c<i)r=o+1;else{c=a._id;if(n<c)s=o-1;else{if(!(c<n))return o;r=o+1}}}return~r}function o(t,e){for(var i=t.array,n=t.i+1;n<i.length;){var r=i[n];r._enabled&&r.node._activeInHierarchy?++n:(t.removeAt(n),e&&(r._objFlags&=~e))}}t=cc.Class({__ctor__:function(t){var e=i.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t},statics:{stableRemoveInactive:o},add:null,remove:null,invoke:null});function a(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}var c=cc.Class({extends:t,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){o(this._zero,t),o(this._neg,t),o(this._pos,t)},invoke:function(){var t=this._neg,t=(0<t.array.length&&(t.array.sort(a),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0,this._pos);0<t.array.length&&(t.array.sort(a),this._invoke(t),t.array.length=0)}}),_=cc.Class({extends:t,add:function(t){var e,i=t.constructor._executionOrder;0===i?this._zero.array.push(t):(e=s(i=(i<0?this._neg:this._pos).array,t))<0&&i.splice(~e,0,t)},remove:function(t){var e=t.constructor._executionOrder;0===e?this._zero.fastRemove(t):0<=(t=s((e=e<0?this._neg:this._pos).array,t))&&e.removeAt(t)},invoke:function(t){0<this._neg.array.length&&this._invoke(this._neg,t),this._invoke(this._zero,t),0<this._pos.array.length&&this._invoke(this._pos,t)}});function l(r,t,s,o){return function(e,i){try{o(e,i)}catch(t){cc._throw(t);var n=e.array;for(s&&(n[e.i]._objFlags|=s),++e.i;e.i<n.length;++e.i)try{r(n[e.i],i)}catch(t){cc._throw(t),s&&(n[e.i]._objFlags|=s)}}}}var d=l(function(t){t.start(),t._objFlags|=n},0,n,function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];i.start(),i._objFlags|=n}}),f=l(function(t,e){t.update(e)},0,void 0,function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].update(e)}),p=l(function(t,e){t.lateUpdate(e)},0,void 0,function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].lateUpdate(e)});function m(){this.startInvoker=new c(d),this.updateInvoker=new _(f),this.lateUpdateInvoker=new _(p),this.scheduleInNextFrame=[],this._updating=!1}e=cc.Class({ctor:m,unscheduleAll:m,statics:{LifeCycleInvoker:t,OneOffInvoker:c,createInvokeImpl:l,invokeOnEnable:function(t){var e=cc.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var n=i[t.i];n._enabled&&(n.onEnable(),n.node._activeInHierarchy&&e._onEnabled(n))}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=r,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~r;var e=this.scheduleInNextFrame.indexOf(t);0<=e?i.fastRemoveAt(this.scheduleInNextFrame,e):(!t.start||t._objFlags&n||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,e){if(!(t._objFlags&r)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&r&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){!t.start||t._objFlags&n||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this.scheduleInNextFrame,e=0,i=t.length;e<i;e++){var n=t[e];this._scheduleImmediate(n)}t.length=0},_earlyStartForNewComps:function(){0<this.scheduleInNextFrame.length&&(this._deferredSchedule(),this.startInvoker.invoke())},startPhase:function(){this._updating=!0,0<this.scheduleInNextFrame.length&&this._deferredSchedule(),this.startInvoker.invoke(),this._earlyStartForNewComps()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1},clearup:function(){this._earlyStartForNewComps()}});h.exports=e},{"./platform/CCClass":189,"./platform/CCObject":195,"./platform/js":209,"./utils/misc":264}],73:[function(t,e,i){"use strict";var n=t("../../animation/animation-animator"),r=t("../../animation/animation-clip"),s=t("../event/event-target"),o=t("../platform/js"),a=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"}),t=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[s],editor:!1,statics:{EventType:a},ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState=o.createMap(!0),this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:r},defaultClip:{type:r,get:function(){return this._defaultClip},set:function(t){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:r,visible:!1},_writableClips:{get:function(){return this._clips},set:function(t){this._didInit=!1,this._clips=t,this._init()},type:[r]},_clips:{default:[],type:[r],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){var t;this.playOnLoad&&this._defaultClip&&(this._animator&&this._animator.isPlaying||(t=this.getAnimationState(this._defaultClip.name),this._animator.playState(t)))},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){t=this.playAdditive(t,e);return this._animator.stopStatesExcept(t),t},playAdditive:function(t,e){this._init();var i,t=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);return t&&(this.enabled=!0,(i=this._animator).isPlaying&&t.isPlaying?t.isPaused?i.resumeState(t):(i.stopState(t),i.playState(t,e)):i.playState(t,e),this.enabledInHierarchy||i.pause(),this.currentClip=t.clip),t},stop:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.stopState(t):this._animator.stop())},pause:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.pauseState(t):this.enabled=!1)},resume:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.resumeState(t):this.enabled=!0)},setCurrentTime:function(t,e){this._init(),e?(e=this._nameToState[e])&&this._animator.setStateTime(e,t):this._animator.setStateTime(t)},getAnimationState:function(t){this._init();t=this._nameToState[t];return t&&!t.curveLoaded&&this._animator._reloadClip(t),t||null},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;i=this._clips.indexOf(i.clip);-1!==i&&this._clips.splice(i,1)}i=new cc.AnimationState(t,e);return this._nameToState[e]=i}cc.warnID(3900)},removeClip:function(e,t){if(e){var i,n;for(n in this._init(),this._nameToState)if((i=this._nameToState[n]).clip===e)break;if(e===this._defaultClip){if(!t)return void cc.warnID(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!t)return void cc.warnID(3903);this.stop(i.name)}this._clips=this._clips.filter(function(t){return!(t===e)}),i&&delete this._nameToState[i.name]}else cc.warnID(3901)},sample:function(t){this._init(),t?(t=this._nameToState[t])&&t.sample():this._animator.sample()},on:function(t,e,i,n){this._init();e=this._EventTargetOn(t,e,i,n);if("lastframe"===t){var r,s=this._nameToState;for(r in s)s[r]._lastframeEventOn=!0}return e},off:function(t,e,i,n){if(this._init(),"lastframe"===t){var r,s=this._nameToState;for(r in s)s[r]._lastframeEventOn=!1}this._EventTargetOff(t,e,i,n)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new n(this.node,this),this._createStates())},_createStates:function(){this._nameToState=o.createMap(!0);for(var t=null,e=!1,i=0;i<this._clips.length;++i){var n=this._clips[i];n&&(t=new cc.AnimationState(n),this._nameToState[t.name]=t,this._defaultClip===n&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});t.prototype._EventTargetOn=s.prototype.on,t.prototype._EventTargetOff=s.prototype.off,cc.Animation=e.exports=t},{"../../animation/animation-animator":10,"../../animation/animation-clip":11,"../event/event-target":115,"../platform/js":209,"./CCComponent":78}],74:[function(t,e,i){"use strict";var n=t("../utils/misc"),r=t("./CCComponent"),s=t("../assets/CCAudioClip"),t=cc.Class({name:"cc.AudioSource",extends:r,editor:!1,ctor:function(){this.audio=new cc.Audio},properties:{_clip:{default:null,type:s},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return this.audio.getState()===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){var i;if("string"==typeof t)return cc.warnID(8401,"cc.AudioSource","cc.AudioClip","AudioClip","cc.AudioClip","audio"),i=this,void s._loadByUrl(t,function(t,e){e&&(i.clip=e)});t!==this._clip&&(this._clip=t,this.audio.stop(),this.preload&&(this.audio.src=this._clip))},type:s,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(t){return t=n.clamp01(t),this._volume=t,this._mute||this.audio.setVolume(t),t},tooltip:!1},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio.setLoop(t),t},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_ensureDataLoaded:function(){this.audio.src!==this._clip&&(this.audio.src=this._clip)},_pausedCallback:function(){this.audio.getState()===cc.Audio.State.PLAYING&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1},onLoad:function(){this.audio.setVolume(this._mute?0:this._volume),this.audio.setLoop(this._loop)},onEnable:function(){this.preload&&(this.audio.src=this._clip),this.playOnLoad&&this.play(),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip)},play:function(){var t;this._clip&&(t=this.audio,this._clip.loaded&&t.stop(),this._ensureDataLoaded(),t.setCurrentTime(0),t.play())},stop:function(){this.audio.stop()},pause:function(){this.audio.pause()},resume:function(){this._ensureDataLoaded(),this.audio.resume()},rewind:function(){this.audio.setCurrentTime(0)},getCurrentTime:function(){return this.audio.getCurrentTime()},setCurrentTime:function(t){return this.audio.setCurrentTime(t),t},getDuration:function(){return this.audio.getDuration()}});cc.AudioSource=e.exports=t},{"../assets/CCAudioClip":35,"../utils/misc":264,"./CCComponent":78}],75:[function(t,e,i){"use strict";var n=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function r(t){t.stopPropagation()}t=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var t=0;t<n.length;t++)this.node.on(n[t],r,this)},onDisable:function(){for(var t=0;t<n.length;t++)this.node.off(n[t],r,this)}});cc.BlockInputEvents=e.exports=t},{"./CCComponent":78}],76:[function(t,e,i){"use strict";var n=t("./CCComponent"),t=t("../utils/gray-sprite-state"),r=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),s=cc.Enum({NORMAL:0,HOVER:1,PRESSED:2,DISABLED:3}),n=cc.Class({name:"cc.Button",extends:n,mixins:[t],ctor:function(){this._pressed=!1,this._hovered=!1,this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=cc.Vec2.ZERO,this._toScale=cc.Vec2.ZERO,this._originalScale=null,this._graySpriteMaterial=null,this._spriteMaterial=null,this._sprite=null},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:r.NONE,tooltip:!1,type:r,animatable:!1,notify:function(t){this._updateTransition(t)},formerlySerializedAs:"transition"},normalColor:{default:cc.Color.WHITE,displayName:"Normal",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.NORMAL&&(this._getTarget().opacity=this.normalColor.a),this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.PRESSED&&(this._getTarget().opacity=this.pressedColor.a),this._updateState()},formerlySerializedAs:"pressedColor"},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.HOVER&&(this._getTarget().opacity=this.hoverColor.a),this._updateState()},formerlySerializedAs:"hoverColor"},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this.transition===r.Color&&this._getButtonState()===s.DISABLED&&(this._getTarget().opacity=this.disabledColor.a),this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(t){this._applyTarget(),t&&this.target!==t&&this._unregisterTargetEvent(t)}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:r},__preload:function(){this._applyTarget(),this._resetState()},_resetState:function(){this._pressed=!1,this._hovered=!1;var t=this._getTarget(),e=this.transition,i=this._originalScale;e===r.COLOR&&this.interactable?this._setTargetColor(this.normalColor):e===r.SCALE&&i&&t.setScale(i.x,i.y),this._transitionFinished=!0},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerNodeEvent()},onDisable:function(){this._resetState(),this._unregisterNodeEvent()},_getTarget:function(){return this.target||this.node},_onTargetSpriteFrameChanged:function(t){this.transition===r.SPRITE&&this._setCurrentStateSprite(t.spriteFrame)},_onTargetColorChanged:function(t){this.transition===r.COLOR&&this._setCurrentStateColor(t)},_onTargetScaleChanged:function(){var t=this._getTarget();this._originalScale&&(this.transition!==r.SCALE||this._transitionFinished)&&(this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY)},_setTargetColor:function(t){var e=this._getTarget();e.color=t,e.opacity=t.a},_getStateColor:function(t){switch(t){case s.NORMAL:return this.normalColor;case s.HOVER:return this.hoverColor;case s.PRESSED:return this.pressedColor;case s.DISABLED:return this.disabledColor}},_getStateSprite:function(t){switch(t){case s.NORMAL:return this.normalSprite;case s.HOVER:return this.hoverSprite;case s.PRESSED:return this.pressedSprite;case s.DISABLED:return this.disabledSprite}},_setCurrentStateColor:function(t){switch(this._getButtonState()){case s.NORMAL:this.normalColor=t;break;case s.HOVER:this.hoverColor=t;break;case s.PRESSED:this.pressedColor=t;break;case s.DISABLED:this.disabledColor=t}},_setCurrentStateSprite:function(t){switch(this._getButtonState()){case s.NORMAL:this.normalSprite=t;break;case s.HOVER:this.hoverSprite=t;break;case s.PRESSED:this.pressedSprite=t;break;case s.DISABLED:this.disabledSprite=t}},update:function(t){var e,i=this._getTarget();this._transitionFinished||this.transition!==r.COLOR&&this.transition!==r.SCALE||(this.time+=t,(t=1)<=(t=0<this.duration?this.time/this.duration:t)&&(t=1),this.transition===r.COLOR?(e=this._fromColor.lerp(this._toColor,t),this._setTargetColor(e)):this.transition===r.SCALE&&this._originalScale&&(i.scale=this._fromScale.lerp(this._toScale,t)),1===t&&(this._transitionFinished=!0))},_registerNodeEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_unregisterNodeEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_registerTargetEvent:function(t){t.on(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_unregisterTargetEvent:function(t){t.off(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_getTargetSprite:function(t){var e=null;return e=t?t.getComponent(cc.Sprite):e},_applyTarget:function(){var t=this._getTarget();this._sprite=this._getTargetSprite(t),this._originalScale||(this._originalScale=cc.Vec2.ZERO),this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY,this._registerTargetEvent(t)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){var e,i,n;this.interactable&&this.enabledInHierarchy&&this._pressed&&(e=t.touch,e=this.node._hitTest(e.getLocation()),n=this._getTarget(),i=this._originalScale,this.transition===r.SCALE&&i?e?(this._fromScale.x=i.x,this._fromScale.y=i.y,this._toScale.x=i.x*this.zoomScale,this._toScale.y=i.y*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,n.setScale(i.x,i.y)):(n=e?s.PRESSED:s.NORMAL,this._applyTransition(n)),t.stopPropagation())},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition===r.SPRITE&&!this.hoverSprite||this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},_getButtonState:function(){return this.interactable?this._pressed?s.PRESSED:this._hovered?s.HOVER:s.NORMAL:s.DISABLED},_updateColorTransitionImmediately:function(t){t=this._getStateColor(t);this._setTargetColor(t),this._fromColor=t.clone(),this._toColor=t},_updateColorTransition:function(t){var e;t===s.DISABLED?this._updateColorTransitionImmediately(t):(e=this._getTarget(),t=this._getStateColor(t),this._fromColor=e.color.clone(),this._toColor=t,this.time=0,this._transitionFinished=!1)},_updateSpriteTransition:function(t){t=this._getStateSprite(t);this._sprite&&t&&(this._sprite.spriteFrame=t)},_updateScaleTransition:function(t){t===s.PRESSED?this._zoomUp():this._zoomBack()},_zoomUp:function(){this._originalScale&&(this._fromScale.x=this._originalScale.x,this._fromScale.y=this._originalScale.y,this._toScale.x=this._originalScale.x*this.zoomScale,this._toScale.y=this._originalScale.y*this.zoomScale,this.time=0,this._transitionFinished=!1)},_zoomBack:function(){var t;this._originalScale&&(t=this._getTarget(),this._fromScale.x=t.scaleX,this._fromScale.y=t.scaleY,this._toScale.x=this._originalScale.x,this._toScale.y=this._originalScale.y,this.time=0,this._transitionFinished=!1)},_updateTransition:function(t){t===r.COLOR?this._updateColorTransitionImmediately(s.NORMAL):t===r.SPRITE&&this._updateSpriteTransition(s.NORMAL),this._updateState()},_applyTransition:function(t){var e=this.transition;e===r.COLOR?this._updateColorTransition(t):e===r.SPRITE?this._updateSpriteTransition(t):e===r.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){var t;this._sprite&&(t=!1,this.enableAutoGrayEffect&&(this.transition===r.SPRITE&&this.disabledSprite||this.interactable||(t=!0)),this._switchGrayMaterial(t,this._sprite))}});cc.Button=e.exports=n},{"../utils/gray-sprite-state":260,"./CCComponent":78}],77:[function(t,e,i){"use strict";var n=t("../camera/CCCamera"),t=t("./CCComponent");var r=cc.Class({name:"cc.Canvas",extends:t,editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},_fitDesignResolution:!1,__preload:function(){if(r.instance)return cc.warnID(6700,this.node.name,r.instance.node.name);(r.instance=this).applySettings();var t=this.getComponent(cc.Widget),t=(t&&t.updateAlignment(),cc.find("Main Camera",this.node)),e=(t||((t=new cc.Node("Main Camera")).parent=this.node,t.setSiblingIndex(0)),t.getComponent(n));e||(e=t.addComponent(n),t=n.ClearFlags,e.clearFlags=t.COLOR|t.DEPTH|t.STENCIL,e.depth=-1),n.main=e},onDestroy:function(){r.instance===this&&(r.instance=null)},applySettings:function(){var t=cc.ResolutionPolicy,t=this.fitHeight&&this.fitWidth?t.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?t.FIXED_WIDTH:t.FIXED_HEIGHT:t.NO_BORDER,e=this._designResolution;cc.view.setDesignResolutionSize(e.width,e.height,t)}});cc.Canvas=e.exports=r},{"../camera/CCCamera":63,"./CCComponent":78}],78:[function(t,e,i){"use strict";var n=t("../platform/CCObject"),r=t("../platform/js"),s=new(t("../platform/id-generater"))("Comp"),o=(n.Flags.IsOnEnableCalled,n.Flags.IsOnLoadCalled),a=!!cc.ActionManager,t=cc.Class({name:"cc.Component",extends:n,ctor:function(){this._id=s.getNewId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return 0<=e&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},uuid:{get:function(){return this._id},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){var e;this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy&&(e=cc.director._compScheduler,t?e.enableComp(this):e.disableComp(this)))},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&o}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){a&&cc.director.getActionManager().removeAllActionsFromTarget(this),this.unscheduleAllCallbacks();for(var t=this.__eventTargets,e=t.length-1;0<=e;--e){var i=t[e];i&&i.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return(t=t||cc.instantiate._clone(this,this)).node=null,t},schedule:function(t,e,i,n){cc.assertID(t,1619),e=e||0,cc.assertID(0<=e,1620),i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0;var r=cc.director.getScheduler(),s=r.isTargetPaused(this);r.schedule(t,this,e,i,n,s)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});t._requireComponent=null,t._executionOrder=0,r.value(t,"_registerEditorProps",function(t,e){var i=e.requireComponent,i=(i&&(t._requireComponent=i),e.executionOrder);i&&"number"==typeof i&&(t._executionOrder=i)}),t.prototype.__scriptUuid="",cc.Component=e.exports=t},{"../platform/CCObject":195,"../platform/id-generater":205,"../platform/js":209}],79:[function(t,e,i){"use strict";cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){if(0<arguments.length)for(var e,i=0,n=(e=new Array(arguments.length-1)).length;i<n;i++)e[i]=arguments[i+1];for(var r=0,s=t.length;r<s;r++){var o=t[r];o instanceof cc.Component.EventHandler&&o.emit(e)}}},emit:function(t){var e,i=this.target;cc.isValid(i)&&(this._genCompIdIfNeeded(),e=cc.js._getClassById(this._componentId),i=i.getComponent(e),!cc.isValid(i)||"function"==typeof(e=i[this.handler])&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),e.apply(i,t)))},_compName2Id:function(t){t=cc.js.getClassByName(t);return cc.js._getClassId(t)},_compId2Name:function(t){t=cc.js._getClassById(t);return cc.js.getClassName(t)},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="")}})},{}],80:[function(t,e,i){"use strict";var n=t("../platform/CCMacro"),r=t("./CCRenderComponent"),s=(t("../assets/material/CCMaterial"),t("../renderer/utils/label/label-frame")),t=n.TextAlignment,n=n.VerticalTextAlignment,o=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),a=cc.Enum({NONE:0,BITMAP:1,CHAR:2}),c=cc.Class({name:"cc.Label",extends:r,ctor:function(){this._actualFontSize=0,this._assemblerData=null,this._frame=null,this._ttfTexture=null,this._letterTexture=null,cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?this._updateMaterial=this._updateMaterialCanvas:this._updateMaterial=this._updateMaterialWebgl},editor:!1,properties:{_useOriginalSize:!0,_string:{default:"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string},set:function(t){var e=this._string;this._string=""+t,this.string!==e&&this.setVertsDirty(),this._checkStringEmpty()},multiline:!0,tooltip:!1},horizontalAlign:{default:t.LEFT,type:t,tooltip:!1,notify:function(t){this.horizontalAlign!==t&&this.setVertsDirty()},animatable:!1},verticalAlign:{default:n.TOP,type:n,tooltip:!1,notify:function(t){this.verticalAlign!==t&&this.setVertsDirty()},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize},tooltip:!1},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.setVertsDirty())},range:[0,512],tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(t){this.fontFamily!==t&&this.setVertsDirty()},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.setVertsDirty())},tooltip:!1},overflow:{default:o.NONE,type:o,tooltip:!1,notify:function(t){this.overflow!==t&&this.setVertsDirty()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.setVertsDirty())},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){this.font!==t&&(t||(this._isSystemFontUsed=!0),(this._N$file=t)&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),"string"==typeof t&&cc.warnID(4e3),this.enabledInHierarchy&&this._forceUpdateRenderData())},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){if(this._isSystemFontUsed!==t){if(this._isSystemFontUsed=!!t,t){if(this.font=null,!this.enabledInHierarchy)return;this._forceUpdateRenderData()}this.markForValidate()}},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this.setVertsDirty()},tooltip:!1},_batchAsBitmap:!1,cacheMode:{default:a.NONE,type:a,tooltip:!1,notify:function(t){this.cacheMode!==t&&(t!==a.BITMAP||this.font instanceof cc.BitmapFont||this._frame&&this._frame._resetDynamicAtlasFrame(),t===a.CHAR&&(this._ttfTexture=null),this.enabledInHierarchy&&this._forceUpdateRenderData())},animatable:!1},_styleFlags:0,enableBold:{get:function(){return!!(1&this._styleFlags)},set:function(t){t?this._styleFlags|=1:this._styleFlags&=-2,this.setVertsDirty()},animatable:!1,tooltip:!1},enableItalic:{get:function(){return!!(2&this._styleFlags)},set:function(t){t?this._styleFlags|=2:this._styleFlags&=-3,this.setVertsDirty()},animatable:!1,tooltip:!1},enableUnderline:{get:function(){return!!(4&this._styleFlags)},set:function(t){t?this._styleFlags|=4:this._styleFlags&=-5,this.setVertsDirty()},animatable:!1,tooltip:!1},_underlineHeight:0,underlineHeight:{get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.setVertsDirty())},tooltip:!1}},statics:{HorizontalAlign:t,VerticalAlign:n,Overflow:o,CacheMode:a,_shareAtlas:null,clearCharCache:function(){c._shareAtlas&&c._shareAtlas.clearAllCache()}},onLoad:function(){this._batchAsBitmap&&this.cacheMode===a.NONE&&(this.cacheMode=a.BITMAP,this._batchAsBitmap=!1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(this.cacheMode=a.NONE)},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this._forceUpdateRenderData()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDestroy:function(){this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData),this._assemblerData=null,this._letterTexture=null,this._ttfTexture&&(this._ttfTexture.destroy(),this._ttfTexture=null),this._super()},_nodeSizeChanged:function(){this.overflow!==o.NONE&&this.setVertsDirty()},_updateColor:function(){this.font instanceof cc.BitmapFont||this.setVertsDirty(),r.prototype._updateColor.call(this)},_validateRender:function(){if(this.string){if(this._materials[0]){var t=this.font;if(!(t instanceof cc.BitmapFont))return;var e=t.spriteFrame;if(e&&e.textureLoaded()&&t._fntConfig)return}this.disableRender()}else this.disableRender()},_resetAssembler:function(){this._frame=null,r.prototype._resetAssembler.call(this)},_checkStringEmpty:function(){this.markForRender(!!this.string)},_on3DNodeChanged:function(){this._resetAssembler(),this._applyFontTexture()},_onBMFontTextureLoaded:function(){this._frame._texture=this.font.spriteFrame._texture,this.markForRender(!0),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)},_applyFontTexture:function(){var t=this.font;t instanceof cc.BitmapFont?(t=t.spriteFrame,(this._frame=t)&&t.onTextureLoaded(this._onBMFontTextureLoaded,this)):(this._frame||(this._frame=new s),this.cacheMode===a.CHAR?(this._letterTexture=this._assembler._getAssemblerData(),this._frame._refreshTexture(this._letterTexture)):this._ttfTexture||(this._ttfTexture=new cc.Texture2D,this._assemblerData=this._assembler._getAssemblerData(),this._ttfTexture.initWithElement(this._assemblerData.canvas)),this.cacheMode!==a.CHAR&&(this._frame._resetDynamicAtlasFrame(),this._frame._refreshTexture(this._ttfTexture)),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)),this.markForValidate()},_updateMaterialCanvas:function(){this._frame&&(this._frame._texture.url=this.uuid+"_texture")},_updateMaterialWebgl:function(){var t;!this._frame||(t=this.getMaterial(0))&&t.setProperty("texture",this._frame._texture)},_forceUpdateRenderData:function(){this.setVertsDirty(),this._resetAssembler(),this._applyFontTexture()},_enableBold:function(t){cc.warn("`label._enableBold` is deprecated, use `label.enableBold = true` instead please"),this.enableBold=!!t},_enableItalics:function(t){cc.warn("`label._enableItalics` is deprecated, use `label.enableItalics = true` instead please"),this.enableItalic=!!t},_enableUnderline:function(t){cc.warn("`label._enableUnderline` is deprecated, use `label.enableUnderline = true` instead please"),this.enableUnderline=!!t}});cc.Label=e.exports=c},{"../assets/material/CCMaterial":53,"../platform/CCMacro":194,"../renderer/utils/label/label-frame":225,"./CCRenderComponent":89}],81:[function(t,e,i){"use strict";t=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_width:1,color:{tooltip:!1,get:function(){return this._color},set:function(t){this._color=t,this._updateRenderData()}},width:{tooltip:!1,get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())},range:[0,512]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.setVertsDirty()}});cc.LabelOutline=e.exports=t},{"./CCComponent":78}],82:[function(t,e,i){"use strict";t=cc.Class({name:"cc.LabelShadow",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{tooltip:!1,get:function(){return this._color},set:function(t){this._color=t,this._updateRenderData()}},offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},blur:{tooltip:!1,get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()},range:[0,1024]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.markForRender(!0)}});cc.LabelShadow=e.exports=t},{"./CCComponent":78}],83:[function(t,e,i){"use strict";var n=t("../CCNode").EventType,E=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),M=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),r=cc.Enum({HORIZONTAL:0,VERTICAL:1}),I=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),B=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),t=cc.Class({name:"cc.Layout",extends:t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:M.NONE,_N$layoutType:E.NONE,type:{type:E,get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:M,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(t){this.type===E.NONE&&t===M.CHILDREN||(this._resize=t,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:r.HORIZONTAL,tooltip:!1,type:r,notify:function(){this._doLayoutDirty()},animatable:!1},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:I.TOP_TO_BOTTOM,type:I,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:B.LEFT_TO_RIGHT,type:B,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},affectedByScale:{default:!1,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:!1}},statics:{Type:E,VerticalDirection:I,HorizontalDirection:B,ResizeMode:M,AxisDirection:r},onEnable:function(){this._addEventListeners(),this.node.getContentSize().equals(cc.size(0,0))&&this.node.setContentSize(this._layoutSize),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_doScaleDirty:function(){this._layoutDirty=this._layoutDirty||this.affectedByScale},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(n.SIZE_CHANGED,this._resized,this),this.node.on(n.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(n.CHILD_ADDED,this._childAdded,this),this.node.on(n.CHILD_REMOVED,this._childRemoved,this),this.node.on(n.CHILD_REORDER,this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(n.SIZE_CHANGED,this._resized,this),this.node.off(n.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(n.CHILD_ADDED,this._childAdded,this),this.node.off(n.CHILD_REMOVED,this._childRemoved,this),this.node.off(n.CHILD_REORDER,this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(n.SCALE_CHANGED,this._doScaleDirty,this),i.on(n.SIZE_CHANGED,this._doLayoutDirty,this),i.on(n.POSITION_CHANGED,this._doLayoutDirty,this),i.on(n.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_removeChildrenEventListeners:function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(n.SCALE_CHANGED,this._doScaleDirty,this),i.off(n.SIZE_CHANGED,this._doLayoutDirty,this),i.off(n.POSITION_CHANGED,this._doLayoutDirty,this),i.off(n.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_childAdded:function(t){t.on(n.SCALE_CHANGED,this._doScaleDirty,this),t.on(n.SIZE_CHANGED,this._doLayoutDirty,this),t.on(n.POSITION_CHANGED,this._doLayoutDirty,this),t.on(n.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(t){t.off(n.SCALE_CHANGED,this._doScaleDirty,this),t.off(n.SIZE_CHANGED,this._doLayoutDirty,this),t.off(n.POSITION_CHANGED,this._doLayoutDirty,this),t.off(n.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(h,u,_,d){for(var f=this.node.getAnchorPoint(),p=this.node.children,t=1,m=this.paddingLeft,y=-f.x*h,g=(this.horizontalDirection===B.RIGHT_TO_LEFT&&(t=-1,y=(1-f.x)*h,m=this.paddingRight),y+t*m-t*this.spacingX),v=0,e=0,i=0,x=0,n=0,b=0,A=0,r=0;r<p.length;++r)(a=p[r]).activeInHierarchy&&A++;var C=this.cellSize.width;this.type!==E.GRID&&this.resizeMode===M.CHILDREN&&(C=(h-(this.paddingLeft+this.paddingRight)-(A-1)*this.spacingX)/A);for(r=0;r<p.length;++r){var S,T,s,w,o,a=p[r],c=this._getUsedScaleValue(a.scaleX),l=this._getUsedScaleValue(a.scaleY);a.activeInHierarchy&&(this._resize===M.CHILDREN&&(a.width=C/c,this.type===E.GRID&&(a.height=this.cellSize.height/l)),o=a.anchorX,c=a.width*c,(e=e<i?i:e)<=(l=a.height*l)&&(i=e,e=l,b=a.getAnchorPoint().y),g=g+t*(o=this.horizontalDirection===B.RIGHT_TO_LEFT?1-a.anchorX:o)*c+t*this.spacingX,S=t*(1-o)*c,u&&(s=g+S+t*(0<t?this.paddingRight:this.paddingLeft),T=this.horizontalDirection===B.LEFT_TO_RIGHT&&s>(1-f.x)*h,s=this.horizontalDirection===B.RIGHT_TO_LEFT&&s<-f.x*h,(T||s)&&(e<=l?(v+=i=0===i?e:i,i=e):(v+=e,i=l,e=0),g=y+t*(m+o*c),x++)),T=_(a,v,x),h>=c+this.paddingLeft+this.paddingRight&&d&&a.setPosition(cc.v2(g,T)),s=1,o=0===e?l:e,this.verticalDirection===I.TOP_TO_BOTTOM?(n=n||this.node._contentSize.height,(w=T+(s=-1)*(o*b+this.paddingBottom))<n&&(n=w)):(n=n||-this.node._contentSize.height)<(w=T+s*(o*b+this.paddingTop))&&(n=w),g+=S)}return n},_getVerticalBaseHeight:function(t){var e=0,i=0;if(this.resizeMode===M.CONTAINER){for(var n=0;n<t.length;++n){var r=t[n];r.activeInHierarchy&&(i++,e+=r.height*this._getUsedScaleValue(r.scaleY))}e+=(i-1)*this.spacingY+this.paddingBottom+this.paddingTop}else e=this.node.getContentSize().height;return e},_doLayoutVertically:function(h,u,_,d){for(var f=this.node.getAnchorPoint(),p=this.node.children,t=1,m=this.paddingBottom,y=-f.y*h,g=(this.verticalDirection===I.TOP_TO_BOTTOM&&(t=-1,y=(1-f.y)*h,m=this.paddingTop),y+t*m-t*this.spacingY),v=0,e=0,i=0,x=0,n=0,b=0,A=0,r=0;r<p.length;++r)(a=p[r]).activeInHierarchy&&A++;var C=this.cellSize.height;this.type!==E.GRID&&this.resizeMode===M.CHILDREN&&(C=(h-(this.paddingTop+this.paddingBottom)-(A-1)*this.spacingY)/A);for(r=0;r<p.length;++r){var S,T,s,w,o,a=p[r],c=this._getUsedScaleValue(a.scaleX),l=this._getUsedScaleValue(a.scaleY);a.activeInHierarchy&&(this.resizeMode===M.CHILDREN&&(a.height=C/l,this.type===E.GRID&&(a.width=this.cellSize.width/c)),o=a.anchorY,c=a.width*c,l=a.height*l,(e=e<i?i:e)<=c&&(i=e,e=c,b=a.getAnchorPoint().x),g=g+t*(o=this.verticalDirection===I.TOP_TO_BOTTOM?1-a.anchorY:o)*l+t*this.spacingY,S=t*(1-o)*l,u&&(s=g+S+t*(0<t?this.paddingTop:this.paddingBottom),T=this.verticalDirection===I.BOTTOM_TO_TOP&&s>(1-f.y)*h,s=this.verticalDirection===I.TOP_TO_BOTTOM&&s<-f.y*h,(T||s)&&(e<=c?(v+=i=0===i?e:i,i=e):(v+=e,i=c,e=0),g=y+t*(m+o*l),x++)),T=_(a,v,x),h>=l+(this.paddingTop+this.paddingBottom)&&d&&a.setPosition(cc.v2(T,g)),s=1,o=0===e?c:e,this.horizontalDirection===B.RIGHT_TO_LEFT?(n=n||this.node._contentSize.width,(w=T+(s=-1)*(o*b+this.paddingLeft))<n&&(n=w)):(n=n||-this.node._contentSize.width)<(w=T+s*(o*b+this.paddingRight))&&(n=w),g+=S)}return n},_doLayoutBasic:function(){for(var t,e,i,n=this.node.children,r=null,s=0;s<n.length;++s){var o=n[s];o.activeInHierarchy&&(r?r.union(r,o.getBoundingBoxToWorld()):r=o.getBoundingBoxToWorld())}r&&(t=this.node.convertToNodeSpaceAR(cc.v2(r.x,r.y)),t=cc.v2(t.x-this.paddingLeft,t.y-this.paddingBottom),i=this.node.convertToNodeSpaceAR(cc.v2(r.xMax,r.yMax)),i=(i=cc.v2(i.x+this.paddingRight,i.y+this.paddingTop)).sub(t),0!==(i=cc.size(parseFloat(i.x.toFixed(2)),parseFloat(i.y.toFixed(2)))).width&&(e=-t.x/i.width,this.node.anchorX=parseFloat(e.toFixed(2))),0!==i.height&&(e=-t.y/i.height,this.node.anchorY=parseFloat(e.toFixed(2))),this.node.setContentSize(i))},_doLayoutGridAxisHorizontal:function(t,e){var i,n=e.width,r=1,s=-t.y*e.height,o=this.paddingBottom,e=(this.verticalDirection===I.TOP_TO_BOTTOM&&(r=-1,s=(1-t.y)*e.height,o=this.paddingTop),function(t,e,i){return s+r*(e+t.anchorY*t.height*this._getUsedScaleValue(t.scaleY)+o+i*this.spacingY)}.bind(this)),a=0;this.resizeMode===M.CONTAINER&&(i=this._doLayoutHorizontally(n,!0,e,!1),(a=s-i)<0&&(a*=-1),s=-t.y*a,this.verticalDirection===I.TOP_TO_BOTTOM&&(r=-1,s=(1-t.y)*a)),this._doLayoutHorizontally(n,!0,e,!0),this.resizeMode===M.CONTAINER&&this.node.setContentSize(n,a)},_doLayoutGridAxisVertical:function(t,e){var i,n=e.height,r=1,s=-t.x*e.width,o=this.paddingLeft,e=(this.horizontalDirection===B.RIGHT_TO_LEFT&&(r=-1,s=(1-t.x)*e.width,o=this.paddingRight),function(t,e,i){return s+r*(e+t.anchorX*t.width*this._getUsedScaleValue(t.scaleX)+o+i*this.spacingX)}.bind(this)),a=0;this.resizeMode===M.CONTAINER&&(i=this._doLayoutVertically(n,!0,e,!1),(a=s-i)<0&&(a*=-1),s=-t.x*a,this.horizontalDirection===B.RIGHT_TO_LEFT&&(r=-1,s=(1-t.x)*a)),this._doLayoutVertically(n,!0,e,!0),this.resizeMode===M.CONTAINER&&this.node.setContentSize(a,n)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),e=this.node.getContentSize();this.startAxis===r.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,e):this.startAxis===r.VERTICAL&&this._doLayoutGridAxisVertical(t,e)},_getHorizontalBaseWidth:function(t){var e=0,i=0;if(this.resizeMode===M.CONTAINER){for(var n=0;n<t.length;++n){var r=t[n];r.activeInHierarchy&&(i++,e+=r.width*this._getUsedScaleValue(r.scaleX))}e+=(i-1)*this.spacingX+this.paddingLeft+this.paddingRight}else e=this.node.getContentSize().width;return e},_doLayout:function(){var t;this.type===E.HORIZONTAL?(t=this._getHorizontalBaseWidth(this.node.children),this._doLayoutHorizontally(t,!1,function(t){return t.y},!0),this.node.width=t):this.type===E.VERTICAL?(t=this._getVerticalBaseHeight(this.node.children),this._doLayoutVertically(t,!1,function(t){return t.x},!0),this.node.height=t):this.type===E.NONE?this.resizeMode===M.CONTAINER&&this._doLayoutBasic():this.type===E.GRID&&this._doLayoutGrid()},_getUsedScaleValue:function(t){return this.affectedByScale?Math.abs(t):1},updateLayout:function(){this._layoutDirty&&0<this.node.children.length&&(this._doLayout(),this._layoutDirty=!1)}});cc.Layout=e.exports=t},{"../CCNode":30,"./CCComponent":78}],84:[function(t,e,h){"use strict";var u=n(t("../../renderer/gfx")),s=n(t("../value-types/mat4")),o=n(t("../value-types/vec2")),i=n(t("../assets/material/material-variant"));function n(t){return t&&t.__esModule?t:{default:t}}var _=t("../utils/misc"),d=t("./CCRenderComponent"),r=t("../renderer/render-flow"),f=t("../graphics/graphics"),p=new o.default,a=new s.default,c=[];var l=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),t=cc.Class({name:"cc.Mask",extends:d,editor:!1,ctor:function(){this._graphics=null,this._enableMaterial=null,this._exitMaterial=null,this._clearMaterial=null},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:l.RECT,type:{get:function(){return this._type},set:function(t){this._type!==t&&this._resetAssembler(),this._type=t,this._type!==l.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics()),this._activateMaterial()},type:l,tooltip:!1},spriteFrame:{type:cc.SpriteFrame,tooltip:!1,get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t,this.setVertsDirty(),this._updateMaterial())}},alphaThreshold:{default:.1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS?this._updateMaterial():cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&cc.warnID(4202)}},_segments:64,segements:{get:function(){return this._segments},set:function(t){this._segments=_.clampf(t,3,1e4),this._updateGraphics()},type:cc.Integer,tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:l},onRestore:function(){this._activateMaterial()},onEnable:function(){this._super(),this._type!==l.IMAGE_STENCIL&&this._updateGraphics(),this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag&=~r.FLAG_POST_RENDER},onDestroy:function(){this._super(),this._removeGraphics()},_resizeNodeToTargetNode:!1,_validateRender:function(){var t;this._type===l.IMAGE_STENCIL&&((t=this._spriteFrame)&&t.textureLoaded()||this.disableRender())},_activateMaterial:function(){this._createGraphics();var t=this._materials[0];(t=t?i.default.create(t,this):i.default.createWithBuiltin("2d-sprite",this)).define("USE_ALPHA_TEST",!0),this._type===l.IMAGE_STENCIL?(t.define("CC_USE_MODEL",!1),t.define("USE_TEXTURE",!0)):(t.define("CC_USE_MODEL",!0),t.define("USE_TEXTURE",!1)),this._enableMaterial||(this._enableMaterial=i.default.createWithBuiltin("2d-sprite",this)),this._exitMaterial||(this._exitMaterial=i.default.createWithBuiltin("2d-sprite",this),this._exitMaterial.setStencilEnabled(u.default.STENCIL_DISABLE)),this._clearMaterial||(this._clearMaterial=i.default.createWithBuiltin("clear-stencil",this)),this.setMaterial(0,t),this._graphics._materials[0]=t,this._updateMaterial()},_updateMaterial:function(){var t,e=this._materials[0];e&&(this._type===l.IMAGE_STENCIL&&this.spriteFrame&&(t=this.spriteFrame.getTexture(),e.setProperty("texture",t)),e.setProperty("alphaThreshold",this.alphaThreshold))},_createGraphics:function(){this._graphics||(this._graphics=new f,cc.Assembler.init(this._graphics),this._graphics.node=this.node,this._graphics.lineWidth=0,this._graphics.strokeColor=cc.color(0,0,0,0))},_updateGraphics:function(){var t=this.node,e=this._graphics,i=(e.clear(!1),t._contentSize.width),n=t._contentSize.height,r=-i*t._anchorPoint.x,t=-n*t._anchorPoint.y;if(this._type===l.RECT)e.rect(r,t,i,n);else if(this._type===l.ELLIPSE){for(var s=function(t,e,i){c.length=0;for(var n=2*Math.PI/i,r=0;r<i;++r)c.push(cc.v2(e.x*Math.cos(n*r)+t.x,e.y*Math.sin(n*r)+t.y));return c}(cc.v2(r+i/2,t+n/2),{x:i/2,y:n/2},this._segments),o=0;o<s.length;++o){var a=s[o];0===o?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}e.close()}cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?e.stroke():e.fill()},_removeGraphics:function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},_hitTest:function(t){var e=this.node,i=e.getContentSize(),n=i.width,i=i.height,r=p;if(e._updateWorldMatrix(),!s.default.invert(a,e._worldMatrix))return!1;o.default.transformMat4(r,t,a),r.x+=e._anchorPoint.x*n,r.y+=e._anchorPoint.y*i;t=!1;return this.type===l.RECT||this.type===l.IMAGE_STENCIL?t=0<=r.x&&0<=r.y&&r.x<=n&&r.y<=i:this.type===l.ELLIPSE&&(t=(e=r.x-.5*n)*e/((e=n/2)*e)+(n=r.y-.5*i)*n/((e=i/2)*e)<1),t=this.inverted?!t:t},markForRender:function(t){var e=r.FLAG_RENDER|r.FLAG_UPDATE_RENDER_DATA|r.FLAG_POST_RENDER;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e},disableRender:function(){this.node._renderFlag&=~(r.FLAG_RENDER|r.FLAG_UPDATE_RENDER_DATA|r.FLAG_POST_RENDER)}});cc.Mask=e.exports=t},{"../../renderer/gfx":312,"../assets/material/material-variant":60,"../graphics/graphics":131,"../renderer/render-flow":221,"../utils/misc":264,"../value-types/mat4":281,"../value-types/vec2":288,"./CCRenderComponent":89}],85:[function(t,e,i){"use strict";var n=t("../components/CCRenderComponent"),r=t("../../core/utils/blend-func"),t=cc.Class({name:"cc.MotionStreak",extends:n,mixins:[r],editor:!1,ctor:function(){this._points=[]},properties:{preview:{default:!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()},animatable:!1,tooltip:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(t){this._minSeg=t},animatable:!1,tooltip:!1},_stroke:64,stroke:{get:function(){return this._stroke},set:function(t){this._stroke=t},animatable:!1,tooltip:!1},_texture:{default:null,type:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this._updateMaterial())},type:cc.Texture2D,animatable:!1,tooltip:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color},set:function(t){this._color=t},type:cc.Color,tooltip:!1},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(t){this._fastMode=t},animatable:!1,tooltip:!1}},onEnable:function(){this._super(),this.reset()},_updateMaterial:function(){var t=this.getMaterial(0);t&&t.setProperty("texture",this._texture),r.prototype._updateMaterial.call(this)},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._points.length=0,this._assembler&&this._assembler._renderData.clear()},lateUpdate:function(t){this._assembler&&this._assembler.update(this,t)}});cc.MotionStreak=e.exports=t},{"../../core/utils/blend-func":257,"../components/CCRenderComponent":89}],86:[function(t,e,i){"use strict";var s=cc.Enum({Unified:0,Free:1}),o=cc.Enum({Horizontal:0,Vertical:1}),n=cc.Enum({PAGE_TURNING:0}),r=cc.Class({name:"cc.PageView",extends:cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._initContentPos=cc.v2(),this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},properties:{sizeMode:{default:s.Unified,type:s,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{default:o.Horizontal,type:o,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:s,Direction:o,EventType:n},__preload:function(){this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this)},onEnable:function(){this._super(),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},onDestroy:function(){this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(t){this.scrollToPage(t,!0)},getPages:function(){return this._pages},addPage:function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(this.content.addChild(t),this._pages.push(t),this._updatePageView())},insertPage:function(t,e){e<0||!t||-1!==this._pages.indexOf(t)||!this.content||(this._pages.length<=e?this.addPage(t):(this._pages.splice(e,0,t),this.content.addChild(t),this._updatePageView()))},removePage:function(t){var e;t&&this.content&&(-1!==(e=this._pages.indexOf(t))?this.removePageAtIndex(e):cc.warnID(4300,t.name))},removePageAtIndex:function(t){var e,i=this._pages;t<0||t>=i.length||(e=i[t])&&(this.content.removeChild(e),i.splice(t,1),this._updatePageView())},removeAllPages:function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(t,e){t<0||t>=this._pages.length||(e=void 0!==e?e:.3,this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===o.Horizontal,this.vertical=this.direction===o.Vertical},_syncSizeMode:function(){var t,e;!this.content||(t=this.content.getComponent(cc.Layout))&&(this.sizeMode===s.Free&&0<this._pages.length&&(e=this._pages[this._pages.length-1],this.direction===o.Horizontal?(t.paddingLeft=(this._view.width-this._pages[0].width)/2,t.paddingRight=(this._view.width-e.width)/2):this.direction===o.Vertical&&(t.paddingTop=(this._view.height-this._pages[0].height)/2,t.paddingBottom=(this._view.height-e.height)/2)),t.updateLayout())},_updatePageView:function(){for(var t=this.content.getComponent(cc.Layout),e=(t&&t.enabled&&t.updateLayout(),this._pages.length),i=(this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx),this._initContentPos),n=0;n<e;++n){var r=this._pages[n];r.setSiblingIndex(n),this.direction===o.Horizontal?this._scrollCenterOffsetX[n]=Math.abs(i.x+r.x):this._scrollCenterOffsetY[n]=Math.abs(i.y+r.y)}this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===s.Unified)for(var t=this._pages,e=this._view.getContentSize(),i=0,n=t.length;i<n;i++)t[i].setContentSize(e)},_initPages:function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];0<=this._pages.indexOf(i)||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,n.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(t,e,i){return this.sizeMode!==s.Free?this.direction===o.Horizontal?Math.abs(t.x)>=this._view.width*this.scrollThreshold:this.direction===o.Vertical?Math.abs(t.y)>=this._view.height*this.scrollThreshold:void 0:this.direction===o.Horizontal?(n=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(n-r)*this.scrollThreshold):this.direction===o.Vertical?(n=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(n-r)*this.scrollThreshold):void 0;var n,r},_isQuicklyScrollable:function(t){if(this.direction===o.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===o.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(t){var e=cc.v2(0,0);return this.sizeMode===s.Free?this.direction===o.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===o.Vertical&&(e.y=this._scrollCenterOffsetY[t]):this.direction===o.Horizontal?e.x=t*this._view.width:this.direction===o.Vertical&&(e.y=t*this._view.height),e},_getDragDirection:function(t){return this.direction===o.Horizontal?0===t.x?0:0<t.x?1:-1:this.direction===o.Vertical?0===t.y?0:t.y<0?1:-1:void 0},_handleReleaseLogic:function(t){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_autoScrollToPage:function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();(0<(t=this._clampDelta(t)).x||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||0<t.y)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var t=this._touchBeganPosition.sub(this._touchEndPosition),e=this._curPageIdx,i=e+this._getDragDirection(t),n=this.pageTurningSpeed*Math.abs(e-i);if(i<this._pages.length){if(this._isScrollable(t,e,i))return void this.scrollToPage(i,n);t=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(t))return void this.scrollToPage(i,n)}this.scrollToPage(e,n)}},_onTouchBegan:function(t,e){this._touchBeganPosition=t.touch.getLocation(),this._super(t,e)},_onTouchMoved:function(t,e){this._super(t,e)},_onTouchEnded:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onTouchCancelled:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onMouseWheel:function(){}});cc.PageView=e.exports=r},{}],87:[function(t,e,i){"use strict";var n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),t=cc.Class({name:"cc.PageViewIndicator",extends:t("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1},direction:{default:n.HORIZONTAL,type:n,tooltip:!1},cellSize:{default:cc.size(20,20),tooltip:!1},spacing:{default:0,tooltip:!1}},statics:{Direction:n},onLoad:function(){this._updateLayout()},setPageView:function(t){this._pageView=t,this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===n.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===n.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var t=new cc.Node,e=t.addComponent(cc.Sprite);return e.spriteFrame=this.spriteFrame,e.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.parent=this.node,t.width=this.cellSize.width,t.height=this.cellSize.height,t},_changedState:function(){var t=this._indicators;if(0!==t.length){var e=this._pageView._curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i)t[i].opacity=127.5;t[e].opacity=255}}},_refresh:function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;0<i;--i){var n=t[i-1];this.node.removeChild(n),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}}});cc.PageViewIndicator=e.exports=t},{"./CCComponent":78}],88:[function(t,e,i){"use strict";var h=t("../utils/misc"),t=t("./CCComponent"),u=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),t=cc.Class({name:"cc.ProgressBar",extends:t,editor:!1,_initBarSprite:function(){var t,e,i,n;!this.barSprite||(t=this.barSprite.node)&&(e=this.node.getContentSize(),i=this.node.getAnchorPoint(),n=t.getContentSize(),t.parent===this.node&&this.node.setContentSize(n),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=u.FILLED),n=t.getContentSize(),this.mode===u.HORIZONTAL?this.totalLength=n.width:this.mode===u.VERTICAL?this.totalLength=n.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node&&(n=-e.width*i.x,t.setPosition(cc.v2(n,0))))},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(t){var e,i,n,r=t.getAnchorPoint(),s=t.getContentSize(),o=t.getPosition(),a=cc.v2(0,.5),c=h.clamp01(this.progress),l=this.totalLength*c;switch(this.mode){case u.HORIZONTAL:this.reverse&&(a=cc.v2(1,.5)),e=cc.size(l,s.height),i=this.totalLength,n=s.height;break;case u.VERTICAL:a=this.reverse?cc.v2(.5,1):cc.v2(.5,0),e=cc.size(s.width,l),i=s.width,n=this.totalLength}this.mode===u.FILLED?this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(l*=-1),this.barSprite.fillRange=l):this.barSprite.type!==cc.Sprite.Type.FILLED?(c=a.x-r.x,r=a.y-r.y,c=cc.v2(i*c,n*r),t.setPosition(o.x+c.x,o.y+c.y),t.setAnchorPoint(a),t.setContentSize(e)):cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:u.HORIZONTAL,type:u,tooltip:!1,notify:function(){var t;!this.barSprite||(t=this.barSprite.node)&&(t=t.getContentSize(),this.mode===u.HORIZONTAL?this.totalLength=t.width:this.mode===u.VERTICAL?this.totalLength=t.height:this.mode===u.FILLED&&(this.totalLength=this.barSprite.fillRange))},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(t){this.mode===u.FILLED&&(t=h.clamp01(t)),this._N$totalLength=t,this._updateBarStatus()}},progress:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:u}});cc.ProgressBar=e.exports=t},{"../utils/misc":264,"./CCComponent":78}],89:[function(t,e,i){"use strict";var n=s(t("../renderer/assembler")),r=s(t("../assets/material/material-variant"));function s(t){return t&&t.__esModule?t:{default:t}}var o=t("./CCComponent"),a=t("../renderer/render-flow"),c=t("../assets/material/CCMaterial"),t=cc.Class({name:"RenderComponent",extends:o,editor:!1,properties:{_materials:{default:[],type:c},materials:{get:function(){return this._materials},set:function(t){this._materials=t,this._activateMaterial()},type:[c],displayName:"Materials",animatable:!1}},ctor:function(){this._vertsDirty=!0,this._assembler=null},_resetAssembler:function(){n.default.init(this),this._updateColor(),this.setVertsDirty()},__preload:function(){this._resetAssembler(),this._activateMaterial()},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),(this.node._renderComponent=this).node._renderFlag|=a.FLAG_OPACITY_COLOR,this.setVertsDirty()},onDisable:function(){this.node._renderComponent=null,this.disableRender()},onDestroy:function(){for(var t=this._materials,e=0;e<t.length;e++)cc.pool.material.put(t[e]);t.length=0,cc.pool.assembler.put(this._assembler)},setVertsDirty:function(){this._vertsDirty=!0,this.markForRender(!0)},_on3DNodeChanged:function(){this._resetAssembler()},_validateRender:function(){},markForValidate:function(){cc.RenderFlow.registerValidate(this)},markForRender:function(t){var e=a.FLAG_RENDER|a.FLAG_UPDATE_RENDER_DATA;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e},disableRender:function(){this.node._renderFlag&=~(a.FLAG_RENDER|a.FLAG_UPDATE_RENDER_DATA)},getMaterial:function(t){if(t<0||t>=this._materials.length)return null;var e=this._materials[t];if(!e)return null;var i=r.default.create(e,this);return i!==e&&this.setMaterial(t,i),i},getMaterials:function(){for(var t=this._materials,e=0;e<t.length;e++)t[e]=r.default.create(t[e],this);return t},setMaterial:function(t,e){return e!==this._materials[t]&&(e=r.default.create(e,this),this._materials[t]=e),this._updateMaterial(),this.markForRender(!0),e},_getDefaultMaterial:function(){return c.getBuiltinMaterial("2d-sprite")},_activateMaterial:function(){var t,e=this._materials;e[0]||(t=this._getDefaultMaterial(),e[0]=t);for(var i=0;i<e.length;i++)e[i]=r.default.create(e[i],this);this._updateMaterial()},_updateMaterial:function(){},_updateColor:function(){this._assembler.updateColor&&this._assembler.updateColor(this)},_checkBacth:function(t,e){var i=this._materials[0];(i&&i.getHash()!==t.material.getHash()||t.cullingMask!==e)&&(t._flush(),t.node=i.getDefine("CC_USE_MODEL")?this.node:t._dummyNode,t.material=i,t.cullingMask=e)}});cc.RenderComponent=e.exports=t},{"../assets/material/CCMaterial":53,"../assets/material/material-variant":60,"../renderer/assembler":217,"../renderer/render-flow":221,"./CCComponent":78}],90:[function(t,e,a){"use strict";var i=t("../platform/js"),n=t("../platform/CCMacro"),u=t("../utils/text-utils"),h=new(t("../utils/html-text-parser")),_=n.TextAlignment,r=n.VerticalTextAlignment,s="RICHTEXT_CHILD",l="RICHTEXT_Image_CHILD",t=cc.Label.CacheMode;var o=new i.Pool(function(t){if(!cc.isValid(t))return!1;t=t.getComponent(cc.LabelOutline);return t&&(t.width=0),!0},20),n=(o.get=function(t,e){var i=this._get(),n=((i=i||new cc.PrivateNode(s)).setPosition(0,0),i.setAnchorPoint(.5,.5),i.skewX=0,i.getComponent(cc.Label));return(n=n||i.addComponent(cc.Label)).string="",n.horizontalAlign=_.LEFT,n.verticalAlign=r.CENTER,i},cc.Class({name:"cc.RichText",extends:cc.Component,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:_.LEFT,type:_,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},_fontFamily:"Arial",fontFamily:{tooltip:!1,get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1,tooltip:!1},cacheMode:{default:t.NONE,type:t,tooltip:!1,notify:function(t){this.cacheMode!==t&&this._updateRichTextStatus()},animatable:!1},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:_,VerticalAlign:r},onEnable:function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},onDisable:function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},start:function(){this._onTTFLoaded()},_onColorChanged:function(e){this.node.children.forEach(function(t){t.color=e})},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t,null,!0)}.bind(this))},_createFontLabel:function(t){return o.get(t,this)},_onTTFLoaded:function(){var i;!(this.font instanceof cc.TTFFont)||this.font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):(i=this,cc.loader.load(this.font.nativeUrl,function(t,e){i._layoutDirty=!0,i._updateRichText()}))},_measureText:function(i,t){function e(t){var e;return 0===n._labelSegmentsCache.length?(e=n._createFontLabel(t),n._labelSegmentsCache.push(e)):e=n._labelSegmentsCache[0],e._styleIndex=i,n._applyTextAttribute(e,t,!0),e.getContentSize().width}var n=this;return t?e(t):e},_onTouchEnded:function(n){for(var r=this,s=this.node.getComponents(cc.Component),t=0;t<this._labelSegments.length;++t)!function(t){var t=r._labelSegments[t],e=t._clickHandler,i=t._clickParam;e&&r._containsTouchLocation(t,n.touch.getLocation())&&(s.forEach(function(t){t.enabledInHierarchy&&t[e]&&t[e](n,i)}),n.stopPropagation())}(t)},_containsTouchLocation:function(t,e){return t.getBoundingBoxToWorld().contains(e)},_resetState:function(){for(var t=this.node.children,e=t.length-1;0<=e;e--){var i=t[e];i.name!==s&&i.name!==l||(i.parent===this.node?i.parent=null:t.splice(e,1),i.name===s&&o.put(i))}this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},onRestore:!1,_activateChildren:function(t){for(var e=this.node.children.length-1;0<=e;e--){var i=this.node.children[e];i.name!==s&&i.name!==l||(i.active=t)}},_addLabelSegment:function(t,e){var i=0===this._labelSegmentsCache.length?this._createFontLabel(t):this._labelSegmentsCache.pop();return i._styleIndex=e,i._lineCount=this._lineCount,i.active=this.node.active,i.setAnchorPoint(0,0),this._applyTextAttribute(i,t),this.node.addChild(i),this._labelSegments.push(i),i},_updateRichTextWithMaxWidth:function(t,h,e){var i=h;if(0<this._lineOffsetX&&i+this._lineOffsetX>this.maxWidth)for(var n=0;this._lineOffsetX<=this.maxWidth;){var r,s=this._getFirstWordLen(t,n,t.length),o=t.substr(n,s),o=this._measureText(e,o);if(!(this._lineOffsetX+o<=this.maxWidth)){0<n&&(r=t.substr(0,n),this._addLabelSegment(r,e),t=t.substr(n,t.length),i=this._measureText(e,t)),this._updateLineInfo();break}this._lineOffsetX+=o,n+=s}if(i>this.maxWidth)for(var a=u.fragmentText(t,i,this.maxWidth,this._measureText(e)),c=0;c<a.length;++c){var l=a[c],l=this._addLabelSegment(l,e).getContentSize();this._lineOffsetX+=l.width,1<a.length&&c<a.length-1&&this._updateLineInfo()}else this._lineOffsetX+=i,this._addLabelSegment(t,e)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;i=i.style,n=n.style;if(i){if(n){if(!i.outline!=!n.outline)return!0;if(i.size!==n.size||!i.italic!=!n.italic||i.isImage!==n.isImage)return!0;if(i.src!==n.src||i.imageAlign!==n.imageAlign||i.imageHeight!==n.imageHeight||i.imageWidth!==n.imageWidth||i.imageOffset!==n.imageOffset)return!0}else if(i.size||i.italic||i.isImage||i.outline)return!0}else if(n&&(n.size||n.italic||n.isImage||n.outline))return!0}return!1},_addRichTextImageElement:function(t){var e=t.style.src,e=this.imageAtlas.getSpriteFrame(e);if(e){var i=new cc.PrivateNode(l),n=i.addComponent(cc.Sprite);switch(t.style.imageAlign){case"top":i.setAnchorPoint(0,1);break;case"center":i.setAnchorPoint(0,.5);break;default:i.setAnchorPoint(0,0)}t.style.imageOffset&&(i._imageOffset=t.style.imageOffset),n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.node.addChild(i),this._labelSegments.push(i);var r=e.getRect(),s=1,o=r.width,r=r.height,a=t.style.imageWidth,c=t.style.imageHeight;o*=s=0<c?c/r:this.lineHeight/r,r*=s,0<a&&(o=a),0<this.maxWidth?(this._lineOffsetX+o>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=o):(this._lineOffsetX+=o,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n.spriteFrame=e,i.setContentSize(o,r),i._lineCount=this._lineCount,t.style.event?(t.style.event.click&&(i._clickHandler=t.style.event.click),t.style.event.param?i._clickParam=t.style.event.param:i._clickParam=""):i._clickHandler=null}else cc.warnID(4400)},_updateRichText:function(){if(this.enabledInHierarchy){var t=h.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();for(var e=!1,i=0;i<this._textArray.length;++i){var n=this._textArray[i],r=n.text;if(""===r){if(n.style&&n.style.newline){this._updateLineInfo();continue}if(n.style&&n.style.isImage&&this.imageAtlas){this._addRichTextImageElement(n);continue}}for(var s=r.split("\n"),o=0;o<s.length;++o){var a,c=s[o];""!==c?(e=!1,0<this.maxWidth?(a=this._measureText(i,c),this._updateRichTextWithMaxWidth(c,a,i)):(a=this._addLabelSegment(c,i).getContentSize(),this._lineOffsetX+=a.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),1<s.length&&o<s.length-1&&this._updateLineInfo()):this._isLastComponentCR(r)&&o===s.length-1||(this._updateLineInfo(),e=!0)}}e||this._linesWidth.push(this._lineOffsetX),0<this.maxWidth&&(this._labelWidth=this.maxWidth),this._labelHeight=(this._lineCount+u.BASELINE_RATIO)*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(u.isUnicodeCJK(n)||u.isUnicodeSpace(n))return 1;for(var r=1,s=e+1;s<i&&(n=t.charAt(s),!u.isUnicodeSpace(n)&&!u.isUnicodeCJK(n));++s)r++;return r},_updateRichTextPosition:function(){for(var t=0,e=1,h=this._lineCount,i=0;i<this._labelSegments.length;++i){var n=this._labelSegments[i],r=n._lineCount,s=(e<r&&(t=0,e=r),0);switch(this.horizontalAlign){case _.LEFT:s=-this._labelWidth/2;break;case _.CENTER:s=-this._linesWidth[r-1]/2;break;case _.RIGHT:s=this._labelWidth/2-this._linesWidth[r-1]}n.x=t+s;var o=n.getContentSize();if(n.y=this.lineHeight*(h-r)-this._labelHeight/2,r===e&&(t+=o.width),n.getComponent(cc.Sprite)){var a,c=this.lineHeight,l=this.lineHeight*(1+u.BASELINE_RATIO);switch(n.anchorY){case 1:n.y+=c+(l-c)/2;break;case.5:n.y+=l/2;break;default:n.y+=(l-c)/2}n._imageOffset&&(1===(o=n._imageOffset.split(",")).length&&o[0]?(a=parseFloat(o[0]),Number.isInteger(a)&&(n.y+=a)):2===o.length&&(a=parseFloat(o[0]),o=parseFloat(o[1]),Number.isInteger(a)&&(n.x+=a),Number.isInteger(o)&&(n.y+=o)))}o=n.getComponent(cc.LabelOutline);o&&o.width&&(n.y=n.y-o.width)}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]||cc.color().fromHEX(t)},_applyTextAttribute:function(t,e,i){var n,r,s=t.getComponent(cc.Label);s&&(r=t._styleIndex,n=null,(n=this._textArray[r]?this._textArray[r].style:n)&&n.color?t.color=this._convertLiteralColorValue(n.color):t.color=this.node.color,s.cacheMode=this.cacheMode,this.font instanceof cc.Font&&!this._isSystemFontUsed?s.font=this.font:s.fontFamily=this.fontFamily,s.useSystemFont=this._isSystemFontUsed,s.lineHeight=this.lineHeight,s.enableBold=n&&n.bold,s.enableItalics=n&&n.italic,n&&n.italic&&(t.skewX=12),s.enableUnderline=n&&n.underline,n&&n.outline&&((r=(r=t.getComponent(cc.LabelOutline))||t.addComponent(cc.LabelOutline)).color=this._convertLiteralColorValue(n.outline.color),r.width=n.outline.width),n&&n.size?s.fontSize=n.size:s.fontSize=this.fontSize,null!==e&&(s.string=e="string"!=typeof e?""+e:e),i&&s._forceUpdateRenderData(),n&&n.event?(n.event.click&&(t._clickHandler=n.event.click),n.event.param?t._clickParam=n.event.param:t._clickParam=""):t._clickHandler=null)},onDestroy:function(){for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(),o.put(this._labelSegments[t])}}));cc.RichText=e.exports=n},{"../platform/CCMacro":194,"../platform/js":209,"../utils/html-text-parser":261,"../utils/text-utils":271}],91:[function(t,e,i){"use strict";var o=t("../utils/misc"),h=(t("./CCComponent"),cc.Enum({HORIZONTAL:0,VERTICAL:1})),t=cc.Class({name:"cc.Scrollbar",extends:t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},direction:{default:h.HORIZONTAL,type:h,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:h},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=this._scrollView.node,t=t.convertToWorldSpaceAR(cc.v2(-t.anchorX*t.width,-t.anchorY*t.height)),t=e.convertToNodeSpaceAR(t);return t.x+=e.anchorX*e.width,t.y+=e.anchorY*e.height,t},_setOpacity:function(t){this.handle&&(this.node.opacity=t,this.handle.node.opacity=t)},_onScroll:function(t){var e,i,n,r,s,o,a,c,l;!this._scrollView||(e=this._scrollView.content)&&(c=e.getContentSize(),l=this._scrollView.node.getContentSize(),i=this.node.getContentSize(),this._conditionalDisableScrollBar(c,l)||(this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)),a=o=s=r=n=0,this.direction===h.HORIZONTAL?(n=c.width,r=l.width,a=i.width,s=t.x,o=-this._convertToScrollViewSpace(e).x):this.direction===h.VERTICAL&&(n=c.height,r=l.height,a=i.height,s=t.y,o=-this._convertToScrollViewSpace(e).y),c=this._calculateLength(n,r,a,s),l=this._calculatePosition(n,r,a,o,s,c),this._updateLength(c),this._updateHanlderPosition(l)))},_updateHanlderPosition:function(t){var e;this.handle&&(e=this._fixupHandlerPosition(),this.handle.node.setPosition(t.x+e.x,t.y+e.y))},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=this.handle.node.getContentSize(),n=this.handle.node.parent,e=this.node.convertToWorldSpaceAR(cc.v2(-t.width*e.x,-t.height*e.y)),n=n.convertToNodeSpaceAR(e);return this.direction===h.HORIZONTAL?n=cc.v2(n.x,n.y+(t.height-i.height)/2):this.direction===h.VERTICAL&&(n=cc.v2(n.x+(t.width-i.width)/2,n.y)),this.handle.node.setPosition(n),n},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===h.HORIZONTAL||t.height<=e.height&&this.direction===h.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var t=t.getContentSize(),e=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(t,e))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,i,n){return n&&(t+=20*(0<n?n:-n)),i*(e/t)},_calculatePosition:function(t,e,i,n,r,s){t-=e,r&&(t+=Math.abs(r)),e=0,r=(i-s)*(e=t?o.clamp01(e=n/t):e);return this.direction===h.VERTICAL?cc.v2(0,r):cc.v2(r,0)},_updateLength:function(t){var e,i;this.handle&&(i=(e=this.handle.node).getContentSize(),e.setAnchorPoint(cc.v2(0,0)),this.direction===h.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t))},_processAutoHide:function(t){!this.enableAutoHide||this._autoHideRemainingTime<=0||this._touching||(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),t=this._opacity*(this._autoHideRemainingTime/this.autoHideTime),this._setOpacity(t)))},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=t},{"../utils/misc":264,"./CCComponent":78}],92:[function(t,e,l){"use strict";function i(){return(new Date).getMilliseconds()}var n=t("../CCNode").EventType,s=1e-4,r=cc.v2(),o=cc.v2(),a=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),c={"scroll-to-top":a.SCROLL_TO_TOP,"scroll-to-bottom":a.SCROLL_TO_BOTTOM,"scroll-to-left":a.SCROLL_TO_LEFT,"scroll-to-right":a.SCROLL_TO_RIGHT,scrolling:a.SCROLLING,"bounce-bottom":a.BOUNCE_BOTTOM,"bounce-left":a.BOUNCE_LEFT,"bounce-right":a.BOUNCE_RIGHT,"bounce-top":a.BOUNCE_TOP,"scroll-ended":a.SCROLL_ENDED,"touch-up":a.TOUCH_UP,"scroll-ended-with-threshold":a.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":a.SCROLL_BEGAN},t=cc.Class({name:"cc.ScrollView",extends:t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.v2(0,0),this._autoScrollTargetDelta=cc.v2(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._outOfBoundaryAmount=cc.v2(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,tooltip:!1,formerlySerializedAs:"content",notify:function(t){this._calculateBoundary()}},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:cc.Float,range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1},_view:{get:function(){if(this.content)return this.content.parent}}},statics:{EventType:a},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToOffset:function(t,e,i){var n=this.getMaxScrollOffset(),r=cc.v2(0,0);0===n.x?r.x=0:r.x=t.x/n.x,0===n.y?r.y=1:r.y=(n.y-t.y)/n.y,this.scrollTo(r,e,i)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(e,t)},getMaxScrollOffset:function(){var t=this._view.getContentSize(),e=this.content.getContentSize(),i=0<=(i=e.width-t.width)?i:0,e=0<=(e=e.height-t.height)?e:0;return cc.v2(i,e)},scrollToPercentHorizontal:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t)},scrollTo:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t)},scrollToPercentVertical:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){t.fuzzyEquals(this.getContentPosition(),s)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(e=cc.v2(0,0),this.vertical?e=cc.v2(0,-.1*t.getScrollY()):this.horizontal&&(e=cc.v2(-.1*t.getScrollY(),0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(e),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)))},_checkMouseWheel:function(t){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),s))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,.1<this._mouseWheelEventElapsedTime&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(t){var e=t.anchor,i=t.applyToHorizontal,t=t.applyToVertical,n=(this._calculateBoundary(),e=e.clampf(cc.v2(0,0),cc.v2(1,1)),this._view.getContentSize()),r=this.content.getContentSize(),s=-(this._getContentBottomBoundary()-this._bottomBoundary),o=-(this._getContentLeftBoundary()-this._leftBoundary),a=cc.v2(0,0),c=0;return i&&(c=r.width-n.width,a.x=o-c*e.x),t&&(c=r.height-n.height,a.y=s-c*e.y),a},_moveContentToTopLeft:function(t){var e=this.content.getContentSize(),i=-(this._getContentBottomBoundary()-this._bottomBoundary),n=cc.v2(0,0),r=0,s=-(this._getContentLeftBoundary()-this._leftBoundary);e.height<t.height&&(r=e.height-t.height,n.y=i-r),e.width<t.width&&(r=e.width-t.width,n.x=s),this._updateScrollBarState(),this._moveContent(n),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){var t,e,i;this.content&&((t=this.content.getComponent(cc.Layout))&&t.enabledInHierarchy&&t.updateLayout(),e=(t=this._view.getContentSize()).width*this._view.anchorX,i=t.height*this._view.anchorY,this._leftBoundary=-e,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+t.width,this._topBoundary=this._bottomBoundary+t.height,this._moveContentToTopLeft(t))},_hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(this.node===n)return!!t.target.getComponent(cc.ViewGroup);if(n.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(e=t.touch,this.content&&this._handlePressLogic(e),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},_onTouchMoved:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(e=t.touch,this.content&&this._handleMoveLogic(e),this.cancelInnerEvents&&(7<e.getLocation().sub(e.getStartLocation()).mag()&&!this._touchMoved&&t.target!==this.node&&((e=new cc.Event.EventTouch(t.getTouches(),t.bubbles)).type=cc.Node.EventType.TOUCH_CANCEL,e.touch=t.touch,e.simulate=!0,t.target.dispatchEvent(e),this._touchMoved=!0),this._stopPropagationIfTargetIsMe(t))))},_onTouchEnded:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(this._dispatchEvent("touch-up"),e=t.touch,this.content&&this._handleReleaseLogic(e),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)))},_onTouchCancelled:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(t.simulate||(e=t.touch,this.content&&this._handleReleaseLogic(e)),this._stopPropagationIfTargetIsMe(t)))},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_getLocalAxisAlignDelta:function(t){return this.node.convertToNodeSpaceAR(t.getLocation(),r),this.node.convertToNodeSpaceAR(t.getPreviousLocation(),o),r.sub(o)},_handleMoveLogic:function(t){t=this._getLocalAxisAlignDelta(t);this._processDeltaMove(t)},_scrollChildren:function(t){var t=t=this._clampDelta(t),e=(this.elastic&&(e=this._getHowMuchOutOfBoundary(),t.x*=0===e.x?1:.5,t.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(t),t=t.add(e)),-1);0<t.y?this.content.y-this.content.anchorY*this.content.height+t.y>=this._bottomBoundary&&(e="scroll-to-bottom"):t.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+t.y<=this._topBoundary&&(e="scroll-to-top"),t.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+t.x<=this._rightBoundary&&(e="scroll-to-right"):0<t.x&&this.content.x-this.content.anchorX*this.content.width+t.x>=this._leftBoundary&&(e="scroll-to-left"),this._moveContent(t,!1),0===t.x&&0===t.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),-1!==e&&this._dispatchEvent(e)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=i(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),i=this._view.getContentSize();return e.width<i.width&&(t.x=0),e.height<i.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);t=i();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).fuzzyEquals(cc.v2(0,0),s))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(0<t.y&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),0<t.x&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){var t;this._startBounceBackIfNeeded()||!this.inertia||!(t=this._calculateTouchMoveVelocity()).fuzzyEquals(cc.v2(0,0),s)&&this.brake<1&&this._startInertiaScroll(t),this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){t=this._getLocalAxisAlignDelta(t);this._gatherTouchMove(t),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),s)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return s},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1,t=(this._autoScrollAccumulatedTime+=t*(1/i),Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime)),n=(this._autoScrollAttenuate&&(n=t,t=--n*n*n*n*n+1),this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(t))),r=Math.abs(t-1)<=s,t=(Math.abs(t-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic?(t=n.sub(this._autoScrollBrakingStartPosition),e&&(t=t.mul(i)),n=this._autoScrollBrakingStartPosition.add(t)):(e=n.sub(this.getContentPosition()),(i=this._getHowMuchOutOfBoundary(e)).fuzzyEquals(cc.v2(0,0),s)||(n=n.add(i),r=!0)),r&&(this._autoScrolling=!1),n.sub(this.getContentPosition()));this._moveContent(this._clampDelta(t),r),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(t){var e=t.mul(.7);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},_startAttenuatingAutoScroll:function(t,e){var e=this._calculateAutoScrollTimeByInitalSpeed(e.mag()),i=t.normalize(),n=this.content.getContentSize(),r=this._view.getContentSize(),s=n.width-r.width,n=n.height-r.height,r=this._calculateAttenuatedFactor(s),o=this._calculateAttenuatedFactor(n),i=cc.v2(i.x*s*(1-this.brake)*r,i.y*n*o*(1-this.brake)),s=t.mag(),r=i.mag()/s;i=i.add(t),0<this.brake&&7<r&&(r=Math.sqrt(r),i=t.mul(r).add(t)),0<this.brake&&3<r&&(e*=r=3),0===this.brake&&1<r&&(e*=r),this._startAutoScroll(i,e,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAutoScroll:function(t,e,i){t=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=t,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),s)||(this._autoScrollCurrentlyOutOfBoundary=!0)},_calculateTouchMoveVelocity:function(){var t;if((t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e},0))<=0||.5<=t)return cc.v2(0,0);var e=cc.v2(0,0),e=this._touchMoveDisplacements.reduce(function(t,e){return t.add(e)},e);return cc.v2(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){return t.x=this.horizontal?t.x:0,t.y=this.vertical?t.y:0,t},_moveContent:function(t,e){t=this._flattenVectorByDirection(t),t=this.getContentPosition().add(t),this.setContentPosition(t),t=this._getHowMuchOutOfBoundary();this._updateScrollBar(t),this.elastic&&e&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(t){if((t=t||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),s)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.v2(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.fuzzyEquals(cc.v2(0,0),s)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),e=this._clampDelta(e)},_updateScrollBarState:function(){var t,e;this.content&&(t=this.content.getContentSize(),e=this._view.getContentSize(),this.verticalScrollBar&&(t.height<e.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(t.width<e.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show()))},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var e=1<<c[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,c[t]),this.node.emit(t,this)},_adjustContentOutOfBoundary:function(){var t;this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()&&(t=this._getHowMuchOutOfBoundary(cc.v2(0,0)),t=this.getContentPosition().add(t),this.content&&(this.content.setPosition(t),this._updateScrollBar(0)))},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},onDisable:function(){this._unregisterEvent(),this.content&&(this.content.off(n.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(n.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(n.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(n.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(n.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.content&&(this.content.on(n.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(n.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(n.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(n.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(n.SIZE_CHANGED,this._calculateBoundary,this))),this._updateScrollBarState()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.ScrollView=e.exports=t},{"../CCNode":30,"./CCViewGroup":99}],93:[function(t,e,i){"use strict";var n=t("../utils/misc"),t=t("./CCComponent"),r=cc.Enum({Horizontal:0,Vertical:1}),t=cc.Class({name:"cc.Slider",extends:t,editor:!1,ctor:function(){this._offset=cc.v2(),this._touchHandle=!1,this._dragging=!1},properties:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:r.Horizontal,type:r,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:r},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(t){this._dragging=!0,this._touchHandle=!0,this._offset=this.handle.node.convertToNodeSpaceAR(t.touch.getLocation()),t.stopPropagation()},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchEnded:function(t){this._dragging=!1,this._touchHandle=!1,this._offset=cc.v2(),t.stopPropagation()},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation()},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(t){var e;this.handle&&(t=(e=this.node).convertToNodeSpaceAR(t.getLocation()),this.direction===r.Horizontal?this.progress=n.clamp01((t.x-this._offset.x+e.anchorX*e.width)/e.width):this.progress=n.clamp01((t.y-this._offset.y+e.anchorY*e.height)/e.height))},_updateHandlePosition:function(){var t;this.handle&&(t=this.direction===r.Horizontal?cc.v2(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.v2(0,-this.node.height*this.node.anchorY+this.progress*this.node.height),t=this.node.convertToWorldSpaceAR(t),this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(t))}});cc.Slider=e.exports=t},{"../utils/misc":264,"./CCComponent":78}],94:[function(t,e,i){"use strict";var n=t("../utils/misc"),r=(t("../CCNode").EventType,t("./CCRenderComponent")),s=t("../utils/blend-func"),o=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),t=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),a=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),c=cc.Enum({NORMAL:0,GRAY:1}),r=cc.Class({name:"cc.Sprite",extends:r,mixins:[s],editor:!1,properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:o.SIMPLE,_sizeMode:a.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._spriteFrame;i!==t&&(this._spriteFrame=t,this._applySpriteFrame(i))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.setVertsDirty(),this._resetAssembler())},type:o,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(t){t!==this._fillType&&(this._fillType=t,this.setVertsDirty(),this._resetAssembler())},type:t,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===o.FILLED&&this.setVertsDirty()},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=n.clampf(t,-1,1),this._type===o.FILLED&&this.setVertsDirty()},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=n.clampf(t,-1,1),this._type===o.FILLED&&this.setVertsDirty()},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type!==o.SIMPLE&&this._type!==o.MESH||this.setVertsDirty())},animatable:!1,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){(this._sizeMode=t)!==a.CUSTOM&&this._applySpriteSize()},animatable:!1,type:a,tooltip:!1}},statics:{FillType:t,Type:o,SizeMode:a,State:c},setVisible:function(t){this.enabled=t},setState:function(){},getState:function(){},onEnable:function(){this._super(),this._applySpriteFrame(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},_updateMaterial:function(){var t=this._spriteFrame&&this._spriteFrame.getTexture(),e=this.getMaterial(0);e&&e.setProperty("texture",t),s.prototype._updateMaterial.call(this)},_applyAtlas:!1,_validateRender:function(){var t=this._spriteFrame;this._materials[0]&&t&&t.textureLoaded()||this.disableRender()},_applySpriteSize:function(){var t;this._spriteFrame&&this.isValid&&(a.RAW===this._sizeMode?(t=this._spriteFrame._originalSize,this.node.setContentSize(t)):a.TRIMMED===this._sizeMode&&(t=this._spriteFrame._rect,this.node.setContentSize(t.width,t.height)),this.setVertsDirty())},_applySpriteFrame:function(t){var e=t&&t.getTexture(),t=(e&&!e.loaded&&t.off("load",this._applySpriteSize,this),this._spriteFrame);t?(this._updateMaterial(),e===(e=t.getTexture())&&e&&e.loaded?this._applySpriteSize():(this.disableRender(),t.onTextureLoaded(this._applySpriteSize,this))):this.disableRender()}});cc.Sprite=e.exports=r},{"../CCNode":30,"../utils/blend-func":257,"../utils/misc":264,"./CCRenderComponent":89}],95:[function(t,e,i){"use strict";var n=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),r=cc.Enum({VERTICAL:0,HORIZONTAL:1}),s=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),o=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),n=cc.Class({name:"cc.StudioComponent",extends:cc.Component,editor:!1,properties:!1,statics:{ComponentType:n,ListDirection:r,VerticalAlign:s,HorizontalAlign:o}}),a=t("../utils/prefab-helper"),r=(n.PlaceHolder=cc.Class({name:"cc.StudioComponent.PlaceHolder",extends:cc.Component,properties:{_baseUrl:"",nestedPrefab:cc.Prefab},onLoad:function(){this.nestedPrefab&&this._replaceWithNestedPrefab()},_replaceWithNestedPrefab:function(){var t=this.node,e=t._prefab;e.root=t,e.asset=this.nestedPrefab,a.syncWithPrefab(t)}}),cc.StudioComponent=e.exports=n,cc.Class({name:"cc.StudioWidget",extends:cc.Widget,editor:!1,_validateTargetInDEV:function(){}}));cc.StudioWidget=e.exports=r},{"../utils/prefab-helper":267}],96:[function(t,e,i){"use strict";var n=t("../utils/gray-sprite-state"),n=cc.Class({name:"cc.Toggle",extends:t("./CCButton"),mixins:[n],editor:!1,properties:{_N$isChecked:!0,isChecked:{get:function(){return this._N$isChecked},set:function(t){var e;t!==this._N$isChecked&&((e=this.toggleGroup||this._toggleContainer)&&e.enabled&&this._N$isChecked&&!e.allowSwitchOff||(this._N$isChecked=t,this._updateCheckMark(),e&&e.enabled&&e.updateToggles(this),cc.Toggle._triggerEventInScript_isChecked&&this._emitToggleEvents()))},tooltip:!1},toggleGroup:{default:null,tooltip:!1,type:t("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{_triggerEventInScript_check:!1,_triggerEventInScript_isChecked:!1},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.removeToggle(this)},_hideCheckMark:function(){this._N$isChecked=!1,this._updateCheckMark()},toggle:function(t){this.isChecked=!this.isChecked,cc.Toggle._triggerEventInScript_isChecked||!cc.Toggle._triggerEventInScript_check&&!t||this._emitToggleEvents()},check:function(){this.isChecked=!0,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},uncheck:function(){this.isChecked=!1,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){var t;this._super(),this.enableAutoGrayEffect&&this.checkMark&&(t=!this.interactable,this._switchGrayMaterial(t,this.checkMark))},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)}});cc.Toggle=e.exports=n,t("../platform/js").get(n.prototype,"_toggleContainer",function(){var t=this.node.parent;return cc.Node.isNode(t)?t.getComponent(cc.ToggleContainer):null})},{"../platform/js":209,"../utils/gray-sprite-state":260,"./CCButton":76,"./CCToggleGroup":98}],97:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},checkEvents:{default:[],type:cc.Component.EventHandler}},updateToggles:function(e){this.enabledInHierarchy&&e.isChecked&&(this.toggleItems.forEach(function(t){t!==e&&t.isChecked&&t.enabled&&t._hideCheckMark()}),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,e))},_allowOnlyOneToggleChecked:function(){var e=!1;return this.toggleItems.forEach(function(t){e?t._hideCheckMark():t.isChecked&&(e=!0)}),e},_makeAtLeastOneToggleChecked:function(){var t;this._allowOnlyOneToggleChecked()||this.allowSwitchOff||0<(t=this.toggleItems).length&&t[0].check()},onEnable:function(){this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)},start:function(){this._makeAtLeastOneToggleChecked()}});t("../platform/js").get(n.prototype,"toggleItems",function(){return this.node.getComponentsInChildren(cc.Toggle)}),cc.ToggleContainer=e.exports=n},{"../platform/js":209}],98:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(e){this.enabledInHierarchy&&this._toggleItems.forEach(function(t){e.isChecked&&t!==e&&t.isChecked&&t.enabled&&t._hideCheckMark()})},addToggle:function(t){-1===this._toggleItems.indexOf(t)&&this._toggleItems.push(t),this._allowOnlyOneToggleChecked()},removeToggle:function(t){t=this._toggleItems.indexOf(t);-1<t&&this._toggleItems.splice(t,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var e=!1;return this._toggleItems.forEach(function(t){e&&t.enabled&&t._hideCheckMark(),t.isChecked&&t.enabled&&(e=!0)}),e},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||0<this._toggleItems.length&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}}),t=t("../platform/js"),r=!1;t.get(cc,"ToggleGroup",function(){return r||(cc.errorID(1405,"cc.ToggleGroup","cc.ToggleContainer"),r=!0),n}),e.exports=n},{"../platform/js":209}],99:[function(t,e,i){"use strict";t=cc.Class({name:"cc.ViewGroup",extends:t("./CCComponent")});cc.ViewGroup=e.exports=t},{"./CCComponent":78}],100:[function(h,u,_){"use strict";var t=h("../base-ui/CCWidgetManager"),e=t.AlignMode,i=t._AlignFlags,n=i.TOP,r=i.MID,s=i.BOT,o=i.LEFT,a=i.CENTER,c=i.RIGHT,d=n|s,l=o|c,i=cc.Class({name:"cc.Widget",extends:h("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(t){this._target=t},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return 0<(this._alignFlags&n)},set:function(t){this._setAlign(n,t)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return 0<(this._alignFlags&r)},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=r):this._alignFlags&=~r},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return 0<(this._alignFlags&s)},set:function(t){this._setAlign(s,t)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return 0<(this._alignFlags&o)},set:function(t){this._setAlign(o,t)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return 0<(this._alignFlags&a)},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=a):this._alignFlags&=~a},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return 0<(this._alignFlags&c)},set:function(t){this._setAlign(c,t)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&l)==l},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&d)==d},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:!1},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:!1},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter=t},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter=t},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},alignMode:{default:e.ON_WINDOW_RESIZE,type:e,tooltip:!1},_wasAlignOnce:{default:void 0,formerlySerializedAs:"isAlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},statics:{AlignMode:e},onLoad:function(){void 0!==this._wasAlignOnce&&(this.alignMode=this._wasAlignOnce?e.ONCE:e.ALWAYS,this._wasAlignOnce=void 0)},onEnable:function(){t.add(this)},onDisable:function(){t.remove(this)},_validateTargetInDEV:!1,_setAlign:function(t,e){var i;e!==0<(this._alignFlags&t)&&(i=0<(t&l),e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(i?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t))},updateAlignment:function(){t.updateAlignment(this.node)}});Object.defineProperty(i.prototype,"isAlignOnce",{get:function(){return cc.warn("`widget.isAlignOnce` is deprecated, use `widget.alignMode === cc.Widget.AlignMode.ONCE` instead please."),this.alignMode===e.ONCE},set:function(t){cc.warn("`widget.isAlignOnce` is deprecated, use `widget.alignMode = cc.Widget.AlignMode.*` instead please."),this.alignMode=t?e.ONCE:e.ALWAYS}}),cc.Widget=u.exports=i},{"../base-ui/CCWidgetManager":62,"./CCComponent":78}],101:[function(t,e,i){"use strict";t=t("./CCComponent"),t=cc.Class({name:"cc.WXSubContextView",extends:t,editor:!1,properties:{_fps:60,fps:{get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1/t,this._updateSubContextFrameRate())},tooltip:!1}},ctor:function(){this._sprite=null,this._tex=new cc.Texture2D,this._context=null,this._updatedTime=performance.now(),this._updateInterval=0},onLoad:function(){wx.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._context=wx.getOpenDataContext(),this.reset(),this._tex.setPremultiplyAlpha(!0),this._tex.initWithElement(sharedCanvas),this._sprite=this.node.getComponent(cc.Sprite),this._sprite||(this._sprite=this.node.addComponent(cc.Sprite),this._sprite.srcBlendFactor=cc.macro.BlendFactor.ONE),this._sprite.spriteFrame=new cc.SpriteFrame(this._tex)):this.enabled=!1},reset:function(){var t;this._context&&(this.updateSubContextViewport(),(t=this._context.canvas)&&(t.width=this.node.width,t.height=this.node.height))},onEnable:function(){this._runSubContextMainLoop(),this._registerNodeEvent(),this._updateSubContextFrameRate(),this.updateSubContextViewport()},onDisable:function(){this._unregisterNodeEvent(),this._stopSubContextMainLoop()},update:function(t){if(void 0===t)return this._context&&this._context.postMessage({fromEngine:!0,event:"step"}),void this._updateSubContextTexture();performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},_updateSubContextTexture:function(){this._tex&&this._context&&(this._tex.initWithElement(this._context.canvas),this._sprite._activateMaterial())},updateSubContextViewport:function(){var t,e,i;this._context&&(t=this.node.getBoundingBoxToWorld(),e=cc.view._scaleX,i=cc.view._scaleY,this._context.postMessage({fromEngine:!0,event:"viewport",x:t.x*e+cc.view._viewportRect.x,y:t.y*i+cc.view._viewportRect.y,width:t.width*e,height:t.height*i}))},_registerNodeEvent:function(){this.node.on("position-changed",this.updateSubContextViewport,this),this.node.on("scale-changed",this.updateSubContextViewport,this),this.node.on("size-changed",this.updateSubContextViewport,this)},_unregisterNodeEvent:function(){this.node.off("position-changed",this.updateSubContextViewport,this),this.node.off("scale-changed",this.updateSubContextViewport,this),this.node.off("size-changed",this.updateSubContextViewport,this)},_runSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!0})},_stopSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!1})},_updateSubContextFrameRate:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"frameRate",value:this._fps})}});cc.WXSubContextView=e.exports=t},{"./CCComponent":78}],102:[function(t,e,l){"use strict";var i=t("../../platform/CCMacro"),n=t("../editbox/EditBoxImplBase"),r=t("../CCLabel"),s=t("./types"),o=s.InputMode,a=s.InputFlag,s=s.KeyboardReturnType;var c=cc.Class({name:"cc.EditBox",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._string},set:function(t){t=""+t,0<=this.maxLength&&t.length>=this.maxLength&&(t=t.slice(0,this.maxLength)),this._string=t,this._updateString(t)}},textLabel:{tooltip:!1,default:null,type:r,notify:function(t){this.textLabel&&this.textLabel!==t&&(this._updateTextLabel(),this._updateLabels())}},placeholderLabel:{tooltip:!1,default:null,type:r,notify:function(t){this.placeholderLabel&&this.placeholderLabel!==t&&(this._updatePlaceholderLabel(),this._updateLabels())}},background:{tooltip:!1,default:null,type:cc.Sprite,notify:function(t){this.background&&this.background!==t&&this._updateBackgroundSprite()}},_N$backgroundImage:{default:void 0,type:cc.SpriteFrame},backgroundImage:{get:function(){return this.background?this.background.spriteFrame:null},set:function(t){this.background&&(this.background.spriteFrame=t)}},returnType:{default:s.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:s},_N$returnType:{default:void 0,type:cc.Float},inputFlag:{tooltip:!1,default:a.DEFAULT,type:a,notify:function(){this._updateString(this._string)}},inputMode:{tooltip:!1,default:o.ANY,type:o,notify:function(t){this.inputMode!==t&&(this._updateTextLabel(),this._updatePlaceholderLabel())}},fontSize:{get:function(){return this.textLabel?this.textLabel.fontSize:0},set:function(t){this.textLabel&&(this.textLabel.fontSize=t)}},_N$fontSize:{default:void 0,type:cc.Float},lineHeight:{get:function(){return this.textLabel?this.textLabel.lineHeight:0},set:function(t){this.textLabel&&(this.textLabel.lineHeight=t)}},_N$lineHeight:{default:void 0,type:cc.Float},fontColor:{get:function(){return this.textLabel?this.textLabel.node.color:cc.Color.BLACK},set:function(t){this.textLabel&&(this.textLabel.node.color=t,this.textLabel.node.opacity=t.a)}},_N$fontColor:void 0,placeholder:{tooltip:!1,get:function(){return this.placeholderLabel?this.placeholderLabel.string:""},set:function(t){this.placeholderLabel&&(this.placeholderLabel.string=t)}},_N$placeholder:{default:void 0,type:cc.String},placeholderFontSize:{get:function(){return this.placeholderLabel?this.placeholderLabel.fontSize:0},set:function(t){this.placeholderLabel&&(this.placeholderLabel.fontSize=t)}},_N$placeholderFontSize:{default:void 0,type:cc.Float},placeholderFontColor:{get:function(){return this.placeholderLabel?this.placeholderLabel.node.color:cc.Color.BLACK},set:function(t){this.placeholderLabel&&(this.placeholderLabel.node.color=t,this.placeholderLabel.node.opacity=t.a)}},_N$placeholderFontColor:void 0,maxLength:{tooltip:!1,default:20},_N$maxLength:{default:void 0,type:cc.Float},stayOnTop:{default:!1,notify:function(){cc.warn("editBox.stayOnTop is removed since v2.1.")}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{_ImplClass:n,KeyboardReturnType:s,InputFlag:a,InputMode:o},_init:function(){this._upgradeComp(),this._isLabelVisible=!0,this.node.on(cc.Node.EventType.SIZE_CHANGED,this._syncSize,this),(this._impl=new c._ImplClass).init(this),this._updateString(this._string),this._syncSize()},_updateBackgroundSprite:function(){var t,e=this.background;e||(e=(e=(t=(t=this.node.getChildByName("BACKGROUND_SPRITE"))||new cc.Node("BACKGROUND_SPRITE")).getComponent(cc.Sprite))||t.addComponent(cc.Sprite),t.parent=this.node,this.background=e),e.type=cc.Sprite.Type.SLICED,void 0!==this._N$backgroundImage&&(e.spriteFrame=this._N$backgroundImage,this._N$backgroundImage=void 0)},_updateTextLabel:function(){var t,e=this.textLabel;e||(e=(e=(t=(t=this.node.getChildByName("TEXT_LABEL"))||new cc.Node("TEXT_LABEL")).getComponent(r))||t.addComponent(r),t.parent=this.node,this.textLabel=e),e.node.setAnchorPoint(0,1),e.overflow=r.Overflow.CLAMP,this.inputMode===o.ANY?(e.verticalAlign=i.VerticalTextAlignment.TOP,e.enableWrapText=!0):(e.verticalAlign=i.VerticalTextAlignment.CENTER,e.enableWrapText=!1),e.string=this._updateLabelStringStyle(this._string),void 0!==this._N$fontColor&&(e.node.color=this._N$fontColor,e.node.opacity=this._N$fontColor.a,this._N$fontColor=void 0),void 0!==this._N$fontSize&&(e.fontSize=this._N$fontSize,this._N$fontSize=void 0),void 0!==this._N$lineHeight&&(e.lineHeight=this._N$lineHeight,this._N$lineHeight=void 0)},_updatePlaceholderLabel:function(){var t,e=this.placeholderLabel;e||(e=(e=(t=(t=this.node.getChildByName("PLACEHOLDER_LABEL"))||new cc.Node("PLACEHOLDER_LABEL")).getComponent(r))||t.addComponent(r),t.parent=this.node,this.placeholderLabel=e),e.node.setAnchorPoint(0,1),e.overflow=r.Overflow.CLAMP,this.inputMode===o.ANY?(e.verticalAlign=i.VerticalTextAlignment.TOP,e.enableWrapText=!0):(e.verticalAlign=i.VerticalTextAlignment.CENTER,e.enableWrapText=!1),e.string=this.placeholder,void 0!==this._N$placeholderFontColor&&(e.node.color=this._N$placeholderFontColor,e.node.opacity=this._N$placeholderFontColor.a,this._N$placeholderFontColor=void 0),void 0!==this._N$placeholderFontSize&&(e.fontSize=this._N$placeholderFontSize,this._N$placeholderFontSize=void 0)},_upgradeComp:function(){void 0!==this._N$returnType&&(this.returnType=this._N$returnType,this._N$returnType=void 0),void 0!==this._N$maxLength&&(this.maxLength=this._N$maxLength,this._N$maxLength=void 0),void 0!==this._N$backgroundImage&&this._updateBackgroundSprite(),void 0===this._N$fontColor&&void 0===this._N$fontSize&&void 0===this._N$lineHeight||this._updateTextLabel(),void 0===this._N$placeholderFontColor&&void 0===this._N$placeholderFontSize||this._updatePlaceholderLabel(),void 0!==this._N$placeholder&&(this.placeholder=this._N$placeholder,this._N$placeholder=void 0)},_syncSize:function(){var t;this._impl&&(t=this.node.getContentSize(),this._impl.setSize(t.width,t.height))},_showLabels:function(){this._isLabelVisible=!0,this._updateLabels()},_hideLabels:function(){this._isLabelVisible=!1,this.textLabel&&(this.textLabel.node.active=!1),this.placeholderLabel&&(this.placeholderLabel.node.active=!1)},_updateLabels:function(){var t;this._isLabelVisible&&(t=this._string,this.textLabel&&(this.textLabel.node.active=""!==t),this.placeholderLabel&&(this.placeholderLabel.node.active=""===t))},_updateString:function(t){var e=this.textLabel;e&&(t=(t=t)&&this._updateLabelStringStyle(t),e.string=t,this._updateLabels())},_updateLabelStringStyle:function(t,e){var i=this.inputFlag;if(e||i!==a.PASSWORD)i===a.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===a.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()}):i===a.INITIAL_CAPS_SENTENCE&&(t=(e=t).charAt(0).toUpperCase()+e.slice(1));else{for(var n="",r=t.length,s=0;s<r;++s)n+="â—";t=n}return t},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,cc.Component.EventHandler.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onEnable:function(){this._registerEvent(),this._impl&&this._impl.enable()},onDisable:function(){this._unregisterEvent(),this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&this._impl.clear()},__preload:function(){this._init()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){t.stopPropagation()},_onTouchCancel:function(t){t.stopPropagation()},_onTouchEnded:function(t){this._impl&&this._impl.beginEditing(),t.stopPropagation()},setFocus:function(){cc.errorID(1400,"setFocus()","focus()"),this._impl&&this._impl.setFocus(!0)},focus:function(){this._impl&&this._impl.setFocus(!0)},blur:function(){this._impl&&this._impl.setFocus(!1)},isFocused:function(){return!!this._impl&&this._impl.isFocused()},update:function(){this._impl&&this._impl.update()}});cc.EditBox=e.exports=c,cc.sys.isBrowser&&t("./WebEditBoxImpl")},{"../../platform/CCMacro":194,"../CCLabel":80,"../editbox/EditBoxImplBase":103,"./WebEditBoxImpl":104,"./types":106}],103:[function(t,e,i){"use strict";var n=cc.Class({ctor:function(){this._delegate=null,this._editing=!1},init:function(t){},enable:function(){},disable:function(){this._editing&&this.endEditing()},clear:function(){},update:function(){},setTabIndex:function(t){},setSize:function(t,e){},setFocus:function(t){t?this.beginEditing():this.endEditing()},isFocused:function(){return this._editing},beginEditing:function(){},endEditing:function(){}});e.exports=n},{}],104:[function(t,n,l){"use strict";var _=(e=t("../../value-types/mat4"))&&e.__esModule?e:{default:e};var h=t("../../platform/utils"),u=t("../../platform/CCMacro"),e=t("./types"),a=t("../CCLabel"),r=t("./tabIndexUtil"),t=cc.EditBox,f=cc.js,s=e.InputMode,o=e.InputFlag,p=e.KeyboardReturnType,m={zoomInvalid:!1},y=(cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(m.zoomInvalid=!0),0),d=cc.v3(),c=null,i=!1,g=!1,v=t._ImplClass;function x(){v.call(this),this._domId="EditBoxId_"+ ++y,this._placeholderStyleSheet=null,this._elem=null,this._isTextArea=!1,this._worldMat=new _.default,this._cameraMat=new _.default,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this._cacheViewportRect=cc.rect(0,0,0,0),this._inputMode=null,this._inputFlag=null,this._returnType=null,this._eventListeners={},this._textLabelFont=null,this._textLabelFontSize=null,this._textLabelFontColor=null,this._textLabelAlign=null,this._placeholderLabelFont=null,this._placeholderLabelFontSize=null,this._placeholderLabelFontColor=null,this._placeholderLabelAlign=null,this._placeholderLineHeight=null}f.extend(x,v),t._ImplClass=x,Object.assign(x.prototype,{init:function(t){t&&((this._delegate=t).inputMode===s.ANY?this._createTextArea():this._createInput(),r.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),i=cc.view.isAutoFullScreenEnabled(),g=cc.view._resizeWithBrowserSize)},clear:function(){this._removeEventListeners(),this._removeDomFromGameContainer(),r.remove(this),c===this&&(c=null)},update:function(){},setTabIndex:function(t){this._elem.tabIndex=t,r.resort()},setSize:function(t,e){var i=this._elem;i.style.width=t+"px",i.style.height=e+"px"},beginEditing:function(){c&&c!==this&&c.setFocus(!1),this._editing=!0,(c=this)._delegate.editBoxEditingDidBegan(),this._showDom(),this._elem.focus()},endEditing:function(){this._elem&&this._elem.blur()},_createInput:function(){this._isTextArea=!1,this._elem=document.createElement("input")},_createTextArea:function(){this._isTextArea=!0,this._elem=document.createElement("textarea")},_addDomToGameContainer:function(){cc.game.container.appendChild(this._elem),document.head.appendChild(this._placeholderStyleSheet)},_removeDomFromGameContainer:function(){h.contains(cc.game.container,this._elem)&&cc.game.container.removeChild(this._elem),h.contains(document.head,this._placeholderStyleSheet)&&document.head.removeChild(this._placeholderStyleSheet),delete this._elem,delete this._placeholderStyleSheet},_showDom:function(){this._updateMatrix(),this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._elem.style.display="",this._delegate._hideLabels(),cc.sys.isMobile&&this._showDomOnMobile()},_hideDom:function(){this._elem.style.display="none",this._delegate._showLabels(),cc.sys.isMobile&&this._hideDomOnMobile()},_showDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(i&&(cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()),g&&cc.view.resizeWithBrowserSize(!1),this._adjustWindowScroll())},_hideDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(g&&cc.view.resizeWithBrowserSize(!0),setTimeout(function(){c||i&&cc.view.enableAutoFullScreen(!0)},800)),this._scrollBackWindow()},_adjustWindowScroll:function(){var t=this;setTimeout(function(){window.scrollY<100&&t._elem.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})},800)},_scrollBackWindow:function(){setTimeout(function(){var t=cc.sys;t.browserType!==t.BROWSER_TYPE_WECHAT||t.os!==t.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)},800)},_updateMatrix:function(){var t,e,i,h,u,n,r,s,o=this._delegate.node,a=(o.getWorldMatrix(this._worldMat),this._worldMat),c=a.m,l=cc.view;this._m00===c[0]&&this._m01===c[1]&&this._m04===c[4]&&this._m05===c[5]&&this._m12===c[12]&&this._m13===c[13]&&this._w===o._contentSize.width&&this._h===o._contentSize.height&&this._cacheViewportRect.equals(l._viewportRect)||(this._m00=c[0],this._m01=c[1],this._m04=c[4],this._m05=c[5],this._m12=c[12],this._m13=c[13],this._w=o._contentSize.width,this._h=o._contentSize.height,this._cacheViewportRect.set(l._viewportRect),c=l._scaleX,t=l._scaleY,r=l._viewportRect,l=l._devicePixelRatio,d.x=-o._anchorPoint.x*this._w,d.y=-o._anchorPoint.y*this._h,_.default.transform(a,a,d),cc.Camera.findCamera(o).getWorldToScreenMatrix2D(this._cameraMat),e=this._cameraMat,_.default.mul(e,e,a),c/=l,t/=l,a=cc.game.container,i=(e=e.m)[0]*c,h=e[1],u=e[4],n=e[5]*t,s=a&&a.style.paddingLeft&&parseInt(a.style.paddingLeft),s+=r.x/l,a=a&&a.style.paddingBottom&&parseInt(a.style.paddingBottom),a+=r.y/l,r=e[12]*c+s,l=e[13]*t+a,m.zoomInvalid&&(this.setSize(o.width*i,o.height*n),n=i=1),(c=this._elem).style.transform=s="matrix("+i+","+-h+","+-u+","+n+","+r+","+-l+")",c.style["-webkit-transform"]=s,c.style["transform-origin"]="0px 100% 0px",c.style["-webkit-transform-origin"]="0px 100% 0px")},_updateInputType:function(){var t,e=this._delegate,i=e.inputMode,n=e.inputFlag,e=e.returnType,r=this._elem;if(this._inputMode!==i||this._inputFlag!==n||this._returnType!==e){if(this._inputMode=i,this._inputFlag=n,this._returnType=e,this._isTextArea)return t="none",n===o.INITIAL_CAPS_ALL_CHARACTERS?t="uppercase":n===o.INITIAL_CAPS_WORD&&(t="capitalize"),void(r.style.textTransform=t);n!==o.PASSWORD?(t=r.type,i===s.EMAIL_ADDR?t="email":i===s.NUMERIC||i===s.DECIMAL?t="number":i===s.PHONE_NUMBER?(t="number",r.pattern="[0-9]*"):i===s.URL?t="url":(t="text",e===p.SEARCH&&(t="search")),r.type=t,i="none",n===o.INITIAL_CAPS_ALL_CHARACTERS?i="uppercase":n===o.INITIAL_CAPS_WORD&&(i="capitalize"),r.style.textTransform=i):r.type="password"}},_updateMaxLength:function(){var t=this._delegate.maxLength;this._elem.maxLength=t=t<0?65535:t},_initStyleSheet:function(){var t=this._elem;t.style.display="none",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.textTransform="uppercase",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflow_y="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")},_updateStyleSheet:function(){var t=this._delegate,e=this._elem;e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel)},_updateTextLabel:function(t){if(t){var e=!(e=t.font)||e instanceof cc.BitmapFont?t.fontFamily:e._fontFamily,i=t.fontSize*t.node.scaleY;if(this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign){this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign;var n=this._elem;switch(n.style.fontSize=i+"px",n.style.color=t.node.color.toCSS(),n.style.fontFamily=e,t.horizontalAlign){case a.HorizontalAlign.LEFT:n.style.textAlign="left";break;case a.HorizontalAlign.CENTER:n.style.textAlign="center";break;case a.HorizontalAlign.RIGHT:n.style.textAlign="right"}}}},_updatePlaceholderLabel:function(t){if(t){var e=!(e=t.font)||e instanceof cc.BitmapFont?t.fontFamily:t.font._fontFamily,i=t.fontSize*t.node.scaleY;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var n,r=this._placeholderStyleSheet,s=t.node.color.toCSS(),o=t.fontSize;switch(t.horizontalAlign){case a.HorizontalAlign.LEFT:n="left";break;case a.HorizontalAlign.CENTER:n="center";break;case a.HorizontalAlign.RIGHT:n="right"}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder,#"+this._domId+"::-moz-placeholder,#"+this._domId+":-ms-input-placeholder{text-transform: initial; font-family: "+e+"; font-size: "+i+"px; color: "+s+"; line-height: "+o+"px; text-align: "+n+";}",cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},_registerEventListeners:function(){var e=this,i=this._elem,t=!1,n=this._eventListeners;n.compositionStart=function(){t=!0},n.compositionEnd=function(){t=!1,e._delegate.editBoxTextChanged(i.value)},n.onInput=function(){t||e._delegate.editBoxTextChanged(i.value)},n.onClick=function(t){e._editing&&cc.sys.isMobile&&e._adjustWindowScroll()},n.onKeydown=function(t){t.keyCode===u.KEY.enter?(t.stopPropagation(),e._delegate.editBoxEditingReturn(),e._isTextArea||i.blur()):t.keyCode===u.KEY.tab&&(t.stopPropagation(),t.preventDefault(),r.next(e))},n.onBlur=function(){e._editing=!1,c=null,e._hideDom(),e._delegate.editBoxEditingDidEnded()},n.onResize=function(){e._updateMatrix()},i.addEventListener("compositionstart",n.compositionStart),i.addEventListener("compositionend",n.compositionEnd),i.addEventListener("input",n.onInput),i.addEventListener("keydown",n.onKeydown),i.addEventListener("blur",n.onBlur),i.addEventListener("touchstart",n.onClick),window.addEventListener("resize",n.onResize),window.addEventListener("orientationchange",n.onResize)},_removeEventListeners:function(){var t=this._elem,e=this._eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),window.removeEventListener("resize",e.onResize),window.removeEventListener("orientationchange",e.onResize),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null,e.onResize=null}})},{"../../platform/CCMacro":194,"../../platform/utils":213,"../../value-types/mat4":281,"../CCLabel":80,"./tabIndexUtil":105,"./types":106}],105:[function(t,e,i){"use strict";e.exports={_tabIndexList:[],add:function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},remove:function(t){var e=this._tabIndexList,t=e.indexOf(t);-1!==t&&e.splice(t,1)},resort:function(){this._tabIndexList.sort(function(t,e){return t._delegate._tabIndex-e._delegate._tabIndex})},next:function(t){var e=this._tabIndexList,i=e.indexOf(t);t.setFocus(!1),-1===i||(t=e[i+1])&&0<=t._delegate._tabIndex&&t.setFocus(!0)}}},{}],106:[function(t,e,i){"use strict";var n=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5}),r=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),s=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});e.exports={KeyboardReturnType:n,InputMode:r,InputFlag:s}},{}],107:[function(t,e,i){"use strict";t("./CCComponent"),t("./CCComponentEventHandler"),t("./missing-script");var n=t("./WXSubContextView"),r=t("./SwanSubContextView"),n=n||cc.Class({name:"cc.WXSubContextView",extends:cc.Component}),r=r||cc.Class({name:"cc.SwanSubContextView",extends:cc.Component}),t=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./editbox/CCEditBox"),t("./CCLabelOutline"),t("./CCLabelShadow"),t("./CCRichText"),t("./CCToggleContainer"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents"),t("./CCMotionStreak"),n,r];e.exports=t},{"./CCAnimation":73,"./CCAudioSource":74,"./CCBlockInputEvents":75,"./CCButton":76,"./CCCanvas":77,"./CCComponent":78,"./CCComponentEventHandler":79,"./CCLabel":80,"./CCLabelOutline":81,"./CCLabelShadow":82,"./CCLayout":83,"./CCMask":84,"./CCMotionStreak":85,"./CCPageView":86,"./CCPageViewIndicator":87,"./CCProgressBar":88,"./CCRichText":90,"./CCScrollBar":91,"./CCScrollView":92,"./CCSlider":93,"./CCSprite":94,"./CCToggle":96,"./CCToggleContainer":97,"./CCToggleGroup":98,"./CCWidget":100,"./SwanSubContextView":void 0,"./WXSubContextView":101,"./editbox/CCEditBox":102,"./missing-script":108}],108:[function(t,e,i){"use strict";var n=cc.js,r=t("../utils/misc").BUILTIN_CLASSID_RE,s=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),o=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){var i=n._getClassById(t);return i||(t?(cc.deserialize.reportMissingClass(t),o.getMissingWrapper(t,e)):null)},getMissingWrapper:function(t,e){return e.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||r.test(t))?o:s}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=e.exports=o},{"../utils/misc":264}],109:[function(t,e,i){"use strict";function n(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0}function r(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null}function s(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t}function o(t,e,i){cc.Event.call(this,cc.Event.KEYBOARD,i),this.keyCode=t,this.isPressed=e}var a=cc.js,t=(t("../event/event"),a.extend(n,cc.Event),n.prototype);t.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},t.getScrollX=function(){return this._scrollX},t.getScrollY=function(){return this._scrollY},t.setLocation=function(t,e){this._x=t,this._y=e},t.getLocation=function(){return cc.v2(this._x,this._y)},t.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y)},t._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e},t.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY)},t.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY)},t.getDeltaX=function(){return this._x-this._prevX},t.getDeltaY=function(){return this._y-this._prevY},t.setButton=function(t){this._button=t},t.getButton=function(){return this._button},t.getLocationX=function(){return this._x},t.getLocationY=function(){return this._y},n.NONE=0,n.DOWN=1,n.UP=2,n.MOVE=3,n.SCROLL=4,n.BUTTON_LEFT=0,n.BUTTON_RIGHT=2,n.BUTTON_MIDDLE=1,n.BUTTON_4=3,n.BUTTON_5=4,n.BUTTON_6=5,n.BUTTON_7=6,n.BUTTON_8=7,a.extend(r,cc.Event),(t=r.prototype).getEventCode=function(){return this._eventCode},t.getTouches=function(){return this._touches},t._setEventCode=function(t){this._eventCode=t},t._setTouches=function(t){this._touches=t},t.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},t.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},t.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},t.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},t.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},t.getID=function(){return this.touch?this.touch.getID():null},t.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},t.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},t.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},t.getLocationX=function(){return this.touch?this.touch.getLocationX():0},t.getLocationY=function(){return this.touch?this.touch.getLocationY():0},r.MAX_TOUCHES=5,r.BEGAN=0,r.MOVED=1,r.ENDED=2,r.CANCELED=3,a.extend(s,cc.Event);a.extend(o,cc.Event),cc.Event.EventMouse=n,cc.Event.EventTouch=r,cc.Event.EventAcceleration=s,cc.Event.EventKeyboard=o,e.exports=cc.Event},{"../event/event":116}],110:[function(t,e,n){"use strict";function r(t,e){this._onCustomEvent=e,cc.EventListener.call(this,cc.EventListener.CUSTOM,t,this._callback)}function s(){cc.EventListener.call(this,cc.EventListener.MOUSE,i.MOUSE,this._callback)}function o(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,i.TOUCH_ONE_BY_ONE,null),this._claimedTouches=[]}function a(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,i.TOUCH_ALL_AT_ONCE,null)}function c(t){this._onAccelerationEvent=t,cc.EventListener.call(this,cc.EventListener.ACCELERATION,i.ACCELERATION,this._callback)}function l(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,i.KEYBOARD,this._callback)}var t=t("../platform/js"),i=(cc.EventListener=function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}},cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"});t.extend(r,cc.EventListener),t.mixin(r.prototype,{_onCustomEvent:null,_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new r(this._listenerID,this._onCustomEvent)}}),t.extend(s,cc.EventListener),t.mixin(s.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new s;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),t.extend(o,cc.EventListener),t.mixin(o.prototype,{constructor:o,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new o;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}}),t.extend(a,cc.EventListener),t.mixin(a.prototype,{constructor:a,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var t=new a;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}}),t.extend(c,cc.EventListener),t.mixin(c.prototype,{constructor:c,_onAccelerationEvent:null,_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new c(this._onAccelerationEvent)}});t.extend(l,cc.EventListener),t.mixin(l.prototype,{constructor:l,onKeyPressed:null,onKeyReleased:null,_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new l;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var e,i=t.event,n=(delete t.event,null);for(e in i===cc.EventListener.TOUCH_ONE_BY_ONE?n=new o:i===cc.EventListener.TOUCH_ALL_AT_ONCE?n=new a:i===cc.EventListener.MOUSE?n=new s:i===cc.EventListener.CUSTOM?(n=new r(t.eventName,t.callback),delete t.eventName,delete t.callback):i===cc.EventListener.KEYBOARD?n=new l:i===cc.EventListener.ACCELERATION&&(n=new c(t.callback),delete t.callback),t)n[e]=t[e];return n},e.exports=cc.EventListener},{"../platform/js":209}],111:[function(t,e,i){"use strict";function n(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0}var r=t("../platform/js"),h=(t("./CCEventListener"),cc.EventListener.ListenerID),l={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:!(n.prototype={constructor:n,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){(0===t._getFixedPriority()?this._sceneGraphListeners:this._fixedListeners).push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),_currentTouch:null,_currentTouchListener:null,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){var e=this._nodeListenersMap[t._id];if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var r=e[i]._getListenerID();null==this._dirtyListeners[r]&&(this._dirtyListeners[r]=!0)}if(0<t.childrenCount)for(var s=t._children,o=0,a=s.length;o<a;o++)this._setDirtyForNode(s[o])},pauseTarget:function(t,e){if(t instanceof cc._BaseNode){var i=this._nodeListenersMap[t._id];if(i)for(r=0,s=i.length;r<s;r++)i[r]._setPaused(!0);if(!0===e)for(var n=t._children,r=0,s=n?n.length:0;r<s;r++)this.pauseTarget(n[r],!0)}else cc.warnID(3506)},resumeTarget:function(t,e){if(t instanceof cc._BaseNode){var i=this._nodeListenersMap[t._id];if(i)for(r=0,s=i.length;r<s;r++)i[r]._setPaused(!1);if(this._setDirtyForNode(t),!0===e)for(var n=t._children,r=0,s=n?n.length:0;r<s;r++)this.resumeTarget(n[r],!0)}else cc.warnID(3506)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];i||(i=new n,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()?(this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY),null===(i=t._getSceneGraphPriority())&&cc.logID(3507),this._associateNodeAndEventListener(i,t),i.activeInHierarchy&&this.resumeTarget(i)):this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){for(var t in this._dirtyListeners)this._setDirty(t,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={}},_removeAllListenersInVector:function(t){if(t)for(var e,i=t.length-1;0<=i;i--)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(t,i)},_removeListenersForListenerID:function(t){for(var e,i,n,r=this._listenersMap[t],s=(r&&(e=r.getFixedPriorityListeners(),i=r.getSceneGraphPriorityListeners(),this._removeAllListenersInVector(i),this._removeAllListenersInVector(e),delete this._priorityDirtyFlagMap[t],this._inDispatch||(r.clear(),delete this._listenersMap[t])),this._toAddedListeners),o=s.length-1;0<=o;o--)(n=s[o])&&n._getListenerID()===t&&cc.js.array.removeAt(s,o)},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;(e=i[t]?i[t]:e)!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY&&cc.director.getScene()&&this._sortListenersOfSceneGraphPriority(t))},_sortListenersOfSceneGraphPriority:function(t){var e,t=this._getListeners(t);!t||(e=t.getSceneGraphPriorityListeners())&&0!==e.length&&t.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=t._getSceneGraphPriority(),n=e._getSceneGraphPriority();if(!(e&&n&&n._activeInHierarchy&&null!==n._parent))return-1;if(!t||!i||!i._activeInHierarchy||null===i._parent)return 1;for(var r=i,s=n,o=!1;r._parent._id!==s._parent._id;)r=null===r._parent._parent?(o=!0,n):r._parent,s=null===s._parent._parent?(o=!0,i):s._parent;if(r._id===s._id){if(r._id===n._id)return-1;if(r._id===i._id)return 1}return o?r._localZOrder-s._localZOrder:s._localZOrder-r._localZOrder},_sortListenersOfFixedPriority:function(t){t=this._listenersMap[t];if(t){var e=t.getFixedPriorityListeners();if(e&&0!==e.length){e.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,n=e.length;i<n&&!(0<=e[i]._getFixedPriority());)++i;t.gt0Index=i}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,i,n,r=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),o=this._toRemovedListeners;if(s)for(e=s.length-1;0<=e;e--)(i=s[e])._isRegistered()||(cc.js.array.removeAt(s,e),-1!==(n=o.indexOf(i))&&o.splice(n,1));if(r)for(e=r.length-1;0<=e;e--)(i=r[e])._isRegistered()||(cc.js.array.removeAt(r,e),-1!==(n=o.indexOf(i))&&o.splice(n,1));s&&0===s.length&&t.clearSceneGraphListeners(),r&&0===r.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t,e=this._listenersMap,i=this._priorityDirtyFlagMap;for(t in e)e[t].empty()&&(delete i[t],delete e[t]);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,s=n.length;r<s;r++)this._forceAddEventListener(n[r]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){var e=this._inDispatch;if(cc.assertID(0<e,3508),!(1<e)){var i=this._listenersMap[h.TOUCH_ONE_BY_ONE],n=(i&&this._onUpdateListeners(i),(i=this._listenersMap[h.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(i),cc.assertID(1===e,3509),this._toAddedListeners);if(0!==n.length){for(var r=0,s=n.length;r<s;r++)this._forceAddEventListener(n[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i,n,r=t[e],s=this._listenersMap[r._getListenerID()];s&&(n=s.getFixedPriorityListeners(),(s=s.getSceneGraphPriorityListeners())&&-1!==(i=s.indexOf(r))&&s.splice(i,1),n&&-1!==(i=n.indexOf(r))&&n.splice(i,1))}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered())return!1;var i,n=e.event,r=n.currentTouch,s=(n.currentTarget=t._node,!1),o=n.getEventCode(),a=cc.Event.EventTouch;if(o===a.BEGAN){if(!cc.macro.ENABLE_MULTI_TOUCH&&l._currentTouch){var c=l._currentTouchListener._node;if(c&&c.activeInHierarchy)return!1}t.onTouchBegan&&(s=t.onTouchBegan(r,n))&&t._registered&&(t._claimedTouches.push(r),l._currentTouchListener=t,l._currentTouch=r)}else if(0<t._claimedTouches.length&&-1!==(i=t._claimedTouches.indexOf(r))){if(s=!0,!cc.macro.ENABLE_MULTI_TOUCH&&l._currentTouch&&l._currentTouch!==r)return!1;o===a.MOVED&&t.onTouchMoved?t.onTouchMoved(r,n):o===a.ENDED?(t.onTouchEnded&&t.onTouchEnded(r,n),t._registered&&t._claimedTouches.splice(i,1),l._clearCurTouch()):o===a.CANCELED&&(t.onTouchCancelled&&t.onTouchCancelled(r,n),t._registered&&t._claimedTouches.splice(i,1),l._clearCurTouch())}return n.isStopped()?(l._updateTouchListeners(n),!0):!(!s||!t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(r,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(h.TOUCH_ONE_BY_ONE),this._sortEventListeners(h.TOUCH_ALL_AT_ONCE);var e=this._getListeners(h.TOUCH_ONE_BY_ONE),i=this._getListeners(h.TOUCH_ALL_AT_ONCE);if(null!==e||null!==i){var n=t.getTouches(),r=cc.js.array.copy(n),s={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var o=0;o<n.length;o++)t.currentTouch=n[o],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,s);i&&0<r.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,n=e.event,e=e.touches,r=n.getEventCode();return n.currentTarget=t._node,r===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(e,n):r===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(e,n):r===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(e,n):r===i.CANCELED&&t.onTouchesCancelled&&t.onTouchesCancelled(e,n),!!n.isStopped()&&(l._updateTouchListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i||(this._nodeListenersMap[t._id]=i=[]),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t._id])},_dispatchEventToListeners:function(t,e,i){var n,r,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(o&&0!==o.length)for(;c<t.gt0Index;++c)if((r=o[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(a&&!s)for(n=0;n<a.length;n++)if((r=a[n]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(o&&!s)for(;c<o.length;++c)if((r=o[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_sortNumberAsc:function(t,e){return t-e},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,e){t=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(t,1),t},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(e in i){var n,r=i[e],s=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();if((n=this._removeListenerInVector(o,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(n=this._removeListenerInVector(s,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[e]),n)break}if(!n)for(var a=this._toAddedListeners,c=a.length-1;0<=c;c--){var l=a[c];if(l===t){cc.js.array.removeAt(a,c),l._setRegistered(!1);break}}this._currentTouchListener===t&&this._clearCurTouch()}},_clearCurTouch:function(){this._currentTouchListener=null,this._currentTouch=null},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=t.length-1;0<=i;i--){var n=t[i];if(n._onCustomEvent===e||n._onEvent===e)return n._setRegistered(!1),null!=n._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(n._getSceneGraphPriority(),n),n._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(n),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=t.length-1;0<=i;i--){var n=t[i];if(n===e)return n._setRegistered(!1),null!=n._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(n._getSceneGraphPriority(),n),n._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(n),!0}return!1},removeListeners:function(t,e){var i=this;if(cc.js.isNumber(t)||t instanceof cc._BaseNode)if(void 0!==t._id){var n,r=i._nodeListenersMap[t._id];if(r){var s=cc.js.array.copy(r);for(n=0;n<s.length;n++)i.removeListener(s[n]);delete i._nodeListenersMap[t._id]}var o=i._toAddedListeners;for(n=0;n<o.length;){var a=o[n];a._getSceneGraphPriority()===t?(a._setSceneGraphPriority(null),a._setRegistered(!1),o.splice(n,1)):++n}if(!0===e){var c,l=t.children;for(n=0,c=l.length;n<c;n++)i.removeListeners(l[n],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(h.TOUCH_ONE_BY_ONE):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(h.TOUCH_ALL_AT_ONCE):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(h.MOUSE):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(h.ACCELERATION):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(h.KEYBOARD):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t,e=this._listenersMap,i=this._internalCustomListenerIDs;for(t in e)-1===i.indexOf(t)&&this._removeListenersForListenerID(t)},setPriority:function(t,e){if(null!=t){var i,n=this._listenersMap;for(i in n){var r=n[i].getFixedPriorityListeners();if(r)if(-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType){if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;e=t,i=cc.Event;var e=(e=e.type)===i.ACCELERATION?h.ACCELERATION:e===i.KEYBOARD?h.KEYBOARD:e.startsWith(i.MOUSE)?h.MOUSE:(e.startsWith(i.TOUCH)&&cc.logID(2e3),""),i=(this._sortEventListeners(e),this._listenersMap[e]);null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}else cc.errorID(3511)},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){t=new cc.Event.EventCustom(t);t.setUserData(e),this.dispatchEvent(t)}};r.get(cc,"eventManager",function(){return cc.errorID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),l}),e.exports=cc.internal.eventManager=l},{"../platform/js":209,"./CCEventListener":110}],112:[function(t,e,i){"use strict";cc.Touch=function(t,e,i){this._lastModified=0,this.setTouchInfo(i,t,e)},cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y)},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y)},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y)},getDelta:function(){return this._point.sub(this._prevPoint)},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y)},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y)},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y)},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.v2(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.v2(t.x,t.y):cc.v2(t||0,e||0)}}},{}],113:[function(t,e,i){"use strict";t("./CCEvent"),t("./CCTouch"),t("./CCEventListener");t=t("./CCEventManager");e.exports=t},{"./CCEvent":109,"./CCEventListener":110,"./CCEventManager":111,"./CCTouch":112}],114:[function(t,e,i){"use strict";var n=cc.js,r=t("../platform/callbacks-invoker");function s(){r.call(this)}n.extend(s,r),s.prototype.emit=function(t,e){var i=t.type,i=this._callbackTable[i];if(i){for(var n=!i.isInvoking,r=(i.isInvoking=!0,i.callbackInfos),s=0,o=r.length;s<o;++s){var a=r[s];if(a&&a.callback&&(a.callback.call(a.target,t,e),t._propagationImmediateStopped))break}n&&(i.isInvoking=!1,i.containCanceled&&i.purgeCanceled())}},e.exports=s},{"../platform/callbacks-invoker":202}],115:[function(t,e,i){"use strict";var n=t("../platform/js"),r=t("../platform/callbacks-invoker"),o=n.array.fastRemove;function s(){r.call(this)}n.extend(s,r);t=s.prototype;t.__on=t.on,t.on=function(t,e,i,n){if(e)return this.hasEventListener(t,e,i)||(this.__on(t,e,i,n),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800)},t.__off=t.off,t.off=function(t,e,i){if(e)this.__off(t,e,i),i&&i.__eventTargets&&o(i.__eventTargets,this);else{e=this._callbackTable[t];if(e){for(var n=e.callbackInfos,r=0;r<n.length;++r){var s=n[r]&&n[r].target;s&&s.__eventTargets&&o(s.__eventTargets,this)}this.removeAll(t)}}},t.targetOff=function(t){this.removeAll(t),t&&t.__eventTargets&&o(t.__eventTargets,this)},t.once=function(t,e,i){this.on(t,e,i,!0)},t.dispatchEvent=function(t){this.emit(t.type,t)},cc.EventTarget=e.exports=s},{"../platform/callbacks-invoker":202,"../platform/js":209}],116:[function(t,e,i){"use strict";function n(t,e){cc.Event.call(this,t,e),this.detail=null}var t=t("../platform/js"),r=(cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3,t.extend(n,cc.Event),(n.prototype.reset=n).prototype.setUserData=function(t){this.detail=t},n.prototype.getUserData=function(){return this.detail},n.prototype.getEventName=cc.Event.prototype.getType,new t.Pool(10));n.put=function(t){r.put(t)},n.get=function(t,e){var i=r._get();return i?i.reset(t,e):i=new n(t,e),i},cc.Event.EventCustom=n,e.exports=cc.Event},{"../platform/js":209}],117:[function(t,e,i){"use strict";t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event")},{"./event":116,"./event-listeners":114,"./event-target":115,"./system-event":118}],118:[function(t,e,i){"use strict";var n=t("../event/event-target"),r=t("../event-manager"),s=t("../platform/CCInputManager"),o=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),a=null,c=null,t=cc.Class({name:"SystemEvent",extends:n,statics:{EventType:o},setAccelerometerEnabled:function(t){t&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(t){console.log("Device Motion Event request permission: "+t),s.setAccelerometerEnabled("granted"===t)}):s.setAccelerometerEnabled(t)},setAccelerometerInterval:function(t){s.setAccelerometerInterval(t)},on:function(t,e,i,n){this._super(t,e,i,n),t!==o.KEY_DOWN&&t!==o.KEY_UP||(a=a||cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=o.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=o.KEY_UP,cc.systemEvent.dispatchEvent(e)}}),r.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||r.addListener(a,1)),t===o.DEVICEMOTION&&(c=c||cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=o.DEVICEMOTION,cc.systemEvent.dispatchEvent(e)}}),r.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||r.addListener(c,1))},off:function(t,e,i){this._super(t,e,i),!a||t!==o.KEY_DOWN&&t!==o.KEY_UP||(e=this.hasEventListener(o.KEY_DOWN),i=this.hasEventListener(o.KEY_UP),e||i||r.removeListener(a)),c&&t===o.DEVICEMOTION&&r.removeListener(c)}});cc.SystemEvent=e.exports=t,cc.systemEvent=new cc.SystemEvent},{"../event-manager":113,"../event/event-target":115,"../platform/CCInputManager":193}],119:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=r(t("../value-types/vec3")),n=r(t("../value-types/mat3")),o=r(t("./enums"));function r(t){return t&&t.__esModule?t:{default:t}}var s=new a.default,h=new a.default,c=new n.default;function l(t,e,i,n,r,s){this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=o.default.SHAPE_AABB,this.center=new a.default(t,e,i),this.halfExtents=new a.default(n,r,s)}l.create=function(t,e,i,n,r,s){return new l(t,e,i,n,r,s)},l.clone=function(t){return new l(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},l.copy=function(t,e){return a.default.copy(t.center,e.center),a.default.copy(t.halfExtents,e.halfExtents),t},l.fromPoints=function(t,e,i){return a.default.scale(t.center,a.default.add(s,e,i),.5),a.default.scale(t.halfExtents,a.default.sub(h,i,e),.5),t},l.set=function(t,e,i,n,r,s,o){return a.default.set(t.center,e,i,n),a.default.set(t.halfExtents,r,s,o),t},(t=l.prototype).getBoundary=function(t,e){a.default.sub(t,this.center,this.halfExtents),a.default.add(e,this.center,this.halfExtents)},t.transform=function(t,e,i,n,r){var s,o;a.default.transformMat4((r=r||this).center,this.center,t),r=r.halfExtents,s=this.halfExtents,t=t,o=c.m,t=t.m,o[0]=Math.abs(t[0]),o[1]=Math.abs(t[1]),o[2]=Math.abs(t[2]),o[3]=Math.abs(t[4]),o[4]=Math.abs(t[5]),o[5]=Math.abs(t[6]),o[6]=Math.abs(t[8]),o[7]=Math.abs(t[9]),o[8]=Math.abs(t[10]),a.default.transformMat3(r,s,c)},i.default=l,e.exports=i.default},{"../value-types/mat3":280,"../value-types/vec3":289,"./enums":121}],120:[function(e,i,t){"use strict";t.__esModule=!0,t.point_plane=s,t.pt_point_plane=function(t,e,i){var n=s(e,i);return o.Vec3.subtract(t,e,o.Vec3.multiplyScalar(t,i.n,n))},t.pt_point_aabb=function(t,e,i){return o.Vec3.copy(t,e),o.Vec3.subtract(n,i.center,i.halfExtents),o.Vec3.add(r,i.center,i.halfExtents),t.x=(t.x<n.x?n:t).x,t.y=(t.y<n.x?n:t).y,t.z=(t.z<n.x?n:t).z,t.x=(t.x>r.x?r:t).x,t.y=(t.y>r.x?r:t).y,t.z=(t.z>r.x?r:t).z,t},t.pt_point_obb=function(t,e,i){var n=i.orientation.m;o.Vec3.set(a,n[0],n[1],n[2]),o.Vec3.set(c,n[3],n[4],n[5]),o.Vec3.set(l,n[6],n[7],n[8]),u[0]=a,u[1]=c,u[2]=l,_[0]=i.halfExtents.x,_[1]=i.halfExtents.y,_[2]=i.halfExtents.z,o.Vec3.subtract(h,e,i.center),o.Vec3.set(t,i.center.x,i.center.y,i.center.z);for(var r=0;r<3;r++){var s=o.Vec3.dot(h,u[r]);(s=s>_[r]?_[r]:s)<-_[r]&&(s=-_[r]),t.x+=s*u[r].x,t.y+=s*u[r].y,t.z+=s*u[r].z}return t};var o=e("../value-types"),a=new o.Vec3,c=new o.Vec3,l=new o.Vec3,h=new o.Vec3,n=new o.Vec3,r=new o.Vec3,u=new Array(3),_=new Array(3);function s(t,e){return o.Vec3.dot(e.n,t)-e.d}},{"../value-types":279}],121:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;i.default={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256},e.exports=i.default},{}],122:[function(t,s,e){"use strict";e.__esModule=!0,e.frustum=void 0;var o=t("../value-types"),a=i(t("./enums")),c=i(t("./plane"));function i(t){return t&&t.__esModule?t:{default:t}}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _,n,l,h=new Array(8),t=(h[0]=new o.Vec3(1,1,1),h[1]=new o.Vec3(-1,1,1),h[2]=new o.Vec3(-1,-1,1),h[3]=new o.Vec3(1,-1,1),h[4]=new o.Vec3(1,1,-1),h[5]=new o.Vec3(-1,1,-1),h[6]=new o.Vec3(-1,-1,-1),h[7]=new o.Vec3(1,-1,-1),r.create=function(){return new r},r.clone=function(t){return r.copy(new r,t)},r.copy=function(t,e){t._type=e._type;for(var i=0;i<6;++i)c.default.copy(t.planes[i],e.planes[i]);for(var n=0;n<8;++n)o.Vec3.copy(t.vertices[n],e.vertices[n]);return t},t=r,(n=[{key:"accurate",set:function(t){this._type=t?a.default.SHAPE_FRUSTUM_ACCURATE:a.default.SHAPE_FRUSTUM}}])&&u(t.prototype,n),_&&u(t,_),(n=r.prototype).update=function(t,e){t=t.m;if(o.Vec3.set(this.planes[0].n,t[3]+t[0],t[7]+t[4],t[11]+t[8]),this.planes[0].d=-(t[15]+t[12]),o.Vec3.set(this.planes[1].n,t[3]-t[0],t[7]-t[4],t[11]-t[8]),this.planes[1].d=-(t[15]-t[12]),o.Vec3.set(this.planes[2].n,t[3]+t[1],t[7]+t[5],t[11]+t[9]),this.planes[2].d=-(t[15]+t[13]),o.Vec3.set(this.planes[3].n,t[3]-t[1],t[7]-t[5],t[11]-t[9]),this.planes[3].d=-(t[15]-t[13]),o.Vec3.set(this.planes[4].n,t[3]+t[2],t[7]+t[6],t[11]+t[10]),this.planes[4].d=-(t[15]+t[14]),o.Vec3.set(this.planes[5].n,t[3]-t[2],t[7]-t[6],t[11]-t[10]),this.planes[5].d=-(t[15]-t[14]),this._type===a.default.SHAPE_FRUSTUM_ACCURATE){for(var i=0;i<6;i++){var n=this.planes[i],r=1/n.n.length();o.Vec3.multiplyScalar(n.n,n.n,r),n.d*=r}for(var s=0;s<8;s++)o.Vec3.transformMat4(this.vertices[s],h[s],e)}},n.transform=function(t){if(this._type===a.default.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)o.Vec3.transformMat4(this.vertices[e],this.vertices[e],t);c.default.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),c.default.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),c.default.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),c.default.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),c.default.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),c.default.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},r);function r(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=a.default.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=c.default.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new o.Vec3}(e.frustum=t).createOrtho=(l=new o.Vec3,function(t,e,i,n,r,s){e/=2,i/=2;o.Vec3.set(l,e,i,n),o.Vec3.transformMat4(t.vertices[0],l,s),o.Vec3.set(l,-e,i,n),o.Vec3.transformMat4(t.vertices[1],l,s),o.Vec3.set(l,-e,-i,n),o.Vec3.transformMat4(t.vertices[2],l,s),o.Vec3.set(l,e,-i,n),o.Vec3.transformMat4(t.vertices[3],l,s),o.Vec3.set(l,e,i,r),o.Vec3.transformMat4(t.vertices[4],l,s),o.Vec3.set(l,-e,i,r),o.Vec3.transformMat4(t.vertices[5],l,s),o.Vec3.set(l,-e,-i,r),o.Vec3.transformMat4(t.vertices[6],l,s),o.Vec3.set(l,e,-i,r),o.Vec3.transformMat4(t.vertices[7],l,s),c.default.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),c.default.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),c.default.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),c.default.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),c.default.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),c.default.fromPoints(t.planes[0],t.vertices[7],t.vertices[5],t.vertices[6])})},{"../value-types":279,"./enums":121,"./plane":127}],123:[function(t,e,i){"use strict";var n={enums:i.__esModule=!0,Triangle:!0,Aabb:!0,Ray:!0,intersect:!0,Sphere:!0,Obb:!0,Frustum:!0,Line:!0,Plane:!0},r=(i.Plane=i.Line=i.Frustum=i.Obb=i.Sphere=i.intersect=i.Ray=i.Aabb=i.Triangle=i.enums=void 0,o(t("./enums"))),r=(i.enums=r.default,o(t("./triangle"))),r=(i.Triangle=r.default,o(t("./aabb"))),r=(i.Aabb=r.default,o(t("./ray"))),r=(i.Ray=r.default,o(t("./intersect"))),r=(i.intersect=r.default,o(t("./sphere"))),r=(i.Sphere=r.default,o(t("./obb"))),r=(i.Obb=r.default,o(t("./frustum"))),r=(i.Frustum=r.default,o(t("./line"))),r=(i.Line=r.default,o(t("./plane"))),s=(i.Plane=r.default,t("./distance"));function o(t){return t&&t.__esModule?t:{default:t}}Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||(i[t]=s[t]))}),cc.geomUtils=e.exports},{"./aabb":119,"./distance":120,"./enums":121,"./frustum":122,"./intersect":124,"./line":125,"./obb":126,"./plane":127,"./ray":128,"./sphere":129,"./triangle":130}],124:[function(t,l,h){"use strict";h.__esModule=!0,h.default=void 0;var u,_,d=n(t("../../renderer/gfx")),e=n(t("../../renderer/memop/recycle-pool")),p=t("../value-types"),f=n(t("./aabb")),m=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=g();if(e&&e.has(t))return e.get(t);var i,n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in t){var s;Object.prototype.hasOwnProperty.call(t,i)&&((s=r?Object.getOwnPropertyDescriptor(t,i):null)&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=t[i])}return n.default=t,e&&e.set(t,n),n}(t("./distance")),i=n(t("./enums")),y=n(t("./ray")),t=n(t("./triangle"));function g(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return g=function(){return t},t}function n(t){return t&&t.__esModule?t:{default:t}}function v(t,e,i,n){p.Vec3.set(t,e[i*n],e[i*n+1],e[i*n+2])}u=t.default.create(),_=1/0;function x(t,e){_=1/0;for(var i=e._subMeshes,n=0;n<i.length;n++)if(i[n]._primitiveType===d.default.PT_TRIANGLES)for(var r=e._subDatas[n]||e._subDatas[0],s=e._getAttrMeshData(n,d.default.ATTR_POSITION),o=r.getIData(Uint16Array),a=r.vfm.element(d.default.ATTR_POSITION).num,c=0;c<o.length;c+=3){v(u.a,s,o[c],a),v(u.b,s,o[c+1],a),v(u.c,s,o[c+2],a);var l=xt(t,u);0<l&&l<_&&(_=l)}return _}var b,A,C,S,T,o,w,E,M;function I(t,e){return t.distance-e.distance}function B(t,e,i){var i=i.m,n=e.x,r=e.y,e=e.z,s=(s=i[3]*n+i[7]*r+i[11]*e)?1/s:1;return t.x=(i[0]*n+i[4]*r+i[8]*e)*s,t.y=(i[1]*n+i[5]*r+i[9]*e)*s,t.z=(i[2]*n+i[6]*r+i[10]*e)*s,t}function R(t){return 0<t&&t<1/0}b=new e.default(function(){return{distance:0,node:null}},1),A=[],C=f.default.create(),S=new p.Vec3,T=new p.Vec3,o=new y.default,w=cc.mat4(),E=cc.mat4(),M=new p.Vec3;function P(t,n,r,s){return b.reset(),A.length=0,function t(e,i){for(var n=e.children,r=n.length-1;0<=r;r--)t(n[r],i);i(e)}(t=t||cc.director.getScene(),function(t){var e,i;s&&!s(t)||(p.Mat4.invert(E,t.getWorldMatrix(w)),p.Vec3.transformMat4(o.o,n.o,E),p.Vec3.normalize(o.d,B(o.d,n.d,E)),e=1/0,(i=t._renderComponent)instanceof cc.MeshRenderer?e=bt(o,i._boundingBox):t.width&&t.height&&(p.Vec3.set(S,-t.width*t.anchorX,-t.height*t.anchorY,t.z),p.Vec3.set(T,t.width*(1-t.anchorX),t.height*(1-t.anchorY),t.z),f.default.fromPoints(C,S,T),e=bt(o,C)),R(e)&&R(e=r?r(o,t,e):e)&&(p.Vec3.scale(M,o.d,e),B(M,M,w),(i=b.add()).node=t,i.distance=p.Vec3.mag(M),A.push(i)))}),A.sort(I),A}function D(t,e){var i=p.Vec3.dot(t.d,e.n);return Math.abs(i)<Number.EPSILON?0:(p.Vec3.multiplyScalar(G,e.n,e.d),(t=p.Vec3.dot(p.Vec3.subtract(G,G,t.o),e.n)/i)<0?0:t)}function L(t,e){return p.Vec3.subtract(z,t.e,t.s),(t=(e.d-p.Vec3.dot(t.s,e.n))/p.Vec3.dot(z,e.n))<0||1<t?0:t}G=new p.Vec3(0,0,0),z=new p.Vec3(0,0,0);function V(t,e,i){p.Vec3.subtract(Y,e.b,e.a),p.Vec3.subtract(q,e.c,e.a),p.Vec3.subtract(J,t.s,t.e),p.Vec3.cross(K,Y,q);var n=p.Vec3.dot(J,K);if(n<=0)return 0;if(p.Vec3.subtract(Z,t.s,e.a),(t=p.Vec3.dot(Z,K))<0||n<t)return 0;if(p.Vec3.cross(Q,J,Z),(t=p.Vec3.dot(q,Q))<0||n<t)return 0;var r=-p.Vec3.dot(Y,Q);return r<0||n<t+r?0:(i&&(n=1-(t*=n=1/n)-(r*=n),p.Vec3.set(i,e.a.x*n+e.b.x*t+e.c.x*r,e.a.y*n+e.b.y*t+e.c.y*r,e.a.z*n+e.b.z*t+e.c.z*r)),1)}function O(t,e,i,n,r,s,o){if(p.Vec3.subtract($,e,t),p.Vec3.subtract(tt,i,t),p.Vec3.subtract(et,n,t),p.Vec3.subtract(it,r,t),p.Vec3.cross(rt,it,$),0<=(e=p.Vec3.dot(tt,rt))){var a=-p.Vec3.dot(et,rt);if(a<0)return 0;var c=p.Vec3.dot(p.Vec3.cross(st,$,et),tt);if(c<0)return 0;o&&p.Vec3.set(o,i.x*(a*=l=1/(a+e+c))+n.x*(e*=l)+r.x*(c*=l),i.y*a+n.y*e+r.y*c,i.z*a+n.z*e+r.z*c)}else{p.Vec3.subtract(nt,s,t);var l=p.Vec3.dot(nt,rt);if(l<0)return 0;a=p.Vec3.dot(p.Vec3.cross(st,$,tt),nt);if(a<0)return 0;o&&(n=1/(l+(e=-e)+a),p.Vec3.set(o,i.x*(l*=n)+s.x*(e*=n)+r.x*(a*=n),i.y*l+s.y*e+r.y*a,i.z*l+s.z*e+r.z*a))}return 1}function F(t,e){var i=e.radius,e=e.center,n=t.o,t=t.d,i=i*i,e=(p.Vec3.subtract(ot,e,n),ot.lengthSqr()),n=p.Vec3.dot(ot,t);return(t=i-(e-n*n))<0?0:(t=Math.sqrt(t),(e=e<i?n+t:n-t)<0?0:e)}function N(t,e){r[0]=e.halfExtents.x,r[1]=e.halfExtents.y,r[2]=e.halfExtents.z,lt=e.center,ht=t.o,ut=t.d,t=e.orientation.m,p.Vec3.set(_t,t[0],t[1],t[2]),p.Vec3.set(dt,t[3],t[4],t[5]),p.Vec3.set(ft,t[6],t[7],t[8]),p.Vec3.subtract(pt,lt,ht),s[0]=p.Vec3.dot(_t,ut),s[1]=p.Vec3.dot(dt,ut),s[2]=p.Vec3.dot(ft,ut),a[0]=p.Vec3.dot(_t,pt),a[1]=p.Vec3.dot(dt,pt),a[2]=p.Vec3.dot(ft,pt);for(var i=0;i<3;++i){if(0===s[i]){if(0<-a[i]-r[i]||-a[i]+r[i]<0)return 0;s[i]=1e-7}c[2*i+0]=(a[i]+r[i])/s[i],c[2*i+1]=(a[i]-r[i])/s[i]}return e=Math.max(Math.max(Math.min(c[0],c[1]),Math.min(c[2],c[3])),Math.min(c[4],c[5])),(t=Math.min(Math.min(Math.max(c[0],c[1]),Math.max(c[2],c[3])),Math.max(c[4],c[5])))<0||t<e||e<0?0:e}function k(t,e){return p.Vec3.subtract(mt,t.center,t.halfExtents),p.Vec3.add(yt,t.center,t.halfExtents),p.Vec3.subtract(gt,e.center,e.halfExtents),p.Vec3.add(vt,e.center,e.halfExtents),mt.x<=vt.x&&yt.x>=gt.x&&mt.y<=vt.y&&yt.y>=gt.y&&mt.z<=vt.z&&yt.z>=gt.z}U=new p.Vec3(0,0,0),W=new p.Vec3(0,0,0),H=new p.Vec3(0,0,0),j=new p.Vec3(0,0,0),X=new p.Vec3(0,0,0);var G,z,U,W,H,j,X,Y,q,J,Z,K,Q,$,tt,et,it,nt,rt,st,ot,at,ct,lt,ht,ut,_t,dt,ft,pt,r,s,a,c,mt,yt,gt,vt,xt=function(t,e,i){p.Vec3.subtract(U,e.b,e.a),p.Vec3.subtract(W,e.c,e.a),p.Vec3.cross(H,t.d,W);var n=p.Vec3.dot(U,H);if(n<Number.EPSILON&&(!i||n>-Number.EPSILON))return 0;i=1/n,p.Vec3.subtract(j,t.o,e.a),n=p.Vec3.dot(j,H)*i;if(n<0||1<n)return 0;p.Vec3.cross(X,j,U);e=p.Vec3.dot(t.d,X)*i;if(e<0||1<n+e)return 0;t=p.Vec3.dot(W,X)*i;return t<0?0:t},t=xt,bt=(Y=new p.Vec3(0,0,0),q=new p.Vec3(0,0,0),J=new p.Vec3(0,0,0),Z=new p.Vec3(0,0,0),K=new p.Vec3(0,0,0),Q=new p.Vec3(0,0,0),$=new p.Vec3(0,0,0),tt=new p.Vec3(0,0,0),et=new p.Vec3(0,0,0),it=new p.Vec3(0,0,0),nt=new p.Vec3(0,0,0),rt=new p.Vec3(0,0,0),st=new p.Vec3(0,0,0),ot=new p.Vec3(0,0,0),at=new p.Vec3,ct=new p.Vec3,function(t,e){var i=t.o,t=t.d,n=1/t.x,r=1/t.y,t=1/t.z,e=(p.Vec3.subtract(at,e.center,e.halfExtents),p.Vec3.add(ct,e.center,e.halfExtents),(at.x-i.x)*n),n=(ct.x-i.x)*n,s=(at.y-i.y)*r,r=(ct.y-i.y)*r,o=(at.z-i.z)*t,i=(ct.z-i.z)*t,t=Math.max(Math.max(Math.min(e,n),Math.min(s,r)),Math.min(o,i)),e=Math.min(Math.min(Math.max(e,n),Math.max(s,r)),Math.max(o,i));return e<0||e<t?0:t}),e=bt;new p.Vec3,new p.Vec3,new p.Vec3,_t=new p.Vec3,dt=new p.Vec3,ft=new p.Vec3,pt=new p.Vec3,r=new Array(3),s=new Array(3),a=new Array(3),c=new Array(6),mt=new p.Vec3,yt=new p.Vec3,gt=new p.Vec3,vt=new p.Vec3;function At(t,e,i,n,r,s){p.Vec3.set(s[0],t.x+i.x*e.x+n.x*e.y+r.x*e.z,t.y+i.y*e.x+n.y*e.y+r.y*e.z,t.z+i.z*e.x+n.z*e.y+r.z*e.z),p.Vec3.set(s[1],t.x-i.x*e.x+n.x*e.y+r.x*e.z,t.y-i.y*e.x+n.y*e.y+r.y*e.z,t.z-i.z*e.x+n.z*e.y+r.z*e.z),p.Vec3.set(s[2],t.x+i.x*e.x-n.x*e.y+r.x*e.z,t.y+i.y*e.x-n.y*e.y+r.y*e.z,t.z+i.z*e.x-n.z*e.y+r.z*e.z),p.Vec3.set(s[3],t.x+i.x*e.x+n.x*e.y-r.x*e.z,t.y+i.y*e.x+n.y*e.y-r.y*e.z,t.z+i.z*e.x+n.z*e.y-r.z*e.z),p.Vec3.set(s[4],t.x-i.x*e.x-n.x*e.y-r.x*e.z,t.y-i.y*e.x-n.y*e.y-r.y*e.z,t.z-i.z*e.x-n.z*e.y-r.z*e.z),p.Vec3.set(s[5],t.x+i.x*e.x-n.x*e.y-r.x*e.z,t.y+i.y*e.x-n.y*e.y-r.y*e.z,t.z+i.z*e.x-n.z*e.y-r.z*e.z),p.Vec3.set(s[6],t.x-i.x*e.x+n.x*e.y-r.x*e.z,t.y-i.y*e.x+n.y*e.y-r.y*e.z,t.z-i.z*e.x+n.z*e.y-r.z*e.z),p.Vec3.set(s[7],t.x-i.x*e.x-n.x*e.y+r.x*e.z,t.y-i.y*e.x-n.y*e.y+r.y*e.z,t.z-i.z*e.x-n.z*e.y+r.z*e.z)}function Ct(t,e){for(var i=s=p.Vec3.dot(e,t[0]),n=1;n<8;++n)var r=p.Vec3.dot(e,t[n]),s=r<s?r:s,i=i<r?r:i;return[s,i]}function St(t,e){var i=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z);return(t=p.Vec3.dot(e.n,t.center))+i<e.d?-1:t-i>e.d?0:1}function Tt(t,e){for(var i=0;i<e.planes.length;i++)if(-1===St(t,e.planes[i]))return 0;return 1}function wt(t,e){return p.Vec3.subtract(Et,e,t.center),p.Vec3.transformMat3(Et,Et,p.Mat3.transpose(Mt,t.orientation)),e=Et,t=t.halfExtents,Math.abs(e.x)<t.x&&Math.abs(e.y)<t.y&&Math.abs(e.z)<t.z}var Et,Mt,y=function(){for(var c=new Array(15),t=0;t<15;t++)c[t]=new p.Vec3(0,0,0);for(var l=new Array(8),h=new Array(8),e=0;e<8;e++)l[e]=new p.Vec3(0,0,0),h[e]=new p.Vec3(0,0,0);var u=new p.Vec3,_=new p.Vec3;return function(t,e){var i=e.orientation.m;p.Vec3.set(c[0],1,0,0),p.Vec3.set(c[1],0,1,0),p.Vec3.set(c[2],0,0,1),p.Vec3.set(c[3],i[0],i[1],i[2]),p.Vec3.set(c[4],i[3],i[4],i[5]),p.Vec3.set(c[5],i[6],i[7],i[8]);for(var n,r=0;r<3;++r)p.Vec3.cross(c[6+3*r],c[r],c[0]),p.Vec3.cross(c[6+3*r+1],c[r],c[1]),p.Vec3.cross(c[6+3*r+1],c[r],c[2]);p.Vec3.subtract(u,t.center,t.halfExtents),p.Vec3.add(_,t.center,t.halfExtents),i=u,t=_,n=l,p.Vec3.set(n[0],i.x,t.y,t.z),p.Vec3.set(n[1],i.x,t.y,i.z),p.Vec3.set(n[2],i.x,i.y,t.z),p.Vec3.set(n[3],i.x,i.y,i.z),p.Vec3.set(n[4],t.x,t.y,t.z),p.Vec3.set(n[5],t.x,t.y,i.z),p.Vec3.set(n[6],t.x,i.y,t.z),p.Vec3.set(n[7],t.x,i.y,i.z),At(e.center,e.halfExtents,c[3],c[4],c[5],h);for(var s=0;s<15;++s){var o=Ct(l,c[s]),a=Ct(h,c[s]);if(a[0]>o[1]||o[0]>a[1])return 0}return 1}}(),It=function(){for(var l=new Array(8),h=0,u=0,t=0;t<l.length;t++)l[t]=new p.Vec3(0,0,0);return function(t,e){for(var i,n=!1,r=0;r<e.planes.length;r++){if(-1===(i=St(t,e.planes[r])))return 0;1===i&&(n=!0)}if(!n)return 1;for(var s=0;s<e.vertices.length;s++)p.Vec3.subtract(l[s],e.vertices[s],t.center);for(var o=u=h=0;o<e.vertices.length;o++)l[o].x>t.halfExtents.x?h++:l[o].x<-t.halfExtents.x&&u++;if(h===e.vertices.length||u===e.vertices.length)return 0;for(var a=u=h=0;a<e.vertices.length;a++)l[a].y>t.halfExtents.y?h++:l[a].y<-t.halfExtents.y&&u++;if(h===e.vertices.length||u===e.vertices.length)return 0;for(var c=u=h=0;c<e.vertices.length;c++)l[c].z>t.halfExtents.z?h++:l[c].z<-t.halfExtents.z&&u++;return h===e.vertices.length||u===e.vertices.length?0:1}}(),Bt=(Et=new p.Vec3(0,0,0),Mt=new p.Mat3,function(t,e){var i=t.orientation.m,i=t.halfExtents.x*Rt(e.n,i[0],i[1],i[2])+t.halfExtents.y*Rt(e.n,i[3],i[4],i[5])+t.halfExtents.z*Rt(e.n,i[6],i[7],i[8]),t=p.Vec3.dot(e.n,t.center);return t+i<e.d?-1:t-i>e.d?0:1});function Rt(t,e,i,n){return Math.abs(t.x*e+t.y*i+t.z*n)}function Pt(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Bt(t,e.planes[i]))return 0;return 1}function Dt(t,e){var i=p.Vec3.dot(e.n,t.center),t=t.radius*e.n.length();return i+t<e.d?-1:i-t>e.d?0:1}function Lt(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Dt(t,e.planes[i]))return 0;return 1}function Vt(t,e){for(var i=0;i<6;i++){var n=e.planes[i],r=t.radius,s=t.center,o=n.n,n=n.d,a=p.Vec3.dot(o,s);if(a+r<n)return 0;if(!(n<a-r)){p.Vec3.add(kt,s,p.Vec3.multiplyScalar(kt,o,r));for(var c=0;c<6;c++)if(c!==i&&c!==i+Gt[i]){var l=e.planes[c];if(p.Vec3.dot(l.n,kt)<l.d)return 0}}}return 1}function Ot(t,e){var i=t.radius+e.radius;return p.Vec3.squaredDistance(t.center,e.center)<i*i}function Ft(t,e){return m.pt_point_aabb(zt,t.center,e),p.Vec3.squaredDistance(t.center,zt)<t.radius*t.radius}function Nt(t,e){return m.pt_point_obb(Ut,t.center,e),p.Vec3.squaredDistance(t.center,Ut)<t.radius*t.radius}var kt,Gt,zt,Ut,Wt=function(){for(var h=new Array(8),u=0,_=0,d=0,t=0;t<h.length;t++)h[t]=new p.Vec3(0,0,0);function f(t,e,i,n){return t.x*e+t.y*i+t.z*n}return function(t,e){for(var i,n=!1,r=0;r<e.planes.length;r++){if(-1===(i=Bt(t,e.planes[r])))return 0;1===i&&(n=!0)}if(!n)return 1;for(var s=0;s<e.vertices.length;s++)p.Vec3.subtract(h[s],e.vertices[s],t.center);d=_=0;for(var o=t.orientation.m,a=0;a<e.vertices.length;a++)(u=f(h[a],o[0],o[1],o[2]))>t.halfExtents.x?_++:u<-t.halfExtents.x&&d++;if(_===e.vertices.length||d===e.vertices.length)return 0;for(var c=d=_=0;c<e.vertices.length;c++)(u=f(h[c],o[3],o[4],o[5]))>t.halfExtents.y?_++:u<-t.halfExtents.y&&d++;if(_===e.vertices.length||d===e.vertices.length)return 0;for(var l=d=_=0;l<e.vertices.length;l++)(u=f(h[l],o[6],o[7],o[8]))>t.halfExtents.z?_++:u<-t.halfExtents.z&&d++;return _===e.vertices.length||d===e.vertices.length?0:1}}(),Ht=function(){for(var c=new Array(15),t=0;t<15;t++)c[t]=new p.Vec3(0,0,0);for(var l=new Array(8),h=new Array(8),e=0;e<8;e++)l[e]=new p.Vec3(0,0,0),h[e]=new p.Vec3(0,0,0);return function(t,e){var i=t.orientation.m,n=e.orientation.m;p.Vec3.set(c[0],i[0],i[1],i[2]),p.Vec3.set(c[1],i[3],i[4],i[5]),p.Vec3.set(c[2],i[6],i[7],i[8]),p.Vec3.set(c[3],n[0],n[1],n[2]),p.Vec3.set(c[4],n[3],n[4],n[5]),p.Vec3.set(c[5],n[6],n[7],n[8]);for(var r=0;r<3;++r)p.Vec3.cross(c[6+3*r],c[r],c[0]),p.Vec3.cross(c[6+3*r+1],c[r],c[1]),p.Vec3.cross(c[6+3*r+1],c[r],c[2]);At(t.center,t.halfExtents,c[0],c[1],c[2],l),At(e.center,e.halfExtents,c[3],c[4],c[5],h);for(var s=0;s<15;++s){var o=Ct(l,c[s]),a=Ct(h,c[s]);if(a[0]>o[1]||o[0]>a[1])return 0}return 1}}(),e=(kt=new p.Vec3(0,0,0),Gt=[1,-1,1,-1,1,-1],zt=new p.Vec3,Ut=new p.Vec3,{rayAabb:e,rayMesh:x,raycast:P,rayTriangle:t,ray_sphere:F,ray_aabb:bt,ray_obb:N,ray_plane:D,ray_triangle:xt,line_plane:L,line_triangle:V,line_quad:O,sphere_sphere:Ot,sphere_aabb:Ft,sphere_obb:Nt,sphere_plane:Dt,sphere_frustum:Lt,sphere_frustum_accurate:Vt,aabb_aabb:k,aabb_obb:y,aabb_plane:St,aabb_frustum:Tt,aabb_frustum_accurate:It,obb_obb:Ht,obb_plane:Bt,obb_frustum:Pt,obb_frustum_accurate:Wt,obb_point:wt,resolve:function(t,e,i){void 0===i&&(i=null);var n=t._type,r=e._type,s=this[n|r];return n<r?s(t,e,i):s(e,t,i)}});e[i.default.SHAPE_RAY|i.default.SHAPE_SPHERE]=F,e[i.default.SHAPE_RAY|i.default.SHAPE_AABB]=bt,e[i.default.SHAPE_RAY|i.default.SHAPE_OBB]=N,e[i.default.SHAPE_RAY|i.default.SHAPE_PLANE]=D,e[i.default.SHAPE_RAY|i.default.SHAPE_TRIANGLE]=xt,e[i.default.SHAPE_LINE|i.default.SHAPE_PLANE]=L,e[i.default.SHAPE_LINE|i.default.SHAPE_TRIANGLE]=V,e[i.default.SHAPE_SPHERE]=Ot,e[i.default.SHAPE_SPHERE|i.default.SHAPE_AABB]=Ft,e[i.default.SHAPE_SPHERE|i.default.SHAPE_OBB]=Nt,e[i.default.SHAPE_SPHERE|i.default.SHAPE_PLANE]=Dt,e[i.default.SHAPE_SPHERE|i.default.SHAPE_FRUSTUM]=Lt,e[i.default.SHAPE_SPHERE|i.default.SHAPE_FRUSTUM_ACCURATE]=Vt,e[i.default.SHAPE_AABB]=k,e[i.default.SHAPE_AABB|i.default.SHAPE_OBB]=y,e[i.default.SHAPE_AABB|i.default.SHAPE_PLANE]=St,e[i.default.SHAPE_AABB|i.default.SHAPE_FRUSTUM]=Tt,e[i.default.SHAPE_AABB|i.default.SHAPE_FRUSTUM_ACCURATE]=It,e[i.default.SHAPE_OBB]=Ht,e[i.default.SHAPE_OBB|i.default.SHAPE_PLANE]=Bt,e[i.default.SHAPE_OBB|i.default.SHAPE_FRUSTUM]=Pt,e[i.default.SHAPE_OBB|i.default.SHAPE_FRUSTUM_ACCURATE]=Wt,h.default=e,l.exports=h.default},{"../../renderer/gfx":312,"../../renderer/memop/recycle-pool":327,"../value-types":279,"./aabb":119,"./distance":120,"./enums":121,"./ray":128,"./triangle":130}],125:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=t("../value-types"),a=(t=t("./enums"))&&t.__esModule?t:{default:t};function c(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=a.default.SHAPE_LINE,this.s=new o.Vec3(t,e,i),this.e=new o.Vec3(n,r,s)}c.create=function(t,e,i,n,r,s){return new c(t,e,i,n,r,s)},c.clone=function(t){return new c(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},c.copy=function(t,e){return o.Vec3.copy(t.s,e.s),o.Vec3.copy(t.e,e.e),t},c.fromPoints=function(t,e,i){return o.Vec3.copy(t.s,e),o.Vec3.copy(t.e,i),t},c.set=function(t,e,i,n,r,s,o){return t.s.x=e,t.s.y=i,t.s.z=n,t.e.x=r,t.e.y=s,t.e.z=o,t},c.len=function(t){return o.Vec3.distance(t.s,t.e)},c.prototype.length=function(){return o.Vec3.distance(this.s,this.e)},i.default=c,e.exports=i.default},{"../value-types":279,"./enums":121}],126:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var m=t("../value-types"),y=(t=t("./enums"))&&t.__esModule?t:{default:t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r,s,o=new m.Vec3,c=new m.Vec3,a=new m.Mat3,t=(p.create=function(t,e,i,n,r,s,o,a,c,l,h,u,_,d,f){return new p(t,e,i,n,r,s,o,a,c,l,h,u,_,d,f)},p.clone=function(t){var e=t.orientation.m;return new p(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},p.copy=function(t,e){return m.Vec3.copy(t.center,e.center),m.Vec3.copy(t.halfExtents,e.halfExtents),m.Mat3.copy(t.orientation,e.orientation),t},p.fromPoints=function(t,e,i){return m.Vec3.multiplyScalar(t.center,m.Vec3.add(o,e,i),.5),m.Vec3.multiplyScalar(t.halfExtents,m.Vec3.subtract(c,i,e),.5),m.Mat3.identity(t.orientation),t},p.set=function(t,e,i,n,r,s,o,a,c,l,h,u,_,d,f,p){return m.Vec3.set(t.center,e,i,n),m.Vec3.set(t.halfExtents,r,s,o),m.Mat3.set(t.orientation,a,c,l,h,u,_,d,f,p),t},t=p,(s=[{key:"type",get:function(){return this._type}}])&&n(t.prototype,s),r&&n(t,r),(s=p.prototype).getBoundary=function(t,e){var i,n,r,s;i=o,n=this.halfExtents,r=this.orientation,s=a.m,r=r.m,s[0]=Math.abs(r[0]),s[1]=Math.abs(r[1]),s[2]=Math.abs(r[2]),s[3]=Math.abs(r[3]),s[4]=Math.abs(r[4]),s[5]=Math.abs(r[5]),s[6]=Math.abs(r[6]),s[7]=Math.abs(r[7]),s[8]=Math.abs(r[8]),m.Vec3.transformMat3(i,n,a),m.Vec3.subtract(t,this.center,o),m.Vec3.add(e,this.center,o)},s.transform=function(t,e,i,n,r){m.Vec3.transformMat4(r.center,this.center,t),m.Mat3.fromQuat(r.orientation,i),m.Vec3.multiply(r.halfExtents,this.halfExtents,n)},s.translateAndRotate=function(t,e,i){m.Vec3.transformMat4(i.center,this.center,t),m.Mat3.fromQuat(i.orientation,e)},s.setScale=function(t,e){m.Vec3.multiply(e.halfExtents,this.halfExtents,t)},p);function p(t,e,i,n,r,s,o,a,c,l,h,u,_,d,f){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===s&&(s=1),void 0===o&&(o=1),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=y.default.SHAPE_OBB,this.center=new m.Vec3(t,e,i),this.halfExtents=new m.Vec3(n,r,s),this.orientation=new m.Mat3(o,a,c,l,h,u,_,d,f)}i.default=t,e.exports=i.default},{"../value-types":279,"./enums":121}],127:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("../value-types"),s=(t=t("./enums"))&&t.__esModule?t:{default:t};var o=new r.Vec3(0,0,0),a=new r.Vec3(0,0,0),n=cc.mat4(),c=cc.v4();function l(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=s.default.SHAPE_PLANE,this.n=new r.Vec3(t,e,i),this.d=n}l.create=function(t,e,i,n){return new l(t,e,i,n)},l.clone=function(t){return new l(t.n.x,t.n.y,t.n.z,t.d)},l.copy=function(t,e){return r.Vec3.copy(t.n,e.n),t.d=e.d,t},l.fromPoints=function(t,e,i,n){return r.Vec3.subtract(o,i,e),r.Vec3.subtract(a,n,e),r.Vec3.normalize(t.n,r.Vec3.cross(t.n,o,a)),t.d=r.Vec3.dot(t.n,e),t},l.set=function(t,e,i,n,r){return t.n.x=e,t.n.y=i,t.n.z=n,t.d=r,t},l.fromNormalAndPoint=function(t,e,i){return r.Vec3.copy(t.n,e),t.d=r.Vec3.dot(e,i),t},l.normalize=function(t,e){var i=e.n.len();return r.Vec3.normalize(t.n,e.n),0<i&&(t.d=e.d/i),t},l.prototype.transform=function(t){r.Mat4.invert(n,t),r.Mat4.transpose(n,n),r.Vec4.set(c,this.n.x,this.n.y,this.n.z,this.d),r.Vec4.transformMat4(c,c,n),r.Vec3.set(this.n,c.x,c.y,c.z),this.d=c.w},i.default=l,e.exports=i.default},{"../value-types":279,"./enums":121}],128:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=t("../value-types"),a=(t=t("./enums"))&&t.__esModule?t:{default:t};function c(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=a.default.SHAPE_RAY,this.o=new o.Vec3(t,e,i),this.d=new o.Vec3(n,r,s)}c.create=function(t,e,i,n,r,s){return new c(t=void 0===t?0:t,e=void 0===e?0:e,i=void 0===i?0:i,n=void 0===n?0:n,r=void 0===r?0:r,s=void 0===s?1:s)},c.clone=function(t){return new c(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},c.copy=function(t,e){return o.Vec3.copy(t.o,e.o),o.Vec3.copy(t.d,e.d),t},c.fromPoints=function(t,e,i){return o.Vec3.copy(t.o,e),o.Vec3.normalize(t.d,o.Vec3.subtract(t.d,i,e)),t},c.set=function(t,e,i,n,r,s,o){return t.o.x=e,t.o.y=i,t.o.z=n,t.d.x=r,t.d.y=s,t.d.z=o,t},c.prototype.computeHit=function(t,e){o.Vec3.normalize(t,this.d),o.Vec3.scaleAndAdd(t,this.o,t,e)},i.default=c,e.exports=i.default},{"../value-types":279,"./enums":121}],129:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=t("../value-types"),r=(t=t("./enums"))&&t.__esModule?t:{default:t};var n=new s.Vec3;function o(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.center=void 0,this.radius=void 0,this._type=void 0,this._type=r.default.SHAPE_SPHERE,this.center=new s.Vec3(t,e,i),this.radius=n}o.create=function(t,e,i,n){return new o(t,e,i,n)},o.clone=function(t){return new o(t.center.x,t.center.y,t.center.z,t.radius)},o.copy=function(t,e){return s.Vec3.copy(t.center,e.center),t.radius=e.radius,t},o.fromPoints=function(t,e,i){return s.Vec3.multiplyScalar(t.center,s.Vec3.add(n,e,i),.5),t.radius=.5*s.Vec3.subtract(n,i,e).len(),t},o.set=function(t,e,i,n,r){return t.center.x=e,t.center.y=i,t.center.z=n,t.radius=r,t},(t=o.prototype).clone=function(){return o.clone(this)},t.copy=function(t){return o.copy(this,t)},t.getBoundary=function(t,e){s.Vec3.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),s.Vec3.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(t,e,i,n,r){s.Vec3.transformMat4(r.center,this.center,t),r.radius=this.radius*n.maxAxis()},t.translateAndRotate=function(t,e,i){s.Vec3.transformMat4(i.center,this.center,t)},t.setScale=function(t,e){e.radius=this.radius*t.maxAxis()},i.default=o,e.exports=i.default},{"../value-types":279,"./enums":121}],130:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var l=n(t("../value-types/vec3")),h=n(t("./enums"));function n(t){return t&&t.__esModule?t:{default:t}}function u(t,e,i,n,r,s,o,a,c){this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this.a=new l.default(t,e,i),this.b=new l.default(n,r,s),this.c=new l.default(o,a,c),this._type=h.default.SHAPE_TRIANGLE}u.create=function(t,e,i,n,r,s,o,a,c){return new u(t,e,i,n,r,s,o,a,c)},u.clone=function(t){return new u(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},u.copy=function(t,e){return l.default.copy(t.a,e.a),l.default.copy(t.b,e.b),l.default.copy(t.c,e.c),t},u.fromPoints=function(t,e,i,n){return l.default.copy(t.a,e),l.default.copy(t.b,i),l.default.copy(t.c,n),t},u.set=function(t,e,i,n,r,s,o,a,c,l){return t.a.x=e,t.a.y=i,t.a.z=n,t.b.x=r,t.b.y=s,t.b.z=o,t.c.x=a,t.c.y=c,t.c.z=l,t},i.default=u,e.exports=i.default},{"../value-types/vec3":289,"./enums":121}],131:[function(t,e,i){"use strict";var n=t("../components/CCRenderComponent"),r=t("../assets/material/CCMaterial"),s=t("./types"),o=s.LineCap,a=s.LineJoin,c=cc.Class({name:"cc.Graphics",extends:n,editor:!1,ctor:function(){this._impl=new c._Impl(this)},properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:a.MITER,_lineCap:o.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._impl.lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this._impl.lineJoin=t},type:a},lineCap:{get:function(){return this._lineCap},set:function(t){this._lineCap=t,this._impl.lineCap=t},type:o},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._impl.strokeColor=this._strokeColor=cc.color(t)}},fillColor:{get:function(){return this._fillColor},set:function(t){this._impl.fillColor=this._fillColor=cc.color(t)}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._miterLimit=t,this._impl.miterLimit=t}}},statics:{LineJoin:a,LineCap:o},onRestore:function(){this._impl||(this._impl=new c._Impl(this))},onDestroy:function(){this.clear(!0),this._super(),this._impl=null},_getDefaultMaterial:function(){return r.getBuiltinMaterial("2d-base")},_updateMaterial:function(){var t=this._materials[0];t&&t.define("CC_USE_MODEL",!0)},moveTo:function(t,e){t instanceof cc.Vec2?cc.warn("[moveTo] : Can not pass Vec2 as [x, y] value, please check it."):this._impl.moveTo(t,e)},lineTo:function(t,e){t instanceof cc.Vec2?cc.warn("[moveTo] : Can not pass Vec2 as [x, y] value, please check it."):this._impl.lineTo(t,e)},bezierCurveTo:function(t,e,i,n,r,s){this._impl.bezierCurveTo(t,e,i,n,r,s)},quadraticCurveTo:function(t,e,i,n){this._impl.quadraticCurveTo(t,e,i,n)},arc:function(t,e,i,n,r,s){this._impl.arc(t,e,i,n,r,s)},ellipse:function(t,e,i,n){this._impl.ellipse(t,e,i,n)},circle:function(t,e,i){this._impl.circle(t,e,i)},rect:function(t,e,i,n){this._impl.rect(t,e,i,n)},roundRect:function(t,e,i,n,r){this._impl.roundRect(t,e,i,n,r)},fillRect:function(t,e,i,n){this.rect(t,e,i,n),this.fill()},clear:function(t){this._impl.clear(t),this._assembler&&this._assembler.clear(t)},close:function(){this._impl.close()},stroke:function(){this._assembler||this._resetAssembler(),this._assembler.stroke(this)},fill:function(){this._assembler||this._resetAssembler(),this._assembler.fill(this)}});cc.Graphics=e.exports=c,cc.Graphics.Types=s,cc.Graphics.Helper=t("./helper")},{"../assets/material/CCMaterial":53,"../components/CCRenderComponent":89,"./helper":132,"./types":134}],132:[function(t,e,i){"use strict";var b=t("./types").PointFlags,v=Math.PI,x=Math.min,T=Math.max,A=Math.cos,C=Math.sin,S=Math.abs,a=Math.sign,c=.5522847493;e.exports={arc:function(h,u,_,t,d,e,f){var i,n,r,s,o,a,c=0,l=0,p=0,m=0,y=0,g=0,c=e-d;if(f=f||!1)if(S(c)>=2*v)c=2*v;else for(;c<0;)c+=2*v;else if(S(c)>=2*v)c=2*-v;else for(;0<c;)c-=2*v;for(a=0|T(1,x(S(c)/(.5*v)+.5,5)),l=S(4/3*(1-A(e=c/a/2))/C(e)),f||(l=-l),o=0;o<=a;o++)i=u+(s=A(r=d+c*(o/a)))*t,n=_+(r=C(r))*t,r=-r*t*l,s=s*t*l,0===o?h.moveTo(i,n):h.bezierCurveTo(p+y,m+g,i-r,n-s,i,n),p=i,m=n,y=r,g=s},ellipse:function(t,e,i,n,r){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+r*c,e-n*c,i+r,e,i+r),t.bezierCurveTo(e+n*c,i+r,e+n,i+r*c,e+n,i),t.bezierCurveTo(e+n,i-r*c,e+n*c,i-r,e,i-r),t.bezierCurveTo(e-n*c,i-r,e-n,i-r*c,e-n,i),t.close()},roundRect:function(t,e,i,n,r,s){var o;s<.1?t.rect(e,i,n,r):(o=x(s,.5*S(n))*a(n),s=x(s,.5*S(r))*a(r),t.moveTo(e,i+s),t.lineTo(e,i+r-s),t.bezierCurveTo(e,i+r-s*(1-c),e+o*(1-c),i+r,e+o,i+r),t.lineTo(e+n-o,i+r),t.bezierCurveTo(e+n-o*(1-c),i+r,e+n,i+r-s*(1-c),e+n,i+r-s),t.lineTo(e+n,i+s),t.bezierCurveTo(e+n,i+s*(1-c),e+n-o*(1-c),i,e+n-o,i),t.lineTo(e+o,i),t.bezierCurveTo(e+o*(1-c),i,e,i+s*(1-c),e,i+s),t.close())},tesselateBezier:function h(t,e,u,i,n,r,s,o,a,_,c){var d,f,p,m,y,g,v,x,l;10<_||(y=.5*(r+o),g=.5*(s+a),v=.5*((d=.5*(e+i))+(p=.5*(i+r))),x=.5*((f=.5*(u+n))+(m=.5*(n+s))),((l=S((i-o)*(i=a-u)-(n-a)*(n=o-e)))+(r=S((r-o)*i-(s-a)*n)))*(l+r)<t._tessTol*(n*n+i*i)?t._addPoint(o,a,0===c?c|b.PT_BEVEL:c):(h(t,e,u,d,f,v,x,l=.5*(v+(s=.5*(p+y))),n=.5*(x+(r=.5*(m+g))),_+1,0),h(t,l,n,s,r,y,g,o,a,_+1,c)))}}},{"./types":134}],133:[function(t,e,i){"use strict";t("./graphics")},{"./graphics":131}],134:[function(t,e,i){"use strict";var n=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2}),s=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});e.exports={LineCap:n,LineJoin:r,PointFlags:s}},{}],135:[function(t,e,i){"use strict";t("./platform"),t("./assets"),t("./CCNode"),t("./CCPrivateNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./collider/CCIntersection"),t("./physics"),t("./camera/CCCamera"),t("./geom-utils"),t("./mesh"),t("./3d"),t("./base-ui/CCWidgetManager")},{"./3d":void 0,"./CCNode":30,"./CCPrivateNode":31,"./CCScene":32,"./assets":51,"./base-ui/CCWidgetManager":62,"./camera/CCCamera":63,"./collider":71,"./collider/CCIntersection":69,"./components":107,"./geom-utils":123,"./graphics":133,"./mesh":158,"./physics":173,"./platform":206}],136:[function(t,i,a){"use strict";var r=t("../platform/js"),n=t("./pipeline"),c=t("./loading-items"),_=t("./asset-loader"),d=t("./downloader"),f=t("./loader"),p=t("./asset-table"),u=t("../platform/utils").callInNextTick,m=t("./auto-release-utils"),y=t("./released-asset-checker"),o=Object.create(null);o.assets=new p,o.internal=new p;var s={url:null,raw:!1};function g(t){var e,i;if("object"==typeof t){if((i=t).url)return i;e=t.uuid}else i={},e=t;return t=i.type?"uuid"===i.type:cc.AssetLibrary._uuidInSettings(e),cc.AssetLibrary._getAssetInfoInRuntime(e,s),i.url=t?s.url:e,s.url&&"uuid"===i.type&&s.raw?(i.type=null,i.isRawAsset=!0):t||(i.isRawAsset=!0),i}var l=[],h=[];function e(){var t=new _,e=new d,i=new f;n.call(this,[t,e,i]),this.assetLoader=t,this.md5Pipe=null,this.downloader=e,this.loader=i,this.onProgress=null,this._autoReleaseSetting=r.createMap(!0),this._releasedAssetChecker_DEBUG=new y}r.extend(e,n);t=e.prototype;t.init=function(t){var e=this;t.on(cc.Director.EVENT_AFTER_UPDATE,function(){e._releasedAssetChecker_DEBUG.checkCouldRelease(e._cache)})},t.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},t.addDownloadHandlers=function(t){this.downloader.addHandlers(t)},t.addLoadHandlers=function(t){this.loader.addHandlers(t)},t.load=function(t,e,n){void 0===n&&(n=e,e=this.onProgress||null);var r,s=this,o=!1;t instanceof Array||(t=t?(o=!0,[t]):[]);for(var i=l.length=0;i<t.length;++i){var a=t[i];a&&a.id&&(cc.warnID(4920,a.id),a.uuid||a.url||(a.url=a.id)),((r=g(a)).url||r.uuid)&&(a=this._cache[r.url],l.push(a||r))}e=c.create(this,e,function(e,i){u(function(){var t;n&&(o?(t=r.url,n.call(s,e,i.getContent(t))):n.call(s,e,i),n=null),i.destroy()})});c.initQueueDeps(e),e.append(l),l.length=0},t.flowInDeps=function(i,t,n){for(var e=h.length=0;e<t.length;++e){var r,s=g(t[e]);(s.url||s.uuid)&&((r=this._cache[s.url])?h.push(r):h.push(s))}var o=c.create(this,i?function(t,e,i){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(i)}:null,function(t,e){n(t,e),i&&i.deps&&(i.deps.length=0),e.destroy()}),a=(i&&(a=c.getQueue(i),o._ownerQueue=a._ownerQueue||a),o.append(h,i));return h.length=0,a},t._assetTables=o,t._getResUuid=function(t,e,i,n){i=o[i=i||"assets"];if(!t||!i)return null;var r,s=t.indexOf("?"),s=(-1!==s&&(t=t.substr(0,s)),i.getUuid(t,e));return s||(r=cc.path.extname(t))&&(t=t.slice(0,-r.length),(s=i.getUuid(t,e))&&!n&&cc.warnID(4901,t,r)),s},t._getReferenceKey=function(t){var e;return"object"==typeof t?e=t._uuid||null:"string"==typeof t&&(e=this._getResUuid(t,null,null,!0)||t),e?(cc.AssetLibrary._getAssetInfoInRuntime(e,s),this._cache[s.url]?s.url:e):(cc.warnID(4800,t),e)},t._urlNotFound=function(e,i,n){u(function(){e=cc.url.normalize(e);var t=(i?r.getClassName(i):"Asset")+' in "resources/'+e+'" does not exist.';n&&n(new Error(t),[])})},t._parseLoadResArgs=function(t,e,i){var n;return void 0===i&&(n=t instanceof Array||r.isChildClassOf(t,cc.RawAsset),e?(i=e,n&&(e=this.onProgress||null)):void 0!==e||n||(i=t,e=this.onProgress||null,t=null),void 0===e||n||(e=t,t=null)),{type:t,onProgress:e,onComplete:i}},t.loadRes=function(t,e,i,n,r){5!==arguments.length&&(r=n,n=i,i="assets");var s=this._parseLoadResArgs(e,n,r),o=(e=s.type,n=s.onProgress,r=s.onComplete,this),a=o._getResUuid(t,e,i);a?this.load({type:"uuid",uuid:a},n,function(t,e){e&&o.setAutoReleaseRecursively(a,!1),r&&r(t,e)}):o._urlNotFound(t,e,r)},t._loadResUuids=function(t,e,a,c){var l,h;0<t.length?(l=this,h=t.map(function(t){return{type:"uuid",uuid:t}}),this.load(h,e,function(t,e){if(a){for(var i=[],n=c&&[],r=0;r<h.length;++r){var s=h[r].uuid,o=this._getReferenceKey(s),o=e.getContent(o);o&&(l.setAutoReleaseRecursively(s,!1),i.push(o),n&&n.push(c[r]))}c?a(t,i,n):a(t,i)}})):a&&u(function(){c?a(null,[],[]):a(null,[])})},t.loadResArray=function(t,e,i,n,r){5!==arguments.length&&(r=n,n=i,i="assets");for(var s=this._parseLoadResArgs(e,n,r),o=(e=s.type,n=s.onProgress,r=s.onComplete,[]),h=e instanceof Array,a=0;a<t.length;a++){var c=t[a],l=h?e[a]:e,u=this._getResUuid(c,l,i);if(!u)return void this._urlNotFound(c,l,r);o.push(u)}this._loadResUuids(o,n,r)},t.loadResDir=function(t,e,i,n,r){var s;5!==arguments.length&&(r=n,n=i,i="assets"),o[i]&&(e=(s=this._parseLoadResArgs(e,n,r)).type,n=s.onProgress,r=s.onComplete,i=o[i].getUuidArray(t,e,s=[]),this._loadResUuids(i,n,r,s))},t.getRes=function(t,e){if(!(i=this._cache[t])){t=this._getResUuid(t,e,null,!0);if(!t)return null;var e=this._getReferenceKey(t),i=this._cache[e]}return(i=i&&i.alias?i.alias:i)&&i.complete?i.content:null},t.getResCount=function(){return Object.keys(this._cache).length},t.getDependsRecursively=function(t){var e;return t?(t=this._getReferenceKey(t),(e=m.getDependsRecursively(t)).push(t),e):[]},t.release=function(t){var e,i,n;if(Array.isArray(t))for(var r=0;r<t.length;r++){var s=t[r];this.release(s)}else t&&((e=this._getReferenceKey(t))&&e in cc.AssetLibrary.getBuiltinDeps()||((i=this.getItem(e))&&(n=this.removeItem(e),t=i.content,n&&this._releasedAssetChecker_DEBUG.setReleased(i,e)),t instanceof cc.Asset&&((n=t.nativeUrl)&&this.release(n),t.destroy())))},t.releaseAsset=function(t){t=t._uuid;t&&this.release(t)},t.releaseRes=function(t,e,i){e=this._getResUuid(t,e,i);e?this.release(e):cc.errorID(4914,t)},t.releaseResDir=function(t,e,i){if(o[i=i||"assets"])for(var n=o[i].getUuidArray(t,e),r=0;r<n.length;r++){var s=n[r];this.release(s)}},t.releaseAll=function(){for(var t in this._cache)this.release(t)},t.removeItem=function(t){var e=n.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],e},t.setAutoRelease=function(t,e){t=this._getReferenceKey(t);t&&(this._autoReleaseSetting[t]=!!e)},t.setAutoReleaseRecursively=function(t,e){e=!!e;t=this._getReferenceKey(t);if(t){this._autoReleaseSetting[t]=e;for(var i=m.getDependsRecursively(t),n=0;n<i.length;n++){var r=i[n];this._autoReleaseSetting[r]=e}}},t.isAutoRelease=function(t){t=this._getReferenceKey(t);return!!t&&!!this._autoReleaseSetting[t]},cc.loader=new e,i.exports=cc.loader},{"../platform/js":209,"../platform/utils":213,"./asset-loader":137,"./asset-table":138,"./auto-release-utils":140,"./downloader":142,"./loader":145,"./loading-items":146,"./pipeline":149,"./released-asset-checker":150}],137:[function(t,e,i){"use strict";t("../utils/CCPath");function n(t){this.id=s,this.async=!0,this.pipeline=null}var o=t("../CCDebug"),r=t("./pipeline"),a=t("./loading-items"),s="AssetLoader",c=(n.ID=s,[]);n.prototype.handle=function(n,r){var s=n.uuid;if(!s)return n.content||null;cc.AssetLibrary.queryAssetInfo(s,function(t,e,i){t?r(t):(n.url=n.rawUrl=e,(n.isRawAsset=i)?(t=cc.path.extname(e).toLowerCase())?(t=t.substr(1),i=a.getQueue(n),c[0]={queueId:n.queueId,id:e,url:e,type:t,error:null,alias:n,complete:!0},i.append(c),n.type=t,r(null,n.content)):r(new Error(o.getError(4931,s,e))):(n.type="uuid",r(null,n.content)))})},r.AssetLoader=e.exports=n},{"../CCDebug":27,"../utils/CCPath":253,"./loading-items":146,"./pipeline":149}],138:[function(t,e,i){"use strict";var r=t("../utils/misc").pushToMap,d=t("../platform/js");function s(t,e){this.uuid=t,this.type=e}function n(){this._pathToUuid=d.createMap(!0)}t=n.prototype;t.getUuid=function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var n=0;n<i.length;n++){var r=i[n];if(d.isChildClassOf(r.type,e))return r.uuid}if(d.isChildClassOf(e,cc.SpriteFrame))for(var s=0;s<i.length;s++){var o=i[s];if(d.isChildClassOf(o.type,cc.SpriteAtlas)){cc.errorID(4932,t);break}}}else{if(!e||d.isChildClassOf(i.type,e))return i.uuid;d.isChildClassOf(e,cc.SpriteFrame)&&d.isChildClassOf(i.type,cc.SpriteAtlas)&&cc.errorID(4932,t)}return""},t.getUuidArray=function(t,e,i){"/"===(t=cc.url.normalize(t))[t.length-1]&&(t=t.slice(0,-1));var n,r,s,o,h=this._pathToUuid,a=[],u=d.isChildClassOf;for(r in h)if(r.startsWith(t)&&(s=r,o=t,!(s.length>o.length)||(46===(s=s.charCodeAt(o.length))||47===s))||!t){var c=h[r];if(Array.isArray(c))for(var l=0;l<c.length;l++){var _=c[l];!e||u(_.type,e)?(a.push(_.uuid),i&&i.push(r)):_.type===cc.SpriteAtlas&&(n=r)}else!e||u(c.type,e)?(a.push(c.uuid),i&&i.push(r)):c.type===cc.SpriteAtlas&&(n=r)}return 0===a.length&&n&&d.isChildClassOf(e,cc.SpriteFrame)&&cc.errorID(4932,n),a},t.add=function(t,e,i,n){t=t.substring(0,t.length-cc.path.extname(t).length);e=new s(e,i);r(this._pathToUuid,t,e,n)},t._getInfo_DEBUG=function(t,e){for(var i=this._pathToUuid,n=Object.keys(i),r=0;r<n.length;++r){var s=n[r],o=i[s];if(Array.isArray(o))for(var a=0;a<o.length;a++){var c=o[a];if(c.uuid===t)return e.path=s,e.type=c.type,!0}else if(o.uuid===t)return e.path=s,e.type=o.type,!0}return!1},t.reset=function(){this._pathToUuid=d.createMap(!0)},e.exports=n},{"../platform/js":209,"../utils/misc":264}],139:[function(t,e,l){"use strict";var i=t("../platform/CCSys"),n=t("../CCDebug"),a=i.__audioSupport,r=a.format,s=a.context;function o(e,i){function n(){clearTimeout(r),t.removeEventListener("canplaythrough",s,!1),t.removeEventListener("error",o,!1),a.USE_LOADER_EVENT&&t.removeEventListener(a.USE_LOADER_EVENT,s,!1)}var t=document.createElement("audio"),r=(t.src=e.url,setTimeout(function(){(0===t.readyState?o:s)()},8e3)),s=function(){n(),i(null,t)},o=function(){n();var t="load audio failure - "+e.url;cc.log(t),i(t)};t.addEventListener("canplaythrough",s,!1),t.addEventListener("error",o,!1),a.USE_LOADER_EVENT&&t.addEventListener(a.USE_LOADER_EVENT,s,!1)}function c(t,e){s||e(new Error(n.getError(4926)));var i=cc.loader.getXMLHttpRequest();i.open("GET",t.url,!0),i.responseType="arraybuffer",i.onload=function(){s.decodeAudioData(i.response,function(t){e(null,t)},function(){e("decode error - "+t.id,null)})},i.onerror=function(){e("request error - "+t.id,null)},i.send()}e.exports=function(t,e){if(0===r.length)return new Error(n.getError(4927));(a.WEB_AUDIO?t._owner instanceof cc.AudioClip?t._owner.loadMode===cc.AudioClip.LoadMode.WEB_AUDIO?c:o:t.urlParam&&t.urlParam.useDom?o:c:o)(t,e)}},{"../CCDebug":27,"../platform/CCSys":198}],140:[function(t,e,i){"use strict";var _=t("../platform/js");function s(t,e){t=cc.loader.getItem(t);if(t){var i=t.dependKeys;if(i)for(var n=0;n<i.length;n++){var r=i[n];e[r]||(e[r]=!0,s(r,e))}}}function f(t,e){t._uuid&&(e[t=cc.loader._getReferenceKey(t)]||(e[t]=!0,s(t,e)))}function p(t,h){for(var e=0;e<t._components.length;e++){i=void 0;n=void 0;r=void 0;s=void 0;o=void 0;a=void 0;c=void 0;u=void 0;l=void 0;_=void 0;var i=t._components[e];var n=h;for(var r=Object.getOwnPropertyNames(i),s=0;s<r.length;s++){var o=i[r[s]];if("object"==typeof o&&o)if(Array.isArray(o))for(var a=0;a<o.length;a++){var c=o[a];c instanceof cc.RawAsset&&f(c,n)}else if(o.constructor&&o.constructor!==Object)o instanceof cc.RawAsset&&f(o,n);else for(var u=Object.getOwnPropertyNames(o),l=0;l<u.length;l++){var _=o[u[l]];_ instanceof cc.RawAsset&&f(_,n)}}}for(var d=0;d<t._children.length;d++)p(t._children[d],h)}e.exports={autoRelease:function(t,e,h){var i=cc.loader._autoReleaseSetting,n=_.createMap();if(e)for(var r=0;r<e.length;r++)n[e[r]]=!0;for(var s=0;s<h.length;s++)p(h[s],n);if(t)for(var o=0;o<t.length;o++){var a=t[o];!1===i[a]||n[a]||cc.loader.release(a)}for(var u=Object.keys(i),c=0;c<u.length;c++){var l=u[c];!0!==i[l]||n[l]||cc.loader.release(l)}},getDependsRecursively:function(t){var e={};return s(t,e),Object.keys(e)}}},{"../platform/js":209}],141:[function(t,e,i){"use strict";e.exports=function(t,e){var t=t.url,i=cc.loader.getXMLHttpRequest(),n="Load binary data failed: "+t;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){var t=i.response;t?(t=new Uint8Array(t),e(null,t)):e({status:i.status,errorMessage:n+"(no response)"})},i.onerror=function(){e({status:i.status,errorMessage:n+"(error)"})},i.ontimeout=function(){e({status:i.status,errorMessage:n+"(time out)"})},i.send(null)}},{}],142:[function(t,h,u){"use strict";var e=t("../platform/js"),a=t("../CCDebug"),_=(t("../utils/CCPath"),t("./pipeline")),n=t("./pack-downloader"),i=t("./binary-downloader"),r=t("./text-downloader"),d=t("./utils").urlAppendTimestamp;function s(){return null}function f(t,e,i){var n=t.url,t=document,r=document.createElement("script");function s(){r.parentNode.removeChild(r),r.removeEventListener("load",s,!1),r.removeEventListener("error",o,!1),e(null,n)}function o(){r.parentNode.removeChild(r),r.removeEventListener("load",s,!1),r.removeEventListener("error",o,!1),e(new Error(a.getError(4928,n)))}"file:"!==window.location.protocol&&(r.crossOrigin="anonymous"),r.async=i,r.src=d(n),r.addEventListener("load",s,!1),r.addEventListener("error",o,!1),t.body.appendChild(r)}function c(e,i,t,n){void 0===t&&(t=!0);var r=d(e.url);if(n=n||new Image,t&&"file:"!==window.location.protocol?n.crossOrigin="anonymous":n.crossOrigin=null,n.complete&&0<n.naturalWidth&&n.src===r)return n;function s(){n.removeEventListener("load",o),n.removeEventListener("error",s),"https:"!==window.location.protocol&&n.crossOrigin&&"anonymous"===n.crossOrigin.toLowerCase()?c(e,i,!1,n):i(new Error(a.getError(4930,r)))}var o=function t(){n.removeEventListener("load",t),n.removeEventListener("error",s),n.id=e.id,i(null,n)};n.addEventListener("load",o),n.addEventListener("error",s),n.src=r}function o(t,e){e(null,t.url)}function l(t){this.id=m,this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this._subpackages={},this.extMap=e.mixin(t,p)}var p={js:f,png:c,jpg:c,bmp:c,jpeg:c,gif:c,ico:c,tiff:c,webp:c,image:c,pvr:i,pkm:i,mp3:t=t("./audio-downloader"),ogg:t,wav:t,m4a:t,txt:r,xml:r,vsh:r,fsh:r,atlas:r,tmx:r,tsx:r,json:r,ExportJson:r,plist:r,fnt:r,font:s,eot:s,ttf:s,woff:s,svg:s,ttc:s,uuid:function(t,e){var i=n.load(t,e);return void 0===i?this.extMap.json(t,e):i||void 0},binary:i,bin:i,dbbin:i,skel:i,mp4:o,avi:o,mov:o,mpg:o,mpeg:o,rm:o,rmvb:o,default:r},m="Downloader";l.ID=m,l.PackDownloader=n,l.prototype.addHandlers=function(t){e.mixin(this.extMap,t)},l.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var t=this._loadQueue.shift();if(!t)break;var e=this.handle(t.item,t.callback);void 0!==e&&(e instanceof Error?t.callback(e):t.callback(null,e))}},l.prototype.handle=function(t,i){var n=this,e=this.extMap[t.type]||this.extMap.default,r=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(r=e.call(this,t,function(t,e){n._curConcurrent=Math.max(0,n._curConcurrent-1),n._handleLoadQueue(),i&&i(t,e)})))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),r}else if(t.ignoreMaxConcurrency){if(void 0!==(r=e.call(this,t,i)))return r}else this._loadQueue.push({item:t,callback:i})},l.prototype.loadSubpackage=function(t,e,i){!i&&e&&(i=e,e=null);var n=this._subpackages[t];n?n.loaded?i&&i():f({url:n.path+"index.js"},function(t){t||(n.loaded=!0),i&&i(t)}):i&&i(new Error("Can't find subpackage "+t))},_.Downloader=h.exports=l},{"../CCDebug":27,"../platform/js":209,"../utils/CCPath":253,"./audio-downloader":139,"./binary-downloader":141,"./pack-downloader":148,"./pipeline":149,"./text-downloader":152,"./utils":154}],143:[function(t,e,n){"use strict";var i,h=t("../utils/text-utils"),u=null,_="BES bswy:->@123ä¸ãá„",d={},f=-1,p=[],y=(i=void 0,function(){var t,e;return i=void 0===i?!!window.FontFace&&(t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor),t?42<parseInt(t[1],10):!e):i});function g(){for(var t=!0,e=Date.now(),i=p.length-1;0<=i;i--){var n,r,s=p[i],o=s.fontFamilyName;3e3<e-s.startTime?(cc.warnID(4933,o),s.callback(null,o),p.splice(i,1)):(n=s.refWidth,u.font=r="40px "+o,n!==h.safeMeasureText(u,_,r)?(p.splice(i,1),s.callback(null,o)):t=!1)}t&&(clearInterval(f),f=-1)}var m={loadFont:function(t,e){var t=t.url,i=m._getFontFamily(t);if(d[i])return i;u||((a=document.createElement("canvas")).width=100,a.height=100,u=a.getContext("2d"));var n,r,s,o,a="40px "+i,a=(u.font=a,h.safeMeasureText(u,_,a)),c=document.createElement("style"),l=(c.type="text/css",""),t=(isNaN(+i)?l+="@font-face { font-family:"+i+"; src:":l+="@font-face { font-family:'"+i+"'; src:",c.textContent=(l+="url('"+t+"');")+"}",document.body.appendChild(c),document.createElement("div")),l=t.style;l.fontFamily=i,t.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",document.body.appendChild(t),y()?(n=Date.now(),r=i,s=e,l=new Promise(function(i,t){(function e(){3e3<=Date.now()-n?t():document.fonts.load("40px "+r).then(function(t){1<=t.length?i():setTimeout(e,100)},function(){t()})})()}),o=null,t=new Promise(function(t,e){o=setTimeout(e,3e3)}),Promise.race([t,l]).then(function(){o&&(clearTimeout(o),o=null),s(null,r)},function(){cc.warnID(4933,r),s(null,r)})):(t={fontFamilyName:i,refWidth:a,callback:e,startTime:Date.now()},p.push(t),-1===f&&(f=setInterval(g,100))),d[i]=c},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i=t.lastIndexOf("/"),t=-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL";return t=-1!==t.indexOf(" ")?'"'+t+'"':t}};e.exports=m},{"../utils/text-utils":271}],144:[function(t,e,i){"use strict";t("./downloader"),t("./loader"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":136,"./downloader":142,"./loader":145,"./loading-items":146,"./pipeline":149}],145:[function(t,e,h){"use strict";var i=t("../platform/js"),u=t("../platform/CCSAXParser").plistParser,_=t("./pipeline"),d=t("../assets/CCTexture2D"),n=t("./uuid-loader"),t=t("./font-loader");function r(e){if("string"!=typeof e.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(e.content)}catch(t){return new Error("JSON Loader: Parse json ["+e.id+"] failed : "+t)}}function s(t){if(t._owner instanceof cc.Asset)return null;var e=t.content;if(cc.sys.platform!==cc.sys.FB_PLAYABLE_ADS&&!(e instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var i=t.texture||new d;return i._uuid=t.uuid,i.url=t.url,i._setRawAsset(t.rawUrl,!1),i._nativeAsset=e,i}function o(t,e){if(t._owner instanceof cc.Asset)return null;var i=new cc.AudioClip;return i._setRawAsset(t.rawUrl,!1),i._nativeAsset=t.content,i.url=t.url,i}function a(t){return t.load?t.load(t.content):null}function c(t,e){return t[e]<<8|t[e+1]}function l(t){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=i.mixin(t,f)}var f={png:s,jpg:s,bmp:s,jpeg:s,gif:s,ico:s,tiff:s,webp:s,image:s,pvr:function(t){t=t.content instanceof ArrayBuffer?t.content:t.content.buffer;if(55727696!=(n=new Int32Array(t,0,13))[0])return new Error("Invalid magic number in PVR header");var e=n[7],i=n[6],n=n[12]+52;return{_data:new Uint8Array(t,n),_compressed:!0,width:e,height:i}},pkm:function(t){var t=t.content instanceof ArrayBuffer?t.content:t.content.buffer,e=new Uint8Array(t);if(0!==(i=c(e,6))&&1!==i&&3!==i)return new Error("Invalid magic number in ETC header");var i=c(e,12),n=c(e,14);return c(e,8),c(e,10),{_data:new Uint8Array(t,16),_compressed:!0,width:i,height:n}},mp3:o,ogg:o,wav:o,m4a:o,json:r,ExportJson:r,plist:function(t){return"string"!=typeof t.content?new Error("Plist Loader: Input item doesn't contain string content"):u.parse(t.content)||new Error("Plist Loader: Parse ["+t.id+"] failed")},uuid:n,prefab:n,fire:n,scene:n,binary:a,dbbin:a,bin:a,skel:a,font:t.loadFont,eot:t.loadFont,ttf:t.loadFont,woff:t.loadFont,svg:t.loadFont,ttc:t.loadFont,default:function(){return null}};l.ID="Loader",l.prototype.addHandlers=function(t){this.extMap=i.mixin(this.extMap,t)},l.prototype.handle=function(t,e){return(this.extMap[t.type]||this.extMap.default).call(this,t,e)},_.Loader=e.exports=l},{"../assets/CCTexture2D":50,"../platform/CCSAXParser":196,"../platform/js":209,"./font-loader":143,"./pipeline":149,"./uuid-loader":155}],146:[function(t,e,i){"use strict";var r=t("../platform/callbacks-invoker"),o=(t("../utils/CCPath"),t("../platform/js")),_=0|998*Math.random(),c=o.createMap(!0),s=[],a={WORKING:1,COMPLETE:2,ERROR:3},l=o.createMap(!0);function d(t,e){var i="object"==typeof t?t.url:t,n={queueId:e,id:i,url:i,rawUrl:void 0,urlParam:function(t){if(t){var e,t=t.split("?");if(t&&t[0]&&t[1])return e={},t[1].split("&").forEach(function(t){t=t.split("=");e[t[0]]=t[1]}),e}}(i),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof t&&(o.mixin(n,t),t.skips))for(var r=0;r<t.skips.length;r++){var s=t.skips[r];n.states[s]=a.COMPLETE}return n.rawUrl=n.url,i&&!n.type&&(n.type=cc.path.extname(i).toLowerCase().substr(1)),n}var h=[];function u(t,e,i,n){r.call(this),this._id=++_,(c[this._id]=this)._pipeline=t,this._errorUrls=o.createMap(!0),this._appending=!1,this._ownerQueue=null,this.onProgress=i,this.onComplete=n,this.map=o.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,e&&(0<e.length?this.append(e):this.allComplete())}u.ItemState=new cc.Enum(a),u.create=function(t,e,i,n){void 0===i?"function"==typeof e&&(n=e,e=i=null):void 0===n&&("function"==typeof e?(n=i,i=e,e=null):(n=i,i=null));var r=s.pop();return r?(r._pipeline=t,r.onProgress=i,r.onComplete=n,(c[r._id]=r)._pipeline&&(r.active=!0),e&&r.append(e)):r=new u(t,e,i,n),r},u.getQueue=function(t){return t.queueId?c[t.queueId]:null},u.itemComplete=function(t){var e=c[t.queueId];e&&e.itemComplete(t.id)},u.initQueueDeps=function(t){var e=l[t._id];e?(e.completed.length=0,e.deps.length=0):l[t._id]={completed:[],deps:[]}},u.registerQueueDep=function(t,e){var i=t.queueId||t;if(!i)return!1;i=l[i];if(i)-1===i.deps.indexOf(e)&&i.deps.push(e);else if(t.id)for(var n in l){n=l[n];-1!==n.deps.indexOf(t.id)&&-1===n.deps.indexOf(e)&&n.deps.push(e)}},u.finishDep=function(t){for(var e in l){e=l[e];-1!==e.deps.indexOf(t)&&-1===e.completed.indexOf(t)&&e.completed.push(t)}};t=u.prototype;o.mixin(t,r.prototype),t.append=function(t,e){if(!this.active)return[];e&&!e.deps&&(e.deps=[]),this._appending=!0;for(var i,n,r,s,o=[],a=0;a<t.length;++a)!(r=t[a]).queueId||this.map[r.id]?"string"==typeof((s=r).url||s)&&(n=(s=d(r,this._id)).id,this.map[n]||(this.map[n]=s,this.totalCount++,e&&e.deps.push(s),u.registerQueueDep(e||this._id,n),o.push(s))):(this.map[r.id]=r,e&&e.deps.push(r),r.complete||function t(e,i,n){if(e&&i){var r=!1;if(h.push(i.id),i.deps)for(var s,o=i.deps,a=0;a<o.length;a++){if((s=o[a]).id===e.id){r=!0;break}if(!(0<=h.indexOf(s.id))&&s.deps&&t(e,s,!0)){r=!0;break}}return n||(h.length=0),r}}(e,r)?(this.totalCount++,this.itemComplete(r.id)):(i=this,(n=c[r.queueId])&&(this.totalCount++,u.registerQueueDep(e||this._id,r.id),n.addListener(r.id,function(t){i.itemComplete(t.id)}))));return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(o),o},t._childOnProgress=function(t){var e;this.onProgress&&(e=l[this._id],this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,t))},t.allComplete=function(){var t=o.isEmptyObject(this._errorUrls)?null:this._errorUrls;this.onComplete&&this.onComplete(t,this)},t.isCompleted=function(){return this.completedCount>=this.totalCount},t.isItemCompleted=function(t){return!!this.completed[t]},t.exists=function(t){return!!this.map[t]},t.getContent=function(t){var t=this.map[t],e=null;return t&&(t.content?e=t.content:t.alias&&(e=t.alias.content)),e},t.getError=function(t){var t=this.map[t],e=null;return t&&(t.error?e=t.error:t.alias&&(e=t.alias.error)),e},t.addListener=r.prototype.on,t.hasListener=r.prototype.hasEventListener,t.removeListener=r.prototype.off,t.removeAllListeners=r.prototype.removeAll,t.removeItem=function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias.id],delete this.map[e.alias.id]),this.completedCount--,this.totalCount--)},t.itemComplete=function(t){var e,i=this.map[t];i&&(e=t in this._errorUrls,i.error instanceof Error||o.isString(i.error)?this._errorUrls[t]=i.error:i.error?o.mixin(this._errorUrls,i.error):!i.error&&e&&delete this._errorUrls[t],this.completed[t]=i,this.completedCount++,u.finishDep(i.id),this.onProgress&&(e=l[this._id],this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,i)),this.emit(t,i),this.removeAll(t),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete())},t.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,o.clear(this._errorUrls),this.onProgress=null,this.onComplete=null,this.map=o.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,r.call(this),l[this._id]&&(l[this._id].completed.length=0,l[this._id].deps.length=0),delete c[this._id],delete l[this._id],-1===s.indexOf(this)&&s.length<10&&s.push(this)},cc.LoadingItems=e.exports=u},{"../platform/callbacks-invoker":202,"../platform/js":209,"../utils/CCPath":253}],147:[function(t,e,i){"use strict";function n(t,e,i){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.md5NativeAssetsMap=e,this.libraryBase=i}var t=t("./pipeline"),r=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;n.ID="MD5Pipe",n.prototype.handle=function(t){return t.url=this.transformURL(t.url),null},n.prototype.transformURL=function(t){var i=!t.startsWith(this.libraryBase)?this.md5NativeAssetsMap:this.md5AssetsMap;return t=t.replace(r,function(t,e){e=i[e];return e?t+"."+e:t})},t.MD5Pipe=e.exports=n},{"./pipeline":149}],148:[function(t,e,i){"use strict";var s=t("./unpackers"),d=t("../utils/misc").pushToMap,o=0,r=2,a=3;function f(){this.unpacker=null,this.state=o,this.duration=0}var c={},l={},h={},u=[],_=null;function p(t,e){return new Error("Can not retrieve "+t+" from packer "+e)}e.exports={msToRelease:12e4,initPacks:function(t){for(var e in c={},l=t)for(var i=t[e],n=0;n<i.length;n++){var r=i[n],s=1===i.length;d(c,r,e,s)}},_loadNewPack:function(i,n,r){var s=this,o=cc.AssetLibrary.getLibUrlNoExt(n)+".json";cc.loader.load({url:o,ignoreMaxConcurrency:!0},function(t,e){if(t)return cc.errorID(4916,i),r(t);h[n].url=o;t=s._doLoadNewPack(i,n,e);t?r(null,t):r(p(i,n))})},_doPreload:function(t,e){var i=h[t];i||((i=h[t]=new f).state=r),i.state!==a&&(i.unpacker=new s.JsonUnpacker,i.unpacker.load(l[t],e),i.state=a)},_doLoadNewPack:function(t,e,i){var n,r=h[e];return r.state!==a&&("string"==typeof i&&(i=JSON.parse(i)),Array.isArray(i)?r.unpacker=new s.JsonUnpacker:i.type===s.TextureUnpacker.ID&&(r.unpacker=new s.TextureUnpacker),r.unpacker.load(l[e],i),r.state=a,r.duration=0,u.push(e),n=this,_=_||setInterval(function(){for(var t=n.msToRelease/5e3,e=u.length-1;0<=e;e--){var i=u[e];++h[i].duration>t&&n.release(i)}0===u.length&&(clearInterval(_),_=null)},5e3)),r.unpacker.retrieve(t)},_selectLoadedPack:function(t){for(var e=o,i="",n=0;n<t.length;n++){var r=t[n],s=h[r];if(s){s=s.state;if(s===a)return r;e<s&&(e=s,i=r)}}return e!==o?i:t[0]},load:function(t,e){var i,t=t.uuid,n=c[t];if(n)return Array.isArray(n)&&(n=this._selectLoadedPack(n)),i=h[n],i&&i.state===a?(i.duration=0,i.unpacker.retrieve(t)||p(t,n)):(i||(console.log("Create unpacker %s for %s",n,t),(i=h[n]=new f).state=r),this._loadNewPack(t,n,e),null)},release:function(t){var e=h[t];e&&(cc.loader.release(e.url),delete h[t],cc.js.array.fastRemove(u,t))}}},{"../utils/misc":264,"./unpackers":153}],149:[function(t,e,i){"use strict";var n=t("../platform/js"),r=t("./loading-items"),a=r.ItemState;function s(t){this._pipes=t,this._cache=n.createMap(!0);for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null)}}s.ItemState=a;t=s.prototype;t.insertPipe=function(t,e){var i,n;!t.handle||!t.id||e>this._pipes.length?cc.warnID(4921):0<this._pipes.indexOf(t)?cc.warnID(4922):(i=null,e<(t.pipeline=this)._pipes.length&&(i=this._pipes[e]),n=null,(n=0<e?this._pipes[e-1]:n)&&(n.next=t),t.next=i,this._pipes.splice(e,0,t))},t.insertPipeAfter=function(t,e){t=this._pipes.indexOf(t);t<0||this.insertPipe(e,t+1)},t.appendPipe=function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,0<this._pipes.length&&(this._pipes[this._pipes.length-1].next=t),this._pipes.push(t))},t.flowIn=function(t){var e,i,n=this._pipes[0];if(n){for(e=0;e<t.length;e++)i=t[e],this._cache[i.id]=i;for(e=0;e<t.length;e++)(function i(t,n){var r=t.id,e=n.states[r],s=t.next,o=t.pipeline;n.error||e===a.WORKING||e===a.ERROR||(e===a.COMPLETE?s?i(s,n):o.flowOut(n):(n.states[r]=a.WORKING,(e=t.handle(n,function(t,e){t?(n.error=t,n.states[r]=a.ERROR,o.flowOut(n)):(e&&(n.content=e),n.states[r]=a.COMPLETE,s?i(s,n):o.flowOut(n))}))instanceof Error?(n.error=e,n.states[r]=a.ERROR,o.flowOut(n)):void 0!==e&&(null!==e&&(n.content=e),n.states[r]=a.COMPLETE,s?i(s,n):o.flowOut(n))))})(n,i=t[e])}else for(e=0;e<t.length;e++)this.flowOut(t[e])},t.flowInDeps=function(t,e,i){return r.create(this,function(t,e){i(t,e),e.destroy()}).append(e,t)},t.flowOut=function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,r.itemComplete(t)},t.copyItemStates=function(t,e){if(e instanceof Array)for(var i=0;i<e.length;++i)e[i].states=t.states;else e.states=t.states},t.getItem=function(t){t=this._cache[t];return t&&(t.alias||t)},t.removeItem=function(t){var e=this._cache[t];return e&&e.complete&&delete this._cache[t],e},t.clear=function(){for(var t in this._cache){var e=this._cache[t];delete this._cache[t],e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e))}},cc.Pipeline=e.exports=s},{"../platform/js":209,"./loading-items":146}],150:[function(t,e,i){"use strict";function n(){this._releasedKeys=c.createMap(!0),this._dirty=!1}function a(t,e,i){i[t]||cc.log('"'+t+'" was released but maybe still referenced by '+((i=e).uuid?(r=r||{path:"",type:null},cc.loader._assetTables.assets._getInfo_DEBUG(i.uuid,r)?(r.path="resources/"+r.path,'"'+r.path+'" (type: '+c.getClassName(r.type)+", uuid: "+i.uuid+")"):'"'+i.rawUrl+'" ('+i.uuid+")"):'"'+i.rawUrl+'"'))}var c=t("../platform/js"),r=(n.prototype.setReleased=function(t,e){this._releasedKeys[e]=!0,this._dirty=!0},null);n.prototype.checkCouldRelease=function(t){if(this._dirty){this._dirty=!1;var e,i=this._releasedKeys;for(e in t){var n=t[e],r=(n=n.alias?n.alias:n).dependKeys;if(r)for(var s=0;s<r.length;++s){var o=r[s];i[o]&&(a(o,n,t),delete i[o])}}c.clear(i)}},e.exports=n},{"../platform/js":209}],151:[function(t,e,i){"use strict";var t=t("./pipeline"),n="SubPackPipe",r=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;function s(t){for(var e in this.id=n,this.async=!1,this.pipeline=null,t){var i=t[e];i.uuids&&i.uuids.forEach(function(t){o[t]=i.path})}}var o=Object.create(null);s.ID=n,s.prototype.handle=function(t){return t.url=this.transformURL(t.url),null},s.prototype.transformURL=function(t){var e=(e=(e=t).match(r))?e[1]:"";if(e){e=o[e];if(e)return t.replace("res/raw-assets/",e+"raw-assets/")}return t},t.SubPackPipe=e.exports=s},{"./pipeline":149}],152:[function(t,e,i){"use strict";var r=t("./utils").urlAppendTimestamp;e.exports=function(t,e){var t=t.url,t=r(t),i=cc.loader.getXMLHttpRequest(),n="Load text file failed: "+t;i.open("GET",t,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.onload=function(){4===i.readyState?200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:n+"(wrong status)"}):e({status:i.status,errorMessage:n+"(wrong readyState)"})},i.onerror=function(){e({status:i.status,errorMessage:n+"(error)"})},i.ontimeout=function(){e({status:i.status,errorMessage:n+"(time out)"})},i.send(null)}},{"./utils":154}],153:[function(t,e,i){"use strict";var n=t("../assets/CCTexture2D"),t=t("../platform/js");function r(){this.jsons={}}function s(){this.contents={}}r.prototype.load=function(t,e){e.length!==t.length&&cc.errorID(4915);for(var i=0;i<t.length;i++){var n=t[i],r=e[i];this.jsons[n]=r}},r.prototype.retrieve=function(t){return this.jsons[t]||null},s.ID=t._getClassId(n),s.prototype.load=function(t,e){var i=e.data.split("|");i.length!==t.length&&cc.errorID(4915);for(var n=0;n<t.length;n++)this.contents[t[n]]=i[n]},s.prototype.retrieve=function(t){t=this.contents[t];return t?{__type__:s.ID,content:t}:null},e.exports={JsonUnpacker:r,TextureUnpacker:s}},{"../assets/CCTexture2D":50,"../platform/js":209}],154:[function(t,e,i){"use strict";var n=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(n.test(t)?t+="&_t="+ +new Date:t+="?_t="+ +new Date),t}}},{}],155:[function(t,e,i){"use strict";var a=t("../platform/js"),c=t("../CCDebug"),p=(t("../platform/deserialize"),t("./loading-items"));function l(t){return t&&(t[0]&&"cc.Scene"===t[0].__type__||t[1]&&"cc.Scene"===t[1].__type__||t[0]&&"cc.Prefab"===t[0].__type__)}function n(e,t){if("string"==typeof e.content)try{o=JSON.parse(e.content)}catch(t){return new Error(c.getError(4923,e.id,t.stack))}else{if("object"!=typeof e.content)return new Error(c.getError(4924));o=e.content}var i,n=l(o),r=n?cc._MissingScript.safeFindClass:function(t){var e=a._getClassById(t);return e||(cc.warnID(4903,t),Object)},s=cc.deserialize.Details.pool.get();try{i=cc.deserialize(o,s,{classFinder:r,target:e.existingAsset,customEnv:e})}catch(t){cc.deserialize.Details.pool.put(s);var o=t.stack;return new Error(c.getError(4925,e.id,o))}i._uuid=e.uuid,i.url=i.nativeUrl,r=i,o=n,(n=(n=e).deferredLoadRaw)?r instanceof cc.Asset&&r.constructor.preventDeferredLoadDependents&&(n=!1):o&&(r instanceof cc.SceneAsset||r instanceof cc.Prefab)&&(n=r.asyncLoadAssets);var u,_,f,d,r=function(h,t,e,u){var i,n,r=e.uuidList,s=e.uuidObjList,o=e.uuidPropList,a=e._stillUseUrl,_=h.dependKeys=[];if(u)for(i=[],n=0;n<r.length;n++){var c=r[n],d=s[n],f=o[n],l=cc.AssetLibrary._getAssetInfoInRuntime(c);l.raw?(l=l.url,d[f]=l,_.push(l)):i.push({type:"uuid",uuid:c,deferredLoadRaw:!0,_owner:d,_ownerProp:f,_stillUseUrl:a[n]})}else{for(i=new Array(r.length),n=0;n<r.length;n++)c=r[n],i[n]={type:"uuid",uuid:c,_owner:s[n],_ownerProp:o[n],_stillUseUrl:a[n]};t._native&&!t.constructor.preventPreloadNativeObject&&i.push({url:t.nativeUrl,_owner:t,_ownerProp:"_nativeAsset"})}return i}(e,i,s,n);if(cc.deserialize.Details.pool.put(s),0===r.length)return i.onLoad&&i.onLoad(),t(null,i);n=this.pipeline,u=i,_=r,f=t,(s=e).content=u,d=s.dependKeys,n.flowInDeps(s,_,function(t,h){var e,i=h.map;for(e in i)(s=i[e]).uuid&&s.content&&(s.content._uuid=s.uuid);function n(t){var e=t.content;this._stillUseUrl&&(e=e&&cc.RawAsset.wasRawAssetType(e.constructor)?e.nativeUrl:t.rawUrl),"_nativeAsset"===this._ownerProp&&(this._owner.url=t.url),this._owner[this._ownerProp]=e,t.uuid!==u._uuid&&d.indexOf(t.id)<0&&d.push(t.id)}for(var r=0;r<_.length;r++){var s,o,a=_[r],c=a.uuid,l=a.url;a._owner,a._ownerProp;(s=i[l])&&(l=a,s.complete||s.content?s.error?cc._throw(s.error.message||s.error.errorMessage||s.error):n.call(l,s):(o=(a=p.getQueue(s))._callbackTable[c])?o.unshift(n,l):a.addListener(c,n,l))}if(!t&&u.onLoad)try{u.onLoad()}catch(t){cc._throw(t)}f(t,u)})}(e.exports=n).isSceneObj=l},{"../CCDebug":27,"../platform/deserialize":204,"../platform/js":209,"./loading-items":146}],156:[function(t,e,r){"use strict";var l=i(t("../../renderer/core/input-assembler")),g=i(t("../../renderer/gfx")),h=t("./mesh-data");function i(t){return t&&t.__esModule?t:{default:t}}var u=t("../renderer"),t=t("../event/event-target");function x(t,e,i){t[e]=i._val}function b(t,e,i){t[e]=i.x,t[e+1]=i.y}function A(t,e,i){t[e]=i.x,t[e+1]=i.y,t[e+2]=i.z}var y={5120:"getInt8",5121:"getUint8",5122:"getInt16",5123:"getUint16",5124:"getInt32",5125:"getUint32",5126:"getFloat32"},C={5120:"setInt8",5121:"setUint8",5122:"setInt16",5123:"setUint16",5124:"setInt32",5125:"setUint32",5126:"setFloat32"},v=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0]),n=cc.Class({name:"cc.Mesh",extends:cc.Asset,mixins:[t],properties:{_nativeAsset:{override:!0,get:function(){return this._buffer},set:function(t){this._buffer=ArrayBuffer.isView(t)?t.buffer:t,this.initWithBuffer()}},_vertexBundles:{default:null,type:h.VertexBundle},_primitives:{default:null,Primitive:h.Primitive},_minPos:cc.v3(),_maxPos:cc.v3(),subMeshes:{get:function(){return this._subMeshes},set:function(t){this._subMeshes=t}},subDatas:{get:function(){return this._subDatas}}},ctor:function(){this._subMeshes=[],this.loaded=!1,this._subDatas=[]},initWithBuffer:function(){this._subMeshes.length=0;for(var t=this._primitives,e=0;e<t.length;e++){var i=t[e],n=i.data,n=new Uint8Array(this._buffer,n.offset,n.length),r=this._vertexBundles[i.vertexBundleIndices[0]],s=r.data,r=new g.default.VertexFormat(r.formats),o=new Uint8Array(this._buffer,s.offset,s.length),a=this._canVertexFormatBatch(r),c=new h.MeshData,s=(c.vData=o,c.iData=n,c.vfm=r,c.offset=s.offset,c.canBatch=a,this._subDatas.push(c),new g.default.VertexBuffer(u.device,r,g.default.USAGE_STATIC,o)),a=new g.default.IndexBuffer(u.device,i.indexUnit,g.default.USAGE_STATIC,n);this._subMeshes.push(new l.default(s,a))}this.loaded=!0,this.emit("load")},_canVertexFormatBatch:function(t){var e=t._attr2el[g.default.ATTR_POSITION];return!e||e.type===g.default.ATTR_TYPE_FLOAT32&&t._bytes%4==0},init:function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=0);var e=new Uint8Array(t._bytes*e),r=new h.MeshData,t=(r.vData=e,r.vfm=t,r.vDirty=!0,r.canBatch=this._canVertexFormatBatch(t),new g.default.VertexBuffer(u.device,t,i?g.default.USAGE_DYNAMIC:g.default.USAGE_STATIC,e)),i=(r.vb=t,this._subMeshes[n]=new l.default(r.vb),this._subDatas[n]);i&&(i.vb&&i.vb.destroy(),i.ib&&i.ib.destroy()),this._subDatas[n]=r,this.loaded=!0,this.emit("load"),this.emit("init-format")},setVertices:function(t,e,i){var i=this._subDatas[i=i||0],n=i.vfm.element(t);if(!n)return cc.warn("Cannot find "+t+" attribute in vertex defines.");var r,h="number"==typeof e[0],s=n.num,o=h?e.length/s|0:e.length,o=(i.vData.byteLength<o*n.stride&&i.setVData(new Uint8Array(o*i.vfm._bytes)),4),u=(t===g.default.ATTR_COLOR?h?(r=i.getVData(),o=1):r=i.getVData(Uint32Array):r=i.getVData(Float32Array),n.stride/o),_=n.offset/o;if(h)for(var a=0,d=e.length/s;a<d;a++)for(var f=a*s,p=a*u+_,c=0;c<s;c++)r[p+c]=e[f+c];else for(var m=t===g.default.ATTR_COLOR?x:2===s?b:A,l=0,y=e.length;l<y;l++)m(r,l*u+_,e[l]);i.vDirty=!0},setIndices:function(t,e,i){e=e||0;var n=t,t=(t instanceof Uint16Array?n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(n=new Uint16Array(t),n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),i?g.default.USAGE_DYNAMIC:g.default.USAGE_STATIC),i=this._subDatas[e];i.ib?(i.iData=n,i.iDirty=!0):(i.iData=n,t=new g.default.IndexBuffer(u.device,g.default.INDEX_FMT_UINT16,t,n,n.byteLength/g.default.IndexBuffer.BYTES_PER_INDEX[g.default.INDEX_FMT_UINT16]),i.ib=t,this._subMeshes[e]._indexBuffer=i.ib)},setPrimitiveType:function(t,e){this._subMeshes[e=e||0]?this._subMeshes[e]._primitiveType=t:cc.warn("Do not have sub mesh at index "+e)},clear:function(){this._subMeshes.length=0;for(var t=this._subDatas,e=0,i=t.length;e<i;e++){var n=t[e].vb,n=(n&&n.destroy(),t[e].ib);n&&n.destroy()}t.length=0},setBoundingBox:function(t,e){this._minPos=t,this._maxPos=e},destroy:function(){this.clear()},_uploadData:function(){for(var t=this._subDatas,e=0,i=t.length;e<i;e++){var n,r,s=t[e];s.vDirty&&(n=s.vb,r=s.vData,n.update(0,r),s.vDirty=!1),s.iDirty&&(n=s.ib,r=s.iData,n.update(0,r),s.iDirty=!1)}},_getAttrMeshData:function(t,e){t=this._subDatas[t];if(!t)return[];var i=t.vfm,n=i.element(e);if(!n)return[];t.attrDatas||(t.attrDatas={});var r=t.attrDatas;if(s=r[e])return s;for(var s=r[e]=[],r=t.vData,o=new DataView(r.buffer,r.byteOffset,r.byteLength),h=n.stride,u=n.offset,a=n.num,_=n.bytes/a,d=y[n.type],f=r.byteLength/i._bytes,c=0;c<f;c++)for(var p=c*h+u,l=0;l<a;l++){var m=o[d](p+l*_,v);s.push(m)}return s},copyAttribute:function(t,e,h,u,_){var i=!1,n=this._subDatas[t];if(!n)return i;var r=n.vfm,s=r.element(e);if(!s)return i;var o=C[s.type];if(!o)return i;var a=this._getAttrMeshData(t,e),d=n.vData.byteLength/r._bytes,f=s.bytes/s.num;if(0<a.length){for(var p=new DataView(h,_),m=u,y=s.num,c=0;c<d;++c)for(var g=c*y,l=0;l<y;++l)p[o](m*c+f*l,a[g+l],v);i=!0}return i},copyIndices:function(t,e){t=this._subDatas[t];if(!t)return!1;for(var t=t.iData,i=t.length/2,n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=y[g.default.INDEX_FMT_UINT8],s=0;s<i;++s)e[s]=n[r](2*s);return!0}});cc.Mesh=e.exports=n},{"../../renderer/core/input-assembler":302,"../../renderer/gfx":312,"../event/event-target":115,"../renderer":220,"./mesh-data":159}],157:[function(t,r,s){"use strict";var S=i(t("../../renderer/gfx")),T=i(t("../../renderer/core/input-assembler")),e=i(t("../geom-utils/aabb")),o=t("../utils/mesh-util"),w=i(t("../value-types/vec3")),B=i(t("../value-types/mat4")),E=i(t("../assets/material/material-variant"));function i(t){return t&&t.__esModule?t:{default:t}}var a=t("../components/CCRenderComponent"),c=t("./CCMesh"),l=t("../renderer/render-flow"),M=t("../renderer"),h=t("../assets/material/CCMaterial"),n=cc.Enum({OFF:0,ON:1}),t=cc.Class({name:"cc.MeshRenderer",extends:a,editor:!1,properties:{_mesh:{default:null,type:c},_receiveShadows:!1,_shadowCastingMode:n.OFF,_enableAutoBatch:!1,mesh:{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._setMesh(t),t?(this.markForRender(!0),this.node._renderFlag|=l.FLAG_TRANSFORM):this.disableRender())},type:c,animatable:!1},textures:{default:[],type:cc.Texture2D,visible:!1},receiveShadows:{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows=t,this._updateReceiveShadow()},animatable:!1},shadowCastingMode:{get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()},type:n,animatable:!1},enableAutoBatch:{get:function(){return this._enableAutoBatch},set:function(t){this._enableAutoBatch=t}}},statics:{ShadowCastingMode:n},ctor:function(){this._boundingBox=cc.geomUtils&&new e.default,this._debugDatas={wireFrame:[],normal:[]}},onEnable:function(){var t=this;this._super(),this._mesh&&!this._mesh.loaded?(this.disableRender(),this._mesh.once("load",function(){t.isValid&&(t._setMesh(t._mesh),t.markForRender(!0))}),(0,o.postLoadMesh)(this._mesh)):this._setMesh(this._mesh),this._updateRenderNode(),this._updateMaterial()},onDestroy:function(){this._setMesh(null),cc.pool.assembler.put(this._assembler)},_updateRenderNode:function(){this._assembler.setRenderNode(this.node)},_setMesh:function(t){cc.geomUtils&&t&&e.default.fromPoints(this._boundingBox,t._minPos,t._maxPos),this._mesh&&this._mesh.off("init-format",this._updateMeshAttribute,this),t&&t.on("init-format",this._updateMeshAttribute,this),this._mesh=t,this._updateMeshAttribute()},_getDefaultMaterial:function(){return h.getBuiltinMaterial("unlit")},_validateRender:function(){var t=this._mesh;t&&0<t._subDatas.length||this.disableRender()},_updateMaterial:function(){var t=this.textures;if(t&&0<t.length)for(var e=this._getDefaultMaterial(),i=0;i<t.length;i++){var n=this._materials[i];n&&n._uuid!==e._uuid||(n||(n=E.default.create(e,this),this.setMaterial(i,n)),n.setProperty("diffuseTexture",t[i]))}this._updateReceiveShadow(),this._updateCastShadow(),this._updateMeshAttribute()},_updateReceiveShadow:function(){for(var t=this.getMaterials(),e=0;e<t.length;e++)t[e].define("CC_USE_SHADOW_MAP",this._receiveShadows,void 0,!0)},_updateCastShadow:function(){for(var t=this.getMaterials(),e=0;e<t.length;e++)t[e].define("CC_CASTING_SHADOW",this._shadowCastingMode===n.ON,void 0,!0)},_updateMeshAttribute:function(){var t=this._mesh&&this._mesh.subDatas;if(t){for(var e,i=this.getMaterials(),n=0;n<i.length&&t[n];n++){var r=t[n].vfm,s=i[n];s.define("CC_USE_ATTRIBUTE_COLOR",!!r.element(S.default.ATTR_COLOR),void 0,!0),s.define("CC_USE_ATTRIBUTE_UV0",!!r.element(S.default.ATTR_UV0),void 0,!0),s.define("CC_USE_ATTRIBUTE_NORMAL",!!r.element(S.default.ATTR_NORMAL),void 0,!0),s.define("CC_USE_ATTRIBUTE_TANGENT",!!r.element(S.default.ATTR_TANGENT),void 0,!0)}for(e in this._debugDatas)this._debugDatas[e].length=0}},_checkBacth:function(){}}),u=cc.Color.BLACK,R=cc.Color.RED,I=[cc.v3(),cc.v3()],P=cc.mat4(),_={normal:function(t,h,e,i){var e=e.vfm,u=e.element(S.default.ATTR_NORMAL),n=e.element(S.default.ATTR_POSITION),r=e.element(S.default.ATTR_JOINTS),s=e.element(S.default.ATTR_WEIGHTS);if(u&&n){for(var _,d=[],o=[],e=(w.default.set(I[0],5,0,0),B.default.invert(P,t.node._worldMatrix),w.default.transformMat4Normal(I[0],I[0],P),_=I[0].mag(),t.mesh),a=e._getAttrMeshData(i,S.default.ATTR_POSITION),f=e._getAttrMeshData(i,S.default.ATTR_NORMAL),p=e._getAttrMeshData(i,S.default.ATTR_JOINTS),m=e._getAttrMeshData(i,S.default.ATTR_WEIGHTS),y=a.length/n.num,c=0;c<y;c++){var g=c*u.num,v=c*n.num;w.default.set(I[0],f[g],f[1+g],f[2+g]),w.default.set(I[1],a[v],a[1+v],a[2+v]),w.default.scaleAndAdd(I[0],I[1],I[0],_);for(var l=0;l<2;l++){if(o.push(I[l].x,I[l].y,I[l].z),r)for(var x=c*r.num,b=0;b<r.num;b++)o.push(p[x+b]);if(s)for(var A=c*s.num,C=0;C<s.num;C++)o.push(m[A+C])}d.push(2*c,2*c+1)}t=[{name:S.default.ATTR_POSITION,type:S.default.ATTR_TYPE_FLOAT32,num:3}],e=(r&&t.push({name:S.default.ATTR_JOINTS,type:S.default.ATTR_TYPE_FLOAT32,num:r.num}),s&&t.push({name:S.default.ATTR_WEIGHTS,type:S.default.ATTR_TYPE_FLOAT32,num:s.num}),new S.default.VertexFormat(t)),i=new S.default.VertexBuffer(M.device,e,S.default.USAGE_STATIC,new Float32Array(o)),t=new Uint16Array(d),e=new S.default.IndexBuffer(M.device,S.default.INDEX_FMT_UINT16,S.default.USAGE_STATIC,t,t.length),t=E.default.createWithBuiltin("unlit");return t.setProperty("diffuseColor",R),{material:t,ia:new T.default(i,e,S.default.PT_LINES)}}},wireFrame:function(l,t,e){for(var i=e.getIData(Uint16Array),e=E.default.createWithBuiltin("unlit"),n=(e.setProperty("diffuseColor",u),[]),r=0;r<i.length;r+=3){var s=i[r+0],o=i[r+1],a=i[r+2];n.push(s,o,o,a,a,s)}var c=new Uint16Array(n),c=new S.default.IndexBuffer(M.device,S.default.INDEX_FMT_UINT16,S.default.USAGE_STATIC,c,c.length);return{material:e,ia:new T.default(t._vertexBuffer,c,S.default.PT_LINES)}}};t.prototype._updateDebugDatas=function(){var t,e=this._debugDatas,i=this._mesh.subMeshes,n=this._mesh._subDatas;for(t in e){var r=e[t];if(r.length!==i.length&&cc.macro["SHOW_MESH_"+t.toUpperCase()]){r.length=i.length;for(var s=0;s<i.length;s++)r[s]=_[t](this,i[s],n[s],s)}}},cc.MeshRenderer=r.exports=t},{"../../renderer/core/input-assembler":302,"../../renderer/gfx":312,"../assets/material/CCMaterial":53,"../assets/material/material-variant":60,"../components/CCRenderComponent":89,"../geom-utils/aabb":119,"../renderer":220,"../renderer/render-flow":221,"../utils/mesh-util":263,"../value-types/mat4":281,"../value-types/vec3":289,"./CCMesh":156}],158:[function(t,e,i){"use strict";t("./CCMesh"),t("./CCMeshRenderer"),t("./mesh-renderer")},{"./CCMesh":156,"./CCMeshRenderer":157,"./mesh-renderer":160}],159:[function(t,e,i){"use strict";i.__esModule=!0,i.MeshData=s,i.Primitive=i.VertexBundle=i.VertexFormat=i.BufferRange=void 0;t=(t=t("../../renderer/gfx"))&&t.__esModule?t:{default:t};var n=cc.Class({name:"cc.BufferRange",properties:{offset:0,length:0}}),r=(i.BufferRange=n,cc.Class({name:"cc.mesh.VertexFormat",properties:{name:"",type:-1,num:-1,normalize:!1}})),r=(i.VertexFormat=r,cc.Class({name:"cc.mesh.VertexBundle",properties:{data:{default:null,type:n},formats:{default:[],type:r},verticesCount:0}})),r=(i.VertexBundle=r,cc.Class({name:"cc.mesh.Primitive",properties:{vertexBundleIndices:{default:[],type:cc.Float},data:{default:null,type:n},indexUnit:t.default.INDEX_FMT_UINT16,topology:t.default.PT_TRIANGLES}}));function s(){this.vData=null,this.float32VData=null,this.uint32VData=null,this.iData=null,this.uint16IData=null,this.vfm=null,this.offset=0,this.vb=null,this.ib=null,this.vDirty=!1,this.iDirty=!1,this.enable=!0}i.Primitive=r,s.prototype.setVData=function(t){this.vData=t,this.float32VData=null,this.uint32VData=null},s.prototype.getVData=function(t){return t===Float32Array?(this.float32VData||(this.float32VData=new Float32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.float32VData):t===Uint32Array?(this.uint32VData||(this.uint32VData=new Uint32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.uint32VData):this.vData},s.prototype.getIData=function(t){return t===Uint16Array?(this.uint16IData||(this.uint16IData=new Uint16Array(this.iData.buffer,this.iData.byteOffset,this.iData.byteLength/2)),this.uint16IData):this.iData}},{"../../renderer/gfx":312}],160:[function(t,a,e){"use strict";e.__esModule=!0,e.default=void 0;var c=i(t("../renderer/assembler")),p=i(t("../../renderer/gfx")),m=i(t("../value-types/vec3"));function i(t){return t&&t.__esModule?t:{default:t}}function l(i){return function(){var t,e=h(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=h(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var n,r,t=t("./CCMeshRenderer"),y=new m.default,s=(n=c.default,s=n,(r=o).prototype=Object.create(s.prototype),(r.prototype.constructor=r).__proto__=s,l(o),(r=o.prototype).init=function(t){n.prototype.init.call(this,t),this._worldDatas={},this._renderNode=null},r.setRenderNode=function(t){this._renderNode=t},r.fillBuffers=function(t,e){if(t.mesh){t.mesh._uploadData();for(var i=e.cullingMask===t.node._cullingMask,n=t.enableAutoBatch,r=t._materials,s=t.mesh._subMeshes,h=t.mesh.subDatas,o=0;o<s.length;o++){var a=s[o],c=h[o],l=r[o]||r[0];n&&c.canBatch&&a._primitiveType===p.default.PT_TRIANGLES?(i&&l.getHash()===e.material.getHash()||e._flush(),e.material=l,e.cullingMask=t.node._cullingMask,e.node=e._dummyNode,this._fillBuffer(t,c,e,o)):(e._flush(),e.material=l,e.cullingMask=t.node._cullingMask,e.node=this._renderNode,e._flushIA(a))}!cc.macro.SHOW_MESH_WIREFRAME&&!cc.macro.SHOW_MESH_NORMAL||t.node._cullingMask&1<<cc.Node.BuiltinGroupIndex.DEBUG||(e._flush(),e.node=this._renderNode,t._updateDebugDatas(),cc.macro.SHOW_MESH_WIREFRAME&&this._drawDebugDatas(t,e,"wireFrame"),cc.macro.SHOW_MESH_NORMAL&&this._drawDebugDatas(t,e,"normal"))}},r._fillBuffer=function(h,t,e,i){var n=t.getVData(Float32Array),r=t.vfm,s=n.byteLength/r._bytes|0,o=t.getIData(Uint16Array),a=o.length,t=e.getBuffer("mesh",r),c=t.request(s,a),u=c.indiceOffset,_=c.byteOffset>>2,d=c.vertexOffset,c=t._vData,f=t._iData;!e.worldMatDirty&&this._worldDatas[i]||this._updateWorldVertices(i,s,n,r,h.node._worldMatrix),c.set(this._worldDatas[i],_);for(var l=0;l<a;l++)f[u+l]=d+o[l]},r._updateWorldVertices=function(t,e,i,n,h){for(var r=this._worldDatas[t],u=(r||(r=this._worldDatas[t]=new Float32Array(i.length)).set(i),n._bytes/4),s=n._elements,o=0,_=s.length;o<_;o++){var a=s[o],d=a.offset/4;if(a.name===p.default.ATTR_POSITION||a.name===p.default.ATTR_NORMAL)for(var f=a.name===p.default.ATTR_NORMAL?m.default.transformMat4Normal:m.default.transformMat4,c=0;c<e;c++){var l=c*u+d;y.x=i[l],y.y=i[1+l],y.z=i[2+l],f(y,y,h),r[l]=y.x,r[1+l]=y.y,r[2+l]=y.z}}},r._drawDebugDatas=function(t,e,i){var n=t._debugDatas[i];if(n)for(var r=0;r<n.length;r++){var s,o=n[r];o&&(s=o.material,e.material=s,e._flushIA(o.ia))}},o);function o(){return n.apply(this,arguments)||this}e.default=s,c.default.register(t,s),a.exports=e.default},{"../../renderer/gfx":312,"../renderer/assembler":217,"../value-types/vec3":289,"./CCMeshRenderer":157}],161:[function(t,c,l){"use strict";var i=t("./component-scheduler"),e=t("./platform/CCObject").Flags,_=t("./platform/js"),s=e.IsPreloadStarted,o=e.IsOnLoadStarted,r=e.IsOnLoadCalled,d=e.Deactivating,h=cc.Class({extends:i.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){i.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),u=i.createInvokeImpl(function(t){t.__preload()},!1,void 0,function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].__preload()}),f=i.createInvokeImpl(function(t){t.onLoad(),t._objFlags|=r},!1,r,function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];i.onLoad(),i._objFlags|=r}}),a=new _.Pool(4);function n(){this._activatingStack=[]}a.get=function(){var t=this._get()||{preload:new h(u),onLoad:new i.OneOffInvoker(f),onEnable:new i.OneOffInvoker(i.invokeOnEnable)},e=(t.preload._zero.i=-1,t.onLoad);return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};t=cc.Class({ctor:n,reset:n,_activateNodeRecursively:function(t,e,i,n){if(t._objFlags&d)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;for(var r,s,h=t._components.length,o=0;o<h;++o){var a=t._components[o];a instanceof cc.Component?this.activateComp(a,e,i,n):(r=t,s=o,(a=a)?r._removeComponent(a):_.array.removeAt(r._components,s),--o,--h)}t._childArrivalOrder=t._children.length;for(var c=0,u=t._children.length;c<u;++c){var l=t._children[c];l._localZOrder=4294901760&l._localZOrder|c+1,l._active&&this._activateNodeRecursively(l,e,i,n)}t._onPostActivated(!0)}},_deactivateNodeRecursively:function(t){t._objFlags|=d,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var n=t._components[i];if(n._enabled&&(cc.director._compScheduler.disableComp(n),t._activeInHierarchy))return void(t._objFlags&=~d)}for(var r=0,s=t._children.length;r<s;++r){var o=t._children[r];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~d)}t._onPostActivated(!1),t._objFlags&=~d},activateNode:function(t,e){if(e){e=a.get();this._activatingStack.push(e),this._activateNodeRecursively(t,e.preload,e.onLoad,e.onEnable),e.preload.invoke(),e.onLoad.invoke(),e.onEnable.invoke(),this._activatingStack.pop(),a.put(e)}else{this._deactivateNodeRecursively(t);for(var i=this._activatingStack,n=0;n<i.length;n++){var r=i[n];r.preload.cancelInactive(s),r.onLoad.cancelInactive(o),r.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,e,i,n){cc.isValid(t,!0)&&(t._objFlags&s||(t._objFlags|=s,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&o||(t._objFlags|=o,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=r):t._objFlags|=r),!t._enabled||t.node._activeInHierarchy&&cc.director._compScheduler.enableComp(t,n))},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&r&&t.onDestroy()},resetComp:!1});c.exports=t},{"./component-scheduler":72,"./platform/CCObject":195,"./platform/js":209,"./utils/misc":264}],162:[function(t,r,o){"use strict";var l=t("./CCPhysicsTypes").PTM_RATIO,h=t("./CCPhysicsTypes").ContactType,i=[],d=[cc.v2(),cc.v2()],c=new b2.WorldManifold,u={points:[],separations:[],normal:cc.v2()};function e(){this.localPoint=cc.v2(),this.normalImpulse=0,this.tangentImpulse=0}var f=[new e,new e],_=(new b2.Manifold,{type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]}),s={normalImpulses:[],tangentImpulses:[]};function n(){}n.prototype.init=function(t){this.colliderA=t.GetFixtureA().collider,this.colliderB=t.GetFixtureB().collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,(this._b2contact=t)._contact=this},n.prototype.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact._contact=null,this._b2contact=null},n.prototype.getWorldManifold=function(){var t=u.points,e=u.separations,i=u.normal,n=(this._b2contact.GetWorldManifold(c),c.points),r=c.separations,s=this._b2contact.GetManifold().pointCount;t.length=e.length=s;for(var o=0;o<s;o++){var a=d[o];a.x=n[o].x*l,a.y=n[o].y*l,t[o]=a,e[o]=r[o]*l}return i.x=c.normal.x,i.y=c.normal.y,this._inverted&&(i.x*=-1,i.y*=-1),u},n.prototype.getManifold=function(){for(var t=_.points,e=_.localNormal,i=_.localPoint,n=this._b2contact.GetManifold(),r=n.points,s=t.length=n.pointCount,o=0;o<s;o++){var a=f[o],c=r[o];a.localPoint.x=c.localPoint.x*l,a.localPoint.Y=c.localPoint.Y*l,a.normalImpulse=c.normalImpulse*l,a.tangentImpulse=c.tangentImpulse,t[o]=a}return i.x=n.localPoint.x*l,i.y=n.localPoint.y*l,e.x=n.localNormal.x,e.y=n.localNormal.y,_.type=n.type,this._inverted&&(e.x*=-1,e.y*=-1),_},n.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;for(var e=s.normalImpulses,i=s.tangentImpulses,n=t.count,r=0;r<n;r++)e[r]=t.normalImpulses[r]*l,i[r]=t.tangentImpulses[r];return i.length=e.length=n,s},n.prototype.emit=function(t){var e;switch(t){case h.BEGIN_CONTACT:e="onBeginContact";break;case h.END_CONTACT:e="onEndContact";break;case h.PRE_SOLVE:e="onPreSolve";break;case h.POST_SOLVE:e="onPostSolve"}var i,n,r,s,o=this.colliderA,a=this.colliderB,t=o.body,c=a.body;if(t.enabledContactListener)for(i=t.node._components,this._inverted=!1,n=0,r=i.length;n<r;n++)(s=i[n])[e]&&s[e](this,o,a);if(c.enabledContactListener)for(i=c.node._components,this._inverted=!0,n=0,r=i.length;n<r;n++)(s=i[n])[e]&&s[e](this,a,o);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},n.get=function(t){var e=0===i.length?new cc.PhysicsContact:i.pop();return e.init(t),e},n.put=function(t){t=t._contact;t&&(i.push(t),t.reset())};t=n.prototype;t.setEnabled=function(t){this._b2contact.SetEnabled(t)},t.isTouching=function(){return this._b2contact.IsTouching()},t.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t/l)},t.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*l},t.setFriction=function(t){this._b2contact.SetFriction(t)},t.getFriction=function(){return this._b2contact.GetFriction()},t.resetFriction=function(){return this._b2contact.ResetFriction()},t.setRestitution=function(t){this._b2contact.SetRestitution(t)},t.getRestitution=function(){return this._b2contact.GetRestitution()},t.resetRestitution=function(){return this._b2contact.ResetRestitution()},n.ContactType=h,cc.PhysicsContact=r.exports=n},{"./CCPhysicsTypes":164}],163:[function(t,r,s){"use strict";var e=t("./CCPhysicsTypes"),i=e.ContactType,c=e.BodyType,d=e.RayCastType,o=e.DrawBits,f=e.PTM_RATIO,h=(e.ANGLE_TO_PHYSICS_ANGLE,e.PHYSICS_ANGLE_TO_ANGLE),u=t("./utils").convertToNodeRotation,_=t("./platform/CCPhysicsDebugDraw"),n=new b2.AABB,p=new b2.Vec2,m=new b2.Vec2,a=cc.v2(),l=cc.Class({mixins:[cc.EventTarget],statics:{DrawBits:o,PTM_RATIO:f,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10,FIXED_TIME_STEP:1/60,MAX_ACCUMULATOR:.2},ctor:function(){this._debugDrawFlags=0,this._debugDrawer=null,this._world=null,this._bodies=[],this._joints=[],this._contactMap={},this._contactID=0,this._delayEvents=[],this._accumulator=0,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.enabledAccumulator=!1},pushDelayEvent:function(t,e,i){this._steping?this._delayEvents.push({target:t,func:e,args:i}):t[e].apply(t,i)},update:function(t){var e=this._world;if(e&&this.enabled){this.emit("before-step"),this._steping=!0;var i=l.VELOCITY_ITERATIONS,n=l.POSITION_ITERATIONS;if(this.enabledAccumulator){this._accumulator+=t;var r=l.FIXED_TIME_STEP,t=l.MAX_ACCUMULATOR;for(this._accumulator>t&&(this._accumulator=t);this._accumulator>r;)e.Step(r,i,n),this._accumulator-=r}else{t=1/cc.game.config.frameRate;e.Step(t,i,n)}this.debugDrawFlags&&(this._checkDebugDrawValid(),this._debugDrawer.clear(),e.DrawDebugData()),this._steping=!1;for(var s=this._delayEvents,o=0,a=s.length;o<a;o++){var c=s[o];c.target[c.func].apply(c.target,c.args)}s.length=0,this._syncNode()}},testPoint:function(t){var e=p.x=t.x/f,t=p.y=t.y/f,i=.2/f,e=(n.lowerBound.x=e-i,n.lowerBound.y=t-i,n.upperBound.x=e+i,n.upperBound.y=t+i,this._aabbQueryCallback),t=(e.init(p),this._world.QueryAABB(e,n),e.getFixture());return t?t.collider:null},testAABB:function(t){n.lowerBound.x=t.xMin/f,n.lowerBound.y=t.yMin/f,n.upperBound.x=t.xMax/f,n.upperBound.y=t.yMax/f;t=this._aabbQueryCallback;return t.init(),this._world.QueryAABB(t,n),t.getFixtures().map(function(t){return t.collider})},rayCast:function(t,e,i){if(t.equals(e))return[];i=i||d.Closest,p.x=t.x/f,p.y=t.y/f,m.x=e.x/f,m.y=e.y/f;var t=this._raycastQueryCallback,n=(t.init(i),this._world.RayCast(t,p,m),t.getFixtures());if(0<n.length){for(var r=t.getPoints(),s=t.getNormals(),o=t.getFractions(),h=[],a=0,u=n.length;a<u;a++){var _=n[a],c=_.collider;if(i===d.AllClosest){var l=h.find(function(t){return t.collider===c});if(l){o[a]<l.fraction&&(l.fixtureIndex=c._getFixtureIndex(_),l.point.x=r[a].x*f,l.point.y=r[a].y*f,l.normal.x=s[a].x,l.normal.y=s[a].y,l.fraction=o[a]);continue}}h.push({collider:c,fixtureIndex:c._getFixtureIndex(_),point:cc.v2(r[a].x*f,r[a].y*f),normal:cc.v2(s[a]),fraction:o[a]})}return h}return[]},syncPosition:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncPosition()},syncRotation:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncRotation()},_registerContactFixture:function(t){this._contactListener.registerContactFixture(t)},_unregisterContactFixture:function(t){this._contactListener.unregisterContactFixture(t)},_addBody:function(t,e){var i=this._world,n=t.node;i&&n&&(t._b2Body=i.CreateBody(e),t._b2Body.body=t,this._bodies.push(t))},_removeBody:function(t){var e=this._world;e&&(t._b2Body.body=null,e.DestroyBody(t._b2Body),t._b2Body=null,cc.js.array.remove(this._bodies,t))},_addJoint:function(t,e){e=this._world.CreateJoint(e);e&&((e._joint=t)._joint=e,this._joints.push(t))},_removeJoint:function(t){t._isValid()&&this._world.DestroyJoint(t._joint),t._joint&&(t._joint._joint=null),cc.js.array.remove(this._joints,t)},_initCallback:function(){var t;this._world?this._contactListener||((t=new cc.PhysicsContactListener).setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback,this._raycastQueryCallback=new cc.PhysicsRayCastCallback):cc.warn("Please init PhysicsManager first")},_init:function(){this.enabled=!0,this.debugDrawFlags=o.e_shapeBit},_getWorld:function(){return this._world},_syncNode:function(){for(var t=this._bodies,e=0,i=t.length;e<i;e++){var n=t[e],r=n.node,s=n._b2Body,o=s.GetPosition(),o=(a.x=o.x*f,a.y=o.y*f,s.GetAngle()*h),s=(null!==r.parent.parent&&(a=r.parent.convertToNodeSpaceAR(a),o=u(r.parent,o)),r._eventMask);r._eventMask=0,r.position=a,r.angle=-o,r._eventMask=s,n.type===c.Animated&&n.resetVelocity()}},_onBeginContact:function(t){cc.PhysicsContact.get(t).emit(i.BEGIN_CONTACT)},_onEndContact:function(t){var e=t._contact;e&&(e.emit(i.END_CONTACT),cc.PhysicsContact.put(t))},_onPreSolve:function(t){t=t._contact;t&&t.emit(i.PRE_SOLVE)},_onPostSolve:function(t,e){t=t._contact;t&&(t._impulse=e,t.emit(i.POST_SOLVE),t._impulse=null)},_checkDebugDrawValid:function(){var t;this._debugDrawer&&this._debugDrawer.isValid||((t=new cc.Node("PHYSICS_MANAGER_DEBUG_DRAW")).zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics),(t=new _(this._debugDrawer)).SetFlags(this.debugDrawFlags),this._world.SetDebugDraw(t))}});cc.js.getset(l.prototype,"enabled",function(){return this._enabled},function(t){var e;t&&!this._world&&((e=new b2.World(new b2.Vec2(0,-10))).SetAllowSleeping(!0),this._world=e,this._initCallback()),this._enabled=t}),cc.js.getset(l.prototype,"debugDrawFlags",function(){return this._debugDrawFlags},function(t){t&&!this._debugDrawFlags?this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!0):!t&&this._debugDrawFlags&&this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!1),t&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t)),(this._debugDrawFlags=t)&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t))}),cc.js.getset(l.prototype,"gravity",function(){var t;return this._world?(t=this._world.GetGravity(),cc.v2(t.x*f,t.y*f)):cc.v2()},function(t){this._world&&this._world.SetGravity(new b2.Vec2(t.x/f,t.y/f))}),cc.PhysicsManager=r.exports=l},{"./CCPhysicsTypes":164,"./platform/CCPhysicsDebugDraw":185,"./utils":187}],164:[function(t,e,i){"use strict";var n=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3}),r=(cc.RigidBodyType=n,cc.Enum({Closest:0,Any:1,AllClosest:2,All:3}));cc.RayCastType=r,e.exports={BodyType:n,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:r,DrawBits:b2.DrawFlags,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI}},{}],165:[function(t,e,i){"use strict";function v(t,e){var i=e.length;return e[t<0?i- -t%i:t%i]}function x(t,e,i){for(var n=[];e<t;)e+=i.length;for(;t<=e;++t)n.push(v(t,i));return n}function b(t,e){return A(t,e)}function A(t,e,i){var n,r;return void 0===i&&(t=v((n=t)-1,r=e),e=v(n,r),i=v(n+1,r)),s(t,e,i)<0}function C(t,e,i){return 0<s(t,e,i)}function S(t,e,i){return 0<=s(t,e,i)}function T(t,e,i){return s(t,e,i)<=0}function w(t,e){var i=e.x-t.x,e=e.y-t.y;return i*i+e*e}function E(t){n(t)||t.reverse()}function n(t){return t.length<3||0<function(t){var e,i=0;for(e=0;e<t.length;e++){var n=(e+1)%t.length;i=(i+=t[e].x*t[n].y)-t[e].y*t[n].x}return i/=2}(t)}function M(t,e,i,n){var r,s=cc.v2(),o=e.y-t.y,e=t.x-e.x,t=o*t.x+e*t.y,a=n.y-i.y,n=i.x-n.x,i=a*i.x+n*i.y,c=o*n-a*e;return r=0,Math.abs(c-r)<=1e-6||(s.x=(n*t-e*i)/c,s.y=(o*i-a*t)/c),s}function s(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)}e.exports={ConvexPartition:function h(t){E(t);for(var e,i,n,u,r=[],_=cc.v2(),d=cc.v2(),s=0,o=0,a=0;a<t.length;++a)if(b(a,t)){for(var f=i=1e8,c=0;c<t.length;++c)C(v(a-1,t),v(a,t),v(c,t))&&T(v(a-1,t),v(a,t),v(c-1,t))&&(n=M(v(a-1,t),v(a,t),v(c,t),v(c-1,t)),A(v(a+1,t),v(a,t),n)&&(e=w(v(a,t),n))<f&&(f=e,_=n,s=c)),C(v(a+1,t),v(a,t),v(c+1,t))&&T(v(a+1,t),v(a,t),v(c,t))&&(n=M(v(a+1,t),v(a,t),v(c,t),v(c+1,t)),C(v(a-1,t),v(a,t),n)&&(e=w(v(a,t),n))<i&&(i=e,o=c,d=n));if(s==(o+1)%t.length){var p,m=_.add(d).div(2);(p=x(a,o,t)).push(m),(u=x(s,a,t)).push(m)}else{for(var y=0,g=s;o<s;)o+=t.length;for(var l,c=s;c<=o;++c)!function(t,e,i){if(b(t,i)){if(S(v(t,i),v(t-1,i),v(e,i))&&T(v(t,i),v(t+1,i),v(e,i)))return}else if(T(v(t,i),v(t+1,i),v(e,i))||S(v(t,i),v(t-1,i),v(e,i)))return;if(b(e,i)){if(S(v(e,i),v(e-1,i),v(t,i))&&T(v(e,i),v(e+1,i),v(t,i)))return}else if(T(v(e,i),v(e+1,i),v(t,i))||S(v(e,i),v(e-1,i),v(t,i)))return;for(var n=0;n<i.length;++n)if((n+1)%i.length!=t&&n!=t&&(n+1)%i.length!=e&&n!=e){var r=cc.v2();if(function(t,e,i,n,h){if(t!=i&&t!=n&&e!=i&&e!=n){var r,s,o=t.x,t=t.y,a=e.x,e=e.y,c=i.x,i=i.y,l=n.x,n=n.y;if(!(Math.max(o,a)<Math.min(c,l)||Math.max(c,l)<Math.min(o,a)))if(!(Math.max(t,e)<Math.min(i,n)||Math.max(i,n)<Math.min(t,e)))return r=(l-c)*(t-i)-(n-i)*(o-c),s=(a-o)*(t-i)-(e-t)*(o-c),n=(n-i)*(a-o)-(l-c)*(e-t),Math.abs(n)<1e-6?void 0:(s/=n,0<(r/=n)&&r<1&&0<s&&s<1&&(h.x=o+r*(a-o),h.y=t+r*(e-t),1))}}(v(t,i),v(e,i),v(n,i),v(n+1,i),r))return}return 1}(a,c,t)||(l=1/(w(v(a,t),v(c,t))+1),b(c,t)?T(v(c-1,t),v(c,t),v(a,t))&&S(v(c+1,t),v(c,t),v(a,t))?l+=3:l+=2:l+=1,y<l&&(g=c,y=l));p=x(a,g,t),u=x(g,a,t)}return r=(r=r.concat(h(p))).concat(h(u))}r.push(t);for(a=r.length-1;0<=a;a--)0==r[a].length&&r.splice(a,0);return r},ForceCounterClockWise:E,IsCounterClockWise:n}},{}],166:[function(t,h,u){"use strict";var e=t("../CCNode").EventType,r=t("./CCPhysicsTypes").PTM_RATIO,s=t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,i=t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,o=t("./utils").getWorldRotation,a=t("./CCPhysicsTypes").BodyType,n=new b2.Vec2,c=new b2.Vec2,l=cc.Vec2.ZERO,t=cc.Class({name:"cc.RigidBody",extends:cc.Component,editor:!1,properties:{_type:a.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled},set:function(){cc.warnID(8200)},visible:!1,override:!0},enabledContactListener:{default:!1,tooltip:!1},bullet:{default:!1,tooltip:!1},type:{type:a,tooltip:!1,get:function(){return this._type},set:function(t){this._type=t,this._b2Body&&(t===a.Animated?this._b2Body.SetType(a.Kinematic):this._b2Body.SetType(t))}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep},set:function(t){this._allowSleep=t,this._b2Body&&this._b2Body.SetSleepingAllowed(t)}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._b2Body&&this._b2Body.SetGravityScale(t)}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping)}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._b2Body&&this._b2Body.SetAngularDamping(t)}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var t,e=this._linearVelocity;return this._b2Body&&(t=this._b2Body.GetLinearVelocity(),e.x=t.x*r,e.y=t.y*r),e},set:function(t){this._linearVelocity=t;var e,i=this._b2Body;i&&((e=i.m_linearVelocity).Set(t.x/r,t.y/r),i.SetLinearVelocity(e))}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*i:this._angularVelocity},set:function(t){this._angularVelocity=t,this._b2Body&&this._b2Body.SetAngularVelocity(t*s)}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._b2Body&&this._b2Body.SetFixedRotation(t)}},awake:{visible:!1,tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake()},set:function(t){this._b2Body&&this._b2Body.SetAwake(t)}},awakeOnLoad:{default:!0,tooltip:!1,animatable:!1},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive()},set:function(t){this._b2Body&&this._b2Body.SetActive(t)}}},getLocalPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(n.Set(t.x/r,t.y/r),t=this._b2Body.GetLocalPoint(n,e),e.x=t.x*r,e.y=t.y*r),e},getWorldPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(n.Set(t.x/r,t.y/r),t=this._b2Body.GetWorldPoint(n,e),e.x=t.x*r,e.y=t.y*r),e},getWorldVector:function(t,e){return e=e||cc.v2(),this._b2Body&&(n.Set(t.x/r,t.y/r),t=this._b2Body.GetWorldVector(n,e),e.x=t.x*r,e.y=t.y*r),e},getLocalVector:function(t,e){return e=e||cc.v2(),this._b2Body&&(n.Set(t.x/r,t.y/r),t=this._b2Body.GetLocalVector(n,e),e.x=t.x*r,e.y=t.y*r),e},getWorldPosition:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetPosition(),t.x=e.x*r,t.y=e.y*r),t},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*i:0},getLocalCenter:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetLocalCenter(),t.x=e.x*r,t.y=e.y*r),t},getWorldCenter:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetWorldCenter(),t.x=e.x*r,t.y=e.y*r),t},getLinearVelocityFromWorldPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(n.Set(t.x/r,t.y/r),t=this._b2Body.GetLinearVelocityFromWorldPoint(n,e),e.x=t.x*r,e.y=t.y*r),e},getMass:function(){return this._b2Body?this._b2Body.GetMass():0},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*r*r:0},getJointList:function(){if(!this._b2Body)return[];var t=[],e=this._b2Body.GetJointList();if(!e)return[];t.push(e.joint._joint);for(var i=e.prev;i;)t.push(i.joint._joint),i=i.prev;for(var n=e.next;n;)t.push(n.joint._joint),n=n.next;return t},applyForce:function(t,e,i){this._b2Body&&(n.Set(t.x/r,t.y/r),c.Set(e.x/r,e.y/r),this._b2Body.ApplyForce(n,c,i))},applyForceToCenter:function(t,e){this._b2Body&&(n.Set(t.x/r,t.y/r),this._b2Body.ApplyForceToCenter(n,e))},applyTorque:function(t,e){this._b2Body&&this._b2Body.ApplyTorque(t/r,e)},applyLinearImpulse:function(t,e,i){this._b2Body&&(n.Set(t.x/r,t.y/r),c.Set(e.x/r,e.y/r),this._b2Body.ApplyLinearImpulse(n,c,i))},applyAngularImpulse:function(t,e){this._b2Body&&this._b2Body.ApplyAngularImpulse(t/r/r,e)},syncPosition:function(t){var e,i,n=this._b2Body;n&&(e=this.node.convertToWorldSpaceAR(l),(i=this.type===a.Animated?n.GetLinearVelocity():n.GetPosition()).x=e.x/r,i.y=e.y/r,this.type===a.Animated&&t?(e=n.GetPosition(),t=cc.game.config.frameRate,i.x=(i.x-e.x)*t,i.y=(i.y-e.y)*t,n.SetAwake(!0),n.SetLinearVelocity(i)):n.SetTransformVec(i,n.GetAngle()))},syncRotation:function(t){var e,i,n=this._b2Body;n&&(e=s*o(this.node),this.type===a.Animated&&t?(t=n.GetAngle(),i=cc.game.config.frameRate,n.SetAwake(!0),n.SetAngularVelocity((e-t)*i)):n.SetTransformVec(n.GetPosition(),e))},resetVelocity:function(){var t,e=this._b2Body;e&&((t=e.m_linearVelocity).Set(0,0),e.SetLinearVelocity(t),e.SetAngularVelocity(0))},onEnable:function(){this._init()},onDisable:function(){this._destroy()},_registerNodeEvents:function(){var t=this.node;t.on(e.POSITION_CHANGED,this._onNodePositionChanged,this),t.on(e.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.on(e.SCALE_CHANGED,this._onNodeScaleChanged,this)},_unregisterNodeEvents:function(){var t=this.node;t.off(e.POSITION_CHANGED,this._onNodePositionChanged,this),t.off(e.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.off(e.SCALE_CHANGED,this._onNodeScaleChanged,this)},_onNodePositionChanged:function(){this.syncPosition(!0)},_onNodeRotationChanged:function(t){this.syncRotation(!0)},_onNodeScaleChanged:function(t){if(this._b2Body)for(var e=this.getComponents(cc.PhysicsCollider),i=0;i<e.length;i++)e[i].apply()},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){var t,e,i;this._inited||(this._registerNodeEvents(),t=new b2.BodyDef,this.type===a.Animated?t.type=a.Kinematic:t.type=this.type,t.allowSleep=this.allowSleep,t.gravityScale=this.gravityScale,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping,e=this.linearVelocity,t.linearVelocity=new b2.Vec2(e.x/r,e.y/r),t.angularVelocity=this.angularVelocity*s,t.fixedRotation=this.fixedRotation,t.bullet=this.bullet,i=(e=this.node).convertToWorldSpaceAR(l),t.position=new b2.Vec2(i.x/r,i.y/r),t.angle=-Math.PI/180*o(e),t.awake=this.awakeOnLoad,cc.director.getPhysicsManager()._addBody(this,t),this._inited=!0)},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},_getBody:function(){return this._b2Body}});cc.RigidBody=h.exports=t},{"../CCNode":30,"./CCPhysicsTypes":164,"./utils":187}],167:[function(t,e,i){"use strict";var n,r,s=t("../../../external/box2d/box2d");for(n in window.b2={},s)-1===n.indexOf("b2_")&&(r=n.replace("b2",""),b2[r]=s[n]);b2.maxPolygonVertices=8},{"../../../external/box2d/box2d":362}],168:[function(t,e,i){"use strict";var s=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.PhysicsBoxCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),t=Math.abs(t.y),i=this.size.width/2/s*e,n=this.size.height/2/s*t,e=this.offset.x/s*e,t=this.offset.y/s*t,r=new b2.PolygonShape;return r.SetAsBox(i,n,new b2.Vec2(e,t),0),r}});cc.PhysicsBoxCollider=e.exports=t},{"../CCPhysicsTypes":164}],169:[function(t,e,i){"use strict";var o=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.PhysicsChainCollider",extends:cc.PhysicsCollider,editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},properties:{loop:!1,points:{default:function(){return[cc.v2(-50,0),cc.v2(50,0)]},type:[cc.Vec2]},threshold:{default:1,serializable:!1,visible:!1}},_createShape:function(t){for(var e=new b2.ChainShape,i=this.points,n=[],r=0;r<i.length;r++){var s=i[r];n.push(new b2.Vec2(s.x/o*t.x,s.y/o*t.y))}return this.loop?e.CreateLoop(n,n.length):e.CreateChain(n,n.length),e},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=e.exports=t},{"../CCPhysicsTypes":164}],170:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.PhysicsCircleCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),t=Math.abs(t.y),i=this.offset.x/r*e,t=this.offset.y/r*t,n=new b2.CircleShape;return n.m_radius=this.radius/r*e,n.m_p=new b2.Vec2(i,t),n}});cc.PhysicsCircleCollider=e.exports=t},{"../CCPhysicsTypes":164}],171:[function(t,e,i){"use strict";var u=t("../CCPhysicsTypes").PTM_RATIO,d=t("../utils").getWorldScale,t=cc.Class({name:"cc.PhysicsCollider",extends:cc.Collider,ctor:function(){this._fixtures=[],this._shapes=[],this._inited=!1,this._rect=cc.rect()},properties:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density},set:function(t){this._density=t}},sensor:{tooltip:!1,get:function(){return this._sensor},set:function(t){this._sensor=t}},friction:{tooltip:!1,get:function(){return this._friction},set:function(t){this._friction=t}},restitution:{tooltip:!1,get:function(){return this._restitution},set:function(t){this._restitution=t}},body:{default:null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},_getFixtureIndex:function(t){return this._fixtures.indexOf(t)},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){var t=this.body||this.getComponent(cc.RigidBody);if(t){var e=t._getBody();if(e){for(var i=t.node,n=d(i),r=0===(this._scale=n).x&&0===n.y?[]:this._createShape(n),n=(r instanceof Array||(r=[r]),1<<i.groupIndex),s=0,o=cc.game.collisionMatrix[i.groupIndex],a=0;a<o.length;a++)o[a]&&(s|=1<<a);for(var h={categoryBits:n,maskBits:s,groupIndex:0},u=cc.director.getPhysicsManager(),c=0;c<r.length;c++){var _=r[c],l=new b2.FixtureDef,l=(l.density=this.density,l.isSensor=this.sensor,l.friction=this.friction,l.restitution=this.restitution,l.shape=_,l.filter=h,e.CreateFixture(l));l.collider=this,t.enabledContactListener&&u._registerContactFixture(l),this._shapes.push(_),this._fixtures.push(l)}this.body=t,this._inited=!0}}}},__destroy:function(){if(this._inited){for(var t=this._fixtures,e=this.body._getBody(),i=cc.director.getPhysicsManager(),n=t.length-1;0<=n;n--){var r=t[n];r.collider=null,i._unregisterContactFixture(r),e&&e.DestroyFixture(r)}this.body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},_createShape:function(){},apply:function(){this._destroy(),this._init()},getAABB:function(){for(var t=1e7,e=1e7,i=-1e7,n=-1e7,r=this._fixtures,s=0;s<r.length;s++)for(var o=r[s],h=o.GetShape().GetChildCount(),a=0;a<h;a++){var c=o.GetAABB(a);c.lowerBound.x<t&&(t=c.lowerBound.x),c.lowerBound.y<e&&(e=c.lowerBound.y),c.upperBound.x>i&&(i=c.upperBound.x),c.upperBound.y>n&&(n=c.upperBound.y)}e*=u,i*=u,n*=u;var l=this._rect;return l.x=t*=u,l.y=e,l.width=i-t,l.height=n-e,l}});cc.PhysicsCollider=e.exports=t},{"../CCPhysicsTypes":164,"../utils":187}],172:[function(t,e,i){"use strict";var f=t("../CCPhysicsTypes").PTM_RATIO,p=t("../CCPolygonSeparator"),t=cc.Class({name:"cc.PhysicsPolygonCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},_createShape:function(t){for(var e=[],i=this.points,h=(0<i.length&&i[0].equals(i[i.length-1])&&--i.length,p.ConvexPartition(i)),u=this.offset,n=0;n<h.length;n++){for(var _=h[n],r=null,s=[],o=null,a=0,d=_.length;a<d;a++){var r=r||new b2.PolygonShape,c=_[a],l=(c.x+u.x)/f*t.x,c=(c.y+u.y)/f*t.y,l=new b2.Vec2(l,c);s.push(l),o=o||l,s.length===b2.maxPolygonVertices&&(r.Set(s,s.length),e.push(r),r=null,a<d-1&&(s=[o,s[s.length-1]]))}r&&(r.Set(s,s.length),e.push(r))}return e}});cc.PhysicsPolygonCollider=e.exports=t},{"../CCPhysicsTypes":164,"../CCPolygonSeparator":165}],173:[function(t,e,i){"use strict";t("./box2d-adapter"),t("./CCPhysicsManager"),t("./CCRigidBody"),t("./CCPhysicsContact"),t("./collider/CCPhysicsCollider"),t("./collider/CCPhysicsChainCollider"),t("./collider/CCPhysicsCircleCollider"),t("./collider/CCPhysicsBoxCollider"),t("./collider/CCPhysicsPolygonCollider"),t("./joint/CCJoint"),t("./joint/CCDistanceJoint"),t("./joint/CCRevoluteJoint"),t("./joint/CCMouseJoint"),t("./joint/CCMotorJoint"),t("./joint/CCPrismaticJoint"),t("./joint/CCWeldJoint"),t("./joint/CCWheelJoint"),t("./joint/CCRopeJoint"),t("./platform/CCPhysicsContactListner"),t("./platform/CCPhysicsAABBQueryCallback"),t("./platform/CCPhysicsRayCastCallback")},{"./CCPhysicsContact":162,"./CCPhysicsManager":163,"./CCRigidBody":166,"./box2d-adapter":167,"./collider/CCPhysicsBoxCollider":168,"./collider/CCPhysicsChainCollider":169,"./collider/CCPhysicsCircleCollider":170,"./collider/CCPhysicsCollider":171,"./collider/CCPhysicsPolygonCollider":172,"./joint/CCDistanceJoint":174,"./joint/CCJoint":175,"./joint/CCMotorJoint":176,"./joint/CCMouseJoint":177,"./joint/CCPrismaticJoint":178,"./joint/CCRevoluteJoint":179,"./joint/CCRopeJoint":180,"./joint/CCWeldJoint":181,"./joint/CCWheelJoint":182,"./platform/CCPhysicsAABBQueryCallback":183,"./platform/CCPhysicsContactListner":184,"./platform/CCPhysicsRayCastCallback":186}],174:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.DistanceJoint",extends:cc.Joint,editor:!1,properties:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance},set:function(t){this._distance=t,this._joint&&this._joint.SetLength(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.DistanceJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.length=this.distance/n,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.DistanceJoint=e.exports=t},{"../CCPhysicsTypes":164}],175:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.Joint",extends:cc.Component,editor:{requireComponent:cc.RigidBody},properties:{anchor:{default:cc.v2(0,0),tooltip:!1},connectedAnchor:{default:cc.v2(0,0),tooltip:!1},connectedBody:{default:null,type:cc.RigidBody,tooltip:!1},collideConnected:{default:!1,tooltip:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},apply:function(){this._destroy(),this._init()},getWorldAnchor:function(){var t;return this._joint?(t=this._joint.GetAnchorA(),cc.v2(t.x*n,t.y*n)):cc.Vec2.ZERO},getWorldConnectedAnchor:function(){var t;return this._joint?(t=this._joint.GetAnchorB(),cc.v2(t.x*n,t.y*n)):cc.Vec2.ZERO},getReactionForce:function(t){var e=cc.v2();return this._joint?this._joint.GetReactionForce(t,e):e},getReactionTorque:function(t){return this._joint?this._joint.GetReactionTorque(t):0},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){var t;this._inited||(this.body=this.getComponent(cc.RigidBody),!this._isValid()||(t=this._createJointDef())&&(t.bodyA=this.body._getBody(),t.bodyB=this.connectedBody._getBody(),t.collideConnected=this.collideConnected,cc.director.getPhysicsManager()._addJoint(this,t),this._inited=!0))},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeJoint(this),this._joint=null,this._inited=!1)},_createJointDef:function(){return null},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody()}});cc.Joint=e.exports=t},{"../CCPhysicsTypes":164}],176:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.MotorJoint",extends:cc.Joint,editor:!1,properties:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new b2.Vec2(t.x/n,t.y/n))}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t)}},maxForce:{tooltip:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t)}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t)}}},_createJointDef:function(){var t=new b2.MotorJointDef;return t.linearOffset=new b2.Vec2(this.linearOffset.x/n,this.linearOffset.y/n),t.angularOffset=this.angularOffset*r,t.maxForce=this.maxForce,t.maxTorque=this.maxTorque,t.correctionFactor=this.correctionFactor,t}});cc.MotorJoint=e.exports=t},{"../CCPhysicsTypes":164}],177:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=new b2.Vec2,t=cc.Class({name:"cc.MouseJoint",extends:cc.Joint,editor:!1,properties:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{default:null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{default:!0,visible:!1,override:!0},anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,default:null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target},set:function(t){this._target=t,this._joint&&(r.x=t.x/n,r.y=t.y/n,this._joint.SetTarget(r))}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}}},onLoad:function(){var t=this.mouseRegion||this.node;t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},onEnable:function(){},start:function(){},onTouchBegan:function(t){var e=cc.director.getPhysicsManager(),t=this._pressPoint=t.touch.getLocation(),e=(cc.Camera&&cc.Camera.main&&(t=cc.Camera.main.getScreenToWorldPoint(t)),e.testPoint(t));e&&((this.connectedBody=e.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=t,this._init())},onTouchMove:function(t){this._pressPoint=t.touch.getLocation()},onTouchEnd:function(t){this._destroy(),this._pressPoint=null},_createJointDef:function(){var t=new b2.MouseJointDef;return r.x=this.target.x/n,r.y=this.target.y/n,t.target=r,t.maxForce=this.maxForce,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t},update:function(){var t;this._pressPoint&&this._isValid()&&(t=cc.Camera.findCamera(this.node),this.target=t?t.getScreenToWorldPoint(this._pressPoint):this._pressPoint)}});cc.MouseJoint=e.exports=t},{"../CCPhysicsTypes":164}],178:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.PrismaticJoint",extends:cc.Joint,editor:!1,properties:{localAxisA:{default:cc.v2(1,0),tooltip:!1},referenceAngle:{default:0,tooltip:!1},enableLimit:{default:!1,tooltip:!1},enableMotor:{default:!1,tooltip:!1},lowerLimit:{default:0,tooltip:!1},upperLimit:{default:0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}}},_createJointDef:function(){var t=new b2.PrismaticJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.referenceAngle=this.referenceAngle*r,t.enableLimit=this.enableLimit,t.lowerTranslation=this.lowerLimit/n,t.upperTranslation=this.upperLimit/n,t.enableMotor=this.enableMotor,t.maxMotorForce=this.maxMotorForce,t.motorSpeed=this.motorSpeed,t}});cc.PrismaticJoint=e.exports=t},{"../CCPhysicsTypes":164}],179:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,t=cc.Class({name:"cc.RevoluteJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{default:0,tooltip:!1},lowerAngle:{default:0,tooltip:!1},upperAngle:{default:0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*s:0},setLimits:function(t,e){if(this._joint)return this._joint.SetLimits(t*r,e*r)},_createJointDef:function(){var t=new b2.RevoluteJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.lowerAngle=this.upperAngle*r,t.upperAngle=this.lowerAngle*r,t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableLimit=this.enableLimit,t.enableMotor=this.enableMotor,t.referenceAngle=this.referenceAngle*r,t}});cc.RevoluteJoint=e.exports=t},{"../CCPhysicsTypes":164}],180:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,t=cc.Class({name:"cc.RopeJoint",extends:cc.Joint,editor:!1,properties:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t)}}},_createJointDef:function(){var t=new b2.RopeJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.maxLength=this.maxLength/n,t}});cc.RopeJoint=e.exports=t},{"../CCPhysicsTypes":164}],181:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.WeldJoint",extends:cc.Joint,editor:!1,properties:{referenceAngle:{default:0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WeldJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.referenceAngle=this.referenceAngle*r,t.frequencyHz=this.frequency,t.dampingRatio=this.dampingRatio,t}});cc.WeldJoint=e.exports=t},{"../CCPhysicsTypes":164}],182:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t=cc.Class({name:"cc.WheelJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{default:cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetSpringFrequencyHz(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WheelJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableMotor=this.enableMotor,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.WheelJoint=e.exports=t},{"../CCPhysicsTypes":164}],183:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").BodyType;function r(){this._point=new b2.Vec2,this._isPoint=!1,this._fixtures=[]}r.prototype.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},r.prototype.ReportFixture=function(t){if(t.GetBody().GetType()===n.Dynamic)if(this._isPoint){if(t.TestPoint(this._point))return this._fixtures.push(t),!1}else this._fixtures.push(t);return!0},r.prototype.getFixture=function(){return this._fixtures[0]},r.prototype.getFixtures=function(){return this._fixtures},cc.PhysicsAABBQueryCallback=e.exports=r},{"../CCPhysicsTypes":164}],184:[function(t,e,i){"use strict";function n(){this._contactFixtures=[]}n.prototype.setBeginContact=function(t){this._BeginContact=t},n.prototype.setEndContact=function(t){this._EndContact=t},n.prototype.setPreSolve=function(t){this._PreSolve=t},n.prototype.setPostSolve=function(t){this._PostSolve=t},n.prototype.BeginContact=function(t){var e,i,n;this._BeginContact&&(e=t.GetFixtureA(),i=t.GetFixtureB(),n=this._contactFixtures,t._shouldReport=!1,-1===n.indexOf(e)&&-1===n.indexOf(i)||(t._shouldReport=!0,this._BeginContact(t)))},n.prototype.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},n.prototype.PreSolve=function(t,e){this._PreSolve&&t._shouldReport&&this._PreSolve(t,e)},n.prototype.PostSolve=function(t,e){this._PostSolve&&t._shouldReport&&this._PostSolve(t,e)},n.prototype.registerContactFixture=function(t){this._contactFixtures.push(t)},n.prototype.unregisterContactFixture=function(t){cc.js.array.remove(this._contactFixtures,t)},cc.PhysicsContactListener=e.exports=n},{}],185:[function(t,e,i){"use strict";var o=t("../CCPhysicsTypes").PTM_RATIO,a=cc.v2(),n=cc.Color.GREEN,r=cc.Color.RED;function s(t){b2.Draw.call(this),this._drawer=t,this._xf=this._dxf=new b2.Transform}cc.js.extend(s,b2.Draw),cc.js.mixin(s.prototype,{_DrawPolygon:function(t,e){for(var i=this._drawer,n=0;n<e;n++){b2.Transform.MulXV(this._xf,t[n],a);var r=a.x*o,s=a.y*o;0===n?i.moveTo(r,s):i.lineTo(r,s)}i.close()},DrawPolygon:function(t,e,i){this._applyStrokeColor(i),this._DrawPolygon(t,e),this._drawer.stroke()},DrawSolidPolygon:function(t,e,i){this._applyFillColor(i),this._DrawPolygon(t,e),this._drawer.fill(),this._drawer.stroke()},_DrawCircle:function(t,e){var i=this._xf.p;this._drawer.circle((t.x+i.x)*o,(t.y+i.y)*o,e*o)},DrawCircle:function(t,e,i){this._applyStrokeColor(i),this._DrawCircle(t,e),this._drawer.stroke()},DrawSolidCircle:function(t,e,i,n){this._applyFillColor(n),this._DrawCircle(t,e),this._drawer.fill()},DrawSegment:function(t,e,i){var n=this._drawer;if(t.x===e.x&&t.y===e.y)return this._applyFillColor(i),this._DrawCircle(t,2/o),void n.fill();this._applyStrokeColor(i),b2.Transform.MulXV(this._xf,t,a),n.moveTo(a.x*o,a.y*o),b2.Transform.MulXV(this._xf,e,a),n.lineTo(a.x*o,a.y*o),n.stroke()},DrawTransform:function(t){var e=this._drawer;e.strokeColor=r,a.x=a.y=0,b2.Transform.MulXV(t,a,a),e.moveTo(a.x*o,a.y*o),a.x=1,a.y=0,b2.Transform.MulXV(t,a,a),e.lineTo(a.x*o,a.y*o),e.stroke(),e.strokeColor=n,a.x=a.y=0,b2.Transform.MulXV(t,a,a),e.moveTo(a.x*o,a.y*o),a.x=0,a.y=1,b2.Transform.MulXV(t,a,a),e.lineTo(a.x*o,a.y*o),e.stroke()},DrawPoint:function(t,e,i){},_applyStrokeColor:function(t){var e=this._drawer.strokeColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.strokeColor=e},_applyFillColor:function(t){var e=this._drawer.fillColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.fillColor=e},PushTransform:function(t){this._xf=t},PopTransform:function(){this._xf=this._dxf}}),e.exports=s},{"../CCPhysicsTypes":164}],186:[function(t,e,i){"use strict";function n(){this._type=0,this._fixtures=[],this._points=[],this._normals=[],this._fractions=[]}n.prototype.init=function(t){this._type=t,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},n.prototype.ReportFixture=function(t,e,i,n){return 0===this._type?(this._fixtures[0]=t,this._points[0]=e,this._normals[0]=i,this._fractions[0]=n):(this._fixtures.push(t),this._points.push(cc.v2(e)),this._normals.push(cc.v2(i)),this._fractions.push(n),1===this._type?0:2<=this._type?1:n)},n.prototype.getFixtures=function(){return this._fixtures},n.prototype.getPoints=function(){return this._points},n.prototype.getNormals=function(){return this._normals},n.prototype.getFractions=function(){return this._fractions},cc.PhysicsRayCastCallback=e.exports=n},{}],187:[function(t,e,i){"use strict";e.exports={getWorldRotation:function(t){for(var e=t.angle,i=t.parent;i.parent;)e+=i.angle,i=i.parent;return-e},getWorldScale:function(t){for(var e=t.scaleX,i=t.scaleY,n=t.parent;n.parent;)e*=n.scaleX,i*=n.scaleY,n=n.parent;return cc.v2(e,i)},convertToNodeRotation:function(t,e){e-=-t.angle;for(var i=t.parent;i.parent;)e-=-i.angle,i=i.parent;return e}}},{}],188:[function(t,i,r){"use strict";t("../assets/CCAsset");var s=t("./utils").callInNextTick,y=t("../load-pipeline/CCLoader"),C=t("../load-pipeline/asset-table"),S=t("../load-pipeline/pack-downloader"),a=t("../load-pipeline/auto-release-utils"),g=t("../utils/decode-uuid"),T=t("../load-pipeline/md5-pipe"),w=t("../load-pipeline/subpackage-pipe"),v=t("./js"),x="",b="",A=v.createMap(!0);function c(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}function E(t,e){this.url=t,this.type=e}var e={loadAsset:function(n,r,t){if("string"!=typeof n)return s(r,new Error("[AssetLibrary] uuid must be string"),null);var e={uuid:n,type:"uuid"};t&&t.existingAsset&&(e.existingAsset=t.existingAsset),y.load(e,function(t,e){var i;t||!e?(i="string"==typeof t?t:t?t.message||t.errorMessage||JSON.stringify(t):"Unknown error",t=new Error("[AssetLibrary] loading JSON or dependencies failed:"+i)):(e.constructor===cc.SceneAsset&&(i=cc.loader._getReferenceKey(n),e.scene.dependAssets=a.getDependsRecursively(i)),c(e)&&(i=cc.loader._getReferenceKey(n),y.removeItem(i))),r&&r(t,e)})},getLibUrlNoExt:function(t,e){return t=g(t),(e?b+"assets/":x)+t.slice(0,2)+"/"+t},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t,e){e=e||{url:null,raw:!1};var i=A[t];return i&&!v.isChildClassOf(i.type,cc.Asset)?(e.url=b+i.url,e.raw=!0):(e.url=this.getLibUrlNoExt(t)+".json",e.raw=!1),e},_uuidInSettings:function(t){return t in A},queryAssetInfo:function(t,e){t=this._getAssetInfoInRuntime(t);e(null,t.url,t.raw)},parseUuidInEditor:function(t){},loadJson:function(t,n){var r=""+((new Date).getTime()+Math.random()),t={uuid:r,type:"uuid",content:t,skips:[y.assetLoader.id,y.downloader.id]};y.load(t,function(t,e){var i;t?t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message):(e.constructor===cc.SceneAsset&&(i=cc.loader._getReferenceKey(r),e.scene.dependAssets=a.getDependsRecursively(i)),c(e)&&(i=cc.loader._getReferenceKey(r),y.removeItem(i))),e._uuid="",n&&n(t,e)})},getAssetByUuid:function(t){return e._uuidToAsset[t]||null},init:function(t){var e=(e=t.libraryPath).replace(/\\/g,"/"),e=(x=cc.path.stripSep(e)+"/",b=t.rawAssetsBase,t.subpackages&&(e=new w(t.subpackages),cc.loader.insertPipeAfter(cc.loader.assetLoader,e),cc.loader.subPackPipe=e),t.md5AssetsMap);if(e&&e.import){for(var i=0,n=0,h=v.createMap(!0),r=e.import,i=0;i<r.length;i+=2)h[n=g(r[i])]=r[i+1];var u=v.createMap(!0),r=e["raw-assets"];for(i=0;i<r.length;i+=2)u[n=g(r[i])]=r[i+1];e=new T(h,u,x);cc.loader.insertPipeAfter(cc.loader.assetLoader,e),cc.loader.md5Pipe=e}var _,s=y._assetTables;for(_ in s)s[_].reset();var o=t.rawAssets;if(o)for(var a in o){var d=o[a];for(n in d){var c,f=d[n],l=f[0],p=f[1],m=cc.js._getClassById(p);m?(A[n]=new E(a+"/"+l,m),c=((c=cc.path.extname(l))&&(l=l.slice(0,-c.length)),1===f[2]),s[a]||(s[a]=new C),s[a].add(l,n,m,!c)):cc.error("Cannot get",p)}}t.packedAssets&&S.initPacks(t.packedAssets),cc.url._init(t.mountPaths&&t.mountPaths.assets||b+"assets")},_uuidToAsset:{}},n={effect:{},material:{}},o={};function l(t,e,r){var i=t+"s",s=n[t]={};cc.loader.loadResDir(i,e,"internal",function(){},function(t,e){if(t)cc.error(t);else for(var i=0;i<e.length;i++){var n=e[i];cc.loader.getDependsRecursively(n).forEach(function(t){return o[t]=!0}),s[""+n.name]=n}r()})}e._loadBuiltins=function(t){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)return t&&t();l("effect",cc.EffectAsset,function(){l("material",cc.Material,t)})},e.getBuiltin=function(t,e){return n[t][e]},e.getBuiltins=function(t){return t?n[t]:n},e.resetBuiltins=function(){n={effect:{},material:{}},o={}},e.getBuiltinDeps=function(){return o},i.exports=cc.AssetLibrary=e},{"../assets/CCAsset":34,"../load-pipeline/CCLoader":136,"../load-pipeline/asset-table":138,"../load-pipeline/auto-release-utils":140,"../load-pipeline/md5-pipe":147,"../load-pipeline/pack-downloader":148,"../load-pipeline/subpackage-pipe":151,"../utils/decode-uuid":258,"./js":209,"./utils":213}],189:[function(t,i,n){"use strict";var g=t("./js"),l=t("./CCEnum"),e=t("./utils"),v=(e.isPlainEmptyObj_DEV,e.cloneable_DEV,t("./attribute")),x=v.DELIMETER,b=t("./preprocess-class"),h=(t("./requiring-frame"),["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"]);function f(t,e){t.indexOf(e)<0&&t.push(e)}var u={datas:null,push:function(t){var e;this.datas?this.datas.push(t):(this.datas=[t],e=this,setTimeout(function(){e.init()},0))},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props,s=("function"==typeof r&&(r=r()),g.getClassName(n));r?C(n,s,r,n.$super,i.mixins):cc.errorID(3633,s)}this.datas=null}}};function A(t,e,i,n){var r=n.default;v.setClassAttr(t,i,"default",r),f(t.__props__,i),T(t,n,0,i)}function r(t){return"function"==typeof t?t():t}function _(t,e,i){for(var n in e)t.hasOwnProperty(n)||i&&!i(n)||Object.defineProperty(t,n,g.getPropertyDescriptor(e,n))}function p(h,t,e,i){var n,r,s=i.__ctor__,u=i.ctor,o=i.__ES6__,a=(o?(n=[u],r=u):(n=s?[s]:function(t,e,i){for(var n=[],r=[t].concat(e),s=0;s<r.length;s++){var o=r[s];if(o)for(var a=function(t){return d._isCCClass(t)?t.__ctors__||[]:[t]}(o),c=0;c<a.length;c++)f(n,a[c])}t=i.ctor;return t&&n.push(t),n}(t,e,i),r=y(n,t,0,i),g.value(r,"extend",function(t){return t.extends=this,d(t)},!0)),g.value(r,"__ctors__",0<n.length?n:null,!0),r.prototype);if(t&&(o||(g.extend(r,t),a=r.prototype),r.$super=t),e){for(var c=e.length-1;0<=c;c--){var l=e[c];_(a,l.prototype),_(r,l,function(t){return l.hasOwnProperty(t)&&!0}),d._isCCClass(l)&&_(v.getClassAttrs(r),v.getClassAttrs(l))}a.constructor=r}return o||(a.__initProps__=m),g.setClassName(h,r),r}function s(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e=/^[A-Za-z_$][0-9A-Za-z_$]*$/;function m(t){var e=v.getClassAttrs(t),i=t.__props__,e=(null===i&&(u.init(),i=t.__props__),function(t,e){for(var r=[],s=[],o=[],a=[],i=0;i<e.length;++i){var n=e[i],c=n+x+"default";c in t&&("object"==typeof(c=t[c])&&c||"function"==typeof c?(r.push(n),s.push(c)):(o.push(n),a.push(c)))}return function(){for(var t=0;t<o.length;++t)this[o[t]]=a[t];for(var e=0;e<r.length;e++){var i=r[e],n=s[e],n="object"==typeof n?n instanceof cc.ValueType?n.clone():Array.isArray(n)?[]:{}:n();this[i]=n}}}(e,i));(t.prototype.__initProps__=e).call(this)}function y(e,t,i,n){var r=t&&function(t,e){var i,n=!1;for(i in e)if(!(0<=h.indexOf(i))){var r=e[i];if("function"==typeof r){var s=g.getPropertyDescriptor(t.prototype,i);if(s){s=s.value;if("function"==typeof s){o.test(r)&&(n=!0,e[i]=function(i,n){return function(){var t=this._super,e=(this._super=i,n.apply(this,arguments));return this._super=t,e}}(s,r));continue}}}}return n}(t,n),s=0<(t=e.length)?r?2===t?function(){this._super=null,this.__initProps__(s),e[0].apply(this,arguments),e[1].apply(this,arguments)}:function(){this._super=null,this.__initProps__(s);for(var t=0;t<e.length;++t)e[t].apply(this,arguments)}:3===t?function(){this.__initProps__(s),e[0].apply(this,arguments),e[1].apply(this,arguments),e[2].apply(this,arguments)}:function(){this.__initProps__(s);for(var t=s.__ctors__,e=0;e<t.length;++e)t[e].apply(this,arguments)}:function(){r&&(this._super=null),this.__initProps__(s)};return s}var o=/xyz/.test(function(){xyz})?/\b\._super\b/:/.*/;/xyz/.test(function(){xyz});function C(e,h,t,i,u,_){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),u)for(var d=0;d<u.length;++d){var f=u[d];f.__props__&&(e.__props__=e.__props__.concat(f.__props__.filter(function(t){return e.__props__.indexOf(t)<0})))}if(t)for(var n in b.preprocessAttrs(t,h,e,_),t){var r=t[n];"default"in r?A(e,0,n,r):(s=e,p=h,n=n,m=_,l=c=a=o=void 0,o=(r=r).get,a=r.set,c=s.prototype,l=!Object.getOwnPropertyDescriptor(c,n),o&&(T(s,r,0,n),v.setClassAttr(s,n,"serializable",!1),m||g.get(c,n,o,l,l)),a&&(m||g.set(c,n,a,l,l)))}var s,p,m,o,a,c,l,y=v.getClassAttrs(e);e.__values__=e.__props__.filter(function(t){return!1!==y[t+x+"serializable"]})}function d(t){var e,i,n,r=(t=t||{}).name,s=t.extends,o=t.mixins,a=function(t,e,i,n){var r=cc.Component,s=cc._RF.peek();if(s&&g.isChildClassOf(e,r)){if(g.isChildClassOf(s.cls,r))return cc.errorID(3615),null;t=t||s.script}return t=p(t,e,i,n),s&&(g.isChildClassOf(e,r)?((i=s.uuid)&&g._setClassId(i,t),s.cls=t):g.isChildClassOf(s.cls,r)||(s.cls=t)),t}(r,s,o,t),r=r||cc.js.getClassName(a),c=(a._sealed=!0,s&&(s._sealed=!1),t.properties),l=("function"==typeof c||s&&null===s.__props__||o&&o.some(function(t){return null===t.__props__})?(u.push({cls:a,props:c,mixins:o}),a.__props__=a.__values__=null):C(a,r,c,s,t.mixins,t.__ES6__),t.statics);if(l)for(e in l)a[e]=l[e];for(i in t)0<=h.indexOf(i)||(n=t[i],b.validateMethodWithProps(n,i,r,a,s)&&g.value(a.prototype,i,n,!0,!0));o=t.editor;return o&&g.isChildClassOf(s,cc.Component)&&cc.Component._registerEditorProps(a,o),a}d._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},d._fastDefine=function(t,e,i){g.setClassName(t,e);for(var n=e.__props__=e.__values__=Object.keys(i),r=v.getClassAttrs(e),s=0;s<n.length;s++){var o=n[s];r[o+x+"visible"]=!1,r[o+x+"default"]=i[o]}},d.Attr=v,d.attr=v.attr,d.getInheritanceChain=function(t){for(var e=[];t=g.getSuper(t);)t!==Object&&e.push(t);return e};var S={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function T(t,n,e,i){var r=null,s="";function o(){return s=i+x,r=v.getClassAttrs(t)}var a=n.type;function c(t,e){var i;t in n&&(typeof(i=n[t])===e&&((r||o())[s+t]=i))}a&&(S[a]?(r||o())[s+"type"]=a:"Object"===a||(a===v.ScriptUuid?((r||o())[s+"type"]="Script",r[s+"ctor"]=cc.ScriptAsset):"object"==typeof a?l.isEnum(a)&&((r||o())[s+"type"]="Enum",r[s+"enumList"]=l.getList(a)):"function"==typeof a&&((r||o())[s+"type"]="Object",r[s+"ctor"]=a))),n.editorOnly&&((r||o())[s+"editorOnly"]=!0),n.url&&((r||o())[s+"saveUrlAsAsset"]=!0),!1===n.serializable&&((r||o())[s+"serializable"]=!1),c("formerlySerializedAs","string");a=n.range;a&&Array.isArray(a)&&2<=a.length&&((r||o())[s+"min"]=a[0],r[s+"max"]=a[1],2<a.length&&(r[s+"step"]=a[2])),c("min","number"),c("max","number"),c("step","number")}cc.Class=d,i.exports={isArray:function(t){return t=r(t),Array.isArray(t)},fastDefine:d._fastDefine,getNewValueTypeCode:!1,IDENTIFIER_RE:e,escapeForJS:s,getDefault:r}},{"./CCEnum":191,"./attribute":201,"./js":209,"./preprocess-class":210,"./requiring-frame":211,"./utils":213}],190:[function(t,h,u){"use strict";t("./CCClass");var _=t("./preprocess-class"),l=t("./js"),n="__ccclassCache__";function d(t){return t}function o(t,e){return t[e]||(t[e]={})}function e(i){return function(e){return"function"==typeof e?i(e):function(t){return i(t,e)}}}function i(t,i,e){return function(e){return function(t){return i(t,e)}}}t=i.bind(null,!1);function r(){return i.bind(null,!1)}var s=r(),f=r();function a(t){return o(t,n)}function p(t,e,i,n,r,s){var o,a=r&&(r.get||r.set),c=(n&&(o=_.getFullFormOfProperty(n,a)),e[i]),c=l.mixin(c||{},o||n||{});a?(r.get&&(c.get=r.get),r.set&&(c.set=r.set)):(o=void 0,r?r.initializer&&(o=function(e){var t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(r.initializer)):(n=s.default||(s.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(t))).hasOwnProperty(i)&&(o=n[i]),c.default=o),e[i]=c}var m=e(function(t,e){var i=l.getSuper(t),e={name:e,extends:i=i===Object?null:i,ctor:t,__ES6__:!0},i=t[n];return i&&((i=i.proto)&&l.mixin(e,i),t[n]=void 0),cc.Class(e)});function y(t,i,n){return t(function(t,e){var t=a(t);t&&(e=void 0!==n?n:e,t=o(t,"proto"),o(t,"editor")[i]=e)},i)}function c(t){return t(d)}var g=c(e),t=y(t,"requireComponent"),v=c(s),f=y(f,"executionOrder"),x=c(e),b=c(e),A=c(s),C=c(s),s=c(s);cc._decorator=h.exports={ccclass:m,property:function(t,e,i){var s=null;function n(t,e,i){var n,r=a(t.constructor);r&&(n=o(r,"proto"),n=o(n,"properties"),p(t.constructor,n,e,s,i,r))}if(void 0===e)return s=t,n;n(t,e,i)},executeInEditMode:g,requireComponent:t,menu:v,executionOrder:f,disallowMultiple:x,playOnFocus:b,inspector:A,icon:C,help:s,mixins:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){t=a(t);t&&(o(t,"proto").mixins=e)}}}},{"./CCClass":189,"./js":209,"./preprocess-class":210,"./utils":213}],191:[function(t,e,i){"use strict";var o=t("./js");function n(t){if("__enums__"in t)return t;o.value(t,"__enums__",null,!0);for(var e=-1,i=Object.keys(t),n=0;n<i.length;n++){var r=i[n],s=t[r];if(-1===s)s=++e,t[r]=s;else if("number"==typeof s)e=s;else if("string"==typeof s&&Number.isInteger(parseFloat(r)))continue;s=""+s;r!==s&&o.value(t,s,r)}return t}n.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},n.getList=function(t){if(t.__enums__)return t.__enums__;var e,i=t.__enums__=[];for(e in t){var n=t[e];Number.isInteger(n)&&i.push({name:e,value:n})}return i.sort(function(t,e){return t.value-e.value}),i},e.exports=cc.Enum=n},{"./js":209}],192:[function(t,e,i){"use strict";var n,r=t("../event-manager"),t=t("./CCInputManager");cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},t.setAccelerometerEnabled=function(t){var e=this;e._accelEnabled!==t&&(e._accelEnabled=t,(t=cc.director.getScheduler()).enableForTarget(e),e._accelEnabled?(e._registerAccelerometerEvent(),e._accelCurTime=0,t.scheduleUpdate(e)):(e._unregisterAccelerometerEvent(),e._accelCurTime=0,t.unscheduleUpdate(e)))},t.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},t._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){r.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){r.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},t._registerAccelerometerEvent=function(){var t=window,e=(this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent),this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation"),i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),n=this.didAccelerate.bind(this),t.addEventListener(e,n,!1)},t._unregisterAccelerometerEvent=function(){var t=window,e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";n&&t.removeEventListener(e,n,!1)},t.didAccelerate=function(t){var e,i,n,r,s,o=window;this._accelEnabled&&(e=this._acceleration,r=this._accelDeviceEvent===window.DeviceMotionEvent?(r=t.accelerationIncludingGravity,i=this._accelMinus*r.x*.1,n=this._accelMinus*r.y*.1,.1*r.z):(i=t.gamma/90*.981,n=-t.beta/90*.981,t.alpha/90*.981),cc.view._isRotated&&(s=i,i=-n,n=s),e.x=i,e.y=n,e.z=r,e.timestamp=t.timeStamp||Date.now(),s=e.x,90===o.orientation?(e.x=-e.y,e.y=s):-90===o.orientation?(e.x=e.y,e.y=-s):180===o.orientation&&(e.x=-e.x,e.y=-e.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e.x=-e.x,e.y=-e.y))}},{"../event-manager":113,"./CCInputManager":193}],193:[function(t,e,i){"use strict";var n=t("./CCMacro"),d=t("./CCSys"),f=t("../event-manager"),r=n.TOUCH_TIMEOUT,h=cc.v2(),t={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:8,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_canvasBoundingRect:{left:0,top:0,adjustedLeft:0,adjustedTop:0,width:0,height:0},_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>r)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){t<0||t>=this._maxTouches||(this._indexBitsUsed&=~(1<<t))},_glView:null,_updateCanvasBoundingRect:function(){var t,e=cc.game.canvas,i=this._canvasBoundingRect,n=document.documentElement,r=window.pageXOffset-n.clientLeft,n=window.pageYOffset-n.clientTop;e.getBoundingClientRect?(t=e.getBoundingClientRect(),i.left=t.left+r,i.top=t.top+n,i.width=t.width,i.height=t.height):e instanceof HTMLCanvasElement?(i.left=r,i.top=n,i.width=e.width,i.height=e.height):(i.left=r,i.top=n,i.width=parseInt(e.style.width),i.height=parseInt(e.style.height))},handleTouchesBegin:function(t){for(var e,i,n,r,s,o=[],a=this._touchesIntegerDict,c=d.now(),l=0,h=t.length;l<h;l++)null==a[r=(n=t[l]).getID()]&&(-1!==(i=this._getUnUsedIndex())?((e=this._touches[i]=new cc.Touch(n._point.x,n._point.y,n.getID()))._lastModified=c,e._setPrevPoint(n._prevPoint),a[r]=i,o.push(e)):cc.logID(2300,i));0<o.length&&(this._glView._convertTouchesWithScale(o),(s=new cc.Event.EventTouch(o))._eventCode=cc.Event.EventTouch.BEGAN,f.dispatchEvent(s))},handleTouchesMove:function(t){for(var e,i,n,r=[],s=this._touches,o=d.now(),a=0,c=t.length;a<c;a++)i=(e=t[a]).getID(),null!=(i=this._touchesIntegerDict[i])&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),s[i]._lastModified=o,r.push(s[i]));0<r.length&&(this._glView._convertTouchesWithScale(r),(n=new cc.Event.EventTouch(r))._eventCode=cc.Event.EventTouch.MOVED,f.dispatchEvent(n))},handleTouchesEnd:function(t){var t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.Event.EventTouch(t))._eventCode=cc.Event.EventTouch.ENDED,f.dispatchEvent(t)),this._preTouchPool.length=0},handleTouchesCancel:function(t){var t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.Event.EventTouch(t))._eventCode=cc.Event.EventTouch.CANCELED,f.dispatchEvent(t)),this._preTouchPool.length=0},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],s=this._touches,o=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)null!=(i=o[n=(e=t[a]).getID()])&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]),this._removeUsedIndexBit(i),delete o[n]);return r},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){e=i[r];break}return e=e||t},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,t=this._glView.convertToLocationInView(t,e,i),e=new cc.Touch(t.x,t.y,0);return e._setPrevPoint(n.x,n.y),n.x=t.x,n.y=t.y,e},getMouseEvent:function(t,e,i){var n=this._prevMousePoint,i=new cc.Event.EventMouse(i);return i._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,this._glView._convertMouseToLocationInView(n,e),i.setLocation(n.x,n.y),i},getPointByEvent:function(t,e){return cc.sys.browserType!==cc.sys.BROWSER_TYPE_QQ&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_SAFARI||this._updateCanvasBoundingRect(),null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,s=[],o=this._glView,a=this._preTouchPoint,c=t.changedTouches.length,l=0;l<c;l++)(r=t.changedTouches[l])&&(n=void 0,n=d.BROWSER_TYPE_FIREFOX===d.browserType?o.convertToLocationInView(r.pageX,r.pageY,e,h):o.convertToLocationInView(r.clientX,r.clientY,e,h),null!=r.identifier?(i=new cc.Touch(n.x,n.y,r.identifier),r=this.getPreTouch(i).getLocation(),i._setPrevPoint(r.x,r.y),this.setPreTouch(i)):(i=new cc.Touch(n.x,n.y))._setPrevPoint(a.x,a.y),a.x=n.x,a.y=n.y,s.push(i));return s},registerSystemEvent:function(s){if(!this._isRegisterEvent){this._glView=cc.view;var o=this,a=this._canvasBoundingRect,t=(window.addEventListener("resize",this._updateCanvasBoundingRect.bind(this)),d.isMobile),e="mouse"in d.capabilities,h="touches"in d.capabilities;if(e){t||(window.addEventListener("mousedown",function(){o._mousePressed=!0},!1),window.addEventListener("mouseup",function(t){var e;o._mousePressed&&(o._mousePressed=!1,e=o.getPointByEvent(t,a),cc.rect(a.left,a.top,a.width,a.height).contains(e)||(o.handleTouchesEnd([o.getTouchByXY(e.x,e.y,a)]),(e=o.getMouseEvent(e,a,cc.Event.EventMouse.UP)).setButton(t.button),f.dispatchEvent(e)))},!1));for(var e=cc.Event.EventMouse,i=[!t&&["mousedown",e.DOWN,function(t,e,i,n){o._mousePressed=!0,o.handleTouchesBegin([o.getTouchByXY(i.x,i.y,n)]),s.focus()}],!t&&["mouseup",e.UP,function(t,e,i,n){o._mousePressed=!1,o.handleTouchesEnd([o.getTouchByXY(i.x,i.y,n)])}],!t&&["mousemove",e.MOVE,function(t,e,i,n){o.handleTouchesMove([o.getTouchByXY(i.x,i.y,n)]),o._mousePressed||e.setButton(null)}],["mousewheel",e.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta)}],["DOMMouseScroll",e.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail)}]],n=0;n<i.length;++n){var c=i[n];c&&function(){var t=c[0],n=c[1],r=c[2];s.addEventListener(t,function(t){var e=o.getPointByEvent(t,a),i=o.getMouseEvent(e,a,n);i.setButton(t.button),r(t,i,e,a),f.dispatchEvent(i),t.stopPropagation(),t.preventDefault()},!1)}()}}if(window.navigator.msPointerEnabled){var r,l={MSPointerDown:o.handleTouchesBegin,MSPointerMove:o.handleTouchesMove,MSPointerUp:o.handleTouchesEnd,MSPointerCancel:o.handleTouchesCancel};for(r in l)!function(t){var i=l[t];s.addEventListener(t,function(t){var e=document.documentElement;a.adjustedLeft=a.left-e.scrollLeft,a.adjustedTop=a.top-e.scrollTop,i.call(o,[o.getTouchByXY(t.clientX,t.clientY,a)]),t.stopPropagation()},!1)}(r)}if(h){var u,_={touchstart:function(t){o.handleTouchesBegin(t),s.focus()},touchmove:function(t){o.handleTouchesMove(t)},touchend:function(t){o.handleTouchesEnd(t)},touchcancel:function(t){o.handleTouchesCancel(t)}};for(u in _)!function(t){var i=_[t];s.addEventListener(t,function(t){var e;t.changedTouches&&(e=document.body,a.adjustedLeft=a.left-(e.scrollLeft||window.scrollX||0),a.adjustedTop=a.top-(e.scrollTop||window.scrollY||0),i(o.getTouchesByEvent(t,a)),t.stopPropagation(),t.preventDefault())},!1)}(u)}this._registerKeyboardEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,f.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};e.exports=cc.internal.inputManager=t},{"../event-manager":113,"./CCMacro":194,"./CCSys":198}],194:[function(t,e,i){"use strict";cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!1,SHOW_MESH_WIREFRAME:!1,SHOW_MESH_NORMAL:!1,ENABLE_MULTI_TOUCH:!0},Object.defineProperty(cc.macro,"ROTATE_ACTION_CCW",{set:function(t){cc.RotateTo&&cc.RotateBy&&(cc.RotateTo._reverse=cc.RotateBy._reverse=t)}});cc.macro.SUPPORT_TEXTURE_FORMATS=[".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],cc.macro.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775}),cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e.exports=cc.macro},{}],195:[function(t,e,i){"use strict";var n=t("./js"),t=t("./CCClass");function r(){this._name="",this._objFlags=0}t.fastDefine("cc.Object",r,{_name:"",_objFlags:0}),n.value(r,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var s=[];n.value(r,"_deferredDestroy",function(){for(var t=s.length,e=0;e<t;++e){var i=s[e];1&i._objFlags||i._destroyImmediate()}t===s.length?s.length=0:s.splice(0,t)});t=r.prototype;n.getset(t,"name",function(){return this._name},function(t){this._name=t},!0),n.get(t,"isValid",function(){return!(1&this._objFlags)},!0);t.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags)&&(this._objFlags|=4,s.push(this),!0)},t._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var i=t instanceof cc._BaseNode||t instanceof cc.Component,n=i?"_id":null,r={};for(c in t)if(t.hasOwnProperty(c)){if(c===n)continue;switch(typeof t[c]){case"string":r[c]="";break;case"object":case"function":r[c]=null}}if(cc.Class._isCCClass(e))for(var s=cc.Class.Attr.getClassAttrs(e),o=e.__props__,a=0;a<o.length;a++){var c,l=(c=o[a])+cc.Class.Attr.DELIMETER+"default";if(l in s&&(!i||"_id"!==c))switch(typeof s[l]){case"string":r[c]="";break;case"object":case"function":r[c]=null;break;case"undefined":r[c]=void 0}}return function(t){for(var e in r)t[e]=r[e]}}(this,t),n.value(t,"__destruct__",e,!0)),e(this)},t._onPreDestroy=null,t._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},t._deserialize=null,cc.isValid=function(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t},cc.Object=e.exports=r},{"./CCClass":189,"./js":209}],196:[function(t,e,i){"use strict";t=t("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}},cc.PlistParser=function(){cc.SAXParser.call(this)},t.extend(cc.PlistParser,cc.SAXParser),t.mixin(cc.PlistParser.prototype,{parse:function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return cc.warnID(5100),{};for(var i=null,n=0,r=e.childNodes.length;n<r&&1!==(i=e.childNodes[n]).nodeType;n++);return this._parseNode(i)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else for(var e="",n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue;else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,e.exports={saxParser:cc.saxParser,plistParser:cc.plistParser}},{"../platform/js":209}],197:[function(t,e,i){"use strict";cc.screen={_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};for(var t,e,i=this._fnMap,n=0,r=i.length;n<r;n++)if((t=i[n])&&void 0!==document[t[1]]){for(n=0,e=t.length;n<e;n++)this._fn[i[0][n]]=t[n];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchend"in window?"touchend":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement])},requestFullScreen:function(t,e,i){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&0<t.readyState)return void(t.webkitEnterFullscreen&&t.webkitEnterFullscreen());t.setAttribute("x5-video-player-fullscreen","true")}var n;this._supportsFullScreen&&(t=t||document.documentElement,e&&(n=this._fn.fullscreenchange,this._onfullscreenchange&&document.removeEventListener(n,this._onfullscreenchange),this._onfullscreenchange=e,document.addEventListener(n,e,!1)),i&&(n=this._fn.fullscreenerror,this._onfullscreenerror&&document.removeEventListener(n,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(n,i,{once:!0})),t[this._fn.requestFullscreen]())},exitFullScreen:function(t){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(t.webkitExitFullscreen&&t.webkitExitFullscreen());t.setAttribute("x5-video-player-fullscreen","false")}return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e)},disableAutoFullScreen:function(t){var t=cc.game.canvas||t,e=this._touchEvent;this._preOnTouch&&(t.removeEventListener(e,this._preOnTouch),this._preOnTouch=null)},_ensureFullScreen:function(t,e){var i,n=this,r=cc.game.canvas||t,s=this._fn.fullscreenerror;function o(){n._preOnFullScreenError=null,n._preOnTouch&&r.removeEventListener(i,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(t,e)},r.addEventListener(i,n._preOnTouch,{once:!0})}void 0!==document[s]&&(i=this._touchEvent,this._preOnFullScreenError&&t.removeEventListener(s,this._preOnFullScreenError),this._preOnFullScreenError=o,t.addEventListener(s,o,{once:!0}))}},cc.screen.init()},{}],198:[function(t,e,i){"use strict";window._CCSettings&&_CCSettings.platform;var d="undefined"==typeof window?global:window;var n=cc&&cc.sys?cc.sys:function(){cc.sys={};var e=cc.sys;if(e.LANGUAGE_ENGLISH="en",e.LANGUAGE_CHINESE="zh",e.LANGUAGE_FRENCH="fr",e.LANGUAGE_ITALIAN="it",e.LANGUAGE_GERMAN="de",e.LANGUAGE_SPANISH="es",e.LANGUAGE_DUTCH="du",e.LANGUAGE_RUSSIAN="ru",e.LANGUAGE_KOREAN="ko",e.LANGUAGE_JAPANESE="ja",e.LANGUAGE_HUNGARIAN="hu",e.LANGUAGE_PORTUGUESE="pt",e.LANGUAGE_ARABIC="ar",e.LANGUAGE_NORWEGIAN="no",e.LANGUAGE_POLISH="pl",e.LANGUAGE_TURKISH="tr",e.LANGUAGE_UKRAINIAN="uk",e.LANGUAGE_ROMANIAN="ro",e.LANGUAGE_BULGARIAN="bg",e.LANGUAGE_UNKNOWN="unknown",e.OS_IOS="iOS",e.OS_ANDROID="Android",e.OS_WINDOWS="Windows",e.OS_MARMALADE="Marmalade",e.OS_LINUX="Linux",e.OS_BADA="Bada",e.OS_BLACKBERRY="Blackberry",e.OS_OSX="OS X",e.OS_WP8="WP8",e.OS_WINRT="WINRT",e.OS_UNKNOWN="Unknown",e.UNKNOWN=-1,e.WIN32=0,e.LINUX=1,e.MACOS=2,e.ANDROID=3,e.IPHONE=4,e.IPAD=5,e.BLACKBERRY=6,e.NACL=7,e.EMSCRIPTEN=8,e.TIZEN=9,e.WINRT=10,e.WP8=11,e.MOBILE_BROWSER=100,e.DESKTOP_BROWSER=101,e.EDITOR_PAGE=102,e.EDITOR_CORE=103,e.WECHAT_GAME=104,e.QQ_PLAY=105,e.FB_PLAYABLE_ADS=106,e.BAIDU_GAME=107,e.VIVO_GAME=108,e.OPPO_GAME=109,e.HUAWEI_GAME=110,e.XIAOMI_GAME=111,e.JKW_GAME=112,e.ALIPAY_GAME=113,e.WECHAT_GAME_SUB=114,e.BAIDU_GAME_SUB=115,e.QTT_GAME=116,e.BROWSER_TYPE_WECHAT="wechat",e.BROWSER_TYPE_WECHAT_GAME="wechatgame",e.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",e.BROWSER_TYPE_BAIDU_GAME="baidugame",e.BROWSER_TYPE_BAIDU_GAME_SUB="baidugamesub",e.BROWSER_TYPE_XIAOMI_GAME="xiaomigame",e.BROWSER_TYPE_ALIPAY_GAME="alipaygame",e.BROWSER_TYPE_QQ_PLAY="qqplay",e.BROWSER_TYPE_ANDROID="androidbrowser",e.BROWSER_TYPE_IE="ie",e.BROWSER_TYPE_EDGE="edge",e.BROWSER_TYPE_QQ="qqbrowser",e.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",e.BROWSER_TYPE_UC="ucbrowser",e.BROWSER_TYPE_UCBS="ucbs",e.BROWSER_TYPE_360="360browser",e.BROWSER_TYPE_BAIDU_APP="baiduboxapp",e.BROWSER_TYPE_BAIDU="baidubrowser",e.BROWSER_TYPE_MAXTHON="maxthon",e.BROWSER_TYPE_OPERA="opera",e.BROWSER_TYPE_OUPENG="oupeng",e.BROWSER_TYPE_MIUI="miuibrowser",e.BROWSER_TYPE_FIREFOX="firefox",e.BROWSER_TYPE_SAFARI="safari",e.BROWSER_TYPE_CHROME="chrome",e.BROWSER_TYPE_LIEBAO="liebao",e.BROWSER_TYPE_QZONE="qzone",e.BROWSER_TYPE_SOUGOU="sogou",e.BROWSER_TYPE_UNKNOWN="unknown",e.isNative=!1,e.isBrowser="object"==typeof window&&"object"==typeof document&&!0,e.glExtension=function(t){return!!cc.renderer.device.ext(t)},e.getMaxJointMatrixSize=function(){var t;return e._maxJointMatrixSize||(t=cc.game._renderContext,t=Math.floor(t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)/4)-10,e._maxJointMatrixSize=t<50?0:50),e._maxJointMatrixSize},d.__globalAdapter&&d.__globalAdapter.adaptSys)d.__globalAdapter.adaptSys(e);else{var t=window,i=t.navigator,h=document,u=h.documentElement,n=i.userAgent.toLowerCase();e.isMobile=/mobile|android|iphone|ipad/.test(n),"undefined"!=typeof FbPlayableAd?e.platform=e.FB_PLAYABLE_ADS:e.platform=e.isMobile?e.MOBILE_BROWSER:e.DESKTOP_BROWSER;var r=(r=i.language)||i.browserLanguage,r=(e.languageCode=r.toLowerCase(),r=r?r.split("-")[0]:e.LANGUAGE_ENGLISH,e.language=r,!1),s=!1,o="",a=0,c=/android (\d+(?:\.\d+)*)/i.exec(n)||/android (\d+(?:\.\d+)*)/i.exec(i.platform),c=(c&&(r=!0,o=c[1]||"",a=parseInt(o)||0),(c=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(n))?(s=!0,o=c[2]||"",a=parseInt(o)||0):(/(iPhone|iPad|iPod)/.exec(i.platform)||"MacIntel"===i.platform&&i.maxTouchPoints&&1<i.maxTouchPoints)&&(s=!0,o="",a=0),e.OS_UNKNOWN),a=(-1!==i.appVersion.indexOf("Win")?c=e.OS_WINDOWS:s?c=e.OS_IOS:-1!==i.appVersion.indexOf("Mac")?c=e.OS_OSX:-1!==i.appVersion.indexOf("X11")&&-1===i.appVersion.indexOf("Linux")?c=e.OS_UNIX:r?c=e.OS_ANDROID:-1===i.appVersion.indexOf("Linux")&&-1===n.indexOf("ubuntu")||(c=e.OS_LINUX),e.os=c,e.osVersion=o,e.osMainVersion=a,e.browserType=e.BROWSER_TYPE_UNKNOWN,("safari"===(s=(s=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(n)||/qq|ucbrowser|ubrowser|edge/i.exec(n)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(n))?s[0].toLowerCase():e.BROWSER_TYPE_UNKNOWN)&&r||"qq"===s&&n.match(/android.*applewebkit/i))&&(s=e.BROWSER_TYPE_ANDROID),c={micromessenger:e.BROWSER_TYPE_WECHAT,trident:e.BROWSER_TYPE_IE,edge:e.BROWSER_TYPE_EDGE,"360 aphone":e.BROWSER_TYPE_360,mxbrowser:e.BROWSER_TYPE_MAXTHON,"opr/":e.BROWSER_TYPE_OPERA,ubrowser:e.BROWSER_TYPE_UC},e.browserType=c[s]||s,e.browserVersion="",o=(o=n.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i))||n.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i),e.browserVersion=o?o[4]:"",window.innerWidth||document.documentElement.clientWidth),r=window.innerHeight||document.documentElement.clientHeight,c=window.devicePixelRatio||1,s=(e.windowPixelResolution={width:c*a,height:c*r},e._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")},document.createElement("canvas"));try{var _=e.localStorage=t.localStorage;_.setItem("storage",""),_.removeItem("storage"),_=null}catch(t){n=function(){cc.warnID(5200)};e.localStorage={getItem:n,setItem:n,removeItem:n,clear:n}}var l,o=s.toDataURL("image/webp").startsWith("data:image/webp"),a=!!s.getContext("2d"),c=!1,r=(t.WebGLRenderingContext&&(c=!0),e.capabilities={canvas:a,opengl:c,webp:o});void 0===u.ontouchstart&&void 0===h.ontouchstart&&!i.msPointerEnabled||(r.touches=!0),void 0!==u.onmouseup&&(r.mouse=!0),void 0!==u.onkeyup&&(r.keyboard=!0),(t.DeviceMotionEvent||t.DeviceOrientationEvent)&&(r.accelerometer=!0),e.browserVersion,_=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),l={ONLY_ONE:!1,WEB_AUDIO:_,DELAY_CREATE_CTX:!1},e.os===e.OS_IOS&&(l.USE_LOADER_EVENT="loadedmetadata"),e.browserType===e.BROWSER_TYPE_FIREFOX&&(l.DELAY_CREATE_CTX=!0,l.USE_LOADER_EVENT="canplay"),e.os===e.OS_ANDROID&&e.browserType===e.BROWSER_TYPE_UC&&(l.ONE_SOURCE=!0);try{l.WEB_AUDIO&&(l.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),l.DELAY_CREATE_CTX&&setTimeout(function(){l.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(t){l.WEB_AUDIO=!1,cc.logID(5201)}n=[];(s=document.createElement("audio")).canPlayType&&(s.canPlayType('audio/ogg; codecs="vorbis"')&&n.push(".ogg"),s.canPlayType("audio/mpeg")&&n.push(".mp3"),s.canPlayType('audio/wav; codecs="1"')&&n.push(".wav"),s.canPlayType("audio/mp4")&&n.push(".mp4"),s.canPlayType("audio/x-m4a")&&n.push(".m4a")),l.format=n,e.__audioSupport=l}return e.NetworkType={NONE:0,LAN:1,WWAN:2},e.getNetworkType=function(){return e.NetworkType.LAN},e.getBatteryLevel=function(){return 1},e.garbageCollect=function(){},e.restartVM=function(){},e.getSafeAreaRect=function(){var t=cc.view.getVisibleSize();return cc.rect(0,0,t.width,t.height)},e.isObjectValid=function(t){return!!t},e.dump=function(){var t="",t=(t=(t=(t=(t=(t=(t=(t=(t+="isMobile : "+this.isMobile+"\r\n")+("language : "+this.language+"\r\n"))+("browserType : "+this.browserType+"\r\n"))+("browserVersion : "+this.browserVersion+"\r\n"))+("capabilities : "+JSON.stringify(this.capabilities)+"\r\n"))+("os : "+this.os+"\r\n"))+("osVersion : "+this.osVersion+"\r\n"))+("platform : "+this.platform+"\r\n"))+("Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n");cc.log(t)},e.openURL=function(t){window.open(t)},e.now=function(){return Date.now?Date.now():+new Date},e}();e.exports=n},{}],199:[function(t,e,h){"use strict";var n=t("../event/event-target"),u=t("../platform/js"),_=t("../renderer"),r=(t("../platform/CCClass"),{init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType});switch(cc.sys.os===cc.sys.OS_IOS&&(r.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),r.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:r.meta["minimal-ui"]="true",r.availWidth=cc.sys.isMobile?function(t){return window.innerWidth}:function(t){return t.clientWidth},r.availHeight=cc.sys.isMobile?function(t){return window.innerHeight}:function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:r.meta["minimal-ui"]="true",r.availWidth=function(t){return t.clientWidth},r.availHeight=function(t){return t.clientHeight}}function i(){n.call(this);var t=this,e=cc.ContainerStrategy,i=cc.ContentStrategy;r.init(this),t._frameSize=cc.size(0,0),t._designResolutionSize=cc.size(0,0),t._originalDesignResolutionSize=cc.size(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=cc.rect(0,0,0,0),t._visibleRect=cc.rect(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=cc.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._antiAliasEnabled=!1,t._resolutionPolicy=null,t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this)}var s,o,a,c,l=null;cc.js.extend(i,n),cc.js.mixin(i.prototype,{init:function(){this._initFrameSize();var t=cc.game.canvas.width,e=cc.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},_resizeEvent:function(t){var e,i,n,r,s=this.setDesignResolutionSize?this:cc.view,o=cc.sys;o.browserType!==o.BROWSER_TYPE_UC||o.os!==o.OS_IOS?(o=s._frameSize.width,e=s._frameSize.height,i=s._isRotated,cc.sys.isMobile?(n=(r=cc.game.container.style).margin,r.margin="0",r.display="none",s._initFrameSize(),r.margin=n,r.display="block"):s._initFrameSize(),!0!==t&&s._isRotated===i&&s._frameSize.width===o&&s._frameSize.height===e||(n=s._originalDesignResolutionSize.width,r=s._originalDesignResolutionSize.height,s._resizing=!0,0<n&&s.setDesignResolutionSize(n,r,s._resolutionPolicy),s._resizing=!1,s.emit("canvas-resize"),s._resizeCallback&&s._resizeCallback.call())):setTimeout(function(){s._resizeEvent(t)},0)},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent(),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&setTimeout(function(){window.innerHeight>window.innerWidth&&window.scrollTo(0,1)},500)},resizeWithBrowserSize:function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){var e;(t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t&&(this._orientation=t,t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height,this.setDesignResolutionSize(t,e,this._resolutionPolicy))},_initFrameSize:function(){var t=this._frameSize,e=r.availWidth(cc.game.frame),i=r.availHeight(cc.game.frame),n=i<=e;!cc.sys.isMobile||n&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.game.container.style["-webkit-transform"]="rotate(0deg)",cc.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.game.container.style["-webkit-transform"]="rotate(90deg)",cc.game.container.style.transform="rotate(90deg)",cc.game.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_setViewportMeta:function(t,e){var i,n,r=document.getElementById("cocosMetaElement"),s=(r&&e&&document.head.removeChild(r),document.getElementsByName("viewport")),s=s?s[0]:null,o=s?s.content:"";for(i in(r=r||document.createElement("meta")).id="cocosMetaElement",r.name="viewport",r.content="",t)-1==o.indexOf(i)?o+=","+i+"="+t[i]:e&&(n=new RegExp(i+"s*=s*[^,]+"),o.replace(n,i+"="+t[i]));/^,/.test(o)&&(o=o.substr(1)),r.content=o,s&&(s.content=o),document.head.appendChild(r)},_adjustViewportMeta:function(){this._isAdjustViewport&&(this._setViewportMeta(r.meta,!1),this._isAdjustViewport=!1)},adjustViewportMeta:function(t){this._isAdjustViewport=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(cc.warnID(9200),this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc.game.renderType===cc.game.RENDER_TYPE_WEBGL){var e,i=cc.loader._cache;for(e in i){var n,r=i[e],r=r&&r.content instanceof cc.Texture2D?r.content:null;r&&(n=cc.Texture2D.Filter,t?r.setFilters(n.LINEAR,n.LINEAR):r.setFilters(n.NEAREST,n.NEAREST))}}else{var s;cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&((s=cc.game.canvas.getContext("2d")).imageSmoothingEnabled=t,s.mozImageSmoothingEnabled=t)}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame))},isAutoFullScreenEnabled:function(){return this._autoFullScreen},setCanvasSize:function(t,e){var i=cc.game.canvas,n=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",n.style.width=t+"px",n.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(!0)},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e,i=this;t instanceof cc.ResolutionPolicy?i._resolutionPolicy=t:(t===(e=cc.ResolutionPolicy).EXACT_FIT&&(i._resolutionPolicy=i._rpExactFit),t===e.SHOW_ALL&&(i._resolutionPolicy=i._rpShowAll),t===e.NO_BORDER&&(i._resolutionPolicy=i._rpNoBorder),t===e.FIXED_HEIGHT&&(i._resolutionPolicy=i._rpFixedHeight),t===e.FIXED_WIDTH&&(i._resolutionPolicy=i._rpFixedWidth))},setDesignResolutionSize:function(t,e,i){var n;0<t||0<e?(this.setResolutionPolicy(i),(i=this._resolutionPolicy)&&i.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i?(this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e,(t=i.apply(this,this._designResolutionSize)).scale&&2===t.scale.length&&(this._scaleX=t.scale[0],this._scaleY=t.scale[1]),t.viewport&&(e=this._viewportRect,n=this._visibleRect,t=t.viewport,e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,n.x=0,n.y=0,n.width=t.width/this._scaleX,n.height=t.height/this._scaleY),i.postApply(this),cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),_.updateCameraViewport(),cc.internal.inputManager._updateCanvasBoundingRect(),this.emit("design-resolution-changed")):cc.logID(2201)):cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewportInPoints:function(t,e,i,n){var r=this._scaleX,s=this._scaleY;cc.game._renderContext.viewport(t*r+this._viewportRect.x,e*s+this._viewportRect.y,i*r,n*s)},setScissorInPoints:function(t,e,i,n){var r=this._scaleX,s=this._scaleY,t=Math.ceil(t*r+this._viewportRect.x),e=Math.ceil(e*s+this._viewportRect.y),i=Math.ceil(i*r),r=Math.ceil(n*s),n=cc.game._renderContext;l||(s=n.getParameter(n.SCISSOR_BOX),l=cc.rect(s[0],s[1],s[2],s[3])),l.x===t&&l.y===e&&l.width===i&&l.height===r||(l.x=t,l.y=e,l.width=i,l.height=r,n.scissor(t,e,i,r))},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){l||(t=gl.getParameter(gl.SCISSOR_BOX),l=cc.rect(t[0],t[1],t[2],t[3]));var t=1/this._scaleX,e=1/this._scaleY;return cc.rect((l.x-this._viewportRect.x)*t,(l.y-this._viewportRect.y)*e,l.width*t,l.height*e)},getViewportRect:function(){return this._viewportRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i,n){var n=n||cc.v2(),r=i.adjustedLeft||i.left,s=i.adjustedTop||i.top,t=this._devicePixelRatio*(t-r),r=this._devicePixelRatio*(s+i.height-e);return this._isRotated?(n.x=cc.game.canvas.width-r,n.y=t):(n.x=t,n.y=r),n},_convertMouseToLocationInView:function(t,e){var i=this._viewportRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n=this._viewportRect,r=this._scaleX,s=this._scaleY,o=0;o<t.length;o++)e=(i=t[o])._point,i=i._prevPoint,e.x=(e.x-n.x)/r,e.y=(e.y-n.y)/s,i.x=(i.x-n.x)/r,i.y=(i.y-n.y)/s}}),cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=(this._setupStyle(t,e,i),t._devicePixelRatio=1);t.isRetinaEnabled()&&(r=t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),n.width=e*r,n.height=i*r},_setupStyle:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px"},_fixContainer:function(){document.body.insertBefore(cc.game.container,document.body.firstChild);var t=document.body.style,t=(t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",cc.game.container.style);t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null}},_buildResult:function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);t=cc.rect((t-i)/2,(e-n)/2,i,n);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,s],this._result.viewport=t,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),t=cc.Class({name:"EqualToFrame",extends:cc.ContainerStrategy,apply:function(t){var e=t._frameSize.height,i=cc.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px"}}),s=cc.Class({name:"ProportionalToFrame",extends:cc.ContainerStrategy,apply:function(t,e){var i=t._frameSize.width,n=t._frameSize.height,r=cc.game.container.style,s=e.width,e=e.height,o=i/s,a=n/e,e=o<a?(c=i,e*o):(c=s*a,n),o=Math.round((i-c)/2),s=Math.round((n-e)/2),c=i-2*o;this._setupContainer(t,c,e=n-2*s),t._isRotated?r.margin="0 0 0 "+n+"px":r.margin="0px",r.paddingLeft=o+"px",r.paddingRight=o+"px",r.paddingTop=s+"px",r.paddingBottom=s+"px"}}),cc.Class({name:"EqualToWindow",extends:t,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),cc.Class({name:"ProportionalToWindow",extends:s,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),o=cc.Class({name:"OriginalContainer",extends:cc.ContainerStrategy,apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}),(a=("undefined"==typeof window?global:window).__globalAdapter)&&(a.adaptContainerStrategy&&a.adaptContainerStrategy(cc.ContainerStrategy.prototype),a.adaptView&&a.adaptView(i.prototype)),cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new s,cc.ContainerStrategy.ORIGINAL_CONTAINER=new o,a=cc.Class({name:"ExactFit",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,e=n/e.height;return this._buildResult(i,n,i,n,r,e)}}),t=cc.Class({name:"ShowAll",extends:cc.ContentStrategy,apply:function(t,e){var i,n=cc.game.canvas.width,r=cc.game.canvas.height,s=e.width,e=e.height,o=n/s,a=r/e,c=0,e=o<a?(i=n,e*(c=o)):(i=s*(c=a),r);return this._buildResult(n,r,i,e,c,c)}}),s=cc.Class({name:"NoBorder",extends:cc.ContentStrategy,apply:function(t,e){var i,n,r=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,e=e.height,a=r/o,c=s/e,o=a<c?(n=o*(i=c),s):(n=r,e*(i=a));return this._buildResult(r,s,n,o,i,i)}}),o=cc.Class({name:"FixedHeight",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,e=n/e.height;return this._buildResult(i,n,i,n,e,e)}}),c=cc.Class({name:"FixedWidth",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,e=i/e.width;return this._buildResult(i,n,i,n,e,e)}}),cc.ContentStrategy.EXACT_FIT=new a,cc.ContentStrategy.SHOW_ALL=new t,cc.ContentStrategy.NO_BORDER=new s,cc.ContentStrategy.FIXED_HEIGHT=new o,cc.ContentStrategy.FIXED_WIDTH=new c,cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(t,e){this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),u.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.view=new i,cc.winSize=cc.size(),e.exports=cc.view},{"../event/event-target":115,"../platform/CCClass":189,"../platform/js":209,"../renderer":220}],200:[function(t,e,i){"use strict";cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,t=t.y,r=t+i,s=n+e;this.topLeft.x=n,this.topLeft.y=r,this.topRight.x=s,this.topRight.y=r,this.top.x=n+e/2,this.top.y=r,this.bottomLeft.x=n,this.bottomLeft.y=t,this.bottomRight.x=s,this.bottomRight.y=t,this.bottom.x=n+e/2,this.bottom.y=t,this.center.x=n+e/2,this.center.y=t+i/2,this.left.x=n,this.left.y=t+i/2,this.right.x=s,this.right.y=t+i/2}}},{}],201:[function(t,e,i){"use strict";var n=t("./js");t("./utils").isPlainEmptyObj_DEV;function s(t,e){e=e?Object.create(e):{};return n.value(t,"__attrs__",e),e}function r(t,e,i){var n,r=a(t),s=e+"$_$",o={};for(n in r)n.startsWith(s)&&(o[n.slice(s.length)]=r[n]);return o}function a(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||function(t){var e;if("function"!=typeof t)return s(t,a(t.constructor));for(var i=cc.Class.getInheritanceChain(t),n=i.length-1;0<=n;n--){var r=i[n];r.hasOwnProperty("__attrs__")&&r.__attrs__||s(r,(e=i[n+1])&&e.__attrs__)}return s(t,(e=i[0])&&e.__attrs__),t.__attrs__}(t)}function o(t,e){this.name=t,this.default=e}o.prototype.toString=function(){return this.name},cc.Integer=new o("Integer",0),cc.Float=new o("Float",0),cc.Boolean=new o("Boolean",!1),cc.String=new o("String",""),e.exports={PrimitiveType:o,attr:r,getClassAttrs:a,setClassAttr:function(t,e,i,n){a(t)[e+"$_$"+i]=n},DELIMETER:"$_$",getTypeChecker_ET:!1,getObjTypeChecker_ET:!1,ScriptUuid:{}}},{"./CCClass":189,"./js":209,"./utils":213}],202:[function(t,e,h){"use strict";var i=t("./js"),a=i.array.fastRemoveAt;function n(){}function r(){this.callback=n,this.target=void 0,this.once=!1}r.prototype.set=function(t,e,i){this.callback=t,this.target=e,this.once=!!i};var c=new i.Pool(function(t){return t.callback=n,t.target=void 0,!(t.once=!1)},32);function s(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}c.get=function(){return this._get()||new r};var t=s.prototype,l=(t.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.callback===t&&(c.put(i),a(this.callbackInfos,e),--e)}},t.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.target===t&&(c.put(i),a(this.callbackInfos,e),--e)}},t.cancel=function(t){var e=this.callbackInfos[t];e&&(c.put(e),this.callbackInfos[t]=null),this.containCanceled=!0},t.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(c.put(e),this.callbackInfos[t]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;0<=t;--t)this.callbackInfos[t]||a(this.callbackInfos,t);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},new i.Pool(function(t){return t.callbackInfos=[],t.isInvoking=!1,!(t.containCanceled=!1)},16));function o(){this._callbackTable=i.createMap(!0)}l.get=function(){return this._get()||new s},(t=o.prototype).on=function(t,e,i,n){var r=(r=this._callbackTable[t])||(this._callbackTable[t]=l.get()),t=c.get();t.set(e,i,n),r.callbackInfos.push(t)},t.hasEventListener=function(t,e,i){t=this._callbackTable[t];if(!t)return!1;var n=t.callbackInfos;if(!e){if(t.isInvoking){for(var r=0;r<n.length;++r)if(n[r])return!0;return!1}return 0<n.length}for(var s=0;s<n.length;++s){var o=n[s];if(o&&o.callback===e&&o.target===i)return!0}return!1},t.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),l.put(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var n=this._callbackTable[i];if(n.isInvoking)for(var r=n.callbackInfos,s=0;s<r.length;++s){var o=r[s];o&&o.target===t&&n.cancel(s)}else n.removeByTarget(t)}},t.off=function(t,e,i){var n=this._callbackTable[t];if(n)for(var r=n.callbackInfos,s=0;s<r.length;++s){var o=r[s];if(o&&o.callback===e&&o.target===i){n.isInvoking?n.cancel(s):(a(r,s),c.put(o));break}}},t.emit=function(t,e,i,n,r,h){var s=this._callbackTable[t];if(s){for(var u=!s.isInvoking,_=(s.isInvoking=!0,s.callbackInfos),o=0,d=_.length;o<d;++o){var a,c,l=_[o];l&&(a=l.target,c=l.callback,l.once&&this.off(t,c,a),a?c.call(a,e,i,n,r,h):c(e,i,n,r,h))}u&&(s.isInvoking=!1,s.containCanceled&&s.purgeCanceled())}},e.exports=o},{"./js":209}],203:[function(t,e,i){"use strict";e.exports={flattenCodeArray:function(t){var e=[];return function t(e,i){for(var n=0;n<i.length;n++){var r=i[n];Array.isArray(r)?t(e,r):e.push(r)}}(e,t),e.join("")}}},{}],204:[function(t,e,i){"use strict";function a(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this._stillUseUrl=S.createMap(!0)}var f,S=t("./js"),T=t("./attribute"),w=t("./CCClass"),E=t("../utils/misc"),c=(a.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,S.clear(this._stillUseUrl)},a.prototype.push=function(t,e,i,n){n&&(this._stillUseUrl[this.uuidList.length]=!0),this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)},(a.pool=new S.Pool(function(t){t.reset()},10)).get=function(){return this._get()||new a},(t=o.prototype).deserialize=function(t){if(Array.isArray(t)){var e=t,i=e.length;this.deserializedList.length=i;for(var n=0;n<i;n++)e[n]&&(this.deserializedList[n]=this._deserializeObject(e[n],!1));this.deserializedData=0<i?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t,!1):null,this.deserializedList[0]=this.deserializedData;for(var r,s,t=this,o=t.deserializedList,a=t._idPropList,c=t._idList,h=t._idObjList,l=(t._classFinder&&t._classFinder.onDereferenced,0);l<c.length;l++)r=a[l],s=c[l],h[l][r]=o[s];return this.deserializedData},t._deserializeObject=function(t,h,u,e,_){var i,n=null,r=null,s=t.__type__;if("TypedArray"===s){for(var d=t.array,n=new window[t.ctor](d.length),o=0;o<d.length;++o)n[o]=d[o];return n}if(s){var a,r=this._classFinder(s,t,e,_);if(!r)return this._classFinder===S._getClassById&&cc.deserialize.reportMissingClass(s),null;if((n=new r)._deserialize)return n._deserialize(t.content,this),n;if(cc.Class._isCCClass(r)){e=this;_=n;s=t;var c=r;c.hasOwnProperty("__deserialize__")?a=c.__deserialize__:(a=f(e,c),S.value(c,"__deserialize__",a,!0));a(e,_,s,c,u)}else this._deserializeTypedObject(n,t,r)}else if(Array.isArray(t)){n=new Array(t.length);for(var l=0;l<t.length;l++)"object"==typeof(i=t[l])&&i?this._deserializeObjField(n,i,""+l,null,h):n[l]=i}else this._deserializePrimitiveObject(n={},t);return n},t._deserializeObjField=function(t,e,i,n,r){var s,o=e.__id__;void 0===o?(s=e.__uuid__)?this.result.push(t,i,s,r):t[i]=this._deserializeObject(e,r):(s=this.deserializedList[o])?t[i]=s:(this._idList.push(o),this._idObjList.push(t),this._idPropList.push(i))},t._deserializePrimitiveObject=function(t,e){var i,n;for(i in e)e.hasOwnProperty(i)&&("object"!=typeof(n=e[i])?"__type__"!==i&&(t[i]=n):n?this._deserializeObjField(t,n,i):t[i]=null)},t._deserializeTypedObject=function(t,e,i){if(i===cc.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===cc.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);var n;if(i===cc.Color)return t.r=e.r||0,t.g=e.g||0,t.b=e.b||0,n=e.a,void(t.a=void 0===n?255:n);if(i===cc.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var r=T.DELIMETER+"default",s=T.getClassAttrs(i),o=i.__props__||Object.keys(t),a=0;a<o.length;a++){var c=o[a],l=e[c];"object"!=typeof(l=void 0!==l&&e.hasOwnProperty(c)?l:w.getDefault(s[c+r]))?t[c]=l:l?this._deserializeObjField(t,l,c):t[c]=null}},f=function(s,t){for(var m,u=E.BUILTIN_CLASSID_RE.test(S._getClassId(t)),y=cc.js.isChildClassOf(t,cc._BaseNode)||cc.js.isChildClassOf(t,cc.Component),_=[],d=_,f=[],p=f,g=[],v=[],o=t.__values__,e=(m="_$erialized"===o[o.length-1],T.getClassAttrs(t)),a=T.DELIMETER+"type",c=T.DELIMETER+"default",l=T.DELIMETER+"saveUrlAsAsset",h=T.DELIMETER+"formerlySerializedAs",x=0;x<o.length;x++){var i,n=o[x],r=n,b=(e[n+h]&&(r=e[n+h]),e[n+l]),A=w.getDefault(e[n+c]),C=!1;u&&(i=e[n+a],C=void 0===A&&i?i instanceof T.PrimitiveType:"string"==(i=typeof A)&&!b||"number"==i||"boolean"==i),u&&C?(r!==n&&d===_&&(d=_.slice()),_.push(n),d!==_&&d.push(r)):(r!==n&&p===f&&(p=f.slice()),f.push(n),p!==f&&p.push(r),g.push(b),v.push(A instanceof cc.ValueType&&A.constructor))}return function(t,e,i,l,h){for(var n=0;n<_.length;++n){var r=i[d[n]];void 0!==r&&(e[_[n]]=r)}for(var s=0;s<f.length;++s){var o,a=f[s],c=i[p[s]];void 0!==c&&(u||"object"==typeof c?(o=v[s])?u||c?t._deserializeTypedObject(e[a],c,o):e[a]=null:c?t._deserializeObjField(e,c,a,null,g[s]):e[a]=null:e[a]=c)}y&&i._id&&(e._id=i._id),m&&(e._$erialized=JSON.parse(JSON.stringify(i)),t._deserializePrimitiveObject(e._$erialized,i))}},(o.pool=new S.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0},1)).get=function(t,e,i,n,r){var s=this._get();return s?(s.result=t,s.customEnv=n,s._classFinder=i,s):new o(t,0,i,n)},o);function o(t,e,i,n,r){this.result=t,this.customEnv=n,this.deserializedList=[],this.deserializedData=null,this._classFinder=i,this._idList=[],this._idObjList=[],this._idPropList=[]}cc.deserialize=function(t,e,i){var n=(i=i||{}).classFinder||S._getClassById,r=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,s=i.customEnv,i=i.ignoreEditorOnly,o=("string"==typeof t&&(t=JSON.parse(t)),!e),n=(e=e||a.pool.get(),c.pool.get(e,!1,n,s,i)),s=(cc.game._isCloning=!0,n.deserialize(t));return cc.game._isCloning=!1,c.pool.put(n),r&&e.assignAssetsBy(Editor.serialize.asAsset),o&&a.pool.put(e),s},cc.deserialize.Details=a,cc.deserialize.reportMissingClass=function(t){cc.warnID(5302,t)}},{"../utils/misc":264,"./CCClass":189,"./attribute":201,"./js":209}],205:[function(t,e,i){"use strict";function n(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),e.exports=n},{}],206:[function(t,e,i){"use strict";t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCAssetLibrary"),t("./CCVisibleRect")},{"./CCAssetLibrary":188,"./CCClass":189,"./CCClassDecorator":190,"./CCEnum":191,"./CCMacro":194,"./CCObject":195,"./CCSys":198,"./CCVisibleRect":200,"./callbacks-invoker":202,"./deserialize":204,"./instantiate":208,"./instantiate-jit":207,"./js":209,"./requiring-frame":211,"./url":212}],207:[function(t,e,i){"use strict";var o=t("./CCObject"),n=o.Flags.Destroyed,f=o.Flags.PersistentMask,h=t("./attribute"),s=t("./js"),u=t("./CCClass"),p=t("./compiler"),m=h.DELIMETER+"default",r=u.IDENTIFIER_RE,y=u.escapeForJS,g={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};try{Float32Array.name||(Float32Array.name="Float32Array"),Float64Array.name||(Float64Array.name="Float64Array"),Int8Array.name||(Int8Array.name="Int8Array"),Int16Array.name||(Int16Array.name="Int16Array"),Int32Array.name||(Int32Array.name="Int32Array"),Uint8Array.name||(Uint8Array.name="Uint8Array"),Uint16Array.name||(Uint16Array.name="Uint16Array"),Uint32Array.name||(Uint32Array.name="Uint32Array")}catch(t){}function a(t,e){this.varName=t,this.expression=e}function c(t,e){return e instanceof a?new a(e.varName,t+e.expression):t+e}function l(t,e,i){Array.isArray(i)?(i[0]=c(e,i[0]),t.push(i)):t.push(c(e,i)+";")}function _(t){this._exps=[],this._targetExp=t}function v(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e){if(t instanceof cc.ValueType&&t.equals(e))return!0;if(Array.isArray(t)&&Array.isArray(e)||t.constructor===Object&&e.constructor===Object)try{return Array.isArray(t)&&Array.isArray(e)&&0===t.length&&0===e.length}catch(t){}}return!1}function d(t){return r.test(t)?"."+t:"["+y(t)+"]"}function x(t,e){this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=s.createMap(),s.mixin(this.funcModuleCache,g),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),s.value(t,"_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),0<this.globalVariables.length&&(i="var "+this.globalVariables.join(",")+";");var i,e=p.flattenCodeArray(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",e)(this.objs,this.funcs);for(var n=0,r=this.objsToClear_iN$t.length;n<r;++n)this.objsToClear_iN$t[n]._iN$t=null;this.objsToClear_iN$t.length=0}a.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},_.prototype.append=function(t,e){this._exps.push([t,e])},_.prototype.writeCode=function(t){var e;if(1<this._exps.length)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var n=this._exps[i];l(t,e+d(n[0])+"=",n[1])}},(_.pool=new s.Pool(function(t){t._exps.length=0,t._targetExp=null},1)).get=function(t){var e=this._get()||new _;return e._targetExp=t,e};t=x.prototype;t.getFuncModule=function(t,e){var i=s.getClassName(t);if(i){var n=this.funcModuleCache[i];if(n)return n;if(void 0===n)if(-1!==i.indexOf("."))try{if(t===Function("return "+i)())return this.funcModuleCache[i]=i}catch(t){}}n=this.funcs.indexOf(t),n<0&&(n=this.funcs.length,this.funcs.push(t)),t="F["+n+"]";return this.funcModuleCache[i]=t=e?"("+t+")":t},t.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},t.setValueType=function(t,e,i,n){for(var r=_.pool.get(n),s=(s=e.constructor.__props__)||Object.keys(e),o=0;o<s.length;o++){var a=s[o],c=i[a];e[a]!==c&&(c=this.enumerateField(i,a,c),r.append(a,c))}r.writeCode(t),_.pool.put(r)},t.enumerateCCClass=function(t,e,i){for(var n=i.__values__,r=h.getClassAttrs(i),s=0;s<n.length;s++){var o,a=n[s],c=e[a],l=r[a+m];v(l,c)||("object"==typeof c&&c instanceof cc.ValueType&&(l=u.getDefault(l))&&l.constructor===c.constructor?(o="o"+d(a),this.setValueType(t,l,c,o)):this.setObjProp(t,e,a,c))}},t.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new a(e,"new Array("+t.length+")")];s.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)l(i,e+"["+n+"]=",this.enumerateField(t,n,t[n]));return i},t.instantiateTypedArray=function(t){var e=t.constructor.name||function(t){if(t===Float32Array)return"Float32Array";if(t===Float64Array)return"Float64Array";if(t===Int8Array)return"Int8Array";if(t===Int16Array)return"Int16Array";if(t===Int32Array)return"Int32Array";if(t===Uint8Array)return"Uint8Array";if(t===Uint16Array)return"Uint16Array";if(t===Uint32Array)return"Uint32Array";throw new Error("Unknown TypedArray could not be instantiated: "+t)}(t.constructor);if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId,n=[new a(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&l(n,i+"["+r+"]=",t[r]);return n},t.enumerateField=function(t,e,i){var n,r,s;return"object"==typeof i&&i?(n=i._iN$t)?((r=n.globalVar)||(r=n.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r),s=n.source[0],n.source[0]=c(r+"=",s)),r):ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i):"function"==typeof i?this.getFuncModule(i):"string"==typeof i?y(i):("_objFlags"===e&&t instanceof o&&(i&=f),i)},t.setObjProp=function(t,e,i,n){l(t,"o"+d(i)+"=",this.enumerateField(e,i,n))},t.enumerateObject=function(t,e){var i,n=e.constructor;if(cc.Class._isCCClass(n))this.enumerateCCClass(t,e,n);else for(var r in e)!e.hasOwnProperty(r)||95===r.charCodeAt(0)&&95===r.charCodeAt(1)&&"__type__"!==r||("object"==typeof(i=e[r])&&i&&i===e._iN$t||this.setObjProp(t,e,r,i))},t.instantiateObj=function(t){if(t instanceof cc.ValueType)return u.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&n)return null;var e,i=t.constructor;if(cc.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new a("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new a("o","{}");else{if(i)return this.getObjRef(t);e=new a("o","Object.create(null)")}i=[e];return s.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(i,t),["(function(){",i,"return o;})();"]},e.exports={compile:function(t){return new x(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:v}},{"./CCClass":189,"./CCObject":195,"./attribute":201,"./compiler":203,"./js":209}],208:[function(t,i,r){"use strict";var f=t("./CCObject"),p=t("../value-types/value-type"),h=f.Flags.Destroyed,v=f.Flags.PersistentMask,s=t("./utils").isDomNode,m=t("./js");function e(t,e){if(!e){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null}var i;if(t instanceof f){if(t._instantiate)return cc.game._isCloning=!0,i=t._instantiate(),cc.game._isCloning=!1,i;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,i=n(t),cc.game._isCloning=!1,i}var y=[];function n(t,e){if(Array.isArray(t))return null;if(s&&s(t))return null;var i;i=t._iN$t||(t.constructor?new t.constructor:Object.create(null)),l(t,i,e);for(var n=0,r=y.length;n<r;++n)y[n]._iN$t=null;return y.length=0,i}function l(t,e,i){m.value(t,"_iN$t",e,!0),y.push(t);var n,h=t.constructor;if(cc.Class._isCCClass(h)){var u=t;var r=e;var _=i;for(var d=h.__values__,s=0;s<d.length;s++){var o,a=d[s],c=u[a];"object"==typeof c&&c?(o=r[a])instanceof p&&o.constructor===c.constructor?o.set(c):r[a]=c._iN$t||g(c,_):r[a]=c}}else for(var l in t)!t.hasOwnProperty(l)||95===l.charCodeAt(0)&&95===l.charCodeAt(1)&&"__type__"!==l||("object"==typeof(n=t[l])&&n?n!==e&&(e[l]=n._iN$t||g(n,i)):e[l]=n);t instanceof f&&(e._objFlags&=v)}function g(t,e){if(t instanceof p)return t.clone();if(t instanceof cc.Asset)return t;if(ArrayBuffer.isView(t)){var i=t.length,n=new t.constructor(i);t._iN$t=n,y.push(t);for(var r=0;r<i;++r)n[r]=t[r];return n}if(Array.isArray(t)){var s=t.length;n=new Array(s),m.value(t,"_iN$t",n,!0),y.push(t);for(var o=0;o<s;++o){var a=t[o];n[o]="object"==typeof a&&a?a._iN$t||g(a,e):a}return n}if(t._objFlags&h)return null;var c=t.constructor;if(cc.Class._isCCClass(c)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t;n=new c}else if(c===Object)n={};else{if(c)return t;n=Object.create(null)}return l(t,n,e),n}e._clone=n,cc.instantiate=e,i.exports=e},{"../value-types/value-type":287,"./CCObject":195,"./js":209,"./utils":213}],209:[function(t,i,u){"use strict";var _=new(t("./id-generater"))("TmpCId.");function n(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function d(t,e,i){e=n(e,t);Object.defineProperty(i,t,e)}var r,s,f,a={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n)if("object"==typeof n)for(var r in n)r in t||d(r,n,t);else cc.errorID(5402,n)}return t},mixin:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n)if("object"==typeof n)for(var r in n)d(r,n,t);else cc.errorID(5403,n)}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){t=t.prototype,t=t&&Object.getPrototypeOf(t);return t&&t.constructor},isChildClassOf:function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=a.getSuper(t)))return!1;if(t===e)return!0}}return!1},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},isEmptyObject:function(t){for(var e in t)return!1;return!0},getPropertyDescriptor:n},o={value:void 0,enumerable:!1,writable:!1,configurable:!0},c={get:null,set:null,enumerable:!(a.value=function(t,e,i,n,r){o.value=i,o.writable=n,o.enumerable=r,Object.defineProperty(t,e,o),o.value=void 0})},l={get:null,enumerable:!(a.getset=function(t,e,i,n,r,s){"function"!=typeof n&&(r=n,n=void 0),c.get=i,c.set=n,c.enumerable=r,c.configurable=s,Object.defineProperty(t,e,c),c.get=null,c.set=null}),configurable:!1},h={set:null,enumerable:!(a.get=function(t,e,i,n,r){l.get=i,l.enumerable=n,l.configurable=r,Object.defineProperty(t,e,l),l.get=null}),configurable:!1};function p(n,t,r){return a.getset(a,t,function(){return Object.assign({},r)},function(t){a.clear(r),Object.assign(r,t)}),function(t,e){var i;e.prototype.hasOwnProperty(n)&&delete r[e.prototype[n]],a.value(e.prototype,n,t),t&&((i=r[t])&&i!==e?cc.error("A Class already exists with the same "+n+' : "'+t+'".'):r[t]=e)}}a.set=function(t,e,i,n,r){h.set=i,h.enumerable=n,h.configurable=r,Object.defineProperty(t,e,h),h.set=null},a.getClassName=function(t){if("function"!=typeof t)return t&&t.constructor?a.getClassName(t.constructor):"";var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;e="";return t.name&&(e=t.name),!t.toString||(t="["===(t=t.toString()).charAt(0)?t.match(/\[\w+\s*(\w+)\]/):t.match(/function\s*(\w+)/))&&2===t.length&&(e=t[1]),"Object"!==e?e:""},r={},s={},a._setClassId=p("__cid__","_registeredClassIds",r),f=p("__classname__","_registeredClassNames",s),a.setClassName=function(t,e){f(t,e),e.prototype.hasOwnProperty("__cid__")||(t=t||_.getNewId())&&a._setClassId(t,e)},a.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t].prototype,i=e.__cid__,i=(i&&delete r[i],e.__classname__);i&&delete s[i]}},a._getClassById=function(t){return r[t]},a.getClassByName=function(t){return s[t]},a._getClassId=function(t,e){if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""},a.obsolete=function(t,e,i,n){var r=/([^.]+)$/,e=r.exec(e)[0],s=r.exec(i)[0];function o(){return this[s]}n?a.getset(t,e,o,function(t){this[s]=t}):a.get(t,e,o)},a.obsoletes=function(t,e,i,n){for(var r in i){var s=i[r];a.obsolete(t,e+"."+r,s,n)}};var m=/(%d)|(%s)/,y=/%s/;function g(t,e){t.splice(e,1)}function v(t,e){e=t.indexOf(e);return 0<=e&&(g(t,e),!0)}a.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&m.test(e))for(var i=1;i<t;++i){var n=arguments[i],r="number"==typeof n?m:y;r.test(e)?e=e.replace(r,n):e+=" "+n}else for(var s=1;s<t;++s)e+=" "+arguments[s];return e},a.shiftArguments=function(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e},a.createMap=function(t){var e=Object.create(null);return t&&(e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]),e};var x=Array.prototype.indexOf;function e(t,e){void 0===e&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t}a.array={remove:v,fastRemove:function(t,e){0<=(e=t.indexOf(e))&&(t[e]=t[t.length-1],--t.length)},removeAt:g,fastRemoveAt:function(t,e){var i=t.length;e<0||i<=e||(t[e]=t[i-1],t.length=i-1)},contains:function(t,e){return 0<=t.indexOf(e)},verifyType:function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.logID(1300),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;i<n;i++)v(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){for(var e=t.length,i=new Array(e),n=0;n<e;n+=1)i[n]=t[n];return i},indexOf:x,MutableForwardIterator:t("../utils/mutable-forward-iterator")},e.prototype._get=function(){var t;return 0<this.count?(--this.count,t=this._pool[this.count],this._pool[this.count]=null,t):null},e.prototype.put=function(t){var e=this._pool;this.count<e.length&&(this._cleanup&&!1===this._cleanup(t)||(e[this.count]=t,++this.count))},e.prototype.resize=function(t){0<=t&&(this._pool.length=t,this.count>t&&(this.count=t))},a.Pool=e,cc.js=a,i.exports=a},{"../utils/mutable-forward-iterator":265,"./id-generater":205}],210:[function(t,e,a){"use strict";var s=t("./js"),o=t("./attribute"),c={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function l(t,e,i,n){t=t?{_short:!0}:{_short:!0,default:e};return i&&(n?t.url=i:t.type=i),t}a.getFullFormOfProperty=function(t,e,i,n){var r;return t&&t.constructor===Object?null:Array.isArray(t)&&0<t.length?(t[0],l(e,[],t)):"function"==typeof t?(r=t,cc.RawAsset.isRawAssetType(r)||cc.RawAsset.wasRawAssetType(r)?l(e,"",r,!0):l(e,s.isChildClassOf(r,cc.ValueType)?new r:null,r)):t instanceof o.PrimitiveType?l(e,t.default):l(e,t)},a.preprocessAttrs=function(t,e,i,n){for(var r in t){var s=t[r],o=a.getFullFormOfProperty(s,!1,r,e);(s=o?t[r]=o:s)&&((o=s.notify)&&function(t,e,i,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r,s="_N$"+e,o=(t.get=function(){return this[s]},t.set=function(t){var e=this[s];this[s]=t,i.call(this,e)},{});for(r in n[s]=o,c){var a=c[r];t.hasOwnProperty(r)&&(o[r]=t[r],a.canUsedInGet||delete t[r])}}}(s,r,o,t),"type"in s&&function(t,e,i,n){if(Array.isArray(e)){if(!(0<e.length))return cc.errorID(5508,i,n);if(cc.RawAsset.isRawAssetType(e[0]))return t.url=e[0],delete t.type;t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=cc.String:e===Boolean?t.type=cc.Boolean:e===Number&&(t.type=cc.Float))}(s,s.type,e,r),"url"in s&&(r=(o=s).url,Array.isArray(r)&&0<r.length&&(r=r[0]),o.type=r),"type"in s&&s.type)}},a.validateMethodWithProps=function(t,e,i,n,r){return"function"==typeof t||null===t}},{"./CCClass":189,"./attribute":201,"./js":209}],211:[function(t,e,i){"use strict";var r=[];cc._RF={push:function(t,e,i){void 0===i&&(i=e,e=""),r.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},pop:function(){var t=r.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var n in i)return;e.exports=t.cls}},peek:function(){return r[r.length-1]}}},{}],212:[function(t,e,i){"use strict";cc.url={_rawAssets:"",normalize:function(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t},raw:function(t){if((t=this.normalize(t)).startsWith("resources/")){var e=cc.loader._getResUuid(t.slice(10),cc.Asset,null,!0);if(e)return cc.AssetLibrary.getLibUrlNoExt(e,!0)+cc.path.extname(t)}else cc.errorID(7002,t);return this._rawAssets+t},_init:function(t){this._rawAssets=cc.path.stripSep(t)+"/"}},e.exports=cc.url},{}],213:[function(t,e,i){"use strict";t("./js");e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0}while(null!==(i=i.parentNode));return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i)},0)}}},{"./js":209}],214:[function(t,e,i){"use strict";t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./load-pipeline"),t("./CCDirector"),t("./renderer"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager")},{"./CCDirector":28,"./CCScheduler":33,"./event":117,"./event-manager":113,"./load-pipeline":144,"./platform/CCInputExtension":192,"./platform/CCInputManager":193,"./platform/CCMacro":194,"./platform/CCScreen":197,"./platform/CCSys":198,"./platform/CCView":199,"./platform/js":209,"./renderer":220,"./utils":262,"./value-types":279}],215:[function(t,h,e){"use strict";e.__esModule=!0,e.default=void 0;var i=r(t("./assembler")),n=r(t("./utils/dynamic-atlas/manager")),u=r(t("./webgl/render-data"));function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _(n){return function(){var t,e,i=a(n);return t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=a(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(e=t)||"object"!=typeof e&&"function"!=typeof e?o(i):e}}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}c=i.default,t=c,(i=l).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,_(l),(i=l.prototype).initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount)},i.initLocal=function(){this._local=[],this._local.length=4},i.updateColor=function(t,e){var i=this._renderData.uintVDatas[0];if(i){e=e||t.node.color._val;for(var n=this.floatsPerVert,r=this.colorOffset,s=i.length;r<s;r+=n)i[r]=e}},i.getBuffer=function(){return cc.renderer._handle._meshBuffer},i.updateWorldVerts=function(t){var h,u,_,e=this._local,i=this._renderData.vDatas[0],t=t.node._worldMatrix.m,n=t[0],r=t[1],d=t[4],s=t[5],o=t[12],t=t[13],a=e[0],c=e[2],l=e[1],e=e[3];1===n&&0===r&&0===d&&1===s?(i[0]=a+o,i[1]=l+t,i[5]=c+o,i[6]=l+t,i[10]=a+o,i[11]=e+t,i[15]=c+o,i[16]=e+t):(h=n*c,u=r*a,r=r*c,c=d*e,_=s*l,s=s*e,i[0]=(e=n*a)+(n=d*l)+o,i[1]=u+_+t,i[5]=h+n+o,i[6]=r+_+t,i[10]=e+c+o,i[11]=u+s+t,i[15]=h+c+o,i[16]=r+s+t)},i.fillBuffers=function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);for(var t=this._renderData,i=t.vDatas[0],n=t.iDatas[0],t=this.getBuffer(e),e=t.request(this.verticesCount,this.indicesCount),r=e.byteOffset>>2,s=t._vData,o=(i.length+r>s.length?s.set(i.subarray(0,s.length-r),r):s.set(i,r),t._iData),a=e.indiceOffset,c=e.vertexOffset,l=0,h=n.length;l<h;l++)o[a++]=c+n[l]},i.packToDynamicAtlas=function(t,e){e._original||!n.default||!e._texture.packable||(i=n.default.insertSpriteFrame(e))&&e._setDynamicAtlasFrame(i);var i=t._materials[0];i&&i.getProperty("texture")!==e._texture&&(t._vertsDirty=!0,t._updateMaterial())},t=l,(i=[{key:"verticesFloats",get:function(){return this.verticesCount*this.floatsPerVert}}])&&s(t.prototype,i),d&&s(t,d);var c,d,i=l;function l(){var t=c.call(this)||this;return t._renderData=new u.default,t._renderData.init(o(t)),t.initData(),t.initLocal(),t}e.default=i,cc.js.addon(i.prototype,{floatsPerVert:5,verticesCount:4,indicesCount:6,uvOffset:2,colorOffset:4}),cc.Assembler2D=i,h.exports=e.default},{"./assembler":217,"./utils/dynamic-atlas/manager":223,"./webgl/render-data":250}],216:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../utils/pool"))&&t.__esModule?t:{default:t};function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s,o,h=0;function a(t){return Object.getOwnPropertyDescriptor(t,"__assemblerId__")||(t.__assemblerId__=++h),t.__assemblerId__}function c(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(t=s.call.apply(s,[this].concat(i))||this)._pool={},t}s=t.default,l=s,(o=c).prototype=Object.create(l.prototype),(o.prototype.constructor=o).__proto__=l,n(c),(o=c.prototype).put=function(t){var e,i;t&&this.enabled&&(e=a(t.constructor),(i=this._pool)[e]||(i[e]=[]),this.count>this.maxSize||(this._clean(t),i[e].push(t),this.count++))},o.get=function(t){var e,i,n;return(n=this.enabled?(e=this._pool)[i=a(t)]&&e[i].pop():n)?this.count--:n=new t,n},o.clear=function(){this._pool={},this.count=0},o._clean=function(t){t._renderComp=null};var l=new c;t.default.register("assembler",l),i.default=l,e.exports=i.default},{"../utils/pool":266}],217:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("./webgl/vertex-format"),r=(t=t("./assembler-pool"))&&t.__esModule?t:{default:t};(t=s.prototype).init=function(t){this._renderComp=t},t.updateRenderData=function(t){},t.fillBuffers=function(t,e){},t.getVfmt=function(){return n.vfmtPosUvColor};t=s;function s(){this._extendNative&&this._extendNative()}(i.default=t).register=function(t,e){t.__assembler__=e},t.init=function(t){for(var e,i=t.constructor,n=i.__assembler__;!n;){if(!(i=i.$super))return void cc.warn("Can not find assembler for render component : ["+cc.js.getClassName(t)+"]");n=i.__assembler__}n.getConstructor&&(n=n.getConstructor(t)),t._assembler&&t._assembler.constructor===n||((e=r.default.get(n)).init(t),t._assembler=e)},cc.Assembler=t,e.exports=i.default},{"./assembler-pool":216,"./webgl/vertex-format":252}],218:[function(t,e,i){"use strict";function n(t){var e;try{e=t.getContext("2d")}catch(t){return void console.error(t)}this._canvas=t,this._ctx=e,this._caps={},this._stats={drawcalls:0},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0}n.prototype._restoreTexture=function(t){},n.prototype.setViewport=function(t,e,i,n){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===n||(this._vx=t,this._vy=e,this._vw=i,this._vh=n)},n.prototype.setScissor=function(t,e,i,n){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===n||(this._sx=t,this._sy=e,this._sw=i,this._sh=n)},n.prototype.clear=function(t){var e=this._ctx;e.clearRect(this._vx,this._vy,this._vw,this._vh),!t||0===t[0]&&0===t[1]&&0===t[2]||(e.fillStyle="rgb("+t[0]+","+t[1]+","+t[2]+")",e.globalAlpha=t[3],e.fillRect(this._vx,this._vy,this._vw,this._vh))},n.prototype.resetDrawCalls=function(){this._stats.drawcalls=0},n.prototype.getDrawCalls=function(){return this._stats.drawcalls},e.exports=n},{}],219:[function(t,e,i){"use strict";function n(t,e){this._device=t,this._width=4,this._height=4,this._image=null,e&&(void 0!==e.width&&(this._width=e.width),void 0!==e.height&&(this._height=e.height),this.updateImage(e))}n.prototype.update=function(t){this.updateImage(t)},n.prototype.updateImage=function(t){t.images&&t.images[0]&&((t=t.images[0])&&t!==this._image&&(this._image=t))},n.prototype.destroy=function(){this._image=null},e.exports=n},{}],220:[function(s,t,e){"use strict";e.__esModule=!0,e.default=void 0;var o=r(s("../../renderer/gfx")),i=r(s("../../renderer/core/input-assembler")),n=r(s("../../renderer/core/pass"));function r(t){return t&&t.__esModule?t:{default:t}}i=cc.renderer={Texture2D:null,InputAssembler:i.default,Pass:n.default,renderEngine:null,canvas:null,device:null,scene:null,drawCalls:0,_handle:null,_cameraNode:null,_camera:null,_forward:null,_flow:null,initWebGL:function(t,e){s("./webgl/assemblers");var i=s("./webgl/model-batcher"),n=(this.Texture2D=o.default.Texture2D,this.canvas=t,this._flow=cc.RenderFlow,s("../../renderer/scene/scene")),r=s("../../renderer/renderers/forward-renderer"),e=(this.device=new o.default.Device(t,e),this.scene=new n,t=this.device,{defaultTexture:new o.default.Texture2D(t,{images:[],width:128,height:128,wrapS:o.default.WRAP_REPEAT,wrapT:o.default.WRAP_REPEAT,format:o.default.TEXTURE_FMT_RGB8,mipmap:!1}),programTemplates:[],programChunks:{}});this._forward=new r(this.device,e),this._handle=new i(this.device,this.scene),this._flow.init(this._handle,this._forward)},initCanvas:function(t){var e=s("./canvas"),i=s("./canvas/Texture2D"),n=s("./canvas/Device");this.Device=n,this.Texture2D=i,this.canvas=t,this.device=new n(t),this._camera={a:1,b:0,c:0,d:1,tx:0,ty:0},this._handle=new e.RenderComponentHandle(this.device,this._camera),this._forward=new e.ForwardRenderer,this._flow=cc.RenderFlow,this._flow.init(this._handle,this._forward)},updateCameraViewport:function(){var t;!cc.director||(t=cc.director.getScene())&&t.setScale(1,1,1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(t=cc.view.getViewportRect(),this.device.setViewport(t.x,t.y,t.width,t.height),this._camera.a=cc.view.getScaleX(),this._camera.d=cc.view.getScaleY(),this._camera.tx=t.x,this._camera.ty=t.y+t.height)},render:function(t,e){this.device.resetDrawCalls(),t&&(this._flow.render(t,e),this.drawCalls=this.device.getDrawCalls())},clear:function(){this._handle.reset(),this._forward.clear()}};e.default=i,t.exports=e.default},{"../../renderer/core/input-assembler":302,"../../renderer/core/pass":303,"../../renderer/gfx":312,"../../renderer/renderers/forward-renderer":331,"../../renderer/scene/scene":334,"./canvas":void 0,"./canvas/Device":218,"./canvas/Texture2D":219,"./webgl/assemblers":232,"./webgl/model-batcher":248}],221:[function(e,i,l){"use strict";var u,n,t=0,r=(t++,t++,t++,t++,t++,t++,t++,t++,t++,1024),_=0;function s(){this._func=h,this._next=null}var t=s.prototype,o=(t._doNothing=function(){},t._localTransform=function(t){t._updateLocalMatrix(),t._renderFlag&=-5,this._next._func(t)},t._worldTransform=function(t){u.worldMatDirty++;var e=t._matrix,i=t._trs,n=e.m;n[12]=i[0],n[13]=i[1],n[14]=i[2],t._mulMat(t._worldMatrix,t._parent._worldMatrix,e),t._renderFlag&=-9,this._next._func(t),u.worldMatDirty--},t._opacity=function(t){u.parentOpacityDirty++,t._renderFlag&=-33,this._next._func(t),u.parentOpacityDirty--},t._color=function(t){var e=t._renderComponent;e&&e._updateColor(),t._renderFlag&=-65,this._next._func(t)},t._updateRenderData=function(t){var e=t._renderComponent;e._assembler.updateRenderData(e),t._renderFlag&=-17,this._next._func(t)},t._render=function(t){var e=t._renderComponent;e._checkBacth(u,t._cullingMask),e._assembler.fillBuffers(e,u),this._next._func(t)},t._children=function(t){for(var e=_,i=u,n=i.parentOpacity,r=i.parentOpacity*=t._opacity/255,s=(i.worldMatDirty?8:0)|(i.parentOpacityDirty?96:0),o=t._children,a=0,h=o.length;a<h;a++){var c,l=o[a];l._renderFlag|=s,l._activeInHierarchy&&0!==l._opacity&&(_=l._cullingMask=0===l.groupIndex?e:1<<l.groupIndex,c=l._color._val,l._color._fastSetA(l._opacity*r),d[l._renderFlag]._func(l),l._color._val=c)}i.parentOpacity=n,this._next._func(t)},t._postRender=function(t){var e=t._renderComponent;e._checkBacth(u,t._cullingMask),e._assembler.postFillBuffers(e,u),this._next._func(t)},new s),d=(o._func=o._doNothing,o._next=o,{});function a(t,e){var i=new s;switch(i._next=e||o,t){case 1:case 2:i._func=i._doNothing;break;case 4:i._func=i._localTransform;break;case 8:i._func=i._worldTransform;break;case 32:i._func=i._opacity;break;case 64:i._func=i._color;break;case 16:i._func=i._updateRenderData;break;case 128:i._func=i._render;break;case 256:i._func=i._children;break;case 512:i._func=i._postRender}return i}function h(t){var e=t._renderFlag;(d[e]=function(t){for(var e=null,i=r;0<i;)i&t&&(e=a(i,e)),i>>=1;return e}(e))._func(t)}s.flows=d,s.createFlow=a;var c=[];s.registerValidate=function(t){t._inValidateList||(c.push(t),t._inValidateList=!0)},s.validateRenderers=function(){for(var t=0,e=c.length;t<e;t++){var i=c[t];i.isValid&&(i.enabledInHierarchy?i._validateRender():i.disableRender(),i._inValidateList=!1)}c.length=0},s.visitRootNode=function(t){s.validateRenderers(),_=1<<t.groupIndex,8&t._renderFlag?(u.worldMatDirty++,t._calculWorldMatrix(),t._renderFlag&=-9,d[t._renderFlag]._func(t),u.worldMatDirty--):d[t._renderFlag]._func(t)},s.render=function(t,e){u.reset(),u.walking=!0,s.visitRootNode(t),u.terminate(),u.walking=!1,n.render(u._renderScene,e)},s.init=function(t,e){u=t,n=e,d[0]=o;for(var i=1;i<r;i++)d[i]=new s},s.getBachther=function(){return u},s.FLAG_DONOTHING=1,s.FLAG_BREAK_FLOW=2,s.FLAG_LOCAL_TRANSFORM=4,s.FLAG_WORLD_TRANSFORM=8,s.FLAG_TRANSFORM=12,s.FLAG_OPACITY=32,s.FLAG_COLOR=64,s.FLAG_OPACITY_COLOR=96,s.FLAG_UPDATE_RENDER_DATA=16,s.FLAG_RENDER=128,s.FLAG_CHILDREN=256,s.FLAG_POST_RENDER=512,s.FLAG_FINAL=r,i.exports=cc.RenderFlow=s},{}],222:[function(t,e,i){"use strict";var n=t("../../../assets/CCRenderTexture");function r(t,e){var i=new n;i.initWithSize(t,e),i.update(),this._texture=i,this._x=2,this._y=2,this._nexty=2,this._width=t,this._height=e,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}r.DEFAULT_HASH=(new n)._getHash(),cc.js.mixin(r.prototype,{insertSpriteFrame:function(t){var e=t._rect,i=t._texture,n=this._innerTextureInfos[i._id],r=e.x,e=e.y;if(n)r+=n.x,e+=n.y;else{var n=i.width,s=i.height;if(this._x+n+2>this._width&&(this._x=2,this._y=this._nexty),this._y+s+2>this._nexty&&(this._nexty=this._y+s+2),this._nexty>this._height)return null;cc.dynamicAtlasManager.textureBleeding&&((n<=8||s<=8)&&(this._texture.drawTextureAt(i,this._x-1,this._y-1),this._texture.drawTextureAt(i,this._x-1,this._y+1),this._texture.drawTextureAt(i,this._x+1,this._y-1),this._texture.drawTextureAt(i,this._x+1,this._y+1)),this._texture.drawTextureAt(i,this._x-1,this._y),this._texture.drawTextureAt(i,this._x+1,this._y),this._texture.drawTextureAt(i,this._x,this._y-1),this._texture.drawTextureAt(i,this._x,this._y+1)),this._texture.drawTextureAt(i,this._x,this._y),this._innerTextureInfos[i._id]={x:this._x,y:this._y,texture:i},this._count++,r+=this._x,e+=this._y,this._x+=n+2,this._dirty=!0}s={x:r,y:e,texture:this._texture};return this._innerSpriteFrames.push(t),s},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1)},deleteInnerTexture:function(t){t&&this._innerTextureInfos[t._id]&&(delete this._innerTextureInfos[t._id],this._count--)},isEmpty:function(){return this._count<=0},reset:function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var n=t[e];n.isValid&&n._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},destroy:function(){this.reset(),this._texture.destroy()}}),e.exports=r},{"../../../assets/CCRenderTexture":43}],223:[function(t,u,_){"use strict";var e=t("./atlas"),n=[],r=-1,s=5,i=2048,o=512,a=!0;function c(){var t=n[++r];return t||(t=new e(i,i),n.push(t)),t}function l(){d.reset()}var h=!1,d={Atlas:e,get enabled(){return h},set enabled(t){h!==t&&(t?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,l)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,l),h=t)},get maxAtlasCount(){return s},set maxAtlasCount(t){s=t},get textureBleeding(){return a},set textureBleeding(t){a=t},get textureSize(){return i},set textureSize(t){i=t},get maxFrameSize(){return o},set maxFrameSize(t){o=t},insertSpriteFrame:function(t){if(!h||r===s||!t||t._original)return null;if(!t._texture.packable)return null;var e=n[r],i=(e=e||c()).insertSpriteFrame(t);return i||r===s?i:(e=c()).insertSpriteFrame(t)},reset:function(){for(var t=0,e=n.length;t<e;t++)n[t].destroy();n.length=0,r=-1},deleteAtlasSpriteFrame:function(t){t._original&&(t=t._original._texture,this.deleteAtlasTexture(t))},deleteAtlasTexture:function(t){if(t)for(var e=n.length-1;0<=e;e--)n[e].deleteInnerTexture(t),n[e].isEmpty()&&(n[e].destroy(),n.splice(e,1),r--)},showDebug:!1,update:function(){if(this.enabled)for(var t=0;t<=r;t++)n[t].update()}};u.exports=cc.dynamicAtlasManager=d},{"./atlas":222}],224:[function(t,i,n){"use strict";n.__esModule=!0,n.default=void 0;var e=(e=t("../../assembler-2d"))&&e.__esModule?e:{default:e};function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""}var a,M=t("../../../utils/text-utils"),c=t("../../../platform/CCMacro"),A=t("../../../components/CCLabel").Overflow,C=t("../utils").shareLabelInfo,d=cc.rect(),p=null,I=[],f=[],S=[],m=[],B=null,R=0,P=0,y=0,D=0,L=0,T=1,g=null,w=cc.size(),V="",l=0,h=0,u=0,_=0,O=0,F=0,E=0,N=!1,k=0,G=0,z=0,t=(a=e.default,t=a,(e=v).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t,r(v),(e=v.prototype).updateRenderData=function(t){t._vertsDirty&&p!==t&&(p=t,this._reserveQuads(t,t.string.toString().length),this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),this.updateWorldVerts(t),p._actualFontSize=l,p.node.setContentSize(w),p._vertsDirty=!1,p=null,this._resetProperties())},e._updateFontScale=function(){T=l/h},e._updateFontFamily=function(t){var e=t.font;g=e.spriteFrame,B=e._fntConfig,C.fontAtlas=e._fontDefDictionary,this.packToDynamicAtlas(t,g)},e._updateLabelInfo=function(){C.hash="",C.margin=0},e._updateProperties=function(t){V=t.string.toString(),l=t.fontSize,h=(B||t).fontSize,u=t.horizontalAlign,_=t.verticalAlign,O=t.spacingX,E=t.overflow,F=t._lineHeight,w.width=t.node.width,w.height=t.node.height,E===A.NONE?(N=!1,w.width+=2*C.margin,w.height+=2*C.margin):E===A.RESIZE_HEIGHT?(N=!0,w.height+=2*C.margin):N=t.enableWrapText,C.lineHeight=F,C.fontSize=l,this._setupBMFontOverflowMetrics()},e._resetProperties=function(){g=B=null,C.hash="",C.margin=0},e._updateContent=function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},e._computeHorizontalKerningForText=function(){for(var t=V,e=t.length,i=B.kerningDict,n=I,r=-1,s=0;s<e;++s){var o=t.charCodeAt(s),a=i[r<<16|65535&o]||0;n[s]=s<e-1?a:0,r=o}},e._multilineTextWrap=function(h){for(var t,u=V.length,e=0,i=0,_=0,d=0,n=0,r=0,s=0,o=cc.v2(0,0),a=0;a<u;)if("\n"!==(c=V.charAt(a))){for(var f=h(V,a,u),p=r,m=s,y=n,g=i,v=!1,x=0;x<f;++x){var c,l=a+x;if("\r"!==(c=V.charAt(l)))if(t=C.fontAtlas.getLetterDefinitionForChar(c,C)){var b=g+t.offsetX*T-C.margin;if(N&&0<z&&0<i&&b+t.w*T>z&&!M.isUnicodeSpace(c)){S.push(n),e++,i=n=0,_-=F*this._getFontScale()+0,v=!0;break}o.x=b,o.y=_-t.offsetY*T+C.margin,this._recordLetterInfo(o,c,l,e),l+1<I.length&&l<u-1&&(g+=I[l+1]),g+=t.xAdvance*T+O-2*C.margin,y=o.x+t.w*T-C.margin,p<o.y&&(p=o.y),m>o.y-t.h*T&&(m=o.y-t.h*T)}else this._recordPlaceholderInfo(l,c),console.log("Can't find letter definition in texture atlas "+B.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(l,c)}v||(i=g,r<p&&(r=p),m<s&&(s=m),d<(n=y)&&(d=n),a+=f)}else S.push(n),e++,i=n=0,_-=F*this._getFontScale()+0,this._recordPlaceholderInfo(a,c),a++;return S.push(n),P=(R=e+1)*F*this._getFontScale(),1<R&&(P+=0*(R-1)),w.width=k,w.height=G,k<=0&&(w.width=parseFloat(d.toFixed(2))+2*C.margin),G<=0&&(w.height=parseFloat(P.toFixed(2))+2*C.margin),D=w.height,L=0,E!==A.CLAMP&&(0<r&&(D=w.height+r),s<-P&&(L=P+s)),!0},e._getFirstCharLen=function(){return 1},e._getFontScale=function(){return E===A.SHRINK?T:1},e._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(M.isUnicodeCJK(n)||"\n"===n||M.isUnicodeSpace(n))return 1;var r=1,s=C.fontAtlas.getLetterDefinitionForChar(n,C);if(!s)return r;for(var o=s.xAdvance*T+O,a=e+1;a<i&&(n=t.charAt(a),s=C.fontAtlas.getLetterDefinitionForChar(n,C));++a){if(o+s.offsetX*T+s.w*T>z&&!M.isUnicodeSpace(n)&&0<z)return r;if(o+=s.xAdvance*T+O,"\n"===n||M.isUnicodeSpace(n)||M.isUnicodeCJK(n))break;r++}return r},e._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen)},e._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen)},e._recordPlaceholderInfo=function(t,e){var i;t>=f.length&&(i=new o,f.push(i)),f[t].char=e,f[t].hash=e.charCodeAt(0)+C.hash,f[t].valid=!1},e._recordLetterInfo=function(t,e,i,n){i>=f.length&&(r=new o,f.push(r));var r=e.charCodeAt(0)+C.hash;f[i].line=n,f[i].char=e,f[i].hash=r,f[i].valid=C.fontAtlas.getLetter(r).valid,f[i].x=t.x,f[i].y=t.y},e._alignText=function(){P=0,S.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),E===A.SHRINK&&0<l&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||E===A.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},e._scaleFontSizeDown=function(t){var e=!0;t||(e=!(t=.1)),l=t,e&&this._updateContent()},e._shrinkLabelToContentSize=function(t){for(var e=0,i=0|l;e<i;){var n,r=n=e+i+1>>1;if(r<=0)break;T=r/h,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?i=n-1:e=n}var s=e;0<=s&&this._scaleFontSizeDown(s)},e._isVerticalClamp=function(){return P>w.height},e._isHorizontalClamp=function(){for(var t=!1,e=0,i=V.length;e<i;++e){var n=f[e];if(n.valid){var r=C.fontAtlas.getLetter(n.hash),r=n.x+r.w*T,n=n.line;if(0<k)if(N){if(S[n]>w.width&&(r>w.width||r<0)){t=!0;break}}else if(r>w.width){t=!0;break}}}return t},e._isHorizontalClamped=function(t,e){e=S[e],t=t>w.width||t<0;return(!N||e>w.width)&&t},e._updateQuads=function(){for(var t=g?g._texture:C.fontAtlas.getTexture(),e=p.node,i=(this.verticesCount=this.indicesCount=0,this._renderData&&(this._renderData.dataLength=0),w),h=e._anchorPoint.x*i.width,u=e._anchorPoint.y*i.height,n=!0,r=0,_=V.length;r<_;++r){var s=f[r];if(s.valid){var o=C.fontAtlas.getLetter(s.hash),a=(d.height=o.h,d.width=o.w,d.x=o.u,d.y=o.v,s.y+y),c=(0<G&&(D<a&&(c=a-D,d.y+=c,d.height-=c,a-=c),a-o.h*T<L&&E===A.CLAMP&&(d.height=a<L?0:(a-L)/T)),s.line),l=s.x+o.w/2*T+m[c];if(0<k&&this._isHorizontalClamped(l,c))if(E===A.CLAMP)d.width=0;else if(E===A.SHRINK){if(w.width>o.w){n=!1;break}d.width=0}0<d.height&&0<d.width&&(l=this._determineRect(d),o=s.x+m[s.line],this.appendQuad(p,t,d,l,o-h,a-u,T))}}return this._quadsUpdated(p),n},e._determineRect=function(t){var e=g.isRotated(),i=g._originalSize,n=g._rect,r=g._offset,s=r.x+(i.width-n.width)/2,r=r.y-(i.height-n.height)/2;return e?(i=t.x,t.x=n.x+n.height-t.y-t.height-r,t.y=i+n.y-s,t.y<0&&(t.height=t.height+r)):(t.x+=n.x-s,t.y+=n.y+r),e},e._computeAlignmentOffset=function(){switch(m.length=0,u){case c.TextAlignment.LEFT:for(var t=0;t<R;++t)m.push(0);break;case c.TextAlignment.CENTER:for(var e=0,i=S.length;e<i;e++)m.push((w.width-S[e])/2);break;case c.TextAlignment.RIGHT:for(var n=0,r=S.length;n<r;n++)m.push(w.width-S[n])}var s;y=w.height,_!==c.VerticalTextAlignment.TOP&&(s=w.height-P+F*this._getFontScale()-h*T,_===c.VerticalTextAlignment.BOTTOM?y-=s:y-=s/2)},e._setupBMFontOverflowMetrics=function(){var t=w.width,e=w.height;E===A.RESIZE_HEIGHT&&(e=0),E===A.NONE&&(e=t=0),G=e,z=k=t},e.updateWorldVerts=function(){},e.appendQuad=function(t,e,i,n,r,s,o){},e._quadsUpdated=function(t){},e._reserveQuads=function(){},v);function v(){return a.apply(this,arguments)||this}n.default=t,i.exports=n.default},{"../../../components/CCLabel":80,"../../../platform/CCMacro":194,"../../../utils/text-utils":271,"../../assembler-2d":215,"../utils":228}],225:[function(t,e,i){"use strict";function n(){this._rect=null,this.uv=[],this._texture=null,this._original=null}n.prototype={constructor:n,getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_refreshTexture:function(t){this._texture=t,this._rect=cc.rect(0,0,t.width,t.height),this._calculateUV()},_calculateUV:function(){var t=this._rect,e=this._texture,i=this.uv,n=e.width,e=e.height,r=0===n?0:t.x/n,n=0===n?0:(t.x+t.width)/n,s=0===e?0:(t.y+t.height)/e,t=0===e?0:t.y/e;i[0]=r,i[1]=s,i[2]=n,i[3]=s,i[4]=r,i[5]=t,i[6]=n,i[7]=t}},e.exports=n},{}],226:[function(t,h,e){"use strict";e.__esModule=!0,e.default=void 0;var i=(i=t("../../webgl/assemblers/label/2d/bmfont"))&&i.__esModule?i:{default:i};function u(i){return function(){var t,e=n(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=n(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=t("../../../components/CCLabel"),d=t("../../../components/CCLabelOutline"),a=t("../../../utils/text-utils"),r=t("../../../components/CCComponent"),f=t("../../../assets/CCRenderTexture"),p=cc.js.isChildClassOf(d,r),m=t("../utils").getFontFamily,s=t("../utils").shareLabelInfo,y=cc.BitmapFont.FontLetterDefinition,g=cc.BitmapFont.FontAtlas,v=cc.Color.WHITE,x=(1/255).toFixed(3);function o(t,e){this._texture=null,this._labelInfo=e,this._char=t,this._hash=null,this._data=null,this._canvas=null,this._context=null,this._width=0,this._height=0,this._offsetY=0,this._hash=t.charCodeAt(0)+e.hash}function b(t,e){var i=new f;i.initWithSize(t,e),i.update(),this._fontDefDictionary=new g(i),this._x=0,this._y=0,this._nexty=0,this._width=t,this._height=e,cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}o.prototype={constructor:o,updateRenderData:function(){this._updateProperties(),this._updateTexture()},_updateProperties:function(){this._texture=new cc.Texture2D,this._data=_._canvasPool.get(),this._canvas=this._data.canvas,this._context=this._data.context,this._context.font=this._labelInfo.fontDesc;var t=a.safeMeasureText(this._context,this._char,this._labelInfo.fontDesc),e=2*this._labelInfo.margin+2;this._width=parseFloat(t.toFixed(2))+e,this._height=(1+a.BASELINE_RATIO)*this._labelInfo.fontSize+e,this._offsetY=-this._labelInfo.fontSize*a.BASELINE_RATIO/2,this._canvas.width!==this._width&&(this._canvas.width=this._width),this._canvas.height!==this._height&&(this._canvas.height=this._height),this._texture.initWithElement(this._canvas)},_updateTexture:function(){var t=this._context,e=this._labelInfo,i=this._canvas.width,n=this._canvas.height,r=i/2,s=n/2+this._labelInfo.fontSize*a.MIDDLE_RATIO,o=e.color;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,n),t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", "+x+")",t.fillRect(0,0,i,n),t.font=e.fontDesc,t.lineJoin="round",t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", 1)",e.isOutlined&&0<e.margin&&(i=e.out||v,t.strokeStyle="rgba("+i.r+", "+i.g+", "+i.b+", "+i.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this._char,r,s)),t.fillText(this._char,r,s),this._texture.handleLoadedTexture()},destroy:function(){this._texture.destroy(),this._texture=null,_._canvasPool.put(this._data)}},cc.js.mixin(b.prototype,{insertLetterTexture:function(t){var e=t._texture,i=e.width,n=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nexty),this._y+n>this._nexty&&(this._nexty=this._y+n+0),this._nexty>this._height)return null;this._fontDefDictionary._texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;n=new y;return n.u=this._x+1,n.v=this._y+1,n.texture=this._fontDefDictionary._texture,n.valid=!0,n.w=t._width-2,n.h=t._height-2,n.xAdvance=n.w,n.offsetY=t._offsetY,this._x+=i+0,this._fontDefDictionary.addLetterDefinitions(t._hash,n),n},update:function(){this._dirty&&(this._fontDefDictionary._texture.update(),this._dirty=!1)},reset:function(){this._x=0,this._y=0,this._nexty=0;for(var t=this._fontDefDictionary._letterDefinitions,e=0,i=t.length;e<i;e++){var n=t[e];n.isValid&&n.destroy()}this._fontDefDictionary.clear()},destroy:function(){this.reset(),this._fontDefDictionary._texture.destroy(),this._fontDefDictionary._texture=null},beforeSceneLoad:function(){this.clearAllCache()},clearAllCache:function(){this.destroy();var t=new f;t.initWithSize(this._width,this._height),t.update(),this._fontDefDictionary._texture=t},getLetter:function(t){return this._fontDefDictionary._letterDefinitions[t]},getTexture:function(){return this._fontDefDictionary.getTexture()},getLetterDefinitionForChar:function(t,e){var i=t.charCodeAt(0)+e.hash,i=this._fontDefDictionary._letterDefinitions[i];return i||((t=new o(t,e)).updateRenderData(),i=this.insertLetterTexture(t),t.destroy()),i}});var A,c=null,i=(A=i.default,r=A,(t=l).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r,u(l),(t=l.prototype)._getAssemblerData=function(){return c||(c=new b(2048,2048),cc.Label._shareAtlas=c),c.getTexture()},t._updateFontFamily=function(t){s.fontAtlas=c,s.fontFamily=m(t);var e=p&&t.getComponent(d);e&&e.enabled?(s.isOutlined=!0,s.margin=e.width,s.out=e.color.clone(),s.out.a=e.color.a*t.node.color.a/255):(s.isOutlined=!1,s.margin=0)},t._updateLabelInfo=function(t){var e,i;s.fontDesc=this._getFontDesc(),s.color=t.node.color,s.hash=(e=(t=s).color.toHEX("#rrggbb"),i="",t.isOutlined&&0<t.margin&&(i=i+t.margin+t.out.toHEX("#rrggbb")),""+t.fontSize+t.fontFamily+e+i)},t._getFontDesc=function(){var t=s.fontSize.toString()+"px ";return t+=s.fontFamily},t._computeHorizontalKerningForText=function(){},t._determineRect=function(t){return!1},l);function l(){return A.apply(this,arguments)||this}e.default=i,h.exports=e.default},{"../../../assets/CCRenderTexture":43,"../../../components/CCComponent":78,"../../../components/CCLabel":80,"../../../components/CCLabelOutline":81,"../../../utils/text-utils":271,"../../webgl/assemblers/label/2d/bmfont":233,"../utils":228}],227:[function(e,i,n){"use strict";n.__esModule=!0,n.default=void 0;var t=(t=e("../../assembler-2d"))&&t.__esModule?t:{default:t};function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _,o,a,p=e("../../../utils/text-utils"),d=e("../../../platform/CCMacro"),c=e("../../../components/CCLabel"),f=e("../../../components/CCLabelOutline"),b=e("../../../components/CCLabelShadow"),A=c.Overflow,C=e("../utils").deleteFromDynamicAtlas,S=e("../utils").getFontFamily,T=(1/255).toFixed(3),m=null,w=null,E=null,y="",M="",g=0,I=0,l=[],v=cc.Size.ZERO,B=0,R=0,P=0,D=null,L="",V=A.NONE,O=!1,h=null,F=cc.Color.WHITE,u=null,N=cc.Color.BLACK,x=cc.rect(),k=cc.Size.ZERO,G=cc.Size.ZERO,z=!1,U=!1,W=!1,H=0,j=cc.Vec2.ZERO,e=(a=t.default,e=a,(t=X).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e,r(X),(t=X.prototype)._getAssemblerData=function(){return(o=c._canvasPool.get()).canvas.width=o.canvas.height=1,o},t._resetAssemblerData=function(t){t&&c._canvasPool.put(t)},t.updateRenderData=function(t){a.prototype.updateRenderData.call(this,t),t._vertsDirty&&(this._updateFontFamily(t),this._updateProperties(t),this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture(t),this._calDynamicAtlas(t),t._actualFontSize=g,t.node.setContentSize(G),this.updateVerts(t),t._vertsDirty=!1,E=w=m=null)},t.updateVerts=function(){},t._updatePaddingRect=function(){var t=0,e=0,i=0,n=0,r=0;k.width=k.height=0,h&&(t=e=i=n=r=h.width,k.width=k.height=2*r),u&&(r=u.blur+r,i=Math.max(i,-u._offset.x+r),n=Math.max(n,u._offset.x+r),t=Math.max(t,u._offset.y+r),e=Math.max(e,-u._offset.y+r)),U&&(n+=r=I*Math.tan(.20943951),k.width+=r),x.x=i,x.y=t,x.width=i+n,x.height=t+e},t._updateFontFamily=function(t){L=S(t)},t._updateProperties=function(t){var e=t._assemblerData;m=e.context,w=e.canvas,E=(t._frame._original||t._frame)._texture,M=t.string.toString(),g=t._fontSize,I=g,H=t.underlineHeight||I/8,V=t.overflow,v.width=t.node.width,v.height=t.node.height,G=t.node.getContentSize(),B=t._lineHeight,R=t.horizontalAlign,P=t.verticalAlign,D=t.node.color,z=t.enableBold,U=t.enableItalic,W=t.enableUnderline,O=V!==A.NONE&&(V===A.RESIZE_HEIGHT||t.enableWrapText),(h=(h=f&&t.getComponent(f))&&h.enabled&&0<h.width?h:null)&&F.set(h.color),(u=(u=b&&t.getComponent(b))&&u.enabled?u:null)&&(N.set(u.color),N.a=N.a*t.node.color.a/255),this._updatePaddingRect()},t._calculateFillTextStartPosition=function(){var t=0;R===d.TextAlignment.RIGHT?t=v.width-x.width:R===d.TextAlignment.CENTER&&(t=(v.width-x.width)/2);var e=this._getLineHeight()*(l.length-1),i=g*(1-p.BASELINE_RATIO/2);return P!==d.VerticalTextAlignment.TOP&&(e=e+x.height+g-v.height,P===d.VerticalTextAlignment.BOTTOM?i-=e+=p.BASELINE_RATIO/2*g:i-=e/2),i+=p.BASELINE_OFFSET*g,cc.v2(t+x.x,i+x.y)},t._setupOutline=function(){m.strokeStyle="rgba("+F.r+", "+F.g+", "+F.b+", "+F.a/255+")",m.lineWidth=2*h.width},t._setupShadow=function(){m.shadowColor="rgba("+N.r+", "+N.g+", "+N.b+", "+N.a/255+")",m.shadowBlur=u.blur,m.shadowOffsetX=u.offset.x,m.shadowOffsetY=-u.offset.y},t._drawUnderline=function(t){h&&(this._setupOutline(),m.strokeRect(j.x,j.y,t,H)),m.lineWidth=H,m.fillStyle="rgba("+D.r+", "+D.g+", "+D.b+", "+D.a/255+")",m.fillRect(j.x,j.y,t,H)},t._updateTexture=function(){m.clearRect(0,0,w.width,w.height);var t=h?F:D,e=(m.fillStyle="rgba("+t.r+", "+t.g+", "+t.b+", "+T+")",m.fillRect(0,0,w.width,w.height),m.font=y,this._calculateFillTextStartPosition()),i=this._getLineHeight(),n=(m.lineJoin="round",m.fillStyle="rgba("+D.r+", "+D.g+", "+D.b+", 1)",1<l.length),r=this._measureText(m,y),s=0,o=0;u&&this._setupShadow(),h&&0<h.width&&this._setupOutline();for(var a=0;a<l.length;++a)s=e.x,o=e.y+a*i,u&&n&&(h&&0<h.width&&m.strokeText(l[a],s,o),m.fillText(l[a],s,o)),W&&(_=r(l[a]),R===d.TextAlignment.RIGHT?j.x=e.x-_:R===d.TextAlignment.CENTER?j.x=e.x-_/2:j.x=e.x,j.y=o+I/8,this._drawUnderline(_));u&&n&&(m.shadowColor="transparent");for(var c=0;c<l.length;++c)s=e.x,o=e.y+c*i,h&&0<h.width&&m.strokeText(l[c],s,o),m.fillText(l[c],s,o);u&&(m.shadowColor="transparent"),E.handleLoadedTexture()},t._calDynamicAtlas=function(t){var e;t.cacheMode===c.CacheMode.BITMAP&&(e=t._frame,C(t,e),e._original||e.setRect(cc.rect(0,0,w.width,w.height)),this.packToDynamicAtlas(t,e))},t._updateLabelDimensions=function(){var t=M.split("\n");if(V===A.RESIZE_HEIGHT){var e=(l.length+p.BASELINE_RATIO)*this._getLineHeight();v.height=e+x.height,G.height=e+k.height}else if(V===A.NONE){l=t;for(var i=0,e=0,n=0;n<t.length;++n)var r=p.safeMeasureText(m,t[n],y),i=r<i?i:r;var e=(l.length+p.BASELINE_RATIO)*this._getLineHeight(),s=parseFloat(i.toFixed(2)),e=parseFloat(e.toFixed(2));v.width=s+x.width,v.height=e+x.height,G.width=s+k.width,G.height=e+k.height}v.width=Math.min(v.width,2048),v.height=Math.min(v.height,2048),w.width!==v.width&&(w.width=v.width),w.height!==v.height&&(w.height=v.height)},t._calculateTextBaseline=function(){var t=R===d.TextAlignment.RIGHT?"right":R===d.TextAlignment.CENTER?"center":"left";m.textAlign=t,m.textBaseline="alphabetic"},t._calculateSplitedStrings=function(){var t=M.split("\n");if(O){l=[];for(var e=G.width,i=0;i<t.length;++i){var n=p.safeMeasureText(m,t[i],y),n=p.fragmentText(t[i],n,e,this._measureText(m,y));l=l.concat(n)}}else l=t},t._getFontDesc=function(){var t=g.toString()+"px ";return t+=L,z&&(t="bold "+t),t=U?"italic "+t:t},t._getLineHeight=function(){return 0|(0===B?g:B*g/I)},t._calculateParagraphLength=function(t,e){for(var i=[],n=0;n<t.length;++n){var r=p.safeMeasureText(e,t[n],y);i.push(r)}return i},t._measureText=function(e,i){return function(t){return p.safeMeasureText(e,t,i)}},t._calculateLabelFont=function(){if(y=this._getFontDesc(),m.font=y,V===A.SHRINK){var t=M.split("\n"),h=this._calculateParagraphLength(t,m),e=0,i=0,n=0;if(O){var r=G.width,s=G.height;if(r<0||s<0)return y=this._getFontDesc(),void(m.font=y);for(var o,i=s+1,n=r+1,a=0,c=0|g+1;a<c;){if((o=a+c+1>>1)<=0){cc.logID(4003);break}for(g=o,y=this._getFontDesc(),m.font=y,e=i=0;e<t.length;++e)for(var l=0,u=p.safeMeasureText(m,t[e],y),_=p.fragmentText(t[e],u,r,this._measureText(m,y));l<_.length;)n=p.safeMeasureText(m,_[l],y),i+=this._getLineHeight(),++l;s<i?c=o-1:a=o}0===a?cc.logID(4003):(g=a,y=this._getFontDesc(),m.font=y)}else{for(i=t.length*this._getLineHeight(),e=0;e<t.length;++e)n<h[e]&&(n=h[e]);var d=(v.width-x.width)/n,f=v.height/i;g=I*Math.min(1,d,f)|0,y=this._getFontDesc(),m.font=y}}},X);function X(){return a.apply(this,arguments)||this}n.default=e,i.exports=n.default},{"../../../components/CCLabel":80,"../../../components/CCLabelOutline":81,"../../../components/CCLabelShadow":82,"../../../platform/CCMacro":194,"../../../utils/text-utils":271,"../../assembler-2d":215,"../utils":228}],228:[function(t,e,i){"use strict";var n=t("./dynamic-atlas/manager"),t=cc.Color.WHITE;e.exports={deleteFromDynamicAtlas:function(t,e){e&&e._original&&n&&(n.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame())},getFontFamily:function(i){return i.useSystemFont?i.fontFamily||"Arial":i.font?i.font._nativeAsset||(cc.loader.load(i.font.nativeUrl,function(t,e){i.font._nativeAsset=e,i.setVertsDirty()}),"Arial"):"Arial"},shareLabelInfo:{fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:t,isOutlined:!1,out:t,margin:0}}},{"./dynamic-atlas/manager":223}],229:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,r,s,o,h,u=e&&e.length,_=u?e[0]*i:t.length,a=S(t,0,_,i,!0),d=[];if(!a)return d;if(u&&(a=function(t,e,i,n){var r,s,o,a,c=[];for(r=0,s=e.length;r<s;r++)a=e[r]*n,o=r<s-1?e[r+1]*n:t.length,(a=S(t,a,o,n,!1))===a.next&&(a.steiner=!0),c.push(function(t){var e=t,i=t;for(;e.x<i.x&&(i=e),e=e.next,e!==t;);return i}(a));for(c.sort(T),r=0;r<c.length;r++)!function(t,e){(e=function(t,h){var e,i=h,n=t.x,r=t.y,s=-1/0;do{if(r<=i.y&&r>=i.next.y){var o=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&s<o){if((s=o)===n){if(r===i.y)return i;if(r===i.next.y)return i.next}e=i.x<i.next.x?i:i.next}}}while(i=i.next,i!==h);if(!e)return null;if(n===s)return e.prev;var a,u=e,_=e.x,c=e.y,l=1/0;i=e.next;for(;i!==u;)n>=i.x&&i.x>=_&&g(r<c?n:s,r,_,c,r<c?s:n,r,i.x,i.y)&&((a=Math.abs(r-i.y)/(n-i.x))<l||a===l&&i.x>e.x)&&b(i,t)&&(e=i,l=a),i=i.next;return e}(t,e))&&p(e=E(e,t),e.next)}(c[r],i),i=p(i,i.next);return i}(t,e,a,i)),t.length>80*i){for(var c=n=t[0],l=r=t[1],f=i;f<_;f+=i)(s=t[f])<c&&(c=s),(o=t[f+1])<l&&(l=o),n<s&&(n=s),r<o&&(r=o);h=Math.max(n-c,r-l)}return m(a,d,i,c,l,h),d}function S(t,e,i,n,r){var s,o;if(r===0<C(t,e,i,n))for(s=e;s<i;s+=n)o=a(s,t[s],t[s+1],o);else for(s=i-n;e<=s;s-=n)o=a(s,t[s],t[s+1],o);return o&&x(o,o.next)&&(A(o),o=o.next),o}function p(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!x(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{if(A(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function m(t,e,i,n,r,s,o){if(t){if(!o&&s){var a=t;var h=n;var u=r;var _=s;var c=a;for(;null===c.z&&(c.z=y(c.x,c.y,h,u,_)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next,c!==a;);c.prevZ.nextZ=null,c.prevZ=null,function(t){var e,i,n,r,s,o,a,c,l=1;do{for(i=t,s=t=null,o=0;i;){for(o++,n=i,e=a=0;e<l&&(a++,n=n.nextZ);e++);for(c=l;0<a||0<c&&n;)0!==a&&(0===c||!n||i.z<=n.z)?(i=(r=i).nextZ,a--):(n=(r=n).nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}}while(s.nextZ=null,l*=2,1<o)}(c)}for(var d,l,f=t;t.prev!==t.next;)if(d=t.prev,l=t.next,s?function(t,e,i,n){var r=t.prev,s=t,o=t.next;if(0<=v(r,s,o))return!1;var a=(r.x<s.x?r.x<o.x?r:o:s.x<o.x?s:o).x,c=(r.y<s.y?r.y<o.y?r:o:s.y<o.y?s:o).y,h=(r.x>s.x?r.x>o.x?r:o:s.x>o.x?s:o).x,u=(r.y>s.y?r.y>o.y?r:o:s.y>o.y?s:o).y,_=y(a,c,e,i,n),d=y(h,u,e,i,n),l=t.nextZ;for(;l&&l.z<=d;){if(l!==t.prev&&l!==t.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,l.x,l.y)&&0<=v(l.prev,l,l.next))return!1;l=l.nextZ}l=t.prevZ;for(;l&&l.z>=_;){if(l!==t.prev&&l!==t.next&&g(r.x,r.y,s.x,s.y,o.x,o.y,l.x,l.y)&&0<=v(l.prev,l,l.next))return!1;l=l.prevZ}return!0}(t,n,r,s):function(t){var e=t.prev,i=t,n=t.next;if(0<=v(e,i,n))return!1;var r=t.next.next;for(;r!==t.prev;){if(g(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=v(r.prev,r,r.next))return!1;r=r.next}return!0}(t))e.push(d.i/i),e.push(t.i/i),e.push(l.i/i),A(t),t=l.next,f=l.next;else if((t=l)===f){o?1===o?m(t=function(t,e,i){var n=t;do{var r=n.prev,s=n.next.next}while(!x(r,s)&&w(r,n,n.next,s)&&b(r,s)&&b(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),A(n),A(n.next),n=t=s),n=n.next,n!==t);return n}(t,e,i),e,i,n,r,s,2):2===o&&function(t,e,i,n,r,s){var o=t;do{for(var a,c=o.next.next;c!==o.prev;){if(o.i!==c.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&w(i,i.next,t,e))return!0}while(i=i.next,i!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;for(;i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n}(t,e)}(o,c))return a=E(o,c),o=p(o,o.next),a=p(a,a.next),m(o,e,i,n,r,s),m(a,e,i,n,r,s);c=c.next}}while(o=o.next,o!==t)}(t,e,i,n,r,s):m(p(t),e,i,n,r,s,1);break}}}function T(t,e){return t.x-e.x}function y(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g(t,e,i,n,r,s,o,a){return 0<=(r-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(n-a)-(i-o)*(e-a)&&0<=(i-o)*(s-a)-(r-o)*(n-a)}function v(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function w(t,e,i,n){return x(t,e)&&x(i,n)||x(t,n)&&x(i,e)||0<v(t,e,i)!=0<v(t,e,n)&&0<v(i,n,t)!=0<v(i,n,e)}function b(t,e){return v(t.prev,t,t.next)<0?0<=v(t,e,t.next)&&0<=v(t,t.prev,e):v(t,e,t.prev)<0||v(t,t.next,e)<0}function E(t,e){var i=new o(t.i,t.x,t.y),n=new o(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n}function a(t,e,i,n){t=new o(t,e,i);return n?(t.next=n.next,(t.prev=n).next.prev=t,n.next=t):(t.prev=t).next=t,t}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function o(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(cc.Graphics.earcut=e.exports=n).deviation=function(t,e,i,n){var r=e&&e.length,h=r?e[0]*i:t.length,s=Math.abs(C(t,0,h,i));if(r)for(var o=0,a=e.length;o<a;o++){var u=e[o]*i,_=o<a-1?e[o+1]*i:t.length;s-=Math.abs(C(t,u,_,i))}for(var c=0,o=0;o<n.length;o+=3){var l=n[o]*i,d=n[o+1]*i,f=n[o+2]*i;c+=Math.abs((t[l]-t[f])*(t[1+d]-t[1+l])-(t[l]-t[d])*(t[1+f]-t[1+l]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],230:[function(t,e,i){"use strict";var a=t("../../../../graphics/helper"),c=t("../../../../graphics/types").PointFlags,o=cc.Graphics.Point=cc.Class({name:"cc.GraphicsPoint",extends:cc.Vec2,ctor:function(t,e){this.reset()},reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}});function n(){this.reset()}function r(t){this._tessTol=.25,this._distTol=.01,this._updatePathOffset=!1,this._paths=null,this._pathLength=0,this._pathOffset=0,this._points=null,this._pointsOffset=0,this._commandx=0,this._commandy=0,this._paths=[],this._points=[]}cc.js.mixin(n.prototype,{reset:function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]}}),cc.js.mixin(r.prototype,{moveTo:function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,c.PT_CORNER),this._commandx=t,this._commandy=e},lineTo:function(t,e){this._addPoint(t,e,c.PT_CORNER),this._commandx=t,this._commandy=e},bezierCurveTo:function(t,e,i,n,r,s){var o=this._curPath,o=o.points[o.points.length-1];o.x!==t||o.y!==e||i!==r||n!==s?(a.tesselateBezier(this,o.x,o.y,t,e,i,n,r,s,0,c.PT_CORNER),this._commandx=r,this._commandy=s):this.lineTo(r,s)},quadraticCurveTo:function(t,e,i,n){var r=this._commandx,s=this._commandy;this.bezierCurveTo(r+2/3*(t-r),s+2/3*(e-s),i+2/3*(t-i),n+2/3*(e-n),i,n)},arc:function(t,e,i,n,r,s){a.arc(this,t,e,i,n,r,s)},ellipse:function(t,e,i,n){a.ellipse(this,t,e,i,n),this._curPath.complex=!1},circle:function(t,e,i){a.ellipse(this,t,e,i,i),this._curPath.complex=!1},rect:function(t,e,i,n){this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1},roundRect:function(t,e,i,n,r){a.roundRect(this,t,e,i,n,r),this._curPath.complex=!1},clear:function(t){this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t&&(this._paths.length=0,this._points.length=0)},close:function(){this._curPath.closed=!0},_addPath:function(){var t=this._pathLength,t=this._paths[t];return t?t.reset():(t=new n,this._paths.push(t)),this._pathLength++,this._curPath=t},_addPoint:function(t,e,i){var n,r,s=this._curPath;s&&(n=this._points,s=s.points,(r=n[this._pointsOffset++])?(r.x=t,r.y=e):(r=new o(t,e),n.push(r)),r.flags=i,s.push(r))}}),cc.Graphics._Impl=r,e.exports=r},{"../../../../graphics/helper":132,"../../../../graphics/types":134}],231:[function(t,n,e){"use strict";e.__esModule=!0,e.default=void 0;var r=o(t("../../../assembler")),s=o(t("../../../../../renderer/core/input-assembler"));function o(t){return t&&t.__esModule?t:{default:t}}function a(i){return function(){var t,e=c(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=c(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=t("../../mesh-buffer"),h=t("../../vertex-format").vfmtPosColor,u=t("../../../index"),i=t("../../../../graphics/graphics"),L=t("../../../../graphics/types").PointFlags,V=i.LineJoin,O=i.LineCap,B=t("./earcut"),F=(t("./impl"),Math.PI),g=Math.min,N=Math.max,k=Math.ceil,G=Math.acos,E=Math.cos,M=Math.sin,I=Math.atan2;function R(t,e,i){return t<e?e:i<t?i:t}_=r.default,i=_,(t=d).prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i,a(d),(t=d.prototype).getVfmt=function(){return h},t.requestBuffer=function(){var t={indiceStart:0,vertexStart:0},e=new l(u._handle,h),e=(t.meshbuffer=e,new s.default(e._vb,e._ib));return t.ia=e,this._buffers.push(t),t},t.getBuffers=function(){return 0===this._buffers.length&&this.requestBuffer(),this._buffers},t.clear=function(t){this._bufferOffset=0;var e=this._buffers;if(t){for(var i=0,n=e.length;i<n;i++){var r=e[i];r.meshbuffer.destroy(),r.meshbuffer=null}e.length=0}else for(var s=0,o=e.length;s<o;s++){var a=e[s];a.indiceStart=0,a.vertexStart=0,a.meshbuffer.reset()}},t.fillBuffers=function(t,e){e._flush(),e.node=t.node,e.material=t._materials[0];for(var i=this.getBuffers(),n=0,r=i.length;n<r;n++){var s=i[n],o=s.meshbuffer;s.ia._count=s.indiceStart,e._flushIA(s.ia),o.uploadData()}},t.genBuffer=function(t,e){var i=this.getBuffers(),n=i[this._bufferOffset],r=n.meshbuffer,s=n.vertexStart+e;return(65535<s||131070<3*s)&&(++this._bufferOffset,s=e,this._bufferOffset<i.length?n=i[this._bufferOffset]:(n=this.requestBuffer(t),i[this._bufferOffset]=n),r=n.meshbuffer),s>r.vertexOffset&&r.requestStatic(e,3*e),this._buffer=n},t.stroke=function(t){this._curColor=t._strokeColor._val,this._flattenPaths(t._impl),this._expandStroke(t),t._impl._updatePathOffset=!0},t.fill=function(t){this._curColor=t._fillColor._val,this._expandFill(t),t._impl._updatePathOffset=!0},t._expandStroke=function(t){for(var h,u,e=.5*t.lineWidth,i=t.lineCap,_=t.lineJoin,d=t.miterLimit,n=t._impl,f=(h=e,u=F,A=n._tessTol,h=2*G(e/(e+A)),N(2,k(u/h))),p=(this._calculateJoins(n,e,_,d),n._paths),m=0,y=n._pathOffset,g=n._pathLength;y<g;y++){var v=p[y],x=v.points.length;_===V.ROUND?m+=2*(x+v.nbevel*(f+2)+1):m+=2*(x+5*v.nbevel+1),v.closed||(i===O.ROUND?m+=2*(2*f+2):m+=12)}for(var b=this.genBuffer(t,m),A=b.meshbuffer,C=A._vData,S=A._iData,T=n._pathOffset,w=n._pathLength;T<w;T++){var r=p[T],E=r.points,s=E.length,M=b.vertexStart,o=void 0,a=void 0,c=void 0,I=void 0,I=(r=r.closed)?(o=E[s-1],a=E[0],c=0,s):(o=E[0],a=E[1],s-(c=1)),a=a||o;r||((s=a.sub(o)).normalizeSelf(),l=s.x,s=s.y,i===O.BUTT?this._buttCapStart(o,l,s,e,0):i===O.SQUARE?this._buttCapStart(o,l,s,e,e):i===O.ROUND&&this._roundCapStart(o,l,s,e,f));for(var l,B=c;B<I;++B)_===V.ROUND?this._roundJoin(o,a,e,e,f):0!=(a.flags&(L.PT_BEVEL|L.PT_INNERBEVEL))?this._bevelJoin(o,a,e,e):(this._vset(a.x+a.dmx*e,a.y+a.dmy*e),this._vset(a.x-a.dmx*e,a.y-a.dmy*e)),o=a,a=E[B+1];r?(this._vset(C[l=3*M],C[1+l]),this._vset(C[3+l],C[4+l])):((s=a.sub(o)).normalizeSelf(),c=s.x,r=s.y,i===O.BUTT?this._buttCapEnd(a,c,r,e,0):i===O.SQUARE?this._buttCapEnd(a,c,r,e,e):i===O.ROUND&&this._roundCapEnd(a,c,r,e,f));for(var R=b.indiceStart,P=M+2,D=b.vertexStart;P<D;P++)S[R++]=P-2,S[R++]=P-1,S[R++]=P;b.indiceStart=R}},t._expandFill=function(t){for(var e=t._impl,h=e._paths,u=0,i=e._pathOffset,_=e._pathLength;i<_;i++)u+=h[i].points.length;for(var n=this.genBuffer(t,u),t=n.meshbuffer,d=t._vData,r=t._iData,f=e._pathOffset,p=e._pathLength;f<p;f++){var m=h[f],y=m.points,g=y.length;if(0!==g){for(var s=n.vertexStart,o=0;o<g;++o)this._vset(y[o].x,y[o].y);var a=n.indiceStart;if(m.complex){for(var v=[],x=s,b=n.vertexStart;x<b;x++){var A=3*x;v.push(d[A]),v.push(d[1+A])}var c=B(v,null,2);if(!c||0===c.length)continue;for(var C=0,S=c.length;C<S;C++)r[a++]=c[C]+s}else for(var T=s,l=s+2,w=n.vertexStart;l<w;l++)r[a++]=T,r[a++]=l-1,r[a++]=l;n.indiceStart=a}}},t._calculateJoins=function(t,h,u,_){for(var d=0,f=(0<h&&(d=1/h),t._paths),e=t._pathOffset,p=t._pathLength;e<p;e++)for(var i=f[e],n=i.points,m=n.length,r=n[m-1],s=n[0],o=i.nbevel=0;o<m;o++){var a=r.dy,c=-r.dx,l=s.dy,y=-s.dx;s.dmx=.5*(a+l),s.dmy=.5*(c+y),1e-6<(a=s.dmx*s.dmx+s.dmy*s.dmy)&&(600<(l=1/a)&&(l=600),s.dmx*=l,s.dmy*=l),0<s.dx*r.dy-r.dx*s.dy&&(s.flags|=L.PT_LEFT),a*(c=N(11,g(r.len,s.len)*d))*c<1&&(s.flags|=L.PT_INNERBEVEL),s.flags&L.PT_CORNER&&(a*_*_<1||u===V.BEVEL||u===V.ROUND)&&(s.flags|=L.PT_BEVEL),0!=(s.flags&(L.PT_BEVEL|L.PT_INNERBEVEL))&&i.nbevel++,r=s,s=n[o+1]}},t._flattenPaths=function(t){for(var e=t._paths,i=t._pathOffset,n=t._pathLength;i<n;i++){var r=e[i],s=r.points,o=s[s.length-1],a=s[0];2<s.length&&o.equals(a)&&(r.closed=!0,s.pop(),o=s[s.length-1]);for(var c=0,h=s.length;c<h;c++){var l=a.sub(o);o.len=l.mag(),(l.x||l.y)&&l.normalizeSelf(),o.dx=l.x,o.dy=l.y,o=a,a=s[c+1]}}},t._chooseBevel=function(t,e,i,n){var r,s,o,a,c=i.x,l=i.y;return 0!==t?(r=c+e.dy*n,s=l-e.dx*n,o=c+i.dy*n,a=l-i.dx*n):(r=o=c+i.dmx*n,s=a=l+i.dmy*n),[r,s,o,a]},t._buttCapStart=function(t,e,i,n,r){var s=t.x-e*r,t=t.y-i*r,r=i,i=-e;this._vset(s+r*n,t+i*n),this._vset(s-r*n,t-i*n)},t._buttCapEnd=function(t,e,i,n,r){var s=t.x+e*r,t=t.y+i*r,r=i,i=-e;this._vset(s+r*n,t+i*n),this._vset(s-r*n,t-i*n)},t._roundCapStart=function(t,e,i,n,h){for(var r=t.x,s=t.y,o=i,a=-e,c=0;c<h;c++){var l=c/(h-1)*F,u=E(l)*n,l=M(l)*n;this._vset(r-o*u-e*l,s-a*u-i*l),this._vset(r,s)}this._vset(r+o*n,s+a*n),this._vset(r-o*n,s-a*n)},t._roundCapEnd=function(t,e,i,n,h){var r=t.x,s=t.y,o=i,a=-e;this._vset(r+o*n,s+a*n),this._vset(r-o*n,s-a*n);for(var c=0;c<h;c++){var l=c/(h-1)*F,u=E(l)*n,l=M(l)*n;this._vset(r,s),this._vset(r-o*u+e*l,s-a*u+i*l)}},t._roundJoin=function(t,e,h,i,n){var r=t.dy,s=-t.dx,u=e.dy,_=-e.dx,o=e.x,a=e.y;if(0!=(e.flags&L.PT_LEFT)){for(var c=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,h),l=c[0],d=c[1],f=c[2],c=c[3],p=I(-s,-r),m=I(-_,-u),y=(p<m&&(m-=2*F),this._vset(l,d),this._vset(o-r*i,e.y-s*i),R(k((p-m)/F)*n,2,n)),g=0;g<y;g++){var v=p+g/(y-1)*(m-p),x=o+E(v)*i,v=a+M(v)*i;this._vset(o,a),this._vset(x,v)}this._vset(f,c),this._vset(o-u*i,a-_*i)}else{for(var l=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,-i),d=l[0],f=l[1],c=l[2],t=l[3],b=I(s,r),A=I(_,u),C=(A<b&&(A+=2*F),this._vset(o+r*i,a+s*i),this._vset(d,f),R(k((A-b)/F)*n,2,n)),S=0;S<C;S++){var T=b+S/(C-1)*(A-b),w=o+E(T)*h,T=a+M(T)*h;this._vset(w,T),this._vset(o,a)}this._vset(o+u*i,a+_*i),this._vset(c,t)}},t._bevelJoin=function(t,e,i,n){var r,s,o,a,c=t.dy,l=-t.dx,h=e.dy,u=-e.dx;e.flags&L.PT_LEFT?(r=(a=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,i))[0],s=a[1],o=a[2],a=a[3],this._vset(r,s),this._vset(e.x-c*n,e.y-l*n),this._vset(o,a),this._vset(e.x-h*n,e.y-u*n)):(s=(r=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,-n))[0],o=r[1],a=r[2],t=r[3],this._vset(e.x+c*i,e.y+l*i),this._vset(s,o),this._vset(e.x+h*i,e.y+u*i),this._vset(a,t))},t._vset=function(t,e){var i=this._buffer,n=i.meshbuffer,r=3*i.vertexStart,s=n._vData,o=n._uintVData;s[r]=t,s[1+r]=e,o[2+r]=this._curColor,i.vertexStart++,n._dirty=!0};var _,i=d;function d(t){t=_.call(this,t)||this;return t._buffer=null,t._buffers=[],t._bufferOffset=0,t}e.default=i,r.default.register(cc.Graphics,i),n.exports=e.default},{"../../../../../renderer/core/input-assembler":302,"../../../../graphics/graphics":131,"../../../../graphics/types":134,"../../../assembler":217,"../../../index":220,"../../mesh-buffer":247,"../../vertex-format":252,"./earcut":229,"./impl":230}],232:[function(t,e,i){"use strict";cc.assemblers={},t("./sprite"),t("./mask-assembler"),t("./graphics"),t("./label"),t("./motion-streak")},{"./graphics":231,"./label":236,"./mask-assembler":237,"./motion-streak":238,"./sprite":245}],233:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../utils/label/bmfont"))&&t.__esModule?t:{default:t};function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s,o,b=0,t=(s=t.default,t=s,(o=a).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,n(a),(o=a.prototype).initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},o._reserveQuads=function(t,e){for(var i=4*e,e=6*e,n=this._renderData._flexBuffer,r=(n.reserve(i,e),n.used(i,e),this._renderData.iDatas[0]),s=0,o=0,a=e;s<a;s+=6,o+=4)r[s]=o,r[s+1]=o+1,r[s+2]=o+2,r[s+3]=o+1,r[s+4]=o+3,r[s+5]=o+2;b=0},o._quadsUpdated=function(t){b=0,this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount)},o._getColor=function(t){return t.node._color._val},o.appendQuad=function(h,t,e,u,_,d,f){for(var i,n,r,s,o=this._renderData,a=o.vDatas[0],p=o.uintVDatas[0],o=(this.verticesCount+=4,this.indicesCount=this.verticesCount/2*3,t.width),t=t.height,m=e.width,y=e.height,g=this._getColor(h),c=this.floatsPerVert,l=b+this.uvOffset,v=(u?(i=e.x/o,r=(e.x+y)/o,n=(e.y+m)/t,s=e.y/t,a[l]=i,a[l+1]=s,a[l+=c]=i,a[l+1]=n,a[l+=c]=r,a[l+1]=s,a[l+=c]=r,a[l+1]=n):(i=e.x/o,r=(e.x+m)/o,n=(e.y+y)/t,s=e.y/t,a[l]=i,a[l+1]=n,a[l+=c]=r,a[l+1]=n,a[l+=c]=i,a[l+1]=s,a[l+=c]=r,a[l+1]=s),this.appendVerts(h,b,i=_,r=_+m*f,n=d-y*f,s=d),b+this.colorOffset),x=0;x<4;x++)p[v]=g,v+=c;b+=4*this.floatsPerVert},o.appendVerts=function(t,e,i,n,r,s){var o=this._local,a=this.floatsPerVert;o[e]=i,o[e+1]=r,o[e+=a]=n,o[e+1]=r,o[e+=a]=i,o[e+1]=s,o[e+=a]=n,o[e+1]=s},o.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],r=t[5],h=t[12],u=t[13],s=this._local,o=this._renderData.vDatas[0],_=this.floatsPerVert,a=0;a<s.length;a+=_){var c=s[a],l=s[a+1];o[a]=c*e+l*n+h,o[a+1]=c*i+l*r+u}},a);function a(){return s.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../utils/label/bmfont":224}],234:[function(t,e,i){"use strict";function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.__esModule=!0,i.default=void 0;t("../../../../../platform/js"),t("./bmfont");var s,o,t=t("../../../../utils/label/letter-font"),a=cc.color(255,255,255,255),t=(t=s=t,(o=c).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,n(c),(o=c.prototype).createData=function(t){return t.requestRenderData()},o._getColor=function(t){return a._fastSetA(t.node._color.a),a._val},o.updateColor=function(t){var e=this._getColor(t);s.prototype.updateColor.call(this,t,e)},c);function c(){return s.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../../platform/js":209,"../../../../utils/label/letter-font":226,"./bmfont":233}],235:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../../../utils/label/ttf"))&&n.__esModule?n:{default:n};function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o,l=t("../../../../../components/CCLabelShadow"),a=cc.color(255,255,255,255),t=(o=n.default,t=o,(n=c).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,r(c),(n=c.prototype).updateUVs=function(t){for(var e=this._renderData.vDatas[0],i=t._frame.uv,n=this.uvOffset,r=this.floatsPerVert,s=0;s<4;s++){var o=2*s,a=r*s+n;e[a]=i[o],e[a+1]=i[1+o]}},n.updateColor=function(t){a._fastSetA(t.node._color.a);var e=a._val;o.prototype.updateColor.call(this,t,e)},n.updateVerts=function(t){var e,i=t.node,n=t._ttfTexture.width,r=t._ttfTexture.height,s=i.anchorX*i.width,o=i.anchorY*i.height,a=l&&t.getComponent(l),c=(a&&a._enabled&&(c=(n-i.width)/2,e=(r-i.height)/2,-(a=a.offset).x>c?s+=n-i.width:c>a.x&&(s+=c-a.x),-a.y>e?o+=r-i.height:e>a.y&&(o+=e-a.y)),this._local);c[0]=-s,c[1]=-o,c[2]=n-s,c[3]=r-o,this.updateUVs(t),this.updateWorldVerts(t)},c);function c(){return o.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../../components/CCLabelShadow":82,"../../../../utils/label/ttf":227}],236:[function(t,h,u){"use strict";var e=i(t("../../../assembler")),n=i(t("../../../../components/CCLabel")),r=i(t("./2d/ttf")),s=i(t("./2d/bmfont")),o=i(t("./2d/letter")),a=i(t("./3d/ttf")),c=i(t("./3d/bmfont")),l=i(t("./3d/letter"));function i(t){return t&&t.__esModule?t:{default:t}}n.default._canvasPool={pool:[],get:function(){var t,e,i=this.pool.pop();return i||(e=(t=document.createElement("canvas")).getContext("2d"),i={canvas:t,context:e}),i},put:function(t){32<=this.pool.length||this.pool.push(t)}},e.default.register(cc.Label,{getConstructor:function(t){var e=t.node.is3DNode,i=(e?a:r).default;return t.font instanceof cc.BitmapFont?i=(e?c:s).default:t.cacheMode===n.default.CacheMode.CHAR&&(cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?cc.warn("sorry, subdomain does not support CHAR mode currently!"):i=(e?l:o).default),i},TTF:r.default,Bmfont:s.default,Letter:o.default,TTF3D:a.default,Bmfont3D:c.default,Letter3D:l.default})},{"../../../../components/CCLabel":80,"../../../assembler":217,"./2d/bmfont":233,"./2d/letter":234,"./2d/ttf":235,"./3d/bmfont":void 0,"./3d/letter":void 0,"./3d/ttf":void 0}],237:[function(t,o,e){"use strict";e.__esModule=!0,e.MaskAssembler=void 0;var i=(i=t("../../assembler"))&&i.__esModule?i:{default:i};function a(i){return function(){var t,e=n(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=n(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=t("../../../components/CCMask"),d=t("../../render-flow"),h=t("./sprite/2d/simple"),f=t("./graphics"),u=t("../../../../renderer/gfx"),p=t("../vertex-format").vfmtPos,_=[];function m(){return 1<<_.length-1}function y(t,e,i,n,r,s){var t=t.effect,o=u.STENCIL_OP_KEEP,a=u.STENCIL_OP_KEEP;t.setStencil(u.STENCIL_ENABLE,e,n,r,i,o,a,s)}function g(t){var e=u.DS_FUNC_EQUAL,i=u.STENCIL_OP_KEEP,n=function(){for(var t=0,e=0;e<_.length;++e)t+=1<<e;return t}(),r=m(),s=_[_.length-1];y(s._enableMaterial,e,i,n,n,r),t._flushMaterial(s._enableMaterial)}t=c=h,(r=s).prototype=Object.create(t.prototype),(r.prototype.constructor=r).__proto__=t,a(s),(r=s.prototype).updateRenderData=function(t){t._type===l.Type.IMAGE_STENCIL?t.spriteFrame?h.prototype.updateRenderData.call(this,t):t.setMaterial(0,null):(t._graphics.setMaterial(0,t._materials[0]),f.prototype.updateRenderData.call(t._graphics._assembler,t._graphics,t._graphics))},r.fillBuffers=function(t,e){var i,n,r,s,o,a,c;t._type===l.Type.IMAGE_STENCIL&&!t.spriteFrame||(c=t,8<_.length+1&&cc.errorID(9e3,8),_.push(c),c=t,i=e,n=u.DS_FUNC_NEVER,r=m(),s=c.inverted?u.STENCIL_OP_REPLACE:u.STENCIL_OP_ZERO,y(c._clearMaterial,n,s,r,r,r),n=i.getBuffer("mesh",p),r=(s=n.request(4,6)).indiceOffset,o=s.byteOffset>>2,s=s.vertexOffset,a=n._vData,n=n._iData,a[o++]=-1,a[o++]=-1,a[o++]=-1,a[o++]=1,a[o++]=1,a[o++]=1,a[o++]=1,a[+o]=-1,n[r++]=s,n[r++]=s+3,n[r++]=s+1,n[r++]=s+1,n[r++]=s+3,n[+r]=s+2,i.node=i._dummyNode,i.material=c._clearMaterial,i._flush(),a=t,o=e,n=u.DS_FUNC_NEVER,r=m(),s=a.inverted?u.STENCIL_OP_ZERO:u.STENCIL_OP_REPLACE,y(a._materials[0],n,s,r,r,r),o.material=a._materials[0],a._type===l.Type.IMAGE_STENCIL?(o.node=o._dummyNode,h.prototype.fillBuffers.call(a._assembler,a,o),o._flush()):(o.node=a.node,f.prototype.fillBuffers.call(a._graphics._assembler,a._graphics,o)),g(e)),t.node._renderFlag|=d.FLAG_UPDATE_RENDER_DATA},r.postFillBuffers=function(t,e){var i;t._type===l.Type.IMAGE_STENCIL&&!t.spriteFrame||(i=t,e=e,0===_.length&&cc.errorID(9001),_.pop(),0===_.length?e._flushMaterial(i._exitMaterial):g(e)),t.node._renderFlag|=d.FLAG_UPDATE_RENDER_DATA};var c,r,t=s;function s(){return c.apply(this,arguments)||this}e.MaskAssembler=t,i.default.register(l,t)},{"../../../../renderer/gfx":312,"../../../components/CCMask":84,"../../assembler":217,"../../render-flow":221,"../vertex-format":252,"./graphics":231,"./sprite/2d/simple":242}],238:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../assembler-2d"))&&n.__esModule?n:{default:n};function a(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=t("../../../components/CCMotionStreak"),f=t("../../render-flow");function A(t,e){this.point=t||cc.v2(),this.dir=e||cc.v2(),this.distance=0,this.time=0}A.prototype.setPoint=function(t,e){this.point.x=t,this.point.y=e},A.prototype.setDir=function(t,e){this.dir.x=t,this.dir.y=e};cc.v2(),cc.v2();var C=cc.v2(),S=cc.v2();s=n.default,t=s,(n=o).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,a(o),(n=o.prototype).initData=function(){this._renderData.createFlexData(0,16,42)},n.update=function(t,h){var e,u=t._stroke/2,i=t.node._worldMatrix.m,_=i[12],i=i[13],n=t._points,d=(1<n.length&&((r=n[0].point.x-_)*r+(r=n[0].point.y-i)*r<t.minSeg&&(e=n[0])),e||(e=new A,n.splice(0,0,e)),e.setPoint(_,i),e.time=t._fadeTime+h,0);if(!(n.length<2)){for(var r=t._color,f=r.r,p=r.g,m=r.b,y=r.a,_=n[1],i=(_.distance=e.point.sub(_.point,S).mag(),S.normalizeSelf(),_.setDir(S.x,S.y),e.setDir(S.x,S.y),this._renderData._flexBuffer),s=(i.reserve(2*n.length,6*(n.length-1)),i.vData),g=i.uintVData,v=t._fadeTime,x=!1,o=n.length-1;0<=o;o--){var a=n[o],b=a.point,c=a.dir;if(a.time-=h,a.time<0)n.splice(o,1);else{var a=a.time/v,l=n[o-1];if(!x){if(!l){n.splice(o,1);continue}b.x=l.point.x-c.x*a,b.y=l.point.y-c.y*a}x=!0,l=c,(c=C).x=-l.y,c.y=l.x;c=(a*y<<24>>>0)+(m<<16)+(p<<8)+f,l=5*d;s[l]=b.x+C.x*u,s[1+l]=b.y+C.y*u,s[2+l]=1,s[3+l]=a,g[4+l]=c,s[l+=5]=b.x-C.x*u,s[1+l]=b.y-C.y*u,s[2+l]=0,s[3+l]=a,g[4+l]=c,d+=2}}i.used(d,d<=2?0:3*(d-2))}},n.fillBuffers=function(h,t){for(var e=this._renderData._flexBuffer,i=e.vData,u=e.usedVertices,n=e.usedIndices,e=e.usedVerticesFloats,t=t._meshBuffer,n=t.request(u,n),r=n.byteOffset>>2,s=t._vData,o=(i.length+r>s.length?s.set(i.subarray(0,e),r):s.set(i,r),t._iData),a=n.indiceOffset,_=n.vertexOffset,c=0,d=u;c<d;c+=2){var l=_+c;o[a++]=l,o[a++]=l+2,o[a++]=l+1,o[a++]=l+1,o[a++]=l+2,o[a++]=l+3}h.node._renderFlag|=f.FLAG_UPDATE_RENDER_DATA};var s,t=o;function o(){return s.apply(this,arguments)||this}(i.default=t).register(c,t),e.exports=i.default},{"../../../components/CCMotionStreak":85,"../../assembler-2d":215,"../../render-flow":221}],239:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../../../assembler-2d"))&&n.__esModule?n:{default:n};function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o,x=t("../../../../../components/CCSprite").FillType,t=(o=n.default,t=o,(n=a).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,r(a),(n=a.prototype).updateRenderData=function(t){var e,i=t._spriteFrame;this.packToDynamicAtlas(t,i),t._vertsDirty&&(i=t._fillStart,(e=t._fillRange)<0&&(i+=e,e=-e),e=(e=1<(e=i+e)?1:e)<0?0:e,e=1<(e=(i=(i=1<i?1:i)<0?0:i)+(e=(e-=i)<0?0:e))?1:e,this.updateUVs(t,i,e),this.updateVerts(t,i,e),t._vertsDirty=!1)},n.updateUVs=function(h,t,e){var u,_,i,n,r,s,d,f,p,m,y=h._spriteFrame,g=y._texture.width,v=y._texture.height,o=y._rect,a=(y._rotated?(u=o.x/g,_=(o.y+o.width)/v,i=r=u,d=p=(o.x+o.height)/g,s=m=_,n=f=o.y/v):(u=o.x/g,_=(o.y+o.height)/v,i=d=u,r=p=(o.x+o.width)/g,n=s=_,f=m=o.y/v),this._renderData.vDatas[0]),c=this.uvOffset,l=this.floatsPerVert;switch(h._fillType){case x.HORIZONTAL:a[c]=i+(r-i)*t,a[c+1]=n+(s-n)*t,a[c+l]=i+(r-i)*e,a[c+l+1]=n+(s-n)*e,a[c+2*l]=d+(p-d)*t,a[c+2*l+1]=f+(m-f)*t,a[c+3*l]=d+(p-d)*e,a[c+3*l+1]=f+(m-f)*e;break;case x.VERTICAL:a[c]=i+(d-i)*t,a[c+1]=n+(f-n)*t,a[c+l]=r+(p-r)*t,a[c+l+1]=s+(m-s)*t,a[c+2*l]=i+(d-i)*e,a[c+2*l+1]=n+(f-n)*e,a[c+3*l]=r+(p-r)*e,a[c+3*l+1]=s+(m-s)*e;break;default:cc.errorID(2626)}},n.updateVerts=function(t,e,i){var n,r=t.node,s=r.width,h=r.height,u=r.anchorX*s,r=r.anchorY*h,o=-u,a=-r,c=s-u,l=h-r;switch(t._fillType){case x.HORIZONTAL:n=o+(c-o)*i,o=o+(c-o)*e,c=n;break;case x.VERTICAL:n=a+(l-a)*i,a=a+(l-a)*e,l=n;break;default:cc.errorID(2626)}s=this._local;s[0]=o,s[1]=a,s[2]=c,s[3]=l,this.updateWorldVerts(t)},a);function a(){return o.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../../components/CCSprite":94,"../../../../assembler-2d":215}],240:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}s=t.default,t=s,(o=a).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,n(a),(o=a.prototype).initData=function(t){this._renderData.createFlexData(0,4,6,this.getVfmt())},o.updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame);var e,i=t.spriteFrame;!i||(i=i.vertices)&&(this.verticesCount=i.x.length,this.indicesCount=i.triangles.length,(e=this._renderData._flexBuffer).reserve(this.verticesCount,this.indicesCount)&&(this.updateColor(t),t._vertsDirty=!0),e.used(this.verticesCount,this.indicesCount),this.updateIndices(i.triangles),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),this.updateWorldVerts(t),t._vertsDirty=!1))},o.updateIndices=function(t){this._renderData.iDatas[0].set(t)},o.updateUVs=function(t){for(var t=t.spriteFrame.vertices,e=t.nu,i=t.nv,n=this.uvOffset,r=this.floatsPerVert,s=this._renderData.vDatas[0],o=0;o<e.length;o++){var a=r*o+n;s[a]=e[o],s[a+1]=i[o]}},o.updateVerts=function(t){var e=t.node,i=Math.abs(e.width),n=Math.abs(e.height),h=e.anchorX*i,u=e.anchorY*n,e=t.spriteFrame,r=e.vertices,s=r.x,_=r.y,r=e._originalSize.width,o=e._originalSize.height,d=e._rect.width,f=e._rect.height,p=e._offset.x+(r-d)/2,m=e._offset.y+(o-f)/2,y=i/(t.trim?d:r),g=n/(t.trim?f:o),a=this._local;if(t.trim)for(var c=0,v=s.length;c<v;c++){var x=2*c;a[x]=(s[c]-p)*y-h,a[1+x]=(o-_[c]-m)*g-u}else for(var l=0,b=s.length;l<b;l++){var A=2*l;a[A]=s[l]*y-h,a[1+A]=(o-_[l])*g-u}},o.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],h=t[5],u=t[12],_=t[13],r=this._local,s=this._renderData.vDatas[0],o=this.floatsPerVert,a=0,d=this.verticesCount;a<d;a++){var c=r[2*a],l=r[2*a+1];s[o*a]=c*e+l*n+u,s[o*a+1]=c*i+l*h+_}};var s,o,t=a;function a(){return s.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":215}],241:[function(t,n,e){"use strict";e.__esModule=!0,e.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=2*Math.PI,m=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],y=[0,0,0,0],g=[0,0,0,0,0,0,0,0],A=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],C=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],v=cc.v2(0,0),x=[];function S(t,e,i,h,n,r,s){var o,a,c=Math.sin(r),l=Math.cos(r);0!==Math.cos(r)&&(o=c/l,0<(t-n.x)*l&&(a=n.y+o*(t-n.x),s[0].x=t,s[0].y=a),0<(e-n.x)*l&&(t=n.y+o*(e-n.x),s[2].x=e,s[2].y=t)),0!==Math.sin(r)&&(a=l/c,0<(h-n.y)*c&&(o=n.x+a*(h-n.y),s[3].x=o,s[3].y=h),0<(i-n.y)*c&&(e=n.x+a*(i-n.y),s[1].x=e,s[1].y=i))}function _(t,e){var i=e.x-t.x,e=e.y-t.y;if(0!=i||0!=e){if(0==i)return 0<e?.5*Math.PI:1.5*Math.PI;t=Math.atan(e/i);return i<0&&(t+=Math.PI),t}}b=t.default,t=b,(i=o).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,r(o),(i=o.prototype).initData=function(t){this._renderData.createFlexData(0,4,6,this.getVfmt()),this.updateIndices()},i.updateRenderData=function(t){b.prototype.updateRenderData.call(this,t);var h,u,_,d,e,i,n,r,s,o,a,f=t.spriteFrame;if(this.packToDynamicAtlas(t,f),t._vertsDirty){var c=t._fillStart,l=t._fillRange;for(l<0&&(c+=l,l=-l);1<=c;)--c;for(;c<0;)c+=1;c*=p,l*=p,i=(s=(e=t).node).width,n=s.height,r=s.anchorX*i,s=s.anchorY*n,o=-r,a=-s,i-=r,r=n-s,(n=y)[0]=o,n[1]=a,n[2]=i,n[3]=r,s=e._fillCenter,e=v.x=Math.min(Math.max(0,s.x),1)*(i-o)+o,s=v.y=Math.min(Math.max(0,s.y),1)*(r-a)+a,m[0].x=m[3].x=o,m[1].x=m[2].x=i,m[0].y=m[1].y=a,m[2].y=m[3].y=r,e!==n[x.length=0]&&(x[0]=[3,0]),e!==n[2]&&(x[2]=[1,2]),s!==n[1]&&(x[1]=[0,1]),s!==n[3]&&(x[3]=[2,3]),o=f._texture.width,i=f._texture.height,a=f._rect,r=g,f._rotated?(h=a.x/o,u=(a.x+a.height)/o,_=a.y/i,d=(a.y+a.width)/i,r[0]=r[2]=h,r[4]=r[6]=u,r[3]=r[7]=d,r[1]=r[5]=_):(h=a.x/o,u=(a.x+a.width)/o,_=a.y/i,d=(a.y+a.height)/i,r[0]=r[4]=h,r[2]=r[6]=u,r[1]=r[3]=d,r[5]=r[7]=_),S(y[0],y[2],y[1],y[3],v,c,A),S(y[0],y[2],y[1],y[3],v,c+l,C),this.updateVerts(t,c,l),t._vertsDirty=!1}},i.updateVerts=function(t,e,h){for(var i=e+h,n=this._local,r=n.length=0,s=3*this.floatsPerVert,o=0;o<4;++o){var a=x[o];if(a)if(p<=h)n.length=r+s,this._generateTriangle(n,r,v,m[a[0]],m[a[1]]),r+=s;else{var c=_(v,m[a[0]]),l=_(v,m[a[1]]);l<c&&(l+=p),c-=p,l-=p;for(var u=0;u<3;++u)i<=c||(e<=c?(n.length=r+s,i<=l?this._generateTriangle(n,r,v,m[a[0]],C[o]):this._generateTriangle(n,r,v,m[a[0]],m[a[1]]),r+=s):l<=e||(l<=i?(n.length=r+s,this._generateTriangle(n,r,v,A[o],m[a[1]])):(n.length=r+s,this._generateTriangle(n,r,v,A[o],C[o])),r+=s)),c+=p,l+=p}}this.allocWorldVerts(t),this.updateWorldVerts(t)},i.allocWorldVerts=function(t){for(var e=t.node._color._val,t=this._renderData,i=this.floatsPerVert,n=this._local,r=n.length/i,s=(this.verticesCount=this.indicesCount=r,t._flexBuffer),o=(s.reserve(r,r)&&this.updateIndices(),s.used(this.verticesCount,this.indicesCount),t.vDatas[0]),a=t.uintVDatas[0],h=this.uvOffset,c=0;c<n.length;c+=i){var l=c+h;o[l]=n[l],o[l+1]=n[l+1],a[l+2]=e}},i.updateIndices=function(){for(var t=this._renderData.iDatas[0],e=0;e<t.length;e++)t[e]=e},i.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],n=t[4],r=t[5],h=t[12],u=t[13],s=this._local,o=this._renderData.vDatas[0],_=this.floatsPerVert,a=0;a<s.length;a+=_){var c=s[a],l=s[a+1];o[a]=c*e+l*n+h,o[a+1]=c*i+l*r+u}},i._generateTriangle=function(t,e,i,n,r){var s=y[0],o=y[1],a=y[2],h=y[3],c=this.floatsPerVert,u=(t[e]=i.x,t[e+1]=i.y,t[e+c]=n.x,t[e+c+1]=n.y,t[e+2*c]=r.x,t[e+2*c+1]=r.y,this.uvOffset),l=(i.x-s)/(a-s),i=(i.y-o)/(h-o);this._generateUV(l,i,t,e+u),l=(n.x-s)/(a-s),i=(n.y-o)/(h-o),this._generateUV(l,i,t,e+c+u),l=(r.x-s)/(a-s),i=(r.y-o)/(h-o),this._generateUV(l,i,t,e+2*c+u)},i._generateUV=function(t,e,i,n){var r=g[0]+(g[2]-g[0])*t,s=g[1]+(g[3]-g[1])*t,o=g[5]+(g[7]-g[5])*t;i[n]=r+(g[4]+(g[6]-g[4])*t-r)*e,i[n+1]=s+(o-s)*e};var b,i,t=o;function o(){return b.apply(this,arguments)||this}e.default=t,n.exports=e.default},{"../../../../assembler-2d":215}],242:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}s=t.default,t=s,(o=a).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,n(a),(o=a.prototype).updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},o.updateUVs=function(t){for(var e=t._spriteFrame.uv,i=this.uvOffset,n=this.floatsPerVert,r=this._renderData.vDatas[0],s=0;s<4;s++){var o=2*s,a=n*s+i;r[a]=e[o],r[a+1]=e[1+o]}},o.updateVerts=function(t){var e,h,i,n,r,u,_,d,s=t.node,o=s.width,a=s.height,c=s.anchorX*o,s=s.anchorY*a,l=(o=t.trim?(u=-c,_=-s,d=o-c,a-s):(n=(i=t.spriteFrame)._originalSize.width,e=i._originalSize.height,l=i._rect.width,h=i._rect.height,r=(i=i._offset).x+(n-l)/2,l=i.x-(n-l)/2,u=r*(r=o/n)-c,_=(i.y+(e-h)/2)*(n=a/e)-s,d=o+l*r-c,a+(i.y-(e-h)/2)*n-s),this._local);l[0]=u,l[1]=_,l[2]=d,l[3]=o,this.updateWorldVerts(t)};var s,o,t=a;function a(){return s.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":215}],243:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}s=t.default,t=s,(o=a).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,n(a),(o=a.prototype).initData=function(t){if(!(0<this._renderData.meshCount)){this._renderData.createData(0,this.verticesFloats,this.indicesCount);for(var e=this._renderData.iDatas[0],i=0,n=0;n<3;++n)for(var r=0;r<3;++r){var s=4*n+r;e[i++]=s,e[i++]=s+1,e[i++]=s+4,e[i++]=s+1,e[i++]=s+5,e[i++]=s+4}}},o.initLocal=function(){this._local=[],this._local.length=8},o.updateRenderData=function(t){var e=t._spriteFrame;this.packToDynamicAtlas(t,e),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},o.updateVerts=function(t){var e=t.node,i=e.width,n=e.height,r=e.anchorX*i,e=e.anchorY*n,s=t.spriteFrame,o=s.insetLeft,a=s.insetRight,c=s.insetTop,s=s.insetBottom,h=i-o-a,u=n-c-s,a=i/(o+a),c=n/(c+s),a=isNaN(a)||1<a?1:a,c=isNaN(c)||1<c?1:c,h=h<0?0:h,u=u<0?0:u,l=this._local;l[0]=-r,l[1]=-e,l[2]=o*a-r,l[3]=s*c-e,l[4]=l[2]+h,l[5]=l[3]+u,l[6]=i-r,l[7]=n-e,this.updateWorldVerts(t)},o.updateUVs=function(t){for(var e=this._renderData.vDatas[0],i=t.spriteFrame.uvSliced,n=this.uvOffset,r=this.floatsPerVert,s=0;s<4;++s)for(var o=0;o<4;++o){var a=4*s+o,c=i[a],a=a*r;e[a+n]=c.u,e[a+n+1]=c.v}},o.updateWorldVerts=function(t){for(var t=t.node._worldMatrix.m,e=t[0],i=t[1],h=t[4],u=t[5],_=t[12],d=t[13],n=this._local,r=this._renderData.vDatas[0],f=this.floatsPerVert,s=0;s<4;++s)for(var o=n[2*s+1],a=0;a<4;++a){var c=n[2*a],l=(4*s+a)*f;r[l]=c*e+o*h+_,r[1+l]=c*i+o*u+d}};var s,o,t=a;function a(){return s.apply(this,arguments)||this}i.default=t,Object.assign(t.prototype,{verticesCount:16,indicesCount:54}),e.exports=i.default},{"../../../../assembler-2d":215}],244:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};function n(i){return function(){var t,e=r(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=r(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}s=t.default,t=s,(o=a).prototype=Object.create(t.prototype),(o.prototype.constructor=o).__proto__=t,n(a),(o=a.prototype).initData=function(t){this.verticesCount=0,this.contentWidth=0,this.contentHeight=0,this.rectWidth=0,this.rectHeight=0,this.hRepeat=0,this.vRepeat=0,this.row=0,this.col=0,this._renderData.createFlexData(0,4,6,this.getVfmt()),this._updateIndices()},o.initLocal=function(){this._local={x:[],y:[]}},o._updateIndices=function(){for(var t=this._renderData.iDatas[0],e=0,i=0,n=t.length;e<n;e+=6,i+=4)t[e]=i,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+1,t[e+4]=i+3,t[e+5]=i+2},o.updateRenderData=function(t){var e=t._spriteFrame,i=(this.packToDynamicAtlas(t,e),t.node),n=this.contentWidth=Math.abs(i.width),i=this.contentHeight=Math.abs(i.height),r=e._rect,s=e.insetLeft,o=e.insetRight,a=r.width-s-o,c=e.insetTop,e=e.insetBottom,r=r.height-c-e,n=(this.sizableWidth=n-s-o,this.sizableHeight=i-c-e,this.sizableWidth=0<this.sizableWidth?this.sizableWidth:0,this.sizableHeight=0<this.sizableHeight?this.sizableHeight:0,this.hRepeat=0==a?this.sizableWidth:this.sizableWidth/a),s=this.vRepeat=0==r?this.sizableHeight:this.sizableHeight/r,o=(this.row=Math.ceil(s+2))*(this.col=Math.ceil(n+2));this.verticesCount=4*o,this.indicesCount=6*o;i=this._renderData._flexBuffer;i.reserve(this.verticesCount,this.indicesCount)&&(this._updateIndices(),this.updateColor(t)),i.used(this.verticesCount,this.indicesCount),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},o.updateVerts=function(h){for(var t=h._spriteFrame,u=t._rect,e=h.node,i=e.anchorX*e.width,n=e.anchorY*e.height,_=this.row,d=this.col,f=this.contentWidth,p=this.contentHeight,m=this._local,y=m.x,g=m.y,r=(y.length=g.length=0,t.insetLeft),v=t.insetRight,s=u.width-r-v,x=t.insetTop,o=t.insetBottom,a=u.height-x-o,b=1<e.width/(r+v)?1:e.width/(r+v),A=1<e.height/(x+o)?1:e.height/(x+o),C=0<s?Math.floor(1e3*this.sizableWidth)/1e3%s==0?s:this.sizableWidth%s:this.sizableWidth,S=0<a?Math.floor(1e3*this.sizableHeight)/1e3%a==0?a:this.sizableHeight%a:this.sizableHeight,c=0;c<=d;c++)0===c?y[c]=-i:0<c&&c<d?y[c]=1===c?r*b+Math.min(s,this.sizableWidth)-i:0<s?c===d-1?r+C+s*(c-2)-i:r+Math.min(s,this.sizableWidth)+s*(c-2)-i:r+this.sizableWidth-i:c===d&&(y[c]=Math.min(r+this.sizableWidth+v,f)-i);for(var l=0;l<=_;l++)0===l?g[l]=-n:0<l&&l<_?g[l]=1===l?o*A+Math.min(a,this.sizableHeight)-n:0<a?l===_-1?o+S+(l-2)*a-n:o+Math.min(a,this.sizableHeight)+(l-2)*a-n:o+this.sizableHeight-n:l===_&&(g[l]=Math.min(o+this.sizableHeight+x,p)-n);this.updateWorldVerts(h)},o.updateWorldVerts=function(h){for(var t,e,i=this._renderData,u=this._local,_=u.x,d=u.y,n=i.vDatas[0],u=this.row,f=this.col,i=h.node._worldMatrix.m,r=i[0],s=i[1],o=i[4],a=i[5],c=i[12],p=i[13],m=this.floatsPerVert,l=0,y=0,g=u;y<g;++y)for(var v=d[y],x=d[y+1],b=0,A=f;b<A;++b)t=_[b],e=_[b+1],n[l]=t*r+v*o+c,n[l+1]=t*s+v*a+p,n[l+=m]=e*r+v*o+c,n[l+1]=e*s+v*a+p,n[l+=m]=t*r+x*o+c,n[l+1]=t*s+x*a+p,n[l+=m]=e*r+x*o+c,n[l+1]=e*s+x*a+p,l+=m},o.updateUVs=function(h){var t=this._renderData.vDatas[0];if(t)for(var u,e=h._spriteFrame,_=e._rect,d=e.insetLeft,f=e.insetRight,p=_.width-d-f,d=e.insetTop,f=e.insetBottom,m=_.height-d-f,i=this.row,n=this.col,y=this.hRepeat,g=this.vRepeat,r=h.spriteFrame.uv,s=h.spriteFrame.uvSliced,v=h.spriteFrame._rotated,o=this.floatsPerVert,a=this.uvOffset,c=0,x=i;c<x;++c)for(var b=this.sizableHeight>m?this.sizableHeight>=c*m?1:g%1:g,l=0,A=n;l<A;++l)u=this.sizableWidth>p?this.sizableWidth>=l*p?1:y%1:y,v?(t[a]=r[0],t[a+1]=r[1],t[a+=o]=r[0],t[a+1]=r[1]+(r[7]-r[1])*u,t[a+=o]=r[0]+(r[6]-r[0])*b,t[a+1]=r[1],t[a+=o]=t[a-o],t[a+1]=t[a+1-2*o]):(0===l?t[a]=r[0]:0<l&&l<n-1?t[a]=s[1].u:l===n-1&&(t[a]=s[2].u),0===c?t[a+1]=s[0].v:0<c&&c<i-1?t[a+1]=s[4].v:c===i-1&&(t[a+1]=s[8].v),a+=o,0===l||0<l&&l<n-1?t[a]=s[1].u+(s[2].u-s[1].u)*u:l===n-1&&(t[a]=s[3].u),0===c?t[a+1]=s[0].v:0<c&&c<i-1?t[a+1]=s[4].v:c===i-1&&(t[a+1]=s[8].v),a+=o,0===l?t[a]=r[0]:0<l&&l<n-1?t[a]=s[1].u:l===n-1&&(t[a]=s[2].u),0===c||0<c&&c<i-1?t[a+1]=s[4].v+(s[8].v-s[4].v)*b:c===i-1&&(t[a+1]=s[12].v),t[a+=o]=t[a-2*o],t[a+1]=t[a+1-o]),a+=o};var s,o,t=a;function a(){return s.apply(this,arguments)||this}i.default=t,e.exports=i.default},{"../../../../assembler-2d":215}],245:[function(t,i,u){"use strict";var _=e(t("../../../assembler")),n=t("../../../../components/CCSprite"),r=e(t("./2d/simple")),s=e(t("./2d/sliced")),o=e(t("./2d/tiled")),a=e(t("./2d/radial-filled")),c=e(t("./2d/bar-filled")),l=e(t("./2d/mesh")),h=e(t("./3d/simple")),d=e(t("./3d/sliced")),f=e(t("./3d/tiled")),p=e(t("./3d/radial-filled")),m=e(t("./3d/bar-filled")),y=e(t("./3d/mesh"));function e(t){return t&&t.__esModule?t:{default:t}}t={getConstructor:function(t){var e=t.node.is3DNode,i=(e?h:r).default;switch(t.type){case n.Type.SLICED:i=(e?d:s).default;break;case n.Type.TILED:i=(e?f:o).default;break;case n.Type.FILLED:i=(t._fillType===n.FillType.RADIAL?e?p:a:e?m:c).default;break;case n.Type.MESH:i=(e?y:l).default}return i},Simple:r.default,Sliced:s.default,Tiled:o.default,RadialFilled:a.default,BarFilled:c.default,Mesh:l.default,Simple3D:h.default,Sliced3D:d.default,Tiled3D:f.default,RadialFilled3D:p.default,BarFilled3D:m.default,Mesh3D:y.default};_.default.register(cc.Sprite,t)},{"../../../../components/CCSprite":94,"../../../assembler":217,"./2d/bar-filled":239,"./2d/mesh":240,"./2d/radial-filled":241,"./2d/simple":242,"./2d/sliced":243,"./2d/tiled":244,"./3d/bar-filled":void 0,"./3d/mesh":void 0,"./3d/radial-filled":void 0,"./3d/simple":void 0,"./3d/sliced":void 0,"./3d/tiled":void 0}],246:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;(n=r.prototype)._reallocVData=function(t,e){this.vData=new Float32Array(t),this.uintVData=new Uint32Array(this.vData.buffer),e&&this.vData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData)},n._reallocIData=function(t,e){this.iData=new Uint16Array(t),e&&this.iData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData)},n.reserve=function(t,e){var i=t*this._verticesBytes>>2,n=this.vData.length,t=!1;if(n<i){for(;n<i;)n*=2;this._reallocVData(n,this.vData),t=!0}var r=this.iData.length;if(r<e){for(;r<e;)r*=2;this._reallocIData(e,this.iData),t=!0}return t},n.used=function(t,e){this.usedVertices=t,this.usedIndices=e,this.usedVerticesFloats=t*this._verticesBytes>>2,this._handler.updateMeshRange(t,e)},n.reset=function(){var t=this._initVerticesCount*this._verticesBytes>>2;this._reallocVData(t),this._reallocIData(this._initIndicesCount),this.usedVertices=0,this.usedVerticesFloats=0,this.usedIndices=0};var n=r;function r(t,e,i,n,r){this._handler=t,this._index=e,this._vfmt=r,this._verticesBytes=r._bytes,this._initVerticesCount=i,this._initIndicesCount=n,this.reset()}i.default=n,cc.FlexBuffer=n,e.exports=i.default},{}],247:[function(t,e,i){"use strict";var n=(t=t("../../../renderer/gfx"))&&t.__esModule?t:{default:t};t=cc.Class({name:"cc.MeshBuffer",ctor:function(t,e){this.init(t,e)},init:function(t,e){this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1,this._vertexFormat=e,this._vertexBytes=this._vertexFormat._bytes,this._arrOffset=0,this._vbArr=[],this._vb=new n.default.VertexBuffer(t._device,e,n.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[0]=this._vb,this._ibArr=[],this._ib=new n.default.IndexBuffer(t._device,n.default.INDEX_FMT_UINT16,n.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[0]=this._ib,this._vData=null,this._uintVData=null,this._iData=null,this._batcher=t,this._initVDataCount=256*e._bytes,this._initIDataCount=1536,this._offsetInfo={byteOffset:0,vertexOffset:0,indiceOffset:0},this._reallocBuffer()},uploadData:function(){var t,e;0!==this.byteOffset&&this._dirty&&(t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this._iData.buffer,0,this.indiceOffset),this._vb.update(0,t),this._ib.update(0,e),this._dirty=!1)},switchBuffer:function(){var t=++this._arrOffset;this.byteOffset=0,this.vertexOffset=0,this.indiceOffset=0,this.indiceStart=0,t<this._vbArr.length?(this._vb=this._vbArr[t],this._ib=this._ibArr[t]):(this._vb=new n.default.VertexBuffer(this._batcher._device,this._vertexFormat,n.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[t]=this._vb,this._ib=new n.default.IndexBuffer(this._batcher._device,n.default.INDEX_FMT_UINT16,n.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[t]=this._ib)},checkAndSwitchBuffer:function(t){65535<this.vertexOffset+t&&(this.uploadData(),this._batcher._flush(),this.switchBuffer())},requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes,n=this.indiceOffset+e,r=this._vData.byteLength,s=this._iData.length;if(r<i||s<n){for(;r<i||s<n;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}this._updateOffset(t,e,i)},_updateOffset:function(t,e,i){var n=this._offsetInfo;n.vertexOffset=this.vertexOffset,this.vertexOffset+=t,n.indiceOffset=this.indiceOffset,this.indiceOffset+=e,n.byteOffset=this.byteOffset,this.byteOffset=i,this._dirty=!0},request:function(t,e){return this._batcher._buffer!==this&&(this._batcher._flush(),this._batcher._buffer=this),this.requestStatic(t,e),this._offsetInfo},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(!0)},_reallocVData:function(t){this._vData&&(e=new Uint8Array(this._vData.buffer)),this._vData=new Float32Array(this._initVDataCount),this._uintVData=new Uint32Array(this._vData.buffer);var e,i=new Uint8Array(this._uintVData.buffer);if(e&&t)for(var n=0,r=e.length;n<r;n++)i[n]=e[n]},_reallocIData:function(t){var e=this._iData;if(this._iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this._iData,n=0,r=e.length;n<r;n++)i[n]=e[n]},reset:function(){this._arrOffset=0,this._vb=this._vbArr[0],this._ib=this._ibArr[0],this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1},destroy:function(){this.reset();for(var t=0;t<this._vbArr.length;t++)this._vbArr[t].destroy();this._vbArr=null;for(var e=0;e<this._ibArr.length;e++)this._ibArr[e].destroy();this._ibArr=null,this._ib=null,this._vb=null},forwardIndiceStartToOffset:function(){this.indiceStart=this.indiceOffset}});cc.MeshBuffer=e.exports=t},{"../../../renderer/gfx":312}],248:[function(t,h,u){"use strict";var i=e(t("../../../renderer/core/input-assembler")),n=e(t("../../../renderer/memop/recycle-pool")),_=e(t("../../../renderer/scene/model"));function e(t){return t&&t.__esModule?t:{default:t}}function r(t,e){this._renderScene=e,this._device=t,this.walking=!1,this.material=l,this.cullingMask=1,this._iaPool=new n.default(function(){return new i.default},16),this._modelPool=new n.default(function(){return new _.default},16),this._quadBuffer=this.getBuffer("quad",o),this._meshBuffer=this.getBuffer("mesh",o),this._quadBuffer3D=this.getBuffer("quad",a),this._meshBuffer3D=this.getBuffer("mesh",a),this._buffer=this._meshBuffer,this._batchedModels=[],this._dummyNode=new cc.Node,this._sortKey=0,this.node=this._dummyNode,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0}var s=t("./vertex-format"),o=s.vfmtPosUvColor,a=s.vfmt3D,d=t("./quad-buffer"),f=t("./mesh-buffer"),p=t("./spine-buffer"),s=t("../../assets/material/CCMaterial"),c=(new(t("../../platform/id-generater"))("VertextFormat"),{}),l=new s,m=new i.default;m._count=0;r.prototype={constructor:r,reset:function(){this._iaPool.reset();for(var t,e=this._renderScene,i=this._batchedModels,n=0;n<i.length;++n)i[n].setInputAssembler(null),i[n].setEffect(null),e.removeModel(i[n]);for(t in this._modelPool.reset(),i.length=0,this._sortKey=0,c)c[t].reset();this._buffer=this._meshBuffer,this.node=this._dummyNode,this.material=l,this.cullingMask=1,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0},_flushMaterial:function(t){var e;!t||(t=(this.material=t).effect)&&(e=this._modelPool.add(),this._batchedModels.push(e),e.sortKey=this._sortKey++,e._cullingMask=this.cullingMask,e.setNode(this.node),e.setEffect(t,null),e.setInputAssembler(m),this._renderScene.addModel(e))},_flush:function(){var t,e=this.material,i=this._buffer,n=i.indiceOffset-i.indiceStart;!this.walking||!e||n<=0||(e=e.effect)&&((t=this._iaPool.add())._vertexBuffer=i._vb,t._indexBuffer=i._ib,t._start=i.indiceStart,t._count=n,n=this._modelPool.add(),this._batchedModels.push(n),n.sortKey=this._sortKey++,n._cullingMask=this.cullingMask,n.setNode(this.node),n.setEffect(e),n.setInputAssembler(t),this._renderScene.addModel(n),i.forwardIndiceStartToOffset())},_flushIA:function(t){var e,i;!t||(e=this.material.effect)&&(i=this._modelPool.add(),this._batchedModels.push(i),i.sortKey=this._sortKey++,i._cullingMask=this.cullingMask,i.setNode(this.node),i.setEffect(e),i.setInputAssembler(t),this._renderScene.addModel(i))},terminate:function(){for(var t in cc.dynamicAtlasManager&&cc.dynamicAtlasManager.enabled&&cc.dynamicAtlasManager.update(),this._flush(),c)c[t].uploadData();this.walking=!1},getBuffer:function(t,e){var i=t+e.getHash(),n=c[i];if(!n){if("mesh"===t)n=new f(this,e);else if("quad"===t)n=new d(this,e);else{if("spine"!==t)return cc.error("Not support buffer type ["+t+"]"),null;n=new p(this,e)}c[i]=n}return n}},h.exports=r},{"../../../renderer/core/input-assembler":302,"../../../renderer/memop/recycle-pool":327,"../../../renderer/scene/model":333,"../../assets/material/CCMaterial":53,"../../platform/id-generater":205,"./mesh-buffer":247,"./quad-buffer":249,"./spine-buffer":251,"./vertex-format":252}],249:[function(t,e,i){"use strict";t=t("./mesh-buffer"),t=cc.Class({name:"cc.QuadBuffer",extends:t,_fillQuadBuffer:function(){for(var t=this._initIDataCount/6,e=this._iData,i=0,n=0;i<t;i++){var r=4*i;e[n++]=r,e[n++]=1+r,e[n++]=2+r,e[n++]=1+r,e[n++]=3+r,e[n++]=2+r}var s=new Uint16Array(this._iData.buffer,0,6*t);this._ib.update(0,s)},uploadData:function(){var t;0!==this.byteOffset&&this._dirty&&(t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),this._vb.update(0,t),this._dirty=!1)},switchBuffer:function(){this._super();var t=new Uint16Array(this._iData.buffer,0,this._initIDataCount);this._ib.update(0,t)},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(),this._fillQuadBuffer()}});cc.QuadBuffer=e.exports=t},{"./mesh-buffer":247}],250:[function(t,e,i){"use strict";i.__esModule=!0,i.default=o;var n,r=(n=t("./flex-buffer"))&&n.__esModule?n:{default:n},s=t("./vertex-format");function o(){this.vDatas=[],this.uintVDatas=[],this.iDatas=[],this.meshCount=0,this._infos=null,this._flexBuffer=null}cc.js.mixin(o.prototype,{init:function(t){},clear:function(){this.vDatas.length=0,this.iDatas.length=0,this.uintVDatas.length=0,this.meshCount=0,this._infos=null,this._flexBuffer&&this._flexBuffer.reset()},updateMesh:function(t,e,i){this.vDatas[t]=e,this.uintVDatas[t]=new Uint32Array(e.buffer,0,e.length),this.iDatas[t]=i,this.meshCount=this.vDatas.length},updateMeshRange:function(t,e){},createData:function(t,e,i){e=new Float32Array(e),i=new Uint16Array(i);this.updateMesh(t,e,i)},createQuadData:function(t,e,i){this.createData(t,e,i),this.initQuadIndices(this.iDatas[t])},createFlexData:function(t,e,i,n){n=n||s.vfmtPosUvColor,this._flexBuffer=new r.default(this,t,e,i,n)},initQuadIndices:function(t){for(var e=t.length/6,i=0,n=0;i<e;i++){var r=4*i;t[n++]=r,t[n++]=1+r,t[n++]=2+r,t[n++]=1+r,t[n++]=3+r,t[n++]=2+r}}}),cc.RenderData=o,e.exports=i.default},{"./flex-buffer":246,"./vertex-format":252}],251:[function(t,e,i){"use strict";t=cc.Class({name:"cc.SpineBuffer",extends:t("./mesh-buffer"),requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes,n=this.indiceOffset+e,r=this._vData.byteLength,s=this._iData.length;if(r<i||s<n){for(;r<i||s<n;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0}});cc.SpineBuffer=e.exports=t},{"./mesh-buffer":247}],252:[function(t,e,i){"use strict";t=(t=t("../../../renderer/gfx"))&&t.__esModule?t:{default:t};var n=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:3},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]),r=(n.name="vfmt3D",t.default.VertexFormat.XYZ_UV_Color=n,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),s=(r.name="vfmtPosUvColor",t.default.VertexFormat.XY_UV_Color=r,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:t.default.ATTR_COLOR0,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),o=(s.name="vfmtPosUvTwoColor",t.default.VertexFormat.XY_UV_Two_Color=s,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2}])),a=(o.name="vfmtPosUv",t.default.VertexFormat.XY_UV=o,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}])),c=(a.name="vfmtPosColor",t.default.VertexFormat.XY_Color=a,new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2}]));c.name="vfmtPos",t.default.VertexFormat.XY=c,e.exports={vfmt3D:n,vfmtPosUvColor:r,vfmtPosUvTwoColor:s,vfmtPosUv:o,vfmtPosColor:a,vfmtPos:c}},{"../../../renderer/gfx":312}],253:[function(t,e,i){"use strict";t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,s=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){t=n.exec(t);return t?t[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?"),i=(0<i&&(t=t.substring(0,i)),/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,"")));if(!i)return null;i=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?i.substring(0,i.length-e.length):i},dirname:function(t){t=r.exec(t);return t?t[2]:""},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return 0<i&&(n=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",i=i?this.extname(t):"";return 0<n&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),t.substring(0,n=n<=0?0:n+1)+e+i+r},_normalize:function(t){var e;for(t=String(t);t=(e=t).replace(s,""),e.length!==t.length;);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},e.exports=cc.path},{"../platform/CCSys":198}],254:[function(t,e,i){"use strict";function n(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}n.create=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}},n.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},n.clone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},n.concat=function(t,e,i){var n=e.a,r=e.b,s=e.c,o=e.d,a=e.tx,e=e.ty;return t.a=n*i.a+r*i.c,t.b=n*i.b+r*i.d,t.c=s*i.a+o*i.c,t.d=s*i.b+o*i.d,t.tx=a*i.a+e*i.c+i.tx,t.ty=a*i.b+e*i.d+i.ty,t},n.invert=function(t,e){var i=e.a,n=e.b,r=e.c,s=e.d,o=1/(i*s-n*r),a=e.tx,e=e.ty;return t.a=o*s,t.b=-o*n,t.c=-o*r,t.d=o*i,t.tx=o*(r*e-s*a),t.ty=o*(n*a-i*e),t},n.fromMat4=function(t,e){e=e.m;return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.tx=e[12],t.ty=e[13],t},n.transformVec2=function(t,e,i,n){var r,e=void 0===n?(n=i,r=e.x,e.y):(r=e,i);return t.x=n.a*r+n.c*e+n.tx,t.y=n.b*r+n.d*e+n.ty,t},n.transformSize=function(t,e,i){return t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height,t},n.transformRect=function(t,e,i){var n=e.x,r=e.y,s=n+e.width,e=r+e.height,o=i.a*n+i.c*r+i.tx,a=i.b*n+i.d*r+i.ty,c=i.a*s+i.c*r+i.tx,r=i.b*s+i.d*r+i.ty,l=i.a*n+i.c*e+i.tx,n=i.b*n+i.d*e+i.ty,h=i.a*s+i.c*e+i.tx,s=i.b*s+i.d*e+i.ty,e=Math.min(o,c,l,h),i=Math.max(o,c,l,h),o=Math.min(a,r,n,s),c=Math.max(a,r,n,s);return t.x=e,t.y=o,t.width=i-e,t.height=c-o,t},n.transformObb=function(t,e,i,n,r,s){var o=r.x,a=r.y,c=r.width,r=r.height,l=s.a*o+s.c*a+s.tx,o=s.b*o+s.d*a+s.ty,a=s.a*c,c=s.b*c,h=s.c*r,s=s.d*r;e.x=l,e.y=o,i.x=a+l,i.y=c+o,t.x=h+l,t.y=s+o,n.x=a+h+l,n.y=c+s+o},cc.AffineTransform=e.exports=n},{}],255:[function(t,h,u){"use strict";var e=t("../platform/CCObject").Flags,_=t("./misc"),i=t("../platform/js"),d=t("../platform/id-generater"),f=t("../event-manager"),n=t("../renderer/render-flow"),c=e.Destroying,r=e.DontDestroy,s=e.Deactivating,o=new d("Node");function a(t){return t?"string"==typeof t?i.getClassByName(t):t:(cc.errorID(3804),null)}function p(t,e){if(e._sealed)for(var i=0;i<t._components.length;++i){var n=t._components[i];if(n.constructor===e)return n}else for(var r=0;r<t._components.length;++r){var s=t._components[r];if(s instanceof e)return s}return null}function l(t,e,i){if(e._sealed)for(var n=0;n<t._components.length;++n){var r=t._components[n];r.constructor===e&&i.push(r)}else for(var s=0;s<t._components.length;++s){var o=t._components[s];o instanceof e&&i.push(o)}}t=cc.Class({name:"cc._BaseNode",extends:cc.Object,properties:{_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return 0<(this._objFlags&r)},set:function(t){t?this._objFlags|=r:this._objFlags&=~r}},name:{get:function(){return this._name},set:function(t){this._name=t}},uuid:{get:function(){return this._id}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){var e;this._active!==(t=!!t)&&(this._active=t,(e=this._parent)&&e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t))}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this._id=o.getNewId(),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.__eventTargets=[]},getParent:function(){return this._parent},setParent:function(t){var e,i;this._parent!==t&&((e=this._parent)&&e._objFlags&s&&cc.errorID(3821),this._parent=t||null,this._onSetParent(t),t&&(t._objFlags&s&&cc.errorID(3821),f._setDirtyForNode(this),t._children.push(this),t.emit&&t.emit("child-added",this),t._renderFlag|=n.FLAG_CHILDREN),e?e._objFlags&c||(i=e._children.indexOf(this),e._children.splice(i,1),e.emit&&e.emit("child-removed",this),this._onHierarchyChanged(e),0===e._children.length&&(e._renderFlag&=~n.FLAG_CHILDREN)):t&&this._onHierarchyChanged(null))},attr:function(t){i.mixin(this,t)},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this)},insertChild:function(t,e){t.parent=this,t.setSiblingIndex(e)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){var e,i;this._parent&&(this._parent._objFlags&s?cc.errorID(3821):(e=this._parent._children,(t=-1!==t?t:e.length-1)!==(i=e.indexOf(this))&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))))},walk:function(t,e){for(var i,n,r,s=cc._BaseNode,o=1,a=s._stacks[s._stackId],c=(a||s._stacks.push(a=[]),s._stackId++,a.length=0,a[0]=this,null),l=!1;o;)if(n=a[--o])if(!l&&t?t(n):l&&e&&e(n),a[o]=null,l){if(l=!1,i)if(i[++r])a[o]=i[r],o++;else if(c&&(a[o]=c,o++,l=!0,c._parent?(r=(i=c._parent._children).indexOf(c),c=c._parent):i=c=null,r<0))break}else 0<n._children.length?(i=(c=n)._children,a[o]=i[r=0],o++):(a[o]=n,o++,l=!0);a.length=0,s._stackId--},cleanup:function(){},removeFromParent:function(t){this._parent&&this._parent.removeChild(this,t=void 0===t?!0:t)},removeChild:function(t,e){-1<this._children.indexOf(t)&&(!e&&void 0!==e||t.cleanup(),t.parent=null)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;0<=i;i--){var n=e[i];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},isChildOf:function(t){var e=this;do{if(e===t)return!0}while(e=e._parent);return!1},getComponent:function(t){t=a(t);return t?p(this,t):null},getComponents:function(t){var t=a(t),e=[];return t&&l(this,t,e),e},getComponentInChildren:function(t){t=a(t);return t?function t(e,i){for(var n=0;n<e.length;++n){var r=e[n],s=p(r,i);if(s)return s;if(0<r._children.length&&(s=t(r._children,i)))return s}return null}(this._children,t):null},getComponentsInChildren:function(t){var t=a(t),e=[];return t&&(l(this,t,e),function t(e,i,n){for(var r=0;r<e.length;++r){var s=e[r];l(s,i,n),0<s._children.length&&t(s._children,i,n)}}(this._children,t,e)),e},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(!(e=i.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null}else{if(!t)return cc.errorID(3804),null;e=t}if("function"!=typeof e)return cc.errorID(3809),null;if(!i.isChildClassOf(e,cc.Component))return cc.errorID(3810),null;t=e._requireComponent;if(t&&!this.getComponent(t)&&!this.addComponent(t))return null;t=new e;return(t.node=this)._components.push(t),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(t),t},_addComponentAt:!1,removeComponent:function(t){t?(t=t instanceof cc.Component?t:this.getComponent(t))&&t.destroy():cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(t){var e;t?this._objFlags&c||(-1!==(e=this._components.indexOf(t))?this._components.splice(e,1):t.node!==this&&cc.errorID(3815)):cc.errorID(3814)},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1)},destroyAllChildren:function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},_onSetParent:function(t){},_onPostActivated:function(){},_onBatchRestored:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(t){var e=this._parent,e=(!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this),this._active&&!(!e||!e._activeInHierarchy));this._activeInHierarchy!==e&&cc.director._nodeActivator.activateNode(this,e)},_instantiate:function(t){t=t||cc.instantiate._clone(this,this);var e=this._prefab;e&&this===e.root&&e.sync;return t._parent=null,t._onBatchRestored(),t},_registerIfAttached:!1,_onPreDestroy:function(){this._objFlags|=c;for(var t=this._parent,e=t&&t._objFlags&c,i=this._children,n=0,r=i.length;n<r;++n)i[n]._destroyImmediate();for(n=0,r=this._components.length;n<r;++n)this._components[n]._destroyImmediate();var s,o=this.__eventTargets;for(n=0,r=o.length;n<r;++n){var a=o[n];a&&a.targetOff(this)}return o.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!e&&t&&(s=t._children.indexOf(this),t._children.splice(s,1),t.emit&&t.emit("child-removed",this)),e},onRestore:!1});t.idGenerater=o,t._stacks=[[]],t._stackId=0,t.prototype._onPreDestroyBase=t.prototype._onPreDestroy,t.prototype._onHierarchyChangedBase=t.prototype._onHierarchyChanged;_.propertyDefine(t,["parent","name","children","childrenCount"],{}),cc._BaseNode=h.exports=t},{"../event-manager":113,"../platform/CCObject":195,"../platform/id-generater":205,"../platform/js":209,"../renderer/render-flow":221,"./misc":264}],256:[function(t,e,i){"use strict";e.exports={binarySearchEpsilon:function(t,e){for(var i=0,n=t.length-1,r=n>>>1;i<=n;r=i+n>>>1){var s=t[r];if(e+1e-6<s)n=r-1;else{if(!(s<e-1e-6))return r;i=r+1}}return~i}}},{}],257:[function(t,e,i){"use strict";var n=t("../components/CCRenderComponent"),r=t("../platform/CCMacro").BlendFactor,s=t("../../renderer/gfx"),t=cc.Class({properties:{_srcBlendFactor:r.SRC_ALPHA,_dstBlendFactor:r.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())},animatable:!1,type:r,tooltip:!1,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())},animatable:!1,type:r,tooltip:!1,visible:!0}},setMaterial:function(t,e){t=n.prototype.setMaterial.call(this,t,e);return this._srcBlendFactor===r.SRC_ALPHA&&this._dstBlendFactor===r.ONE_MINUS_SRC_ALPHA||this._updateMaterialBlendFunc(t),t},_updateMaterial:function(){this._updateBlendFunc()},_updateBlendFunc:function(){if(this._srcBlendFactor!==r.SRC_ALPHA||this._dstBlendFactor!==r.ONE_MINUS_SRC_ALPHA)for(var t=this.getMaterials(),e=0;e<t.length;e++){var i=t[e];this._updateMaterialBlendFunc(i)}},_updateMaterialBlendFunc:function(t){t.setBlend(!0,s.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,s.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor)}});e.exports=cc.BlendFunc=t},{"../../renderer/gfx":312,"../components/CCRenderComponent":89,"../platform/CCMacro":194}],258:[function(t,e,i){"use strict";var s=t("./misc").BASE64_VALUES,o="0123456789abcdef".split(""),t=["","","",""],a=t.concat(t,"-",t,"-",t,"-",t,"-",t,t,t),c=a.map(function(t,e){return"-"===t?NaN:e}).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;a[0]=t[0],a[1]=t[1];for(var e=2,i=2;e<22;e+=2){var n=s[t.charCodeAt(e)],r=s[t.charCodeAt(e+1)];a[c[i++]]=o[n>>2],a[c[i++]]=o[(3&n)<<2|r>>4],a[c[i++]]=o[15&r]}return a.join("")}},{"./misc":264}],259:[function(t,e,i){"use strict";cc.find=e.exports=function(t,e){if(null==t)return cc.errorID(3814),null;if(!e){var i=cc.director.getScene();if(!i)return null;e=i}for(var n=e,i="/"!==t[0]?0:1,r=t.split("/"),s=i;s<r.length;s++){for(var o=r[s],a=n._children,n=null,c=0,h=a.length;c<h;++c){var l=a[c];if(l.name===o){n=l;break}}if(!n)return null}return n}},{}],260:[function(t,e,i){"use strict";var n=(s=t("../assets/material/material-variant"))&&s.__esModule?s:{default:s};var r=t("../assets/material/CCMaterial"),s=cc.Class({properties:{_normalMaterial:null,normalMaterial:{get:function(){return this._normalMaterial},set:function(t){this._normalMaterial=t,this._updateDisabledState&&this._updateDisabledState()},type:r,tooltip:!1,animatable:!1},_grayMaterial:null,grayMaterial:{get:function(){return this._grayMaterial},set:function(t){this._grayMaterial=t,this._updateDisabledState&&this._updateDisabledState()},type:r,tooltip:!1,animatable:!1}},_switchGrayMaterial:function(t,e){var i=t?(i=(i=this._grayMaterial)||r.getBuiltinMaterial("2d-gray-sprite"),this._grayMaterial=n.default.create(i,e)):(i=(i=this._normalMaterial)||r.getBuiltinMaterial("2d-sprite",e),this._normalMaterial=n.default.create(i,e));e.setMaterial(0,i)}});e.exports=s},{"../assets/material/CCMaterial":53,"../assets/material/material-variant":60}],261:[function(t,e,i){"use strict";function n(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "])}var c=/^(click)(\s)*=|(param)(\s)*=/,u=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;n.prototype={constructor:n,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,i=t.length;e<i;){var n,r,s=t.indexOf(">",e),o=-1;0<=s&&(o=t.lastIndexOf("<",s))<e-1&&(o=t.indexOf("<",s+1),s=t.indexOf(">",o+1)),e=o<0?(this._stack.pop(),this._processResult(t.substring(e)),i):(n=t.substring(e,o),""===(r=t.substring(o+1,s))&&(n=t.substring(e,s+1)),this._processResult(n),-1===s?s=o:"/"===t.charAt(o+1)?this._stack.pop():this._addToStack(r),s+1)}return this._resultObjectArray},_attributeToObject:function(t){var e,i,n,r={};if(o=(t=t.trim()).match(/^(color|size)(\s)*=/)){if(e=o[0],""===(t=t.substring(e.length).trim()))return r;switch(i=t.indexOf(" "),e[0]){case"c":r.color=-1<i?t.substring(0,i).trim():t;break;case"s":r.size=parseInt(t)}return-1<i&&(n=t.substring(i+1).trim(),n=this._processEventHandler(n),r.event=n),r}if((o=t.match(/^(br(\s)*\/)/))&&0<o[0].length&&(e=o[0].trim()).startsWith("br")&&"/"===e[e.length-1])return r.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),r;if((o=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&0<o[0].length&&(e=o[0].trim()).startsWith("img")&&"/"===e[e.length-1]){for(var s,o=t.match(u),a=!1;o;){if(e=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),l=-1<(i=(s=t.substring(e.length).trim()).indexOf(" "))?s.substr(0,i):s,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=s.substring(i).trim(),l.endsWith("/")&&(l=l.slice(0,-1)),"src"===e){switch(l.charCodeAt(0)){case 34:case 39:a=!0,l=l.slice(1,-1)}r.isImage=!0,r.src=l}else if("height"===e)r.imageHeight=parseInt(l);else if("width"===e)r.imageWidth=parseInt(l);else if("align"===e){switch(l.charCodeAt(0)){case 34:case 39:l=l.slice(1,-1)}r.imageAlign=l.toLocaleLowerCase()}else"offset"===e?r.imageOffset=l:"click"===e&&(r.event=this._processEventHandler(e+"="+l));r.event&&"param"===e&&(r.event.param=l.replace(/^\"|\"$/g,"")),o=t.match(u)}return a&&r.isImage&&this._resultObjectArray.push({text:"",style:r}),{}}if(o=t.match(/^(outline(\s)*[^>]*)/)){var c={color:"#ffffff",width:1};if(t=o[0].substring("outline".length).trim()){var l,h=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(o=t.match(h);o;)e=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),l=-1<(i=(s=t.substring(e.length).trim()).indexOf(" "))?s.substr(0,i):s,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=s.substring(i).trim(),"click"===e?r.event=this._processEventHandler(e+"="+l):"color"===e?c.color=l:"width"===e&&(c.width=parseInt(l)),r.event&&"param"===e&&(r.event.param=l.replace(/^\"|\"$/g,"")),o=t.match(h)}r.outline=c}if((o=t.match(/^(on|u|b|i)(\s)*/))&&0<o[0].length){switch(e=o[0],t=t.substring(e.length).trim(),e[0]){case"u":r.underline=!0;break;case"i":r.italic=!0;break;case"b":r.bold=!0}if(""===t)return r;n=this._processEventHandler(t),r.event=n}return r},_processEventHandler:function(t){for(var e=0,i={},n=t.match(c),r=!1;n;){var s,o=n[0],a="",r=!1;'"'===(t=t.substring(o.length).trim()).charAt(0)?(-1<(e=t.indexOf('"',1))&&(a=t.substring(1,e).trim(),r=!0),e++):"'"===t.charAt(0)?(-1<(e=t.indexOf("'",1))&&(a=t.substring(1,e).trim(),r=!0),e++):e=(a=(s=t.match(/(\S)+/))?s[0]:"").length,r&&(i[o=o.substring(0,o.length-1).trim()]=a),n=(t=t.substring(e).trim()).match(c)}return i},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else if(!e.isNewLine&&!e.isImage){var i,n=this._stack[this._stack.length-1];for(i in n)e[i]||(e[i]=n[i]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),0<this._stack.length?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0],n=this._specialSymbolArray[e][1];t=t.replace(i,n)}return t}},e.exports=n},{}],262:[function(t,e,i){"use strict";t("./CCPath"),t("./profiler/CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":253,"./find":259,"./mutable-forward-iterator":265,"./profiler/CCProfiler":268}],263:[function(t,e,i){"use strict";i.__esModule=!0,i.postLoadMesh=function(i,n){!i.loaded&&i.nativeUrl?cc.loader.load(i.nativeUrl,function(t,e){e&&(i._nativeAsset=e),n&&n(t)}):n&&n()}},{}],264:[function(t,e,i){"use strict";for(var l=t("../platform/js"),t={propertyDefine:function(t,e,i){function n(t,e,i,n){var r=Object.getOwnPropertyDescriptor(t,e);r?(r.get&&(t[i]=r.get),r.set&&n&&(t[n]=r.set)):(r=t[i],l.getset(t,e,r,t[n]))}for(var r=t.prototype,s=0;s<e.length;s++){var o,a=(o=e[s])[0].toUpperCase()+o.slice(1);n(r,o,"get"+a,"set"+a)}for(o in i){var c=i[o];n(r,o,c[0],c[1])}},NextPOT:function(t){return--t,(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)+1},BUILTIN_CLASSID_RE:/^(?:cc|dragonBones|sp|ccsg)\..+/},n=new Array(123),r=0;r<123;++r)n[r]=64;for(var s=0;s<64;++s)n["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(s)]=s;t.BASE64_VALUES=n,t.pushToMap=function(t,e,i,n){var r=t[e];r?Array.isArray(r)?n?(r.push(r[0]),r[0]=i):r.push(i):t[e]=n?[i,r]:[r,i]:t[e]=i},t.clampf=function(t,e,i){var n;return i<e&&(n=e,e=i,i=n),t<e?e:t<i?t:i},t.clamp01=function(t){return t<0?0:t<1?t:1},t.lerp=function(t,e,i){return t+(e-t)*i},t.degreesToRadians=function(t){return t*cc.macro.RAD},t.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.misc=e.exports=t},{"../platform/js":209}],265:[function(t,e,i){"use strict";function n(t){this.i=0,this.array=t}var r=n.prototype;r.remove=function(t){t=this.array.indexOf(t);0<=t&&this.removeAt(t)},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.fastRemove=function(t){t=this.array.indexOf(t);0<=t&&this.fastRemoveAt(t)},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=n},{}],266:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;(n=r.prototype).get=function(){},n.put=function(){},n.clear=function(){};var n=r;function r(){this.enabled=!1,this.count=0,this.maxSize=1024}i.default=n,cc.pool={},n.register=function(t,e){cc.pool[t]=e},e.exports=i.default},{}],267:[function(t,e,i){"use strict";cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,!e.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var i=t._objFlags,n=t._parent,r=t._id,s=t._name,o=t._active,a=t._eulerAngles.x,h=t._eulerAngles.y,u=t._eulerAngles.z,_=t._localZOrder,d=t._globalZOrder,c=t._trs,f=c[0],p=c[1],m=c[2],l=(cc.game._isCloning=!0,e.asset.data);l._prefab._synced=!0,l._iN$t=t,cc.instantiate._clone(l,l),cc.game._isCloning=!1,t._objFlags=i,t._parent=n,t._id=r,t._prefab=e,t._name=s,t._active=o,t._localZOrder=_,t._globalZOrder=d,(c=t._trs)[0]=f,c[1]=p,c[2]=m,t._eulerAngles.x=a,t._eulerAngles.y=h,t._eulerAngles.z=u}}},{}],268:[function(t,e,h){"use strict";var u=t("../../platform/CCMacro"),_=t("./perf-counter"),i=!1,n=15,s=null,r=null,o=null;function a(){r&&r.isValid||((r=new cc.Node("PROFILER-NODE")).x=r.y=10,r.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),r.zIndex=u.MAX_ZINDEX,cc.game.addPersistRootNode(r),(i=new cc.Node("LEFT-PANEL")).anchorX=i.anchorY=0,(t=i.addComponent(cc.Label)).fontSize=n,t.lineHeight=n,i.parent=r,(i=new cc.Node("RIGHT-PANEL")).anchorX=1,i.anchorY=0,i.x=200,(e=i.addComponent(cc.Label)).horizontalAlign=cc.Label.HorizontalAlign.RIGHT,e.fontSize=n,e.lineHeight=n,i.parent=r,cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_GAME_SUB&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(t.cacheMode=cc.Label.CacheMode.CHAR,e.cacheMode=cc.Label.CacheMode.CHAR),o={left:t,right:e});var t,e,i=cc.director._lastUpdate;s.frame._counter.start(i),s.logic._counter.start(i)}function c(){var t=performance.now();cc.director.isPaused()?s.frame._counter.start(t):s.logic._counter.end(t),s.render._counter.start(t)}function l(){var t,e=performance.now(),i=(s.render._counter.end(e),s.draws._counter.value=cc.renderer.drawCalls,s.frame._counter.end(e),s.fps._counter.frame(e),""),n="";for(t in s){var r=s[t];r._counter.sample(e),i+=r.desc+"\n",n+=r._counter.human()+"\n"}o&&(o.left.string=i,o.right.string=n)}cc.profiler=e.exports={isShowingStats:function(){return i},hideStats:function(){i&&(r&&(r.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,a),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,c),cc.director.off(cc.Director.EVENT_AFTER_DRAW,l),i=!1)},showStats:function(){if(!i){if(!s){s={frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};var t,e=performance.now();for(t in s)s[t]._counter=new _(t,s[t],e)}r&&(r.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,a),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,c),cc.director.on(cc.Director.EVENT_AFTER_DRAW,l),i=!0}}}},{"../../platform/CCMacro":194,"./perf-counter":270}],269:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.Counter",ctor:function(t,e,i){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=i},properties:{value:{get:function(){return this._value},set:function(t){this._value=t}}},_average:function(t,e){this._opts.average&&(this._accumValue+=t,++this._accumSamples,(t=e)-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=t,this._accumSamples=0))},sample:function(t){this._average(this._value,t)},human:function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}});e.exports=n},{}],270:[function(t,e,i){"use strict";t=t("./counter"),t=cc.Class({name:"cc.PerfCounter",extends:t,ctor:function(t,e,i){this._time=i},start:function(t){this._time=t},end:function(t){this._value=t-this._time,this._average(this._value)},tick:function(){this.end(),this.start()},frame:function(t){var e=t-this._time;this._total++,(this._opts.average||1e3)<e&&(this._value=1e3*this._total/e,this._total=0,this._time=t,this._average(this._value))}});e.exports=t},{"./counter":269}],271:[function(t,e,i){"use strict";var n=new((t=t("../platform/js"))&&t.__esModule?t:{default:t}).default.Pool(2);function r(t){this.count=0,this.limit=t,this.datas={},this.head=null,this.tail=null}n.get=function(){return this._get()||{key:null,value:null,prev:null,next:null}},r.prototype.moveToHead=function(t){t.next=this.head,(t.prev=null)!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.count++,this.datas[t.key]=t},r.prototype.put=function(t,e){var i=n.get();i.key=t,i.value=e,this.count>=this.limit&&(t=this.tail,delete this.datas[t.key],this.count--,this.tail=t.prev,this.tail.next=null,t.prev=null,t.next=null,n.put(t)),this.moveToHead(i)},r.prototype.remove=function(t){null!==t.prev?t.prev.next=t.next:this.head=t.next,null!==t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},r.prototype.get=function(t){t=this.datas[t];return t?(this.remove(t),this.moveToHead(t),t.value):null},r.prototype.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},r.prototype.has=function(t){return!!this.datas[t]},r.prototype.delete=function(t){t=this.datas[t];this.remove(t)};var s=new r(100);cc.textUtils=e.exports={BASELINE_RATIO:.26,MIDDLE_RATIO:.37,BASELINE_OFFSET:0,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,highSurrogateRex:/[\uD800-\uDBFF]/,lowSurrogateRex:/[\uDC00-\uDFFF]/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(t){return this.__CHINESE_REG.test(t)||this.__JAPANESE_REG.test(t)||this.__KOREAN_REG.test(t)},isUnicodeSpace:function(t){return 9<=(t=t.charCodeAt(0))&&t<=13||32===t||133===t||160===t||5760===t||8192<=t&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},safeMeasureText:function(t,e,i){var i=(i||t.font)+"ðŸŽ®"+e,n=s.get(i);if(null!==n)return n;n=t.measureText(e),t=n&&n.width||0;return s.put(i,t),t},_safeSubstring:function(t,e,i){var n=e,r=i,s=t[e];return this.lowSurrogateRex.test(s)&&n--,void 0!==i&&(i-1!==e?(e=t[i-1],this.highSurrogateRex.test(e)&&r--):this.highSurrogateRex.test(s)&&r++),t.substring(n,r)},fragmentText:function(h,t,e,u){var i=[];if(0===h.length||e<0)return i.push(""),i;for(var n=h;e<t&&1<n.length;){for(var _,r=n.length*(e/t)|0,s=this._safeSubstring(n,r),o=t-u(s),a=s,d=0,f=0;e<o&&f++<10;)o=t-u(s=this._safeSubstring(n,r=r*(e/o)|0));for(f=0;o<=e&&f++<10;)s&&(d=(_=this.label_wordRex.exec(s))?_[0].length:1,a=s),r+=d,o=t-u(s=this._safeSubstring(n,r));0===(r-=d)?a=this._safeSubstring(n,r=1):1===r&&this.highSurrogateRex.test(n[0])&&(a=this._safeSubstring(n,r=2));var c,l=this._safeSubstring(n,0,r);this.label_wrapinspection&&this.label_symbolRex.test(a||s)&&(0===(r-=(c=this.label_lastWordRex.exec(l))?c[0].length:0)&&(r=1),a=this._safeSubstring(n,r),l=this._safeSubstring(n,0,r)),this.label_firstEnglish.test(a)&&(c=this.label_lastEnglish.exec(l))&&l!==c[0]&&(r-=c[0].length,a=this._safeSubstring(n,r),l=this._safeSubstring(n,0,r)),(0===i.length||0<(l=l.trimLeft()).length)&&i.push(l),t=u(n=a||s)}return(0===i.length||0<(n=n.trimLeft()).length)&&i.push(n),i}}},{"../platform/js":209}],272:[function(t,e,i){"use strict";var r=t("../assets/CCTexture2D");cc.textureUtil=e.exports={loadImage:function(t,i,n){cc.assertID(t,3103);var e=cc.loader.getRes(t);return e?e.loaded?i&&i.call(n,null,e):e.once("load",function(){i&&i.call(n,null,e)},n):((e=new r).url=t,cc.loader.load({url:t,texture:e},function(t,e){if(t)return i&&i.call(n,t||new Error("Unknown error"));e.handleLoadedTexture(),i&&i.call(n,null,e)})),e},cacheImage:function(t,e){var i;if(t&&e)return(i=new r).initWithElement(e),cc.loader.flowOut({id:t,url:t,error:null,content:i,complete:!1}),i},postLoadTexture:function(i,n){!i.loaded&&i.url?cc.loader.load({url:i.url,skips:i._isCompressed()?void 0:["Loader"]},function(t,e){if(e){if(e instanceof cc.Texture2D)return cc.error("internal error: loader handle pipe must be skipped");i.loaded||(i._nativeAsset=e)}n&&n(t)}):n&&n()}}},{"../assets/CCTexture2D":50}],273:[function(t,e,i){"use strict";var n=t("./node-unit"),t=t("./node-mem-pool");e.exports={NodeMemPool:new t(n)}},{"./node-mem-pool":275,"./node-unit":276}],274:[function(t,e,i){"use strict";function n(t){this._unitClass=t,this._pool=[],this._findOrder=[]}var r=n.prototype;r._initNative=function(){this._nativeMemPool=new renderer.MemPool},r._buildUnit=function(t){return new this._unitClass(t,this)},r._destroyUnit=function(t){this._pool[t]=null;for(var e=0,i=this._findOrder.length;e<i;e++){var n=this._findOrder[e];if(n&&n.unitID==t){this._findOrder.splice(e,1);break}}},r._findUnitID=function(){for(var t=0,e=this._pool;e[t];)t++;return t},r.pop=function(){for(var t,e=null,i=0,n=this._findOrder,r=this._pool,s=n.length;i<s;i++){var o=n[i];if(o&&o.hasSpace()){e=o;break}}e||(t=this._findUnitID(),e=this._buildUnit(t),r[t]=e,n.push(e),i=n.length-1);r=n[0];return r!==e&&(n[0]=e,n[i]=r),e.pop()},r.push=function(t){var e=this._pool[t.unitID];return e.push(t.index),1<this._findOrder.length&&e.isAllFree()&&this._destroyUnit(t.unitID),e},e.exports=n},{}],275:[function(t,e,i){"use strict";function n(t){r.call(this,t)}var r=t("./mem-pool");function s(){}s.prototype=r.prototype;t=n.prototype=new s;t._initNative=function(){this._nativeMemPool=new renderer.NodeMemPool},t._destroyUnit=function(t){r.prototype._destroyUnit.call(this,t)},e.exports=n},{"./mem-pool":274}],276:[function(t,e,r){"use strict";function i(t,e){l.call(this,t,e);var i=this._contentNum;this.trsList=new s.FLOAT_ARRAY_TYPE(10*i),this.localMatList=new s.FLOAT_ARRAY_TYPE(16*i),this.worldMatList=new s.FLOAT_ARRAY_TYPE(16*i);for(var n=0;n<i;n++){var r=this._spacesData[n];r.trs=new s.FLOAT_ARRAY_TYPE(this.trsList.buffer,n*o,10),r.localMat=new s.FLOAT_ARRAY_TYPE(this.localMatList.buffer,n*a,16),r.worldMat=new s.FLOAT_ARRAY_TYPE(this.worldMatList.buffer,n*c,16)}}var s=t("../../value-types/utils"),o=(Uint32Array,10*s.FLOAT_BYTES),a=16*s.FLOAT_BYTES,c=16*s.FLOAT_BYTES,l=(Uint32Array,Uint32Array,Int32Array,Uint8Array,Uint8Array,Uint32Array,s.FLOAT_BYTES,t("./unit-base"));function n(){}n.prototype=l.prototype,i.prototype=new n,e.exports=i},{"../../value-types/utils":286,"./unit-base":277}],277:[function(t,e,i){"use strict";function n(t,e,i){i=i||128,this.unitID=t,this._memPool=e,this._data=new Uint16Array(2),this._data[0]=0,this._data[1]=0,this._contentNum=i,this._signData=new Uint16Array(2*this._contentNum),this._spacesData=[];for(var n=0;n<i;n++){var r=2*n;this._signData[0+r]=n+1,this._signData[1+r]=0,this._spacesData[n]={index:n,unitID:t}}this._signData[2*(i-1)]=65535}var r=n.prototype;r.hasSpace=function(){return 65535!==this._data[0]},r.isAllFree=function(){return 0==this._data[1]},r.pop=function(){var t=this._data[0];if(65535===t)return null;var e=2*t,t=this._spacesData[t];return this._signData[1+e]=1,this._data[0]=this._signData[0+e],this._data[1]++,t},r.push=function(t){var e=2*t;this._signData[1+e]=0,this._signData[0+e]=this._data[0],this._data[0]=t,this._data[1]--},r.dump=function(){for(var t=0,e=this._data[0],i="";65535!=e;)t++,i+=e+"->",e=this._signData[2*e+0];for(var n=0,r="",s=this._contentNum,o=0;o<s;o++)1==this._signData[2*o+1]&&(n++,r+=o+"->");var a=t+n;console.log("unitID:",this.unitID,"spaceNum:",t,"calc using num:",n,"store using num:",this._data[1],"calc total num:",a,"actually total num:",this._contentNum),console.log("free info:",i),console.log("using info:",r),n!=this._data[1]&&cc.error("using num error","calc using num:",n,"store using num:",this._data[1]),t+n!=this._contentNum&&cc.error("total num error","calc total num:",a,"actually total num:",this._contentNum)},e.exports=n},{}],278:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=s(t("./value-type")),h=s(t("../platform/CCClass")),r=s(t("../utils/misc"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}function u(i){return function(){var t,e=a(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=function(s){var t;t=s,(e=a).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t,u(a);function a(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=255),(r=s.call(this)||this)._val=0,"object"==typeof t&&(e=t.g,i=t.b,n=t.a,t=t.r),r._val=(n<<24>>>0)+(i<<16)+(e<<8)+t,r}a.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},a.clone=function(t){return new a(t.r,t.g,t.b,t.a)},a.set=function(t,e,i,n,r){return void 0===i&&(i=255),void 0===n&&(n=255),void 0===r&&(r=255),t.r=e=void 0===e?255:e,t.g=i,t.b=n,t.a=r,t},a.fromHex=function(t,e){var i=(e>>16&255)/255,n=(e>>8&255)/255,r=(255&e)/255;return t.r=(e>>24)/255,t.g=i,t.b=n,t.a=r,t},a.add=function(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t},a.subtract=function(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t},a.multiply=function(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t},a.divide=function(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t},a.scale=function(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t},a.lerp=function(t,e,i,n){var r=e.r,s=e.g,o=e.b,e=e.a;return t.r=r+n*(i.r-r),t.g=s+n*(i.g-s),t.b=o+n*(i.b-o),t.a=e+n*(i.a-e),t},a.toArray=function(t,e,i){var n=e instanceof a||1<e.a?1/255:1;return t[(i=void 0===i?0:i)+0]=e.r*n,t[i+1]=e.g*n,t[i+2]=e.b*n,t[i+3]=e.a*n,t},a.fromArray=function(t,e,i){return e.r=255*t[(i=void 0===i?0:i)+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e},c(a,null,[{key:"WHITE",get:function(){return new a(255,255,255,255)}},{key:"BLACK",get:function(){return new a(0,0,0,255)}},{key:"TRANSPARENT",get:function(){return new a(0,0,0,0)}},{key:"GRAY",get:function(){return new a(127.5,127.5,127.5)}},{key:"RED",get:function(){return new a(255,0,0)}},{key:"GREEN",get:function(){return new a(0,255,0)}},{key:"BLUE",get:function(){return new a(0,0,255)}},{key:"YELLOW",get:function(){return new a(255,235,4)}},{key:"ORANGE",get:function(){return new a(255,127,0)}},{key:"CYAN",get:function(){return new a(0,255,255)}},{key:"MAGENTA",get:function(){return new a(255,0,255)}}]);var e=a.prototype;return e.clone=function(){var t=new a;return t._val=this._val,t},e.equals=function(t){return t&&this._val===t._val},e.lerp=function(t,e,i){i=i||new a;var n=this.r,r=this.g,s=this.b,o=this.a;return i.r=n+(t.r-n)*e,i.g=r+(t.g-r)*e,i.b=s+(t.b-s)*e,i.a=o+(t.a-o)*e,i},e.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},e.getR=function(){return 255&this._val},e.setR=function(t){return t=~~r.default.clampf(t,0,255),this._val=(4294967040&this._val|t)>>>0,this},e.getG=function(){return(65280&this._val)>>8},e.setG=function(t){return t=~~r.default.clampf(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0,this},e.getB=function(){return(16711680&this._val)>>16},e.setB=function(t){return t=~~r.default.clampf(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0,this},e.getA=function(){return(4278190080&this._val)>>>24},e.setA=function(t){return t=~~r.default.clampf(t,0,255),this._val=(16777215&this._val|t<<24)>>>0,this},e.toCSS=function(t){return t&&"rgba"!==t?"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t):"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")"},e.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,i=parseInt(t.substr(2,2),16)||0,n=parseInt(t.substr(4,2),16)||0,t=parseInt(t.substr(6,2),16)||255;return this._val=(t<<24>>>0)+(n<<16)+(i<<8)+e,this},e.toHEX=function(t){var e=[(this.r<16?"0":"")+(0|this.r).toString(16),(this.g<16?"0":"")+(0|this.g).toString(16),(this.b<16?"0":"")+(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)1<e[i].length&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);else"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+(0|this.a).toString(16));return e.join("")},e.toRGBValue=function(){return 16777215&this._val},e.fromHSV=function(t,e,i){var n,r,s;if(0===e)n=r=s=i;else if(0===i)n=r=s=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t),t=t-o,a=i*(1-e),c=i*(1-e*t),l=i*(1-e*(1-t));switch(o){case 0:n=i,r=l,s=a;break;case 1:n=c,r=i,s=a;break;case 2:n=a,r=i,s=l;break;case 3:n=a,r=c,s=i;break;case 4:n=l,r=a,s=i;break;case 5:n=i,r=a,s=c}}return this._val=(this.a<<24>>>0)+((s*=255)<<16)+((r*=255)<<8)+(n*=255),this},e.toHSV=function(){var t=this.r/255,e=this.g/255,i=this.b/255,n={h:0,s:0,v:0},r=Math.max(t,e,i),s=Math.min(t,e,i);return n.v=r,n.s=r?(r-s)/r:0,n.s?(s=r-s,n.h=t===r?(e-i)/s:e===r?2+(i-t)/s:4+(t-e)/s,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},e.set=function(t){return t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a),this},e._fastSetA=function(t){this._val=(16777215&this._val|t<<24)>>>0},e.multiply=function(t){var e=(255&this._val)*t.r>>8,i=(65280&this._val)*t.g>>8,n=(16711680&this._val)*t.b>>8,t=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&t|16711680&n|65280&i|255&e,this},c(a,[{key:"r",get:function(){return this.getR()},set:function(t){this.setR(t)}},{key:"g",get:function(){return this.getG()},set:function(t){this.setG(t)}},{key:"b",get:function(){return this.getB()},set:function(t){this.setB(t)}},{key:"a",get:function(){return this.getA()},set:function(t){this.setA(t)}}]),a}(n.default);(i.default=l).div=l.divide,l.sub=l.subtract,l.mul=l.multiply,l.WHITE_R=l.WHITE,l.BLACK_R=l.BLACK,l.TRANSPARENT_R=l.TRANSPARENT,l.GRAY_R=l.GRAY,l.RED_R=l.RED,l.GREEN_R=l.GREEN,l.BLUE_R=l.BLUE,l.YELLOW_R=l.YELLOW,l.ORANGE_R=l.ORANGE,l.CYAN_R=l.CYAN,l.MAGENTA_R=l.MAGENTA,h.default.fastDefine("cc.Color",l,{r:0,g:0,b:0,a:255}),cc.Color=l,cc.color=function(t,e,i,n){return"string"!=typeof t?"object"==typeof t?new l(t.r,t.g,t.b,t.a):new l(t,e,i,n):(new l).fromHEX(t)},e.exports=i.default},{"../platform/CCClass":189,"../utils/misc":264,"./value-type":287}],279:[function(t,e,i){"use strict";var n={Vec2:i.__esModule=!0,Vec3:!0,Vec4:!0,Mat4:!0,Mat3:!0,Rect:!0,Size:!0,Color:!0,Quat:!0,Trs:!0},r=(i.Trs=i.Quat=i.Color=i.Size=i.Rect=i.Mat3=i.Mat4=i.Vec4=i.Vec3=i.Vec2=void 0,o(t("./vec2"))),r=(i.Vec2=r.default,o(t("./vec3"))),r=(i.Vec3=r.default,o(t("./vec4"))),r=(i.Vec4=r.default,o(t("./mat4"))),r=(i.Mat4=r.default,o(t("./mat3"))),r=(i.Mat3=r.default,o(t("./rect"))),r=(i.Rect=r.default,o(t("./size"))),r=(i.Size=r.default,o(t("./color"))),r=(i.Color=r.default,o(t("./quat"))),r=(i.Quat=r.default,o(t("./trs"))),s=(i.Trs=r.default,t("./utils"));function o(t){return t&&t.__esModule?t:{default:t}}Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||(i[t]=s[t]))}),cc.math=e.exports},{"./color":278,"./mat3":280,"./mat4":281,"./quat":282,"./rect":283,"./size":284,"./trs":285,"./utils":286,"./vec2":288,"./vec3":289,"./vec4":290}],280:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var g=t("../value-types/utils"),o=(t=t("./vec3"))&&t.__esModule?t:{default:t};l.create=function(t,e,i,n,r,s,o,a,c){return new l(t=void 0===t?1:t,e=void 0===e?0:e,i=void 0===i?0:i,n=void 0===n?0:n,r=void 0===r?1:r,s=void 0===s?0:s,o=void 0===o?0:o,a=void 0===a?0:a,c=void 0===c?1:c)},l.clone=function(t){t=t.m;return new l(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},l.copy=function(t,e){return t.m.set(e.m),t},l.set=function(t,e,i,n,r,s,o,a,c,h){var l=t.m;return l[0]=e,l[1]=i,l[2]=n,l[3]=r,l[4]=s,l[5]=o,l[6]=a,l[7]=c,l[8]=h,t},l.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,t},l.transpose=function(t,e){var i,n,r=e.m,s=t.m;return t===e?(e=r[1],i=r[2],n=r[5],s[1]=r[3],s[2]=r[6],s[3]=e,s[5]=r[7],s[6]=i,s[7]=n):(s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8]),t},l.invert=function(h,t){var t=t.m,e=h.m,i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],t=t[8],_=t*o-a*u,d=-t*s+a*c,f=u*s-o*c,l=i*_+n*d+r*f;return l&&(e[0]=_*(l=1/l),e[1]=(-t*n+r*u)*l,e[2]=(a*n-r*o)*l,e[3]=d*l,e[4]=(t*i-r*c)*l,e[5]=(-a*i+r*s)*l,e[6]=f*l,e[7]=(-u*i+n*c)*l,e[8]=(o*i-n*s)*l),h},l.adjoint=function(h,t){var t=t.m,e=h.m,i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],t=t[8];return e[0]=o*t-a*l,e[1]=r*l-n*t,e[2]=n*a-r*o,e[3]=a*c-s*t,e[4]=i*t-r*c,e[5]=r*s-i*a,e[6]=s*l-o*c,e[7]=n*c-i*l,e[8]=i*o-n*s,h},l.determinant=function(t){var t=t.m,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],t=t[8];return e*(t*s-o*c)+i*(-t*r+o*a)+n*(c*r-s*a)},l.multiply=function(h,t,e){var t=t.m,e=e.m,i=h.m,n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],t=t[8],_=e[0],d=e[1],f=e[2],p=e[3],m=e[4],y=e[5],g=e[6],v=e[7],e=e[8];return i[0]=_*n+d*o+f*l,i[1]=_*r+d*a+f*u,i[2]=_*s+d*c+f*t,i[3]=p*n+m*o+y*l,i[4]=p*r+m*a+y*u,i[5]=p*s+m*c+y*t,i[6]=g*n+v*o+e*l,i[7]=g*r+v*a+e*u,i[8]=g*s+v*c+e*t,h},l.multiplyMat4=function(h,t,e){var t=t.m,e=e.m,i=h.m,n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],t=t[8],_=e[0],d=e[1],f=e[2],p=e[4],m=e[5],y=e[6],g=e[8],v=e[9],e=e[10];return i[0]=_*n+d*o+f*l,i[1]=_*r+d*a+f*u,i[2]=_*s+d*c+f*t,i[3]=p*n+m*o+y*l,i[4]=p*r+m*a+y*u,i[5]=p*s+m*c+y*t,i[6]=g*n+v*o+e*l,i[7]=g*r+v*a+e*u,i[8]=g*s+v*c+e*t,h},l.translate=function(t,e,i){var e=e.m,n=t.m,r=e[0],s=e[1],o=e[2],a=e[3],c=e[4],h=e[5],u=e[6],_=e[7],e=e[8],l=i.x,i=i.y;return n[0]=r,n[1]=s,n[2]=o,n[3]=a,n[4]=c,n[5]=h,n[6]=l*r+i*a+u,n[7]=l*s+i*c+_,n[8]=l*o+i*h+e,t},l.rotate=function(t,e,i){var e=e.m,n=t.m,r=e[0],s=e[1],o=e[2],a=e[3],c=e[4],h=e[5],u=e[6],_=e[7],e=e[8],l=Math.sin(i),i=Math.cos(i);return n[0]=i*r+l*a,n[1]=i*s+l*c,n[2]=i*o+l*h,n[3]=i*a-l*r,n[4]=i*c-l*s,n[5]=i*h-l*o,n[6]=u,n[7]=_,n[8]=e,t},l.scale=function(t,e,i){var n=i.x,i=i.y,e=e.m,r=t.m;return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],t},l.fromMat4=function(t,e){var e=e.m,i=t.m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},l.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e.x,i[7]=e.y,i[8]=1,t},l.fromRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=e,n[1]=i,n[2]=0,n[3]=-i,n[4]=e,n[5]=0,n[6]=0,n[7]=0,n[8]=1,t},l.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=e.y,i[5]=0,i[6]=0,i[7]=0,i[8]=1,t},l.fromQuat=function(t,e){var i=t.m,n=e.x,r=e.y,s=e.z,e=e.w,o=n+n,a=r+r,c=s+s,n=n*o,l=r*o,r=r*a,h=s*o,u=s*a,s=s*c,o=e*o,a=e*a,e=e*c;return i[0]=1-r-s,i[3]=l-e,i[6]=h+a,i[1]=l+e,i[4]=1-n-s,i[7]=u-o,i[2]=h-a,i[5]=u+o,i[8]=1-n-r,t},l.fromViewUp=function(t,e,i){n=new o.default(0,1,0),r=new o.default,s=new o.default;var n,r,s;return o.default.lengthSqr(e)<g.EPSILON*g.EPSILON?(l.identity(t),t):(o.default.normalize(r,o.default.cross(r,i=i||n,e)),o.default.lengthSqr(r)<g.EPSILON*g.EPSILON?l.identity(t):(o.default.cross(s,e,r),l.set(t,r.x,r.y,r.z,s.x,s.y,s.z,e.x,e.y,e.z)),t)},l.normalFromMat4=function(h,t){var t=t.m,e=h.m,i=t[0],n=t[1],u=t[2],r=t[3],_=t[4],d=t[5],f=t[6],s=t[7],o=t[8],a=t[9],c=t[10],l=t[11],p=t[12],m=t[13],y=t[14],t=t[15],g=i*d-n*_,v=i*f-u*_,x=i*s-r*_,b=n*f-u*d,A=n*s-r*d,C=u*s-r*f,S=o*m-a*p,T=o*y-c*p,o=o*t-l*p,w=a*y-c*m,a=a*t-l*m,c=c*t-l*y,l=g*c-v*a+x*w+b*o-A*T+C*S;return l&&(e[0]=(d*c-f*a+s*w)*(l=1/l),e[1]=(f*o-_*c-s*T)*l,e[2]=(_*a-d*o+s*S)*l,e[3]=(u*a-n*c-r*w)*l,e[4]=(i*c-u*o+r*T)*l,e[5]=(n*o-i*a-r*S)*l,e[6]=(m*C-y*A+t*b)*l,e[7]=(y*x-p*C-t*v)*l,e[8]=(p*A-m*x+t*g)*l),h},l.frob=function(t){t=t.m;return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},l.add=function(t,e,i){var e=e.m,i=i.m,n=t.m;return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n[3]=e[3]+i[3],n[4]=e[4]+i[4],n[5]=e[5]+i[5],n[6]=e[6]+i[6],n[7]=e[7]+i[7],n[8]=e[8]+i[8],t},l.subtract=function(t,e,i){var e=e.m,i=i.m,n=t.m;return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n[3]=e[3]-i[3],n[4]=e[4]-i[4],n[5]=e[5]-i[5],n[6]=e[6]-i[6],n[7]=e[7]-i[7],n[8]=e[8]-i[8],t},l.multiplyScalar=function(t,e,i){var e=e.m,n=t.m;return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*i,t},l.multiplyScalarAndAdd=function(t,e,i,n){var e=e.m,i=i.m,r=t.m;return r[0]=e[0]+i[0]*n,r[1]=e[1]+i[1]*n,r[2]=e[2]+i[2]*n,r[3]=e[3]+i[3]*n,r[4]=e[4]+i[4]*n,r[5]=e[5]+i[5]*n,r[6]=e[6]+i[6]*n,r[7]=e[7]+i[7]*n,r[8]=e[8]+i[8]*n,t},l.exactEquals=function(t,e){t=t.m,e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},l.equals=function(t,e){var t=t.m,e=e.m,i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],t=t[8],h=e[0],u=e[1],_=e[2],d=e[3],f=e[4],p=e[5],m=e[6],y=e[7],e=e[8];return Math.abs(i-h)<=g.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-u)<=g.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-_)<=g.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(s-d)<=g.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-f)<=g.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-p)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(c-m)<=g.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(l-y)<=g.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(t-e)<=g.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},l.toArray=function(t,e,i){void 0===i&&(i=0);for(var n=e.m,r=0;r<9;r++)t[i+r]=n[r];return t},l.fromArray=function(t,e,i){void 0===i&&(i=0);for(var n=t.m,r=0;r<9;r++)n[r]=e[i+r];return t},l.prototype.toString=function(){var t=this.m;return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"};t=l;function l(t,e,i,n,r,s,o,a,c){var l;void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===c&&(c=1),this.m=void 0,t instanceof g.FLOAT_ARRAY_TYPE?this.m=t:(this.m=new g.FLOAT_ARRAY_TYPE(9),(l=this.m)[0]=t,l[1]=e,l[2]=i,l[3]=n,l[4]=r,l[5]=s,l[6]=o,l[7]=a,l[8]=c)}(i.default=t).sub=t.subtract,t.mul=t.multiply,t.IDENTITY=Object.freeze(new t),cc.Mat3=t,e.exports=i.default},{"../value-types/utils":286,"./vec3":289}],281:[function(e,i,r){"use strict";r.__esModule=!0,r.default=void 0;var t=c(e("./value-type")),s=c(e("../platform/CCClass")),o=c(e("./vec3")),a=c(e("./quat")),S=e("./utils"),u=c(e("./mat3"));function c(t){return t&&t.__esModule?t:{default:t}}function l(i){return function(){var t,e=h(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=h(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var T,m=0,y=0,g=0,v=0,x=0,b=0,A=0,C=0,w=0,E=0,M=0,I=0,p=0,B=0,R=0,P=0,D=(T=t.default,e=T,(t=n).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e,l(n),(t=n.prototype).mul=function(t,e){return n.multiply(e||new n,this,t)},t.mulScalar=function(t,e){n.multiplyScalar(e||new n,this,t)},t.sub=function(t,e){n.subtract(e||new n,this,t)},n.clone=function(t){t=t.m;return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},n.copy=function(t,e){var i=t.m,e=e.m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],t},n.set=function(t,e,i,n,r,s,o,a,c,h,u,_,d,f,p,m,y){var l=t.m;return l[0]=e,l[1]=i,l[2]=n,l[3]=r,l[4]=s,l[5]=o,l[6]=a,l[7]=c,l[8]=h,l[9]=u,l[10]=_,l[11]=d,l[12]=f,l[13]=p,l[14]=m,l[15]=y,t},n.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},n.transpose=function(t,e){var i,n,r,s,o,a=t.m,c=e.m;return t===e?(e=c[1],i=c[2],n=c[3],r=c[6],s=c[7],o=c[11],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=e,a[6]=c[9],a[7]=c[13],a[8]=i,a[9]=r,a[11]=c[14],a[12]=n,a[13]=s,a[14]=o):(a[0]=c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15]),t},n.invert=function(h,t){var t=t.m,t=(m=t[0],y=t[1],g=t[2],v=t[3],x=t[4],b=t[5],A=t[6],C=t[7],w=t[8],E=t[9],M=t[10],I=t[11],p=t[12],B=t[13],R=t[14],P=t[15],m*b-y*x),e=m*A-g*x,i=m*C-v*x,n=y*A-g*b,r=y*C-v*b,s=g*C-v*A,o=w*B-E*p,a=w*R-M*p,u=w*P-I*p,_=E*R-M*B,d=E*P-I*B,f=M*P-I*R,c=t*f-e*d+i*_+n*u-r*a+s*o;if(0==c)return null;var l=h.m;return l[0]=(b*f-A*d+C*_)*(c=1/c),l[1]=(g*d-y*f-v*_)*c,l[2]=(B*s-R*r+P*n)*c,l[3]=(M*r-E*s-I*n)*c,l[4]=(A*u-x*f-C*a)*c,l[5]=(m*f-g*u+v*a)*c,l[6]=(R*i-p*s-P*e)*c,l[7]=(w*s-M*i+I*e)*c,l[8]=(x*d-b*u+C*o)*c,l[9]=(y*u-m*d-v*o)*c,l[10]=(p*r-B*i+P*t)*c,l[11]=(E*i-w*r-I*t)*c,l[12]=(b*a-x*_-A*o)*c,l[13]=(m*_-y*a+g*o)*c,l[14]=(B*e-p*n-R*t)*c,l[15]=(w*n-E*e+M*t)*c,h},n.determinant=function(t){t=t.m;return m=t[0],y=t[1],g=t[2],v=t[3],x=t[4],b=t[5],A=t[6],C=t[7],w=t[8],E=t[9],M=t[10],I=t[11],p=t[12],B=t[13],R=t[14],P=t[15],(m*b-y*x)*(M*P-I*R)-(m*A-g*x)*(E*P-I*B)+(m*C-v*x)*(E*R-M*B)+(y*A-g*b)*(w*P-I*p)-(y*C-v*b)*(w*R-M*p)+(g*C-v*A)*(w*B-E*p)},n.multiply=function(t,e,i){var n=t.m,e=e.m,i=i.m,e=(m=e[0],y=e[1],g=e[2],v=e[3],x=e[4],b=e[5],A=e[6],C=e[7],w=e[8],E=e[9],M=e[10],I=e[11],p=e[12],B=e[13],R=e[14],P=e[15],i[0]),r=i[1],s=i[2],o=i[3];return n[0]=e*m+r*x+s*w+o*p,n[1]=e*y+r*b+s*E+o*B,n[2]=e*g+r*A+s*M+o*R,n[3]=e*v+r*C+s*I+o*P,e=i[4],r=i[5],s=i[6],o=i[7],n[4]=e*m+r*x+s*w+o*p,n[5]=e*y+r*b+s*E+o*B,n[6]=e*g+r*A+s*M+o*R,n[7]=e*v+r*C+s*I+o*P,e=i[8],r=i[9],s=i[10],o=i[11],n[8]=e*m+r*x+s*w+o*p,n[9]=e*y+r*b+s*E+o*B,n[10]=e*g+r*A+s*M+o*R,n[11]=e*v+r*C+s*I+o*P,e=i[12],r=i[13],s=i[14],o=i[15],n[12]=e*m+r*x+s*w+o*p,n[13]=e*y+r*b+s*E+o*B,n[14]=e*g+r*A+s*M+o*R,n[15]=e*v+r*C+s*I+o*P,t},n.transform=function(t,e,i){var n=i.x,r=i.y,i=i.z,s=t.m,o=e.m;return e===t?(s[12]=o[0]*n+o[4]*r+o[8]*i+o[12],s[13]=o[1]*n+o[5]*r+o[9]*i+o[13],s[14]=o[2]*n+o[6]*r+o[10]*i+o[14],s[15]=o[3]*n+o[7]*r+o[11]*i+o[15]):(m=o[0],y=o[1],g=o[2],v=o[3],x=o[4],b=o[5],A=o[6],C=o[7],w=o[8],E=o[9],M=o[10],I=o[11],p=o[12],B=o[13],R=o[14],P=o[15],s[0]=m,s[1]=y,s[2]=g,s[3]=v,s[4]=x,s[5]=b,s[6]=A,s[7]=C,s[8]=w,s[9]=E,s[10]=M,s[11]=I,s[12]=m*n+x*r+w*i+o[12],s[13]=y*n+b*r+E*i+o[13],s[14]=g*n+A*r+M*i+o[14],s[15]=v*n+C*r+I*i+o[15]),t},n.translate=function(t,e,i){var n=t.m,r=e.m;return e===t?(n[12]+=i.x,n[13]+=i.y,n[14]+=i.z):(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]+=i.x,n[13]+=i.y,n[14]+=i.z,n[15]=r[15]),t},n.scale=function(t,e,i){var n=i.x,r=i.y,i=i.z,s=t.m,e=e.m;return s[0]=e[0]*n,s[1]=e[1]*n,s[2]=e[2]*n,s[3]=e[3]*n,s[4]=e[4]*r,s[5]=e[5]*r,s[6]=e[6]*r,s[7]=e[7]*r,s[8]=e[8]*i,s[9]=e[9]*i,s[10]=e[10]*i,s[11]=e[11]*i,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],t},n.rotate=function(h,u,t,e){var i=e.x,n=e.y,e=e.z,r=Math.sqrt(i*i+n*n+e*e);if(Math.abs(r)<S.EPSILON)return null;i*=r=1/r,n*=r,e*=r;var r=Math.sin(t),t=Math.cos(t),s=1-t,o=u.m,a=(m=o[0],y=o[1],g=o[2],v=o[3],x=o[4],b=o[5],A=o[6],C=o[7],w=o[8],E=o[9],M=o[10],I=o[11],i*i*s+t),c=n*i*s+e*r,l=e*i*s-n*r,_=i*n*s-e*r,d=n*n*s+t,f=e*n*s+i*r,p=i*e*s+n*r,n=n*e*s-i*r,i=e*e*s+t,r=h.m;return r[0]=m*a+x*c+w*l,r[1]=y*a+b*c+E*l,r[2]=g*a+A*c+M*l,r[3]=v*a+C*c+I*l,r[4]=m*_+x*d+w*f,r[5]=y*_+b*d+E*f,r[6]=g*_+A*d+M*f,r[7]=v*_+C*d+I*f,r[8]=m*p+x*n+w*i,r[9]=y*p+b*n+E*i,r[10]=g*p+A*n+M*i,r[11]=v*p+C*n+I*i,u!==h&&(r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15]),h},n.rotateX=function(t,e,i){var n=t.m,r=e.m,s=Math.sin(i),i=Math.cos(i),o=r[4],a=r[5],c=r[6],l=r[7],h=r[8],u=r[9],_=r[10],d=r[11];return e!==t&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[4]=o*i+h*s,n[5]=a*i+u*s,n[6]=c*i+_*s,n[7]=l*i+d*s,n[8]=h*i-o*s,n[9]=u*i-a*s,n[10]=_*i-c*s,n[11]=d*i-l*s,t},n.rotateY=function(t,e,i){var n=t.m,r=e.m,s=Math.sin(i),i=Math.cos(i),o=r[0],a=r[1],c=r[2],l=r[3],h=r[8],u=r[9],_=r[10],d=r[11];return e!==t&&(n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=o*i-h*s,n[1]=a*i-u*s,n[2]=c*i-_*s,n[3]=l*i-d*s,n[8]=o*s+h*i,n[9]=a*s+u*i,n[10]=c*s+_*i,n[11]=l*s+d*i,t},n.rotateZ=function(t,e,i){var n=e.m,r=t.m,s=Math.sin(i),i=Math.cos(i),o=e.m[0],a=e.m[1],c=e.m[2],l=e.m[3],h=e.m[4],u=e.m[5],_=e.m[6],d=e.m[7];return e!==t&&(r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=o*i+h*s,r[1]=a*i+u*s,r[2]=c*i+_*s,r[3]=l*i+d*s,r[4]=h*i-o*s,r[5]=u*i-a*s,r[6]=_*i-c*s,r[7]=d*i-l*s,t},n.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,t},n.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e.y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e.z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,t},n.fromRotation=function(t,e,i){var n=i.x,r=i.y,i=i.z,s=Math.sqrt(n*n+r*r+i*i);if(Math.abs(s)<S.EPSILON)return null;n*=s=1/s,r*=s,i*=s;var s=Math.sin(e),e=Math.cos(e),o=1-e,a=t.m;return a[0]=n*n*o+e,a[1]=r*n*o+i*s,a[2]=i*n*o-r*s,a[3]=0,a[4]=n*r*o-i*s,a[5]=r*r*o+e,a[6]=i*r*o+n*s,a[7]=0,a[8]=n*i*o+r*s,a[9]=r*i*o-n*s,a[10]=i*i*o+e,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,t},n.fromXRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=i,n[7]=0,n[8]=0,n[9]=-i,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},n.fromYRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=e,n[1]=0,n[2]=-i,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=i,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},n.fromZRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e),n=t.m;return n[0]=e,n[1]=i,n[2]=0,n[3]=0,n[4]=-i,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},n.fromRT=function(t,e,i){var n=e.x,r=e.y,s=e.z,e=e.w,o=n+n,a=r+r,c=s+s,l=n*o,h=n*a,n=n*c,u=r*a,r=r*c,s=s*c,o=e*o,a=e*a,e=e*c,c=t.m;return c[0]=1-(u+s),c[1]=h+e,c[2]=n-a,c[3]=0,c[4]=h-e,c[5]=1-(l+s),c[6]=r+o,c[7]=0,c[8]=n+a,c[9]=r-o,c[10]=1-(l+u),c[11]=0,c[12]=i.x,c[13]=i.y,c[14]=i.z,c[15]=1,t},n.getTranslation=function(t,e){e=e.m;return t.x=e[12],t.y=e[13],t.z=e[14],t},n.getScaling=function(t,e){var e=e.m,i=d.m,n=i[0]=e[0],r=i[1]=e[1],s=i[2]=e[2],o=i[3]=e[4],a=i[4]=e[5],c=i[5]=e[6],l=i[6]=e[8],h=i[7]=e[9],i=i[8]=e[10];return t.x=Math.sqrt(n*n+r*r+s*s),t.y=Math.sqrt(o*o+a*a+c*c),t.z=Math.sqrt(l*l+h*h+i*i),u.default.determinant(d)<0&&(t.x*=-1),t},n.getRotation=function(t,e){var e=e.m,i=e[0]+e[5]+e[10],n=0;return 0<i?(n=2*Math.sqrt(i+1),t.w=.25*n,t.x=(e[6]-e[9])/n,t.y=(e[8]-e[2])/n,t.z=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t.w=(e[6]-e[9])/n,t.x=.25*n,t.y=(e[1]+e[4])/n,t.z=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t.w=(e[8]-e[2])/n,t.x=(e[1]+e[4])/n,t.y=.25*n,t.z=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t.w=(e[1]-e[4])/n,t.x=(e[8]+e[2])/n,t.y=(e[6]+e[9])/n,t.z=.25*n),t},n.toRTS=function(t,e,i,n){var t=t.m,r=d.m;n.x=o.default.set(_,t[0],t[1],t[2]).mag(),r[0]=t[0]/n.x,r[1]=t[1]/n.x,r[2]=t[2]/n.x,n.y=o.default.set(_,t[4],t[5],t[6]).mag(),r[3]=t[4]/n.y,r[4]=t[5]/n.y,r[5]=t[6]/n.y,n.z=o.default.set(_,t[8],t[9],t[10]).mag(),r[6]=t[8]/n.z,r[7]=t[9]/n.z,r[8]=t[10]/n.z,u.default.determinant(d)<0&&(n.x*=-1,r[0]*=-1,r[1]*=-1,r[2]*=-1),a.default.fromMat3(e,d),o.default.set(i,t[12],t[13],t[14])},n.fromRTS=function(h,t,e,i){var n=t.x,r=t.y,s=t.z,t=t.w,o=n+n,a=r+r,c=s+s,u=n*o,_=n*a,n=n*c,d=r*a,r=r*c,s=s*c,o=t*o,a=t*a,t=t*c,c=i.x,f=i.y,i=i.z,l=h.m;return l[0]=(1-(d+s))*c,l[1]=(_+t)*c,l[2]=(n-a)*c,l[3]=0,l[4]=(_-t)*f,l[5]=(1-(u+s))*f,l[6]=(r+o)*f,l[7]=0,l[8]=(n+a)*i,l[9]=(r-o)*i,l[10]=(1-(u+d))*i,l[11]=0,l[12]=e.x,l[13]=e.y,l[14]=e.z,l[15]=1,h},n.fromRTSOrigin=function(h,t,u,e,i){var n=t.x,r=t.y,s=t.z,t=t.w,o=n+n,a=r+r,c=s+s,_=n*o,d=n*a,n=n*c,f=r*a,r=r*c,s=s*c,o=t*o,a=t*a,t=t*c,c=e.x,p=e.y,e=e.z,m=i.x,y=i.y,i=i.z,l=h.m;return l[0]=(1-(f+s))*c,l[1]=(d+t)*c,l[2]=(n-a)*c,l[3]=0,l[4]=(d-t)*p,l[5]=(1-(_+s))*p,l[6]=(r+o)*p,l[7]=0,l[8]=(n+a)*e,l[9]=(r-o)*e,l[10]=(1-(_+f))*e,l[11]=0,l[12]=u.x+m-(l[0]*m+l[4]*y+l[8]*i),l[13]=u.y+y-(l[1]*m+l[5]*y+l[9]*i),l[14]=u.z+i-(l[2]*m+l[6]*y+l[10]*i),l[15]=1,h},n.fromQuat=function(t,e){var i=e.x,n=e.y,r=e.z,e=e.w,s=i+i,o=n+n,a=r+r,i=i*s,c=n*s,n=n*o,l=r*s,h=r*o,r=r*a,s=e*s,o=e*o,e=e*a,a=t.m;return a[0]=1-n-r,a[1]=c+e,a[2]=l-o,a[3]=0,a[4]=c-e,a[5]=1-i-r,a[6]=h+s,a[7]=0,a[8]=l+o,a[9]=h-s,a[10]=1-i-n,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,t},n.frustum=function(t,e,i,n,r,s,o){var a=1/(i-e),c=1/(r-n),h=1/(s-o),l=t.m;return l[0]=2*s*a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*s*c,l[6]=0,l[7]=0,l[8]=(i+e)*a,l[9]=(r+n)*c,l[10]=(o+s)*h,l[11]=-1,l[12]=0,l[13]=0,l[14]=o*s*2*h,l[15]=0,t},n.perspective=function(t,e,i,n,r){var e=1/Math.tan(e/2),s=1/(n-r),o=t.m;return o[0]=e/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+n)*s,o[11]=-1,o[12]=0,o[13]=0,o[14]=2*r*n*s,o[15]=0,t},n.ortho=function(t,e,i,n,r,s,o){var a=1/(e-i),c=1/(n-r),h=1/(s-o),l=t.m;return l[0]=-2*a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*c,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*h,l[11]=0,l[12]=(e+i)*a,l[13]=(r+n)*c,l[14]=(o+s)*h,l[15]=1,t},n.lookAt=function(h,t,e,i){var n=t.x,u=t.y,t=t.z,r=i.x,_=i.y,i=i.z,s=n-e.x,o=u-e.y,e=t-e.z,a=1/Math.sqrt(s*s+o*o+e*e),c=_*(e*=a)-i*(o*=a),i=i*(s*=a)-r*e,r=r*o-_*s,_=(c*=a=1/Math.sqrt(c*c+i*i+r*r),o*(r*=a)-e*(i*=a)),a=e*c-s*r,d=s*i-o*c,l=h.m;return l[0]=c,l[1]=_,l[2]=s,l[3]=0,l[4]=i,l[5]=a,l[6]=o,l[7]=0,l[8]=r,l[9]=d,l[10]=e,l[11]=0,l[12]=-(c*n+i*u+r*t),l[13]=-(_*n+a*u+d*t),l[14]=-(s*n+o*u+e*t),l[15]=1,h},n.inverseTranspose=function(h,t){var t=t.m,u=(m=t[0],y=t[1],g=t[2],v=t[3],x=t[4],b=t[5],A=t[6],C=t[7],w=t[8],E=t[9],M=t[10],I=t[11],p=t[12],B=t[13],R=t[14],P=t[15],m*b-y*x),_=m*A-g*x,e=m*C-v*x,d=y*A-g*b,i=y*C-v*b,n=g*C-v*A,r=w*B-E*p,s=w*R-M*p,o=w*P-I*p,f=E*R-M*B,a=E*P-I*B,c=M*P-I*R,l=u*c-_*a+e*f+d*o-i*s+n*r;return l?((t=h.m)[0]=(b*c-A*a+C*f)*(l=1/l),t[1]=(A*o-x*c-C*s)*l,t[2]=(x*a-b*o+C*r)*l,t[3]=0,t[4]=(g*a-y*c-v*f)*l,t[5]=(m*c-g*o+v*s)*l,t[6]=(y*o-m*a-v*r)*l,t[7]=0,t[8]=(B*n-R*i+P*d)*l,t[9]=(R*e-p*n-P*_)*l,t[10]=(p*i-B*e+P*u)*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,h):null},n.add=function(t,e,i){var n=t.m,e=e.m,i=i.m;return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n[3]=e[3]+i[3],n[4]=e[4]+i[4],n[5]=e[5]+i[5],n[6]=e[6]+i[6],n[7]=e[7]+i[7],n[8]=e[8]+i[8],n[9]=e[9]+i[9],n[10]=e[10]+i[10],n[11]=e[11]+i[11],n[12]=e[12]+i[12],n[13]=e[13]+i[13],n[14]=e[14]+i[14],n[15]=e[15]+i[15],t},n.subtract=function(t,e,i){var n=t.m,e=e.m,i=i.m;return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n[3]=e[3]-i[3],n[4]=e[4]-i[4],n[5]=e[5]-i[5],n[6]=e[6]-i[6],n[7]=e[7]-i[7],n[8]=e[8]-i[8],n[9]=e[9]-i[9],n[10]=e[10]-i[10],n[11]=e[11]-i[11],n[12]=e[12]-i[12],n[13]=e[13]-i[13],n[14]=e[14]-i[14],n[15]=e[15]-i[15],t},n.multiplyScalar=function(t,e,i){var n=t.m,e=e.m;return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*i,n[9]=e[9]*i,n[10]=e[10]*i,n[11]=e[11]*i,n[12]=e[12]*i,n[13]=e[13]*i,n[14]=e[14]*i,n[15]=e[15]*i,t},n.multiplyScalarAndAdd=function(t,e,i,n){var r=t.m,e=e.m,i=i.m;return r[0]=e[0]+i[0]*n,r[1]=e[1]+i[1]*n,r[2]=e[2]+i[2]*n,r[3]=e[3]+i[3]*n,r[4]=e[4]+i[4]*n,r[5]=e[5]+i[5]*n,r[6]=e[6]+i[6]*n,r[7]=e[7]+i[7]*n,r[8]=e[8]+i[8]*n,r[9]=e[9]+i[9]*n,r[10]=e[10]+i[10]*n,r[11]=e[11]+i[11]*n,r[12]=e[12]+i[12]*n,r[13]=e[13]+i[13]*n,r[14]=e[14]+i[14]*n,r[15]=e[15]+i[15]*n,t},n.strictEquals=function(t,e){t=t.m,e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},n.equals=function(t,e,i){void 0===i&&(i=S.EPSILON);t=t.m,e=e.m;return Math.abs(t[0]-e[0])<=i*Math.max(1,Math.abs(t[0]),Math.abs(e[0]))&&Math.abs(t[1]-e[1])<=i*Math.max(1,Math.abs(t[1]),Math.abs(e[1]))&&Math.abs(t[2]-e[2])<=i*Math.max(1,Math.abs(t[2]),Math.abs(e[2]))&&Math.abs(t[3]-e[3])<=i*Math.max(1,Math.abs(t[3]),Math.abs(e[3]))&&Math.abs(t[4]-e[4])<=i*Math.max(1,Math.abs(t[4]),Math.abs(e[4]))&&Math.abs(t[5]-e[5])<=i*Math.max(1,Math.abs(t[5]),Math.abs(e[5]))&&Math.abs(t[6]-e[6])<=i*Math.max(1,Math.abs(t[6]),Math.abs(e[6]))&&Math.abs(t[7]-e[7])<=i*Math.max(1,Math.abs(t[7]),Math.abs(e[7]))&&Math.abs(t[8]-e[8])<=i*Math.max(1,Math.abs(t[8]),Math.abs(e[8]))&&Math.abs(t[9]-e[9])<=i*Math.max(1,Math.abs(t[9]),Math.abs(e[9]))&&Math.abs(t[10]-e[10])<=i*Math.max(1,Math.abs(t[10]),Math.abs(e[10]))&&Math.abs(t[11]-e[11])<=i*Math.max(1,Math.abs(t[11]),Math.abs(e[11]))&&Math.abs(t[12]-e[12])<=i*Math.max(1,Math.abs(t[12]),Math.abs(e[12]))&&Math.abs(t[13]-e[13])<=i*Math.max(1,Math.abs(t[13]),Math.abs(e[13]))&&Math.abs(t[14]-e[14])<=i*Math.max(1,Math.abs(t[14]),Math.abs(e[14]))&&Math.abs(t[15]-e[15])<=i*Math.max(1,Math.abs(t[15]),Math.abs(e[15]))},n.adjoint=function(h,t){var t=t.m,e=h.m,u=t[0],i=t[1],n=t[2],r=t[3],_=t[4],d=t[5],s=t[6],o=t[7],f=t[8],p=t[9],a=t[10],c=t[11],m=t[12],y=t[13],l=t[14],t=t[15];return e[0]=d*(a*t-c*l)-p*(s*t-o*l)+y*(s*c-o*a),e[1]=-(i*(a*t-c*l)-p*(n*t-r*l)+y*(n*c-r*a)),e[2]=i*(s*t-o*l)-d*(n*t-r*l)+y*(n*o-r*s),e[3]=-(i*(s*c-o*a)-d*(n*c-r*a)+p*(n*o-r*s)),e[4]=-(_*(a*t-c*l)-f*(s*t-o*l)+m*(s*c-o*a)),e[5]=u*(a*t-c*l)-f*(n*t-r*l)+m*(n*c-r*a),e[6]=-(u*(s*t-o*l)-_*(n*t-r*l)+m*(n*o-r*s)),e[7]=u*(s*c-o*a)-_*(n*c-r*a)+f*(n*o-r*s),e[8]=_*(p*t-c*y)-f*(d*t-o*y)+m*(d*c-o*p),e[9]=-(u*(p*t-c*y)-f*(i*t-r*y)+m*(i*c-r*p)),e[10]=u*(d*t-o*y)-_*(i*t-r*y)+m*(i*o-r*d),e[11]=-(u*(d*c-o*p)-_*(i*c-r*p)+f*(i*o-r*d)),e[12]=-(_*(p*l-a*y)-f*(d*l-s*y)+m*(d*a-s*p)),e[13]=u*(p*l-a*y)-f*(i*l-n*y)+m*(i*a-n*p),e[14]=-(u*(d*l-s*y)-_*(i*l-n*y)+m*(i*s-n*d)),e[15]=u*(d*a-s*p)-_*(i*a-n*p)+f*(i*s-n*d),h},n.toArray=function(t,e,i){void 0===i&&(i=0);for(var n=e.m,r=0;r<16;r++)t[i+r]=n[r];return t},n.fromArray=function(t,e,i){void 0===i&&(i=0);for(var n=t.m,r=0;r<16;r++)n[r]=e[i+r];return t},t.clone=function(){var t=this.m;return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},t.set=function(t){var e=this.m,t=t.m;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},t.equals=function(t){return n.strictEquals(this,t)},t.fuzzyEquals=function(t){return n.equals(this,t)},t.toString=function(){var t=this.m;return t?"[\n"+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+",\n"+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+",\n"+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+",\n"+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"\n]":"[\n1, 0, 0, 0\n0, 1, 0, 0\n0, 0, 1, 0\n0, 0, 0, 1\n]"},t.identity=function(){return n.identity(this)},t.transpose=function(t){return t=t||new n,n.transpose(t,this)},t.invert=function(t){return t=t||new n,n.invert(t,this)},t.adjoint=function(t){return t=t||new n,n.adjoint(t,this)},t.determinant=function(){return n.determinant(this)},t.add=function(t,e){return e=e||new n,n.add(e,this,t)},t.subtract=function(t){return n.subtract(this,this,t)},t.multiply=function(t){return n.multiply(this,this,t)},t.multiplyScalar=function(t){return n.multiplyScalar(this,this,t)},t.translate=function(t,e){return e=e||new n,n.translate(e,this,t)},t.scale=function(t,e){return e=e||new n,n.scale(e,this,t)},t.rotate=function(t,e,i){return i=i||new n,n.rotate(i,this,t,e)},t.getTranslation=function(t){return t=t||new o.default,n.getTranslation(t,this)},t.getScale=function(t){return t=t||new o.default,n.getScaling(t,this)},t.getRotation=function(t){return t=t||new a.default,n.getRotation(t,this)},t.fromRTS=function(t,e,i){return n.fromRTS(this,t,e,i)},t.fromQuat=function(t){return n.fromQuat(this,t)},n);function n(t,e,i,n,r,s,o,a,h,u,_,d,f,p,m,y){var c,l;return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===_&&(_=1),void 0===d&&(d=0),void 0===f&&(f=0),void 0===p&&(p=0),void 0===m&&(m=0),void 0===y&&(y=1),(c=T.call(this)||this).m=void 0,t instanceof S.FLOAT_ARRAY_TYPE?c.m=t:(c.m=new S.FLOAT_ARRAY_TYPE(16),(l=c.m)[0]=t,l[1]=e,l[2]=i,l[3]=n,l[4]=r,l[5]=s,l[6]=o,l[7]=a,l[8]=h,l[9]=u,l[10]=_,l[11]=d,l[12]=f,l[13]=p,l[14]=m,l[15]=y),c}(r.default=D).mul=D.multiply,D.sub=D.subtract,D.IDENTITY=Object.freeze(new D);for(var _=new o.default,d=new u.default,f=(s.default.fastDefine("cc.Mat4",D,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),0);f<16;f++)!function(e){Object.defineProperty(D.prototype,"m"+e,{get:function(){return this.m[e]},set:function(t){this.m[e]=t}})}(f);cc.mat4=function(t,e,i,n,r,s,o,a,c,l,h,u,_,d,f,p){e=new D(t,e,i,n,r,s,o,a,c,l,h,u,_,d,f,p);return void 0===t&&D.identity(e),e},cc.Mat4=D,i.exports=r.default},{"../platform/CCClass":189,"./mat3":280,"./quat":282,"./utils":286,"./value-type":287,"./vec3":289}],282:[function(t,l,e){"use strict";e.__esModule=!0,e.default=void 0;var i=n(t("./value-type")),h=n(t("../platform/CCClass")),r=n(t("./vec3")),u=n(t("./mat3")),_=t("./utils");function n(t){return t&&t.__esModule?t:{default:t}}function d(i){return function(){var t,e=f(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=f(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}v=i.default,t=v,(i=o).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,d(o),(i=o.prototype).mul=function(t,e){return o.multiply(e||new o,this,t)},o.clone=function(t){return new o(t.x,t.y,t.z,t.w)},o.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},o.set=function(t,e,i,n,r){return t.x=e,t.y=i,t.z=n,t.w=r,t},o.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},o.rotationTo=function(t,e,i){var n=r.default.dot(e,i);return n<-.999999?(r.default.cross(c,r.default.RIGHT,e),c.mag()<1e-6&&r.default.cross(c,r.default.UP,e),r.default.normalize(c,c),o.fromAxisAngle(t,c,Math.PI),t):.999999<n?(t.x=0,t.y=0,t.z=0,t.w=1,t):(r.default.cross(c,e,i),t.x=c.x,t.y=c.y,t.z=c.z,t.w=1+n,o.normalize(t,t))},o.getAxisAngle=function(t,e){var i=2*Math.acos(e.w),n=Math.sin(i/2);return 0!==n?(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n):(t.x=1,t.y=0,t.z=0),i},o.multiply=function(t,e,i){return p=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,m=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,y=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,g=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z,t.x=p,t.y=m,t.z=y,t.w=g,t},o.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},o.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t.w=e.w+i.w*n,t},o.rotateX=function(t,e,i){i*=.5;var n=Math.sin(i),i=Math.cos(i);return t.x=e.x*i+e.w*n,t.y=e.y*i+e.z*n,t.z=e.z*i-e.y*n,t.w=e.w*i-e.x*n,t},o.rotateY=function(t,e,i){i*=.5;var n=Math.sin(i),i=Math.cos(i);return t.x=e.x*i-e.z*n,t.y=e.y*i+e.w*n,t.z=e.z*i+e.x*n,t.w=e.w*i-e.y*n,t},o.rotateZ=function(t,e,i){i*=.5;var n=Math.sin(i),i=Math.cos(i);return t.x=e.x*i+e.y*n,t.y=e.y*i-e.x*n,t.z=e.z*i+e.w*n,t.w=e.w*i-e.z*n,t},o.rotateAround=function(t,e,i,n){return o.invert(a,e),r.default.transformQuat(c,i,a),o.fromAxisAngle(a,c,n),o.multiply(t,e,a),t},o.rotateAroundLocal=function(t,e,i,n){return o.fromAxisAngle(a,i,n),o.multiply(t,e,a),t},o.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},o.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},o.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t.w=e.w+n*(i.w-e.w),t},o.slerp=function(t,e,i,n){var r,s=0,o=0,a=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;return a<0&&(a=-a,i.x=-i.x,i.y=-i.y,i.z=-i.z,i.w=-i.w),o=1e-6<1-a?(a=Math.acos(a),r=Math.sin(a),s=Math.sin((1-n)*a)/r,Math.sin(n*a)/r):(s=1-n,n),t.x=s*e.x+o*i.x,t.y=s*e.y+o*i.y,t.z=s*e.z+o*i.z,t.w=s*e.w+o*i.w,t},o.sqlerp=function(t,e,i,n,r,s){return o.slerp(a,e,r,s),o.slerp(x,i,n,s),o.slerp(t,a,x,2*s*(1-s)),t},o.invert=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,i=i?1/i:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t},o.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},o.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},o.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},o.normalize=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return 0<i&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i),t},o.fromAxes=function(t,e,i,n){return u.default.set(b,e.x,e.y,e.z,i.x,i.y,i.z,n.x,n.y,n.z),o.normalize(t,o.fromMat3(t,b))},o.fromViewUp=function(t,e,i){return u.default.fromViewUp(b,e,i),o.normalize(t,o.fromMat3(t,b))},o.fromAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t.x=n*e.x,t.y=n*e.y,t.z=n*e.z,t.w=Math.cos(i),t},o.fromAngleZ=function(t,e){return e*=A,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},o.fromMat3=function(t,e){var e=e.m,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],h=e[7],e=e[8],l=i+o+e;return 0<l?(l=.5/Math.sqrt(l+1),t.w=.25/l,t.x=(a-h)*l,t.y=(c-r)*l,t.z=(n-s)*l):o<i&&e<i?(l=2*Math.sqrt(1+i-o-e),t.w=(a-h)/l,t.x=.25*l,t.y=(s+n)/l,t.z=(c+r)/l):e<o?(l=2*Math.sqrt(1+o-i-e),t.w=(c-r)/l,t.x=(s+n)/l,t.y=.25*l,t.z=(h+a)/l):(l=2*Math.sqrt(1+e-i-o),t.w=(n-s)/l,t.x=(c+r)/l,t.y=(h+a)/l,t.z=.25*l),t},o.fromEuler=function(t,e,i,n){e*=A,i*=A,n*=A;var r=Math.sin(e),e=Math.cos(e),s=Math.sin(i),i=Math.cos(i),o=Math.sin(n),n=Math.cos(n);return t.x=r*i*n+e*s*o,t.y=e*s*n+r*i*o,t.z=e*i*o-r*s*n,t.w=e*i*n-r*s*o,t},o.toAxisX=function(t,e){var i=2*e.y,n=2*e.z;return t.x=1-i*e.y-n*e.z,t.y=i*e.x+n*e.w,t.z=n*e.x+i*e.w,t},o.toAxisY=function(t,e){var i=2*e.x,n=2*e.y,r=2*e.z;return t.x=n*e.x-r*e.w,t.y=1-i*e.x-r*e.z,t.z=r*e.y+i*e.w,t},o.toAxisZ=function(t,e){var i=2*e.x,n=2*e.y,r=2*e.z;return t.x=r*e.x-n*e.w,t.y=r*e.y-i*e.w,t.z=1-i*e.x-n*e.y,t},o.toEuler=function(t,e,h){var u,i,n=e.x,r=e.y,s=e.z,e=e.w,o=0,a=0,c=0,l=n*r+s*e;return.499999<l?(a=(o=0,_.toDegree)(2*Math.atan2(n,e)),c=90):l<-.499999?(a=-(o=0,_.toDegree)(2*Math.atan2(n,e)),c=-90):(u=r*r,i=s*s,o=(0,_.toDegree)(Math.atan2(2*n*e-2*r*s,1-2*(n*n)-2*i)),a=(0,_.toDegree)(Math.atan2(2*r*e-2*n*s,1-2*u-2*i)),c=(0,_.toDegree)(Math.asin(2*l)),h&&(o=-180*Math.sign(o+1e-6)+o,a=-180*Math.sign(a+1e-6)+a,c=180*Math.sign(c+1e-6)-c)),t.x=o,t.y=a,t.z=c,t},o.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},o.equals=function(t,e,i){return void 0===i&&(i=_.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))},o.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},o.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},i.clone=function(){return new o(this.x,this.y,this.z,this.w)},i.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.toEuler=function(t){return o.toEuler(t,this)},i.fromEuler=function(t){return o.fromEuler(this,t.x,t.y,t.z)},i.lerp=function(t,e,i){return i=i||new o,o.slerp(i,this,t,e),i},i.multiply=function(t){return o.multiply(this,this,t)},i.rotateAround=function(t,e,i,n){return n=n||new o,o.rotateAround(n,t,e,i)};var p,m,y,g,v,s=o;function o(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),(r=v.call(this)||this).x=void 0,r.y=void 0,r.z=void 0,r.w=void 0,t&&"object"==typeof t?(r.z=t.z,r.y=t.y,r.w=t.w,r.x=t.x):(r.x=t,r.y=e,r.z=i,r.w=n),r}(e.default=s).mul=s.multiply,s.scale=s.multiplyScalar,s.mag=s.len,s.IDENTITY=Object.freeze(new s);var a=new s,x=new s,c=new r.default,b=new u.default,A=.5*Math.PI/180;h.default.fastDefine("cc.Quat",s,{x:0,y:0,z:0,w:1}),cc.quat=function(t,e,i,n){return new s(t,e,i,n)},cc.Quat=s,l.exports=e.default},{"../platform/CCClass":189,"./mat3":280,"./utils":286,"./value-type":287,"./vec3":289}],283:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=s(t("./value-type")),r=s(t("../platform/CCClass")),o=s(t("./vec2")),h=s(t("./size"));function s(t){return t&&t.__esModule?t:{default:t}}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(i){return function(){var t,e=a(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=function(s){t=s,(i=a).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,u(a);function a(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),(r=s.call(this)||this).x=void 0,r.y=void 0,r.width=void 0,r.height=void 0,t&&"object"==typeof t&&(e=t.y,i=t.width,n=t.height,t=t.x),r.x=t||0,r.y=e||0,r.width=i||0,r.height=n||0,r}a.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y);return new a(i,n,Math.max(t.x,e.x)-i,Math.max(t.y,e.y)-n)};var t,e,i=a.prototype;return i.clone=function(){return new a(this.x,this.y,this.width,this.height)},i.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},i.lerp=function(t,e,i){i=i||new a;var n=this.x,r=this.y,s=this.width,o=this.height;return i.x=n+(t.x-n)*e,i.y=r+(t.y-r)*e,i.width=s+(t.width-s)*e,i.height=o+(t.height-o)*e,i},i.set=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},i.intersects=function(t){var e=this.x+this.width,i=this.y+this.height,n=t.x+t.width,r=t.y+t.height;return!(e<t.x||n<this.x||i<t.y||r<this.y)},i.intersection=function(t,e){var i=this.x,n=this.y,r=this.x+this.width,s=this.y+this.height,o=e.x,a=e.y,c=e.x+e.width,e=e.y+e.height;return t.x=Math.max(i,o),t.y=Math.max(n,a),t.width=Math.min(r,c)-t.x,t.height=Math.min(s,e)-t.y,t},i.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},i.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},i.union=function(t,e){var i=this.x,n=this.y,r=this.width,s=this.height,o=e.x,a=e.y,c=e.width,e=e.height;return t.x=Math.min(i,o),t.y=Math.min(n,a),t.width=Math.max(i+r,o+c)-t.x,t.height=Math.max(n+s,a+e)-t.y,t},i.transformMat4=function(t,e){var i=this.x,n=this.y,r=i+this.width,s=n+this.height,e=e.m,o=e[0]*i+e[4]*n+e[12],a=e[1]*i+e[5]*n+e[13],c=e[0]*r+e[4]*n+e[12],n=e[1]*r+e[5]*n+e[13],l=e[0]*i+e[4]*s+e[12],i=e[1]*i+e[5]*s+e[13],h=e[0]*r+e[4]*s+e[12],r=e[1]*r+e[5]*s+e[13],s=Math.min(o,c,l,h),e=Math.max(o,c,l,h),o=Math.min(a,n,i,r),c=Math.max(a,n,i,r);return t.x=s,t.y=o,t.width=e-s,t.height=c-o,t},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},t=a,(i=[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new o.default(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new o.default(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new h.default(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}])&&c(t.prototype,i),e&&c(t,e),a}(n.default);i.default=l,r.default.fastDefine("cc.Rect",l,{x:0,y:0,width:0,height:0}),cc.Rect=l,cc.rect=function(t,e,i,n){return new l(t,e,i,n)},e.exports=i.default},{"../platform/CCClass":189,"./size":284,"./value-type":287,"./vec2":288}],284:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=r(t("./value-type")),t=r(t("../platform/CCClass"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=function(n){var t,e;e=n,(t=s).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e,a(s);function s(t,e){var i;return void 0===t&&(t=0),void 0===e&&(e=0),(i=n.call(this)||this).width=void 0,i.height=void 0,t&&"object"==typeof t?(i.height=t.height,i.width=t.width):(i.width=t||0,i.height=e||0),i}t=s,e=[{key:"ZERO",get:function(){return new s}}],(i=null)&&o(t.prototype,i),e&&o(t,e);var i=s.prototype;return i.clone=function(){return new s(this.width,this.height)},i.equals=function(t){return t&&this.width===t.width&&this.height===t.height},i.lerp=function(t,e,i){i=i||new s;var n=this.width,r=this.height;return i.width=n+(t.width-n)*e,i.height=r+(t.height-r)*e,i},i.set=function(t){return this.width=t.width,this.height=t.height,this},i.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},s}(n.default);(i.default=c).ZERO_R=c.ZERO,t.default.fastDefine("cc.Size",c,{width:0,height:0}),cc.size=function(t,e){return new c(t,e)},cc.Size=c,e.exports=i.default},{"../platform/CCClass":189,"./value-type":287}],285:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("./quat"))&&t.__esModule?t:{default:t};var s=new r.default,t=(o.toRotation=function(t,e){return t.x=e[3],t.y=e[4],t.z=e[5],t.w=e[6],t},o.fromRotation=function(t,e){return t[3]=e.x,t[4]=e.y,t[5]=e.z,t[6]=e.w,t},o.toEuler=function(t,e){return o.toRotation(s,e),r.default.toEuler(t,s),t},o.fromEuler=function(t,e){return r.default.fromEuler(s,e.x,e.y,e.z),o.fromRotation(t,s),t},o.fromEulerNumber=function(t,e,i,n){return r.default.fromEuler(s,e,i,n),o.fromRotation(t,s),t},o.toScale=function(t,e){return t.x=e[7],t.y=e[8],t.z=e[9],t},o.fromScale=function(t,e){return t[7]=e.x,t[8]=e.y,t[9]=e.z,t},o.toPosition=function(t,e){return t.x=e[0],t.y=e[1],t.z=e[2],t},o.fromPosition=function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t},o.fromAngleZ=function(t,e){return r.default.fromAngleZ(s,e),o.fromRotation(t,s),t},o.toMat4=function(h,t){var e=t[3],i=t[4],n=t[5],r=t[6],s=e+e,o=i+i,a=n+n,u=e*s,_=e*o,e=e*a,d=i*o,i=i*a,n=n*a,s=r*s,o=r*o,r=r*a,a=t[7],c=t[8],f=t[9],l=h.m;return l[0]=(1-(d+n))*a,l[1]=(_+r)*a,l[2]=(e-o)*a,l[3]=0,l[4]=(_-r)*c,l[5]=(1-(u+n))*c,l[6]=(i+s)*c,l[7]=0,l[8]=(e+o)*f,l[9]=(i-s)*f,l[10]=(1-(u+d))*f,l[11]=0,l[12]=t[0],l[13]=t[1],l[14]=t[2],l[15]=1,h},o);function o(){}i.default=t,cc.Trs=t,e.exports=i.default},{"./quat":282}],286:[function(l,h,t){"use strict";t.__esModule=!0,t.equals=function(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))},t.approx=function(t,e,i){return i=i||n,Math.abs(t-e)<=i},t.clamp=function(t,e,i){return t<e?e:i<t?i:t},t.clamp01=function(t){return t<0?0:1<t?1:t},t.lerp=function(t,e,i){return t+(e-t)*i},t.toRadian=function(t){return t*e},t.toDegree=function(t){return t*i},t.randomRange=s,t.randomRangeInt=function(t,e){return Math.floor(s(t,e))},t.pseudoRandom=o,t.pseudoRandomRange=a,t.pseudoRandomRangeInt=function(t,e,i){return Math.floor(a(t,e,i))},t.nextPow2=function(t){return--t,t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16,++t},t.repeat=c,t.pingPong=function(t,e){return t=c(t,2*e),t=e-Math.abs(t-e)},t.inverseLerp=function(t,e,i){return(i-t)/(e-t)},t.sign=function(t){return(0<t)-(t<0)},t.random=t.FLOAT_BYTES=t.FLOAT_ARRAY_TYPE=t.INT_MIN=t.INT_MAX=t.INT_BITS=t.EPSILON=void 0;var e=Math.PI/180,i=180/Math.PI,n=1e-6,r=(t.EPSILON=n,t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,Float64Array);t.FLOAT_ARRAY_TYPE=r;t.FLOAT_BYTES=8;r=Math.random;function s(t,e){return Math.random()*(e-t)+t}function o(t){return(t=(9301*t+49297)%233280)/233280}function a(t,e,i){return o(t)*(i-e)+e}function c(t,e){return t-Math.floor(t/e)*e}t.random=r},{}],287:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("../platform/js"))&&t.__esModule?t:{default:t};(t=r.prototype).clone=function(){return cc.errorID("0100",n.default.getClassName(this)+".clone"),null},t.equals=function(t){return cc.errorID("0100",n.default.getClassName(this)+".equals"),!1},t.lerp=function(t,e){return cc.errorID("0100",n.default.getClassName(this)+".lerp"),this.clone()},t.set=function(t){cc.errorID("0100",n.default.getClassName(this)+".set")},t.toString=function(){return""+{}};t=r;function r(){}i.default=t,n.default.setClassName("cc.ValueType",t),cc.ValueType=t,e.exports=i.default},{"../platform/js":209}],288:[function(t,h,e){"use strict";e.__esModule=!0,e.default=void 0;var i=s(t("./value-type")),u=s(t("../platform/CCClass")),n=s(t("../utils/misc")),r=t("./utils");function s(t){return t&&t.__esModule?t:{default:t}}function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(i){return function(){var t,e=f(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=f(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p,m,y,o=0,a=0,c=(p=i.default,t=p,(i=l).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,d(l),(i=l.prototype).sub=function(t,e){return l.subtract(e||new l,this,t)},i.mul=function(t,e){return l.multiplyScalar(e||new l,this,t)},i.div=function(t,e){return l.multiplyScalar(e||new l,this,1/t)},i.scale=function(t,e){return l.multiply(e||new l,this,t)},i.neg=function(t){return l.negate(t||new l,this)},l.clone=function(t){return new l(t.x,t.y)},l.copy=function(t,e){return t.x=e.x,t.y=e.y,t},l.set=function(t,e,i){return t.x=e,t.y=i,t},l.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},l.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},l.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t},l.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t},l.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},l.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},l.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t},l.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t},l.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},l.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},l.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t},l.distance=function(t,e){return o=e.x-t.x,a=e.y-t.y,Math.sqrt(o*o+a*a)},l.squaredDistance=function(t,e){return o=e.x-t.x,a=e.y-t.y,o*o+a*a},l.len=function(t){return o=t.x,a=t.y,Math.sqrt(o*o+a*a)},l.lengthSqr=function(t){return o=t.x,a=t.y,o*o+a*a},l.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},l.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},l.inverseSafe=function(t,e){return o=e.x,a=e.y,Math.abs(o)<r.EPSILON?t.x=0:t.x=1/o,Math.abs(a)<r.EPSILON?t.y=0:t.y=1/a,t},l.normalize=function(t,e){o=e.x,a=e.y;e=o*o+a*a;return 0<e&&(e=1/Math.sqrt(e),t.x=o*e,t.y=a*e),t},l.dot=function(t,e){return t.x*e.x+t.y*e.y},l.cross=function(t,e,i){return t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t},l.lerp=function(t,e,i,n){return o=e.x,a=e.y,t.x=o+n*(i.x-o),t.y=a+n*(i.y-a),t},l.random=function(t,e){e=e||1;var i=2*(0,r.random)()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t},l.transformMat3=function(t,e,i){o=e.x,a=e.y;e=i.m;return t.x=e[0]*o+e[3]*a+e[6],t.y=e[1]*o+e[4]*a+e[7],t},l.transformMat4=function(t,e,i){o=e.x,a=e.y;e=i.m;return t.x=e[0]*o+e[4]*a+e[12],t.y=e[1]*o+e[5]*a+e[13],t},l.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},l.equals=function(t,e,i){return void 0===i&&(i=r.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))},l.angle=function(t,e){l.normalize(g,t),l.normalize(v,e);t=l.dot(g,v);return 1<t?0:t<-1?Math.PI:Math.acos(t)},l.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t},l.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t},t=l,y=[{key:"ONE",get:function(){return new l(1,1)}},{key:"ZERO",get:function(){return new l(0,0)}},{key:"UP",get:function(){return new l(0,1)}},{key:"RIGHT",get:function(){return new l(1,0)}}],(m=null)&&_(t.prototype,m),y&&_(t,y),i.clone=function(){return new l(this.x,this.y)},i.set=function(t){return this.x=t.x,this.y=t.y,this},i.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},i.lerp=function(t,e,i){i=i||new l;var n=this.x,r=this.y;return i.x=n+(t.x-n)*e,i.y=r+(t.y-r)*e,i},i.clampf=function(t,e){return this.x=n.default.clampf(this.x,t.x,e.x),this.y=n.default.clampf(this.y,t.y,e.y),this},i.add=function(t,e){return(e=e||new l).x=this.x+t.x,e.y=this.y+t.y,e},i.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},i.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},i.divide=function(t){return this.x/=t,this.y/=t,this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.dot=function(t){return this.x*t.x+this.y*t.y},i.cross=function(t){return this.x*t.y-this.y*t.x},i.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y},i.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1==t)return this;if(0==t)return this;t=1/Math.sqrt(t);return this.x*=t,this.y*=t,this},i.normalize=function(t){return(t=t||new l).x=this.x,t.y=this.y,t.normalizeSelf(),t},i.angle=function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;t=this.dot(t)/Math.sqrt(e*i),t=n.default.clampf(t,-1,1);return Math.acos(t)},i.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},i.rotate=function(t,e){return(e=e||new l).x=this.x,e.y=this.y,e.rotateSelf(t)},i.rotateSelf=function(t){var e=Math.sin(t),t=Math.cos(t),i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this},i.project=function(t){return t.multiplyScalar(this.dot(t)/t.dot(t))},i.transformMat4=function(t,e){return e=e||new l,l.transformMat4(e,this,t),e},i.maxAxis=function(){return Math.max(this.x,this.y)},l);function l(t,e){var i;return void 0===t&&(t=0),void 0===e&&(e=0),(i=p.call(this)||this).mag=l.prototype.len,i.magSqr=l.prototype.lengthSqr,i.subSelf=l.prototype.subtract,i.mulSelf=l.prototype.multiplyScalar,i.divSelf=l.prototype.divide,i.scaleSelf=l.prototype.multiply,i.negSelf=l.prototype.negate,i.x=void 0,i.y=void 0,i.z=0,t&&"object"==typeof t?(i.y=t.y||0,i.x=t.x||0):(i.x=t||0,i.y=e||0),i}(e.default=c).sub=c.subtract,c.mul=c.multiply,c.scale=c.multiplyScalar,c.mag=c.len,c.squaredMagnitude=c.lengthSqr,c.div=c.divide,c.ONE_R=c.ONE,c.ZERO_R=c.ZERO,c.UP_R=c.UP,c.RIGHT_R=c.RIGHT;var g=new c,v=new c;u.default.fastDefine("cc.Vec2",c,{x:0,y:0}),cc.v2=function(t,e){return new c(t,e)},cc.Vec2=c,h.exports=e.default},{"../platform/CCClass":189,"../utils/misc":264,"./utils":286,"./value-type":287}],289:[function(t,h,e){"use strict";e.__esModule=!0,e.default=void 0;var i=d(t("./value-type")),u=d(t("../platform/CCClass")),_=d(t("../utils/misc")),r=d(t("./vec2")),a=t("./utils");function d(t){return t&&t.__esModule?t:{default:t}}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(i){return function(){var t,e=m(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=m(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y,g,v,o=0,c=0,l=0,n=(y=i.default,t=y,(i=s).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,p(s),(i=s.prototype).sub=function(t,e){return s.subtract(e||new s,this,t)},i.mul=function(t,e){return s.multiplyScalar(e||new s,this,t)},i.div=function(t,e){return s.multiplyScalar(e||new s,this,1/t)},i.scale=function(t,e){return s.multiply(e||new s,this,t)},i.neg=function(t){return s.negate(t||new s,this)},s.zero=function(t){return t.x=0,t.y=0,t.z=0,t},s.clone=function(t){return new s(t.x,t.y,t.z)},s.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},s.set=function(t,e,i,n){return t.x=e,t.y=i,t.z=n,t},s.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t},s.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t},s.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t},s.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t},s.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},s.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},s.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t},s.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t},s.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},s.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t},s.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t},s.distance=function(t,e){return o=e.x-t.x,c=e.y-t.y,l=e.z-t.z,Math.sqrt(o*o+c*c+l*l)},s.squaredDistance=function(t,e){return o=e.x-t.x,c=e.y-t.y,l=e.z-t.z,o*o+c*c+l*l},s.len=function(t){return o=t.x,c=t.y,l=t.z,Math.sqrt(o*o+c*c+l*l)},s.lengthSqr=function(t){return o=t.x,c=t.y,l=t.z,o*o+c*c+l*l},s.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},s.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},s.inverseSafe=function(t,e){return o=e.x,c=e.y,l=e.z,Math.abs(o)<a.EPSILON?t.x=0:t.x=1/o,Math.abs(c)<a.EPSILON?t.y=0:t.y=1/c,Math.abs(l)<a.EPSILON?t.z=0:t.z=1/l,t},s.normalize=function(t,e){o=e.x,c=e.y,l=e.z;e=o*o+c*c+l*l;return 0<e&&(e=1/Math.sqrt(e),t.x=o*e,t.y=c*e,t.z=l*e),t},s.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},s.cross=function(t,e,i){var n=e.x,r=e.y,e=e.z,s=i.x,o=i.y,i=i.z;return t.x=r*i-e*o,t.y=e*s-n*i,t.z=n*o-r*s,t},s.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t},s.random=function(t,e){e=e||1;var i=2*(0,a.random)()*Math.PI,n=2*(0,a.random)()-1,r=Math.sqrt(1-n*n);return t.x=r*Math.cos(i)*e,t.y=r*Math.sin(i)*e,t.z=n*e,t},s.transformMat4=function(t,e,i){o=e.x,c=e.y,l=e.z;e=i.m,i=(i=e[3]*o+e[7]*c+e[11]*l+e[15])?1/i:1;return t.x=(e[0]*o+e[4]*c+e[8]*l+e[12])*i,t.y=(e[1]*o+e[5]*c+e[9]*l+e[13])*i,t.z=(e[2]*o+e[6]*c+e[10]*l+e[14])*i,t},s.transformMat4Normal=function(t,e,i){o=e.x,c=e.y,l=e.z;e=i.m,i=(i=e[3]*o+e[7]*c+e[11]*l)?1/i:1;return t.x=(e[0]*o+e[4]*c+e[8]*l)*i,t.y=(e[1]*o+e[5]*c+e[9]*l)*i,t.z=(e[2]*o+e[6]*c+e[10]*l)*i,t},s.transformMat3=function(t,e,i){o=e.x,c=e.y,l=e.z;e=i.m;return t.x=o*e[0]+c*e[3]+l*e[6],t.y=o*e[1]+c*e[4]+l*e[7],t.z=o*e[2]+c*e[5]+l*e[8],t},s.transformAffine=function(t,e,i){o=e.x,c=e.y,l=e.z;e=i.m;return t.x=e[0]*o+e[1]*c+e[2]*l+e[3],t.y=e[4]*o+e[5]*c+e[6]*l+e[7],t.x=e[8]*o+e[9]*c+e[10]*l+e[11],t},s.transformQuat=function(t,e,i){var n=i.w*e.x+i.y*e.z-i.z*e.y,r=i.w*e.y+i.z*e.x-i.x*e.z,s=i.w*e.z+i.x*e.y-i.y*e.x,e=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=n*i.w+e*-i.x+r*-i.z-s*-i.y,t.y=r*i.w+e*-i.y+s*-i.x-n*-i.z,t.z=s*i.w+e*-i.z+n*-i.y-r*-i.x,t},s.transformRTS=function(t,e,i,n,r){var s=e.x*r.x,o=e.y*r.y,e=e.z*r.z,r=i.w*s+i.y*e-i.z*o,a=i.w*o+i.z*s-i.x*e,c=i.w*e+i.x*o-i.y*s,s=-i.x*s-i.y*o-i.z*e;return t.x=r*i.w+s*-i.x+a*-i.z-c*-i.y+n.x,t.y=a*i.w+s*-i.y+c*-i.x-r*-i.z+n.y,t.z=c*i.w+s*-i.z+r*-i.y-a*-i.x+n.z,t},s.transformInverseRTS=function(t,e,i,n,r){var s=e.x-n.x,o=e.y-n.y,e=e.z-n.z,n=i.w*s-i.y*e+i.z*o,a=i.w*o-i.z*s+i.x*e,c=i.w*e-i.x*o+i.y*s,s=i.x*s+i.y*o+i.z*e;return t.x=(n*i.w+s*i.x+a*i.z-c*i.y)/r.x,t.y=(a*i.w+s*i.y+c*i.x-n*i.z)/r.y,t.z=(c*i.w+s*i.z+n*i.y-a*i.x)/r.z,t},s.rotateX=function(t,e,i,n){o=e.x-i.x,c=e.y-i.y,l=e.z-i.z;var e=Math.cos(n),n=Math.sin(n),r=o,s=c*e-l*n,n=c*n+l*e;return t.x=r+i.x,t.y=s+i.y,t.z=n+i.z,t},s.rotateY=function(t,e,i,n){o=e.x-i.x,c=e.y-i.y,l=e.z-i.z;var e=Math.cos(n),n=Math.sin(n),r=l*n+o*e,s=c,e=l*e-o*n;return t.x=r+i.x,t.y=s+i.y,t.z=e+i.z,t},s.rotateZ=function(t,e,i,n){o=e.x-i.x,c=e.y-i.y,l=e.z-i.z;var e=Math.cos(n),n=Math.sin(n),r=o*e-c*n,n=o*n+c*e,e=l;return t.x=r+i.x,t.y=n+i.y,t.z=e+i.z,t},s.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},s.equals=function(t,e,i){void 0===i&&(i=a.EPSILON);var n=t.x,r=t.y,t=t.z,s=e.x,o=e.y,e=e.z;return Math.abs(n-s)<=i*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=i*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(t-e)<=i*Math.max(1,Math.abs(t),Math.abs(e))},s.angle=function(t,e){s.normalize(x,t),s.normalize(b,e);t=s.dot(x,b);return 1<t?0:t<-1?Math.PI:Math.acos(t)},s.projectOnPlane=function(t,e,i){return s.subtract(t,e,s.project(t,e,i))},s.project=function(t,e,i){var n=s.lengthSqr(i);return n<1e-6?s.set(t,0,0,0):s.multiplyScalar(t,i,s.dot(e,i)/n)},s.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t},s.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t},t=s,v=[{key:"ONE",get:function(){return new s(1,1,1)}},{key:"ZERO",get:function(){return new s}},{key:"UP",get:function(){return new s(0,1,0)}},{key:"RIGHT",get:function(){return new s(1,0,0)}},{key:"FORWARD",get:function(){return new s(0,0,1)}}],(g=null)&&f(t.prototype,g),v&&f(t,v),i.clone=function(){return new s(this.x,this.y,this.z)},i.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e&&this.z-e<=t.z&&t.z<=this.z+e},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},i.lerp=function(t,e,i){return i=i||new s,s.lerp(i,this,t,e),i},i.clampf=function(t,e){return this.x=_.default.clampf(this.x,t.x,e.x),this.y=_.default.clampf(this.y,t.y,e.y),this.z=_.default.clampf(this.z,t.z,e.z),this},i.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.add=function(t,e){return(e=e||new s).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e},i.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.cross=function(t,e){return e=e||new s,s.cross(e,this,t),e},i.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.normalizeSelf=function(){return s.normalize(this,this),this},i.normalize=function(t){return t=t||new s,s.normalize(t,this),t},i.transformMat4=function(t,e){return e=e||new s,s.transformMat4(e,this,t),e},i.maxAxis=function(){return Math.max(this.x,this.y,this.z)},i.signAngle=function(t){cc.warnID(1408,"vec3.signAngle","v2.1","cc.v2(selfVector).signAngle(vector)");var e=new r.default(this.x,this.y),t=new r.default(t.x,t.y);return e.signAngle(t)},i.rotate=function(t,e){return cc.warnID(1408,"vec3.rotate","v2.1","cc.v2(selfVector).rotate(radians, out)"),r.default.prototype.rotate.call(this,t,e)},i.rotateSelf=function(t){return cc.warnID(1408,"vec3.rotateSelf","v2.1","cc.v2(selfVector).rotateSelf(radians)"),r.default.prototype.rotateSelf.call(this,t)},s);function s(t,e,i){var n;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),(n=y.call(this)||this).mag=s.prototype.len,n.magSqr=s.prototype.lengthSqr,n.subSelf=s.prototype.subtract,n.mulSelf=s.prototype.multiplyScalar,n.divSelf=s.prototype.divide,n.scaleSelf=s.prototype.multiply,n.negSelf=s.prototype.negate,n.x=void 0,n.y=void 0,n.z=void 0,n.angle=r.default.prototype.angle,n.project=r.default.prototype.project,t&&"object"==typeof t?(n.z=t.z,n.y=t.y,n.x=t.x):(n.x=t,n.y=e,n.z=i),n}(e.default=n).sub=n.subtract,n.mul=n.multiply,n.scale=n.multiplyScalar,n.mag=n.len,n.squaredMagnitude=n.lengthSqr,n.div=n.divide,n.ONE_R=n.ONE,n.ZERO_R=n.ZERO,n.UP_R=n.UP,n.RIGHT_R=n.RIGHT,n.FRONT_R=n.FORWARD;var x=new n,b=new n;u.default.fastDefine("cc.Vec3",n,{x:0,y:0,z:0}),cc.v3=function(t,e,i){return new n(t,e,i)},cc.Vec3=n,h.exports=e.default},{"../platform/CCClass":189,"../utils/misc":264,"./utils":286,"./value-type":287,"./vec2":288}],290:[function(t,n,e){"use strict";e.__esModule=!0,e.v4=v,e.default=void 0;var o=_(t("../platform/CCClass")),i=_(t("./value-type")),s=t("./utils");function _(t){return t&&t.__esModule?t:{default:t}}function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(i){return function(){var t,e=p(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=p(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m,y,g,c=0,l=0,h=0,u=0,r=(m=i.default,t=m,(i=a).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,f(a),(i=a.prototype).sub=function(t,e){return a.subtract(e||new a,this,t)},i.mul=function(t,e){return a.multiplyScalar(e||new a,this,t)},i.div=function(t,e){return a.multiplyScalar(e||new a,this,1/t)},i.scale=function(t,e){return a.multiply(e||new a,this,t)},i.neg=function(t){return a.negate(t||new a,this)},a.clone=function(t){return new a(t.x,t.y,t.z,t.w)},a.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},a.set=function(t,e,i,n,r){return t.x=e,t.y=i,t.z=n,t.w=r,t},a.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t},a.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t},a.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t},a.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t},a.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},a.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},a.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t.w=Math.min(e.w,i.w),t},a.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t.w=Math.max(e.w,i.w),t},a.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},a.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},a.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t.w=e.w+i.w*n,t},a.distance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,e=e.w-t.w;return Math.sqrt(i*i+n*n+r*r+e*e)},a.squaredDistance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,e=e.w-t.w;return i*i+n*n+r*r+e*e},a.len=function(t){return c=t.x,l=t.y,h=t.z,u=t.w,Math.sqrt(c*c+l*l+h*h+u*u)},a.lengthSqr=function(t){return c=t.x,l=t.y,h=t.z,u=t.w,c*c+l*l+h*h+u*u},a.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},a.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},a.inverseSafe=function(t,e){return c=e.x,l=e.y,h=e.z,u=e.w,Math.abs(c)<s.EPSILON?t.x=0:t.x=1/c,Math.abs(l)<s.EPSILON?t.y=0:t.y=1/l,Math.abs(h)<s.EPSILON?t.z=0:t.z=1/h,Math.abs(u)<s.EPSILON?t.w=0:t.w=1/u,t},a.normalize=function(t,e){c=e.x,l=e.y,h=e.z,u=e.w;e=c*c+l*l+h*h+u*u;return 0<e&&(e=1/Math.sqrt(e),t.x=c*e,t.y=l*e,t.z=h*e,t.w=u*e),t},a.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},a.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t.w=e.w+n*(i.w-e.w),t},a.random=function(t,e){e=e||1;var i=2*(0,s.random)()*Math.PI,n=2*(0,s.random)()-1,r=Math.sqrt(1-n*n);return t.x=r*Math.cos(i)*e,t.y=r*Math.sin(i)*e,t.z=n*e,t.w=0,t},a.transformMat4=function(t,e,i){c=e.x,l=e.y,h=e.z,u=e.w;e=i.m;return t.x=e[0]*c+e[4]*l+e[8]*h+e[12]*u,t.y=e[1]*c+e[5]*l+e[9]*h+e[13]*u,t.z=e[2]*c+e[6]*l+e[10]*h+e[14]*u,t.w=e[3]*c+e[7]*l+e[11]*h+e[15]*u,t},a.transformAffine=function(t,e,i){c=e.x,l=e.y,h=e.z,u=e.w;i=i.m;return t.x=i[0]*c+i[1]*l+i[2]*h+i[3]*u,t.y=i[4]*c+i[5]*l+i[6]*h+i[7]*u,t.x=i[8]*c+i[9]*l+i[10]*h+i[11]*u,t.w=e.w,t},a.transformQuat=function(t,e,i){var n=e.x,r=e.y,s=e.z,i=(c=i.x,l=i.y,h=i.z,(u=i.w)*n+l*s-h*r),o=u*r+h*n-c*s,a=u*s+c*r-l*n,n=-c*n-l*r-h*s;return t.x=i*u+n*-c+o*-h-a*-l,t.y=o*u+n*-l+a*-c-i*-h,t.z=a*u+n*-h+i*-l-o*-c,t.w=e.w,t},a.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},a.equals=function(t,e,i){return void 0===i&&(i=s.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))},a.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},a.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},t=a,g=[{key:"ZERO",get:function(){return new a(0,0,0,0)}},{key:"ONE",get:function(){return new a(1,1,1,1)}},{key:"NEG_ONE",get:function(){return new a(-1,-1,-1,-1)}}],(y=null)&&d(t.prototype,y),g&&d(t,g),i.clone=function(){return new a(this.x,this.y,this.z,this.w)},i.set=function(t,e,i,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0),this},i.equals=function(t,e){return void 0===e&&(e=s.EPSILON),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},i.equals4f=function(t,e,i,n,r){return void 0===r&&(r=s.EPSILON),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=r*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-n)<=r*Math.max(1,Math.abs(this.w),Math.abs(n))},i.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.strictEquals4f=function(t,e,i,n){return this.x===t&&this.y===e&&this.z===i&&this.w===n},i.lerp=function(t,e){return c=this.x,l=this.y,h=this.z,u=this.w,this.x=c+e*(t.x-c),this.y=l+e*(t.y-l),this.z=h+e*(t.z-h),this.w=u+e*(t.w-u),this},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},i.clampf=function(t,e){return this.x=(0,s.clamp)(this.x,t.x,e.x),this.y=(0,s.clamp)(this.y,t.y,e.y),this.z=(0,s.clamp)(this.z,t.z,e.z),this.w=(0,s.clamp)(this.w,t.w,e.w),this},i.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.add=function(t,e){return(e=e||new a).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,e},i.subtract=function(t,e){return(e=e||new a).x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,e},i.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},i.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.cross=function(t,e){e=e||new a;var i=this.x,n=this.y,r=this.z,s=t.x,o=t.y,t=t.z;return e.x=n*t-r*o,e.y=r*s-i*t,e.z=i*o-n*s,e},i.len=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return Math.sqrt(t*t+e*e+i*i+n*n)},i.lengthSqr=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n},i.normalizeSelf=function(){return this.normalize(this),this},i.normalize=function(t){t=t||new a,c=this.x,l=this.y,h=this.z,u=this.w;var e=c*c+l*l+h*h+u*u;return 0<e&&(e=1/Math.sqrt(e),t.x=c*e,t.y=l*e,t.z=h*e,t.w=u*e),t},i.transformMat4=function(t,e){e=e||new a,c=this.x,l=this.y,h=this.z,u=this.w;t=t.m;return e.x=t[0]*c+t[4]*l+t[8]*h+t[12]*u,e.y=t[1]*c+t[5]*l+t[9]*h+t[13]*u,e.z=t[2]*c+t[6]*l+t[10]*h+t[14]*u,e.w=t[3]*c+t[7]*l+t[11]*h+t[15]*u,e},i.maxAxis=function(){return Math.max(this.x,this.y,this.z,this.w)},a);function a(t,e,i,n){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),(r=m.call(this)||this).mag=a.prototype.len,r.magSqr=a.prototype.lengthSqr,r.subSelf=a.prototype.subtract,r.mulSelf=a.prototype.multiplyScalar,r.divSelf=a.prototype.divide,r.scaleSelf=a.prototype.multiply,r.negSelf=a.prototype.negate,r.x=void 0,r.y=void 0,r.z=void 0,r.w=void 0,t&&"object"==typeof t?(r.w=t.w,r.z=t.z,r.y=t.y,r.x=t.x):(r.x=t,r.y=e,r.z=i,r.w=n),r}function v(t,e,i,n){return new r(t,e,i,n)}(e.default=r).sub=r.subtract,r.mul=r.multiply,r.div=r.divide,r.scale=r.multiplyScalar,r.mag=r.len,r.squaredMagnitude=r.lengthSqr,r.ZERO_R=r.ZERO,r.ONE_R=r.ONE,r.NEG_ONE_R=r.NEG_ONE,o.default.fastDefine("cc.Vec4",r,{x:0,y:0,z:0,w:0}),cc.v4=v,cc.Vec4=r},{"../platform/CCClass":189,"./utils":286,"./value-type":287}],291:[function(t,e,l){"use strict";function i(i,t,n){i&&(n=n||a.getClassName(i),t.forEach(function(t){function e(){cc.errorID(1406,n,t)}a.getset(i.prototype,t,e,e)}))}function n(e,t,i){e&&t.forEach(function(t){a.getset(e,t,function(){cc.errorID(1406,i,t)})})}function r(n,t,e){if(n){var i,r,s,o="Sorry, "+(e||cc.js.getClassName(n))+".%s is removed, please use %s instead.";for(i in t)!function(){function e(e,t){function i(t){cc.error(o,e,t)}Array.isArray(t)||(t=t.split(",").map(function(t){return t.trim()}));try{a.getset(n,e,i.bind(null,t[0]),t[1]&&i.bind(null,t[1]))}catch(t){}}r=t[i],"*"===i[0]?(e("g"+(s=i.slice(1)),r),e("s"+s,r)):i.split(",").map(function(t){return t.trim()}).forEach(function(t){e(t,r)})}()}}function s(i,n,r){if(i)for(var s in r=r||a.getClassName(i),n)!function(){var t=s,e=i[t];e&&(i[t]=function(){return cc.warn("Sorry, %s.%s is deprecated. Please use %s instead",r,t,n[t]),e.apply(this,arguments)})}()}var a=cc.js,o=(a.get(cc,"info",function(){return cc.errorID(1400,"cc.info","cc.log"),cc.log}),a.get(cc,"spriteFrameCache",function(){cc.errorID(1404)}),a.get(cc,"vmath",function(){return cc.warnID(1400,"cc.vmath","cc.math"),cc.math}),a.get(cc.math,"vec2",function(){return cc.warnID(1400,"cc.vmath.vec2","cc.Vec2"),cc.Vec2}),a.get(cc.math,"vec3",function(){return cc.warnID(1400,"cc.vmath.vec3","cc.Vec3"),cc.Vec3}),a.get(cc.math,"vec4",function(){return cc.warnID(1400,"cc.vmath.vec4","cc.Vec4"),cc.Vec4}),a.get(cc.math,"mat4",function(){return cc.warnID(1400,"cc.vmath.mat4","cc.Mat4"),cc.Mat4}),a.get(cc.math,"mat3",function(){return cc.warnID(1400,"cc.vmath.mat3","cc.Mat3"),cc.Mat3}),a.get(cc.math,"quat",function(){return cc.warnID(1400,"cc.vmath.quat","cc.Quat"),cc.Quat}),a.get(cc.SpriteFrame.prototype,"_textureLoaded",function(){return cc.errorID(1400,"spriteFrame._textureLoaded","spriteFrame.textureLoaded()"),this.textureLoaded()}),i(cc.SpriteFrame,["addLoadedEventListener"]),s(cc.Sprite.prototype,{setState:"cc.Sprite.setMaterial",getState:"cc.Sprite.getMaterial"},"cc.Sprite"),a.get(cc.SpriteFrame.prototype,"clearTexture",function(){return cc.errorID(1406,"cc.SpriteFrame","clearTexture"),function(){}}),a.get(cc,"textureCache",function(){cc.errorID(1406,"cc","textureCache")}),cc.Texture2D),c=(a.get(o.prototype,"releaseTexture",function(){return cc.errorID(1400,"texture.releaseTexture()","texture.destroy()"),this.destroy}),a.get(o.prototype,"getName",function(){return cc.errorID(1400,"texture.getName()","texture._glID"),function(){return this._glID||null}}),a.get(o.prototype,"isLoaded",function(){return cc.errorID(1400,"texture.isLoaded function","texture.loaded property"),function(){return this.loaded}}),a.get(o.prototype,"setAntiAliasTexParameters",function(){return cc.errorID(1400,"texture.setAntiAliasTexParameters()","texture.setFilters(cc.Texture2D.Filter.LINEAR, cc.Texture2D.Filter.LINEAR)"),function(){this.setFilters(o.Filter.LINEAR,o.Filter.LINEAR)}}),a.get(o.prototype,"setAliasTexParameters",function(){return cc.errorID(1400,"texture.setAntiAliasTexParameters()","texture.setFilters(cc.Texture2D.Filter.NEAREST, cc.Texture2D.Filter.NEAREST)"),function(){this.setFilters(o.Filter.NEAREST,o.Filter.NEAREST)}}),n(cc.macro,["ENABLE_GL_STATE_CACHE","FIX_ARTIFACTS_BY_STRECHING_TEXEL"],"cc.macro"),r(cc.macro,{PI:"Math.PI",PI2:"Math.PI * 2",FLT_MAX:"Number.MAX_VALUE",FLT_MIN:"Number.MIN_VALUE",UINT_MAX:"Number.MAX_SAFE_INTEGER"},"cc.macro"),n(cc.game,["CONFIG_KEY"],"cc.game"),n(cc.sys,["dumpRoot","cleanScript"],"cc.sys"),r(cc.Director,{EVENT_PROJECTION_CHANGED:"",EVENT_BEFORE_VISIT:"EVENT_AFTER_UPDATE",EVENT_AFTER_VISIT:"EVENT_BEFORE_DRAW"},"cc.Director"),s(cc.Director.prototype,{convertToGL:"cc.view.convertToLocationInView",convertToUI:"",getWinSize:"cc.winSize",getWinSizeInPixels:"cc.winSize",getVisibleSize:"cc.view.getVisibleSize",getVisibleOrigin:"cc.view.getVisibleOrigin",purgeCachedData:"cc.loader.releaseAll",setDepthTest:"cc.Camera.main.depth",setClearColor:"cc.Camera.main.backgroundColor",getRunningScene:"cc.director.getScene",getAnimationInterval:"cc.game.getFrameRate",setAnimationInterval:"cc.game.setFrameRate",isDisplayStats:"cc.debug.isDisplayStats",setDisplayStats:"cc.debug.setDisplayStats",stopAnimation:"cc.game.pause",startAnimation:"cc.game.resume"},"cc.Director"),i(cc.Director,["pushScene","popScene","popToRootScene","popToSceneStackLevel","setProjection","getProjection"],"cc.Director"),r(cc.Scheduler,{scheduleCallbackForTarget:"schedule",scheduleUpdateForTarget:"scheduleUpdate",unscheduleCallbackForTarget:"unschedule",unscheduleUpdateForTarget:"unscheduleUpdate",unscheduleAllCallbacksForTarget:"unscheduleAllForTarget",unscheduleAllCallbacks:"unscheduleAll",unscheduleAllCallbacksWithMinPriority:"unscheduleAllWithMinPriority"},"cc.Scheduler"),r(cc.view,{adjustViewPort:"adjustViewportMeta",setViewPortInPoints:"setViewportInPoints",getViewPortRect:"getViewportRect"},"cc.view"),n(cc.view,["isViewReady","setTargetDensityDPI","getTargetDensityDPI","setFrameZoomFactor","canSetContentScaleFactor","setContentTranslateLeftTop","getContentTranslateLeftTop","setViewName","getViewName"],"cc.view"),i(cc.Pipeline,["flowInDeps","getItems"],"cc.loader"),i(cc.PhysicsManager,["attachDebugDrawToCamera","detachDebugDrawFromCamera"]),i(cc.CollisionManager,["attachDebugDrawToCamera","detachDebugDrawFromCamera"]),r(cc._BaseNode.prototype,{tag:"name",getTag:"name",setTag:"name",getChildByTag:"getChildByName",removeChildByTag:"getChildByName(name).destroy()"}),i(cc.Node,["_cascadeColorEnabled","cascadeColor","isCascadeColorEnabled","setCascadeColorEnabled","_cascadeOpacityEnabled","cascadeOpacity","isCascadeOpacityEnabled","setCascadeOpacityEnabled","opacityModifyRGB","isOpacityModifyRGB","setOpacityModifyRGB","ignoreAnchor","isIgnoreAnchorPointForPosition","ignoreAnchorPointForPosition","isRunning","_sgNode"]),s(cc.Node.prototype,{getNodeToParentTransform:"getLocalMatrix",getNodeToParentTransformAR:"getLocalMatrix",getNodeToWorldTransform:"getWorldMatrix",getNodeToWorldTransformAR:"getWorldMatrix",getParentToNodeTransform:"getLocalMatrix",getWorldToNodeTransform:"getWorldMatrix",convertTouchToNodeSpace:"convertToNodeSpaceAR",convertTouchToNodeSpaceAR:"convertToNodeSpaceAR",convertToWorldSpace:"convertToWorldSpaceAR",convertToNodeSpace:"convertToNodeSpaceAR"}),r(cc.Node.prototype,{getRotationX:"rotationX",setRotationX:"rotationX",getRotationY:"rotationY",setRotationY:"rotationY",getPositionX:"x",setPositionX:"x",getPositionY:"y",setPositionY:"y",getSkewX:"skewX",setSkewX:"skewX",getSkewY:"skewY",setSkewY:"skewY",getScaleX:"scaleX",setScaleX:"scaleX",getScaleY:"scaleY",setScaleY:"scaleY",getOpacity:"opacity",setOpacity:"opacity",getColor:"color",setColor:"color",getLocalZOrder:"zIndex",setLocalZOrder:"zIndex"}),r(cc.Sprite.prototype,{setInsetLeft:"cc.SpriteFrame insetLeft",setInsetRight:"cc.SpriteFrame insetRight",setInsetTop:"cc.SpriteFrame insetTop",setInsetBottom:"cc.SpriteFrame insetBottom"}),cc.Material.getInstantiatedBuiltinMaterial=cc.MaterialVariant.createWithBuiltin,cc.Material.getInstantiatedMaterial=cc.MaterialVariant.create,s(cc.Material,{getInstantiatedBuiltinMaterial:"cc.MaterialVariant.createWithBuiltin",getInstantiatedMaterial:"cc.MaterialVariant.create"}),cc.js.getset(cc.RenderComponent.prototype,"sharedMaterials",function(){return cc.warnID(1400,"sharedMaterials","getMaterials"),this.materials},function(t){cc.warnID(1400,"sharedMaterials","setMaterial"),this.materials=t}),s(cc.Camera.prototype,{getNodeToCameraTransform:"getWorldToScreenMatrix2D",getCameraToWorldPoint:"getScreenToWorldPoint",getWorldToCameraPoint:"getWorldToScreenPoint",getCameraToWorldMatrix:"getScreenToWorldMatrix2D",getWorldToCameraMatrix:"getWorldToScreenMatrix2D"}),i(cc.Camera,["addTarget","removeTarget","getTargets"]),'"%s" is not defined in the Scene, it is only defined in normal nodes.');Object.defineProperties(cc.Scene.prototype,{active:{get:function(){return cc.error(c,"active"),!0},set:function(){cc.error(c,"active")}},activeInHierarchy:{get:function(){return cc.error(c,"activeInHierarchy"),!0}},getComponent:{get:function(){return cc.error(c,"getComponent"),function(){return null}}},addComponent:{get:function(){return cc.error(c,"addComponent"),function(){return null}}}}),n(cc.dynamicAtlasManager,["minFrameSize"],"cc.dynamicAtlasManager"),cc.Light&&n(cc.Light.prototype,["shadowDepthScale"],"cc.Light.prototype"),r(cc,{affineTransformMake:"cc.AffineTransform.create",affineTransformMakeIdentity:"cc.AffineTransform.identity",affineTransformClone:"cc.AffineTransform.clone",affineTransformConcat:"cc.AffineTransform.concat",affineTransformConcatIn:"cc.AffineTransform.concat",affineTransformInvert:"cc.AffineTransform.invert",affineTransformInvertIn:"cc.AffineTransform.invert",affineTransformInvertOut:"cc.AffineTransform.invert",affineTransformEqualToTransform:"cc.AffineTransform.equal",pointApplyAffineTransform:"cc.AffineTransform.transformVec2",sizeApplyAffineTransform:"cc.AffineTransform.transformSize",rectApplyAffineTransform:"cc.AffineTransform.transformRect",obbApplyAffineTransform:"cc.AffineTransform.transformObb",pointEqualToPoint:"cc.Vec2 equals",sizeEqualToSize:"cc.Size equals",rectEqualToRect:"rectA.equals(rectB)",rectContainsRect:"rectA.containsRect(rectB)",rectContainsPoint:"rect.contains(vec2)",rectOverlapsRect:"rectA.intersects(rectB)",rectIntersectsRect:"rectA.intersects(rectB)",rectIntersection:"rectA.intersection(intersection, rectB)",rectUnion:"rectA.union(union, rectB)",rectGetMaxX:"rect.xMax",rectGetMidX:"rect.center.x",rectGetMinX:"rect.xMin",rectGetMaxY:"rect.yMax",rectGetMidY:"rect.center.y",rectGetMinY:"rect.yMin",colorEqual:"colorA.equals(colorB)",hexToColor:"color.fromHEX(hexColor)",colorToHex:"color.toHEX()",TextAlignment:"cc.macro.TextAlignment",VerticalTextAlignment:"cc.macro.VerticalTextAlignment",pNeg:"p.neg()",pAdd:"p1.add(p2)",pSub:"p1.sub(p2)",pMult:"p.mul(factor)",pMidpoint:"p1.add(p2).mul(0.5)",pDot:"p1.dot(p2)",pCross:"p1.cross(p2)",pPerp:"p.rotate(-90 * Math.PI / 180)",pRPerp:"p.rotate(90 * Math.PI / 180)",pProject:"p1.project(p2)",pLengthSQ:"p.magSqr()",pDistanceSQ:"p1.sub(p2).magSqr()",pLength:"p.mag()",pDistance:"p1.sub(p2).mag()",pNormalize:"p.normalize()",pForAngle:"cc.v2(Math.cos(a), Math.sin(a))",pToAngle:"Math.atan2(v.y, v.x)",pZeroIn:"p.x = p.y = 0",pIn:"p1.set(p2)",pMultIn:"p.mulSelf(factor)",pSubIn:"p1.subSelf(p2)",pAddIn:"p1.addSelf(p2)",pNormalizeIn:"p.normalizeSelf()",pSameAs:"p1.equals(p2)",pAngle:"v1.angle(v2)",pAngleSigned:"v1.signAngle(v2)",pRotateByAngle:"p.rotate(radians)",pCompMult:"v1.dot(v2)",pFuzzyEqual:"v1.fuzzyEquals(v2, tolerance)",pLerp:"p.lerp(endPoint, ratio)",pClamp:"p.clampf(min_inclusive, max_inclusive)",rand:"Math.random() * 0xffffff",randomMinus1To1:"(Math.random() - 0.5) * 2",container:"cc.game.container",_canvas:"cc.game.canvas",_renderType:"cc.game.renderType",_getError:"cc.debug.getError",_initDebugSetting:"cc.debug._resetDebugSetting",DebugMode:"cc.debug.DebugMode"},"cc"),n(cc,["blendFuncDisable","pFromSize","pCompOp","pIntersectPoint","pSegmentIntersect","pLineIntersect","obbApplyMatrix","getImageFormatByData","initEngine"],"cc"),s(cc,{p:"cc.v2"},"cc"),r(cc.Rect,{contain:"rectA.contains(rectB)",transformMat4:"rect.transformMat4(out, mat4)"}),r(cc.Color,{rgb2hsv:"color.toHSV()",hsv2rgb:"color.fromHSV(h, s, v)"}),a.get(cc,"lerp",function(){return cc.errorID(1400,"cc.lerp","cc.misc.lerp"),cc.misc.lerp}),a.get(cc,"random0To1",function(){return cc.errorID(1400,"cc.random0To1","Math.random"),Math.random}),a.get(cc,"degreesToRadians",function(){return cc.errorID(1400,"cc.degreesToRadians","cc.misc.degreesToRadians"),cc.misc.degreesToRadians}),a.get(cc,"radiansToDegrees",function(){return cc.errorID(1400,"cc.radiansToDegrees","cc.misc.radiansToDegrees"),cc.misc.radiansToDegrees}),a.get(cc,"clampf",function(){return cc.errorID(1400,"cc.clampf","cc.misc.clampf"),cc.misc.clampf}),a.get(cc,"clamp01",function(){return cc.errorID(1400,"cc.clamp01","cc.misc.clamp01"),cc.misc.clamp01}),a.get(cc,"ImageFormat",function(){return cc.errorID(1400,"cc.ImageFormat","cc.macro.ImageFormat"),cc.macro.ImageFormat}),a.get(cc,"KEY",function(){return cc.errorID(1400,"cc.KEY","cc.macro.KEY"),cc.macro.KEY}),a.get(cc,"Easing",function(){return cc.errorID(1400,"cc.Easing","cc.easing"),cc.easing}),a.get(cc,"isChildClassOf",function(){return cc.errorID(1400,"cc.isChildClassOf","cc.js.isChildClassOf"),cc.js.isChildClassOf}),"undefined"!=typeof dragonBones&&a.get(dragonBones.CCFactory,"getFactory",function(){return cc.errorID(1400,"dragonBones.CCFactory.getFactory","dragonBones.CCFactory.getInstance"),dragonBones.CCFactory.getInstance}),cc.renderer.renderEngine={get gfx(){return cc.warnID(1400,"cc.renderer.renderEngine.gfx","cc.gfx"),cc.gfx},get math(){return cc.warnID(1400,"cc.renderer.renderEngine.math","cc.math"),cc.vmath},get InputAssembler(){return cc.warnID(1400,"cc.renderer.renderEngine.InputAssembler","cc.renderer.InputAssembler"),cc.renderer.InputAssembler}}},{}],292:[function(t,e,i){"use strict";t("./core/CCGame"),t("./actions")},{"./actions":8,"./core/CCGame":29}],293:[function(t,e,i){"use strict";function n(t){var e,i,n,r,h,s,o,a,c,l;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},n=null;;){switch(e=this.readUInt32(),h=function(){var t,e=[];for(t=0;t<4;++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},o=this.readUInt16(),r=this.readUInt16()||100,n.delay=1e3*o/r,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===h&&(this.pos+=4,e-=4),t=(null!=n?n.data:void 0)||this.imgData,a=0;0<=e?a<e:e<a;0<=e?++a:--a)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),0<(s=255-this.transparency.indexed.length))for(c=0;0<=s?c<s:s<c;0<=s?++c:--c)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":r=(o=this.read(e)).indexOf(0),l=String.fromCharCode.apply(String,o.slice(0,r)),this.text[l]=String.fromCharCode.apply(String,o.slice(r+1));break;case"IEND":return n&&this.animation.frames.push(n),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(l=this.colorType)||6===l,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error(C.getError(6017))}}var A=t("../compression/zlib.min"),C=t("../core/CCDebug");n.prototype={constructor:n,read:function(t){var e,i=[];for(e=0;0<=t?e<t:t<e;0<=t?++e:--e)i.push(this.data[this.pos++]);return i},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++]},decodePixels:function(t){var e,i,h,n,u,_,d,f,p,r,s,o,a,c,l,m,y,g,v,x,b;if(0===(t=null==t?this.imgData:t).length)return new Uint8Array(0);for(t=new A.Inflate(t,{index:0,verify:!1}).decompress(),c=(r=this.pixelBitlength/8)*this.width,s=new Uint8Array(c*this.height),_=t.length,i=o=a=0;o<_;){switch(t[o++]){case 0:for(n=y=0;y<c;n=y+=1)s[i++]=t[o++];break;case 1:for(n=g=0;g<c;n=g+=1)e=t[o++],u=n<r?0:s[i-r],s[i++]=(e+u)%256;break;case 2:for(n=v=0;v<c;n=v+=1)e=t[o++],h=(n-n%r)/r,l=a&&s[(a-1)*c+h*r+n%r],s[i++]=(l+e)%256;break;case 3:for(n=x=0;x<c;n=x+=1)e=t[o++],h=(n-n%r)/r,u=n<r?0:s[i-r],l=a&&s[(a-1)*c+h*r+n%r],s[i++]=(e+Math.floor((u+l)/2))%256;break;case 4:for(n=b=0;b<c;n=b+=1)e=t[o++],h=(n-n%r)/r,u=n<r?0:s[i-r],0===a?l=m=0:(l=s[(a-1)*c+h*r+n%r],m=h&&s[(a-1)*c+(h-1)*r+n%r]),p=u+l-m,d=Math.abs(p-u),f=Math.abs(p-l),p=Math.abs(p-m),s[i++]=(e+(d<=f&&d<=p?u:f<=p?l:m))%256;break;default:throw new Error(C.getError(6018,t[o-1]))}a++}return s},copyToImageData:function(h,t){var e,i,n,r,s,o,a,u,_=this.colors,c=null,l=this.hasAlphaChannel;if(this.palette.length&&(c=null!=(u=this._decodedPalette)?u:this._decodedPalette=this.decodePalette(),_=4,l=!0),o=(e=h.data||h).length,n=c||t,i=r=0,1===_)for(;i<o;)s=c?4*t[i/4]:r,a=n[s++],e[i++]=a,e[i++]=a,e[i++]=a,e[i++]=l?n[s++]:255,r=s;else for(;i<o;)s=c?4*t[i/4]:r,e[i++]=n[s++],e[i++]=n[s++],e[i++]=n[s++],e[i++]=l?n[s++]:255,r=s},decodePalette:function(){for(var t,e,i=this.palette,n=this.transparency.indexed||[],r=new Uint8Array((n.length||0)+i.length),s=0,o=0,a=t=0,c=i.length;t<c;a=t+=3)r[s++]=i[a],r[s++]=i[a+1],r[s++]=i[a+2],r[s++]=null!=(e=n[o++])?e:255;return r},render:function(t){var e;return t.width=this.width,t.height=this.height,e=(t=t.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0)}},e.exports=n},{"../compression/zlib.min":26,"../core/CCDebug":27}],294:[function(t,e,i){"use strict";var n=t("../core/assets/CCAsset"),t=t("../core/assets/CCSpriteFrame"),n=cc.Class({name:"cc.ParticleAsset",extends:n,properties:{spriteFrame:{default:null,type:t}}});cc.ParticleAsset=e.exports=n},{"../core/assets/CCAsset":34,"../core/assets/CCSpriteFrame":47}],295:[function(t,e,h){"use strict";var o=t("../core/platform/CCMacro"),i=t("./CCParticleAsset"),u=t("../core/components/CCRenderComponent"),_=t("../compression/ZipUtils"),a=t("./CCPNGReader"),c=t("./CCTIFFReader"),l=t("../core/utils/texture-util"),d=(t("../core/renderer/render-flow"),t("./particle-simulator")),n=(t("../core/assets/material/CCMaterial"),t("../core/utils/blend-func"));var r=cc.Enum({GRAVITY:0,RADIUS:1}),s=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),t={preview:{default:!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())},animatable:!1,tooltip:!1},_file:{default:null,type:i},file:{get:function(){return this._file},set:function(t,e){this._file!==t&&((this._file=t)?this._applyFile():this.custom=!0)},animatable:!1,type:i,tooltip:!1},_spriteFrame:{default:null,type:cc.SpriteFrame},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._renderSpriteFrame;i!==t&&((this._renderSpriteFrame=t)&&!t._uuid||(this._spriteFrame=t),(i&&i.getTexture())!==(t&&t.getTexture())&&this._applySpriteFrame(i))},type:cc.SpriteFrame,tooltip:!1},_texture:{default:null,type:cc.Texture2D,editorOnly:!0},texture:{get:function(){return this._getTexture()},set:function(t){t&&cc.warnID(6017)},type:cc.Texture2D,tooltip:!1,readonly:!0,visible:!1,animatable:!1},particleCount:{visible:!1,get:function(){return this._simulator.particles.length},readonly:!0},_stopped:!0,stopped:{get:function(){return this._stopped},animatable:!1,visible:!1},playOnLoad:!0,autoRemoveOnFinish:{default:!1,animatable:!1,tooltip:!1},active:{get:function(){return this._simulator.active},visible:!1},totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,_startColor:null,startColor:{type:cc.Color,get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},_startColorVar:null,startColorVar:{type:cc.Color,get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},_endColor:null,endColor:{type:cc.Color,get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},_endColorVar:null,endColorVar:{type:cc.Color,get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.Vec2.ZERO,posVar:cc.Vec2.ZERO,_positionType:{default:s.FREE,formerlySerializedAs:"positionType"},positionType:{type:s,get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},emitterMode:{default:r.GRAVITY,type:r},gravity:cc.Vec2.ZERO,speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},i=cc.Class({name:"cc.ParticleSystem",extends:u,mixins:[n],editor:!1,ctor:function(){this.initProperties()},initProperties:function(){this._previewTimer=null,this._focused=!1,this._aspectRatio=1,this._simulator=new d(this),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(0,0,0,0),this._endColor=cc.color(255,255,255,0),this._endColorVar=cc.color(0,0,0,0),this._renderSpriteFrame=null},properties:t,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:r,PositionType:s,_PNGReader:a,_TIFFReader:c},onFocusInEditor:!1,onLostFocusInEditor:!1,_startPreview:!1,_stopPreview:!1,_convertTextureToSpriteFrame:!1,__preload:function(){this._super(),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame(this.spriteFrame):this._file&&(this._custom&&this._getTexture()||this._applyFile()),this.playOnLoad&&this.resetSystem()},onDestroy:function(){this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._simulator._uvFilled=0,this._super()},lateUpdate:function(t){this._simulator.finished||this._simulator.step(t)},addParticle:function(){},stopSystem:function(){this._stopped=!0,this._simulator.stop()},resetSystem:function(){this._stopped=!1,this._simulator.reset(),this.markForRender(!0)},isFull:function(){return this.particleCount>=this.totalParticles},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this.spriteFrame=new cc.SpriteFrame(t,e))},_applyFile:function(){var i,n=this._file;n&&(i=this,cc.loader.load(n.nativeUrl,function(t,e){!t&&e?i.isValid&&(i._plistFile=n.nativeUrl,i._custom||i._initWithDictionary(e),i._spriteFrame?!i._renderSpriteFrame&&i._spriteFrame&&i._applySpriteFrame(i.spriteFrame):n.spriteFrame?i.spriteFrame=n.spriteFrame:i._custom&&i._initTextureWithDictionary(e)):cc.errorID(6029)}))},_initTextureWithDictionary:function(i){var t=cc.path.changeBasename(this._plistFile,i.textureFileName||"");if(i.textureFileName)l.loadImage(t,function(t,e){t?(i.textureFileName=void 0,this._initTextureWithDictionary(i)):this.spriteFrame=new cc.SpriteFrame(e)},this);else if(i.textureImageData){var e=i.textureImageData;if(!(e&&0<e.length))return!1;var n=cc.loader.getRes(t);if(!n){e=_.unzipBase64AsArray(e,1);if(!e)return cc.logID(6030),!1;var r=8<(r=e).length&&137===r[0]&&80===r[1]&&78===r[2]&&71===r[3]&&13===r[4]&&10===r[5]&&26===r[6]&&10===r[7]?o.ImageFormat.PNG:2<r.length&&(73===r[0]&&73===r[1]||77===r[0]&&77===r[1]||255===r[0]&&216===r[1])?o.ImageFormat.TIFF:o.ImageFormat.UNKNOWN;if(r!==o.ImageFormat.TIFF&&r!==o.ImageFormat.PNG)return cc.logID(6031),!1;var s=document.createElement("canvas");r===o.ImageFormat.PNG?new a(e).render(s):c.parseTIFF(e,s),n=l.cacheImage(t,s)}n||cc.logID(6032),this.spriteFrame=new cc.SpriteFrame(n)}return!0},_initWithDictionary:function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate,e=(this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this.srcBlendFactor=parseInt(t.blendFuncSource||o.SRC_ALPHA),this.dstBlendFactor=parseInt(t.blendFuncDestination||o.ONE_MINUS_SRC_ALPHA),this._startColor),e=(e.r=255*parseFloat(t.startColorRed||0),e.g=255*parseFloat(t.startColorGreen||0),e.b=255*parseFloat(t.startColorBlue||0),e.a=255*parseFloat(t.startColorAlpha||0),this._startColorVar),e=(e.r=255*parseFloat(t.startColorVarianceRed||0),e.g=255*parseFloat(t.startColorVarianceGreen||0),e.b=255*parseFloat(t.startColorVarianceBlue||0),e.a=255*parseFloat(t.startColorVarianceAlpha||0),this._endColor),e=(e.r=255*parseFloat(t.finishColorRed||0),e.g=255*parseFloat(t.finishColorGreen||0),e.b=255*parseFloat(t.finishColorBlue||0),e.a=255*parseFloat(t.finishColorAlpha||0),this._endColorVar);if(e.r=255*parseFloat(t.finishColorVarianceRed||0),e.g=255*parseFloat(t.finishColorVarianceGreen||0),e.b=255*parseFloat(t.finishColorVarianceBlue||0),e.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:s.RELATIVE),this.sourcePos.x=0,this.sourcePos.y=0,this.posVar.x=parseFloat(t.sourcePositionVariancex||0),this.posVar.y=parseFloat(t.sourcePositionVariancey||0),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||r.GRAVITY),this.emitterMode===r.GRAVITY){this.gravity.x=parseFloat(t.gravityx||0),this.gravity.y=parseFloat(t.gravityy||0),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);e=t.rotationIsDir||"";null!==e?(e=e.toString().toLowerCase(),this.rotationIsDir="true"===e||"1"===e):this.rotationIsDir=!1}else{if(this.emitterMode!==r.RADIUS)return cc.warnID(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},_validateRender:function(){var t=this._getTexture();t&&t.loaded?this._super():this.disableRender()},_onTextureLoaded:function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this.markForRender(!0)},_syncAspect:function(){var t=this._renderSpriteFrame._rect;this._aspectRatio=t.width/t.height},_applySpriteFrame:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame&&(this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.onTextureLoaded(this._onTextureLoaded,this))},_getTexture:function(){return this._renderSpriteFrame&&this._renderSpriteFrame.getTexture()||this._texture},_updateMaterial:function(){var t=this.getMaterial(0);t&&(t.define("CC_USE_MODEL",this._positionType!==s.FREE),t.setProperty("texture",this._getTexture()),n.prototype._updateMaterial.call(this))},_finishedSimulation:function(){this.resetSystem(),this.stopSystem(),this.disableRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()}});cc.ParticleSystem=e.exports=i},{"../compression/ZipUtils":23,"../core/assets/material/CCMaterial":53,"../core/components/CCRenderComponent":89,"../core/platform/CCMacro":194,"../core/renderer/render-flow":221,"../core/utils/blend-func":257,"../core/utils/texture-util":272,"./CCPNGReader":293,"./CCParticleAsset":294,"./CCTIFFReader":296,"./particle-simulator":298,"fire-url":void 0}],296:[function(t,e,i){"use strict";var tt=t("../core/CCDebug");e.exports={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(tt.getError(6019));this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError(tt.getError(6020));return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(cc.logID(6021,t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,e,i,n){var r=[],s=this.getFieldTypeLength(e);if(s*i<=4)!1===this.littleEndian?r.push(n>>>8*(4-s)):r.push(n);else for(var o=0;o<i;o++){var a=s*o;8<=s?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(n+a)),r.push(this.getUint32(n+a+4))):cc.logID(8e3):r.push(this.getBytes(s,n+a))}return"ASCII"===e&&r.forEach(function(t,e,i){i[e]=String.fromCharCode(t)}),r},getBytes:function(t,e){if(!(t<=0))return t<=1?this.getUint8(e):t<=2?this.getUint16(e):t<=3?this.getUint32(e)>>>8:t<=4?this.getUint32(e):void cc.logID(8002);cc.logID(8001)},getBits:function(t,e,i){i=i||0;var n,r,e=e+Math.floor(i/8),s=i+t,t=32-t;return s<=0?cc.logID(6023):s<=8?(n=24+i,r=this.getUint8(e)):s<=16?(n=16+i,r=this.getUint16(e)):s<=32?(n=i,r=this.getUint32(e)):cc.logID(6022),{bits:r<<n>>>t,byteOffset:e+Math.floor(s/8),bitOffset:s%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),i=[],n=t+2,r=0;r<e;n+=12,r++){var s=this.getUint16(n),o=this.getUint16(n+2),a=this.getUint32(n+4),c=this.getUint32(n+8),s=this.getFieldTagName(s),o=this.getFieldTypeName(o),a=this.getFieldValues(s,o,a,c);i[s]={type:o,values:a}}this._fileDirectories.push(i);t=this.getUint32(n);0!==t&&this.parseFileDirectory(t)},clampColorSample:function(t,e){e=Math.pow(2,8-e);return Math.floor(t*e+(e-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var h,t=this.getUint32(4),t=(this._fileDirectories.length=0,this.parseFileDirectory(t),this._fileDirectories[0]),u=t.ImageWidth.values[0],i=t.ImageLength.values[0],n=(this.canvas.width=u,this.canvas.height=i,[]),_=t.Compression?t.Compression.values[0]:1,d=t.SamplesPerPixel.values[0],r=[],f=0,p=!1,m=(t.BitsPerSample.values.forEach(function(t,e,i){r[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(r[e].hasBytesPerSample=!0,r[e].bytesPerSample=t/8),f+=t},this),f%8==0&&(p=!0,h=f/8),t.StripOffsets.values),y=m.length;if(t.StripByteCounts)var g=t.StripByteCounts.values;else{if(cc.logID(8003),1!==y)throw Error(tt.getError(6024));g=[Math.ceil(u*i*f/8)]}for(var s=0;s<y;s++)for(var v=m[s],x=(n[s]=[],g[s]),o=0,b=0,A=1,C=!0,a=[],S=0,T=0,w=0;o<x;o+=A)switch(_){case 1:for(var c=0,a=[];c<d;c++){if(!r[c].hasBytesPerSample)throw E=this.getBits(r[c].bitsPerSample,v+o,b),a.push(E.bits),o=E.byteOffset-v,b=E.bitOffset,RangeError(tt.getError(6025));var E=r[c].bytesPerSample*c;a.push(this.getBytes(r[c].bytesPerSample,v+o+E))}if(n[s].push(a),!p)throw A=0,RangeError(tt.getError(6026));A=h;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){var C=!1,M=1,I=1,B=this.getInt8(v+o);0<=B&&B<=127?M=B+1:-127<=B&&B<=-1?I=1-B:C=!0}else{for(var R=this.getUint8(v+o),c=0;c<I;c++){if(!r[T].hasBytesPerSample)throw RangeError(tt.getError(6025));w=w<<8*S|R,++S===r[T].bytesPerSample&&(a.push(w),w=S=0,T++),T===d&&(n[s].push(a),a=[],T=0)}0===--M&&(C=!0)}A=1}if(e.getContext){var P,D,L=this.canvas.getContext("2d"),e=(L.fillStyle="rgba(255, 255, 255, 0)",t.RowsPerStrip?t.RowsPerStrip.values[0]:i),V=n.length,i=i%e,O=0==i?e:i,F=e,N=0,k=t.PhotometricInterpretation.values[0],G=[],z=0;t.ExtraSamples&&(z=(G=t.ExtraSamples.values).length),t.ColorMap&&(P=t.ColorMap.values,D=Math.pow(2,r[0].bitsPerSample));for(s=0;s<V;s++){s+1===V&&(F=O);for(var U=n[s].length,W=N*s,H=0,j=0;j<U;H++)for(var X=0;X<u;X++,j++){var Y,l=n[s][j],q=0,J=0,Z=0,K=1;if(0<z)for(var Q=0;Q<z;Q++)if(1===G[Q]||2===G[Q]){K=l[3+Q]/256;break}switch(k){case 0:r[0].hasBytesPerSample&&(Y=Math.pow(16,2*r[0].bytesPerSample)),l.forEach(function(t,e,i){i[e]=Y-t});case 1:q=J=Z=this.clampColorSample(l[0],r[0].bitsPerSample);break;case 2:q=this.clampColorSample(l[0],r[0].bitsPerSample),J=this.clampColorSample(l[1],r[1].bitsPerSample),Z=this.clampColorSample(l[2],r[2].bitsPerSample);break;case 3:if(void 0===P)throw Error(tt.getError(6027));var $=l[0],q=this.clampColorSample(P[$],16),J=this.clampColorSample(P[D+$],16),Z=this.clampColorSample(P[2*D+$],16);break;default:throw RangeError(tt.getError(6028,k))}L.fillStyle="rgba("+q+", "+J+", "+Z+", "+K+")",L.fillRect(X,W+H,1,1)}N=F}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}}},{"../core/CCDebug":27}],297:[function(t,e,i){"use strict";t("./CCParticleAsset"),t("./CCParticleSystem"),t("./particle-simulator"),t("./particle-system-assembler")},{"./CCParticleAsset":294,"./CCParticleSystem":295,"./particle-simulator":298,"./particle-system-assembler":299}],298:[function(e,i,n){"use strict";function r(){this.pos=cc.v2(0,0),this.startPos=cc.v2(0,0),this.color=cc.color(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=cc.v2(0,0),this.aspectRatio=1,this.dir=cc.v2(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0}function t(t){this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this._uvFilled=0}var m=e("../core/utils/affine-transform"),s=e("../core/platform/js"),y=e("../core/utils/misc"),g=cc.v2(0,0),v=m.create(),x=cc.v2(),b=cc.v2(),A=cc.v2(),C=cc.v2(),S=new s.Pool(function(t){t.pos.set(g),t.startPos.set(g),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(g),t.aspectRatio=1,t.dir.set(g),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0},1024);S.get=function(){return this._get()||new r};t.prototype.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},t.prototype.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)S.put(t[e]);t.length=0},t.prototype.emitParticle=function(h){var t,e=this.sys,i=y.clampf,n=S.get(),r=(this.particles.push(n),n.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2,n.timeToLive=Math.max(0,n.timeToLive)),s=(n.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,n.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2,e._startColor),o=e._startColorVar,a=e._endColor,c=e._endColorVar,o=(n.color.r=t=i(s.r+o.r*(Math.random()-.5)*2,0,255),n.color.g=l=i(s.g+o.g*(Math.random()-.5)*2,0,255),n.color.b=u=i(s.b+o.b*(Math.random()-.5)*2,0,255),n.color.a=s=i(s.a+o.a*(Math.random()-.5)*2,0,255),n.deltaColor.r=(i(a.r+c.r*(Math.random()-.5)*2,0,255)-t)/r,n.deltaColor.g=(i(a.g+c.g*(Math.random()-.5)*2,0,255)-l)/r,n.deltaColor.b=(i(a.b+c.b*(Math.random()-.5)*2,0,255)-u)/r,n.deltaColor.a=(i(a.a+c.a*(Math.random()-.5)*2,0,255)-s)/r,e.startSize+e.startSizeVar*(Math.random()-.5)*2),o=Math.max(0,o),l=(n.size=o,e.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?n.deltaSize=0:(t=e.endSize+e.endSizeVar*(Math.random()-.5)*2,t=Math.max(0,t),n.deltaSize=(t-o)/r),e.startSpin+e.startSpinVar*(Math.random()-.5)*2),u=e.endSpin+e.endSpinVar*(Math.random()-.5)*2,i=(n.rotation=l,n.deltaRotation=(u-l)/r,n.startPos.x=h.x,n.startPos.y=h.y,n.aspectRatio=e._aspectRatio||1,function(t){var e=0,i=t;for(;i;)e+=i.angle,i=i.parent;return e}(e.node)),a=e.positionType===cc.ParticleSystem.PositionType.FREE?e.angle+i:e.angle,c=y.degreesToRadians(a+e.angleVar*(Math.random()-.5)*2);e.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(s=e.speed+e.speedVar*(Math.random()-.5)*2,n.dir.x=Math.cos(c),n.dir.y=Math.sin(c),n.dir.mulSelf(s),n.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(n.rotation=-y.radiansToDegrees(Math.atan2(n.dir.y,n.dir.x)))):(t=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,o=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2,n.radius=t,n.deltaRadius=e.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(o-t)/r,n.angle=c,n.degreesPerSecond=y.degreesToRadians(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2))},t.prototype.updateUVs=function(t){var e=this.sys._assembler;if(e){var i=e.getBuffer();if(i&&this.sys._renderSpriteFrame){for(var n=4*e._vfmt._bytes/4,r=i._vData,s=this.sys._renderSpriteFrame.uv,e=t?0:this._uvFilled,o=this.particles.length,a=e;a<o;a++){var c=a*n;r[2+c]=s[0],r[3+c]=s[1],r[7+c]=s[2],r[8+c]=s[3],r[12+c]=s[4],r[13+c]=s[5],r[17+c]=s[6],r[18+c]=s[7]}this._uvFilled=o}}},t.prototype.updateParticleBuffer=function(t,e,h,i){var u,_,d,n,r,s=h._vData,h=h._uintVData,o=e.x,e=e.y,a=t.size,c=a,l=t.aspectRatio,l=(1<l?c=a/l:a=c*l,a/2),a=c/2;t.rotation?(c=-l,u=-a,_=l,d=a,r=-y.degreesToRadians(t.rotation),n=Math.cos(r),r=Math.sin(r),s[i]=c*n-u*r+o,s[i+1]=c*r+u*n+e,s[i+5]=_*n-u*r+o,s[i+6]=_*r+u*n+e,s[i+10]=c*n-d*r+o,s[i+11]=c*r+d*n+e,s[i+15]=_*n-d*r+o,s[i+16]=_*r+d*n+e):(s[i]=o-l,s[i+1]=e-a,s[i+5]=o+l,s[i+6]=e-a,s[i+10]=o-l,s[i+11]=e+a,s[i+15]=o+l,s[i+16]=e+a),h[i+4]=t.color._val,h[i+9]=t.color._val,h[i+14]=t.color._val,h[i+19]=t.color._val},t.prototype.step=function(t){t=t>cc.director._maxParticleDeltaTime?cc.director._maxParticleDeltaTime:t;var h,e=this.sys,u=e.node,i=this.particles,_=4*this.sys._assembler._vfmt._bytes/4,d=(u._updateWorldMatrix(),v=m.identity(),e.positionType===cc.ParticleSystem.PositionType.FREE?(n=u._worldMatrix.m,v.tx=n[12],v.ty=n[13],m.transformVec2(x,g,v)):e.positionType===cc.ParticleSystem.PositionType.RELATIVE&&(n=y.degreesToRadians(-u.angle),h=Math.cos(n),n=Math.sin(n),v=m.create(h,-n,n,h,0,0),x.x=u.x,x.y=u.y),m.invert(v,v),v);if(this.active&&e.emissionRate){var f=1/e.emissionRate;for(i.length<e.totalParticles&&(this.emitCounter+=t);i.length<e.totalParticles&&this.emitCounter>f;)this.emitParticle(x),this.emitCounter-=f;this.elapsed+=t,-1!==e.duration&&e.duration<this.elapsed&&e.stopSystem()}for(var p=e._assembler.getBuffer(),n=i.length,r=(p.reset(),p.request(4*n,6*n),n>this._uvFilled&&this.updateUVs(),0);r<i.length;){b.x=b.y=A.x=A.y=C.x=C.y=0;var s,o,a,c,l=i[r];l.timeToLive-=t,0<l.timeToLive?(e.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(c=C,o=b,a=A,(l.pos.x||l.pos.y)&&(o.set(l.pos),o.normalizeSelf()),a.set(o),o.mulSelf(l.radialAccel),s=a.x,a.x=-a.y,a.y=s,a.mulSelf(l.tangentialAccel),c.set(o),c.addSelf(a),c.addSelf(e.gravity),c.mulSelf(t),l.dir.addSelf(c),c.set(l.dir),c.mulSelf(t),l.pos.addSelf(c)):(l.angle+=l.degreesPerSecond*t,l.radius+=l.deltaRadius*t,l.pos.x=-Math.cos(l.angle)*l.radius,l.pos.y=-Math.sin(l.angle)*l.radius),l.color.r+=l.deltaColor.r*t,l.color.g+=l.deltaColor.g*t,l.color.b+=l.deltaColor.b*t,l.color.a+=l.deltaColor.a*t,l.size+=l.deltaSize*t,l.size<0&&(l.size=0),l.rotation+=l.deltaRotation*t,s=b,o=A,e.positionType===cc.ParticleSystem.PositionType.FREE?(o.set(l.startPos),o.negSelf(),s.set(l.pos),s.subSelf(o)):e.positionType===cc.ParticleSystem.PositionType.RELATIVE?(a=C,m.transformVec2(o,x,d),m.transformVec2(a,l.startPos,d),o.subSelf(a),s.set(l.pos),s.subSelf(o)):s.set(l.pos),this.updateParticleBuffer(l,s,p,_*r),++r):(c=i[r],r!==i.length-1&&(i[r]=i[i.length-1]),S.put(c),i.length--)}0<i.length?(p.uploadData(),e._assembler._ia._count=6*i.length):this.active||this.readyToPlay||(this.finished=!0,e._finishedSimulation())},i.exports=t},{"../core/platform/js":209,"../core/utils/affine-transform":254,"../core/utils/misc":264}],299:[function(t,e,h){"use strict";var i=r(t("../core/renderer/assembler")),n=r(t("../renderer/core/input-assembler"));function r(t){return t&&t.__esModule?t:{default:t}}function u(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o,a,_=t("./CCParticleSystem"),d=t("../core/renderer/"),f=t("../core/renderer/webgl/quad-buffer"),c=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor,t=(o=i.default,t=o,(a=l).prototype=Object.create(t.prototype),(a.prototype.constructor=a).__proto__=t,u(l),(a=l.prototype).getBuffer=function(){return this._buffer||(this._buffer=new f(d._handle,c),this._ia=new n.default,this._ia._vertexBuffer=this._buffer._vb,this._ia._indexBuffer=this._buffer._ib,this._ia._start=0,this._ia._count=0),this._buffer},a.fillBuffers=function(t,e){this._ia&&(e.node=t.node,e.material=t._materials[0],e._flushIA(this._ia))},l);function l(t){t=o.call(this,t)||this;return t._buffer=null,t._ia=null,t._vfmt=c,t}i.default.register(_,t),e.exports=t},{"../core/renderer/":220,"../core/renderer/assembler":217,"../core/renderer/webgl/quad-buffer":249,"../core/renderer/webgl/vertex-format":252,"../renderer/core/input-assembler":302,"./CCParticleSystem":295}],300:[function(h,u,_){"use strict";var e,i,d=512,f=513,p=514,m=515,y=516,g=517,v=518,x=519,b=32774,A=32778,C=32779,S=0,T=1,w=768,E=769,M=774,I=775,B=770,R=771,P=772,D=773,L=32769,V=32770,O=32771,F=32772,N=776,k=7680,G=7681,z=7682,U=34055,W=7683,H=34056,j=5386,X=0,Y=1028,q=1029;(a=e=e||{})[a.UNKNOWN=0]="UNKNOWN",a[a.BUFFER=1]="BUFFER",a[a.TEXTURE=2]="TEXTURE",a[a.TEXTURE_VIEW=3]="TEXTURE_VIEW",a[a.RENDER_PASS=4]="RENDER_PASS",a[a.FRAMEBUFFER=5]="FRAMEBUFFER",a[a.SAMPLER=6]="SAMPLER",a[a.SHADER=7]="SHADER",a[a.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",a[a.PIPELINE_STATE=9]="PIPELINE_STATE",a[a.BINDING_LAYOUT=10]="BINDING_LAYOUT",a[a.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",a[a.COMMAND_ALLOCATOR=12]="COMMAND_ALLOCATOR",a[a.COMMAND_BUFFER=13]="COMMAND_BUFFER",a[a.QUEUE=14]="QUEUE",a[a.WINDOW=15]="WINDOW",(a=i=i||{})[a.UNREADY=0]="UNREADY",a[a.FAILED=1]="FAILED",a[a.SUCCESS=2]="SUCCESS";var n,t,r;Object.defineProperty(J.prototype,"gfxType",{get:function(){return this._gfxType},enumerable:!0,configurable:!0}),Object.defineProperty(J.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});function J(t){this._gfxType=e.UNKNOWN,this._status=i.UNREADY,this._gfxType=t}(a=n=n||{})[a.UNKNOWN=0]="UNKNOWN",a[a.BOOL=1]="BOOL",a[a.BOOL2=2]="BOOL2",a[a.BOOL3=3]="BOOL3",a[a.BOOL4=4]="BOOL4",a[a.INT=5]="INT",a[a.INT2=6]="INT2",a[a.INT3=7]="INT3",a[a.INT4=8]="INT4",a[a.UINT=9]="UINT",a[a.UINT2=10]="UINT2",a[a.UINT3=11]="UINT3",a[a.UINT4=12]="UINT4",a[a.FLOAT=13]="FLOAT",a[a.FLOAT2=14]="FLOAT2",a[a.FLOAT3=15]="FLOAT3",a[a.FLOAT4=16]="FLOAT4",a[a.COLOR4=17]="COLOR4",a[a.MAT2=18]="MAT2",a[a.MAT2X3=19]="MAT2X3",a[a.MAT2X4=20]="MAT2X4",a[a.MAT3X2=21]="MAT3X2",a[a.MAT3=22]="MAT3",a[a.MAT3X4=23]="MAT3X4",a[a.MAT4X2=24]="MAT4X2",a[a.MAT4X3=25]="MAT4X3",a[a.MAT4=26]="MAT4",a[a.SAMPLER1D=27]="SAMPLER1D",a[a.SAMPLER1D_ARRAY=28]="SAMPLER1D_ARRAY",a[a.SAMPLER2D=29]="SAMPLER2D",a[a.SAMPLER2D_ARRAY=30]="SAMPLER2D_ARRAY",a[a.SAMPLER3D=31]="SAMPLER3D",a[a.SAMPLER_CUBE=32]="SAMPLER_CUBE",a[a.COUNT=33]="COUNT",(a=c=c||{})[a.UNKNOWN=0]="UNKNOWN",a[a.A8=1]="A8",a[a.L8=2]="L8",a[a.LA8=3]="LA8",a[a.R8=4]="R8",a[a.R8SN=5]="R8SN",a[a.R8UI=6]="R8UI",a[a.R8I=7]="R8I",a[a.R16F=8]="R16F",a[a.R16UI=9]="R16UI",a[a.R16I=10]="R16I",a[a.R32F=11]="R32F",a[a.R32UI=12]="R32UI",a[a.R32I=13]="R32I",a[a.RG8=14]="RG8",a[a.RG8SN=15]="RG8SN",a[a.RG8UI=16]="RG8UI",a[a.RG8I=17]="RG8I",a[a.RG16F=18]="RG16F",a[a.RG16UI=19]="RG16UI",a[a.RG16I=20]="RG16I",a[a.RG32F=21]="RG32F",a[a.RG32UI=22]="RG32UI",a[a.RG32I=23]="RG32I",a[a.RGB8=24]="RGB8",a[a.SRGB8=25]="SRGB8",a[a.RGB8SN=26]="RGB8SN",a[a.RGB8UI=27]="RGB8UI",a[a.RGB8I=28]="RGB8I",a[a.RGB16F=29]="RGB16F",a[a.RGB16UI=30]="RGB16UI",a[a.RGB16I=31]="RGB16I",a[a.RGB32F=32]="RGB32F",a[a.RGB32UI=33]="RGB32UI",a[a.RGB32I=34]="RGB32I",a[a.RGBA8=35]="RGBA8",a[a.SRGB8_A8=36]="SRGB8_A8",a[a.RGBA8SN=37]="RGBA8SN",a[a.RGBA8UI=38]="RGBA8UI",a[a.RGBA8I=39]="RGBA8I",a[a.RGBA16F=40]="RGBA16F",a[a.RGBA16UI=41]="RGBA16UI",a[a.RGBA16I=42]="RGBA16I",a[a.RGBA32F=43]="RGBA32F",a[a.RGBA32UI=44]="RGBA32UI",a[a.RGBA32I=45]="RGBA32I",a[a.R5G6B5=46]="R5G6B5",a[a.R11G11B10F=47]="R11G11B10F",a[a.RGB5A1=48]="RGB5A1",a[a.RGBA4=49]="RGBA4",a[a.RGB10A2=50]="RGB10A2",a[a.RGB10A2UI=51]="RGB10A2UI",a[a.RGB9E5=52]="RGB9E5",a[a.D16=53]="D16",a[a.D16S8=54]="D16S8",a[a.D24=55]="D24",a[a.D24S8=56]="D24S8",a[a.D32F=57]="D32F",a[a.D32F_S8=58]="D32F_S8",a[a.BC1=59]="BC1",a[a.BC1_ALPHA=60]="BC1_ALPHA",a[a.BC1_SRGB=61]="BC1_SRGB",a[a.BC1_SRGB_ALPHA=62]="BC1_SRGB_ALPHA",a[a.BC2=63]="BC2",a[a.BC2_SRGB=64]="BC2_SRGB",a[a.BC3=65]="BC3",a[a.BC3_SRGB=66]="BC3_SRGB",a[a.BC4=67]="BC4",a[a.BC4_SNORM=68]="BC4_SNORM",a[a.BC5=69]="BC5",a[a.BC5_SNORM=70]="BC5_SNORM",a[a.BC6H_UF16=71]="BC6H_UF16",a[a.BC6H_SF16=72]="BC6H_SF16",a[a.BC7=73]="BC7",a[a.BC7_SRGB=74]="BC7_SRGB",a[a.ETC_RGB8=75]="ETC_RGB8",a[a.ETC2_RGB8=76]="ETC2_RGB8",a[a.ETC2_SRGB8=77]="ETC2_SRGB8",a[a.ETC2_RGB8_A1=78]="ETC2_RGB8_A1",a[a.ETC2_SRGB8_A1=79]="ETC2_SRGB8_A1",a[a.ETC2_RGBA8=80]="ETC2_RGBA8",a[a.ETC2_SRGB8_A8=81]="ETC2_SRGB8_A8",a[a.EAC_R11=82]="EAC_R11",a[a.EAC_R11SN=83]="EAC_R11SN",a[a.EAC_RG11=84]="EAC_RG11",a[a.EAC_RG11SN=85]="EAC_RG11SN",a[a.PVRTC_RGB2=86]="PVRTC_RGB2",a[a.PVRTC_RGBA2=87]="PVRTC_RGBA2",a[a.PVRTC_RGB4=88]="PVRTC_RGB4",a[a.PVRTC_RGBA4=89]="PVRTC_RGBA4",a[a.PVRTC2_2BPP=90]="PVRTC2_2BPP",a[a.PVRTC2_4BPP=91]="PVRTC2_4BPP",t=t||{},t[t.DEFAULT=100]="DEFAULT",(a=r=r||{})[a.MIN=0]="MIN",a[a.MAX=255]="MAX",a[a.DEFAULT=128]="DEFAULT";(a=s=s||{})[a.UBO_GLOBAL=23]="UBO_GLOBAL",a[a.UBO_SHADOW=22]="UBO_SHADOW",a[a.UBO_LOCAL=21]="UBO_LOCAL",a[a.UBO_FORWARD_LIGHTS=20]="UBO_FORWARD_LIGHTS",a[a.UBO_SKINNING=19]="UBO_SKINNING",a[a.UBO_SKINNING_TEXTURE=18]="UBO_SKINNING_TEXTURE",a[a.UBO_UI=17]="UBO_UI",a[a.SAMPLER_JOINTS=25]="SAMPLER_JOINTS",a[a.SAMPLER_ENVIRONMENT=26]="SAMPLER_ENVIRONMENT",a[a.CUSTUM_UBO_BINDING_END_POINT=17]="CUSTUM_UBO_BINDING_END_POINT",a[a.CUSTOM_SAMPLER_BINDING_START_POINT=30]="CUSTOM_SAMPLER_BINDING_START_POINT",(a=Z=Z||{})[a.minFilter=0]="minFilter",a[a.magFilter=1]="magFilter",a[a.mipFilter=2]="mipFilter",a[a.addressU=3]="addressU",a[a.addressV=4]="addressV",a[a.addressW=5]="addressW",a[a.maxAnisotropy=6]="maxAnisotropy",a[a.cmpFunc=7]="cmpFunc",a[a.minLOD=8]="minLOD",a[a.maxLOD=9]="maxLOD",a[a.mipLODBias=10]="mipLODBias",a[a.borderColor=11]="borderColor",a[a.total=15]="total";var s,Z,o,a={},c=(a[a.bool=n.BOOL]="bool",a[a.int=n.INT]="int",a[a.ivec2=n.INT2]="ivec2invTypeParams",a[a.ivec3=n.INT3]="ivec3",a[a.ivec4=n.INT4]="ivec4",a[a.float=n.FLOAT]="float",a[a.vec2=n.FLOAT2]="vec2",a[a.vec3=n.FLOAT3]="vec3",a[a.vec4=n.FLOAT4]="vec4",a[a.mat2=n.MAT2]="mat2",a[a.mat3=n.MAT3]="mat3",a[a.mat4=n.MAT4]="mat4",a[a.sampler2D=n.SAMPLER2D]="sampler2D",a[a.samplerCube=n.SAMPLER_CUBE]="samplerCube",(o={})[n.BOOL]=4,o[n.INT]=4,o[n.INT2]=8,o[n.INT3]=12,o[n.INT4]=16,o[n.FLOAT]=4,o[n.FLOAT2]=8,o[n.FLOAT3]=12,o[n.FLOAT4]=16,o[n.MAT2]=16,o[n.MAT3]=36,o[n.MAT4]=64,o[n.SAMPLER2D]=4,o[n.SAMPLER_CUBE]=4,(l={})[n.BOOL]=c.R32I,l[n.INT]=c.R32I,l[n.INT2]=c.RG32I,l[n.INT3]=c.RGB32I,l[n.INT4]=c.RGBA32I,l[n.FLOAT]=c.R32F,l[n.FLOAT2]=c.RG32F,l[n.FLOAT3]=c.RGB32F,l[n.FLOAT4]=c.RGBA32F,l),l={BACK:q,FRONT:Y,NONE:X,ADD:b,SUB:A,REV_SUB:C,ZERO:S,ONE:T,SRC_COLOR:w,ONE_MINUS_SRC_COLOR:E,DST_COLOR:M,ONE_MINUS_DST_COLOR:I,SRC_ALPHA:B,ONE_MINUS_SRC_ALPHA:R,DST_ALPHA:P,ONE_MINUS_DST_ALPHA:D,CONSTANT_COLOR:L,ONE_MINUS_CONSTANT_COLOR:V,CONSTANT_ALPHA:O,ONE_MINUS_CONSTANT_ALPHA:F,SRC_ALPHA_SATURATE:N,NEVER:d,LESS:f,EQUAL:p,LEQUAL:m,GREATER:y,NOTEQUAL:g,GEQUAL:v,ALWAYS:x,KEEP:k,REPLACE:G,INCR:z,INCR_WRAP:U,DECR:W,DECR_WRAP:H,INVERT:j};Object.assign(l,t);u.exports={murmurhash2_32_gc:function(t,e){for(var i,n=t.length,r=e^n,s=0;4<=n;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),n-=4,++s;switch(n){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0},SamplerInfoIndex:Z,effectStructure:{$techniques:[{$passes:[{depthStencilState:{},rasterizerState:{},blendState:{targets:[{}]},properties:{any:{sampler:{},inspector:{}}}}]}]},typeMap:a,sizeMap:o,formatMap:c,passParams:l,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderPriority:r,GFXGetTypeSize:function(t){switch(t){case n.BOOL:case n.INT:case n.UINT:case n.FLOAT:return 4;case n.BOOL2:case n.INT2:case n.UINT2:case n.FLOAT2:return 8;case n.BOOL3:case n.INT3:case n.UINT3:case n.FLOAT3:return 12;case n.BOOL4:case n.INT4:case n.UINT4:case n.FLOAT4:case n.MAT2:return 16;case n.MAT2X3:return 24;case n.MAT2X4:return 32;case n.MAT3X2:return 24;case n.MAT3:return 36;case n.MAT3X4:return 48;case n.MAT4X2:case n.MAT4X2:return 32;case n.MAT4:return 64;case n.SAMPLER1D:case n.SAMPLER1D_ARRAY:case n.SAMPLER2D:case n.SAMPLER2D_ARRAY:case n.SAMPLER3D:case n.SAMPLER_CUBE:return 4;default:return 0}},UniformBinding:s}},{}],301:[function(t,r,e){"use strict";e.__esModule=!0,e.default=void 0;var i=t("../memop"),y=n(t("../enums")),g=t("../../core/value-types"),s=n(t("./program-lib")),o=n(t("./view")),A=n(t("../gfx"));function n(t){return t&&t.__esModule?t:{default:t}}var m=new g.Mat4,v=new i.RecyclePool(function(){return{stage:null,items:null}},8),C=new i.RecyclePool(function(){return new Float32Array(2)},8),S=new i.RecyclePool(function(){return new Float32Array(3)},8),T=new i.RecyclePool(function(){return new Float32Array(4)},8),w=new i.RecyclePool(function(){return new Float32Array(9)},8),x=new i.RecyclePool(function(){return new Float32Array(16)},8),E=new i.RecyclePool(function(){return new Float32Array(64)},8),M=new i.RecyclePool(function(){return new Int32Array(2)},8),I=new i.RecyclePool(function(){return new Int32Array(3)},8),B=new i.RecyclePool(function(){return new Int32Array(4)},8),b=new i.RecyclePool(function(){return new Int32Array(64)},8);function a(t,e){this._device=t,this._programLib=new s.default(t),this._opts=e,this._type2defaultValue=((t={})[y.default.PARAM_INT]=0,t[y.default.PARAM_INT2]=new g.Vec2(0,0),t[y.default.PARAM_INT3]=new g.Vec3(0,0,0),t[y.default.PARAM_INT4]=new g.Vec4(0,0,0,0),t[y.default.PARAM_FLOAT]=0,t[y.default.PARAM_FLOAT2]=new g.Vec2(0,0),t[y.default.PARAM_FLOAT3]=new g.Vec3(0,0,0),t[y.default.PARAM_FLOAT4]=new g.Vec4(0,0,0,0),t[y.default.PARAM_COLOR4]=new g.Color(0,0,0,1),t[y.default.PARAM_MAT3]=new g.Mat3,t[y.default.PARAM_MAT4]=new g.Mat4,t[y.default.PARAM_TEXTURE_2D]=e.defaultTexture,t[y.default.PARAM_TEXTURE_CUBE]=e.defaultTextureCube,t),this._stage2fn={},this._usedTextureUnits=0,this._viewPools=new i.RecyclePool(function(){return new o.default},8),this._drawItemsPools=new i.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,uniforms:null}},100),this._stageItemsPools=new i.RecyclePool(function(){return new i.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,passes:[],sortKey:-1,uniforms:null}},100)},16)}(t=a.prototype)._resetTextuerUnit=function(){this._usedTextureUnits=0},t._allocTextureUnit=function(){var t=this._device,e=this._usedTextureUnits;return e>=t._caps.maxTextureUnits&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+t._caps.maxTextureUnits),this._usedTextureUnits+=1,e},t._registerStage=function(t,e){this._stage2fn[t]=e},t.clear=function(){this._programLib.clear(),this.reset()},t.reset=function(){this._viewPools.reset(),this._stageItemsPools.reset()},t._requestView=function(){return this._viewPools.add()},t._render=function(t,h){var e=this._device,i=(e.setFrameBuffer(t._framebuffer),e.setViewport(t._rect.x,t._rect.y,t._rect.w,t._rect.h),{});t._clearFlags&y.default.CLEAR_COLOR&&(i.color=g.Vec4.toArray([],t._color)),t._clearFlags&y.default.CLEAR_DEPTH&&(i.depth=t._depth),t._clearFlags&y.default.CLEAR_STENCIL&&(i.stencil=t._stencil),e.clear(i),this._drawItemsPools.reset();for(var n=0;n<h._models.length;++n){var u,_=h._models.data[n];0!=(_._cullingMask&t._cullingMask)&&(u=this._drawItemsPools.add(),_.extractDrawItem(u))}v.reset();for(var r=0;r<t._stages.length;++r){var d=t._stages[r],s=this._stageItemsPools.add();s.reset();for(var o=0;o<this._drawItemsPools.length;++o){var a,c=this._drawItemsPools.data[o],l=c.effect.stagePasses[d];l&&0!==l.length&&((a=s.add()).passes=l,a.model=c.model,a.node=c.node,a.ia=c.ia,a.effect=c.effect,a.defines=c.defines,a.sortKey=-1,a.uniforms=c.uniforms)}var f=v.add();f.stage=d,f.items=s}for(var p=0;p<v.length;++p){var m=v.data[p];(0,this._stage2fn[m.stage])(t,m.items)}},t._setProperty=function(t){var e=this._device,i=t.value;if(void 0!==(i=void 0===(i=void 0===i?t.val:i)?this._type2defaultValue[t.type]:i))if(t.type===y.default.PARAM_TEXTURE_2D||t.type===y.default.PARAM_TEXTURE_CUBE)if(Array.isArray(i))if(i.length>t.count)console.error("Failed to set property ["+t.name+"] : The length of texture array ["+i.length+"] is bigger than ["+t.count+"].");else{for(var n=b.add(),r=0;r<i.length;++r)n[r]=this._allocTextureUnit();e.setTextureArray(t.name,i,n)}else e.setTexture(t.name,i,this._allocTextureUnit());else t.directly?e.setUniformDirectly(t.name,i):e.setUniform(t.name,i);else console.warn("Failed to set technique property "+t.name+", value not found.")},t._draw=function(t){for(var e=this._device,h=this._programLib,u=t.node,i=t.ia,n=t.passes,_=t.effect,r=(C.reset(),S.reset(),T.reset(),w.reset(),x.reset(),E.reset(),M.reset(),I.reset(),B.reset(),b.reset(),u.getWorldMatrix(m),e.setUniform("cc_matWorld",g.Mat4.toArray(x.add(),m)),g.Mat4.invert(m,m),g.Mat4.transpose(m,m),e.setUniform("cc_matWorldIT",g.Mat4.toArray(x.add(),m)),this._defines),s=0;s<n.length;++s){for(var o=n[s],d=i.count,a=(i._vertexBuffer&&e.setVertexBuffer(0,i._vertexBuffer),i._indexBuffer&&e.setIndexBuffer(i._indexBuffer),e.setPrimitiveType(i._primitiveType),Object.setPrototypeOf(r,o._defines),h.getProgram(o._programName,r,_.name)),c=(e.setProgram(a),a._uniforms),f=o._properties,l=0;l<c.length;l++){var p=f[c[l].name];void 0!==p&&this._setProperty(p)}e.setCullMode(o._cullMode),o._blend&&(e.enableBlend(),e.setBlendFuncSep(o._blendSrc,o._blendDst,o._blendSrcAlpha,o._blendDstAlpha),e.setBlendEqSep(o._blendEq,o._blendAlphaEq),e.setBlendColor32(o._blendColor)),o._depthTest&&(e.enableDepthTest(),e.setDepthFunc(o._depthFunc)),o._depthWrite&&e.enableDepthWrite(),e.setStencilTest(o._stencilTest),o._stencilTest===A.default.STENCIL_ENABLE&&(e.setStencilFuncFront(o._stencilFuncFront,o._stencilRefFront,o._stencilMaskFront),e.setStencilOpFront(o._stencilFailOpFront,o._stencilZFailOpFront,o._stencilZPassOpFront,o._stencilWriteMaskFront),e.setStencilFuncBack(o._stencilFuncBack,o._stencilRefBack,o._stencilMaskBack),e.setStencilOpBack(o._stencilFailOpBack,o._stencilZFailOpBack,o._stencilZPassOpBack,o._stencilWriteMaskBack)),e.draw(i._start,d),this._resetTextuerUnit()}},e.default=a,r.exports=e.default},{"../../core/value-types":279,"../enums":307,"../gfx":312,"../memop":324,"./program-lib":304,"./view":306}],302:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("../gfx"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t=a,(o=[{key:"count",get:function(){return-1!==this._count?this._count:this._indexBuffer?this._indexBuffer.count:this._vertexBuffer?this._vertexBuffer.count:0}}])&&r(t.prototype,o),s&&r(t,s);var s,o=a;function a(t,e,i){void 0===i&&(i=n.default.PT_TRIANGLES),this._vertexBuffer=t,this._indexBuffer=e,this._primitiveType=i,this._start=0,this._count=-1}i.default=o,e.exports=i.default},{"../gfx":312}],303:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var c=n(t("../gfx")),o=n(t("../enums")),a=n(t("../../core/value-types/value-type"));function n(t){return t&&t.__esModule?t:{default:t}}function l(t,e,i,n,r,s){void 0===r&&(r={}),void 0===s&&(s={}),this._name=t,this._detailName=e,this._programName=i,this._stage=n,this._properties=r,this._defines=s,this._cullMode=c.default.CULL_BACK,this._blend=!1,this._blendEq=c.default.BLEND_FUNC_ADD,this._blendAlphaEq=c.default.BLEND_FUNC_ADD,this._blendSrc=c.default.BLEND_SRC_ALPHA,this._blendDst=c.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendSrcAlpha=c.default.BLEND_SRC_ALPHA,this._blendDstAlpha=c.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendColor=4294967295,this._depthTest=!1,this._depthWrite=!1,this._depthFunc=c.default.DS_FUNC_LESS,this._stencilTest=c.default.STENCIL_INHERIT,this._stencilFuncFront=c.default.DS_FUNC_ALWAYS,this._stencilRefFront=0,this._stencilMaskFront=255,this._stencilFailOpFront=c.default.STENCIL_OP_KEEP,this._stencilZFailOpFront=c.default.STENCIL_OP_KEEP,this._stencilZPassOpFront=c.default.STENCIL_OP_KEEP,this._stencilWriteMaskFront=255,this._stencilFuncBack=c.default.DS_FUNC_ALWAYS,this._stencilRefBack=0,this._stencilMaskBack=255,this._stencilFailOpBack=c.default.STENCIL_OP_KEEP,this._stencilZFailOpBack=c.default.STENCIL_OP_KEEP,this._stencilZPassOpBack=c.default.STENCIL_OP_KEEP,this._stencilWriteMaskBack=255}(t=l.prototype).setCullMode=function(t){void 0===t&&(t=c.default.CULL_BACK),this._cullMode=t},t.setBlend=function(t,e,i,n,r,s,o,a){void 0===e&&(e=c.default.BLEND_FUNC_ADD),void 0===i&&(i=c.default.BLEND_SRC_ALPHA),void 0===n&&(n=c.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===r&&(r=c.default.BLEND_FUNC_ADD),void 0===s&&(s=c.default.BLEND_SRC_ALPHA),void 0===o&&(o=c.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===a&&(a=4294967295),this._blend=t=void 0===t?!1:t,this._blendEq=e,this._blendSrc=i,this._blendDst=n,this._blendAlphaEq=r,this._blendSrcAlpha=s,this._blendDstAlpha=o,this._blendColor=a},t.setDepth=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=c.default.DS_FUNC_LESS),this._depthTest=t=void 0===t?!1:t,this._depthWrite=e,this._depthFunc=i},t.setStencilFront=function(t,e,i,n,r,s,o,a){void 0===t&&(t=c.default.STENCIL_INHERIT),void 0===e&&(e=c.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===n&&(n=255),void 0===r&&(r=c.default.STENCIL_OP_KEEP),void 0===s&&(s=c.default.STENCIL_OP_KEEP),void 0===o&&(o=c.default.STENCIL_OP_KEEP),void 0===a&&(a=255),this._stencilTest=t,this._stencilFuncFront=e,this._stencilRefFront=i,this._stencilMaskFront=n,this._stencilFailOpFront=r,this._stencilZFailOpFront=s,this._stencilZPassOpFront=o,this._stencilWriteMaskFront=a},t.setStencilEnabled=function(t){void 0===t&&(t=c.default.STENCIL_INHERIT),this._stencilTest=t},t.setStencilBack=function(t,e,i,n,r,s,o,a){void 0===t&&(t=c.default.STENCIL_INHERIT),void 0===e&&(e=c.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===n&&(n=255),void 0===r&&(r=c.default.STENCIL_OP_KEEP),void 0===s&&(s=c.default.STENCIL_OP_KEEP),void 0===o&&(o=c.default.STENCIL_OP_KEEP),void 0===a&&(a=255),this._stencilTest=t,this._stencilFuncBack=e,this._stencilRefBack=i,this._stencilMaskBack=n,this._stencilFailOpBack=r,this._stencilZFailOpBack=s,this._stencilZPassOpBack=o,this._stencilWriteMaskBack=a},t.setStage=function(t){this._stage=t},t.setProperties=function(t){this._properties=t},t.getProperty=function(t){if(this._properties[t])return this._properties[t].value},t.setProperty=function(t,e,i){var n=this._properties[t];if(!n)return!1;if(n.directly=i,Array.isArray(e)){var r=n.value;if(r.length!==e.length)return void cc.warnID(9105,this._name,t);for(var s=0;s<e.length;s++)r[s]=e[s]}else e&&!ArrayBuffer.isView(e)?n.type===o.default.PARAM_TEXTURE_2D?n.value=e.getImpl():e instanceof a.default?e.constructor.toArray(n.value,e):("object"==typeof e&&cc.warnID(9106,this._name,t),n.value=e):n.value=e;return!0},t.getDefine=function(t){return this._defines[t]},t.define=function(t,e,i){if(!i&&void 0===this._defines[t])return!1;return this._defines[t]=e,!0},t.clone=function(){var t,e=new l(this._programName),i=(Object.assign(e,this),{}),n=this._properties;for(t in n){var r,s=n[t],o=i[t]={},a=s.value;for(r in Array.isArray(a)?o.value=a.concat():ArrayBuffer.isView(a)?o.value=new a.__proto__.constructor(a):o.value=a,s)"value"!==r&&(o[r]=s[r])}return e._properties=i,e._defines=Object.assign({},this._defines),e},i.default=l,e.exports=i.default},{"../../core/value-types/value-type":287,"../enums":307,"../gfx":312}],304:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var h=(t=t("../gfx"))&&t.__esModule?t:{default:t};var y=0;function u(t,e,i){for(var n=t,r=0;r<e.length;r++){var s=e[r].name,o=i[s];Number.isInteger(o)&&(s=new RegExp(s,"g"),n=n.replace(s,o))}return n}function _(t){return t.replace(/#pragma for (\w+) in range\(\s*(\d+)\s*,\s*(\d+)\s*\)([\s\S]+?)#pragma endFor/g,function(t,e,i,n,r){var s="",i=parseInt(i),o=parseInt(n);(i.isNaN||o.isNaN)&&console.error("Unroll For Loops Error: begin and end of range must be an int num.");for(var a=i;a<o;++a)s+=r.replace(new RegExp("{"+e+"}","g"),a);return s})}function d(t){return t.replace(/\bhighp\b/g,"mediump")}function n(t){this._device=t,this._templates={},this._cache={},this._checkPrecision()}(t=n.prototype).clear=function(){this._templates={},this._cache={}},t.define=function(t){var e=t.name,i=t.defines,n=t.glsl1||t,h=n.vert,n=n.frag;if(!this._templates[e]){for(var u=++y,_=0,r=0;r<i.length;++r){var s,o=i[r],d=1;"number"===o.type?(s=o.range||[],o.min=s[0]||0,o.max=s[1]||4,d=Math.ceil(Math.log2(o.max-o.min)),o._map=function(t){return t-this.min<<this._offset}.bind(o)):o._map=function(t){return t?1<<this._offset:0}.bind(o),o._offset=_,_+=d}var a=t.uniforms||[];if(t.samplers)for(var f=0;f<t.samplers.length;f++)a.push(t.samplers[f]);if(t.blocks)for(var c=0;c<t.blocks.length;c++)for(var p=t.blocks[c].defines,m=t.blocks[c].members,l=0;l<m.length;l++)a.push({defines:p,name:m[l].name,type:m[l].type});this._templates[e]={id:u,name:e,vert:h,frag:n,defines:i,attributes:t.attributes,uniforms:a,extensions:t.extensions}}},t.getTemplate=function(t){return this._templates[t]},t.hasProgram=function(t){return void 0!==this._templates[t]},t.getKey=function(t,e){for(var i=this._templates[t],n=0,r=0;r<i.defines.length;++r){var s=i.defines[r],o=e[s.name];void 0!==o&&(n|=s._map(o))}return i.id+":"+n},t.getProgram=function(t,e,n){var i=this.getKey(t,e),r=this._cache[i];if(r)return r;var t=this._templates[t],s=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n].name,s=e[r];"number"!=typeof s&&(s=s?1:0),i.push("#define "+r+" "+s)}return i.join("\n")+"\n"}(t.defines,e),o=s+_(o=u(t.vert,t.defines,e));this._highpSupported||(o=d(o));s+=_(s=u(t.frag,t.defines,e));this._highpSupported||(s=d(s));var a,c,l,e=(r=new h.default.Program(this._device,{vert:o,frag:s})).link();return e&&(a=o.split("\n"),c=s.split("\n"),l=t.defines.length,e.forEach(function(t){var e=t.line-1,i=t.line-l,e=("vs"===t.type?a:c)[e],i=t.info||"Failed to compile "+t.type+" "+t.fileID+" (ln "+i+"): \n "+t.message+": \n  "+e;cc.error(n+" : "+i)})),this._cache[i]=r},t._checkPrecision=function(){var t,e=this._device._gl,i=!1;e.getShaderPrecisionFormat&&(t=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),e=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),i=t&&0<t.precision&&e&&0<e.precision),i||cc.warnID(9102),this._highpSupported=i},i.default=n,e.exports=i.default},{"../gfx":312}],305:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.__esModule=!0,i.default=void 0;a.prototype.clone=function(){for(var t=[],e=0;e<this._passes.length;e++)t.push(this._passes[e].clone());return new a(this._name,t)},r=a,(o=[{key:"name",get:function(){return this._name}},{key:"passes",get:function(){return this._passes}}])&&n(r.prototype,o),s&&n(r,s);var r,s,o=a;function a(t,e){this._name=t,this._passes=e}i.default=o,e.exports=i.default},{}],306:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../../core/value-types"),r=(t=t("../enums"))&&t.__esModule?t:{default:t};var s=new n.Mat4,o=0;function a(){this._id=o++,this._priority=0,this._rect={x:0,y:0,w:1,h:1},this._color=new n.Vec4(.3,.3,.3,1),this._depth=1,this._stencil=0,this._clearFlags=r.default.CLEAR_COLOR|r.default.CLEAR_DEPTH,this._clearModel=null,this._matView=cc.mat4(),this._matViewInv=cc.mat4(),this._matProj=cc.mat4(),this._matViewProj=cc.mat4(),this._matInvViewProj=cc.mat4(),this._stages=[],this._cullingByID=!1,this._framebuffer=null,this._shadowLight=null,this._cullingMask=4294967295}(t=a.prototype).getForward=function(t){var e=this._matView.m;return n.Vec3.set(t,-e[2],-e[6],-e[10])},t.getPosition=function(t){return n.Mat4.invert(s,this._matView),n.Mat4.getTranslation(t,s)},i.default=a,e.exports=i.default},{"../../core/value-types":279,"../enums":307}],307:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./build/mappings"),t={PROJ_PERSPECTIVE:0,PROJ_ORTHO:1,LIGHT_DIRECTIONAL:0,LIGHT_POINT:1,LIGHT_SPOT:2,LIGHT_AMBIENT:3,SHADOW_NONE:0,SHADOW_HARD:1,SHADOW_SOFT:2,PARAM_INT:t.typeMap.int,PARAM_INT2:t.typeMap.ivec2,PARAM_INT3:t.typeMap.ivec3,PARAM_INT4:t.typeMap.ivec4,PARAM_FLOAT:t.typeMap.float,PARAM_FLOAT2:t.typeMap.vec2,PARAM_FLOAT3:t.typeMap.vec3,PARAM_FLOAT4:t.typeMap.vec4,PARAM_MAT2:t.typeMap.mat2,PARAM_MAT3:t.typeMap.mat3,PARAM_MAT4:t.typeMap.mat4,PARAM_TEXTURE_2D:t.typeMap.sampler2D,PARAM_TEXTURE_CUBE:t.typeMap.samplerCube,CLEAR_COLOR:1,CLEAR_DEPTH:2,CLEAR_STENCIL:4,CLEAR_SKYBOX:8,BUFFER_VIEW_INT8:0,BUFFER_VIEW_UINT8:1,BUFFER_VIEW_INT16:2,BUFFER_VIEW_UINT16:3,BUFFER_VIEW_INT32:4,BUFFER_VIEW_UINT32:5,BUFFER_VIEW_FLOAT32:6};i.default=t,e.exports=i.default},{"./build/mappings":300}],308:[function(t,l,e){"use strict";e.__esModule=!0,e.default=void 0;var r=i(t("./state")),P=t("./enums"),h=i(t("./texture-2d")),u=i(t("./texture-cube"));function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t={})[5124]=function(t,e,i){t.uniform1i(e,i)},t[5126]=function(t,e,i){t.uniform1f(e,i)},t[35664]=function(t,e,i){t.uniform2fv(e,i)},t[35665]=function(t,e,i){t.uniform3fv(e,i)},t[35666]=function(t,e,i){t.uniform4fv(e,i)},t[35667]=function(t,e,i){t.uniform2iv(e,i)},t[35668]=function(t,e,i){t.uniform3iv(e,i)},t[35669]=function(t,e,i){t.uniform4iv(e,i)},t[35670]=function(t,e,i){t.uniform1i(e,i)},t[35671]=function(t,e,i){t.uniform2iv(e,i)},t[35672]=function(t,e,i){t.uniform3iv(e,i)},t[35673]=function(t,e,i){t.uniform4iv(e,i)},t[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i)},t[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i)},t[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i)},t[35678]=function(t,e,i){t.uniform1i(e,i)},t[35680]=function(t,e,i){t.uniform1i(e,i)};var D=t,L=((t={})[5124]=function(t,e,i){t.uniform1iv(e,i)},t[5126]=function(t,e,i){t.uniform1fv(e,i)},t[35664]=function(t,e,i){t.uniform2fv(e,i)},t[35665]=function(t,e,i){t.uniform3fv(e,i)},t[35666]=function(t,e,i){t.uniform4fv(e,i)},t[35667]=function(t,e,i){t.uniform2iv(e,i)},t[35668]=function(t,e,i){t.uniform3iv(e,i)},t[35669]=function(t,e,i){t.uniform4iv(e,i)},t[35670]=function(t,e,i){t.uniform1iv(e,i)},t[35671]=function(t,e,i){t.uniform2iv(e,i)},t[35672]=function(t,e,i){t.uniform3iv(e,i)},t[35673]=function(t,e,i){t.uniform4iv(e,i)},t[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i)},t[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i)},t[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i)},t[35678]=function(t,e,i){t.uniform1iv(e,i)},t[35680]=function(t,e,i){t.uniform1iv(e,i)},t);function o(t,e,i,n){void 0===n&&(n=0),i instanceof h.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,i._glID,0):i instanceof u.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i._glID,0):t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,i._glID)}t=c,(a=[{key:"caps",get:function(){return this._caps}}])&&n(t.prototype,a),s&&n(t,s),(a=c.prototype)._initExtensions=function(t){for(var e=this._gl,i=0;i<t.length;++i)for(var n=t[i],r=["","WEBKIT_","MOZ_"],s=0;s<r.length;s++)try{var o=e.getExtension(r[s]+n);if(o){this._extensions[n]=o;break}}catch(t){console.error(t)}},a._initCaps=function(){var t=this._gl,e=this.ext("WEBGL_draw_buffers");this._caps.maxVertexStreams=4,this._caps.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxFragUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this._caps.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._caps.maxDrawBuffers=e?t.getParameter(e.MAX_DRAW_BUFFERS_WEBGL):1,this._caps.maxColorAttachments=e?t.getParameter(e.MAX_COLOR_ATTACHMENTS_WEBGL):1},a._initStates=function(){var t=this._gl;t.disable(t.BLEND),t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),t.blendColor(1,1,1,1),t.colorMask(!0,!0,!0,!0),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.disable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.depthMask(!1),t.disable(t.POLYGON_OFFSET_FILL),t.depthRange(0,1),t.disable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,0,255),t.stencilMask(255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearDepth(1),t.clearColor(0,0,0,0),t.clearStencil(0),t.disable(t.SCISSOR_TEST)},a._restoreTexture=function(t){var e=this._gl,t=this._current.textureUnits[t];t&&-1!==t._glID?e.bindTexture(t._target,t._glID):e.bindTexture(e.TEXTURE_2D,null)},a._restoreIndexBuffer=function(){var t=this._gl,e=this._current.indexBuffer;e&&-1!==e._glID?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._glID):t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},a.ext=function(t){return this._extensions[t]},a.allowFloatTexture=function(){return null!=this.ext("OES_texture_float")},a.setFrameBuffer=function(t){if(this._framebuffer!==t){this._framebuffer=t;var e=this._gl;if(t){e.bindFramebuffer(e.FRAMEBUFFER,t._glID);for(var i=t._colors.length,n=0;n<i;++n){var r=t._colors[n];o(e,e.COLOR_ATTACHMENT0+n,r)}for(var s=i;s<this._caps.maxColorAttachments;++s)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,null,0);t._depth&&o(e,e.DEPTH_ATTACHMENT,t._depth),t._stencil&&o(e,e.STENCIL_ATTACHMENT,t._stencil),t._depthStencil&&o(e,e.DEPTH_STENCIL_ATTACHMENT,t._depthStencil)}else e.bindFramebuffer(e.FRAMEBUFFER,null)}},a.setViewport=function(t,e,i,n){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===n||(this._gl.viewport(t,e,i,n),this._vx=t,this._vy=e,this._vw=i,this._vh=n)},a.setScissor=function(t,e,i,n){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===n||(this._gl.scissor(t,e,i,n),this._sx=t,this._sy=e,this._sw=i,this._sh=n)},a.clear=function(t){var e,i;void 0===t.color&&void 0===t.depth&&void 0===t.stencil||(e=this._gl,void(i=0)!==t.color&&(i|=e.COLOR_BUFFER_BIT,e.clearColor(t.color[0],t.color[1],t.color[2],t.color[3])),void 0!==t.depth&&(i|=e.DEPTH_BUFFER_BIT,e.clearDepth(t.depth),e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.ALWAYS)),void 0!==t.stencil&&(i|=e.STENCIL_BUFFER_BIT,e.clearStencil(t.stencil)),e.clear(i),void 0!==t.depth&&(!1===this._current.depthTest?e.disable(e.DEPTH_TEST):(!1===this._current.depthWrite&&e.depthMask(!1),this._current.depthFunc!==P.enums.DS_FUNC_ALWAYS&&e.depthFunc(this._current.depthFunc))))},a.enableBlend=function(){this._next.blend=!0},a.enableDepthTest=function(){this._next.depthTest=!0},a.enableDepthWrite=function(){this._next.depthWrite=!0},a.setStencilTest=function(t){this._next.stencilTest=t},a.setStencilFunc=function(t,e,i){this._next.stencilSep=!1,this._next.stencilFuncFront=this._next.stencilFuncBack=t,this._next.stencilRefFront=this._next.stencilRefBack=e,this._next.stencilMaskFront=this._next.stencilMaskBack=i},a.setStencilFuncFront=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncFront=t,this._next.stencilRefFront=e,this._next.stencilMaskFront=i},a.setStencilFuncBack=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncBack=t,this._next.stencilRefBack=e,this._next.stencilMaskBack=i},a.setStencilOp=function(t,e,i,n){this._next.stencilFailOpFront=this._next.stencilFailOpBack=t,this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=e,this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=n},a.setStencilOpFront=function(t,e,i,n){this._next.stencilSep=!0,this._next.stencilFailOpFront=t,this._next.stencilZFailOpFront=e,this._next.stencilZPassOpFront=i,this._next.stencilWriteMaskFront=n},a.setStencilOpBack=function(t,e,i,n){this._next.stencilSep=!0,this._next.stencilFailOpBack=t,this._next.stencilZFailOpBack=e,this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskBack=n},a.setDepthFunc=function(t){this._next.depthFunc=t},a.setBlendColor32=function(t){this._next.blendColor=t},a.setBlendColor=function(t,e,i,n){this._next.blendColor=(255*t<<24|255*e<<16|255*i<<8|255*n)>>>0},a.setBlendFunc=function(t,e){this._next.blendSep=!1,this._next.blendSrc=t,this._next.blendDst=e},a.setBlendFuncSep=function(t,e,i,n){this._next.blendSep=!0,this._next.blendSrc=t,this._next.blendDst=e,this._next.blendSrcAlpha=i,this._next.blendDstAlpha=n},a.setBlendEq=function(t){this._next.blendSep=!1,this._next.blendEq=t},a.setBlendEqSep=function(t,e){this._next.blendSep=!0,this._next.blendEq=t,this._next.blendAlphaEq=e},a.setCullMode=function(t){this._next.cullMode=t},a.setVertexBuffer=function(t,e,i){void 0===i&&(i=0),this._next.vertexBuffers[t]=e,this._next.vertexBufferOffsets[t]=i,this._next.maxStream<t&&(this._next.maxStream=t)},a.setIndexBuffer=function(t){this._next.indexBuffer=t},a.setProgram=function(t){this._next.program=t},a.setTexture=function(t,e,i){i>=this._caps.maxTextureUnits?console.warn("Can not set texture "+t+" at stage "+i+", max texture exceed: "+this._caps.maxTextureUnits):(this._next.textureUnits[i]=e,this.setUniform(t,i),this._next.maxTextureSlot<i&&(this._next.maxTextureSlot=i))},a.setTextureArray=function(t,e,i){var n=e.length;if(n>=this._caps.maxTextureUnits)console.warn("Can not set "+n+" textures for "+t+", max texture exceed: "+this._caps.maxTextureUnits);else{for(var r=0;r<n;++r){var s=i[r];this._next.textureUnits[s]=e[r],this._next.maxTextureSlot<s&&(this._next.maxTextureSlot=s)}this.setUniform(t,i)}},a.setUniform=function(t,e){for(var i=this._uniforms[t],n=!1,h=!1,r=!1,s=!1;i&&(r=Array.isArray(e)||e instanceof Float32Array,s=e instanceof Int32Array,i.isArray===(h=r||s)&&(!i.isArray||i.value.length===e.length)&&(n=!0,0)););if(n){var o=i.value,a=!1;if(i.isArray)for(var c=0,u=o.length;c<u;c++)o[c]!==e[c]&&(a=!0,o[c]=e[c]);else o!==e&&(a=!0,i.value=e);a&&(i.dirty=!0)}else{var l=e;r?l=new Float32Array(e):s&&(l=new Int32Array(e)),i={dirty:!0,value:l,isArray:h}}this._uniforms[t]=i},a.setUniformDirectly=function(t,e){var i=this._uniforms[t];i||(this._uniforms[t]=i={}),i.dirty=!0,i.value=e},a.setPrimitiveType=function(t){this._next.primitiveType=t},a.resetDrawCalls=function(){this._stats.drawcalls=0},a.getDrawCalls=function(){return this._stats.drawcalls},a.draw=function(h,u){var t,e,i,n=this._gl,r=this._current,s=this._next,o=(!function(t,e,i){if(e.blend!==i.blend)return i.blend?(t.enable(t.BLEND),i.blendSrc!==P.enums.BLEND_CONSTANT_COLOR&&i.blendSrc!==P.enums.BLEND_ONE_MINUS_CONSTANT_COLOR&&i.blendDst!==P.enums.BLEND_CONSTANT_COLOR&&i.blendDst!==P.enums.BLEND_ONE_MINUS_CONSTANT_COLOR||t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq))):t.disable(t.BLEND);!1!==i.blend&&(e.blendColor!==i.blendColor&&t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),e.blendSep===i.blendSep?i.blendSep?(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst&&e.blendSrcAlpha===i.blendSrcAlpha&&e.blendDstAlpha===i.blendDstAlpha||t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),e.blendEq===i.blendEq&&e.blendAlphaEq===i.blendAlphaEq||t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst||t.blendFunc(i.blendSrc,i.blendDst),e.blendEq!==i.blendEq&&t.blendEquation(i.blendEq)):i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq)))}(n,r,s),function(t,e,i){if(e.depthTest!==i.depthTest)return i.depthTest?(t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc),t.depthMask(i.depthWrite)):t.disable(t.DEPTH_TEST);e.depthWrite!==i.depthWrite&&t.depthMask(i.depthWrite),!1!==i.depthTest?e.depthFunc!==i.depthFunc&&t.depthFunc(i.depthFunc):i.depthWrite&&(i.depthTest=!0,i.depthFunc=P.enums.DS_FUNC_ALWAYS,t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc))}(n,r,s),i=n,e=r,(t=s).stencilTest!==P.enums.STENCIL_INHERIT&&(t.stencilTest!==e.stencilTest?t.stencilTest===P.enums.STENCIL_DISABLE?i.disable(i.STENCIL_TEST):(i.enable(i.STENCIL_TEST),t.stencilSep?(i.stencilFuncSeparate(i.FRONT,t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront),i.stencilMaskSeparate(i.FRONT,t.stencilWriteMaskFront),i.stencilOpSeparate(i.FRONT,t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront),i.stencilFuncSeparate(i.BACK,t.stencilFuncBack,t.stencilRefBack,t.stencilMaskBack),i.stencilMaskSeparate(i.BACK,t.stencilWriteMaskBack),i.stencilOpSeparate(i.BACK,t.stencilFailOpBack,t.stencilZFailOpBack,t.stencilZPassOpBack)):(i.stencilFunc(t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront),i.stencilMask(t.stencilWriteMaskFront),i.stencilOp(t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront))):t.stencilTest!==P.enums.STENCIL_DISABLE&&(e.stencilSep===t.stencilSep?t.stencilSep?(e.stencilFuncFront===t.stencilFuncFront&&e.stencilRefFront===t.stencilRefFront&&e.stencilMaskFront===t.stencilMaskFront||i.stencilFuncSeparate(i.FRONT,t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront),e.stencilWriteMaskFront!==t.stencilWriteMaskFront&&i.stencilMaskSeparate(i.FRONT,t.stencilWriteMaskFront),e.stencilFailOpFront===t.stencilFailOpFront&&e.stencilZFailOpFront===t.stencilZFailOpFront&&e.stencilZPassOpFront===t.stencilZPassOpFront||i.stencilOpSeparate(i.FRONT,t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront),e.stencilFuncBack===t.stencilFuncBack&&e.stencilRefBack===t.stencilRefBack&&e.stencilMaskBack===t.stencilMaskBack||i.stencilFuncSeparate(i.BACK,t.stencilFuncBack,t.stencilRefBack,t.stencilMaskBack),e.stencilWriteMaskBack!==t.stencilWriteMaskBack&&i.stencilMaskSeparate(i.BACK,t.stencilWriteMaskBack),e.stencilFailOpBack===t.stencilFailOpBack&&e.stencilZFailOpBack===t.stencilZFailOpBack&&e.stencilZPassOpBack===t.stencilZPassOpBack||i.stencilOpSeparate(i.BACK,t.stencilFailOpBack,t.stencilZFailOpBack,t.stencilZPassOpBack)):(e.stencilFuncFront===t.stencilFuncFront&&e.stencilRefFront===t.stencilRefFront&&e.stencilMaskFront===t.stencilMaskFront||i.stencilFunc(t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront),e.stencilWriteMaskFront!==t.stencilWriteMaskFront&&i.stencilMask(t.stencilWriteMaskFront),e.stencilFailOpFront===t.stencilFailOpFront&&e.stencilZFailOpFront===t.stencilZFailOpFront&&e.stencilZPassOpFront===t.stencilZPassOpFront||i.stencilOp(t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront)):t.stencilSep?(i.stencilFuncSeparate(i.FRONT,t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront),i.stencilMaskSeparate(i.FRONT,t.stencilWriteMaskFront),i.stencilOpSeparate(i.FRONT,t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront),i.stencilFuncSeparate(i.BACK,t.stencilFuncBack,t.stencilRefBack,t.stencilMaskBack),i.stencilMaskSeparate(i.BACK,t.stencilWriteMaskBack),i.stencilOpSeparate(i.BACK,t.stencilFailOpBack,t.stencilZFailOpBack,t.stencilZPassOpBack)):(i.stencilFunc(t.stencilFuncFront,t.stencilRefFront,t.stencilMaskFront),i.stencilMask(t.stencilWriteMaskFront),i.stencilOp(t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilZPassOpFront)))),e=n,i=s,r.cullMode!==i.cullMode&&(i.cullMode!==P.enums.CULL_NONE?(e.enable(e.CULL_FACE),e.cullFace(i.cullMode)):e.disable(e.CULL_FACE)),this),_=n,d=r,a=s,f=!1;if(-1!==a.maxStream){if(d.maxStream!==a.maxStream)f=!0;else if(d.program!==a.program)f=!0;else for(var p=0;p<a.maxStream+1;++p)if(d.vertexBuffers[p]!==a.vertexBuffers[p]||d.vertexBufferOffsets[p]!==a.vertexBufferOffsets[p]){f=!0;break}if(f){for(var m=0;m<o._caps.maxVertexAttribs;++m)o._newAttributes[m]=0;for(var y=0;y<a.maxStream+1;++y){var g=a.vertexBuffers[y],v=a.vertexBufferOffsets[y];if(g&&-1!==g._glID){_.bindBuffer(_.ARRAY_BUFFER,g._glID);for(var x=0;x<a.program._attributes.length;++x){var c=a.program._attributes[x],l=g._format.element(c.name);l?(0===o._enabledAttributes[c.location]&&(_.enableVertexAttribArray(c.location),o._enabledAttributes[c.location]=1),o._newAttributes[c.location]=1,_.vertexAttribPointer(c.location,l.num,l.type,l.normalize,l.stride,l.offset+v*l.stride)):console.warn("Can not find vertex attribute: "+c.name)}}}for(var b=0;b<o._caps.maxVertexAttribs;++b)o._enabledAttributes[b]!==o._newAttributes[b]&&(_.disableVertexAttribArray(b),o._enabledAttributes[b]=0)}}r.indexBuffer!==s.indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.indexBuffer&&-1!==s.indexBuffer._glID?s.indexBuffer._glID:null);for(var A,C=!1,S=(r.program!==s.program&&(s.program._linked?n.useProgram(s.program._glID):console.warn("Failed to use program: has not linked yet."),C=!0),n),T=r,w=s,E=0;E<w.maxTextureSlot+1;++E)T.textureUnits[E]===w.textureUnits[E]||(A=w.textureUnits[E])&&-1!==A._glID&&(S.activeTexture(S.TEXTURE0+E),S.bindTexture(A._target,A._glID));for(var M=0;M<s.program._uniforms.length;++M){var I,B=s.program._uniforms[M],R=this._uniforms[B.name];R&&(C||R.dirty)&&(R.dirty=!1,(I=(void 0===B.size?D:L)[B.type])?I(n,B.location,R.value):console.warn("Can not find commit function for uniform "+B.name))}u&&(s.indexBuffer?n.drawElements(this._next.primitiveType,u,s.indexBuffer._format,h*s.indexBuffer._bytesPerIndex):n.drawArrays(this._next.primitiveType,h,u),this._stats.drawcalls++),r.set(s),s.reset()};var s,a,t=c;function c(t,e){var i;void 0===(e=e||{}).alpha&&(e.alpha=!1),void 0===e.stencil&&(e.stencil=!0),void 0===e.depth&&(e.depth=!0),void 0===e.antialias&&(e.antialias=!1),void 0===e.preserveDrawingBuffer&&(e.preserveDrawingBuffer=!1);try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)||t.getContext("webkit-3d",e)||t.getContext("moz-webgl",e)}catch(t){return void console.error(t)}i||console.error("This device does not support webgl"),this._gl=i,this._extensions={},this._caps={},this._stats={texture:0,vb:0,ib:0,drawcalls:0},this._initExtensions(["EXT_texture_filter_anisotropic","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]),this._initCaps(),this._initStates(),r.default.initDefault(this),this._current=new r.default(this),this._next=new r.default(this),this._uniforms={},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0,this._framebuffer=null,this._enabledAttributes=new Array(this._caps.maxVertexAttribs),this._newAttributes=new Array(this._caps.maxVertexAttribs);for(var n=0;n<this._caps.maxVertexAttribs;++n)this._enabledAttributes[n]=0,this._newAttributes[n]=0}e.default=t,l.exports=e.default},{"./enums":309,"./state":316,"./texture-2d":317,"./texture-cube":318}],309:[function(t,e,i){"use strict";i.__esModule=!0,i.attrTypeBytes=function(t){return t===a.ATTR_TYPE_INT8||t===a.ATTR_TYPE_UINT8?1:t===a.ATTR_TYPE_INT16||t===a.ATTR_TYPE_UINT16?2:t===a.ATTR_TYPE_INT32||t===a.ATTR_TYPE_UINT32||t===a.ATTR_TYPE_FLOAT32?4:(console.warn("Unknown ATTR_TYPE: "+t),0)},i.glFilter=function(t,e,i){void 0===i&&(i=-1);var n=s[e][i+1];return void 0!==n?n:(console.warn("Unknown FILTER: "+e),-1===i?t.LINEAR:t.LINEAR_MIPMAP_LINEAR)},i.glTextureFmt=function(t){var e=o[t];return void 0!==e?e:(console.warn("Unknown TEXTURE_FMT: "+t),o[a.TEXTURE_FMT_RGBA8])},i.enums=void 0;var n=6407,r=6408,s=[[9728,9984,9986],[9729,9985,9987]],o=[{format:n,internalFormat:33776,pixelType:null},{format:r,internalFormat:33777,pixelType:null},{format:r,internalFormat:33778,pixelType:null},{format:r,internalFormat:33779,pixelType:null},{format:n,internalFormat:36196,pixelType:null},{format:n,internalFormat:35841,pixelType:null},{format:r,internalFormat:35843,pixelType:null},{format:n,internalFormat:35840,pixelType:null},{format:r,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:n,internalFormat:n,pixelType:33635},{format:r,internalFormat:r,pixelType:32820},{format:r,internalFormat:r,pixelType:32819},{format:n,internalFormat:n,pixelType:5121},{format:r,internalFormat:r,pixelType:5121},{format:n,internalFormat:n,pixelType:36193},{format:r,internalFormat:r,pixelType:36193},{format:n,internalFormat:n,pixelType:5126},{format:r,internalFormat:r,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:n,internalFormat:37492,pixelType:null},{format:r,internalFormat:37496,pixelType:null}],a={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};i.enums=a},{}],310:[function(t,e,i){"use strict";var n;function r(t,e,i,n){this._device=t,this._width=e,this._height=i,this._colors=n.colors||[],this._depth=n.depth||null,this._stencil=n.stencil||null,this._depthStencil=n.depthStencil||null,this._glID=t._gl.createFramebuffer()}i.__esModule=!0,i.default=void 0,(n=r.prototype).destroy=function(){null!==this._glID?(this._device._gl.deleteFramebuffer(this._glID),this._glID=null):console.error("The frame-buffer already destroyed")},n.getHandle=function(){return this._glID},i.default=r,e.exports=i.default},{}],311:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./enums");function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(o={})[t.enums.INDEX_FMT_UINT8]=1,o[t.enums.INDEX_FMT_UINT16]=2,o[t.enums.INDEX_FMT_UINT32]=4;var r,s=o,o=((t=a.prototype).destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.ib-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},t.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numIndices=this._bytes/this._bytesPerIndex}var i=this._device._gl,n=this._usage;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,n),this._needExpandDataStore=!1):i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,t,e),this._device._restoreIndexBuffer()}}else console.error("The buffer is destroyed")},t.setUsage=function(t){this._usage=t},t=a,(o=[{key:"count",get:function(){return this._numIndices}}])&&n(t.prototype,o),r&&n(t,r),a);function a(t,e,i,n){this._device=t,this._format=e,this._usage=i,this._bytesPerIndex=s[e],this._bytes=n.byteLength,this._numIndices=this._bytes/this._bytesPerIndex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,n),t._stats.ib+=this._bytes}o.BYTES_PER_INDEX=s,i.default=o,e.exports=i.default},{"./enums":309}],312:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("./enums"),t={VertexFormat:t("./vertex-format"),IndexBuffer:t("./index-buffer"),VertexBuffer:t("./vertex-buffer"),Program:t("./program"),Texture:t("./texture"),Texture2D:t("./texture-2d"),TextureCube:t("./texture-cube"),RenderBuffer:t("./render-buffer"),FrameBuffer:t("./frame-buffer"),Device:t("./device"),attrTypeBytes:n.attrTypeBytes,glFilter:n.glFilter,glTextureFmt:n.glTextureFmt};Object.assign(t,n.enums),i.default=t,cc.gfx=t,e.exports=i.default},{"./device":308,"./enums":309,"./frame-buffer":310,"./index-buffer":311,"./program":314,"./render-buffer":315,"./texture":319,"./texture-2d":317,"./texture-cube":318,"./vertex-buffer":320,"./vertex-format":321}],313:[function(t,e,i){"use strict";i.__esModule=!0,i.isPow2=function(t){return!(t&t-1||!t)}},{}],314:[function(c,t,e){"use strict";function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}e.__esModule=!0,e.default=void 0;var n=0;function m(i,n,t){t.split("\n").forEach(function(t){var e;t.length<5||((e=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t))?i.push({type:n,fileID:0|e[1],line:0|e[2],message:e[3].trim()}):0<t.length&&i.push({type:n,fileID:-1,line:0,message:t}))})}(s=a.prototype).link=function(){if(!this._linked){var t=this._device._gl,e=y(t,t.VERTEX_SHADER,this._vertSource),i=y(t,t.FRAGMENT_SHADER,this._fragSource),n=t.createProgram(),r=(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),!1),s=this._errors;if(t.getShaderParameter(e,t.COMPILE_STATUS)||(m(s,"vs",t.getShaderInfoLog(e)),r=!0),t.getShaderParameter(i,t.COMPILE_STATUS)||(m(s,"fs",t.getShaderInfoLog(i)),r=!0),t.deleteShader(e),t.deleteShader(i),r)return s;if(!t.getProgramParameter(n,t.LINK_STATUS))return s.push({info:"Failed to link shader program: "+t.getProgramInfoLog(n)}),s;this._glID=n;for(var h=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES),o=0;o<h;++o){var a=t.getActiveAttrib(n,o),u=t.getAttribLocation(n,a.name);this._attributes.push({name:a.name,location:u,type:a.type})}for(var _=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),c=0;c<_;++c){var d=t.getActiveUniform(n,c),l=d.name,f=t.getUniformLocation(n,l),p="[0]"===l.substr(l.length-3),l={name:l=p?l.substr(0,l.length-3):l,location:f,type:d.type,size:p?d.size:void 0};this._uniforms.push(l)}this._linked=!0}},s.destroy=function(){this._device._gl.deleteProgram(this._glID),this._linked=!1,this._glID=null,this._attributes=[],this._uniforms=[],this._samplers=[]},s=a,(o=[{key:"id",get:function(){return this._id}}])&&i(s.prototype,o),r&&i(s,r);var r,s,o=a;function a(t,e){this._device=t,this._attributes=[],this._uniforms=[],this._samplers=[],this._errors=[],this._linked=!1,this._vertSource=e.vert,this._fragSource=e.frag,this._glID=null,this._id=n++}function y(t,e,i){e=t.createShader(e);return t.shaderSource(e,i),t.compileShader(e),e}e.default=o,t.exports=e.default},{}],315:[function(t,e,i){"use strict";var n;function r(t,e,i,n){this._device=t,this._format=e,this._glID=t._gl.createRenderbuffer(),this.update(i,n)}i.__esModule=!0,i.default=void 0,(n=r.prototype).update=function(t,e){this._width=t,this._height=e;var i=this._device._gl;i.bindRenderbuffer(i.RENDERBUFFER,this._glID),i.renderbufferStorage(i.RENDERBUFFER,this._format,t,e),i.bindRenderbuffer(i.RENDERBUFFER,null)},n.destroy=function(){var t;null!==this._glID?((t=this._device._gl).bindRenderbuffer(t.RENDERBUFFER,null),t.deleteRenderbuffer(this._glID),this._glID=null):console.error("The render-buffer already destroyed")},i.default=r,e.exports=i.default},{}],316:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var t=t("./enums"),n={blend:!1,blendSep:!1,blendColor:4294967295,blendEq:t.enums.BLEND_FUNC_ADD,blendAlphaEq:t.enums.BLEND_FUNC_ADD,blendSrc:t.enums.BLEND_ONE,blendDst:t.enums.BLEND_ZERO,blendSrcAlpha:t.enums.BLEND_ONE,blendDstAlpha:t.enums.BLEND_ZERO,depthTest:!1,depthWrite:!1,depthFunc:t.enums.DS_FUNC_LESS,stencilTest:!1,stencilSep:!1,stencilFuncFront:t.enums.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:t.enums.STENCIL_OP_KEEP,stencilZFailOpFront:t.enums.STENCIL_OP_KEEP,stencilZPassOpFront:t.enums.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:t.enums.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:t.enums.STENCIL_OP_KEEP,stencilZFailOpBack:t.enums.STENCIL_OP_KEEP,stencilZPassOpBack:t.enums.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:t.enums.CULL_BACK,primitiveType:t.enums.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,maxTextureSlot:-1,textureUnits:[],program:null};function r(t){this.vertexBuffers=new Array(t._caps.maxVertexStreams),this.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),this.textureUnits=new Array(t._caps.maxTextureUnits),this.set(n)}r.initDefault=function(t){n.vertexBuffers=new Array(t._caps.maxVertexStreams),n.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),n.textureUnits=new Array(t._caps.maxTextureUnits)},(t=r.prototype).reset=function(){this.set(n)},t.set=function(t){this.blend=t.blend,this.blendSep=t.blendSep,this.blendColor=t.blendColor,this.blendEq=t.blendEq,this.blendAlphaEq=t.blendAlphaEq,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.depthFunc=t.depthFunc,this.stencilTest=t.stencilTest,this.stencilSep=t.stencilSep,this.stencilFuncFront=t.stencilFuncFront,this.stencilRefFront=t.stencilRefFront,this.stencilMaskFront=t.stencilMaskFront,this.stencilFailOpFront=t.stencilFailOpFront,this.stencilZFailOpFront=t.stencilZFailOpFront,this.stencilZPassOpFront=t.stencilZPassOpFront,this.stencilWriteMaskFront=t.stencilWriteMaskFront,this.stencilFuncBack=t.stencilFuncBack,this.stencilRefBack=t.stencilRefBack,this.stencilMaskBack=t.stencilMaskBack,this.stencilFailOpBack=t.stencilFailOpBack,this.stencilZFailOpBack=t.stencilZFailOpBack,this.stencilZPassOpBack=t.stencilZPassOpBack,this.stencilWriteMaskBack=t.stencilWriteMaskBack,this.cullMode=t.cullMode,this.primitiveType=t.primitiveType,this.maxStream=t.maxStream;for(var e=0;e<t.vertexBuffers.length;++e)this.vertexBuffers[e]=t.vertexBuffers[e];for(var i=0;i<t.vertexBufferOffsets.length;++i)this.vertexBufferOffsets[i]=t.vertexBufferOffsets[i];this.indexBuffer=t.indexBuffer,this.maxTextureSlot=t.maxTextureSlot;for(var n=0;n<t.textureUnits.length;++n)this.textureUnits[n]=t.textureUnits[n];this.program=t.program},i.default=r,e.exports=i.default},{"./enums":309}],317:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("./texture"))&&n.__esModule?n:{default:n},o=t("./enums"),s=t("./misc");function r(i){return function(){var t,e=a(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}c=n.default,t=c,(n=l).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,r(l),(n=l.prototype).update=function(t){var e,i,n=this._device._gl,r=this._genMipmap;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=o.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=o.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=o.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=o.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==t.genMipmaps&&(this._genMipmap=t.genMipmaps,r=t.genMipmaps),(e=this._device.caps.maxTextureSize||Number.MAX_VALUE)<(i=Math.max(t.width||0,t.height||0))&&console.warn("The current texture size "+i+" exceeds the maximum size ["+e+"] supported on the device."),void 0!==t.images&&1<t.images.length&&(r=!1,(t.width>t.height?t.width:t.height)>>t.images.length-1!=1&&console.error("texture-2d mipmap is invalid, should have a 1x1 mipmap."))),(0,s.isPow2)(this._width)&&(0,s.isPow2)(this._height)||(r=!1),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._glID),void 0!==t.images&&0<t.images.length&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),1<t.images.length&&(this._genMipmap=!0)),r&&(n.hint(n.GENERATE_MIPMAP_HINT,n.NICEST),n.generateMipmap(n.TEXTURE_2D),this._genMipmap=!0),this._setTexInfo(),this._device._restoreTexture(0)},n.updateSubImage=function(t){var e=this._device._gl,i=(0,o.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0)},n.updateImage=function(t){var e=this._device._gl,i=(0,o.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setImage(i,t),this._device._restoreTexture(0)},n._setSubImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.image;!s||ArrayBuffer.isView(s)||s instanceof ArrayBuffer?(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this._compressed?i.compressedTexSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,s):i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,s)):(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,t.format,t.pixelType,s))},n._setImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.image;!s||ArrayBuffer.isView(s)||s instanceof ArrayBuffer?(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this._compressed?i.compressedTexImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,s):i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,s)):(void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,t.format,t.pixelType,s))},n._setMipmap=function(t,e,i){for(var n=(0,o.glTextureFmt)(this._format),r={width:this._width,height:this._height,flipY:e,premultiplyAlpha:i,level:0,image:null},s=0;s<t.length;++s)r.level=s,r.width=this._width>>s,r.height=this._height>>s,r.image=t[s],this._setImage(n,r)},n._setTexInfo=function(){var t=this._device._gl,e=(0,s.isPow2)(this._width)&&(0,s.isPow2)(this._height),i=(e||this._wrapS===o.enums.WRAP_CLAMP&&this._wrapT===o.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=o.enums.WRAP_CLAMP,this._wrapT=o.enums.WRAP_CLAMP),this._genMipmap?this._mipFilter:-1),e=(e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,(0,o.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,(0,o.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrapT),this._device.ext("EXT_texture_filter_anisotropic"));e&&t.texParameteri(t.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)};var c,t=l;function l(t,e){var t=c.call(this,t)||this,i=t._device._gl;return t._target=i.TEXTURE_2D,t._glID=i.createTexture(),e.images=e.images||[null],t.update(e),t}i.default=t,e.exports=i.default},{"./enums":309,"./misc":313,"./texture":319}],318:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("./texture"))&&n.__esModule?n:{default:n},c=t("./enums"),r=t("./misc");function s(i){return function(){var t,e=o(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}a=n.default,t=a,(n=l).prototype=Object.create(t.prototype),(n.prototype.constructor=n).__proto__=t,s(l),(n=l.prototype).update=function(t){var e=this._device._gl,i=this._genMipmaps;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=c.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=c.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=c.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=c.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps,i=t.genMipmaps),void 0!==t.images&&1<t.images.length&&(i=!1,t.width!==t.height&&console.warn("texture-cube width and height should be identical."),t.width>>t.images.length-1!=1&&console.error("texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn"))),(0,r.isPow2)(this._width)&&(0,r.isPow2)(this._height)||(i=!1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),void 0!==t.images&&0<t.images.length&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),1<t.images.length&&(this._genMipmaps=!0)),i&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_CUBE_MAP),this._genMipmaps=!0),this._setTexInfo(),this._device._restoreTexture(0)},n.updateSubImage=function(t){var e=this._device._gl,i=(0,c.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0)},n.updateImage=function(t){var e=this._device._gl,i=(0,c.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setImage(i,t),this._device._restoreTexture(0)},n._setSubImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.faceIndex,o=e.image;void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),!o||ArrayBuffer.isView(o)||o instanceof ArrayBuffer?this._compressed?i.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,e.width,e.height,t.format,o):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,o):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,t.format,t.pixelType,o)},n._setImage=function(t,e){var i=this._device._gl,n=e.flipY,r=e.premultiplyAlpha,s=e.faceIndex,o=e.image;void 0===n?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n),void 0===r?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),!o||ArrayBuffer.isView(o)||o instanceof ArrayBuffer?this._compressed?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,e.width,e.height,0,o):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,o):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,t.format,t.pixelType,o)},n._setMipmap=function(t,e,i){for(var n=(0,c.glTextureFmt)(this._format),r={width:this._width,height:this._height,faceIndex:0,flipY:e,premultiplyAlpha:i,level:0,image:null},s=0;s<t.length;++s){var o=t[s];r.level=s,r.width=this._width>>s,r.height=this._height>>s;for(var a=0;a<6;++a)r.faceIndex=a,r.image=o[a],this._setImage(n,r)}},n._setTexInfo=function(){var t=this._device._gl,e=(0,r.isPow2)(this._width)&&(0,r.isPow2)(this._height),i=(e||this._wrapS===c.enums.WRAP_CLAMP&&this._wrapT===c.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=c.enums.WRAP_CLAMP,this._wrapT=c.enums.WRAP_CLAMP),this._genMipmaps?this._mipFilter:-1),e=(e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,(0,c.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,(0,c.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this._wrapT),this._device.ext("EXT_texture_filter_anisotropic"));e&&t.texParameteri(t.TEXTURE_CUBE_MAP,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)};var a,t=l;function l(t,e){var t=a.call(this,t)||this,i=t._device._gl;return t._target=i.TEXTURE_CUBE_MAP,t._glID=i.createTexture(),t.update(e),t}i.default=t,e.exports=i.default},{"./enums":309,"./misc":313,"./texture":319}],319:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("./enums"),r=0;function s(t){this._device=t,this._width=4,this._height=4,this._genMipmaps=!1,this._compressed=!1,this._anisotropy=1,this._minFilter=n.enums.FILTER_LINEAR,this._magFilter=n.enums.FILTER_LINEAR,this._mipFilter=n.enums.FILTER_LINEAR,this._wrapS=n.enums.WRAP_REPEAT,this._wrapT=n.enums.WRAP_REPEAT,this._format=n.enums.TEXTURE_FMT_RGBA8,this._target=-1,this._id=r++}s.prototype.destroy=function(){null!==this._glID?(this._device._gl.deleteTexture(this._glID),this._device._stats.tex-=this.bytes,this._glID=null):console.error("The texture already destroyed")},i.default=s,e.exports=i.default},{"./enums":309}],320:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t("./enums");function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=o.prototype).destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.vb-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},t.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numVertices=this._bytes/this._bytesPerVertex}var i=this._device._gl,n=this._usage;i.bindBuffer(i.ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ARRAY_BUFFER,e,n),this._needExpandDataStore=!1):i.bufferSubData(i.ARRAY_BUFFER,t,e),i.bindBuffer(i.ARRAY_BUFFER,null)}}else console.error("The buffer is destroyed")},t.getFormat=function(t){return this._format.element(t)},t.setUsage=function(t){this._usage=t},t=o,(s=[{key:"count",get:function(){return this._numVertices}}])&&n(t.prototype,s),r&&n(t,r);var r,s=o;function o(t,e,i,n){this._device=t,this._format=e,this._usage=i,this._bytesPerVertex=this._format._bytes,this._bytes=n.byteLength,this._numVertices=this._bytes/this._bytesPerVertex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,n),t._stats.vb+=this._bytes}i.default=s,e.exports=i.default},{"./enums":309}],321:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=t("./enums"),c=(t=t("../murmurhash2_gc"))&&t.__esModule?t:{default:t};function n(t){this._attr2el={},this._elements=[];for(var e="",i=this._bytes=0,n=t.length;i<n;++i){var r=t[i],r={name:r.name,offset:this._bytes,stride:0,stream:-1,type:r.type,num:r.num,normalize:void 0!==r.normalize&&r.normalize,bytes:r.num*(0,a.attrTypeBytes)(r.type)};this._attr2el[r.name]=r,this._elements.push(r),this._bytes+=r.bytes,e+=r.name+":"+r.num+":"+r.type+":"+r.normalize}for(var s=0,o=this._elements.length;s<o;++s)this._elements[s].stride=this._bytes;this._hash=(0,c.default)(e,666)}(t=n.prototype).element=function(t){return this._attr2el[t]},t.getHash=function(){return this._hash},i.default=n,e.exports=i.default},{"../murmurhash2_gc":330,"./enums":309}],322:[function(t,e,i){"use strict";function n(t,e){this._cursor=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}i.__esModule=!0,i.default=void 0,n.prototype.request=function(){var t=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,t},i.default=n,e.exports=i.default},{}],323:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./timsort"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=a.prototype)._resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=void 0},t.reset=function(){for(var t=0;t<this._count;++t)this._data[t]=void 0;this._count=0},t.push=function(t){this._count>=this._data.length&&this._resize(2*this._data.length),this._data[this._count]=t,++this._count},t.pop=function(){--this._count,this._count<0&&(this._count=0);var t=this._data[this._count];return this._data[this._count]=void 0,t},t.fastRemove=function(t){var e;t>=this._count||t<0||(e=this._count-1,this._data[t]=this._data[e],this._data[e]=void 0,--this._count)},t.indexOf=function(t){return this._data.indexOf(t)},t.sort=function(t){return(0,n.default)(this._data,0,this._count,t)},t=a,(o=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&r(t.prototype,o),s&&r(t,s);var s,o=a;function a(t){this._count=0,this._data=new Array(t)}i.default=o,e.exports=i.default},{"./timsort":328}],324:[function(t,e,i){"use strict";i.__esModule=!0,i.TypedArrayPool=i.RecyclePool=i.Pool=i.LinkedArray=i.FixedArray=i.CircularPool=void 0;var n=r(t("./circular-pool")),n=(i.CircularPool=n.default,r(t("./fixed-array"))),n=(i.FixedArray=n.default,r(t("./linked-array"))),n=(i.LinkedArray=n.default,r(t("./pool"))),n=(i.Pool=n.default,r(t("./recycle-pool"))),n=(i.RecyclePool=n.default,r(t("./typed-array-pool")));function r(t){return t&&t.__esModule?t:{default:t}}i.TypedArrayPool=n.default},{"./circular-pool":322,"./fixed-array":323,"./linked-array":325,"./pool":326,"./recycle-pool":327,"./typed-array-pool":329}],325:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./pool"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=a.prototype).add=function(){var t=this._pool.alloc();return this._tail?(this._tail._next=t)._prev=this._tail:this._head=t,this._tail=t,this._count+=1,t},t.remove=function(t){t._prev?t._prev._next=t._next:this._head=t._next,t._next?t._next._prev=t._prev:this._tail=t._prev,t._next=null,t._prev=null,this._pool.free(t),--this._count},t.forEach=function(t,e){var i=this._head;if(i){e&&(t=t.bind(e));for(var n,r=0;i;)n=i._next,t(i,r,this),i=n,++r}},t=a,(o=[{key:"head",get:function(){return this._head}},{key:"tail",get:function(){return this._tail}},{key:"length",get:function(){return this._count}}])&&r(t.prototype,o),s&&r(t,s);var s,o=a;function a(t,e){this._fn=t,this._count=0,this._head=null,this._tail=null,this._pool=new n.default(t,e)}i.default=o,e.exports=i.default},{"./pool":326}],326:[function(t,e,i){"use strict";var n;function r(t,e){this._fn=t,this._idx=e-1,this._frees=new Array(e);for(var i=0;i<e;++i)this._frees[i]=t()}i.__esModule=!0,i.default=void 0,(n=r.prototype)._expand=function(t){for(var e=this._frees,i=(this._frees=new Array(t),t-e.length),n=0;n<i;++n)this._frees[n]=this._fn();for(var r=i,s=0;r<t;++r,++s)this._frees[r]=e[s];this._idx+=i},n.alloc=function(){this._idx<0&&this._expand(Math.round(1.2*this._frees.length)+1);var t=this._frees[this._idx];return this._frees[this._idx]=null,--this._idx,t},n.free=function(t){++this._idx,this._frees[this._idx]=t},n.clear=function(t){for(var e=0;e<=this._idx;e++)t&&t(this._frees[e]);this._frees.length=0,this._idx=-1},i.default=r,e.exports=i.default},{}],327:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./timsort"))&&t.__esModule?t:{default:t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t=a.prototype).reset=function(){this._count=0},t.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.remove=function(t){var e,i;t>=this._count||(e=this._count-1,i=this._data[t],this._data[t]=this._data[e],this._data[e]=i,--this._count)},t.sort=function(t){return(0,n.default)(this._data,0,this._count,t)},t=a,(o=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&r(t.prototype,o),s&&r(t,s);var s,o=a;function a(t,e){this._fn=t,this._count=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}i.default=o,cc.RecyclePool=o,e.exports=i.default},{"./timsort":328}],328:[function(n,r,t){"use strict";t.__esModule=!0,t.default=function(t,e,i,n){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");void 0===e&&(e=0),void 0===i&&(i=t.length),void 0===n&&(n=_);var r=i-e;if(!(r<2)){var s=0;if(r<l)s=h(t,e,i,n),u(t,e,i,e+s,n);else{var o,a=new d(t,n),c=function(t){var e=0;for(;l<=t;)e|=1&t,t>>=1;return t+e}(r);do{}while((s=h(t,e,i,n))<c&&(u(t,e,e+(o=c<(o=r)?c:o),e+s,n),s=o),a.pushRun(e,s),a.mergeRuns(),e+=s,0!==(r-=s));a.forceMergeRuns()}}};var l=32,s=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function o(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function _(t,e){if(t===e)return 0;if(~~t===t&&~~e===e){if(0===t||0===e)return t<e?-1:1;if(t<0||e<0){if(0<=e)return-1;if(0<=t)return 1;t=-t,e=-e}var i=o(t),n=o(e),r=0;return i<n?(t*=s[n-i-1],e/=10,r=-1):n<i&&(e*=s[i-n-1],t/=10,r=1),t===e?r:t<e?-1:1}i=String(t),n=String(e);return i===n?0:i<n?-1:1}function h(t,e,i,n){var r=e+1;if(r===i)return 1;if(n(t[r++],t[e])<0){for(;r<i&&n(t[r],t[r-1])<0;)r++;var s=t,o=e,a=r;for(a--;o<a;){var c=s[o];s[o++]=s[a],s[a--]=c}}else for(;r<i&&0<=n(t[r],t[r-1]);)r++;return r-e}function u(t,e,i,n,r){for(n===e&&n++;n<i;n++){for(var s=t[n],o=e,a=n;o<a;){var c=o+a>>>1;r(s,t[c])<0?a=c:o=1+c}var l=n-o;switch(l){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;0<l;)t[o+l]=t[o+l-1],l--}t[o]=s}}function y(t,e,i,n,r,s){var o=0,a=0,c=1;if(0<s(t,e[i+r])){for(a=n-r;c<a&&0<s(t,e[i+r+c]);)(c=1+((o=c)<<1))<=0&&(c=a);a<c&&(c=a),o+=r,c+=r}else{for(a=r+1;c<a&&s(t,e[i+r-c])<=0;)(c=1+((o=c)<<1))<=0&&(c=a);n=o,o=r-(c=a<c?a:c),c=r-n}for(o++;o<c;){var l=o+(c-o>>>1);0<s(t,e[i+l])?o=l+1:c=l}return c}function g(t,e,i,n,r,s){var o=0,a=0,c=1;if(s(t,e[i+r])<0){for(a=r+1;c<a&&s(t,e[i+r-c])<0;)(c=1+((o=c)<<1))<=0&&(c=a);var h=o,o=r-(c=a<c?a:c),c=r-h}else{for(a=n-r;c<a&&0<=s(t,e[i+r+c]);)(c=1+((o=c)<<1))<=0&&(c=a);a<c&&(c=a),o+=r,c+=r}for(o++;o<c;){var l=o+(c-o>>>1);s(t,e[i+l])<0?c=l:o=l+1}return c}(e=i.prototype).pushRun=function(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1},e.mergeRuns=function(){for(;1<this.stackSize;){var t=this.stackSize-2;if(1<=t&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||2<=t&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}},e.forceMergeRuns=function(){for(;1<this.stackSize;){var t=this.stackSize-2;0<t&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}},e.mergeAt=function(t){var e=this.compare,i=this.array,n=this.runStart[t],r=this.runLength[t],s=this.runStart[t+1],o=this.runLength[t+1],t=(this.runLength[t]=r+o,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--,g(i[s],i,n,r,0,e));n+=t,0!=(r-=t)&&0!==(o=y(i[n+r-1],i,s,o,o-1,e))&&(r<=o?this.mergeLow(n,r,s,o):this.mergeHigh(n,r,s,o))},e.mergeLow=function(h,t,u,e){for(var _=this.compare,i=this.array,n=this.tmp,r=0,r=0;r<t;r++)n[r]=i[h+r];var s=0,o=u,a=h;if(i[a++]=i[o++],0!=--e)if(1!==t){for(var d=this.minGallop;;){var c=0,l=0,f=!1;do{if(_(i[o],n[s])<0){if(i[a++]=i[o++],l++,(c=0)==--e){f=!0;break}}else if(i[a++]=n[s++],c++,l=0,1==--t){f=!0;break}}while((c|l)<d);if(f)break;do{if(0!==(c=g(i[o],n,s,t,0,_))){for(r=0;r<c;r++)i[a+r]=n[s+r];if(a+=c,s+=c,(t-=c)<=1){f=!0;break}}if(i[a++]=i[o++],0==--e){f=!0;break}if(0!==(l=y(n[s],i,o,e,0,_))){for(r=0;r<l;r++)i[a+r]=i[o+r];if(a+=l,o+=l,0===(e-=l)){f=!0;break}}if(i[a++]=n[s++],1==--t){f=!0;break}}while(d--,7<=c||7<=l);if(f)break;d<0&&(d=0),d+=2}if((this.minGallop=d)<1&&(this.minGallop=1),1===t){for(r=0;r<e;r++)i[a+r]=i[o+r];i[a+e]=n[s]}else{if(0===t)throw new Error("mergeLow preconditions were not respected");for(r=0;r<t;r++)i[a+r]=n[s+r]}}else{for(r=0;r<e;r++)i[a+r]=i[o+r];i[a+e]=n[s]}else for(r=0;r<t;r++)i[a+r]=n[s+r]},e.mergeHigh=function(h,t,u,e){for(var _=this.compare,i=this.array,n=this.tmp,r=0,r=0;r<e;r++)n[r]=i[u+r];var s=h+t-1,d=e-1,o=u+e-1,a=0,f=0;if(i[o--]=i[s--],0!=--t)if(1!==e){for(var p=this.minGallop;;){var c=0,l=0,m=!1;do{if(_(n[d],i[s])<0){if(i[o--]=i[s--],c++,(l=0)==--t){m=!0;break}}else if(i[o--]=n[d--],l++,c=0,1==--e){m=!0;break}}while((c|l)<p);if(m)break;do{if(0!==(c=t-g(n[d],i,h,t,t-1,_))){for(t-=c,f=(o-=c)+1,a=(s-=c)+1,r=c-1;0<=r;r--)i[f+r]=i[a+r];if(0===t){m=!0;break}}if(i[o--]=n[d--],1==--e){m=!0;break}if(0!==(l=e-y(i[s],n,0,e,e-1,_))){for(e-=l,f=(o-=l)+1,a=(d-=l)+1,r=0;r<l;r++)i[f+r]=n[a+r];if(e<=1){m=!0;break}}if(i[o--]=i[s--],0==--t){m=!0;break}}while(p--,7<=c||7<=l);if(m)break;p<0&&(p=0),p+=2}if((this.minGallop=p)<1&&(this.minGallop=1),1===e){for(f=(o-=t)+1,a=(s-=t)+1,r=t-1;0<=r;r--)i[f+r]=i[a+r];i[o]=n[d]}else{if(0===e)throw new Error("mergeHigh preconditions were not respected");for(a=o-(e-1),r=0;r<e;r++)i[a+r]=n[r]}}else{for(f=(o-=t)+1,a=(s-=t)+1,r=t-1;0<=r;r--)i[f+r]=i[a+r];i[o]=n[d]}else for(a=o-(e-1),r=0;r<e;r++)i[a+r]=n[r]};var e,d=i;function i(t,e){this.array=t,this.compare=e,this.minGallop=7,this.length=t.length,this.tmpStorageLength=256,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}r.exports=t.default},{}],329:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;for(var n=Array(8),r=0;r<8;++r)n[r]=[];function s(t){var e,i=(65535<t)<<4;return(i=(i|=e=(255<(t>>>=i))<<3)|(e=(15<(t>>>=e))<<2)|(e=(3<(t>>>=e))<<1))|(t>>>=e)>>1}function o(t){var t=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}(t),e=n[s(t)>>2];return 0<e.length?e.pop():new ArrayBuffer(t)}i.default={alloc_int8:function(t){var e=new Int8Array(o(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint8:function(t){var e=new Uint8Array(o(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int16:function(t){var e=new Int16Array(o(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint16:function(t){var e=new Uint16Array(o(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int32:function(t){var e=new Int32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint32:function(t){var e=new Uint32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float32:function(t){var e=new Float32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float64:function(t){var e=new Float64Array(o(8*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_dataview:function(t){var e=new DataView(o(t),0,t);return e.length!==t?e.subarray(0,t):e},free:function(t){t=t.buffer,n[s(t.byteLength)>>2].push(t)},reset:function(){for(var t=Array(8),e=0;e<8;++e)t[e]=[]}},e.exports=i.default},{}],330:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e){var i,n=t.length,r=e^n,s=0;for(;4<=n;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0},e.exports=i.default},{}],331:[function(t,h,e){"use strict";e.__esModule=!0,e.default=void 0;var r=t("../../core/value-types"),i=_(t("../core/base-renderer")),u=_(t("../enums")),t=t("../memop");function _(t){return t&&t.__esModule?t:{default:t}}function d(n){return function(){var t,e,i=f(n);return t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=f(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(e=t)||"object"!=typeof e&&"function"!=typeof e?s(i):e}}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var n,p=new Float32Array(16),m=new Float32Array(16),y=new Float32Array(16),g=new Float32Array(16),v=new Float32Array(4),x=new Float32Array(64),b=[],A=new Float32Array(4),o=new r.Vec4(0,0,0,0),C=new r.Vec3(0,0,0),a=new r.Vec3(0,0,0),c=new t.RecyclePool(function(){return new Float32Array(16)},8),t=(n=i.default,t=n,(i=l).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t,d(l),(i=l.prototype).reset=function(){c.reset(),n.prototype.reset.call(this)},i.render=function(t,e){this.reset(),this._time[0]+=e,this._device.setUniform("cc_time",this._time),this._updateLights(t);for(var i=this._device._gl.canvas,n=0;n<t._cameras.length;++n){var r=this._requestView(),s=i.width,o=i.height;t._cameras.data[n].extractView(r,s,o)}this._viewPools.sort(function(t,e){return t._priority-e._priority});for(var a=0;a<this._viewPools.length;++a){var c=this._viewPools.data[a];this._render(c,t)}},i.renderCamera=function(t,e){this.reset();var i=this._device._gl.canvas,n=i.width,i=i.height,r=this._requestView();t.extractView(r,n,i),this._render(r,e)},i._updateLights=function(t){this._lights.length=0,this._shadowLights.length=0;for(var e=t._lights,i=0;i<e.length;++i){var n,r=e.data[i];r.update(this._device),r.shadowType!==u.default.SHADOW_NONE?(this._shadowLights.length<2&&this._shadowLights.splice(0,0,r),n=this._requestView(),r.extractView(n,["shadowcast"]),this._lights.splice(0,0,r)):this._lights.push(r)}this._updateLightDefines(),this._numLights=e._count},i._updateLightDefines=function(){for(var t=this._defines,e=0;e<this._lights.length;++e){var i=this._lights[e];t["CC_LIGHT_"+e+"_TYPE"]=i._type,t["CC_SHADOW_"+e+"_TYPE"]=i._shadowType}t.CC_NUM_LIGHTS=Math.min(4,this._lights.length),t.CC_NUM_SHADOW_LIGHTS=Math.min(4,this._shadowLights.length)},i._submitLightsUniforms=function(){var t=this._device;if(0<this._lights.length){for(var e=c.add(),i=c.add(),n=c.add(),r=Math.min(4,this._lights.length),s=0;s<r;++s){var o=this._lights[s],a=4*s;n.set(o._colorUniform,a),i.set(o._directionUniform,a),e.set(o._positionUniform,a),e[3+a]=o._range,o._type===u.default.LIGHT_SPOT?(i[3+a]=o._spotUniform[0],n[3+a]=o._spotUniform[1]):(i[3+a]=0,n[3+a]=0)}t.setUniform("cc_lightDirection",i),t.setUniform("cc_lightColor",n),t.setUniform("cc_lightPositionAndRange",e)}},i._submitShadowStageUniforms=function(t){var e=t._shadowLight,i=A;i[0]=e.shadowMinDepth,i[1]=e.shadowMaxDepth,i[2]=e.shadowDepthScale,i[3]=e.shadowDarkness,this._device.setUniform("cc_shadow_map_lightViewProjMatrix",r.Mat4.toArray(g,t._matViewProj)),this._device.setUniform("cc_shadow_map_info",i),this._device.setUniform("cc_shadow_map_bias",e.shadowBias),this._defines.CC_SHADOW_TYPE=e._shadowType},i._submitOtherStagesUniforms=function(){for(var t=c.add(),e=0;e<this._shadowLights.length;++e){var i=this._shadowLights[e],n=(n=b[e])||(b[e]=new Float32Array(x.buffer,64*e,16)),n=(r.Mat4.toArray(n,i.viewProjMatrix),4*e);t[n]=i.shadowMinDepth,t[1+n]=i.shadowMaxDepth,t[2+n]=i._shadowResolution,t[3+n]=i.shadowDarkness}this._device.setUniform("cc_shadow_lightViewProjMatrix",x),this._device.setUniform("cc_shadow_info",t)},i._sortItems=function(t){t.sort(function(t,e){return t.passes.length!==e.passes.length?t.passes.length-e.passes.length:t.sortKey-e.sortKey})},i._shadowStage=function(t,e){this._submitShadowStageUniforms(t);for(var i=0;i<e.length;++i){var n=e.data[i];n.effect.getDefine("CC_CASTING_SHADOW")&&this._draw(n)}},i._drawItems=function(t,e){var i=this._shadowLights;if(0===i.length&&0===this._numLights)for(var n=0;n<e.length;++n){var r=e.data[n];this._draw(r)}else for(var s=0;s<e.length;++s){for(var o=e.data[s],a=0;a<i.length;++a)this._device.setTexture("cc_shadow_map_"+a,i[a].shadowMap,this._allocTextureUnit());this._draw(o)}},i._opaqueStage=function(t,e){t.getPosition(o),this._device.setUniform("cc_matView",r.Mat4.toArray(p,t._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(m,t._matViewInv)),this._device.setUniform("cc_matpProj",r.Mat4.toArray(y,t._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(g,t._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(v,o)),this._submitLightsUniforms(),this._submitOtherStagesUniforms(),this._drawItems(t,e)},i._transparentStage=function(t,e){t.getPosition(o),t.getForward(C),this._device.setUniform("cc_matView",r.Mat4.toArray(p,t._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(m,t._matViewInv)),this._device.setUniform("cc_matpProj",r.Mat4.toArray(y,t._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(g,t._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(v,o)),this._submitLightsUniforms(),this._submitOtherStagesUniforms();for(var i=0;i<e.length;++i){var n=e.data[i];n.node.getWorldPosition(a),r.Vec3.sub(a,a,o),n.sortKey=-r.Vec3.dot(a,C)}this._sortItems(e),this._drawItems(t,e)},l);function l(t,e){t=n.call(this,t,e)||this;return t._time=new Float32Array(4),t._lights=[],t._shadowLights=[],t._numLights=0,t._defines={},t._registerStage("shadowcast",t._shadowStage.bind(s(t))),t._registerStage("opaque",t._opaqueStage.bind(s(t))),t._registerStage("transparent",t._transparentStage.bind(s(t))),t}e.default=t,h.exports=e.default},{"../../core/value-types":279,"../core/base-renderer":301,"../enums":307,"../memop":324}],332:[function(t,i,e){"use strict";e.__esModule=!0,e.default=void 0;var a=t("../../core/value-types"),_=t("../../core/geom-utils"),c=(t=t("../enums"))&&t.__esModule?t:{default:t};function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d,r=new a.Mat4,f=new a.Mat4,p=new a.Mat4,n=new a.Mat4,o=new a.Mat4,l=new a.Mat4,h=new a.Vec3,u=new a.Vec3,m=((t=y.prototype).setCullingMask=function(t){this._cullingMask=t},t.getNode=function(){return this._node},t.setNode=function(t){this._node=t},t.getType=function(){return this._projection},t.setType=function(t){this._projection=t},t.getPriority=function(){return this._priority},t.setPriority=function(t){this._priority=t},t.getOrthoHeight=function(){return this._orthoHeight},t.setOrthoHeight=function(t){this._orthoHeight=t},t.getFov=function(){return this._fov},t.setFov=function(t){this._fov=t},t.getNear=function(){return this._near},t.setNear=function(t){this._near=t},t.getFar=function(){return this._far},t.setFar=function(t){this._far=t},t.getColor=function(t){return a.Vec4.copy(t,this._color)},t.setColor=function(t,e,i,n){a.Vec4.set(this._color,t,e,i,n)},t.getDepth=function(){return this._depth},t.setDepth=function(t){this._depth=t},t.getStencil=function(){return this._stencil},t.setStencil=function(t){this._stencil=t},t.getClearFlags=function(){return this._clearFlags},t.setClearFlags=function(t){this._clearFlags=t},t.getRect=function(t){return t.x=this._rect.x,t.y=this._rect.y,t.w=this._rect.w,t.h=this._rect.h,t},t.setRect=function(t,e,i,n){this._rect.x=t,this._rect.y=e,this._rect.w=i,this._rect.h=n},t.getStages=function(){return this._stages},t.setStages=function(t){this._stages=t},t.getFramebuffer=function(){return this._framebuffer},t.setFrameBuffer=function(t){this._framebuffer=t},t._calcMatrices=function(t,e){this._node.getWorldRT(p),a.Mat4.invert(f,p);var t=t/e;this._projection===c.default.PROJ_PERSPECTIVE?a.Mat4.perspective(n,this._fov,t,this._near,this._far):(e=this._orthoHeight*t,t=this._orthoHeight,a.Mat4.ortho(n,-e,e,-t,t,this._near,this._far)),a.Mat4.mul(o,n,f),a.Mat4.invert(l,o)},t.extractView=function(t,e,i){this._framebuffer&&(e=this._framebuffer._width,i=this._framebuffer._height),t._priority=this._priority,t._rect.x=this._rect.x*e,t._rect.y=this._rect.y*i,t._rect.w=this._rect.w*e,t._rect.h=this._rect.h*i,this.getColor(t._color),t._depth=this._depth,t._stencil=this._stencil,t._clearFlags=this._clearFlags,t._clearModel=this._clearModel,t._stages=this._stages,t._framebuffer=this._framebuffer,this._calcMatrices(e,i),a.Mat4.copy(t._matView,f),a.Mat4.copy(t._matViewInv,p),a.Mat4.copy(t._matProj,n),a.Mat4.copy(t._matViewProj,o),a.Mat4.copy(t._matInvViewProj,l),t._cullingMask=this._cullingMask},t.screenPointToRay=function(t,e,i,n,r){if(!cc.geomUtils)return r;r=r||new _.Ray,this._calcMatrices(i,n);var s=this._rect.x*i,o=this._rect.y*n,i=this._rect.w*i,n=this._rect.h*n;return a.Vec3.set(u,(t-s)/i*2-1,(e-o)/n*2-1,1),a.Vec3.transformMat4(u,u,l),this._projection===c.default.PROJ_PERSPECTIVE?this._node.getWorldPosition(h):(a.Vec3.set(h,(t-s)/i*2-1,(e-o)/n*2-1,-1),a.Vec3.transformMat4(h,h,l)),_.Ray.fromPoints(r,h,u)},t.screenToWorld=function(t,e,i,n){this._calcMatrices(i,n);var r=this._rect.x*i,s=this._rect.y*n,i=this._rect.w*i,n=this._rect.h*n;return this._projection===c.default.PROJ_PERSPECTIVE?(a.Vec3.set(t,(e.x-r)/i*2-1,(e.y-s)/n*2-1,.9999),a.Vec3.transformMat4(t,t,l),this._node.getWorldPosition(h),a.Vec3.lerp(t,h,t,(0,a.lerp)(this._near/this._far,1,e.z))):(a.Vec3.set(t,(e.x-r)/i*2-1,(e.y-s)/n*2-1,2*e.z-1),a.Vec3.transformMat4(t,t,l)),t},t.worldToScreen=function(t,e,i,n){this._calcMatrices(i,n);var r=this._rect.x*i,s=this._rect.y*n,i=this._rect.w*i,n=this._rect.h*n;return a.Vec3.transformMat4(t,e,o),t.x=r+.5*(t.x+1)*i,t.y=s+.5*(t.y+1)*n,t.z=.5*t.z+.5,t},t.worldMatrixToScreen=function(t,e,i,n){this._calcMatrices(i,n),a.Mat4.mul(t,o,e);e=i/2,i=n/2;return a.Mat4.identity(r),a.Mat4.transform(r,r,a.Vec3.set(h,e,i,0)),a.Mat4.scale(r,r,a.Vec3.set(h,e,i,1)),a.Mat4.mul(t,r,t),t},t=y,(m=[{key:"cullingMask",get:function(){return this._cullingMask},set:function(t){this._cullingMask=t}}])&&s(t.prototype,m),d&&s(t,d),y);function y(){this._poolID=-1,this._node=null,this._projection=c.default.PROJ_PERSPECTIVE,this._priority=0,this._color=new a.Vec4(.2,.3,.47,1),this._depth=1,this._stencil=0,this._clearFlags=c.default.CLEAR_COLOR|c.default.CLEAR_DEPTH,this._clearModel=null,this._stages=[],this._framebuffer=null,this._near=.01,this._far=1e3,this._fov=Math.PI/4,this._rect={x:0,y:0,w:1,h:1},this._orthoHeight=10,this._cullingMask=4294967295}e.default=m,i.exports=e.default},{"../../core/geom-utils":123,"../../core/value-types":279,"../enums":307}],333:[function(t,e,i){"use strict";var n;function r(){this._type="default",this._poolID=-1,this._node=null,this._inputAssembler=null,this._effect=null,this._viewID=-1,this._cameraID=-1,this._userKey=-1,this._castShadow=!1,this._boundingShape=null}i.__esModule=!0,i.default=void 0,(n=r.prototype).setNode=function(t){this._node=t},n.setInputAssembler=function(t){this._inputAssembler=t},n.setEffect=function(t){this._effect=t},n.setUserKey=function(t){this._userKey=t},n.extractDrawItem=function(t){t.model=this,t.node=this._node,t.ia=this._inputAssembler,t.effect=this._effect},i.default=r,e.exports=i.default},{}],334:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../memop");function r(t){this._lights=new n.FixedArray(16),this._models=new n.FixedArray(16),this._cameras=new n.FixedArray(16),this._debugCamera=null,this._app=t,this._views=[]}(t=r.prototype)._add=function(t,e){-1===e._poolID&&(t.push(e),e._poolID=t.length-1)},t._remove=function(t,e){-1!==e._poolID&&(t.data[t.length-1]._poolID=e._poolID,t.fastRemove(e._poolID),e._poolID=-1)},t.reset=function(){for(var t=0;t<this._models.length;++t)this._models.data[t]._viewID=-1},t.setDebugCamera=function(t){this._debugCamera=t},t.getCameraCount=function(){return this._cameras.length},t.getCamera=function(t){return this._cameras.data[t]},t.addCamera=function(t){this._add(this._cameras,t)},t.removeCamera=function(t){this._remove(this._cameras,t)},t.getModelCount=function(){return this._models.length},t.getModel=function(t){return this._models.data[t]},t.addModel=function(t){this._add(this._models,t)},t.removeModel=function(t){this._remove(this._models,t)},t.getLightCount=function(){return this._lights.length},t.getLight=function(t){return this._lights.data[t]},t.addLight=function(t){this._add(this._lights,t)},t.removeLight=function(t){this._remove(this._lights,t)},t.addView=function(t){-1===this._views.indexOf(t)&&this._views.push(t)},t.removeView=function(t){t=this._views.indexOf(t);-1!==t&&this._views.splice(t,1)},i.default=r,e.exports=i.default},{"../memop":324}],335:[function(t,h,e){"use strict";e.__esModule=!0,e.getInspectorProps=function(t){var e={type:t.type},t=(Object.assign(e,t.editor||t.inspector),e.defines=t.defines,e.value=_(e.type)(t.value),d(e.type));e.typeName=f[t]||t,e.valueCtor=c[e.type],"cc.Texture2D"==e.typeName&&(e.typeName="cc.Asset",e.assetType="cc.Texture2D");return e},e.getClassName=e.getInstanceCtor=e.getInstanceType=e.enums2default=e.ctor2enums=void 0;var i,n=o(t("./enums")),r=t("../core/value-types"),s=o(t("../core/assets/CCTexture2D"));function o(t){return t&&t.__esModule?t:{default:t}}var t=t("./gfx/texture-2d"),a=cc.Object,u=((i={})[Boolean]=function(t){return t||!1},i[Number]=function(t){return t?ArrayBuffer.isView(t)?t[0]:t:0},i[r.Vec2]=function(t){return t?cc.v2(t[0],t[1]):cc.v2()},i[r.Vec3]=function(t){return t?cc.v3(t[0],t[1],t[2]):cc.v3()},i[r.Vec4]=function(t){return t?cc.v4(t[0],t[1],t[2],t[3]):cc.v4()},i[r.Color]=function(t){return t?cc.color(255*t[0],255*t[1],255*t[2],255*(t[3]||1)):cc.color()},i[r.Mat4]=function(t){return t?cc.mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]):cc.mat4()},i[s.default]=function(){return null},i[a]=function(){return null},i),c=((i={})[n.default.PARAM_INT]=Number,i[n.default.PARAM_INT2]=r.Vec2,i[n.default.PARAM_INT3]=r.Vec3,i[n.default.PARAM_INT4]=r.Vec4,i[n.default.PARAM_FLOAT]=Number,i[n.default.PARAM_FLOAT2]=r.Vec2,i[n.default.PARAM_FLOAT3]=r.Vec3,i[n.default.PARAM_FLOAT4]=r.Vec4,i[n.default.PARAM_MAT4]=r.Mat4,i[n.default.PARAM_TEXTURE_2D]=s.default,i.color=r.Color,i.number=Number,i.boolean=Boolean,i.default=a,i);(a={})[Number]=n.default.PARAM_FLOAT,a[r.Vec2]=n.default.PARAM_FLOAT2,a[r.Vec3]=n.default.PARAM_FLOAT3,a[r.Vec4]=n.default.PARAM_FLOAT4,a[r.Color]=n.default.PARAM_COLOR3,a[r.Color]=n.default.PARAM_COLOR4,a[r.Mat4]=n.default.PARAM_MAT4,a[s.default]=n.default.PARAM_TEXTURE_2D,a[t]=n.default.PARAM_TEXTURE_2D;function l(t){return c[t]||c.default}e.ctor2enums=a,(i={})[n.default.PARAM_INT]=new Uint32Array([0]),i[n.default.PARAM_INT2]=new Uint32Array([0,0]),i[n.default.PARAM_INT3]=new Uint32Array([0,0,0]),i[n.default.PARAM_INT4]=new Uint32Array([0,0,0,0]),i[n.default.PARAM_FLOAT]=new Float32Array([0]),i[n.default.PARAM_FLOAT2]=new Float32Array([0,0]),i[n.default.PARAM_FLOAT3]=new Float32Array([0,0,0]),i[n.default.PARAM_FLOAT4]=new Float32Array([0,0,0,0]),i[n.default.PARAM_MAT4]=cc.mat4().m,i[n.default.PARAM_TEXTURE_2D]=null,i.number=0,i.boolean=!1;var r=i,_=(e.enums2default=r,e.getInstanceType=l,function(t){return u[l(t)]}),d=(e.getInstanceCtor=_,function(t){return cc.js.getClassName(l(t))}),f=(e.getClassName=d,{Number:"number",Boolean:"boolean"})},{"../core/assets/CCTexture2D":50,"../core/value-types":279,"./enums":307,"./gfx/texture-2d":317}],336:[function(t,e,i){"use strict";var _=t("../compression/ZipUtils"),d=t("../compression/zlib.min"),n=t("../core/platform/js");function u(t){if(!t)return cc.color(0,0,0,255);var e;if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length)return e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,n=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||0,cc.color(i,n,r,e);var i=parseInt(t.substr(0,2),16)||0,n=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0;return cc.color(i,n,r,255)}function G(t,e){for(var i=[],n=t.getElementsByTagName("properties"),r=0;r<n.length;++r)for(var s=n[r].getElementsByTagName("property"),o=0;o<s.length;++o)i.push(s[o]);e=e||{};for(var a=0;a<i.length;a++){var c=i[a],h=c.getAttribute("name"),l=c.getAttribute("type")||"string",c=c.getAttribute("value");"int"===l?c=parseInt(c):"float"===l?c=parseFloat(c):"bool"===l?c="true"===c:"color"===l&&(c=u(c)),e[h]=c}return e}t("../core/platform/CCSAXParser"),cc.TMXLayerInfo=function(){this.properties={},this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.v2(0,0)},cc.TMXLayerInfo.prototype={constructor:cc.TMXLayerInfo,getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}},cc.TMXImageLayerInfo=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=cc.v2(0,0),this._opacity=0,this._trans=new cc.Color(255,255,255,255),this.sourceImage=null},cc.TMXObjectGroupInfo=function(){this.properties={},this.name="",this._objects=[],this.visible=!0,this._opacity=0,this._color=new cc.Color(255,255,255,255),this.offset=cc.v2(0,0),this._draworder="topdown"},cc.TMXObjectGroupInfo.prototype={constructor:cc.TMXObjectGroupInfo,getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}},cc.TMXTilesetInfo=function(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=null,this.imageSize=cc.size(0,0),this.tileOffset=cc.v2(0,0),this._tileSize=cc.size(0,0)},cc.TMXTilesetInfo.prototype={constructor:cc.TMXTilesetInfo,rectForGID:function(t,e){var e=e||cc.rect(0,0,0,0),i=(e.width=this._tileSize.width,e.height=this._tileSize.height,t=(t&=cc.TiledMap.TileFlag.FLIPPED_MASK)-parseInt(this.firstGid,10),parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10));return e.x=parseInt(t%i*(this._tileSize.width+this.spacing)+this.margin,10),e.y=parseInt(parseInt(t/i,10)*(this._tileSize.height+this.spacing)+this.margin,10),e}},cc.TMXMapInfo=function(t,e,i,n,r){this.properties=[],this.orientation=null,this.parentElement=null,this.parentGID=null,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=cc.TiledMap.RenderOrder.RightDown,this._supportVersion=[1,2,0],this._parser=new cc.SAXParser,this._objectGroups=[],this._allChildren=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties={},this._tileAnimations={},this._tsxMap=null,this._textures=null,this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerTextures=null,this.initWithXML(t,e,i,n,r)},cc.TMXMapInfo.prototype={constructor:cc.TMXMapInfo,getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getStaggerAxis:function(){return this._staggerAxis},setStaggerAxis:function(t){this._staggerAxis=t},getStaggerIndex:function(){return this._staggerIndex},setStaggerIndex:function(t){this._staggerIndex=t},getHexSideLength:function(){return this._hexSideLength},setHexSideLength:function(t){this._hexSideLength=t},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._allChildren.push(t),this._layers.push(t)},getImageLayers:function(){return this._imageLayers},setImageLayers:function(t){this._allChildren.push(t),this._imageLayers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._allChildren.push(t),this._objectGroups.push(t)},getAllChildren:function(){return this._allChildren},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithXML:function(t,e,i,n,r){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxMap=e,this._textures=i,this._imageLayerTextures=r,this._textureSizes=n,this._objectGroups.length=0,this._allChildren.length=0,this.properties.length=0,this._tileProperties={},this._tileAnimations={},this.currentString="",this.storingCharacters=!1,this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=cc.TiledMap.NONE,this.parseXMLString(t)},parseXMLString:function(t,h){var t=this._parser._parseXML(t).documentElement,e=t.getAttribute("orientation"),u=t.getAttribute("staggeraxis"),_=t.getAttribute("staggerindex"),d=t.getAttribute("hexsidelength"),f=t.getAttribute("renderorder"),p=t.getAttribute("version")||"1.0.0";if("map"===t.nodeName){for(var m=p.split("."),y=this._supportVersion,i=0;i<y.length;i++){var g=parseInt(m[i])||0;if(y[i]<g){cc.logID(7216,p);break}}"orthogonal"===e?this.orientation=cc.TiledMap.Orientation.ORTHO:"isometric"===e?this.orientation=cc.TiledMap.Orientation.ISO:"hexagonal"===e?this.orientation=cc.TiledMap.Orientation.HEX:null!==e&&cc.logID(7217,e),this.renderOrder="right-up"===f?cc.TiledMap.RenderOrder.RightUp:"left-up"===f?cc.TiledMap.RenderOrder.LeftUp:"left-down"===f?cc.TiledMap.RenderOrder.LeftDown:cc.TiledMap.RenderOrder.RightDown,"x"===u?this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_X):"y"===u&&this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_Y),"odd"===_?this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD):"even"===_&&this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN),d&&this.setHexSideLength(parseFloat(d));e=cc.size(0,0);e.width=parseFloat(t.getAttribute("width")),e.height=parseFloat(t.getAttribute("height")),this.setMapSize(e),(e=cc.size(0,0)).width=parseFloat(t.getAttribute("tilewidth")),e.height=parseFloat(t.getAttribute("tileheight")),this.setTileSize(e),this.properties=G(t)}var v=t.getElementsByTagName("tileset");for("map"!==t.nodeName&&(v=[]).push(t),c=0;c<v.length;c++){var n=v[c],r=n.getAttribute("source");if(r){var x=parseInt(n.getAttribute("firstgid")),r=this._tsxMap[r];r&&this.parseXMLString(r,x)}else for(var r=n.getElementsByTagName("image"),b=1<r.length,A=(P=r[0]).getAttribute("source"),C=(A.replace(/\\/g,"/"),n.getElementsByTagName("tile")),S=C&&C.length||1,s=null,T=n.getAttribute("name")||"",w=parseInt(n.getAttribute("spacing"))||0,E=parseInt(n.getAttribute("margin"))||0,M=(M=parseInt(h))||(parseInt(n.getAttribute("firstgid"))||0),I=cc.size(0,0),x=(I.width=parseFloat(n.getAttribute("tilewidth")),I.height=parseFloat(n.getAttribute("tileheight")),n.getElementsByTagName("tileoffset")[0]),B=cc.v2(0,0),o=(x&&(B.x=parseFloat(x.getAttribute("x")),B.y=parseFloat(x.getAttribute("y"))),null),R=0;R<S;R++)if(o&&!b||((o=new cc.TMXTilesetInfo).name=T,o.firstGid=M,o.spacing=w,o.margin=E,o._tileSize=I,o.tileOffset=B,o.sourceImage=this._textures[A],o.imageSize=this._textureSizes[A]||o.imageSize,o.sourceImage||cc.errorID(7221,A),this.setTilesets(o)),s=C&&C[R]){this.parentGID=parseInt(M)+parseInt(s.getAttribute("id")||0);var P,a=s.getElementsByTagName("image"),a=(a&&0<a.length&&((a=(P=a[0]).getAttribute("source")).replace(/\\/g,"/"),o.sourceImage=this._textures[a],o.sourceImage||cc.errorID(7221,a),(a=cc.size(0,0)).width=parseFloat(P.getAttribute("width")),a.height=parseFloat(P.getAttribute("height")),o._tileSize=a,o.firstGid=this.parentGID),this._tileProperties[this.parentGID]=G(s),s.getElementsByTagName("animation"));if(a&&0<a.length)for(var D=a[0].getElementsByTagName("frame"),a={frames:[],dt:0,frameIdx:0},L=(this._tileAnimations[this.parentGID]=a).frames,V=0;V<D.length;V++){var O=D[V],F=parseInt(M)+parseInt(O.getAttribute("tileid")),O=parseFloat(O.getAttribute("duration"));L.push({tileid:F,duration:O/1e3,grid:null})}}}for(var N=t.childNodes,c=0;c<N.length;c++){var k,l=N[c];this._shouldIgnoreNode(l)||("imagelayer"!==l.nodeName||(k=this._parseImageLayer(l))&&this.setImageLayers(k),"layer"===l.nodeName&&(k=this._parseLayer(l),this.setLayers(k)),"objectgroup"===l.nodeName&&(l=this._parseObjectGroup(l),this.setObjectGroups(l)))}return t},_shouldIgnoreNode:function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},_parseImageLayer:function(t){var e=t.getElementsByTagName("image");if(!e||0==e.length)return null;var i=new cc.TMXImageLayerInfo,n=(i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0,t.getAttribute("visible")),n=(i.visible=!("0"===n),t.getAttribute("opacity")||1),t=(i.opacity=parseInt(255*parseFloat(n))||255,e[0]),n=t.getAttribute("source");return i.sourceImage=this._imageLayerTextures[n],i.width=parseInt(t.getAttribute("width"))||0,i.height=parseInt(t.getAttribute("height"))||0,i.trans=u(t.getAttribute("trans")),i.sourceImage?i:(cc.errorID(7221,n),null)},_parseLayer:function(t){for(var e=t.getElementsByTagName("data")[0],i=new cc.TMXLayerInfo,n=(i.name=t.getAttribute("name"),cc.size(0,0)),n=(n.width=parseFloat(t.getAttribute("width")),n.height=parseFloat(t.getAttribute("height")),i._layerSize=n,t.getAttribute("visible")),n=(i.visible=!("0"===n),t.getAttribute("opacity")||1),r=(i._opacity=n?parseInt(255*parseFloat(n)):255,i.offset=cc.v2(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0),""),s=0;s<e.childNodes.length;s++)r+=e.childNodes[s].nodeValue;var r=r.trim(),n=e.getAttribute("compression"),o=e.getAttribute("encoding");if(n&&"gzip"!==n&&"zlib"!==n)return cc.logID(7218),null;switch(n){case"gzip":a=_.unzipBase64AsArray(r,4);break;case"zlib":var a=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;n<e;n++){var r=4*n;i[n]=t[r]+256*t[1+r]+65536*t[2+r]+t[3+r]*(1<<24)}return i}(new d.Inflate(_.Base64.decodeAsArray(r,1)).decompress());break;case null:case"":if("base64"===o)a=_.Base64.decodeAsArray(r,4);else if("csv"===o){a=[];for(var h=r.split(","),c=0;c<h.length;c++)a.push(parseInt(h[c]))}else{var u=e.getElementsByTagName("tile");a=[];for(var l=0;l<u.length;l++)a.push(parseInt(u[l].getAttribute("gid")))}break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.logID(7219)}return a&&(i._tiles=new Uint32Array(a)),i.properties=G(t),i},_parseObjectGroup:function(t){var e=new cc.TMXObjectGroupInfo,i=(e.name=t.getAttribute("name")||"",e.offset=cc.v2(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety"))),t.getAttribute("opacity")||1),i=(e._opacity=i?parseInt(255*parseFloat(i)):255,t.getAttribute("visible")),i=(i&&0===parseInt(i)&&(e.visible=!1),t.getAttribute("color")),i=(i&&e._color.fromHEX(i),t.getAttribute("draworder")),n=(i&&(e._draworder=i),e.setProperties(G(t)),t.getElementsByTagName("object"));if(n){for(var r=0;r<n.length;r++){var s=n[r],o={},a=(o.id=s.getAttribute("id")||r,o.name=s.getAttribute("name")||"",o.width=parseFloat(s.getAttribute("width"))||0,o.height=parseFloat(s.getAttribute("height"))||0,o.x=parseFloat(s.getAttribute("x"))||0,o.y=parseFloat(s.getAttribute("y"))||0,o.rotation=parseFloat(s.getAttribute("rotation"))||0,G(s,o),s.getAttribute("visible")),a=(o.visible=!(a&&0===parseInt(a)),s.getElementsByTagName("text")),a=(a&&0<a.length&&(a=a[0],o.type=cc.TiledMap.TMXObjectType.TEXT,o.wrap="1"==a.getAttribute("wrap"),o.color=u(a.getAttribute("color")),o.halign=function(t){var e=cc.Label.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}(a.getAttribute("halign")),o.valign=function(t){var e=cc.Label.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}(a.getAttribute("valign")),o.pixelsize=parseInt(a.getAttribute("pixelsize"))||16,o.text=a.childNodes[0].nodeValue),s.getAttribute("gid")),a=(a&&(o.gid=parseInt(a),o.type=cc.TiledMap.TMXObjectType.IMAGE),s.getElementsByTagName("ellipse")),a=(a&&0<a.length&&(o.type=cc.TiledMap.TMXObjectType.ELLIPSE),s.getElementsByTagName("polygon")),a=(a&&0<a.length&&(o.type=cc.TiledMap.TMXObjectType.POLYGON,(a=a[0].getAttribute("points"))&&(o.points=this._parsePointsString(a))),s.getElementsByTagName("polyline"));a&&0<a.length&&(o.type=cc.TiledMap.TMXObjectType.POLYLINE,(s=a[0].getAttribute("points"))&&(o.polylinePoints=this._parsePointsString(s))),o.type||(o.type=cc.TiledMap.TMXObjectType.RECT),e._objects.push(o)}"index"!==i&&e._objects.sort(function(t,e){return t.y-e.y})}return e},_parsePointsString:function(t){if(!t)return null;for(var e=[],i=t.split(" "),n=0;n<i.length;n++){var r=i[n].split(",");e.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return e},setTileAnimations:function(t){this._tileAnimations=t},getTileAnimations:function(){return this._tileAnimations},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties=t},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t}};t=cc.TMXMapInfo.prototype;n.getset(t,"mapWidth",t._getMapWidth,t._setMapWidth),n.getset(t,"mapHeight",t._getMapHeight,t._setMapHeight),n.getset(t,"tileWidth",t._getTileWidth,t._setTileWidth),n.getset(t,"tileHeight",t._getTileHeight,t._setTileHeight),cc.TMXLayerInfo.ATTRIB_NONE=1,cc.TMXLayerInfo.ATTRIB_BASE64=2,cc.TMXLayerInfo.ATTRIB_GZIP=4,cc.TMXLayerInfo.ATTRIB_ZLIB=8},{"../compression/ZipUtils":23,"../compression/zlib.min":26,"../core/platform/CCSAXParser":196,"../core/platform/js":209}],337:[function(t,e,h){"use strict";var i=t("../core/value-types"),u=(n=t("../core/assets/material/material-variant"))&&n.__esModule?n:{default:n};var n=t("../core/components/CCRenderComponent"),_=t("../core/assets/material/CCMaterial"),r=t("../core/renderer/render-flow"),s=cc.mat4(),o=cc.v2(),a=cc.v2(),c={row:0,col:0},l=cc.Class({name:"cc.TiledUserNodeData",extends:cc.Component,ctor:function(){this._index=-1,this._row=-1,this._col=-1,this._tiledLayer=null}}),t=cc.Class({name:"cc.TiledLayer",extends:n,editor:{inspector:"packages://inspector/inspectors/comps/tiled-layer.js"},ctor:function(){this._userNodeGrid={},this._userNodeMap={},this._userNodeDirty=!1,this._tiledTiles=[],this._tilesetIndexArr=[],this._texIdToMatIndex={},this._viewPort={x:-1,y:-1,width:-1,height:-1},this._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},this._cullingDirty=!0,this._rightTop={row:-1,col:-1},this._layerInfo=null,this._mapInfo=null,this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._tiles=[],this._vertices=[],this._verticesDirty=!0,this._layerName="",this._layerOrientation=null,this._texGrids=null,this._textures=null,this._tilesets=null,this._leftDownToCenterX=0,this._leftDownToCenterY=0,this._hasTiledNodeGrid=!1,this._hasAniGrid=!1,this._animations=null,this._enableCulling=cc.macro.ENABLE_TILEDMAP_CULLING},_hasTiledNode:function(){return this._hasTiledNodeGrid},_hasAnimation:function(){return this._hasAniGrid},enableCulling:function(t){this._enableCulling!=t&&(this._enableCulling=t,this._cullingDirty=!0)},addUserNode:function(t){var e=t.getComponent(l);return e?(cc.warn("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(l),t.parent=this.node,t._renderFlag|=r.FLAG_BREAK_FLOW,(this._userNodeMap[t._id]=e)._row=-1,e._col=-1,(e._tiledLayer=this)._nodeLocalPosToLayerPos(t,o),this._positionToRowCol(o.x,o.y,c),this._addUserNodeToGrid(e,c),this._updateCullingOffsetByUserNode(t),t.on(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.on(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},removeUserNode:function(t){var e=t.getComponent(l);return e?(t.off(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.off(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t._id],t._removeComponent(e),e.destroy(),t.removeFromParent(!0),t._renderFlag&=~r.FLAG_BREAK_FLOW,!0):(cc.warn("CCTiledLayer:removeUserNode node is not exist"),!1)},destroyUserNode:function(t){this.removeUserNode(t),t.destroy()},_nodeLocalPosToLayerPos:function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},_getNodesByRowCol:function(t,e){t=this._userNodeGrid[t];return t?t[e]:null},_getNodesCountByRow:function(t){t=this._userNodeGrid[t];return t?t.count:0},_updateAllUserNode:function(){for(var t in this._userNodeGrid={},this._userNodeMap){t=this._userNodeMap[t];this._nodeLocalPosToLayerPos(t.node,o),this._positionToRowCol(o.x,o.y,c),this._addUserNodeToGrid(t,c),this._updateCullingOffsetByUserNode(t.node)}},_updateCullingOffsetByUserNode:function(t){this._topOffset<t.height&&(this._topOffset=t.height),this._downOffset<t.height&&(this._downOffset=t.height),this._leftOffset<t.width&&(this._leftOffset=t.width),this._rightOffset<t.width&&(this._rightOffset=t.width)},_userNodeSizeChange:function(){var t=this.node;this._tiledLayer._updateCullingOffsetByUserNode(t)},_userNodePosChange:function(){var t=this.node,e=this._tiledLayer;e._nodeLocalPosToLayerPos(t,o),e._positionToRowCol(o.x,o.y,c),e._limitInLayer(c),c.row===this._row&&c.col===this._col||(e._removeUserNodeFromGrid(this),e._addUserNodeToGrid(this,c))},_removeUserNodeFromGrid:function(t){var e=t._row,i=t._col,n=t._index,e=this._userNodeGrid[e],i=e&&e[i];i&&(e.count--,i.count--,i.list[n]=null,i.count<=0&&(i.list.length=0,i.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0},_limitInLayer:function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},_addUserNodeToGrid:function(t,e){var i=e.row,e=e.col,n=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},r=n[e]=n[e]||{count:0,list:[]};t._row=i,t._col=e,t._index=r.list.length,n.count++,r.count++,r.list.push(t),this._userNodeDirty=!0},_isUserNodeDirty:function(){return this._userNodeDirty},_setUserNodeDirty:function(t){this._userNodeDirty=t},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this),this._activateMaterial()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},_syncAnchorPoint:function(){var t=this.node;this._leftDownToCenterX=t.width*t.anchorX*t.scaleX,this._leftDownToCenterY=t.height*t.anchorY*t.scaleY,this._cullingDirty=!0},onDestroy:function(){this._super(),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._renderDataList=null},getLayerName:function(){return this._layerName},setLayerName:function(t){this._layerName=t},getProperty:function(t){return this._properties[t]},getPositionAt:function(t,e){var i,n;switch(e=void 0!==e?(i=Math.floor(t),Math.floor(e)):(i=Math.floor(t.x),Math.floor(t.y)),this._layerOrientation){case cc.TiledMap.Orientation.ORTHO:n=this._positionForOrthoAt(i,e);break;case cc.TiledMap.Orientation.ISO:n=this._positionForIsoAt(i,e);break;case cc.TiledMap.Orientation.HEX:n=this._positionForHexAt(i,e)}return n},_isInvalidPosition:function(t,e){var i;return t&&"object"==typeof t&&(e=(i=t).y,t=i.x),t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},_positionForIsoAt:function(t,e){var i=0,n=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this._tiles[r];return r&&(i=(r=this._texGrids[r].tileset.tileOffset).x,n=r.y),cc.v2(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-n)},_positionForOrthoAt:function(t,e){var i=0,n=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this._tiles[r];return r&&(i=(r=this._texGrids[r].tileset.tileOffset).x,n=r.y),cc.v2(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-n)},_positionForHexAt:function(t,e){var i=this._mapTileSize.width,n=this._mapTileSize.height,r=this._layerSize.height,h=Math.floor(t)+Math.floor(e)*this._layerSize.width,h=this._tiles[h],s=this._texGrids[h].tileset.tileOffset,u=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD?1:-1,o=0,a=0,c=0,l=0;switch(this._staggerAxis){case cc.TiledMap.StaggerAxis.STAGGERAXIS_Y:c=0,o=t*i+(c=e%2==1?i/2*u:c)+s.x,a=(r-e-1)*(n-(n-this._hexSideLength)/2)-s.y;break;case cc.TiledMap.StaggerAxis.STAGGERAXIS_X:l=0,o=t*(i-(i-this._hexSideLength)/2)+s.x,a=(r-e-1)*n+(l=t%2==1?n/2*-u:l)-s.y}return cc.v2(o,a)},setTileGIDAt:function(t,e,i,n){if(void 0===e)throw new Error("cc.TiledLayer.setTileGIDAt(): pos should be non-null");var r;if(void 0===n&&e instanceof cc.Vec2?(r=e,n=i):r=cc.v2(e,i),r.x=Math.floor(r.x),r.y=Math.floor(r.y),this._isInvalidPosition(r))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this._tiles&&this._tilesets&&0!=this._tilesets.length?0!==t&&t<this._tilesets[0].firstGid?cc.logID(7239,t):(n=n||0,e=this.getTileFlagsAt(r),this.getTileGIDAt(r)===t&&e===n||this._updateTileForGID((t|n)>>>0,r)):cc.logID(7238)},_updateTileForGID:function(t,e){0!==t&&!this._texGrids[t]||(e=0|e.x+e.y*this._layerSize.width)<this._tiles.length&&(this._tiles[e]=t,this._cullingDirty=!0)},getTileGIDAt:function(t,e){if(void 0===t)throw new Error("cc.TiledLayer.getTileGIDAt(): pos should be non-null");var i=t;if(void 0===e&&(i=t.x,e=t.y),this._isInvalidPosition(i,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this._tiles)return cc.logID(7237),null;t=Math.floor(i)+Math.floor(e)*this._layerSize.width;return(this._tiles[t]&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0},getTileFlagsAt:function(t,e){if(!t)throw new Error("TiledLayer.getTileFlagsAt: pos should be non-null");if(void 0!==e&&(t=cc.v2(t,e)),this._isInvalidPosition(t))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this._tiles)return cc.logID(7240),null;e=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;return(this._tiles[e]&cc.TiledMap.TileFlag.FLIPPED_ALL)>>>0},_setCullingDirty:function(t){this._cullingDirty=t},_isCullingDirty:function(){return this._cullingDirty},_updateViewPort:function(t,e,i,n){var r,s,o;this._viewPort.width===i&&this._viewPort.height===n&&this._viewPort.x===t&&this._viewPort.y===e||(this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=n,t=1,this._layerOrientation===cc.TiledMap.Orientation.ISO&&(t=2),e=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,r=e-this._leftOffset,s=o-this._downOffset,e=e+i+this._rightOffset,i=o+n+this._topOffset,o=this._cullingRect.leftDown,n=this._cullingRect.rightTop,this._positionToRowCol(r=r<0?0:r,s=s<0?0:s,c),c.row-=t,c.col-=t,c.row=0<c.row?c.row:0,c.col=0<c.col?c.col:0,c.row===o.row&&c.col===o.col||(o.row=c.row,o.col=c.col,this._cullingDirty=!0),e<0||i<0?(c.row=-1,c.col=-1):(this._positionToRowCol(e,i,c),c.row++,c.col++),c.row>this._rightTop.row&&(c.row=this._rightTop.row),c.col>this._rightTop.col&&(c.col=this._rightTop.col),c.row===n.row&&c.col===n.col||(n.row=c.row,n.col=c.col,this._cullingDirty=!0))},_positionToRowCol:function(t,e,i){var n,r=cc.TiledMap,s=r.Orientation,h=r.StaggerAxis,o=this._mapTileSize.width,a=this._mapTileSize.height,u=.5*o,_=.5*a,c=0,l=0,d=this._staggerAxis;this._layerSize.width;switch(this._layerOrientation){case s.ORTHO:l=Math.floor(t/o),c=Math.floor(e/a);break;case s.ISO:l=Math.floor(t/u),c=Math.floor(e/_);break;case s.HEX:d===h.STAGGERAXIS_Y?(n=(c=Math.floor(e/(a-this._diffY1)))%2==1?u*this._odd_even:0,l=Math.floor((t-n)/o)):(n=(l=Math.floor(t/(o-this._diffX1)))%2==1?_*-this._odd_even:0,c=Math.floor((e-n)/a))}return i.row=c,i.col=l,i},_updateCulling:function(){var t,e;this._enableCulling&&(this.node._updateWorldMatrix(),i.Mat4.invert(s,this.node._worldMatrix),t=cc.visibleRect,(e=cc.Camera.findCamera(this.node))&&(o.x=0,o.y=0,a.x=o.x+t.width,a.y=o.y+t.height,e.getScreenToWorldPoint(o,o),e.getScreenToWorldPoint(a,a),i.Vec2.transformMat4(o,o,s),i.Vec2.transformMat4(a,a,s),this._updateViewPort(o.x,o.y,a.x-o.x,a.y-o.y)))},getLayerOrientation:function(){return this._layerOrientation},getProperties:function(){return this._properties},_updateVertices:function(){var h=cc.TiledMap,u=h.TileFlag.FLIPPED_MASK,_=h.StaggerAxis,d=h.Orientation,f=this._vertices,p=(f.length=0,this._layerOrientation),m=this._tiles;if(m){for(var t,e,y,g,v,x,b,A,i=this._rightTop,C=(i.row=-1,i.col=-1,this._mapTileSize.width),S=this._mapTileSize.height,T=.5*C,w=.5*S,n=this._layerSize.height,E=this._layerSize.width,M=this._texGrids,I=0,r=(p===d.HEX&&(y=this._staggerAxis,g=this._diffX1,v=this._diffY1,x=this._odd_even),0),s=0,o=(this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1,0),B=0,a=0;a<n;++a){for(var c=0;c<E;++c){var R=I+c,P=M[l=(m[R]&u)>>>0];if(this._animations[l]&&(this._hasAniGrid=!0),P){switch(p){case d.ORTHO:t=(r=c)*C,e=(s=n-a-1)*S;break;case d.ISO:t=T*(r=n+c-a-1),e=w*(s=n+E-c-a-2);break;case d.HEX:t=c*(C-g)+(y===_.STAGGERAXIS_Y&&a%2==1?T*x:0),e=(n-a-1)*(S-v)+(y===_.STAGGERAXIS_X&&c%2==1?w*-x:0),r=c,s=n-a-1}var l=f[s]=f[s]||{minCol:0,maxCol:0},D=l[r]=l[r]||{};l.minCol>r&&(l.minCol=r),l.maxCol<r&&(l.maxCol=r),i.row<s&&(i.row=s),i.col<r&&(i.col=r),l=P.tileset.tileOffset,t+=this._offset.x+l.x,e+=this._offset.y-l.y,o=(o=-l.y+P.tileset._tileSize.height-S)<0?0:o,b=l.y<0?0:l.y,A=-l.x<0?0:-l.x,B=(B=l.x+P.tileset._tileSize.width-C)<0?0:B,this._rightOffset<A&&(this._rightOffset=A),this._leftOffset<B&&(this._leftOffset=B),this._topOffset<b&&(this._topOffset=b),this._downOffset<o&&(this._downOffset=o),D.left=t,D.bottom=e,D.index=R}}I+=E}this._verticesDirty=!1}},getTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this._tiledTiles[n];return!n&&i&&((n=(i=new cc.Node).addComponent(cc.TiledTile))._x=t,n._y=e,n._layer=this,n._updateInfo(),i.parent=this.node),n},setTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;t=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this._tiledTiles[t]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this._tiledTiles.some(function(t,e){return!!t}),i},getTexture:function(t){return t=t||0,this._textures&&0<=t&&this._textures.length>t?this._textures[t]:null},getTextures:function(){return this._textures},setTexture:function(t){this.setTextures([t])},setTextures:function(t){this._textures=t,this._activateMaterial()},getLayerSize:function(){return this._layerSize},getMapTileSize:function(){return this._mapTileSize},getTileSet:function(t){return t=t||0,this._tilesets&&0<=t&&this._tilesets.length>t?this._tilesets[t]:null},getTileSets:function(){return this._tilesets},setTileSet:function(t){this.setTileSets([t])},setTileSets:function(n){this._tilesets=n;for(var t=this._textures=[],r=this._texGrids=[],e=0;e<n.length;e++){var i=n[e];i&&(t[e]=i.sourceImage)}cc.TiledMap.loadAllTextures(t,function(){for(var t=0,e=n.length;t<e;++t){var i=n[t];i&&cc.TiledMap.fillTextureGrids(i,r,t)}this._prepareToRender()}.bind(this))},_traverseAllGrid:function(){for(var t=this._tiles,e=this._texGrids,i=this._tilesetIndexArr,n={},r=cc.TiledMap.TileFlag.FLIPPED_MASK,s=i.length=0;s<t.length;s++){var o,a=t[s];0!==a&&((o=e[a=(a&r)>>>0])?n[o=o.texId]||(n[o]=!0,i.push(o)):cc.error("CCTiledLayer:_traverseAllGrid grid is null, gid is:",a))}},_init:function(t,e,i,n,r){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var s,o,a,c=t._layerSize,c=(this._layerName=t.name,this._tiles=t._tiles,this._properties=t.properties,this._layerSize=c,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this._renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=i,this._textures=n,this._texGrids=r,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize(),this._mapTileSize.width),i=this._mapTileSize.height,n=this._layerSize.width,r=this._layerSize.height;this._layerOrientation===cc.TiledMap.Orientation.HEX?(s=(e=cc.TiledMap).StaggerAxis,e=e.StaggerIndex,a=o=0,this._odd_even=this._staggerIndex===e.STAGGERINDEX_ODD?1:-1,this._staggerAxis===s.STAGGERAXIS_X?(this._diffX1=(c-this._hexSideLength)/2,this._diffY1=0,a=i*(r+.5),o=(c+this._hexSideLength)*Math.floor(n/2)+c*(n%2)):(this._diffX1=0,this._diffY1=(i-this._hexSideLength)/2,o=c*(n+.5),a=(i+this._hexSideLength)*Math.floor(r/2)+i*(r%2)),this.node.setContentSize(o,a)):this._layerOrientation===cc.TiledMap.Orientation.ISO?this.node.setContentSize(.5*c*(e=n+r),.5*i*e):this.node.setContentSize(n*c,r*i),this._offset=cc.v2(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},_prepareToRender:function(){this._updateVertices(),this._traverseAllGrid(),this._updateAllUserNode(),this._activateMaterial()},_activateMaterial:function(){var t=this._tilesetIndexArr;if(0!==t.length){for(var e=this._texIdToMatIndex={},i=this._textures,n=t.length,r=0;r<n;r++){var s=t[r],o=i[s],a=(a=this._materials[r])||_.getBuiltinMaterial("2d-sprite");(a=u.default.create(a,this)).define("CC_USE_MODEL",!0),a.setProperty("texture",o),this._materials[r]=a,e[s]=r}this._materials.length=n,this.markForRender(!0)}else this.disableRender()}});cc.TiledLayer=e.exports=t},{"../core/assets/material/CCMaterial":53,"../core/assets/material/material-variant":60,"../core/components/CCRenderComponent":89,"../core/renderer/render-flow":221,"../core/value-types":279}],338:[function(t,e,i){"use strict";t("./CCTMXXMLParser"),t("./CCTiledMapAsset"),t("./CCTiledLayer"),t("./CCTiledTile"),t("./CCTiledObjectGroup");var t=cc.Enum({ORTHO:0,HEX:1,ISO:2}),n=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5}),r=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:4026531840,FLIPPED_MASK:268435455}),s=cc.Enum({STAGGERAXIS_X:0,STAGGERAXIS_Y:1}),o=cc.Enum({STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1}),a=cc.Enum({RightDown:0,RightUp:1,LeftDown:2,LeftUp:3}),c=cc.Enum({RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4,TEXT:5}),t=cc.Class({name:"cc.TiledMap",extends:cc.Component,editor:!1,ctor:function(){this._texGrids=[],this._textures=[],this._tilesets=[],this._animations=[],this._imageLayers=[],this._layers=[],this._groups=[],this._images=[],this._properties=[],this._tileProperties=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0)},statics:{Orientation:t,Property:n,TileFlag:r,StaggerAxis:s,StaggerIndex:o,TMXObjectType:c,RenderOrder:a},properties:{_tmxFile:{default:null,type:cc.TiledMapAsset},tmxAsset:{get:function(){return this._tmxFile},set:function(t,e){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile())},type:cc.TiledMapAsset}},getMapSize:function(){return this._mapSize},getTileSize:function(){return this._tileSize},getMapOrientation:function(){return this._mapOrientation},getObjectGroups:function(){return this._groups},getObjectGroup:function(t){for(var e=this._groups,i=0,n=e.length;i<n;i++){var r=e[i];if(r&&r.getGroupName()===t)return r}return null},enableCulling:function(t){for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling(t)},getProperties:function(){return this._properties},getLayers:function(){return this._layers},getLayer:function(t){for(var e=this._layers,i=0,n=e.length;i<n;i++){var r=e[i];if(r&&r.getLayerName()===t)return r}return null},_changeLayer:function(t,e){for(var i=this._layers,n=0,r=i.length;n<r;n++){var s=i[n];if(s&&s.getLayerName()===t)return void(i[n]=e)}},getProperty:function(t){return this._properties[t.toString()]},getPropertiesForGID:function(t){return this._tileProperties[t]},__preload:function(){this._tmxFile&&this._applyFile()},onEnable:function(){this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},onDisable:function(){this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},_applyFile:function(){var t=this._tmxFile;if(t){for(var e=t.textures,i=t.textureNames,h=t.textureSizes,n={},r={},s=0;s<e.length;++s){var o=i[s];n[o]=e[s],r[o]=h[s]}for(var u={},e=t.imageLayerTextures,i=t.imageLayerTextureNames,a=0;a<e.length;++a)u[i[a]]=e[a];for(var c=t.tsxFileNames,_=t.tsxFiles,d={},l=0;l<c.length;++l)0<c[l].length&&(d[c[l]]=_[l].text);var t=new cc.TMXMapInfo(t.tmxXmlStr,d,n,r,u),f=t.getTilesets();f&&0!==f.length||cc.logID(7241),this._buildWithMapInfo(t)}else this._releaseMapInfo()},_releaseMapInfo:function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(!0),t[e].node.destroy();t.length=0;for(var n=this._groups,r=0,s=n.length;r<s;r++)n[r].node.removeFromParent(!0),n[r].node.destroy();n.length=0;for(var o=this._images,a=0,c=o.length;a<c;a++)o[a].removeFromParent(!0),o[a].destroy();o.length=0},_syncAnchorPoint:function(){for(var t=this.node.getAnchorPoint(),e=this.node.width*t.x,i=this.node.height*(1-t.y),n=0,r=this._layers.length;n<r;n++)this._layers[n].node.setAnchorPoint(t);for(n=0,r=this._groups.length;n<r;n++){var s=this._groups[n],o=s.node;o.anchorX=.5,o.anchorY=.5,o.x=s._offset.x-e+o.width*o.anchorX,o.y=s._offset.y+i-o.height*o.anchorY}for(n=0,r=this._images.length;n<r;n++){var a=this._images[n];a.anchorX=.5,a.anchorY=.5,a.x=a._offset.x-e+a.width*a.anchorX,a.y=a._offset.y+i-a.height*a.anchorY}},_fillAniGrids:function(t,e){for(var i in e){i=e[i];if(i)for(var n=i.frames,r=0;r<n.length;r++){var s=n[r];s.grid=t[s.tileid]}}},_buildLayerAndGroup:function(){for(var t=this._tilesets,e=this._texGrids,h=this._animations,i=e.length=0,u=t.length;i<u;++i){var _=t[i];_&&cc.TiledMap.fillTextureGrids(_,e,i)}this._fillAniGrids(e,h);for(var n=this._layers,d=this._groups,f=this._images,r={},p=0,m=n.length;p<m;p++)r[n[p].node._name]=!0;for(var y=0,g=d.length;y<g;y++)r[d[y].node._name]=!0;for(var v=0,x=f.length;v<x;v++)r[f[v]._name]=!0;var n=this._layers=[],d=this._groups=[],f=this._images=[],b=this._mapInfo,A=this.node,s=b.getAllChildren(),C=this._textures,S=0,T=0;if(s&&0<s.length)for(var o=0,w=s.length;o<w;o++){var E,a=s[o],c=a.name,l=this.node.getChildByName(c);r[c]=!1,l||((l=new cc.Node).name=c,A.addChild(l)),l.setSiblingIndex(o),l.active=a.visible,a instanceof cc.TMXLayerInfo?((c=(c=l.getComponent(cc.TiledLayer))||l.addComponent(cc.TiledLayer))._init(a,b,t,C,e),a.ownTiles=!1,n.push(c)):a instanceof cc.TMXObjectGroupInfo?((c=(c=l.getComponent(cc.TiledObjectGroup))||l.addComponent(cc.TiledObjectGroup))._init(a,b,e),d.push(c)):a instanceof cc.TMXImageLayerInfo&&(c=a.sourceImage,l.opacity=a.opacity,l.layerInfo=a,l._offset=cc.v2(a.offset.x,-a.offset.y),(E=(a=(a=l.getComponent(cc.Sprite))||l.addComponent(cc.Sprite)).spriteFrame||new cc.SpriteFrame).setTexture(c),a.spriteFrame=E,l.width=c.width,l.height=c.height,f.push(l)),S=Math.max(S,l.width),T=Math.max(T,l.height)}for(var M=A.children,I=0,B=M.length;I<B;I++){var R=M[I];r[R._name]&&R.destroy()}this.node.width=S,this.node.height=T,this._syncAnchorPoint()},_buildWithMapInfo:function(t){this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();for(var e=this._tilesets,i=[],n=this._textures.length=0,r=e.length;n<r;++n){var s=e[n];s&&s.sourceImage&&(this._textures[n]=s.sourceImage,i.push(s.sourceImage))}for(var o=0;o<this._imageLayers.length;o++){var a=this._imageLayers[o];a&&a.sourceImage&&i.push(a.sourceImage)}cc.TiledMap.loadAllTextures(i,function(){this._buildLayerAndGroup()}.bind(this))},update:function(t){var e,i=this._animations,n=this._texGrids;for(e in i){var r=i[e],s=r.frames,o=s[r.frameIdx];r.dt+=t,o.duration<r.dt&&(r.dt=0,r.frameIdx++,r.frameIdx>=s.length&&(r.frameIdx=0),o=s[r.frameIdx]),n[e]=o.grid}}});cc.TiledMap=e.exports=t,cc.TiledMap.loadAllTextures=function(t,e){var i=t.length;if(0!==i)for(var n=0,r=function(){i<=++n&&e()},s=0;s<i;s++){var o=t[s];o.loaded?r():o.once("load",function(){r()})}else e()},cc.TiledMap.fillTextureGrids=function(t,e,h){for(var i=t.sourceImage,u=(t.imageSize.width&&t.imageSize.height||(t.imageSize.width=i.width,t.imageSize.height=i.height),t._tileSize.width),_=t._tileSize.height,n=i.width,r=i.height,i=t.spacing,s=t.margin,d=Math.floor((n-2*s+i)/(u+i)),s=Math.floor((r-2*s+i)/(_+i))*d,o=t.firstGid,a=null,c=!!e[o],l=cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX?.5:0,f=t.firstGid+(s=s<=0?1:s);o<f&&((c=!(c&&!e[o])&&c)||!e[o]);++o)t.rectForGID(o,a={texId:h,tileset:t,x:0,y:0,width:u,height:_,t:0,l:0,r:0,b:0,gid:o}),a.x+=l,a.y+=l,a.width-=2*l,a.height-=2*l,a.t=a.y/r,a.l=a.x/n,a.r=(a.x+a.width)/n,a.b=(a.y+a.height)/r,e[o]=a},cc.js.obsolete(cc.TiledMap.prototype,"cc.TiledMap.tmxFile","tmxAsset",!0),cc.js.get(cc.TiledMap.prototype,"mapLoaded",function(){return cc.errorID(7203),[]},!1)},{"./CCTMXXMLParser":336,"./CCTiledLayer":337,"./CCTiledMapAsset":339,"./CCTiledObjectGroup":341,"./CCTiledTile":342}],339:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TiledMapAsset",extends:cc.Asset,properties:{tmxXmlStr:"",textures:{default:[],type:[cc.Texture2D]},textureNames:[cc.String],textureSizes:{default:[],type:[cc.Size]},imageLayerTextures:{default:[],type:[cc.Texture2D]},imageLayerTextureNames:[cc.String],tsxFiles:[cc.TextAsset],tsxFileNames:[cc.String]},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=n,e.exports=n},{}],340:[function(t,e,i){"use strict";var n=(t=t("../renderer/core/input-assembler"))&&t.__esModule?t:{default:t};t=cc.Class({name:"cc.TiledMapRenderDataList",ctor:function(){this._dataList=[],this._offset=0},_pushRenderData:function(){var t={};t.ia=new n.default,t.nodesRenderList=[],this._dataList.push(t)},popRenderData:function(t){this._offset>=this._dataList.length&&this._pushRenderData();var e=this._dataList[this._offset],i=(e.nodesRenderList.length=0,e.ia);return i._vertexBuffer=t._vb,i._indexBuffer=t._ib,i._start=t.indiceOffset,i._count=0,this._offset++,e},pushNodesList:function(t,e){t.nodesRenderList.push(e)},reset:function(){this._offset=0}});cc.TiledMapRenderDataList=e.exports=t},{"../renderer/core/input-assembler":302}],341:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TiledObjectGroup",extends:cc.Component,getPositionOffset:function(){return this._positionOffset},getProperties:function(){this._properties},getGroupName:function(){return this._groupName},getProperty:function(t){return this._properties[t.toString()]},getObject:function(t){for(var e=0,i=this._objects.length;e<i;e++){var n=this._objects[e];if(n&&n.name===t)return n}return null},getObjects:function(){return this._objects},_init:function(h,t,u){for(var e=cc.TiledMap,_=e.TMXObjectType,d=e.Orientation,f=e.StaggerAxis,e=e.TileFlag,p=e.FLIPPED_MASK,m=e.HORIZONTAL,y=e.VERTICAL,i=(this._groupName=h.name,this._positionOffset=h.offset,this._mapInfo=t,this._properties=h.getProperties(),this._offset=cc.v2(h.offset.x,-h.offset.y),this._opacity=h._opacity,t._mapSize),n=t._tileSize,e=0,g=0,v=(t.orientation===d.HEX?t.getStaggerAxis()===f.STAGGERAXIS_X?(g=n.height*(i.height+.5),e=(n.width+t.getHexSideLength())*Math.floor(i.width/2)+n.width*(i.width%2)):(e=n.width*(i.width+.5),g=(n.height+t.getHexSideLength())*Math.floor(i.height/2)+n.height*(i.height%2)):g=t.orientation===d.ISO?(f=i.width+i.height,e=.5*n.width*f,.5*n.height*f):(e=i.width*n.width,i.height*n.height),this.node.setContentSize(e,g),e*this.node.anchorX),x=g*(1-this.node.anchorY),b=h._objects,A={},C=0,S=b.length;C<S;C++){var T,r,s,w,o,E,M,I,a,c=b[C],l=c.type,B=(c.offset=cc.v2(c.x,c.y),c.points||c.polylinePoints);if(B)for(var R=0;R<B.length;R++)B[R].y*=-1;d.ISO!==t.orientation?c.y=g-c.y:(T=c.x/n.height,r=c.y/n.height,c.x=.5*n.width*(i.height+T-r),c.y=.5*n.height*(i.width+i.height-T-r)),l===_.TEXT&&(A[T="text"+c.id]=!0,(r=(r=this.node.getChildByName(T))||new cc.Node).anchorX=0,r.anchorY=1,r.angle=-c.rotation,r.x=c.x-v,r.y=c.y-x,r.name=T,r.parent=this.node,r.color=c.color,r.opacity=this._opacity,r.setSiblingIndex(C),(s=(s=r.getComponent(cc.Label))||r.addComponent(cc.Label)).overflow=cc.Label.Overflow.SHRINK,s.lineHeight=c.height,s.string=c.text,s.horizontalAlign=c.halign,s.verticalAlign=c.valign,s.fontSize=c.pixelsize,r.width=c.width,r.height=c.height),l!==_.IMAGE||(l=u[((s=c.gid)&p)>>>0])&&(a=l.tileset,A[w="img"+c.id]=!0,o=this.node.getChildByName(w),E=c.width||l.width,M=c.height||l.height,I=a.tileOffset.x,a=a.tileOffset.y,o instanceof cc.PrivateNode&&(o.removeFromParent(),o.destroy(),o=null),o=o||new cc.Node,d.ISO==t.orientation?o.anchorX=.5+I/E:o.anchorX=I/E,o.anchorY=a/M,o.angle=-c.rotation,o.x=c.x-v,o.y=c.y-x,o.name=w,o.parent=this.node,o.opacity=this._opacity,o.setSiblingIndex(C),a=(a=(I=(I=o.getComponent(cc.Sprite))||o.addComponent(cc.Sprite)).spriteFrame)||new cc.SpriteFrame,(s&m)>>>0?a.setFlipX(!0):a.setFlipX(!1),(s&y)>>>0?a.setFlipY(!0):a.setFlipY(!1),a.setTexture(l.tileset.sourceImage,cc.rect(l)),I.spriteFrame=a,I.setVertsDirty(),o.width=E,o.height=M)}this._objects=b;for(var P=this.node.children,D=/^(?:img|text)\d+$/,L=0,V=P.length;L<V;L++){var O=P[L],F=O._name;D.test(F)&&!A[F]&&O.destroy()}}});cc.TiledObjectGroup=e.exports=n},{}],342:[function(t,e,i){"use strict";var n=cc.Class({name:"cc.TiledTile",extends:cc.Component,editor:!1,ctor:function(){this._layer=null},properties:{_x:0,_y:0,x:{get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer._isInvalidPosition(t,this._y)?cc.warn("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.width):(this._resetTile(),this._x=t,this._updateInfo()))},type:cc.Integer},y:{get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer._isInvalidPosition(this._x,t)?cc.warn("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.height):(this._resetTile(),this._y=t,this._updateInfo()))},type:cc.Integer},gid:{get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)},type:cc.Integer}},onEnable:function(){var t=this.node.parent;this._layer=t.getComponent(cc.TiledLayer),this._resetTile(),this._updateInfo()},onDisable:function(){this._resetTile()},_resetTile:function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},_updateInfo:function(){var t,e;this._layer&&(t=this._x,e=this._y,this._layer.getTiledTileAt(t,e)?cc.warn("There is already a TiledTile at [%s, %s]",t,e):(this.node.setPosition(this._layer.getPositionAt(t,e)),this._layer.setTiledTileAt(t,e,this)))}});cc.TiledTile=e.exports=n},{}],343:[function(t,e,i){"use strict";t("./CCTiledMap"),t("./CCTiledMapRenderDataList"),t("./tiledmap-buffer"),t("./tmx-layer-assembler")},{"./CCTiledMap":338,"./CCTiledMapRenderDataList":340,"./tiledmap-buffer":344,"./tmx-layer-assembler":345}],344:[function(t,e,i){"use strict";t=cc.Class({name:"cc.TiledMapBuffer",extends:t("../core/renderer/webgl/quad-buffer"),_updateOffset:function(){var t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.indiceStart=this.indiceOffset,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0}});cc.TiledMapBuffer=e.exports=t},{"../core/renderer/webgl/quad-buffer":249}],345:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../core/renderer/assembler"))&&n.__esModule?n:{default:n},d=t("../core/value-types");function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=t("./CCTiledLayer"),a=t("./CCTiledMap"),V=a.TileFlag,O=V.FLIPPED_MASK,c=t("../core/renderer/"),l=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor,F=parseInt(10922.5),f=a.RenderOrder,h=t("../core/renderer/render-flow"),p=cc.mat4(),m=cc.v3(),y={row:0,col:0},N={x:0,y:0},w={x:0,y:0},E={x:0,y:0},k={x:0,y:0},M=null,G=null,z=0,I=0,U=0,W=0,g=null,B=null,R=null,P=null,H=null,D=null,L=null,j=null;function v(t){t._updateLocalMatrix(),d.Mat4.mul(t._worldMatrix,g,t._matrix),t._renderFlag&=~(h.FLAG_TRANSFORM|h.FLAG_BREAK_FLOW),h.visitRootNode(t),t._renderFlag|=h.FLAG_BREAK_FLOW}function X(){0!==G._count&&(B.material=M.material,B.node=D.node,B._flushIA(M.ia),F<=z?(P.uploadData(),P.switchBuffer(),L=P._vData,j=P._uintVData,M=R.popRenderData(P),G=M.ia,z=I=0):(M=R.popRenderData(P),G=M.ia),M.material=H)}function Y(t,e){var i=D._getNodesByRowCol(t,e);if(i&&0!=i.count){var n=i.list,r=0,s=0;for(X(),B.worldMatDirty++;r<i.count;){var o=n[s];s++,o&&(v(o.node),r!==s&&((n[r]=o)._index=r),r++)}n.length=r,B.worldMatDirty--,R.pushNodesList(M,n),B._flush(),B.node=D.node}}u=n.default,a=u,(t=_).prototype=Object.create(a.prototype),(t.prototype.constructor=t).__proto__=a,r(_),(t=_.prototype).updateRenderData=function(t){t._renderDataList||(t._buffer=new cc.TiledMapBuffer(c._handle,l),t._renderDataList=new cc.TiledMapRenderDataList)},t.fillBuffers=function(t,e){if(0!==t._vertices.length){t._updateCulling();var i,n,h=t.node;if(U=t._leftDownToCenterX,W=t._leftDownToCenterY,g=h._worldMatrix,B=e,R=(D=t)._renderDataList,P=t._buffer,t._isCullingDirty()||t._isUserNodeDirty()||t._hasAnimation()||t._hasTiledNode()){P.reset();var r=((n=t._enableCulling?(i=(r=t._cullingRect).leftDown,r.rightTop):(i=y,t._rightTop)).row-i.row+1)*(n.col-i.col+1);switch(F<r&&(r=F),P.request(4*r,6*r),t._renderOrder){case f.RightDown:this.traverseGrids(i,n,-1,1);break;case f.LeftDown:this.traverseGrids(i,n,-1,-1);break;case f.RightUp:this.traverseGrids(i,n,1,1);break;case f.LeftUp:this.traverseGrids(i,n,1,-1)}t._setCullingDirty(!1),t._setUserNodeDirty(!1)}else for(var s,o,a,c=0;c<R._offset;c++){if(0<(o=(s=R._dataList[c]).nodesRenderList).length){e.worldMatDirty++;for(var l=0;l<o.length;l++)if(a=o[l])for(var u=0;u<a.length;u++){var _=a[u];_&&v(_.node)}e.worldMatDirty--,e._flush()}0<s.ia._count&&(e.material=s.material,e.node=h,e._flushIA(s.ia))}j=L=D=H=P=R=B=g=G=M=null}},t.traverseGrids=function(t,e,h,u){if(R.reset(),!(e.row<0||e.col<0)){M=R.popRenderData(P),G=M.ia,L=P._vData,j=P._uintVData,I=z=0,H=null;for(var i,n,_,r,s,d,o,f,a,p,m,c,l,y=D.node._color._val,g=D._tiledTiles,v=D._texGrids,x=D._tiles,b=D._texIdToMatIndex,A=D._materials,C=D._vertices,S=-1,T=-1==h?(r=e.row,t.row):(r=t.row,e.row);0<=(T-r)*h;r+=h)for(i=C[r],m=0==(p=D._getNodesCountByRow(r))&&null!=i,_=1==u?(n=m&&t.col<i.minCol?i.minCol:t.col,m&&e.col>i.maxCol?i.maxCol:e.col):(n=m&&e.col>i.maxCol?i.maxCol:e.col,m&&t.col<i.minCol?i.minCol:t.col);0<=(_-n)*u;n+=u)(c=i&&i[n])?(s=v[((d=x[c.index])&O)>>>0])&&(S!==s.texId&&(-1!==S&&X(),a=b[S=s.texId],H=A[a],M.material=H),H&&(a=c.left-U,o=c.bottom-W,f=a+(l=s.tileset._tileSize).width,l=o+l.height,(c=g[c.index])?this.fillByTiledNode(c.node,L,j,a,f,l,o):(L[I]=a,L[I+1]=l,j[I+4]=y,L[I+5]=a,L[I+6]=o,j[I+9]=y,L[I+10]=f,L[I+11]=l,j[I+14]=y,L[I+15]=f,L[I+16]=o,j[I+19]=y),c=s,l=d,N.x=c.l,N.y=c.t,w.x=c.r,w.y=c.t,E.x=c.l,E.y=c.b,k.x=c.r,k.y=c.b,c=null,(l&V.DIAGONAL)>>>0&&(c=w,w=E,E=c),(l&V.HORIZONTAL)>>>0&&(c=N,N=w,w=c,c=E,E=k,k=c),(l&V.VERTICAL)>>>0&&(c=N,N=E,E=c,c=w,w=k,k=c),L[I+2]=N.x,L[I+3]=N.y,L[I+7]=E.x,L[I+8]=E.y,L[I+12]=w.x,L[I+13]=w.y,L[I+17]=k.x,L[I+18]=k.y,I+=20,P.adjust(4,6),G._count+=6,z++,0<p&&Y(r,n),F<=z&&X())):0<p&&Y(r,n);P.uploadData(),0<G._count&&(B.material=M.material,B.node=D.node,B._flushIA(M.ia))}},t.fillByTiledNode=function(t,e,i,n,r,s,o){t._updateLocalMatrix(),d.Mat4.copy(p,t._matrix),d.Vec3.set(m,-(n+U),-(o+W),0),d.Mat4.transform(p,p,m);var a=p.m,c=a[0],l=a[1],h=a[4],u=a[5],_=a[12],a=a[13],t=t._color._val;e[I]=n*c+s*h+_,e[I+1]=n*l+s*u+a,i[I+4]=t,e[I+5]=n*c+o*h+_,e[I+6]=n*l+o*u+a,i[I+9]=t,e[I+10]=r*c+s*h+_,e[I+11]=r*l+s*u+a,i[I+14]=t,e[I+15]=r*c+o*h+_,e[I+16]=r*l+o*u+a,i[I+19]=t};var u,a=_;function _(){return u.apply(this,arguments)||this}i.default=a,n.default.register(o,a),e.exports=i.default},{"../core/renderer/":220,"../core/renderer/assembler":217,"../core/renderer/render-flow":221,"../core/renderer/webgl/vertex-format":252,"../core/value-types":279,"./CCTiledLayer":337,"./CCTiledMap":338}],346:[function(t,e,i){"use strict";var n=t("./video-player-impl"),r=n.EventType,s=cc.Enum({REMOTE:0,LOCAL:1}),t=cc.Class({name:"cc.VideoPlayer",extends:cc.Component,editor:!1,properties:{_resourceType:s.REMOTE,resourceType:{tooltip:!1,type:s,set:function(t){this._resourceType=t,this._updateVideoSource()},get:function(){return this._resourceType}},_remoteURL:"",remoteURL:{tooltip:!1,type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource()},get:function(){return this._remoteURL}},_clip:{default:null,type:cc.Asset},clip:{tooltip:!1,get:function(){return this._clip},set:function(t){this._clip=t,this._updateVideoSource()},type:cc.Asset},currentTime:{tooltip:!1,type:cc.Float,set:function(t){this._impl&&this._impl.seekTo(t)},get:function(){return this._impl?this._currentStatus===r.NONE||this._currentStatus===r.STOPPED||this._currentStatus===r.META_LOADED||this._currentStatus===r.READY_TO_PLAY?0:this._currentStatus===r.COMPLETED?this._impl.duration():this._impl.currentTime():-1}},_volume:1,volume:{get:function(){return this._volume},set:function(t){this._volume=t,this.isPlaying()&&!this._mute&&this._syncVolume()},range:[0,1],type:cc.Float,tooltip:!1},_mute:!1,mute:{get:function(){return this._mute},set:function(t){this._mute=t,this._syncVolume()},tooltip:!1},keepAspectRatio:{tooltip:!1,default:!0,type:cc.Boolean,notify:function(){this._impl&&this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio)}},_isFullscreen:{default:!1,formerlySerializedAs:"_N$isFullscreen"},isFullscreen:{get:function(){return this._isFullscreen=this._impl&&this._impl.isFullScreenEnabled(),this._isFullscreen},set:function(t){this._isFullscreen=t,this._impl&&this._impl.setFullScreenEnabled(t)},animatable:!1,tooltip:!1},_stayOnBottom:!1,stayOnBottom:{get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom=t,this._impl&&this._impl.setStayOnBottom(t)},animatable:!1,tooltip:!1},videoPlayerEvent:{default:[],type:cc.Component.EventHandler}},statics:{EventType:r,ResourceType:s,Impl:n},ctor:function(){this._impl=new n,this._currentStatus=r.NONE},_syncVolume:function(){var t,e=this._impl;e&&(t=this._mute?0:this._volume,e.setVolume(t))},_updateVideoSource:function(){var t="";this.resourceType===s.REMOTE?t=this.remoteURL:this._clip&&(t=this._clip.nativeUrl||""),t&&cc.loader.md5Pipe&&(t=cc.loader.md5Pipe.transformURL(t)),this._impl.setURL(t,this._mute||0===this._volume),this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio)},onLoad:function(){var t=this._impl;t&&(t.createDomElementIfNeeded(this._mute||0===this._volume),t.setStayOnBottom(this._stayOnBottom),this._updateVideoSource(),t.seekTo(this.currentTime),t.setFullScreenEnabled(this._isFullscreen),this.pause(),t.setEventListener(r.PLAYING,this.onPlaying.bind(this)),t.setEventListener(r.PAUSED,this.onPasued.bind(this)),t.setEventListener(r.STOPPED,this.onStopped.bind(this)),t.setEventListener(r.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(r.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(r.CLICKED,this.onClicked.bind(this)),t.setEventListener(r.READY_TO_PLAY,this.onReadyToPlay.bind(this)))},onRestore:function(){this._impl||(this._impl=new n)},onEnable:function(){this._impl&&this._impl.enable()},onDisable:function(){this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(t){this._impl&&this._impl.updateMatrix(this.node)},onReadyToPlay:function(){this._currentStatus=r.READY_TO_PLAY,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.READY_TO_PLAY),this.node.emit("ready-to-play",this)},onMetaLoaded:function(){this._currentStatus=r.META_LOADED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.META_LOADED),this.node.emit("meta-loaded",this)},onClicked:function(){this._currentStatus=r.CLICKED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.CLICKED),this.node.emit("clicked",this)},onPlaying:function(){this._currentStatus=r.PLAYING,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.PLAYING),this.node.emit("playing",this)},onPasued:function(){this._currentStatus=r.PAUSED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.PAUSED),this.node.emit("paused",this)},onStopped:function(){this._currentStatus=r.STOPPED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.STOPPED),this.node.emit("stopped",this)},onCompleted:function(){this._currentStatus=r.COMPLETED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.COMPLETED),this.node.emit("completed",this)},play:function(){this._impl&&(this._syncVolume(),this._impl.play())},resume:function(){this._impl&&(this._syncVolume(),this._impl.resume())},pause:function(){this._impl&&this._impl.pause()},stop:function(){this._impl&&this._impl.stop()},getDuration:function(){return this._impl?this._impl.duration():-1},isPlaying:function(){return!!this._impl&&this._impl.isPlaying()}});cc.VideoPlayer=e.exports=t},{"./video-player-impl":347}],347:[function(t,e,o){"use strict";var i=t("../core/platform/utils"),_=t("../core/platform/CCSys"),n=t("../core/platform/CCMacro"),r=1,s=4,d=cc.mat4(),f=cc.Class({name:"VideoPlayerImpl",ctor:function(){this._EventList={},this._video=null,this._url="",this._waitingFullscreen=!1,this._fullScreenEnabled=!1,this._stayOnBottom=!1,this._loadedmeta=!1,this._loaded=!1,this._visible=!1,this._playing=!1,this._ignorePause=!1,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={}},_bindEvent:function(){var t=this._video,e=this,i=this.__eventListeners;i.loadedmetadata=function(){e._loadedmeta=!0,e._forceUpdate=!0,e._waitingFullscreen&&(e._waitingFullscreen=!1,e._toggleFullscreen(!0)),e._dispatchEvent(f.EventType.META_LOADED)},i.ended=function(){e._video===t&&(e._playing=!1,e._dispatchEvent(f.EventType.COMPLETED))},i.play=function(){e._video===t&&(e._playing=!0,e._updateVisibility(),e._dispatchEvent(f.EventType.PLAYING))},i.pause=function(){e._video===t&&(e._playing=!1,e._ignorePause||e._dispatchEvent(f.EventType.PAUSED))},i.click=function(){e._dispatchEvent(f.EventType.CLICKED)},t.addEventListener("loadedmetadata",i.loadedmetadata),t.addEventListener("ended",i.ended),t.addEventListener("play",i.play),t.addEventListener("pause",i.pause),t.addEventListener("click",i.click),i.onCanPlay=function(){var t;e._loaded||e._playing||((t=e._video).readyState!==s&&t.readyState!==r||(t.currentTime=0,e._loaded=!0,e._forceUpdate=!0,e._dispatchEvent(f.EventType.READY_TO_PLAY),e._updateVisibility()))},t.addEventListener("canplay",i.onCanPlay),t.addEventListener("canplaythrough",i.onCanPlay),t.addEventListener("suspend",i.onCanPlay)},_updateVisibility:function(){var t=this._video;t&&(this._visible?t.style.visibility="visible":(t.style.visibility="hidden",t.pause(),this._playing=!1))},_updateSize:function(t,e){var i=this._video;i&&(i.style.width=t+"px",i.style.height=e+"px")},_createDom:function(t){var e=document.createElement("video");e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["z-index"]=this._stayOnBottom?n.MIN_ZINDEX:0,e.className="cocosVideo",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),t&&e.setAttribute("muted",""),this._video=e,cc.game.container.appendChild(e)},createDomElementIfNeeded:function(t){this._video||this._createDom(t)},removeDom:function(){var t,e=this._video;e&&(i.contains(cc.game.container,e)&&cc.game.container.removeChild(e),t=this.__eventListeners,e.removeEventListener("loadedmetadata",t.loadedmetadata),e.removeEventListener("ended",t.ended),e.removeEventListener("play",t.play),e.removeEventListener("pause",t.pause),e.removeEventListener("click",t.click),e.removeEventListener("canplay",t.onCanPlay),e.removeEventListener("canplaythrough",t.onCanPlay),e.removeEventListener("suspend",t.onCanPlay),t.loadedmetadata=null,t.ended=null,t.play=null,t.pause=null,t.click=null,t.onCanPlay=null),this._video=null,this._url=""},setURL:function(t,e){var i,n;if(this._url!==t){this.removeDom(),this._url=t,this.createDomElementIfNeeded(e),this._bindEvent();for(var r=this._video,s=(r.style.visibility="hidden",this._loaded=!1,this._playing=!1,this._loadedmeta=!1,(i=document.createElement("source")).src=t,r.appendChild(i),n=cc.path.extname(t),f._polyfill),o=0;o<s.canPlayType.length;o++)n!==s.canPlayType[o]&&((i=document.createElement("source")).src=t.replace(n,s.canPlayType[o]),r.appendChild(i))}},getURL:function(){return this._url},play:function(){var t=this._video;t&&this._visible&&!this._playing&&(f._polyfill.autoplayAfterOperation?setTimeout(function(){t.play()},20):t.play())},pause:function(){var t=this._video;this._playing&&t&&t.pause()},resume:function(){this.play()},stop:function(){var t=this._video;t&&this._visible&&(this._ignorePause=!0,t.currentTime=0,t.pause(),setTimeout(function(){this._dispatchEvent(f.EventType.STOPPED),this._ignorePause=!1}.bind(this),0))},setVolume:function(t){var e=this._video;e&&(e.volume=t)},seekTo:function(e){var i=this._video;i&&(this._loaded?i.currentTime=e:i.addEventListener(f._polyfill.event,function t(){i.currentTime=e,i.removeEventListener(f._polyfill.event,t)}),f._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){i.play()},20))},isPlaying:function(){var t=this._video;return f._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){t.play()},20),this._playing},duration:function(){var t=this._video,e=-1;return t&&(e=t.duration)<=0&&cc.logID(7702),e},currentTime:function(){var t=this._video;return t?t.currentTime:-1},setKeepAspectRatioEnabled:function(){cc.logID(7700)},isKeepAspectRatioEnabled:function(){return!0},_toggleFullscreen:function(t){var i=this,n=this._video;n&&(t?(_.browserType===_.BROWSER_TYPE_IE&&(n.style.transform=""),cc.screen.requestFullScreen(n,function(t){var e=_.browserType===_.BROWSER_TYPE_IE?document.msFullscreenElement:document.fullscreenElement;i._fullScreenEnabled=e===n},function(t){i._fullScreenEnabled=!1})):cc.screen.fullScreen()&&cc.screen.exitFullScreen(n))},setStayOnBottom:function(t){this._stayOnBottom=t,this._video&&(this._video.style["z-index"]=t?n.MIN_ZINDEX:0)},setFullScreenEnabled:function(t){!this._loadedmeta&&t?this._waitingFullscreen=!0:this._toggleFullscreen(t)},isFullScreenEnabled:function(){return this._fullScreenEnabled},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){t=this._EventList[t];t&&t.call(this,this,this._video.src)},onPlayEvent:function(){this._EventList[f.EventType.PLAYING].call(this,this,this._video.src)},enable:function(){var t=f.elements;-1===t.indexOf(this)&&t.push(this),this.setVisible(!0)},disable:function(){var t=f.elements,e=t.indexOf(this);-1!==e&&t.splice(e,1),this.setVisible(!1)},destroy:function(){this.disable(),this.removeDom()},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility())},updateMatrix:function(t){var e,i,n,r,s,h,o,u,a,c,l;this._video&&this._visible&&!this._fullScreenEnabled&&(t.getWorldMatrix(d),(e=cc.Camera._findRendererCamera(t))&&e.worldMatrixToScreen(d,d,cc.game.canvas.width,cc.game.canvas.height),e=d.m,!this._forceUpdate&&this._m00===e[0]&&this._m01===e[1]&&this._m04===e[4]&&this._m05===e[5]&&this._m12===e[12]&&this._m13===e[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height||(this._m00=e[0],this._m01=e[1],this._m04=e[4],this._m05=e[5],this._m12=e[12],this._m13=e[13],this._w=t._contentSize.width,this._h=t._contentSize.height,n=i=1/cc.view._devicePixelRatio,a=cc.game.container,r=e[0]*i,s=e[1],h=e[4],o=e[5]*n,u=a&&a.style.paddingLeft?parseInt(a.style.paddingLeft):0,a=a&&a.style.paddingBottom?parseInt(a.style.paddingBottom):0,f._polyfill.zoomInvalid?(this._updateSize(this._w*r,this._h*o),o=r=1,c=this._w*i,l=this._h*n):(c=this._w*i,l=this._h*n,this._updateSize(this._w,this._h)),c=c*e[0]*t._anchorPoint.x,l=l*e[5]*t._anchorPoint.y,t="matrix("+r+","+-s+","+-h+","+o+","+(e[12]*i-c+u)+","+-(e[13]*n-l+a)+")",this._video.style.transform=t,this._video.style["-webkit-transform"]=t,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px",_.browserType!==_.BROWSER_TYPE_IE&&(this._forceUpdate=!1)))}}),t=(f.EventType={NONE:-1,PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},f.elements=[],f.pauseElements=[],cc.game.on(cc.game.EVENT_HIDE,function(){for(var t,e=f.elements,i=0;i<e.length;i++)(t=e[i]).isPlaying()&&(t.pause(),f.pauseElements.push(t))}),cc.game.on(cc.game.EVENT_SHOW,function(){for(var t=f.pauseElements,e=t.pop();e;)e.play(),e=t.pop()}),f._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},document.createElement("video")),t=(t.canPlayType&&(t.canPlayType("video/ogg")&&(f._polyfill.canPlayType.push(".ogg"),f._polyfill.canPlayType.push(".ogv")),t.canPlayType("video/mp4")&&f._polyfill.canPlayType.push(".mp4"),t.canPlayType("video/webm")&&f._polyfill.canPlayType.push(".webm")),_.browserType===_.BROWSER_TYPE_FIREFOX&&(f._polyfill.autoplayAfterOperation=!0),_.OS_ANDROID!==_.os||_.browserType!==_.BROWSER_TYPE_SOUGOU&&_.browserType!==_.BROWSER_TYPE_360||(f._polyfill.zoomInvalid=!0),document.createElement("style"));t.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(t),e.exports=f},{"../core/platform/CCMacro":194,"../core/platform/CCSys":198,"../core/platform/utils":213}],348:[function(t,e,i){"use strict";var t=t("./webview-impl"),n=t.EventType;function r(){}var s=cc.Class({name:"cc.WebView",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_url:"",url:{type:cc.String,tooltip:!1,get:function(){return this._url},set:function(t){this._url=t;var e=this._impl;e&&e.loadURL(t)}},webviewEvents:{default:[],type:cc.Component.EventHandler}},statics:{EventType:n,Impl:t},ctor:function(){this._impl=new s.Impl},onRestore:function(){this._impl||(this._impl=new s.Impl)},onEnable:function(){var t=this._impl;t.createDomElementIfNeeded(this.node.width,this.node.height),t.setEventListener(n.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(n.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(n.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setVisible(!0)},onDisable:function(){var t=this._impl;t.setVisible(!1),t.setEventListener(n.LOADED,r),t.setEventListener(n.LOADING,r),t.setEventListener(n.ERROR,r)},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(t){this._impl&&this._impl.updateMatrix(this.node)},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.LOADED),this.node.emit("loaded",this)},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.LOADING),this.node.emit("loading",this),!0},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.ERROR),this.node.emit("error",this)},setJavascriptInterfaceScheme:function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},setOnJSCallback:function(t){this._impl&&this._impl.setOnJSCallback(t)},evaluateJS:function(t){this._impl&&this._impl.evaluateJS(t)}});cc.WebView=e.exports=s},{"./webview-impl":349}],349:[function(t,e,i){"use strict";var n=t("../core/platform/utils"),t=t("../core/platform/CCSys"),_=cc.mat4(),r=cc.Class({name:"WebViewImpl",ctor:function(){this._EventList={},this._visible=!1,this._parent=null,this._div=null,this._iframe=null,this._listener=null,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={}},_updateVisibility:function(){var t;this._div&&(t=this._div,this._visible?t.style.visibility="visible":t.style.visibility="hidden")},_updateSize:function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},_initEvent:function(){var t,e,i=this._iframe;i&&(t=this.__eventListeners,e=this,t.load=function(){e._forceUpdate=!0,e._dispatchEvent(r.EventType.LOADED)},t.error=function(){e._dispatchEvent(r.EventType.ERROR)},i.addEventListener("load",t.load),i.addEventListener("error",t.error))},_initStyle:function(){var t;this._div&&((t=this._div).style.position="absolute",t.style.bottom="0px",t.style.left="0px")},_setOpacity:function(t){var e=this._iframe;e&&e.style&&(e.style.opacity=t/255)},_createDom:function(t,e){r._polyfill.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%"):this._div=this._iframe=document.createElement("iframe"),r._polyfill.enableBG&&(this._div.style.background="#FFF"),this._div.style.background="#FFF",this._div.style.height=e+"px",this._div.style.width=t+"px",this._div.style.overflow="scroll",this._iframe.style.border="none",cc.game.container.appendChild(this._div),this._updateVisibility()},_createNativeControl:function(t,e){this._createDom(t,e),this._initStyle(),this._initEvent()},createDomElementIfNeeded:function(t,e){this._div?this._updateSize(t,e):this._createNativeControl(t,e)},removeDom:function(){var t,e=this._div,e=(e&&(n.contains(cc.game.container,e)&&cc.game.container.removeChild(e),this._div=null),this._iframe);e&&(t=this.__eventListeners,e.removeEventListener("load",t.load),e.removeEventListener("error",t.error),t.load=null,t.error=null,this._iframe=null)},setOnJSCallback:function(t){},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,n){},loadHTMLString:function(t,e){},loadURL:function(t){var e,i=this._iframe;i&&(i.src=t,e=this,i.addEventListener("load",function t(){e._loaded=!0,e._updateVisibility(),i.removeEventListener("load",t)}),this._dispatchEvent(r.EventType.LOADING))},stopLoading:function(){cc.logID(7800)},reload:function(){var t=this._iframe;!t||(t=t.contentWindow)&&t.location&&t.location.reload()},canGoBack:function(){return cc.logID(7801),!0},canGoForward:function(){return cc.logID(7802),!0},goBack:function(){try{if(r._polyfill.closeHistory)return cc.logID(7803);var t,e=this._iframe;!e||(t=e.contentWindow)&&t.location&&t.history.back.call(t)}catch(t){cc.log(t)}},goForward:function(){try{if(r._polyfill.closeHistory)return cc.logID(7804);var t,e=this._iframe;!e||(t=e.contentWindow)&&t.location&&t.history.forward.call(t)}catch(t){cc.log(t)}},evaluateJS:function(t){var e=this._iframe;if(e){e=e.contentWindow;try{e.eval(t),this._dispatchEvent(r.EventType.JS_EVALUATED)}catch(t){console.error(t)}}},setScalesPageToFit:function(){cc.logID(7805)},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){t=this._EventList[t];t&&t.call(this,this,this._iframe.src)},_createRenderCmd:function(){return new r.RenderCmd(this)},destroy:function(){this.removeDom()},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility())},updateMatrix:function(t){var e,i,n,r,s,h,u,o,a,c,l;this._div&&this._visible&&(t.getWorldMatrix(_),(e=cc.Camera._findRendererCamera(t))&&e.worldMatrixToScreen(_,_,cc.game.canvas.width,cc.game.canvas.height),e=_.m,!this._forceUpdate&&this._m00===e[0]&&this._m01===e[1]&&this._m04===e[4]&&this._m05===e[5]&&this._m12===e[12]&&this._m13===e[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height||(this._m00=e[0],this._m01=e[1],this._m04=e[4],this._m05=e[5],this._m12=e[12],this._m13=e[13],this._w=t._contentSize.width,this._h=t._contentSize.height,n=i=1/cc.view._devicePixelRatio,o=cc.game.container,l=e[0]*i,r=e[1],s=e[4],h=e[5]*n,u=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,o=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,this._updateSize(this._w,this._h),a=this._w*i,c=this._h*n,a=a*e[0]*t._anchorPoint.x,c=c*e[5]*t._anchorPoint.y,l="matrix("+l+","+-r+","+-s+","+h+","+(e[12]*i-a+u)+","+-(e[13]*n-c+o)+")",this._div.style.transform=l,this._div.style["-webkit-transform"]=l,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px",this._setOpacity(t.opacity),this._forceUpdate=!1))}}),s=(r.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3},r._polyfill={devicePixelRatio:!1,enableDiv:!1});t.os===t.OS_IOS&&(s.enableDiv=!0),t.isMobile?t.browserType===t.BROWSER_TYPE_FIREFOX&&(s.enableBG=!0):t.browserType===t.BROWSER_TYPE_IE&&(s.closeHistory=!0),e.exports=r},{"../core/platform/CCSys":198,"../core/platform/utils":213}],350:[function(t,e,i){"use strict";t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle"),t("./cocos2d/tilemap"),t("./cocos2d/videoplayer/CCVideoPlayer"),t("./cocos2d/webview/CCWebView"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./cocos2d/actions"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated")},{"./cocos2d/actions":8,"./cocos2d/animation":17,"./cocos2d/core":135,"./cocos2d/core/components/CCStudioComponent":95,"./cocos2d/deprecated":291,"./cocos2d/particle":297,"./cocos2d/particle/CCParticleAsset":294,"./cocos2d/tilemap":343,"./cocos2d/tilemap/CCTiledMapAsset":339,"./cocos2d/videoplayer/CCVideoPlayer":346,"./cocos2d/webview/CCWebView":348,"./extensions/ccpool/CCNodePool":351,"./extensions/dragonbones":void 0,"./extensions/spine":354}],351:[function(t,e,i){"use strict";cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){var e;t&&-1===this._pool.indexOf(t)&&(t.removeFromParent(!1),(e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null)&&e.unuse&&e.unuse(),this._pool.push(t))},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t],t=(this._pool.length=t,this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null);return t&&t.reuse&&t.reuse.apply(t,arguments),e}},e.exports=cc.NodePool},{}],352:[function(t,e,r){"use strict";var d=(n=t("../../cocos2d/core/value-types/mat4"))&&n.__esModule?n:{default:n};function i(){}function c(t){Object.defineProperty(t,"_worldMatDirty",{get:function(){return!0},set:function(t){}}),t._calculWorldMatrix=i,t._mulMat=i}var f=t("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,l="ATTACHED_NODE_TREE",h="ATTACHED_NODE:",p=new d.default,n=cc.Class({name:"sp.AttachUtil",ctor:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={}},init:function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},reset:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},_prepareAttachNode:function(){var t;if(this._skeleton)return t=this._skeletonNode.getChildByName(l),t&&t.isValid||(t=new cc.Node(l),c(t),this._skeletonNode.addChild(t)),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=t},_buildBoneAttachedNode:function(t,e){var i=h+t.data.name,i=new cc.Node(i);return this._buildBoneRelation(i,t,e),i},_buildBoneRelation:function(t,e,i){c(t),t._bone=e,t._boneIndex=i,this._attachedNodeArray.push(t),this._boneIndexToNode[i]=t},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(t){var e=this._attachedNodeArray,i=[];if(!this._inited)return i;for(var n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&s.name===h+t&&i.push(s)}return i},_rebuildNodeArray:function(){for(var t=this._boneIndexToNode={},e=this._attachedNodeArray,i=this._attachedNodeArray=[],n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&!s._toRemove&&(i.push(s),t[s._boneIndex]=s)}},_sortNodeArray:function(){this._attachedNodeArray.sort(function(t,e){return t._boneIndex<e._boneIndex?-1:1})},_getNodeByBoneIndex:function(t){t=this._boneIndexToNode[t];return t&&t.isValid?t:null},destroyAttachedNodes:function(t){if(this._inited){for(var e=this._attachedNodeArray,i=function t(e){for(var i=e.children,n=0,r=i.length;n<r;n++){var s=i[n];s&&t(s)}e._toRemove=!0},n=0,r=e.length;n<r;n++){var s=e[n];s&&s.isValid&&s.name.split(h)[1]===t&&(i(s),s.removeFromParent(!0),s.destroy(),e[n]=null)}this._rebuildNodeArray()}},generateAttachedNodes:function(t){var e=[];if(!this._inited)return e;var n=this._prepareAttachNode();if(!n)return e;for(var i=[],r=this._skeleton.bones,s=0,o=r.length;s<o;s++){var a=r[s];a.data.name==t&&i.push(a)}for(var c=function(t){if(t){var e=t.data;if(i=this._getNodeByBoneIndex(e.index))return i;var i=this._buildBoneAttachedNode(t,e.index),e=c(t.parent)||n;return i.parent=e,i}}.bind(this),l=0,h=i.length;l<h;l++){var u=c(i[l]);e.push(u)}return this._sortNodeArray(),e},destroyAllAttachedNodes:function(){var t;this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},!this._inited||(t=this._skeletonNode.getChildByName(l))&&(t.removeFromParent(!0),t.destroy())},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var t=this._prepareAttachNode();if(t){for(var e=this._skeleton.bones,i=0,n=e.length;i<n;i++){var r,s=e[i],o=s.data,a=null;(a=s.parent?(r=s.parent.data.index,this._boneIndexToNode[r]):t)&&((r=a.getChildByName(h+o.name))&&r.isValid?this._buildBoneRelation(r,s,o.index):(r=this._buildBoneAttachedNode(s,o.index),a.addChild(r)))}return t}}},_hasAttachedNode:function(){return!!this._inited&&!!this._skeletonNode.getChildByName(l)},_associateAttachedNode:function(){if(this._inited){var t=this._skeletonNode.getChildByName(l);if(t&&t.isValid){this._attachedRootNode=t,this._boneIndexToNode={},this._attachedNodeArray.length=0,c(t);this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo();for(var e=this._skeleton.bones,i=0,n=e.length;i<n;i++){var r,s=e[i],o=s.data,a=null;!(a=s.parent?(r=s.parent.data.index,this._boneIndexToNode[r]):t)||(r=a.getChildByName(h+o.name))&&r.isValid&&this._buildBoneRelation(r,s,o.index)}}}},_syncAttachedNode:function(){if(this._inited){var t=this._attachedRootNode,e=this._attachedNodeArray;if(!t||!t.isValid)return this._attachedRootNode=null,void(e.length=0);var i,h=this._skeletonNode._worldMatrix;d.default.copy(t._worldMatrix,h),t._renderFlag&=~f;if(i=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones){for(var n,r,s,u=this._skeletonNode._mulMat,o=!1,a=0,_=e.length;a<_;a++){var c,l=e[a];l&&l.isValid?(c=i[l._boneIndex])?(n=l._worldMatrix,r=t._worldMatrix,c=c,s=void 0,(s=p.m)[0]=c.a,s[1]=c.c,s[4]=c.b,s[5]=c.d,s[12]=c.worldX,s[13]=c.worldY,u(n,r,p),l._renderFlag&=~f):(l.removeFromParent(!0),l.destroy(),o=!(e[a]=null)):o=!(e[a]=null)}o&&this._rebuildNodeArray()}}}});e.exports=sp.AttachUtil=n},{"../../cocos2d/core/renderer/render-flow":221,"../../cocos2d/core/value-types/mat4":281}],353:[function(t,e,h){"use strict";var n=t("./track-entry-listeners"),i=t("../../cocos2d/core/components/CCRenderComponent"),r=t("./lib/spine"),s=t("../../cocos2d/core/graphics/graphics"),o=t("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,a=t("./skeleton-cache"),c=t("./AttachUtil"),t=cc.Enum({default:-1}),u=cc.Enum({"<None>":0}),l=cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2});sp.Skeleton=cc.Class({name:"sp.Skeleton",extends:i,editor:!1,statics:{AnimationCacheMode:l},properties:{paused:{default:!1,visible:!1},skeletonData:{default:null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData()},tooltip:!1},defaultSkin:{default:"",visible:!1},defaultAnimation:{default:"",visible:!1},animation:{get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){(this.defaultAnimation=t)?this.setAnimation(0,t,this.loop):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0}else{t=t[this.defaultSkin];if(void 0!==t)return t}}return 0},set:function(t){if(!(e=this.skeletonData?this.skeletonData.getSkinsEnum():e))return cc.errorID("",this.name);var e=e[t];void 0!==e?(this.defaultSkin=e,this.setSkin(this.defaultSkin)):cc.errorID(7501,this.name)},type:t,visible:!0,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var t=this.animation;if(this.skeletonData&&t){var e=this.skeletonData.getAnimsEnum();if(e){e=e[t];if(void 0!==e)return e}}return 0},set:function(t){if(0!==t){if(!(e=this.skeletonData?this.skeletonData.getAnimsEnum():e))return cc.errorID(7502,this.name);var e=e[t];void 0!==e?this.animation=e:cc.errorID(7503,this.name)}else this.animation=""},type:u,visible:!0,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:l.REALTIME,_defaultCacheMode:{default:0,type:l,notify:function(){this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},loop:{default:!0,tooltip:!1},premultipliedAlpha:{default:!0,tooltip:!1},timeScale:{default:1,tooltip:!1},debugSlots:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugBones:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugMesh:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},useTint:{default:!1,tooltip:!1,notify:function(){this._updateUseTint()}},enableBatch:{default:!1,notify:function(){this._updateBatch()},tooltip:!1},_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_skeletonCache:null,_animationName:"",_animationQueue:[],_headAniInfo:null,_playTimes:0,_isAniComplete:!0},ctor:function(){this._effectDelegate=null,this._skeleton=null,this._rootBone=null,this._listener=null,this._materialCache={},this._debugRenderer=null,this._startSlotIndex=-1,this._endSlotIndex=-1,this._startEntry={animation:{name:""},trackIndex:0},this._endEntry={animation:{name:""},trackIndex:0},this.attachUtil=new c},_getDefaultMaterial:function(){return cc.Material.getBuiltinMaterial("2d-spine")},_updateMaterial:function(){var t=this.useTint||this.isAnimationCached()&&!0,e=this.getMaterial(0);e&&(e.define("USE_TINT",t),e.define("CC_USE_MODEL",!this.enableBatch)),this._materialCache={}},disableRender:function(){this._super(),this.node._renderFlag&=~o},markForRender:function(t){this._super(t),t?this.node._renderFlag|=o:this.node._renderFlag&=~o},_updateUseTint:function(){var t,e=this.getMaterial(0);e&&(t=this.useTint||this.isAnimationCached()&&!0,e.define("USE_TINT",t)),this._materialCache={}},_updateBatch:function(){var t=this.getMaterial(0);t&&t.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={}},_validateRender:function(){var t=this.skeletonData;t&&t.isTexturesLoaded()?this._super():this.disableRender()},setSkeletonData:function(t){var e;null!=t.width&&null!=t.height&&this.node.setContentSize(t.width,t.height),this._cacheMode===l.SHARED_CACHE?this._skeletonCache=a.sharedCache:this._cacheMode===l.PRIVATE_CACHE&&(this._skeletonCache=new a,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()?((this.debugBones||this.debugSlots)&&cc.warn("Debug bones or slots is invalid in cached mode"),e=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t),this._skeleton=e.skeleton,this._clipper=e.clipper):(this._skeleton=new r.Skeleton(t),this._clipper=new r.SkeletonClipping),this._rootBone=this._skeleton.getRootBone(),this.markForRender(!0)},setSlotsRange:function(t,e){this.isAnimationCached()?cc.warn("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},setAnimationStateData:function(t){this.isAnimationCached()?cc.warn("'setAnimationStateData' interface can not be invoked in cached mode."):(t=new r.AnimationState(t),this._listener&&(this._state&&this._state.removeListener(this._listener),t.addListener(this._listener)),this._state=t)},__preload:function(){this._super();for(var t=this.node.children,e=0,i=t.length;e<i;e++){var n=t[e];n&&"DEBUG_DRAW_NODE"===n._name&&n.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._updateBatch()},setAnimationCacheMode:function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint())},isAnimationCached:function(){return this._cacheMode!==l.REALTIME},update:function(t){if(!this.paused)if(t*=this.timeScale*sp.timeScale,this.isAnimationCached()){var e;if(this._isAniComplete)return 0!==this._animationQueue.length||this._headAniInfo?(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,void(this._accTime>this._headAniInfo.delay&&(e=this._headAniInfo,this._headAniInfo=null,this.setAnimation(0,e.animationName,e.loop)))):void((e=this._frameCache)&&e.isInvalid()&&(e.updateToFrame(),e=e.frames,this._curFrame=e[e.length-1]));this._updateCache(t)}else this._updateRealtime(t)},_emitCacheCompleteEvent:function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},_updateCache:function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames,n=a.FrameTime,t=(0==this._accTime&&0==this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t,Math.floor(this._accTime/n));if(e.isCompleted||e.updateToFrame(t),e.isCompleted&&t>=i.length){if(this._playCount++,0<this._playTimes&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();t=this._accTime=0,this._emitCacheCompleteEvent()}this._curFrame=i[t]}},_updateRealtime:function(t){var e=this._skeleton,i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)))},setVertexEffectDelegate:function(t){this._effectDelegate=t},updateWorldTransform:function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton&&this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},updateAnimationCache:function(t){var e;this.isAnimationCached()&&(e=this.skeletonData._uuid,this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t))},invalidAnimationCache:function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this.skeletonData._uuid)},findBone:function(t){return this._skeleton?this._skeleton.findBone(t):null},findSlot:function(t){return this._skeleton?this._skeleton.findSlot(t):null},setSkin:function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},getAttachment:function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},setAttachment:function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},getTextureAtlas:function(t){return t.region},setMix:function(t,e,i){this._state&&this._state.data.setMix(t,e,i)},setAnimation:function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var n=this._skeletonCache.getAnimationCache(this.skeletonData._uuid,e);(n=n||this._skeletonCache.initAnimationCache(this.skeletonData._uuid,e))&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=n,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){n=this._skeleton.data.findAnimation(e);if(!n)return cc.logID(7509,e),null;e=this._state.setAnimationWith(t,n,i);return this._state.apply(this._skeleton),e}return null},addAnimation:function(t,e,i,n){var r;if(n=n||0,this.isAnimationCached())0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:n});else if(this._skeleton)return(r=this._skeleton.data.findAnimation(e))?this._state.addAnimationWith(t,r,i,n):(cc.logID(7510,e),null);return null},findAnimation:function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},getCurrent:function(t){if(this.isAnimationCached())cc.warn("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},clearTracks:function(){this.isAnimationCached()?cc.warn("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks()},clearTrack:function(t){this.isAnimationCached()?cc.warn("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},setStartListener:function(t){this._ensureListener(),this._listener.start=t},setInterruptListener:function(t){this._ensureListener(),this._listener.interrupt=t},setEndListener:function(t){this._ensureListener(),this._listener.end=t},setDisposeListener:function(t){this._ensureListener(),this._listener.dispose=t},setCompleteListener:function(t){this._ensureListener(),this._listener.complete=t},setEventListener:function(t){this._ensureListener(),this._listener.event=t},setTrackStartListener:function(t,e){n.getListeners(t).start=e},setTrackInterruptListener:function(t,e){n.getListeners(t).interrupt=e},setTrackEndListener:function(t,e){n.getListeners(t).end=e},setTrackDisposeListener:function(t,e){n.getListeners(t).dispose=e},setTrackCompleteListener:function(t,i){n.getListeners(t).complete=function(t){var e=Math.floor(t.trackTime/t.animationEnd);i(t,e)}},setTrackEventListener:function(t,e){n.getListeners(t).event=e},getState:function(){return this._state},_updateAnimEnum:!1,_updateSkinEnum:!1,_ensureListener:function(){this._listener||(this._listener=new n,this._state&&this._state.addListener(this._listener))},_updateSkeletonData:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new r.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){cc.warn(t)}this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},_refreshInspector:function(){this._updateAnimEnum(),this._updateSkinEnum(),Editor.Utils.refreshSelectedInspector("node",this.node.uuid)},_updateDebugDraw:function(){var t;this.debugBones||this.debugSlots?(this._debugRenderer||((t=new cc.PrivateNode).name="DEBUG_DRAW_NODE",(t=t.addComponent(s)).lineWidth=1,t.strokeColor=cc.color(255,0,0,255),this._debugRenderer=t),this._debugRenderer.node.parent=this.node,this.isAnimationCached()&&cc.warn("Debug bones or slots is invalid in cached mode")):this._debugRenderer&&(this._debugRenderer.node.parent=null)}}),e.exports=sp.Skeleton},{"../../cocos2d/core/components/CCRenderComponent":89,"../../cocos2d/core/graphics/graphics":131,"../../cocos2d/core/renderer/render-flow":221,"./AttachUtil":352,"./lib/spine":355,"./skeleton-cache":356,"./track-entry-listeners":360}],354:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;n.spine=t("./lib/spine"),n.sp={},sp._timeScale=1,Object.defineProperty(sp,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},configurable:!0}),sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5}),sp.spine=n.spine,t("./skeleton-texture"),t("./skeleton-data"),t("./vertex-effect-delegate"),t("./Skeleton"),t("./spine-assembler")},{"./Skeleton":353,"./lib/spine":355,"./skeleton-data":357,"./skeleton-texture":358,"./spine-assembler":359,"./vertex-effect-delegate":361}],355:[function(s,o,a){"use strict";c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var c,l,h,d,f,p,m,y,g,v,x,b,A,C,S,T,u,w,E,M,I,B,R,P,t,D,V=function(t,e){function i(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};function L(t){t=d.call(this,t,0,!1)||this;return t.bones=new Array,t.bendDirection=1,t.compress=!1,t.stretch=!1,t.uniform=!1,t.mix=1,t.softness=0,t}function O(t){t=f.call(this,t,0,!1)||this;return t.bones=new Array,t}!function(N){i.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},i.prototype.apply=function(t,e,i,n,r,s,o,a){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(i%=this.duration,0<e&&(e%=this.duration));for(var c=this.timelines,l=0,h=c.length;l<h;l++)c[l].apply(t,e,i,r,s,o,a)},i.binarySearch=function(t,e,i){var n=0,r=t.length/(i=void 0===i?1:i)-2;if(0==r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e?n=s+1:r=s,n==r)return(n+1)*i;s=n+r>>>1}},i.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1};var k,y,e,G=i;function i(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var n=0;n<e.length;n++)this.timelineIds[e[n].getPropertyId()]=!0;this.duration=i}N.Animation=G,(t=k=N.MixBlend||(N.MixBlend={}))[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",(t=y=N.MixDirection||(N.MixDirection={}))[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",(t=e=N.TimelineType||(N.TimelineType={}))[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor";g.prototype.getFrameCount=function(){return this.curves.length/g.BEZIER_SIZE+1},g.prototype.setLinear=function(t){this.curves[t*g.BEZIER_SIZE]=g.LINEAR},g.prototype.setStepped=function(t){this.curves[t*g.BEZIER_SIZE]=g.STEPPED},g.prototype.getCurveType=function(t){t*=g.BEZIER_SIZE;if(t==this.curves.length)return g.LINEAR;t=this.curves[t];return t==g.LINEAR?g.LINEAR:t==g.STEPPED?g.STEPPED:g.BEZIER},g.prototype.setCurve=function(h,t,e,i,n){for(var u=.03*(2*-t+i),_=.03*(2*-e+n),r=.006*(3*(t-i)+1),s=.006*(3*(e-n)+1),d=2*u+r,f=2*_+s,o=.3*t+u+.16666667*r,a=.3*e+_+.16666667*s,c=h*g.BEZIER_SIZE,l=this.curves,p=(l[c++]=g.BEZIER,o),m=a,y=c+g.BEZIER_SIZE-1;c<y;c+=2)l[c]=p,l[c+1]=m,o+=d,a+=f,d+=r,f+=s,p+=o,m+=a},g.prototype.getCurvePercent=function(t,e){e=N.MathUtils.clamp(e,0,1);var i=this.curves,n=t*g.BEZIER_SIZE,t=i[n];if(t==g.LINEAR)return e;if(t==g.STEPPED)return 0;for(var r,s,o=0,a=++n,c=n+g.BEZIER_SIZE-1;n<c;n+=2)if(e<=(o=i[n]))return s=r=void 0,(s=n==a?r=0:(r=i[n-2],i[n-1]))+(i[n+1]-s)*(e-r)/(o-r);t=i[n-1];return t+(1-t)*(e-o)/(1-o)},g.LINEAR=0,g.STEPPED=1,g.BEZIER=2,g.BEZIER_SIZE=19;var t=g;function g(t){if(t<=0)throw new Error("frameCount must be > 0: "+t);this.curves=N.Utils.newFloatArray((t-1)*g.BEZIER_SIZE)}N.CurveTimeline=t;V(v,n=t),v.prototype.getPropertyId=function(){return(e.rotate<<24)+this.boneIndex},v.prototype.setFrame=function(t,e,i){this.frames[t<<=1]=e,this.frames[t+v.ROTATION]=i},v.prototype.apply=function(t,h,e,u,i,n,_){var r=this.frames,s=t.bones[this.boneIndex];if(s.active)if(e<r[0])switch(n){case k.setup:return void(s.rotation=s.data.rotation);case k.first:var o=s.data.rotation-s.rotation;s.rotation+=(o-360*(16384-(16384.499999999996-o/360|0)))*i}else if(e>=r[r.length-v.ENTRIES]){var a=r[r.length+v.PREV_ROTATION];switch(n){case k.setup:s.rotation=s.data.rotation+a*i;break;case k.first:case k.replace:a=(a+=s.data.rotation-s.rotation)-360*(16384-(16384.499999999996-a/360|0));case k.add:s.rotation+=a*i}}else{var t=G.binarySearch(r,e,v.ENTRIES),c=r[t+v.PREV_ROTATION],d=r[t],e=this.getCurvePercent((t>>1)-1,1-(e-d)/(r[t+v.PREV_TIME]-d)),l=c+((l=r[t+v.ROTATION]-c)-360*(16384-(16384.499999999996-l/360|0)))*e;switch(n){case k.setup:s.rotation=s.data.rotation+(l-360*(16384-(16384.499999999996-l/360|0)))*i;break;case k.first:case k.replace:l+=s.data.rotation-s.rotation;case k.add:s.rotation+=(l-360*(16384-(16384.499999999996-l/360|0)))*i}}},v.ENTRIES=2,v.PREV_TIME=-2,v.PREV_ROTATION=-1,v.ROTATION=1;var n,r=v;function v(t){var e=n.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t<<1),e}N.RotateTimeline=r;V(_,s=t),_.prototype.getPropertyId=function(){return(e.translate<<24)+this.boneIndex},_.prototype.setFrame=function(t,e,i,n){this.frames[t*=_.ENTRIES]=e,this.frames[t+_.X]=i,this.frames[t+_.Y]=n},_.prototype.apply=function(t,l,e,h,i,n,u){var r=this.frames,s=t.bones[this.boneIndex];if(s.active)if(e<r[0])switch(n){case k.setup:return s.x=s.data.x,void(s.y=s.data.y);case k.first:s.x+=(s.data.x-s.x)*i,s.y+=(s.data.y-s.y)*i}else{var o,a=0,c=0;switch(e>=r[r.length-_.ENTRIES]?(a=r[r.length+_.PREV_X],c=r[r.length+_.PREV_Y]):(a=r[(t=G.binarySearch(r,e,_.ENTRIES))+_.PREV_X],c=r[t+_.PREV_Y],o=r[t],e=this.getCurvePercent(t/_.ENTRIES-1,1-(e-o)/(r[t+_.PREV_TIME]-o)),a+=(r[t+_.X]-a)*e,c+=(r[t+_.Y]-c)*e),n){case k.setup:s.x=s.data.x+a*i,s.y=s.data.y+c*i;break;case k.first:case k.replace:s.x+=(s.data.x+a-s.x)*i,s.y+=(s.data.y+c-s.y)*i;break;case k.add:s.x+=a*i,s.y+=c*i}}},_.ENTRIES=3,_.PREV_TIME=-3,_.PREV_X=-2,_.PREV_Y=-1,_.X=1,_.Y=2;var s,r=_;function _(t){var e=s.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*_.ENTRIES),e}N.TranslateTimeline=r;V(x,o=r),x.prototype.getPropertyId=function(){return(e.scale<<24)+this.boneIndex},x.prototype.apply=function(t,h,e,u,i,n,_){var r=this.frames,s=t.bones[this.boneIndex];if(s.active)if(e<r[0])switch(n){case k.setup:return s.scaleX=s.data.scaleX,void(s.scaleY=s.data.scaleY);case k.first:s.scaleX+=(s.data.scaleX-s.scaleX)*i,s.scaleY+=(s.data.scaleY-s.scaleY)*i}else{var d,o=0,a=0;if(a=e>=r[r.length-x.ENTRIES]?(o=r[r.length+x.PREV_X]*s.data.scaleX,r[r.length+x.PREV_Y]*s.data.scaleY):(o=r[(t=G.binarySearch(r,e,x.ENTRIES))+x.PREV_X],a=r[t+x.PREV_Y],d=r[t],e=this.getCurvePercent(t/x.ENTRIES-1,1-(e-d)/(r[t+x.PREV_TIME]-d)),o=(o+(r[t+x.X]-o)*e)*s.data.scaleX,(a+(r[t+x.Y]-a)*e)*s.data.scaleY),1==i)n==k.add?(s.scaleX+=o-s.data.scaleX,s.scaleY+=a-s.data.scaleY):(s.scaleX=o,s.scaleY=a);else{var c=0,l=0;if(_==y.mixOut)switch(n){case k.setup:c=s.data.scaleX,l=s.data.scaleY,s.scaleX=c+(Math.abs(o)*N.MathUtils.signum(c)-c)*i,s.scaleY=l+(Math.abs(a)*N.MathUtils.signum(l)-l)*i;break;case k.first:case k.replace:c=s.scaleX,l=s.scaleY,s.scaleX=c+(Math.abs(o)*N.MathUtils.signum(c)-c)*i,s.scaleY=l+(Math.abs(a)*N.MathUtils.signum(l)-l)*i;break;case k.add:c=s.scaleX,l=s.scaleY,s.scaleX=c+(Math.abs(o)*N.MathUtils.signum(c)-s.data.scaleX)*i,s.scaleY=l+(Math.abs(a)*N.MathUtils.signum(l)-s.data.scaleY)*i}else switch(n){case k.setup:c=Math.abs(s.data.scaleX)*N.MathUtils.signum(o),l=Math.abs(s.data.scaleY)*N.MathUtils.signum(a),s.scaleX=c+(o-c)*i,s.scaleY=l+(a-l)*i;break;case k.first:case k.replace:c=Math.abs(s.scaleX)*N.MathUtils.signum(o),l=Math.abs(s.scaleY)*N.MathUtils.signum(a),s.scaleX=c+(o-c)*i,s.scaleY=l+(a-l)*i;break;case k.add:c=N.MathUtils.signum(o),l=N.MathUtils.signum(a),s.scaleX=Math.abs(s.scaleX)*c+(o-Math.abs(s.data.scaleX)*c)*i,s.scaleY=Math.abs(s.scaleY)*l+(a-Math.abs(s.data.scaleY)*l)*i}}}};var o,a=x;function x(t){return o.call(this,t)||this}N.ScaleTimeline=a;V(A,c=r),A.prototype.getPropertyId=function(){return(e.shear<<24)+this.boneIndex},A.prototype.apply=function(t,l,e,h,i,n,u){var r=this.frames,s=t.bones[this.boneIndex];if(s.active)if(e<r[0])switch(n){case k.setup:return s.shearX=s.data.shearX,void(s.shearY=s.data.shearY);case k.first:s.shearX+=(s.data.shearX-s.shearX)*i,s.shearY+=(s.data.shearY-s.shearY)*i}else{var o,a=0,c=0;switch(e>=r[r.length-A.ENTRIES]?(a=r[r.length+A.PREV_X],c=r[r.length+A.PREV_Y]):(a=r[(t=G.binarySearch(r,e,A.ENTRIES))+A.PREV_X],c=r[t+A.PREV_Y],o=r[t],e=this.getCurvePercent(t/A.ENTRIES-1,1-(e-o)/(r[t+A.PREV_TIME]-o)),a+=(r[t+A.X]-a)*e,c+=(r[t+A.Y]-c)*e),n){case k.setup:s.shearX=s.data.shearX+a*i,s.shearY=s.data.shearY+c*i;break;case k.first:case k.replace:s.shearX+=(s.data.shearX+a-s.shearX)*i,s.shearY+=(s.data.shearY+c-s.shearY)*i;break;case k.add:s.shearX+=a*i,s.shearY+=c*i}}};var c,a=A;function A(t){return c.call(this,t)||this}N.ShearTimeline=a;V(m,l=t),m.prototype.getPropertyId=function(){return(e.color<<24)+this.slotIndex},m.prototype.setFrame=function(t,e,i,n,r,s){this.frames[t*=m.ENTRIES]=e,this.frames[t+m.R]=i,this.frames[t+m.G]=n,this.frames[t+m.B]=r,this.frames[t+m.A]=s},m.prototype.apply=function(t,h,e,u,i,_,d){var n=t.slots[this.slotIndex];if(n.bone.active){t=this.frames;if(e<t[0])switch(_){case k.setup:return void n.color.setFromColor(n.data.color);case k.first:var r=n.color,f=n.data.color;r.add((f.r-r.r)*i,(f.g-r.g)*i,(f.b-r.b)*i,(f.a-r.a)*i)}else{var s,p,o=0,a=0,c=0,l=0;e>=t[t.length-m.ENTRIES]?(o=t[(s=t.length)+m.PREV_R],a=t[s+m.PREV_G],c=t[s+m.PREV_B],l=t[s+m.PREV_A]):(o=t[(s=G.binarySearch(t,e,m.ENTRIES))+m.PREV_R],a=t[s+m.PREV_G],c=t[s+m.PREV_B],l=t[s+m.PREV_A],p=t[s],e=this.getCurvePercent(s/m.ENTRIES-1,1-(e-p)/(t[s+m.PREV_TIME]-p)),o+=(t[s+m.R]-o)*e,a+=(t[s+m.G]-a)*e,c+=(t[s+m.B]-c)*e,l+=(t[s+m.A]-l)*e),1==i?n.color.set(o,a,c,l):(r=n.color,_==k.setup&&r.setFromColor(n.data.color),r.add((o-r.r)*i,(a-r.g)*i,(c-r.b)*i,(l-r.a)*i))}}},m.ENTRIES=5,m.PREV_TIME=-5,m.PREV_R=-4,m.PREV_G=-3,m.PREV_B=-2,m.PREV_A=-1,m.R=1,m.G=2,m.B=3,m.A=4;var l,r=m;function m(t){var e=l.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*m.ENTRIES),e}N.ColorTimeline=r;V(b,h=t),b.prototype.getPropertyId=function(){return(e.twoColor<<24)+this.slotIndex},b.prototype.setFrame=function(t,e,i,n,r,s,o,a,c){this.frames[t*=b.ENTRIES]=e,this.frames[t+b.R]=i,this.frames[t+b.G]=n,this.frames[t+b.B]=r,this.frames[t+b.A]=s,this.frames[t+b.R2]=o,this.frames[t+b.G2]=a,this.frames[t+b.B2]=c},b.prototype.apply=function(t,h,e,u,i,_,d){var n=t.slots[this.slotIndex];if(n.bone.active){t=this.frames;if(e<t[0])switch(_){case k.setup:return n.color.setFromColor(n.data.color),void n.darkColor.setFromColor(n.data.darkColor);case k.first:var r=n.color,s=n.darkColor,f=n.data.color,p=n.data.darkColor;r.add((f.r-r.r)*i,(f.g-r.g)*i,(f.b-r.b)*i,(f.a-r.a)*i),s.add((p.r-s.r)*i,(p.g-s.g)*i,(p.b-s.b)*i,0)}else{var o,m,a=0,c=0,l=0,y=0,g=0,v=0,x=0;e>=t[t.length-b.ENTRIES]?(a=t[(o=t.length)+b.PREV_R],c=t[o+b.PREV_G],l=t[o+b.PREV_B],y=t[o+b.PREV_A],g=t[o+b.PREV_R2],v=t[o+b.PREV_G2],x=t[o+b.PREV_B2]):(a=t[(o=G.binarySearch(t,e,b.ENTRIES))+b.PREV_R],c=t[o+b.PREV_G],l=t[o+b.PREV_B],y=t[o+b.PREV_A],g=t[o+b.PREV_R2],v=t[o+b.PREV_G2],x=t[o+b.PREV_B2],m=t[o],e=this.getCurvePercent(o/b.ENTRIES-1,1-(e-m)/(t[o+b.PREV_TIME]-m)),a+=(t[o+b.R]-a)*e,c+=(t[o+b.G]-c)*e,l+=(t[o+b.B]-l)*e,y+=(t[o+b.A]-y)*e,g+=(t[o+b.R2]-g)*e,v+=(t[o+b.G2]-v)*e,x+=(t[o+b.B2]-x)*e),1==i?(n.color.set(a,c,l,y),n.darkColor.set(g,v,x,1)):(r=n.color,s=n.darkColor,_==k.setup&&(r.setFromColor(n.data.color),s.setFromColor(n.data.darkColor)),r.add((a-r.r)*i,(c-r.g)*i,(l-r.b)*i,(y-r.a)*i),s.add((g-s.r)*i,(v-s.g)*i,(x-s.b)*i,0))}}},b.ENTRIES=8,b.PREV_TIME=-8,b.PREV_R=-7,b.PREV_G=-6,b.PREV_B=-5,b.PREV_A=-4,b.PREV_R2=-3,b.PREV_G2=-2,b.PREV_B2=-1,b.R=1,b.G=2,b.B=3,b.A=4,b.R2=5,b.G2=6,b.B2=7;var h,a=b;function b(t){var e=h.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*b.ENTRIES),e}function u(t){this.frames=N.Utils.newFloatArray(t),this.attachmentNames=new Array(t)}N.TwoColorTimeline=a,u.prototype.getPropertyId=function(){return(e.attachment<<24)+this.slotIndex},u.prototype.getFrameCount=function(){return this.frames.length},u.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},u.prototype.apply=function(t,e,i,n,r,s,o){var a=t.slots[this.slotIndex];if(a.bone.active){if(o==y.mixOut&&s==k.setup)return o=a.data.attachmentName,void a.setAttachment(null==o?null:t.getAttachment(this.slotIndex,o));o=this.frames;i<o[0]?s!=k.setup&&s!=k.first||(s=a.data.attachmentName,a.setAttachment(null==s?null:t.getAttachment(this.slotIndex,s))):(a=0,a=i>=o[o.length-1]?o.length-1:G.binarySearch(o,i,1)-1,s=this.attachmentNames[a],t.slots[this.slotIndex].setAttachment(null==s?null:t.getAttachment(this.slotIndex,s)))}},N.AttachmentTimeline=u;var C,S=null,r=(V(T,C=t),T.prototype.getPropertyId=function(){return(e.deform<<27)+ +this.attachment.id+this.slotIndex},T.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},T.prototype.apply=function(t,h,u,_,e,d,f){t=t.slots[this.slotIndex];if(t.bone.active){var i=t.getAttachment();if(i instanceof N.VertexAttachment&&i.deformAttachment==this.attachment){var p=t.deform,t=(0==p.length&&(d=k.setup),this.frameVertices),n=t[0].length,m=this.frames;if(u<m[0]){var r=i;switch(d){case k.setup:return void(p.length=0);case k.first:if(1==e){p.length=0;break}var y=N.Utils.setArraySize(p,n);if(null==r.bones)for(var g=r.vertices,s=0;s<n;s++)y[s]+=(g[s]-y[s])*e;else{e=1-e;for(s=0;s<n;s++)y[s]*=e}}}else{var o=N.Utils.setArraySize(p,n);if(u>=m[m.length-1]){var a=t[m.length-1];if(1==e)if(d==k.add)if(null==(r=i).bones)for(var g=r.vertices,v=0;v<n;v++)o[v]+=a[v]-g[v];else for(var x=0;x<n;x++)o[x]+=a[x];else N.Utils.arrayCopy(a,0,o,0,n);else switch(d){case k.setup:if(null==i.bones)for(var g=i.vertices,b=0;b<n;b++){var A=g[b];o[b]=A+(a[b]-A)*e}else for(var C=0;C<n;C++)o[C]=a[C]*e;break;case k.first:case k.replace:for(var S=0;S<n;S++)o[S]+=(a[S]-o[S])*e;case k.add:if(null==(r=i).bones)for(var g=r.vertices,T=0;T<n;T++)o[T]+=(a[T]-g[T])*e;else for(var w=0;w<n;w++)o[w]+=a[w]*e}}else{var E=G.binarySearch(m,u),c=t[E-1],M=t[E],t=m[E],I=this.getCurvePercent(E-1,1-(u-t)/(m[E-1]-t));if(1==e)if(d==k.add)if(null==(r=i).bones)for(var g=r.vertices,B=0;B<n;B++){var l=c[B];o[B]+=l+(M[B]-l)*I-g[B]}else for(var R=0;R<n;R++){l=c[R];o[R]+=l+(M[R]-l)*I}else for(var P=0;P<n;P++){l=c[P];o[P]=l+(M[P]-l)*I}else switch(d){case k.setup:if(null==i.bones)for(var g=i.vertices,D=0;D<n;D++){l=c[D],A=g[D];o[D]=A+(l+(M[D]-l)*I-A)*e}else for(var L=0;L<n;L++){l=c[L];o[L]=(l+(M[L]-l)*I)*e}break;case k.first:case k.replace:for(var V=0;V<n;V++){l=c[V];o[V]+=(l+(M[V]-l)*I-o[V])*e}break;case k.add:if(null==(r=i).bones)for(var g=r.vertices,O=0;O<n;O++){l=c[O];o[O]+=(l+(M[O]-l)*I-g[O])*e}else for(var F=0;F<n;F++){l=c[F];o[F]+=(l+(M[F]-l)*I)*e}}}}}}},T);function T(t){var e=C.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t),e.frameVertices=new Array(t),null==S&&(S=N.Utils.newFloatArray(64)),e}function w(t){this.frames=N.Utils.newFloatArray(t),this.events=new Array(t)}function E(t){this.frames=N.Utils.newFloatArray(t),this.drawOrders=new Array(t)}N.DeformTimeline=r,w.prototype.getPropertyId=function(){return e.event<<24},w.prototype.getFrameCount=function(){return this.frames.length},w.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},w.prototype.apply=function(t,e,i,n,r,s,o){if(null!=n){var a=this.frames,c=this.frames.length;if(i<e)this.apply(t,e,Number.MAX_VALUE,n,r,s,o),e=-1;else if(e>=a[c-1])return;if(!(i<a[0])){var l=0;if(e<a[0])l=0;else for(var h=a[l=G.binarySearch(a,e)];0<l&&a[l-1]==h;)l--;for(;l<c&&i>=a[l];l++)n.push(this.events[l])}}},N.EventTimeline=w,E.prototype.getPropertyId=function(){return e.drawOrder<<24},E.prototype.getFrameCount=function(){return this.frames.length},E.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},E.prototype.apply=function(t,l,e,h,u,i,n){var r=t.drawOrder,s=t.slots;if(n!=y.mixOut||i!=k.setup){n=this.frames;if(e<n[0])i!=k.setup&&i!=k.first||N.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var i=e>=n[n.length-1]?n.length-1:G.binarySearch(n,e)-1,o=this.drawOrders[i];if(null==o)N.Utils.arrayCopy(s,0,r,0,s.length);else for(var a=0,c=o.length;a<c;a++)r[a]=s[o[a]]}}else N.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)},N.DrawOrderTimeline=E;V(d,M=t),d.prototype.getPropertyId=function(){return(e.ikConstraint<<24)+this.ikConstraintIndex},d.prototype.setFrame=function(t,e,i,n,r,s,o){this.frames[t*=d.ENTRIES]=e,this.frames[t+d.MIX]=i,this.frames[t+d.SOFTNESS]=n,this.frames[t+d.BEND_DIRECTION]=r,this.frames[t+d.COMPRESS]=s?1:0,this.frames[t+d.STRETCH]=o?1:0},d.prototype.apply=function(t,h,e,u,i,n,r){var s,o,a,c=this.frames,l=t.ikConstraints[this.ikConstraintIndex];if(l.active)if(e<c[0])switch(n){case k.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case k.first:l.mix+=(l.data.mix-l.mix)*i,l.softness+=(l.data.softness-l.softness)*i,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}else e>=c[c.length-d.ENTRIES]?n==k.setup?(l.mix=l.data.mix+(c[c.length+d.PREV_MIX]-l.data.mix)*i,l.softness=l.data.softness+(c[c.length+d.PREV_SOFTNESS]-l.data.softness)*i,r==y.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=c[c.length+d.PREV_BEND_DIRECTION],l.compress=0!=c[c.length+d.PREV_COMPRESS],l.stretch=0!=c[c.length+d.PREV_STRETCH])):(l.mix+=(c[c.length+d.PREV_MIX]-l.mix)*i,l.softness+=(c[c.length+d.PREV_SOFTNESS]-l.softness)*i,r==y.mixIn&&(l.bendDirection=c[c.length+d.PREV_BEND_DIRECTION],l.compress=0!=c[c.length+d.PREV_COMPRESS],l.stretch=0!=c[c.length+d.PREV_STRETCH])):(s=c[(t=G.binarySearch(c,e,d.ENTRIES))+d.PREV_MIX],o=c[t+d.PREV_SOFTNESS],a=c[t],e=this.getCurvePercent(t/d.ENTRIES-1,1-(e-a)/(c[t+d.PREV_TIME]-a)),n==k.setup?(l.mix=l.data.mix+(s+(c[t+d.MIX]-s)*e-l.data.mix)*i,l.softness=l.data.softness+(o+(c[t+d.SOFTNESS]-o)*e-l.data.softness)*i,r==y.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=c[t+d.PREV_BEND_DIRECTION],l.compress=0!=c[t+d.PREV_COMPRESS],l.stretch=0!=c[t+d.PREV_STRETCH])):(l.mix+=(s+(c[t+d.MIX]-s)*e-l.mix)*i,l.softness+=(o+(c[t+d.SOFTNESS]-o)*e-l.softness)*i,r==y.mixIn&&(l.bendDirection=c[t+d.PREV_BEND_DIRECTION],l.compress=0!=c[t+d.PREV_COMPRESS],l.stretch=0!=c[t+d.PREV_STRETCH])))},d.ENTRIES=6,d.PREV_TIME=-6,d.PREV_MIX=-5,d.PREV_SOFTNESS=-4,d.PREV_BEND_DIRECTION=-3,d.PREV_COMPRESS=-2,d.PREV_STRETCH=-1,d.MIX=1,d.SOFTNESS=2,d.BEND_DIRECTION=3,d.COMPRESS=4,d.STRETCH=5;var M,a=d;function d(t){var e=M.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*d.ENTRIES),e}N.IkConstraintTimeline=a;V(p,I=t),p.prototype.getPropertyId=function(){return(e.transformConstraint<<24)+this.transformConstraintIndex},p.prototype.setFrame=function(t,e,i,n,r,s){this.frames[t*=p.ENTRIES]=e,this.frames[t+p.ROTATE]=i,this.frames[t+p.TRANSLATE]=n,this.frames[t+p.SCALE]=r,this.frames[t+p.SHEAR]=s},p.prototype.apply=function(t,h,e,u,i,_,d){var n=this.frames,r=t.transformConstraints[this.transformConstraintIndex];if(r.active)if(e<n[0]){var s=r.data;switch(_){case k.setup:return r.rotateMix=s.rotateMix,r.translateMix=s.translateMix,r.scaleMix=s.scaleMix,void(r.shearMix=s.shearMix);case k.first:r.rotateMix+=(s.rotateMix-r.rotateMix)*i,r.translateMix+=(s.translateMix-r.translateMix)*i,r.scaleMix+=(s.scaleMix-r.scaleMix)*i,r.shearMix+=(s.shearMix-r.shearMix)*i}}else{var o,f,t=0,a=0,c=0,l=0;e>=n[n.length-p.ENTRIES]?(t=n[(o=n.length)+p.PREV_ROTATE],a=n[o+p.PREV_TRANSLATE],c=n[o+p.PREV_SCALE],l=n[o+p.PREV_SHEAR]):(t=n[(o=G.binarySearch(n,e,p.ENTRIES))+p.PREV_ROTATE],a=n[o+p.PREV_TRANSLATE],c=n[o+p.PREV_SCALE],l=n[o+p.PREV_SHEAR],f=n[o],e=this.getCurvePercent(o/p.ENTRIES-1,1-(e-f)/(n[o+p.PREV_TIME]-f)),t+=(n[o+p.ROTATE]-t)*e,a+=(n[o+p.TRANSLATE]-a)*e,c+=(n[o+p.SCALE]-c)*e,l+=(n[o+p.SHEAR]-l)*e),_==k.setup?(s=r.data,r.rotateMix=s.rotateMix+(t-s.rotateMix)*i,r.translateMix=s.translateMix+(a-s.translateMix)*i,r.scaleMix=s.scaleMix+(c-s.scaleMix)*i,r.shearMix=s.shearMix+(l-s.shearMix)*i):(r.rotateMix+=(t-r.rotateMix)*i,r.translateMix+=(a-r.translateMix)*i,r.scaleMix+=(c-r.scaleMix)*i,r.shearMix+=(l-r.shearMix)*i)}},p.ENTRIES=5,p.PREV_TIME=-5,p.PREV_ROTATE=-4,p.PREV_TRANSLATE=-3,p.PREV_SCALE=-2,p.PREV_SHEAR=-1,p.ROTATE=1,p.TRANSLATE=2,p.SCALE=3,p.SHEAR=4;var I,r=p;function p(t){var e=I.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*p.ENTRIES),e}N.TransformConstraintTimeline=r;V(R,B=t),R.prototype.getPropertyId=function(){return(e.pathConstraintPosition<<24)+this.pathConstraintIndex},R.prototype.setFrame=function(t,e,i){this.frames[t*=R.ENTRIES]=e,this.frames[t+R.VALUE]=i},R.prototype.apply=function(t,e,i,l,n,r,h){var s=this.frames,o=t.pathConstraints[this.pathConstraintIndex];if(o.active)if(i<s[0])switch(r){case k.setup:return void(o.position=o.data.position);case k.first:o.position+=(o.data.position-o.position)*n}else{var a,c,t=0;i>=s[s.length-R.ENTRIES]?t=s[s.length+R.PREV_VALUE]:(t=s[(a=G.binarySearch(s,i,R.ENTRIES))+R.PREV_VALUE],c=s[a],i=this.getCurvePercent(a/R.ENTRIES-1,1-(i-c)/(s[a+R.PREV_TIME]-c)),t+=(s[a+R.VALUE]-t)*i),r==k.setup?o.position=o.data.position+(t-o.data.position)*n:o.position+=(t-o.position)*n}},R.ENTRIES=2,R.PREV_TIME=-2,R.PREV_VALUE=-1,R.VALUE=1;var B,a=R;function R(t){var e=B.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*R.ENTRIES),e}N.PathConstraintPositionTimeline=a;V(D,P=a),D.prototype.getPropertyId=function(){return(e.pathConstraintSpacing<<24)+this.pathConstraintIndex},D.prototype.apply=function(t,e,i,l,n,r,h){var s=this.frames,o=t.pathConstraints[this.pathConstraintIndex];if(o.active)if(i<s[0])switch(r){case k.setup:return void(o.spacing=o.data.spacing);case k.first:o.spacing+=(o.data.spacing-o.spacing)*n}else{var a,c,t=0;i>=s[s.length-D.ENTRIES]?t=s[s.length+D.PREV_VALUE]:(t=s[(a=G.binarySearch(s,i,D.ENTRIES))+D.PREV_VALUE],c=s[a],i=this.getCurvePercent(a/D.ENTRIES-1,1-(i-c)/(s[a+D.PREV_TIME]-c)),t+=(s[a+D.VALUE]-t)*i),r==k.setup?o.spacing=o.data.spacing+(t-o.data.spacing)*n:o.spacing+=(t-o.spacing)*n}};var P,r=D;function D(t){return P.call(this,t)||this}N.PathConstraintSpacingTimeline=r;V(f,L=t),f.prototype.getPropertyId=function(){return(e.pathConstraintMix<<24)+this.pathConstraintIndex},f.prototype.setFrame=function(t,e,i,n){this.frames[t*=f.ENTRIES]=e,this.frames[t+f.ROTATE]=i,this.frames[t+f.TRANSLATE]=n},f.prototype.apply=function(t,l,e,h,i,n,u){var r=this.frames,s=t.pathConstraints[this.pathConstraintIndex];if(s.active)if(e<r[0])switch(n){case k.setup:return s.rotateMix=s.data.rotateMix,void(s.translateMix=s.data.translateMix);case k.first:s.rotateMix+=(s.data.rotateMix-s.rotateMix)*i,s.translateMix+=(s.data.translateMix-s.translateMix)*i}else{var o,a,t=0,c=0;e>=r[r.length-f.ENTRIES]?(t=r[r.length+f.PREV_ROTATE],c=r[r.length+f.PREV_TRANSLATE]):(t=r[(o=G.binarySearch(r,e,f.ENTRIES))+f.PREV_ROTATE],c=r[o+f.PREV_TRANSLATE],a=r[o],e=this.getCurvePercent(o/f.ENTRIES-1,1-(e-a)/(r[o+f.PREV_TIME]-a)),t+=(r[o+f.ROTATE]-t)*e,c+=(r[o+f.TRANSLATE]-c)*e),n==k.setup?(s.rotateMix=s.data.rotateMix+(t-s.data.rotateMix)*i,s.translateMix=s.data.translateMix+(c-s.data.translateMix)*i):(s.rotateMix+=(t-s.rotateMix)*i,s.translateMix+=(c-s.translateMix)*i)}},f.ENTRIES=3,f.PREV_TIME=-3,f.PREV_ROTATE=-2,f.PREV_TRANSLATE=-1,f.ROTATE=1,f.TRANSLATE=2;var L,a=f;function f(t){var e=L.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*f.ENTRIES),e}N.PathConstraintMixTimeline=a}(t=t||{}),function(S){T.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,n=e.length;i<n;i++){var r=e[i];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var s=t*r.timeScale;if(0<r.delay){if(r.delay-=s,0<r.delay)continue;s=-r.delay,r.delay=0}var o=r.next;if(null!=o){var a=r.trackLast-o.delay;if(0<=a){for(o.delay=0,o.trackTime+=0==r.timeScale?0:(a/r.timeScale+t)*o.timeScale,r.trackTime+=s,this.setCurrent(i,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[i]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var c=r.mixingFrom;for((r.mixingFrom=null)!=c&&(c.mixingTo=null);null!=c;)this.queue.end(c),c=c.mixingFrom}r.trackTime+=s}}this.queue.drain()},T.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var n=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,0<t.mixTime&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),n):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)},T.prototype.apply=function(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var e=this.events,h=this.tracks,u=!1,i=0,_=h.length;i<_;i++){var n=h[i];if(!(null==n||0<n.delay)){var u=!0,r=0==i?S.MixBlend.first:n.mixBlend,s=n.alpha,d=(null!=n.mixingFrom?s*=this.applyMixingFrom(n,t,r):n.trackTime>=n.trackEnd&&null==n.next&&(s=0),n.animationLast),o=n.getAnimationTime(),a=n.animation.timelines.length,f=n.animation.timelines;if(0==i&&1==s||r==S.MixBlend.add)for(var c=0;c<a;c++)S.Utils.webkit602BugfixHelper(s,r),f[c].apply(t,d,o,e,s,r,S.MixDirection.mixIn);else for(var p=n.timelineMode,m=0==n.timelinesRotation.length,y=(m&&S.Utils.setArraySize(n.timelinesRotation,a<<1,null),n.timelinesRotation),c=0;c<a;c++){var l=f[c],g=(p[c]&T.NOT_LAST-1)==T.SUBSEQUENT?r:S.MixBlend.setup;l instanceof S.RotateTimeline?this.applyRotateTimeline(l,t,o,s,g,y,c<<1,m):(S.Utils.webkit602BugfixHelper(s,r),l.apply(t,d,o,e,s,g,S.MixDirection.mixIn))}this.queueEvents(n,o),e.length=0,n.nextAnimationLast=o,n.nextTrackLast=n.trackTime}}return this.queue.drain(),u},T.prototype.applyMixingFrom=function(t,e,i){var n=t.mixingFrom,r=(null!=n.mixingFrom&&this.applyMixingFrom(n,e,i),0),h=(0==t.mixDuration?(r=1,i==S.MixBlend.first&&(i=S.MixBlend.setup)):(1<(r=t.mixTime/t.mixDuration)&&(r=1),i!=S.MixBlend.first&&(i=n.mixBlend)),r<n.eventThreshold?this.events:null),u=r<n.attachmentThreshold,_=r<n.drawOrderThreshold,d=n.animationLast,s=n.getAnimationTime(),f=n.animation.timelines.length,p=n.animation.timelines,m=n.alpha*t.interruptAlpha,y=m*(1-r);if(i==S.MixBlend.add)for(var o=0;o<f;o++)p[o].apply(e,d,s,h,y,i,S.MixDirection.mixOut);else for(var g=n.timelineMode,v=n.timelineHoldMix,x=0==n.timelinesRotation.length,b=(x&&S.Utils.setArraySize(n.timelinesRotation,f<<1,null),n.timelinesRotation),o=n.totalAlpha=0;o<f;o++){var a=p[o],A=S.MixDirection.mixOut,c=void 0,l=0;switch(g[o]&T.NOT_LAST-1){case T.SUBSEQUENT:if(c=i,!u&&a instanceof S.AttachmentTimeline){if((g[o]&T.NOT_LAST)==T.NOT_LAST)continue;c=S.MixBlend.setup}if(!_&&a instanceof S.DrawOrderTimeline)continue;l=y;break;case T.FIRST:c=S.MixBlend.setup,l=y;break;case T.HOLD:c=S.MixBlend.setup,l=m;break;default:var c=S.MixBlend.setup,C=v[o],l=m*Math.max(0,1-C.mixTime/C.mixDuration)}n.totalAlpha+=l,a instanceof S.RotateTimeline?this.applyRotateTimeline(a,e,s,l,c,b,o<<1,x):(S.Utils.webkit602BugfixHelper(l,i),c==S.MixBlend.setup&&(a instanceof S.AttachmentTimeline?!u&&(g[o]&T.NOT_LAST)!=T.NOT_LAST||(A=S.MixDirection.mixIn):a instanceof S.DrawOrderTimeline&&_&&(A=S.MixDirection.mixIn)),a.apply(e,d,s,h,l,c,A))}return 0<t.mixDuration&&this.queueEvents(n,s),this.events.length=0,n.nextAnimationLast=s,n.nextTrackLast=n.trackTime,r},T.prototype.applyRotateTimeline=function(h,u,t,_,d,e,i,f){if(f&&(e[i]=0),1!=_){var n=h,r=n.frames,s=u.bones[n.boneIndex];if(s.active){var p=0,o=0;if(t<r[0])switch(d){case S.MixBlend.setup:s.rotation=s.data.rotation;default:return;case S.MixBlend.first:p=s.rotation,o=s.data.rotation}else{p=(d==S.MixBlend.setup?s.data:s).rotation;t>=r[r.length-S.RotateTimeline.ENTRIES]?o=s.data.rotation+r[r.length+S.RotateTimeline.PREV_ROTATION]:(c=r[(a=S.Animation.binarySearch(r,t,S.RotateTimeline.ENTRIES))+S.RotateTimeline.PREV_ROTATION],l=r[a],n=n.getCurvePercent((a>>1)-1,1-(t-l)/(r[a+S.RotateTimeline.PREV_TIME]-l)),o=r[a+S.RotateTimeline.ROTATION]-c,o=c+(o-=360*(16384-(16384.499999999996-o/360|0)))*n+s.data.rotation,o-=360*(16384-(16384.499999999996-o/360|0)))}var a,c,l=0,r=o-p;0==(r-=360*(16384-(16384.499999999996-r/360|0)))?l=e[i]:(c=a=0,c=f?(a=0,r):(a=e[i],e[i+1]),n=0<r,f=0<=a,S.MathUtils.signum(c)!=S.MathUtils.signum(r)&&Math.abs(c)<=90&&(180<Math.abs(a)&&(a+=360*S.MathUtils.signum(a)),f=n),l=r+a-a%360,f!=n&&(l+=360*S.MathUtils.signum(a)),e[i]=l),e[i+1]=r,s.rotation=(p+=l*_)-360*(16384-(16384.499999999996-p/360|0))}}else h.apply(u,0,t,null,1,d,S.MixDirection.mixIn)},T.prototype.queueEvents=function(t,e){for(var i=t.animationStart,n=t.animationEnd,r=n-i,s=t.trackLast%r,o=this.events,a=0,c=o.length;a<c;a++){var l=o[a];if(l.time<s)break;l.time>n||this.queue.event(t,l)}for((t.loop?0==r||s>t.trackTime%r:n<=e&&t.animationLast<n)&&this.queue.complete(t);a<c;a++)o[a].time<i||this.queue.event(t,o[a])},T.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},T.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){t=this.tracks[t];if(null!=t){this.queue.end(t),this.disposeNext(t);for(var e=t;;){var i=e.mixingFrom;if(null==i)break;this.queue.end(i),e.mixingFrom=null,e.mixingTo=null,e=i}this.tracks[t.trackIndex]=null,this.queue.drain()}}},T.prototype.setCurrent=function(t,e,i){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(i&&this.queue.interrupt(n),((e.mixingFrom=n).mixingTo=e).mixTime=0,null!=n.mixingFrom&&0<n.mixDuration&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)},T.prototype.setAnimation=function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,i)},T.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var n=!0,r=this.expandToIndex(t),e=(null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,n=!1):this.disposeNext(r)),this.trackEntry(t,e,i,r));return this.setCurrent(t,e,n),this.queue.drain(),e},T.prototype.addAnimation=function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,i,n)},T.prototype.addAnimationWith=function(t,e,i,n){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;i=this.trackEntry(t,e,i,r);return null==r?(this.setCurrent(t,i,!0),this.queue.drain()):(r.next=i,n<=0&&(0!=(t=r.animationEnd-r.animationStart)?(r.loop?n+=t*(1+(r.trackTime/t|0)):n+=Math.max(t,r.trackTime),n-=this.data.getMix(r.animation,e)):n=r.trackTime)),i.delay=n,i},T.prototype.setEmptyAnimation=function(t,e){t=this.setAnimationWith(t,T.emptyAnimation,!1);return t.mixDuration=e,t.trackEnd=e,t},T.prototype.addEmptyAnimation=function(t,e,i){i<=0&&(i-=e);t=this.addAnimationWith(t,T.emptyAnimation,!1,i);return t.mixDuration=e,t.trackEnd=e,t},T.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,n=this.tracks.length;i<n;i++){var r=this.tracks[i];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},T.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(S.Utils.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)},T.prototype.trackEntry=function(t,e,i,n){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=i,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==n?0:this.data.getMix(n.animation,e),r},T.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},T.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++)if(null!=(i=this.tracks[t])){for(;null!=i.mixingFrom;)i=i.mixingFrom;for(;null!=i.mixingFrom&&i.mixBlend==S.MixBlend.add||this.computeHold(i),null!=(i=i.mixingTo););}this.propertyIDs.clear();for(t=this.tracks.length-1;0<=t;t--)for(var i=this.tracks[t];null!=i;)this.computeNotLast(i),i=i.mixingFrom},T.prototype.computeHold=function(t){var e=t.mixingTo,i=t.animation.timelines,n=t.animation.timelines.length,r=S.Utils.setArraySize(t.timelineMode,n),h=(t.timelineHoldMix.length=0,S.Utils.setArraySize(t.timelineHoldMix,n)),s=this.propertyIDs;if(null!=e&&e.holdPrevious)for(var o=0;o<n;o++)s.add(i[o].getPropertyId()),r[o]=T.HOLD;else t:for(o=0;o<n;o++){var a=i[o],c=a.getPropertyId();if(s.add(c))if(null==e||a instanceof S.AttachmentTimeline||a instanceof S.DrawOrderTimeline||a instanceof S.EventTimeline||!e.animation.hasTimeline(c))r[o]=T.FIRST;else{for(var l=e.mixingTo;null!=l;l=l.mixingTo)if(!l.animation.hasTimeline(c)){if(0<t.mixDuration){r[o]=T.HOLD_MIX,h[o]=l;continue t}break}r[o]=T.HOLD}else r[o]=T.SUBSEQUENT}},T.prototype.computeNotLast=function(t){for(var e,i=t.animation.timelines,n=t.animation.timelines.length,r=t.timelineMode,s=this.propertyIDs,o=0;o<n;o++)i[o]instanceof S.AttachmentTimeline&&(e=i[o],s.add(e.slotIndex)||(r[o]|=T.NOT_LAST))},T.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},T.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},T.prototype.removeListener=function(t){t=this.listeners.indexOf(t);0<=t&&this.listeners.splice(t,1)},T.prototype.clearListeners=function(){this.listeners.length=0},T.prototype.clearListenerNotifications=function(){this.queue.clear()},T.emptyAnimation=new S.Animation("<empty>",[],0),T.SUBSEQUENT=0,T.FIRST=1,T.HOLD=2,T.HOLD_MIX=3,T.NOT_LAST=4;var t=T;function T(t){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new n(this),this.propertyIDs=new S.IntSet,this.animationsChanged=!1,this.trackEntryPool=new S.Pool(function(){return new e}),this.data=t}S.AnimationState=t;i.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},i.prototype.getAnimationTime=function(){var t;return this.loop?0==(t=this.animationEnd-this.animationStart)?this.animationStart:this.trackTime%t+this.animationStart:Math.min(this.trackTime+this.animationStart,this.animationEnd)},i.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},i.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},i.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};var e=i;function i(){this.mixBlend=S.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}S.TrackEntry=e;r.prototype.start=function(t){this.objects.push(a.start),this.objects.push(t),this.animState.animationsChanged=!0},r.prototype.interrupt=function(t){this.objects.push(a.interrupt),this.objects.push(t)},r.prototype.end=function(t){this.objects.push(a.end),this.objects.push(t),this.animState.animationsChanged=!0},r.prototype.dispose=function(t){this.objects.push(a.dispose),this.objects.push(t)},r.prototype.complete=function(t){this.objects.push(a.complete),this.objects.push(t)},r.prototype.event=function(t,e){this.objects.push(a.event),this.objects.push(t),this.objects.push(e)},r.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var n=t[i],r=t[i+1];switch(n){case a.start:null!=r.listener&&r.listener.start&&r.listener.start(r);for(var s=0;s<e.length;s++)e[s].start&&e[s].start(r);break;case a.interrupt:null!=r.listener&&r.listener.interrupt&&r.listener.interrupt(r);for(s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(r);break;case a.end:null!=r.listener&&r.listener.end&&r.listener.end(r);for(s=0;s<e.length;s++)e[s].end&&e[s].end(r);case a.dispose:null!=r.listener&&r.listener.dispose&&r.listener.dispose(r);for(s=0;s<e.length;s++)e[s].dispose&&e[s].dispose(r);this.animState.trackEntryPool.free(r);break;case a.complete:null!=r.listener&&r.listener.complete&&r.listener.complete(r);for(s=0;s<e.length;s++)e[s].complete&&e[s].complete(r);break;case a.event:var o=t[2+i++];null!=r.listener&&r.listener.event&&r.listener.event(r,o);for(s=0;s<e.length;s++)e[s].event&&e[s].event(r,o)}}this.clear(),this.drainDisabled=!1}},r.prototype.clear=function(){this.objects.length=0};var a,n=r;function r(t){this.objects=[],this.drainDisabled=!1,this.animState=t}function s(){}S.EventQueue=n,(t=a=S.EventType||(S.EventType={}))[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",s.prototype.start=function(t){},s.prototype.interrupt=function(t){},s.prototype.end=function(t){},s.prototype.dispose=function(t){},s.prototype.complete=function(t){},s.prototype.event=function(t,e){},S.AnimationStateAdapter=s}(t=t||{}),function(t){function e(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}e.prototype.setMix=function(t,e,i){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);t=this.skeletonData.findAnimation(e);if(null==t)throw new Error("Animation not found: "+e);this.setMixWith(n,t,i)},e.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");t=t.name+"."+e.name;this.animationToMixTime[t]=i},e.prototype.getMix=function(t,e){t=t.name+"."+e.name,e=this.animationToMixTime[t];return void 0===e?this.defaultMix:e},t.AnimationStateData=e}(t=t||{}),function(_){function t(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}t.downloadText=function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){200==n.status?e(n.responseText):i(n.status,n.responseText)},n.onerror=function(){i(n.status,n.responseText)},n.send()},t.downloadBinary=function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status?e(new Uint8Array(n.response)):i(n.status,n.responseText)},n.onerror=function(){i(n.status,n.responseText)},n.send()},t.prototype.loadBinary=function(i,e,n){var r=this;void 0===e&&(e=null),void 0===n&&(n=null),i=this.pathPrefix+i,this.toLoad++,t.downloadBinary(i,function(t){r.assets[i]=t,e&&e(i,t),r.toLoad--,r.loaded++},function(t,e){r.errors[i]="Couldn't load binary "+i+": status "+status+", "+e,n&&n(i,"Couldn't load binary "+i+": status "+status+", "+e),r.toLoad--,r.loaded++})},t.prototype.loadText=function(i,e,n){var r=this;void 0===e&&(e=null),void 0===n&&(n=null),i=this.pathPrefix+i,this.toLoad++,t.downloadText(i,function(t){r.assets[i]=t,e&&e(i,t),r.toLoad--,r.loaded++},function(t,e){r.errors[i]="Couldn't load text "+i+": status "+status+", "+e,n&&n(i,"Couldn't load text "+i+": status "+status+", "+e),r.toLoad--,r.loaded++})},t.prototype.loadTexture=function(i,n,e){var r=this,s=(void 0===n&&(n=null),void 0===e&&(e=null),i=this.pathPrefix+i,this.toLoad++,new Image);s.crossOrigin="anonymous",s.onload=function(t){var e=r.textureLoader(s);r.assets[i]=e,r.toLoad--,r.loaded++,n&&n(i,s)},s.onerror=function(t){r.errors[i]="Couldn't load image "+i,r.toLoad--,r.loaded++,e&&e(i,"Couldn't load image "+i)},s.src=i},t.prototype.loadTextureData=function(i,t,n,e){var r=this,s=(void 0===n&&(n=null),void 0===e&&(e=null),i=this.pathPrefix+i,this.toLoad++,new Image);s.onload=function(t){var e=r.textureLoader(s);r.assets[i]=e,r.toLoad--,r.loaded++,n&&n(i,s)},s.onerror=function(t){r.errors[i]="Couldn't load image "+i,r.toLoad--,r.loaded++,e&&e(i,"Couldn't load image "+i)},s.src=t},t.prototype.loadTextureAtlas=function(a,c,l){var h=this,u=(void 0===c&&(c=null),void 0===l&&(l=null),0<=a.lastIndexOf("/")?a.substring(0,a.lastIndexOf("/")):"");a=this.pathPrefix+a,this.toLoad++,t.downloadText(a,function(r){var s={count:0},o=new Array;try{new _.TextureAtlas(r,function(t){o.push(u+"/"+t);t=document.createElement("img");return t.width=16,t.height=16,new _.FakeTexture(t)})}catch(t){var e=t;return h.errors[a]="Couldn't load texture atlas "+a+": "+e.message,l&&l(a,"Couldn't load texture atlas "+a+": "+e.message),h.toLoad--,void h.loaded++}for(var t=0,i=o;t<i.length;t++)!function(t){var n=!1;h.loadTexture(t,function(e,t){if(s.count++,s.count==o.length)if(n)h.errors[a]="Couldn't load texture atlas page "+e+"} of atlas "+a,l&&l(a,"Couldn't load texture atlas page "+e+" of atlas "+a),h.toLoad--,h.loaded++;else try{var i=new _.TextureAtlas(r,function(t){return h.get(u+"/"+t)});h.assets[a]=i,c&&c(a,i),h.toLoad--,h.loaded++}catch(t){e=t;h.errors[a]="Couldn't load texture atlas "+a+": "+e.message,l&&l(a,"Couldn't load texture atlas "+a+": "+e.message),h.toLoad--,h.loaded++}},function(t,e){n=!0,s.count++,s.count==o.length&&(h.errors[a]="Couldn't load texture atlas page "+t+"} of atlas "+a,l&&l(a,"Couldn't load texture atlas page "+t+" of atlas "+a),h.toLoad--,h.loaded++)})}(i[t])},function(t,e){h.errors[a]="Couldn't load texture atlas "+a+": status "+status+", "+e,l&&l(a,"Couldn't load texture atlas "+a+": status "+status+", "+e),h.toLoad--,h.loaded++})},t.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},t.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},t.prototype.removeAll=function(){for(var t in this.assets){t=this.assets[t];t.dispose&&t.dispose()}this.assets={}},t.prototype.isLoadingComplete=function(){return 0==this.toLoad},t.prototype.getToLoad=function(){return this.toLoad},t.prototype.getLoaded=function(){return this.loaded},t.prototype.dispose=function(){this.removeAll()},t.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},t.prototype.getErrors=function(){return this.errors},_.AssetManager=t}(t=t||{}),function(n){function t(t){this.atlas=t}t.prototype.newRegionAttachment=function(t,e,i){i=this.atlas.findRegion(i);if(null==i)return null;i.renderObject=i;e=new n.RegionAttachment(e);return e.setRegion(i),e},t.prototype.newMeshAttachment=function(t,e,i){i=this.atlas.findRegion(i);if(null==i)return null;i.renderObject=i;e=new n.MeshAttachment(e);return e.region=i,e},t.prototype.newBoundingBoxAttachment=function(t,e){return new n.BoundingBoxAttachment(e)},t.prototype.newPathAttachment=function(t,e){return new n.PathAttachment(e)},t.prototype.newPointAttachment=function(t,e){return new n.PointAttachment(e)},t.prototype.newClippingAttachment=function(t,e){return new n.ClippingAttachment(e)},n.AtlasAttachmentLoader=t}(t=t||{}),(e=(e=t=t||{}).BlendMode||(e.BlendMode={}))[e.Normal=0]="Normal",e[e.Additive=1]="Additive",e[e.Multiply=2]="Multiply",e[e.Screen=3]="Screen",function(T){function t(t,e,i){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}t.prototype.isActive=function(){return this.active},t.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransformWith=function(h,u,t,e,i,n,_){this.ax=h,this.ay=u,this.arotation=t,this.ascaleX=e,this.ascaleY=i,this.ashearX=n,this.ashearY=_,this.appliedValid=!0;var d,f,p,m=this.parent;if(null==m)return y=t+90+_,f=(d=this.skeleton).scaleX,p=d.scaleY,this.a=T.MathUtils.cosDeg(t+n)*e*f,this.b=T.MathUtils.cosDeg(y)*i*f,this.c=T.MathUtils.sinDeg(t+n)*e*p,this.d=T.MathUtils.sinDeg(y)*i*p,this.worldX=h*f+d.x,void(this.worldY=u*p+d.y);var r=m.a,s=m.b,o=m.c,a=m.d;switch(this.worldX=r*h+s*u+m.worldX,this.worldY=o*h+a*u+m.worldY,this.data.transformMode){case T.TransformMode.Normal:var y=t+90+_,g=T.MathUtils.cosDeg(t+n)*e,v=T.MathUtils.cosDeg(y)*i,x=T.MathUtils.sinDeg(t+n)*e,b=T.MathUtils.sinDeg(y)*i;return this.a=r*g+s*x,this.b=r*v+s*b,this.c=o*g+a*x,void(this.d=o*v+a*b);case T.TransformMode.OnlyTranslation:y=t+90+_;this.a=T.MathUtils.cosDeg(t+n)*e,this.b=T.MathUtils.cosDeg(y)*i,this.c=T.MathUtils.sinDeg(t+n)*e,this.d=T.MathUtils.sinDeg(y)*i;break;case T.TransformMode.NoRotationOrReflection:var A=0,c=t+n-(A=1e-4<(l=r*r+o*o)?(s=o*(l=Math.abs(r*a-s*o)/l),a=r*l,Math.atan2(o,r)*T.MathUtils.radDeg):(o=r=0,90-Math.atan2(a,s)*T.MathUtils.radDeg)),A=t+_-A+90,g=T.MathUtils.cosDeg(c)*e,v=T.MathUtils.cosDeg(A)*i,x=T.MathUtils.sinDeg(c)*e,b=T.MathUtils.sinDeg(A)*i;this.a=r*g-s*x,this.b=r*v-s*b,this.c=o*g+a*x,this.d=o*v+a*b;break;case T.TransformMode.NoScale:case T.TransformMode.NoScaleOrReflection:var l,c=T.MathUtils.cosDeg(t),A=T.MathUtils.sinDeg(t),C=(r*c+s*A)/this.skeleton.scaleX,c=(o*c+a*A)/this.skeleton.scaleY,A=(C*=l=1e-5<(l=Math.sqrt(C*C+c*c))?1/l:l,c*=l,l=Math.sqrt(C*C+c*c),this.data.transformMode==T.TransformMode.NoScale&&r*a-s*o<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(l=-l),Math.PI/2+Math.atan2(c,C)),S=Math.cos(A)*l,A=Math.sin(A)*l,g=T.MathUtils.cosDeg(n)*e,v=T.MathUtils.cosDeg(90+_)*i,x=T.MathUtils.sinDeg(n)*e,b=T.MathUtils.sinDeg(90+_)*i;this.a=C*g+S*x,this.b=C*v+S*b,this.c=c*g+A*x,this.d=c*v+A*b}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},t.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},t.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*T.MathUtils.radDeg},t.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*T.MathUtils.radDeg},t.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},t.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},t.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*T.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*T.MathUtils.radDeg);var e=t.a,i=t.b,n=t.c,r=t.d,s=1/(e*r-i*n),o=this.worldX-t.worldX,t=this.worldY-t.worldY,t=(this.ax=o*r*s-t*i*s,this.ay=t*e*s-o*n*s,s*r),o=s*e,r=s*i,e=s*n,i=t*this.a-r*this.c,s=t*this.b-r*this.d,n=o*this.c-e*this.a,t=o*this.d-e*this.b;this.ashearX=0,this.ascaleX=Math.sqrt(i*i+n*n),1e-4<this.ascaleX?(this.ascaleY=(r=i*t-s*n)/this.ascaleX,this.ashearY=Math.atan2(i*s+n*t,r)*T.MathUtils.radDeg,this.arotation=Math.atan2(n,i)*T.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(s*s+t*t),this.ashearY=0,this.arotation=90-Math.atan2(t,s)*T.MathUtils.radDeg)},t.prototype.worldToLocal=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=1/(e*r-i*n),o=t.x-this.worldX,a=t.y-this.worldY;return t.x=o*r*s-a*i*s,t.y=a*e*s-o*n*s,t},t.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},t.prototype.worldToLocalRotation=function(t){var e=T.MathUtils.sinDeg(t),t=T.MathUtils.cosDeg(t);return Math.atan2(this.a*e-this.c*t,this.d*t-this.b*e)*T.MathUtils.radDeg+this.rotation-this.shearX},t.prototype.localToWorldRotation=function(t){t-=this.rotation-this.shearX;var e=T.MathUtils.sinDeg(t),t=T.MathUtils.cosDeg(t);return Math.atan2(t*this.c+e*this.d,t*this.a+e*this.b)*T.MathUtils.radDeg},t.prototype.rotateWorld=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=T.MathUtils.cosDeg(t),t=T.MathUtils.sinDeg(t);this.a=s*e-t*n,this.b=s*i-t*r,this.c=t*e+s*n,this.d=t*i+s*r,this.appliedValid=!1},T.Bone=t}(t=t||{}),(l=t=t||{}).BoneData=function(t,e,i){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=h.Normal,this.skinRequired=!1,this.color=new l.Color,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=i},(e=h=l.TransformMode||(l.TransformMode={}))[e.Normal=0]="Normal",e[e.OnlyTranslation=1]="OnlyTranslation",e[e.NoRotationOrReflection=2]="NoRotationOrReflection",e[e.NoScale=3]="NoScale",e[e.NoScaleOrReflection=4]="NoScaleOrReflection",(t||(t={})).ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i},(t||(t={})).Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e},(t||(t={})).EventData=function(t){this.name=t},function(q){function t(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},t.prototype.apply1=function(t,e,i,n,r,h,s){t.appliedValid||t.updateAppliedTransform();var o,a=t.parent,c=1/(a.a*a.d-a.b*a.c),e=e-a.worldX,i=i-a.worldY,l=(e*a.d-i*a.b)*c-t.ax,i=(i*a.a-e*a.c)*c-t.ay,e=Math.atan2(i,l)*q.MathUtils.radDeg-t.ashearX-t.arotation,a=(t.ascaleX<0&&(e+=180),180<e?e-=360:e<-180&&(e+=360),t.ascaleX),c=t.ascaleY;(n||r)&&(o=t.data.length*a,l=Math.sqrt(l*l+i*i),(n&&l<o||r&&o<l&&1e-4<o)&&(a*=i=(l/o-1)*s+1,h&&(c*=i))),t.updateWorldTransformWith(t.ax,t.ay,t.arotation+e*s,a,c,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,e,h,u,_,d,f,p){if(0!=p){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var m,y=t.ax,g=t.ay,v=t.ascaleX,x=v,b=t.ascaleY,A=e.ascaleX,C=0,S=0,T=0,T=v<0?(v=-v,C=180,-1):(C=0,1),S=(b<0&&(b=-b,T=-T),A<0?(A=-A,180):0),w=e.ax,E=0,M=0,I=0,i=t.a,n=t.b,r=t.c,B=t.d,R=Math.abs(v-b)<=1e-4,I=R?(M=i*w+n*(E=e.ay)+t.worldX,r*w+B*E+t.worldY):(E=0,M=i*w+t.worldX,r*w+t.worldY),s=t.parent,P=(i=s.a,n=s.b,r=s.c,1/(i*(B=s.d)-n*r)),D=M-s.worldX,o=I-s.worldY,M=(D*B-o*n)*P-y,I=(o*i-D*r)*P-g,a=Math.sqrt(M*M+I*I),L=e.data.length*A;if(a<1e-4)return this.apply1(t,h,u,!1,d,!1,p),void e.updateWorldTransformWith(w,E,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var V=((D=h-s.worldX)*B-(o=u-s.worldY)*n)*P-y,O=(o*i-D*r)*P-g,F=V*V+O*O;0!=f&&(f*=v*(A+1)/2,0<(I=(M=Math.sqrt(F))-a-L*v+f)&&(F=(V-=(h=(I-f*(1-(h=Math.min(1,I/(2*f))-1)*h))/M)*V)*V+(O-=h*O)*O));t:if(R){var c=(F-a*a-(L*=v)*L)/(2*a*L);c<-1?c=-1:1<c&&(c=1,d&&(x*=(Math.sqrt(F)/(a+L)-1)*p+1)),m=Math.acos(c)*_,i=a+L*c,n=L*Math.sin(m),Y=Math.atan2(O*i-V*n,V*i+O*n)}else{var N=(i=v*L)*i,k=(n=b*L)*n,G=Math.atan2(O,V),c=-2*k*a,z=k-N;if(0<=(B=c*c-4*z*(r=k*a*a+N*F-N*k))){var l=Math.sqrt(B),c=(l=-(c+(l=c<0?-l:l))/2)/z,z=r/l,l=Math.abs(c)<Math.abs(z)?c:z;if(l*l<=F){o=Math.sqrt(F-l*l)*_,Y=G-Math.atan2(o,l),m=Math.atan2(o/b,(l-a)/v);break t}}var c=q.MathUtils.PI,z=a-i,l=z*z,U=0,W=0,H=a+i,j=H*H,X=0;-1<=(r=-i*a/(N-k))&&r<=1&&(r=Math.acos(r),(B=(D=i*Math.cos(r)+a)*D+(o=n*Math.sin(r))*o)<l&&(c=r,l=B,z=D,U=o),j<B&&(W=r,j=B,H=D,X=o)),m=F<=(l+j)/2?(Y=G-Math.atan2(U*_,z),c*_):(Y=G-Math.atan2(X*_,H),W*_)}var Y,u=Math.atan2(E,w)*T,s=t.arotation;180<(Y=(Y-u)*q.MathUtils.radDeg+C-s)?Y-=360:Y<-180&&(Y+=360),t.updateWorldTransformWith(y,g,s+Y*p,x,t.ascaleY,0,0),s=e.arotation,180<(m=((m+u)*q.MathUtils.radDeg-e.ashearX)*T+S-s)?m-=360:m<-180&&(m+=360),e.updateWorldTransformWith(w,E,s+m*p,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()},q.IkConstraint=t}(t=t||{}),e=t=t||{},d=e.ConstraintData,V(L,d),e.IkConstraintData=L,function(q){function J(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}J.prototype.isActive=function(){return this.active},J.prototype.apply=function(){this.update()},J.prototype.update=function(){var h=this.target.getAttachment();if(h instanceof q.PathAttachment){var u=this.rotateMix,_=this.translateMix,d=0<u;if(0<_||d){var f=this.data,p=f.spacingMode==q.SpacingMode.Percent,m=f.rotateMode,y=m==q.RotateMode.Tangent,g=m==q.RotateMode.ChainScale,v=this.bones.length,x=y?v:v+1,b=this.bones,A=q.Utils.setArraySize(this.spaces,x),C=null,S=this.spacing;if(g||!p){g&&(C=q.Utils.setArraySize(this.lengths,v));for(var T=f.spacingMode==q.SpacingMode.Length,t=0,w=x-1;t<w;){var E,e=(i=b[t]).data.length;e<J.epsilon?(g&&(C[t]=0),A[++t]=0):p?(g&&(r=e*i.a,s=e*i.c,E=Math.sqrt(r*r+s*s),C[t]=E),A[++t]=S):(r=e*i.a,s=e*i.c,E=Math.sqrt(r*r+s*s),g&&(C[t]=E),A[++t]=(T?e+S:S)*E/e)}}else for(t=1;t<x;t++)A[t]=S;var M=this.computeWorldPositions(h,x,y,f.positionMode==q.PositionMode.Percent,p),I=M[0],B=M[1],R=f.offsetRotation,P=!1;0==R?P=m==q.RotateMode.Chain:(P=!1,R*=0<(n=this.target.bone).a*n.d-n.b*n.c?q.MathUtils.degRad:-q.MathUtils.degRad);for(var i,t=0,n=3;t<v;t++,n+=3){(i=b[t]).worldX+=(I-i.worldX)*_,i.worldY+=(B-i.worldY)*_;var r,s,o,D,L,V,a,c,O,l,F=(r=M[n])-I,N=(s=M[n+1])-B;!g||0!=(o=C[t])&&(o=(Math.sqrt(F*F+N*N)/o-1)*u+1,i.a*=o,i.c*=o),I=r,B=s,d&&(o=i.a,D=i.b,L=i.c,V=i.d,c=a=l=0,l=y?M[n-1]:0==A[t+1]?M[n+2]:Math.atan2(N,F),l-=Math.atan2(L,o),P?(a=Math.cos(l),c=Math.sin(l),I+=((O=i.data.length)*(a*o-c*L)-F)*u,B+=(O*(c*o+a*L)-N)*u):l+=R,l>q.MathUtils.PI?l-=q.MathUtils.PI2:l<-q.MathUtils.PI&&(l+=q.MathUtils.PI2),l*=u,a=Math.cos(l),c=Math.sin(l),i.a=a*o-c*L,i.b=a*D-c*V,i.c=c*o+a*L,i.d=c*D+a*V),i.appliedValid=!1}}}},J.prototype.computeWorldPositions=function(t,h,u,_,d){var f=this.target,p=this.position,m=this.spaces,y=q.Utils.setArraySize(this.positions,3*h+2),e=null,g=t.closed,i=t.worldVerticesLength,v=i/6,x=J.NONE;if(!t.constantSpeed){var b=t.lengths,A=b[v-=g?1:2];if(_&&(p*=A),d)for(var n=1;n<h;n++)m[n]*=A;for(var e=q.Utils.setArraySize(this.world,8),n=0,C=0,r=0;n<h;n++,C+=3){var s=p+=H=m[n];if(g)(s%=A)<0&&(s+=A),r=0;else{if(s<0){x!=J.BEFORE&&(x=J.BEFORE,t.computeWorldVertices(f,2,4,e,0,2)),this.addBeforePosition(s,e,0,y,C);continue}if(A<s){x!=J.AFTER&&(x=J.AFTER,t.computeWorldVertices(f,i-6,4,e,0,2)),this.addAfterPosition(s-A,e,0,y,C);continue}}for(;;r++){var S=b[r];if(!(S<s)){0==r?s/=S:s=(s-(X=b[r-1]))/(S-X);break}}r!=x&&(x=r,g&&r==v?(t.computeWorldVertices(f,i-4,4,e,0,2),t.computeWorldVertices(f,0,4,e,4,2)):t.computeWorldVertices(f,6*r+2,8,e,0,2)),this.addCurvePosition(s,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],y,C,u||0<n&&0==H)}return y}g?(e=q.Utils.setArraySize(this.world,i+=2),t.computeWorldVertices(f,2,i-4,e,0,2),t.computeWorldVertices(f,0,2,e,i-4,2),e[i-2]=e[0],e[i-1]=e[1]):(v--,e=q.Utils.setArraySize(this.world,i-=4),t.computeWorldVertices(f,2,i,e,0,2));for(var T=q.Utils.setArraySize(this.curves,v),o=0,w=e[0],E=e[1],M=0,I=0,B=0,R=0,P=0,D=0,L=0,V=0,O=0,F=0,N=0,k=0,a=0,c=0,n=0,G=2;n<v;n++,G+=6)M=e[G],I=e[G+1],B=e[G+2],R=e[G+3],N=2*(L=.1875*(w-2*M+B))+(O=.09375*(3*(M-B)-w+(P=e[G+4]))),k=2*(V=.1875*(E-2*I+R))+(F=.09375*(3*(I-R)-E+(D=e[G+5]))),a=.75*(M-w)+L+.16666667*O,c=.75*(I-E)+V+.16666667*F,o+=Math.sqrt(a*a+c*c),a+=N,c+=k,N+=O,k+=F,o+=Math.sqrt(a*a+c*c),a+=N,c+=k,o+=Math.sqrt(a*a+c*c),a+=N+O,c+=k+F,o+=Math.sqrt(a*a+c*c),T[n]=o,w=P,E=D;if(p*=_?o:o/t.lengths[v-1],d)for(n=1;n<h;n++)m[n]*=o;for(var z=this.segments,U=0,n=0,C=0,r=0,W=0;n<h;n++,C+=3){var H,s=p+=H=m[n];if(g)(s%=o)<0&&(s+=o),r=0;else{if(s<0){this.addBeforePosition(s,e,0,y,C);continue}if(o<s){this.addAfterPosition(s-o,e,i-4,y,C);continue}}for(;;r++){var j=T[r];if(!(j<s)){0==r?s/=j:s=(s-(X=T[r-1]))/(j-X);break}}if(r!=x){var x=r,l=6*r,w=e[l],E=e[l+1],M=e[l+2],I=e[l+3],B=e[l+4],R=e[l+5],N=2*(L=.03*(w-2*M+B))+(O=.006*(3*(M-B)-w+(P=e[l+6]))),k=2*(V=.03*(E-2*I+R))+(F=.006*(3*(I-R)-E+(D=e[l+7]))),a=.3*(M-w)+L+.16666667*O,c=.3*(I-E)+V+.16666667*F,U=Math.sqrt(a*a+c*c);for(z[0]=U,l=1;l<8;l++)a+=N,c+=k,N+=O,k+=F,U+=Math.sqrt(a*a+c*c),z[l]=U;a+=N,c+=k,U+=Math.sqrt(a*a+c*c),z[8]=U,a+=N+O,c+=k+F,U+=Math.sqrt(a*a+c*c),z[9]=U,W=0}for(s*=U;;W++){var X,Y=z[W];if(!(Y<s)){0==W?s/=Y:s=W+(s-(X=z[W-1]))/(Y-X);break}}this.addCurvePosition(.1*s,w,E,M,I,B,R,P,D,y,C,u||0<n&&0==H)}return y},J.prototype.addBeforePosition=function(t,e,i,n,r){var s=e[i],o=e[i+1],a=e[i+2]-s,e=e[i+3]-o,i=Math.atan2(e,a);n[r]=s+t*Math.cos(i),n[r+1]=o+t*Math.sin(i),n[r+2]=i},J.prototype.addAfterPosition=function(t,e,i,n,r){var s=e[i+2],o=e[i+3],a=s-e[i],e=o-e[i+1],i=Math.atan2(e,a);n[r]=s+t*Math.cos(i),n[r+1]=o+t*Math.sin(i),n[r+2]=i},J.prototype.addCurvePosition=function(t,e,i,n,r,h,u,_,d,s,o,f){if(0==t||isNaN(t))return s[o]=e,s[o+1]=i,void(s[o+2]=Math.atan2(r-i,n-e));var p=t*t,m=p*t,a=1-t,y=a*a,c=y*a,g=a*t,l=3*g,a=a*l,l=l*t,_=e*c+n*a+h*l+_*m,c=i*c+r*a+u*l+d*m;s[o]=_,s[o+1]=c,f&&(s[o+2]=t<.001?Math.atan2(r-i,n-e):Math.atan2(c-(i*y+r*g*2+u*p),_-(e*y+n*g*2+h*p)))},J.NONE=-1,J.BEFORE=-2,J.AFTER=-3,J.epsilon=1e-5,q.PathConstraint=J}(t=t||{}),e=t=t||{},f=e.ConstraintData,V(O,f),n=O,e.PathConstraintData=n,(n=e.PositionMode||(e.PositionMode={}))[n.Fixed=0]="Fixed",n[n.Percent=1]="Percent",(n=e.SpacingMode||(e.SpacingMode={}))[n.Length=0]="Length",n[n.Fixed=1]="Fixed",n[n.Percent=2]="Percent",(n=e.RotateMode||(e.RotateMode={}))[n.Tangent=0]="Tangent",n[n.Chain=1]="Chain",n[n.ChainScale=2]="ChainScale",function(t){e.prototype.loaded=function(){var t,e=0;for(t in this.assets)e++;return e};var r=e;function e(t){this.toLoad=new Array,this.assets={},this.clientId=t}function i(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}i.prototype.queueAsset=function(t,e,i){var n=this.clientAssets[t];return null==n&&(n=new r(t),this.clientAssets[t]=n),null!==e&&(n.textureLoader=e),n.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0)},i.prototype.loadText=function(t,e){var i,n=this;e=this.pathPrefix+e,this.queueAsset(t,null,e)&&((i=new XMLHttpRequest).onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200<=i.status&&i.status<300?n.rawAssets[e]=i.responseText:n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send())},i.prototype.loadJson=function(t,e){var i,n=this;e=this.pathPrefix+e,this.queueAsset(t,null,e)&&((i=new XMLHttpRequest).onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200<=i.status&&i.status<300?n.rawAssets[e]=JSON.parse(i.responseText):n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send())},i.prototype.loadTexture=function(t,e,i){var n,r=this;i=this.pathPrefix+i,this.queueAsset(t,e,i)&&((n=new Image).src=i,n.crossOrigin="anonymous",n.onload=function(t){r.rawAssets[i]=n},n.onerror=function(t){r.errors[i]="Couldn't load image "+i})},i.prototype.get=function(t,e){e=this.pathPrefix+e;t=this.clientAssets[t];return null==t||t.assets[e]},i.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e],n=t.assets[i];null!=n||null!=(n=this.rawAssets[i])&&(n instanceof HTMLImageElement?t.assets[i]=t.textureLoader(n):t.assets[i]=n)}},i.prototype.isLoadingComplete=function(t){t=this.clientAssets[t];return null==t||(this.updateClientAssets(t),t.toLoad.length==t.loaded())},i.prototype.dispose=function(){},i.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},i.prototype.getErrors=function(){return this.errors},t.SharedAssetManager=i}(t=t||{}),function(g){function t(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var i,n=t.bones[e],r=void 0;null==n.parent?r=new g.Bone(n,this,null):(i=this.bones[n.parent.index],r=new g.Bone(n,this,i),i.children.push(r)),this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(e=0;e<t.slots.length;e++){var s=t.slots[e],r=this.bones[s.boneData.index],s=new g.Slot(s,r);this.slots.push(s),this.drawOrder.push(s)}this.ikConstraints=new Array;for(e=0;e<t.ikConstraints.length;e++){var o=t.ikConstraints[e];this.ikConstraints.push(new g.IkConstraint(o,this))}this.transformConstraints=new Array;for(e=0;e<t.transformConstraints.length;e++){var a=t.transformConstraints[e];this.transformConstraints.push(new g.TransformConstraint(a,this))}this.pathConstraints=new Array;for(e=0;e<t.pathConstraints.length;e++){var c=t.pathConstraints[e];this.pathConstraints.push(new g.PathConstraint(c,this))}this.color=new g.Color(1,1,1,1),this.updateCache()}t.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)(n=t[e]).sorted=n.data.skinRequired,n.active=!n.sorted;if(null!=this.skin)for(var h=this.skin.bones,e=0,i=this.skin.bones.length;e<i;e++)for(var n=this.bones[h[e].index];n.sorted=!1,n.active=!0,null!=(n=n.parent););var r=this.ikConstraints,s=this.transformConstraints,o=this.pathConstraints,a=r.length,u=s.length,_=o.length,d=a+u+_;t:for(e=0;e<d;e++){for(var c=0;c<a;c++)if((l=r[c]).data.order==e){this.sortIkConstraint(l);continue t}for(c=0;c<u;c++)if((l=s[c]).data.order==e){this.sortTransformConstraint(l);continue t}for(var l,c=0;c<_;c++)if((l=o[c]).data.order==e){this.sortPathConstraint(l);continue t}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},t.prototype.sortIkConstraint=function(t){var e,i,n;t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.Utils.contains(this.skin.constraints,t.data,!0)),t.active&&(e=t.target,this.sortBone(e),i=(e=t.bones)[0],this.sortBone(i),1<e.length&&(n=e[e.length-1],-1<this._updateCache.indexOf(n)||this.updateCacheReset.push(n)),this._updateCache.push(t),this.sortReset(i.children),e[e.length-1].sorted=!0)},t.prototype.sortPathConstraint=function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.Utils.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,i=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,n);for(var r=0,s=this.data.skins.length;r<s;r++)this.sortPathConstraintAttachment(this.data.skins[r],i,n);for(var e=e.getAttachment(),o=(e instanceof g.PathAttachment&&this.sortPathConstraintAttachmentWith(e,n),t.bones),a=o.length,r=0;r<a;r++)this.sortBone(o[r]);this._updateCache.push(t);for(r=0;r<a;r++)this.sortReset(o[r].children);for(r=0;r<a;r++)o[r].sorted=!0}},t.prototype.sortTransformConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.Utils.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,i=e.length;if(t.data.local)for(var n=0;n<i;n++){var r=e[n];this.sortBone(r.parent),-1<this._updateCache.indexOf(r)||this.updateCacheReset.push(r)}else for(n=0;n<i;n++)this.sortBone(e[n]);this._updateCache.push(t);for(var s=0;s<i;s++)this.sortReset(e[s].children);for(s=0;s<i;s++)e[s].sorted=!0}},t.prototype.sortPathConstraintAttachment=function(t,e,i){var n=t.attachments[e];if(n)for(var r in n)this.sortPathConstraintAttachmentWith(n[r],i)},t.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof g.PathAttachment){var i=t.bones;if(null==i)this.sortBone(e);else for(var n=this.bones,r=0;r<i.length;)for(var s=i[r++],o=r+s;r<o;r++){var a=i[r];this.sortBone(n[a])}}},t.prototype.sortBone=function(t){var e;t.sorted||(null!=(e=t.parent)&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t))},t.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}},t.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var r=this._updateCache,e=0,i=r.length;e<i;e++)r[e].update()},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,i=n.length;e<i;e++)(a=n[e]).mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch;for(var r=this.transformConstraints,e=0,i=r.length;e<i;e++){var s=(a=r[e]).data;a.rotateMix=s.rotateMix,a.translateMix=s.translateMix,a.scaleMix=s.scaleMix,a.shearMix=s.shearMix}for(var o=this.pathConstraints,e=0,i=o.length;e<i;e++){var a,s=(a=o[e]).data;a.position=s.position,a.spacing=s.spacing,a.rotateMix=s.rotateMix,a.translateMix=s.translateMix}},t.prototype.setSlotsToSetupPose=function(){var t=this.slots;g.Utils.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},t.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},t.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],s=r.data.attachmentName;null==s||null!=(s=t.getAttachment(i,s))&&r.setAttachment(s)}this.skin=t,this.updateCache()}},t.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},t.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},t.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,n=0,r=i.length;n<r;n++){var s=i[n];if(s.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(o)}}throw new Error("Slot not found: "+t)},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},t.prototype.getBounds=function(t,h,e){if(void 0===e&&(e=new Array(2)),null==t)throw new Error("offset cannot be null.");if(null==h)throw new Error("size cannot be null.");for(var u=this.drawOrder,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,r=0,f=u.length;r<f;r++){var s=u[r];if(s.bone.active){var o=0,a=null,c=s.getAttachment();if(c instanceof g.RegionAttachment?(a=g.Utils.setArraySize(e,o=8,0),c.computeWorldVertices(s.bone,a,0,2)):c instanceof g.MeshAttachment&&(o=(c=c).worldVerticesLength,a=g.Utils.setArraySize(e,o,0),c.computeWorldVertices(s,0,o,a,0,2)),null!=a)for(var l=0,p=a.length;l<p;l+=2)var m=a[l],y=a[l+1],i=Math.min(i,m),n=Math.min(n,y),_=Math.max(_,m),d=Math.max(d,y)}}t.set(i,n),h.set(_-i,d-n)},t.prototype.update=function(t){this.time+=t},g.Skeleton=t}(t=t||{});var H=t=t||{},e=(j.prototype.readSkeletonData=function(h){for(var t=this.scale,e=new H.SkeletonData,i=(e.name="",new F(h)),u=(e.hash=i.readString(),e.version=i.readString(),e.x=i.readFloat(),e.y=i.readFloat(),e.width=i.readFloat(),e.height=i.readFloat(),i.readBoolean()),n=(u&&(e.fps=i.readFloat(),e.imagesPath=i.readString(),e.audioPath=i.readString()),0),n=i.readInt(!0),r=0;r<n;r++)i.strings.push(i.readString());n=i.readInt(!0);for(r=0;r<n;r++){var _=i.readString(),d=0==r?null:e.bones[i.readInt(!0)];(s=new H.BoneData(r,_,d)).rotation=i.readFloat(),s.x=i.readFloat()*t,s.y=i.readFloat()*t,s.scaleX=i.readFloat(),s.scaleY=i.readFloat(),s.shearX=i.readFloat(),s.shearY=i.readFloat(),s.length=i.readFloat()*t,s.transformMode=j.TransformModeValues[i.readInt(!0)],s.skinRequired=i.readBoolean(),u&&H.Color.rgba8888ToColor(s.color,i.readInt32()),e.bones.push(s)}n=i.readInt(!0);for(r=0;r<n;r++){var f=i.readString(),p=e.bones[i.readInt(!0)],s=new H.SlotData(r,f,p),f=(H.Color.rgba8888ToColor(s.color,i.readInt32()),i.readInt32());-1!=f&&H.Color.rgb888ToColor(s.darkColor=new H.Color,f),s.attachmentName=i.readStringRef(),s.blendMode=j.BlendModeValues[i.readInt(!0)],e.slots.push(s)}n=i.readInt(!0);for(var r=0,o=void 0;r<n;r++){(s=new H.IkConstraintData(i.readString())).order=i.readInt(!0),s.skinRequired=i.readBoolean(),o=i.readInt(!0);for(var a=0;a<o;a++)s.bones.push(e.bones[i.readInt(!0)]);s.target=e.bones[i.readInt(!0)],s.mix=i.readFloat(),s.softness=i.readFloat()*t,s.bendDirection=i.readByte(),s.compress=i.readBoolean(),s.stretch=i.readBoolean(),s.uniform=i.readBoolean(),e.ikConstraints.push(s)}n=i.readInt(!0);for(r=0,o=void 0;r<n;r++){(s=new H.TransformConstraintData(i.readString())).order=i.readInt(!0),s.skinRequired=i.readBoolean(),o=i.readInt(!0);for(a=0;a<o;a++)s.bones.push(e.bones[i.readInt(!0)]);s.target=e.bones[i.readInt(!0)],s.local=i.readBoolean(),s.relative=i.readBoolean(),s.offsetRotation=i.readFloat(),s.offsetX=i.readFloat()*t,s.offsetY=i.readFloat()*t,s.offsetScaleX=i.readFloat(),s.offsetScaleY=i.readFloat(),s.offsetShearY=i.readFloat(),s.rotateMix=i.readFloat(),s.translateMix=i.readFloat(),s.scaleMix=i.readFloat(),s.shearMix=i.readFloat(),e.transformConstraints.push(s)}n=i.readInt(!0);for(r=0,o=void 0;r<n;r++){(s=new H.PathConstraintData(i.readString())).order=i.readInt(!0),s.skinRequired=i.readBoolean(),o=i.readInt(!0);for(a=0;a<o;a++)s.bones.push(e.bones[i.readInt(!0)]);s.target=e.slots[i.readInt(!0)],s.positionMode=j.PositionModeValues[i.readInt(!0)],s.spacingMode=j.SpacingModeValues[i.readInt(!0)],s.rotateMode=j.RotateModeValues[i.readInt(!0)],s.offsetRotation=i.readFloat(),s.position=i.readFloat(),s.positionMode==H.PositionMode.Fixed&&(s.position*=t),s.spacing=i.readFloat(),s.spacingMode!=H.SpacingMode.Length&&s.spacingMode!=H.SpacingMode.Fixed||(s.spacing*=t),s.rotateMix=i.readFloat(),s.translateMix=i.readFloat(),e.pathConstraints.push(s)}var h=this.readSkin(i,e,!0,u),r=(null!=h&&(e.defaultSkin=h,e.skins.push(h)),e.skins.length);for(H.Utils.setArraySize(e.skins,n=r+i.readInt(!0));r<n;r++)e.skins[r]=this.readSkin(i,e,!1,u);n=this.linkedMeshes.length;for(r=0;r<n;r++){var c=this.linkedMeshes[r],l=null==c.skin?e.defaultSkin:e.findSkin(c.skin);if(null==l)throw new Error("Skin not found: "+c.skin);l=l.getAttachment(c.slotIndex,c.parent);if(null==l)throw new Error("Parent mesh not found: "+c.parent);c.mesh.deformAttachment=c.inheritDeform?l:c.mesh,c.mesh.setParentMesh(l),c.mesh.updateUVs()}this.linkedMeshes.length=0,n=i.readInt(!0);for(r=0;r<n;r++)(s=new H.EventData(i.readStringRef())).intValue=i.readInt(!1),s.floatValue=i.readFloat(),s.stringValue=i.readString(),s.audioPath=i.readString(),null!=s.audioPath&&(s.volume=i.readFloat(),s.balance=i.readFloat()),e.events.push(s);n=i.readInt(!0);for(r=0;r<n;r++)e.animations.push(this.readAnimation(i,i.readString(),e));return e},j.prototype.readSkin=function(t,e,h,u){var i=null,n=0;if(h){if(0==(n=t.readInt(!0)))return null;i=new H.Skin("default")}else{(i=new H.Skin(t.readStringRef())).bones.length=t.readInt(!0);for(var r=0,s=i.bones.length;r<s;r++)i.bones[r]=e.bones[t.readInt(!0)];for(r=0,s=t.readInt(!0);r<s;r++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(r=0,s=t.readInt(!0);r<s;r++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(r=0,s=t.readInt(!0);r<s;r++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);n=t.readInt(!0)}for(r=0;r<n;r++)for(var o=t.readInt(!0),a=0,_=t.readInt(!0);a<_;a++){var c=t.readStringRef(),l=this.readAttachment(t,e,i,o,c,u);null!=l&&i.setAttachment(o,c,l)}return i},j.prototype.readAttachment=function(t,h,u,_,d,e){var i=this.scale,n=t.readStringRef(),d=(null==n&&(n=d),t.readByte());switch(j.AttachmentTypeValues[d]){case H.AttachmentType.Region:var r=t.readStringRef(),f=t.readFloat(),p=t.readFloat(),m=t.readFloat(),y=t.readFloat(),s=t.readFloat(),g=t.readFloat(),o=t.readFloat(),v=t.readInt32(),a=(null==r&&(r=n),this.attachmentLoader.newRegionAttachment(u,n,r));return null==a?null:(a.path=r,a.x=p*i,a.y=m*i,a.scaleX=y,a.scaleY=s,a.rotation=f,a.width=g*i,a.height=o*i,H.Color.rgba8888ToColor(a.color,v),a.updateOffset(),a);case H.AttachmentType.BoundingBox:var c=t.readInt(!0),x=this.readVertices(t,c),v=e?t.readInt32():0,y=this.attachmentLoader.newBoundingBoxAttachment(u,n);return null==y?null:(y.worldVerticesLength=c<<1,y.vertices=x.vertices,y.bones=x.bones,e&&H.Color.rgba8888ToColor(y.color,v),y);case H.AttachmentType.Mesh:var r=t.readStringRef(),v=t.readInt32(),c=t.readInt(!0),s=this.readFloatArray(t,c<<1,1),a=this.readShortArray(t),x=this.readVertices(t,c),y=t.readInt(!0),b=null,g=0,o=0;return e&&(b=this.readShortArray(t),g=t.readFloat(),o=t.readFloat()),null==r&&(r=n),null==(l=this.attachmentLoader.newMeshAttachment(u,n,r))?null:(l.path=r,H.Color.rgba8888ToColor(l.color,v),l.bones=x.bones,l.vertices=x.vertices,l.worldVerticesLength=c<<1,l.triangles=a,l.regionUVs=s,l.updateUVs(),l.hullLength=y<<1,e&&(l.edges=b,l.width=g*i,l.height=o*i),l);case H.AttachmentType.LinkedMesh:var l,r=t.readStringRef(),v=t.readInt32(),a=t.readStringRef(),s=t.readStringRef(),y=t.readBoolean(),g=0,o=0;return e&&(g=t.readFloat(),o=t.readFloat()),null==r&&(r=n),null==(l=this.attachmentLoader.newMeshAttachment(u,n,r))?null:(l.path=r,H.Color.rgba8888ToColor(l.color,v),e&&(l.width=g*i,l.height=o*i),this.linkedMeshes.push(new k(l,a,_,s,y)),l);case H.AttachmentType.Path:for(var b=t.readBoolean(),g=t.readBoolean(),c=t.readInt(!0),x=this.readVertices(t,c),A=H.Utils.newArray(c/3,0),C=0,S=A.length;C<S;C++)A[C]=t.readFloat()*i;v=e?t.readInt32():0;return null==(r=this.attachmentLoader.newPathAttachment(u,n))?null:(r.closed=b,r.constantSpeed=g,r.worldVerticesLength=c<<1,r.vertices=x.vertices,r.bones=x.bones,r.lengths=A,e&&H.Color.rgba8888ToColor(r.color,v),r);case H.AttachmentType.Point:f=t.readFloat(),p=t.readFloat(),m=t.readFloat(),v=e?t.readInt32():0,o=this.attachmentLoader.newPointAttachment(u,n);return null==o?null:(o.x=p*i,o.y=m*i,o.rotation=f,e&&H.Color.rgba8888ToColor(o.color,v),o);case H.AttachmentType.Clipping:a=t.readInt(!0),c=t.readInt(!0),x=this.readVertices(t,c),v=e?t.readInt32():0,s=this.attachmentLoader.newClippingAttachment(u,n);return null==s?null:(s.endSlot=h.slots[a],s.worldVerticesLength=c<<1,s.vertices=x.vertices,s.bones=x.bones,e&&H.Color.rgba8888ToColor(s.color,v),s)}return null},j.prototype.readVertices=function(t,e){var i=e<<1,n=new G,r=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,i,r),n;for(var s=new Array,o=new Array,a=0;a<e;a++){var c=t.readInt(!0);o.push(c);for(var l=0;l<c;l++)o.push(t.readInt(!0)),s.push(t.readFloat()*r),s.push(t.readFloat()*r),s.push(t.readFloat())}return n.vertices=H.Utils.toFloatArray(s),n.bones=o,n},j.prototype.readFloatArray=function(t,e,i){var n=new Array(e);if(1==i)for(var r=0;r<e;r++)n[r]=t.readFloat();else for(r=0;r<e;r++)n[r]=t.readFloat()*i;return n},j.prototype.readShortArray=function(t){for(var e=t.readInt(!0),i=new Array(e),n=0;n<e;n++)i[n]=t.readShort();return i},j.prototype.readAnimation=function(t,h,u){for(var e=new Array,_=this.scale,i=0,d=new H.Color,f=new H.Color,n=0,r=t.readInt(!0);n<r;n++)for(var p=t.readInt(!0),s=0,m=t.readInt(!0);s<m;s++){var y=t.readByte(),o=t.readInt(!0);switch(y){case j.SLOT_ATTACHMENT:(c=new H.AttachmentTimeline(o)).slotIndex=p;for(var a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readStringRef());e.push(c),i=Math.max(i,c.frames[o-1]);break;case j.SLOT_COLOR:(c=new H.ColorTimeline(o)).slotIndex=p;for(a=0;a<o;a++){var g=t.readFloat();H.Color.rgba8888ToColor(d,t.readInt32()),c.setFrame(a,g,d.r,d.g,d.b,d.a),a<o-1&&this.readCurve(t,a,c)}e.push(c),i=Math.max(i,c.frames[(o-1)*H.ColorTimeline.ENTRIES]);break;case j.SLOT_TWO_COLOR:(c=new H.TwoColorTimeline(o)).slotIndex=p;for(a=0;a<o;a++){g=t.readFloat();H.Color.rgba8888ToColor(d,t.readInt32()),H.Color.rgb888ToColor(f,t.readInt32()),c.setFrame(a,g,d.r,d.g,d.b,d.a,f.r,f.g,f.b),a<o-1&&this.readCurve(t,a,c)}e.push(c),i=Math.max(i,c.frames[(o-1)*H.TwoColorTimeline.ENTRIES])}}for(n=0,r=t.readInt(!0);n<r;n++)for(var v=t.readInt(!0),s=0,m=t.readInt(!0);s<m;s++){y=t.readByte(),o=t.readInt(!0);switch(y){case j.BONE_ROTATE:(c=new H.RotateTimeline(o)).boneIndex=v;for(a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readFloat()),a<o-1&&this.readCurve(t,a,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.RotateTimeline.ENTRIES]);break;case j.BONE_TRANSLATE:case j.BONE_SCALE:case j.BONE_SHEAR:var c=void 0,x=1;y==j.BONE_SCALE?c=new H.ScaleTimeline(o):y==j.BONE_SHEAR?c=new H.ShearTimeline(o):(c=new H.TranslateTimeline(o),x=_),c.boneIndex=v;for(a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readFloat()*x,t.readFloat()*x),a<o-1&&this.readCurve(t,a,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.TranslateTimeline.ENTRIES])}}for(n=0,r=t.readInt(!0);n<r;n++){var b=t.readInt(!0),o=t.readInt(!0);(c=new H.IkConstraintTimeline(o)).ikConstraintIndex=b;for(a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readFloat(),t.readFloat()*_,t.readByte(),t.readBoolean(),t.readBoolean()),a<o-1&&this.readCurve(t,a,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.IkConstraintTimeline.ENTRIES])}for(n=0,r=t.readInt(!0);n<r;n++){b=t.readInt(!0),o=t.readInt(!0);(c=new H.TransformConstraintTimeline(o)).transformConstraintIndex=b;for(a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),a<o-1&&this.readCurve(t,a,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.TransformConstraintTimeline.ENTRIES])}for(n=0,r=t.readInt(!0);n<r;n++)for(var b=t.readInt(!0),A=u.pathConstraints[b],s=0,m=t.readInt(!0);s<m;s++){y=t.readByte(),o=t.readInt(!0);switch(y){case j.PATH_POSITION:case j.PATH_SPACING:var c=void 0,x=1;y==j.PATH_SPACING?(c=new H.PathConstraintSpacingTimeline(o),A.spacingMode!=H.SpacingMode.Length&&A.spacingMode!=H.SpacingMode.Fixed||(x=_)):(c=new H.PathConstraintPositionTimeline(o),A.positionMode==H.PositionMode.Fixed&&(x=_)),c.pathConstraintIndex=b;for(a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readFloat()*x),a<o-1&&this.readCurve(t,a,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.PathConstraintPositionTimeline.ENTRIES]);break;case j.PATH_MIX:(c=new H.PathConstraintMixTimeline(o)).pathConstraintIndex=b;for(a=0;a<o;a++)c.setFrame(a,t.readFloat(),t.readFloat(),t.readFloat()),a<o-1&&this.readCurve(t,a,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.PathConstraintMixTimeline.ENTRIES])}}for(n=0,r=t.readInt(!0);n<r;n++)for(var C=u.skins[t.readInt(!0)],s=0,m=t.readInt(!0);s<m;s++)for(var p=t.readInt(!0),S=0,T=t.readInt(!0);S<T;S++){var w=C.getAttachment(p,t.readStringRef()),E=null!=w.bones,M=w.vertices,I=E?M.length/3*2:M.length,o=t.readInt(!0);(c=new H.DeformTimeline(o)).slotIndex=p,c.attachment=w;for(a=0;a<o;a++){var g=t.readFloat(),B=void 0,R=t.readInt(!0);if(0==R)B=E?H.Utils.newFloatArray(I):M;else{var B=H.Utils.newFloatArray(I),P=t.readInt(!0);if(R+=P,1==_)for(var l=P;l<R;l++)B[l]=t.readFloat();else for(l=P;l<R;l++)B[l]=t.readFloat()*_;if(!E)for(var l=0,D=B.length;l<D;l++)B[l]+=M[l]}c.setFrame(a,g,B),a<o-1&&this.readCurve(t,a,c)}e.push(c),i=Math.max(i,c.frames[o-1])}var L=t.readInt(!0);if(0<L){for(var c=new H.DrawOrderTimeline(L),V=u.slots.length,n=0;n<L;n++){for(var g=t.readFloat(),O=t.readInt(!0),F=H.Utils.newArray(V,0),s=V-1;0<=s;s--)F[s]=-1;for(var N=H.Utils.newArray(V-O,0),k=0,G=0,s=0;s<O;s++){for(p=t.readInt(!0);k!=p;)N[G++]=k++;F[k+t.readInt(!0)]=k++}for(;k<V;)N[G++]=k++;for(s=V-1;0<=s;s--)-1==F[s]&&(F[s]=N[--G]);c.setFrame(n,g,F)}e.push(c),i=Math.max(i,c.frames[L-1])}var z=t.readInt(!0);if(0<z){for(c=new H.EventTimeline(z),n=0;n<z;n++){var g=t.readFloat(),U=u.events[t.readInt(!0)],W=new H.Event(g,U);W.intValue=t.readInt(!1),W.floatValue=t.readFloat(),W.stringValue=t.readBoolean()?t.readString():U.stringValue,null!=W.data.audioPath&&(W.volume=t.readFloat(),W.balance=t.readFloat()),c.setFrame(n,W)}e.push(c),i=Math.max(i,c.frames[z-1])}return new H.Animation(h,e,i)},j.prototype.readCurve=function(t,e,i){switch(t.readByte()){case j.CURVE_STEPPED:i.setStepped(e);break;case j.CURVE_BEZIER:this.setCurve(i,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},j.prototype.setCurve=function(t,e,i,n,r,s){t.setCurve(e,i,n,r,s)},j.AttachmentTypeValues=[0,1,2,3,4,5,6],j.TransformModeValues=[H.TransformMode.Normal,H.TransformMode.OnlyTranslation,H.TransformMode.NoRotationOrReflection,H.TransformMode.NoScale,H.TransformMode.NoScaleOrReflection],j.PositionModeValues=[H.PositionMode.Fixed,H.PositionMode.Percent],j.SpacingModeValues=[H.SpacingMode.Length,H.SpacingMode.Fixed,H.SpacingMode.Percent],j.RotateModeValues=[H.RotateMode.Tangent,H.RotateMode.Chain,H.RotateMode.ChainScale],j.BlendModeValues=[H.BlendMode.Normal,H.BlendMode.Additive,H.BlendMode.Multiply,H.BlendMode.Screen],j.BONE_ROTATE=0,j.BONE_TRANSLATE=1,j.BONE_SCALE=2,j.BONE_SHEAR=3,j.SLOT_ATTACHMENT=0,j.SLOT_COLOR=1,j.SLOT_TWO_COLOR=2,j.PATH_POSITION=0,j.PATH_SPACING=1,j.PATH_MIX=2,j.CURVE_LINEAR=0,j.CURVE_STEPPED=1,j.CURVE_BEZIER=2,j);function j(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}H.SkeletonBinary=e,N.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},N.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},N.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},N.prototype.readInt=function(t){var e=this.readByte(),i=127&e;return 0!=(128&e)&&(i|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(i|=(127&this.readByte())<<28)))),t?i:i>>>1^-(1&i)},N.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},N.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",i=0;i<t;){var n=this.readByte();switch(n>>4){case 12:case 13:e+=String.fromCharCode((31&n)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&n)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(n),i++}}return e},N.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},N.prototype.readBoolean=function(){return 0!=this.readByte()};var F=N;function N(t,e,i,n){void 0===e&&(e=new Array),void 0===i&&(i=0),void 0===n&&(n=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=n}var k=function(t,e,i,n,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n,this.inheritDeform=r},G=function(t,e){void 0===e&&(e=null),this.bones=t=void 0===t?null:t,this.vertices=e};function i(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}!function(u){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new u.Pool(function(){return u.Utils.newFloatArray(16)})}t.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,n=this.polygons,r=this.polygonPool,s=t.slots,h=s.length;i.length=0,r.freeAll(n);for(var o=n.length=0;o<h;o++){var a,c,l=s[o];l.bone.active&&((a=l.getAttachment())instanceof u.BoundingBoxAttachment&&(i.push(a=a),(c=r.obtain()).length!=a.worldVerticesLength&&(c=u.Utils.newFloatArray(a.worldVerticesLength)),n.push(c),a.computeWorldVertices(l,0,a.worldVerticesLength,c,0,2)))}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=this.polygons,s=0,h=r.length;s<h;s++)for(var o=r[s],a=o,c=0,u=o.length;c<u;c+=2)var l=a[c],_=a[c+1],t=Math.min(t,l),e=Math.min(e,_),i=Math.max(i,l),n=Math.max(n,_);this.minX=t,this.minY=e,this.maxX=i,this.maxY=n},t.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},t.prototype.aabbIntersectsSegment=function(t,e,i,n){var r=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(t<=r&&i<=r||e<=s&&n<=s||o<=t&&o<=i||a<=e&&a<=n)return!1;n=(n-e)/(i-t),i=n*(r-t)+e;if(s<i&&i<a)return!0;if(s<(i=n*(o-t)+e)&&i<a)return!0;i=(s-e)/n+t;return r<i&&i<o||r<(i=(a-e)/n+t)&&i<o},t.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},t.prototype.containsPoint=function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.containsPointPolygon(i[n],t,e))return this.boundingBoxes[n];return null},t.prototype.containsPointPolygon=function(t,h,e){for(var i=t,n=t.length,r=n-2,s=!1,o=0;o<n;o+=2){var a,c=i[o+1],l=i[r+1];!(c<e&&e<=l||l<e&&e<=c)||(a=i[o])+(e-c)/(l-c)*(i[r]-a)<h&&(s=!s),r=o}return s},t.prototype.intersectsSegment=function(t,e,i,n){for(var r=this.polygons,s=0,o=r.length;s<o;s++)if(this.intersectsSegmentPolygon(r[s],t,e,i,n))return this.boundingBoxes[s];return null},t.prototype.intersectsSegmentPolygon=function(h,t,e,i,n){for(var r=h,u=h.length,_=t-i,d=e-n,f=t*n-e*i,s=r[u-2],o=r[u-1],p=0;p<u;p+=2){var a=r[p],c=r[p+1],m=s*c-o*a,l=s-a,y=o-c,g=_*y-d*l,l=(f*l-_*m)/g;if((s<=l&&l<=a||a<=l&&l<=s)&&(t<=l&&l<=i||i<=l&&l<=t)){l=(f*y-d*m)/g;if((o<=l&&l<=c||c<=l&&l<=o)&&(e<=l&&l<=n||n<=l&&l<=e))return!0}s=a,o=c}return!1},t.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");t=this.boundingBoxes.indexOf(t);return-1==t?null:this.polygons[t]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},u.SkeletonBounds=t}(t=t||{}),function(Q){function c(){this.triangulator=new Q.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}c.prototype.clipStart=function(t,e){if(null!=this.clipAttachment)return 0;for(var i=(this.clipAttachment=e).worldVerticesLength,n=Q.Utils.setArraySize(this.clippingPolygon,i),e=(e.computeWorldVertices(t,0,i,n,0,2),this.clippingPolygon),r=(c.makeClockwise(e),this.clippingPolygons=this.triangulator.decompose(e,this.triangulator.triangulate(e))),s=0,o=r.length;s<o;s++){var a=r[s];c.makeClockwise(a),a.push(a[0]),a.push(a[1])}return r.length},c.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},c.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},c.prototype.isClipping=function(){return null!=this.clipAttachment},c.prototype.clipTriangles=function(t,h,u,_,e,i,n,d,f,p,m,y){var g=this.clipOutput,v=this.clippedVertices,x=this.clippedTriangles,b=this.clippingPolygons,A=this.clippingPolygons.length,C=d?12:8,r=0;p=p||0,m=m||0,y=y||0,v.length=0,x.length=0;t:for(var S=p,T=p+_;S<T;S+=3)for(var w=u[S]*f,E=w+m,M=w+y,I=t[E],B=t[E+1],R=e[M],P=e[M+1],D=t[E=(w=u[S+1]*f)+m],L=t[E+1],V=e[M=w+y],O=e[M+1],F=t[E=(w=u[S+2]*f)+m],s=t[E+1],N=e[M=w+y],k=e[M+1],G=0;G<A;G++){var o=v.length;if(!this.clip(I,B,D,L,F,s,b[G],g)){(a=Q.Utils.setArraySize(v,o+3*C))[o]=I,a[o+1]=B,a[o+2]=i.r,a[o+3]=i.g,a[o+4]=i.b,a[o+5]=i.a,d?(a[o+6]=R,a[o+7]=P,a[o+8]=n.r,a[o+9]=n.g,a[o+10]=n.b,a[o+11]=n.a,a[o+12]=D,a[o+13]=L,a[o+14]=i.r,a[o+15]=i.g,a[o+16]=i.b,a[o+17]=i.a,a[o+18]=V,a[o+19]=O,a[o+20]=n.r,a[o+21]=n.g,a[o+22]=n.b,a[o+23]=n.a,a[o+24]=F,a[o+25]=s,a[o+26]=i.r,a[o+27]=i.g,a[o+28]=i.b,a[o+29]=i.a,a[o+30]=N,a[o+31]=k,a[o+32]=n.r,a[o+33]=n.g,a[o+34]=n.b,a[o+35]=n.a):(a[o+6]=R,a[o+7]=P,a[o+8]=D,a[o+9]=L,a[o+10]=i.r,a[o+11]=i.g,a[o+12]=i.b,a[o+13]=i.a,a[o+14]=V,a[o+15]=O,a[o+16]=F,a[o+17]=s,a[o+18]=i.r,a[o+19]=i.g,a[o+20]=i.b,a[o+21]=i.a,a[o+22]=N,a[o+23]=k),o=x.length,(K=Q.Utils.setArraySize(x,o+3))[o]=r,K[o+1]=r+1,K[o+2]=r+2,r+=3;continue t}var z=g.length;if(0!=z){for(var U=L-s,W=F-D,H=I-F,j=s-B,X=1/(U*H+W*(B-s)),Y=z>>1,q=this.clipOutput,a=Q.Utils.setArraySize(v,o+Y*C),c=0;c<z;c+=2){var l=q[c],J=q[c+1],l=(a[o]=l,a[o+1]=J,a[o+2]=i.r,a[o+3]=i.g,a[o+4]=i.b,a[o+5]=i.a,l-F),J=J-s,Z=(U*l+W*J)*X,l=(j*l+H*J)*X,J=1-Z-l;a[o+6]=R*Z+V*l+N*J,a[o+7]=P*Z+O*l+k*J,d&&(a[o+8]=n.r,a[o+9]=n.g,a[o+10]=n.b,a[o+11]=n.a),o+=C}var o=x.length,K=Q.Utils.setArraySize(x,o+3*(Y-2));Y--;for(c=1;c<Y;c++)K[o]=r,K[o+1]=r+c,K[o+2]=r+c+1,o+=3;r+=1+Y}}},c.prototype.clip=function(h,u,_,d,f,p,m,t){for(var e=t,y=!1,i=null,g=(2<=m.length%4?(i=t,t=this.scratch):i=this.scratch,i.length=0,i.push(h),i.push(u),i.push(_),i.push(d),i.push(f),i.push(p),i.push(h),i.push(u),t.length=0,m),v=m.length-4,n=0;;n+=2){for(var r=g[n],s=g[n+1],o=g[n+2],a=g[n+3],x=r-o,b=s-a,A=i,C=i.length-2,S=t.length,c=0;c<C;c+=2){var l=A[c],T=A[c+1],w=A[c+2],E=A[c+3],M=0<x*(E-a)-b*(w-o);if(0<x*(T-a)-b*(l-o)){if(M){t.push(w),t.push(E);continue}var I,B,R,P=(I=E-T)*(o-r)-(B=w-l)*(a-s);1e-6<Math.abs(P)?(t.push(r+(o-r)*(R=(B*(s-T)-I*(r-l))/P)),t.push(s+(a-s)*R)):(t.push(r),t.push(s))}else M&&(P=(I=E-T)*(o-r)-(B=w-l)*(a-s),1e-6<Math.abs(P)?(t.push(r+(o-r)*(R=(B*(s-T)-I*(r-l))/P)),t.push(s+(a-s)*R)):(t.push(r),t.push(s)),t.push(w),t.push(E));y=!0}if(S==t.length)return!(e.length=0);if(t.push(t[0]),t.push(t[1]),n==v)break;S=t;(t=i).length=0,i=S}if(e!=t)for(var n=e.length=0,D=t.length-2;n<D;n++)e[n]=t[n];else e.length=e.length-2;return y},c.makeClockwise=function(t){for(var e,i,n,r=t,t=t.length,s=r[t-2]*r[1]-r[0]*r[t-1],o=0,a=t-3;o<a;o+=2)e=r[o],i=r[o+1],n=r[o+2],s+=e*r[o+3]-n*i;if(!(s<0))for(var o=0,c=t-2,a=t>>1;o<a;o+=2){var h=r[o],u=r[o+1],l=c-o;r[o]=r[l],r[o+1]=r[1+l],r[l]=h,r[1+l]=u}},Q.SkeletonClipping=c}(t=t||{}),function(t){function e(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},e.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},e.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.SkeletonData=e}(t=t||{}),function(et){function L(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}L.prototype.readSkeletonData=function(t){var h=this.scale,e=new et.SkeletonData,i="string"==typeof t?JSON.parse(t):t,t=i.skeleton;if(null!=t&&(e.hash=t.hash,e.version=t.spine,e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e.fps=t.fps,e.imagesPath=t.images),i.bones)for(var n=0;n<i.bones.length;n++){var r=i.bones[n],u=null,_=this.getValue(r,"parent",null);if(null!=_&&null==(u=e.findBone(_)))throw new Error("Parent bone not found: "+_);(o=new et.BoneData(e.bones.length,r.name,u)).length=this.getValue(r,"length",0)*h,o.x=this.getValue(r,"x",0)*h,o.y=this.getValue(r,"y",0)*h,o.rotation=this.getValue(r,"rotation",0),o.scaleX=this.getValue(r,"scaleX",1),o.scaleY=this.getValue(r,"scaleY",1),o.shearX=this.getValue(r,"shearX",0),o.shearY=this.getValue(r,"shearY",0),o.transformMode=L.transformModeFromString(this.getValue(r,"transform","normal")),o.skinRequired=this.getValue(r,"skin",!1),e.bones.push(o)}if(i.slots)for(n=0;n<i.slots.length;n++){var d=(C=i.slots[n]).name,s=C.bone,f=e.findBone(s);if(null==f)throw new Error("Slot bone not found: "+s);var o=new et.SlotData(e.slots.length,d,f),f=this.getValue(C,"color",null),f=(null!=f&&o.color.setFromString(f),this.getValue(C,"dark",null));null!=f&&(o.darkColor=new et.Color(1,1,1,1),o.darkColor.setFromString(f)),o.attachmentName=this.getValue(C,"attachment",null),o.blendMode=L.blendModeFromString(this.getValue(C,"blend","normal")),e.slots.push(o)}if(i.ik)for(n=0;n<i.ik.length;n++){var a=i.ik[n];(o=new et.IkConstraintData(a.name)).order=this.getValue(a,"order",0),o.skinRequired=this.getValue(a,"skin",!1);for(var p=0;p<a.bones.length;p++){s=a.bones[p];if(null==(x=e.findBone(s)))throw new Error("IK bone not found: "+s);o.bones.push(x)}var m=a.target;if(o.target=e.findBone(m),null==o.target)throw new Error("IK target bone not found: "+m);o.mix=this.getValue(a,"mix",1),o.softness=this.getValue(a,"softness",0)*h,o.bendDirection=this.getValue(a,"bendPositive",!0)?1:-1,o.compress=this.getValue(a,"compress",!1),o.stretch=this.getValue(a,"stretch",!1),o.uniform=this.getValue(a,"uniform",!1),e.ikConstraints.push(o)}if(i.transform)for(n=0;n<i.transform.length;n++){a=i.transform[n];(o=new et.TransformConstraintData(a.name)).order=this.getValue(a,"order",0),o.skinRequired=this.getValue(a,"skin",!1);for(p=0;p<a.bones.length;p++){s=a.bones[p];if(null==(x=e.findBone(s)))throw new Error("Transform constraint bone not found: "+s);o.bones.push(x)}m=a.target;if(o.target=e.findBone(m),null==o.target)throw new Error("Transform constraint target bone not found: "+m);o.local=this.getValue(a,"local",!1),o.relative=this.getValue(a,"relative",!1),o.offsetRotation=this.getValue(a,"rotation",0),o.offsetX=this.getValue(a,"x",0)*h,o.offsetY=this.getValue(a,"y",0)*h,o.offsetScaleX=this.getValue(a,"scaleX",0),o.offsetScaleY=this.getValue(a,"scaleY",0),o.offsetShearY=this.getValue(a,"shearY",0),o.rotateMix=this.getValue(a,"rotateMix",1),o.translateMix=this.getValue(a,"translateMix",1),o.scaleMix=this.getValue(a,"scaleMix",1),o.shearMix=this.getValue(a,"shearMix",1),e.transformConstraints.push(o)}if(i.path)for(n=0;n<i.path.length;n++){a=i.path[n];(o=new et.PathConstraintData(a.name)).order=this.getValue(a,"order",0),o.skinRequired=this.getValue(a,"skin",!1);for(p=0;p<a.bones.length;p++){s=a.bones[p];if(null==(x=e.findBone(s)))throw new Error("Transform constraint bone not found: "+s);o.bones.push(x)}m=a.target;if(o.target=e.findSlot(m),null==o.target)throw new Error("Path target slot not found: "+m);o.positionMode=L.positionModeFromString(this.getValue(a,"positionMode","percent")),o.spacingMode=L.spacingModeFromString(this.getValue(a,"spacingMode","length")),o.rotateMode=L.rotateModeFromString(this.getValue(a,"rotateMode","tangent")),o.offsetRotation=this.getValue(a,"rotation",0),o.position=this.getValue(a,"position",0),o.positionMode==et.PositionMode.Fixed&&(o.position*=h),o.spacing=this.getValue(a,"spacing",0),o.spacingMode!=et.SpacingMode.Length&&o.spacingMode!=et.SpacingMode.Fixed||(o.spacing*=h),o.rotateMix=this.getValue(a,"rotateMix",1),o.translateMix=this.getValue(a,"translateMix",1),e.pathConstraints.push(o)}if(i.skins){var y=i.skins;if(!(y instanceof Array)){var g,v=[];for(g in y)v.push({name:g,attachments:y[g]});y=v}for(n=0;n<y.length;n++){var x,b,c=y[n],A=new et.Skin(c.name);if(c.bones)for(var l=0;l<c.bones.length;l++){if(null==(x=e.findBone(c.bones[l])))throw new Error("Skin bone not found: "+c.bones[n]);A.bones.push(x)}if(c.ik)for(l=0;l<c.ik.length;l++){if(null==(b=e.findIkConstraint(c.ik[l])))throw new Error("Skin IK constraint not found: "+c.ik[n]);A.constraints.push(b)}if(c.transform)for(l=0;l<c.transform.length;l++){if(null==(b=e.findTransformConstraint(c.transform[l])))throw new Error("Skin transform constraint not found: "+c.transform[n]);A.constraints.push(b)}if(c.path)for(l=0;l<c.path.length;l++){if(null==(b=e.findPathConstraint(c.path[l])))throw new Error("Skin path constraint not found: "+c.path[n]);A.constraints.push(b)}for(d in c.attachments){var C,S,T=e.findSlot(d);if(null==T)throw new Error("Slot not found: "+d);for(S in C=c.attachments[d]){var w=this.readAttachment(C[S],A,T.index,S,e);null!=w&&A.setAttachment(T.index,S,w)}}e.skins.push(A),"default"==A.name&&(e.defaultSkin=A)}}for(var n=0,E=this.linkedMeshes.length;n<E;n++){var M=this.linkedMeshes[n];if(null==(A=null==M.skin?e.defaultSkin:e.findSkin(M.skin)))throw new Error("Skin not found: "+M.skin);var I=A.getAttachment(M.slotIndex,M.parent);if(null==I)throw new Error("Parent mesh not found: "+M.parent);M.mesh.deformAttachment=M.inheritDeform?I:M.mesh,M.mesh.setParentMesh(I),M.mesh.updateUVs()}if(this.linkedMeshes.length=0,i.events)for(var B in i.events){var R=i.events[B];(o=new et.EventData(B)).intValue=this.getValue(R,"int",0),o.floatValue=this.getValue(R,"float",0),o.stringValue=this.getValue(R,"string",""),o.audioPath=this.getValue(R,"audio",null),null!=o.audioPath&&(o.volume=this.getValue(R,"volume",1),o.balance=this.getValue(R,"balance",0)),e.events.push(o)}if(i.animations)for(var P in i.animations){var D=i.animations[P];this.readAnimation(D,P,e)}return e},L.prototype.readAttachment=function(t,e,h,i,u){var n=this.scale;switch(i=this.getValue(t,"name",i),this.getValue(t,"type","region")){case"region":var r=this.getValue(t,"path",i),s=this.attachmentLoader.newRegionAttachment(e,i,r);return null==s?null:(s.path=r,s.x=this.getValue(t,"x",0)*n,s.y=this.getValue(t,"y",0)*n,s.scaleX=this.getValue(t,"scaleX",1),s.scaleY=this.getValue(t,"scaleY",1),s.rotation=this.getValue(t,"rotation",0),s.width=t.width*n,s.height=t.height*n,null!=(l=this.getValue(t,"color",null))&&s.color.setFromString(l),s.updateOffset(),s);case"boundingbox":s=this.attachmentLoader.newBoundingBoxAttachment(e,i);return null==s?null:(this.readVertices(t,s,t.vertexCount<<1),null!=(l=this.getValue(t,"color",null))&&s.color.setFromString(l),s);case"mesh":case"linkedmesh":var r=this.getValue(t,"path",i),s=this.attachmentLoader.newMeshAttachment(e,i,r);if(null==s)return null;s.path=r;null!=(l=this.getValue(t,"color",null))&&s.color.setFromString(l),s.width=this.getValue(t,"width",0)*n,s.height=this.getValue(t,"height",0)*n;var o=this.getValue(t,"parent",null);if(null!=o)return this.linkedMeshes.push(new d(s,this.getValue(t,"skin",null),h,o,this.getValue(t,"deform",!0))),s;o=t.uvs;return this.readVertices(t,s,o.length),s.triangles=t.triangles,s.regionUVs=o,s.updateUVs(),s.edges=this.getValue(t,"edges",null),s.hullLength=2*this.getValue(t,"hull",0),s;case"path":if(null==(r=this.attachmentLoader.newPathAttachment(e,i)))return null;r.closed=this.getValue(t,"closed",!1),r.constantSpeed=this.getValue(t,"constantSpeed",!0);for(var a=t.vertexCount,_=(this.readVertices(t,r,a<<1),et.Utils.newArray(a/3,0)),c=0;c<t.lengths.length;c++)_[c]=t.lengths[c]*n;return r.lengths=_,null!=(l=this.getValue(t,"color",null))&&r.color.setFromString(l),r;case"point":o=this.attachmentLoader.newPointAttachment(e,i);return null==o?null:(o.x=this.getValue(t,"x",0)*n,o.y=this.getValue(t,"y",0)*n,o.rotation=this.getValue(t,"rotation",0),null!=(l=this.getValue(t,"color",null))&&o.color.setFromString(l),o);case"clipping":s=this.attachmentLoader.newClippingAttachment(e,i);if(null==s)return null;r=this.getValue(t,"end",null);if(null!=r){o=u.findSlot(r);if(null==o)throw new Error("Clipping end slot not found: "+r);s.endSlot=o}var l,a=t.vertexCount;return this.readVertices(t,s,a<<1),null!=(l=this.getValue(t,"color",null))&&s.color.setFromString(l),s}return null},L.prototype.readVertices=function(h,t,e){var i=this.scale,n=(t.worldVerticesLength=e,h.vertices);if(e!=n.length){for(var r=new Array,s=new Array,o=0,a=n.length;o<a;){var c=n[o++];s.push(c);for(var u=o+4*c;o<u;o+=4)s.push(n[o]),r.push(n[o+1]*i),r.push(n[o+2]*i),r.push(n[o+3])}t.bones=s,t.vertices=et.Utils.toFloatArray(r)}else{var l=et.Utils.toFloatArray(n);if(1!=i)for(var o=0,a=n.length;o<a;o++)l[o]*=i;t.vertices=l}},L.prototype.readAnimation=function(t,h,e){var u=this.scale,i=new Array,n=0;if(t.slots)for(var _ in t.slots){var d=t.slots[_];if(-1==(Z=e.findSlotIndex(_)))throw new Error("Slot not found: "+_);for(l in d){var r=d[l];if("attachment"==l){(c=new et.AttachmentTimeline(r.length)).slotIndex=Z;for(var s=0,o=0;o<r.length;o++){var a=r[o];c.setFrame(s++,this.getValue(a,"time",0),a.name)}i.push(c),n=Math.max(n,c.frames[c.getFrameCount()-1])}else if("color"==l){for(s=((c=new et.ColorTimeline(r.length)).slotIndex=Z,0),o=0;o<r.length;o++){var a=r[o],f=new et.Color;f.setFromString(a.color),c.setFrame(s,this.getValue(a,"time",0),f.r,f.g,f.b,f.a),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.ColorTimeline.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+_+")");for(s=((c=new et.TwoColorTimeline(r.length)).slotIndex=Z,0),o=0;o<r.length;o++){var a=r[o],p=new et.Color,m=new et.Color;p.setFromString(a.light),m.setFromString(a.dark),c.setFrame(s,this.getValue(a,"time",0),p.r,p.g,p.b,p.a,m.r,m.g,m.b),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.TwoColorTimeline.ENTRIES])}}}if(t.bones)for(var y in t.bones){var g=t.bones[y],v=e.findBoneIndex(y);if(-1==v)throw new Error("Bone not found: "+y);for(l in g){r=g[l];if("rotate"===l){for(s=((c=new et.RotateTimeline(r.length)).boneIndex=v,0),o=0;o<r.length;o++){a=r[o];c.setFrame(s,this.getValue(a,"time",0),this.getValue(a,"angle",0)),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.RotateTimeline.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw new Error("Invalid timeline type for a bone: "+l+" ("+y+")");for(var c=null,x=1,b=0,s=("scale"===l?(c=new et.ScaleTimeline(r.length),b=1):"shear"===l?c=new et.ShearTimeline(r.length):(c=new et.TranslateTimeline(r.length),x=u),c.boneIndex=v,0),o=0;o<r.length;o++){var a=r[o],A=this.getValue(a,"x",b),C=this.getValue(a,"y",b);c.setFrame(s,this.getValue(a,"time",0),A*x,C*x),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.TranslateTimeline.ENTRIES])}}}if(t.ik)for(var S in t.ik){for(var T=t.ik[S],w=e.findIkConstraint(S),s=((c=new et.IkConstraintTimeline(T.length)).ikConstraintIndex=e.ikConstraints.indexOf(w),0),o=0;o<T.length;o++){a=T[o];c.setFrame(s,this.getValue(a,"time",0),this.getValue(a,"mix",1),this.getValue(a,"softness",0)*u,this.getValue(a,"bendPositive",!0)?1:-1,this.getValue(a,"compress",!1),this.getValue(a,"stretch",!1)),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.IkConstraintTimeline.ENTRIES])}if(t.transform)for(var S in t.transform){for(T=t.transform[S],w=e.findTransformConstraint(S),s=((c=new et.TransformConstraintTimeline(T.length)).transformConstraintIndex=e.transformConstraints.indexOf(w),0),o=0;o<T.length;o++){a=T[o];c.setFrame(s,this.getValue(a,"time",0),this.getValue(a,"rotateMix",1),this.getValue(a,"translateMix",1),this.getValue(a,"scaleMix",1),this.getValue(a,"shearMix",1)),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.TransformConstraintTimeline.ENTRIES])}var E=t.path||t.paths;if(E)for(var S in E){var T=E[S],M=e.findPathConstraintIndex(S);if(-1==M)throw new Error("Path constraint not found: "+S);var I=e.pathConstraints[M];for(l in T){r=T[l];if("position"===l||"spacing"===l){for(c=null,x=1,s=("spacing"===l?(c=new et.PathConstraintSpacingTimeline(r.length),I.spacingMode!=et.SpacingMode.Length&&I.spacingMode!=et.SpacingMode.Fixed||(x=u)):(c=new et.PathConstraintPositionTimeline(r.length),I.positionMode==et.PositionMode.Fixed&&(x=u)),c.pathConstraintIndex=M,0),o=0;o<r.length;o++){a=r[o];c.setFrame(s,this.getValue(a,"time",0),this.getValue(a,l,0)*x),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===l){for(s=((c=new et.PathConstraintMixTimeline(r.length)).pathConstraintIndex=M,0),o=0;o<r.length;o++){a=r[o];c.setFrame(s,this.getValue(a,"time",0),this.getValue(a,"rotateMix",1),this.getValue(a,"translateMix",1)),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[(c.getFrameCount()-1)*et.PathConstraintMixTimeline.ENTRIES])}}}if(t.deform)for(var B in t.deform){var R=t.deform[B],P=e.findSkin(B);if(null==P)throw new Error("Skin not found: "+B);for(_ in R){var l,d=R[_];if(-1==(Z=e.findSlotIndex(_)))throw new Error("Slot not found: "+d.name);for(l in d){var r=d[l],D=P.getAttachment(Z,l);if(null!=D){for(var L=null!=D.bones,V=D.vertices,O=L?V.length/3*2:V.length,s=((c=new et.DeformTimeline(r.length)).slotIndex=Z,c.attachment=D,0),F=0;F<r.length;F++){var a=r[F],N=void 0,k=this.getValue(a,"vertices",null);if(null==k)N=L?et.Utils.newFloatArray(O):V;else{var N=et.Utils.newFloatArray(O),G=this.getValue(a,"offset",0);if(et.Utils.arrayCopy(k,0,N,G,k.length),1!=u)for(var z=(o=G)+k.length;o<z;o++)N[o]*=u;if(!L)for(o=0;o<O;o++)N[o]+=V[o]}c.setFrame(s,this.getValue(a,"time",0),N),this.readCurve(a,c,s),s++}i.push(c),n=Math.max(n,c.frames[c.getFrameCount()-1])}}}}var U=t.drawOrder;if(null!=(U=null==U?t.draworder:U)){for(var c=new et.DrawOrderTimeline(U.length),W=e.slots.length,s=0,F=0;F<U.length;F++){var H=U[F],j=null,X=this.getValue(H,"offsets",null);if(null!=X){for(var j=et.Utils.newArray(W,-1),Y=et.Utils.newArray(W-X.length,0),q=0,J=0,o=0;o<X.length;o++){var Z,K=X[o];if(-1==(Z=e.findSlotIndex(K.slot)))throw new Error("Slot not found: "+K.slot);for(;q!=Z;)Y[J++]=q++;j[q+K.offset]=q++}for(;q<W;)Y[J++]=q++;for(o=W-1;0<=o;o--)-1==j[o]&&(j[o]=Y[--J])}c.setFrame(s++,this.getValue(H,"time",0),j)}i.push(c),n=Math.max(n,c.frames[c.getFrameCount()-1])}if(t.events){for(c=new et.EventTimeline(t.events.length),s=0,o=0;o<t.events.length;o++){var Q=t.events[o],$=e.findEvent(Q.name);if(null==$)throw new Error("Event not found: "+Q.name);var tt=new et.Event(et.Utils.toSinglePrecision(this.getValue(Q,"time",0)),$);tt.intValue=this.getValue(Q,"int",$.intValue),tt.floatValue=this.getValue(Q,"float",$.floatValue),tt.stringValue=this.getValue(Q,"string",$.stringValue),null!=tt.data.audioPath&&(tt.volume=this.getValue(Q,"volume",1),tt.balance=this.getValue(Q,"balance",0)),c.setFrame(s++,tt)}i.push(c),n=Math.max(n,c.frames[c.getFrameCount()-1])}if(isNaN(n))throw new Error("Error while parsing animation, duration is NaN");e.animations.push(new et.Animation(h,i,n))},L.prototype.readCurve=function(t,e,i){var n=t.curve;n&&("stepped"==n?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(n)?e.setCurve(i,n[0],n[1],n[2],n[3]):e.setCurve(i,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},L.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},L.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return et.BlendMode.Normal;if("additive"==t)return et.BlendMode.Additive;if("multiply"==t)return et.BlendMode.Multiply;if("screen"==t)return et.BlendMode.Screen;throw new Error("Unknown blend mode: "+t)},L.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return et.PositionMode.Fixed;if("percent"==t)return et.PositionMode.Percent;throw new Error("Unknown position mode: "+t)},L.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return et.SpacingMode.Length;if("fixed"==t)return et.SpacingMode.Fixed;if("percent"==t)return et.SpacingMode.Percent;throw new Error("Unknown position mode: "+t)},L.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return et.RotateMode.Tangent;if("chain"==t)return et.RotateMode.Chain;if("chainscale"==t)return et.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+t)},L.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return et.TransformMode.Normal;if("onlytranslation"==t)return et.TransformMode.OnlyTranslation;if("norotationorreflection"==t)return et.TransformMode.NoRotationOrReflection;if("noscale"==t)return et.TransformMode.NoScale;if("noscaleorreflection"==t)return et.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t)},et.SkeletonJson=L;var d=function(t,e,i,n,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n,this.inheritDeform=r}}(t=t||{}),p=t=t||{},m=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i},p.SkinEntry=m,i.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=i},i.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==i){n=!0;break}n||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){for(var s=t.constraints[e],n=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==s){n=!0;break}n||this.constraints.push(s)}for(var o=t.getAttachments(),e=0;e<o.length;e++){var a=o[e];this.setAttachment(a.slotIndex,a.name,a.attachment)}},i.prototype.copySkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==i){n=!0;break}n||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){for(var s=t.constraints[e],n=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==s){n=!0;break}n||this.constraints.push(s)}for(var o=t.getAttachments(),e=0;e<o.length;e++){var a=o[e];null!=a.attachment&&(a.attachment instanceof p.MeshAttachment?a.attachment=a.attachment.newLinkedMesh():a.attachment=a.attachment.copy(),this.setAttachment(a.slotIndex,a.name,a.attachment))}},i.prototype.getAttachment=function(t,e){t=this.attachments[t];return t?t[e]:null},i.prototype.removeAttachment=function(t,e){t=this.attachments[t];t&&(t[e]=null)},i.prototype.getAttachments=function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var i=this.attachments[e];if(i)for(var n in i){var r=i[n];r&&t.push(new m(e,n,r))}}return t},i.prototype.getAttachmentsForSlot=function(t,e){var i=this.attachments[t];if(i)for(var n in i){var r=i[n];r&&e.push(new m(t,n,r))}},i.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},i.prototype.attachAll=function(t,e){for(var i=0,n=0;n<t.slots.length;n++){var r=t.slots[n],s=r.getAttachment();if(s&&i<e.attachments.length){var o,a=e.attachments[i];for(o in a)if(s==a[o]){var c=this.getAttachment(i,o);null!=c&&r.setAttachment(c);break}}i++}},p.Skin=i,function(i){function t(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new i.Color,this.darkColor=null==t.darkColor?null:new i.Color,this.setToSetupPose()}t.prototype.getSkeleton=function(){return this.bone.skeleton},t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},t.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},i.Slot=t}(t=t||{}),(y=t=t||{}).SlotData=function(t,e,i){if(this.color=new y.Color(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=i};var n=t=t||{};W.prototype.getImage=function(){return this._image},W.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return z.Nearest;case"linear":return z.Linear;case"mipmap":return z.MipMap;case"mipmapnearestnearest":return z.MipMapNearestNearest;case"mipmaplinearnearest":return z.MipMapLinearNearest;case"mipmapnearestlinear":return z.MipMapNearestLinear;case"mipmaplinearlinear":return z.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},W.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return U.MirroredRepeat;case"clamptoedge":return U.ClampToEdge;case"repeat":return U.Repeat;default:throw new Error("Unknown texture wrap "+t)}};var z,U,e=W;function W(t){this._image=t}n.Texture=e,(r=z=n.TextureFilter||(n.TextureFilter={}))[r.Nearest=9728]="Nearest",r[r.Linear=9729]="Linear",r[r.MipMap=9987]="MipMap",r[r.MipMapNearestNearest=9984]="MipMapNearestNearest",r[r.MipMapLinearNearest=9985]="MipMapLinearNearest",r[r.MipMapNearestLinear=9986]="MipMapNearestLinear",r[r.MipMapLinearLinear=9987]="MipMapLinearLinear",(r=U=n.TextureWrap||(n.TextureWrap={}))[r.MirroredRepeat=33648]="MirroredRepeat",r[r.ClampToEdge=33071]="ClampToEdge",r[r.Repeat=10497]="Repeat",n.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0},V(Y,X=e),Y.prototype.setFilters=function(t,e){},Y.prototype.setWraps=function(t,e){},Y.prototype.dispose=function(){};var X,r=Y;function Y(){return null!==X&&X.apply(this,arguments)||this}function q(t){t=g.call(this,t,0,!1)||this;return t.bones=new Array,t.rotateMix=0,t.translateMix=0,t.scaleMix=0,t.shearMix=0,t.offsetRotation=0,t.offsetX=0,t.offsetY=0,t.offsetScaleX=0,t.offsetScaleY=0,t.offsetShearY=0,t.relative=!1,t.local=!1,t}function J(t){if(null==t)throw new Error("name cannot be null.");this.name=t}function Z(t){t=b.call(this,t)||this;return t.id=(65535&Z.nextID++)<<11,t.worldVerticesLength=0,t.deformAttachment=t}function K(t){t=C.call(this,t)||this;return t.color=new A.Color(1,1,1,1),t}function Q(t){t=T.call(this,t)||this;return t.color=new S.Color(.2275,.2275,.8078,1),t}function $(t){t=w.call(this,t)||this;return t.color=new u.Color(1,1,1,1),t.tempColor=new u.Color(0,0,0,0),t}function tt(t){t=M.call(this,t)||this;return t.closed=!1,t.constantSpeed=!1,t.color=new E.Color(1,1,1,1),t}function et(t){t=B.call(this,t)||this;return t.color=new I.Color(.38,.94,0,1),t}function _(t){t=P.call(this,t)||this;return t.x=0,t.y=0,t.scaleX=1,t.scaleY=1,t.rotation=0,t.width=0,t.height=0,t.color=new R.Color(1,1,1,1),t.offset=R.Utils.newFloatArray(8),t.uvs=R.Utils.newFloatArray(8),t.tempColor=new R.Color(1,1,1,1),t}function it(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}n.FakeTexture=r,function(u){function t(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}t.prototype.load=function(h,t){if(null==t)throw new Error("textureLoader cannot be null.");for(var e=new _(h),i=new Array(4),n=null;;){var r,s,o,a,c,l=e.readLine();if(null==l)break;0==(l=l.trim()).length?n=null:n?((r=new f).name=l,r.page=n,"true"==(c=e.readValue()).toLocaleLowerCase()?r.degrees=90:"false"==c.toLocaleLowerCase()?r.degrees=0:r.degrees=parseFloat(c),r.rotate=90==r.degrees,e.readTuple(i),c=parseInt(i[0]),s=parseInt(i[1]),e.readTuple(i),o=parseInt(i[0]),a=parseInt(i[1]),r.u=c/n.width,r.v=s/n.height,r.rotate?(r.u2=(c+a)/n.width,r.v2=(s+o)/n.height):(r.u2=(c+o)/n.width,r.v2=(s+a)/n.height),r.x=c,r.y=s,r.width=Math.abs(o),r.height=Math.abs(a),4==e.readTuple(i)&&4==e.readTuple(i)&&e.readTuple(i),r.originalWidth=parseInt(i[0]),r.originalHeight=parseInt(i[1]),e.readTuple(i),r.offsetX=parseInt(i[0]),r.offsetY=parseInt(i[1]),r.index=parseInt(e.readValue()),r.texture=n.texture,this.regions.push(r)):((n=new d).name=l,2==e.readTuple(i)&&(n.width=parseInt(i[0]),n.height=parseInt(i[1]),e.readTuple(i)),e.readTuple(i),n.minFilter=u.Texture.filterFromString(i[0]),n.magFilter=u.Texture.filterFromString(i[1]),c=e.readValue(),n.uWrap=u.TextureWrap.ClampToEdge,n.vWrap=u.TextureWrap.ClampToEdge,"x"==c?n.uWrap=u.TextureWrap.Repeat:"y"==c?n.vWrap=u.TextureWrap.Repeat:"xy"==c&&(n.uWrap=n.vWrap=u.TextureWrap.Repeat),n.texture=t(l),n.texture.setFilters(n.minFilter,n.magFilter),n.texture.setWraps(n.uWrap,n.vWrap),n.width=n.texture.getImage().width,n.height=n.texture.getImage().height,this.pages.push(n))}},t.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},t.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},u.TextureAtlas=t;e.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},e.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},e.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var n=0,r=i+1;n<3;n++){var s=e.indexOf(",",r);if(-1==s)break;t[n]=e.substr(r,s-r).trim(),r=s+1}return t[n]=e.substring(r).trim(),n+1};var _=e;function e(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}var i,d=function(){},f=(u.TextureAtlasPage=d,i=u.TextureRegion,V(n,i),n);function n(){return null!==i&&i.apply(this,arguments)||this}u.TextureAtlasRegion=f}(t=t||{}),function(T){function t(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new T.Vector2,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},t.prototype.applyAbsoluteWorld=function(){for(var h=this.rotateMix,u=this.translateMix,_=this.scaleMix,d=this.shearMix,t=this.target,e=t.a,f=t.b,p=t.c,m=t.d,y=0<e*m-f*p?T.MathUtils.degRad:-T.MathUtils.degRad,g=this.data.offsetRotation*y,v=this.data.offsetShearY*y,x=this.bones,b=0,A=x.length;b<A;b++){var C,i,n,r,s,o,a,c,l=x[b],S=!1;0!=h&&(i=l.a,r=l.b,n=l.c,s=l.d,(a=Math.atan2(p,e)-Math.atan2(n,i)+g)>T.MathUtils.PI?a-=T.MathUtils.PI2:a<-T.MathUtils.PI&&(a+=T.MathUtils.PI2),a*=h,C=Math.cos(a),o=Math.sin(a),l.a=C*i-o*n,l.b=C*r-o*s,l.c=o*i+C*n,l.d=o*r+C*s,S=!0),0!=u&&(i=this.temp,t.localToWorld(i.set(this.data.offsetX,this.data.offsetY)),l.worldX+=(i.x-l.worldX)*u,l.worldY+=(i.y-l.worldY)*u,S=!0),0<_&&(c=Math.sqrt(l.a*l.a+l.c*l.c),n=Math.sqrt(e*e+p*p),1e-5<c&&(c=(c+(n-c+this.data.offsetScaleX)*_)/c),l.a*=c,l.c*=c,c=Math.sqrt(l.b*l.b+l.d*l.d),n=Math.sqrt(f*f+m*m),1e-5<c&&(c=(c+(n-c+this.data.offsetScaleY)*_)/c),l.b*=c,l.d*=c,S=!0),0<d&&(r=l.b,s=l.d,o=Math.atan2(s,r),(a=Math.atan2(m,f)-Math.atan2(p,e)-(o-Math.atan2(l.c,l.a)))>T.MathUtils.PI?a-=T.MathUtils.PI2:a<-T.MathUtils.PI&&(a+=T.MathUtils.PI2),a=o+(a+v)*d,c=Math.sqrt(r*r+s*s),l.b=Math.cos(a)*c,l.d=Math.sin(a)*c,S=!0),S&&(l.appliedValid=!1)}},t.prototype.applyRelativeWorld=function(){for(var h=this.rotateMix,u=this.translateMix,_=this.scaleMix,d=this.shearMix,t=this.target,e=t.a,f=t.b,i=t.c,p=t.d,m=0<e*p-f*i?T.MathUtils.degRad:-T.MathUtils.degRad,y=this.data.offsetRotation*m,g=this.data.offsetShearY*m,v=this.bones,x=0,b=v.length;x<b;x++){var A,n,C,r,s,o,a,c,l=v[x],S=!1;0!=h&&(r=l.a,o=l.b,A=l.c,a=l.d,(s=Math.atan2(i,e)+y)>T.MathUtils.PI?s-=T.MathUtils.PI2:s<-T.MathUtils.PI&&(s+=T.MathUtils.PI2),s*=h,n=Math.cos(s),C=Math.sin(s),l.a=n*r-C*A,l.b=n*o-C*a,l.c=C*r+n*A,l.d=C*o+n*a,S=!0),0!=u&&(r=this.temp,t.localToWorld(r.set(this.data.offsetX,this.data.offsetY)),l.worldX+=r.x*u,l.worldY+=r.y*u,S=!0),0<_&&(c=(Math.sqrt(e*e+i*i)-1+this.data.offsetScaleX)*_+1,l.a*=c,l.c*=c,c=(Math.sqrt(f*f+p*p)-1+this.data.offsetScaleY)*_+1,l.b*=c,l.d*=c,S=!0),0<d&&((s=Math.atan2(p,f)-Math.atan2(i,e))>T.MathUtils.PI?s-=T.MathUtils.PI2:s<-T.MathUtils.PI&&(s+=T.MathUtils.PI2),o=l.b,a=l.d,s=Math.atan2(a,o)+(s-T.MathUtils.PI/2+g)*d,c=Math.sqrt(o*o+a*a),l.b=Math.cos(s)*c,l.d=Math.sin(s)*c,S=!0),S&&(l.appliedValid=!1)}},t.prototype.applyAbsoluteLocal=function(){for(var h=this.rotateMix,t=this.translateMix,e=this.scaleMix,u=this.shearMix,i=this.target,_=(i.appliedValid||i.updateAppliedTransform(),this.bones),n=0,d=_.length;n<d;n++){var r,s=_[n],o=(s.appliedValid||s.updateAppliedTransform(),s.arotation),a=(0!=h&&(r=i.arotation-o+this.data.offsetRotation,o+=(r-=360*(16384-(16384.499999999996-r/360|0)))*h),s.ax),f=s.ay,c=(0!=t&&(a+=(i.ax-a+this.data.offsetX)*t,f+=(i.ay-f+this.data.offsetY)*t),s.ascaleX),l=s.ascaleY,p=(0!=e&&(1e-5<c&&(c=(c+(i.ascaleX-c+this.data.offsetScaleX)*e)/c),1e-5<l&&(l=(l+(i.ascaleY-l+this.data.offsetScaleY)*e)/l)),s.ashearY);0!=u&&(r=i.ashearY-p+this.data.offsetShearY,r-=360*(16384-(16384.499999999996-r/360|0)),s.shearY+=r*u),s.updateWorldTransformWith(a,f,o,c,l,s.ashearX,p)}},t.prototype.applyRelativeLocal=function(){for(var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target,s=(r.appliedValid||r.updateAppliedTransform(),this.bones),o=0,h=s.length;o<h;o++){var a=s[o],u=(a.appliedValid||a.updateAppliedTransform(),a.arotation),_=(0!=t&&(u+=(r.arotation+this.data.offsetRotation)*t),a.ax),d=a.ay,c=(0!=e&&(_+=(r.ax+this.data.offsetX)*e,d+=(r.ay+this.data.offsetY)*e),a.ascaleX),l=a.ascaleY,f=(0!=i&&(1e-5<c&&(c*=(r.ascaleX-1+this.data.offsetScaleX)*i+1),1e-5<l&&(l*=(r.ascaleY-1+this.data.offsetScaleY)*i+1)),a.ashearY);0!=n&&(f+=(r.ashearY+this.data.offsetShearY)*n),a.updateWorldTransformWith(_,d,u,c,l,a.ashearX,f)}},T.TransformConstraint=t}(t=t||{}),e=t=t||{},g=e.ConstraintData,V(q,g),e.TransformConstraintData=q,function(t){function z(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool(function(){return new Array}),this.polygonIndicesPool=new t.Pool(function(){return new Array})}z.prototype.triangulate=function(h){for(var t=h,e=h.length>>1,i=this.indicesArray,n=i.length=0;n<e;n++)i[n]=n;for(var r=this.isConcaveArray,n=r.length=0,u=e;n<u;++n)r[n]=z.isConcave(n,e,t,i);var s=this.triangles;for(s.length=0;3<e;){for(var o=e-1,n=0,a=1;;){t:if(!r[n]){for(var _=i[o]<<1,d=i[n]<<1,f=i[a]<<1,p=t[_],m=t[1+_],y=t[d],g=t[1+d],v=t[f],x=t[1+f],c=(a+1)%e;c!=o;c=(c+1)%e)if(r[c]){var l=i[c]<<1,b=t[l],l=t[1+l];if(z.positiveArea(v,x,p,m,b,l)&&z.positiveArea(p,m,y,g,b,l)&&z.positiveArea(y,g,v,x,b,l))break t}break}if(0==a){for(;r[n]&&0<--n;);break}o=n,a=((n=a)+1)%e}s.push(i[(e+n-1)%e]),s.push(i[n]),s.push(i[(n+1)%e]),i.splice(n,1),r.splice(n,1);var A=(--e+n-1)%e,C=n==e?0:n;r[A]=z.isConcave(A,e,t,i),r[C]=z.isConcave(C,e,t,i)}return 3==e&&(s.push(i[2]),s.push(i[0]),s.push(i[1])),s},z.prototype.decompose=function(h,u){for(var t=h,e=this.convexPolygons,i=(this.polygonPool.freeAll(e),e.length=0,this.convexPolygonsIndices),n=(this.polygonIndicesPool.freeAll(i),i.length=0,this.polygonIndicesPool.obtain()),r=(n.length=0,this.polygonPool.obtain()),_=-1,d=r.length=0,s=0,f=u.length;s<f;s+=3){var p=u[s]<<1,m=u[s+1]<<1,y=u[s+2]<<1,g=t[p],v=t[1+p],x=t[m],b=t[1+m],o=t[y],a=t[1+y],A=!1;_==p&&(c=r.length-4,M=z.winding(r[c],r[c+1],r[c+2],r[c+3],o,a),I=z.winding(o,a,r[0],r[1],r[2],r[3]),M==d&&I==d&&(r.push(o),r.push(a),n.push(y),A=!0)),A||(0<r.length?(e.push(r),i.push(n)):(this.polygonPool.free(r),this.polygonIndicesPool.free(n)),(r=this.polygonPool.obtain()).length=0,r.push(g),r.push(v),r.push(x),r.push(b),r.push(o),r.push(a),(n=this.polygonIndicesPool.obtain()).length=0,n.push(p),n.push(m),n.push(y),d=z.winding(g,v,x,b,o,a),_=p)}0<r.length&&(e.push(r),i.push(n));for(s=0,f=e.length;s<f;s++)if(0!=(n=i[s]).length)for(var c,C,S,T,w,E,M,I,B=n[0],R=n[n.length-1],P=(r=e[s])[c=r.length-4],D=r[c+1],L=r[c+2],V=r[c+3],O=r[0],F=r[1],N=r[2],k=r[3],G=z.winding(P,D,L,V,O,F),l=0;l<f;l++)l!=s&&(3==(C=i[l]).length&&(S=C[0],T=C[1],w=C[2],o=(E=e[l])[E.length-2],a=E[E.length-1],S==B&&T==R&&(M=z.winding(P,D,L,V,o,a),I=z.winding(o,a,O,F,N,k),M==G&&I==G&&(E.length=0,C.length=0,r.push(o),r.push(a),n.push(w),P=L,D=V,L=o,V=a,l=0))));for(s=e.length-1;0<=s;s--)0==(r=e[s]).length&&(e.splice(s,1),this.polygonPool.free(r),n=i[s],i.splice(s,1),this.polygonIndicesPool.free(n));return e},z.isConcave=function(t,e,i,n){var r=n[(e+t-1)%e]<<1,s=n[t]<<1,n=n[(t+1)%e]<<1;return!this.positiveArea(i[r],i[1+r],i[s],i[1+s],i[n],i[1+n])},z.positiveArea=function(t,e,i,n,r,s){return 0<=t*(s-n)+i*(e-s)+r*(n-e)},z.winding=function(t,e,i,n,r,s){i-=t,n-=e;return 0<=r*n-s*i+i*e-t*n?1:-1},t.Triangulator=z}(t=t||{}),function(t){function e(){this.array=new Array}function i(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t=void 0===t?0:t,this.g=e,this.b=i,this.a=n}function n(){}e.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},e.prototype.contains=function(t){return null!=this.array[0|t]},e.prototype.remove=function(t){this.array[0|t]=void 0},e.prototype.clear=function(){this.array.length=0},t.IntSet=e,i.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp(),this},i.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},i.prototype.add=function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp(),this},i.prototype.clamp=function(){return this.r<0?this.r=0:1<this.r&&(this.r=1),this.g<0?this.g=0:1<this.g&&(this.g=1),this.b<0?this.b=0:1<this.b&&(this.b=1),this.a<0?this.a=0:1<this.a&&(this.a=1),this},i.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},i.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},i.WHITE=new i(1,1,1,1),i.RED=new i(1,0,0,1),i.GREEN=new i(0,1,0,1),i.BLUE=new i(0,0,1,1),i.MAGENTA=new i(1,0,1,1),t.Color=i,n.clamp=function(t,e,i){return t<e?e:i<t?i:t},n.cosDeg=function(t){return Math.cos(t*n.degRad)},n.sinDeg=function(t){return Math.sin(t*n.degRad)},n.signum=function(t){return 0<t?1:t<0?-1:0},n.toInt=function(t){return 0<t?Math.floor(t):Math.ceil(t)},n.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},n.randomTriangular=function(t,e){return n.randomTriangularWith(t,e,.5*(t+e))},n.randomTriangularWith=function(t,e,i){var n=Math.random(),r=e-t;return n<=(i-t)/r?t+Math.sqrt(n*r*(i-t)):e-Math.sqrt((1-n)*r*(e-i))},n.PI2=2*(n.PI=3.1415927),n.radDeg=n.radiansToDegrees=180/n.PI,n.degRad=n.degreesToRadians=n.PI/180,t.MathUtils=n;h.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)};var r=h;function h(){}t.Interpolation=r;V(s,u=r),s.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1};var u,r=s;function s(t){var e=u.call(this)||this;return e.power=2,e.power=t,e}t.Pow=r;V(d,_=r),d.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1};var _,r=d;function d(t){return _.call(this,t)||this}function o(){}function f(){}function a(t){this.items=new Array,this.instantiator=t}function c(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e}function p(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}function l(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}t.PowOut=r,o.arrayCopy=function(t,e,i,n,r){for(var s=e,o=n;s<e+r;s++,o++)i[o]=t[s]},o.setArraySize=function(t,e,i){void 0===i&&(i=0);var n=t.length;if(n==e)return t;if(n<(t.length=e))for(var r=n;r<e;r++)t[r]=i;return t},o.ensureArrayCapacity=function(t,e,i){return void 0===i&&(i=0),t.length>=e?t:o.setArraySize(t,e,i)},o.newArray=function(t,e){for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i},o.newFloatArray=function(t){if(o.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);for(var e=new Array(t),i=0;i<e.length;i++)e[i]=0;return e},o.newShortArray=function(t){if(o.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);for(var e=new Array(t),i=0;i<e.length;i++)e[i]=0;return e},o.toFloatArray=function(t){return o.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t},o.toSinglePrecision=function(t){return o.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t},o.webkit602BugfixHelper=function(t,e){},o.contains=function(t,e,i){void 0===i&&(i=!0);for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},o.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t.Utils=o,f.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t.DebugUtils=f,a.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()},a.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},a.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},a.prototype.clear=function(){this.items.length=0},t.Pool=a,c.prototype.set=function(t,e){return this.x=t,this.y=e,this},c.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},c.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t.Vector2=c,p.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t.TimeKeeper=p,l.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},l.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},l.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t.WindowedMean=l}(t=t||{}),Math.fround||(Math.fround=(v=new Float32Array(1),function(t){return v[0]=t,v[0]})),(x=t=t||{}).Attachment=J,V(Z,b=J),Z.prototype.computeWorldVertices=function(h,u,_,t,d,f){_=d+(_>>1)*f;var p=h.bone.skeleton,m=h.deform,e=this.vertices,i=this.bones;if(null!=i){for(var n=0,y=0,g=0;g<u;g+=2)n+=(r=i[n])+1,y+=r;var v=p.bones;if(0==m.length)for(c=d,l=3*y;c<_;c+=f){var x=0,b=0,r=i[n++];for(r+=n;n<r;n++,l+=3){var s=v[i[n]],o=e[l],a=e[l+1],A=e[l+2];x+=(o*s.a+a*s.b+s.worldX)*A,b+=(o*s.c+a*s.d+s.worldY)*A}t[c]=x,t[c+1]=b}else for(var C=m,c=d,l=3*y,S=y<<1;c<_;c+=f){x=0,b=0,r=i[n++];for(r+=n;n<r;n++,l+=3,S+=2){s=v[i[n]],o=e[l]+C[S],a=e[l+1]+C[S+1],A=e[l+2];x+=(o*s.a+a*s.b+s.worldX)*A,b+=(o*s.c+a*s.d+s.worldY)*A}t[c]=x,t[c+1]=b}}else{0<m.length&&(e=m);for(var s,T=(s=h.bone).worldX,w=s.worldY,E=s.a,l=s.b,M=s.c,I=s.d,B=u,c=d;c<_;B+=2,c+=f){var o=e[B],a=e[B+1];t[c]=o*E+a*l+T,t[c+1]=o*M+a*I+w}}},Z.prototype.copyTo=function(t){null!=this.bones?(t.bones=new Array(this.bones.length),x.Utils.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=x.Utils.newFloatArray(this.vertices.length),x.Utils.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment},Z.nextID=0,x.VertexAttachment=Z,(n=(n=t=t||{}).AttachmentType||(n.AttachmentType={}))[n.Region=0]="Region",n[n.BoundingBox=1]="BoundingBox",n[n.Mesh=2]="Mesh",n[n.LinkedMesh=3]="LinkedMesh",n[n.Path=4]="Path",n[n.Point=5]="Point",n[n.Clipping=6]="Clipping",A=t=t||{},C=A.VertexAttachment,V(K,C),K.prototype.copy=function(){var t=new K(name);return this.copyTo(t),t.color.setFromColor(this.color),t},A.BoundingBoxAttachment=K,S=t=t||{},T=S.VertexAttachment,V(Q,T),Q.prototype.copy=function(){var t=new Q(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},S.ClippingAttachment=Q,u=t=t||{},w=u.VertexAttachment,V($,w),$.prototype.updateUVs=function(){var t=this.regionUVs,e=(null!=this.uvs&&this.uvs.length==t.length||(this.uvs=u.Utils.newFloatArray(t.length)),this.uvs),h=this.uvs.length,i=this.region.u,n=this.region.v,r=0,s=0;if(this.region instanceof u.TextureAtlasRegion){var o=this.region,a=o.texture.getImage().width,c=o.texture.getImage().height;switch(o.degrees){case 90:i-=(o.originalHeight-o.offsetY-o.height)/a,n-=(o.originalWidth-o.offsetX-o.width)/c;for(var r=o.originalHeight/a,s=o.originalWidth/c,l=0;l<h;l+=2)e[l]=i+t[l+1]*r,e[l+1]=n+(1-t[l])*s;return;case 180:i-=(o.originalWidth-o.offsetX-o.width)/a,n-=o.offsetY/c,r=o.originalWidth/a,s=o.originalHeight/c;for(l=0;l<h;l+=2)e[l]=i+(1-t[l])*r,e[l+1]=n+(1-t[l+1])*s;return;case 270:i-=o.offsetY/a,n-=o.offsetX/c,r=o.originalHeight/a,s=o.originalWidth/c;for(l=0;l<h;l+=2)e[l]=i+(1-t[l+1])*r,e[l+1]=n+t[l]*s;return}i-=o.offsetX/a,n-=(o.originalHeight-o.offsetY-o.height)/c,r=o.originalWidth/a,s=o.originalHeight/c}else null==this.region?(i=n=0,r=s=1):(r=this.region.u2-i,s=this.region.v2-n);for(l=0;l<h;l+=2)e[l]=i+t[l]*r,e[l+1]=n+t[l+1]*s},$.prototype.getParentMesh=function(){return this.parentMesh},$.prototype.setParentMesh=function(t){null!=(this.parentMesh=t)&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},$.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new $(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),u.Utils.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),u.Utils.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),u.Utils.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),u.Utils.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t},$.prototype.newLinkedMesh=function(){var t=new $(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},u.MeshAttachment=$,E=t=t||{},M=E.VertexAttachment,V(tt,M),tt.prototype.copy=function(){var t=new tt(name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),E.Utils.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t},E.PathAttachment=tt,I=t=t||{},B=I.VertexAttachment,V(et,B),et.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},et.prototype.computeWorldRotation=function(t){var e=I.MathUtils.cosDeg(this.rotation),i=I.MathUtils.sinDeg(this.rotation),n=e*t.a+i*t.b,e=e*t.c+i*t.d;return Math.atan2(e,n)*I.MathUtils.radDeg},et.prototype.copy=function(){var t=new et(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},I.PointAttachment=et,R=t=t||{},P=R.Attachment,V(_,P),_.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,t=i+this.region.width*t,e=n+this.region.height*e,r=this.rotation*Math.PI/180,s=Math.cos(r),r=Math.sin(r),o=i*s+this.x,i=i*r,a=n*s+this.y,n=n*r,c=t*s+this.x,t=t*r,s=e*s+this.y,e=e*r,r=this.offset;r[_.OX1]=o-n,r[_.OY1]=a+i,r[_.OX2]=o-e,r[_.OY2]=s+i,r[_.OX3]=c-e,r[_.OY3]=s+t,r[_.OX4]=c-n,r[_.OY4]=a+t},_.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},_.prototype.computeWorldVertices=function(t,e,i,h){var n=this.offset,r=t.worldX,s=t.worldY,o=t.a,a=t.b,u=t.c,t=t.d,c=n[_.OX1],l=n[_.OY1];e[i]=c*o+l*a+r,e[i+1]=c*u+l*t+s,c=n[_.OX2],l=n[_.OY2],e[i+=h]=c*o+l*a+r,e[i+1]=c*u+l*t+s,c=n[_.OX3],l=n[_.OY3],e[i+=h]=c*o+l*a+r,e[i+1]=c*u+l*t+s,c=n[_.OX4],l=n[_.OY4],e[i+=h]=c*o+l*a+r,e[i+1]=c*u+l*t+s},_.prototype.copy=function(){var t=new _(name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,R.Utils.arrayCopy(this.uvs,0,t.uvs,0,8),R.Utils.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t},_.OX1=0,_.OY1=1,_.OX2=2,_.OY2=3,_.OX3=4,_.OY3=5,_.OX4=6,_.OY4=7,_.X1=0,_.Y1=1,_.C1R=2,_.C1G=3,_.C1B=4,_.C1A=5,_.U1=6,_.V1=7,_.X2=8,_.Y2=9,_.C2R=10,_.C2G=11,_.C2B=12,_.C2A=13,_.U2=14,_.V2=15,_.X3=16,_.Y3=17,_.C3R=18,_.C3G=19,_.C3B=20,_.C3A=21,_.U3=22,_.V3=23,_.X4=24,_.Y4=25,_.C4R=26,_.C4G=27,_.C4B=28,_.C4A=29,_.U4=30,_.V4=31,R.RegionAttachment=_,function(r){function t(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}t.prototype.begin=function(t){},t.prototype.transform=function(t,e,i,n){t.x+=r.MathUtils.randomTriangular(-this.jitterX,this.jitterY),t.y+=r.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},r.JitterEffect=t}(t=t||{}),D=t=t||{},it.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},it.prototype.transform=function(t,e,i,n){var r=this.angle*D.MathUtils.degreesToRadians,s=t.x-this.worldX,o=t.y-this.worldY,a=Math.sqrt(s*s+o*o);a<this.radius&&(r=this.interpolation.apply(0,r,(this.radius-a)/this.radius),a=Math.cos(r),r=Math.sin(r),t.x=a*s-r*o+this.worldX,t.y=r*s+a*o+this.worldY)},it.prototype.end=function(){},it.interpolation=new D.PowOut(2),D.SwirlEffect=it,o.exports=t},{}],356:[function(t,e,i){"use strict";var y,g,v,x,b,A,o=t("./track-entry-listeners"),I=t("./lib/spine"),B=[],F=[],N=0,R=0,P=0,k=null,G=null,D=0,z=0,L=0,C=0,S=null,T=null,V=0,O=0,p=new I.Color(1,1,1,1),m=new I.Color(1,1,1,1),U=[0,1,2,2,3,0],s=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null},init:function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},clear:function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},bind:function(t){var e=function(t){t&&t.animation.name===this._animationName&&(this.isCompleted=!0)}.bind(this);t.complete=e},unbind:function(t){t.complete=null},begin:function(){var t,e,i,n;this._invalid&&((n=(t=this._skeletonInfo).curAnimationCache)&&n!==this&&(this._privateMode?n.invalidAllFrame():n.updateToFrame()),n=t.skeleton,e=t.listener,i=t.state,n=n.data.findAnimation(this._animationName),i.setAnimationWith(0,n,!1),this.bind(e),(t.curAnimationCache=this)._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1)},end:function(){this._needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},_needToUpdate:function(t){return!this.isCompleted&&this.totalTime<30&&(null==t||this._frameIdx<t)},updateToFrame:function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){for(var e=this._skeletonInfo,i=e.skeleton,n=e.clipper,r=e.state;i.update(1/60),r.update(1/60),r.apply(i),i.updateWorldTransform(),this._frameIdx++,this._updateFrame(i,n,this._frameIdx),this.totalTime+=1/60,this._needToUpdate(t););this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(t,e,i){C=L=z=D=R=N=P=0,T=S=G=k=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var i=this.frames[i],n=this._tempSegments=i.segments,h=this._tempColors=i.colors,u=this._tempBoneInfos=i.boneInfos,t=(this._traverseSkeleton(t,e),0<C&&(h[C-1].vfOffset=P),h.length=C,u.length=N,L-1);if(0<=t&&(0<z?((e=n[t]).indexCount=z,e.vfCount=6*D,e.vertexCount=D,n.length=L):n.length=L-1),0!=n.length){var r=i.vertices,s=i.uintVert;(!r||r.length<P)&&(r=i.vertices=new Float32Array(P),s=i.uintVert=new Uint32Array(r.buffer));for(var o=0,a=0;o<P;)r[o++]=B[a++],r[o++]=B[a++],r[o++]=B[a++],r[o++]=B[a++],s[o++]=B[a++],s[o++]=B[a++];var c=i.indices;(!c||c.length<R)&&(c=i.indices=new Uint16Array(R));for(var l=0;l<R;l++)c[l]=F[l];i.vertices=r,i.uintVert=s,i.indices=c}},fillVertices:function(t,e,i,n,r){if(x=i.a*e.a*t.a*255,y=e.r*t.r*255,g=e.g*t.g*255,v=e.b*t.b*255,p.r=y*i.r,p.g=g*i.g,p.b=v*i.b,p.a=x,null==r.darkColor?m.set(0,0,0,1):(m.r=r.darkColor.r*y,m.g=r.darkColor.g*g,m.b=r.darkColor.b*v),m.a=0,b=(p.a<<24>>>0)+(p.b<<16)+(p.g<<8)+p.r,A=(m.a<<24>>>0)+(m.b<<16)+(m.g<<8)+m.r,S===b&&T===A||(e=this._tempColors,S=b,T=A,0<C&&(e[C-1].vfOffset=P),e[C++]={fr:p.r,fg:p.g,fb:p.b,fa:p.a,dr:m.r,dg:m.g,db:m.b,da:m.a,vfOffset:0}),n.isClipping()){n.clipTriangles(B,V,F,O,B,p,m,!0,6,R,P,P+2);var s=n.clippedVertices,o=n.clippedTriangles;O=o.length,V=s.length/12*6;for(var h=0,u=R,_=o.length;h<_;)F[u++]=o[h++];for(var a=0,d=s.length,c=P;a<d;a+=12,c+=6)B[c]=s[a],B[c+1]=s[a+1],B[c+2]=s[a+6],B[c+3]=s[a+7],B[c+4]=b,B[c+5]=A}else for(var l=P,f=P+V;l<f;l+=6)B[l+4]=b,B[l+5]=A},_traverseSkeleton:function(t,e){var i,n,h,u,r,s,o,a,_=this._tempSegments,d=this._tempBoneInfos,f=t.color,p=t.bones;if(this._enableCacheAttachedInfo)for(var m=0,y=p.length;m<y;m++,N++){var c=p[m],l=d[N];(l=l||(d[N]={})).a=c.a,l.b=c.b,l.c=c.c,l.d=c.d,l.worldX=c.worldX,l.worldY=c.worldY}for(var g=0,v=t.drawOrder.length;g<v;g++)if(a=t.drawOrder[g],O=V=0,i=a.getAttachment())if(h=i instanceof I.RegionAttachment,u=i instanceof I.MeshAttachment,i instanceof I.ClippingAttachment)e.clipStart(a,i);else if(h||u)if(r=i.region.texture._texture)if(o=a.data.blendMode,k===r.url&&G===o||(k=r.url,G=o,0<=(s=L-1)&&(0<z?((s=_[s]).indexCount=z,s.vertexCount=D,s.vfCount=6*D):L--),_[L]={tex:r,blendMode:o,indexCount:0,vertexCount:0,vfCount:0},L++,D=z=0),h?(n=U,V=24,O=6,i.computeWorldVertices(a.bone,B,P,6)):u&&(n=i.triangles,V=6*(i.worldVerticesLength>>1),O=n.length,i.computeWorldVertices(a,0,i.worldVerticesLength,B,P,6)),0!=V&&0!=O){for(var x=0,b=R,A=n.length;x<A;)F[b++]=n[x++];for(var C=i.uvs,S=P,T=P+V,w=0;S<T;S+=6,w+=2)B[S+2]=C[w],B[S+3]=C[w+1];if(s=i.color,r=a.color,this.fillVertices(f,s,r,e,a),0<O){for(var E=R,M=R+O;E<M;E++)F[E]+=D;R+=O,P+=V,z+=O,D+=V/6}e.clipEndWithSlot(a)}else e.clipEndWithSlot(a);else e.clipEndWithSlot(a);else e.clipEndWithSlot(a);else e.clipEndWithSlot(a);e.clipEnd()}}),t=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._skeletonCache={}},enablePrivateMode:function(){this._privateMode=!0},clear:function(){this._animationPool={},this._skeletonCache={}},removeSkeleton:function(t){var e=this._skeletonCache[t];if(e){var i,n=e.animationsCache;for(i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r).clear()}delete this._skeletonCache[t]}},getSkeletonCache:function(t,e){var i,n,r,s=this._skeletonCache[t];return s||(e=new I.Skeleton(e),i=new I.SkeletonClipping,n=new I.AnimationStateData(e.data),n=new I.AnimationState(n),r=new o,n.addListener(r),this._skeletonCache[t]=s={skeleton:e,clipper:i,state:n,listener:r,animationsCache:{},curAnimationCache:null}),s},getAnimationCache:function(t,e){t=this._skeletonCache[t];return t?t.animationsCache[e]:null},invalidAnimationCache:function(t){t=this._skeletonCache[t];if(t&&t.skeleton){var e,i=t.animationsCache;for(e in i)i[e].invalidAllFrame()}},initAnimationCache:function(t,e){if(!e)return null;var i=this._skeletonCache[t],n=i&&i.skeleton;if(!n)return null;if(!n.data.findAnimation(e))return null;var n=i.animationsCache,r=n[e];return r||((r=this._animationPool[t=t+"#"+e])?delete this._animationPool[t]:(r=new s)._privateMode=this._privateMode,r.init(i,e),n[e]=r),r},updateAnimationCache:function(t,e){if(e){e=this.initAnimationCache(t,e);if(!e)return null;e.updateAllFrame()}else{e=this._skeletonCache[t];if(e&&e.skeleton){var i,n=e.animationsCache;for(i in n)n[i].updateAllFrame()}}}});t.FrameTime=1/60,t.sharedCache=new t,e.exports=t},{"./lib/spine":355,"./track-entry-listeners":360}],357:[function(t,e,i){"use strict";var n=t("./skeleton-cache").sharedCache,t=cc.Class({name:"sp.SkeletonData",extends:cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJsonStr:{get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},skeletonJson:{get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},textures:{default:[],type:[cc.Texture2D]},textureNames:{default:[],type:[cc.String]},scale:1,_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t,this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null,this._atlasCache=null},ensureTexturesLoaded:function(t,e){var i=this.textures,n=i.length;if(0!=n)for(var r=0,s=function(){n<=++r&&(t&&t.call(e,!0),t=null)},o=0;o<n;o++){var a=i[o];a.loaded?s():a.once("load",s)}else t.call(e,!1)},isTexturesLoaded:function(){for(var t=this.textures,e=t.length,i=0;i<e;i++)if(!t[i].loaded)return!1;return!0},getRuntimeData:function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&0<this.textures.length)&&this.textureNames&&0<this.textureNames.length)return t||cc.errorID(7507,this.name),null;t=this._getAtlas(t);if(!t)return null;var e=new sp.spine.AtlasAttachmentLoader(t),i=null,n=null,i=this.skeletonJson?(n=new sp.spine.SkeletonJson(e),this.skeletonJson):(n=new sp.spine.SkeletonBinary(e),new Uint8Array(this._nativeAsset));return n.scale=this.scale,this._skeletonCache=n.readSkeletonData(i),t.dispose(),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getTexture:function(t){for(var e,i,n=this.textureNames,r=0;r<n.length;r++)if(n[r]===t)return e=this.textures[r],(i=new sp.SkeletonTexture({width:e.width,height:e.height})).setRealTexture(e),i;return cc.errorID(7506,t),null},_getAtlas:function(t){return this._atlasCache||(this.atlasText?this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||cc.errorID(7508,this.name),null))},destroy:function(){n.removeSkeleton(this._uuid),this._super()}});sp.SkeletonData=e.exports=t},{"./skeleton-cache":356}],358:[function(t,e,i){"use strict";sp.SkeletonTexture=cc.Class({name:"sp.SkeletonTexture",extends:sp.spine.Texture,_texture:null,_material:null,setRealTexture:function(t){this._texture=t},getRealTexture:function(){return this._texture},setFilters:function(t,e){this._texture&&this._texture.setFilters(t,e)},setWraps:function(t,e){this._texture&&this._texture.setWrapMode(t,e)},dispose:function(){}})},{}],359:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(n=t("../../cocos2d/core/renderer/assembler"))&&n.__esModule?n:{default:n};function r(i){return function(){var t,e=s(i),e=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(!t||"object"!=typeof t&&"function"!=typeof t){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}return t}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b,A,W,H,O,j,X,Y,C,S,T,w,I,B,o,F,q,R,P,E,M,D,J,Z,K,Q,$,tt,et,it,nt,rt,a,c,l,h,u,_,d,N,k,st,ot,L,V,f=t("./Skeleton"),at=t("./lib/spine"),p=t("../../cocos2d/core/renderer/render-flow"),t=t("../../cocos2d/core/renderer/webgl/vertex-format"),m=t.vfmtPosUvColor,y=t.vfmtPosUvTwoColor,g=cc.gfx,ct=0,lt=[0,1,2,2,3,0],ht=cc.color(0,0,255,255),ut=cc.color(255,0,0,255),_t=cc.color(0,255,0,255),dt=cc.color(255,255,0,255),v=null,x=null,ft=null,pt=null,v=new at.Color(1,1,1,1),x=new at.Color(1,1,1,1),ft=new at.Vector2,pt=new at.Vector2,G=0,z=0,mt=0,U=0,yt=0;function gt(t,e){var i,n;switch(e){case at.BlendMode.Additive:i=b?cc.macro.ONE:cc.macro.SRC_ALPHA,n=cc.macro.ONE;break;case at.BlendMode.Multiply:i=cc.macro.DST_COLOR,n=cc.macro.ONE_MINUS_SRC_ALPHA;break;case at.BlendMode.Screen:i=cc.macro.ONE,n=cc.macro.ONE_MINUS_SRC_COLOR;break;default:at.BlendMode.Normal;i=b?cc.macro.ONE:cc.macro.SRC_ALPHA,n=cc.macro.ONE_MINUS_SRC_ALPHA}var e=!N.enableBatch,r=N._materials[0];if(!r)return null;var s=t.getId()+i+n+O+e,o=N._materialCache,a=o[s];return a||(o.baseMaterial?a=cc.MaterialVariant.create(r):o.baseMaterial=a=r,a.define("CC_USE_MODEL",e),a.define("USE_TINT",O),a.setProperty("texture",t),a.setBlend(!0,g.BLEND_FUNC_ADD,i,n,g.BLEND_FUNC_ADD,i,n),o[s]=a),a}function vt(t){u=t.fa*w,a=C*(A=b?u/255:1),c=S*A,l=T*A,h=t.fr*a,d=t.fg*c,_=t.fb*l,I=(u<<24>>>0)+(_<<16)+(d<<8)+h,u=t.dr*a,_=t.dg*c,d=t.db*l,B=((b?255:0)<<24>>>0)+(d<<16)+(_<<8)+u}function xt(t){return(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r}bt=n.default,t=bt,(At=Ct).prototype=Object.create(t.prototype),(At.prototype.constructor=At).__proto__=t,r(Ct),(At=Ct.prototype).updateRenderData=function(t){t.isAnimationCached()||(t=t._skeleton)&&t.updateWorldTransform()},At.fillVertices=function(t,h,e,u,_){var i=k._vData,d=k._iData,n=k._uintVData;if(v.a=e.a*h.a*t.a*w*255,A=b?v.a:255,E=C*h.r*t.r*A,M=S*h.g*t.g*A,D=T*h.b*t.b*A,v.r=E*e.r,v.g=M*e.g,v.b=D*e.b,null==_.darkColor?x.set(0,0,0,1):(x.r=_.darkColor.r*E,x.g=_.darkColor.g*M,x.b=_.darkColor.b*D),x.a=b?255:0,u.isClipping()){var h=i.subarray(z+2),r=(u.clipTriangles(i.subarray(z),G,d.subarray(yt),U,h,v,x,O,F),new Float32Array(u.clippedVertices)),t=u.clippedTriangles;if(U=t.length,G=r.length/q*F,e=k.request(G/F,U),yt=e.indiceOffset,mt=e.vertexOffset,z=e.byteOffset>>2,i=k._vData,d=k._iData,n=k._uintVData,d.set(t,yt),V)for(var s=0,f=r.length,o=z;s<f;s+=q,o+=F)ft.x=r[s],ft.y=r[s+1],v.set(r[s+2],r[s+3],r[s+4],r[s+5]),pt.x=r[s+6],pt.y=r[s+7],O?x.set(r[s+8],r[s+9],r[s+10],r[s+11]):x.set(0,0,0,0),V.transform(ft,pt,v,x),i[o]=ft.x,i[o+1]=ft.y,i[o+2]=pt.x,i[o+3]=pt.y,n[o+4]=xt(v),O&&(n[o+5]=xt(x));else for(var a=0,p=r.length,c=z;a<p;a+=q,c+=F)i[c]=r[a],i[c+1]=r[a+1],i[c+2]=r[a+6],i[c+3]=r[a+7],I=(r[a+5]<<24>>>0)+(r[a+4]<<16)+(r[a+3]<<8)+r[a+2],n[c+4]=I,O&&(B=(r[a+11]<<24>>>0)+(r[a+10]<<16)+(r[a+9]<<8)+r[a+8],n[c+5]=B)}else if(V)for(var l=z,m=z+G;l<m;l+=F)ft.x=i[l],ft.y=i[l+1],pt.x=i[l+2],pt.y=i[l+3],V.transform(ft,pt,v,x),i[l]=ft.x,i[l+1]=ft.y,i[l+2]=pt.x,i[l+3]=pt.y,n[l+4]=xt(v),O&&(n[l+5]=xt(x));else{I=xt(v),B=xt(x);for(var y=z,g=z+G;y<g;y+=F)n[y+4]=I,O&&(n[y+5]=B)}},At.realTimeTraverse=function(h){var t,u,e,i,_,n,r,s,d=N._skeleton,f=d.color,o=N._debugRenderer,a=N._clipper,p=null;W=N._startSlotIndex,H=N._endSlotIndex,J=-1==W?!0:!1,j=N.debugSlots,X=N.debugBones,Y=N.debugMesh,o&&(X||j||Y)&&(o.clear(),o.lineWidth=2),q=O?12:8;for(var m=yt=U=mt=z=G=0,y=d.drawOrder.length;m<y;m++)if(r=d.drawOrder[m],J=0<=W&&W==r.data.index?!0:J)if(0<=H&&H==r.data.index&&(J=!1),U=G=0,s=r.getAttachment())if(i=s instanceof at.RegionAttachment,_=s instanceof at.MeshAttachment,s instanceof at.ClippingAttachment)a.clipStart(r,s);else if(i||_)if(p=gt(s.region.texture._texture,r.data.blendMode)){if(!Z&&p.getHash()===st.material.getHash()||(Z=!1,st._flush(),st.node=ot,st.material=p),i){if(e=lt,G=4*F,U=6,n=k.request(4,6),yt=n.indiceOffset,mt=n.vertexOffset,z=n.byteOffset>>2,t=k._vData,u=k._iData,s.computeWorldVertices(r.bone,t,z,F),o&&j){o.strokeColor=ht,o.moveTo(t[z],t[z+1]);for(var g=z+F,v=z+G;g<v;g+=F)o.lineTo(t[g],t[g+1]);o.close(),o.stroke()}}else if(_&&(e=s.triangles,G=(s.worldVerticesLength>>1)*F,U=e.length,n=k.request(G/F,U),yt=n.indiceOffset,mt=n.vertexOffset,z=n.byteOffset>>2,t=k._vData,u=k._iData,s.computeWorldVertices(r,0,s.worldVerticesLength,t,z,F),o&&Y)){o.strokeColor=dt;for(var x=0,b=e.length;x<b;x+=3){var A=e[x]*F+z,C=e[x+1]*F+z,S=e[x+2]*F+z;o.moveTo(t[A],t[A+1]),o.lineTo(t[C],t[C+1]),o.lineTo(t[S],t[S+1]),o.close(),o.stroke()}}if(0!=G&&0!=U){u.set(e,yt);for(var T=s.uvs,w=z,E=z+G,M=0;w<E;w+=F,M+=2)t[w+2]=T[M],t[w+3]=T[M+1];if(i=s.color,_=r.color,this.fillVertices(f,i,_,a,r),0<U){for(var I=yt,B=yt+U;I<B;I++)u[I]+=mt;if(h){s=h.m,$=s[0],tt=s[4],et=s[12],it=s[1],nt=s[5],rt=s[13];for(var c=z,R=z+G;c<R;c+=F)K=t[c],Q=t[c+1],t[c]=K*$+Q*tt+et,t[c+1]=K*it+Q*nt+rt}k.adjust(G/F,U)}a.clipEndWithSlot(r)}else a.clipEndWithSlot(r)}else a.clipEndWithSlot(r);else a.clipEndWithSlot(r);else a.clipEndWithSlot(r);else a.clipEndWithSlot(r);if(a.clipEnd(),o&&X){o.strokeColor=ut,o.fillColor=ht;for(var P=0,D=d.bones.length;P<D;P++){var l,L=(l=d.bones[P]).data.length*l.a+l.worldX,V=l.data.length*l.c+l.worldY;o.moveTo(l.worldX,l.worldY),o.lineTo(L,V),o.stroke(),o.circle(l.worldX,l.worldY,1.5*Math.PI),o.fill(),0===P&&(o.fillColor=_t)}}},At.cacheTraverse=function(t){var e=N._curFrame;if(e){var h=e.segments;if(0!=h.length){var u=e.vertices,_=e.indices,i=0,d=0;t&&(t=t.m,$=t[0],it=t[1],tt=t[4],nt=t[5],et=t[12],rt=t[13]);var f=16&ct,p=f&&(1===$&&0===it&&0===tt&&1===nt),m=0,y=e.colors,n=y[m++],g=n.vfOffset;vt(n);for(var v=0,x=h.length;v<x;v++){var r,s=h[v];if(r=gt(s.tex,s.blendMode)){!Z&&r.getHash()===st.material.getHash()||(Z=!1,st._flush(),st.node=ot,st.material=r),R=s.vertexCount,U=s.indexCount,r=k.request(R,U),yt=r.indiceOffset,mt=r.vertexOffset,P=r.byteOffset>>2;for(var o=k._vData,b=k._iData,A=k._uintVData,C=yt,S=yt+U;C<S;C++)b[C]=mt+_[d++];if(r=s.vfCount,o.set(u.subarray(i,i+r),P),i+=r,p)for(var a=P,T=P+r;a<T;a+=6)o[a]+=et,o[a+1]+=rt;else if(f)for(var c=P,w=P+r;c<w;c+=6)K=o[c],Q=o[c+1],o[c]=K*$+Q*tt+et,o[c+1]=K*it+Q*nt+rt;if(k.adjust(R,U),L)for(var E=i-r,l=4+P,M=4+P+r;l<M;l+=6,E+=6)g<=E&&(vt(n=y[m++]),g=n.vfOffset),A[l]=I,A[l+1]=B}}}}},At.fillBuffers=function(t,e){var i=t.node;i._renderFlag|=p.FLAG_UPDATE_RENDER_DATA,t._skeleton&&(i=i._color,C=i.r/255,S=i.g/255,T=i.b/255,w=i.a/255,O=t.useTint||t.isAnimationCached(),o=O?y:m,F=O?6:5,ot=t.node,k=e.getBuffer("spine",o),st=e,Z=!0,b=(N=t).premultipliedAlpha,ct=0,L=!(A=1),V=t._effectDelegate&&t._effectDelegate._vertexEffect,4294967295===i._val&&!b||(L=!0),i=void(O&&(ct|=1)),N.enableBatch&&(i=ot._worldMatrix,Z=!1,ct|=16),t.isAnimationCached()?this.cacheTraverse(i):(V&&V.begin(t._skeleton),this.realTimeTraverse(i),V&&V.end()),e.worldMatDirty++,t.attachUtil._syncAttachedNode(),N=st=k=ot=void 0,V=null)},At.postFillBuffers=function(t,e){e.worldMatDirty--};var bt,At,t=Ct;function Ct(){return bt.apply(this,arguments)||this}i.default=t,n.default.register(f,t),e.exports=i.default},{"../../cocos2d/core/renderer/assembler":217,"../../cocos2d/core/renderer/render-flow":221,"../../cocos2d/core/renderer/webgl/vertex-format":252,"./Skeleton":353,"./lib/spine":355}],360:[function(t,e,i){"use strict";function n(){this.start=null,this.end=null,this.complete=null,this.event=null,this.interrupt=null,this.dispose=null}n.getListeners=function(t){return t.listener||(t.listener=new n),t.listener},e.exports=n},{}],361:[function(t,e,i){"use strict";var n=t("./lib/spine");sp.VertexEffectDelegate=cc.Class({name:"sp.VertexEffectDelegate",ctor:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},clear:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},initJitter:function(t,e){return this._effectType="jitter",this._vertexEffect=new n.JitterEffect(t,e),this._vertexEffect},initSwirlWithPow:function(t,e){return this._interpolation=new n.Pow(e),this._vertexEffect=new n.SwirlEffect(t,this._interpolation),this._vertexEffect},initSwirlWithPowOut:function(t,e){return this._interpolation=new n.PowOut(e),this._vertexEffect=new n.SwirlEffect(t,this._interpolation),this._vertexEffect},getJitterVertexEffect:function(){return this._vertexEffect},getSwirlVertexEffect:function(){return this._vertexEffect},getVertexEffect:function(){return this._vertexEffect},getEffectType:function(){return this._effectType}}),e.exports=sp.VertexEffectDelegate},{"./lib/spine":355}],362:[function(t,e,i){"use strict";var n;n=function(H){function f(t,e){return void 0!==t?t:e}var P=1e37,M=1e-5,g=M*M,m=3.14159265359,I=.008,D=2/180*m,p=8/180*m,T=.5*m,w=T*T,t=2/180*m;n.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision};var i=n;function n(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}var s=new i(2,3,2);function c(t,e){for(var i=[],n=0;n<t;++n)i.push(e(n));return i}function h(t,e){void 0===e&&(e=0);for(var i=[],n=0;n<t;++n)i.push(e);return i}var o=m/180,a=180/m,l=2*m,L=Math.abs,V=Math.min,O=Math.max;function F(t,e,i){return t<e?e:i<t?i:t}var u=isFinite;function _(t){return t*t}function A(t){return 1/Math.sqrt(t)}var Y=Math.sqrt,d=Math.pow;var y=Math.cos,v=Math.sin,x=Math.acos,b=Math.asin,C=Math.atan2;e.prototype.Clone=function(){return new e(this.x,this.y)},e.prototype.SetZero=function(){return this.x=0,this.y=0,this},e.prototype.Set=function(t,e){return this.x=t,this.y=e,this},e.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this},e.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},e.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},e.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this},e.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},e.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},e.prototype.Dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.Cross=function(t){return this.x*t.y-this.y*t.x},e.prototype.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},e.prototype.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},e.prototype.Normalize=function(){var t,e=this.Length();return M<=e&&(this.x*=t=1/e,this.y*=t),e},e.prototype.SelfNormalize=function(){var t=this.Length();return M<=t&&(this.x*=t=1/t,this.y*=t),this},e.prototype.SelfRotate=function(t){var e=Math.cos(t),t=Math.sin(t),i=this.x;return this.x=e*i-t*this.y,this.y=t*i+e*this.y,this},e.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},e.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},e.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},e.prototype.SelfMinV=function(t){return this.x=V(this.x,t.x),this.y=V(this.y,t.y),this},e.prototype.SelfMaxV=function(t){return this.x=O(this.x,t.x),this.y=O(this.y,t.y),this},e.prototype.SelfAbs=function(){return this.x=L(this.x),this.y=L(this.y),this},e.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},e.MakeArray=function(t){return c(t,function(t){return new e})},e.AbsV=function(t,e){return e.x=L(t.x),e.y=L(t.y),e},e.MinV=function(t,e,i){return i.x=V(t.x,e.x),i.y=V(t.y,e.y),i},e.MaxV=function(t,e,i){return i.x=O(t.x,e.x),i.y=O(t.y,e.y),i},e.ClampV=function(t,e,i,n){return n.x=F(t.x,e.x,i.x),n.y=F(t.y,e.y,i.y),n},e.RotateV=function(t,e,i){var n=t.x,t=t.y,r=Math.cos(e),e=Math.sin(e);return i.x=r*n-e*t,i.y=e*n+r*t,i},e.DotVV=function(t,e){return t.x*e.x+t.y*e.y},e.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},e.CrossVS=function(t,e,i){var n=t.x;return i.x=e*t.y,i.y=-e*n,i},e.CrossVOne=function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e},e.CrossSV=function(t,e,i){var n=e.x;return i.x=-t*e.y,i.y=t*n,i},e.CrossOneV=function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e},e.AddVV=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},e.SubVV=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},e.MulSV=function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i},e.MulVS=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},e.AddVMulSV=function(t,e,i,n){return n.x=t.x+e*i.x,n.y=t.y+e*i.y,n},e.SubVMulSV=function(t,e,i,n){return n.x=t.x-e*i.x,n.y=t.y-e*i.y,n},e.AddVCrossSV=function(t,e,i,n){var r=i.x;return n.x=t.x-e*i.y,n.y=t.y+e*r,n},e.MidVV=function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i},e.ExtVV=function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i},e.IsEqualToV=function(t,e){return t.x===e.x&&t.y===e.y},e.DistanceVV=function(t,e){var i=t.x-e.x,t=t.y-e.y;return Math.sqrt(i*i+t*t)},e.DistanceSquaredVV=function(t,e){var i=t.x-e.x,t=t.y-e.y;return i*i+t*t},e.NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e},e.ZERO=new e(0,0),e.UNITX=new e(1,0),e.UNITY=new e(0,1),e.s_t0=new e,e.s_t1=new e,e.s_t2=new e,e.s_t3=new e;var j=e;function e(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e}var N=new j(0,0),k=(G.prototype.Clone=function(){return new G(this.x,this.y,this.z)},G.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},G.prototype.SetXYZ=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},G.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},G.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},G.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},G.prototype.SelfAddXYZ=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},G.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},G.prototype.SelfSubXYZ=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this},G.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},G.DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},G.CrossV3V3=function(t,e,i){var n=t.x,r=t.y,t=t.z,s=e.x,o=e.y,e=e.z;return i.x=r*e-t*o,i.y=t*s-n*e,i.z=n*o-r*s,i},G.ZERO=new G(0,0,0),G.s_t0=new G,G);function G(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.x=t=void 0===t?0:t,this.y=e,this.z=i}U.prototype.Clone=function(){return(new U).Copy(this)},U.FromVV=function(t,e){return(new U).SetVV(t,e)},U.FromSSSS=function(t,e,i,n){return(new U).SetSSSS(t,e,i,n)},U.FromAngle=function(t){return(new U).SetAngle(t)},U.prototype.SetSSSS=function(t,e,i,n){return this.ex.Set(t,i),this.ey.Set(e,n),this},U.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},U.prototype.SetAngle=function(t){var e=Math.cos(t),t=Math.sin(t);return this.ex.Set(e,t),this.ey.Set(-t,e),this},U.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},U.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},U.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},U.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},U.prototype.GetInverse=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;return t.ex.x=(s=0!==s?1/s:s)*r,t.ey.x=-s*i,t.ex.y=-s*n,t.ey.y=s*e,t},U.prototype.Solve=function(t,e,i){var n=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,a=n*o-r*s;return i.x=(a=0!==a?1/a:a)*(o*t-r*e),i.y=a*(n*e-s*t),i},U.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},U.prototype.SelfInv=function(){return this.GetInverse(this),this},U.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},U.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},U.AbsM=function(t,e){var i=t.ex,t=t.ey;return e.ex.x=L(i.x),e.ex.y=L(i.y),e.ey.x=L(t.x),e.ey.y=L(t.y),e},U.MulMV=function(t,e,i){var n=t.ex,t=t.ey,r=e.x,e=e.y;return i.x=n.x*r+t.x*e,i.y=n.y*r+t.y*e,i},U.MulTMV=function(t,e,i){var n=t.ex,t=t.ey,r=e.x,e=e.y;return i.x=n.x*r+n.y*e,i.y=t.x*r+t.y*e,i},U.AddMM=function(t,e,i){var n=t.ex,t=t.ey,r=e.ex,e=e.ey;return i.ex.x=n.x+r.x,i.ex.y=n.y+r.y,i.ey.x=t.x+e.x,i.ey.y=t.y+e.y,i},U.MulMM=function(t,e,i){var n=t.ex.x,r=t.ex.y,s=t.ey.x,t=t.ey.y,o=e.ex.x,a=e.ex.y,c=e.ey.x,e=e.ey.y;return i.ex.x=n*o+s*a,i.ex.y=r*o+t*a,i.ey.x=n*c+s*e,i.ey.y=r*c+t*e,i},U.MulTMM=function(t,e,i){var n=t.ex.x,r=t.ex.y,s=t.ey.x,t=t.ey.y,o=e.ex.x,a=e.ex.y,c=e.ey.x,e=e.ey.y;return i.ex.x=n*o+r*a,i.ex.y=s*o+t*a,i.ey.x=n*c+r*e,i.ey.y=s*c+t*e,i},U.IDENTITY=new U;var z=U;function U(){this.ex=new j(1,0),this.ey=new j(0,1)}q.prototype.Clone=function(){return(new q).Copy(this)},q.prototype.SetVVV=function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this},q.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},q.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},q.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},q.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},q.prototype.Solve33=function(t,e,i,h){var u=this.ex.x,_=this.ex.y,d=this.ex.z,n=this.ey.x,r=this.ey.y,s=this.ey.z,o=this.ez.x,a=this.ez.y,c=this.ez.z,l=u*(r*c-s*a)+_*(s*o-n*c)+d*(n*a-r*o);return h.x=(l=0!==l?1/l:l)*(t*(r*c-s*a)+e*(s*o-n*c)+i*(n*a-r*o)),h.y=l*(u*(e*c-i*a)+_*(i*o-t*c)+d*(t*a-e*o)),h.z=l*(u*(r*i-s*e)+_*(s*t-n*i)+d*(n*e-r*t)),h},q.prototype.Solve22=function(t,e,i){var n=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,a=n*o-r*s;return i.x=(a=0!==a?1/a:a)*(o*t-r*e),i.y=a*(n*e-s*t),i},q.prototype.GetInverse22=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;t.ex.x=(s=0!==s?1/s:s)*r,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*n,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},q.prototype.GetSymInverse33=function(t){var e=k.DotV3V3(this.ex,k.CrossV3V3(this.ey,this.ez,k.s_t0)),i=this.ex.x,n=this.ey.x,r=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=(e=0!==e?1/e:e)*(s*a-o*o),t.ex.y=e*(r*o-n*a),t.ex.z=e*(n*o-r*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-r*r),t.ey.z=e*(r*n-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-n*n)},q.MulM33V3=function(t,e,i){var n=e.x,r=e.y,e=e.z;return i.x=t.ex.x*n+t.ey.x*r+t.ez.x*e,i.y=t.ex.y*n+t.ey.y*r+t.ez.y*e,i.z=t.ex.z*n+t.ey.z*r+t.ez.z*e,i},q.MulM33XYZ=function(t,e,i,n,r){return r.x=t.ex.x*e+t.ey.x*i+t.ez.x*n,r.y=t.ex.y*e+t.ey.y*i+t.ez.y*n,r.z=t.ex.z*e+t.ey.z*i+t.ez.z*n,r},q.MulM33V2=function(t,e,i){var n=e.x,e=e.y;return i.x=t.ex.x*n+t.ey.x*e,i.y=t.ex.y*n+t.ey.y*e,i},q.MulM33XY=function(t,e,i,n){return n.x=t.ex.x*e+t.ey.x*i,n.y=t.ex.y*e+t.ey.y*i,n},q.IDENTITY=new q;var W=q;function q(){this.ex=new k(1,0,0),this.ey=new k(0,1,0),this.ez=new k(0,0,1)}J.prototype.Clone=function(){return(new J).Copy(this)},J.prototype.Copy=function(t){return this.s=t.s,this.c=t.c,this},J.prototype.SetAngle=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this},J.prototype.SetIdentity=function(){return this.s=0,this.c=1,this},J.prototype.GetAngle=function(){return Math.atan2(this.s,this.c)},J.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},J.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},J.MulRR=function(t,e,i){var n=t.c,t=t.s,r=e.c,e=e.s;return i.s=t*r+n*e,i.c=n*r-t*e,i},J.MulTRR=function(t,e,i){var n=t.c,t=t.s,r=e.c,e=e.s;return i.s=n*e-t*r,i.c=n*r+t*e,i},J.MulRV=function(t,e,i){var n=t.c,t=t.s,r=e.x,e=e.y;return i.x=n*r-t*e,i.y=t*r+n*e,i},J.MulTRV=function(t,e,i){var n=t.c,t=t.s,r=e.x,e=e.y;return i.x=n*r+t*e,i.y=-t*r+n*e,i},J.IDENTITY=new J;var B=J;function J(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}Z.prototype.Clone=function(){return(new Z).Copy(this)},Z.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},Z.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},Z.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},Z.prototype.SetPositionAngle=function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this},Z.prototype.SetPosition=function(t){return this.p.Copy(t),this},Z.prototype.SetPositionXY=function(t,e){return this.p.Set(t,e),this},Z.prototype.SetRotation=function(t){return this.q.Copy(t),this},Z.prototype.SetRotationAngle=function(t){return this.q.SetAngle(t),this},Z.prototype.GetPosition=function(){return this.p},Z.prototype.GetRotation=function(){return this.q},Z.prototype.GetRotationAngle=function(){return this.q.GetAngle()},Z.prototype.GetAngle=function(){return this.q.GetAngle()},Z.MulXV=function(t,e,i){var n=t.q.c,r=t.q.s,s=e.x,e=e.y;return i.x=n*s-r*e+t.p.x,i.y=r*s+n*e+t.p.y,i},Z.MulTXV=function(t,e,i){var n=t.q.c,r=t.q.s,s=e.x-t.p.x,e=e.y-t.p.y;return i.x=n*s+r*e,i.y=-r*s+n*e,i},Z.MulXX=function(t,e,i){return B.MulRR(t.q,e.q,i.q),j.AddVV(B.MulRV(t.q,e.p,i.p),t.p,i.p),i},Z.MulTXX=function(t,e,i){return B.MulTRR(t.q,e.q,i.q),B.MulTRV(t.q,j.SubVV(e.p,t.p,i.p),i.p),i},Z.IDENTITY=new Z;var R=Z;function Z(){this.p=new j,this.q=new B}Q.prototype.Clone=function(){return(new Q).Copy(this)},Q.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},Q.prototype.GetTransform=function(t,e){var i=1-e,i=(t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y,i*this.a0+e*this.a);return t.q.SetAngle(i),t.p.SelfSub(B.MulRV(t.q,this.localCenter,j.s_t0)),t},Q.prototype.Advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t},Q.prototype.Normalize=function(){var t=l*Math.floor(this.a0/l);this.a0-=t,this.a-=t};var K=Q;function Q(){this.localCenter=new j,this.c0=new j,this.c=new j,this.a0=0,this.a=0,this.alpha0=0}tt.prototype.Clone=function(){return(new tt).Copy(this)},tt.prototype.Copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},tt.prototype.IsEqual=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},tt.prototype.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},tt.prototype.Set=function(t,e,i,n){void 0===n&&(n=this.a),this.SetRGBA(t,e,i,n)},tt.prototype.SetByteRGB=function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this},tt.prototype.SetByteRGBA=function(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this},tt.prototype.SetRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},tt.prototype.SetRGBA=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this},tt.prototype.SelfAdd=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},tt.prototype.Add=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e},tt.prototype.SelfSub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this},tt.prototype.Sub=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e},tt.prototype.SelfMul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},tt.prototype.Mul=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e},tt.prototype.Mix=function(t,e){tt.MixColors(this,t,e)},tt.MixColors=function(t,e,i){var n=i*(e.r-t.r),r=i*(e.g-t.g),s=i*(e.b-t.b),i=i*(e.a-t.a);t.r+=n,t.g+=r,t.b+=s,t.a+=i,e.r-=n,e.g-=r,e.b-=s,e.a-=i},tt.prototype.MakeStyleString=function(t){return void 0===t&&(t=this.a),tt.MakeStyleString(this.r,this.g,this.b,t)},tt.MakeStyleString=function(t,e,i,n){return t*=255,e*=255,i*=255,(n=void 0===n?1:n)<1?"rgba("+t+","+e+","+i+","+n+")":"rgb("+t+","+e+","+i+")"},tt.ZERO=new tt(0,0,0,0),tt.RED=new tt(1,0,0),tt.GREEN=new tt(0,1,0),tt.BLUE=new tt(0,0,1);var $=tt;function tt(t,e,i,n){void 0===e&&(e=.5),void 0===i&&(i=.5),void 0===n&&(n=1),this.r=t=void 0===t?.5:t,this.g=e,this.b=i,this.a=n}(et=H.b2DrawFlags||(H.b2DrawFlags={}))[et.e_none=0]="e_none",et[et.e_shapeBit=1]="e_shapeBit",et[et.e_jointBit=2]="e_jointBit",et[et.e_aabbBit=4]="e_aabbBit",et[et.e_pairBit=8]="e_pairBit",et[et.e_centerOfMassBit=16]="e_centerOfMassBit",et[et.e_particleBit=32]="e_particleBit",et[et.e_controllerBit=64]="e_controllerBit",et[et.e_all=63]="e_all";it.prototype.SetFlags=function(t){this.m_drawFlags=t},it.prototype.GetFlags=function(){return this.m_drawFlags},it.prototype.AppendFlags=function(t){this.m_drawFlags|=t},it.prototype.ClearFlags=function(t){this.m_drawFlags&=~t};var et=it;function it(){this.m_drawFlags=0}rt.prototype.Reset=function(){return this.m_start=Date.now(),this},rt.prototype.GetMilliseconds=function(){return Date.now()-this.m_start};var nt=rt;function rt(){this.m_start=Date.now()}ot.prototype.GetCount=function(){return this.m_count},ot.prototype.GetMinCount=function(){return this.m_min_count},ot.prototype.GetMaxCount=function(){return this.m_max_count},ot.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},ot.prototype.ResetMinCount=function(){this.m_min_count=0},ot.prototype.ResetMaxCount=function(){this.m_max_count=0},ot.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},ot.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)};var st=ot;function ot(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}ct.prototype.Reset=function(){return this.m_count=0,this},ct.prototype.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++},ct.prototype.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];if((this.m_stack[this.m_count]=null)===t)throw new Error;return t},ct.prototype.GetCount=function(){return this.m_count};var at=ct;function ct(t){this.m_stack=[],this.m_count=0,this.m_stack=c(t,function(t){return null}),this.m_count=0}function lt(){}function ht(){}_t.prototype.Copy=function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this},_t.prototype.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},_t.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},_t.prototype.SetVerticesRadius=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},_t.prototype.GetSupport=function(t){for(var e=0,i=j.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var r=j.DotVV(this.m_vertices[n],t);i<r&&(e=n,i=r)}return e},_t.prototype.GetSupportVertex=function(t){for(var e=0,i=j.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var r=j.DotVV(this.m_vertices[n],t);i<r&&(e=n,i=r)}return this.m_vertices[e]},_t.prototype.GetVertexCount=function(){return this.m_count},_t.prototype.GetVertex=function(t){return this.m_vertices[t]};var ut=_t;function _t(){this.m_buffer=j.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}ft.prototype.Reset=function(){return this.metric=0,this.count=0,this};var dt=ft;function ft(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}mt.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this};var pt=mt;function mt(){this.proxyA=new ut,this.proxyB=new ut,this.transformA=new R,this.transformB=new R,this.useRadii=!1}gt.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this};var yt=gt;function gt(){this.pointA=new j,this.pointB=new j,this.distance=0,this.iterations=0}function vt(){this.proxyA=new ut,this.proxyB=new ut,this.transformA=new R,this.transformB=new R,this.translationB=new j}function xt(){this.point=new j,this.normal=new j,this.lambda=0,this.iterations=0}H.b2_gjkCalls=0,H.b2_gjkIters=0,H.b2_gjkMaxIters=0;At.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this};var bt=At;function At(){this.wA=new j,this.wB=new j,this.w=new j,this.a=0,this.indexA=0,this.indexB=0}St.prototype.ReadCache=function(t,e,i,n,h){this.m_count=t.count;for(var r,s,u=this.m_vertices,o=0;o<this.m_count;++o){(a=u[o]).indexA=t.indexA[o],a.indexB=t.indexB[o];var a,c=e.GetVertex(a.indexA),l=n.GetVertex(a.indexB);R.MulXV(i,c,a.wA),R.MulXV(h,l,a.wB),j.SubVV(a.wB,a.wA,a.w),a.a=0}1<this.m_count&&(r=t.metric,((s=this.GetMetric())<.5*r||2*r<s||s<M)&&(this.m_count=0)),0===this.m_count&&((a=u[0]).indexA=0,a.indexB=0,c=e.GetVertex(0),l=n.GetVertex(0),R.MulXV(i,c,a.wA),R.MulXV(h,l,a.wB),j.SubVV(a.wB,a.wA,a.w),a.a=1,this.m_count=1)},St.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},St.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return j.NegV(this.m_v1.w,t);case 2:var e=j.SubVV(this.m_v2.w,this.m_v1.w,t);return 0<j.CrossVV(e,j.NegV(this.m_v1.w,j.s_t0))?j.CrossOneV(e,t):j.CrossVOne(e,t);default:return t.SetZero()}},St.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return t.SetZero()}},St.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},St.prototype.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return j.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return j.CrossVV(j.SubVV(this.m_v2.w,this.m_v1.w,j.s_t0),j.SubVV(this.m_v3.w,this.m_v1.w,j.s_t1));default:return 0}},St.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=j.SubVV(e,t,St.s_e12),t=-j.DotVV(t,i);if(t<=0)return this.m_v1.a=1,void(this.m_count=1);e=j.DotVV(e,i);if(e<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);i=1/(e+t);this.m_v1.a=e*i,this.m_v2.a=t*i,this.m_count=2},St.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,n=j.SubVV(e,t,St.s_e12),r=j.DotVV(t,n),s=j.DotVV(e,n),r=-r,o=j.SubVV(i,t,St.s_e13),a=j.DotVV(t,o),h=j.DotVV(i,o),a=-a,c=j.SubVV(i,e,St.s_e23),l=j.DotVV(e,c),c=j.DotVV(i,c),l=-l,n=j.CrossVV(n,o),o=n*j.CrossVV(e,i),i=n*j.CrossVV(i,t),n=n*j.CrossVV(t,e);if(r<=0&&a<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<s&&0<r&&n<=0)return this.m_v1.a=s*(t=1/(s+r)),this.m_v2.a=r*t,void(this.m_count=2);if(0<h&&0<a&&i<=0)return this.m_v1.a=h*(e=1/(h+a)),this.m_v3.a=a*e,this.m_count=2,void this.m_v2.Copy(this.m_v3);if(s<=0&&l<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&c<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(0<c&&0<l&&o<=0)return this.m_v2.a=c*(r=1/(c+l)),this.m_v3.a=l*r,this.m_count=2,void this.m_v1.Copy(this.m_v3);t=1/(o+i+n);this.m_v1.a=o*t,this.m_v2.a=i*t,this.m_v3.a=n*t,this.m_count=3},St.s_e12=new j,St.s_e13=new j,St.s_e23=new j;var Ct=St;function St(){this.m_v1=new bt,this.m_v2=new bt,this.m_v3=new bt,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}var Tt=new Ct,wt=[0,0,0],Et=[0,0,0],Mt=new j,It=new j,Bt=new j,Rt=new j,Pt=new j;function Dt(t,e,i){++H.b2_gjkCalls;for(var n,r=i.proxyA,s=i.proxyB,h=i.transformA,u=i.transformB,o=Tt,_=(o.ReadCache(e,r,h,s,u),o.m_vertices),d=wt,f=Et,a=0;a<20;){for(var p=o.m_count,c=0;c<p;++c)d[c]=_[c].indexA,f[c]=_[c].indexB;switch(o.m_count){case 1:break;case 2:o.Solve2();break;case 3:o.Solve3()}if(3===o.m_count)break;var m=o.GetSearchDirection(It);if(m.LengthSquared()<g)break;for(var l=_[o.m_count],y=(l.indexA=r.GetSupport(B.MulTRV(h.q,j.NegV(m,j.s_t0),Rt)),R.MulXV(h,r.GetVertex(l.indexA),l.wA),l.indexB=s.GetSupport(B.MulTRV(u.q,m,Pt)),R.MulXV(u,s.GetVertex(l.indexB),l.wB),j.SubVV(l.wB,l.wA,l.w),++a,++H.b2_gjkIters,!1),c=0;c<p;++c)if(l.indexA===d[c]&&l.indexB===f[c]){y=!0;break}if(y)break;++o.m_count}H.b2_gjkMaxIters=O(H.b2_gjkMaxIters,a),o.GetWitnessPoints(t.pointA,t.pointB),t.distance=j.DistanceVV(t.pointA,t.pointB),t.iterations=a,o.WriteCache(e),i.useRadii&&(e=r.m_radius,i=s.m_radius,t.distance>e+i&&t.distance>M?(t.distance-=e+i,(n=j.SubVV(t.pointB,t.pointA,Bt)).Normalize(),t.pointA.SelfMulAdd(e,n),t.pointB.SelfMulSub(i,n)):(e=j.MidVV(t.pointA,t.pointB,Mt),t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0))}var Lt=new j,Vt=new Ct,Ot=new j,Ft=new j,Nt=new j,kt=new j,Gt=new j,zt=new j;(Zt=H.b2ContactFeatureType||(H.b2ContactFeatureType={}))[Zt.e_vertex=0]="e_vertex",Zt[Zt.e_face=1]="e_face";Object.defineProperty(Wt.prototype,"key",{get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.prototype,"indexA",{get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.prototype,"indexB",{get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.prototype,"typeA",{get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.prototype,"typeB",{get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0},enumerable:!0,configurable:!0});var Ut=Wt;function Wt(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}jt.prototype.Copy=function(t){return this.key=t.key,this},jt.prototype.Clone=function(){return(new jt).Copy(this)},Object.defineProperty(jt.prototype,"key",{get:function(){return this.cf.key},set:function(t){this.cf.key=t},enumerable:!0,configurable:!0});var Ht=jt;function jt(){this.cf=new Ut}Yt.MakeArray=function(t){return c(t,function(t){return new Yt})},Yt.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},Yt.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this};var Xt=Yt;function Yt(){this.localPoint=new j,this.normalImpulse=0,this.tangentImpulse=0,this.id=new Ht}(Zt=H.b2ManifoldType||(H.b2ManifoldType={}))[Zt.e_unknown=-1]="e_unknown",Zt[Zt.e_circles=0]="e_circles",Zt[Zt.e_faceA=1]="e_faceA",Zt[Zt.e_faceB=2]="e_faceB";Jt.prototype.Reset=function(){for(var t=0;t<2;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=H.b2ManifoldType.e_unknown,this.pointCount=0},Jt.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var e=0;e<2;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},Jt.prototype.Clone=function(){return(new Jt).Copy(this)};var qt=Jt;function Jt(){this.points=Xt.MakeArray(2),this.localNormal=new j,this.localPoint=new j,this.type=H.b2ManifoldType.e_unknown,this.pointCount=0}Kt.prototype.Initialize=function(t,e,i,n,r){if(0!==t.pointCount)switch(t.type){case H.b2ManifoldType.e_circles:this.normal.Set(1,0);var s=R.MulXV(e,t.localPoint,Kt.Initialize_s_pointA),h=R.MulXV(n,t.points[0].localPoint,Kt.Initialize_s_pointB),o=(j.DistanceSquaredVV(s,h)>g&&j.SubVV(h,s,this.normal).SelfNormalize(),j.AddVMulSV(s,i,this.normal,Kt.Initialize_s_cA)),a=j.SubVMulSV(h,r,this.normal,Kt.Initialize_s_cB);j.MidVV(o,a,this.points[0]),this.separations[0]=j.DotVV(j.SubVV(a,o,j.s_t0),this.normal);break;case H.b2ManifoldType.e_faceA:B.MulRV(e.q,t.localNormal,this.normal);for(var u=R.MulXV(e,t.localPoint,Kt.Initialize_s_planePoint),c=0;c<t.pointCount;++c){var l=R.MulXV(n,t.points[c].localPoint,Kt.Initialize_s_clipPoint),_=i-j.DotVV(j.SubVV(l,u,j.s_t0),this.normal),o=j.AddVMulSV(l,_,this.normal,Kt.Initialize_s_cA),a=j.SubVMulSV(l,r,this.normal,Kt.Initialize_s_cB);j.MidVV(o,a,this.points[c]),this.separations[c]=j.DotVV(j.SubVV(a,o,j.s_t0),this.normal)}break;case H.b2ManifoldType.e_faceB:B.MulRV(n.q,t.localNormal,this.normal);for(u=R.MulXV(n,t.localPoint,Kt.Initialize_s_planePoint),c=0;c<t.pointCount;++c){l=R.MulXV(e,t.points[c].localPoint,Kt.Initialize_s_clipPoint),_=r-j.DotVV(j.SubVV(l,u,j.s_t0),this.normal),a=j.AddVMulSV(l,_,this.normal,Kt.Initialize_s_cB),o=j.SubVMulSV(l,i,this.normal,Kt.Initialize_s_cA);j.MidVV(o,a,this.points[c]),this.separations[c]=j.DotVV(j.SubVV(o,a,j.s_t0),this.normal)}this.normal.SelfNeg()}},Kt.Initialize_s_pointA=new j,Kt.Initialize_s_pointB=new j,Kt.Initialize_s_cA=new j,Kt.Initialize_s_cB=new j,Kt.Initialize_s_planePoint=new j,Kt.Initialize_s_clipPoint=new j;var Zt=Kt;function Kt(){this.normal=new j,this.points=j.MakeArray(2),this.separations=h(2)}(Qt=H.b2PointState||(H.b2PointState={}))[Qt.b2_nullState=0]="b2_nullState",Qt[Qt.b2_addState=1]="b2_addState",Qt[Qt.b2_persistState=2]="b2_persistState",Qt[Qt.b2_removeState=3]="b2_removeState";$t.MakeArray=function(t){return c(t,function(t){return new $t})},$t.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this};var Qt=$t;function $t(){this.v=new j,this.id=new Ht}ee.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this};var te=ee;function ee(){this.p1=new j,this.p2=new j,this.maxFraction=1}ne.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this};var ie=ne;function ne(){this.normal=new j,this.fraction=0}se.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},se.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 0<=t&&0<=e&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},se.prototype.GetCenter=function(){return j.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},se.prototype.GetExtents=function(){return j.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},se.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},se.prototype.Combine1=function(t){return this.lowerBound.x=V(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=V(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=O(this.upperBound.x,t.upperBound.x),this.upperBound.y=O(this.upperBound.y,t.upperBound.y),this},se.prototype.Combine2=function(t,e){return this.lowerBound.x=V(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=V(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=O(t.upperBound.x,e.upperBound.x),this.upperBound.y=O(t.upperBound.y,e.upperBound.y),this},se.Combine=function(t,e,i){return i.Combine2(t,e),i},se.prototype.Contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},se.prototype.RayCast=function(h,t){var e=-P,i=P,n=t.p1.x,r=t.p1.y,u=t.p2.x-t.p1.x,_=t.p2.y-t.p1.y,d=L(u),f=L(_),s=h.normal;if(d<M){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{var o=1/u,a=(this.lowerBound.x-n)*o,c=-1;if((l=(this.upperBound.x-n)*o)<a&&(p=a,a=l,l=p,c=1),e<a&&(s.x=c,s.y=0,e=a),(i=V(i,l))<e)return!1}if(f<M){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{var l,p,o=1/_,a=(this.lowerBound.y-r)*o,c=-1;if((l=(this.upperBound.y-r)*o)<a&&(p=a,a=l,l=p,c=1),e<a&&(s.x=0,s.y=c,e=a),(i=V(i,l))<e)return!1}return!(e<0||t.maxFraction<e)&&(h.fraction=e,!0)},se.prototype.TestContain=function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y)},se.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,n=this.lowerBound.x-t.upperBound.x,t=this.lowerBound.y-t.upperBound.y;return!(0<e||0<i)&&!(0<n||0<t)};var re=se;function se(){this.lowerBound=new j,this.upperBound=new j,this.m_cache_center=new j,this.m_cache_extent=new j}function oe(t,e){var i=e.lowerBound.x-t.upperBound.x,n=e.lowerBound.y-t.upperBound.y,r=t.lowerBound.x-e.upperBound.x,t=t.lowerBound.y-e.upperBound.y;return!(0<i||0<n)&&!(0<r||0<t)}function ae(t,e,i,n,r){var s=0,o=e[0],e=e[1],a=j.DotVV(i,o.v)-n,i=j.DotVV(i,e.v)-n;return a<=0&&t[s++].Copy(o),i<=0&&t[s++].Copy(e),a*i<0&&((n=t[s].v).x=o.v.x+(a=a/(a-i))*(e.v.x-o.v.x),n.y=o.v.y+a*(e.v.y-o.v.y),(i=t[s].id).cf.indexA=r,i.cf.indexB=o.id.cf.indexB,i.cf.typeA=H.b2ContactFeatureType.e_vertex,i.cf.typeB=H.b2ContactFeatureType.e_face,++s),s}var ce=new pt,le=new dt,he=new yt;function ue(t,e,i,n,r,s){var o=ce.Reset(),t=(o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,n),o.transformA.Copy(r),o.transformB.Copy(s),o.useRadii=!0,le.Reset()),e=(t.count=0,he.Reset());return Dt(e,t,o),e.distance<10*M}function _e(t){if(null===t)throw new Error;return t}fe.prototype.IsLeaf=function(){return null===this.child1};var de=fe;function fe(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new re,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}me.prototype.Query=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);0<i.GetCount();){var n=i.Pop();if(n.aabb.TestOverlap(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(_e(n.child1)),i.Push(_e(n.child2))}}},me.prototype.QueryPoint=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);0<i.GetCount();){var n=i.Pop();if(n.aabb.TestContain(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(_e(n.child1)),i.Push(_e(n.child2))}}},me.prototype.RayCast=function(t,h){if(null!==this.m_root){var e=t.p1,i=t.p2,u=j.SubVV(i,e,me.s_r),_=(u.Normalize(),j.CrossOneV(u,me.s_v)),d=j.AbsV(_,me.s_abs_v),n=t.maxFraction,r=me.s_segmentAABB,s=e.x+n*(i.x-e.x),o=e.y+n*(i.y-e.y),a=(r.lowerBound.x=V(e.x,s),r.lowerBound.y=V(e.y,o),r.upperBound.x=O(e.x,s),r.upperBound.y=O(e.y,o),this.m_stack.Reset());for(a.Push(this.m_root);0<a.GetCount();){var c=a.Pop();if(oe(c.aabb,r)){var l=c.aabb.GetCenter(),f=c.aabb.GetExtents();if(!(0<L(j.DotVV(_,j.SubVV(e,l,j.s_t0)))-j.DotVV(d,f)))if(c.IsLeaf()){l=me.s_subInput,f=(l.p1.Copy(t.p1),l.p2.Copy(t.p2),l.maxFraction=n,h(l,c));if(0===f)return;0<f&&(s=e.x+(n=f)*(i.x-e.x),o=e.y+n*(i.y-e.y),r.lowerBound.x=V(e.x,s),r.lowerBound.y=V(e.y,o),r.upperBound.x=O(e.x,s),r.upperBound.y=O(e.y,o))}else a.Push(_e(c.child1)),a.Push(_e(c.child2))}}}},me.prototype.AllocateNode=function(){var t;return this.m_freeList?(t=this.m_freeList,this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,delete t.userData,t):new de(me.s_node_id++)},me.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t},me.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();return i.aabb.lowerBound.x=t.lowerBound.x-.1,i.aabb.lowerBound.y=t.lowerBound.y-.1,i.aabb.upperBound.x=t.upperBound.x+.1,i.aabb.upperBound.y=t.upperBound.y+.1,i.userData=e,i.height=0,this.InsertLeaf(i),i},me.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},me.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=.1+2*(0<i.x?i.x:-i.x),i=.1+2*(0<i.y?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-i,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+i,this.InsertLeaf(t),!0},me.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;!i.IsLeaf();){var n=_e(i.child1),r=_e(i.child2),h=i.aabb.GetPerimeter(),s=me.s_combinedAABB,s=(s.Combine2(i.aabb,e),s.GetPerimeter()),u=2*s,s=2*(s-h),h=void 0,o=me.s_aabb,_=void 0,h=n.IsLeaf()?(o.Combine2(e,n.aabb),o.GetPerimeter()+s):(o.Combine2(e,n.aabb),_=n.aabb.GetPerimeter(),o.GetPerimeter()-_+s),d=void 0,d=r.IsLeaf()?(o.Combine2(e,r.aabb),o.GetPerimeter()+s):(o.Combine2(e,r.aabb),_=r.aabb.GetPerimeter(),o.GetPerimeter()-_+s);if(u<h&&u<d)break;i=h<d?n:r}for(var a=i,f=a.parent,c=this.AllocateNode(),l=(c.parent=f,delete c.userData,c.aabb.Combine2(e,a.aabb),c.height=a.height+1,f?(f.child1===a?f.child1=c:f.child2=c,c.child1=a,c.child2=t,a.parent=c,t.parent=c):(c.child1=a,c.child2=t,a.parent=c,t.parent=c,this.m_root=c),t.parent);null!==l;){n=_e((l=this.Balance(l)).child1),r=_e(l.child2);l.height=1+O(n.height,r.height),l.aabb.Combine2(n.aabb,r.aabb),l=l.parent}},me.prototype.RemoveLeaf=function(t){if(t!==this.m_root){var e=_e(t.parent),i=e&&e.parent,t=e.child1===t?_e(e.child2):_e(e.child1);if(i){i.child1===e?i.child1=t:i.child2=t,t.parent=i,this.FreeNode(e);for(var n=i;n;){var r=_e((n=this.Balance(n)).child1),s=_e(n.child2);n.aabb.Combine2(r.aabb,s.aabb),n.height=1+O(r.height,s.height),n=n.parent}}else(this.m_root=t).parent=null,this.FreeNode(e)}else this.m_root=null},me.prototype.Balance=function(t){if(t.IsLeaf()||t.height<2)return t;var e,i,n=_e(t.child1),r=_e(t.child2),s=r.height-n.height;return 1<s?(e=_e(r.child1),i=_e(r.child2),r.child1=t,r.parent=t.parent,null!==(t.parent=r).parent?r.parent.child1===t?r.parent.child1=r:r.parent.child2=r:this.m_root=r,e.height>i.height?(r.child2=e,((t.child2=i).parent=t).aabb.Combine2(n.aabb,i.aabb),r.aabb.Combine2(t.aabb,e.aabb),t.height=1+O(n.height,i.height),r.height=1+O(t.height,e.height)):(r.child2=i,((t.child2=e).parent=t).aabb.Combine2(n.aabb,e.aabb),r.aabb.Combine2(t.aabb,i.aabb),t.height=1+O(n.height,e.height),r.height=1+O(t.height,i.height)),r):s<-1?(e=_e(n.child1),i=_e(n.child2),n.child1=t,n.parent=t.parent,null!==(t.parent=n).parent?n.parent.child1===t?n.parent.child1=n:n.parent.child2=n:this.m_root=n,e.height>i.height?(n.child2=e,((t.child1=i).parent=t).aabb.Combine2(r.aabb,i.aabb),n.aabb.Combine2(t.aabb,e.aabb),t.height=1+O(r.height,i.height),n.height=1+O(t.height,e.height)):(n.child2=i,((t.child1=e).parent=t).aabb.Combine2(r.aabb,e.aabb),n.aabb.Combine2(t.aabb,i.aabb),t.height=1+O(r.height,e.height),n.height=1+O(t.height,i.height)),n):t},me.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height},me.GetAreaNode=function(t){if(null===t)return 0;if(t.IsLeaf())return 0;var e=t.aabb.GetPerimeter();return(e+=me.GetAreaNode(t.child1))+me.GetAreaNode(t.child2)},me.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var t=this.m_root.aabb.GetPerimeter();return me.GetAreaNode(this.m_root)/t},me.prototype.ComputeHeightNode=function(t){if(!t||t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),t=this.ComputeHeightNode(t.child2);return 1+O(e,t)},me.prototype.ComputeHeight=function(){return this.ComputeHeightNode(this.m_root)},me.prototype.ValidateStructure=function(t){var e;null!==t&&(this.m_root,(t=t).IsLeaf()||(e=_e(t.child1),t=_e(t.child2),this.ValidateStructure(e),this.ValidateStructure(t)))},me.prototype.ValidateMetrics=function(t){var e;null!==t&&((t=t).IsLeaf()||(e=_e(t.child1),t=_e(t.child2),me.s_aabb.Combine2(e.aabb,t.aabb),this.ValidateMetrics(e),this.ValidateMetrics(t)))},me.prototype.Validate=function(){},me.GetMaxBalanceNode=function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=_e(t.child1),t=_e(t.child2),t=L(t.height-i.height);return O(e,t)},me.prototype.GetMaxBalance=function(){return me.GetMaxBalanceNode(this.m_root,0)},me.prototype.RebuildBottomUp=function(){this.Validate()},me.ShiftOriginNode=function(t,e){var i,n;null!==t&&(t.height<=1||(i=t.child1,n=t.child2,me.ShiftOriginNode(i,e),me.ShiftOriginNode(n,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)))},me.prototype.ShiftOrigin=function(t){me.ShiftOriginNode(this.m_root,t)},me.s_r=new j,me.s_v=new j,me.s_abs_v=new j,me.s_segmentAABB=new re,me.s_subInput=new te,me.s_combinedAABB=new re,me.s_aabb=new re,me.s_node_id=0;var pe=me;function me(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new at(256)}var ye=function(t,e){this.proxyA=t,this.proxyB=e},ge=(ve.prototype.CreateProxy=function(t,e){t=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(t),t},ve.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},ve.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},ve.prototype.TouchProxy=function(t){this.BufferMove(t)},ve.prototype.GetProxyCount=function(){return this.m_proxyCount},ve.prototype.UpdatePairs=function(t){for(var r=this,e=(this.m_pairCount=0,this),i=0;i<this.m_moveCount;++i)!function(t){var n=e.m_moveBuffer[t];if(null===n)return;t=n.aabb;e.m_tree.Query(t,function(t){if(t.m_id===n.m_id)return!0;var e,i,t=t.m_id<n.m_id?(e=t,n):(e=n,t);return r.m_pairCount===r.m_pairBuffer.length?r.m_pairBuffer[r.m_pairCount]=new ye(e,t):((i=r.m_pairBuffer[r.m_pairCount]).proxyA=e,i.proxyB=t),++r.m_pairCount,!0})}(i);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(xe);for(var n=0;n<this.m_pairCount;){var s=this.m_pairBuffer[n],o=s.proxyA.userData,a=s.proxyB.userData;for(o&&a&&t(o,a),++n;n<this.m_pairCount;){var c=this.m_pairBuffer[n];if(c.proxyA.m_id!==s.proxyA.m_id||c.proxyB.m_id!==s.proxyB.m_id)break;++n}}},ve.prototype.Query=function(t,e){this.m_tree.Query(t,e)},ve.prototype.QueryPoint=function(t,e){this.m_tree.QueryPoint(t,e)},ve.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},ve.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},ve.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},ve.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},ve.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},ve.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},ve.prototype.UnBufferMove=function(t){t=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[t]=null},ve);function ve(){this.m_tree=new pe,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}function xe(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}H.b2_toiTime=0,H.b2_toiMaxTime=0,H.b2_toiCalls=0,H.b2_toiIters=0,H.b2_toiMaxIters=0,H.b2_toiRootIters=0,H.b2_toiMaxRootIters=0;var be=new R,Ae=new R,Ce=new j,Se=new j,Te=new j,we=new j,Ee=new j,Me=function(){this.proxyA=new ut,this.proxyB=new ut,this.sweepA=new K,this.sweepB=new K,this.tMax=0},Ie=((Ie=H.b2TOIOutputState||(H.b2TOIOutputState={}))[Ie.e_unknown=0]="e_unknown",Ie[Ie.e_failed=1]="e_failed",Ie[Ie.e_overlapped=2]="e_overlapped",Ie[Ie.e_touching=3]="e_touching",Ie[Ie.e_separated=4]="e_separated",function(){this.state=H.b2TOIOutputState.e_unknown,this.t=0}),Be=((Be=H.b2SeparationFunctionType||(H.b2SeparationFunctionType={}))[Be.e_unknown=-1]="e_unknown",Be[Be.e_points=0]="e_points",Be[Be.e_faceA=1]="e_faceA",Be[Be.e_faceB=2]="e_faceB",Re.prototype.Initialize=function(t,e,i,n,r,s){this.m_proxyA=e,this.m_proxyB=n;var o,e=t.count,n=(this.m_sweepA.Copy(i),this.m_sweepB.Copy(r),be),i=Ae;if(this.m_sweepA.GetTransform(n,s),this.m_sweepB.GetTransform(i,s),1===e)return this.m_type=H.b2SeparationFunctionType.e_points,o=this.m_proxyA.GetVertex(t.indexA[0]),u=this.m_proxyB.GetVertex(t.indexB[0]),c=R.MulXV(n,o,Ce),l=R.MulXV(i,u,Se),j.SubVV(l,c,this.m_axis),a=this.m_axis.Normalize(),this.m_localPoint.SetZero(),a;if(t.indexA[0]===t.indexA[1])return this.m_type=H.b2SeparationFunctionType.e_faceB,r=this.m_proxyB.GetVertex(t.indexB[0]),s=this.m_proxyB.GetVertex(t.indexB[1]),j.CrossVOne(j.SubVV(s,r,j.s_t0),this.m_axis).SelfNormalize(),h=B.MulRV(i.q,this.m_axis,Te),j.MidVV(r,s,this.m_localPoint),l=R.MulXV(i,this.m_localPoint,Se),o=this.m_proxyA.GetVertex(t.indexA[0]),c=R.MulXV(n,o,Ce),(a=j.DotVV(j.SubVV(c,l,j.s_t0),h))<0&&(this.m_axis.SelfNeg(),a=-a),a;this.m_type=H.b2SeparationFunctionType.e_faceA;var a,e=this.m_proxyA.GetVertex(t.indexA[0]),r=this.m_proxyA.GetVertex(t.indexA[1]),h=(j.CrossVOne(j.SubVV(r,e,j.s_t0),this.m_axis).SelfNormalize(),B.MulRV(n.q,this.m_axis,Te)),c=(j.MidVV(e,r,this.m_localPoint),R.MulXV(n,this.m_localPoint,Ce)),u=this.m_proxyB.GetVertex(t.indexB[0]),l=R.MulXV(i,u,Se);return(a=j.DotVV(j.SubVV(l,c,j.s_t0),h))<0&&(this.m_axis.SelfNeg(),a=-a),a},Re.prototype.FindMinSeparation=function(t,e,i){var n=be,r=Ae;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(r,i),this.m_type){case H.b2SeparationFunctionType.e_points:var s=B.MulTRV(n.q,this.m_axis,we),h=B.MulTRV(r.q,j.NegV(this.m_axis,j.s_t0),Ee),o=(t[0]=this.m_proxyA.GetSupport(s),e[0]=this.m_proxyB.GetSupport(h),this.m_proxyA.GetVertex(t[0])),u=this.m_proxyB.GetVertex(e[0]),a=R.MulXV(n,o,Ce),c=R.MulXV(r,u,Se);return j.DotVV(j.SubVV(c,a,j.s_t0),this.m_axis);case H.b2SeparationFunctionType.e_faceA:var l=B.MulRV(n.q,this.m_axis,Te),a=R.MulXV(n,this.m_localPoint,Ce),h=B.MulTRV(r.q,j.NegV(l,j.s_t0),Ee),u=(t[0]=-1,e[0]=this.m_proxyB.GetSupport(h),this.m_proxyB.GetVertex(e[0])),c=R.MulXV(r,u,Se);return j.DotVV(j.SubVV(c,a,j.s_t0),l);case H.b2SeparationFunctionType.e_faceB:l=B.MulRV(r.q,this.m_axis,Te),c=R.MulXV(r,this.m_localPoint,Se),s=B.MulTRV(n.q,j.NegV(l,j.s_t0),we),o=(e[0]=-1,t[0]=this.m_proxyA.GetSupport(s),this.m_proxyA.GetVertex(t[0])),a=R.MulXV(n,o,Ce);return j.DotVV(j.SubVV(a,c,j.s_t0),l);default:return t[0]=-1,e[0]=-1,0}},Re.prototype.Evaluate=function(t,e,i){var n=be,r=Ae;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(r,i),this.m_type){case H.b2SeparationFunctionType.e_points:var s=this.m_proxyA.GetVertex(t),o=this.m_proxyB.GetVertex(e),a=R.MulXV(n,s,Ce),c=R.MulXV(r,o,Se);return j.DotVV(j.SubVV(c,a,j.s_t0),this.m_axis);case H.b2SeparationFunctionType.e_faceA:var l=B.MulRV(n.q,this.m_axis,Te),a=R.MulXV(n,this.m_localPoint,Ce),o=this.m_proxyB.GetVertex(e),c=R.MulXV(r,o,Se);return j.DotVV(j.SubVV(c,a,j.s_t0),l);case H.b2SeparationFunctionType.e_faceB:l=B.MulRV(r.q,this.m_axis,Te),c=R.MulXV(r,this.m_localPoint,Se),s=this.m_proxyA.GetVertex(t),a=R.MulXV(n,s,Ce);return j.DotVV(j.SubVV(a,c,j.s_t0),l);default:return 0}},Re);function Re(){this.m_sweepA=new K,this.m_sweepB=new K,this.m_type=H.b2SeparationFunctionType.e_unknown,this.m_localPoint=new j,this.m_axis=new j}var Pe=new nt,De=new dt,Le=new pt,Ve=new yt,Oe=new Be,Fe=[0],Ne=[0],ke=new K,Ge=new K;function ze(t,e){var h=Pe.Reset(),u=(++H.b2_toiCalls,t.state=H.b2TOIOutputState.e_unknown,t.t=e.tMax,e.proxyA),_=e.proxyB,d=ke.Copy(e.sweepA),f=Ge.Copy(e.sweepB),p=(d.Normalize(),f.Normalize(),e.tMax),i=u.m_radius+_.m_radius,n=O(I,i-.024),r=0,m=0,y=De,s=(y.count=0,Le);for(s.proxyA.Copy(e.proxyA),s.proxyB.Copy(e.proxyB),s.useRadii=!1;;){var o=be,g=Ae,o=(d.GetTransform(o,r),f.GetTransform(g,r),s.transformA.Copy(o),s.transformB.Copy(g),Ve);if(Dt(o,y,s),o.distance<=0){t.state=H.b2TOIOutputState.e_overlapped,t.t=0;break}if(o.distance<n+.002){t.state=H.b2TOIOutputState.e_touching,t.t=r;break}for(var a=Oe,c=(a.Initialize(y,u,d,_,f,r),!1),v=p,x=0;;){var b=Fe,A=Ne,C=a.FindMinSeparation(b,A,v);if(n+.002<C){t.state=H.b2TOIOutputState.e_separated,t.t=p,c=!0;break}if(n-.002<C){r=v;break}var l=a.Evaluate(b[0],A[0],r);if(l<n-.002){t.state=H.b2TOIOutputState.e_failed,t.t=r,c=!0;break}if(l<=n+.002){t.state=H.b2TOIOutputState.e_touching,t.t=r,c=!0;break}for(var S=0,T=r,w=v;;){var E=1&S?T+(n-l)*(w-T)/(C-l):.5*(T+w),M=(++S,++H.b2_toiRootIters,a.Evaluate(b[0],A[0],E));if(L(M-n)<.002){v=E;break}if(n<M?(T=E,l=M):(w=E,C=M),50===S)break}if(H.b2_toiMaxRootIters=O(H.b2_toiMaxRootIters,S),8===++x)break}if(++m,++H.b2_toiIters,c)break;if(20===m){t.state=H.b2TOIOutputState.e_failed,t.t=r;break}}H.b2_toiMaxIters=O(H.b2_toiMaxIters,m);i=h.GetMilliseconds();H.b2_toiMaxTime=O(H.b2_toiMaxTime,i),H.b2_toiTime+=i}var Ue=new j,We=new j;function He(t,e,i,n,r){t.pointCount=0;i=R.MulXV(i,e.m_p,Ue),r=R.MulXV(r,n.m_p,We),i=j.DistanceSquaredVV(i,r),r=e.m_radius+n.m_radius;r*r<i||(t.type=H.b2ManifoldType.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0)}var je=new j,Xe=new j,Ye=new j;function qe(t,e,i,n,r){t.pointCount=0;for(var r=R.MulXV(r,n.m_p,je),s=R.MulTXV(i,r,Xe),h=0,u=-P,o=e.m_radius+n.m_radius,_=e.m_count,d=e.m_vertices,a=e.m_normals,c=0;c<_;++c){var f=j.DotVV(a[c],j.SubVV(s,d[c],j.s_t0));if(o<f)return;u<f&&(u=f,h=c)}i=h,r=d[i],e=d[(i+1)%_];if(u<M)return t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,t.localNormal.Copy(a[h]),j.MidVV(r,e,t.localPoint),t.points[0].localPoint.Copy(n.m_p),void(t.points[0].id.key=0);var l=j.DotVV(j.SubVV(s,r,j.s_t0),j.SubVV(e,r,j.s_t1)),p=j.DotVV(j.SubVV(s,e,j.s_t0),j.SubVV(r,e,j.s_t1));l<=0?j.DistanceSquaredVV(s,r)>o*o||(t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,j.SubVV(s,r,t.localNormal).SelfNormalize(),t.localPoint.Copy(r),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0):p<=0?j.DistanceSquaredVV(s,e)>o*o||(t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,j.SubVV(s,e,t.localNormal).SelfNormalize(),t.localPoint.Copy(e),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0):(l=j.MidVV(r,e,Ye),o<j.DotVV(j.SubVV(s,l,j.s_t1),a[i])||(t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,t.localNormal.Copy(a[i]).SelfNormalize(),t.localPoint.Copy(l),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0))}var Je=new j,Ze=new j,Ke=new j,Qe=new j;function $e(t,e,i,n,r){for(var h=t.m_vertices,t=t.m_normals,u=n.m_count,s=n.m_vertices,n=B.MulRV(e.q,t[i],Je),_=B.MulTRV(r.q,n,Ze),o=0,a=P,c=0;c<u;++c){var l=j.DotVV(s[c],_);l<a&&(a=l,o=c)}t=R.MulXV(e,h[i],Ke),e=R.MulXV(r,s[o],Qe);return j.DotVV(j.SubVV(e,t,j.s_t0),n)}var ti=new j,ei=new j;function ii(h,t,e,i,n){for(var r=t.m_count,u=t.m_normals,_=j.SubVV(R.MulXV(n,i.m_centroid,j.s_t0),R.MulXV(e,t.m_centroid,j.s_t1),ti),d=B.MulTRV(e.q,_,ei),s=0,f=-P,o=0;o<r;++o){var p=j.DotVV(u[o],d);f<p&&(f=p,s=o)}var a=$e(t,e,s,i,n),_=(s+r-1)%r,m=$e(t,e,_,i,n),y=(s+1)%r,g=$e(t,e,y,i,n),c=0,l=0,v=0;if(a<m&&g<m)v=-1,c=_,l=m;else{if(!(a<g))return h[0]=s,a;v=1,c=y,l=g}for(;;){if(!(l<(a=$e(t,e,s=-1===v?(c+r-1)%r:(c+1)%r,i,n))))break;c=s,l=a}return h[0]=c,l}var ni=new j;var ri=Qt.MakeArray(2),si=Qt.MakeArray(2),oi=Qt.MakeArray(2),ai=[0],ci=[0],li=new j,hi=new j,ui=new j,_i=new j,di=new j,fi=new j,pi=new j,mi=new j;function yi(t,e,i,n,r){t.pointCount=0;var h=e.m_radius+n.m_radius,u=ai,_=(u[0]=0,ii(u,e,i,n,r));if(!(h<_)){var s=ci,o=(s[0]=0,ii(s,n,r,e,i));if(!(h<o)){for(var d,f,p=0,m=0,m=.98*_+.001<o?(d=n,a=e,w=r,f=i,p=s[0],t.type=H.b2ManifoldType.e_faceB,1):(d=e,a=n,w=i,f=r,p=u[0],t.type=H.b2ManifoldType.e_faceA,0),_=ri,o=_,s=w,e=p,n=a,i=f,r=(r=d).m_normals,y=n.m_count,u=n.m_vertices,g=n.m_normals,v=B.MulTRV(i.q,B.MulRV(s.q,r[e],j.s_t0),ni),x=0,b=P,A=0;A<y;++A){var C=j.DotVV(v,g[A]);C<b&&(b=C,x=A)}s=((n=x)+1)%y,r=o[0],R.MulXV(i,u[n],r.v),(r=r.id.cf).indexA=e,r.indexB=n,r.typeA=H.b2ContactFeatureType.e_face,r.typeB=H.b2ContactFeatureType.e_vertex,n=o[1],R.MulXV(i,u[s],n.v),(r=n.id.cf).indexA=e,r.indexB=s,r.typeA=H.b2ContactFeatureType.e_face,r.typeB=H.b2ContactFeatureType.e_vertex;var a=d.m_count,o=d.m_vertices,i=p,u=(p+1)%a,n=o[i],e=o[u],s=j.SubVV(e,n,li),r=(s.Normalize(),j.CrossVOne(s,hi)),p=j.MidVV(n,e,ui),a=B.MulRV(w.q,s,di),S=j.CrossVOne(a,_i),o=R.MulXV(w,n,pi),s=R.MulXV(w,e,mi),T=j.DotVV(S,o),n=-j.DotVV(a,o)+h,w=j.DotVV(a,s)+h,e=si,E=oi,o=ae(e,_,j.NegV(a,fi),n,i);if(!(o<2||ae(E,e,a,w,u)<2)){t.localNormal.Copy(r),t.localPoint.Copy(p);for(var M=0,I=0;I<2;++I){var c,l=E[I];j.DotVV(S,l.v)-T<=h&&(c=t.points[M],R.MulTXV(f,l.v,c.localPoint),c.id.Copy(l.id),m&&(l=c.id.cf,c.id.cf.indexA=l.indexB,c.id.cf.indexB=l.indexA,c.id.cf.typeA=l.typeB,c.id.cf.typeB=l.typeA),++M)}t.pointCount=M}}}}var gi=new j,vi=new j,xi=new j,bi=new j,Ai=new j,Ci=new j,Si=new j,Ti=new Ht;function wi(t,e,i,h,n){t.pointCount=0;var i=R.MulTXV(i,R.MulXV(n,h.m_p,j.s_t0),gi),n=e.m_vertex1,r=e.m_vertex2,s=j.SubVV(r,n,vi),u=j.DotVV(s,j.SubVV(r,i,j.s_t0)),_=j.DotVV(s,j.SubVV(i,n,j.s_t0)),d=e.m_radius+h.m_radius,o=Ti;if(o.cf.indexB=0,o.cf.typeB=H.b2ContactFeatureType.e_vertex,_<=0){var a=n,c=j.SubVV(i,a,xi);if(d*d<j.DotVV(c,c))return;if(e.m_hasVertex0){var c=e.m_vertex0,l=n,c=j.SubVV(l,c,bi);if(0<j.DotVV(c,j.SubVV(l,i,j.s_t0)))return}return o.cf.indexA=0,o.cf.typeA=H.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=H.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(a),t.points[0].id.Copy(o),void t.points[0].localPoint.Copy(h.m_p)}if(u<=0){c=r,l=j.SubVV(i,c,xi);if(d*d<j.DotVV(l,l))return;if(e.m_hasVertex3){a=e.m_vertex3,l=r,e=j.SubVV(a,l,Ai);if(0<j.DotVV(e,j.SubVV(i,l,j.s_t0)))return}return o.cf.indexA=1,o.cf.typeA=H.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=H.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(o),void t.points[0].localPoint.Copy(h.m_p)}a=j.DotVV(s,s),e=Ci,e.x=1/a*(u*n.x+_*r.x),e.y=1/a*(u*n.y+_*r.y),l=j.SubVV(i,e,xi);d*d<j.DotVV(l,l)||(c=Si.Set(-s.y,s.x),j.DotVV(c,j.SubVV(i,n,j.s_t0))<0&&c.Set(-c.x,-c.y),c.Normalize(),o.cf.indexA=0,o.cf.typeA=H.b2ContactFeatureType.e_face,t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,t.localNormal.Copy(c),t.localPoint.Copy(n),t.points[0].id.Copy(o),t.points[0].localPoint.Copy(h.m_p))}var Ei=function(){this.type=0,this.index=0,this.separation=0},Mi=function(){this.vertices=j.MakeArray(8),this.normals=j.MakeArray(8),this.count=0},Ii=function(){this.i1=0,this.i2=0,this.v1=new j,this.v2=new j,this.normal=new j,this.sideNormal1=new j,this.sideOffset1=0,this.sideNormal2=new j,this.sideOffset2=0};function Bi(){this.m_polygonB=new Mi,this.m_xf=new R,this.m_centroidB=new j,this.m_v0=new j,this.m_v1=new j,this.m_v2=new j,this.m_v3=new j,this.m_normal0=new j,this.m_normal1=new j,this.m_normal2=new j,this.m_normal=new j,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new j,this.m_upperLimit=new j,this.m_radius=0,this.m_front=!1}Bi.prototype.Collide=function(t,h,e,u,_){R.MulTXX(e,_,this.m_xf),R.MulXV(this.m_xf,u.m_centroid,this.m_centroidB),this.m_v0.Copy(h.m_vertex0),this.m_v1.Copy(h.m_vertex1),this.m_v2.Copy(h.m_vertex2),this.m_v3.Copy(h.m_vertex3);var e=h.m_hasVertex0,_=h.m_hasVertex3,i=j.SubVV(this.m_v2,this.m_v1,Bi.s_edge1),n=(i.Normalize(),this.m_normal1.Set(i.y,-i.x),j.DotVV(this.m_normal1,j.SubVV(this.m_centroidB,this.m_v1,j.s_t0))),r=0,d=0,f=!1,p=!1;e&&((o=j.SubVV(this.m_v1,this.m_v0,Bi.s_edge0)).Normalize(),this.m_normal0.Set(o.y,-o.x),f=0<=j.CrossVV(o,i),r=j.DotVV(this.m_normal0,j.SubVV(this.m_centroidB,this.m_v0,j.s_t0))),_&&((o=j.SubVV(this.m_v3,this.m_v2,Bi.s_edge2)).Normalize(),this.m_normal2.Set(o.y,-o.x),p=0<j.CrossVV(i,o),d=j.DotVV(this.m_normal2,j.SubVV(this.m_centroidB,this.m_v2,j.s_t0))),e&&_?f&&p?(this.m_front=0<=r||0<=n||0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):f?(this.m_front=0<=r||0<=n&&0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):p?(this.m_front=0<=d||0<=r&&0<=n,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=0<=r&&0<=n&&0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):e?f?(this.m_front=0<=r||0<=n,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1)),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_front=0<=r&&0<=n,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):_?p?(this.m_front=0<=n||0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=0<=n&&0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg()),this.m_upperLimit.Copy(this.m_normal1)):(this.m_front=0<=n,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=u.m_count;for(var s=0;s<u.m_count;++s)R.MulXV(this.m_xf,u.m_vertices[s],this.m_polygonB.vertices[s]),B.MulRV(this.m_xf.q,u.m_normals[s],this.m_polygonB.normals[s]);this.m_radius=u.m_radius+h.m_radius,t.pointCount=0;i=this.ComputeEdgeSeparation(Bi.s_edgeAxis);if(0!==i.type&&!(i.separation>this.m_radius)){var o=this.ComputePolygonSeparation(Bi.s_polygonAxis);if(!(0!==o.type&&o.separation>this.m_radius)){var m=0!==o.type&&o.separation>.98*i.separation+.001?o:i,e=Bi.s_ie,a=Bi.s_rf;if(1===m.type){t.type=H.b2ManifoldType.e_faceA;for(var y=0,g=j.DotVV(this.m_normal,this.m_polygonB.normals[0]),s=1;s<this.m_polygonB.count;++s){var v=j.DotVV(this.m_normal,this.m_polygonB.normals[s]);v<g&&(g=v,y=s)}var c,l,f=y,r=(f+1)%this.m_polygonB.count;(c=e[0]).v.Copy(this.m_polygonB.vertices[f]),c.id.cf.indexA=0,c.id.cf.indexB=f,c.id.cf.typeA=H.b2ContactFeatureType.e_face,c.id.cf.typeB=H.b2ContactFeatureType.e_vertex,(l=e[1]).v.Copy(this.m_polygonB.vertices[r]),l.id.cf.indexA=0,l.id.cf.indexB=r,l.id.cf.typeA=H.b2ContactFeatureType.e_face,l.id.cf.typeB=H.b2ContactFeatureType.e_vertex,this.m_front?(a.i1=0,a.i2=1,a.v1.Copy(this.m_v1),a.v2.Copy(this.m_v2),a.normal.Copy(this.m_normal1)):(a.i1=1,a.i2=0,a.v1.Copy(this.m_v2),a.v2.Copy(this.m_v1),a.normal.Copy(this.m_normal1).SelfNeg())}else t.type=H.b2ManifoldType.e_faceB,(c=e[0]).v.Copy(this.m_v1),c.id.cf.indexA=0,c.id.cf.indexB=m.index,c.id.cf.typeA=H.b2ContactFeatureType.e_vertex,c.id.cf.typeB=H.b2ContactFeatureType.e_face,(l=e[1]).v.Copy(this.m_v2),l.id.cf.indexA=0,l.id.cf.indexB=m.index,l.id.cf.typeA=H.b2ContactFeatureType.e_vertex,l.id.cf.typeB=H.b2ContactFeatureType.e_face,a.i1=m.index,a.i2=(a.i1+1)%this.m_polygonB.count,a.v1.Copy(this.m_polygonB.vertices[a.i1]),a.v2.Copy(this.m_polygonB.vertices[a.i2]),a.normal.Copy(this.m_polygonB.normals[a.i1]);a.sideNormal1.Set(a.normal.y,-a.normal.x),a.sideNormal2.Copy(a.sideNormal1).SelfNeg(),a.sideOffset1=j.DotVV(a.sideNormal1,a.v1),a.sideOffset2=j.DotVV(a.sideNormal2,a.v2);var _=Bi.s_clipPoints1,x=Bi.s_clipPoints2,p=ae(_,e,a.sideNormal1,a.sideOffset1,a.i1);if(!(p<2||ae(x,_,a.sideNormal2,a.sideOffset2,a.i2)<2)){1===m.type?(t.localNormal.Copy(a.normal),t.localPoint.Copy(a.v1)):(t.localNormal.Copy(u.m_normals[a.i1]),t.localPoint.Copy(u.m_vertices[a.i1]));for(var b=0,s=0;s<2;++s){var A;j.DotVV(a.normal,j.SubVV(x[s].v,a.v1,j.s_t0))<=this.m_radius&&(A=t.points[b],1===m.type?(R.MulTXV(this.m_xf,x[s].v,A.localPoint),A.id=x[s].id):(A.localPoint.Copy(x[s].v),A.id.cf.typeA=x[s].id.cf.typeB,A.id.cf.typeB=x[s].id.cf.typeA,A.id.cf.indexA=x[s].id.cf.indexB,A.id.cf.indexB=x[s].id.cf.indexA),++b)}t.pointCount=b}}}},Bi.prototype.ComputeEdgeSeparation=function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=P;for(var i=0;i<this.m_polygonB.count;++i){var n=j.DotVV(this.m_normal,j.SubVV(this.m_polygonB.vertices[i],this.m_v1,j.s_t0));n<e.separation&&(e.separation=n)}return e},Bi.prototype.ComputePolygonSeparation=function(t){for(var e=t,i=(e.type=0,e.index=-1,e.separation=-P,Bi.s_perp.Set(-this.m_normal.y,this.m_normal.x)),n=0;n<this.m_polygonB.count;++n){var r=j.NegV(this.m_polygonB.normals[n],Bi.s_n),s=j.DotVV(r,j.SubVV(this.m_polygonB.vertices[n],this.m_v1,j.s_t0)),o=j.DotVV(r,j.SubVV(this.m_polygonB.vertices[n],this.m_v2,j.s_t0)),s=V(s,o);if(s>this.m_radius)return e.type=2,e.index=n,e.separation=s,e;if(0<=j.DotVV(r,i)){if(j.DotVV(j.SubVV(r,this.m_upperLimit,j.s_t0),this.m_normal)<-D)continue}else if(j.DotVV(j.SubVV(r,this.m_lowerLimit,j.s_t0),this.m_normal)<-D)continue;s>e.separation&&(e.type=2,e.index=n,e.separation=s)}return e},Bi.s_edge1=new j,Bi.s_edge0=new j,Bi.s_edge2=new j,Bi.s_ie=Qt.MakeArray(2),Bi.s_rf=new Ii,Bi.s_clipPoints1=Qt.MakeArray(2),Bi.s_clipPoints2=Qt.MakeArray(2),Bi.s_edgeAxis=new Ei,Bi.s_polygonAxis=new Ei,Bi.s_n=new j,Bi.s_perp=new j;var Ri=new Bi;function Pi(t,e,i,n,r){Ri.Collide(t,e,i,n,r)}var Di=function(){this.mass=0,this.center=new j(0,0),this.I=0},Li=((Ii=H.b2ShapeType||(H.b2ShapeType={}))[Ii.e_unknown=-1]="e_unknown",Ii[Ii.e_circleShape=0]="e_circleShape",Ii[Ii.e_edgeShape=1]="e_edgeShape",Ii[Ii.e_polygonShape=2]="e_polygonShape",Ii[Ii.e_chainShape=3]="e_chainShape",Ii[Ii.e_shapeTypeCount=4]="e_shapeTypeCount",Vi.prototype.Copy=function(t){return this.m_radius=t.m_radius,this},Vi.prototype.GetType=function(){return this.m_type},Vi);function Vi(t,e){this.m_type=H.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}var Oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};function Fi(t,e){function i(){this.constructor=t}Oi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}Fi(ki,Ni=Li),ki.prototype.Set=function(t,e){return void 0===e&&(e=this.m_radius),this.m_p.Copy(t),this.m_radius=e,this},ki.prototype.Clone=function(){return(new ki).Copy(this)},ki.prototype.Copy=function(t){return Ni.prototype.Copy.call(this,t),this.m_p.Copy(t.m_p),this},ki.prototype.GetChildCount=function(){return 1},ki.prototype.TestPoint=function(t,e){t=R.MulXV(t,this.m_p,ki.TestPoint_s_center),e=j.SubVV(e,t,ki.TestPoint_s_d);return j.DotVV(e,e)<=_(this.m_radius)},ki.prototype.ComputeDistance=function(t,e,i,n){t=R.MulXV(t,this.m_p,ki.ComputeDistance_s_center);return j.SubVV(e,t,i),i.Normalize()-this.m_radius},ki.prototype.RayCast=function(t,e,i,n){var i=R.MulXV(i,this.m_p,ki.RayCast_s_position),i=j.SubVV(e.p1,i,ki.RayCast_s_s),r=j.DotVV(i,i)-_(this.m_radius),s=j.SubVV(e.p2,e.p1,ki.RayCast_s_r),o=j.DotVV(i,s),a=j.DotVV(s,s),r=o*o-a*r;if(r<0||a<M)return!1;o=-(o+Y(r));return 0<=o&&o<=e.maxFraction*a&&(t.fraction=o/=a,j.AddVMulSV(i,o,s,t.normal).SelfNormalize(),!0)},ki.prototype.ComputeAABB=function(t,e,i){e=R.MulXV(e,this.m_p,ki.ComputeAABB_s_p);t.lowerBound.Set(e.x-this.m_radius,e.y-this.m_radius),t.upperBound.Set(e.x+this.m_radius,e.y+this.m_radius)},ki.prototype.ComputeMass=function(t,e){var i=_(this.m_radius);t.mass=e*m*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+j.DotVV(this.m_p,this.m_p))},ki.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius},ki.prototype.ComputeSubmergedArea=function(t,e,i,n){i=R.MulXV(i,this.m_p,new j),e=-(j.DotVV(t,i)-e);if(e<-this.m_radius+M)return 0;if(e>this.m_radius)return n.Copy(i),m*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,s=e*e,e=r*(b(e/this.m_radius)+m/2)+e*Y(r-s),r=-2/3*d(r-s,1.5)/e;return n.x=i.x+t.x*r,n.y=i.y+t.y*r,e},ki.prototype.Dump=function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},ki.TestPoint_s_center=new j,ki.TestPoint_s_d=new j,ki.ComputeDistance_s_center=new j,ki.RayCast_s_position=new j,ki.RayCast_s_s=new j,ki.RayCast_s_r=new j,ki.ComputeAABB_s_p=new j;var Ni,Ei=ki;function ki(t){t=Ni.call(this,H.b2ShapeType.e_circleShape,t=void 0===t?0:t)||this;return t.m_p=new j,t}Fi(S,Gi=Li),S.prototype.Clone=function(){return(new S).Copy(this)},S.prototype.Copy=function(t){Gi.prototype.Copy.call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=j.MakeArray(this.m_count),this.m_normals=j.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this},S.prototype.GetChildCount=function(){return 1},S.prototype.Set=function(h,t,u){if(void 0===u&&(u=0),(t=void 0===t?h.length:t)<3)return this.SetAsBox(1,1);for(var e=V(t,8),i=S.Set_s_ps,_=0,n=0;n<e;++n){for(var r=h[u+n],d=!0,s=0;s<_;++s)if(j.DistanceSquaredVV(r,i[s])<16e-6){d=!1;break}d&&i[_++].Copy(r)}if((e=_)<3)return this.SetAsBox(1,1);for(var o=0,f=i[0].x,n=1;n<e;++n){var p=i[n].x;(f<p||p===f&&i[n].y<i[o].y)&&(o=n,f=p)}for(var a=S.Set_s_hull,c=0,m=o;;){a[c]=m;for(var y,g,l=0,s=1;s<e;++s)l!==m?(y=j.SubVV(i[l],i[a[c]],S.Set_s_r),r=j.SubVV(i[s],i[a[c]],S.Set_s_v),(g=j.CrossVV(y,r))<0&&(l=s),0===g&&r.LengthSquared()>y.LengthSquared()&&(l=s)):l=s;if(++c,(m=l)===o)break}this.m_count=c,this.m_vertices=j.MakeArray(this.m_count),this.m_normals=j.MakeArray(this.m_count);for(n=0;n<c;++n)this.m_vertices[n].Copy(i[a[n]]);for(n=0;n<c;++n){var v=this.m_vertices[n],x=this.m_vertices[(n+1)%c],x=j.SubVV(x,v,j.s_t0);j.CrossVOne(x,this.m_normals[n]).SelfNormalize()}return S.ComputeCentroid(this.m_vertices,c,this.m_centroid),this},S.prototype.SetAsArray=function(t,e){return void 0===e&&(e=t.length),this.Set(t,e)},S.prototype.SetAsBox=function(t,e,i,n){if(void 0===n&&(n=0),this.m_count=4,this.m_vertices=j.MakeArray(this.m_count),this.m_normals=j.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var r=new R;r.SetPosition(i),r.SetRotationAngle(n);for(var s=0;s<this.m_count;++s)R.MulXV(r,this.m_vertices[s],this.m_vertices[s]),B.MulRV(r.q,this.m_normals[s],this.m_normals[s])}return this},S.prototype.TestPoint=function(t,e){for(var i=R.MulTXV(t,e,S.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(0<j.DotVV(this.m_normals[n],j.SubVV(i,this.m_vertices[n],j.s_t0)))return!1;return!0},S.prototype.ComputeDistance=function(t,h,e,u){for(var i=R.MulTXV(t,h,S.ComputeDistance_s_pLocal),n=-P,r=S.ComputeDistance_s_normalForMaxDistance.Copy(i),s=0;s<this.m_count;++s){var o=j.DotVV(this.m_normals[s],j.SubVV(i,this.m_vertices[s],j.s_t0));n<o&&(n=o,r.Copy(this.m_normals[s]))}if(0<n){for(var a=S.ComputeDistance_s_minDistance.Copy(r),c=n*n,s=0;s<this.m_count;++s){var l=j.SubVV(i,this.m_vertices[s],S.ComputeDistance_s_distance),_=l.LengthSquared();_<c&&(a.Copy(l),c=_)}return B.MulRV(t.q,a,e),e.Normalize(),Math.sqrt(c)}return B.MulRV(t.q,r,e),n},S.prototype.RayCast=function(t,e,i,h){for(var n=R.MulTXV(i,e.p1,S.RayCast_s_p1),u=R.MulTXV(i,e.p2,S.RayCast_s_p2),_=j.SubVV(u,n,S.RayCast_s_d),r=0,s=e.maxFraction,o=-1,a=0;a<this.m_count;++a){var c=j.DotVV(this.m_normals[a],j.SubVV(this.m_vertices[a],n,j.s_t0)),l=j.DotVV(this.m_normals[a],_);if(0===l){if(c<0)return!1}else l<0&&c<r*l?(r=c/l,o=a):0<l&&c<s*l&&(s=c/l);if(s<r)return!1}return 0<=o&&(t.fraction=r,B.MulRV(i.q,this.m_normals[o],t.normal),!0)},S.prototype.ComputeAABB=function(t,e,i){for(var n=R.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(n),s=0;s<this.m_count;++s){var o=R.MulXV(e,this.m_vertices[s],S.ComputeAABB_s_v);j.MinV(o,n,n),j.MaxV(o,r,r)}t=this.m_radius;n.SelfSubXY(t,t),r.SelfAddXY(t,t)},S.prototype.ComputeMass=function(t,e){for(var i=S.ComputeMass_s_center.SetZero(),n=0,h=0,r=S.ComputeMass_s_s.SetZero(),s=0;s<this.m_count;++s)r.SelfAdd(this.m_vertices[s]);r.SelfMul(1/this.m_count);for(s=0;s<this.m_count;++s){var o=j.SubVV(this.m_vertices[s],r,S.ComputeMass_s_e1),a=j.SubVV(this.m_vertices[(s+1)%this.m_count],r,S.ComputeMass_s_e2),u=j.CrossVV(o,a),c=.5*u,c=(n+=c,i.SelfAdd(j.MulSV(1/3*c,j.AddVV(o,a,j.s_t0),j.s_t1)),o.x),o=o.y,l=a.x,a=a.y;h+=1/3*.25*u*(c*c+l*c+l*l+(o*o+a*o+a*a))}t.mass=e*n,i.SelfMul(1/n),j.AddVV(i,r,t.center),t.I=e*h,t.I+=t.mass*(j.DotVV(t.center,t.center)-j.DotVV(i,i))},S.prototype.Validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,n=this.m_vertices[e],r=j.SubVV(this.m_vertices[i],n,S.Validate_s_e),s=0;s<this.m_count;++s)if(s!==e&&s!==i){var o=j.SubVV(this.m_vertices[s],n,S.Validate_s_v);if(j.CrossVV(r,o)<0)return!1}return!0},S.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},S.prototype.ComputeSubmergedArea=function(t,e,h,u){for(var _,d=B.MulTRV(h.q,t,S.ComputeSubmergedArea_s_normalL),f=e-j.DotVV(t,h.p),i=S.ComputeSubmergedArea_s_depths,p=0,n=-1,r=-1,m=!1,s=0;s<this.m_count;++s){i[s]=j.DotVV(d,this.m_vertices[s])-f;var y=i[s]<-M;0<s&&(y?m||(n=s-1,p++):m&&(r=s-1,p++)),m=y}switch(p){case 0:return m?(this.ComputeMass(_=S.ComputeSubmergedArea_s_md,1),R.MulXV(h,_.center,u),_.mass):0;case 1:-1===n?n=this.m_count-1:r=this.m_count-1}for(var e=(n+1)%this.m_count,o=(r+1)%this.m_count,t=(0-i[n])/(i[e]-i[n]),g=(0-i[r])/(i[o]-i[r]),a=S.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[n].x*(1-t)+this.m_vertices[e].x*t,this.m_vertices[n].y*(1-t)+this.m_vertices[e].y*t),v=S.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[r].x*(1-g)+this.m_vertices[o].x*g,this.m_vertices[r].y*(1-g)+this.m_vertices[o].y*g),x=0,b=S.ComputeSubmergedArea_s_center.SetZero(),c=this.m_vertices[e],A=e;A!==o;){var l=(A=(A+1)%this.m_count)===o?v:this.m_vertices[A],C=.5*((c.x-a.x)*(l.y-a.y)-(c.y-a.y)*(l.x-a.x));x+=C,b.x+=C*(a.x+c.x+l.x)/3,b.y+=C*(a.y+c.y+l.y)/3,c=l}return b.SelfMul(1/x),R.MulXV(h,b,u),x},S.prototype.Dump=function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)},S.ComputeCentroid=function(t,e,i){for(var n=i,r=(n.SetZero(),0),h=S.ComputeCentroid_s_pRef.SetZero(),s=0;s<e;++s){var o=h,a=t[s],c=t[(s+1)%e],l=j.SubVV(a,o,S.ComputeCentroid_s_e1),u=j.SubVV(c,o,S.ComputeCentroid_s_e2),l=.5*j.CrossVV(l,u);r+=l,n.x+=1/3*l*(o.x+a.x+c.x),n.y+=1/3*l*(o.y+a.y+c.y)}return n.SelfMul(1/r),n},S.Set_s_ps=j.MakeArray(8),S.Set_s_hull=h(8),S.Set_s_r=new j,S.Set_s_v=new j,S.TestPoint_s_pLocal=new j,S.ComputeDistance_s_pLocal=new j,S.ComputeDistance_s_normalForMaxDistance=new j,S.ComputeDistance_s_minDistance=new j,S.ComputeDistance_s_distance=new j,S.RayCast_s_p1=new j,S.RayCast_s_p2=new j,S.RayCast_s_d=new j,S.ComputeAABB_s_v=new j,S.ComputeMass_s_center=new j,S.ComputeMass_s_s=new j,S.ComputeMass_s_e1=new j,S.ComputeMass_s_e2=new j,S.Validate_s_e=new j,S.Validate_s_v=new j,S.ComputeSubmergedArea_s_normalL=new j,S.ComputeSubmergedArea_s_depths=h(8),S.ComputeSubmergedArea_s_md=new Di,S.ComputeSubmergedArea_s_intoVec=new j,S.ComputeSubmergedArea_s_outoVec=new j,S.ComputeSubmergedArea_s_center=new j,S.ComputeCentroid_s_pRef=new j,S.ComputeCentroid_s_e1=new j,S.ComputeCentroid_s_e2=new j;var Gi,Ii=S;function S(){var t=Gi.call(this,H.b2ShapeType.e_polygonShape,.016)||this;return t.m_centroid=new j(0,0),t.m_vertices=[],t.m_normals=[],t.m_count=0,t}Fi(Wi,zi=Li),Wi.prototype.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},Wi.prototype.Clone=function(){return(new Wi).Copy(this)},Wi.prototype.Copy=function(t){return zi.prototype.Copy.call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this},Wi.prototype.GetChildCount=function(){return 1},Wi.prototype.TestPoint=function(t,e){return!1},Wi.prototype.ComputeDistance=function(t,e,i,n){var r,s=R.MulXV(t,this.m_vertex1,Wi.ComputeDistance_s_v1),t=R.MulXV(t,this.m_vertex2,Wi.ComputeDistance_s_v2),o=j.SubVV(e,s,Wi.ComputeDistance_s_d),s=j.SubVV(t,s,Wi.ComputeDistance_s_s),a=j.DotVV(o,s);return 0<a&&((r=j.DotVV(s,s))<a?j.SubVV(e,t,o):o.SelfMulSub(a/r,s)),i.Copy(o),i.Normalize()},Wi.prototype.RayCast=function(t,e,i,l){var n=R.MulTXV(i,e.p1,Wi.RayCast_s_p1),r=R.MulTXV(i,e.p2,Wi.RayCast_s_p2),r=j.SubVV(r,n,Wi.RayCast_s_d),s=this.m_vertex1,o=this.m_vertex2,a=j.SubVV(o,s,Wi.RayCast_s_e),a=t.normal.Set(a.y,-a.x).SelfNormalize(),c=j.DotVV(a,j.SubVV(s,n,j.s_t0)),a=j.DotVV(a,r);if(0===a)return!1;a=c/a;if(a<0||e.maxFraction<a)return!1;e=j.AddVMulSV(n,a,r,Wi.RayCast_s_q),n=j.SubVV(o,s,Wi.RayCast_s_r),r=j.DotVV(n,n);if(0===r)return!1;o=j.DotVV(j.SubVV(e,s,j.s_t0),n)/r;return!(o<0||1<o)&&(t.fraction=a,B.MulRV(i.q,t.normal,t.normal),0<c&&t.normal.SelfNeg(),!0)},Wi.prototype.ComputeAABB=function(t,e,i){var n=R.MulXV(e,this.m_vertex1,Wi.ComputeAABB_s_v1),e=R.MulXV(e,this.m_vertex2,Wi.ComputeAABB_s_v2),n=(j.MinV(n,e,t.lowerBound),j.MaxV(n,e,t.upperBound),this.m_radius);t.lowerBound.SelfSubXY(n,n),t.upperBound.SelfAddXY(n,n)},Wi.prototype.ComputeMass=function(t,e){t.mass=0,j.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},Wi.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},Wi.prototype.ComputeSubmergedArea=function(t,e,i,n){return n.SetZero(),0},Wi.prototype.Dump=function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},Wi.ComputeDistance_s_v1=new j,Wi.ComputeDistance_s_v2=new j,Wi.ComputeDistance_s_d=new j,Wi.ComputeDistance_s_s=new j,Wi.RayCast_s_p1=new j,Wi.RayCast_s_p2=new j,Wi.RayCast_s_d=new j,Wi.RayCast_s_e=new j,Wi.RayCast_s_q=new j,Wi.RayCast_s_r=new j,Wi.ComputeAABB_s_v1=new j,Wi.ComputeAABB_s_v2=new j;var zi,Ui=Wi;function Wi(){var t=zi.call(this,H.b2ShapeType.e_edgeShape,.016)||this;return t.m_vertex1=new j,t.m_vertex2=new j,t.m_vertex0=new j,t.m_vertex3=new j,t.m_hasVertex0=!1,t.m_hasVertex3=!1,t}Fi(Xi,Hi=Li),Xi.prototype.CreateLoop=function(t,e,i){if(void 0===i&&(i=0),(e=void 0===e?t.length:e)<3)return this;this.m_count=e+1,this.m_vertices=j.MakeArray(this.m_count);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},Xi.prototype.CreateChain=function(t,e,i){void 0===e&&(e=t.length),void 0===i&&(i=0),this.m_count=e,this.m_vertices=j.MakeArray(e);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},Xi.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},Xi.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},Xi.prototype.Clone=function(){return(new Xi).Copy(this)},Xi.prototype.Copy=function(t){return Hi.prototype.Copy.call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this},Xi.prototype.GetChildCount=function(){return this.m_count-1},Xi.prototype.GetChildEdge=function(t,e){t.m_type=H.b2ShapeType.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),0<e?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},Xi.prototype.TestPoint=function(t,e){return!1},Xi.prototype.ComputeDistance=function(t,e,i,n){var r=Xi.ComputeDistance_s_edgeShape;return this.GetChildEdge(r,n),r.ComputeDistance(t,e,i,0)},Xi.prototype.RayCast=function(t,e,i,n){var r=Xi.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[n]),r.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),r.RayCast(t,e,i,0)},Xi.prototype.ComputeAABB=function(t,e,i){var n=this.m_vertices[i],i=this.m_vertices[(i+1)%this.m_count],n=R.MulXV(e,n,Xi.ComputeAABB_s_v1),e=R.MulXV(e,i,Xi.ComputeAABB_s_v2);j.MinV(n,e,t.lowerBound),j.MaxV(n,e,t.upperBound)},Xi.prototype.ComputeMass=function(t,e){t.mass=0,t.center.SetZero(),t.I=0},Xi.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius},Xi.prototype.ComputeSubmergedArea=function(t,e,i,n){return n.SetZero(),0},Xi.prototype.Dump=function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},Xi.ComputeDistance_s_edgeShape=new Ui,Xi.RayCast_s_edgeShape=new Ui,Xi.ComputeAABB_s_v1=new j,Xi.ComputeAABB_s_v2=new j;var Hi,ji=Xi;function Xi(){var t=Hi.call(this,H.b2ShapeType.e_chainShape,.016)||this;return t.m_vertices=[],t.m_count=0,t.m_prevVertex=new j,t.m_nextVertex=new j,t.m_hasPrevVertex=!1,t.m_hasNextVertex=!1,t}qi.prototype.Clone=function(){return(new qi).Copy(this)},qi.prototype.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this},qi.DEFAULT=new qi;var Yi=qi;function qi(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}var Ji=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new Yi},Zi=function(t){this.aabb=new re,this.childIndex=0,this.fixture=t},Ki=(Qi.prototype.GetType=function(){return this.m_shape.GetType()},Qi.prototype.GetShape=function(){return this.m_shape},Qi.prototype.SetSensor=function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},Qi.prototype.IsSensor=function(){return this.m_isSensor},Qi.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()},Qi.prototype.GetFilterData=function(){return this.m_filter},Qi.prototype.Refilter=function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!==this&&n!==this||e.FlagForFiltering(),t=t.next}var r=this.m_body.GetWorld();if(null!==r)for(var s=r.m_contactManager.m_broadPhase,o=0;o<this.m_proxyCount;++o)s.TouchProxy(this.m_proxies[o].treeNode)},Qi.prototype.GetBody=function(){return this.m_body},Qi.prototype.GetNext=function(){return this.m_next},Qi.prototype.GetUserData=function(){return this.m_userData},Qi.prototype.SetUserData=function(t){this.m_userData=t},Qi.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},Qi.prototype.ComputeDistance=function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)},Qi.prototype.RayCast=function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)},Qi.prototype.GetMassData=function(t){return void 0===t&&(t=new Di),this.m_shape.ComputeMass(t,this.m_density),t},Qi.prototype.SetDensity=function(t){this.m_density=t},Qi.prototype.GetDensity=function(){return this.m_density},Qi.prototype.GetFriction=function(){return this.m_friction},Qi.prototype.SetFriction=function(t){this.m_friction=t},Qi.prototype.GetRestitution=function(){return this.m_restitution},Qi.prototype.SetRestitution=function(t){this.m_restitution=t},Qi.prototype.GetAABB=function(t){return this.m_proxies[t].aabb},Qi.prototype.Dump=function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)},Qi.prototype.Create=function(t){var e=this;this.m_userData=t.userData,this.m_friction=f(t.friction,.2),this.m_restitution=f(t.restitution,0),this.m_next=null,this.m_filter.Copy(f(t.filter,Yi.DEFAULT)),this.m_isSensor=f(t.isSensor,!1),this.m_proxies=c(this.m_shape.GetChildCount(),function(t){return new Zi(e)}),this.m_proxyCount=0,this.m_density=f(t.density,0)},Qi.prototype.Destroy=function(){},Qi.prototype.CreateProxies=function(t){var e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i]=new Zi(this);this.m_shape.ComputeAABB(n.aabb,t,i),n.treeNode=e.CreateProxy(n.aabb,n),n.childIndex=i}},Qi.prototype.DestroyProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode}this.m_proxyCount=0},Qi.prototype.TouchProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=this.m_proxyCount,i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode)},Qi.prototype.Synchronize=function(t,e){if(0!==this.m_proxyCount)for(var i=this.m_body.m_world.m_contactManager.m_broadPhase,n=0;n<this.m_proxyCount;++n){var r=this.m_proxies[n],s=Qi.Synchronize_s_aabb1,o=Qi.Synchronize_s_aabb2,s=(this.m_shape.ComputeAABB(s,t,n),this.m_shape.ComputeAABB(o,e,n),r.aabb.Combine2(s,o),j.SubVV(e.p,t.p,Qi.Synchronize_s_displacement));i.MoveProxy(r.treeNode,r.aabb,s)}},Qi.Synchronize_s_aabb1=new re,Qi.Synchronize_s_aabb2=new re,Qi.Synchronize_s_displacement=new j,Qi);function Qi(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new Yi,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone()}(en=H.b2BodyType||(H.b2BodyType={}))[en.b2_unknown=-1]="b2_unknown",en[en.b2_staticBody=0]="b2_staticBody",en[en.b2_kinematicBody=1]="b2_kinematicBody",en[en.b2_dynamicBody=2]="b2_dynamicBody";function $i(){this.type=H.b2BodyType.b2_staticBody,this.position=new j(0,0),this.angle=0,this.linearVelocity=new j(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}r.prototype.CreateFixture=function(t,e){return void 0===e&&(e=0),t instanceof Li?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)},r.prototype.CreateFixtureDef=function(t){if(this.m_world.IsLocked())throw new Error;var e=new Ki(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,0<e.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},r.prototype.CreateFixtureShapeDensity=function(t,e){void 0===e&&(e=0);var i=r.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)},r.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}e=(i=e).m_next}for(var n=this.m_contactList;n;){var r=n.contact,n=n.next,s=r.GetFixtureA(),o=r.GetFixtureB();t!==s&&t!==o||this.m_world.m_contactManager.Destroy(r)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()},r.prototype.SetTransformVec=function(t,e){this.SetTransformXY(t.x,t.y,e)},r.prototype.SetTransformXY=function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),R.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},r.prototype.SetTransform=function(t){this.SetTransformVec(t.p,t.GetAngle())},r.prototype.GetTransform=function(){return this.m_xf},r.prototype.GetPosition=function(){return this.m_xf.p},r.prototype.SetPosition=function(t){this.SetTransformVec(t,this.GetAngle())},r.prototype.SetPositionXY=function(t,e){this.SetTransformXY(t,e,this.GetAngle())},r.prototype.GetAngle=function(){return this.m_sweep.a},r.prototype.SetAngle=function(t){this.SetTransformVec(this.GetPosition(),t)},r.prototype.GetWorldCenter=function(){return this.m_sweep.c},r.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},r.prototype.SetLinearVelocity=function(t){this.m_type!==H.b2BodyType.b2_staticBody&&(0<j.DotVV(t,t)&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))},r.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},r.prototype.SetAngularVelocity=function(t){this.m_type!==H.b2BodyType.b2_staticBody&&(0<t*t&&this.SetAwake(!0),this.m_angularVelocity=t)},r.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},r.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},r.prototype.ApplyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},r.prototype.ApplyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))},r.prototype.ApplyTorque=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},r.prototype.ApplyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))},r.prototype.ApplyLinearImpulseToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))},r.prototype.ApplyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},r.prototype.GetMass=function(){return this.m_mass},r.prototype.GetInertia=function(){return this.m_I+this.m_mass*j.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},r.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*j.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},r.prototype.SetMassData=function(t){if(this.m_world.IsLocked())throw new Error;var e;this.m_type===H.b2BodyType.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*j.DotVV(t.center,t.center),this.m_invI=1/this.m_I),e=r.SetMassData_s_oldCenter.Copy(this.m_sweep.c),this.m_sweep.localCenter.Copy(t.center),R.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(this.m_sweep.c,e,j.s_t0),this.m_linearVelocity))},r.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===H.b2BodyType.b2_staticBody||this.m_type===H.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var t,e=r.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)0!==i.m_density&&(t=i.GetMassData(r.ResetMassData_s_massData),this.m_mass+=t.mass,e.x+=t.center.x*t.mass,e.y+=t.center.y*t.mass,this.m_I+=t.I);0<this.m_mass?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*j.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=r.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),R.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(this.m_sweep.c,n,j.s_t0),this.m_linearVelocity)},r.prototype.GetWorldPoint=function(t,e){return R.MulXV(this.m_xf,t,e)},r.prototype.GetWorldVector=function(t,e){return B.MulRV(this.m_xf.q,t,e)},r.prototype.GetLocalPoint=function(t,e){return R.MulTXV(this.m_xf,t,e)},r.prototype.GetLocalVector=function(t,e){return B.MulTRV(this.m_xf.q,t,e)},r.prototype.GetLinearVelocityFromWorldPoint=function(t,e){return j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(t,this.m_sweep.c,j.s_t0),e)},r.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},r.prototype.GetLinearDamping=function(){return this.m_linearDamping},r.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},r.prototype.GetAngularDamping=function(){return this.m_angularDamping},r.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},r.prototype.GetGravityScale=function(){return this.m_gravityScale},r.prototype.SetGravityScale=function(t){this.m_gravityScale=t},r.prototype.SetType=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),this.m_type===H.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e,e=e.next;this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var n=this.m_fixtureList;n;n=n.m_next)n.TouchProxies()}},r.prototype.GetType=function(){return this.m_type},r.prototype.SetBullet=function(t){this.m_bulletFlag=t},r.prototype.IsBullet=function(){return this.m_bulletFlag},r.prototype.SetSleepingAllowed=function(t){(this.m_autoSleepFlag=t)||this.SetAwake(!0)},r.prototype.IsSleepingAllowed=function(){return this.m_autoSleepFlag},r.prototype.SetAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},r.prototype.IsAwake=function(){return this.m_awakeFlag},r.prototype.SetActive=function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(this.m_xf);else{for(e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies();for(var i=this.m_contactList;i;){var n=i,i=i.next;this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}},r.prototype.IsActive=function(){return this.m_activeFlag},r.prototype.SetFixedRotation=function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())},r.prototype.IsFixedRotation=function(){return this.m_fixedRotationFlag},r.prototype.GetFixtureList=function(){return this.m_fixtureList},r.prototype.GetJointList=function(){return this.m_jointList},r.prototype.GetContactList=function(){return this.m_contactList},r.prototype.GetNext=function(){return this.m_next},r.prototype.GetUserData=function(){return this.m_userData},r.prototype.SetUserData=function(t){this.m_userData=t},r.prototype.GetWorld=function(){return this.m_world},r.prototype.Dump=function(t){var e=this.m_islandIndex,i=(t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n"),"");switch(this.m_type){case H.b2BodyType.b2_staticBody:i="b2BodyType.b2_staticBody";break;case H.b2BodyType.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case H.b2BodyType.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(var n=this.m_fixtureList;n;n=n.m_next)t("  {\n"),n.Dump(t,e),t("  }\n");t("}\n")},r.prototype.SynchronizeFixtures=function(){var t=r.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),B.MulRV(t.q,this.m_sweep.localCenter,t.p),j.SubVV(this.m_sweep.c0,t.p,t.p);for(var e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf)},r.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),B.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),j.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},r.prototype.ShouldCollide=function(t){return(this.m_type!==H.b2BodyType.b2_staticBody||t.m_type!==H.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(t)},r.prototype.ShouldCollideConnected=function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0},r.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),B.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),j.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},r.prototype.GetControllerList=function(){return this.m_controllerList},r.prototype.GetControllerCount=function(){return this.m_controllerCount},r.CreateFixtureShapeDensity_s_def=new Ji,r.SetMassData_s_oldCenter=new j,r.ResetMassData_s_localCenter=new j,r.ResetMassData_s_oldCenter=new j,r.ResetMassData_s_massData=new Di,r.SynchronizeFixtures_s_xf1=new R;var tn=r;function r(t,e){this.m_type=H.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new R,this.m_xf0=new R,this.m_sweep=new K,this.m_linearVelocity=new j,this.m_angularVelocity=0,this.m_force=new j,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=f(t.bullet,!1),this.m_fixedRotationFlag=f(t.fixedRotation,!1),this.m_autoSleepFlag=f(t.allowSleep,!0),this.m_awakeFlag=f(t.awake,!0),this.m_activeFlag=f(t.active,!0),this.m_world=e,this.m_xf.p.Copy(f(t.position,j.ZERO)),this.m_xf.q.SetAngle(f(t.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(f(t.linearVelocity,j.ZERO)),this.m_angularVelocity=f(t.angularVelocity,0),this.m_linearDamping=f(t.linearDamping,0),this.m_angularDamping=f(t.angularDamping,0),this.m_gravityScale=f(t.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=f(t.type,H.b2BodyType.b2_staticBody),t.type===H.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}(en=H.b2JointType||(H.b2JointType={}))[en.e_unknownJoint=0]="e_unknownJoint",en[en.e_revoluteJoint=1]="e_revoluteJoint",en[en.e_prismaticJoint=2]="e_prismaticJoint",en[en.e_distanceJoint=3]="e_distanceJoint",en[en.e_pulleyJoint=4]="e_pulleyJoint",en[en.e_mouseJoint=5]="e_mouseJoint",en[en.e_gearJoint=6]="e_gearJoint",en[en.e_wheelJoint=7]="e_wheelJoint",en[en.e_weldJoint=8]="e_weldJoint",en[en.e_frictionJoint=9]="e_frictionJoint",en[en.e_ropeJoint=10]="e_ropeJoint",en[en.e_motorJoint=11]="e_motorJoint",en[en.e_areaJoint=12]="e_areaJoint",(en=H.b2LimitState||(H.b2LimitState={}))[en.e_inactiveLimit=0]="e_inactiveLimit",en[en.e_atLowerLimit=1]="e_atLowerLimit",en[en.e_atUpperLimit=2]="e_atUpperLimit",en[en.e_equalLimits=3]="e_equalLimits";nn.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},nn.prototype.Set=function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this};var en=nn;function nn(){this.linear=new j,this.angularA=0,this.angularB=0}function rn(t){this.type=H.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=t}var sn=function(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e},on=(an.prototype.GetType=function(){return this.m_type},an.prototype.GetBodyA=function(){return this.m_bodyA},an.prototype.GetBodyB=function(){return this.m_bodyB},an.prototype.GetNext=function(){return this.m_next},an.prototype.GetUserData=function(){return this.m_userData},an.prototype.SetUserData=function(t){this.m_userData=t},an.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},an.prototype.GetCollideConnected=function(){return this.m_collideConnected},an.prototype.Dump=function(t){t("// Dump is not supported for this joint type.\n")},an.prototype.ShiftOrigin=function(t){},an);function an(t){this.m_type=H.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new sn(this,t.bodyB),this.m_edgeB=new sn(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=f(t.collideConnected,!1),this.m_userData=t.userData}Fi(hn,cn=rn),hn.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=j.DistanceVV(i,n),this.frequencyHz=0,this.dampingRatio=0};var cn,ln=hn;function hn(){var t=cn.call(this,H.b2JointType.e_distanceJoint)||this;return t.localAnchorA=new j,t.localAnchorB=new j,t.length=1,t.frequencyHz=0,t.dampingRatio=0,t}Fi(dn,un=on),dn.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},dn.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},dn.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e},dn.prototype.GetReactionTorque=function(t){return 0},dn.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},dn.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},dn.prototype.SetLength=function(t){this.m_length=t},dn.prototype.Length=function(){return this.m_length},dn.prototype.SetFrequency=function(t){this.m_frequencyHz=t},dn.prototype.GetFrequency=function(){return this.m_frequencyHz},dn.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},dn.prototype.GetDampingRatio=function(){return this.m_dampingRatio},dn.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},dn.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e,i=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,n=this.m_qA.SetAngle(n),a=this.m_qB.SetAngle(a),n=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(n,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(a,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-i.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-i.y-this.m_rA.y,this.m_u.Length()),a=(I<n?this.m_u.SelfMul(1/n):this.m_u.SetZero(),j.CrossVV(this.m_rA,this.m_u)),o=j.CrossVV(this.m_rB,this.m_u),i=this.m_invMassA+this.m_invIA*a*a+this.m_invMassB+this.m_invIB*o*o;this.m_mass=0!==i?1/i:0,0<this.m_frequencyHz?(a=n-this.m_length,o=2*m*this.m_frequencyHz,n=2*this.m_mass*this.m_dampingRatio*o,o=this.m_mass*o*o,e=t.step.dt,this.m_gamma=e*(n+e*o),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=a*e*o*this.m_gamma,i+=this.m_gamma,this.m_mass=0!==i?1/i:0):(this.m_gamma=0,this.m_bias=0),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,n=j.MulSV(this.m_impulse,this.m_u,dn.InitVelocityConstraints_s_P),r.SelfMulSub(this.m_invMassA,n),s-=this.m_invIA*j.CrossVV(this.m_rA,n),c.SelfMulAdd(this.m_invMassB,n),l+=this.m_invIB*j.CrossVV(this.m_rB,n)):this.m_impulse=0,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l},dn.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=j.AddVCrossSV(e,i,this.m_rA,dn.SolveVelocityConstraints_s_vpA),o=j.AddVCrossSV(n,r,this.m_rB,dn.SolveVelocityConstraints_s_vpB),o=j.DotVV(this.m_u,j.SubVV(o,s,j.s_t0)),s=-this.m_mass*(o+this.m_bias+this.m_gamma*this.m_impulse),o=(this.m_impulse+=s,j.MulSV(s,this.m_u,dn.SolveVelocityConstraints_s_P));e.SelfMulSub(this.m_invMassA,o),i-=this.m_invIA*j.CrossVV(this.m_rA,o),n.SelfMulAdd(this.m_invMassB,o),r+=this.m_invIB*j.CrossVV(this.m_rB,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},dn.prototype.SolvePositionConstraints=function(t){if(0<this.m_frequencyHz)return!0;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r),s=B.MulRV(s,this.m_lalcA,this.m_rA),o=B.MulRV(o,this.m_lalcB,this.m_rB),a=this.m_u;a.x=n.x+o.x-e.x-s.x,a.y=n.y+o.y-e.y-s.y;var c=F(this.m_u.Normalize()-this.m_length,-.2,.2),l=-this.m_mass*c,l=j.MulSV(l,a,dn.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,l),i-=this.m_invIA*j.CrossVV(s,l),n.SelfMulAdd(this.m_invMassB,l),r+=this.m_invIB*j.CrossVV(o,l),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,L(c)<I},dn.InitVelocityConstraints_s_P=new j,dn.SolveVelocityConstraints_s_vpA=new j,dn.SolveVelocityConstraints_s_vpB=new j,dn.SolveVelocityConstraints_s_P=new j,dn.SolvePositionConstraints_s_P=new j;var un,_n=dn;function dn(t){var e=un.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_bias=0,e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_gamma=0,e.m_impulse=0,e.m_length=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new j,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_localAnchorA.Copy(t.localAnchorA),e.m_localAnchorB.Copy(t.localAnchorB),e.m_length=t.length,e}Fi(mn,fn=rn),mn.prototype.AddBody=function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)};var fn,pn=mn;function mn(){var t=fn.call(this,H.b2JointType.e_areaJoint)||this;return t.bodies=[],t.frequencyHz=0,t.dampingRatio=0,t}Fi(vn,yn=on),vn.prototype.GetAnchorA=function(t){return t},vn.prototype.GetAnchorB=function(t){return t},vn.prototype.GetReactionForce=function(t,e){return e},vn.prototype.GetReactionTorque=function(t){return 0},vn.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)},vn.prototype.GetFrequency=function(){return this.m_frequencyHz},vn.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)},vn.prototype.GetDampingRatio=function(){return this.m_dampingRatio},vn.prototype.Dump=function(t){t("Area joint dumping is not supported.\n")},vn.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],n=this.m_bodies[(e+1)%this.m_bodies.length],i=t.positions[i.m_islandIndex].c,n=t.positions[n.m_islandIndex].c,r=this.m_deltas[e];j.SubVV(n,i,r)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(e=0;e<this.m_bodies.length;++e){var s=this.m_bodies[e],o=t.velocities[s.m_islandIndex].v,r=this.m_deltas[e];o.x+=s.m_invMass*r.y*.5*this.m_impulse,o.y+=s.m_invMass*-r.x*.5*this.m_impulse}}else this.m_impulse=0},vn.prototype.SolveVelocityConstraints=function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=t.velocities[r.m_islandIndex].v;e+=(a=this.m_deltas[n]).LengthSquared()/r.GetMass(),i+=j.CrossVV(s,a)}var o=-2*i/e;this.m_impulse+=o;for(n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=t.velocities[r.m_islandIndex].v,a=this.m_deltas[n];s.x+=r.m_invMass*a.y*.5*o,s.y+=r.m_invMass*-a.x*.5*o}},vn.prototype.SolvePositionConstraints=function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],s=this.m_bodies[(n+1)%this.m_bodies.length],o=t.positions[r.m_islandIndex].c,s=t.positions[s.m_islandIndex].c,a=(c=j.SubVV(s,o,this.m_delta)).Length();a<M&&(a=1),this.m_normals[n].x=c.y/a,this.m_normals[n].y=-c.x/a,e+=a,i+=j.CrossVV(o,s)}for(var h=.5*(this.m_targetArea-(i*=.5))/e,u=!0,n=0;n<this.m_bodies.length;++n){var c,r=this.m_bodies[n],o=t.positions[r.m_islandIndex].c,l=(n+1)%this.m_bodies.length,l=((c=j.AddVV(this.m_normals[n],this.m_normals[l],this.m_delta)).SelfMul(h),c.LengthSquared());l>_(.2)&&c.SelfMul(.2/Y(l)),64e-6<l&&(u=!1),o.x+=c.x,o.y+=c.y}return u};var yn,gn=vn;function vn(t){var e=yn.call(this,t)||this,i=(e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_impulse=0,e.m_targetArea=0,e.m_bodies=t.bodies,e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_targetLengths=h(t.bodies.length),e.m_normals=j.MakeArray(t.bodies.length),e.m_joints=[],e.m_deltas=j.MakeArray(t.bodies.length),e.m_delta=new j,new ln);i.frequencyHz=e.m_frequencyHz,i.dampingRatio=e.m_dampingRatio;for(var n=e.m_targetArea=0;n<e.m_bodies.length;++n){var r=e.m_bodies[n],s=e.m_bodies[(n+1)%e.m_bodies.length],o=r.GetWorldCenter(),a=s.GetWorldCenter();e.m_targetLengths[n]=j.DistanceVV(o,a),e.m_targetArea+=j.CrossVV(o,a),i.Initialize(r,s,o,a),e.m_joints[n]=r.GetWorld().CreateJoint(i)}return e.m_targetArea*=.5,e}Fi(An,xn=rn),An.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)};var xn,bn=An;function An(){var t=xn.call(this,H.b2JointType.e_frictionJoint)||this;return t.localAnchorA=new j,t.localAnchorB=new j,t.maxForce=0,t.maxTorque=0,t}Fi(Tn,Cn=on),Tn.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,e=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(n),e=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(e,this.m_lalcA,this.m_rA)),n=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(n,this.m_lalcB,this.m_rB)),s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,c=this.m_invIB,l=this.m_K;l.ex.x=s+o+a*e.y*e.y+c*n.y*n.y,l.ex.y=-a*e.x*e.y-c*n.x*n.y,l.ey.x=l.ex.y,l.ey.y=s+o+a*e.x*e.x+c*n.x*n.x,l.GetInverse(this.m_linearMass),this.m_angularMass=a+c,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting?(this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio,e=this.m_linearImpulse,h.SelfMulSub(s,e),i-=a*(j.CrossVV(this.m_rA,e)+this.m_angularImpulse),u.SelfMulAdd(o,e),r+=c*(j.CrossVV(this.m_rB,e)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},Tn.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,h=this.m_invMassA,u=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,_=t.step.dt,a=-this.m_angularMass*(r-i),c=this.m_angularImpulse,l=_*this.m_maxTorque,c=(this.m_angularImpulse=F(this.m_angularImpulse+a,-l,l),i-=s*(a=this.m_angularImpulse-c),j.SubVV(j.AddVCrossSV(n,r+=o*a,this.m_rB,j.s_t0),j.AddVCrossSV(e,i,this.m_rA,j.s_t1),Tn.SolveVelocityConstraints_s_Cdot_v2)),a=z.MulMV(this.m_linearMass,c,Tn.SolveVelocityConstraints_s_impulseV).SelfNeg(),c=Tn.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse),l=(this.m_linearImpulse.SelfAdd(a),_*this.m_maxForce);this.m_linearImpulse.LengthSquared()>l*l&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(l)),j.SubVV(this.m_linearImpulse,c,a),e.SelfMulSub(h,a),i-=s*j.CrossVV(this.m_rA,a),n.SelfMulAdd(u,a),r+=o*j.CrossVV(this.m_rB,a),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},Tn.prototype.SolvePositionConstraints=function(t){return!0},Tn.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},Tn.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},Tn.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e},Tn.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},Tn.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},Tn.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},Tn.prototype.SetMaxForce=function(t){this.m_maxForce=t},Tn.prototype.GetMaxForce=function(){return this.m_maxForce},Tn.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},Tn.prototype.GetMaxTorque=function(){return this.m_maxTorque},Tn.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},Tn.SolveVelocityConstraints_s_Cdot_v2=new j,Tn.SolveVelocityConstraints_s_impulseV=new j,Tn.SolveVelocityConstraints_s_oldImpulseV=new j;var Cn,Sn=Tn;function Tn(t){var e=Cn.call(this,t)||this;return e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_linearImpulse=new j,e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new z,e.m_angularMass=0,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_K=new z,e.m_localAnchorA.Copy(t.localAnchorA),e.m_localAnchorB.Copy(t.localAnchorB),e.m_linearImpulse.SetZero(),e.m_maxForce=f(t.maxForce,0),e.m_maxTorque=f(t.maxTorque,0),e.m_linearMass.SetZero(),e}Fi(Mn,wn=rn);var wn,En=Mn;function Mn(){var t=wn.call(this,H.b2JointType.e_gearJoint)||this;return t.ratio=1,t}Fi(Rn,In=on),Rn.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e,i=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=t.positions[this.m_indexC].a,_=t.velocities[this.m_indexC].v,a=t.velocities[this.m_indexC].w,c=t.positions[this.m_indexD].a,d=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,i=this.m_qA.SetAngle(i),r=this.m_qB.SetAngle(r),o=this.m_qC.SetAngle(o),c=this.m_qD.SetAngle(c);this.m_mass=0,this.m_typeA===H.b2JointType.e_revoluteJoint?(this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC):(e=B.MulRV(o,this.m_localAxisC,Rn.InitVelocityConstraints_s_u),j.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC),o=B.MulRV(o,this.m_lalcC,Rn.InitVelocityConstraints_s_rC),j.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA),i=B.MulRV(i,this.m_lalcA,Rn.InitVelocityConstraints_s_rA),this.m_JvAC.Copy(e),this.m_JwC=j.CrossVV(o,e),this.m_JwA=j.CrossVV(i,e),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA),this.m_typeB===H.b2JointType.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD)):(e=B.MulRV(c,this.m_localAxisD,Rn.InitVelocityConstraints_s_u),j.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD),o=B.MulRV(c,this.m_lalcD,Rn.InitVelocityConstraints_s_rD),j.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB),i=B.MulRV(r,this.m_lalcB,Rn.InitVelocityConstraints_s_rB),j.MulSV(this.m_ratio,e,this.m_JvBD),this.m_JwD=this.m_ratio*j.CrossVV(o,e),this.m_JwB=this.m_ratio*j.CrossVV(i,e),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB),this.m_mass=0<this.m_mass?1/this.m_mass:0,t.step.warmStarting?(h.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,u.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),s+=this.m_iB*this.m_impulse*this.m_JwB,_.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),a-=this.m_iC*this.m_impulse*this.m_JwC,d.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),l-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=s,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=l},Rn.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,l=j.DotVV(this.m_JvAC,j.SubVV(e,s,j.s_t0))+j.DotVV(this.m_JvBD,j.SubVV(n,a,j.s_t0)),l=(l+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*r-this.m_JwD*c),-this.m_mass*l);this.m_impulse+=l,e.SelfMulAdd(this.m_mA*l,this.m_JvAC),i+=this.m_iA*l*this.m_JwA,n.SelfMulAdd(this.m_mB*l,this.m_JvBD),r+=this.m_iB*l*this.m_JwB,s.SelfMulSub(this.m_mC*l,this.m_JvAC),o-=this.m_iC*l*this.m_JwC,a.SelfMulSub(this.m_mD*l,this.m_JvBD),c-=this.m_iD*l*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=c},Rn.prototype.SolvePositionConstraints=function(t){var e,i,n,r,s,h=t.positions[this.m_indexA].c,u=t.positions[this.m_indexA].a,_=t.positions[this.m_indexB].c,d=t.positions[this.m_indexB].a,f=t.positions[this.m_indexC].c,p=t.positions[this.m_indexC].a,m=t.positions[this.m_indexD].c,y=t.positions[this.m_indexD].a,o=this.m_qA.SetAngle(u),g=this.m_qB.SetAngle(d),a=this.m_qC.SetAngle(p),v=this.m_qD.SetAngle(y),x=this.m_JvAC,b=this.m_JvBD,c=0,v=(o=this.m_typeA===H.b2JointType.e_revoluteJoint?(x.SetZero(),n=e=1,c+=this.m_iA+this.m_iC,u-p-this.m_referenceAngleA):(s=B.MulRV(a,this.m_localAxisC,Rn.SolvePositionConstraints_s_u),l=B.MulRV(a,this.m_lalcC,Rn.SolvePositionConstraints_s_rC),o=B.MulRV(o,this.m_lalcA,Rn.SolvePositionConstraints_s_rA),x.Copy(s),n=j.CrossVV(l,s),e=j.CrossVV(o,s),c+=this.m_mC+this.m_mA+this.m_iC*n*n+this.m_iA*e*e,l=this.m_lalcC,a=B.MulTRV(a,j.AddVV(o,j.SubVV(h,f,j.s_t0),j.s_t0),j.s_t0),j.DotVV(j.SubVV(a,l,j.s_t0),this.m_localAxisC)),s=this.m_typeB===H.b2JointType.e_revoluteJoint?(b.SetZero(),i=this.m_ratio,r=this.m_ratio,c+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),d-y-this.m_referenceAngleB):(s=B.MulRV(v,this.m_localAxisD,Rn.SolvePositionConstraints_s_u),a=B.MulRV(v,this.m_lalcD,Rn.SolvePositionConstraints_s_rD),l=B.MulRV(g,this.m_lalcB,Rn.SolvePositionConstraints_s_rB),j.MulSV(this.m_ratio,s,b),r=this.m_ratio*j.CrossVV(a,s),i=this.m_ratio*j.CrossVV(l,s),c+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*r*r+this.m_iB*i*i,g=this.m_lalcD,a=B.MulTRV(v,j.AddVV(l,j.SubVV(_,m,j.s_t0),j.s_t0),j.s_t0),j.DotVV(j.SubVV(a,g,j.s_t0),this.m_localAxisD)),o+this.m_ratio*s-this.m_constant),l=0<c?-v/c:0;return h.SelfMulAdd(this.m_mA*l,x),u+=this.m_iA*l*e,_.SelfMulAdd(this.m_mB*l,b),d+=this.m_iB*l*i,f.SelfMulSub(this.m_mC*l,x),p-=this.m_iC*l*n,m.SelfMulSub(this.m_mD*l,b),y-=this.m_iD*l*r,t.positions[this.m_indexA].a=u,t.positions[this.m_indexB].a=d,t.positions[this.m_indexC].a=p,t.positions[this.m_indexD].a=y,!0},Rn.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},Rn.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},Rn.prototype.GetReactionForce=function(t,e){return j.MulSV(t*this.m_impulse,this.m_JvAC,e)},Rn.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},Rn.prototype.GetJoint1=function(){return this.m_joint1},Rn.prototype.GetJoint2=function(){return this.m_joint2},Rn.prototype.GetRatio=function(){return this.m_ratio},Rn.prototype.SetRatio=function(t){this.m_ratio=t},Rn.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,n=this.m_joint1.m_index,r=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",n),t("  jd.joint2 = joints[%d];\n",r),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},Rn.InitVelocityConstraints_s_u=new j,Rn.InitVelocityConstraints_s_rA=new j,Rn.InitVelocityConstraints_s_rB=new j,Rn.InitVelocityConstraints_s_rC=new j,Rn.InitVelocityConstraints_s_rD=new j,Rn.SolvePositionConstraints_s_u=new j,Rn.SolvePositionConstraints_s_rA=new j,Rn.SolvePositionConstraints_s_rB=new j,Rn.SolvePositionConstraints_s_rC=new j,Rn.SolvePositionConstraints_s_rD=new j;var In,Bn=Rn;function Rn(t){var e,i,n=In.call(this,t)||this,r=(n.m_typeA=H.b2JointType.e_unknownJoint,n.m_typeB=H.b2JointType.e_unknownJoint,n.m_localAnchorA=new j,n.m_localAnchorB=new j,n.m_localAnchorC=new j,n.m_localAnchorD=new j,n.m_localAxisC=new j,n.m_localAxisD=new j,n.m_referenceAngleA=0,n.m_referenceAngleB=0,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_indexC=0,n.m_indexD=0,n.m_lcA=new j,n.m_lcB=new j,n.m_lcC=new j,n.m_lcD=new j,n.m_mA=0,n.m_mB=0,n.m_mC=0,n.m_mD=0,n.m_iA=0,n.m_iB=0,n.m_iC=0,n.m_iD=0,n.m_JvAC=new j,n.m_JvBD=new j,n.m_JwA=0,n.m_JwB=0,n.m_JwC=0,n.m_JwD=0,n.m_mass=0,n.m_qA=new B,n.m_qB=new B,n.m_qC=new B,n.m_qD=new B,n.m_lalcA=new j,n.m_lalcB=new j,n.m_lalcC=new j,n.m_lalcD=new j,n.m_joint1=t.joint1,n.m_joint2=t.joint2,n.m_typeA=n.m_joint1.GetType(),n.m_typeB=n.m_joint2.GetType(),n.m_bodyC=n.m_joint1.GetBodyA(),n.m_bodyA=n.m_joint1.GetBodyB(),n.m_bodyA.m_xf),s=n.m_bodyA.m_sweep.a,o=n.m_bodyC.m_xf,a=n.m_bodyC.m_sweep.a,o=(r=n.m_typeA===H.b2JointType.e_revoluteJoint?(i=t.joint1,n.m_localAnchorC.Copy(i.m_localAnchorA),n.m_localAnchorA.Copy(i.m_localAnchorB),n.m_referenceAngleA=i.m_referenceAngle,n.m_localAxisC.SetZero(),s-a-n.m_referenceAngleA):(e=t.joint1,n.m_localAnchorC.Copy(e.m_localAnchorA),n.m_localAnchorA.Copy(e.m_localAnchorB),n.m_referenceAngleA=e.m_referenceAngle,n.m_localAxisC.Copy(e.m_localXAxisA),s=n.m_localAnchorC,a=B.MulTRV(o.q,j.AddVV(B.MulRV(r.q,n.m_localAnchorA,j.s_t0),j.SubVV(r.p,o.p,j.s_t1),j.s_t0),j.s_t0),j.DotVV(j.SubVV(a,s,j.s_t0),n.m_localAxisC)),n.m_bodyD=n.m_joint2.GetBodyA(),n.m_bodyB=n.m_joint2.GetBodyB(),n.m_bodyB.m_xf),a=n.m_bodyB.m_sweep.a,s=n.m_bodyD.m_xf,c=n.m_bodyD.m_sweep.a;return c=n.m_typeB===H.b2JointType.e_revoluteJoint?(i=t.joint2,n.m_localAnchorD.Copy(i.m_localAnchorA),n.m_localAnchorB.Copy(i.m_localAnchorB),n.m_referenceAngleB=i.m_referenceAngle,n.m_localAxisD.SetZero(),a-c-n.m_referenceAngleB):(e=t.joint2,n.m_localAnchorD.Copy(e.m_localAnchorA),n.m_localAnchorB.Copy(e.m_localAnchorB),n.m_referenceAngleB=e.m_referenceAngle,n.m_localAxisD.Copy(e.m_localXAxisA),i=n.m_localAnchorD,a=B.MulTRV(s.q,j.AddVV(B.MulRV(o.q,n.m_localAnchorB,j.s_t0),j.SubVV(o.p,s.p,j.s_t1),j.s_t0),j.s_t0),j.DotVV(j.SubVV(a,i,j.s_t0),n.m_localAxisD)),n.m_ratio=f(t.ratio,1),n.m_constant=r+n.m_ratio*c,n.m_impulse=0,n}Fi(Ln,Pn=rn),Ln.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);t=this.bodyA.GetAngle(),e=this.bodyB.GetAngle();this.angularOffset=e-t};var Pn,Dn=Ln;function Ln(){var t=Pn.call(this,H.b2JointType.e_motorJoint)||this;return t.linearOffset=new j(0,0),t.angularOffset=0,t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}Fi(Fn,Vn=on),Fn.prototype.GetAnchorA=function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t},Fn.prototype.GetAnchorB=function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t},Fn.prototype.GetReactionForce=function(t,e){return j.MulSV(t,this.m_linearImpulse,e)},Fn.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},Fn.prototype.SetLinearOffset=function(t){j.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},Fn.prototype.GetLinearOffset=function(){return this.m_linearOffset},Fn.prototype.SetAngularOffset=function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},Fn.prototype.GetAngularOffset=function(){return this.m_angularOffset},Fn.prototype.SetMaxForce=function(t){this.m_maxForce=t},Fn.prototype.GetMaxForce=function(){return this.m_maxForce},Fn.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},Fn.prototype.GetMaxTorque=function(){return this.m_maxTorque},Fn.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var h=t.positions[this.m_indexA].c,e=t.positions[this.m_indexA].a,u=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,_=t.positions[this.m_indexB].c,d=t.positions[this.m_indexB].a,f=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,n=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(d),n=B.MulRV(n,j.SubVV(this.m_linearOffset,this.m_localCenterA,j.s_t0),this.m_rA),r=B.MulRV(r,j.NegV(this.m_localCenterB,j.s_t0),this.m_rB),s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,c=this.m_invIB,l=this.m_K;l.ex.x=s+o+a*n.y*n.y+c*r.y*r.y,l.ex.y=-a*n.x*n.y-c*r.x*r.y,l.ey.x=l.ex.y,l.ey.y=s+o+a*n.x*n.x+c*r.x*r.x,l.GetInverse(this.m_linearMass),this.m_angularMass=a+c,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),j.SubVV(j.AddVV(_,r,j.s_t0),j.AddVV(h,n,j.s_t1),this.m_linearError),this.m_angularError=d-e-this.m_angularOffset,t.step.warmStarting?(this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio,l=this.m_linearImpulse,u.SelfMulSub(s,l),i-=a*(j.CrossVV(n,l)+this.m_angularImpulse),f.SelfMulAdd(o,l),p+=c*(j.CrossVV(r,l)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=p},Fn.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,h=this.m_invMassA,u=this.m_invMassB,s=this.m_invIA,_=this.m_invIB,d=t.step.dt,o=t.step.inv_dt,a=r-i+o*this.m_correctionFactor*this.m_angularError,a=-this.m_angularMass*a,c=this.m_angularImpulse,l=d*this.m_maxTorque,c=(this.m_angularImpulse=F(this.m_angularImpulse+a,-l,l),i-=s*(a=this.m_angularImpulse-c),this.m_rA),f=this.m_rB,a=j.AddVV(j.SubVV(j.AddVV(n,j.CrossSV(r+=_*a,f,j.s_t0),j.s_t0),j.AddVV(e,j.CrossSV(i,c,j.s_t1),j.s_t1),j.s_t2),j.MulSV(o*this.m_correctionFactor,this.m_linearError,j.s_t3),Fn.SolveVelocityConstraints_s_Cdot_v2),o=z.MulMV(this.m_linearMass,a,Fn.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),a=Fn.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse),l=(this.m_linearImpulse.SelfAdd(o),d*this.m_maxForce);this.m_linearImpulse.LengthSquared()>l*l&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(l)),j.SubVV(this.m_linearImpulse,a,o),e.SelfMulSub(h,o),i-=s*j.CrossVV(c,o),n.SelfMulAdd(u,o),r+=_*j.CrossVV(f,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},Fn.prototype.SolvePositionConstraints=function(t){return!0},Fn.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},Fn.SolveVelocityConstraints_s_Cdot_v2=new j,Fn.SolveVelocityConstraints_s_impulse_v2=new j,Fn.SolveVelocityConstraints_s_oldImpulse_v2=new j;var Vn,On=Fn;function Fn(t){var e=Vn.call(this,t)||this;return e.m_linearOffset=new j,e.m_angularOffset=0,e.m_linearImpulse=new j,e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_correctionFactor=.3,e.m_indexA=0,e.m_indexB=0,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_linearError=new j,e.m_angularError=0,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new z,e.m_angularMass=0,e.m_qA=new B,e.m_qB=new B,e.m_K=new z,e.m_linearOffset.Copy(f(t.linearOffset,j.ZERO)),e.m_linearImpulse.SetZero(),e.m_maxForce=f(t.maxForce,0),e.m_maxTorque=f(t.maxTorque,0),e.m_correctionFactor=f(t.correctionFactor,.3),e}Fi(Gn,Nn=rn);var Nn,kn=Gn;function Gn(){var t=Nn.call(this,H.b2JointType.e_mouseJoint)||this;return t.target=new j,t.maxForce=0,t.frequencyHz=5,t.dampingRatio=.7,t}Fi(Wn,zn=on),Wn.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},Wn.prototype.GetTarget=function(){return this.m_targetA},Wn.prototype.SetMaxForce=function(t){this.m_maxForce=t},Wn.prototype.GetMaxForce=function(){return this.m_maxForce},Wn.prototype.SetFrequency=function(t){this.m_frequencyHz=t},Wn.prototype.GetFrequency=function(){return this.m_frequencyHz},Wn.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},Wn.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Wn.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,i=this.m_qB.SetAngle(i),s=this.m_bodyB.GetMass(),o=2*m*this.m_frequencyHz,a=2*s*this.m_dampingRatio*o,s=s*(o*o),o=t.step.dt,a=(this.m_gamma=o*(a+o*s),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=o*s*this.m_gamma,j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(i,this.m_lalcB,this.m_rB),this.m_K);a.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,a.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,a.ey.x=a.ex.y,a.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,a.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*j.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r},Wn.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,n=j.AddVCrossSV(e,i,this.m_rB,Wn.SolveVelocityConstraints_s_Cdot),n=z.MulMV(this.m_mass,j.AddVV(n,j.AddVV(this.m_C,j.MulSV(this.m_gamma,this.m_impulse,j.s_t0),j.s_t0),j.s_t0).SelfNeg(),Wn.SolveVelocityConstraints_s_impulse),r=Wn.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse),s=(this.m_impulse.SelfAdd(n),t.step.dt*this.m_maxForce);this.m_impulse.LengthSquared()>s*s&&this.m_impulse.SelfMul(s/this.m_impulse.Length()),j.SubVV(this.m_impulse,r,n),e.SelfMulAdd(this.m_invMassB,n),i+=this.m_invIB*j.CrossVV(this.m_rB,n),t.velocities[this.m_indexB].w=i},Wn.prototype.SolvePositionConstraints=function(t){return!0},Wn.prototype.GetAnchorA=function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t},Wn.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},Wn.prototype.GetReactionForce=function(t,e){return j.MulSV(t,this.m_impulse,e)},Wn.prototype.GetReactionTorque=function(t){return 0},Wn.prototype.Dump=function(t){t("Mouse joint dumping is not supported.\n")},Wn.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},Wn.SolveVelocityConstraints_s_Cdot=new j,Wn.SolveVelocityConstraints_s_impulse=new j,Wn.SolveVelocityConstraints_s_oldImpulse=new j;var zn,Un=Wn;function Wn(t){var e=zn.call(this,t)||this;return e.m_localAnchorB=new j,e.m_targetA=new j,e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_beta=0,e.m_impulse=new j,e.m_maxForce=0,e.m_gamma=0,e.m_indexA=0,e.m_indexB=0,e.m_rB=new j,e.m_localCenterB=new j,e.m_invMassB=0,e.m_invIB=0,e.m_mass=new z,e.m_C=new j,e.m_qB=new B,e.m_lalcB=new j,e.m_K=new z,e.m_targetA.Copy(f(t.target,j.ZERO)),R.MulTXV(e.m_bodyB.GetTransform(),e.m_targetA,e.m_localAnchorB),e.m_maxForce=f(t.maxForce,0),e.m_impulse.SetZero(),e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_beta=0,e.m_gamma=0,e}Fi(Xn,Hn=rn),Xn.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};var Hn,jn=Xn;function Xn(){var t=Hn.call(this,H.b2JointType.e_prismaticJoint)||this;return t.localAnchorA=new j,t.localAnchorB=new j,t.localAxisA=new j(1,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorForce=0,t.motorSpeed=0,t}Fi(Jn,Yn=on),Jn.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,_=t.velocities[this.m_indexB].w,i=this.m_qA.SetAngle(i),s=this.m_qB.SetAngle(s),o=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(i,this.m_lalcA,this.m_rA)),s=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(s,this.m_lalcB,this.m_rB)),r=j.AddVV(j.SubVV(r,e,j.s_t0),j.SubVV(s,o,j.s_t1),Jn.InitVelocityConstraints_s_d),e=this.m_invMassA,a=this.m_invMassB,c=this.m_invIA,l=this.m_invIB;B.MulRV(i,this.m_localXAxisA,this.m_axis),this.m_a1=j.CrossVV(j.AddVV(r,o,j.s_t0),this.m_axis),this.m_a2=j.CrossVV(s,this.m_axis),this.m_motorMass=e+a+c*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),B.MulRV(i,this.m_localYAxisA,this.m_perp),this.m_s1=j.CrossVV(j.AddVV(r,o,j.s_t0),this.m_perp),this.m_s2=j.CrossVV(s,this.m_perp),this.m_K.ex.x=e+a+c*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.ex.y=c*this.m_s1+l*this.m_s2,this.m_K.ex.z=c*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=c+l,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=c*this.m_a1+l*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=e+a+c*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(i=j.DotVV(this.m_axis,r),L(this.m_upperTranslation-this.m_lowerTranslation)<.016?this.m_limitState=H.b2LimitState.e_equalLimits:i<=this.m_lowerTranslation?this.m_limitState!==H.b2LimitState.e_atLowerLimit&&(this.m_limitState=H.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):i>=this.m_upperTranslation?this.m_limitState!==H.b2LimitState.e_atUpperLimit&&(this.m_limitState=H.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=H.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):(this.m_limitState=H.b2LimitState.e_inactiveLimit,this.m_impulse.z=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,o=j.AddVV(j.MulSV(this.m_impulse.x,this.m_perp,j.s_t0),j.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,j.s_t1),Jn.InitVelocityConstraints_s_P),s=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,r=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,h.SelfMulSub(e,o),n-=c*s,u.SelfMulAdd(a,o),_+=l*r):(this.m_impulse.SetZero(),this.m_motorImpulse=0),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=_},Jn.prototype.SolveVelocityConstraints=function(t){var e,i,n,r,s,o,a,h=t.velocities[this.m_indexA].v,c=t.velocities[this.m_indexA].w,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,_=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,p=this.m_invIB,m=(this.m_enableMotor&&this.m_limitState!==H.b2LimitState.e_equalLimits&&(a=j.DotVV(this.m_axis,j.SubVV(u,h,j.s_t0))+this.m_a2*l-this.m_a1*c,a=this.m_motorMass*(this.m_motorSpeed-a),o=this.m_motorImpulse,s=t.step.dt*this.m_maxMotorForce,this.m_motorImpulse=F(this.m_motorImpulse+a,-s,s),a=this.m_motorImpulse-o,s=j.MulSV(a,this.m_axis,Jn.SolveVelocityConstraints_s_P),o=a*this.m_a1,a=a*this.m_a2,h.SelfMulSub(_,s),c-=f*o,u.SelfMulAdd(d,s),l+=p*a),j.DotVV(this.m_perp,j.SubVV(u,h,j.s_t0))+this.m_s2*l-this.m_s1*c),y=l-c;a=this.m_enableLimit&&this.m_limitState!==H.b2LimitState.e_inactiveLimit?(i=j.DotVV(this.m_axis,j.SubVV(u,h,j.s_t0))+this.m_a2*l-this.m_a1*c,e=Jn.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),i=this.m_K.Solve33(-m,-y,-i,Jn.SolveVelocityConstraints_s_df3),this.m_impulse.SelfAdd(i),this.m_limitState===H.b2LimitState.e_atLowerLimit?this.m_impulse.z=O(this.m_impulse.z,0):this.m_limitState===H.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=V(this.m_impulse.z,0)),n=-m-(this.m_impulse.z-e.z)*this.m_K.ez.x,r=-y-(this.m_impulse.z-e.z)*this.m_K.ez.y,(n=this.m_K.Solve22(n,r,Jn.SolveVelocityConstraints_s_f2r)).x+=e.x,n.y+=e.y,this.m_impulse.x=n.x,this.m_impulse.y=n.y,i.x=this.m_impulse.x-e.x,i.y=this.m_impulse.y-e.y,i.z=this.m_impulse.z-e.z,s=j.AddVV(j.MulSV(i.x,this.m_perp,j.s_t0),j.MulSV(i.z,this.m_axis,j.s_t1),Jn.SolveVelocityConstraints_s_P),o=i.x*this.m_s1+i.y+i.z*this.m_a1,i.x*this.m_s2+i.y+i.z*this.m_a2):(r=this.m_K.Solve22(-m,-y,Jn.SolveVelocityConstraints_s_df2),this.m_impulse.x+=r.x,this.m_impulse.y+=r.y,s=j.MulSV(r.x,this.m_perp,Jn.SolveVelocityConstraints_s_P),o=r.x*this.m_s1+r.y,r.x*this.m_s2+r.y),h.SelfMulSub(_,s),c-=f*o,u.SelfMulAdd(d,s),l+=p*a,t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=l},Jn.prototype.SolvePositionConstraints=function(t){var h,u,_,d=t.positions[this.m_indexA].c,f=t.positions[this.m_indexA].a,p=t.positions[this.m_indexB].c,m=t.positions[this.m_indexB].a,e=this.m_qA.SetAngle(f),i=this.m_qB.SetAngle(m),y=this.m_invMassA,g=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,s=B.MulRV(e,this.m_lalcA,this.m_rA),i=B.MulRV(i,this.m_lalcB,this.m_rB),o=j.SubVV(j.AddVV(p,i,j.s_t0),j.AddVV(d,s,j.s_t1),Jn.SolvePositionConstraints_s_d),v=B.MulRV(e,this.m_localXAxisA,this.m_axis),x=j.CrossVV(j.AddVV(o,s,j.s_t0),v),b=j.CrossVV(i,v),e=B.MulRV(e,this.m_localYAxisA,this.m_perp),s=j.CrossVV(j.AddVV(o,s,j.s_t0),e),i=j.CrossVV(i,e),a=Jn.SolvePositionConstraints_s_impulse,A=j.DotVV(e,o),C=m-f-this.m_referenceAngle,c=L(A),S=L(C),l=!1,T=0,l=(this.m_enableLimit&&(o=j.DotVV(v,o),L(this.m_upperTranslation-this.m_lowerTranslation)<.016?(T=F(o,-.2,.2),c=O(c,L(o)),l=!0):o<=this.m_lowerTranslation?(T=F(o-this.m_lowerTranslation+I,-.2,0),c=O(c,this.m_lowerTranslation-o),l=!0):o>=this.m_upperTranslation&&(T=F(o-this.m_upperTranslation-I,0,.2),c=O(c,o-this.m_upperTranslation),l=!0)),l?(0===(u=n+r)&&(u=1),o=n*x+r*b,l=y+g+n*x*x+r*b*b,(w=this.m_K3).ex.SetXYZ(y+g+n*s*s+r*i*i,h=n*s+r*i,_=n*s*x+r*i*b),w.ey.SetXYZ(h,u,o),w.ez.SetXYZ(_,o,l),a=w.Solve33(-A,-C,-T,a)):(0===(u=n+r)&&(u=1),(_=this.m_K2).ex.Set(y+g+n*s*s+r*i*i,h=n*s+r*i),_.ey.Set(h,u),o=_.Solve(-A,-C,Jn.SolvePositionConstraints_s_impulse1),a.x=o.x,a.y=o.y,a.z=0),j.AddVV(j.MulSV(a.x,e,j.s_t0),j.MulSV(a.z,v,j.s_t1),Jn.SolvePositionConstraints_s_P)),w=a.x*s+a.y+a.z*x,T=a.x*i+a.y+a.z*b;return d.SelfMulSub(y,l),f-=n*w,p.SelfMulAdd(g,l),m+=r*T,t.positions[this.m_indexA].a=f,t.positions[this.m_indexB].a=m,c<=I&&S<=D},Jn.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},Jn.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},Jn.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e},Jn.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y},Jn.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},Jn.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},Jn.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},Jn.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},Jn.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,Jn.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Jn.GetJointTranslation_s_pB),e=j.SubVV(e,t,Jn.GetJointTranslation_s_d),t=this.m_bodyA.GetWorldVector(this.m_localXAxisA,Jn.GetJointTranslation_s_axis);return j.DotVV(e,t)},Jn.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=(j.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA),B.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA)),n=(j.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB),B.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB)),r=j.AddVV(t.m_sweep.c,i,j.s_t0),s=j.AddVV(e.m_sweep.c,n,j.s_t1),s=j.SubVV(s,r,j.s_t2),r=t.GetWorldVector(this.m_localXAxisA,this.m_axis),o=t.m_linearVelocity,a=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return j.DotVV(s,j.CrossSV(t,r,j.s_t0))+j.DotVV(r,j.SubVV(j.AddVCrossSV(a,e,n,j.s_t0),j.AddVCrossSV(o,t,i,j.s_t1),j.s_t0))},Jn.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Jn.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},Jn.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Jn.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Jn.prototype.SetLimits=function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},Jn.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Jn.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},Jn.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},Jn.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Jn.prototype.SetMaxMotorForce=function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)},Jn.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Jn.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse},Jn.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},Jn.InitVelocityConstraints_s_d=new j,Jn.InitVelocityConstraints_s_P=new j,Jn.SolveVelocityConstraints_s_P=new j,Jn.SolveVelocityConstraints_s_f2r=new j,Jn.SolveVelocityConstraints_s_f1=new k,Jn.SolveVelocityConstraints_s_df3=new k,Jn.SolveVelocityConstraints_s_df2=new j,Jn.SolvePositionConstraints_s_d=new j,Jn.SolvePositionConstraints_s_impulse=new k,Jn.SolvePositionConstraints_s_impulse1=new j,Jn.SolvePositionConstraints_s_P=new j,Jn.GetJointTranslation_s_pA=new j,Jn.GetJointTranslation_s_pB=new j,Jn.GetJointTranslation_s_d=new j,Jn.GetJointTranslation_s_axis=new j;var Yn,qn=Jn;function Jn(t){var e=Yn.call(this,t)||this;return e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_localXAxisA=new j,e.m_localYAxisA=new j,e.m_referenceAngle=0,e.m_impulse=new k(0,0,0),e.m_motorImpulse=0,e.m_lowerTranslation=0,e.m_upperTranslation=0,e.m_maxMotorForce=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_enableMotor=!1,e.m_limitState=H.b2LimitState.e_inactiveLimit,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_axis=new j(0,0),e.m_perp=new j(0,0),e.m_s1=0,e.m_s2=0,e.m_a1=0,e.m_a2=0,e.m_K=new W,e.m_K3=new W,e.m_K2=new z,e.m_motorMass=0,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_rA=new j,e.m_rB=new j,e.m_localAnchorA.Copy(f(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,j.ZERO)),e.m_localXAxisA.Copy(f(t.localAxisA,new j(1,0))).SelfNormalize(),j.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_referenceAngle=f(t.referenceAngle,0),e.m_lowerTranslation=f(t.lowerTranslation,0),e.m_upperTranslation=f(t.upperTranslation,0),e.m_maxMotorForce=f(t.maxMotorForce,0),e.m_motorSpeed=f(t.motorSpeed,0),e.m_enableLimit=f(t.enableLimit,!1),e.m_enableMotor=f(t.enableMotor,!1),e}Fi(Qn,Zn=rn),Qn.prototype.Initialize=function(t,e,i,n,r,s,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=j.DistanceVV(r,i),this.lengthB=j.DistanceVV(s,n),this.ratio=o};var Zn,Kn=Qn;function Qn(){var t=Zn.call(this,H.b2JointType.e_pulleyJoint)||this;return t.groundAnchorA=new j(-1,1),t.groundAnchorB=new j(1,1),t.localAnchorA=new j(-1,0),t.localAnchorB=new j(1,0),t.lengthA=0,t.lengthB=0,t.ratio=1,t.collideConnected=!0,t}Fi(er,$n=on),er.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,i=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(o),i=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(i,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(o,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(s).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB),this.m_uA.Length()),o=this.m_uB.Length(),e=(.08<i?this.m_uA.SelfMul(1/i):this.m_uA.SetZero(),.08<o?this.m_uB.SelfMul(1/o):this.m_uB.SetZero(),j.CrossVV(this.m_rA,this.m_uA)),s=j.CrossVV(this.m_rB,this.m_uB),i=this.m_invMassA+this.m_invIA*e*e,o=this.m_invMassB+this.m_invIB*s*s;this.m_mass=i+this.m_ratio*this.m_ratio*o,0<this.m_mass&&(this.m_mass=1/this.m_mass),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,e=j.MulSV(-this.m_impulse,this.m_uA,er.InitVelocityConstraints_s_PA),s=j.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,er.InitVelocityConstraints_s_PB),n.SelfMulAdd(this.m_invMassA,e),r+=this.m_invIA*j.CrossVV(this.m_rA,e),a.SelfMulAdd(this.m_invMassB,s),c+=this.m_invIB*j.CrossVV(this.m_rB,s)):this.m_impulse=0,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c},er.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=j.AddVCrossSV(e,i,this.m_rA,er.SolveVelocityConstraints_s_vpA),o=j.AddVCrossSV(n,r,this.m_rB,er.SolveVelocityConstraints_s_vpB),s=-j.DotVV(this.m_uA,s)-this.m_ratio*j.DotVV(this.m_uB,o),o=-this.m_mass*s,s=(this.m_impulse+=o,j.MulSV(-o,this.m_uA,er.SolveVelocityConstraints_s_PA)),o=j.MulSV(-this.m_ratio*o,this.m_uB,er.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,s),i+=this.m_invIA*j.CrossVV(this.m_rA,s),n.SelfMulAdd(this.m_invMassB,o),r+=this.m_invIB*j.CrossVV(this.m_rB,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},er.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c,e=t.positions[this.m_indexA].a,u=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,i=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(_),i=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(i,this.m_lalcA,this.m_rA)),n=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(n,this.m_lalcB,this.m_rB)),r=this.m_uA.Copy(h).SelfAdd(i).SelfSub(this.m_groundAnchorA),s=this.m_uB.Copy(u).SelfAdd(n).SelfSub(this.m_groundAnchorB),o=r.Length(),a=s.Length(),c=(.08<o?r.SelfMul(1/o):r.SetZero(),.08<a?s.SelfMul(1/a):s.SetZero(),j.CrossVV(i,r)),l=j.CrossVV(n,s),c=this.m_invMassA+this.m_invIA*c*c,l=this.m_invMassB+this.m_invIB*l*l,c=c+this.m_ratio*this.m_ratio*l,l=(0<c&&(c=1/c),this.m_constant-o-this.m_ratio*a),o=L(l),a=-c*l,c=j.MulSV(-a,r,er.SolvePositionConstraints_s_PA),l=j.MulSV(-this.m_ratio*a,s,er.SolvePositionConstraints_s_PB);return h.SelfMulAdd(this.m_invMassA,c),e+=this.m_invIA*j.CrossVV(i,c),u.SelfMulAdd(this.m_invMassB,l),_+=this.m_invIB*j.CrossVV(n,l),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=_,o<I},er.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},er.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},er.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e},er.prototype.GetReactionTorque=function(t){return 0},er.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},er.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},er.prototype.GetLengthA=function(){return this.m_lengthA},er.prototype.GetLengthB=function(){return this.m_lengthB},er.prototype.GetRatio=function(){return this.m_ratio},er.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,er.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return j.DistanceVV(t,e)},er.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,er.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return j.DistanceVV(t,e)},er.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},er.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},er.InitVelocityConstraints_s_PA=new j,er.InitVelocityConstraints_s_PB=new j,er.SolveVelocityConstraints_s_vpA=new j,er.SolveVelocityConstraints_s_vpB=new j,er.SolveVelocityConstraints_s_PA=new j,er.SolveVelocityConstraints_s_PB=new j,er.SolvePositionConstraints_s_PA=new j,er.SolvePositionConstraints_s_PB=new j,er.GetCurrentLengthA_s_p=new j,er.GetCurrentLengthB_s_p=new j;var $n,tr=er;function er(t){var e=$n.call(this,t)||this;return e.m_groundAnchorA=new j,e.m_groundAnchorB=new j,e.m_lengthA=0,e.m_lengthB=0,e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_constant=0,e.m_ratio=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_uA=new j,e.m_uB=new j,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_groundAnchorA.Copy(f(t.groundAnchorA,new j(-1,1))),e.m_groundAnchorB.Copy(f(t.groundAnchorB,new j(1,0))),e.m_localAnchorA.Copy(f(t.localAnchorA,new j(-1,0))),e.m_localAnchorB.Copy(f(t.localAnchorB,new j(1,0))),e.m_lengthA=f(t.lengthA,0),e.m_lengthB=f(t.lengthB,0),e.m_ratio=f(t.ratio,1),e.m_constant=f(t.lengthA,0)+e.m_ratio*f(t.lengthB,0),e.m_impulse=0,e}Fi(rr,ir=rn),rr.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};var ir,nr=rr;function rr(){var t=ir.call(this,H.b2JointType.e_revoluteJoint)||this;return t.localAnchorA=new j(0,0),t.localAnchorB=new j(0,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerAngle=0,t.upperAngle=0,t.enableMotor=!1,t.motorSpeed=0,t.maxMotorTorque=0,t}Fi(ar,sr=on),ar.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=this.m_qA.SetAngle(e),o=this.m_qB.SetAngle(n),s=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(s,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(o,this.m_lalcB,this.m_rB),this.m_invMassA),o=this.m_invMassB,a=this.m_invIA,c=this.m_invIB,l=a+c===0;this.m_mass.ex.x=s+o+this.m_rA.y*this.m_rA.y*a+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*a-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*a-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=s+o+this.m_rA.x*this.m_rA.x*a+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*a+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=a+c,this.m_motorMass=a+c,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!l||(this.m_motorImpulse=0),this.m_enableLimit&&!l?(l=n-e-this.m_referenceAngle,L(this.m_upperAngle-this.m_lowerAngle)<2*D?this.m_limitState=H.b2LimitState.e_equalLimits:l<=this.m_lowerAngle?(this.m_limitState!==H.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=H.b2LimitState.e_atLowerLimit):l>=this.m_upperAngle?(this.m_limitState!==H.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=H.b2LimitState.e_atUpperLimit):(this.m_limitState=H.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=H.b2LimitState.e_inactiveLimit,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,n=ar.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),h.SelfMulSub(s,n),i-=a*(j.CrossVV(this.m_rA,n)+this.m_motorImpulse+this.m_impulse.z),u.SelfMulAdd(o,n),r+=c*(j.CrossVV(this.m_rB,n)+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},ar.prototype.SolveVelocityConstraints=function(t){var e,i,n,r,s,o,h=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,u=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,_=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,p=this.m_invIB,l=f+p===0;this.m_enableMotor&&this.m_limitState!==H.b2LimitState.e_equalLimits&&!l&&(s=c-a-this.m_motorSpeed,s=-this.m_motorMass*s,e=this.m_motorImpulse,o=t.step.dt*this.m_maxMotorTorque,this.m_motorImpulse=F(this.m_motorImpulse+s,-o,o),a-=f*(s=this.m_motorImpulse-e),c+=p*s),this.m_enableLimit&&this.m_limitState!==H.b2LimitState.e_inactiveLimit&&!l?(o=j.SubVV(j.AddVCrossSV(u,c,this.m_rB,j.s_t0),j.AddVCrossSV(h,a,this.m_rA,j.s_t1),ar.SolveVelocityConstraints_s_Cdot1),e=this.m_mass.Solve33(o.x,o.y,c-a,ar.SolveVelocityConstraints_s_impulse_v3).SelfNeg(),this.m_limitState===H.b2LimitState.e_equalLimits?this.m_impulse.SelfAdd(e):this.m_limitState===H.b2LimitState.e_atLowerLimit?this.m_impulse.z+e.z<0?(i=-o.x+this.m_impulse.z*this.m_mass.ez.x,n=-o.y+this.m_impulse.z*this.m_mass.ez.y,r=this.m_mass.Solve22(i,n,ar.SolveVelocityConstraints_s_reduced_v2),e.x=r.x,e.y=r.y,e.z=-this.m_impulse.z,this.m_impulse.x+=r.x,this.m_impulse.y+=r.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(e):this.m_limitState===H.b2LimitState.e_atUpperLimit&&(0<this.m_impulse.z+e.z?(i=-o.x+this.m_impulse.z*this.m_mass.ez.x,n=-o.y+this.m_impulse.z*this.m_mass.ez.y,r=this.m_mass.Solve22(i,n,ar.SolveVelocityConstraints_s_reduced_v2),e.x=r.x,e.y=r.y,e.z=-this.m_impulse.z,this.m_impulse.x+=r.x,this.m_impulse.y+=r.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(e)),s=ar.SolveVelocityConstraints_s_P.Set(e.x,e.y),h.SelfMulSub(_,s),a-=f*(j.CrossVV(this.m_rA,s)+e.z),u.SelfMulAdd(d,s),c+=p*(j.CrossVV(this.m_rB,s)+e.z)):(l=j.SubVV(j.AddVCrossSV(u,c,this.m_rB,j.s_t0),j.AddVCrossSV(h,a,this.m_rA,j.s_t1),ar.SolveVelocityConstraints_s_Cdot_v2),o=this.m_mass.Solve22(-l.x,-l.y,ar.SolveVelocityConstraints_s_impulse_v2),this.m_impulse.x+=o.x,this.m_impulse.y+=o.y,h.SelfMulSub(_,o),a-=f*j.CrossVV(this.m_rA,o),u.SelfMulAdd(d,o),c+=p*j.CrossVV(this.m_rB,o)),t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=c},ar.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c,e=t.positions[this.m_indexA].a,u=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,_=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(i),r=0,s=this.m_invIA+this.m_invIB===0,s=(this.m_enableLimit&&this.m_limitState!==H.b2LimitState.e_inactiveLimit&&!s&&(s=i-e-this.m_referenceAngle,a=0,this.m_limitState===H.b2LimitState.e_equalLimits?(o=F(s-this.m_lowerAngle,-p,p),a=-this.m_motorMass*o,r=L(o)):this.m_limitState===H.b2LimitState.e_atLowerLimit?(r=-(o=s-this.m_lowerAngle),o=F(o+D,-p,0),a=-this.m_motorMass*o):this.m_limitState===H.b2LimitState.e_atUpperLimit&&(o=F((r=o=s-this.m_upperAngle)-D,0,p),a=-this.m_motorMass*o),e-=this.m_invIA*a,i+=this.m_invIB*a),_.SetAngle(e),n.SetAngle(i),j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(_,this.m_lalcA,this.m_rA)),o=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(n,this.m_lalcB,this.m_rB)),a=j.SubVV(j.AddVV(u,o,j.s_t0),j.AddVV(h,s,j.s_t1),ar.SolvePositionConstraints_s_C_v2),_=a.Length(),n=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,l=this.m_K,l=(l.ex.x=n+d+c*s.y*s.y+f*o.y*o.y,l.ex.y=-c*s.x*s.y-f*o.x*o.y,l.ey.x=l.ex.y,l.ey.y=n+d+c*s.x*s.x+f*o.x*o.x,l.Solve(a.x,a.y,ar.SolvePositionConstraints_s_impulse).SelfNeg());return h.SelfMulSub(n,l),e-=c*j.CrossVV(s,l),u.SelfMulAdd(d,l),i+=f*j.CrossVV(o,l),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=i,_<=I&&r<=D},ar.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},ar.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},ar.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},ar.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},ar.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},ar.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},ar.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},ar.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},ar.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},ar.prototype.IsMotorEnabled=function(){return this.m_enableMotor},ar.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},ar.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},ar.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},ar.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},ar.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},ar.prototype.IsLimitEnabled=function(){return this.m_enableLimit},ar.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},ar.prototype.GetLowerLimit=function(){return this.m_lowerAngle},ar.prototype.GetUpperLimit=function(){return this.m_upperAngle},ar.prototype.SetLimits=function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},ar.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},ar.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},ar.InitVelocityConstraints_s_P=new j,ar.SolveVelocityConstraints_s_P=new j,ar.SolveVelocityConstraints_s_Cdot_v2=new j,ar.SolveVelocityConstraints_s_Cdot1=new j,ar.SolveVelocityConstraints_s_impulse_v3=new k,ar.SolveVelocityConstraints_s_reduced_v2=new j,ar.SolveVelocityConstraints_s_impulse_v2=new j,ar.SolvePositionConstraints_s_C_v2=new j,ar.SolvePositionConstraints_s_impulse=new j;var sr,or=ar;function ar(t){var e=sr.call(this,t)||this;return e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_impulse=new k,e.m_motorImpulse=0,e.m_enableMotor=!1,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_referenceAngle=0,e.m_lowerAngle=0,e.m_upperAngle=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new W,e.m_motorMass=0,e.m_limitState=H.b2LimitState.e_inactiveLimit,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_K=new z,e.m_localAnchorA.Copy(f(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,j.ZERO)),e.m_referenceAngle=f(t.referenceAngle,0),e.m_impulse.SetZero(),e.m_motorImpulse=0,e.m_lowerAngle=f(t.lowerAngle,0),e.m_upperAngle=f(t.upperAngle,0),e.m_maxMotorTorque=f(t.maxMotorTorque,0),e.m_motorSpeed=f(t.motorSpeed,0),e.m_enableLimit=f(t.enableLimit,!1),e.m_enableMotor=f(t.enableMotor,!1),e.m_limitState=H.b2LimitState.e_inactiveLimit,e}Fi(hr,cr=rn);var cr,lr=hr;function hr(){var t=cr.call(this,H.b2JointType.e_ropeJoint)||this;return t.localAnchorA=new j(-1,0),t.localAnchorB=new j(1,0),t.maxLength=0,t}Fi(dr,ur=on),dr.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,i=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(o),i=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(i,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(o,this.m_lalcB,this.m_rB),this.m_u.Copy(s).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length(),this.m_length-this.m_maxLength);if(this.m_state=0<i?H.b2LimitState.e_atUpperLimit:H.b2LimitState.e_inactiveLimit,!(this.m_length>I))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);o=j.CrossVV(this.m_rA,this.m_u),s=j.CrossVV(this.m_rB,this.m_u),e=this.m_invMassA+this.m_invIA*o*o+this.m_invMassB+this.m_invIB*s*s;this.m_mass=0!==e?1/e:0,t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,i=j.MulSV(this.m_impulse,this.m_u,dr.InitVelocityConstraints_s_P),n.SelfMulSub(this.m_invMassA,i),r-=this.m_invIA*j.CrossVV(this.m_rA,i),a.SelfMulAdd(this.m_invMassB,i),c+=this.m_invIB*j.CrossVV(this.m_rB,i)):this.m_impulse=0,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c},dr.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,s=j.AddVCrossSV(e,i,this.m_rA,dr.SolveVelocityConstraints_s_vpA),o=j.AddVCrossSV(n,r,this.m_rB,dr.SolveVelocityConstraints_s_vpB),a=this.m_length-this.m_maxLength,o=j.DotVV(this.m_u,j.SubVV(o,s,j.s_t0)),s=(a<0&&(o+=t.step.inv_dt*a),-this.m_mass*o),a=this.m_impulse,o=(this.m_impulse=V(0,this.m_impulse+s),s=this.m_impulse-a,j.MulSV(s,this.m_u,dr.SolveVelocityConstraints_s_P));e.SelfMulSub(this.m_invMassA,o),i-=this.m_invIA*j.CrossVV(this.m_rA,o),n.SelfMulAdd(this.m_invMassB,o),r+=this.m_invIB*j.CrossVV(this.m_rB,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r},dr.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r),s=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(s,this.m_lalcA,this.m_rA)),o=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(o,this.m_lalcB,this.m_rB)),a=this.m_u.Copy(n).SelfAdd(o).SelfSub(e).SelfSub(s),c=a.Normalize(),l=F(c-this.m_maxLength,0,.2),l=-this.m_mass*l,l=j.MulSV(l,a,dr.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,l),i-=this.m_invIA*j.CrossVV(s,l),n.SelfMulAdd(this.m_invMassB,l),r+=this.m_invIB*j.CrossVV(o,l),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,c-this.m_maxLength<I},dr.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},dr.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},dr.prototype.GetReactionForce=function(t,e){return j.MulSV(t*this.m_impulse,this.m_u,e)},dr.prototype.GetReactionTorque=function(t){return 0},dr.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},dr.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},dr.prototype.SetMaxLength=function(t){this.m_maxLength=t},dr.prototype.GetMaxLength=function(){return this.m_maxLength},dr.prototype.GetLimitState=function(){return this.m_state},dr.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},dr.InitVelocityConstraints_s_P=new j,dr.SolveVelocityConstraints_s_vpA=new j,dr.SolveVelocityConstraints_s_vpB=new j,dr.SolveVelocityConstraints_s_P=new j,dr.SolvePositionConstraints_s_P=new j;var ur,_r=dr;function dr(t){var e=ur.call(this,t)||this;return e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_maxLength=0,e.m_length=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new j,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_state=H.b2LimitState.e_inactiveLimit,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_localAnchorA.Copy(f(t.localAnchorA,new j(-1,0))),e.m_localAnchorB.Copy(f(t.localAnchorB,new j(1,0))),e.m_maxLength=f(t.maxLength,0),e}Fi(mr,fr=rn),mr.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};var fr,pr=mr;function mr(){var t=fr.call(this,H.b2JointType.e_weldJoint)||this;return t.localAnchorA=new j,t.localAnchorB=new j,t.referenceAngle=0,t.frequencyHz=0,t.dampingRatio=0,t}Fi(vr,yr=on),vr.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e,i,n,r,s=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,u=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,d=t.velocities[this.m_indexB].w,f=this.m_qA.SetAngle(s),p=this.m_qB.SetAngle(o),f=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(f,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(p,this.m_lalcB,this.m_rB),this.m_invMassA),p=this.m_invMassB,a=this.m_invIA,c=this.m_invIB,l=this.m_K;l.ex.x=f+p+this.m_rA.y*this.m_rA.y*a+this.m_rB.y*this.m_rB.y*c,l.ey.x=-this.m_rA.y*this.m_rA.x*a-this.m_rB.y*this.m_rB.x*c,l.ez.x=-this.m_rA.y*a-this.m_rB.y*c,l.ex.y=l.ey.x,l.ey.y=f+p+this.m_rA.x*this.m_rA.x*a+this.m_rB.x*this.m_rB.x*c,l.ez.y=this.m_rA.x*a+this.m_rB.x*c,l.ex.z=l.ez.x,l.ey.z=l.ez.y,l.ez.z=a+c,0<this.m_frequencyHz?(l.GetInverse22(this.m_mass),o=o-s-this.m_referenceAngle,s=2*m*this.m_frequencyHz,i=2*(r=0<(e=a+c)?1/e:0)*this.m_dampingRatio*s,n=t.step.dt,this.m_gamma=n*(i+n*(i=r*s*s)),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=o*n*i*this.m_gamma,e+=this.m_gamma,this.m_mass.ez.z=0!==e?1/e:0):(l.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0),t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r=vr.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),h.SelfMulSub(f,r),u-=a*(j.CrossVV(this.m_rA,r)+this.m_impulse.z),_.SelfMulAdd(p,r),d+=c*(j.CrossVV(this.m_rB,r)+this.m_impulse.z)):this.m_impulse.SetZero(),t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=d},vr.prototype.SolveVelocityConstraints=function(t){var e,i,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_invMassA,h=this.m_invMassB,c=this.m_invIA,l=this.m_invIB;0<this.m_frequencyHz?(e=-this.m_mass.ez.z*(o-r+this.m_bias+this.m_gamma*this.m_impulse.z),this.m_impulse.z+=e,r-=c*e,e=j.SubVV(j.AddVCrossSV(s,o+=l*e,this.m_rB,j.s_t0),j.AddVCrossSV(n,r,this.m_rA,j.s_t1),vr.SolveVelocityConstraints_s_Cdot1),i=W.MulM33XY(this.m_mass,e.x,e.y,vr.SolveVelocityConstraints_s_impulse1).SelfNeg(),this.m_impulse.x+=i.x,this.m_impulse.y+=i.y,n.SelfMulSub(a,i=i),r-=c*j.CrossVV(this.m_rA,i),s.SelfMulAdd(h,i),o+=l*j.CrossVV(this.m_rB,i)):(e=j.SubVV(j.AddVCrossSV(s,o,this.m_rB,j.s_t0),j.AddVCrossSV(n,r,this.m_rA,j.s_t1),vr.SolveVelocityConstraints_s_Cdot1),e=W.MulM33XYZ(this.m_mass,e.x,e.y,o-r,vr.SolveVelocityConstraints_s_impulse).SelfNeg(),this.m_impulse.SelfAdd(e),i=vr.SolveVelocityConstraints_s_P.Set(e.x,e.y),n.SelfMulSub(a,i),r-=c*(j.CrossVV(this.m_rA,i)+e.z),s.SelfMulAdd(h,i),o+=l*(j.CrossVV(this.m_rB,i)+e.z)),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o},vr.prototype.SolvePositionConstraints=function(t){var h,u,e,i,_=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,d=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(n),o=this.m_qB.SetAngle(r),f=this.m_invMassA,p=this.m_invMassB,a=this.m_invIA,c=this.m_invIB,s=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(s,this.m_lalcA,this.m_rA)),o=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(o,this.m_lalcB,this.m_rB)),l=this.m_K;return l.ex.x=f+p+s.y*s.y*a+o.y*o.y*c,l.ey.x=-s.y*s.x*a-o.y*o.x*c,l.ez.x=-s.y*a-o.y*c,l.ex.y=l.ey.x,l.ey.y=f+p+s.x*s.x*a+o.x*o.x*c,l.ez.y=s.x*a+o.x*c,l.ex.z=l.ez.x,l.ey.z=l.ez.y,l.ez.z=a+c,0<this.m_frequencyHz?(h=(e=j.SubVV(j.AddVV(d,o,j.s_t0),j.AddVV(_,s,j.s_t1),vr.SolvePositionConstraints_s_C1)).Length(),u=0,i=l.Solve22(e.x,e.y,vr.SolvePositionConstraints_s_P).SelfNeg(),_.SelfMulSub(f,i),n-=a*j.CrossVV(s,i),d.SelfMulAdd(p,i),r+=c*j.CrossVV(o,i)):(e=j.SubVV(j.AddVV(d,o,j.s_t0),j.AddVV(_,s,j.s_t1),vr.SolvePositionConstraints_s_C1),o=r-n-this.m_referenceAngle,h=e.Length(),u=L(o),s=l.Solve33(e.x,e.y,o,vr.SolvePositionConstraints_s_impulse).SelfNeg(),i=vr.SolvePositionConstraints_s_P.Set(s.x,s.y),_.SelfMulSub(f,i),n-=a*(j.CrossVV(this.m_rA,i)+s.z),d.SelfMulAdd(p,i),r+=c*(j.CrossVV(this.m_rB,i)+s.z)),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,h<=I&&u<=D},vr.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},vr.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},vr.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},vr.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},vr.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},vr.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},vr.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},vr.prototype.SetFrequency=function(t){this.m_frequencyHz=t},vr.prototype.GetFrequency=function(){return this.m_frequencyHz},vr.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},vr.prototype.GetDampingRatio=function(){return this.m_dampingRatio},vr.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},vr.InitVelocityConstraints_s_P=new j,vr.SolveVelocityConstraints_s_Cdot1=new j,vr.SolveVelocityConstraints_s_impulse1=new j,vr.SolveVelocityConstraints_s_impulse=new k,vr.SolveVelocityConstraints_s_P=new j,vr.SolvePositionConstraints_s_C1=new j,vr.SolvePositionConstraints_s_P=new j,vr.SolvePositionConstraints_s_impulse=new k;var yr,gr=vr;function vr(t){var e=yr.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_bias=0,e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_referenceAngle=0,e.m_gamma=0,e.m_impulse=new k(0,0,0),e.m_indexA=0,e.m_indexB=0,e.m_rA=new j,e.m_rB=new j,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new W,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_K=new W,e.m_frequencyHz=f(t.frequencyHz,0),e.m_dampingRatio=f(t.dampingRatio,0),e.m_localAnchorA.Copy(f(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,j.ZERO)),e.m_referenceAngle=f(t.referenceAngle,0),e.m_impulse.SetZero(),e}Fi(Ar,xr=rn),Ar.prototype.Initialize=function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA)};var xr,br=Ar;function Ar(){var t=xr.call(this,H.b2JointType.e_wheelJoint)||this;return t.localAnchorA=new j(0,0),t.localAnchorB=new j(0,0),t.localAxisA=new j(1,0),t.enableMotor=!1,t.maxMotorTorque=0,t.motorSpeed=0,t.frequencyHz=2,t.dampingRatio=.7,t}Fi(Tr,Cr=on),Tr.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Tr.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},Tr.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},Tr.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},Tr.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},Tr.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},Tr.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,s=t.positions[this.m_indexA].c,o=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v,u=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].c,c=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,d=t.velocities[this.m_indexB].w,o=this.m_qA.SetAngle(o),c=this.m_qB.SetAngle(c),l=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(o,this.m_lalcA,this.m_rA)),c=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(c,this.m_lalcB,this.m_rB)),a=j.SubVV(j.AddVV(a,c,j.s_t0),j.AddVV(s,l,j.s_t1),Tr.InitVelocityConstraints_s_d);B.MulRV(o,this.m_localYAxisA,this.m_ay),this.m_sAy=j.CrossVV(j.AddVV(a,l,j.s_t0),this.m_ay),this.m_sBy=j.CrossVV(c,this.m_ay),this.m_mass=e+i+n*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,0<this.m_mass&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,(this.m_gamma=0)<this.m_frequencyHz?(B.MulRV(o,this.m_localXAxisA,this.m_ax),this.m_sAx=j.CrossVV(j.AddVV(a,l,j.s_t0),this.m_ax),this.m_sBx=j.CrossVV(c,this.m_ax),0<(s=e+i+n*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx)&&(this.m_springMass=1/s,o=j.DotVV(a,this.m_ax),l=2*m*this.m_frequencyHz,c=2*this.m_springMass*this.m_dampingRatio*l,e=this.m_springMass*l*l,i=t.step.dt,this.m_gamma=i*(c+i*e),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=o*i*e*this.m_gamma,this.m_springMass=s+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass))):this.m_springImpulse=0,this.m_enableMotor?(this.m_motorMass=n+r,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio,a=j.AddVV(j.MulSV(this.m_impulse,this.m_ay,j.s_t0),j.MulSV(this.m_springImpulse,this.m_ax,j.s_t1),Tr.InitVelocityConstraints_s_P),l=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,c=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse,h.SelfMulSub(this.m_invMassA,a),u-=this.m_invIA*l,_.SelfMulAdd(this.m_invMassB,a),d+=this.m_invIB*c):(this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0),t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=d},Tr.prototype.SolveVelocityConstraints=function(t){var h=this.m_invMassA,u=this.m_invMassB,e=this.m_invIA,i=this.m_invIB,n=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=j.DotVV(this.m_ax,j.SubVV(s,n,j.s_t0))+this.m_sBx*o-this.m_sAx*r,c=-this.m_springMass*(a+this.m_bias+this.m_gamma*this.m_springImpulse),l=(this.m_springImpulse+=c,j.MulSV(c,this.m_ax,Tr.SolveVelocityConstraints_s_P)),_=c*this.m_sAx,d=c*this.m_sBx,a=(n.SelfMulSub(h,l),r-=e*_,s.SelfMulAdd(u,l),(o+=i*d)-r-this.m_motorSpeed),c=-this.m_motorMass*a,f=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque,a=(this.m_motorImpulse=F(this.m_motorImpulse+c,-p,p),r-=e*(c=this.m_motorImpulse-f),o+=i*c,j.DotVV(this.m_ay,j.SubVV(s,n,j.s_t0))+this.m_sBy*o-this.m_sAy*r),c=-this.m_mass*a,l=(this.m_impulse+=c,j.MulSV(c,this.m_ay,Tr.SolveVelocityConstraints_s_P)),_=c*this.m_sAy,d=c*this.m_sBy;n.SelfMulSub(h,l),r-=e*_,s.SelfMulAdd(u,l),o+=i*d,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o},Tr.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(r),a=(j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),B.MulRV(s,this.m_lalcA,this.m_rA)),o=(j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),B.MulRV(o,this.m_lalcB,this.m_rB)),c=j.AddVV(j.SubVV(n,e,j.s_t0),j.SubVV(o,a,j.s_t1),Tr.SolvePositionConstraints_s_d),s=B.MulRV(s,this.m_localYAxisA,this.m_ay),a=j.CrossVV(j.AddVV(c,a,j.s_t0),s),o=j.CrossVV(o,s),c=j.DotVV(c,this.m_ay),l=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,l=0!==l?-c/l:0,s=j.MulSV(l,s,Tr.SolvePositionConstraints_s_P),a=l*a,l=l*o;return e.SelfMulSub(this.m_invMassA,s),i-=this.m_invIA*a,n.SelfMulAdd(this.m_invMassB,s),r+=this.m_invIB*l,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,L(c)<=I},Tr.prototype.GetDefinition=function(t){return t},Tr.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},Tr.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},Tr.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},Tr.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse},Tr.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},Tr.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},Tr.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},Tr.prototype.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},Tr.prototype.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},Tr.prototype.GetJointAngle=function(){return this.GetRevoluteJointAngle()},Tr.prototype.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},Tr.prototype.GetPrismaticJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new j),e=e.GetWorldPoint(this.m_localAnchorB,new j),e=j.SubVV(e,i,new j),i=t.GetWorldVector(this.m_localXAxisA,new j);return j.DotVV(e,i)},Tr.prototype.GetPrismaticJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=(j.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA),B.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA)),n=(j.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB),B.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB)),r=j.AddVV(t.m_sweep.c,i,j.s_t0),s=j.AddVV(e.m_sweep.c,n,j.s_t1),s=j.SubVV(s,r,j.s_t2),r=t.GetWorldVector(this.m_localXAxisA,new j),o=t.m_linearVelocity,a=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return j.DotVV(s,j.CrossSV(t,r,j.s_t0))+j.DotVV(r,j.SubVV(j.AddVCrossSV(a,e,n,j.s_t0),j.AddVCrossSV(o,t,i,j.s_t1),j.s_t0))},Tr.prototype.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},Tr.prototype.GetRevoluteJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},Tr.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Tr.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},Tr.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},Tr.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},Tr.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},Tr.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},Tr.InitVelocityConstraints_s_d=new j,Tr.InitVelocityConstraints_s_P=new j,Tr.SolveVelocityConstraints_s_P=new j,Tr.SolvePositionConstraints_s_d=new j,Tr.SolvePositionConstraints_s_P=new j;var Cr,Sr=Tr;function Tr(t){var e=Cr.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_localAnchorA=new j,e.m_localAnchorB=new j,e.m_localXAxisA=new j,e.m_localYAxisA=new j,e.m_impulse=0,e.m_motorImpulse=0,e.m_springImpulse=0,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableMotor=!1,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new j,e.m_localCenterB=new j,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_ax=new j,e.m_ay=new j,e.m_sAx=0,e.m_sBx=0,e.m_sAy=0,e.m_sBy=0,e.m_mass=0,e.m_motorMass=0,e.m_springMass=0,e.m_bias=0,e.m_gamma=0,e.m_qA=new B,e.m_qB=new B,e.m_lalcA=new j,e.m_lalcB=new j,e.m_rA=new j,e.m_rB=new j,e.m_frequencyHz=f(t.frequencyHz,2),e.m_dampingRatio=f(t.dampingRatio,.7),e.m_localAnchorA.Copy(f(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(f(t.localAnchorB,j.ZERO)),e.m_localXAxisA.Copy(f(t.localAxisA,j.UNITX)),j.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_maxMotorTorque=f(t.maxMotorTorque,0),e.m_motorSpeed=f(t.motorSpeed,0),e.m_enableMotor=f(t.enableMotor,!1),e.m_ax.SetZero(),e.m_ay.SetZero(),e}function wr(t,e){return Y(t*e)}function Er(t,e){return e<t?t:e}var Mr=function(t){this.prev=null,this.next=null,this.contact=t},Ir=(Br.prototype.GetManifold=function(){return this.m_manifold},Br.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)},Br.prototype.IsTouching=function(){return this.m_touchingFlag},Br.prototype.SetEnabled=function(t){this.m_enabledFlag=t},Br.prototype.IsEnabled=function(){return this.m_enabledFlag},Br.prototype.GetNext=function(){return this.m_next},Br.prototype.GetFixtureA=function(){return this.m_fixtureA},Br.prototype.GetChildIndexA=function(){return this.m_indexA},Br.prototype.GetFixtureB=function(){return this.m_fixtureB},Br.prototype.GetChildIndexB=function(){return this.m_indexB},Br.prototype.FlagForFiltering=function(){this.m_filterFlag=!0},Br.prototype.SetFriction=function(t){this.m_friction=t},Br.prototype.GetFriction=function(){return this.m_friction},Br.prototype.ResetFriction=function(){this.m_friction=wr(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},Br.prototype.SetRestitution=function(t){this.m_restitution=t},Br.prototype.GetRestitution=function(){return this.m_restitution},Br.prototype.ResetRestitution=function(){this.m_restitution=Er(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},Br.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t},Br.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},Br.prototype.Reset=function(t,e,i,n){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=wr(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Er(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},Br.prototype.Update=function(t){var e=this.m_oldManifold,e=(this.m_oldManifold=this.m_manifold,this.m_manifold=e,!(this.m_enabledFlag=!0)),i=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),n=n||r,r=this.m_fixtureA.GetBody(),s=this.m_fixtureB.GetBody(),h=r.GetTransform(),u=s.GetTransform();if(n){var _=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape(),e=ue(_,this.m_indexA,d,this.m_indexB,h,u);this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,h,u),e=0<this.m_manifold.pointCount;for(var o=0;o<this.m_manifold.pointCount;++o)for(var a=this.m_manifold.points[o],f=(a.normalImpulse=0,a.tangentImpulse=0,a.id),c=0;c<this.m_oldManifold.pointCount;++c){var l=this.m_oldManifold.points[c];if(l.id.key===f.key){a.normalImpulse=l.normalImpulse,a.tangentImpulse=l.tangentImpulse;break}}e!==i&&(r.SetAwake(!0),s.SetAwake(!0))}this.m_touchingFlag=e,!i&&e&&t&&t.BeginContact(this),i&&!e&&t&&t.EndContact(this),!n&&e&&t&&t.PreSolve(this,this.m_oldManifold)},Br.prototype.ComputeTOI=function(t,e){var i=Br.ComputeTOI_s_input,t=(i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=I,Br.ComputeTOI_s_output);return ze(t,i),t.t},Br.ComputeTOI_s_input=new Me,Br.ComputeTOI_s_output=new Ie,Br);function Br(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new qt,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new qt,this.m_nodeA=new Mr(this),this.m_nodeB=new Mr(this)}Fi(Dr,Rr=Ir),Dr.Create=function(t){return new Dr},Dr.Destroy=function(t,e){},Dr.prototype.Reset=function(t,e,i,n){Rr.prototype.Reset.call(this,t,e,i,n)},Dr.prototype.Evaluate=function(t,e,i){He(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)};var Rr,Pr=Dr;function Dr(){return Rr.call(this)||this}Fi(Or,Lr=Ir),Or.Create=function(t){return new Or},Or.Destroy=function(t,e){},Or.prototype.Reset=function(t,e,i,n){Lr.prototype.Reset.call(this,t,e,i,n)},Or.prototype.Evaluate=function(t,e,i){yi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)};var Lr,Vr=Or;function Or(){return Lr.call(this)||this}Fi(kr,Fr=Ir),kr.Create=function(t){return new kr},kr.Destroy=function(t,e){},kr.prototype.Reset=function(t,e,i,n){Fr.prototype.Reset.call(this,t,e,i,n)},kr.prototype.Evaluate=function(t,e,i){qe(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)};var Fr,Nr=kr;function kr(){return Fr.call(this)||this}Fi(Ur,Gr=Ir),Ur.Create=function(t){return new Ur},Ur.Destroy=function(t,e){},Ur.prototype.Reset=function(t,e,i,n){Gr.prototype.Reset.call(this,t,e,i,n)},Ur.prototype.Evaluate=function(t,e,i){wi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)};var Gr,zr=Ur;function Ur(){return Gr.call(this)||this}Fi(jr,Wr=Ir),jr.Create=function(t){return new jr},jr.Destroy=function(t,e){},jr.prototype.Reset=function(t,e,i,n){Wr.prototype.Reset.call(this,t,e,i,n)},jr.prototype.Evaluate=function(t,e,i){Pi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)};var Wr,Hr=jr;function jr(){return Wr.call(this)||this}Fi(qr,Xr=Ir),qr.Create=function(t){return new qr},qr.Destroy=function(t,e){},qr.prototype.Reset=function(t,e,i,n){Xr.prototype.Reset.call(this,t,e,i,n)},qr.prototype.Evaluate=function(t,e,i){var n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),s=qr.Evaluate_s_edge;n.GetChildEdge(s,this.m_indexA),wi(t,s,e,r,i)},qr.Evaluate_s_edge=new Ui;var Xr,Yr=qr;function qr(){return Xr.call(this)||this}Fi(Kr,Jr=Ir),Kr.Create=function(t){return new Kr},Kr.Destroy=function(t,e){},Kr.prototype.Reset=function(t,e,i,n){Jr.prototype.Reset.call(this,t,e,i,n)},Kr.prototype.Evaluate=function(t,e,i){var n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),s=Kr.Evaluate_s_edge;n.GetChildEdge(s,this.m_indexA),Pi(t,s,e,r,i)},Kr.Evaluate_s_edge=new Ui;var Jr,Zr=Kr;function Kr(){return Jr.call(this)||this}var Qr=function(){this.createFcn=null,this.destroyFcn=null,this.primary=!1},$r=(ts.prototype.AddType=function(e,t,i,n){var r=this,s=c(256,function(t){return e(r.m_allocator)});function o(t){return s.pop()||e(t)}function a(t,e){s.push(t)}this.m_registers[i][n].createFcn=o,this.m_registers[i][n].destroyFcn=a,this.m_registers[i][n].primary=!0,i!==n&&(this.m_registers[n][i].createFcn=o,this.m_registers[n][i].destroyFcn=a,this.m_registers[n][i].primary=!1)},ts.prototype.InitializeRegisters=function(){this.m_registers=[];for(var t=0;t<H.b2ShapeType.e_shapeTypeCount;t++){this.m_registers[t]=[];for(var e=0;e<H.b2ShapeType.e_shapeTypeCount;e++)this.m_registers[t][e]=new Qr}this.AddType(Pr.Create,Pr.Destroy,H.b2ShapeType.e_circleShape,H.b2ShapeType.e_circleShape),this.AddType(Nr.Create,Nr.Destroy,H.b2ShapeType.e_polygonShape,H.b2ShapeType.e_circleShape),this.AddType(Vr.Create,Vr.Destroy,H.b2ShapeType.e_polygonShape,H.b2ShapeType.e_polygonShape),this.AddType(zr.Create,zr.Destroy,H.b2ShapeType.e_edgeShape,H.b2ShapeType.e_circleShape),this.AddType(Hr.Create,Hr.Destroy,H.b2ShapeType.e_edgeShape,H.b2ShapeType.e_polygonShape),this.AddType(Yr.Create,Yr.Destroy,H.b2ShapeType.e_chainShape,H.b2ShapeType.e_circleShape),this.AddType(Zr.Create,Zr.Destroy,H.b2ShapeType.e_chainShape,H.b2ShapeType.e_polygonShape)},ts.prototype.Create=function(t,e,i,n){var r=t.GetType(),s=i.GetType(),r=this.m_registers[r][s];return r.createFcn?(s=r.createFcn(this.m_allocator),r.primary?s.Reset(t,e,i,n):s.Reset(i,n,t,e),s):null},ts.prototype.Destroy=function(t){var e=t.m_fixtureA,i=t.m_fixtureB,e=(0<t.m_manifold.pointCount&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),e.GetType()),i=i.GetType(),e=this.m_registers[e][i];e.destroyFcn&&e.destroyFcn(t,this.m_allocator)},ts);function ts(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}is.prototype.SayGoodbyeJoint=function(t){},is.prototype.SayGoodbyeFixture=function(t){},is.prototype.SayGoodbyeParticleGroup=function(t){},is.prototype.SayGoodbyeParticle=function(t,e){};var es=is;function is(){}rs.prototype.ShouldCollide=function(t,e){var i=t.GetBody(),n=e.GetBody();if(n.GetType()===H.b2BodyType.b2_staticBody&&i.GetType()===H.b2BodyType.b2_staticBody)return!1;if(!n.ShouldCollideConnected(i))return!1;n=t.GetFilterData(),i=e.GetFilterData();return n.groupIndex===i.groupIndex&&0!==n.groupIndex?0<n.groupIndex:0!=(n.maskBits&i.categoryBits)&&0!=(n.categoryBits&i.maskBits)},rs.prototype.ShouldCollideFixtureParticle=function(t,e,i){return!0},rs.prototype.ShouldCollideParticleParticle=function(t,e,i){return!0},rs.b2_defaultFilter=new rs;var ns=rs;function rs(){}var ss=function(){this.normalImpulses=h(2),this.tangentImpulses=h(2),this.count=0},os=(as.prototype.BeginContact=function(t){},as.prototype.EndContact=function(t){},as.prototype.BeginContactFixtureParticle=function(t,e){},as.prototype.EndContactFixtureParticle=function(t,e){},as.prototype.BeginContactParticleParticle=function(t,e){},as.prototype.EndContactParticleParticle=function(t,e){},as.prototype.PreSolve=function(t,e){},as.prototype.PostSolve=function(t,e){},as.b2_defaultListener=new as,as);function as(){}ls.prototype.ReportFixture=function(t){return!0},ls.prototype.ReportParticle=function(t,e){return!1},ls.prototype.ShouldQueryParticleSystem=function(t){return!0};var cs=ls;function ls(){}us.prototype.ReportFixture=function(t,e,i,n){return n},us.prototype.ReportParticle=function(t,e,i,n,r){return 0},us.prototype.ShouldQueryParticleSystem=function(t){return!0};var hs=us;function us(){}ds.prototype.AddPair=function(t,e){var i=t.fixture,n=e.fixture,r=t.childIndex,s=e.childIndex,o=i.GetBody(),t=n.GetBody();if(o!==t){for(var a=t.GetContactList();a;){if(a.other===o){var c=a.contact.GetFixtureA(),l=a.contact.GetFixtureB(),h=a.contact.GetChildIndexA(),u=a.contact.GetChildIndexB();if(c===i&&l===n&&h===r&&u===s)return;if(c===n&&l===i&&h===s&&u===r)return}a=a.next}this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,n)||null!==(e=this.m_contactFactory.Create(i,r,n,s))&&(i=e.GetFixtureA(),n=e.GetFixtureB(),r=e.GetChildIndexA(),s=e.GetChildIndexB(),o=i.m_body,t=n.m_body,e.m_prev=null,e.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=e),((this.m_contactList=e).m_nodeA.contact=e).m_nodeA.other=t,e.m_nodeA.prev=null,e.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=e.m_nodeA),o.m_contactList=e.m_nodeA,(e.m_nodeB.contact=e).m_nodeB.other=o,e.m_nodeB.prev=null,e.m_nodeB.next=t.m_contactList,null!==t.m_contactList&&(t.m_contactList.prev=e.m_nodeB),t.m_contactList=e.m_nodeB,i.IsSensor()||n.IsSensor()||(o.SetAwake(!0),t.SetAwake(!0)),++this.m_contactCount)}},ds.prototype.FindNewContacts=function(){var i=this;this.m_broadPhase.UpdatePairs(function(t,e){i.AddPair(t,e)})},ds.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),e=e.GetBody(),i=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===e.m_contactList&&(e.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===i.m_contactList&&(i.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},ds.prototype.Collide=function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=t.GetChildIndexA(),r=t.GetChildIndexB(),s=e.GetBody(),o=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){t=(a=t).m_next;this.Destroy(a);continue}t.m_filterFlag=!1}var a,s=s.IsAwake()&&s.m_type!==H.b2BodyType.b2_staticBody,o=o.IsAwake()&&o.m_type!==H.b2BodyType.b2_staticBody;s||o?(s=e.m_proxies[n].treeNode,o=i.m_proxies[r].treeNode,oe(s.aabb,o.aabb)?(t.Update(this.m_contactListener),t=t.m_next):(t=(a=t).m_next,this.Destroy(a))):t=t.m_next}};var _s=ds;function ds(){this.m_broadPhase=new ge,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=ns.b2_defaultFilter,this.m_contactListener=os.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new $r(this.m_allocator)}ps.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this};var fs=ps;function ps(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}ys.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this};var ms=ys;function ys(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}vs.MakeArray=function(t){return c(t,function(t){return new vs})};var gs=vs;function vs(){this.c=new j,this.a=0}bs.MakeArray=function(t){return c(t,function(t){return new bs})};var xs=bs;function bs(){this.v=new j,this.w=0}var As=function(){this.step=new ms},Cs=(Ss.MakeArray=function(t){return c(t,function(t){return new Ss})},Ss);function Ss(){this.rA=new j,this.rB=new j,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}ws.MakeArray=function(t){return c(t,function(t){return new ws})};var Ts=ws;function ws(){this.points=Cs.MakeArray(2),this.normal=new j,this.tangent=new j,this.normalMass=new z,this.K=new z,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}Ms.MakeArray=function(t){return c(t,function(t){return new Ms})};var Es=Ms;function Ms(){this.localPoints=j.MakeArray(2),this.localNormal=new j,this.localPoint=new j,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new j,this.localCenterB=new j,this.invIA=0,this.invIB=0,this.type=H.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}var Is=function(){this.step=new ms,this.count=0,this.allocator=null},Bs=(Rs.prototype.Initialize=function(t,e,i,n){var r=Rs.Initialize_s_pointA,s=Rs.Initialize_s_pointB,o=Rs.Initialize_s_planePoint,a=Rs.Initialize_s_clipPoint;switch(t.type){case H.b2ManifoldType.e_circles:R.MulXV(e,t.localPoint,r),R.MulXV(i,t.localPoints[0],s),j.SubVV(s,r,this.normal).SelfNormalize(),j.MidVV(r,s,this.point),this.separation=j.DotVV(j.SubVV(s,r,j.s_t0),this.normal)-t.radiusA-t.radiusB;break;case H.b2ManifoldType.e_faceA:B.MulRV(e.q,t.localNormal,this.normal),R.MulXV(e,t.localPoint,o),R.MulXV(i,t.localPoints[n],a),this.separation=j.DotVV(j.SubVV(a,o,j.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(a);break;case H.b2ManifoldType.e_faceB:B.MulRV(i.q,t.localNormal,this.normal),R.MulXV(i,t.localPoint,o),R.MulXV(e,t.localPoints[n],a),this.separation=j.DotVV(j.SubVV(a,o,j.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(a),this.normal.SelfNeg()}},Rs.Initialize_s_pointA=new j,Rs.Initialize_s_pointB=new j,Rs.Initialize_s_planePoint=new j,Rs.Initialize_s_clipPoint=new j,Rs);function Rs(){this.normal=new j,this.point=new j,this.separation=0}Ds.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var h=O(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<h;)this.m_positionConstraints[this.m_positionConstraints.length]=new Es;if(this.m_velocityConstraints.length<this.m_count)for(h=O(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<h;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new Ts;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var e=0;e<this.m_count;++e){var i=this.m_contacts[e],n=i.m_fixtureA,r=i.m_fixtureB,u=n.GetShape(),_=r.GetShape(),u=u.m_radius,_=_.m_radius,n=n.GetBody(),r=r.GetBody(),s=i.GetManifold(),d=s.pointCount,o=this.m_velocityConstraints[e],a=(o.friction=i.m_friction,o.restitution=i.m_restitution,o.tangentSpeed=i.m_tangentSpeed,o.indexA=n.m_islandIndex,o.indexB=r.m_islandIndex,o.invMassA=n.m_invMass,o.invMassB=r.m_invMass,o.invIA=n.m_invI,o.invIB=r.m_invI,o.contactIndex=e,o.pointCount=d,o.K.SetZero(),o.normalMass.SetZero(),this.m_positionConstraints[e]);a.indexA=n.m_islandIndex,a.indexB=r.m_islandIndex,a.invMassA=n.m_invMass,a.invMassB=r.m_invMass,a.localCenterA.Copy(n.m_sweep.localCenter),a.localCenterB.Copy(r.m_sweep.localCenter),a.invIA=n.m_invI,a.invIB=r.m_invI,a.localNormal.Copy(s.localNormal),a.localPoint.Copy(s.localPoint),a.pointCount=d,a.radiusA=u,a.radiusB=_,a.type=s.type;for(var c=0;c<d;++c){var f=s.points[c],l=o.points[c];this.m_step.warmStarting?(l.normalImpulse=this.m_step.dtRatio*f.normalImpulse,l.tangentImpulse=this.m_step.dtRatio*f.tangentImpulse):(l.normalImpulse=0,l.tangentImpulse=0),l.rA.SetZero(),l.rB.SetZero(),l.normalMass=0,l.tangentMass=0,l.velocityBias=0,a.localPoints[c].Copy(f.localPoint)}}return this},Ds.prototype.InitializeVelocityConstraints=function(){for(var t=Ds.InitializeVelocityConstraints_s_xfA,e=Ds.InitializeVelocityConstraints_s_xfB,i=Ds.InitializeVelocityConstraints_s_worldManifold,h=0;h<this.m_count;++h){for(var n=this.m_velocityConstraints[h],r=this.m_positionConstraints[h],u=r.radiusA,_=r.radiusB,d=this.m_contacts[n.contactIndex].GetManifold(),s=n.indexA,f=n.indexB,p=n.invMassA,m=n.invMassB,y=n.invIA,g=n.invIB,v=r.localCenterA,r=r.localCenterB,x=this.m_positions[s].c,b=this.m_positions[s].a,A=this.m_velocities[s].v,C=this.m_velocities[s].w,S=this.m_positions[f].c,s=this.m_positions[f].a,T=this.m_velocities[f].v,w=this.m_velocities[f].w,E=(t.q.SetAngle(b),e.q.SetAngle(s),j.SubVV(x,B.MulRV(t.q,v,j.s_t0),t.p),j.SubVV(S,B.MulRV(e.q,r,j.s_t0),e.p),i.Initialize(d,t,u,e,_),n.normal.Copy(i.normal),j.CrossVOne(n.normal,n.tangent),n.pointCount),o=0;o<E;++o){var a=n.points[o],c=(j.SubVV(i.points[o],x,a.rA),j.SubVV(i.points[o],S,a.rB),j.CrossVV(a.rA,n.normal)),l=j.CrossVV(a.rB,n.normal),c=p+m+y*c*c+g*l*l,l=(a.normalMass=0<c?1/c:0,n.tangent),c=j.CrossVV(a.rA,l),l=j.CrossVV(a.rB,l),c=p+m+y*c*c+g*l*l,l=(a.tangentMass=0<c?1/c:0,a.velocityBias=0,j.DotVV(n.normal,j.SubVV(j.AddVCrossSV(T,w,a.rB,j.s_t0),j.AddVCrossSV(A,C,a.rA,j.s_t1),j.s_t0)));l<-1&&(a.velocityBias+=-n.restitution*l)}n.pointCount}},Ds.prototype.WarmStart=function(){for(var t=Ds.WarmStart_s_P,e=0;e<this.m_count;++e){for(var i=this.m_velocityConstraints[e],n=i.indexA,r=i.indexB,s=i.invMassA,h=i.invIA,u=i.invMassB,_=i.invIB,d=i.pointCount,f=this.m_velocities[n].v,o=this.m_velocities[n].w,p=this.m_velocities[r].v,a=this.m_velocities[r].w,m=i.normal,y=i.tangent,c=0;c<d;++c){var l=i.points[c];j.AddVV(j.MulSV(l.normalImpulse,m,j.s_t0),j.MulSV(l.tangentImpulse,y,j.s_t1),t),o-=h*j.CrossVV(l.rA,t),f.SelfMulSub(s,t),a+=_*j.CrossVV(l.rB,t),p.SelfMulAdd(u,t)}this.m_velocities[n].w=o,this.m_velocities[r].w=a}},Ds.prototype.SolveVelocityConstraints=function(){for(var t=Ds.SolveVelocityConstraints_s_dv,e=Ds.SolveVelocityConstraints_s_P,h=0;h<this.m_count;++h){for(var i=this.m_velocityConstraints[h],u=i.indexA,_=i.indexB,d=i.invMassA,f=i.invIA,p=i.invMassB,m=i.invIB,y=i.pointCount,n=this.m_velocities[u].v,r=this.m_velocities[u].w,s=this.m_velocities[_].v,o=this.m_velocities[_].w,g=i.normal,v=i.tangent,x=i.friction,a=0;a<y;++a){var c=i.points[a],b=(j.SubVV(j.AddVCrossSV(s,o,c.rB,j.s_t0),j.AddVCrossSV(n,r,c.rA,j.s_t1),t),j.DotVV(t,v)-i.tangentSpeed),l=c.tangentMass*-b,b=x*c.normalImpulse;l=(A=F(c.tangentImpulse+l,-b,b))-c.tangentImpulse,c.tangentImpulse=A,j.MulSV(l,v,e),n.SelfMulSub(d,e),r-=f*j.CrossVV(c.rA,e),s.SelfMulAdd(p,e),o+=m*j.CrossVV(c.rB,e)}i.pointCount;for(a=0;a<y;++a){var A,c=i.points[a],C=(j.SubVV(j.AddVCrossSV(s,o,c.rB,j.s_t0),j.AddVCrossSV(n,r,c.rA,j.s_t1),t),j.DotVV(t,g)),l=-c.normalMass*(C-c.velocityBias);l=(A=O(c.normalImpulse+l,0))-c.normalImpulse,c.normalImpulse=A,j.MulSV(l,g,e),n.SelfMulSub(d,e),r-=f*j.CrossVV(c.rA,e),s.SelfMulAdd(p,e),o+=m*j.CrossVV(c.rB,e)}this.m_velocities[u].w=r,this.m_velocities[_].w=o}},Ds.prototype.StoreImpulses=function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),n=0;n<e.pointCount;++n)i.points[n].normalImpulse=e.points[n].normalImpulse,i.points[n].tangentImpulse=e.points[n].tangentImpulse},Ds.prototype.SolvePositionConstraints=function(){for(var t=Ds.SolvePositionConstraints_s_xfA,e=Ds.SolvePositionConstraints_s_xfB,i=Ds.SolvePositionConstraints_s_psm,n=Ds.SolvePositionConstraints_s_rA,r=Ds.SolvePositionConstraints_s_rB,s=Ds.SolvePositionConstraints_s_P,o=0,a=0;a<this.m_count;++a){for(var c=this.m_positionConstraints[a],h=c.indexA,u=c.indexB,_=c.localCenterA,d=c.invMassA,f=c.invIA,p=c.localCenterB,m=c.invMassB,y=c.invIB,g=c.pointCount,v=this.m_positions[h].c,x=this.m_positions[h].a,b=this.m_positions[u].c,A=this.m_positions[u].a,C=0;C<g;++C){t.q.SetAngle(x),e.q.SetAngle(A),j.SubVV(v,B.MulRV(t.q,_,j.s_t0),t.p),j.SubVV(b,B.MulRV(e.q,p,j.s_t0),e.p),i.Initialize(c,t,e,C);var S=i.normal,T=i.point,l=i.separation,T=(j.SubVV(T,v,n),j.SubVV(T,b,r),o=V(o,l),F(.2*(l+I),-.2,0)),l=j.CrossVV(n,S),w=j.CrossVV(r,S),l=d+m+f*l*l+y*w*w;j.MulSV(0<l?-T/l:0,S,s),v.SelfMulSub(d,s),x-=f*j.CrossVV(n,s),b.SelfMulAdd(m,s),A+=y*j.CrossVV(r,s)}this.m_positions[h].a=x,this.m_positions[u].a=A}return-.024<o},Ds.prototype.SolveTOIPositionConstraints=function(h,u){for(var t=Ds.SolveTOIPositionConstraints_s_xfA,e=Ds.SolveTOIPositionConstraints_s_xfB,i=Ds.SolveTOIPositionConstraints_s_psm,n=Ds.SolveTOIPositionConstraints_s_rA,r=Ds.SolveTOIPositionConstraints_s_rB,s=Ds.SolveTOIPositionConstraints_s_P,_=0,d=0;d<this.m_count;++d){for(var o=this.m_positionConstraints[d],a=o.indexA,c=o.indexB,f=o.localCenterA,p=o.localCenterB,m=o.pointCount,y=0,g=0,v=(a!==h&&a!==u||(y=o.invMassA,g=o.invIA),0),x=0,b=(c!==h&&c!==u||(v=o.invMassB,x=o.invIB),this.m_positions[a].c),A=this.m_positions[a].a,C=this.m_positions[c].c,S=this.m_positions[c].a,T=0;T<m;++T){t.q.SetAngle(A),e.q.SetAngle(S),j.SubVV(b,B.MulRV(t.q,f,j.s_t0),t.p),j.SubVV(C,B.MulRV(e.q,p,j.s_t0),e.p),i.Initialize(o,t,e,T);var w=i.normal,E=i.point,l=i.separation,E=(j.SubVV(E,b,n),j.SubVV(E,C,r),_=V(_,l),F(.75*(l+I),-.2,0)),l=j.CrossVV(n,w),M=j.CrossVV(r,w),l=y+v+g*l*l+x*M*M;j.MulSV(0<l?-E/l:0,w,s),b.SelfMulSub(y,s),A-=g*j.CrossVV(n,s),C.SelfMulAdd(v,s),S+=x*j.CrossVV(r,s)}this.m_positions[a].a=A,this.m_positions[c].a=S}return-.012<=_},Ds.InitializeVelocityConstraints_s_xfA=new R,Ds.InitializeVelocityConstraints_s_xfB=new R,Ds.InitializeVelocityConstraints_s_worldManifold=new Zt,Ds.WarmStart_s_P=new j,Ds.SolveVelocityConstraints_s_dv=new j,Ds.SolveVelocityConstraints_s_dv1=new j,Ds.SolveVelocityConstraints_s_dv2=new j,Ds.SolveVelocityConstraints_s_P=new j,Ds.SolveVelocityConstraints_s_a=new j,Ds.SolveVelocityConstraints_s_b=new j,Ds.SolveVelocityConstraints_s_x=new j,Ds.SolveVelocityConstraints_s_d=new j,Ds.SolveVelocityConstraints_s_P1=new j,Ds.SolveVelocityConstraints_s_P2=new j,Ds.SolveVelocityConstraints_s_P1P2=new j,Ds.SolvePositionConstraints_s_xfA=new R,Ds.SolvePositionConstraints_s_xfB=new R,Ds.SolvePositionConstraints_s_psm=new Bs,Ds.SolvePositionConstraints_s_rA=new j,Ds.SolvePositionConstraints_s_rB=new j,Ds.SolvePositionConstraints_s_P=new j,Ds.SolveTOIPositionConstraints_s_xfA=new R,Ds.SolveTOIPositionConstraints_s_xfB=new R,Ds.SolveTOIPositionConstraints_s_psm=new Bs,Ds.SolveTOIPositionConstraints_s_rA=new j,Ds.SolveTOIPositionConstraints_s_rB=new j,Ds.SolveTOIPositionConstraints_s_P=new j;var Ps=Ds;function Ds(){this.m_step=new ms,this.m_allocator=null,this.m_positionConstraints=Es.MakeArray(1024),this.m_velocityConstraints=Ts.MakeArray(1024),this.m_count=0}Vs.prototype.Initialize=function(t,e,i,n,r){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=r,this.m_positions.length<t)for(var s=O(2*this.m_positions.length,t);this.m_positions.length<s;)this.m_positions[this.m_positions.length]=new gs;if(this.m_velocities.length<t)for(s=O(2*this.m_velocities.length,t);this.m_velocities.length<s;)this.m_velocities[this.m_velocities.length]=new xs},Vs.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Vs.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},Vs.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},Vs.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},Vs.prototype.Solve=function(h,t,u,_){for(var e=Vs.s_timer.Reset(),i=t.dt,n=0;n<this.m_bodyCount;++n){var r=this.m_bodies[n],d=(this.m_positions[n].c.Copy(r.m_sweep.c),r.m_sweep.a),s=this.m_velocities[n].v.Copy(r.m_linearVelocity),o=r.m_angularVelocity;r.m_sweep.c0.Copy(r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.m_type===H.b2BodyType.b2_dynamicBody&&(s.x+=i*(r.m_gravityScale*u.x+r.m_invMass*r.m_force.x),s.y+=i*(r.m_gravityScale*u.y+r.m_invMass*r.m_force.y),o+=i*r.m_invI*r.m_torque,s.SelfMul(1/(1+i*r.m_linearDamping)),o*=1/(1+i*r.m_angularDamping)),this.m_positions[n].a=d,this.m_velocities[n].w=o}e.Reset();var a=Vs.s_solverData,c=(a.step.Copy(t),a.positions=this.m_positions,a.velocities=this.m_velocities,Vs.s_contactSolverDef),l=(c.step.Copy(t),c.contacts=this.m_contacts,c.count=this.m_contactCount,c.positions=this.m_positions,c.velocities=this.m_velocities,c.allocator=this.m_allocator,Vs.s_contactSolver.Initialize(c));l.InitializeVelocityConstraints(),t.warmStarting&&l.WarmStart();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].InitVelocityConstraints(a);h.solveInit=e.GetMilliseconds(),e.Reset();for(n=0;n<t.velocityIterations;++n){for(var f=0;f<this.m_jointCount;++f)this.m_joints[f].SolveVelocityConstraints(a);l.SolveVelocityConstraints()}l.StoreImpulses(),h.solveVelocity=e.GetMilliseconds();for(n=0;n<this.m_bodyCount;++n){var p,m=this.m_positions[n].c,d=this.m_positions[n].a,s=this.m_velocities[n].v,o=this.m_velocities[n].w,y=j.MulSV(i,s,Vs.s_translation),y=(4<j.DotVV(y,y)&&(p=2/y.Length(),s.SelfMul(p)),i*o);w<y*y&&(o*=p=T/L(y)),m.x+=i*s.x,m.y+=i*s.y,d+=i*o,this.m_positions[n].a=d,this.m_velocities[n].w=o}e.Reset();for(var g=!1,n=0;n<t.positionIterations;++n){for(var v=l.SolvePositionConstraints(),x=!0,f=0;f<this.m_jointCount;++f)var b=this.m_joints[f].SolvePositionConstraints(a),x=x&&b;if(v&&x){g=!0;break}}for(n=0;n<this.m_bodyCount;++n){var A=this.m_bodies[n];A.m_sweep.c.Copy(this.m_positions[n].c),A.m_sweep.a=this.m_positions[n].a,A.m_linearVelocity.Copy(this.m_velocities[n].v),A.m_angularVelocity=this.m_velocities[n].w,A.SynchronizeTransform()}if(h.solvePosition=e.GetMilliseconds(),this.Report(l.m_velocityConstraints),_){for(var C=P,n=0;n<this.m_bodyCount;++n)(r=this.m_bodies[n]).GetType()!==H.b2BodyType.b2_staticBody&&(C=!r.m_autoSleepFlag||.0012184696791469947<r.m_angularVelocity*r.m_angularVelocity||1e-4<j.DotVV(r.m_linearVelocity,r.m_linearVelocity)?r.m_sleepTime=0:(r.m_sleepTime+=i,V(C,r.m_sleepTime)));if(.5<=C&&g)for(n=0;n<this.m_bodyCount;++n)(r=this.m_bodies[n]).SetAwake(!1)}},Vs.prototype.SolveTOI=function(t,e,i){for(var n=0;n<this.m_bodyCount;++n){var r=this.m_bodies[n];this.m_positions[n].c.Copy(r.m_sweep.c),this.m_positions[n].a=r.m_sweep.a,this.m_velocities[n].v.Copy(r.m_linearVelocity),this.m_velocities[n].w=r.m_angularVelocity}for(var s=Vs.s_contactSolverDef,o=(s.contacts=this.m_contacts,s.count=this.m_contactCount,s.allocator=this.m_allocator,s.step.Copy(t),s.positions=this.m_positions,s.velocities=this.m_velocities,Vs.s_contactSolver.Initialize(s)),n=0;n<t.positionIterations&&!o.SolveTOIPositionConstraints(e,i);++n);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,o.InitializeVelocityConstraints();for(n=0;n<t.velocityIterations;++n)o.SolveVelocityConstraints();for(var a=t.dt,n=0;n<this.m_bodyCount;++n){var h,u=this.m_positions[n].c,_=this.m_positions[n].a,d=this.m_velocities[n].v,c=this.m_velocities[n].w,l=j.MulSV(a,d,Vs.s_translation),l=(4<j.DotVV(l,l)&&(h=2/l.Length(),d.SelfMul(h)),a*c),l=(w<l*l&&(c*=h=T/L(l)),u.SelfMulAdd(a,d),_+=a*c,this.m_positions[n].a=_,this.m_velocities[n].w=c,this.m_bodies[n]);l.m_sweep.c.Copy(u),l.m_sweep.a=_,l.m_linearVelocity.Copy(d),l.m_angularVelocity=c,l.SynchronizeTransform()}this.Report(o.m_velocityConstraints)},Vs.prototype.Report=function(t){if(null!==this.m_listener)for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];if(i){var n=t[e],r=Vs.s_impulse;r.count=n.pointCount;for(var s=0;s<n.pointCount;++s)r.normalImpulses[s]=n.points[s].normalImpulse,r.tangentImpulses[s]=n.points[s].tangentImpulse;this.m_listener.PostSolve(i,r)}}},Vs.s_timer=new nt,Vs.s_solverData=new As,Vs.s_contactSolverDef=new Is,Vs.s_contactSolver=new Ps,Vs.s_translation=new j,Vs.s_impulse=new ss;var Ls=Vs;function Vs(){this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=gs.MakeArray(1024),this.m_velocities=xs.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}(Ys=H.b2ParticleFlag||(H.b2ParticleFlag={}))[Ys.b2_waterParticle=0]="b2_waterParticle",Ys[Ys.b2_zombieParticle=2]="b2_zombieParticle",Ys[Ys.b2_wallParticle=4]="b2_wallParticle",Ys[Ys.b2_springParticle=8]="b2_springParticle",Ys[Ys.b2_elasticParticle=16]="b2_elasticParticle",Ys[Ys.b2_viscousParticle=32]="b2_viscousParticle",Ys[Ys.b2_powderParticle=64]="b2_powderParticle",Ys[Ys.b2_tensileParticle=128]="b2_tensileParticle",Ys[Ys.b2_colorMixingParticle=256]="b2_colorMixingParticle",Ys[Ys.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Ys[Ys.b2_barrierParticle=1024]="b2_barrierParticle",Ys[Ys.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Ys[Ys.b2_reactiveParticle=4096]="b2_reactiveParticle",Ys[Ys.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Ys[Ys.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Ys[Ys.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Ys[Ys.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Ys[Ys.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var Os=function(){this.flags=0,this.position=new j,this.velocity=new j,this.color=new $(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function Fs(t,e,i){return F(Math.ceil(Math.sqrt(t/(.01*e))*i),1,8)}ks.prototype.GetIndex=function(){return this.m_index},ks.prototype.SetIndex=function(t){this.m_index=t};var Ns=ks;function ks(){this.m_index=-1}(Ys=H.b2ParticleGroupFlag||(H.b2ParticleGroupFlag={}))[Ys.b2_solidParticleGroup=1]="b2_solidParticleGroup",Ys[Ys.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Ys[Ys.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Ys[Ys.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Ys[Ys.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Ys[Ys.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Gs=function(){this.flags=0,this.groupFlags=0,this.position=new j,this.angle=0,this.linearVelocity=new j,this.angularVelocity=0,this.color=new $,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},zs=(Us.prototype.GetNext=function(){return this.m_next},Us.prototype.GetParticleSystem=function(){return this.m_system},Us.prototype.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},Us.prototype.GetBufferIndex=function(){return this.m_firstIndex},Us.prototype.ContainsParticle=function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex},Us.prototype.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t},Us.prototype.GetGroupFlags=function(){return this.m_groupFlags},Us.prototype.SetGroupFlags=function(t){t|=this.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)},Us.prototype.GetMass=function(){return this.UpdateStatistics(),this.m_mass},Us.prototype.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},Us.prototype.GetCenter=function(){return this.UpdateStatistics(),this.m_center},Us.prototype.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},Us.prototype.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},Us.prototype.GetTransform=function(){return this.m_transform},Us.prototype.GetPosition=function(){return this.m_transform.p},Us.prototype.GetAngle=function(){return this.m_transform.q.GetAngle()},Us.prototype.GetLinearVelocityFromWorldPoint=function(t,e){var i=Us.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(t,this.m_center,i),e)},Us.prototype.GetUserData=function(){return this.m_userData},Us.prototype.SetUserData=function(t){this.m_userData=t},Us.prototype.ApplyForce=function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)},Us.prototype.ApplyLinearImpulse=function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)},Us.prototype.DestroyParticles=function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)},Us.prototype.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new j,e=new j;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var n,r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);0<this.m_mass&&(n=1/this.m_mass,this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)),this.m_inertia=0,this.m_angularVelocity=0;for(r=this.m_firstIndex;r<this.m_lastIndex;r++)j.SubVV(this.m_system.m_positionBuffer.data[r],this.m_center,t),j.SubVV(this.m_system.m_velocityBuffer.data[r],this.m_linearVelocity,e),this.m_inertia+=i*j.DotVV(t,t),this.m_angularVelocity+=i*j.CrossVV(t,e);0<this.m_inertia&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}},Us.GetLinearVelocityFromWorldPoint_s_t0=new j,Us);function Us(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new j,this.m_linearVelocity=new j,this.m_angularVelocity=0,this.m_transform=new R,this.m_userData=null,this.m_system=t}Hs.prototype.Push=function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(0<this.m_capacity?(this.m_buffer.concat(c(this.m_capacity,function(t){return null})),this.m_capacity*=2):(this.m_buffer.concat(c(1,function(t){return null})),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++},Hs.prototype.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++},Hs.prototype.Empty=function(){return this.m_front===this.m_back},Hs.prototype.Front=function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t};var Ws=Hs;function Hs(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=c(t,function(t){return null}),this.m_capacity=t}Xs.prototype.AddGenerator=function(t,e,i){var n=this.m_generatorBuffer[this.m_generatorCount++];n.center.Copy(t),n.tag=e,n.necessary=i},Xs.prototype.Generate=function(h,u){for(var _=1/h,t=new j(+P,+P),d=new j(-P,-P),f=0,e=0;e<this.m_generatorCount;e++)(o=this.m_generatorBuffer[e]).necessary&&(j.MinV(t,o.center,t),j.MaxV(d,o.center,d),++f);if(0===f)return this.m_countX=0,void(this.m_countY=0);t.x-=u,t.y-=u,d.x+=u,d.y+=u,this.m_countX=1+Math.floor(_*(d.x-t.x)),this.m_countY=1+Math.floor(_*(d.y-t.y)),this.m_diagram=[];for(var i=new Ws(4*this.m_countX*this.m_countY),e=0;e<this.m_generatorCount;e++){(o=this.m_generatorBuffer[e]).center.SelfSub(t).SelfMul(_);var n=Math.floor(o.center.x),r=Math.floor(o.center.y);0<=n&&0<=r&&n<this.m_countX&&r<this.m_countY&&i.Push(new Xs.Task(n,r,n+r*this.m_countX,o))}for(;!i.Empty();){var n=(a=i.Front()).m_x,r=a.m_y,s=a.m_i,o=a.m_generator;i.Pop(),this.m_diagram[s]||(this.m_diagram[s]=o,0<n&&i.Push(new Xs.Task(n-1,r,s-1,o)),0<r&&i.Push(new Xs.Task(n,r-1,s-this.m_countX,o)),n<this.m_countX-1&&i.Push(new Xs.Task(n+1,r,s+1,o)),r<this.m_countY-1&&i.Push(new Xs.Task(n,r+1,s+this.m_countX,o)))}for(r=0;r<this.m_countY;r++)for(n=0;n<this.m_countX-1;n++){s=n+r*this.m_countX;(c=this.m_diagram[s])!==(l=this.m_diagram[s+1])&&(i.Push(new Xs.Task(n,r,s,l)),i.Push(new Xs.Task(n+1,r,s+1,c)))}for(r=0;r<this.m_countY-1;r++)for(n=0;n<this.m_countX;n++){s=n+r*this.m_countX;(c=this.m_diagram[s])!==(l=this.m_diagram[s+this.m_countX])&&(i.Push(new Xs.Task(n,r,s,l)),i.Push(new Xs.Task(n,r+1,s+this.m_countX,c)))}for(;!i.Empty();){var a,c,l,p,m,y,n=(a=i.Front()).m_x,r=a.m_y,s=a.m_i,e=a.m_generator;i.Pop(),(c=this.m_diagram[s])!==(l=e)&&(p=c.center.x-n,m=c.center.y-r,(y=l.center.x-n)*y+(y=l.center.y-r)*y<p*p+m*m&&(this.m_diagram[s]=l,0<n&&i.Push(new Xs.Task(n-1,r,s-1,l)),0<r&&i.Push(new Xs.Task(n,r-1,s-this.m_countX,l)),n<this.m_countX-1&&i.Push(new Xs.Task(n+1,r,s+1,l)),r<this.m_countY-1&&i.Push(new Xs.Task(n,r+1,s+this.m_countX,l))))}},Xs.prototype.GetNodes=function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var n=i+e*this.m_countX,r=this.m_diagram[n],s=this.m_diagram[n+1],o=this.m_diagram[n+this.m_countX],n=this.m_diagram[n+1+this.m_countX];s!==o&&(r!==s&&r!==o&&(r.necessary||s.necessary||o.necessary)&&t(r.tag,s.tag,o.tag),n!==s&&n!==o&&(r.necessary||s.necessary||o.necessary)&&t(s.tag,n.tag,o.tag))}};var js=Xs;function Xs(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=c(t,function(t){return new Xs.Generator}),this.m_generatorCapacity=t}var Ys=js=Xs||{};function qs(t,e,i,n){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=n}function Js(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Zs(t,e){return t<e}function Ks(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=t.length-e),void 0===n&&(n=Zs);for(var r=e,s=[],o=0;;){for(;r+1<i;i++){var a=t[r+Math.floor(Math.random()*(i-r))];s[o++]=i;for(var c=r-1;;){for(;n(t[++c],a););for(;n(a,t[--i]););if(i<=c)break;Js(t,c,i)}}if(0===o)break;r=i,i=s[--o]}return t}function Qs(t,e,i,n){return Ks(t,e=void 0===e?0:e,i=void 0===i?t.length-e:i,n=void 0===n?Zs:n)}function $s(t,e,i){void 0===i&&(i=t.length);for(var n=0,r=0;r<i;++r)e(t[r])||(r!==n?Js(t,n++,r):++n);return n}function to(t,e,i,n,r){void 0===r&&(r=Zs);for(var s=i-e;0<s;){var o=Math.floor(s/2),a=e+o;r(t[a],n)?(e=++a,s-=o+1):s=o}return e}function eo(t,e,i,n,r){void 0===r&&(r=Zs);for(var s=i-e;0<s;){var o=Math.floor(s/2),a=e+o;r(n,t[a])?s=o:(e=++a,s-=o+1)}return e}function io(t,e,i,n){for(var r=i;e!==r;)Js(t,e++,r++),r===n?r=i:e===i&&(i=r)}Ys.Generator=function(){this.center=new j,this.tag=0,this.necessary=!1},Ys.Task=qs;ro.prototype.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},ro.prototype.Reserve=function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}},ro.prototype.Grow=function(){var t=this.capacity?2*this.capacity:256;this.Reserve(t)},ro.prototype.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},ro.prototype.Shorten=function(t){},ro.prototype.Data=function(){return this.data},ro.prototype.GetCount=function(){return this.count},ro.prototype.SetCount=function(t){this.count=t},ro.prototype.GetCapacity=function(){return this.capacity},ro.prototype.RemoveIf=function(t){this.count=$s(this.data,t,this.count)},ro.prototype.Unique=function(t){this.count=function(t,e,i,n){if(e===i)return i;for(var r=e;++e!==i;)n(t[r],t[e])||Js(t,++r,e);return++r}(this.data,0,this.count,t)};var no=ro;function ro(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}Fi(ao,so=cs),ao.prototype.ShouldQueryParticleSystem=function(t){return!1},ao.prototype.ReportFixture=function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var n,r=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(r);0<=(n=s.GetNext());)this.ReportFixtureAndParticle(t,i,n);return!0},ao.prototype.ReportParticle=function(t,e){return!1},ao.prototype.ReportFixtureAndParticle=function(t,e,i){};var so,oo=ao;function ao(t){var e=so.call(this)||this;return e.m_system=t,e}lo.prototype.SetIndices=function(t,e){this.indexA=t,this.indexB=e},lo.prototype.SetWeight=function(t){this.weight=t},lo.prototype.SetNormal=function(t){this.normal.Copy(t)},lo.prototype.SetFlags=function(t){this.flags=t},lo.prototype.GetIndexA=function(){return this.indexA},lo.prototype.GetIndexB=function(){return this.indexB},lo.prototype.GetWeight=function(){return this.weight},lo.prototype.GetNormal=function(){return this.normal},lo.prototype.GetFlags=function(){return this.flags},lo.prototype.IsEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y},lo.prototype.IsNotEqual=function(t){return!this.IsEqual(t)},lo.prototype.ApproximatelyEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&L(this.weight-t.weight)<.01&&j.DistanceSquaredVV(this.normal,t.normal)<1e-4};var co=lo;function lo(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new j,this.flags=0}var ho=function(){this.index=0,this.weight=0,this.normal=new j,this.mass=0},uo=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},_o=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new j(0,0),this.pb=new j(0,0),this.pc=new j(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},fo=(po.prototype.Copy=function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this},po.prototype.Clone=function(){return(new po).Copy(this)},po);function po(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}function X(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new X.UserOverridableBuffer,this.m_flagsBuffer=new X.UserOverridableBuffer,this.m_positionBuffer=new X.UserOverridableBuffer,this.m_velocityBuffer=new X.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new X.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new X.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new X.UserOverridableBuffer,this.m_bodyContactCountBuffer=new X.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new X.UserOverridableBuffer,this.m_stuckParticleBuffer=new no(function(){return 0}),this.m_proxyBuffer=new no(function(){return new X.Proxy}),this.m_contactBuffer=new no(function(){return new co}),this.m_bodyContactBuffer=new no(function(){return new ho}),this.m_pairBuffer=new no(function(){return new uo}),this.m_triadBuffer=new no(function(){return new _o}),this.m_expirationTimeBuffer=new X.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new X.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new fo,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}H.b2ParticleSystem=(X.computeTag=function(t,e){return(e+X.yOffset>>>0<<X.yShift)+(X.xScale*t+X.xOffset>>>0)>>>0},X.computeRelativeTag=function(t,e,i){return t+(i<<X.yShift)+(e<<X.xShift)>>>0},X.prototype.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},X.prototype.CreateParticle=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity&&(e=this.m_count?2*this.m_count:256,this.ReallocateInternalAllocatedBuffers(e)),this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return-1;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var e=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new j).Copy(f(t.position,j.ZERO)),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new j).Copy(f(t.velocity,j.ZERO)),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new j).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);var i=(new $).Copy(f(t.color,$.ZERO)),i=(!this.m_colorBuffer.data&&i.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new $).Copy(i)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null),this.m_proxyBuffer.data[this.m_proxyBuffer.Append()]),n=f(t.lifetime,0),r=0<n;if(this.m_expirationTimeBuffer.data||r){if(this.SetParticleLifetime(e,r?n:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[e]=e}i.index=e;r=f(t.group,null);return(this.m_groupBuffer[e]=r)&&(r.m_firstIndex<r.m_lastIndex?this.RotateBuffer(r.m_firstIndex,r.m_lastIndex,e):r.m_firstIndex=e,r.m_lastIndex=1+e),this.SetParticleFlags(e,f(t.flags,0)),e},X.prototype.GetParticleHandleFromIndex=function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Ns).SetIndex(t),this.m_handleIndexBuffer.data[t]=e)},X.prototype.DestroyParticle=function(t,e){if(void 0===e&&(e=!1),!this.m_flagsBuffer.data)throw new Error;var i=H.b2ParticleFlag.b2_zombieParticle;e&&(i|=H.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)},X.prototype.DestroyOldestParticle=function(t,e){void 0===e&&(e=!1);var i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;i=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],t=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(0<this.m_expirationTimeBuffer.data[i]?i:t,e)},X.prototype.DestroyParticlesInShape=function(t,e,i){void 0===i&&(i=!1);var n=X.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;i=new X.DestroyParticlesInShapeCallback(this,t,e,i);return t.ComputeAABB(n,e,0),this.m_world.QueryAABB(i,n),i.Destroyed()},X.prototype.CreateParticleGroup=function(t){var e=X.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var i=e,e=(i.SetPositionAngle(f(t.position,j.ZERO),f(t.angle,0)),this.m_count);if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,f(t.shapeCount,t.shapes.length),t,i),t.positionData)for(var n=f(t.particleCount,t.positionData.length),r=0;r<n;r++){var s=t.positionData[r];this.CreateParticleForGroup(t,i,s)}var o=this.m_count,a=new zs(this);a.m_firstIndex=e,a.m_lastIndex=o,a.m_strength=f(t.strength,1),a.m_userData=t.userData,a.m_transform.Copy(i),a.m_prev=null,a.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=a),this.m_groupList=a,++this.m_groupCount;for(r=e;r<o;r++)this.m_groupBuffer[r]=a;this.SetGroupFlags(a,f(t.groupFlags,0));var c=new X.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(e,o,c),t.group&&(this.JoinParticleGroups(t.group,a),a=t.group),a},X.prototype.JoinParticleGroups=function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new X.JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var n=e.m_firstIndex;n<e.m_lastIndex;n++)this.m_groupBuffer[n]=t;i=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,i),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)},X.prototype.SplitParticleGroup=function(t){this.UpdateContacts(!0);var e=c(t.GetParticleCount(),function(t){return new X.ParticleListNode}),i=(X.InitializeParticleLists(t,e),this.MergeParticleListsInContact(t,e),X.FindLongestParticleList(t,e));this.MergeZombieParticleListNodes(t,e,i),this.CreateParticleGroupsFromParticleList(t,e,i),this.UpdatePairsAndTriadsWithParticleList(t,e)},X.prototype.GetParticleGroupList=function(){return this.m_groupList},X.prototype.GetParticleGroupCount=function(){return this.m_groupCount},X.prototype.GetParticleCount=function(){return this.m_count},X.prototype.GetMaxParticleCount=function(){return this.m_def.maxCount},X.prototype.SetMaxParticleCount=function(t){this.m_def.maxCount=t},X.prototype.GetAllParticleFlags=function(){return this.m_allParticleFlags},X.prototype.GetAllGroupFlags=function(){return this.m_allGroupFlags},X.prototype.SetPaused=function(t){this.m_paused=t},X.prototype.GetPaused=function(){return this.m_paused},X.prototype.SetDensity=function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density},X.prototype.GetDensity=function(){return this.m_def.density},X.prototype.SetGravityScale=function(t){this.m_def.gravityScale=t},X.prototype.GetGravityScale=function(){return this.m_def.gravityScale},X.prototype.SetDamping=function(t){this.m_def.dampingStrength=t},X.prototype.GetDamping=function(){return this.m_def.dampingStrength},X.prototype.SetStaticPressureIterations=function(t){this.m_def.staticPressureIterations=t},X.prototype.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},X.prototype.SetRadius=function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter},X.prototype.GetRadius=function(){return this.m_particleDiameter/2},X.prototype.GetPositionBuffer=function(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data},X.prototype.GetVelocityBuffer=function(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data},X.prototype.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},X.prototype.GetGroupBuffer=function(){return this.m_groupBuffer},X.prototype.GetWeightBuffer=function(){return this.m_weightBuffer},X.prototype.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},X.prototype.GetFlagsBuffer=function(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data},X.prototype.SetParticleFlags=function(t,e){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&H.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&H.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e},X.prototype.GetParticleFlags=function(t){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[t]},X.prototype.SetFlagsBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)},X.prototype.SetPositionBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)},X.prototype.SetVelocityBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)},X.prototype.SetColorBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)},X.prototype.SetUserDataBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)},X.prototype.GetContacts=function(){return this.m_contactBuffer.data},X.prototype.GetContactCount=function(){return this.m_contactBuffer.count},X.prototype.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},X.prototype.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},X.prototype.GetPairs=function(){return this.m_pairBuffer.data},X.prototype.GetPairCount=function(){return this.m_pairBuffer.count},X.prototype.GetTriads=function(){return this.m_triadBuffer.data},X.prototype.GetTriadCount=function(){return this.m_triadBuffer.count},X.prototype.SetStuckThreshold=function(t){0<(this.m_stuckThreshold=t)&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},X.prototype.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},X.prototype.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},X.prototype.ComputeCollisionEnergy=function(){if(!this.m_velocityBuffer.data)throw new Error;for(var t=X.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,i=0,n=0;n<this.m_contactBuffer.count;n++){var r=this.m_contactBuffer.data[n],s=r.indexA,o=r.indexB,r=r.normal,o=j.SubVV(e[o],e[s],t),s=j.DotVV(o,r);s<0&&(i+=s*s)}return.5*this.GetParticleMass()*i},X.prototype.SetStrictContactCheck=function(t){this.m_def.strictContactCheck=t},X.prototype.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},X.prototype.SetParticleLifetime=function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var n=this.GetParticleCount(),r=0;r<n;++r)this.m_indexByExpirationTimeBuffer.data[r]=r;i=e/this.m_def.lifetimeGranularity,e=0<i?this.GetQuantizedTimeElapsed()+i:i;e!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=e,this.m_expirationTimeBufferRequiresSorting=!0)},X.prototype.GetParticleLifetime=function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])},X.prototype.SetDestructionByAge=function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t},X.prototype.GetDestructionByAge=function(){return this.m_def.destroyByAge},X.prototype.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},X.prototype.ExpirationTimeToLifetime=function(t){return(0<t?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity},X.prototype.GetIndexByExpirationTimeBuffer=function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data},X.prototype.ParticleApplyLinearImpulse=function(t,e){this.ApplyLinearImpulse(t,t+1,e)},X.prototype.ApplyLinearImpulse=function(t,e,i){if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,r=(e-t)*this.GetParticleMass(),s=(new j).Copy(i).SelfMul(1/r),o=t;o<e;o++)n[o].SelfAdd(s)},X.IsSignificantForce=function(t){return 0!==t.x||0!==t.y},X.prototype.ParticleApplyForce=function(t,e){if(!this.m_flagsBuffer.data)throw new Error;X.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))},X.prototype.ApplyForce=function(t,e,i){var n=(new j).Copy(i).SelfMul(1/(e-t));if(X.IsSignificantForce(n)){this.PrepareForceBuffer();for(var r=t;r<e;r++)this.m_forceBuffer[r].SelfAdd(n)}},X.prototype.GetNext=function(){return this.m_next},X.prototype.QueryAABB=function(t,e){if(0!==this.m_proxyBuffer.count){var i=this.m_proxyBuffer.count,n=to(this.m_proxyBuffer.data,0,i,X.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),X.Proxy.CompareProxyTag),r=eo(this.m_proxyBuffer.data,n,i,X.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),X.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,o=n;o<r;++o){var a=this.m_proxyBuffer.data[o].index,c=s[a];if(e.lowerBound.x<c.x&&c.x<e.upperBound.x&&e.lowerBound.y<c.y&&c.y<e.upperBound.y&&!t.ReportParticle(this,a))break}}},X.prototype.QueryShapeAABB=function(t,e,i,n){var r=X.QueryShapeAABB_s_aabb;e.ComputeAABB(r,i,n=void 0===n?0:n),this.QueryAABB(t,r)},X.prototype.QueryPointAABB=function(t,e,i){var n=X.QueryPointAABB_s_aabb;n.lowerBound.Set(e.x-(i=void 0===i?I:i),e.y-i),n.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,n)},X.prototype.RayCast=function(h,t,e){var i=X.RayCast_s_aabb,u=X.RayCast_s_p,_=X.RayCast_s_v,d=X.RayCast_s_n,f=X.RayCast_s_point;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error;for(var n,p=this.m_positionBuffer.data,r=(j.MinV(t,e,i.lowerBound),j.MaxV(t,e,i.upperBound),1),s=j.SubVV(e,t,_),m=j.DotVV(s,s),y=this.GetInsideBoundsEnumerator(i);0<=(n=y.GetNext());){var o=j.SubVV(t,p[n],u),a=j.DotVV(o,s),c=a*a-m*(j.DotVV(o,o)-this.m_squaredDiameter);if(0<=c){var c=Y(c),l=(-a-c)/m;if(!(r<l)&&!(l<0&&((l=(-a+c)/m)<0||r<l))){a=j.AddVMulSV(o,l,s,d),c=(a.Normalize(),h.ReportParticle(this,n,j.AddVMulSV(t,l,s,f),a,l));if((r=V(r,c))<=0)break}}}}},X.prototype.ComputeAABB=function(t){var e=this.GetParticleCount();if(t.lowerBound.x=+P,t.lowerBound.y=+P,t.upperBound.x=-P,t.upperBound.y=-P,!this.m_positionBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=0;n<e;n++){var r=i[n];j.MinV(t.lowerBound,r,t.lowerBound),j.MaxV(t.upperBound,r,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter},X.prototype.FreeBuffer=function(t,e){null!==t&&(t.length=0)},X.prototype.FreeUserOverridableBuffer=function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)},X.prototype.ReallocateBuffer3=function(t,e,i){if(i<=e)throw new Error;e=t?t.slice():[];return e.length=i,e},X.prototype.ReallocateBuffer5=function(t,e,i,n,r){if(n<=i)throw new Error;if(e&&!(n<=e))throw new Error;return t=r&&!t||e?t:this.ReallocateBuffer3(t,i,n)},X.prototype.ReallocateBuffer4=function(t,e,i,n){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,n)},X.prototype.RequestBuffer=function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),(t=[]).length=this.m_internalAllocatedCapacity),t},X.prototype.ReallocateHandleBuffers=function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)},X.prototype.ReallocateInternalAllocatedBuffers=function(t){function e(t,e){return e&&e<t?e:t}var i;t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t&&(this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1),i=0<this.m_stuckThreshold,this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t)},X.prototype.CreateParticleForGroup=function(t,e,i){var n=new Os;n.flags=f(t.flags,0),R.MulXV(e,i,n.position),j.AddVV(f(t.linearVelocity,j.ZERO),j.CrossSV(f(t.angularVelocity,0),j.SubVV(n.position,f(t.position,j.ZERO),j.s_t0),j.s_t0),n.velocity),n.color.Copy(f(t.color,$.ZERO)),n.lifetime=f(t.lifetime,0),n.userData=t.userData,this.CreateParticle(n)},X.prototype.CreateParticlesStrokeShapeForGroup=function(t,e,i){for(var n=X.CreateParticlesStrokeShapeForGroup_s_edge,h=X.CreateParticlesStrokeShapeForGroup_s_d,u=X.CreateParticlesStrokeShapeForGroup_s_p,r=f(e.stride,0),s=(0===r&&(r=this.GetParticleStride()),0),_=t.GetChildCount(),o=0;o<_;o++){for(var a=null,c=(t.GetType()===H.b2ShapeType.e_edgeShape?a=t:t.GetChildEdge(a=n,o),j.SubVV(a.m_vertex2,a.m_vertex1,h)),l=c.Length();s<l;){var d=j.AddVMulSV(a.m_vertex1,s/l,c,u);this.CreateParticleForGroup(e,i,d),s+=r}s-=l}},X.prototype.CreateParticlesFillShapeForGroup=function(t,e,i){var n=X.CreateParticlesFillShapeForGroup_s_aabb,h=X.CreateParticlesFillShapeForGroup_s_p,r=f(e.stride,0),s=(0===r&&(r=this.GetParticleStride()),R.IDENTITY),o=n;t.ComputeAABB(o,s,0);for(var a=Math.floor(o.lowerBound.y/r)*r;a<o.upperBound.y;a+=r)for(var c=Math.floor(o.lowerBound.x/r)*r;c<o.upperBound.x;c+=r){var l=h.Set(c,a);t.TestPoint(s,l)&&this.CreateParticleForGroup(e,i,l)}},X.prototype.CreateParticlesWithShapeForGroup=function(t,e,i){switch(t.GetType()){case H.b2ShapeType.e_edgeShape:case H.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case H.b2ShapeType.e_polygonShape:case H.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}},X.prototype.CreateParticlesWithShapesForGroup=function(t,e,i,n){t=new X.CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(t,i,n)},X.prototype.CloneParticle=function(t,e){var i=new Os;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;e=this.CreateParticle(i);return this.m_handleIndexBuffer.data&&((i=this.m_handleIndexBuffer.data[t])&&i.SetIndex(e),this.m_handleIndexBuffer.data[e]=i,this.m_handleIndexBuffer.data[t]=null),this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[t]),e},X.prototype.DestroyParticlesInGroup=function(t,e){void 0===e&&(e=!1);for(var i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)},X.prototype.DestroyParticleGroup=function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount},X.ParticleCanBeConnected=function(t,e){return 0!=(t&(H.b2ParticleFlag.b2_wallParticle|H.b2ParticleFlag.b2_springParticle|H.b2ParticleFlag.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&H.b2ParticleGroupFlag.b2_rigidParticleGroup)},X.prototype.UpdatePairsAndTriads=function(t,e,m){var v=X.UpdatePairsAndTriads_s_dab,x=X.UpdatePairsAndTriads_s_dbc,b=X.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var y=this.m_positionBuffer.data,i=0,n=t;n<e;n++)i|=this.m_flagsBuffer.data[n];if(i&X.k_pairFlags)for(var a=0;a<this.m_contactBuffer.count;a++){var c=this.m_contactBuffer.data[a],r=c.indexA,s=c.indexB,o=this.m_flagsBuffer.data[r],l=this.m_flagsBuffer.data[s],h=this.m_groupBuffer[r],u=this.m_groupBuffer[s];t<=r&&r<e&&t<=s&&s<e&&!((o|l)&H.b2ParticleFlag.b2_zombieParticle)&&(o|l)&X.k_pairFlags&&(m.IsNecessary(r)||m.IsNecessary(s))&&X.ParticleCanBeConnected(o,h)&&X.ParticleCanBeConnected(l,u)&&m.ShouldCreatePair(r,s)&&((o=this.m_pairBuffer.data[this.m_pairBuffer.Append()]).indexA=r,o.indexB=s,o.flags=c.flags,o.strength=V(h?h.m_strength:1,u?u.m_strength:1),o.distance=j.DistanceVV(y[r],y[s])),Qs(this.m_pairBuffer.data,0,this.m_pairBuffer.count,X.ComparePairIndices),this.m_pairBuffer.Unique(X.MatchPairIndices)}if(i&X.k_triadFlags){for(var _=new js(e-t),n=t;n<e;n++){var d=this.m_flagsBuffer.data[n],f=this.m_groupBuffer[n];d&H.b2ParticleFlag.b2_zombieParticle||!X.ParticleCanBeConnected(d,f)||_.AddGenerator(y[n],n,m.IsNecessary(n))}var p=this.GetParticleStride(),g=(_.Generate(p/2,2*p),this);_.GetNodes(function(t,e,i){if(!g.m_flagsBuffer.data)throw new Error;var n,r,s,o,a,h,c,u,_,l,d=g.m_flagsBuffer.data[t],f=g.m_flagsBuffer.data[e],p=g.m_flagsBuffer.data[i];(d|f|p)&X.k_triadFlags&&m.ShouldCreateTriad(t,e,i)&&(n=y[t],r=y[e],s=y[i],o=j.SubVV(n,r,v),a=j.SubVV(r,s,x),h=j.SubVV(s,n,b),c=4*g.m_squaredDiameter,j.DotVV(o,o)>c||j.DotVV(a,a)>c||j.DotVV(h,h)>c||(c=g.m_groupBuffer[t],u=g.m_groupBuffer[e],_=g.m_groupBuffer[i],(l=g.m_triadBuffer.data[g.m_triadBuffer.Append()]).indexA=t,l.indexB=e,l.indexC=i,l.flags=d|f|p,l.strength=V(V(c?c.m_strength:1,u?u.m_strength:1),_?_.m_strength:1),t=(n.x+r.x+s.x)/3,e=(n.y+r.y+s.y)/3,l.pa.x=n.x-t,l.pa.y=n.y-e,l.pb.x=r.x-t,l.pb.y=r.y-e,l.pc.x=s.x-t,l.pc.y=s.y-e,l.ka=-j.DotVV(h,o),l.kb=-j.DotVV(o,a),l.kc=-j.DotVV(a,h),l.s=j.CrossVV(n,r)+j.CrossVV(r,s)+j.CrossVV(s,n)))}),Qs(this.m_triadBuffer.data,0,this.m_triadBuffer.count,X.CompareTriadIndices),this.m_triadBuffer.Unique(X.MatchTriadIndices)}},X.prototype.UpdatePairsAndTriadsWithReactiveParticles=function(){var t=new X.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,t),!this.m_flagsBuffer.data)throw new Error;for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=~H.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~H.b2ParticleFlag.b2_reactiveParticle},X.ComparePairIndices=function(t,e){var i=t.indexA-e.indexA;return 0!=i?i<0:t.indexB<e.indexB},X.MatchPairIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB},X.CompareTriadIndices=function(t,e){var i=t.indexA-e.indexA;if(0!=i)return i<0;i=t.indexB-e.indexB;return 0!=i?i<0:t.indexC<e.indexC},X.MatchTriadIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC},X.InitializeParticleLists=function(t,e){for(var i=t.GetBufferIndex(),n=t.GetParticleCount(),r=0;r<n;r++){var s=e[r];(s.list=s).next=null,s.count=1,s.index=r+i}},X.prototype.MergeParticleListsInContact=function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var r,s=this.m_contactBuffer.data[n],o=s.indexA,s=s.indexB;t.ContainsParticle(o)&&t.ContainsParticle(s)&&((o=e[o-i].list)!==(s=e[s-i].list)&&(o.count<s.count&&(r=o,o=s,s=r),X.MergeParticleLists(o,s)))}},X.MergeParticleLists=function(t,e){for(var i=e;;){i.list=t;var n=i.next;if(!n){i.next=t.next;break}i=n}t.next=e,t.count+=e.count,e.count=0},X.FindLongestParticleList=function(t,e){for(var i=t.GetParticleCount(),n=e[0],r=0;r<i;r++){var s=e[r];n.count<s.count&&(n=s)}return n},X.prototype.MergeZombieParticleListNodes=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;for(var n=t.GetParticleCount(),r=0;r<n;r++){var s=e[r];s!==i&&this.m_flagsBuffer.data[s.index]&H.b2ParticleFlag.b2_zombieParticle&&X.MergeParticleListAndNode(i,s)}},X.MergeParticleListAndNode=function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0},X.prototype.CreateParticleGroupsFromParticleList=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;var n=t.GetParticleCount(),r=new Gs;r.groupFlags=t.GetGroupFlags(),r.userData=t.GetUserData();for(var s=0;s<n;s++){var o=e[s];if(o.count&&o!==i)for(var a=this.CreateParticleGroup(r),c=o;c;c=c.next){var l=c.index,h=this.CloneParticle(l,a);this.m_flagsBuffer.data[l]|=H.b2ParticleFlag.b2_zombieParticle,c.index=h}}},X.prototype.UpdatePairsAndTriadsWithParticleList=function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_pairBuffer.count;n++){var r=this.m_pairBuffer.data[n],s=r.indexA,o=r.indexB;t.ContainsParticle(s)&&(r.indexA=e[s-i].index),t.ContainsParticle(o)&&(r.indexB=e[o-i].index)}for(n=0;n<this.m_triadBuffer.count;n++){var a=this.m_triadBuffer.data[n],s=a.indexA,o=a.indexB,c=a.indexC;t.ContainsParticle(s)&&(a.indexA=e[s-i].index),t.ContainsParticle(o)&&(a.indexB=e[o-i].index),t.ContainsParticle(c)&&(a.indexC=e[c-i].index)}},X.prototype.ComputeDepth=function(){for(var h=[],u=0,t=0;t<this.m_contactBuffer.count;t++){var e=(a=this.m_contactBuffer.data[t]).indexA,i=a.indexB,_=this.m_groupBuffer[e],d=this.m_groupBuffer[i];_&&_===d&&_.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(h[u++]=a)}for(var f=[],p=0,n=this.m_groupList;n;n=n.GetNext())if(n.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){f[p++]=n,this.SetGroupFlags(n,n.m_groupFlags&~H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var r=n.m_firstIndex;r<n.m_lastIndex;r++)this.m_accumulationBuffer[r]=0}for(t=0;t<u;t++){var e=(a=h[t]).indexA,i=a.indexB,s=a.weight;this.m_accumulationBuffer[e]+=s,this.m_accumulationBuffer[i]+=s}for(r=0;r<p;r++)for(var o=(n=f[r]).m_firstIndex;o<n.m_lastIndex;o++){s=this.m_accumulationBuffer[o];this.m_depthBuffer[o]=s<.8?0:P}for(var m=Y(this.m_count)>>0,y=0;y<m;y++){for(var g=!1,t=0;t<u;t++){var a,e=(a=h[t]).indexA,i=a.indexB,c=1-a.weight,v=this.m_depthBuffer[e],x=this.m_depthBuffer[i],b=x+c,c=v+c;b<v&&(this.m_depthBuffer[e]=b,g=!0),c<x&&(this.m_depthBuffer[i]=c,g=!0)}if(!g)break}for(r=0;r<p;r++)for(var l=(n=f[r]).m_firstIndex;l<n.m_lastIndex;l++)this.m_depthBuffer[l]<P?this.m_depthBuffer[l]*=this.m_particleDiameter:this.m_depthBuffer[l]=0},X.prototype.GetInsideBoundsEnumerator=function(t){var e=X.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),t=X.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),i=this.m_proxyBuffer.count,n=to(this.m_proxyBuffer.data,0,i,e,X.Proxy.CompareProxyTag),i=eo(this.m_proxyBuffer.data,0,i,t,X.Proxy.CompareTagProxy);return new X.InsideBoundsEnumerator(this,e,t,n,i)},X.prototype.UpdateAllParticleFlags=function(){if(!this.m_flagsBuffer.data)throw new Error;for(var t=this.m_allParticleFlags=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1},X.prototype.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},X.prototype.AddContact=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;var n,r,s=X.AddContact_s_d,o=this.m_positionBuffer.data,o=j.SubVV(o[e],o[t],s),s=j.DotVV(o,o);s<this.m_squaredDiameter&&(n=A(s),isFinite(n)||(n=198177537e11),(r=this.m_contactBuffer.data[this.m_contactBuffer.Append()]).indexA=t,r.indexB=e,r.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],r.weight=1-s*n*this.m_inverseDiameter,j.MulSV(n,o,r.normal))},X.prototype.FindContacts_Reference=function(t){for(var e=this.m_proxyBuffer.count,i=this.m_contactBuffer.count=0,n=0;i<e;i++){for(var r=X.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,0),s=i+1;s<e&&!(r<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer);for(var o=X.computeRelativeTag(this.m_proxyBuffer.data[i].tag,-1,1);n<e&&!(o<=this.m_proxyBuffer.data[n].tag);n++);for(var a=X.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,1),s=n;s<e&&!(a<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer)}},X.prototype.FindContacts=function(t){this.FindContacts_Reference(t)},X.prototype.UpdateProxies_Reference=function(t){if(!this.m_positionBuffer.data)throw new Error;for(var e=this.m_positionBuffer.data,i=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var r=this.m_proxyBuffer.data[n],s=e[r.index];r.tag=X.computeTag(i*s.x,i*s.y)}},X.prototype.UpdateProxies=function(t){this.UpdateProxies_Reference(t)},X.prototype.SortProxies=function(t){Ks(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,X.Proxy.CompareProxyProxy)},X.prototype.FilterContacts=function(t){var e,i=this.GetParticleContactFilter();null!==i&&(e=this).m_contactBuffer.RemoveIf(function(t){return 0!=(t.flags&H.b2ParticleFlag.b2_particleContactFilterParticle)&&!i.ShouldCollideParticleParticle(e,t.indexA,t.indexB)})},X.prototype.NotifyContactListenerPreContact=function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error},X.prototype.NotifyContactListenerPostContact=function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var n=this.m_contactBuffer.data[i];e.BeginContactParticleParticle(this,n)}throw new Error}},X.b2ParticleContactIsZombie=function(t){return(t.flags&H.b2ParticleFlag.b2_zombieParticle)===H.b2ParticleFlag.b2_zombieParticle},X.prototype.UpdateContacts=function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var e=new X.b2ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(X.b2ParticleContactIsZombie)},X.prototype.NotifyBodyContactListenerPreContact=function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error},X.prototype.NotifyBodyContactListenerPostContact=function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var n=this.m_bodyContactBuffer.data[i];e.BeginContactFixtureParticle(this,n)}throw new Error}},X.prototype.UpdateBodyContacts=function(){var t=X.UpdateBodyContacts_s_aabb,e=new X.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),0<this.m_stuckThreshold){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;for(var i=this.GetParticleCount(),n=0;n<i;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);this.ComputeAABB(t);var r=new X.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(r,t),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)},X.prototype.Solve=function(t){var e=X.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&H.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var i=e.Copy(t);if(i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&H.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&H.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&X.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&H.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&H.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(i.dt,this.m_velocityBuffer.data[n])}},X.prototype.SolveCollision=function(t){var e=X.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;var i=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=e;r.lowerBound.x=+P,r.lowerBound.y=+P,r.upperBound.x=-P,r.upperBound.y=-P;for(var s=0;s<this.m_count;s++){var o=n[s],a=i[s],c=a.x+t.dt*o.x,o=a.y+t.dt*o.y;r.lowerBound.x=V(r.lowerBound.x,V(a.x,c)),r.lowerBound.y=V(r.lowerBound.y,V(a.y,o)),r.upperBound.x=O(r.upperBound.x,O(a.x,c)),r.upperBound.y=O(r.upperBound.y,O(a.y,o))}e=new X.SolveCollisionCallback(this,t);this.m_world.QueryAABB(e,r)},X.prototype.LimitVelocity=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),n=0;n<this.m_count;n++){var r=e[n],s=j.DotVV(r,r);i<s&&r.SelfMul(Y(i/s))}},X.prototype.SolveGravity=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=X.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,n=j.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e),r=0;r<this.m_count;r++)i[r].SelfAdd(n)},X.prototype.SolveBarrier=function(h){var u=X.SolveBarrier_s_aabb,_=X.SolveBarrier_s_va,d=X.SolveBarrier_s_vb,f=X.SolveBarrier_s_pba,p=X.SolveBarrier_s_vba,m=X.SolveBarrier_s_vc,y=X.SolveBarrier_s_pca,g=X.SolveBarrier_s_vca,v=X.SolveBarrier_s_qba,x=X.SolveBarrier_s_qca,b=X.SolveBarrier_s_dv,A=X.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var C=this.m_positionBuffer.data,S=this.m_velocityBuffer.data,T=0;T<this.m_count;T++)0!=(this.m_flagsBuffer.data[T]&X.k_barrierWallFlags)&&S[T].SetZero();for(var w=2.5*h.dt,E=this.GetParticleMass(),M=0;M<this.m_pairBuffer.count;M++){var t=this.m_pairBuffer.data[M];if(t.flags&H.b2ParticleFlag.b2_barrierParticle)for(var I,B=t.indexA,t=t.indexB,R=C[B],P=C[t],D=u,L=(j.MinV(R,P,D.lowerBound),j.MaxV(R,P,D.upperBound),this.m_groupBuffer[B]),V=this.m_groupBuffer[t],O=this.GetLinearVelocity(L,B,R,_),B=this.GetLinearVelocity(V,t,P,d),F=j.SubVV(P,R,f),e=j.SubVV(B,O,p),N=this.GetInsideBoundsEnumerator(D);0<=(I=N.GetNext());){var k=C[I],i=this.m_groupBuffer[I];if(L!==i&&V!==i){var G=this.GetLinearVelocity(i,I,k,m),z=j.SubVV(k,R,y),U=j.SubVV(G,O,g),n=j.CrossVV(e,U),r=j.CrossVV(F,U)-j.CrossVV(z,e),s=j.CrossVV(F,z),o=void 0,a=void 0,c=v,W=x;if(0===n){if(0==r)continue;if(!(0<=(a=-s/r)&&a<w))continue;if(j.AddVMulSV(F,a,e,c),j.AddVMulSV(z,a,U,W),!(0<=(o=j.DotVV(c,W)/j.DotVV(c,c))&&o<=1))continue}else{s=r*r-4*s*n;if(s<0)continue;var s=Y(s),l=(-r-s)/(2*n),r=(-r+s)/(2*n);if(r<l&&(s=l,l=r,r=s),a=l,j.AddVMulSV(F,a,e,c),j.AddVMulSV(z,a,U,W),o=j.DotVV(c,W)/j.DotVV(c,c),!(0<=a&&a<w&&0<=o&&o<=1)){if(!(0<=(a=r)&&a<w))continue;if(j.AddVMulSV(F,a,e,c),j.AddVMulSV(z,a,U,W),!(0<=(o=j.DotVV(c,W)/j.DotVV(c,c))&&o<=1))continue}}n=b,s=(n.x=O.x+o*e.x-G.x,n.y=O.y+o*e.y-G.y,j.MulSV(E,n,A));i&&this.IsRigidGroup(i)?(l=i.GetMass(),r=i.GetInertia(),0<l&&i.m_linearVelocity.SelfMulAdd(1/l,s),0<r&&(i.m_angularVelocity+=j.CrossVV(j.SubVV(k,i.GetCenter(),j.s_t0),s)/r)):S[I].SelfAdd(n),this.ParticleApplyForce(I,s.SelfMul(-h.inv_dt))}}}},X.prototype.SolveStaticPressure=function(t){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var t=this.GetCriticalPressure(t),e=this.m_def.staticPressureStrength*t,h=.25*t,u=this.m_def.staticPressureRelaxation,i=0;i<this.m_def.staticPressureIterations;i++){for(var n=0;n<this.m_count;n++)this.m_accumulationBuffer[n]=0;for(var r=0;r<this.m_contactBuffer.count;r++){var s,o,a=this.m_contactBuffer.data[r];a.flags&H.b2ParticleFlag.b2_staticPressureParticle&&(s=a.indexA,o=a.indexB,l=a.weight,this.m_accumulationBuffer[s]+=l*this.m_staticPressureBuffer[o],this.m_accumulationBuffer[o]+=l*this.m_staticPressureBuffer[s])}for(n=0;n<this.m_count;n++){var c,l=this.m_weightBuffer[n];this.m_flagsBuffer.data[n]&H.b2ParticleFlag.b2_staticPressureParticle?(c=this.m_accumulationBuffer[n],this.m_staticPressureBuffer[n]=F((c+e*(l-1))/(l+u),0,h)):this.m_staticPressureBuffer[n]=0}}},X.prototype.ComputeWeight=function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(t=0;t<this.m_bodyContactBuffer.count;t++){var e=(n=this.m_bodyContactBuffer.data[t]).index,i=n.weight;this.m_weightBuffer[e]+=i}for(t=0;t<this.m_contactBuffer.count;t++){var n,e=(n=this.m_contactBuffer.data[t]).indexA,r=n.indexB,i=n.weight;this.m_weightBuffer[e]+=i,this.m_weightBuffer[r]+=i}},X.prototype.SolvePressure=function(t){var h=X.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,e=this.m_velocityBuffer.data,_=this.GetCriticalPressure(t),d=this.m_def.pressureStrength*_,f=.25*_,i=0;i<this.m_count;i++){var n=this.m_weightBuffer[i],r=d*O(0,n-1);this.m_accumulationBuffer[i]=V(r,f)}if(this.m_allParticleFlags&X.k_noPressureFlags)for(i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&X.k_noPressureFlags&&(this.m_accumulationBuffer[i]=0);if(this.m_allParticleFlags&H.b2ParticleFlag.b2_staticPressureParticle)for(i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&H.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[i]+=this.m_staticPressureBuffer[i]);for(var p=t.dt/(this.m_def.density*this.m_particleDiameter),m=this.GetParticleInvMass(),s=0;s<this.m_bodyContactBuffer.count;s++){var o=(l=this.m_bodyContactBuffer.data[s]).index,a=l.body,n=l.weight,y=l.mass,g=l.normal,v=u[o],r=this.m_accumulationBuffer[o]+d*n,c=j.MulSV(p*n*y*r,g,h);e[o].SelfMulSub(m,c),a.ApplyLinearImpulse(c,v,!0)}for(s=0;s<this.m_contactBuffer.count;s++){var l,o=(l=this.m_contactBuffer.data[s]).indexA,a=l.indexB,n=l.weight,g=l.normal,r=this.m_accumulationBuffer[o]+this.m_accumulationBuffer[a],c=j.MulSV(p*n*r,g,h);e[o].SelfSub(c),e[a].SelfAdd(c)}},X.prototype.SolveDamping=function(h){var t=X.SolveDamping_s_v,u=X.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var _=this.m_positionBuffer.data,e=this.m_velocityBuffer.data,d=this.m_def.dampingStrength,f=1/this.GetCriticalVelocity(h),p=this.GetParticleInvMass(),i=0;i<this.m_bodyContactBuffer.count;i++){var n=(o=this.m_bodyContactBuffer.data[i]).index,r=o.body,m=o.weight,y=o.mass,s=o.normal,g=_[n],v=j.SubVV(r.GetLinearVelocityFromWorldPoint(g,j.s_t0),e[n],t);(a=j.DotVV(v,s))<0&&(c=O(d*m,V(-f*a,.5)),l=j.MulSV(c*y*a,s,u),e[n].SelfMulAdd(p,l),r.ApplyLinearImpulse(l.SelfNeg(),g,!0))}for(i=0;i<this.m_contactBuffer.count;i++){var o,a,c,l,n=(o=this.m_contactBuffer.data[i]).indexA,r=o.indexB,m=o.weight,s=o.normal,v=j.SubVV(e[r],e[n],t);(a=j.DotVV(v,s))<0&&(c=O(d*m,V(-f*a,.5)),l=j.MulSV(c*a,s,u),e[n].SelfAdd(l),e[r].SelfSub(l))}},X.prototype.SolveRigidDamping=function(){var h=X.SolveRigidDamping_s_t0,u=X.SolveRigidDamping_s_t1,_=X.SolveRigidDamping_s_p,d=X.SolveRigidDamping_s_v,t=[0],e=[0],i=[0],f=[0],p=[0],m=[0];if(!this.m_positionBuffer.data)throw new Error;for(var y=this.m_positionBuffer.data,g=this.m_def.dampingStrength,n=0;n<this.m_bodyContactBuffer.count;n++){var r=(s=this.m_bodyContactBuffer.data[n]).index;(l=this.m_groupBuffer[r])&&this.IsRigidGroup(l)&&(a=s.body,c=s.normal,A=s.weight,o=y[r],v=j.SubVV(a.GetLinearVelocityFromWorldPoint(o,h),l.GetLinearVelocityFromWorldPoint(o,u),d),(x=j.DotVV(v,c))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(t,e,i,!0,l,r,o,c),this.InitDampingParameter(f,p,m,a.GetMass(),a.GetInertia()-a.GetMass()*a.GetLocalCenter().LengthSquared(),a.GetWorldCenter(),o,c),b=g*V(A,1)*this.ComputeDampingImpulse(t[0],e[0],i[0],f[0],p[0],m[0],x),this.ApplyDamping(t[0],e[0],i[0],!0,l,r,b,c),a.ApplyLinearImpulse(j.MulSV(-b,c,j.s_t0),o,!0)))}for(n=0;n<this.m_contactBuffer.count;n++){var s,o,v,x,b,r=(s=this.m_contactBuffer.data[n]).indexA,a=s.indexB,c=s.normal,A=s.weight,l=this.m_groupBuffer[r],C=this.m_groupBuffer[a],S=this.IsRigidGroup(l),T=this.IsRigidGroup(C);l!==C&&(S||T)&&(o=j.MidVV(y[r],y[a],_),v=j.SubVV(this.GetLinearVelocity(C,a,o,h),this.GetLinearVelocity(l,r,o,u),d),(x=j.DotVV(v,c))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(t,e,i,S,l,r,o,c),this.InitDampingParameterWithRigidGroupOrParticle(f,p,m,T,C,a,o,c),b=g*A*this.ComputeDampingImpulse(t[0],e[0],i[0],f[0],p[0],m[0],x),this.ApplyDamping(t[0],e[0],i[0],S,l,r,b,c),this.ApplyDamping(f[0],p[0],m[0],T,C,a,-b,c)))}},X.prototype.SolveExtraDamping=function(){var t=X.SolveExtraDamping_s_v,e=X.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,h=this.m_positionBuffer.data,u=this.GetParticleInvMass(),n=0;n<this.m_bodyContactBuffer.count;n++){var r,s,o,a,c=this.m_bodyContactBuffer.data[n],l=c.index;this.m_flagsBuffer.data[l]&X.k_extraDampingFlags&&(r=c.body,a=c.mass,c=c.normal,s=h[l],o=j.SubVV(r.GetLinearVelocityFromWorldPoint(s,j.s_t0),i[l],t),(o=j.DotVV(o,c))<0&&(a=j.MulSV(.5*a*o,c,e),i[l].SelfMulAdd(u,a),r.ApplyLinearImpulse(a.SelfNeg(),s,!0)))}},X.prototype.SolveWall=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&H.b2ParticleFlag.b2_wallParticle&&t[e].SetZero()},X.prototype.SolveRigid=function(t){var e=X.SolveRigid_s_position,i=X.SolveRigid_s_rotation,n=X.SolveRigid_s_transform,r=X.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var h=this.m_positionBuffer.data,u=this.m_velocityBuffer.data,s=this.m_groupList;s;s=s.GetNext())if(s.m_groupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup){s.UpdateStatistics();var o=i,_=(o.SetAngle(t.dt*s.m_angularVelocity),j.AddVV(s.m_center,j.SubVV(j.MulSV(t.dt,s.m_linearVelocity,j.s_t0),B.MulRV(o,s.m_center,j.s_t1),j.s_t0),e)),a=n,c=(a.SetPositionRotation(_,o),R.MulXX(a,s.m_transform,s.m_transform),r);c.p.x=t.inv_dt*a.p.x,c.p.y=t.inv_dt*a.p.y,c.q.s=t.inv_dt*a.q.s,c.q.c=t.inv_dt*(a.q.c-1);for(var l=s.m_firstIndex;l<s.m_lastIndex;l++)R.MulXV(c,h[l],u[l])}},X.prototype.SolveElastic=function(h){var u=X.SolveElastic_s_pa,_=X.SolveElastic_s_pb,d=X.SolveElastic_s_pc,f=X.SolveElastic_s_r,t=X.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var p=this.m_positionBuffer.data,m=this.m_velocityBuffer.data,y=h.inv_dt*this.m_def.elasticStrength,g=0;g<this.m_triadBuffer.count;g++){var v,x,b,e,i,n,r,s,o,a,c,l=this.m_triadBuffer.data[g];l.flags&H.b2ParticleFlag.b2_elasticParticle&&(r=l.indexA,s=l.indexB,o=l.indexC,v=l.pa,x=l.pb,b=l.pc,e=u.Copy(p[r]),i=_.Copy(p[s]),n=d.Copy(p[o]),r=m[r],s=m[s],o=m[o],e.SelfMulAdd(h.dt,r),i.SelfMulAdd(h.dt,s),n.SelfMulAdd(h.dt,o),a=(e.x+i.x+n.x)/3,c=(e.y+i.y+n.y)/3,e.x-=a,e.y-=c,i.x-=a,i.y-=c,n.x-=a,n.y-=c,(a=f).s=j.CrossVV(v,e)+j.CrossVV(x,i)+j.CrossVV(b,n),a.c=j.DotVV(v,e)+j.DotVV(x,i)+j.DotVV(b,n),c=A(a.s*a.s+a.c*a.c),isFinite(c)||(c=198177537e11),a.s*=c,a.c*=c,c=y*l.strength,B.MulRV(a,v,t),j.SubVV(t,e,t),j.MulSV(c,t,t),r.SelfAdd(t),B.MulRV(a,x,t),j.SubVV(t,i,t),j.MulSV(c,t,t),s.SelfAdd(t),B.MulRV(a,b,t),j.SubVV(t,n,t),j.MulSV(c,t,t),o.SelfAdd(t))}},X.prototype.SolveSpring=function(t){var h=X.SolveSpring_s_pa,u=X.SolveSpring_s_pb,_=X.SolveSpring_s_d,d=X.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_positionBuffer.data,i=this.m_velocityBuffer.data,f=t.inv_dt*this.m_def.springStrength,n=0;n<this.m_pairBuffer.count;n++){var r,s,o,a,c,l=this.m_pairBuffer.data[n];l.flags&H.b2ParticleFlag.b2_springParticle&&(r=l.indexA,s=l.indexB,a=h.Copy(e[r]),o=u.Copy(e[s]),r=i[r],s=i[s],a.SelfMulAdd(t.dt,r),o.SelfMulAdd(t.dt,s),o=j.SubVV(o,a,_),a=l.distance,c=o.Length(),l=f*l.strength,l=j.MulSV(l*(a-c)/c,o,d),r.SelfSub(l),s.SelfAdd(l))}},X.prototype.SolveTensile=function(t){var h=X.SolveTensile_s_weightedNormal,u=X.SolveTensile_s_s,_=X.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var d=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)this.m_accumulation2Buffer[e]=new j,this.m_accumulation2Buffer[e].SetZero();for(var f,i=0;i<this.m_contactBuffer.count;i++)(n=this.m_contactBuffer.data[i]).flags&H.b2ParticleFlag.b2_tensileParticle&&(r=n.indexA,s=n.indexB,o=n.weight,a=n.normal,f=j.MulSV((1-o)*o,a,h),this.m_accumulation2Buffer[r].SelfSub(f),this.m_accumulation2Buffer[s].SelfAdd(f));for(var n,r,s,o,a,c,l,t=this.GetCriticalVelocity(t),p=this.m_def.surfaceTensionPressureStrength*t,m=this.m_def.surfaceTensionNormalStrength*t,y=.5*t,i=0;i<this.m_contactBuffer.count;i++)(n=this.m_contactBuffer.data[i]).flags&H.b2ParticleFlag.b2_tensileParticle&&(r=n.indexA,s=n.indexB,o=n.weight,a=n.normal,c=this.m_weightBuffer[r]+this.m_weightBuffer[s],l=j.SubVV(this.m_accumulation2Buffer[s],this.m_accumulation2Buffer[r],u),c=V(p*(c-2)+m*j.DotVV(l,a),y)*o,l=j.MulSV(c,a,_),d[r].SelfSub(l),d[s].SelfAdd(l))},X.prototype.SolveViscous=function(){var t=X.SolveViscous_s_v,h=X.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,e=this.m_velocityBuffer.data,_=this.m_def.viscousStrength,d=this.GetParticleInvMass(),i=0;i<this.m_bodyContactBuffer.count;i++){var f,n,r=(s=this.m_bodyContactBuffer.data[i]).index;this.m_flagsBuffer.data[r]&H.b2ParticleFlag.b2_viscousParticle&&(o=s.body,a=s.weight,f=s.mass,n=u[r],c=j.SubVV(o.GetLinearVelocityFromWorldPoint(n,j.s_t0),e[r],t),l=j.MulSV(_*f*a,c,h),e[r].SelfMulAdd(d,l),o.ApplyLinearImpulse(l.SelfNeg(),n,!0))}for(var s,o,a,c,l,i=0;i<this.m_contactBuffer.count;i++)(s=this.m_contactBuffer.data[i]).flags&H.b2ParticleFlag.b2_viscousParticle&&(r=s.indexA,o=s.indexB,a=s.weight,c=j.SubVV(e[o],e[r],t),l=j.MulSV(_*a,c,h),e[r].SelfAdd(l),e[o].SelfSub(l))},X.prototype.SolveRepulsive=function(t){var e=X.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t),r=0;r<this.m_contactBuffer.count;r++){var s,o,a,c=this.m_contactBuffer.data[r];c.flags&H.b2ParticleFlag.b2_repulsiveParticle&&(s=c.indexA,o=c.indexB,this.m_groupBuffer[s]!==this.m_groupBuffer[o]&&(a=c.weight,c=c.normal,a=j.MulSV(n*a,c,e),i[s].SelfSub(a),i[o].SelfAdd(a)))}},X.prototype.SolvePowder=function(h){var t=X.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,e=this.m_velocityBuffer.data,i=this.m_def.powderStrength*this.GetCriticalVelocity(h),_=this.GetParticleInvMass(),n=0;n<this.m_bodyContactBuffer.count;n++){var d,f,r=(s=this.m_bodyContactBuffer.data[n]).index;this.m_flagsBuffer.data[r]&H.b2ParticleFlag.b2_powderParticle&&.25<(o=s.weight)&&(a=s.body,d=s.mass,f=u[r],c=s.normal,l=j.MulSV(i*d*(o-.25),c,t),e[r].SelfMulSub(_,l),a.ApplyLinearImpulse(l,f,!0))}for(var s,o,a,c,l,n=0;n<this.m_contactBuffer.count;n++)(s=this.m_contactBuffer.data[n]).flags&H.b2ParticleFlag.b2_powderParticle&&.25<(o=s.weight)&&(r=s.indexA,a=s.indexB,c=s.normal,l=j.MulSV(i*(o-.25),c,t),e[r].SelfSub(l),e[a].SelfAdd(l))},X.prototype.SolveSolid=function(t){var e=X.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,n=(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer),t.inv_dt*this.m_def.ejectionStrength),r=0;r<this.m_contactBuffer.count;r++){var s,o,a=this.m_contactBuffer.data[r],c=a.indexA,l=a.indexB;this.m_groupBuffer[c]!==this.m_groupBuffer[l]&&(s=a.weight,a=a.normal,o=this.m_depthBuffer[c]+this.m_depthBuffer[l],o=j.MulSV(n*o*s,a,e),i[c].SelfSub(o),i[l].SelfAdd(o))}},X.prototype.SolveForce=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),n=0;n<this.m_count;n++)e[n].SelfMulAdd(i,this.m_forceBuffer[n]);this.m_hasForce=!1},X.prototype.SolveColorMixing=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],n=i.indexA,i=i.indexB;this.m_flagsBuffer.data[n]&this.m_flagsBuffer.data[i]&H.b2ParticleFlag.b2_colorMixingParticle&&(n=this.m_colorBuffer.data[n],i=this.m_colorBuffer.data[i],$.MixColors(n,i,t))}},X.prototype.SolveZombie=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=-1;for(var h=0,i=0;i<this.m_count;i++){var u,n,_=this.m_flagsBuffer.data[i];_&H.b2ParticleFlag.b2_zombieParticle?(u=this.m_world.m_destructionListener,_&H.b2ParticleFlag.b2_destructionListenerParticle&&u&&u.SayGoodbyeParticle(this,i),this.m_handleIndexBuffer.data&&(n=this.m_handleIndexBuffer.data[i])&&(n.SetIndex(-1),this.m_handleIndexBuffer.data[i]=null),e[i]=-1):(i!==(e[i]=t)&&(this.m_handleIndexBuffer.data&&((n=this.m_handleIndexBuffer.data[i])&&n.SetIndex(t),this.m_handleIndexBuffer.data[t]=n),this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[i],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[i]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[i]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[i]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[i]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[i]),this.m_groupBuffer[t]=this.m_groupBuffer[i],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[i]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[i]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[i]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[i]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[i]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[i])),t++,h|=_)}for(var d=function(t){return t.index<0},f=function(t){return t.indexA<0||t.indexB<0},p=function(t){return t.index<0},m=function(t){return t.indexA<0||t.indexB<0},y=function(t){return t.indexA<0||t.indexB<0||t.indexC<0},r=0;r<this.m_proxyBuffer.count;r++){var g=this.m_proxyBuffer.data[r];g.index=e[g.index]}this.m_proxyBuffer.RemoveIf(d);for(r=0;r<this.m_contactBuffer.count;r++)(s=this.m_contactBuffer.data[r]).indexA=e[s.indexA],s.indexB=e[s.indexB];this.m_contactBuffer.RemoveIf(f);for(var s,r=0;r<this.m_bodyContactBuffer.count;r++)(s=this.m_bodyContactBuffer.data[r]).index=e[s.index];this.m_bodyContactBuffer.RemoveIf(p);for(r=0;r<this.m_pairBuffer.count;r++){var o=this.m_pairBuffer.data[r];o.indexA=e[o.indexA],o.indexB=e[o.indexB]}this.m_pairBuffer.RemoveIf(m);for(r=0;r<this.m_triadBuffer.count;r++){var a=this.m_triadBuffer.data[r];a.indexA=e[a.indexA],a.indexB=e[a.indexB],a.indexC=e[a.indexC]}if(this.m_triadBuffer.RemoveIf(y),this.m_indexByExpirationTimeBuffer.data)for(var v=0,x=0;x<this.m_count;x++){var b=e[this.m_indexByExpirationTimeBuffer.data[x]];-1!==b&&(this.m_indexByExpirationTimeBuffer.data[v++]=b)}for(var c=this.m_groupList;c;c=c.GetNext()){for(var l=t,A=0,C=!1,i=c.m_firstIndex;i<c.m_lastIndex;i++){var S=e[i];0<=S?(l=V(l,S),A=O(A,S+1)):C=!0}l<A?(c.m_firstIndex=l,c.m_lastIndex=A,C&&c.m_groupFlags&H.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(c,c.m_groupFlags|H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(c.m_firstIndex=0,c.m_lastIndex=0,c.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(c,c.m_groupFlags|H.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=t,this.m_allParticleFlags=h,this.m_needsUpdateAllParticleFlags=!1;for(c=this.m_groupList;c;){var T=c.GetNext();c.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(c),c=T}},X.prototype.SolveLifetimes=function(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),n=this.m_expirationTimeBuffer.data,i=this.m_indexByExpirationTimeBuffer.data,t=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Ks(i,0,t,function(t,e){var t=n[t],e=n[e],i=t<=0;return i==e<=0?e<t:i}),this.m_expirationTimeBufferRequiresSorting=!1);for(var r=t-1;0<=r;--r){var s=i[r],o=n[s];if(e<o||o<=0)break;this.DestroyParticle(s)}},X.prototype.RotateBuffer=function(e,i,n){if(e!==i&&i!==n){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(io(this.m_flagsBuffer.data,e,i,n),this.m_lastBodyContactStepBuffer.data&&io(this.m_lastBodyContactStepBuffer.data,e,i,n),this.m_bodyContactCountBuffer.data&&io(this.m_bodyContactCountBuffer.data,e,i,n),this.m_consecutiveContactStepsBuffer.data&&io(this.m_consecutiveContactStepsBuffer.data,e,i,n),io(this.m_positionBuffer.data,e,i,n),io(this.m_velocityBuffer.data,e,i,n),io(this.m_groupBuffer,e,i,n),this.m_hasForce&&io(this.m_forceBuffer,e,i,n),this.m_staticPressureBuffer&&io(this.m_staticPressureBuffer,e,i,n),this.m_depthBuffer&&io(this.m_depthBuffer,e,i,n),this.m_colorBuffer.data&&io(this.m_colorBuffer.data,e,i,n),this.m_userDataBuffer.data&&io(this.m_userDataBuffer.data,e,i,n),this.m_handleIndexBuffer.data){io(this.m_handleIndexBuffer.data,e,i,n);for(var t=e;t<n;++t){var h=this.m_handleIndexBuffer.data[t];h&&h.SetIndex(l(h.GetIndex()))}}if(this.m_expirationTimeBuffer.data){io(this.m_expirationTimeBuffer.data,e,i,n);var u=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;for(var _=this.m_indexByExpirationTimeBuffer.data,t=0;t<u;++t)_[t]=l(_[t])}for(var r=0;r<this.m_proxyBuffer.count;r++){var d=this.m_proxyBuffer.data[r];d.index=l(d.index)}for(r=0;r<this.m_contactBuffer.count;r++)(s=this.m_contactBuffer.data[r]).indexA=l(s.indexA),s.indexB=l(s.indexB);for(var s,r=0;r<this.m_bodyContactBuffer.count;r++)(s=this.m_bodyContactBuffer.data[r]).index=l(s.index);for(r=0;r<this.m_pairBuffer.count;r++){var o=this.m_pairBuffer.data[r];o.indexA=l(o.indexA),o.indexB=l(o.indexB)}for(r=0;r<this.m_triadBuffer.count;r++){var a=this.m_triadBuffer.data[r];a.indexA=l(a.indexA),a.indexB=l(a.indexB),a.indexC=l(a.indexC)}for(var c=this.m_groupList;c;c=c.GetNext())c.m_firstIndex=l(c.m_firstIndex),c.m_lastIndex=l(c.m_lastIndex-1)+1}function l(t){return t<e?t:t<i?t+n-i:t<n?t+e-i:t}},X.prototype.GetCriticalVelocity=function(t){return this.m_particleDiameter*t.inv_dt},X.prototype.GetCriticalVelocitySquared=function(t){t=this.GetCriticalVelocity(t);return t*t},X.prototype.GetCriticalPressure=function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)},X.prototype.GetParticleStride=function(){return.75*this.m_particleDiameter},X.prototype.GetParticleMass=function(){var t=this.GetParticleStride();return this.m_def.density*t*t},X.prototype.GetParticleInvMass=function(){var t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t},X.prototype.GetFixtureContactFilter=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},X.prototype.GetParticleContactFilter=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},X.prototype.GetFixtureContactListener=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},X.prototype.GetParticleContactListener=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},X.prototype.SetUserOverridableBuffer=function(t,e,i){t.data=e,t.userSuppliedCapacity=i},X.prototype.SetGroupFlags=function(t,e){var i=t.m_groupFlags;(i^e)&H.b2ParticleGroupFlag.b2_solidParticleGroup&&(e|=H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&H.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e},X.BodyContactCompare=function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index},X.prototype.RemoveSpuriousBodyContacts=function(){Ks(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,X.BodyContactCompare);var s=X.RemoveSpuriousBodyContacts_s_n,o=X.RemoveSpuriousBodyContacts_s_pos,a=X.RemoveSpuriousBodyContacts_s_normal,c=this,l=-1,h=0;this.m_bodyContactBuffer.count=$s(this.m_bodyContactBuffer.data,function(t){if(t.index!==l&&(h=0,l=t.index),3<h++)return!0;var e=s.Copy(t.normal);if(e.SelfMul(c.m_particleDiameter*(1-t.weight)),!c.m_positionBuffer.data)throw new Error;var i=j.AddVV(c.m_positionBuffer.data[t.index],e,o);if(t.fixture.TestPoint(i))return!1;for(var n=t.fixture.GetShape().GetChildCount(),r=0;r<n;r++)if(t.fixture.ComputeDistance(i,a,r)<I)return!1;return!0},this.m_bodyContactBuffer.count)},X.prototype.DetectStuckParticle=function(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}},X.prototype.ValidateParticleIndex=function(t){return 0<=t&&t<this.GetParticleCount()&&-1!==t},X.prototype.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296)},X.prototype.LifetimeToExpirationTime=function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)},X.prototype.ForceCanBeApplied=function(t){return!(t&H.b2ParticleFlag.b2_wallParticle)},X.prototype.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}},X.prototype.IsRigidGroup=function(t){return null!==t&&0!=(t.m_groupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup)},X.prototype.GetLinearVelocity=function(t,e,i,n){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,n);if(!this.m_velocityBuffer.data)throw new Error;return n.Copy(this.m_velocityBuffer.data[e])},X.prototype.InitDampingParameter=function(t,e,i,n,r,s,o,a){t[0]=0<n?1/n:0,e[0]=0<r?1/r:0,i[0]=j.CrossVV(j.SubVV(o,s,j.s_t0),a)},X.prototype.InitDampingParameterWithRigidGroupOrParticle=function(t,e,i,n,r,s,o,a){if(r&&n)this.InitDampingParameter(t,e,i,r.GetMass(),r.GetInertia(),r.GetCenter(),o,a);else{if(!this.m_flagsBuffer.data)throw new Error;n=this.m_flagsBuffer.data[s];this.InitDampingParameter(t,e,i,n&H.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,o,o,a)}},X.prototype.ComputeDampingImpulse=function(t,e,i,n,r,s,o){t=t+e*i*i+n+r*s*s;return 0<t?o/t:0},X.prototype.ApplyDamping=function(t,e,i,n,r,s,o,a){if(r&&n)r.m_linearVelocity.SelfMulAdd(o*t,a),r.m_angularVelocity+=o*i*e;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[s].SelfMulAdd(o*t,a)}},X.xTruncBits=12,X.yTruncBits=12,X.tagBits=32,X.yOffset=1<<X.yTruncBits-1,X.yShift=X.tagBits-X.yTruncBits,X.xShift=X.tagBits-X.yTruncBits-X.xTruncBits,X.xScale=1<<X.xShift,X.xOffset=X.xScale*(1<<X.xTruncBits-1),X.yMask=(1<<X.yTruncBits)-1<<X.yShift,X.xMask=~X.yMask,X.DestroyParticlesInShape_s_aabb=new re,X.CreateParticleGroup_s_transform=new R,X.ComputeCollisionEnergy_s_v=new j,X.QueryShapeAABB_s_aabb=new re,X.QueryPointAABB_s_aabb=new re,X.RayCast_s_aabb=new re,X.RayCast_s_p=new j,X.RayCast_s_v=new j,X.RayCast_s_n=new j,X.RayCast_s_point=new j,X.k_pairFlags=H.b2ParticleFlag.b2_springParticle,X.k_triadFlags=H.b2ParticleFlag.b2_elasticParticle,X.k_noPressureFlags=H.b2ParticleFlag.b2_powderParticle|H.b2ParticleFlag.b2_tensileParticle,X.k_extraDampingFlags=H.b2ParticleFlag.b2_staticPressureParticle,X.k_barrierWallFlags=H.b2ParticleFlag.b2_barrierParticle|H.b2ParticleFlag.b2_wallParticle,X.CreateParticlesStrokeShapeForGroup_s_edge=new Ui,X.CreateParticlesStrokeShapeForGroup_s_d=new j,X.CreateParticlesStrokeShapeForGroup_s_p=new j,X.CreateParticlesFillShapeForGroup_s_aabb=new re,X.CreateParticlesFillShapeForGroup_s_p=new j,X.UpdatePairsAndTriads_s_dab=new j,X.UpdatePairsAndTriads_s_dbc=new j,X.UpdatePairsAndTriads_s_dca=new j,X.AddContact_s_d=new j,X.UpdateBodyContacts_s_aabb=new re,X.Solve_s_subStep=new ms,X.SolveCollision_s_aabb=new re,X.SolveGravity_s_gravity=new j,X.SolveBarrier_s_aabb=new re,X.SolveBarrier_s_va=new j,X.SolveBarrier_s_vb=new j,X.SolveBarrier_s_pba=new j,X.SolveBarrier_s_vba=new j,X.SolveBarrier_s_vc=new j,X.SolveBarrier_s_pca=new j,X.SolveBarrier_s_vca=new j,X.SolveBarrier_s_qba=new j,X.SolveBarrier_s_qca=new j,X.SolveBarrier_s_dv=new j,X.SolveBarrier_s_f=new j,X.SolvePressure_s_f=new j,X.SolveDamping_s_v=new j,X.SolveDamping_s_f=new j,X.SolveRigidDamping_s_t0=new j,X.SolveRigidDamping_s_t1=new j,X.SolveRigidDamping_s_p=new j,X.SolveRigidDamping_s_v=new j,X.SolveExtraDamping_s_v=new j,X.SolveExtraDamping_s_f=new j,X.SolveRigid_s_position=new j,X.SolveRigid_s_rotation=new B,X.SolveRigid_s_transform=new R,X.SolveRigid_s_velocityTransform=new R,X.SolveElastic_s_pa=new j,X.SolveElastic_s_pb=new j,X.SolveElastic_s_pc=new j,X.SolveElastic_s_r=new B,X.SolveElastic_s_t0=new j,X.SolveSpring_s_pa=new j,X.SolveSpring_s_pb=new j,X.SolveSpring_s_d=new j,X.SolveSpring_s_f=new j,X.SolveTensile_s_weightedNormal=new j,X.SolveTensile_s_s=new j,X.SolveTensile_s_f=new j,X.SolveViscous_s_v=new j,X.SolveViscous_s_f=new j,X.SolveRepulsive_s_f=new j,X.SolvePowder_s_f=new j,X.SolveSolid_s_f=new j,X.RemoveSpuriousBodyContacts_s_n=new j,X.RemoveSpuriousBodyContacts_s_pos=new j,X.RemoveSpuriousBodyContacts_s_normal=new j,X),function(_){_.UserOverridableBuffer=function(){this.data=null,this.userSuppliedCapacity=0},e.CompareProxyProxy=function(t,e){return t.tag<e.tag},e.CompareTagProxy=function(t,e){return t<e.tag},e.CompareProxyTag=function(t,e){return t.tag<e};var t=e;function e(){this.index=-1,this.tag=0}function l(t,e,i,n,r){this.m_system=t,this.m_xLower=(e&_.xMask)>>>0,this.m_xUpper=(i&_.xMask)>>>0,this.m_yLower=(e&_.yMask)>>>0,this.m_yUpper=(i&_.yMask)>>>0,this.m_first=n,this.m_last=r}_.Proxy=t,l.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&_.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return-1},_.InsideBoundsEnumerator=l;_.ParticleListNode=function(){this.next=null,this.count=0,this.index=0},i.prototype.Allocate=function(t,e){return e},i.prototype.Clear=function(){},i.prototype.GetCount=function(){return 0},i.prototype.Invalidate=function(t){},i.prototype.GetValidBuffer=function(){return[]},i.prototype.GetBuffer=function(){return[]},i.prototype.SetCount=function(t){};t=i;function i(){}_.FixedSetAllocator=t;_.FixtureParticle=function(t,e){this.second=-1,this.first=t,this.second=e},Fi(n,h=_.FixedSetAllocator),n.prototype.Initialize=function(t,e){},n.prototype.Find=function(t){return-1};var h,t=n;function n(){return null!==h&&h.apply(this,arguments)||this}_.FixtureParticleSet=t;_.ParticlePair=function(t,e){this.first=-1,this.second=-1,this.first=t,this.second=e},Fi(r,u=_.FixedSetAllocator),r.prototype.Initialize=function(t,e){},r.prototype.Find=function(t){return-1};var u,t=r;function r(){return null!==u&&u.apply(this,arguments)||this}function d(){}_.b2ParticlePairSet=t,d.prototype.IsNecessary=function(t){return!0},d.prototype.ShouldCreatePair=function(t,e){return!0},d.prototype.ShouldCreateTriad=function(t,e,i){return!0},_.ConnectionFilter=d;Fi(s,f=cs),s.prototype.ReportFixture=function(t){return!1},s.prototype.ReportParticle=function(t,e){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0},s.prototype.Destroyed=function(){return this.m_destroyed};var f,t=s;function s(t,e,i,n){var r=f.call(this)||this;return r.m_callDestructionListener=!1,r.m_destroyed=0,r.m_system=t,r.m_shape=e,r.m_xf=i,r.m_callDestructionListener=n,r.m_destroyed=0,r}_.DestroyParticlesInShapeCallback=t;Fi(m,p=_.ConnectionFilter),m.prototype.ShouldCreatePair=function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t},m.prototype.ShouldCreateTriad=function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)};var p,t=m;function m(t){var e=p.call(this)||this;return e.m_threshold=0,e.m_threshold=t,e}_.JoinParticleGroupsFilter=t;Fi(o,y=Li),o.prototype.Clone=function(){throw new Error},o.prototype.GetChildCount=function(){return 1},o.prototype.TestPoint=function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1},o.prototype.ComputeDistance=function(t,e,i,n){return 0},o.prototype.RayCast=function(t,e,i,n){return!1},o.prototype.ComputeAABB=function(t,e,i){var n=new re;t.lowerBound.x=+P,t.lowerBound.y=+P,t.upperBound.x=-P,t.upperBound.y=-P;for(var r=0;r<this.m_shapeCount;r++)for(var s=this.m_shapes[r].GetChildCount(),o=0;o<s;o++){var a=n;this.m_shapes[r].ComputeAABB(a,e,o),t.Combine1(a)}},o.prototype.ComputeMass=function(t,e){},o.prototype.SetupDistanceProxy=function(t,e){},o.prototype.ComputeSubmergedArea=function(t,e,i,n){return 0},o.prototype.Dump=function(t){};var y,t=o;function o(t,e){void 0===e&&(e=t.length);var i=y.call(this,H.b2ShapeType.e_unknown,0)||this;return i.m_shapeCount=0,i.m_shapes=t,i.m_shapeCount=e,i}_.CompositeShape=t;Fi(v,g=_.ConnectionFilter),v.prototype.IsNecessary=function(t){if(!this.m_flagsBuffer.data)throw new Error;return 0!=(this.m_flagsBuffer.data[t]&H.b2ParticleFlag.b2_reactiveParticle)};var g,t=v;function v(t){var e=g.call(this)||this;return e.m_flagsBuffer=t,e}_.ReactiveFilter=t;Fi(a,x=oo),a.prototype.ShouldCollideFixtureParticle=function(t,e,i){if(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[i]&H.b2ParticleFlag.b2_fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i);return!0},a.prototype.ReportFixtureAndParticle=function(t,e,i){var n=_.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,r=_.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;var s,h,o,a,c,l=this.m_system.m_positionBuffer.data[i],e=t.ComputeDistance(l,n,e);e<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,i)&&(a=(s=t.GetBody()).GetWorldCenter(),h=0<(o=s.GetMass())?1/o:0,o=0<(o=s.GetInertia()-o*s.GetLocalCenter().LengthSquared())?1/o:0,c=this.m_system.m_flagsBuffer.data[i]&H.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),l=j.SubVV(l,a,r),r=c+h+o*(a=j.CrossVV(l,n))*a,(c=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()]).index=i,c.body=s,c.fixture=t,c.weight=1-e*this.m_system.m_inverseDiameter,c.normal.Copy(n.SelfNeg()),c.mass=0<r?1/r:0,this.m_system.DetectStuckParticle(i))},a.ReportFixtureAndParticle_s_n=new j,a.ReportFixtureAndParticle_s_rp=new j;var x,t=a;function a(t,e){t=x.call(this,t)||this;return t.m_contactFilter=e,t}_.UpdateBodyContactsCallback=t;Fi(c,b=oo),c.prototype.ReportFixtureAndParticle=function(t,e,i){var n=_.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,r=_.SolveCollisionCallback.ReportFixtureAndParticle_s_output,s=_.SolveCollisionCallback.ReportFixtureAndParticle_s_input,o=_.SolveCollisionCallback.ReportFixtureAndParticle_s_p,h=_.SolveCollisionCallback.ReportFixtureAndParticle_s_v,u=_.SolveCollisionCallback.ReportFixtureAndParticle_s_f,a=t.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var c=this.m_system.m_positionBuffer.data[i],l=this.m_system.m_velocityBuffer.data[i];0===this.m_system.m_iterationIndex?(n=R.MulTXV(a.m_xf0,c,n),t.GetShape().GetType()===H.b2ShapeType.e_circleShape&&(n.SelfSub(a.GetLocalCenter()),B.MulRV(a.m_xf0.q,n,n),B.MulTRV(a.m_xf.q,n,n),n.SelfAdd(a.GetLocalCenter())),R.MulXV(a.m_xf,n,s.p1)):s.p1.Copy(c),j.AddVMulSV(c,this.m_step.dt,l,s.p2),s.maxFraction=1,t.RayCast(r,s,e)&&(a=r.normal,(n=o).x=(1-r.fraction)*s.p1.x+r.fraction*s.p2.x+I*a.x,n.y=(1-r.fraction)*s.p1.y+r.fraction*s.p2.y+I*a.y,(t=h).x=this.m_step.inv_dt*(n.x-c.x),t.y=this.m_step.inv_dt*(n.y-c.y),this.m_system.m_velocityBuffer.data[i].Copy(t),(e=u).x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(l.x-t.x),e.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(l.y-t.y),this.m_system.ParticleApplyForce(i,e))},c.prototype.ReportParticle=function(t,e){return!1},c.ReportFixtureAndParticle_s_p1=new j,c.ReportFixtureAndParticle_s_output=new ie,c.ReportFixtureAndParticle_s_input=new te,c.ReportFixtureAndParticle_s_p=new j,c.ReportFixtureAndParticle_s_v=new j,c.ReportFixtureAndParticle_s_f=new j;var b,t=c;function c(t,e){t=b.call(this,t)||this;return t.m_step=e,t}_.SolveCollisionCallback=t}(H.b2ParticleSystem||(H.b2ParticleSystem={}));E.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},E.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},E.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},E.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},E.prototype.CreateBody=function(t){if(void 0===t&&(t={}),this.IsLocked())throw new Error;t=new tn(t,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},E.prototype.DestroyBody=function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e,e=e.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_controllerList;n;){var r=n,n=n.nextController;r.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var o=s,s=s.next;this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var c=a,a=a.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(),c.Destroy(),t.m_fixtureList=a,--t.m_fixtureCount}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount},E._Joint_Create=function(t,e){switch(t.type){case H.b2JointType.e_distanceJoint:return new _n(t);case H.b2JointType.e_mouseJoint:return new Un(t);case H.b2JointType.e_prismaticJoint:return new qn(t);case H.b2JointType.e_revoluteJoint:return new or(t);case H.b2JointType.e_pulleyJoint:return new tr(t);case H.b2JointType.e_gearJoint:return new Bn(t);case H.b2JointType.e_wheelJoint:return new Sr(t);case H.b2JointType.e_weldJoint:return new gr(t);case H.b2JointType.e_frictionJoint:return new Sn(t);case H.b2JointType.e_ropeJoint:return new _r(t);case H.b2JointType.e_motorJoint:return new On(t);case H.b2JointType.e_areaJoint:return new gn(t)}throw new Error},E._Joint_Destroy=function(t,e){},E.prototype.CreateJoint=function(t){if(this.IsLocked())throw new Error;var e=E._Joint_Create(t,null),i=(e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB,t.bodyA),n=t.bodyB;if(!t.collideConnected)for(var r=n.GetContactList();r;)r.other===i&&r.contact.FlagForFiltering(),r=r.next;return e},E.prototype.DestroyJoint=function(t){if(this.IsLocked())throw new Error;var e=t.m_collideConnected,i=(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next),t.m_bodyA),n=t.m_bodyB;if(i.SetAwake(!0),n.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===n.m_jointList&&(n.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,E._Joint_Destroy(t,null),--this.m_jointCount,!e)for(var r=n.GetContactList();r;)r.other===i&&r.contact.FlagForFiltering(),r=r.next},E.prototype.CreateParticleSystem=function(t){if(this.IsLocked())throw new Error;t=new H.b2ParticleSystem(t,this);return t.m_prev=null,t.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=t),this.m_particleSystemList=t},E.prototype.DestroyParticleSystem=function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)},E.prototype.CalculateReasonableParticleIterations=function(t){return null===this.m_particleSystemList?1:Fs(this.m_gravity.Length(),function(t){for(var e=P,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=V(e,i.GetRadius());return e}(this),t)},E.prototype.Step=function(t,e,i,n){void 0===n&&(n=this.CalculateReasonableParticleIterations(t));var r=E.Step_s_stepTimer.Reset(),s=(this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0,E.Step_s_step),e=(s.dt=t,s.velocityIterations=e,s.positionIterations=i,s.particleIterations=n,s.inv_dt=0<t?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting,E.Step_s_timer.Reset());if(this.m_contactManager.Collide(),this.m_profile.collide=e.GetMilliseconds(),this.m_stepComplete&&0<s.dt){for(var i=E.Step_s_timer.Reset(),o=this.m_particleSystemList;o;o=o.m_next)o.Solve(s);this.Solve(s),this.m_profile.solve=i.GetMilliseconds()}this.m_continuousPhysics&&0<s.dt&&(n=E.Step_s_timer.Reset(),this.SolveTOI(s),this.m_profile.solveTOI=n.GetMilliseconds()),0<s.dt&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()},E.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},E.prototype.DrawParticleSystem=function(t){var e,i,n;null===this.m_debugDraw||(e=t.GetParticleCount())&&(i=t.GetRadius(),n=t.GetPositionBuffer(),t.m_colorBuffer.data?(t=t.GetColorBuffer(),this.m_debugDraw.DrawParticles(n,i,t,e)):this.m_debugDraw.DrawParticles(n,i,null,e))},E.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){var t=this.m_debugDraw.GetFlags(),e=E.DrawDebugData_s_color.SetRGB(0,0,0);if(t&H.b2DrawFlags.e_shapeBit)for(var i=this.m_bodyList;i;i=i.m_next){var n=i.m_xf;this.m_debugDraw.PushTransform(n);for(var r=i.GetFixtureList();r;r=r.m_next)i.IsActive()?i.GetType()===H.b2BodyType.b2_staticBody?e.SetRGB(.5,.9,.5):i.GetType()===H.b2BodyType.b2_kinematicBody?e.SetRGB(.5,.5,.9):i.IsAwake()?e.SetRGB(.9,.7,.7):e.SetRGB(.6,.6,.6):e.SetRGB(.5,.5,.3),this.DrawShape(r,e);this.m_debugDraw.PopTransform(n)}if(t&H.b2DrawFlags.e_particleBit)for(var s=this.m_particleSystemList;s;s=s.m_next)this.DrawParticleSystem(s);if(t&H.b2DrawFlags.e_jointBit)for(var o=this.m_jointList;o;o=o.m_next)this.DrawJoint(o);if(t&H.b2DrawFlags.e_aabbBit){e.SetRGB(.9,.3,.9);for(var a=E.DrawDebugData_s_vs,i=this.m_bodyList;i;i=i.m_next)if(i.IsActive())for(r=i.GetFixtureList();r;r=r.m_next)for(var h=0;h<r.m_proxyCount;++h){var c=r.m_proxies[h].treeNode.aabb;a[0].Set(c.lowerBound.x,c.lowerBound.y),a[1].Set(c.upperBound.x,c.lowerBound.y),a[2].Set(c.upperBound.x,c.upperBound.y),a[3].Set(c.lowerBound.x,c.upperBound.y),this.m_debugDraw.DrawPolygon(a,4,e)}}if(t&H.b2DrawFlags.e_centerOfMassBit)for(i=this.m_bodyList;i;i=i.m_next)(n=E.DrawDebugData_s_xf).q.Copy(i.m_xf.q),n.p.Copy(i.GetWorldCenter()),this.m_debugDraw.DrawTransform(n);if(t&H.b2DrawFlags.e_controllerBit)for(var l=this.m_controllerList;l;l=l.m_next)l.Draw(this.m_debugDraw)}},E.prototype.QueryAABB=function(e,t,i){if(this.m_contactManager.m_broadPhase.Query(t,function(t){t=t.userData.fixture;return e?e.ReportFixture(t):!i||i(t)}),e instanceof cs)for(var n=this.m_particleSystemList;n;n=n.m_next)e.ShouldQueryParticleSystem(n)&&n.QueryAABB(e,t)},E.prototype.QueryAllAABB=function(t,e){return void 0===e&&(e=[]),this.QueryAABB(null,t,function(t){return e.push(t),!0}),e},E.prototype.QueryPointAABB=function(e,t,i){if(this.m_contactManager.m_broadPhase.QueryPoint(t,function(t){t=t.userData.fixture;return e?e.ReportFixture(t):!i||i(t)}),e instanceof cs)for(var n=this.m_particleSystemList;n;n=n.m_next)e.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(e,t)},E.prototype.QueryAllPointAABB=function(t,e){return void 0===e&&(e=[]),this.QueryPointAABB(null,t,function(t){return e.push(t),!0}),e},E.prototype.QueryFixtureShape=function(i,n,r,s,o){var t=E.QueryFixtureShape_s_aabb;if(n.ComputeAABB(t,s,r),this.m_contactManager.m_broadPhase.Query(t,function(t){var t=t.userData,e=t.fixture;if(ue(n,r,e.GetShape(),t.childIndex,s,e.GetBody().GetTransform())){if(i)return i.ReportFixture(e);if(o)return o(e)}return!0}),i instanceof cs)for(var e=this.m_particleSystemList;e;e=e.m_next)i.ShouldQueryParticleSystem(e)&&e.QueryAABB(i,t)},E.prototype.QueryAllFixtureShape=function(t,e,i,n){return void 0===n&&(n=[]),this.QueryFixtureShape(null,t,e,i,function(t){return n.push(t),!0}),n},E.prototype.QueryFixturePoint=function(e,i,n){if(this.m_contactManager.m_broadPhase.QueryPoint(i,function(t){t=t.userData.fixture;if(t.TestPoint(i)){if(e)return e.ReportFixture(t);if(n)return n(t)}return!0}),e)for(var t=this.m_particleSystemList;t;t=t.m_next)e.ShouldQueryParticleSystem(t)&&t.QueryPointAABB(e,i)},E.prototype.QueryAllFixturePoint=function(t,e){return void 0===e&&(e=[]),this.QueryFixturePoint(null,t,function(t){return e.push(t),!0}),e},E.prototype.RayCast=function(s,o,a,c){var t=E.RayCast_s_input;if(t.maxFraction=1,t.p1.Copy(o),t.p2.Copy(a),this.m_contactManager.m_broadPhase.RayCast(t,function(t,e){var e=e.userData,i=e.fixture,e=e.childIndex,n=E.RayCast_s_output;if(i.RayCast(n,t,e)){var e=n.fraction,r=E.RayCast_s_point;if(r.Set((1-e)*o.x+e*a.x,(1-e)*o.y+e*a.y),s)return s.ReportFixture(i,r,n.normal,e);if(c)return c(i,r,n.normal,e)}return t.maxFraction}),s)for(var e=this.m_particleSystemList;e;e=e.m_next)s.ShouldQueryParticleSystem(e)&&e.RayCast(s,o,a)},E.prototype.RayCastOne=function(t,e){var r=null,s=1;return this.RayCast(null,t,e,function(t,e,i,n){return n<s&&(s=n,r=t),s}),r},E.prototype.RayCastAll=function(t,e,r){return void 0===r&&(r=[]),this.RayCast(null,t,e,function(t,e,i,n){return r.push(t),1}),r},E.prototype.GetBodyList=function(){return this.m_bodyList},E.prototype.GetJointList=function(){return this.m_jointList},E.prototype.GetParticleSystemList=function(){return this.m_particleSystemList},E.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},E.prototype.SetAllowSleeping=function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},E.prototype.GetAllowSleeping=function(){return this.m_allowSleep},E.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},E.prototype.GetWarmStarting=function(){return this.m_warmStarting},E.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},E.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},E.prototype.SetSubStepping=function(t){this.m_subStepping=t},E.prototype.GetSubStepping=function(){return this.m_subStepping},E.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},E.prototype.GetBodyCount=function(){return this.m_bodyCount},E.prototype.GetJointCount=function(){return this.m_jointCount},E.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},E.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},E.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},E.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},E.prototype.SetGravity=function(t,e){if(void 0===e&&(e=!0),!j.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)},E.prototype.GetGravity=function(){return this.m_gravity},E.prototype.IsLocked=function(){return this.m_locked},E.prototype.SetAutoClearForces=function(t){this.m_clearForces=t},E.prototype.GetAutoClearForces=function(){return this.m_clearForces},E.prototype.ShiftOrigin=function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)},E.prototype.GetContactManager=function(){return this.m_contactManager},E.prototype.GetProfile=function(){return this.m_profile},E.prototype.Dump=function(t){if(!this.m_locked){t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");for(var e=0,i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;for(var e=0,n=this.m_jointList;n;n=n.m_next)n.m_index=e,++e;for(n=this.m_jointList;n;n=n.m_next)n.m_type!==H.b2JointType.e_gearJoint&&(t("{\n"),n.Dump(t),t("}\n"));for(n=this.m_jointList;n;n=n.m_next)n.m_type===H.b2JointType.e_gearJoint&&(t("{\n"),n.Dump(t),t("}\n"))}},E.prototype.DrawJoint=function(t){if(null!==this.m_debugDraw){var e=t.GetBodyA(),i=t.GetBodyB(),e=e.m_xf,i=i.m_xf,n=e.p,r=i.p,s=t.GetAnchorA(E.DrawJoint_s_p1),o=t.GetAnchorB(E.DrawJoint_s_p2),a=E.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case H.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(s,o,a);break;case H.b2JointType.e_pulleyJoint:var c=t,l=c.GetGroundAnchorA(),c=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,s,a),this.m_debugDraw.DrawSegment(c,o,a),this.m_debugDraw.DrawSegment(l,c,a);break;case H.b2JointType.e_mouseJoint:l=E.DrawJoint_s_c;l.Set(0,1,0),this.m_debugDraw.DrawPoint(s,4,l),this.m_debugDraw.DrawPoint(o,4,l),l.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(s,o,l);break;default:this.m_debugDraw.DrawSegment(n,s,a),this.m_debugDraw.DrawSegment(s,o,a),this.m_debugDraw.DrawSegment(r,o,a)}}},E.prototype.DrawShape=function(t,e){if(null!==this.m_debugDraw){var i=t.GetShape();switch(i.m_type){case H.b2ShapeType.e_circleShape:var n=i.m_p,r=i.m_radius,s=j.UNITX;this.m_debugDraw.DrawSolidCircle(n,r,s,e);break;case H.b2ShapeType.e_edgeShape:var o=i.m_vertex1,a=i.m_vertex2;this.m_debugDraw.DrawSegment(o,a,e);break;case H.b2ShapeType.e_chainShape:var n=i,h=n.m_count,c=n.m_vertices,r=E.DrawShape_s_ghostColor.SetRGBA(.75*e.r,.75*e.g,.75*e.b,e.a),o=c[0];this.m_debugDraw.DrawPoint(o,4,e),n.m_hasPrevVertex&&(s=n.m_prevVertex,this.m_debugDraw.DrawSegment(s,o,r),this.m_debugDraw.DrawCircle(s,.1,r));for(var l=1;l<h;++l){a=c[l];this.m_debugDraw.DrawSegment(o,a,e),this.m_debugDraw.DrawPoint(a,4,e),o=a}n.m_hasNextVertex&&(s=n.m_nextVertex,this.m_debugDraw.DrawSegment(s,o,r),this.m_debugDraw.DrawCircle(s,.1,r));break;case H.b2ShapeType.e_polygonShape:n=i.m_count,c=i.m_vertices;this.m_debugDraw.DrawSolidPolygon(c,n,e)}}},E.prototype.Solve=function(h){for(var t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(var u=this.m_controllerList;u;u=u.m_next)u.Step(h);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(var _=this.m_contactManager.m_contactList;_;_=_.m_next)_.m_islandFlag=!1;for(var d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;for(var i=this.s_stack,n=this.m_bodyList;n;n=n.m_next)if(!n.m_islandFlag&&n.IsAwake()&&n.IsActive()&&n.GetType()!==H.b2BodyType.b2_staticBody){e.Clear();var r=0;for((i[r++]=n).m_islandFlag=!0;0<r;){if(!(t=i[--r]))throw new Error;if(e.AddBody(t),t.m_awakeFlag=!0,t.GetType()!==H.b2BodyType.b2_staticBody){for(var s=t.m_contactList;s;s=s.next){var o=s.contact;if(!o.m_islandFlag&&(o.IsEnabled()&&o.IsTouching())){var f=o.m_fixtureA.m_isSensor,p=o.m_fixtureB.m_isSensor;if(!f&&!p){if(e.AddContact(o),o.m_islandFlag=!0,!(a=s.other))throw new Error;a.m_islandFlag||((i[r++]=a).m_islandFlag=!0)}}}for(var a,c=t.m_jointList;c;c=c.next)c.joint.m_islandFlag||(a=c.other).IsActive()&&(e.AddJoint(c.joint),c.joint.m_islandFlag=!0,a.m_islandFlag||((i[r++]=a).m_islandFlag=!0))}}var m=new fs;e.Solve(m,h,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=m.solveInit,this.m_profile.solveVelocity+=m.solveVelocity,this.m_profile.solvePosition+=m.solvePosition;for(var l=0;l<e.m_bodyCount;++l)(t=e.m_bodies[l]).GetType()===H.b2BodyType.b2_staticBody&&(t.m_islandFlag=!1)}for(l=0;l<i.length&&i[l];++l)i[l]=null;for(var y=new nt,t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&t.GetType()!==H.b2BodyType.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=y.GetMilliseconds()},E.prototype.SolveTOI=function(h){var t=this.m_island;if(t.Initialize(64,32,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var u=this.m_bodyList;u;u=u.m_next)u.m_islandFlag=!1,u.m_sweep.alpha0=0;for(var e=this.m_contactManager.m_contactList;e;e=e.m_next)e.m_toiFlag=!1,e.m_islandFlag=!1,e.m_toiCount=0,e.m_toi=1}for(;;){for(var i=null,_=1,e=this.m_contactManager.m_contactList;e;e=e.m_next)if(e.IsEnabled()&&!(8<e.m_toiCount)){var d=1;if(e.m_toiFlag)d=e.m_toi;else{var f=e.GetFixtureA(),p=e.GetFixtureB();if(f.IsSensor()||p.IsSensor())continue;var n=f.GetBody(),m=p.GetBody(),r=n.m_type,y=m.m_type,g=n.IsAwake()&&r!==H.b2BodyType.b2_staticBody,s=m.IsAwake()&&y!==H.b2BodyType.b2_staticBody;if(!g&&!s)continue;g=n.IsBullet()||r!==H.b2BodyType.b2_dynamicBody,s=m.IsBullet()||y!==H.b2BodyType.b2_dynamicBody;if(!g&&!s)continue;r=n.m_sweep.alpha0,y=(n.m_sweep.alpha0<m.m_sweep.alpha0?(r=m.m_sweep.alpha0,n.m_sweep.Advance(r)):m.m_sweep.alpha0<n.m_sweep.alpha0&&(r=n.m_sweep.alpha0,m.m_sweep.Advance(r)),e.GetChildIndexA()),g=e.GetChildIndexB(),s=E.SolveTOI_s_toi_input,f=(s.proxyA.SetShape(f.GetShape(),y),s.proxyB.SetShape(p.GetShape(),g),s.sweepA.Copy(n.m_sweep),s.sweepB.Copy(m.m_sweep),s.tMax=1,E.SolveTOI_s_toi_output),y=(ze(f,s),f.t),d=f.state===H.b2TOIOutputState.e_touching?V(r+(1-r)*y,1):1;e.m_toi=d,e.m_toiFlag=!0}d<_&&(i=e,_=d)}if(null===i||1-10*M<_){this.m_stepComplete=!0;break}var v=i.GetFixtureA(),x=i.GetFixtureB(),o=v.GetBody(),a=x.GetBody(),v=E.SolveTOI_s_backup1.Copy(o.m_sweep),x=E.SolveTOI_s_backup2.Copy(a.m_sweep);if(o.Advance(_),a.Advance(_),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,i.IsEnabled()&&i.IsTouching()){o.SetAwake(!0),a.SetAwake(!0),t.Clear(),t.AddBody(o),t.AddBody(a),t.AddContact(i),o.m_islandFlag=!0,a.m_islandFlag=!0,i.m_islandFlag=!0;for(var b=0;b<2;++b)if((w=0===b?o:a).m_type===H.b2BodyType.b2_dynamicBody)for(var c=w.m_contactList;c&&t.m_bodyCount!==t.m_bodyCapacity&&t.m_contactCount!==t.m_contactCapacity;c=c.next){var l,A,C,S=c.contact;S.m_islandFlag||((l=c.other).m_type!==H.b2BodyType.b2_dynamicBody||w.IsBullet()||l.IsBullet())&&(C=S.m_fixtureA.m_isSensor,A=S.m_fixtureB.m_isSensor,C||A||(C=E.SolveTOI_s_backup.Copy(l.m_sweep),l.m_islandFlag||l.Advance(_),S.Update(this.m_contactManager.m_contactListener),S.IsEnabled()&&S.IsTouching()?(S.m_islandFlag=!0,t.AddContact(S),l.m_islandFlag||(l.m_islandFlag=!0,l.m_type!==H.b2BodyType.b2_staticBody&&l.SetAwake(!0),t.AddBody(l))):(l.m_sweep.Copy(C),l.SynchronizeTransform())))}var T=E.SolveTOI_s_subStep;T.dt=(1-_)*h.dt,T.inv_dt=1/T.dt,T.dtRatio=1,T.positionIterations=20,T.velocityIterations=h.velocityIterations,T.particleIterations=h.particleIterations,T.warmStarting=!1,t.SolveTOI(T,o.m_islandIndex,a.m_islandIndex);for(var w,b=0;b<t.m_bodyCount;++b)if((w=t.m_bodies[b]).m_islandFlag=!1,w.m_type===H.b2BodyType.b2_dynamicBody){w.SynchronizeFixtures();for(c=w.m_contactList;c;c=c.next)c.contact.m_toiFlag=!1,c.contact.m_islandFlag=!1}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else i.SetEnabled(!1),o.m_sweep.Copy(v),a.m_sweep.Copy(x),o.SynchronizeTransform(),a.SynchronizeTransform()}},E.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t},E.prototype.RemoveController=function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t},E.Step_s_step=new ms,E.Step_s_stepTimer=new nt,E.Step_s_timer=new nt,E.DrawDebugData_s_color=new $(0,0,0),E.DrawDebugData_s_vs=j.MakeArray(4),E.DrawDebugData_s_xf=new R,E.QueryFixtureShape_s_aabb=new re,E.RayCast_s_input=new te,E.RayCast_s_output=new ie,E.RayCast_s_point=new j,E.DrawJoint_s_p1=new j,E.DrawJoint_s_p2=new j,E.DrawJoint_s_color=new $(.5,.8,.8),E.DrawJoint_s_c=new $,E.DrawShape_s_ghostColor=new $,E.SolveTOI_s_subStep=new ms,E.SolveTOI_s_backup=new K,E.SolveTOI_s_backup1=new K,E.SolveTOI_s_backup2=new K,E.SolveTOI_s_toi_input=new Me,E.SolveTOI_s_toi_output=new Ie;Ys=E;function E(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new _s,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new j,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new fs,this.m_island=new Ls,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}var mo=function(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e},yo=(go.prototype.GetNext=function(){return this.m_next},go.prototype.GetPrev=function(){return this.m_prev},go.prototype.GetBodyList=function(){return this.m_bodyList},go.prototype.AddBody=function(t){var e=new mo(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount},go.prototype.RemoveBody=function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount},go.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},go);function go(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}Fi(bo,vo=yo),bo.prototype.Step=function(h){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(e.IsAwake()){for(var i,n=new j,r=new j,s=0,o=0,a=e.GetFixtureList();a;a=a.m_next){var u,c=new j,l=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),c);s+=l,n.x+=l*c.x,n.y+=l*c.y;o+=l*(u=this.useDensity?a.GetDensity():1),r.x+=l*c.x*u,r.y+=l*c.y*u}n.x/=s,n.y/=s,r.x/=o,r.y/=o,s<M||((i=this.gravity.Clone().SelfNeg()).SelfMul(this.density*s),e.ApplyForce(i,r),(i=e.GetLinearVelocityFromWorldPoint(n,new j)).SelfSub(this.velocity),i.SelfMul(-this.linearDrag*s),e.ApplyForce(i,n),e.ApplyTorque(-e.GetInertia()/e.GetMass()*s*e.GetAngularVelocity()*this.angularDrag))}}}},bo.prototype.Draw=function(t){var e=new j,i=new j,n=(e.x=this.normal.x*this.offset+100*this.normal.y,e.y=this.normal.y*this.offset-100*this.normal.x,i.x=this.normal.x*this.offset-100*this.normal.y,i.y=this.normal.y*this.offset+100*this.normal.x,new $(0,0,.8));t.DrawSegment(e,i,n)};var vo,xo=bo;function bo(){var t=null!==vo&&vo.apply(this,arguments)||this;return t.normal=new j(0,1),t.offset=0,t.density=0,t.velocity=new j(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new j(0,0),t}Fi(So,Ao=yo),So.prototype.Step=function(t){for(var e=j.MulSV(t.dt,this.A,So.Step_s_dtA),i=this.m_bodyList;i;i=i.nextBody){var n=i.body;n.IsAwake()&&n.SetLinearVelocity(j.AddVV(n.GetLinearVelocity(),e,j.s_t0))}},So.prototype.Draw=function(t){},So.Step_s_dtA=new j;var Ao,Co=So;function So(){var t=null!==Ao&&Ao.apply(this,arguments)||this;return t.A=new j(0,0),t}Fi(Eo,To=yo),Eo.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}},Eo.prototype.Draw=function(t){};var To,wo=Eo;function Eo(){var t=null!==To&&To.apply(this,arguments)||this;return t.F=new j(0,0),t}Fi(Bo,Mo=yo),Bo.prototype.Step=function(h){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody)for(var e=(r=t.body).GetWorldCenter(),u=r.GetMass(),i=this.m_bodyList;i&&i!==t;i=i.nextBody){var n=(s=i.body).GetWorldCenter(),_=s.GetMass();(c=(o=n.x-e.x)*o+(a=n.y-e.y)*a)<M||((l=Bo.Step_s_f.Set(o,a)).SelfMul(this.G/c/Y(c)*u*_),r.IsAwake()&&r.ApplyForce(l,e),s.IsAwake()&&s.ApplyForce(l.SelfMul(-1),n))}else for(t=this.m_bodyList;t;t=t.nextBody)for(var r,e=(r=t.body).GetWorldCenter(),u=r.GetMass(),i=this.m_bodyList;i&&i!==t;i=i.nextBody){var s,o,a,c,l,n=(s=i.body).GetWorldCenter(),_=s.GetMass();(c=(o=n.x-e.x)*o+(a=n.y-e.y)*a)<M||((l=Bo.Step_s_f.Set(o,a)).SelfMul(this.G/c*u*_),r.IsAwake()&&r.ApplyForce(l,e),s.IsAwake()&&s.ApplyForce(l.SelfMul(-1),n))}},Bo.prototype.Draw=function(t){},Bo.Step_s_f=new j;var Mo,Io=Bo;function Bo(){var t=null!==Mo&&Mo.apply(this,arguments)||this;return t.G=1,t.invSqr=!0,t}Fi(Do,Ro=yo),Do.prototype.Step=function(t){var e=t.dt;if(!(e<=M)){e>this.maxTimestep&&0<this.maxTimestep&&(e=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var n,r=i.body;r.IsAwake()&&(n=r.GetWorldVector(z.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity(),j.s_t0),j.s_t1),Do.Step_s_damping),r.SetLinearVelocity(j.AddVV(r.GetLinearVelocity(),j.MulSV(e,n,j.s_t0),j.s_t1)))}}},Do.prototype.Draw=function(t){},Do.prototype.SetAxisAligned=function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=0<t||0<e?1/O(t,e):0},Do.Step_s_damping=new j;var Ro,Po=Do;function Do(){var t=null!==Ro&&Ro.apply(this,arguments)||this;return t.T=new z,t.maxTimestep=0,t}function Lo(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new j(0,0),this.damping=.1,this.k2=.9,this.k3=.1}Oo.prototype.GetVertexCount=function(){return this.m_count},Oo.prototype.GetVertices=function(){return this.m_ps},Oo.prototype.Initialize=function(t){this.m_count=t.count,this.m_ps=j.MakeArray(this.m_count),this.m_p0s=j.MakeArray(this.m_count),this.m_vs=j.MakeArray(this.m_count),this.m_ims=h(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=0<i?1/i:0}var n=this.m_count-1,r=this.m_count-2;this.m_Ls=h(n),this.m_as=h(r);for(e=0;e<n;++e){var s=this.m_ps[e],o=this.m_ps[e+1];this.m_Ls[e]=j.DistanceVV(s,o)}for(e=0;e<r;++e){var s=this.m_ps[e],o=this.m_ps[e+1],a=this.m_ps[e+2],c=j.SubVV(o,s,j.s_t0),a=j.SubVV(a,o,j.s_t1),l=j.CrossVV(c,a),c=j.DotVV(c,a);this.m_as[e]=C(l,c)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},Oo.prototype.Step=function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Copy(this.m_ps[n]),0<this.m_ims[n]&&this.m_vs[n].SelfMulAdd(t,this.m_gravity),this.m_vs[n].SelfMul(i),this.m_ps[n].SelfMulAdd(t,this.m_vs[n]);for(n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var r=1/t,n=0;n<this.m_count;++n)j.MulSV(r,j.SubVV(this.m_ps[n],this.m_p0s[n],j.s_t0),this.m_vs[n])}},Oo.prototype.SolveC2=function(){for(var t=this.m_count-1,e=0;e<t;++e){var i,n=this.m_ps[e],r=this.m_ps[e+1],s=j.SubVV(r,n,Oo.s_d),o=s.Normalize(),a=this.m_ims[e],c=this.m_ims[e+1];a+c!==0&&(i=c/(a+c),n.SelfMulSub(this.m_k2*(a/(a+c))*(this.m_Ls[e]-o),s),r.SelfMulAdd(this.m_k2*i*(this.m_Ls[e]-o),s))}},Oo.prototype.SetAngle=function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t},Oo.prototype.SolveC3=function(){for(var h=this.m_count-2,t=0;t<h;++t){var u=this.m_ps[t],e=this.m_ps[t+1],_=this.m_ps[t+2],d=this.m_ims[t],f=this.m_ims[t+1],p=this.m_ims[t+2],i=j.SubVV(e,u,Oo.s_d1),n=j.SubVV(_,e,Oo.s_d2),r=i.LengthSquared(),s=n.LengthSquared();if(r*s!=0){var o=j.CrossVV(i,n),a=j.DotVV(i,n),c=C(o,a),o=j.MulSV(-1/r,i.SelfSkew(),Oo.s_Jd1),a=j.MulSV(1/s,n.SelfSkew(),Oo.s_Jd2),r=j.NegV(o,Oo.s_J1),i=j.SubVV(o,a,Oo.s_J2),s=a;if(0!=(n=d*j.DotVV(r,r)+f*j.DotVV(i,i)+p*j.DotVV(s,s))){for(var n=1/n,l=c-this.m_as[t];m<l;)l=(c-=2*m)-this.m_as[t];for(;l<-m;)l=(c+=2*m)-this.m_as[t];o=-this.m_k3*n*l;u.SelfMulAdd(d*o,r),e.SelfMulAdd(f*o,i),_.SelfMulAdd(p*o,s)}}}},Oo.prototype.Draw=function(t){for(var e=new $(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)},Oo.s_d=new j,Oo.s_d1=new j,Oo.s_d2=new j,Oo.s_Jd1=new j,Oo.s_Jd2=new j,Oo.s_J1=new j,Oo.s_J2=new j;var Vo=Oo;function Oo(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new j,this.m_damping=0,this.m_k2=1,this.m_k3=.1}H.b2Assert=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!t)throw new(Error.bind.apply(Error,[void 0].concat(e)))},H.b2Maybe=f,H.b2_maxFloat=P,H.b2_epsilon=M,H.b2_epsilon_sq=g,H.b2_pi=m,H.b2_maxManifoldPoints=2,H.b2_maxPolygonVertices=8,H.b2_aabbExtension=.1,H.b2_aabbMultiplier=2,H.b2_linearSlop=I,H.b2_angularSlop=D,H.b2_polygonRadius=.016,H.b2_maxSubSteps=8,H.b2_maxTOIContacts=32,H.b2_velocityThreshold=1,H.b2_maxLinearCorrection=.2,H.b2_maxAngularCorrection=p,H.b2_maxTranslation=2,H.b2_maxTranslationSquared=4,H.b2_maxRotation=T,H.b2_maxRotationSquared=w,H.b2_baumgarte=.2,H.b2_toiBaumgarte=.75,H.b2_invalidParticleIndex=-1,H.b2_maxParticleIndex=2147483647,H.b2_particleStride=.75,H.b2_minParticleWeight=1,H.b2_maxParticlePressure=.25,H.b2_maxParticleForce=.5,H.b2_maxTriadDistance=2,H.b2_maxTriadDistanceSquared=4,H.b2_minParticleSystemBufferCapacity=256,H.b2_barrierCollisionTime=2.5,H.b2_timeToSleep=.5,H.b2_linearSleepTolerance=.01,H.b2_angularSleepTolerance=t,H.b2Alloc=function(t){return null},H.b2Free=function(t){},H.b2Log=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},H.b2Version=i,H.b2_version=s,H.b2_branch="master",H.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf",H.b2ParseInt=function(t){return parseInt(t,10)},H.b2ParseUInt=function(t){return Math.abs(parseInt(t,10))},H.b2MakeArray=c,H.b2MakeNullArray=function(t){for(var e=[],i=0;i<t;++i)e.push(null);return e},H.b2MakeNumberArray=h,H.b2_pi_over_180=o,H.b2_180_over_pi=a,H.b2_two_pi=l,H.b2Abs=L,H.b2Min=V,H.b2Max=O,H.b2Clamp=F,H.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},H.b2IsValid=u,H.b2Sq=_,H.b2InvSqrt=A,H.b2Sqrt=Y,H.b2Pow=d,H.b2DegToRad=function(t){return t*o},H.b2RadToDeg=function(t){return t*a},H.b2Cos=y,H.b2Sin=v,H.b2Acos=x,H.b2Asin=b,H.b2Atan2=C,H.b2NextPowerOfTwo=function(t){return(t=(t=(t=(t=(t|=t>>1&2147483647)|t>>2&1073741823)|t>>4&268435455)|t>>8&16777215)|t>>16&65535)+1},H.b2IsPowerOfTwo=function(t){return 0<t&&0==(t&t-1)},H.b2Random=function(){return 2*Math.random()-1},H.b2RandomRange=function(t,e){return(e-t)*Math.random()+t},H.b2Vec2=j,H.b2Vec2_zero=N,H.b2Vec3=k,H.b2Mat22=z,H.b2Mat33=W,H.b2Rot=B,H.b2Transform=R,H.b2Sweep=K,H.b2Color=$,H.b2Draw=et,H.b2Timer=nt,H.b2Counter=st,H.b2GrowableStack=at,H.b2BlockAllocator=lt,H.b2StackAllocator=ht,H.b2ContactFeature=Ut,H.b2ContactID=Ht,H.b2ManifoldPoint=Xt,H.b2Manifold=qt,H.b2WorldManifold=Zt,H.b2GetPointStates=function(t,e,i,n){for(var r=0;r<i.pointCount;++r){var s=i.points[r].id.key;t[r]=H.b2PointState.b2_removeState;for(var o=0,a=n.pointCount;o<a;++o)if(n.points[o].id.key===s){t[r]=H.b2PointState.b2_persistState;break}}for(;r<2;++r)t[r]=H.b2PointState.b2_nullState;for(r=0;r<n.pointCount;++r){s=n.points[r].id.key;e[r]=H.b2PointState.b2_addState;for(o=0,a=i.pointCount;o<a;++o)if(i.points[o].id.key===s){e[r]=H.b2PointState.b2_persistState;break}}for(;r<2;++r)e[r]=H.b2PointState.b2_nullState},H.b2ClipVertex=Qt,H.b2RayCastInput=te,H.b2RayCastOutput=ie,H.b2AABB=re,H.b2TestOverlapAABB=oe,H.b2ClipSegmentToLine=ae,H.b2TestOverlapShape=ue,H.b2DistanceProxy=ut,H.b2SimplexCache=dt,H.b2DistanceInput=pt,H.b2DistanceOutput=yt,H.b2ShapeCastInput=vt,H.b2ShapeCastOutput=xt,H.b2_gjk_reset=function(){H.b2_gjkCalls=0,H.b2_gjkIters=0,H.b2_gjkMaxIters=0},H.b2SimplexVertex=bt,H.b2Simplex=Ct,H.b2Distance=Dt,H.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();for(var i=e.proxyA,n=e.proxyB,h=O(i.m_radius,.016)+O(n.m_radius,.016),r=e.transformA,s=e.transformB,o=e.translationB,u=Lt.Set(0,0),_=0,a=Vt,d=(a.m_count=0,a.m_vertices),f=i.GetSupport(B.MulTRV(r.q,j.NegV(o,j.s_t1),j.s_t0)),p=R.MulXV(r,i.GetVertex(f),Ot),m=n.GetSupport(B.MulTRV(s.q,o,j.s_t0)),y=R.MulXV(s,n.GetVertex(m),Ft),c=j.SubVV(p,y,Nt),g=O(.016,h-.016),v=0;v<20&&.004<L(c.Length()-g);){t.iterations+=1;var f=i.GetSupport(B.MulTRV(r.q,j.NegV(c,j.s_t1),j.s_t0)),p=R.MulXV(r,i.GetVertex(f),Ot),m=n.GetSupport(B.MulTRV(s.q,c,j.s_t0)),y=R.MulXV(s,n.GetVertex(m),Ft),l=j.SubVV(p,y,kt),l=(c.Normalize(),j.DotVV(c,l)),x=j.DotVV(c,o);if(_*x<l-g){if(x<=0)return!1;if(1<(_=(l-g)/x))return!1;u.Copy(c).SelfNeg(),a.m_count=0}l=d[a.m_count];switch(l.indexA=m,l.wA.Copy(y).SelfMulAdd(_,o),l.indexB=f,l.wB.Copy(p),l.w.Copy(l.wB).SelfSub(l.wA),l.a=1,a.m_count+=1,a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3()}if(3===a.m_count)return!1;a.GetClosestPoint(c),++v}return a.GetWitnessPoints(Gt,zt),0<c.LengthSquared()&&(u.Copy(c).SelfNeg(),u.Normalize()),t.normal.Copy(u),t.lambda=_,t.iterations=v,!0},H.b2Pair=ye,H.b2BroadPhase=ge,H.b2PairLessThan=xe,H.b2TreeNode=de,H.b2DynamicTree=pe,H.b2_toi_reset=function(){H.b2_toiTime=0,H.b2_toiMaxTime=0,H.b2_toiCalls=0,H.b2_toiIters=0,H.b2_toiMaxIters=0,H.b2_toiRootIters=0,H.b2_toiMaxRootIters=0},H.b2TOIInput=Me,H.b2TOIOutput=Ie,H.b2SeparationFunction=Be,H.b2TimeOfImpact=ze,H.b2CollideCircles=He,H.b2CollidePolygonAndCircle=qe,H.b2CollidePolygons=yi,H.b2CollideEdgeAndCircle=wi,H.b2CollideEdgeAndPolygon=Pi,H.b2MassData=Di,H.b2Shape=Li,H.b2CircleShape=Ei,H.b2PolygonShape=Ii,H.b2EdgeShape=Ui,H.b2ChainShape=ji,H.b2Filter=Yi,H.b2FixtureDef=Ji,H.b2FixtureProxy=Zi,H.b2Fixture=Ki,H.b2BodyDef=$i,H.b2Body=tn,H.b2World=Ys,H.b2DestructionListener=es,H.b2ContactFilter=ns,H.b2ContactImpulse=ss,H.b2ContactListener=os,H.b2QueryCallback=cs,H.b2RayCastCallback=hs,H.b2Island=Ls,H.b2Profile=fs,H.b2TimeStep=ms,H.b2Position=gs,H.b2Velocity=xs,H.b2SolverData=As,H.b2ContactManager=_s,H.b2MixFriction=wr,H.b2MixRestitution=Er,H.b2ContactEdge=Mr,H.b2Contact=Ir,H.b2ContactRegister=Qr,H.b2ContactFactory=$r,H.g_blockSolve=!1,H.b2VelocityConstraintPoint=Cs,H.b2ContactVelocityConstraint=Ts,H.b2ContactPositionConstraint=Es,H.b2ContactSolverDef=Is,H.b2PositionSolverManifold=Bs,H.b2ContactSolver=Ps,H.b2CircleContact=Pr,H.b2PolygonContact=Vr,H.b2PolygonAndCircleContact=Nr,H.b2EdgeAndCircleContact=zr,H.b2EdgeAndPolygonContact=Hr,H.b2ChainAndCircleContact=Yr,H.b2ChainAndPolygonContact=Zr,H.b2Jacobian=en,H.b2JointEdge=sn,H.b2JointDef=rn,H.b2Joint=on,H.b2AreaJointDef=pn,H.b2AreaJoint=gn,H.b2DistanceJointDef=ln,H.b2DistanceJoint=_n,H.b2FrictionJointDef=bn,H.b2FrictionJoint=Sn,H.b2GearJointDef=En,H.b2GearJoint=Bn,H.b2MotorJointDef=Dn,H.b2MotorJoint=On,H.b2MouseJointDef=kn,H.b2MouseJoint=Un,H.b2PrismaticJointDef=jn,H.b2PrismaticJoint=qn,H.b2_minPulleyLength=2,H.b2PulleyJointDef=Kn,H.b2PulleyJoint=tr,H.b2RevoluteJointDef=nr,H.b2RevoluteJoint=or,H.b2RopeJointDef=lr,H.b2RopeJoint=_r,H.b2WeldJointDef=pr,H.b2WeldJoint=gr,H.b2WheelJointDef=br,H.b2WheelJoint=Sr,H.b2ControllerEdge=mo,H.b2Controller=yo,H.b2BuoyancyController=xo,H.b2ConstantAccelController=Co,H.b2ConstantForceController=wo,H.b2GravityController=Io,H.b2TensorDampingController=Po,H.b2ParticleDef=Os,H.b2CalculateParticleIterations=Fs,H.b2ParticleHandle=Ns,H.b2ParticleGroupDef=Gs,H.b2ParticleGroup=zs,H.b2GrowableBuffer=no,H.b2FixtureParticleQueryCallback=oo,H.b2ParticleContact=co,H.b2ParticleBodyContact=ho,H.b2ParticlePair=uo,H.b2ParticleTriad=_o,H.b2ParticleSystemDef=fo,H.b2RopeDef=Lo,H.b2Rope=Vo,Object.defineProperty(H,"__esModule",{value:!0})},"object"==typeof i&&void 0!==e?n(i):"function"==typeof define&&define.amd?define(["exports"],n):n((void 0).box2d={})},{}],363:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;n.cc=n.cc||{},cc.internal=cc.internal||{},t("./predefine"),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/object"),t("./polyfill/array-buffer"),t("./polyfill/number"),t("./polyfill/typescript"),t("./cocos2d/core/predefine"),t("./cocos2d"),t("./extends"),e.exports=n.cc},{"./cocos2d":292,"./cocos2d/core/predefine":214,"./extends":350,"./package":void 0,"./polyfill/array":365,"./polyfill/array-buffer":364,"./polyfill/misc":366,"./polyfill/number":367,"./polyfill/object":368,"./polyfill/string":369,"./polyfill/typescript":370,"./predefine":371}],364:[function(t,e,i){"use strict";var n;ArrayBuffer.isView||(n=Object.getPrototypeOf(Int8Array),ArrayBuffer.isView="function"==typeof n?function(t){return t instanceof n}:function(t){if("object"!=typeof t)return!1;t=t.constructor;return t===Float32Array||t===Uint8Array||t===Uint32Array||t===Int8Array})},{}],365:[function(t,e,i){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.find||(Array.prototype.find=function(t){for(var e=this.length,i=0;i<e;i++){var n=this[i];if(t.call(this,n,i,this))return n}}),Array.prototype.includes||(Array.prototype.includes=function(t){return-1!==this.indexOf(t)})},{}],366:[function(t,e,i){"use strict";var n,r;Math.sign||(Math.sign=function(t){return 0===(t=+t)||isNaN(t)?t:0<t?1:-1}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),console.time||(n=window.performance||Date,r=Object.create(null),console.time=function(t){r[t]=n.now()},console.timeEnd=function(t){var e=r[t],e=n.now()-e;console.log(t+": "+e+"ms")})},{}],367:[function(t,e,i){"use strict";Number.parseFloat=Number.parseFloat||parseFloat,Number.parseInt=Number.parseInt||parseInt},{}],368:[function(t,e,i){"use strict";Object.assign||(Object.assign=function(t,e){return cc.js.mixin(t,e)}),Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(t){var e={},i=Object.getOwnPropertyNames(t);Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t)));for(var n=0;n<i.length;++n){var r=i[n];e[r]=Object.getOwnPropertyDescriptor(t,r)}return e})},{}],369:[function(t,e,i){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.lastIndexOf(t,e=e||0)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;t=this.indexOf(t,e);return-1!==t&&t===e}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")})},{}],370:[function(t,e,i){"use strict";var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};window.__extends=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},window.__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},window.__rest=function(t,e){var i={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&(i[r[n]]=t[r[n]]);return i},window.__decorate=function(t,e,i,n){var r,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(o=(s<3?r(o):3<s?r(e,i,o):r(e,i))||o);return 3<s&&o&&Object.defineProperty(e,i,o),o},window.__param=function(i,n){return function(t,e){n(t,e,i)}},window.__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},window.__awaiter=function(s,o,a,c){return new(a=a||Promise)(function(t,e){function i(t){try{r(c.next(t))}catch(t){e(t)}}function n(t){try{r(c.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,n)}r((c=c.apply(s,o||[])).next())})},window.__generator=function(n,r){var s,o,a,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(s)throw new TypeError("Generator is already executing.");for(;c;)try{if(s=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,o=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){c.label=e[1];break}if(6===e[0]&&c.label<a[1]){c.label=a[1],a=e;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(e);break}a[2]&&c.ops.pop(),c.trys.pop();continue}e=r.call(n,c)}catch(t){e=[6,t],o=0}finally{s=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},window.__exportStar=function(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])},window.__values=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return{value:(t=t&&i>=t.length?void 0:t)&&t[i++],done:!t}}}},window.__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),o=[];try{for(;(void 0===e||0<e--)&&!(n=s.next()).done;)o.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o},window.__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},window.__asyncGenerator=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),s=[],o={};return n("next"),n("throw"),n("return"),o[Symbol.asyncIterator]=function(){return this},o;function n(n){r[n]&&(o[n]=function(i){return new Promise(function(t,e){1<s.push([n,i,t,e])||a(n,i)})})}function a(t,e){try{(i=r[t](e)).value instanceof __await?Promise.resolve(i.value.v).then(c,h):l(s[0][2],i)}catch(t){l(s[0][3],t)}var i}function c(t){a("next",t)}function h(t){a("throw",t)}function l(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}},window.__asyncDelegator=function(n){var r,t={};return e("next"),e("throw",function(t){throw t}),e("return"),t[Symbol.iterator]=function(){return this},t;function e(e,i){t[e]=n[e]?function(t){return(r=!r)?{value:__await(n[e](t)),done:"return"===e}:i?i(t):t}:i}},window.__asyncValues=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=o[Symbol.asyncIterator];return e?e.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=o[s]&&function(r){return new Promise(function(t,e){var i,n;r=o[s](r),i=t,t=e,n=r.done,e=r.value,Promise.resolve(e).then(function(t){i({value:t,done:n})},t)})}}},window.__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},window.__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e},window.__importDefault=function(t){return t&&t.__esModule?t:{default:t}}},{}],371:[function(t,e,i){"use strict";var n="undefined"==typeof window?global:window;function r(e,i){void 0===n[e]&&Object.defineProperty(n,e,{get:function(){var t;return"CC_WECHATGAMESUB"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME_SUB":"CC_WECHATGAME"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME":"CC_QQPLAY"===e&&(t="cc.sys.platform === cc.sys.QQ_PLAY"),cc.warnID(1400,e,t),i}})}function s(t){return"object"==typeof n[t]}a=!(o="CC_BUILD"),void 0===n[o]&&(n[o]=a),n.CC_BUILD=!0,n.CC_DEV=!1,n.CC_DEBUG=!0,n.CC_JSB=!1,n.CC_NATIVERENDERER=!1,n.CC_SUPPORT_JIT=!1,n.CC_PHYSICS_BUILTIN=!1,n.CC_PHYSICS_CANNON=!1,n.CC_EDITOR=!1,n.CC_PREVIEW=!1,n.CC_TEST=!1,n.CC_RUNTIME=!1,n.CC_JSB=!1;var o=!(!s("wx")||!wx.getSharedCanvas),a=!(!s("wx")||!wx.getSystemInfoSync&&!wx.getSharedCanvas),c=s("bk");r("CC_WECHATGAMESUB",o),r("CC_WECHATGAME",a),r("CC_QQPLAY",c);n.CocosEngine=cc.ENGINE_VERSION="2.3.3"},{}]},{},[363]);