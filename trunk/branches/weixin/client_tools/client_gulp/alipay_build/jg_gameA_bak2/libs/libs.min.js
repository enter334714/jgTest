var Laya=window.Laya=function(t,H){var R={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(H,n){return 1==arguments.length?R.__presubstr.call(this,H):R.__presubstr.call(this,H,0<n?n:this.length+n)},__init:function(H){H.forEach(function(H){H.__init$&&H.__init$()})},__isClass:function(H){return H&&(H.__isclass||H==Object||H==String||H==Array)},__newvec:function(H,n){var C=[];C.length=H;for(var r=0;r<H;r++)C[r]=n;return C},__extend:function(H,n){for(var C in n)if(n.hasOwnProperty(C)){var r=Object.getOwnPropertyDescriptor(n,C),N=r.get,Q=r.set;N||Q?N&&Q?Object.defineProperty(H,C,r):(N&&Object.defineProperty(H,C,N),Q&&Object.defineProperty(H,C,Q)):H[C]=n[C]}function I(){R.un(this,"constructor",H)}I.prototype=n.prototype,H.prototype=new I,R.un(H.prototype,"__imps",R.__copy({},n.prototype.__imps))},__copy:function(H,n){if(!n)return null;for(var C in H=H||{},n)H[C]=n[C];return H},__package:function(H,n){if(!R.__packages[H]){R.__packages[H]=!0;var C=t,r=H.split(".");if(1<r.length)for(var N=0,Q=r.length-1;N<Q;N++){var I=C[r[N]];C=I||(C[r[N]]={})}C[r[r.length-1]]||(C[r[r.length-1]]=n||{})}},__hasOwnProperty:function(H,n){return n=n||this,Object.hasOwnProperty.call(n,H)||function H(n,C){if(Object.hasOwnProperty.call(C.prototype,n))return!0;var r=C.prototype.__super;return null==r?null:H(n,r)}(H,n.__class)},__typeof:function(H,n){if(!H||!n)return!1;if(n===String)return"string"==typeof H;if(n===Number)return"number"==typeof H;if(n.__interface__)n=n.__interface__;else if("string"!=typeof n)return H instanceof n;return H.__imps&&H.__imps[n]||H.__class==n},__as:function(H,n){return this.__typeof(H,n)?H:null},__int:function(H){return H?parseInt(H):0},interface:function(H,n){R.__package(H,{});var C=R.__internals,r=C[H]=C[H]||{self:H};if(n){var N=n.split(",");r.extend=[];for(var Q=0;Q<N.length;Q++){var I=N[Q];C[I]=C[I]||{self:I},r.extend.push(C[I])}}var A=t,P=H.split(".");for(Q=0;Q<P.length-1;Q++)A=A[P[Q]];A[P[P.length-1]]={__interface__:H}},class:function(H,n,C,r){if(C&&R.__extend(H,C),n)if(R.__package(n,H),R.__classmap[n]=H,0<n.indexOf(".")){if(0==n.indexOf("laya.")){var N=n.split(".");r=r||N[N.length-1],R[r]&&console.log("Warning!,this class["+r+"] already exist:",R[r]),R[r]=H}}else"Main"==n?t.Main=H:"MainWX"==n?t.MainWX=H:(R[n]&&console.log("Error!,this class["+n+"] already exist:",R[n]),R[n]=H);var Q=R.un,I=H.prototype;Q(I,"hasOwnProperty",R.__hasOwnProperty),Q(I,"__class",H),Q(I,"__super",C),Q(I,"__className",n),Q(H,"__super",C),Q(H,"__className",n),Q(H,"__isclass",!0),Q(H,"super",function(H){this.__super.call(H)})},imps:function(H,n){if(!n)return null;var N=H.__imps||R.un(H,"__imps",{});function Q(H){var n,C;if((n=R.__internals[H])&&(N[H]=!0,C=n.extend))for(var r=0;r<C.length;r++)Q(C[r].self)}for(var C in n)Q(C)},superSet:function(H,n,C,r){var N=H.prototype["_$set_"+C];N&&N.call(n,r)},superGet:function(H,n,C){var r=H.prototype["_$get_"+C];return r?r.call(n):null},getset:function(H,n,C,r,N){H?(r&&(n["_$GET_"+C]=r),N&&(n["_$SET_"+C]=N)):(r&&R.un(n,"_$get_"+C,r),N&&R.un(n,"_$set_"+C,N)),r&&N?Object.defineProperty(n,C,{get:r,set:N,enumerable:!1,configurable:!0}):(r&&Object.defineProperty(n,C,{get:r,enumerable:!1,configurable:!0}),N&&Object.defineProperty(n,C,{set:N,enumerable:!1,configurable:!0}))},static:function(C,r){for(var N=0,H=r.length;N<H;N+=2)if("length"==r[N])C.length=r[N+1].call(C);else{function n(){var n=r[N],H=r[N+1];Object.defineProperty(C,n,{get:function(){return delete this[n],this[n]=H.call(this)},set:function(H){delete this[n],this[n]=H},enumerable:!0,configurable:!0})}n()}},un:function(H,n,C){return C||(C=H[n]),R.__propun.value=C,Object.defineProperty(H,n,R.__propun),C},uns:function(n,H){H.forEach(function(H){R.un(n,H)})}};return t.console=t.console||{log:function(){}},t.trace=t.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),R}(window,document);!function(H,n,C){C.un,C.uns,C.static,C.class,C.getset,C.__newvec}(window,document,Laya),function(g,n,F){F.un,F.uns;var P=F.static,l=F.class,R=F.getset;F.__newvec;F.interface("laya.runtime.IMarket"),F.interface("laya.filters.IFilter"),F.interface("laya.display.ILayout"),F.interface("laya.resource.IDispose"),F.interface("laya.runtime.IPlatform"),F.interface("laya.resource.IDestroy"),F.interface("laya.runtime.IConchNode"),F.interface("laya.filters.IFilterAction"),F.interface("laya.runtime.ICPlatformClass"),F.interface("laya.resource.ICreateResource"),F.interface("laya.runtime.IConchRenderObject"),F.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var b=function(){function Q(){}return l(Q,"laya.utils.RunDriver"),Q.FILTER_ACTIONS=[],Q.pixelRatio=-1,Q._charSizeTestDiv=null,Q.now=function(){return Date.now()},Q.getWindow=function(){return g},Q.getPixelRatio=function(){if(Q.pixelRatio<0){var H=_.context,n=H.backingStorePixelRatio||H.webkitBackingStorePixelRatio||H.mozBackingStorePixelRatio||H.msBackingStorePixelRatio||H.oBackingStorePixelRatio||H.backingStorePixelRatio||1;(Q.pixelRatio=(_.window.devicePixelRatio||1)/n)<1&&(Q.pixelRatio=1)}return Q.pixelRatio},Q.getIncludeStr=function(H){return null},Q.createShaderCondition=function(H){var n="(function() {return "+H+";})";return F._runScript(n)},Q.fontMap=[],Q.measureText=function(H,n){var C=Q.hanzi.test(H);if(C&&Q.fontMap[n])return Q.fontMap[n];var r=_.context;r.font=n;var N=r.measureText(H);return N||(N={width:16,height:16}),C&&(Q.fontMap[n]=N),N},Q.getWebGLContext=function(H){},Q.beginFlush=function(){},Q.endFinish=function(){},Q.addToAtlas=null,Q.flashFlushImage=function(H){},Q.drawToCanvas=function(H,n,C,r,N,Q){var I=KH.create("2D"),A=new q(C,r,I);return p.renders[n]._fun(H,A,N,Q),I},Q.createParticleTemplate2D=null,Q.createGLTextur=null,Q.createWebGLContext2D=null,Q.changeWebGLSize=function(H,n){},Q.createRenderSprite=function(H,n){return new p(H,n)},Q.createFilterAction=function(H){return new I},Q.createGraphics=function(){return new o},Q.clear=function(H){Z._context.ctx.clear()},Q.cancelLoadByUrl=function(H){},Q.clearAtlas=function(H){},Q.isAtlas=function(H){return!1},Q.addTextureToAtlas=function(H){},Q.getTexturePixels=function(H,n,C,r,N){return null},Q.skinAniSprite=function(){return null},Q.update3DLoop=function(){},P(Q,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),Q}(),r=(R(1,F,"alertGlobalError",null,function(H){var Q=0;_.window.onerror=H?function(H,n,C,r,N){Q++<5&&N&&alert(N.stack||N)}:null}),F.init=function(H,n,C){for(var r=[],N=2,Q=arguments.length;N<Q;N++)r.push(arguments[N]);if(!F._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=F._arrayBufferSlice),F._isinit=!0,_.__init__(),m.__init__(),o.__init__(),F.timer=new J,F.scaleTimer=new J,F.loader=new PH,V.__init__(),N=0;for(var I=r.length;N<I;N++)r[N].enable&&r[N].enable();return M.__init__(),A.__init__(),d.__init__(),s.beginCheck(),F._currentStage=F.stage=new fH,F.stage.conchModel&&F.stage.conchModel.setRootNode(),F._getUrlPath(),F.render=new Z(0,0),F.stage.size(H,n),p.__init__(),y.__init__(),j.instance.__init__(F.stage,Z.canvas),zH.__init__(),L.autoStopMusic=!0,a.__init__(),Z.canvas}},F._getUrlPath=function(){var H=_.window.location,n=H.pathname;n=n&&":"==n.charAt(2)?n.substring(1):n,e.rootPath=e.basePath=e.getPath("file:"==H.protocol?n:H.protocol+"//"+H.host+H.pathname)},F._arrayBufferSlice=function(H,n){var C=new Uint8Array(this,H,n-H),r=new Uint8Array(C.length);return r.set(C),r.buffer},F._runScript=function(H){return _.window[F._evcode](H)},F.stage=null,F.timer=null,F.scaleTimer=null,F.loader=null,F.version="1.8.6",F.render=null,F._currentStage=null,F._isinit=!1,F.isDebug=!1,F.MiniAdpter={init:function(){g.navigator&&g.navigator.userAgent&&-1<g.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},P(F,["conchMarket",function(){return this.conchMarket=g.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=g.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function H(){}return l(H,"Config"),H.WebGLTextCacheCount=500,H.atlasEnable=!1,H.showCanvasMark=!1,H.animationInterval=50,H.isAntialias=!1,H.isAlpha=!1,H.premultipliedAlpha=!0,H.isStencil=!0,H.preserveDrawingBuffer=!1,H}()),t=function(){function t(){this._events=null}l(t,"laya.events.EventDispatcher");var H=t.prototype;return H.hasListener=function(H){return!!(this._events&&this._events[H])},H.getListener=function(H){return this._events?this._events[H]:null},H.event=function(H,n){if(!this._events||!this._events[H])return!1;var C=this._events[H];if(C.lock)C.queue||(C.queue=[]),C.queue.push(n);else{var r;for(C.lock=!0,C.cursor=C.head;C.cursor;)(r=C.cursor).recover?(C.head=C.tail=C.cursor=null,console.error("node is recover："+r.id)):(C.cursor=r.next,r.once&&t.delNode(C,r),r.method&&(null!=n?r.args?r.method.apply(r.caller,r.args.concat(n)):n instanceof Array?r.method.apply(r.caller,n):r.caller?r.method.call(r.caller,n):F.recordError("事件派发错误","node.caller:"+r.caller+"node.method:"+r.method+"data:"+n+"node.prev"+r.prev):r.method.apply(r.caller,r.args)),r.once&&t.recoverHandler(r));C.lock=!1,!C.head&&this._events&&this._events[H]==C&&delete this._events[H],C.queue&&C.queue.length&&this.event(H,C.queue.shift())}return!0},H.on=function(H,n,C,r){return this._createListener(H,n,C,r,!1)},H.once=function(H,n,C,r){return this._createListener(H,n,C,r,!0)},H._createListener=function(H,n,C,r,N,Q){void 0===Q&&(Q=!0),Q&&this.off(H,n,C,N);var I=t.createHandler(n||this,C,r,N);this._events||(this._events={});var A=this._events,P=A[H];return P?P.tail?(I.prev=P.tail,P.tail.next=I,P.tail=I):P.head=P.tail=I:A[H]={head:I,tail:I,cursor:null,lock:!1},this},H.off=function(H,n,C,r){if(void 0===r&&(r=!1),!this._events||!this._events[H])return this;for(var N=this._events[H],Q=N.head;Q;){if((!n||Q.caller===n)&&Q.method===C&&(!r||Q.once)){t.delNode(N,Q),N.cursor==Q&&(N.cursor=Q.next),t.recoverHandler(Q);break}Q=Q.next}return this},H.offAll=function(H){var n=this._events;if(!n)return this;if(H)this._recoverHandlers(n[H]),delete n[H];else{for(var C in n)this._recoverHandlers(n[C]);this._events=null}return this},H._recoverHandlers=function(H){if(H){for(var n=H.head;n;){t.delNode(H,n);var C=n.next;t.recoverHandler(n),n=C}H.cursor=null}},H.isMouseEvent=function(H){return t.MOUSE_EVENTS[H]},t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},t.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},t.delNode=function(H,n){n.prev?n.prev.next=n.next:H.head=n.next,n.next?n.next.prev=n.prev:H.tail=n.prev},t.createHandler=function(H,n,C,r){var N=500<t._freeHandler.length?t._freeHandler.shift():null;if(N)if(N.recover)N.recover=!1,N.caller=H,N.method=n,N.args=C,N.once=r;else{var Q="";try{arguments.propertyIsEnumerable.caller}catch(H){Q=H.stack}var I=N.caller?(N.caller.__proto__&&N.caller.__proto__.constructor&&N.caller.__proto__.constructor.name)+"|"+N.caller.__className+"|"+N.caller.name:"",A=N.method?N.method.name:"";F.recordError("EventDispatcher重复创建","caller="+I+"  method="+A+"  stack="+Q),N={id:++t._nodeCount,caller:H,method:n,args:C,once:r,recover:!1}}else N={id:++t._nodeCount,caller:H,method:n,args:C,once:r,recover:!1};return N.prev=N.next=null,N},t.recoverHandler=function(H){if(H.recover){if(t._errorCount<5){t._errorCount++;var n="";try{arguments.propertyIsEnumerable.caller}catch(H){n=H.stack}var C=H.caller?(H.caller.__proto__&&H.caller.__proto__.constructor&&H.caller.__proto__.constructor.name)+"|"+H.caller.__className+"|"+H.caller.name:"",r=H.method?H.method.name:"";F.recordError("EventDispatcher重复回收","id="+H.id+"  caller="+C+"  method="+r+"  stack="+n)}H.caller=H.method=H.args=H.prev=null}else H.recover=!0,H.caller=H.method=H.args=H.prev=H.next=null,t._freeHandler&&t._freeHandler.length<3e3&&t._freeHandler.push(H)},t._freeHandler=[],t._nodeCount=0,t._errorCount=0,t}(),c=function(){function N(H,n,C,r){this.once=!1,void(this._id=0)===r&&(r=!1),this.setTo(H,n,C,r)}l(N,"laya.utils.Handler");var H=N.prototype;return H.setTo=function(H,n,C,r){return this._id=N._gid++,this.caller=H,this.method=n,this.args=C,this.once=r,this},H.run=function(){if(null==this.method)return null;var H=this._id,n=this.method.apply(this.caller,this.args);return this._id===H&&this.once&&this.recover(),n},H.runWith=function(H){if(null==this.method)return null;var n=this._id;if(null==H)var C=this.method.apply(this.caller,this.args);else C=this.args||H.unshift?this.args?this.method.apply(this.caller,this.args.concat(H)):this.method.apply(this.caller,H):this.method.call(this.caller,H);return this._id===n&&this.once&&this.recover(),C},H.clear=function(){return this.caller=null,this.method=null,this.args=null,this},H.recover=function(){0<this._id&&(this._id=0,this.clear())},N.create=function(H,n,C,r){return void 0===r&&(r=!0),new N(H,n,C,r)},N._gid=1,N}(),D=function(){function H(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}l(H,"laya.display.BitmapFont");var n=H.prototype;return n.loadFont=function(H,n){this._path=H,this._complete=n,F.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],c.create(this,this.onLoaded))},n.onLoaded=function(){this.parseFont(AH.getRes(this._path),AH.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},n.parseFont=function(H,n){if(null!=H&&null!=n){this._texture=n;var C=H.getElementsByTagName("info");if(!C[0].getAttributeNode)return this.parseFont2(H,n);this.fontSize=parseInt(C[0].getAttributeNode("size").nodeValue);var r,N=C[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(N[0]),parseInt(N[1]),parseInt(N[2]),parseInt(N[3])],r=H.getElementsByTagName("char");var Q=0;for(Q=0;Q<r.length;Q++){var I=r[Q],A=parseInt(I.getAttributeNode("id").nodeValue),P=parseInt(I.getAttributeNode("xoffset").nodeValue)/1,t=parseInt(I.getAttributeNode("yoffset").nodeValue)/1,R=parseInt(I.getAttributeNode("xadvance").nodeValue)/1,y=new i;y.x=parseInt(I.getAttributeNode("x").nodeValue),y.y=parseInt(I.getAttributeNode("y").nodeValue),y.width=parseInt(I.getAttributeNode("width").nodeValue),y.height=parseInt(I.getAttributeNode("height").nodeValue);var o=RH.create(n,y.x,y.y,y.width,y.height,P,t);this._maxWidth=Math.max(this._maxWidth,R+this.letterSpacing),this._fontCharDic[A]=o,this._fontWidthMap[A]=R}}},n.parseFont2=function(H,n){if(null!=H&&null!=n){this._texture=n;var C=H.getElementsByTagName("info");this.fontSize=parseInt(C[0].attributes.size.nodeValue);var r=C[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];var N=H.getElementsByTagName("char"),Q=0;for(Q=0;Q<N.length;Q++){var I=N[Q].attributes,A=parseInt(I.id.nodeValue),P=parseInt(I.xoffset.nodeValue)/1,t=parseInt(I.yoffset.nodeValue)/1,R=parseInt(I.xadvance.nodeValue)/1,y=new i;y.x=parseInt(I.x.nodeValue),y.y=parseInt(I.y.nodeValue),y.width=parseInt(I.width.nodeValue),y.height=parseInt(I.height.nodeValue);var o=RH.create(n,y.x,y.y,y.width,y.height,P,t);this._maxWidth=Math.max(this._maxWidth,R+this.letterSpacing),this._fontCharDic[A]=o,this._fontWidthMap[A]=R}}},n.getCharTexture=function(H){return this._fontCharDic[H.charCodeAt(0)]},n.destroy=function(){if(this._texture){for(var H in this._fontCharDic){var n=this._fontCharDic[H];n&&n.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},n.setSpaceWidth=function(H){this._spaceWidth=H},n.getCharWidth=function(H){var n=H.charCodeAt(0);return this._fontWidthMap[n]?this._fontWidthMap[n]+this.letterSpacing:" "==H?this._spaceWidth+this.letterSpacing:0},n.getTextWidth=function(H){for(var n=0,C=0,r=H.length;C<r;C++)n+=this.getCharWidth(H.charAt(C));return n},n.getMaxWidth=function(){return this._maxWidth},n.getMaxHeight=function(){return this.fontSize},n.drawText=function(H,n,C,r,N,Q){var I,A=this.getTextWidth(H),P=0;"center"===N&&(P=(Q-A)/2),"right"===N&&(P=Q-A);for(var t=0,R=0,y=H.length;R<y;R++)(I=this.getCharTexture(H.charAt(R)))&&(n.graphics.drawTexture(I,C+t+P,r),t+=this.getCharWidth(H.charAt(R)))},H}(),A=function(){function C(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=C._TF_EMPTY}l(C,"laya.display.css.Style");var H=C.prototype;return H.getTransform=function(){return this._tf},H.setTransform=function(H){this._tf="none"!==H&&H?H:C._TF_EMPTY},H.setTranslateX=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.translateX=H},H.setTranslateY=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.translateY=H},H.setScaleX=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.scaleX=H},H.setScale=function(H,n){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.scaleX=H,this._tf.scaleY=n},H.setScaleY=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.scaleY=H},H.setRotate=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.rotate=H},H.setSkewX=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.skewX=H},H.setSkewY=function(H){this._tf===C._TF_EMPTY&&(this._tf=new N),this._tf.skewY=H},H.destroy=function(){this.scrollRect=null},H.render=function(H,n,C,r){},H.getCSSStyle=function(){return nH.EMPTY},H._enableLayout=function(){return!1},R(0,H,"scaleX",function(){return this._tf.scaleX},function(H){this.setScaleX(H)}),R(0,H,"transform",function(){return this.getTransform()},function(H){this.setTransform(H)}),R(0,H,"translateX",function(){return this._tf.translateX},function(H){this.setTranslateX(H)}),R(0,H,"translateY",function(){return this._tf.translateY},function(H){this.setTranslateY(H)}),R(0,H,"scaleY",function(){return this._tf.scaleY},function(H){this.setScaleY(H)}),R(0,H,"block",function(){return 0!=(1&this._type)}),R(0,H,"skewY",function(){return this._tf.skewY},function(H){this.setSkewY(H)}),R(0,H,"rotate",function(){return this._tf.rotate},function(H){this.setRotate(H)}),R(0,H,"skewX",function(){return this._tf.skewX},function(H){this.setSkewX(H)}),R(0,H,"paddingLeft",function(){return 0}),R(0,H,"paddingTop",function(){return 0}),R(0,H,"absolute",function(){return!0}),C.__init__=function(){C._TF_EMPTY=new N,C.EMPTY=new C},C.EMPTY=null,C._TF_EMPTY=null,C}(),M=function(){function n(H){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=x.create(n.defaultColor),this.family=n.defaultFamily,this.stroke=n._STROKE,this.size=n.defaultSize,H&&H!==n.EMPTY&&H.copyTo(this)}l(n,"laya.display.css.Font");var H=n.prototype;return H.set=function(H){this._text=null;for(var n=H.split(" "),C=0,r=n.length;C<r;C++){var N=n[C];switch(N){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<N.indexOf("px")&&(this.size=parseInt(N),this.family=n[C+1],C++)}},H.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},H.copyTo=function(H){H._type=this._type,H._text=this._text,H._weight=this._weight,H._color=this._color,H.family=this.family,H.stroke=this.stroke!=n._STROKE?this.stroke.slice():n._STROKE,H.indent=this.indent,H.size=this.size},R(0,H,"password",function(){return 0!=(1024&this._type)},function(H){H?this._type|=1024:this._type&=-1025}),R(0,H,"color",function(){return this._color.strColor},function(H){this._color=x.create(H)}),R(0,H,"italic",function(){return 0!=(512&this._type)},function(H){H?this._type|=512:this._type&=-513}),R(0,H,"bold",function(){return 0!=(2048&this._type)},function(H){H?this._type|=2048:this._type&=-2049}),R(0,H,"weight",function(){return""+this._weight},function(H){var n=0;switch(H){case"normal":break;case"bold":this.bold=!0,n=700;break;case"bolder":n=800;break;case"lighter":n=100;break;default:n=parseInt(H)}this._weight=n,this._text=null}),R(0,H,"decoration",function(){return this._decoration?this._decoration.value:null},function(H){var n=H.split(" ");switch(this._decoration||(this._decoration={}),n[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=n[0]}n[1]&&(this._decoration.color=x.create(n)),this._decoration.value=H}),n.__init__=function(){n.EMPTY=new n(null)},n.EMPTY=null,n.defaultColor="#000000",n.defaultSize=12,n.defaultFamily="Arial",n.defaultFont="12px Arial",n._STROKE=[0,"#000000"],n._ITALIC=512,n._PASSWORD=1024,n._BOLD=2048,n}(),N=function(){function H(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return l(H,"laya.display.css.TransformInfo"),H}(),o=function(){function y(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,Z.isConchNode){this._nativeObj=new g._conchGraphics,this.id=this._nativeObj.conchID}}l(y,"laya.display.Graphics");var H=y.prototype;return H.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},H.clear=function(H){void 0===H&&(H=!1);var n=0,C=0;if(H){var r=this._one;if(this._cmds){for(C=this._cmds.length,n=0;n<C;n++)!(r=this._cmds[n])||r.callee!==Z._context._drawTexture&&r.callee!==Z._context._drawTextureWithTransform||(r[0]=null,y._cache.push(r));this._cmds.length=0}else r&&(!r||r.callee!==Z._context._drawTexture&&r.callee!==Z._context._drawTextureWithTransform||(r[0]=null,y._cache.push(r)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(n=0,C=this._vectorgraphArray.length;n<C;n++)X.getInstance().deleteShape(this._vectorgraphArray[n]);this._vectorgraphArray.length=0}},H._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},H._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new C,this._graphicBounds._graphics=this)},H._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},H._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},H.getBounds=function(H){return void 0===H&&(H=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(H)},H.getBoundPoints=function(H){return void 0===H&&(H=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(H)},H._addCmd=function(H){this._cmds=this._cmds||[],H.callee=H.shift(),this._cmds.push(H)},H.setFilters=function(H){this._saveToCmd(Z._context._setFilters,H)},H.drawTexture=function(H,n,C,r,N,Q,I){if(void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0),void 0===N&&(N=0),void 0===I&&(I=1),!H||I<.01)return null;r||(r=H.sourceWidth),N||(N=H.sourceHeight),I=I<0?0:1<I?1:I;var A,P=!Z.isWebGL&&(_.onFirefox||_.onEdge||_.onIE||_.onSafari)?.5:0,t=r/H.sourceWidth,R=N/H.sourceHeight;return r=H.width*t,N=H.height*R,H.loaded&&(r<=0||N<=0)?null:(n+=H.offsetX*t,C+=H.offsetY*R,this._sp&&(this._sp._renderType|=512),n-=P,C-=P,r+=2*P,N+=2*P,y._cache.length?((A=y._cache.pop())[0]=H,A[1]=n,A[2]=C,A[3]=r,A[4]=N,A[5]=Q,A[6]=I):A=[H,n,C,r,N,Q,I],A.callee=Q||1!=I?Z._context._drawTextureWithTransform:Z._context._drawTexture,null!=this._one||Q||1!=I?this._saveToCmd(A.callee,A):(this._one=A,this._render=this._renderOneImg),H.loaded||H.once("loaded",this,this._textureLoaded,[H,A]),this._repaint(),A)},H.cleanByTexture=function(H,n,C,r,N){if(void 0===r&&(r=0),void 0===N&&(N=0),!H)return this.clear();if(this._one&&this._render===this._renderOneImg){r||(r=H.sourceWidth),N||(N=H.sourceHeight);var Q=r/H.sourceWidth,I=N/H.sourceHeight;r=H.width*Q,N=H.height*I,n+=H.offsetX*Q,C+=H.offsetY*I,this._one[0]=H,this._one[1]=n,this._one[2]=C,this._one[3]=r,this._one[4]=N,this._repaint()}else this.clear(),H&&this.drawTexture(H,n,C,r,N)},H.drawTextures=function(H,n){H&&this._saveToCmd(Z._context._drawTextures,[H,n])},H.fillTexture=function(H,n,C,r,N,Q,I){if(void 0===r&&(r=0),void 0===N&&(N=0),void 0===Q&&(Q="repeat"),H){var A=[H,n,C,r,N,Q,I||k.EMPTY,{}];H.loaded||H.once("loaded",this,this._textureLoaded,[H,A]),this._saveToCmd(Z._context._fillTexture,A)}},H._textureLoaded=function(H,n){n[3]=n[3]||H.width,n[4]=n[4]||H.height,this._repaint()},H.fillCircle=function(H,n,C,r,N,Q,I){C.bitmap.enableMerageInAtlas=!1;var A=new Float32Array(2*(I+1)),P=new Float32Array(2*(I+1)),t=new Uint16Array(3*I),R=2*Math.PI/I,y=0;A[0]=r,A[1]=N,P[0]=r/C.width,P[1]=N/C.height;for(var o=2,g=0;g<I;g++){var M=Q*Math.cos(y)+r,j=Q*Math.sin(y)+N;A[o]=M,A[o+1]=j,P[o]=M/C.width,P[o+1]=j/C.height,y+=R,o+=2}for(g=o=0;g<I;g++)t[o++]=0,t[o++]=g+1,t[o++]=I+1<=g+2?1:g+2;this.drawTriangles(C,H,n,A,P,t)},H.drawTriangles=function(H,n,C,r,N,Q,I,A,P,t){void 0===A&&(A=1),this._saveToCmd(Z._context.drawTriangles,[H,n,C,r,N,Q,I,A,P,t])},H._saveToCmd=function(H,n){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=n,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(n)),n.callee=H,this._repaint(),n},H.clipRect=function(H,n,C,r){this._saveToCmd(Z._context._clipRect,[H,n,C,r])},H.fillText=function(H,n,C,r,N,Q,I){void 0===I&&(I=0),this._saveToCmd(Z._context._fillText,[H,n,C,r||M.defaultFont,N,Q])},H.fillBorderText=function(H,n,C,r,N,Q,I,A){this._saveToCmd(Z._context._fillBorderText,[H,n,C,r||M.defaultFont,N,Q,I,A])},H.strokeText=function(H,n,C,r,N,Q,I){this._saveToCmd(Z._context._strokeText,[H,n,C,r||M.defaultFont,N,Q,I])},H.alpha=function(H){H=H<0?0:1<H?1:H,this._saveToCmd(Z._context._alpha,[H])},H.setAlpha=function(H){H=H<0?0:1<H?1:H,this._saveToCmd(Z._context._setAlpha,[H])},H.transform=function(H,n,C){void 0===n&&(n=0),void 0===C&&(C=0),this._saveToCmd(Z._context._transform,[H,n,C])},H.rotate=function(H,n,C){void 0===n&&(n=0),void 0===C&&(C=0),this._saveToCmd(Z._context._rotate,[H,n,C])},H.scale=function(H,n,C,r){void 0===C&&(C=0),void 0===r&&(r=0),this._saveToCmd(Z._context._scale,[H,n,C,r])},H.translate=function(H,n){this._saveToCmd(Z._context._translate,[H,n])},H.save=function(){this._saveToCmd(Z._context._save,[])},H.restore=function(){this._saveToCmd(Z._context._restore,[])},H.replaceText=function(H){this._repaint();var n=this._cmds;if(n){for(var C=n.length-1;-1<C;C--)if(this._isTextCmd(n[C].callee))return n[C][0].toUpperCase?n[C][0]=H:n[C][0].setText(H),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=H:this._one[0].setText(H),!0;return!1},H._isTextCmd=function(H){return H===Z._context._fillText||H===Z._context._fillBorderText||H===Z._context._strokeText},H.replaceTextColor=function(H){this._repaint();var n=this._cmds;if(n)for(var C=n.length-1;-1<C;C--)this._isTextCmd(n[C].callee)&&(n[C][4]=H,n[C][0].toUpperCase||(n[C][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=H,this._one[0].toUpperCase||(this._one[0].changed=!0))},H.loadImage=function(H,n,C,r,N,Q){var I=this;void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0),void 0===N&&(N=0);var A=AH.getRes(H);function P(H){H&&(I.drawTexture(H,n,C,r,N),null!=Q&&Q.call(I._sp,H))}A?P(A):F.loader.load(H,c.create(null,P),null,"image")},H._renderEmpty=function(H,n,C,r){},H._renderAll=function(H,n,C,r){for(var N,Q=this._cmds,I=0,A=Q.length;I<A;I++)(N=Q[I]).callee.call(n,C,r,N)},H._renderOne=function(H,n,C,r){this._one.callee.call(n,C,r,this._one)},H._renderOneImg=function(H,n,C,r){this._one.callee.call(n,C,r,this._one),2305!==H._renderType&&(H._renderType|=1)},H.drawLine=function(H,n,C,r,N,Q){void 0===Q&&(Q=1);var I=0;Z.isWebGL&&(I=X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(I));var A=Q%2==0?0:.5,P=[H+A,n+A,C+A,r+A,N,Q,I];this._saveToCmd(Z._context._drawLine,P)},H.drawLines=function(H,n,C,r,N){void 0===N&&(N=1);var Q=0;if(C&&!(C.length<4)){Z.isWebGL&&(Q=X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(Q));var I=N%2==0?0:.5,A=[H+I,n+I,C,r,N,Q];this._saveToCmd(Z._context._drawLines,A)}},H.drawCurves=function(H,n,C,r,N){void 0===N&&(N=1);var Q=[H,n,C,r,N];this._saveToCmd(Z._context._drawCurves,Q)},H.drawRect=function(H,n,C,r,N,Q,I){void 0===I&&(I=1);var A=Q?I/2:0,P=Q?I:0,t=[H+A,n+A,C-P,r-P,N,Q,I];this._saveToCmd(Z._context._drawRect,t)},H.drawCircle=function(H,n,C,r,N,Q){void 0===Q&&(Q=1);var I=N?Q/2:0,A=0;Z.isWebGL&&(A=X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(A));var P=[H,n,C-I,r,N,Q,A];this._saveToCmd(Z._context._drawCircle,P)},H.drawPie=function(H,n,C,r,N,Q,I,A){void 0===A&&(A=1);var P=I?A/2:0,t=I?A:0,R=0;Z.isWebGL&&(R=X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(R));var y=[H+P,n+P,C-t,r,N,Q,I,A,R];y[3]=u.toRadian(r),y[4]=u.toRadian(N),this._saveToCmd(Z._context._drawPie,y)},H.drawPoly=function(H,n,C,r,N,Q){void 0===Q&&(Q=1);var I=0,A=!1;Z.isWebGL&&(I=X.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(I),A=!(6<C.length));var P=N?Q%2==0?0:.5:0,t=[H+P,n+P,C,r,N,Q,I,A];this._saveToCmd(Z._context._drawPoly,t)},H.drawPath=function(H,n,C,r,N){var Q=[H,n,C,r,N];this._saveToCmd(Z._context._drawPath,Q)},R(0,H,"cmds",function(){return this._cmds},function(H){this._sp&&(this._sp._renderType|=512),this._cmds=H,this._render=this._renderAll,this._repaint()}),y.__init__=function(){if(Z.isConchNode){for(var H=laya.display.Graphics.prototype,n=_.window.ConchGraphics.prototype,C=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],r=0,N=C.length;r<=N;r++){var Q=C[r];H[Q]=n[Q]}H._saveToCmd=null,n.drawImageS&&(H.drawTextures=function(H,n){if(H&&H.loaded&&H.bitmap&&H.source){var C=H.uv,r=H.bitmap.width,N=H.bitmap.height;this.drawImageS(H.bitmap.source,C[0]*r,C[1]*N,(C[2]-C[0])*r,(C[5]-C[3])*N,H.offsetX,H.offsetY,H.width,H.height,n)}}),H.drawTexture=function(H,n,C,r,N,Q,I){if(void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0),void 0===N&&(N=0),void 0===I&&(I=1),H)if(H.loaded){if(H.loaded&&H.bitmap&&H.source&&(r||(r=H.sourceWidth),N||(N=H.sourceHeight),I=I<0?0:1<I?1:I,r=r-H.sourceWidth+H.width,N=N-H.sourceHeight+H.height,!(r<=0||N<=0))){n+=H.offsetX,C+=H.offsetY;var A=H.uv,P=H.bitmap.width,t=H.bitmap.height;A[4]<A[0]&&A[5]<A[1]?this.drawImageM(H.bitmap.source,A[4]*P,A[5]*t,(A[0]-A[4])*P,(A[1]-A[5])*t,n,C,r,N,Q,I):this.drawImageM(H.bitmap.source,A[0]*P,A[1]*t,(A[2]-A[0])*P,(A[5]-A[3])*t,n,C,r,N,Q,I),this._repaint()}}else H.once("loaded",this,function(){this.drawTexture(H,n,C,r,N,Q)})},H.fillTexture=function(H,n,C,r,N,Q,I){if(void 0===r&&(r=0),void 0===N&&(N=0),void 0===Q&&(Q="repeat"),H&&H.loaded){var A,P=Z._context.ctx,t=H.bitmap.width,R=H.bitmap.height,y=H.uv;A=H.uv!=RH.DEF_UV?P.createPattern(H.bitmap.source,Q,y[0]*t,y[1]*R,(y[2]-y[0])*t,(y[5]-y[3])*R):P.createPattern(H.bitmap.source,Q);var o=0,g=0;I&&(n+=I.x%H.width,C+=I.y%H.height,o-=I.x%H.width,g-=I.y%H.height),this._fillImage(A,n,C,o,g,r,N)}}}},y._cache=[],y}(),C=function(){function K(){this._cacheBoundsType=!1}l(K,"laya.display.GraphicsBounds");var H=K.prototype;return H.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},H.reset=function(){this._temp&&(this._temp.length=0)},H.getBounds=function(H){return void 0===H&&(H=!1),(!this._bounds||!this._temp||this._temp.length<1||H!=this._cacheBoundsType)&&(this._bounds=i._getWrapRec(this.getBoundPoints(H),this._bounds)),this._cacheBoundsType=H,this._bounds},H.getBoundPoints=function(H){return void 0===H&&(H=!1),(!this._temp||this._temp.length<1||H!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(H)),this._cacheBoundsType=H,this._rstBoundPoints=u.copyArray(this._rstBoundPoints,this._temp)},H._getCmdPoints=function(H){void 0===H&&(H=!1);var n,C,r=Z._context,N=this._graphics.cmds;if((n=this._temp||(this._temp=[])).length=0,N||null==this._graphics._one||(K._tempCmds.length=0,K._tempCmds.push(this._graphics._one),N=K._tempCmds),!N)return n;(C=K._tempMatrixArrays).length=0;var Q=K._initMatrix;Q.identity();for(var I,A,P=K._tempMatrix,t=NaN,R=NaN,y=NaN,o=NaN,g=NaN,M=NaN,j=0,l=N.length;j<l;j++)if((I=N[j]).callee)switch(I.callee){case r._save:case 7:C.push(Q),Q=Q.clone();break;case r._restore:case 8:Q=C.pop();break;case r._scale:case 5:P.identity(),P.translate(-I[2],-I[3]),P.scale(I[0],I[1]),P.translate(I[2],I[3]),this._switchMatrix(Q,P);break;case r._rotate:case 3:P.identity(),P.translate(-I[1],-I[2]),P.rotate(I[0]),P.translate(I[1],I[2]),this._switchMatrix(Q,P);break;case r._translate:case 6:P.identity(),P.translate(I[0],I[1]),this._switchMatrix(Q,P);break;case r._transform:case 4:P.identity(),P.translate(-I[1],-I[2]),P.concat(I[0]),P.translate(I[1],I[2]),this._switchMatrix(Q,P);break;case 16:case 24:K._addPointArrToRst(n,i._getBoundPointS(I[0],I[1],I[2],I[3]),Q);break;case 17:Q.copyTo(P),P.concat(I[4]),K._addPointArrToRst(n,i._getBoundPointS(I[0],I[1],I[2],I[3]),P);break;case r._drawTexture:A=I[0],H?I[3]&&I[4]?K._addPointArrToRst(n,i._getBoundPointS(I[1],I[2],I[3],I[4]),Q):(A=I[0],K._addPointArrToRst(n,i._getBoundPointS(I[1],I[2],A.width,A.height),Q)):(t=(I[3]||A.sourceWidth)/A.width,R=(I[4]||A.sourceHeight)/A.height,y=t*A.sourceWidth,o=R*A.sourceHeight,g=0<A.offsetX?A.offsetX:0,M=0<A.offsetY?A.offsetY:0,g*=t,M*=R,K._addPointArrToRst(n,i._getBoundPointS(I[1]-g,I[2]-M,y,o),Q));break;case r._fillTexture:I[3]&&I[4]?K._addPointArrToRst(n,i._getBoundPointS(I[1],I[2],I[3],I[4]),Q):(A=I[0],K._addPointArrToRst(n,i._getBoundPointS(I[1],I[2],A.width,A.height),Q));break;case r._drawTextureWithTransform:var f;f=I[5]?(Q.copyTo(P),P.concat(I[5]),P):Q,H?I[3]&&I[4]?K._addPointArrToRst(n,i._getBoundPointS(I[1],I[2],I[3],I[4]),f):(A=I[0],K._addPointArrToRst(n,i._getBoundPointS(I[1],I[2],A.width,A.height),f)):(A=I[0],t=(I[3]||A.sourceWidth)/A.width,R=(I[4]||A.sourceHeight)/A.height,y=t*A.sourceWidth,o=R*A.sourceHeight,g=0<A.offsetX?A.offsetX:0,M=0<A.offsetY?A.offsetY:0,g*=t,M*=R,K._addPointArrToRst(n,i._getBoundPointS(I[1]-g,I[2]-M,y,o),f));break;case r._drawRect:case 13:K._addPointArrToRst(n,i._getBoundPointS(I[0],I[1],I[2],I[3]),Q);break;case r._drawCircle:case r._fillCircle:case 14:K._addPointArrToRst(n,i._getBoundPointS(I[0]-I[2],I[1]-I[2],I[2]+I[2],I[2]+I[2]),Q);break;case r._drawLine:case 20:K._tempPoints.length=0;var c;c=.5*I[5],I[0]==I[2]?K._tempPoints.push(I[0]+c,I[1],I[2]+c,I[3],I[0]-c,I[1],I[2]-c,I[3]):I[1]==I[3]?K._tempPoints.push(I[0],I[1]+c,I[2],I[3]+c,I[0],I[1]-c,I[2],I[3]-c):K._tempPoints.push(I[0],I[1],I[2],I[3]),K._addPointArrToRst(n,K._tempPoints,Q);break;case r._drawCurves:case 22:K._addPointArrToRst(n,W.I.getBezierPoints(I[2]),Q,I[0],I[1]);break;case r._drawPoly:case r._drawLines:case 18:K._addPointArrToRst(n,I[2],Q,I[0],I[1]);break;case r._drawPath:case 19:K._addPointArrToRst(n,this._getPathPoints(I[2]),Q,I[0],I[1]);break;case r._drawPie:case 15:K._addPointArrToRst(n,this._getPiePoints(I[0],I[1],I[2],I[3],I[4]),Q)}return 200<n.length?n=u.copyArray(n,i._getWrapRec(n)._getBoundPoints()):8<n.length&&(n=z.scanPList(n)),n},H._switchMatrix=function(H,n){n.concat(H),n.copyTo(H)},H._getPiePoints=function(H,n,C,r,N){var Q=K._tempPoints;K._tempPoints.length=0,Q.push(H,n);var I=(N-r)%(2*Math.PI)/10,A=NaN,P=r;for(A=0;A<=10;A++)Q.push(H+C*Math.cos(P),n+C*Math.sin(P)),P+=I;return Q},H._getPathPoints=function(H){var n,C,r=0,N=K._tempPoints;for(N.length=0,n=H.length,r=0;r<n;r++)1<(C=H[r]).length&&(N.push(C[1],C[2]),3<C.length&&N.push(C[3],C[4]));return N},K._addPointArrToRst=function(H,n,C,r,N){void 0===r&&(r=0),void 0===N&&(N=0);var Q,I=0;for(Q=n.length,I=0;I<Q;I+=2)K._addPointToRst(H,n[I]+r,n[I+1]+N,C)},K._addPointToRst=function(H,n,C,r){var N=k.TEMP;N.setTo(n||0,C||0),r.transformPoint(N),H.push(N.x,N.y)},K._tempPoints=[],K._tempMatrixArrays=[],K._tempCmds=[],P(K,["_tempMatrix",function(){return this._tempMatrix=new h},"_initMatrix",function(){return this._initMatrix=new h}]),K}(),Q=function(){function H(){}l(H,"laya.events.Event");var n=H.prototype;return n.setTo=function(H,n,C){return this.type=H,this.currentTarget=n,this.target=C,this},n.stopPropagation=function(){this._stoped=!0},R(0,n,"stageY",function(){return F.stage.mouseY}),R(0,n,"charCode",function(){return this.nativeEvent.charCode}),R(0,n,"touches",function(){var H=this.nativeEvent.touches;if(H)for(var n=F.stage,C=0,r=H.length;C<r;C++){var N=H[C],Q=k.TEMP;Q.setTo(N.clientX,N.clientY),n._canvasTransform.invertTransformPoint(Q),n.transform.invertTransformPoint(Q),N.stageX=Q.x,N.stageY=Q.y}return H}),R(0,n,"keyLocation",function(){return this.nativeEvent.keyLocation}),R(0,n,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),R(0,n,"altKey",function(){return this.nativeEvent.altKey}),R(0,n,"shiftKey",function(){return this.nativeEvent.shiftKey}),R(0,n,"stageX",function(){return F.stage.mouseX}),H.EMPTY=new H,H.MOUSE_DOWN="mousedown",H.MOUSE_UP="mouseup",H.CLICK="click",H.RIGHT_MOUSE_DOWN="rightmousedown",H.RIGHT_MOUSE_UP="rightmouseup",H.RIGHT_CLICK="rightclick",H.MOUSE_MOVE="mousemove",H.MOUSE_OVER="mouseover",H.MOUSE_OUT="mouseout",H.MOUSE_WHEEL="mousewheel",H.ROLL_OVER="mouseover",H.ROLL_OUT="mouseout",H.DOUBLE_CLICK="doubleclick",H.CHANGE="change",H.CHANGED="changed",H.RESIZE="resize",H.ADDED="added",H.REMOVED="removed",H.DISPLAY="display",H.UNDISPLAY="undisplay",H.ERROR="error",H.COMPLETE="complete",H.LOADED="loaded",H.INITED="inited",H.PROGRESS="progress",H.INPUT="input",H.RENDER="render",H.OPEN="open",H.MESSAGE="message",H.CLOSE="close",H.KEY_DOWN="keydown",H.KEY_PRESS="keypress",H.KEY_UP="keyup",H.FRAME="enterframe",H.DRAG_START="dragstart",H.DRAG_MOVE="dragmove",H.DRAG_END="dragend",H.ENTER="enter",H.SELECT="select",H.BLUR="blur",H.FOCUS="focus",H.VISIBILITY_CHANGE="visibilitychange",H.FOCUS_CHANGE="focuschange",H.PLAYED="played",H.PAUSED="paused",H.STOPPED="stopped",H.START="start",H.END="end",H.ENABLE_CHANGED="enablechanged",H.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",H.COMPONENT_ADDED="componentadded",H.COMPONENT_REMOVED="componentremoved",H.LAYER_CHANGED="layerchanged",H.HIERARCHY_LOADED="hierarchyloaded",H.RECOVERED="recovered",H.RELEASED="released",H.LINK="link",H.LABEL="label",H.FULL_SCREEN_CHANGE="fullscreenchange",H.DEVICE_LOST="devicelost",H.MESH_CHANGED="meshchanged",H.MATERIAL_CHANGED="materialchanged",H.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",H.ANIMATION_CHANGED="animationchanged",H.TRIGGER_ENTER="triggerenter",H.TRIGGER_STAY="triggerstay",H.TRIGGER_EXIT="triggerexit",H.TRAIL_FILTER_CHANGE="trailfilterchange",H.DOMINO_FILTER_CHANGE="dominofilterchange",H}(),y=(function(){function H(){}l(H,"laya.events.Keyboard"),H.NUMBER_0=48,H.NUMBER_1=49,H.NUMBER_2=50,H.NUMBER_3=51,H.NUMBER_4=52,H.NUMBER_5=53,H.NUMBER_6=54,H.NUMBER_7=55,H.NUMBER_8=56,H.NUMBER_9=57,H.A=65,H.B=66,H.C=67,H.D=68,H.E=69,H.F=70,H.G=71,H.H=72,H.I=73,H.J=74,H.K=75,H.L=76,H.M=77,H.N=78,H.O=79,H.P=80,H.Q=81,H.R=82,H.S=83,H.T=84,H.U=85,H.V=86,H.W=87,H.X=88,H.Y=89,H.Z=90,H.F1=112,H.F2=113,H.F3=114,H.F4=115,H.F5=116,H.F6=117,H.F7=118,H.F8=119,H.F9=120,H.F10=121,H.F11=122,H.F12=123,H.F13=124,H.F14=125,H.F15=126,H.NUMPAD=21,H.NUMPAD_0=96,H.NUMPAD_1=97,H.NUMPAD_2=98,H.NUMPAD_3=99,H.NUMPAD_4=100,H.NUMPAD_5=101,H.NUMPAD_6=102,H.NUMPAD_7=103,H.NUMPAD_8=104,H.NUMPAD_9=105,H.NUMPAD_ADD=107,H.NUMPAD_DECIMAL=110,H.NUMPAD_DIVIDE=111,H.NUMPAD_ENTER=108,H.NUMPAD_MULTIPLY=106,H.NUMPAD_SUBTRACT=109,H.SEMICOLON=186,H.EQUAL=187,H.COMMA=188,H.MINUS=189,H.PERIOD=190,H.SLASH=191,H.BACKQUOTE=192,H.LEFTBRACKET=219,H.BACKSLASH=220,H.RIGHTBRACKET=221,H.QUOTE=222,H.ALTERNATE=18,H.BACKSPACE=8,H.CAPS_LOCK=20,H.COMMAND=15,H.CONTROL=17,H.DELETE=46,H.ENTER=13,H.ESCAPE=27,H.PAGE_UP=33,H.PAGE_DOWN=34,H.END=35,H.HOME=36,H.LEFT=37,H.UP=38,H.RIGHT=39,H.DOWN=40,H.SHIFT=16,H.SPACE=32,H.TAB=9,H.INSERT=45}(),function(){function N(){}return l(N,"laya.events.KeyBoardManager"),N.__init__=function(){N._addEvent("keydown"),N._addEvent("keypress"),N._addEvent("keyup")},N._addEvent=function(n){_.document.addEventListener(n,function(H){laya.events.KeyBoardManager._dispatch(H,n)},!0)},N._dispatch=function(H,n){if(N.enabled){N._event._stoped=!1,N._event.nativeEvent=H,N._event.keyCode=H.keyCode||H.which||H.charCode,"keydown"===n?N._pressKeys[N._event.keyCode]=!0:"keyup"===n&&(N._pressKeys[N._event.keyCode]=null);for(var C=F.stage.focus&&null!=F.stage.focus.event&&F.stage.focus.displayedInStage?F.stage.focus:F.stage,r=C;r;)r.event(n,N._event.setTo(n,r,C)),r=r.parent}},N.hasKeyDown=function(H){return N._pressKeys[H]},N._pressKeys={},N.enabled=!0,P(N,["_event",function(){return this._event=new Q}]),N}()),j=(function(){function H(){}l(H,"laya.events.KeyLocation"),H.STANDARD=0,H.LEFT=1,H.RIGHT=2,H.NUM_PAD=3}(),function(){function R(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=_.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new Q,this._matrix=new h,this._point=new k,this._rect=new i,this._prePoint=new k,this._curTouchID=NaN}l(R,"laya.events.MouseManager");var H=R.prototype;return H.__init__=function(H,n){var C=this;this._stage=H;var r=this,N=this._eventList;n.oncontextmenu=function(H){if(R.enabled)return!1},n.addEventListener("mousedown",function(H){R.enabled&&(_.onIE||H.preventDefault(),N.push(H),r.mouseDownTime=_.now())}),n.addEventListener("mouseup",function(H){R.enabled&&(H.preventDefault(),N.push(H),r.mouseDownTime=-_.now())},!0),n.addEventListener("mousemove",function(H){if(R.enabled){H.preventDefault();var n=_.now();if(n-r._lastMoveTimer<10)return;r._lastMoveTimer=n,N.push(H)}},!0),n.addEventListener("mouseout",function(H){R.enabled&&N.push(H)}),n.addEventListener("mouseover",function(H){R.enabled&&N.push(H)}),n.addEventListener("touchstart",function(H){R.enabled&&(N.push(H),R._isFirstTouch||zH.isInputting||H.preventDefault(),r.mouseDownTime=_.now())}),n.addEventListener("touchend",function(H){R.enabled?(R._isFirstTouch||zH.isInputting||H.preventDefault(),R._isFirstTouch=!1,N.push(H),r.mouseDownTime=-_.now()):C._curTouchID=NaN},!0),n.addEventListener("touchmove",function(H){R.enabled&&(H.preventDefault(),N.push(H))},!0),n.addEventListener("touchcancel",function(H){R.enabled?(H.preventDefault(),N.push(H)):C._curTouchID=NaN},!0),n.addEventListener("mousewheel",function(H){R.enabled&&N.push(H)}),n.addEventListener("DOMMouseScroll",function(H){R.enabled&&N.push(H)})},H.initEvent=function(H,n){var C,r=this;r._event._stoped=!1,r._event.nativeEvent=n||H,r._target=null,this._point.setTo(H.pageX||H.clientX,H.pageY||H.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),r.mouseX=this._point.x,r.mouseY=this._point.y,r._event.touchId=H.identifier||0,this._tTouchID=r._event.touchId,(C=f.I._event)._stoped=!1,C.nativeEvent=r._event.nativeEvent,C.touchId=r._event.touchId},H.checkMouseWheel=function(H){this._event.delta=H.wheelDelta?.025*H.wheelDelta:-H.detail;for(var n=f.I.getLastOvers(),C=0,r=n.length;C<r;C++){var N=n[C];N.event("mousewheel",this._event.setTo("mousewheel",N,this._target))}},H.onMouseMove=function(H){f.I.onMouseMove(H,this._tTouchID)},H.onMouseDown=function(H){if(zH.isInputting&&F.stage.focus&&F.stage.focus.focus&&!F.stage.focus.contains(this._target)){var n=F.stage.focus._tf||F.stage.focus,C=H._tf||H;C instanceof laya.display.Input&&C.multiline==n.multiline?n._focusOut():n.focus=!1}f.I.onMouseDown(H,this._tTouchID,this._isLeftMouse)},H.onMouseUp=function(H){f.I.onMouseUp(H,this._tTouchID,this._isLeftMouse)},H.check=function(H,n,C,r){this._point.setTo(n,C),H.fromParentPoint(this._point),n=this._point.x,C=this._point.y;var N=H.scrollRect;if(N&&(this._rect.setTo(N.x,N.y,N.width,N.height),!this._rect.contains(n,C)))return!1;if(!this.disableMouseEvent){if(H.hitTestPrior&&!H.mouseThrough&&!this.hitTest(H,n,C))return!1;for(var Q=H._childs.length-1;-1<Q;Q--){var I=H._childs[Q];if(!I.destroyed&&I.mouseEnabled&&I.visible&&this.check(I,n,C,r))return!0}}var A=!(!H.hitTestPrior||H.mouseThrough||this.disableMouseEvent)||this.hitTest(H,n,C);return A?(this._target=H,r.call(this,H)):r===this.onMouseUp&&H===this._stage&&(this._target=this._stage,r.call(this,this._target)),A},H.hitTest=function(H,n,C){var r=!1;if(H.scrollRect&&(n-=H.scrollRect.x,C-=H.scrollRect.y),H.hitArea instanceof laya.utils.HitArea)return H.hitArea.isHit(n,C);if(0<H.width&&0<H.height||H.mouseThrough||H.hitArea)if(H.mouseThrough)r=H.getGraphicBounds().contains(n,C);else{var N=this._rect;H.hitArea?N=H.hitArea:N.setTo(0,0,H.width,H.height),r=N.contains(n,C)}return r},H.runEvent=function(){var H=this._eventList.length;if(H){var n=this;n.mouseEventTime=_.now();var C,r=0,N=0,Q=0;try{for(;r<H;){var I=this._eventList[r];switch("mousemove"!==I.type&&(this._prePoint.x=this._prePoint.y=-1e6),I.type){case"mousedown":this._touchIDs[0]=this._id++,R._isTouchRespond?R._isTouchRespond=!1:(n._isLeftMouse=0===I.button,n.initEvent(I),n.check(n._stage,n.mouseX,n.mouseY,n.onMouseDown));break;case"mouseup":n._isLeftMouse=0===I.button,n.initEvent(I),n.check(n._stage,n.mouseX,n.mouseY,n.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-I.clientX)+Math.abs(this._prePoint.y-I.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=I.clientX,this._prePoint.y=I.clientY,n.initEvent(I),n.check(n._stage,n.mouseX,n.mouseY,n.onMouseMove));break;case"touchstart":R._isTouchRespond=!0,n._isLeftMouse=!0;var A=I.changedTouches;for(N=0,Q=A.length;N<Q;N++)C=A[N],(R.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=C.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[C.identifier]=this._id++,n.initEvent(C,I),n.check(n._stage,n.mouseX,n.mouseY,n.onMouseDown));break;case"touchend":case"touchcancel":R._isTouchRespond=!0,n._isLeftMouse=!0;var P=I.changedTouches;for(N=0,Q=P.length;N<Q;N++)if(C=P[N],R.multiTouchEnabled||C.identifier==this._curTouchID){this._curTouchID=NaN,n.initEvent(C,I);n.check(n._stage,n.mouseX,n.mouseY,n.onMouseUp)||n.onMouseUp(null)}break;case"touchmove":var t=I.changedTouches;for(N=0,Q=t.length;N<Q;N++)C=t[N],(R.multiTouchEnabled||C.identifier==this._curTouchID)&&(n.initEvent(C,I),n.check(n._stage,n.mouseX,n.mouseY,n.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":n.checkMouseWheel(I);break;case"mouseout":f.I.stageMouseOut();break;case"mouseover":n._stage.event("mouseover",n._event.setTo("mouseover",n._stage,n._stage))}r++}}catch(H){throw this._eventList.length=0,H}this._eventList.length=0}},R.enabled=!0,R.multiTouchEnabled=!0,R._isTouchRespond=!1,R._isFirstTouch=!0,P(R,["instance",function(){return this.instance=new R}]),R}()),f=function(){function M(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new Q}l(M,"laya.events.TouchManager");var H=M.prototype;return H._clearTempArrs=function(){M._oldArr.length=0,M._newArr.length=0,M._tEleArr.length=0},H.getTouchFromArr=function(H,n){var C,r,N=0;for(C=n.length,N=0;N<C;N++)if((r=n[N]).id==H)return r;return null},H.removeTouchFromArr=function(H,n){var C=0;for(C=n.length-1;0<=C;C--)n[C].id==H&&n.splice(C,1)},H.createTouchO=function(H,n){var C;return(C=E.getItem("TouchData")||{}).id=n,C.tar=H,C},H.onMouseDown=function(H,n,C){var r,N,Q,I;(void 0===C&&(C=!1),this.enable)&&(r=this.getTouchFromArr(n,this.preOvers),Q=this.getEles(H,null,M._tEleArr),r?r.tar=H:(N=this.createTouchO(H,n),this.preOvers.push(N)),_.onMobile&&this.sendEvents(Q,"mouseover",n),I=C?this.preDowns:this.preRightDowns,(r=this.getTouchFromArr(n,I))?r.tar=H:(N=this.createTouchO(H,n),I.push(N)),this.sendEvents(Q,C?"mousedown":"rightmousedown",n),this._clearTempArrs())},H.sendEvents=function(H,n,C){void 0===C&&(C=0);var r,N,Q,I=0;for(r=H.length,this._event._stoped=!1,N=H[0],I=0;I<r;I++){if((Q=H[I]).destroyed)return;if(Q.event(n,this._event.setTo(n,Q,N)),this._event._stoped)break}},H.getEles=function(H,n,C){for(C?C.length=0:C=[];H&&H!=n;)C.push(H),H=H.parent;return C},H.checkMouseOutAndOverOfMove=function(H,n,C){if(void 0===C&&(C=0),n!=H){var r,N,Q=0,I=0;if(n.contains(H))N=this.getEles(H,n,M._tEleArr),this.sendEvents(N,"mouseover",C);else if(H.contains(n))N=this.getEles(n,H,M._tEleArr),this.sendEvents(N,"mouseout",C);else{var A,P;(N=M._tEleArr).length=0,A=this.getEles(n,null,M._oldArr),P=this.getEles(H,null,M._newArr),I=A.length;var t=0;for(Q=0;Q<I;Q++){if(r=A[Q],0<=(t=P.indexOf(r))){P.splice(t,P.length-t);break}N.push(r)}0<N.length&&this.sendEvents(N,"mouseout",C),0<P.length&&this.sendEvents(P,"mouseover",C)}}},H.onMouseMove=function(H,n){var C,r;this.enable&&((C=this.getTouchFromArr(n,this.preOvers))?(this.checkMouseOutAndOverOfMove(H,C.tar),C.tar=H,r=this.getEles(H,null,M._tEleArr)):(r=this.getEles(H,null,M._tEleArr),this.sendEvents(r,"mouseover",n),this.preOvers.push(this.createTouchO(H,n))),this.sendEvents(r,"mousemove",n),this._clearTempArrs())},H.getLastOvers=function(){return(M._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,M._tEleArr):(M._tEleArr.push(F.stage),M._tEleArr)},H.stageMouseOut=function(){var H;H=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(H,"mouseout",0)},H.onMouseUp=function(H,n,C){if(void 0===C&&(C=!1),this.enable){var r,N,Q,I,A,P,t=0,R=0,y=_.onMobile;if(N=this.getEles(H,null,M._tEleArr),this.sendEvents(N,C?"mouseup":"rightmouseup",n),P=C?this.preDowns:this.preRightDowns,r=this.getTouchFromArr(n,P)){var o,g=_.now();if(o=g-this._lastClickTime<300,this._lastClickTime=g,H==r.tar)A=N;else for(Q=this.getEles(r.tar,null,M._oldArr),(A=M._newArr).length=0,R=Q.length,t=0;t<R;t++)I=Q[t],0<=N.indexOf(I)&&A.push(I);0<A.length&&this.sendEvents(A,C?"click":"rightclick",n),C&&o&&this.sendEvents(A,"doubleclick",n),this.removeTouchFromArr(n,P),r.tar=null,E.recover("TouchData",r)}else;(r=this.getTouchFromArr(n,this.preOvers))&&y&&((A=this.getEles(r.tar,null,A))&&0<A.length&&this.sendEvents(A,"mouseout",n),this.removeTouchFromArr(n,this.preOvers),r.tar=null,E.recover("TouchData",r)),this._clearTempArrs()}},M._oldArr=[],M._newArr=[],M._tEleArr=[],P(M,["I",function(){return this.I=new M}]),M}(),K=function(){function H(){this._action=null}l(H,"laya.filters.Filter");var n=H.prototype;return F.imps(n,{"laya.filters.IFilter":!0}),n.callNative=function(H){},R(0,n,"type",function(){return-1}),R(0,n,"action",function(){return this._action}),H.BLUR=16,H.COLOR=32,H.GLOW=8,H._filterStart=null,H._filterEnd=null,H._EndTarget=null,H._recycleScope=null,H._filter=null,H._useSrc=null,H._endSrc=null,H._useOut=null,H._endOut=null,H}(),I=function(){function H(){this.data=null}l(H,"laya.filters.ColorFilterAction");var n=H.prototype;return F.imps(n,{"laya.filters.IFilterAction":!0}),n.apply=function(H){var n=H.ctx.ctx,C=H.ctx.ctx.canvas;if(0==C.width||0==C.height)return C;for(var r,N=n.getImageData(0,0,C.width,C.height),Q=N.data,I=0,A=Q.length;I<A;I+=4)r=this.getColor(Q[I],Q[I+1],Q[I+2],Q[I+3]),0!=Q[I+3]&&(Q[I]=r[0],Q[I+1]=r[1],Q[I+2]=r[2],Q[I+3]=r[3]);return n.putImageData(N,0,0),H},n.getColor=function(H,n,C,r){var N=[];if(this.data._mat&&this.data._alpha){var Q=this.data._mat,I=this.data._alpha;N[0]=Q[0]*H+Q[1]*n+Q[2]*C+Q[3]*r+I[0],N[1]=Q[4]*H+Q[5]*n+Q[6]*C+Q[7]*r+I[1],N[2]=Q[8]*H+Q[9]*n+Q[10]*C+Q[11]*r+I[2],N[3]=Q[12]*H+Q[13]*n+Q[14]*C+Q[15]*r+I[3]}return N},H}(),W=(function(){function H(){}l(H,"laya.maths.Arith"),H.formatR=function(H){return H>Math.PI&&(H-=2*Math.PI),H<-Math.PI&&(H+=2*Math.PI),H},H.isPOT=function(H,n){return 0<H&&0==(H&H-1)&&0<n&&0==(n&n-1)},H.setMatToArray=function(H,n){H.a,H.b,H.c,H.d,H.tx,H.ty,n[0]=H.a,n[1]=H.b,n[4]=H.c,n[5]=H.d,n[12]=H.tx,n[13]=H.ty}}(),function(){function H(){this._controlPoints=[new k,new k,new k],this._calFun=this.getPoint2}l(H,"laya.maths.Bezier");var n=H.prototype;return n._switchPoint=function(H,n){var C=this._controlPoints.shift();C.setTo(H,n),this._controlPoints.push(C)},n.getPoint2=function(H,n){var C=this._controlPoints[0],r=this._controlPoints[1],N=this._controlPoints[2],Q=Math.pow(1-H,2)*C.x+2*H*(1-H)*r.x+Math.pow(H,2)*N.x,I=Math.pow(1-H,2)*C.y+2*H*(1-H)*r.y+Math.pow(H,2)*N.y;n.push(Q,I)},n.getPoint3=function(H,n){var C=this._controlPoints[0],r=this._controlPoints[1],N=this._controlPoints[2],Q=this._controlPoints[3],I=Math.pow(1-H,3)*C.x+3*r.x*H*(1-H)*(1-H)+3*N.x*H*H*(1-H)+Q.x*Math.pow(H,3),A=Math.pow(1-H,3)*C.y+3*r.y*H*(1-H)*(1-H)+3*N.y*H*H*(1-H)+Q.y*Math.pow(H,3);n.push(I,A)},n.insertPoints=function(H,n){var C,r=NaN;for(C=1/(H=0<H?H:5),r=0;r<=1;r+=C)this._calFun(r,n)},n.getBezierPoints=function(H,n,C){void 0===n&&(n=5),void 0===C&&(C=2);var r,N,Q=0;if((r=H.length)<2*(C+1))return[];switch(N=[],C){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=C;)this._controlPoints.push(new k);for(Q=0;Q<2*C;Q+=2)this._switchPoint(H[Q],H[Q+1]);for(Q=2*C;Q<r;Q+=2)this._switchPoint(H[Q],H[Q+1]),Q/2%C==0&&this.insertPoints(n,N);return N},P(H,["I",function(){return this.I=new H}]),H}()),z=function(){function t(){}return l(t,"laya.maths.GrahamScan"),t.multiply=function(H,n,C){return(H.x-C.x)*(n.y-C.y)-(n.x-C.x)*(H.y-C.y)},t.dis=function(H,n){return(H.x-n.x)*(H.x-n.x)+(H.y-n.y)*(H.y-n.y)},t._getPoints=function(H,n,C){for(void 0===n&&(n=!1),t._mPointList||(t._mPointList=[]);t._mPointList.length<H;)t._mPointList.push(new k);return C||(C=[]),C.length=0,n?t.getFrom(C,t._mPointList,H):t.getFromR(C,t._mPointList,H),C},t.getFrom=function(H,n,C){var r=0;for(r=0;r<C;r++)H.push(n[r]);return H},t.getFromR=function(H,n,C){var r=0;for(r=0;r<C;r++)H.push(n.pop());return H},t.pListToPointList=function(H,n){void 0===n&&(n=!1);var C=0,r=H.length/2,N=t._getPoints(r,n,t._tempPointList);for(C=0;C<r;C++)N[C].setTo(H[C+C],H[C+C+1]);return N},t.pointListToPlist=function(H){var n,C=0,r=H.length,N=t._temPList;for(C=N.length=0;C<r;C++)n=H[C],N.push(n.x,n.y);return N},t.scanPList=function(H){return u.copyArray(H,t.pointListToPlist(t.scan(t.pListToPointList(H,!0))))},t.scan=function(H){var n,C,r,N=0,Q=0,I=0,A=H.length,P={};for((C=t._temArr).length=0,N=(A=H.length)-1;0<=N;N--)r=(n=H[N]).x+"_"+n.y,P.hasOwnProperty(r)||(P[r]=!0,C.push(n));for(A=C.length,u.copyArray(H,C),N=1;N<A;N++)(H[N].y<H[I].y||H[N].y==H[I].y&&H[N].x<H[I].x)&&(I=N);for(n=H[0],H[0]=H[I],H[I]=n,N=1;N<A-1;N++){for(Q=(I=N)+1;Q<A;Q++)(0<t.multiply(H[Q],H[I],H[0])||0==t.multiply(H[Q],H[I],H[0])&&t.dis(H[0],H[Q])<t.dis(H[0],H[I]))&&(I=Q);n=H[N],H[N]=H[I],H[I]=n}if((C=t._temArr).length=0,H.length<3)return u.copyArray(C,H);for(C.push(H[0],H[1],H[2]),N=3;N<A;N++){for(;2<=C.length&&0<=t.multiply(H[N],C[C.length-1],C[C.length-2]);)C.pop();H[N]&&C.push(H[N])}return C},t._mPointList=null,t._tempPointList=[],t._temPList=[],t._temArr=[],t}(),w=function(){function N(){}return l(N,"laya.maths.MathUtil"),N.subtractVector3=function(H,n,C){C[0]=H[0]-n[0],C[1]=H[1]-n[1],C[2]=H[2]-n[2]},N.lerp=function(H,n,C){return H*(1-C)+n*C},N.scaleVector3=function(H,n,C){C[0]=H[0]*n,C[1]=H[1]*n,C[2]=H[2]*n},N.lerpVector3=function(H,n,C,r){var N=H[0],Q=H[1],I=H[2];r[0]=N+C*(n[0]-N),r[1]=Q+C*(n[1]-Q),r[2]=I+C*(n[2]-I)},N.lerpVector4=function(H,n,C,r){var N=H[0],Q=H[1],I=H[2],A=H[3];r[0]=N+C*(n[0]-N),r[1]=Q+C*(n[1]-Q),r[2]=I+C*(n[2]-I),r[3]=A+C*(n[3]-A)},N.slerpQuaternionArray=function(H,n,C,r,N,Q,I){var A,P,t,R,y,o=H[n+0],g=H[n+1],M=H[n+2],j=H[n+3],l=C[r+0],f=C[r+1],c=C[r+2],K=C[r+3];return(P=o*l+g*f+M*c+j*K)<0&&(P=-P,l=-l,f=-f,c=-c,K=-K),y=1e-6<1-P?(A=Math.acos(P),t=Math.sin(A),R=Math.sin((1-N)*A)/t,Math.sin(N*A)/t):(R=1-N,N),Q[I+0]=R*o+y*l,Q[I+1]=R*g+y*f,Q[I+2]=R*M+y*c,Q[I+3]=R*j+y*K,Q},N.getRotation=function(H,n,C,r){return Math.atan2(r-n,C-H)/Math.PI*180},N.sortBigFirst=function(H,n){return H==n?0:H<n?1:-1},N.sortSmallFirst=function(H,n){return H==n?0:H<n?-1:1},N.sortNumBigFirst=function(H,n){return parseFloat(n)-parseFloat(H)},N.sortNumSmallFirst=function(H,n){return parseFloat(H)-parseFloat(n)},N.sortByKey=function(C,H,n){var r;return void 0===H&&(H=!1),void 0===n&&(n=!0),r=H?n?N.sortNumBigFirst:N.sortBigFirst:n?N.sortNumSmallFirst:N.sortSmallFirst,function(H,n){return r(H[C],n[C])}},N}(),h=function(){function C(H,n,C,r,N,Q){this.inPool=!1,this.bTransform=!1,void 0===H&&(H=1),void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=1),void 0===N&&(N=0),void 0===Q&&(Q=0),this.a=H,this.b=n,this.c=C,this.d=r,this.tx=N,this.ty=Q,this._checkTransform()}l(C,"laya.maths.Matrix");var H=C.prototype;return H.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},H._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},H.setTranslate=function(H,n){return this.tx=H,this.ty=n,this},H.translate=function(H,n){return this.tx+=H,this.ty+=n,this},H.scale=function(H,n){this.a*=H,this.d*=n,this.c*=H,this.b*=n,this.tx*=H,this.ty*=n,this.bTransform=!0},H.rotate=function(H){var n=Math.cos(H),C=Math.sin(H),r=this.a,N=this.c,Q=this.tx;this.a=r*n-this.b*C,this.b=r*C+this.b*n,this.c=N*n-this.d*C,this.d=N*C+this.d*n,this.tx=Q*n-this.ty*C,this.ty=Q*C+this.ty*n,this.bTransform=!0},H.skew=function(H,n){var C=Math.tan(H),r=Math.tan(n),N=this.a,Q=this.b;return this.a+=r*this.c,this.b+=r*this.d,this.c+=C*N,this.d+=C*Q,this},H.invertTransformPoint=function(H){var n=this.a,C=this.b,r=this.c,N=this.d,Q=this.tx,I=n*N-C*r,A=N/I,P=-C/I,t=-r/I,R=n/I,y=(r*this.ty-N*Q)/I,o=-(n*this.ty-C*Q)/I;return H.setTo(A*H.x+t*H.y+y,P*H.x+R*H.y+o)},H.transformPoint=function(H){return H.setTo(this.a*H.x+this.c*H.y+this.tx,this.b*H.x+this.d*H.y+this.ty)},H.transformPointN=function(H){return H.setTo(this.a*H.x+this.c*H.y,this.b*H.x+this.d*H.y)},H.transformPointArray=function(H,n){for(var C=H.length,r=0;r<C;r+=2){var N=H[r],Q=H[r+1];n[r]=this.a*N+this.c*Q+this.tx,n[r+1]=this.b*N+this.d*Q+this.ty}return n},H.transformPointArrayScale=function(H,n){for(var C=H.length,r=0;r<C;r+=2){var N=H[r],Q=H[r+1];n[r]=this.a*N+this.c*Q,n[r+1]=this.b*N+this.d*Q}return n},H.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},H.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},H.invert=function(){var H=this.a,n=this.b,C=this.c,r=this.d,N=this.tx,Q=H*r-n*C;return this.a=r/Q,this.b=-n/Q,this.c=-C/Q,this.d=H/Q,this.tx=(C*this.ty-r*N)/Q,this.ty=-(H*this.ty-n*N)/Q,this},H.setTo=function(H,n,C,r,N,Q){return this.a=H,this.b=n,this.c=C,this.d=r,this.tx=N,this.ty=Q,this},H.concat=function(H){var n=this.a,C=this.c,r=this.tx;return this.a=n*H.a+this.b*H.c,this.b=n*H.b+this.b*H.d,this.c=C*H.a+this.d*H.c,this.d=C*H.b+this.d*H.d,this.tx=r*H.a+this.ty*H.c+H.tx,this.ty=r*H.b+this.ty*H.d+H.ty,this},H.scaleEx=function(H,n){var C=this.a,r=this.b,N=this.c,Q=this.d;0!==r||0!==N?(this.a=H*C,this.b=H*r,this.c=n*N):(this.a=H*C,this.b=0*Q,this.c=0*C),this.d=n*Q,this.bTransform=!0},H.rotateEx=function(H){var n=Math.cos(H),C=Math.sin(H),r=this.a,N=this.b,Q=this.c,I=this.d;0!==N||0!==Q?(this.a=n*r+C*Q,this.b=n*N+C*I,this.c=-C*r+n*Q,this.d=-C*N+n*I):(this.a=n*r,this.b=C*I,this.c=-C*r,this.d=n*I),this.bTransform=!0},H.clone=function(){var H=C.create();return H.a=this.a,H.b=this.b,H.c=this.c,H.d=this.d,H.tx=this.tx,H.ty=this.ty,H.bTransform=this.bTransform,H},H.copyTo=function(H){return H.a=this.a,H.b=this.b,H.c=this.c,H.d=this.d,H.tx=this.tx,H.ty=this.ty,H.bTransform=this.bTransform,H},H.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},H.destroy=function(){if(!this.inPool){var H=C._cache;this.inPool=!0,H._length||(H._length=0),(H[H._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},C.mul=function(H,n,C){var r=H.a,N=H.b,Q=H.c,I=H.d,A=H.tx,P=H.ty,t=n.a,R=n.b,y=n.c,o=n.d,g=n.tx,M=n.ty;return 0!==R||0!==y?(C.a=r*t+N*y,C.b=r*R+N*o,C.c=Q*t+I*y,C.d=Q*R+I*o,C.tx=t*A+y*P+g,C.ty=R*A+o*P+M):(C.a=r*t,C.b=N*o,C.c=Q*t,C.d=I*o,C.tx=t*A+g,C.ty=o*P+M),C},C.mul16=function(H,n,C){var r=H.a,N=H.b,Q=H.c,I=H.d,A=H.tx,P=H.ty,t=n.a,R=n.b,y=n.c,o=n.d,g=n.tx,M=n.ty;return 0!==R||0!==y?(C[0]=r*t+N*y,C[1]=r*R+N*o,C[4]=Q*t+I*y,C[5]=Q*R+I*o,C[12]=t*A+y*P+g,C[13]=R*A+o*P+M):(C[0]=r*t,C[1]=N*o,C[4]=Q*t,C[5]=I*o,C[12]=t*A+g,C[13]=o*P+M),C},C.mulPre=function(H,n,C,r,N,Q,I,A){var P=H.a,t=H.b,R=H.c,y=H.d,o=H.tx,g=H.ty;return 0!==C||0!==r?(A.a=P*n+t*r,A.b=P*C+t*N,A.c=R*n+y*r,A.d=R*C+y*N,A.tx=n*o+r*g+Q,A.ty=C*o+N*g+I):(A.a=P*n,A.b=t*N,A.c=R*n,A.d=y*N,A.tx=n*o+Q,A.ty=N*g+I),A},C.mulPos=function(H,n,C,r,N,Q,I,A){var P=H.a,t=H.b,R=H.c,y=H.d,o=H.tx,g=H.ty;return 0!==t||0!==R?(A.a=n*P+C*R,A.b=n*t+C*y,A.c=r*P+N*R,A.d=r*t+N*y,A.tx=P*Q+R*I+o,A.ty=t*Q+y*I+g):(A.a=n*P,A.b=C*y,A.c=r*P,A.d=N*y,A.tx=P*Q+o,A.ty=y*I+g),A},C.preMul=function(H,n,C){var r=H.a,N=H.b,Q=H.c,I=H.d,A=n.a,P=n.b,t=n.c,R=n.d,y=n.tx,o=n.ty;return C.a=A*r,C.b=C.c=0,C.d=R*I,C.tx=y*r+H.tx,C.ty=o*I+H.ty,0===P&&0===t&&0===N&&0===Q||(C.a+=P*Q,C.d+=t*N,C.b+=A*N+P*I,C.c+=t*r+R*Q,C.tx+=o*Q,C.ty+=y*N),C},C.preMulXY=function(H,n,C,r){var N=H.a,Q=H.b,I=H.c,A=H.d;return r.a=N,r.b=Q,r.c=I,r.d=A,r.tx=n*N+H.tx+C*I,r.ty=C*A+H.ty+n*Q,r},C.create=function(){var H=C._cache,n=H._length?H[--H._length]:new C;return n.inPool=!1,n},C.EMPTY=new C,C.TEMP=new C,C._cache=[],C}(),k=function(){function H(H,n){void 0===H&&(H=0),void 0===n&&(n=0),this.x=H,this.y=n}l(H,"laya.maths.Point");var n=H.prototype;return n.setTo=function(H,n){return this.x=H,this.y=n,this},n.distance=function(H,n){return Math.sqrt((this.x-H)*(this.x-H)+(this.y-n)*(this.y-n))},n.toString=function(){return this.x+","+this.y},n.normalize=function(){var H=Math.sqrt(this.x*this.x+this.y*this.y);if(0<H){var n=1/H;this.x*=n,this.y*=n}},H.TEMP=new H,H.EMPTY=new H,H}(),i=function(){function t(H,n,C,r){void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0),this.x=H,this.y=n,this.width=C,this.height=r}l(t,"laya.maths.Rectangle");var H=t.prototype;return H.setTo=function(H,n,C,r){return this.x=H,this.y=n,this.width=C,this.height=r,this},H.copyFrom=function(H){return this.x=H.x,this.y=H.y,this.width=H.width,this.height=H.height,this},H.contains=function(H,n){return!(this.width<=0||this.height<=0)&&(H>=this.x&&H<this.right&&n>=this.y&&n<this.bottom)},H.intersects=function(H){return!(H.x>this.x+this.width||H.x+H.width<this.x||H.y>this.y+this.height||H.y+H.height<this.y)},H.intersection=function(H,n){return this.intersects(H)?(n||(n=new t),n.x=Math.max(this.x,H.x),n.y=Math.max(this.y,H.y),n.width=Math.min(this.right,H.right)-n.x,n.height=Math.min(this.bottom,H.bottom)-n.y,n):null},H.union=function(H,n){return n||(n=new t),this.clone(n),H.width<=0||H.height<=0?n:(n.addPoint(H.x,H.y),n.addPoint(H.right,H.bottom),this)},H.clone=function(H){return H||(H=new t),H.x=this.x,H.y=this.y,H.width=this.width,H.height=this.height,H},H.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},H.equals=function(H){return!(!H||H.x!==this.x||H.y!==this.y||H.width!==this.width||H.height!==this.height)},H.addPoint=function(H,n){return this.x>H&&(this.width+=this.x-H,this.x=H),this.y>n&&(this.height+=this.y-n,this.y=n),this.width<H-this.x&&(this.width=H-this.x),this.height<n-this.y&&(this.height=n-this.y),this},H._getBoundPoints=function(){var H=t._temB;return(H.length=0)==this.width||0==this.height||H.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),H},H.isEmpty=function(){return this.width<=0||this.height<=0},R(0,H,"right",function(){return this.x+this.width}),R(0,H,"bottom",function(){return this.y+this.height}),t._getBoundPointS=function(H,n,C,r){var N=t._temA;return(N.length=0)==C||0==r||N.push(H,n,H+C,n,H,n+r,H+C,n+r),N},t._getWrapRec=function(H,n){if(!H||H.length<1)return n?n.setTo(0,0,0,0):t.TEMP.setTo(0,0,0,0);n=n||new t;var C,r,N,Q,I,A=H.length,P=k.TEMP;for(N=I=-(r=Q=99999),C=0;C<A;C+=2)P.x=H[C],P.y=H[C+1],r=r<P.x?r:P.x,Q=Q<P.y?Q:P.y,N=N>P.x?N:P.x,I=I>P.y?I:P.y;return n.setTo(r,Q,N-r,I-Q)},t.EMPTY=new t,t.TEMP=new t,t._temB=[],t._temA=[],t}(),L=function(){function P(){}return l(P,"laya.media.SoundManager"),R(1,P,"useAudioMusic",function(){return P._useAudioMusic},function(H){P._useAudioMusic=H,P._musicClass=H?CH:null}),R(1,P,"autoStopMusic",function(){return P._autoStopMusic},function(H){F.stage.off("blur",null,P._stageOnBlur),F.stage.off("focus",null,P._stageOnFocus),F.stage.off("visibilitychange",null,P._visibilityChange),(P._autoStopMusic=H)&&(F.stage.on("blur",null,P._stageOnBlur),F.stage.on("focus",null,P._stageOnFocus),F.stage.on("visibilitychange",null,P._visibilityChange))}),R(1,P,"muted",function(){return P._muted},function(H){H!=P._muted&&(H&&P.stopAllSound(),P.musicMuted=H,P._muted=H)}),R(1,P,"musicMuted",function(){return P._musicMuted},function(H){H!=P._musicMuted&&(H?(P._tMusic&&P._musicChannel&&!P._musicChannel.isStopped?P._musicChannel.pause():P._musicChannel=null,P._musicMuted=H):(P._musicMuted=H,P._tMusic&&P._musicChannel&&P._musicChannel.resume()))}),R(1,P,"soundMuted",function(){return P._soundMuted},function(H){P._soundMuted=H}),P.addChannel=function(H){0<=P._channels.indexOf(H)||(P._channels.push(H),P.autoReleaseSound&&0!=P._notUsedCount&&P._notUsedUrls[H.url]&&(delete P._notUsedUrls[H.url],0==--P._notUsedCount&&F.timer.clear(P,P.disposeSoundIfNotUsed)))},P.removeChannel=function(H){var n=P._channels,C=n.indexOf(H);if(-1!=C&&(n.splice(C,1),P.autoReleaseSound)){var r=H.url,N=P.defaultIntervals[r]||2e4;if(0<N){var Q=!0;for(C=n.length-1;0<=C;C--)if(n[C].url==r){Q=!1;break}Q&&(P._notUsedUrls[r]=Date.now()+N,0==P._notUsedCount++&&F.timer.loop(1e4,P,P.disposeSoundIfNotUsed))}}},P.disposeSoundIfNotUsed=function(){var H=P._notUsedUrls;if(0!=P._notUsedCount){var n=Date.now();for(var C in H)n>=H[C]&&(delete H[C],--P._notUsedCount,P.destroySound(C));if(0!=P._notUsedCount)return}F.timer.clear(P,P.disposeSoundIfNotUsed)},P._visibilityChange=function(){F.stage.isVisibility?P._stageOnFocus():P._stageOnBlur()},P._stageOnBlur=function(){P._isActive=!1,P._musicChannel&&(P._musicChannel.isStopped||(P._blurPaused=!0,P._musicChannel.pause())),P.stopAllSound(),F.stage.once("mousedown",null,P._stageOnFocus)},P._recoverWebAudio=function(){QH.ctx&&"running"!=QH.ctx.state&&QH.ctx.resume&&QH.ctx.resume()},P._stageOnFocus=function(){if(P._isActive=!0,P._recoverWebAudio(),F.stage.off("mousedown",null,P._stageOnFocus),P._blurPaused){var H=P._musicChannel;H&&P._music&&H.isStopped&&(P._blurPaused=!1,P._music._disposed?P.playMusic(H.url,H.loops,H.startHandler,H.completeHandler,H.startTime):H.audioBuffer?H.resume():P._music.play(H.startTime,H.loops,H.startHandler,H))}},P.playSound=function(H,n,C,r,N,Q){if(void 0===n&&(n=1),void 0===Q&&(Q=0),!H)return null;if(P._muted)return null;if(P._recoverWebAudio(),H==P._tMusic){if(P._musicMuted)return null}else{if(!P._isActive)return null;if(P._soundMuted)return null}var I,A=P._pool[H];return N||(N=P._soundClass),A||((A=new N).load(H),P._pool[H]=A),(I=A.play(Q,n,C))?(H==P._tMusic&&(P._music=A,P._isActive||(P._blurPaused=!0,I.pause())),I.url=H,I.volume=H==P._tMusic?P.musicVolume:P.soundVolume,I.completeHandler=r,I):null},P.destroySound=function(H){var n=P._pool[H];n&&(delete P._pool[H],n.dispose())},P.playMusic=function(H,n,C,r,N){return void 0===n&&(n=0),void 0===N&&(N=0),P._tMusic=H,P._musicChannel&&P._musicChannel.stop(),P._musicChannel=P.playSound(H,n,C,r,null,N)},P.stopSound=function(H){for(var n,C=P._channels.length-1;0<=C;C--)(n=P._channels[C]).url==H&&n.stop()},P.stopAll=function(){P._tMusic=null;var H=0;for(H=P._channels.length-1;0<=H;H--)P._channels[H].stop()},P.stopAllSound=function(){var H,n=0;for(n=P._channels.length-1;0<=n;n--)(H=P._channels[n]).url!=P._tMusic&&H.stop()},P.stopMusic=function(){P._musicChannel&&P._musicChannel.stop(),P._tMusic=null},P.setSoundVolume=function(H,n){if(n)P._setVolume(n,H);else{P.soundVolume=H;var C,r=0;for(r=P._channels.length-1;0<=r;r--)(C=P._channels[r]).url!=P._tMusic&&(C.volume=H)}},P.setMusicVolume=function(H){P.musicVolume=H,P._setVolume(P._tMusic,H)},P._setVolume=function(H,n){for(var C,r=P._channels.length-1;0<=r;r--)(C=P._channels[r]).url==H&&(C.volume=n)},P.musicVolume=1,P.soundVolume=1,P.playbackRate=1,P._useAudioMusic=!0,P._muted=!1,P._soundMuted=!1,P._musicMuted=!1,P._tMusic=null,P._musicChannel=null,P._music=null,P._channels=[],P._autoStopMusic=!1,P._blurPaused=!1,P._isActive=!0,P._soundClass=null,P._musicClass=null,P.autoReleaseSound=!0,P._pool={},P.defaultIntervals={},P._notUsedUrls={},P._notUsedCount=0,P}(),a=function(){var H;function C(){}return l(C,"laya.net.LocalStorage"),C.__init__=function(){C._baseClass||(C._baseClass=H).init(),C.items=C._baseClass.items,C.support=C._baseClass.support},C.setItem=function(H,n){C._baseClass.setItem(H,n)},C.getItem=function(H){return C._baseClass.getItem(H)},C.setJSON=function(H,n){C._baseClass.setJSON(H,n)},C.getJSON=function(H){return C._baseClass.getJSON(H)},C.removeItem=function(H){C._baseClass.removeItem(H)},C.clear=function(){C._baseClass.clear()},C._baseClass=null,C.items=null,C.support=!1,C.__init$=function(){H=function(){function C(){}return l(C,""),C.init=function(){try{C.support=!0,C.items=g.localStorage,C.setItem("laya","1"),C.removeItem("laya")}catch(H){C.support=!1}C.support||console.log("LocalStorage is not supprot or browser is private mode.")},C.setItem=function(H,n){try{C.support&&C.items.setItem(H,n)}catch(H){console.warn("set localStorage failed",H)}},C.getItem=function(H){return C.support?C.items.getItem(H):null},C.setJSON=function(H,n){try{C.support&&C.items.setItem(H,JSON.stringify(n))}catch(H){console.warn("set localStorage failed",H)}},C.getJSON=function(H){return JSON.parse(C.support?C.items.getItem(H):null)},C.removeItem=function(H){C.support&&C.items.removeItem(H)},C.clear=function(){C.support&&C.items.clear()},C.items=null,C.support=!1,C}()},C}(),v=(function(){function r(){}l(r,"laya.net.ResourceVersion"),r.enable=function(H,n,C){void 0===C&&(C=2),laya.net.ResourceVersion.type=C,F.loader.load(H,c.create(null,r.onManifestLoaded,[n]),null,"json"),e.customFormat=r.addVersionPrefix},r.onManifestLoaded=function(H,n){r.manifest=n,H.run(),n||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},r.addVersionPrefix=function(H){return r.manifest&&r.manifest[H]?2==r.type?r.manifest[H]:r.manifest[H]+"/"+H:H},r.FOLDER_VERSION=1,r.FILENAME_VERSION=2,r.manifest=null,r.type=1}(),function(){function H(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}l(H,"laya.net.TTFLoader");var n=H.prototype;return n.load=function(H){var n=(this._url=H).split(".ttf")[0].split("/");this.fontName=n[n.length-1],_.window.conch?this._loadConch():_.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},n._loadConch=function(){this._http=new IH,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},n._onHttpLoaded=function(H){_.window.conch.setFontFaceFromBuffer(this.fontName,H),this._clearHttp(),this._complete()},n._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},n._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},n._complete=function(){F.timer.clear(this,this._complete),F.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},n._checkComplete=function(){b.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},n._loadWithFontFace=function(){var H=new _.window.FontFace(this.fontName,"url('"+this._url+"')");_.window.document.fonts.add(H);var n=this;H.loaded.then(function(){n._complete()}),H.load()},n._createDiv=function(){this._div=_.createElement("div"),this._div.innerHTML="laya";var H=this._div.style;H.fontFamily=this.fontName,H.position="absolute",H.left="-100px",H.top="-100px",_.document.body.appendChild(this._div)},n._loadWithCSS=function(){var H=this,n=_.createElement("style");n.type="text/css",_.document.body.appendChild(n),n.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=b.measureText("LayaTTFFont",this._fontTxt).width;var C=this;n.onload=function(){F.timer.once(1e4,C,H._complete)},F.timer.loop(20,this,this._checkComplete),this._createDiv()},H._testString="LayaTTFFont",H}()),e=function(){function r(H){this._url=null,this._path=null,this._url=r.formatURL(H),this._path=r.getPath(H)}l(r,"laya.net.URL");var H=r.prototype;return R(0,H,"path",function(){return this._path}),R(0,H,"url",function(){return this._url}),r.formatURL=function(H,n){if(!H)return"null path";if(0<H.indexOf(":"))return H;null!=r.customFormat&&(H=r.customFormat(H,n));var C=H.charAt(0);if("."===C)return r.formatRelativePath((n||r.basePath)+H);if("~"===C)return r.rootPath+H.substring(1);if("d"===C){if(0===H.indexOf("data:image"))return H}else if("/"===C)return H;return(n||r.basePath)+H},r.formatRelativePath=function(H){for(var n=H.split("/"),C=0,r=n.length;C<r;C++)".."==n[C]&&(n.splice(C-1,2),C-=2);return n.join("/")},r.isAbsolute=function(H){return 0<H.indexOf(":")||"/"==H.charAt(0)},r.getPath=function(H){var n=H.lastIndexOf("/");return 0<n?H.substr(0,n+1):""},r.getFileName=function(H){var n=H.lastIndexOf("/");return 0<n?H.substr(n+1):H},r.version={},r.basePath="",r.rootPath="",r.customFormat=function(H){var n=r.version[H];return!Z.isConchApp&&n&&(H+="?v="+n),H},r}(),Z=function(){function N(H,n){this._timeId=0;var C=N._mainCanvas.source.style;C.position="absolute",C.top=C.left="0px",C.background="#000000",N._mainCanvas.source.id="layaCanvas";var r=laya.renders.Render.isWebGL;N._mainCanvas.source.width=H,N._mainCanvas.source.height=n,r&&N.WebGL.init(N._mainCanvas,H,n),_.container.appendChild(N._mainCanvas.source),(N._context=new q(H,n,r?null:N._mainCanvas)).ctx.setIsMainContext(),_.window.requestAnimationFrame(function H(n){_.window.requestAnimationFrame(H);F.stage._loop(n)}),F.stage.on("visibilitychange",this,this._onVisibilitychange)}l(N,"laya.renders.Render");var H=N.prototype;return H._onVisibilitychange=function(){F.stage.isVisibility?0!=this._timeId&&_.window.clearInterval(this._timeId):this._timeId=_.window.setInterval(this._enterFrame,1e3)},H._enterFrame=function(H){F.stage._loop(0)},R(1,N,"context",function(){return N._context}),R(1,N,"canvas",function(){return N._mainCanvas.source}),N._context=null,N._mainCanvas=null,N.WebGL=null,N.isConchNode=!1,N.isConchApp=!1,N.isConchWebGL=!1,N.isWebGL=!1,N.is3DMode=!1,N.optimizeTextureMemory=function(H,n){return!0},N.__init$=function(){g.ConchRenderType=g.ConchRenderType||1,g.ConchRenderType|=g.conch?4:0,N.isConchNode=5==(5&g.ConchRenderType),N.isConchApp=4==(4&g.ConchRenderType),N.isConchWebGL=6==g.ConchRenderType},N}(),q=function(){function I(H,n,C){this.x=0,this.y=0,this._drawTexture=function(H,n,C){C[0].loaded&&this.ctx.drawTexture(C[0],C[1],C[2],C[3],C[4],H,n)},this._fillTexture=function(H,n,C){C[0].loaded&&this.ctx.fillTexture(C[0],C[1]+H,C[2]+n,C[3],C[4],C[5],C[6],C[7])},this._drawTextureWithTransform=function(H,n,C){C[0].loaded&&this.ctx.drawTextureWithTransform(C[0],C[1],C[2],C[3],C[4],C[5],H,n,C[6])},this._fillQuadrangle=function(H,n,C){this.ctx.fillQuadrangle(C[0],C[1],C[2],C[3],C[4])},this._drawRect=function(H,n,C){var r=this.ctx;null!=C[4]&&(r.fillStyle=C[4],r.fillRect(H+C[0],n+C[1],C[2],C[3],null)),null!=C[5]&&(r.strokeStyle=C[5],r.lineWidth=C[6],r.strokeRect(H+C[0],n+C[1],C[2],C[3],C[6]))},this._drawPie=function(H,n,C){var r=this.ctx;Z.isWebGL&&r.setPathId(C[8]),r.beginPath(),Z.isWebGL?(r.movePath(C[0]+H,C[1]+n),r.moveTo(0,0)):r.moveTo(H+C[0],n+C[1]),r.arc(H+C[0],n+C[1],C[2],C[3],C[4]),r.closePath(),this._fillAndStroke(C[5],C[6],C[7],!0)},this._clipRect=function(H,n,C){this.ctx.clipRect(H+C[0],n+C[1],C[2],C[3])},this._fillRect=function(H,n,C){this.ctx.fillRect(H+C[0],n+C[1],C[2],C[3],C[4])},this._drawCircle=function(H,n,C){var r=this.ctx;Z.isWebGL&&r.setPathId(C[6]),G.drawCall++,r.beginPath(),Z.isWebGL&&r.movePath(C[0]+H,C[1]+n),r.arc(C[0]+H,C[1]+n,C[2],0,I.PI2),r.closePath(),this._fillAndStroke(C[3],C[4],C[5],!0)},this._fillCircle=function(H,n,C){G.drawCall++;var r=this.ctx;r.beginPath(),r.fillStyle=C[3],r.arc(C[0]+H,C[1]+n,C[2],0,I.PI2),r.fill()},this._setShader=function(H,n,C){this.ctx.setShader(C[0])},this._drawLine=function(H,n,C){var r=this.ctx;Z.isWebGL&&r.setPathId(C[6]),r.beginPath(),r.strokeStyle=C[4],r.lineWidth=C[5],Z.isWebGL?(r.movePath(H,n),r.moveTo(C[0],C[1]),r.lineTo(C[2],C[3])):(r.moveTo(H+C[0],n+C[1]),r.lineTo(H+C[2],n+C[3])),r.stroke()},this._drawLines=function(H,n,C){var r=this.ctx;Z.isWebGL&&r.setPathId(C[5]),r.beginPath(),H+=C[0],n+=C[1],Z.isWebGL&&r.movePath(H,n),r.strokeStyle=C[3],r.lineWidth=C[4];var N=C[2],Q=2,I=N.length;if(Z.isWebGL)for(r.moveTo(N[0],N[1]);Q<I;)r.lineTo(N[Q++],N[Q++]);else for(r.moveTo(H+N[0],n+N[1]);Q<I;)r.lineTo(H+N[Q++],n+N[Q++]);r.stroke()},this._drawLinesWebGL=function(H,n,C){this.ctx.drawLines(H+this.x+C[0],n+this.y+C[1],C[2],C[3],C[4])},this._drawCurves=function(H,n,C){this.ctx.drawCurves(H,n,C)},this._draw=function(H,n,C){C[0].call(null,this,H,n)},this._transformByMatrix=function(H,n,C){this.ctx.transformByMatrix(C[0])},this._setTransform=function(H,n,C){this.ctx.setTransform(C[0],C[1],C[2],C[3],C[4],C[5])},this._setTransformByMatrix=function(H,n,C){this.ctx.setTransformByMatrix(C[0])},this._save=function(H,n,C){this.ctx.save()},this._restore=function(H,n,C){this.ctx.restore()},this._translate=function(H,n,C){this.ctx.translate(C[0],C[1])},this._transform=function(H,n,C){this.ctx.translate(C[1]+H,C[2]+n);var r=C[0];this.ctx.transform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.ctx.translate(-H-C[1],-n-C[2])},this._rotate=function(H,n,C){this.ctx.translate(C[1]+H,C[2]+n),this.ctx.rotate(C[0]),this.ctx.translate(-H-C[1],-n-C[2])},this._scale=function(H,n,C){this.ctx.translate(C[2]+H,C[3]+n),this.ctx.scale(C[0],C[1]),this.ctx.translate(-H-C[2],-n-C[3])},this._alpha=function(H,n,C){this.ctx.globalAlpha*=C[0]},this._setAlpha=function(H,n,C){this.ctx.globalAlpha=C[0]},this._fillText=function(H,n,C){this.ctx.fillText(C[0],C[1]+H,C[2]+n,C[3],C[4],C[5])},this._strokeText=function(H,n,C){this.ctx.strokeText(C[0],C[1]+H,C[2]+n,C[3],C[4],C[5],C[6])},this._fillBorderText=function(H,n,C){this.ctx.fillBorderText(C[0],C[1]+H,C[2]+n,C[3],C[4],C[5],C[6],C[7])},this._blendMode=function(H,n,C){this.ctx.globalCompositeOperation=C[0]},this._beginClip=function(H,n,C){this.ctx.beginClip&&this.ctx.beginClip(H+C[0],n+C[1],C[2],C[3])},this._setIBVB=function(H,n,C){this.ctx.setIBVB(C[0]+H,C[1]+n,C[2],C[3],C[4],C[5],C[6],C[7])},this._fillTrangles=function(H,n,C){this.ctx.fillTrangles(C[0],C[1]+H,C[2]+n,C[3],C[4])},this._drawPath=function(H,n,C){var r=this.ctx;Z.isWebGL&&r.setPathId(-1),r.beginPath(),H+=C[0],n+=C[1],Z.isWebGL&&r.movePath(H,n);for(var N=C[2],Q=0,I=N.length;Q<I;Q++){var A=N[Q];switch(A[0]){case"moveTo":Z.isWebGL?r.moveTo(A[1],A[2]):r.moveTo(H+A[1],n+A[2]);break;case"lineTo":Z.isWebGL?r.lineTo(A[1],A[2]):r.lineTo(H+A[1],n+A[2]);break;case"arcTo":Z.isWebGL?r.arcTo(A[1],A[2],A[3],A[4],A[5]):r.arcTo(H+A[1],n+A[2],H+A[3],n+A[4],A[5]);break;case"closePath":r.closePath()}}var P=C[3];null!=P&&(r.fillStyle=P.fillStyle,r.fill());var t=C[4];null!=t&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.lineWidth||1,r.lineJoin=t.lineJoin,r.lineCap=t.lineCap,r.miterLimit=t.miterLimit,r.stroke())},this.drawPoly=function(H,n,C){this.ctx.drawPoly(H+this.x+C[0],n+this.y+C[1],C[2],C[3],C[4],C[5],C[6])},this._drawPoly=function(H,n,C){var r=this.ctx,N=C[2],Q=2,I=N.length;if(Z.isWebGL)for(r.setPathId(C[6]),r.beginPath(),H+=C[0],n+=C[1],r.movePath(H,n),r.moveTo(N[0],N[1]);Q<I;)r.lineTo(N[Q++],N[Q++]);else for(r.beginPath(),H+=C[0],n+=C[1],r.moveTo(H+N[0],n+N[1]);Q<I;)r.lineTo(H+N[Q++],n+N[Q++]);r.closePath(),this._fillAndStroke(C[3],C[4],C[5],C[7])},this._drawSkin=function(H,n,C){var r=C[0];if(r){var N=this.ctx;r.render(N,H,n)}},this._drawParticle=function(H,n,C){this.ctx.drawParticle(H+this.x,n+this.y,C[0])},this._setFilters=function(H,n,C){this.ctx.setFilters(C)},C?this.ctx=C.getContext("2d"):(C=KH.create("3D"),this.ctx=b.createWebGLContext2D(C),C._setContext(this.ctx)),C.size(H,n),this.canvas=C}l(I,"laya.renders.RenderContext");var H=I.prototype;return H.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},H.drawTexture=function(H,n,C,r,N){H.loaded&&this.ctx.drawTexture(H,n,C,r,N,this.x,this.y)},H._drawTextures=function(H,n,C){C[0].loaded&&this.ctx.drawTextures(C[0],C[1],H+this.x,n+this.y)},H.drawTextureWithTransform=function(H,n,C,r,N,Q,I){H.loaded&&this.ctx.drawTextureWithTransform(H,n,C,r,N,Q,this.x,this.y,I)},H.fillQuadrangle=function(H,n,C,r,N){this.ctx.fillQuadrangle(H,n,C,r,N)},H.drawCanvas=function(H,n,C,r,N){this.ctx.drawCanvas(H,n+this.x,C+this.y,r,N)},H.drawRect=function(H,n,C,r,N,Q){void 0===Q&&(Q=1);var I=this.ctx;I.strokeStyle=N,I.lineWidth=Q,I.strokeRect(H+this.x,n+this.y,C,r,Q)},H._fillAndStroke=function(H,n,C,r){void 0===r&&(r=!1);var N=this.ctx;null!=H&&(N.fillStyle=H,Z.isWebGL?N.fill(r):N.fill()),null!=n&&0<C&&(N.strokeStyle=n,N.lineWidth=C,N.stroke())},H.clipRect=function(H,n,C,r){this.ctx.clipRect(H+this.x,n+this.y,C,r)},H.fillRect=function(H,n,C,r,N){this.ctx.fillRect(H+this.x,n+this.y,C,r,N)},H.drawCircle=function(H,n,C,r,N){void 0===N&&(N=1),G.drawCall++;var Q=this.ctx;Q.beginPath(),Q.strokeStyle=r,Q.lineWidth=N,Q.arc(H+this.x,n+this.y,C,0,I.PI2),Q.stroke()},H.drawTriangles=function(H,n,C){if(Z.isWebGL)this.ctx.drawTriangles(C[0],H+C[1],n+C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9]);else{var r=C[5],N=0,Q=r.length,I=this.ctx;for(N=0;N<Q;N+=3){var A=2*r[N],P=2*r[N+1],t=2*r[N+2];I.drawTriangle(C[0],C[3],C[4],A,P,t,C[6],!0)}}},H.fillCircle=function(H,n,C,r){G.drawCall++;var N=this.ctx;N.beginPath(),N.fillStyle=r,N.arc(H+this.x,n+this.y,C,0,I.PI2),N.fill()},H.setShader=function(H){this.ctx.setShader(H)},H.drawLine=function(H,n,C,r,N,Q){void 0===Q&&(Q=1);var I=this.ctx;I.beginPath(),I.strokeStyle=N,I.lineWidth=Q,I.moveTo(this.x+H,this.y+n),I.lineTo(this.x+C,this.y+r),I.stroke()},H.clear=function(){this.ctx.clear()},H.transformByMatrix=function(H){this.ctx.transformByMatrix(H)},H.setTransform=function(H,n,C,r,N,Q){this.ctx.setTransform(H,n,C,r,N,Q)},H.setTransformByMatrix=function(H){this.ctx.setTransformByMatrix(H)},H.save=function(){this.ctx.save()},H.restore=function(){this.ctx.restore()},H.translate=function(H,n){this.ctx.translate(H,n)},H.transform=function(H,n,C,r,N,Q){this.ctx.transform(H,n,C,r,N,Q)},H.rotate=function(H){this.ctx.rotate(H)},H.scale=function(H,n){this.ctx.scale(H,n)},H.alpha=function(H){this.ctx.globalAlpha*=H},H.setAlpha=function(H){this.ctx.globalAlpha=H},H.fillWords=function(H,n,C,r,N,Q){void 0===Q&&(Q=0),this.ctx.fillWords(H,n,C,r,N,Q)},H.fillBorderWords=function(H,n,C,r,N,Q,I){this.ctx.fillBorderWords(H,n,C,r,N,Q,I)},H.fillText=function(H,n,C,r,N,Q){this.ctx.fillText(H,n+this.x,C+this.y,r,N,Q)},H.strokeText=function(H,n,C,r,N,Q,I){this.ctx.strokeText(H,n+this.x,C+this.y,r,N,Q,I)},H.blendMode=function(H){this.ctx.globalCompositeOperation=H},H.flush=function(){this.ctx.flush&&this.ctx.flush()},H.addRenderObject=function(H){this.ctx.addRenderObject(H)},H.beginClip=function(H,n,C,r){this.ctx.beginClip&&this.ctx.beginClip(H,n,C,r)},H.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},H.fillTrangles=function(H,n,C){this.ctx.fillTrangles(C[0],C[1],C[2],C[3],4<C.length?C[4]:null)},I.PI2=2*Math.PI,I}(),p=function(){function I(H,n){switch(this._next=n||I.NORENDER,H){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=K._filter);case 69905:return void(this._fun=I._initRenderFun)}this.onCreate(H)}l(I,"laya.renders.RenderSprite");var H=I.prototype;return H.onCreate=function(H){},H._style=function(H,n,C,r){H._style.render(H,n,C,r);var N=this._next;N._fun.call(N,H,n,C,r)},H._no=function(H,n,C,r){},H._custom=function(H,n,C,r){H.customRender(n,C,r);var N=H._style._tf;this._next._fun.call(this._next,H,n,C-N.translateX,r-N.translateY)},H._clip=function(H,n,C,r){var N=this._next;if(N!=I.NORENDER){var Q=H._style.scrollRect;n.ctx.save(),n.ctx.clipRect(C,r,Q.width,Q.height),N._fun.call(N,H,n,C-Q.x,r-Q.y),n.ctx.restore()}},H._blend=function(H,n,C,r){var N=H._style;N.blendMode&&(n.ctx.globalCompositeOperation=N.blendMode);var Q=this._next;Q._fun.call(Q,H,n,C,r),n.ctx.globalCompositeOperation="source-over"},H._mask=function(H,n,C,r){var N=this._next;N._fun.call(N,H,n,C,r);var Q=H.mask;Q&&(n.ctx.globalCompositeOperation="destination-in",(0<Q.numChildren||!Q.graphics._isOnlyOne())&&(Q.cacheAsBitmap=!0),Q.render(n,C-H.pivotX,r-H.pivotY)),n.ctx.globalCompositeOperation="source-over"},H._graphics=function(H,n,C,r){var N=H._style._tf;H._graphics&&H._graphics._render(H,n,C-N.translateX,r-N.translateY);var Q=this._next;Q._fun.call(Q,H,n,C,r)},H._image=function(H,n,C,r){var N=H._style;n.ctx.drawTexture2(C,r,N._tf.translateX,N._tf.translateY,H.transform,N.alpha,N.blendMode,H._graphics._one)},H._image2=function(H,n,C,r){var N=H._style._tf;n.ctx.drawTexture2(C,r,N.translateX,N.translateY,H.transform,1,null,H._graphics._one)},H._alpha=function(H,n,C,r){var N;if(.01<(N=H._style.alpha)||H._needRepaint()){var Q=n.ctx.globalAlpha;n.ctx.globalAlpha*=N;var I=this._next;I._fun.call(I,H,n,C,r),n.ctx.globalAlpha=Q}},H._transform=function(H,n,C,r){var N=H.transform,Q=this._next;N&&Q!=I.NORENDER?(n.save(),n.transform(N.a,N.b,N.c,N.d,N.tx+C,N.ty+r),Q._fun.call(Q,H,n,0,0),n.restore()):Q._fun.call(Q,H,n,C,r)},H._childs=function(H,n,C,r){var N=H._style,Q=N._tf;if(C=C-Q.translateX+N.paddingLeft,r=r-Q.translateY+N.paddingTop,N._calculation){var I=H._getWords();if(I){var A=N;A&&(A.stroke?n.fillBorderWords(I,C,r,A.font,A.color,A.strokeColor,A.stroke):n.fillWords(I,C,r,A.font,A.color,"none"!=A.textDecoration&&A.underLine?1:0))}}var P,t=H._childs,R=t.length;if(H.viewport||H.optimizeScrollRect&&H._style.scrollRect){var y=H.viewport||H._style.scrollRect,o=y.x,g=y.y,M=y.right,j=y.bottom,l=NaN,f=NaN;for(c=0;c<R;++c)(P=t[c]).visible&&(l=P._x)<M&&l+P.width>o&&(f=P._y)<j&&f+P.height>g&&P.render(n,C,r)}else for(var c=0;c<R;++c)(P=t[c])._style.visible&&P.render(n,C,r)},H._canvas=function(H,n,C,r){var N=H._$P.cacheCanvas;if(N){"bitmap"===N.type?G.canvasBitmap++:G.canvasNormal++;var Q=N.ctx;if(H._needRepaint()||!Q)this._canvas_repaint(H,n,C,r);else{var I=N._cacheRec;n.drawCanvas(Q.canvas,C+I.x,r+I.y,I.width,I.height)}}else this._next._fun.call(this._next,H,n,C,r)},H._canvas_repaint=function(H,n,C,r){var N=H._$P.cacheCanvas,Q=this._next;if(N){var I,A,P,t,R=N.ctx,y=H._needRepaint()||!R,o=N.type;if("bitmap"===o?G.canvasBitmap++:G.canvasNormal++,y){var g,M;N._cacheRec||(N._cacheRec=new i),Z.isWebGL&&"bitmap"!==o?N._cacheRec.setTo(-H.pivotX,-H.pivotY,1,1):((t=H.getSelfBounds()).x=t.x-H.pivotX,t.y=t.y-H.pivotY,t.x=t.x-16,t.y=t.y-16,t.width=t.width+32,t.height=t.height+32,t.x=Math.floor(t.x+C)-C,t.y=Math.floor(t.y+r)-r,t.width=Math.floor(t.width),t.height=Math.floor(t.height),N._cacheRec.copyFrom(t)),t=N._cacheRec;var j,l=Z.isWebGL?1:_.pixelRatio*F.stage.clientScaleX,f=Z.isWebGL?1:_.pixelRatio*F.stage.clientScaleY;if(!Z.isWebGL){var c,K=1,W=1;for(c=H;c&&c!=F.stage;)K*=c.scaleX,W*=c.scaleY,c=c.parent;Z.isWebGL?(K<1&&(l*=K),W<1&&(f*=W)):(1<K&&(l*=K),1<W&&(f*=W))}if(H.scrollRect){var z=H.scrollRect;t.x-=z.x,t.y-=z.y}if(g=t.width*l,M=t.height*f,A=t.x,P=t.y,Z.isWebGL&&"bitmap"===o&&(2048<g||2048<M))return console.warn("cache bitmap size larger than 2048,cache ignored"),N.ctx&&(E.recover("RenderContext",N.ctx),N.ctx.canvas.size(0,0),N.ctx=null),void Q._fun.call(Q,H,n,C,r);if(R||(R=N.ctx=E.getItem("RenderContext")||new q(g,M,KH.create("AUTO"))),R.ctx.sprite=H,(I=R.canvas).clear(),(I.width!=g||I.height!=M)&&I.size(g,M),"bitmap"===o?I.context.asBitmap=!0:"normal"===o&&(I.context.asBitmap=!1),1!=l||1!=f){var w=R.ctx;w.save(),w.scale(l,f),!Z.isConchWebGL&&Z.isConchApp&&(j=H._$P.cf)&&w.setFilterMatrix&&w.setFilterMatrix(j._mat,j._alpha),Q._fun.call(Q,H,R,-A,-P),w.restore(),Z.isConchApp&&!Z.isConchWebGL||H._applyFilters()}else w=R.ctx,!Z.isConchWebGL&&Z.isConchApp&&(j=H._$P.cf)&&w.setFilterMatrix&&w.setFilterMatrix(j._mat,j._alpha),Q._fun.call(Q,H,R,-A,-P),Z.isConchApp&&!Z.isConchWebGL||H._applyFilters();H._$P.staticCache&&(N.reCache=!1),G.canvasReCache++}else A=(t=N._cacheRec).x,P=t.y,I=R.canvas;n.drawCanvas(I,C+A,r+P,t.width,t.height)}else Q._fun.call(Q,H,R,C,r)},I.__init__=function(){var H,n,C=0;for(n=b.createRenderSprite(69905,null),H=I.renders.length=4096,C=0;C<H;C++)I.renders[C]=n;I.renders[0]=b.createRenderSprite(0,null),function(H,n){for(var C=0,r=0;r<H.length;r++)C|=H[r],I.renders[C]=n}([1,512,4,2],new I(1,null)),I.renders[513]=b.createRenderSprite(513,null),I.renders[517]=new I(517,null)},I._initRenderFun=function(H,n,C,r){var N=H._renderType;(I.renders[N]=I._getTypeRender(N))._fun(H,n,C,r)},I._getTypeRender=function(H){for(var n=null,C=2048;1<C;)C&H&&(n=b.createRenderSprite(C,n)),C>>=1;return n},I.IMAGE=1,I.ALPHA=2,I.TRANSFORM=4,I.BLEND=8,I.CANVAS=16,I.FILTERS=32,I.MASK=64,I.CLIP=128,I.STYLE=256,I.GRAPHICS=512,I.CUSTOM=1024,I.CHILDS=2048,I.INIT=69905,I.renders=[],I.NORENDER=new I(0,null),I}(),m=function(){function A(){this._repaint=!1}l(A,"laya.resource.Context");var H=A.prototype;return H.replaceReset=function(){var H,n,C=0;for(H=A.replaceKeys.length,C=0;C<H;C++)n=A.replaceKeys[C],this[A.newKeys[C]]=this[n]},H.replaceResotre=function(){this.__restore(),this.__reset()},H.setIsMainContext=function(){},H.drawTextures=function(H,n,C,r){G.drawCall+=n.length/2;for(var N=H.width,Q=H.height,I=0,A=n.length;I<A;I+=2)this.drawTexture(H,n[I],n[I+1],N,Q,C,r)},H.drawCanvas=function(H,n,C,r,N){G.drawCall++,this.drawImage(H.source,n,C,r,N)},H.fillRect=function(H,n,C,r,N){G.drawCall++,N&&(this.fillStyle=N),this.__fillRect(H,n,C,r)},H.fillText=function(H,n,C,r,N,Q){G.drawCall++,3<arguments.length&&null!=r&&(this.font=r,this.fillStyle=N,this.textAlign=Q,this.textBaseline="top"),this.__fillText(H,n,C)},H.fillBorderText=function(H,n,C,r,N,Q,I,A){G.drawCall++,this.font=r,this.fillStyle=N,this.textBaseline="top",this.strokeStyle=Q,this.lineWidth=I,this.textAlign=A,this.__strokeText(H,n,C),this.__fillText(H,n,C)},H.strokeText=function(H,n,C,r,N,Q,I){G.drawCall++,3<arguments.length&&null!=r&&(this.font=r,this.strokeStyle=N,this.lineWidth=Q,this.textAlign=I,this.textBaseline="top"),this.__strokeText(H,n,C)},H.transformByMatrix=function(H){this.transform(H.a,H.b,H.c,H.d,H.tx,H.ty)},H.setTransformByMatrix=function(H){this.setTransform(H.a,H.b,H.c,H.d,H.tx,H.ty)},H.clipRect=function(H,n,C,r){G.drawCall++,this.beginPath(),this.rect(H,n,C,r),this.clip()},H.drawTexture=function(H,n,C,r,N,Q,I){G.drawCall++;var A=H.uv,P=H.bitmap.width,t=H.bitmap.height;this.drawImage(H.source,A[0]*P,A[1]*t,(A[2]-A[0])*P,(A[5]-A[3])*t,n+Q,C+I,r,N)},H.drawTextureWithTransform=function(H,n,C,r,N,Q,I,A,P){G.drawCall++;var t=H.uv,R=H.bitmap.width,y=H.bitmap.height;this.save(),1!=P&&(this.globalAlpha*=P),Q?(this.transform(Q.a,Q.b,Q.c,Q.d,Q.tx+I,Q.ty+A),this.drawImage(H.source,t[0]*R,t[1]*y,(t[2]-t[0])*R,(t[5]-t[3])*y,n,C,r,N)):this.drawImage(H.source,t[0]*R,t[1]*y,(t[2]-t[0])*R,(t[5]-t[3])*y,n+I,C+A,r,N),this.restore()},H.drawTexture2=function(H,n,C,r,N,Q,I,A){var P=A[0];if(P.loaded&&P.bitmap&&P.source){G.drawCall++;var t=1!==Q;if(t){var R=this.globalAlpha;this.globalAlpha*=Q}var y=P.uv,o=P.bitmap.width,g=P.bitmap.height;N?(this.save(),this.transform(N.a,N.b,N.c,N.d,N.tx+H,N.ty+n),this.drawImage(P.source,y[0]*o,y[1]*g,(y[2]-y[0])*o,(y[5]-y[3])*g,A[1]-C,A[2]-r,A[3],A[4]),this.restore()):this.drawImage(P.source,y[0]*o,y[1]*g,(y[2]-y[0])*o,(y[5]-y[3])*g,A[1]-C+H,A[2]-r+n,A[3],A[4]),t&&(this.globalAlpha=R)}},H.fillTexture=function(H,n,C,r,N,Q,I,A){if(!A.pat){if(H.uv!=RH.DEF_UV){var P=new KH("2D");P.getContext("2d"),P.size(H.width,H.height),P.context.drawTexture(H,0,0,H.width,H.height,0,0),H=new RH(P)}A.pat=this.createPattern(H.bitmap.source,Q)}var t=n,R=C,y=0,o=0;I&&(t+=I.x%H.width,R+=I.y%H.height,y-=I.x%H.width,o-=I.y%H.height),this.translate(t,R),this.fillRect(y,o,r,N,A.pat),this.translate(-t,-R)},H.drawTriangle=function(H,n,C,r,N,Q,I,A){var P=H.bitmap,t=P.source,R=H.width,y=H.height,o=P.width,g=P.height,M=C[r]*o,j=C[N]*o,l=C[Q]*o,f=C[r+1]*g,c=C[N+1]*g,K=C[Q+1]*g,W=n[r],z=n[N],w=n[Q],F=n[r+1],k=n[N+1],i=n[Q+1];if(A){var a=(W+z+w)/3,D=(F+k+i)/3,L=W-a,b=F-D,h=Math.sqrt(L*L+b*b);W=a+L/h*(h+1),F=D+b/h*(h+1),b=k-D,z=a+(L=z-a)/(h=Math.sqrt(L*L+b*b))*(h+1),k=D+b/h*(h+1),b=i-D,w=a+(L=w-a)/(h=Math.sqrt(L*L+b*b))*(h+1),i=D+b/h*(h+1)}this.save(),I&&this.transform(I.a,I.b,I.c,I.d,I.tx,I.ty),this.beginPath(),this.moveTo(W,F),this.lineTo(z,k),this.lineTo(w,i),this.closePath(),this.clip();var v=1/(M*c+f*l+j*K-c*l-f*j-M*K),e=W*c+f*w+z*K-c*w-f*z-W*K,Z=M*z+W*l+j*w-z*l-W*j-M*w,q=M*c*w+f*z*l+W*j*K-W*c*l-f*j*w-M*z*K,p=F*c+f*i+k*K-c*i-f*k-F*K,m=M*k+F*l+j*i-k*l-F*j-M*i,d=M*c*i+f*k*l+F*j*K-F*c*l-f*j*i-M*k*K;this.transform(e*v,p*v,Z*v,m*v,q*v,d*v),this.drawImage(t,H.uv[0]*o,H.uv[1]*g,R,y,H.uv[0]*o,H.uv[1]*g,R,y),this.restore()},H.flush=function(){return 0},H.fillWords=function(H,n,C,r,N,Q){r&&(this.font=r),N&&(this.fillStyle=N);this.textBaseline="top",this.textAlign="left";for(var I=0,A=H.length;I<A;I++){var P=H[I];if(this.__fillText(P.char,P.x+n,P.y+C),1===Q){var t=P.height,R=.5*P.style.letterSpacing;R||(R=0),this.beginPath(),this.strokeStyle=N,this.lineWidth=1,this.moveTo(n+P.x-R+.5,C+P.y+t+.5),this.lineTo(n+P.x+P.width+R+.5,C+P.y+t+.5),this.stroke()}}},H.fillBorderWords=function(H,n,C,r,N,Q,I){r&&(this.font=r),N&&(this.fillStyle=N),this.textBaseline="top",this.lineWidth=I,this.textAlign="left",this.strokeStyle=Q;for(var A=0,P=H.length;A<P;A++){var t=H[A];this.__strokeText(t.char,t.x+n,t.y+C),this.__fillText(t.char,t.x+n,t.y+C)}},H.destroy=function(){this.canvas.width=this.canvas.height=0},H.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},H.drawCurves=function(H,n,C){this.beginPath(),this.strokeStyle=C[3],this.lineWidth=C[4];var r=C[2];H+=C[0],n+=C[1],this.moveTo(H+r[0],n+r[1]);for(var N=2,Q=r.length;N<Q;)this.quadraticCurveTo(H+r[N++],n+r[N++],H+r[N++],n+r[N++]);this.stroke()},A.__init__=function(n){var C=laya.resource.Context.prototype;if(!(n=n||CanvasRenderingContext2D.prototype).inited){n.inited=!0,n.__fillText=n.fillText,n.__fillRect=n.fillRect,n.__strokeText=n.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(H){n[H]=C[H]})}},A.replaceCanvasGetSet=function(H,n){var C=Object.getOwnPropertyDescriptor(H,n);if(!C||!C.configurable)return!1;var r,N={};for(r in C)"set"!=r&&(N[r]=C[r]);var Q=C.set;return N.set=function(H){Q.call(this,H);var n=this.getContext("2d");n&&"__reset"in n&&n.__reset()},Object.defineProperty(H,n,N),!0},A.replaceGetSet=function(H,n){var C=Object.getOwnPropertyDescriptor(H,n);if(!C||!C.configurable)return!1;var r,N={};for(r in C)"set"!=r&&(N[r]=C[r]);var Q=C.set,I="___"+n+"__";return A.newKeys.push(I),N.set=function(H){H!=this[I]&&(this[I]=H,Q.call(this,H))},Object.defineProperty(H,n,N),!0},A._default=new A,A.newKeys=[],P(A,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),A}(),d=function(){function Q(H){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++Q._uniqueIDCounter,this._name=H||"Content Manager",Q._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,Q._resourceManagers.push(this),this._resources=[],this._records={}}l(Q,"laya.resource.ResourceManager");var H=Q.prototype;return F.imps(H,{"laya.resource.IDispose":!0}),H.getResourceByIndex=function(H){return this._resources[H]},H.getResourcesLength=function(){return this._resources.length},H.addResource=function(H){return H.resourceManager&&H.resourceManager.removeResource(H),-1===this._resources.indexOf(H)&&((H._resourceManager=this)._resources.push(H),this.addRecord(H.uri,H.__className,H.memorySize),this.addSize(H.memorySize),!0)},H.removeResource=function(H){var n=this._resources.indexOf(H);return-1!==n&&(this._resources.splice(n,1),H._resourceManager=null,this._memorySize-=H.memorySize,this.addRecord(H.uri,H.__className,-H.memorySize),!0)},H.unload=function(){for(var H=this._resources.slice(0,this._resources.length),n=0;n<H.length;n++){H[n].destroy()}H.length=0},H.dispose=function(){if(this===Q._systemResourceManager)throw new Error("systemResourceManager不能被释放！");Q._resourceManagers.splice(Q._resourceManagers.indexOf(this),1),Q._isResourceManagersSorted=!1;for(var H=this._resources.slice(0,this._resources.length),n=0;n<H.length;n++){var C=H[n];C.resourceManager.removeResource(C),C.destroy()}H.length=0},H.addSize=function(H){H&&(this.autoRelease&&0<H&&this._memorySize+H>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=H)},H.addRecord=function(H,n,C){DEBUG&&C&&!H&&console.error(H,n,C)},H.garbageCollection=function(H){var n=this._resources;(n=n.slice()).sort(function(H,n){if(!H||!n)throw new Error("a或b不能为空！");return H.released&&n.released?0:H.released?1:n.released?-1:H._lastUseFrameCount-n._lastUseFrameCount});for(var C=G.loopCount,r=0,N=n.length;r<N;r++){var Q=n[r];if(!(1<C-Q._lastUseFrameCount))return void(this._memorySize>=H&&(this._isOverflow=!0));if(Q.releaseResource(),this._memorySize<H)return void(this._isOverflow=!1)}},R(0,H,"id",function(){return this._id}),R(0,H,"name",function(){return this._name},function(H){!H&&""===H||this._name===H||(this._name=H,Q._isResourceManagersSorted=!1)}),R(0,H,"memorySize",function(){return this._memorySize}),R(0,H,"records",function(){return this._records}),R(1,Q,"systemResourceManager",function(){return Q._systemResourceManager}),Q.__init__=function(){Q.currentResourceManager=Q.systemResourceManager},Q.getLoadedResourceManagerByIndex=function(H){return Q._resourceManagers[H]},Q.getLoadedResourceManagersCount=function(){return Q._resourceManagers.length},Q.recreateContentManagers=function(H){void 0===H&&(H=!1);for(var n=Q.currentResourceManager,C=0;C<Q._resourceManagers.length;C++){Q.currentResourceManager=Q._resourceManagers[C];for(var r=0;r<Q.currentResourceManager._resources.length;r++)Q.currentResourceManager._resources[r].releaseResource(H),Q.currentResourceManager._resources[r].activeResource(H)}Q.currentResourceManager=n},Q.releaseContentManagers=function(H){void 0===H&&(H=!1);for(var n=Q.currentResourceManager,C=0;C<Q._resourceManagers.length;C++){Q.currentResourceManager=Q._resourceManagers[C];for(var r=0;r<Q.currentResourceManager._resources.length;r++){var N=Q.currentResourceManager._resources[r];!N.released&&N.releaseResource(H)}}Q.currentResourceManager=n},Q._uniqueIDCounter=0,Q._isResourceManagersSorted=!1,Q._resourceManagers=[],P(Q,["_systemResourceManager",function(){return this._systemResourceManager=new Q("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=Q._systemResourceManager}]),Q}(),_=(function(){function H(){}l(H,"laya.system.System"),H.changeDefinition=function(H,n){F[H]=n;var C=H+"=classObj";F._runScript(C)},H.__init__=function(){Z.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function C(){}return l(C,"laya.utils.Browser"),R(1,C,"pixelRatio",function(){return C.__init__(),-1<C.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:b.getPixelRatio()}),R(1,C,"height",function(){return C.__init__(),(F.stage&&F.stage.canvasRotation?C.clientWidth:C.clientHeight)*C.pixelRatio}),R(1,C,"clientWidth",function(){return C.__init__(),C.window.innerWidth||C.document.body.clientWidth}),R(1,C,"window",function(){return C.__init__(),C._window}),R(1,C,"clientHeight",function(){return C.__init__(),C.window.innerHeight||C.document.body.clientHeight||C.document.documentElement.clientHeight}),R(1,C,"width",function(){return C.__init__(),(F.stage&&F.stage.canvasRotation?C.clientHeight:C.clientWidth)*C.pixelRatio}),R(1,C,"container",function(){return C.__init__(),C._container||((C._container=C.createElement("div")).id="layaContainer",C.document.body.appendChild(C._container)),C._container},function(H){C._container=H}),R(1,C,"document",function(){return C.__init__(),C._document}),C.__init__=function(){if(!C._window){C._window=b.getWindow(),C._document=C.window.document,C._window.addEventListener("message",function(H){laya.utils.Browser._onMessage(H)},!1),C.document.__createElement=C.document.createElement,g.requestAnimationFrame=g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(H){return g.setTimeout(H,1e3/60)};var H=g.document.body.style;H["-webkit-user-select"]="none",H["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",C.userAgent=C.window.navigator.userAgent,C.onIOS=!!(C.u=C.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),C.onMobile=-1<C.u.indexOf("Mobile"),C.onIPhone=-1<C.u.indexOf("iPhone"),C.onMac=-1<C.u.indexOf("Mac OS X"),C.onIPad=-1<C.u.indexOf("iPad"),C.onAndroid=-1<C.u.indexOf("Android")||-1<C.u.indexOf("Adr"),C.onWP=-1<C.u.indexOf("Windows Phone"),C.onQQBrowser=-1<C.u.indexOf("QQBrowser"),C.onMQQBrowser=-1<C.u.indexOf("MQQBrowser")||-1<C.u.indexOf("Mobile")&&-1<C.u.indexOf("QQ"),C.onIE=!!C.window.ActiveXObject||"ActiveXObject"in C.window,C.onWeiXin=-1<C.u.indexOf("MicroMessenger"),C.onPC=!C.onMobile,C.onSafari=-1<C.u.indexOf("Safari"),C.onFirefox=-1<C.u.indexOf("Firefox"),C.onEdge=-1<C.u.indexOf("Edge"),C.onMiniGame=-1<C.u.indexOf("MiniGame"),C.onLimixiu=-1<C.u.indexOf("limixiu"),C.httpProtocol="http:"==C.window.location.protocol,C.onMiniGame&&null==C.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),C.webAudioEnabled=!!(C.window.AudioContext||C.window.webkitAudioContext||C.window.mozAudioContext),C.soundType=C.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",NH=C.webAudioEnabled?QH:CH,C.webAudioEnabled&&QH.initWebAudio(),CH._initMusicAudio(),C.enableTouch="ontouchstart"in g||g.DocumentTouch&&n instanceof DocumentTouch,g.focus(),L._soundClass=NH,L._musicClass=CH,Z._mainCanvas=Z._mainCanvas||KH.create("2D"),C.canvas||(C.canvas=KH.create("2D"),C.context=C.canvas.getContext("2d"))}},C._onMessage=function(H){if(H.data&&"size"==H.data.name){if(C.window.innerWidth=H.data.width,C.window.innerHeight=H.data.height,C.window.__innerHeight=H.data.clientHeight,!C.document.createEvent)return void console.warn("no document.createEvent");var n=C.document.createEvent("HTMLEvents");return n.initEvent("resize",!1,!1),void C.window.dispatchEvent(n)}},C.createElement=function(H){return C.__init__(),C.document.__createElement(H)},C.getElementById=function(H){return C.__init__(),C.document.getElementById(H)},C.removeElement=function(H){H&&H.parentNode&&H.parentNode.removeChild(H)},C.now=function(){return b.now()},C._window=null,C._document=null,C._container=null,C.userAgent=null,C.u=null,C.onIOS=!1,C.onMac=!1,C.onMobile=!1,C.onIPhone=!1,C.onIPad=!1,C.onAndroid=!1,C.onWP=!1,C.onQQBrowser=!1,C.onMQQBrowser=!1,C.onSafari=!1,C.onFirefox=!1,C.onEdge=!1,C.onIE=!1,C.onWeiXin=!1,C.onMiniGame=!1,C.onLimixiu=!1,C.onPC=!1,C.httpProtocol=!1,C.webAudioEnabled=!1,C.soundType=null,C.enableTouch=!1,C.canvas=null,C.context=null,C.__init$=function(){},C}()),U=function(){function n(H){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,H?(this._u8d_=new Uint8Array(H),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}l(n,"laya.utils.Byte");var H=n.prototype;return H.___resizeBuffer=function(n){try{var H=new Uint8Array(n);null!=this._u8d_&&(this._u8d_.length<=n?H.set(this._u8d_):H.set(this._u8d_.subarray(0,n))),this._u8d_=H,this._d_=new DataView(H.buffer)}catch(H){throw"___resizeBuffer err:"+n}},H.getString=function(){return this.rUTF(this.getUint16())},H.getFloat32Array=function(H,n){var C=H+n;C=C>this._length?this._length:C;var r=new Float32Array(this._d_.buffer.slice(H,C));return this._pos_=C,r},H.getUint8Array=function(H,n){var C=H+n;C=C>this._length?this._length:C;var r=new Uint8Array(this._d_.buffer.slice(H,C));return this._pos_=C,r},H.getInt16Array=function(H,n){var C=H+n;C=C>this._length?this._length:C;var r=new Int16Array(this._d_.buffer.slice(H,C));return this._pos_=C,r},H.getFloat32=function(){if(this._pos_+4>this._length)throw new Error("getFloat32 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var H=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,H},H.getFloat64=function(){if(this._pos_+8>this._length)throw new Error("getFloat64 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var H=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,H},H.writeFloat32=function(H){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,H,this._xd_),this._pos_+=4},H.writeFloat64=function(H){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,H,this._xd_),this._pos_+=8},H.getInt32=function(){if(this._pos_+4>this._length)throw new Error("getInt32 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var H=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,H},H.getUint32=function(){if(this._pos_+4>this._length)throw new Error("getUint32 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var H=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,H},H.writeInt32=function(H){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,H,this._xd_),this._pos_+=4},H.writeUint32=function(H){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,H,this._xd_),this._pos_+=4},H.getInt16=function(){if(this._pos_+2>this._length)throw new Error("getInt16 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var H=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,H},H.getUint16=function(){if(this._pos_+2>this._length)throw new Error("getUint16 error - Out of bounds, pos="+this._pos_+"， length="+this._length);var H=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,H},H.writeUint16=function(H){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,H,this._xd_),this._pos_+=2},H.writeInt16=function(H){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,H,this._xd_),this._pos_+=2},H.getUint8=function(){if(this._pos_+1>this._length)throw new Error("getUint8 error - Out of bounds, pos="+this._pos_+"， length="+this._length);return this._d_.getUint8(this._pos_++)},H.writeUint8=function(H){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,H),this._pos_++},H._getUInt8=function(H){return this._d_.getUint8(H)},H._getUint16=function(H){return this._d_.getUint16(H,this._xd_)},H._getMatrix=function(){return new h(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},H.rUTF=function(H){for(var n=[],C=this._pos_+H,r=0,N=0,Q=0,I=String.fromCharCode,A=this._u8d_;this._pos_<C;)(r=A[this._pos_++])<128?0!=r&&n.push(I(r)):r<224?n.push(I((63&r)<<6|127&A[this._pos_++])):r<240?(N=A[this._pos_++],n.push(I((31&r)<<12|(127&N)<<6|127&A[this._pos_++]))):(N=A[this._pos_++],Q=A[this._pos_++],n.push(I((15&r)<<18|(127&N)<<12|Q<<6&127|127&A[this._pos_++]))),0;return n.join("")},H.getCustomString=function(H){for(var n=[],C=0,r=0,N=0,Q=String.fromCharCode,I=this._u8d_;0<H;)if((r=I[this._pos_])<128)n.push(Q(r)),this._pos_++,H--;else for(C=r-128,this._pos_++,H-=C;0<C;)r=I[this._pos_++],N=I[this._pos_++],n.push(Q(N<<8|r)),C--;return n.join("")},H.clear=function(){this._pos_=0,this.length=0},H.__getBuffer=function(){return this._d_.buffer},H.writeUTFBytes=function(H){for(var n=0,C=(H+="").length;n<C;n++){var r=H.charCodeAt(n);r<=127?this.writeByte(r):r<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|r>>6,128|63&r],this._pos_),this._pos_+=2):r<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|r>>12,128|r>>6&63,128|63&r],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r],this._pos_),this._pos_+=4)}},H.writeUTFString=function(H){var n=this.pos;this.writeUint16(1),this.writeUTFBytes(H);var C=this.pos-n-2;if(65536<=C)throw new Error("writeUTFString byte len more than 65536");this._d_.setUint16(n,C,this._xd_)},H.readUTFString=function(){return this.readUTFBytes(this.getUint16())},H.getUTFString=function(){return this.readUTFString()},H.readUTFBytes=function(H){if(void 0===H&&(H=-1),0==H)return"";var n=this.bytesAvailable;if(n<H)throw new Error("readUTFBytes error - Out of bounds, pos="+this._pos_+"， length="+this._length);return H=0<H?H:n,this.rUTF(H)},H.getUTFBytes=function(H){return void 0===H&&(H=-1),this.readUTFBytes(H)},H.writeByte=function(H){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,H),this._pos_+=1},H.readByte=function(){if(this._pos_+1>this._length)throw new Error("readByte error - Out of bounds, pos="+this._pos_+"， length="+this._length);return this._d_.getInt8(this._pos_++)},H.getByte=function(){return this.readByte()},H.ensureWrite=function(H){this._length<H&&(this._length=H),this._allocated_<H&&(this.length=H)},H.writeArrayBuffer=function(H,n,C){if(void 0===n&&(n=0),void 0===C&&(C=0),n<0||C<0)throw new Error("writeArrayBuffer error - Out of bounds");0==C&&(C=H.byteLength-n),this.ensureWrite(this._pos_+C);var r=new Uint8Array(H);this._u8d_.set(r.subarray(n,n+C),this._pos_),this._pos_+=C},R(0,H,"buffer",function(){var H=this._d_.buffer;return H.byteLength==this.length?H:H.slice(0,this.length)}),R(0,H,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(H){this._xd_="littleEndian"==H}),R(0,H,"length",function(){return this._length},function(H){this._allocated_<H?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(H,2*this._allocated_))):this._allocated_>H&&this.___resizeBuffer(this._allocated_=H),this._length=H}),R(0,H,"pos",function(){return this._pos_},function(H){this._pos_=H}),R(0,H,"bytesAvailable",function(){return this._length-this._pos_}),n.getSystemEndian=function(){if(!n._sysEndian){var H=new ArrayBuffer(2);new DataView(H).setInt16(0,256,!0),n._sysEndian=256===new Int16Array(H)[0]?"littleEndian":"bigEndian"}return n._sysEndian},n.BIG_ENDIAN="bigEndian",n.LITTLE_ENDIAN="littleEndian",n._sysEndian=null,n}(),s=function(){function N(){}return l(N,"laya.utils.CacheManager"),N.regCacheByFunction=function(H,n){var C;N.unRegCacheByFunction(H,n),C={tryDispose:H,getCacheList:n},N._cacheList.push(C)},N.unRegCacheByFunction=function(H,n){var C,r=0;for(C=N._cacheList.length,r=0;r<C;r++)if(N._cacheList[r].tryDispose==H&&N._cacheList[r].getCacheList==n)return void N._cacheList.splice(r,1)},N.forceDispose=function(){var H=0,n=N._cacheList.length;for(H=0;H<n;H++)N._cacheList[H].tryDispose(!0)},N.beginCheck=function(H){void 0===H&&(H=15e3),F.timer.loop(H,null,N._checkLoop)},N.stopCheck=function(){F.timer.clear(null,N._checkLoop)},N._checkLoop=function(){var H=N._cacheList;if(!(H.length<1)){var n,C=_.now(),r=0;for(n=r=H.length;0<r&&(H[N._index=++N._index%n].tryDispose(!1),!(_.now()-C>N.loopTimeLimit));)r--}},N.loopTimeLimit=2,N._cacheList=[],N._index=0,N}(),$=function(){function g(){}return l(g,"laya.utils.ClassUtils"),g.regClass=function(H,n){g._classMap[H]=n},g.getRegClass=function(H){return g._classMap[H]},g.getInstance=function(H){var n=g.getClass(H);return n?new n:(console.warn("[error] Undefined class:",H),null)},g.createByJson=function(H,n,C,r,N){"string"==typeof H&&(H=JSON.parse(H));var Q=H.props;if(!n&&!(n=N?N.runWith(H):g.getInstance(Q.runtime||H.type)))return null;var I=H.child;if(I)for(var A=0,P=I.length;A<P;A++){var t=I[A];if("render"!==t.props.name&&"render"!==t.props.renderType||!n._$set_itemRender)if("Graphic"==t.type)g.addGraphicsToSprite(t,n);else if(g.isDrawType(t.type))g.addGraphicToSprite(t,n,!0);else{var R=g.createByJson(t,null,C,r,N);"Script"==t.type?R.hasOwnProperty("owner")?R.owner=n:R.hasOwnProperty("target")&&(R.target=n):"mask"==t.props.renderType?n.mask=R:n.addChild(R)}else n.itemRender=t}if(Q)for(var y in Q){var o=Q[y];"var"===y&&C?C[o]=n:o instanceof Array&&"function"==typeof n[y]?n[y].apply(n,o):n[y]=o}return r&&H.customProps&&r.runWith([n,H]),n.created&&n.created(),n},g.addGraphicsToSprite=function(H,n){var C;if((C=H.child)&&!(C.length<1)){var r;r=g._getGraphicsFromSprite(H,n);var N=0,Q=0;H.props&&(N=g._getObjVar(H.props,"x",0),Q=g._getObjVar(H.props,"y",0)),0!=N&&0!=Q&&r.translate(N,Q);var I,A=0;for(I=C.length,A=0;A<I;A++)g._addGraphicToGraphics(C[A],r);0!=N&&0!=Q&&r.translate(-N,-Q)}},g.addGraphicToSprite=function(H,n,C){var r;void 0===C&&(C=!1),r=C?g._getGraphicsFromSprite(H,n):n.graphics,g._addGraphicToGraphics(H,r)},g._getGraphicsFromSprite=function(H,n){var C,r;if(!H||!H.props)return n.graphics;switch(r=H.props.renderType){case"hit":case"unHit":var N;n.hitArea||(n.hitArea=new T),(N=n.hitArea)[r]||(N[r]=new o),C=N[r]}return C||(C=n.graphics),C},g._getTransformData=function(H){var n;(H.hasOwnProperty("pivotX")||H.hasOwnProperty("pivotY"))&&(n=n||new h).translate(-g._getObjVar(H,"pivotX",0),-g._getObjVar(H,"pivotY",0));var C=g._getObjVar(H,"scaleX",1),r=g._getObjVar(H,"scaleY",1),N=g._getObjVar(H,"rotation",0);g._getObjVar(H,"skewX",0),g._getObjVar(H,"skewY",0);return 1==C&&1==r&&0==N||((n=n||new h).scale(C,r),n.rotate(.0174532922222222*N)),n},g._addGraphicToGraphics=function(H,n){var C,r;if((C=H.props)&&(r=g.DrawTypeDic[H.type])){var N,Q;N=n;var I=g._getParams(C,r[1],r[2],r[3]);((Q=g._tM)||1!=g._alpha)&&(N.save(),Q&&N.transform(Q),1!=g._alpha&&N.alpha(g._alpha)),N[r[0]].apply(N,I),(Q||1!=g._alpha)&&N.restore()}},g._adptLineData=function(H){return H[2]=parseFloat(H[0])+parseFloat(H[2]),H[3]=parseFloat(H[1])+parseFloat(H[3]),H},g._adptTextureData=function(H){return H[0]=AH.getRes(H[0]),H},g._adptLinesData=function(H){return H[2]=g._getPointListByStr(H[2]),H},g.isDrawType=function(H){return"Image"!=H&&g.DrawTypeDic.hasOwnProperty(H)},g._getParams=function(H,n,C,r){var N;void 0===C&&(C=0),(N=g._temParam).length=n.length;var Q,I,A=0;for(Q=n.length,A=0;A<Q;A++)N[A]=g._getObjVar(H,n[A][0],n[A][1]);return g._alpha=g._getObjVar(H,"alpha",1),I=g._getTransformData(H),g._tM=I?(C||(C=0),I.translate(N[C],N[C+1]),N[C]=N[C+1]=0,I):null,r&&g[r]&&(N=g[r](N)),N},g._getPointListByStr=function(H){var n,C,r=0;for(C=(n=H.split(",")).length,r=0;r<C;r++)n[r]=parseFloat(n[r]);return n},g._getObjVar=function(H,n,C){return H.hasOwnProperty(n)?H[n]:C},g._temParam=[],g._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},g.getClass=function(H){var n=g._classMap[H]||H;return"string"==typeof n?F.__classmap[n]:n},g._tM=null,g._alpha=NaN,P(g,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),g}(),x=function(){function Q(H){if(this._color=[],"string"==typeof H){null===(this.strColor=H)&&(H="#000000"),"#"==H.charAt(0)&&(H=H.substr(1));var n=H.length;if(3==n||4==n){for(var C="",r=0;r<n;r++)C+=H[r]+H[r];H=C}var N=this.numColor=parseInt(H,16);if(8==H.length)return void(this._color=[parseInt(H.substr(0,2),16)/255,((16711680&N)>>16)/255,((65280&N)>>8)/255,(255&N)/255])}else N=this.numColor=H,this.strColor=u.toHexColor(N);this._color=[((16711680&N)>>16)/255,((65280&N)>>8)/255,(255&N)/255,1],this._color.__id=++Q._COLODID}return l(Q,"laya.utils.Color"),Q._initDefault=function(){for(var H in Q._DEFAULT={},Q._COLOR_MAP)Q._SAVE[H]=Q._DEFAULT[H]=new Q(Q._COLOR_MAP[H]);return Q._DEFAULT},Q._initSaveMap=function(){for(var H in Q._SAVE_SIZE=0,Q._SAVE={},Q._DEFAULT)Q._SAVE[H]=Q._DEFAULT[H]},Q.create=function(H){var n=Q._SAVE[H+""];return null!=n?n:(Q._SAVE_SIZE<1e3||Q._initSaveMap(),Q._SAVE[H+""]=new Q(H))},Q._SAVE={},Q._SAVE_SIZE=0,Q._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},Q._DEFAULT=Q._initDefault(),Q._COLODID=1,Q}(),O=(function(){function H(){this._values=[],this._keys=[]}l(H,"laya.utils.Dictionary");var n=H.prototype;n.set=function(H,n){var C=this.indexOf(H);0<=C?this._values[C]=n:(this._keys.push(H),this._values.push(n))},n.indexOf=function(H){var n=this._keys.indexOf(H);return 0<=n?n:(H="string"==typeof H?Number(H):"number"==typeof H?H.toString():H,this._keys.indexOf(H))},n.get=function(H){var n=this.indexOf(H);return n<0?null:this._values[n]},n.remove=function(H){var n=this.indexOf(H);return 0<=n&&(this._keys.splice(n,1),this._values.splice(n,1),!0)},n.clear=function(){this._values.length=0,this._keys.length=0},R(0,n,"values",function(){return this._values}),R(0,n,"keys",function(){return this._keys})}(),function(){function H(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}l(H,"laya.utils.Dragging");var n=H.prototype;return n.start=function(H,n,C,r,N,Q,I,A){void 0===A&&(A=.92),this.clearTimer(),this.target=H,this.area=n,this.hasInertia=C,this.elasticDistance=n?r:0,this.elasticBackTime=N,this.data=Q,this._disableMouseEvent=I,this.ratio=A,1!=H.globalScaleX||1!=H.globalScaleY?this._parent=H.parent:this._parent=F.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,F.stage.on("mouseup",this,this.onStageMouseUp),F.stage.on("mouseout",this,this.onStageMouseUp),F.timer.frameLoop(1,this,this.loop)},n.clearTimer=function(){F.timer.clear(this,this.loop),F.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},n.stop=function(){this._dragging&&(j.instance.disableMouseEvent=!1,F.stage.off("mouseup",this,this.onStageMouseUp),F.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},n.loop=function(){var H=this._parent.getMousePoint(),n=H.x,C=H.y,r=n-this._lastX,N=C-this._lastY;if(this._clickOnly){if(!(1<Math.abs(r*F.stage._canvasTransform.getScaleX())||1<Math.abs(N*F.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),j.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(r,N);0==r&&0==N||(this._lastX=n,this._lastY=C,this.target.x+=r*this._elasticRateX,this.target.y+=N*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},n.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var H=this.area.x-this.target.x;else H=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-H/this.elasticDistance),this.target.y<this.area.y)var n=this.area.y-this.target.y;else n=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-n/this.elasticDistance)}},n.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},n.onStageMouseUp=function(H){if(j.instance.disableMouseEvent=!1,F.stage.off("mouseup",this,this.onStageMouseUp),F.stage.off("mouseout",this,this.onStageMouseUp),F.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var n=this._offsets.length,C=Math.min(n,6),r=this._offsets.length-C,N=n-1;r<N;N--)this._offsetY+=this._offsets[N--],this._offsetX+=this._offsets[N];this._offsetX=this._offsetX/C*2,this._offsetY=this._offsetY/C*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),F.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},n.checkElastic=function(){var H=NaN,n=NaN;if(this.target.x<this.area.x?H=this.area.x:this.target.x>this.area.x+this.area.width&&(H=this.area.x+this.area.width),this.target.y<this.area.y?n=this.area.y:this.target.y>this.area.y+this.area.height&&(n=this.area.y+this.area.height),isNaN(H)&&isNaN(n))this.clear();else{var C={};isNaN(H)||(C.x=H),isNaN(n)||(C.y=n),this._tween=Y.to(this.target,C,this.elasticBackTime,S.sineOut,c.create(this,this.clear),0,!1,!1)}},n.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(F.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},n.clear=function(){if(this.target){this.clearTimer();var H=this.target;this.target=null,this._parent=null,H.event("dragend",this.data)}},H}()),S=function(){function A(){}return l(A,"laya.utils.Ease"),A.linearNone=function(H,n,C,r){return C*H/r+n},A.linearIn=function(H,n,C,r){return C*H/r+n},A.linearInOut=function(H,n,C,r){return C*H/r+n},A.linearOut=function(H,n,C,r){return C*H/r+n},A.bounceIn=function(H,n,C,r){return C-A.bounceOut(r-H,0,C,r)+n},A.bounceInOut=function(H,n,C,r){return H<.5*r?.5*A.bounceIn(2*H,0,C,r)+n:.5*A.bounceOut(2*H-r,0,C,r)+.5*C+n},A.bounceOut=function(H,n,C,r){return(H/=r)<1/2.75?C*(7.5625*H*H)+n:H<2/2.75?C*(7.5625*(H-=1.5/2.75)*H+.75)+n:H<2.5/2.75?C*(7.5625*(H-=2.25/2.75)*H+.9375)+n:C*(7.5625*(H-=2.625/2.75)*H+.984375)+n},A.backIn=function(H,n,C,r,N){return void 0===N&&(N=1.70158),C*(H/=r)*H*((N+1)*H-N)+n},A.backInOut=function(H,n,C,r,N){return void 0===N&&(N=1.70158),(H/=.5*r)<1?.5*C*(H*H*((1+(N*=1.525))*H-N))+n:C/2*((H-=2)*H*((1+(N*=1.525))*H+N)+2)+n},A.backOut=function(H,n,C,r,N){return void 0===N&&(N=1.70158),C*((H=H/r-1)*H*((N+1)*H+N)+1)+n},A.elasticIn=function(H,n,C,r,N,Q){var I;return void 0===N&&(N=0),void 0===Q&&(Q=0),0==H?n:1==(H/=r)?n+C:(Q||(Q=.3*r),I=!N||0<C&&N<C||C<0&&N<-C?(N=C,Q/4):Q/A.PI2*Math.asin(C/N),-N*Math.pow(2,10*(H-=1))*Math.sin((H*r-I)*A.PI2/Q)+n)},A.elasticInOut=function(H,n,C,r,N,Q){var I;return void 0===N&&(N=0),void 0===Q&&(Q=0),0==H?n:2==(H/=.5*r)?n+C:(Q||(Q=r*(.3*1.5)),I=!N||0<C&&N<C||C<0&&N<-C?(N=C,Q/4):Q/A.PI2*Math.asin(C/N),H<1?N*Math.pow(2,10*(H-=1))*Math.sin((H*r-I)*A.PI2/Q)*-.5+n:N*Math.pow(2,-10*(H-=1))*Math.sin((H*r-I)*A.PI2/Q)*.5+C+n)},A.elasticOut=function(H,n,C,r,N,Q){var I;return void 0===N&&(N=0),void 0===Q&&(Q=0),0==H?n:1==(H/=r)?n+C:(Q||(Q=.3*r),I=!N||0<C&&N<C||C<0&&N<-C?(N=C,Q/4):Q/A.PI2*Math.asin(C/N),N*Math.pow(2,-10*H)*Math.sin((H*r-I)*A.PI2/Q)+C+n)},A.strongIn=function(H,n,C,r){return C*(H/=r)*H*H*H*H+n},A.strongInOut=function(H,n,C,r){return(H/=.5*r)<1?.5*C*H*H*H*H*H+n:.5*C*((H-=2)*H*H*H*H+2)+n},A.strongOut=function(H,n,C,r){return C*((H=H/r-1)*H*H*H*H+1)+n},A.sineInOut=function(H,n,C,r){return.5*-C*(Math.cos(Math.PI*H/r)-1)+n},A.sineIn=function(H,n,C,r){return-C*Math.cos(H/r*A.HALF_PI)+C+n},A.sineOut=function(H,n,C,r){return C*Math.sin(H/r*A.HALF_PI)+n},A.quintIn=function(H,n,C,r){return C*(H/=r)*H*H*H*H+n},A.quintInOut=function(H,n,C,r){return(H/=.5*r)<1?.5*C*H*H*H*H*H+n:.5*C*((H-=2)*H*H*H*H+2)+n},A.quintOut=function(H,n,C,r){return C*((H=H/r-1)*H*H*H*H+1)+n},A.quartIn=function(H,n,C,r){return C*(H/=r)*H*H*H+n},A.quartInOut=function(H,n,C,r){return(H/=.5*r)<1?.5*C*H*H*H*H+n:.5*-C*((H-=2)*H*H*H-2)+n},A.quartOut=function(H,n,C,r){return-C*((H=H/r-1)*H*H*H-1)+n},A.cubicIn=function(H,n,C,r){return C*(H/=r)*H*H+n},A.cubicInOut=function(H,n,C,r){return(H/=.5*r)<1?.5*C*H*H*H+n:.5*C*((H-=2)*H*H+2)+n},A.cubicOut=function(H,n,C,r){return C*((H=H/r-1)*H*H+1)+n},A.quadIn=function(H,n,C,r){return C*(H/=r)*H+n},A.quadInOut=function(H,n,C,r){return(H/=.5*r)<1?.5*C*H*H+n:.5*-C*(--H*(H-2)-1)+n},A.quadOut=function(H,n,C,r){return-C*(H/=r)*(H-2)+n},A.expoIn=function(H,n,C,r){return 0==H?n:C*Math.pow(2,10*(H/r-1))+n-.001*C},A.expoInOut=function(H,n,C,r){return 0==H?n:H==r?n+C:(H/=.5*r)<1?.5*C*Math.pow(2,10*(H-1))+n:.5*C*(2-Math.pow(2,-10*--H))+n},A.expoOut=function(H,n,C,r){return H==r?n+C:C*(1-Math.pow(2,-10*H/r))+n},A.circIn=function(H,n,C,r){return-C*(Math.sqrt(1-(H/=r)*H)-1)+n},A.circInOut=function(H,n,C,r){return(H/=.5*r)<1?.5*-C*(Math.sqrt(1-H*H)-1)+n:.5*C*(Math.sqrt(1-(H-=2)*H)+1)+n},A.circOut=function(H,n,C,r){return C*Math.sqrt(1-(H=H/r-1)*H)+n},A.HALF_PI=.5*Math.PI,A.PI2=2*Math.PI,A}(),T=function(){function y(){this._hit=null,this._unHit=null}l(y,"laya.utils.HitArea");var H=y.prototype;return H.isHit=function(H,n){return!!y.isHitGraphic(H,n,this.hit)&&!y.isHitGraphic(H,n,this.unHit)},H.contains=function(H,n){return this.isHit(H,n)},R(0,H,"hit",function(){return this._hit||(this._hit=new o),this._hit},function(H){this._hit=H}),R(0,H,"unHit",function(){return this._unHit||(this._unHit=new o),this._unHit},function(H){this._unHit=H}),y.isHitGraphic=function(H,n,C){if(!C)return!1;var r;if(!(r=C.cmds)&&C._one&&((r=y._cmds).length=1,r[0]=C._one),!r)return!1;var N,Q,I=0;for(N=r.length,I=0;I<N;I++)if(Q=r[I]){var A=Z._context;switch(Q.callee){case A._translate:case 6:H-=Q[0],n-=Q[1]}if(y.isHitCmd(H,n,Q))return!0}return!1},y.isHitCmd=function(H,n,C){if(!C)return!1;var r=Z._context,N=!1;switch(C.callee){case r._drawRect:case 13:y._rec.setTo(C[0],C[1],C[2],C[3]),N=y._rec.contains(H,n);break;case r._drawCircle:case r._fillCircle:case 14:N=(H-=C[0])*H+(n-=C[1])*n<C[2]*C[2];break;case r._drawPoly:case 18:H-=C[0],n-=C[1],N=y.ptInPolygon(H,n,C[2])}return N},y.ptInPolygon=function(H,n,C){var r;(r=y._ptPoint).setTo(H,n);var N,Q=0,I=NaN,A=NaN,P=NaN,t=NaN;N=C.length;for(var R=0;R<N;R+=2){if(I=C[R],A=C[R+1],P=C[(R+2)%N],A!=(t=C[(R+3)%N]))if(!(r.y<Math.min(A,t)))if(!(r.y>=Math.max(A,t)))(r.y-A)*(P-I)/(t-A)+I>r.x&&Q++}return Q%2==1},y._cmds=[],P(y,["_rec",function(){return this._rec=new i},"_ptPoint",function(){return this._ptPoint=new k}]),y}(),E=(function(){function N(H,n,C,r){this.char=H,this.charNum=H.charCodeAt(0),this._x=this._y=0,this.width=n,this.height=C,this.style=r,this.isWord=!N._isWordRegExp.test(H)}l(N,"laya.utils.HTMLChar");var H=N.prototype;F.imps(H,{"laya.display.ILayout":!0}),H.setSprite=function(H){this._sprite=H},H.getSprite=function(){return this._sprite},H._isChar=function(){return!0},H._getCSSStyle=function(){return this.style},R(0,H,"width",function(){return this._w},function(H){this._w=H}),R(0,H,"x",function(){return this._x},function(H){this._sprite&&(this._sprite.x=H),this._x=H}),R(0,H,"y",function(){return this._y},function(H){this._sprite&&(this._sprite.y=H),this._y=H}),R(0,H,"height",function(){return this._h},function(H){this._h=H}),N._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function n(){}l(n,"laya.utils.Log"),n.enable=function(){n._logdiv||(n._logdiv=_.window.document.createElement("div"),_.window.document.body.appendChild(n._logdiv),n._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},n.toggle=function(){var H=n._logdiv.style;"1px"==H.width?H.width=H.height="50%":H.width=H.height="1px"},n.print=function(H){n._logdiv&&(n.maxCount<=n._count&&n.clear(),n._count++,n._logdiv.innerText+=H+"\n",n._logdiv.scrollTop=n._logdiv.scrollHeight)},n.clear=function(){n._logdiv.innerText="",n._count=0},n._logdiv=null,n._count=0,n.maxCount=20}(),function(){function n(){}l(n,"laya.utils.Mouse"),R(1,n,"cursor",function(){return n._style.cursor},function(H){n._style.cursor=H}),n.hide=function(){"none"!=n.cursor&&(n._preCursor=n.cursor,n.cursor="none")},n.show=function(){"none"==n.cursor&&(n.cursor=n._preCursor?n._preCursor:"auto")},n._preCursor=null,P(n,["_style",function(){return this._style=_.document.body.style}])}(),function(){function Q(){}return l(Q,"laya.utils.Pool"),Q.getPoolBySign=function(H){return Q._poolDic[H]||(Q._poolDic[H]=[])},Q.clearBySign=function(H){Q._poolDic[H]&&(Q._poolDic[H].length=0)},Q.recover=function(H,n){n.__InPool||(n.__InPool=!0,Q.getPoolBySign(H).push(n))},Q.getItemByClass=function(H,n){var C=Q.getPoolBySign(H),r=C.length?C.pop():new n;return r.__InPool=!1,r},Q.getItemByCreateFun=function(H,n,C){var r=Q.getPoolBySign(H),N=r.length?r.pop():n.call(C);return N.__InPool=!1,N},Q.getItem=function(H){var n=Q.getPoolBySign(H),C=n.length?n.pop():null;return C&&(C.__InPool=!1),C},Q._poolDic={},Q.InPoolSign="__InPool",Q}()),G=function(){function P(){}return l(P,"laya.utils.Stat"),R(1,P,"onclick",null,function(H){P._sp&&P._sp.on("click",P._sp,H),P._canvas&&(P._canvas.source.onclick=H,P._canvas.source.style.pointerEvents="")}),P.show=function(H,n,C){if(void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),!Z.isConchApp||Z.isConchWebGL){if(Z.isConchWebGL||_.onMiniGame||_.onLimixiu||(P._useCanvas=!0),P._show=!0,P._fpsData.length=60,P._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},P._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},P._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},P._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},Z.isWebGL)if(P._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},Z.is3DMode){if(P._view[0].title="FPS(3D)",P._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},P._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},P._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==C){var r=8;P._view[r++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},P._view[r++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},P._view[r++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},P._view[r++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},P._view[r++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},P._view[r++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},P._view[r++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},P._view[r++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},P._view[r++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==C){r=8;P._view[r++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},P._view[r++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},P._view[r++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},P._view[r++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},P._view[r++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},P._view[r++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},P._view[r++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else P._view[0].title="FPS(WebGL)",P._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else P._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};P._useCanvas?P.createUIPre(H,n):P.createUI(H,n),P.enable()}else _.window.conch.showFPS&&_.window.conch.showFPS(H,n)},P.createUIPre=function(H,n){var C=_.pixelRatio;P._width=170*C,P._vx=75*C,P._height=C*(12*P._view.length+3*C)+4,P._fontSize=12*C;for(var r=0;r<P._view.length;r++)P._view[r].x=4,P._view[r].y=r*P._fontSize+2*C;P._canvas||((P._canvas=new KH("2D")).size(P._width,P._height),(P._ctx=P._canvas.getContext("2d")).textBaseline="top",P._ctx.font=P._fontSize+"px Sans-serif",P._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+H+"px;top:"+n+"px;width:"+P._width/C+"px;height:"+P._height/C+"px;"),P._first=!0,P.loop(),P._first=!1,_.container.appendChild(P._canvas.source)},P.createUI=function(H,n){var C=P._sp,r=_.pixelRatio;C||(C=new yH,(P._leftText=new lH).pos(5,5),P._leftText.color="#ffffff",C.addChild(P._leftText),(P._txt=new lH).pos(80*r,5),P._txt.color="#ffffff",C.addChild(P._txt),P._sp=C),C.pos(H,n);for(var N="",Q=0;Q<P._view.length;Q++){N+=P._view[Q].title+"\n"}P._leftText.text=N;var I=170*r,A=r*(12*P._view.length+3*r)+4;P._txt.fontSize=P._fontSize*r,P._leftText.fontSize=P._fontSize*r,C.size(I,A),C.graphics.clear(),C.graphics.setAlpha(.5),C.graphics.drawRect(0,0,I,A,"#999999"),C.graphics.setAlpha(1),P.loop()},P.enable=function(){F.timer.frameLoop(1,P,P.loop)},P.hide=function(){P._show=!1,F.timer.clear(P,P.loop),P._canvas&&_.removeElement(P._canvas.source)},P.clear=function(){P.trianglesFaces=P.drawCall=P.shaderCall=P.spriteCount=P.spriteRenderUseCacheCount=P.treeNodeCollision=P.treeSpriteCollision=P.canvasNormal=P.canvasBitmap=P.canvasReCache=0},P.loop=function(){P._count++;var H=_.now();if(!(H-P._timer<1e3)){var n=P._count;if(P.FPS=Math.round(1e3*n/(H-P._timer)),P._show){P.trianglesFaces=Math.round(P.trianglesFaces/n),P.spriteCount=P._useCanvas?(P.drawCall=Math.round(P.drawCall/n)-2,P.shaderCall=Math.round(P.shaderCall/n),Math.round(P.spriteCount/n)-1):(P.drawCall=Math.round(P.drawCall/n)-2,P.shaderCall=Math.round(P.shaderCall/n)-4,Math.round(P.spriteCount/n)-4),P.spriteRenderUseCacheCount=Math.round(P.spriteRenderUseCacheCount/n),P.canvasNormal=Math.round(P.canvasNormal/n),P.canvasBitmap=Math.round(P.canvasBitmap/n),P.canvasReCache=Math.ceil(P.canvasReCache/n),P.treeNodeCollision=Math.round(P.treeNodeCollision/n),P.treeSpriteCollision=Math.round(P.treeSpriteCollision/n);var C=0<P.FPS?Math.floor(1e3/P.FPS).toString():" ";P._fpsStr=P.FPS+(P.renderSlow?" slow":"")+" "+C,P._spriteStr=P.spriteCount+(P.spriteRenderUseCacheCount?"/"+P.spriteRenderUseCacheCount:""),P._canvasStr=P.canvasReCache+"/"+P.canvasNormal+"/"+P.canvasBitmap,P.currentMemorySize=d.systemResourceManager.memorySize,P._useCanvas?P.renderInfoPre():P.renderInfo(),P.clear()}P._count=0,P._timer=H}},P.renderInfoPre=function(){if(P._canvas){var H=P._ctx;H.clearRect(P._first?0:P._vx,0,P._width,P._height);for(var n=Z.WebGL.mainContext,C=0;C<P._view.length;C++){var r=P._view[C];P._first&&(H.fillStyle="white",H.fillText(r.title,r.x,r.y,null,null,null)),H.fillStyle=r.color;var N=-1;if((r=P._view[C]).varying){if(n)switch(r.varying){case 1:N=n.getParameter(n[r.value]);break;case 2:N=n.getExtension(r.value)}}else N=P[r.value];"M"==r.units&&(N=Math.floor(N/1048576*100)/100+" M"),"K"==r.units&&(N=Math.floor(N/1024*100)/100+" K"),"string"==r.units&&(N=N.match(/\d+\.?\d/i)),H.fillText(N+"",r.x+P._vx,r.y,null,null,null)}}},P.renderInfo=function(){for(var H="",n=Z.WebGL.mainContext,C=0;C<P._view.length;C++){var r=P._view[C],N=-1;if(r.varying){if(n)switch(r.varying){case 1:N=n.getParameter(n[r.value]);break;case 2:N=n.getExtension(r.value)}}else N=P[r.value];"M"==r.units&&(N=Math.floor(N/1048576*100)/100+" M"),"K"==r.units&&(N=Math.floor(N/1024*100)/100+" K"),"string"==r.units&&(N=N.match(/\d+\.?\d/i)),H+=N+"\n"}P._txt.text=H},P.FPS=0,P.loopCount=0,P.shaderCall=0,P.drawCall=0,P.trianglesFaces=0,P.spriteCount=0,P.spriteRenderUseCacheCount=0,P.treeNodeCollision=0,P.treeSpriteCollision=0,P.canvasNormal=0,P.canvasBitmap=0,P.canvasReCache=0,P.renderSlow=!1,P.currentMemorySize=0,P._fpsStr=null,P._canvasStr=null,P._spriteStr=null,P._fpsData=[],P._timer=0,P._count=0,P._view=[],P._fontSize=12,P._txt=null,P._leftText=null,P._sp=null,P._show=!1,P._useCanvas=!1,P._canvas=null,P._ctx=null,P._first=!1,P._vx=NaN,P._width=0,P._height=100,P}(),J=(function(){function H(){this._strsToID={},this._idToStrs=[],this._length=0}l(H,"laya.utils.StringKey");var n=H.prototype;n.add=function(H){var n=this._strsToID[H];return null!=n?n:(this._idToStrs[this._length]=H,this._strsToID[H]=this._length++)},n.getID=function(H){var n=this._strsToID[H];return null==n?-1:n},n.getName=function(H){var n=this._idToStrs[H];return null==n?void 0:n}}(),function(){var t;function H(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}l(H,"laya.utils.Timer");var n=H.prototype;return n._init=function(){F.timer&&F.timer.frameLoop(1,this,this._update)},n._now=function(){return Date.now()},n._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var H=this.currFrame=this.currFrame+this.scale,n=this._now();this._delta=(n-this._lastTimer)*this.scale;var C=this.currTimer=this.currTimer+this._delta;F.isDebug&&6e4<Math.abs(n-this._lastTimer)&&console.error("系统时间错误！"+(n-this._lastTimer)),this._lastTimer=n;var r=this._handlers;for(I=this._count=0,A=r.length;I<A;I++)if(null!==(P=r[I]).method){var N=P.userFrame?H:C;if(N>=P.exeTime)if(P.repeat)if(P.jumpFrame)for(;N>=P.exeTime;)P.exeTime+=P.delay,P.run(!1);else P.exeTime+=P.delay,P.run(!1),N>P.exeTime&&(P.exeTime+=Math.ceil((N-P.exeTime)/P.delay)*P.delay);else P.run(!0)}else this._count++;(30<this._count||H%200==0)&&this._clearHandlers();for(var Q=this._laters,I=0,A=Q.length-1;I<=A;I++){var P=Q[I];this._isIgnoreRecover(P)||(null!==P.method&&(delete this._map[P.key],P.run(!1)),this._recoverHandler(P)),I===A&&(A=Q.length-1)}Q.length=0}},n._clearHandlers=function(){for(var H=this._handlers,n=0,C=H.length;n<C;n++){var r=H[n];null!==r.method?this._temp.push(r):this._isIgnoreRecover(r)?this._temp.push(r):this._recoverHandler(r)}this._handlers=this._temp,this._temp=H,this._temp.length=0},n._recoverHandler=function(H){this._map[H.key]==H&&delete this._map[H.key],H.recover()},n._create=function(H,n,C,r,N,Q,I,A){if(!C)return N.apply(r,Q),null;if(I){var P=this._getHandler(r,N);if(P)return P.repeat=n,P.userFrame=H,P.delay=C,P.ignoreRecover=A,P.caller=r,P.method=N,P.args=Q,P.exeTime=C+(H?this.currFrame:this.currTimer+this._now()-this._lastTimer),P}return(P=t.create()).repeat=n,P.userFrame=H,P.delay=C,P.ignoreRecover=A,P.caller=r,P.method=N,P.args=Q,P.exeTime=C+(H?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(P),this._handlers.push(P),P},n._indexHandler=function(H){var n=H.caller,C=H.method,r=n?n.$_GID||(n.$_GID=u.getGID()):0,N=C.$_TID||(C.$_TID=this._mid++);H.key=r+"_"+N,this._map[H.key]=H},n.once=function(H,n,C,r,N){void 0===N&&(N=!0),this._create(!1,!1,H,n,C,r,N,!1)},n.loop=function(H,n,C,r,N,Q,I){void 0===N&&(N=!0),void 0===Q&&(Q=!1),void 0===I&&(I=!1);var A=this._create(!1,!0,H,n,C,r,N,I);A&&(A.jumpFrame=Q)},n.frameOnce=function(H,n,C,r,N){void 0===N&&(N=!0),this._create(!0,!1,H,n,C,r,N,!1)},n.frameLoop=function(H,n,C,r,N,Q){void 0===N&&(N=!0),void 0===Q&&(Q=!1),this._create(!0,!0,H,n,C,r,N,Q)},n.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+t._freeCount},n.clear=function(H,n){var C=this._getHandler(H,n);return!(!C||this._isIgnoreRecover(C))&&(delete this._map[C.key],C.key=null,C.clear(),!0)},n.clearAll=function(H){if(H)for(var n=0,C=this._handlers.length;n<C;n++){var r=this._handlers[n];r.caller===H&&(this._isIgnoreRecover(r)||(delete this._map[r.key],r.key=null,r.clear()))}},n._getHandler=function(H,n){var C=H?H.$_GID||(H.$_GID=u.getGID()):0,r=n.$_TID||(n.$_TID=this._mid++);return this._map[C+"_"+r]},n._isIgnoreRecover=function(H){if(H.ignoreRecover||H.caller&&"IgnoreRecover"==H.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var n="";try{arguments.propertyIsEnumerable.caller}catch(H){n=H.stack}F.recordError("报错：核心定时器销毁忽略  "+n)}return!0}return!1},n.hasHandler=function(H,n){return this._map[H.$_GID+"_"+n.$_TID]},n.callLater=function(H,n,C){if(null==this._getHandler(H,n)){var r=t.create();r.caller=H,r.method=n,r.args=C,this._indexHandler(r),this._laters.push(r)}},n.runCallLater=function(H,n){var C=this._getHandler(H,n);C&&null!=C.method&&(this._isIgnoreRecover(C)||(delete this._map[C.key],C.run(!0)))},n.runTimer=function(H,n){this.runCallLater(H,n)},R(0,n,"delta",function(){return this._delta}),H.__init$=function(){t=function(){function n(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}l(n,"");var H=n.prototype;return H.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},H.recover=function(){this.clear(),this.args=n._freeHandler,n._freeHandler=this,n._freeCount++},H.run=function(H){var n=this.caller;if(n&&n.destroyed)return this.clear();var C=this.method,r=this.args;H&&this.clear(),null!=C&&(r?C.apply(n,r):C.call(n))},n._freeHandler=null,n._freeCount=0,n.create=function(){var H=n._freeHandler;return H?(n._freeHandler=H.args,--n._freeCount,H.args=null,H):new n},n}()},H}()),Y=function(){function y(){this.gid=0}l(y,"laya.utils.Tween");var H=y.prototype;return H.to=function(H,n,C,r,N,Q,I){return void 0===Q&&(Q=0),void 0===I&&(I=!1),this._create(H,n,C,r,N,Q,I,!0,!1,!0)},H.from=function(H,n,C,r,N,Q,I){return void 0===Q&&(Q=0),void 0===I&&(I=!1),this._create(H,n,C,r,N,Q,I,!1,!1,!0)},H._create=function(H,n,C,r,N,Q,I,A,P,t){if(!H)throw new Error("Tween:target is null");this._target=H,this._duration=C,this._ease=r||n.ease||y.easeNone,this._complete=N||n.complete,this._delay=Q,this._props=[],this._usedTimer=0,this._startTimer=_.now(),this._usedPool=P,this._delayParam=null,this.update=n.update;var R=H.$_GID||(H.$_GID=u.getGID());return y.tweenMap[R]?(I&&y.clearTween(H),y.tweenMap[R].push(this)):y.tweenMap[R]=[this],t?Q<=0?this.firstStart(H,n,A):(this._delayParam=[H,n,A],F.scaleTimer.once(Q,this,this.firstStart,this._delayParam)):this._initProps(H,n,A),this},H.firstStart=function(H,n,C){this._delayParam=null,H.destroyed?this.clear():(this._initProps(H,n,C),this._beginLoop())},H._initProps=function(H,n,C){for(var r in n)if("number"==typeof H[r]){var N=C?H[r]:n[r],Q=C?n[r]:H[r];this._props.push([r,N,Q-N]),C||(H[r]=N)}},H._beginLoop=function(){F.scaleTimer.frameLoop(1,this,this._doEase)},H._doEase=function(){this._updateEase(_.now())},H._updateEase=function(H){var n=this._target;if(n){if(n.destroyed)return y.clearTween(n);var C=this._usedTimer=H-this._startTimer-this._delay;if(!(C<0)){if(C>=this._duration)return this.complete();for(var r=0<C?this._ease(C,0,1,this._duration):0,N=this._props,Q=0,I=N.length;Q<I;Q++){var A=N[Q];n[A[0]]=A[1]+r*A[2]}this.update&&this.update.run()}}},H.complete=function(){if(this._target){F.scaleTimer.runTimer(this,this.firstStart);for(var H=this._target,n=this._props,C=this._complete,r=0,N=n.length;r<N;r++){var Q=n[r];H[Q[0]]=Q[1]+Q[2]}this.update&&this.update.run(),this.clear(),C&&C.run()}},H.pause=function(){F.scaleTimer.clear(this,this._beginLoop),F.scaleTimer.clear(this,this._doEase),F.scaleTimer.clear(this,this.firstStart);var H;(H=_.now()-this._startTimer-this._delay)<0&&(this._usedTimer=H)},H.setStartTime=function(H){this._startTimer=H},H.clear=function(){this._target&&(this._remove(),this._clear())},H._clear=function(){this.pause(),F.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,E.recover("tween",this))},H.recover=function(){this._usedPool=!0,this._clear()},H._remove=function(){var H=y.tweenMap[this._target.$_GID];if(H)for(var n=0,C=H.length;n<C;n++)if(H[n]===this){H.splice(n,1);break}},H.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=_.now(),this._delayParam)F.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var H=this._props,n=0,C=H.length;n<C;n++){var r=H[n];this._target[r[0]]=r[1]}F.scaleTimer.once(this._delay,this,this._beginLoop)}},H.resume=function(){this._usedTimer>=this._duration||(this._startTimer=_.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?F.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},R(0,H,"progress",null,function(H){var n=H*this._duration;this._startTimer=_.now()-this._delay-n}),y.to=function(H,n,C,r,N,Q,I,A){return void 0===Q&&(Q=0),void 0===I&&(I=!1),void 0===A&&(A=!0),E.getItemByClass("tween",y)._create(H,n,C,r,N,Q,I,!0,A,!0)},y.from=function(H,n,C,r,N,Q,I,A){return void 0===Q&&(Q=0),void 0===I&&(I=!1),void 0===A&&(A=!0),E.getItemByClass("tween",y)._create(H,n,C,r,N,Q,I,!1,A,!0)},y.clearAll=function(H){if(H&&H.$_GID){var n=y.tweenMap[H.$_GID];if(n){for(var C=0,r=n.length;C<r;C++)n[C]._clear();n.length=0}}},y.clear=function(H){H.clear()},y.clearTween=function(H){y.clearAll(H)},y.easeNone=function(H,n,C,r){return C*H/r+n},y.tweenMap={},y}(),u=function(){function A(){}return l(A,"laya.utils.Utils"),A.toRadian=function(H){return H*A._pi2},A.toAngle=function(H){return H*A._pi},A.toHexColor=function(H){if(H<0||isNaN(H))return null;for(var n=H.toString(16);n.length<6;)n="0"+n;return"#"+n},A.getGID=function(){return A._gid++},A.concatArray=function(H,n){if(!n)return H;if(!H)return n;var C=0,r=n.length;for(C=0;C<r;C++)H.push(n[C]);return H},A.clearArray=function(H){return H&&(H.length=0),H},A.copyArray=function(H,n){if(H||(H=[]),!n)return H;H.length=n.length;var C=0,r=n.length;for(C=0;C<r;C++)H[C]=n[C];return H},A.getGlobalRecByPoints=function(H,n,C,r,N){var Q,I;return Q=new k(n,C),Q=H.localToGlobal(Q),I=new k(r,N),I=H.localToGlobal(I),i._getWrapRec([Q.x,Q.y,I.x,I.y])},A.getGlobalPosAndScale=function(H){return A.getGlobalRecByPoints(H,0,0,1,1)},A.bind=function(H,n){return H.bind(n)},A.measureText=function(H,n){return b.measureText(H,n)},A.contextMeasureText=function(H){var n=_.context.measureText(H);return n||(n={width:16,height:16}),n},A.updateOrder=function(H){if(!H||H.length<2)return!1;for(var n,C=1,r=0,N=H.length,Q=NaN;C<N;){for(n=H[r=C],Q=H[r]._zOrder;-1<--r&&H[r]._zOrder>Q;)H[r+1]=H[r];H[r+1]=n,C++}var I=n.parent.conchModel;if(I)if(null!=I.updateZOrder)I.updateZOrder();else{for(C=0;C<N;C++)I.removeChild(H[C].conchModel);for(C=0;C<N;C++)I.addChildAt(H[C].conchModel,C)}return!0},A.transPointList=function(H,n,C){var r=0,N=H.length;for(r=0;r<N;r+=2)H[r]+=n,H[r+1]+=C},A.parseInt=function(H,n){void 0===n&&(n=0);var C=_.window.parseInt(H,n);return isNaN(C)?0:C},A.getFileExtension=function(H){A._extReg.lastIndex=H.lastIndexOf(".");var n=A._extReg.exec(H);return n&&1<n.length?n[1].toLowerCase():null},A.getTransformRelativeToWindow=function(H,n,C){var r=F.stage,N=laya.utils.Utils.getGlobalPosAndScale(H),Q=r._canvasTransform.clone(),I=Q.tx,A=Q.ty;Q.rotate(-Math.PI/180*F.stage.canvasDegree),Q.scale(F.stage.clientScaleX,F.stage.clientScaleY);var P=F.stage.canvasDegree%180!=0,t=NaN,R=NaN;P?(t=C+N.y,R=n+N.x,t*=Q.d,R*=Q.a,90==F.stage.canvasDegree?(t=I-t,R+=A):(t+=I,R=A-R)):(t=n+N.x,R=C+N.y,t*=Q.a,R*=Q.d,t+=I,R+=A);var y=NaN,o=NaN;return o=P?(y=Q.d*N.height,Q.a*N.width):(y=Q.a*N.width,Q.d*N.height),{x:t,y:R,scaleX:y,scaleY:o}},A.fitDOMElementInArea=function(H,n,C,r,N,Q){H._fitLayaAirInitialized||(H._fitLayaAirInitialized=!0,H.style.transformOrigin=H.style.webKittransformOrigin="left top",H.style.position="absolute");var I=A.getTransformRelativeToWindow(n,C,r);H.style.transform=H.style.webkitTransform="scale("+I.scaleX+","+I.scaleY+") rotate("+F.stage.canvasDegree+"deg)",H.style.width=N+"px",H.style.height=Q+"px",H.style.left=I.x+"px",H.style.top=I.y+"px"},A.isOkTextureList=function(H){if(!H)return!1;var n,C=0,r=H.length;for(C=0;C<r;C++)if(!(n=H[C])||!n.source)return!1;return!0},A.isOKCmdList=function(H){if(!H)return!1;var n,C,r=0,N=H.length,Q=Z._context;for(r=0;r<N;r++)switch((n=H[r]).callee){case Q._drawTexture:case Q._fillTexture:case Q._drawTextureWithTransform:if(!(C=n[0])||!C.source)return!1}return!0},A._gid=1,A._pi=180/Math.PI,A._pi2=Math.PI/180,A._extReg=/\.(\w+)\??/g,A.parseXMLFromString=function(H){var n;if(H=H.replace(/>\s+</g,"><"),-1<(n=(new DOMParser).parseFromString(H,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))if(console.error("html error    ===============>>>>>>>  "+H),-1!=H.indexOf("&")||-1!=H.indexOf('"')||-1!=H.indexOf(">")||-1!=H.indexOf("<")){var C=H.slice(6,H.length-7);C="<root>"+(C=(C=(C=(C=C.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/>/g,"&gt;")).replace(/</g,"&lt;"))+"</root>",n=(new DOMParser).parseFromString(C,"text/xml")}else n=(new DOMParser).parseFromString("<root>error...</root>","text/xml");return n},A}(),X=function(){function H(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Z.isWebGL&&s.regCacheByFunction(u.bind(this.startDispose,this),u.bind(this.getCacheList,this))}l(H,"laya.utils.VectorGraphManager");var n=H.prototype;return n.getId=function(){return this._id++},n.addShape=function(H,n){this.shapeDic[H]=n,this.useDic[H]||(this.useDic[H]=!0)},n.addLine=function(H,n){this.shapeLineDic[H]=n,this.shapeLineDic[H]||(this.shapeLineDic[H]=!0)},n.getShape=function(H){this._checkKey&&null!=this.useDic[H]&&(this.useDic[H]=!0)},n.deleteShape=function(H){this.shapeDic[H]&&(this.shapeDic[H]=null,delete this.shapeDic[H]),this.shapeLineDic[H]&&(this.shapeLineDic[H]=null,delete this.shapeLineDic[H]),null!=this.useDic[H]&&delete this.useDic[H]},n.getCacheList=function(){var H,n=[];for(H in this.shapeDic)n.push(this.shapeDic[H]);for(H in this.shapeLineDic)n.push(this.shapeLineDic[H]);return n},n.startDispose=function(H){var n;for(n in this.useDic)this.useDic[n]=!1;this._checkKey=!0},n.endDispose=function(){if(this._checkKey){var H;for(H in this.useDic)this.useDic[H]||this.deleteShape(H);this._checkKey=!1}},H.getInstance=function(){return H.instance=H.instance||new H},H.instance=null,H}(),V=function(){function r(){this._obj=null,this._obj=r.supportWeakMap?new _.window.WeakMap:{},r.supportWeakMap||r._maps.push(this)}l(r,"laya.utils.WeakObject");var H=r.prototype;return H.set=function(H,n){if(null!=H)if(r.supportWeakMap){var C=H;"string"!=typeof H&&"number"!=typeof H||(C=r._keys[H])||(C=r._keys[H]={k:H}),this._obj.set(C,n)}else"string"==typeof H||"number"==typeof H?this._obj[H]=n:(H.$_GID||(H.$_GID=u.getGID()),this._obj[H.$_GID]=n)},H.get=function(H){if(null==H)return null;if(r.supportWeakMap){var n="string"==typeof H||"number"==typeof H?r._keys[H]:H;return n?this._obj.get(n):null}return"string"==typeof H||"number"==typeof H?this._obj[H]:this._obj[H.$_GID]},H.del=function(H){if(null!=H)if(r.supportWeakMap){var n="string"==typeof H||"number"==typeof H?r._keys[H]:H;if(!n)return;this._obj.delete(n)}else"string"==typeof H||"number"==typeof H?delete this._obj[H]:delete this._obj[this._obj.$_GID]},H.has=function(H){if(null==H)return!1;if(r.supportWeakMap){var n="string"==typeof H||"number"==typeof H?r._keys[H]:H;return this._obj.has(n)}return"string"==typeof H||"number"==typeof H?null!=this._obj[H]:null!=this._obj[this._obj.$_GID]},r.__init__=function(){(r.supportWeakMap=null!=_.window.WeakMap)||F.timer.loop(r.delInterval,null,r.clearCache)},r.clearCache=function(){for(var H=0,n=r._maps.length;H<n;H++){r._maps[H]._obj={}}},r.supportWeakMap=!1,r.delInterval=3e5,r._keys={},r._maps=[],P(r,["I",function(){return this.I=new r}]),r}(),B=function(){function H(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}l(H,"laya.utils.WordText");var n=H.prototype;return n.setText=function(H){this.changed=!0,this._text=H},n.toString=function(){return this._text},n.charCodeAt=function(H){return this._text?this._text.charCodeAt(H):NaN},n.charAt=function(H){return this._text?this._text.charAt(H):null},R(0,n,"length",function(){return this._text?this._text.length:0}),H}(),HH=function(H){function I(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,I.__super.call(this),this._childs=I.ARRAY_EMPTY,this._$P=I.PROP_EMPTY,this.timer=F.scaleTimer,this.conchModel=Z.isConchNode?this.createConchModel():null}l(I,"laya.display.Node",t);var n=I.prototype;return n._setBit=function(H,n){1==H&&(this._getBit(H)!=n&&this._updateDisplayedInstage());n?this._bits|=H:this._bits&=~H},n._getBit=function(H){return 0!=(this._bits&H)},n._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},n._setUpNoticeType=function(H){var n=this;for(n._setBit(H,!0),n=n.parent;n;){if(n._getBit(H))return;n._setBit(H,!0),n=n.parent}},n.on=function(H,n,C,r){return"display"!==H&&"undisplay"!==H||this._getBit(1)||this._setUpNoticeType(1),this._createListener(H,n,C,r,!1)},n.once=function(H,n,C,r){return"display"!==H&&"undisplay"!==H||this._getBit(1)||this._setUpNoticeType(1),this._createListener(H,n,C,r,!0)},n.createConchModel=function(){return null},n.destroy=function(H){void 0===H&&(H=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(H?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},n.destroyChildren=function(){if(this._childs)for(var H=this._childs.length-1;-1<H;H--)this._childs[H].destroy(!0)},n.addChild=function(H){if(!H||this.destroyed||H===this)return H;if(H.zOrder&&this._set$P("hasZorder",!0),H._parent===this){var n=this.getChildIndex(H);n!==this._childs.length-1&&(this._childs.splice(n,1),this._childs.push(H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,this._childs.length-1)),this._childChanged())}else H.parent&&H.parent.removeChild(H),this._childs===I.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(H),this.conchModel&&this.conchModel.addChildAt(H.conchModel,this._childs.length-1),(H.parent=this)._childChanged();return H},n.addChildren=function(H){for(var n=arguments,C=0,r=n.length;C<r;)this.addChild(n[C++])},n.addChildAt=function(H,n){if(!H||this.destroyed||H===this)return H;if(H.zOrder&&this._set$P("hasZorder",!0),0<=n&&n<=this._childs.length){if(H._parent===this){var C=this.getChildIndex(H);this._childs.splice(C,1),this._childs.splice(n,0,H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,n)),this._childChanged()}else H.parent&&H.parent.removeChild(H),this._childs===I.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(n,0,H),this.conchModel&&this.conchModel.addChildAt(H.conchModel,n),H.parent=this;return H}throw new Error("appendChildAt:The index is out of bounds")},n.getChildIndex=function(H){return this._childs.indexOf(H)},n.getChildByName=function(H){var n=this._childs;if(n)for(var C=0,r=n.length;C<r;C++){var N=n[C];if(N.name===H)return N}return null},n._get$P=function(H){return this._$P[H]},n._set$P=function(H,n){return this.destroyed||(this._$P===I.PROP_EMPTY&&(this._$P={}),this._$P[H]=n),n},n.getChildAt=function(H){return this._childs[H]},n.setChildIndex=function(H,n){var C=this._childs;if(n<0||n>=C.length)throw new Error("setChildIndex:The index is out of bounds.");var r=this.getChildIndex(H);if(r<0)throw new Error("setChildIndex:node is must child of this object.");return C.splice(r,1),C.splice(n,0,H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,n)),this._childChanged(),H},n._childChanged=function(H){},n.removeChild=function(H){if(!this._childs)return H;var n=this._childs.indexOf(H);return this.removeChildAt(n)},n.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},n.removeChildByName=function(H){var n=this.getChildByName(H);return n&&this.removeChild(n),n},n.removeChildAt=function(H){var n=this.getChildAt(H);if(n){for(var C=this._childs.length-1,r=H;r<C;++r)this._childs[r]=this._childs[r+1];this._childs.length=C,this.conchModel&&this.conchModel.removeChild(n.conchModel),n.parent=null}return n},n.removeChildren=function(H,n){if(void 0===H&&(H=0),void 0===n&&(n=2147483647),this._childs&&0<this._childs.length){var C=this._childs;if(0===H&&Q<=n){var r=C;this._childs=I.ARRAY_EMPTY}else r=C.splice(H,n-H);for(var N=0,Q=r.length;N<Q;N++)r[N].parent=null,this.conchModel&&this.conchModel.removeChild(r[N].conchModel)}return this},n.replaceChild=function(H,n){var C=this._childs.indexOf(n);return-1<C?(this._childs.splice(C,1,H),this.conchModel&&(this.conchModel.removeChild(n.conchModel),this.conchModel.addChildAt(H.conchModel,C)),n.parent=null,H.parent=this,H):null},n._updateDisplayedInstage=function(){var H;H=this;var n=F.stage;for(this._displayedInStage=!1;H;){if(H._getBit(1)){this._displayedInStage=H._displayedInStage;break}if(H==n||H._displayedInStage){this._displayedInStage=!0;break}H=H.parent}},n._setDisplay=function(H){this._displayedInStage!==H&&((this._displayedInStage=H)?this.event("display"):this.event("undisplay"))},n._displayChild=function(H,n){var C=H._childs;if(C)for(var r=0;r<C.length;r++){var N=C[r];N&&N._getBit(1)&&(0<N._childs.length?this._displayChild(N,n):N._setDisplay(n))}H._setDisplay(n)},n.contains=function(H){if(H===this)return!0;for(;H;){if(H.parent===this)return!0;H=H.parent}return!1},n.timerLoop=function(H,n,C,r,N,Q){void 0===N&&(N=!0),void 0===Q&&(Q=!1),this.timer.loop(H,n,C,r,N,Q)},n.timerOnce=function(H,n,C,r,N){void 0===N&&(N=!0),this.timer._create(!1,!1,H,n,C,r,N)},n.frameLoop=function(H,n,C,r,N){void 0===N&&(N=!0),this.timer._create(!0,!0,H,n,C,r,N)},n.frameOnce=function(H,n,C,r,N){void 0===N&&(N=!0),this.timer._create(!0,!1,H,n,C,r,N)},n.clearTimer=function(H,n){this.timer.clear(H,n)},R(0,n,"numChildren",function(){return this._childs.length}),R(0,n,"destroyed",function(){return this._destroyed}),R(0,n,"parent",function(){return this._parent},function(H){this._parent!==H&&(H?(this._parent=H,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),H.displayedInStage&&this._displayChild(this,!0)),H._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=H))}),R(0,n,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),I.ARRAY_EMPTY=[],I.PROP_EMPTY={},I.NOTICE_DISPLAY=1,I.MOUSEENABLE=2,I}(),nH=function(H){function o(H){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,o.__super.call(this),this._padding=o._PADDING,this._spacing=o._SPACING,this._aligns=o._ALIGNS,this._font=M.EMPTY,this._ower=H}l(o,"laya.display.css.CSSStyle",H);var n=o.prototype;return n.destroy=function(){this._ower=null,this._font=null,this._rect=null},n.inherit=function(H){this._font=H._font,this._spacing=H._spacing===o._SPACING?o._SPACING:H._spacing.slice(),this.lineHeight=H.lineHeight},n._widthAuto=function(){return 0!=(262144&this._type)},n.widthed=function(H){return 0!=(8&this._type)},n._calculation=function(H,n){if(n.indexOf("%")<0)return!1;var r=this._ower,N=r.parent,Q=this._rect;function I(H,n,C){return H*C[0]+n*C[1]+C[2]}function C(H){var n=N.width,C=r.width;Q.width&&(r.width=I(n,C,Q.width)),Q.height&&(r.height=I(n,C,Q.height)),Q.left&&(r.x=I(n,C,Q.left)),Q.top&&(r.y=I(n,C,Q.top))}null===Q&&(N._getCSSStyle()._type|=524288,N.on("resize",this,C),this._rect=Q={input:{}});var A=n.split(" ");return A[0]=parseFloat(A[0])/100,1==A.length?A[1]=A[2]=0:(A[1]=parseFloat(A[1])/100,A[2]=parseFloat(A[2])),Q[H]=A,Q.input[H]=n,C(),!0},n.heighted=function(H){return 0!=(8192&this._type)},n.size=function(H,n){var C=this._ower,r=!1;-1!==H&&H!=this._ower.width&&(this._type|=8,this._ower.width=H,r=!0),-1!==n&&n!=this._ower.height&&(this._type|=8192,this._ower.height=n,r=!0),r&&(C._layoutLater(),524288&this._type&&C.event("resize",this))},n._getAlign=function(){return this._aligns[0]},n._getValign=function(){return this._aligns[1]},n._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},n._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new M(this._font))},n.render=function(H,n,C,r){var N=H.width,Q=H.height;C-=H.pivotX,r-=H.pivotY,this._bgground&&null!=this._bgground.color&&n.ctx.fillRect(C,r,N,Q,this._bgground.color),this._border&&this._border.color&&n.drawRect(C,r,N,Q,this._border.color.strColor,this._border.size)},n.getCSSStyle=function(){return this},n.cssText=function(H){this.attrs(o.parseOneCSS(H,";"))},n.attrs=function(H){if(H)for(var n=0,C=H.length;n<C;n++){var r=H[n];this[r[0]]=r[1]}},n.setTransform=function(H){"none"===H?this._tf=A._TF_EMPTY:this.attrs(o.parseOneCSS(H,","))},n.translate=function(H,n){this._tf===A._TF_EMPTY&&(this._tf=new N),this._tf.translateX=H,this._tf.translateY=n},n.scale=function(H,n){this._tf===A._TF_EMPTY&&(this._tf=new N),this._tf.scaleX=H,this._tf.scaleY=n},n._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},R(0,n,"block",H.prototype._$get_block,function(H){H?this._type|=1:this._type&=-2}),R(0,n,"valign",function(){return o._valigndef[this._aligns[1]]},function(H){this._aligns===o._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=o._valigndef[H]}),R(0,n,"height",null,function(H){if(this._type|=8192,"string"==typeof H){if(this._calculation("height",H))return;H=parseInt(H)}this.size(-1,H)}),R(0,n,"width",null,function(H){if(this._type|=8,"string"==typeof H){var n=H.indexOf("auto");if(0<=n&&(this._type|=262144,H=H.substr(0,n)),this._calculation("width",H))return;H=parseInt(H)}this.size(H,-1)}),R(0,n,"fontWeight",function(){return this._font.weight},function(H){this._createFont().weight=H}),R(0,n,"left",null,function(H){var n=this._ower;if("string"==typeof H){if("center"===H?H="50% -50% 0":"right"===H&&(H="100% -100% 0"),this._calculation("left",H))return;H=parseInt(H)}n.x=H}),R(0,n,"_translate",null,function(H){this.translate(H[0],H[1])}),R(0,n,"absolute",function(){return 0!=(4&this._type)}),R(0,n,"top",null,function(H){var n=this._ower;if("string"==typeof H){if("middle"===H?H="50% -50% 0":"bottom"===H&&(H="100% -100% 0"),this._calculation("top",H))return;H=parseInt(H)}n.y=H}),R(0,n,"align",function(){return o._aligndef[this._aligns[0]]},function(H){this._aligns===o._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=o._aligndef[H]}),R(0,n,"bold",function(){return this._font.bold},function(H){this._createFont().bold=H}),R(0,n,"padding",function(){return this._padding},function(H){this._padding=H}),R(0,n,"leading",function(){return this._spacing[1]},function(H){"string"==typeof H&&(H=parseInt(H+"")),this._spacing===o._SPACING&&(this._spacing=[0,0]),this._spacing[1]=H}),R(0,n,"lineElement",function(){return 0!=(65536&this._type)},function(H){H?this._type|=65536:this._type&=-65537}),R(0,n,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(H){this.lineElement=!1,"right"===H?this._type|=32768:this._type&=-32769}),R(0,n,"textDecoration",function(){return this._font.decoration},function(H){this._createFont().decoration=H}),R(0,n,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(H){"nowrap"===H&&(this._type|=131072),"none"===H&&(this._type&=-131073)}),R(0,n,"background",null,function(H){H?(this._bgground||(this._bgground={}),this._bgground.color=H,this._ower.conchModel&&this._ower.conchModel.bgColor(H),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),R(0,n,"wordWrap",function(){return 0==(131072&this._type)},function(H){H?this._type&=-131073:this._type|=131072}),R(0,n,"color",function(){return this._font.color},function(H){this._createFont().color=H}),R(0,n,"password",function(){return this._font.password},function(H){this._createFont().password=H}),R(0,n,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(H){"none"===H?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=H),this._ower.conchModel&&this._ower.conchModel.bgColor(H),this._ower._renderType|=256}),R(0,n,"font",function(){return this._font.toString()},function(H){this._createFont().set(H)}),R(0,n,"weight",null,function(H){this._createFont().weight=H}),R(0,n,"letterSpacing",function(){return this._spacing[0]},function(H){"string"==typeof H&&(H=parseInt(H+"")),this._spacing===o._SPACING&&(this._spacing=[0,0]),this._spacing[0]=H}),R(0,n,"fontSize",function(){return this._font.size},function(H){this._createFont().size=H}),R(0,n,"italic",function(){return this._font.italic},function(H){this._createFont().italic=H}),R(0,n,"fontFamily",function(){return this._font.family},function(H){this._createFont().family=H}),R(0,n,"stroke",function(){return this._font.stroke[0]},function(H){this._createFont().stroke===M._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=H}),R(0,n,"strokeColor",function(){return this._font.stroke[1]},function(H){this._createFont().stroke===M._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=H}),R(0,n,"border",function(){return this._border?this._border.value:""},function(H){if("none"!=H){this._border||(this._border={});var n=(this._border.value=H).split(" ");if(this._border.color=x.create(n[n.length-1]),1==n.length)return this._border.size=1,void(this._border.type="solid");var C=0;0<n[0].indexOf("px")?(this._border.size=parseInt(n[0]),C++):this._border.size=1,this._border.type=n[C],this._ower._renderType|=256}else this._border=null}),R(0,n,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(H){H?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==H?null:x.create(H),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),R(0,n,"position",function(){return 4&this._type?"absolute":""},function(H){"absolute"==H?this._type|=4:this._type&=-5}),R(0,n,"display",null,function(H){switch(H){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),R(0,n,"paddingLeft",function(){return this.padding[3]}),R(0,n,"paddingTop",function(){return this.padding[0]}),R(0,n,"_scale",null,function(H){this._ower.scale(H[0],H[1])}),R(0,n,"_rotate",null,function(H){this._ower.rotation=H}),o.parseOneCSS=function(H,n){for(var C,r=[],N=H.split(n),Q=0,I=N.length;Q<I;Q++){var A=N[Q],P=A.indexOf(":"),t=A.substr(0,P).replace(/^\s+|\s+$/g,"");if(0!=t.length){var R=A.substr(P+1).replace(/^\s+|\s+$/g,""),y=[t,R];switch(t){case"italic":case"bold":y[1]="true"==R;break;case"line-height":y[0]="lineHeight",y[1]=parseInt(R);break;case"font-size":y[0]="fontSize",y[1]=parseInt(R);break;case"padding":1<(C=R.split(" ")).length||(C[1]=C[2]=C[3]=C[0]),y[1]=[parseInt(C[0]),parseInt(C[1]),parseInt(C[2]),parseInt(C[3])];break;case"rotate":y[0]="_rotate",y[1]=parseFloat(R);break;case"scale":C=R.split(" "),y[0]="_scale",y[1]=[parseFloat(C[0]),parseFloat(C[1])];break;case"translate":C=R.split(" "),y[0]="_translate",y[1]=[parseInt(C[0]),parseInt(C[1])];break;default:(y[0]=o._CSSTOVALUE[t])||(y[0]=t)}r.push(y)}}return r},o.parseCSS=function(H,n){for(var C;null!=(C=o._parseCSSRegExp.exec(H));)o.styleSheets[C[1]]=o.parseOneCSS(C[2],";")},o.EMPTY=new o(null),o._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},o._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),o._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},o._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},o.styleSheets={},o.ALIGN_CENTER=1,o.ALIGN_RIGHT=2,o.VALIGN_MIDDLE=1,o.VALIGN_BOTTOM=2,o._CSS_BLOCK=1,o._DISPLAY_NONE=2,o._ABSOLUTE=4,o._WIDTH_SET=8,o._PADDING=[0,0,0,0],o._RECT=[-1,-1,-1,-1],o._SPACING=[0,0],o._ALIGNS=[0,0,0],o.ADDLAYOUTED=512,o._NEWFONT=4096,o._HEIGHT_SET=8192,o._BACKGROUND_SET=16384,o._FLOAT_RIGHT=32768,o._LINE_ELEMENT=65536,o._NOWARP=131072,o._WIDTHAUTO=262144,o._LISTERRESZIE=524288,o}(A),CH=function(H){function I(){this.url=null,this.audio=null,this.loaded=!1,I.__super.call(this)}l(I,"laya.media.h5audio.AudioSound",t);var n=I.prototype;return n.dispose=function(){var H=I._audioCache[this.url];H&&(H.src="",delete I._audioCache[this.url])},n.load=function(H){var n;if(H=e.formatURL(H),(this.url=H)==L._tMusic?(I._initMusicAudio(),(n=I._musicAudio).src!=H&&(I._audioCache[n.src]=null,n=null)):n=I._audioCache[H],n&&2<=n.readyState)this.event("complete");else{n||(n=H==L._tMusic?(I._initMusicAudio(),I._musicAudio):_.createElement("audio"),(I._audioCache[H]=n).src=H),n.addEventListener("canplaythrough",r),n.addEventListener("error",N);var C=this;(this.audio=n).load?n.load():N()}function r(){Q(),C.loaded=!0,C.event("complete")}function N(){n.load=null,Q(),C.event("error")}function Q(){n.removeEventListener("canplaythrough",r),n.removeEventListener("error",N)}},n.play=function(H,n,C){if(void 0===H&&(H=0),void 0===n&&(n=0),!this.url)return null;var r,N;if(!(r=this.url==L._tMusic?I._musicAudio:I._audioCache[this.url]))return null;N=E.getItem("audio:"+this.url),Z.isConchApp?N||((N=_.createElement("audio")).src=this.url):this.url==L._tMusic?(I._initMusicAudio(),(N=I._musicAudio).src=this.url):N=N||r.cloneNode(!0);var Q=new oH(N);return Q.url=this.url,Q.loops=n,Q.startTime=H,Q.startHandler=C,Q.play(!1),L.addChannel(Q),Q},R(0,n,"duration",function(){var H;return(H=I._audioCache[this.url])?H.duration:0}),I._initMusicAudio=function(){I._musicAudio||(I._musicAudio||(I._musicAudio=_.createElement("audio")),Z.isConchApp||_.document.addEventListener("mousedown",I._makeMusicOK))},I._makeMusicOK=function(){_.document.removeEventListener("mousedown",I._makeMusicOK),I._musicAudio.src?I._musicAudio.play():(I._musicAudio.src="",I._musicAudio.load())},I._audioCache={},I._musicAudio=null,I}(),rH=function(H){function n(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,n.__super.call(this)}l(n,"laya.media.SoundChannel",t);var C=n.prototype;return C.play=function(){},C.stop=function(){},C.pause=function(){},C.resume=function(){},C.__runComplete=function(H){H&&H.run()},R(0,C,"volume",function(){return 1},function(H){}),R(0,C,"position",function(){return 0}),R(0,C,"duration",function(){return 0}),n}(),NH=function(H){function n(){n.__super.call(this)}l(n,"laya.media.Sound",t);var C=n.prototype;return C.load=function(H){},C.play=function(H,n,C){return void 0===H&&(H=0),void 0===n&&(n=0),null},C.dispose=function(){},R(0,C,"duration",function(){return 0}),n}(),QH=function(H){function N(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,N.__super.call(this)}l(N,"laya.media.webaudio.WebAudioSound",t);var n=N.prototype;return n.load=function(H){this.url=H,this.audioBuffer=N._dataCache[H],this.audioBuffer?this._loaded(this.audioBuffer):(N.e.on("loaded:"+H,this,this._loaded),N.e.on("err:"+H,this,this._err),N.__loadingSound[H]||(N.__loadingSound[H]=!0,F.loader.load(H,c.create(this,this.onloaded),null,AH.BUFFER,4,!1,null,!0)))},n.onloaded=function(H){H||this._err(),this._disposed?this._removeLoadEvents():(this.data=H,N.buffs.push({buffer:this.data,url:this.url}),N.decode())},n._err=function(){if(this._removeLoadEvents(),N.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var H,n,C,r=0;for(H=(n=this.__toPlays).length,r=0;r<H;r++)(C=n[r])[3]&&!C[3].isStopped&&C[3].event("error");this.__toPlays.length=0}},n._loaded=function(H){this._removeLoadEvents(),this._disposed||(this.audioBuffer=H,this.loaded=!0,this.event("complete"))},n._removeLoadEvents=function(){N.e.off("loaded:"+this.url,this,this._loaded),N.e.off("err:"+this.url,this,this._err)},n.__playAfterLoaded=function(){if(this.__toPlays){var H,n,C,r=0;for(H=(n=this.__toPlays).length,r=0;r<H;r++)(C=n[r])[3]&&!C[3].isStopped&&this.play(C[0],C[1],C[2],C[3]);this.__toPlays.length=0}},n.play=function(H,n,C,r){return void 0===H&&(H=0),void 0===n&&(n=0),r=r||new gH,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([H,n,C,r]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),r.url=this.url,r.loops=n,r.audioBuffer=this.audioBuffer,r.startTime=H,r.startHandler=C,r.play(!1),L.addChannel(r),r},n.dispose=function(){this._disposed=!0,delete N._dataCache[this.url],delete N.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},R(0,n,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),N.decode=function(){if(!(N.buffs.length<=0||N.isDecoding))if(N.isDecoding=!0,(N.tInfo=N.buffs.shift())&&N.tInfo.buffer&&N.tInfo.buffer.byteLength)try{N.ctx.decodeAudioData(N.tInfo.buffer,N._done,N._fail)}catch(H){console.error("decodeAudioData error  byteLength:"+N.tInfo.buffer.byteLength+"  url:"+N.tInfo.url)}else N._fail()},N._done=function(H){N.e.event("loaded:"+N.tInfo.url,H),N._dataCache[N.tInfo.url]=H,N.isDecoding=!1,N.decode()},N._fail=function(){N.e.event("err:"+N.tInfo.url,null),N.isDecoding=!1,N.decode()},N._playEmptySound=function(){if(null!=N.ctx){if(N._emptySource&&(N._emptySource.stop(),N._emptySource.disconnect(0),!gH._tryCleanFailed))try{N._emptySource.buffer=null}catch(H){gH._tryCleanFailed=!0}var H=N.ctx.createBufferSource();H.buffer=N._miniBuffer,H.connect(N.ctx.destination),H.start(0,0,0),N._emptySource=H}},N._unlock=function(){N._unlocked||(N._playEmptySound(),"running"==N.ctx.state?(_.document.removeEventListener("mousedown",N._unlock,!0),_.document.removeEventListener("touchend",N._unlock,!0),_.document.removeEventListener("touchstart",N._unlock,!0),N._unlocked=!0):"suspended"==N.ctx.state&&L._recoverWebAudio())},N.initWebAudio=function(){"running"!=N.ctx.state&&(N._unlock(),_.document.addEventListener("mousedown",N._unlock,!0),_.document.addEventListener("touchend",N._unlock,!0),_.document.addEventListener("touchstart",N._unlock,!0))},N._emptySource=null,N._dataCache={},N.buffs=[],N.isDecoding=!1,N._unlocked=!1,N.tInfo=null,N.__loadingSound={},P(N,["window",function(){return this.window=_.window},"webAudioEnabled",function(){return this.webAudioEnabled=N.window.AudioContext||N.window.webkitAudioContext||N.window.mozAudioContext},"ctx",function(){return this.ctx=N.webAudioEnabled?new(N.window.AudioContext||N.window.webkitAudioContext||N.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=N.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new t}]),N}(),IH=function(H){function n(){this._responseType=null,this._data=null,n.__super.call(this),this._http=new _.window.XMLHttpRequest}l(n,"laya.net.HttpRequest",t);var C=n.prototype;return C.send=function(H,n,C,r,N){void 0===C&&(C="get"),void 0===r&&(r="text"),this._responseType=r,this._data=null;var Q=this,I=this._http;if(I.open(C,H,!0),N)for(var A=0;A<N.length;A++)I.setRequestHeader(N[A++],N[A]);else Z.isConchApp||(n&&"string"!=typeof n?I.setRequestHeader("Content-Type","application/json"):I.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));I.responseType="arraybuffer"!==r?"text":"arraybuffer",I.onerror=function(H){Q._onError(H)},I.onabort=function(H){Q._onAbort(H)},I.onprogress=function(H){Q._onProgress(H)},I.onload=function(H){Q._onLoad(H)},I.send(n)},C._onProgress=function(H){H&&H.lengthComputable&&this.event("progress",H.loaded/H.total)},C._onAbort=function(H){this.error("Request was aborted by user")},C._onError=function(H){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},C._onLoad=function(H){var n=this._http,C=void 0!==n.status?n.status:200;200===C||204===C||0===C?this.complete():this.error("["+n.status+"]"+n.statusText+":"+n.responseURL)},C.error=function(H){this.clear(),this.event("error",H)},C.complete=function(){this.clear();var n=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=u.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(H){n=!1,this.error(H.message)}n&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},C.clear=function(){var H=this._http;H.onerror=H.onabort=H.onprogress=H.onload=null},R(0,C,"url",function(){return this._http.responseURL}),R(0,C,"http",function(){return this._http}),R(0,C,"data",function(){return this._data}),n}(),AH=function(H){function a(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,a.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}l(a,"laya.net.Loader",t);var n=a.prototype;return n.load=function(H,n,C,r,N){if(H&&""!=H||console.error("Loader 加载的url不合法 "+H),void 0===C&&(C=!0),void 0===N&&(N=!1),this._url=H,this._base64=!1,0===H.indexOf("data:image")?(this._base64=!0,this._type=n="image"):this._type=n||(n=this.getTypeFromUrl(H)),this._cache=C,this._data=null,!N&&a.loadedMap[H])return this._data=a.loadedMap[H],this.event("progress",1),void this.event("complete",this._data);if(r&&a.setGroup(H,r),null!=a.parserMap[n])return this._customParse=!0,void(a.parserMap[n]instanceof laya.utils.Handler?a.parserMap[n].runWith(this):a.parserMap[n].call(null,this));if("image"===n||"htmlimage"===n||"nativeimage"===n)return this._loadImage(H);if("ttf"===n)return this._loadTTF(H);switch(n){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:n}a.preLoadedMap[H]?this.onLoaded(a.preLoadedMap[H]):g.resMgrLoad(H,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},n.getTypeFromUrl=function(H){var n=u.getFileExtension(H);return n?a.typeMap[n]:(console.warn("Not recognize the resources suffix",H),"text")},n._loadTTF=function(H){H=e.formatURL(H);var n=new v;n.complete=c.create(this,this.onLoaded),n.load(H)},n._loadBase64Image=function(n){n=e.formatURL(n);var C,H=this;function r(){C.onload=null,C.onerror=null,delete a.imgCache[n]}function N(){r(),H.onLoaded(C)}function Q(){r(),H.event("error","Load image failed")}"nativeimage"===this._type?((C=new _.window.Image).crossOrigin="",C.onload=N,C.onerror=Q,C.src=n,a.imgCache[n]=C):new wH.create(n,{onload:N,onerror:Q,onCreate:function(H){C=H,a.imgCache[n]=H}})},n._loadImage=function(H){this._base64?this._loadBase64Image(H):g.imgMgrLoad(H,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},n._loadImageComplete=function(H,n,C){if(null!=C)if(C instanceof ArrayBuffer){var r=new DataView(C),N=new laya.webgl.resource.WebGLImage(new Uint8Array(C,8),H,0,!1,r.getUint32(0),r.getUint32(4));this.onLoaded(N)}else if(C instanceof RH)a.imgMgrSet[H]=n,g.imgMgrLock(H,a.imgMgrSet[H]),this._url=H,this.complete(C);else{var Q=-1!=H.indexOf(".png",H.length-4)?6408:6407;N=new laya.webgl.resource.WebGLImage(C,H,Q,!1,C.width,C.height);this.onLoaded(N)}else this.event("error","Load image failed")},n.imageCancel=function(H,n,C){g.imgMgrCancel&&g.imgMgrCancel(H,this._onImageCallback)},n._loadSound=function(H){var n=new L._soundClass,C=this;function r(){n.offAll()}n.on("complete",this,function(){r(),C.onLoaded(n)}),n.on("error",this,function(){r(),n.dispose(),C.event("error","Load sound failed")}),n.load(H)},n.onProgress=function(H){"atlas"===this._type?this.event("progress",.3*H):this.event("progress",H)},n.onError=function(H){this.event("error",H)},n._loadedComplete=function(H,n,C){if(null!=C)switch(this._type){case"atlas":case"plf":case"json":var r=new U(C);this.onLoaded(JSON.parse(r.readUTFBytes()));break;case"font":r=new U(C);this.onLoaded(u.parseXMLFromString(r.readUTFBytes()));break;default:this.onLoaded(C)}else this.event("error",H)},n.onLoaded=function(H){var n=this._type;if("plf"==n)this.parsePLFData(H),this.complete(H);else if("image"===n){var C=new RH(H);C.url=this._url,this.complete(C)}else if("sound"===n||"htmlimage"===n||"nativeimage"===n)this.complete(H);else if("atlas"===n){if(!H.src&&!H._setContext){if(!this._data){if((this._data=H).meta&&H.meta.image)for(var r=H.meta.image.split(","),N=0<=this._url.indexOf("/")?"/":"\\",Q=this._url.lastIndexOf(N),I=0<=Q?this._url.substr(0,Q+1):"",A=0,P=r.length;A<P;A++)r[A]=I+r[A];else r=[this._url.replace(".json",".png")];r.reverse(),H.toLoads=r,H.pics=[]}return this.event("progress",.3+1/r.length*.6),this._loadImage(r.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(H),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var t=this._data.frames,R=this._url.split("?")[0],y=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:R.substring(0,R.lastIndexOf("."))+"/",o=this._data.pics,g=e.formatURL(this._url),M=a.atlasMap[g]||(a.atlasMap[g]=[]);M.dir=y;var j=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var l in j=parseFloat(this._data.meta.scale),t){var f,c=t[l],K=o[c.frame.idx?c.frame.idx:0],W=e.formatURL(y+l);K.scaleRate=j,f=RH.create(K,c.frame.x,c.frame.y,c.frame.w,c.frame.h,c.spriteSourceSize.x,c.spriteSourceSize.y,c.sourceSize.w,c.sourceSize.h),a.cacheRes(W,f),a.keepCache(this._url,y+l),f.url=W,M.push(W)}else for(l in t)K=o[(c=t[l]).frame.idx?c.frame.idx:0],W=e.formatURL(y+l),a.cacheRes(W,RH.create(K,c.frame.x,c.frame.y,c.frame.w,c.frame.h,c.spriteSourceSize.x,c.spriteSourceSize.y,c.sourceSize.w,c.sourceSize.h)),a.loadedMap[W].url=W,a.keepCache(this._url,y+l),M.push(W);delete this._data.pics,this.complete(this._data)}else if("font"==n){if(!H.src)return this._data=H,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var z=new D;z.parseFont(this._data,H);var w=this._url.split(".fnt")[0].split("/"),F=w[w.length-1];lH.registerBitmapFont(F,z),this._data=z,this.complete(this._data)}else if("pkm"==n){var k=wH.create(H,this._url),i=new RH(k);i.url=this._url,this.complete(i)}else this.complete(H)},n.parsePLFData=function(H){var n,C,r;for(n in H)switch(r=H[n],n){case"json":case"text":for(C in r)a.preLoadedMap[e.formatURL(C)]=r[C];break;default:for(C in r)a.preLoadedMap[e.formatURL(C)]=r[C]}},n.complete=function(H){this._data=H,this._customParse?this.event("loaded",H instanceof Array?[H]:H):(a._loaders.push(this),a._isWorking||a.checkNext())},n.endLoad=function(H){H&&(this._data=H),this._cache&&a.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},R(0,n,"url",function(){return this._url}),R(0,n,"data",function(){return this._data}),R(0,n,"cache",function(){return this._cache}),R(0,n,"type",function(){return this._type}),a.checkNext=function(){a._isWorking=!0;for(var H=_.now();a._startIndex<a._loaders.length;)if(_.now(),a._loaders[a._startIndex].endLoad(),a._startIndex++,_.now()-H>a.maxTimeOut)return console.warn("loader callback cost a long time:"+(_.now()-H)+" url="+a._loaders[a._startIndex-1].url),void F.timer.frameOnce(1,null,a.checkNext);a._loaders.length=0,a._startIndex=0,a._isWorking=!1},a.clearRes=function(H,n){if(null!=H){void 0===n&&(n=!1),H=e.formatURL(H);var C=a.getAtlas(H);if(C){for(var r=0,N=C.length;r<N;r++){var Q=C[r],I=a.getRes(Q);delete a.loadedMap[Q],a.clearCache(H.substring(e.basePath.length),Q.substring(e.basePath.length)),I&&I.destroy(n)}C.length=0,delete a.atlasMap[H],delete a.loadedMap[H]}else{var A=a.loadedMap[H];A&&(delete a.loadedMap[H],A instanceof laya.resource.Texture&&A.bitmap&&A.destroy(n))}}},a.clearTextureRes=function(H){H=e.formatURL(H);var n=laya.net.Loader.getAtlas(H),C=n&&0<n.length?laya.net.Loader.getRes(n[0]):laya.net.Loader.getRes(H);C&&C.bitmap&&(Z.isConchApp&&!Z.isConchWebGL?C.bitmap.source.releaseTexture&&C.bitmap.source.releaseTexture():null==C.bitmap._atlaser&&C.bitmap.releaseResource(!0))},a.getRes=function(H){return a.loadedMap[e.formatURL(H)]},a.getAtlas=function(H){return a.atlasMap[e.formatURL(H)]},a.cacheRes=function(H,n){H=e.formatURL(H),null!=a.loadedMap[H]?console.warn("Resources already exist,is repeated loading:",H):a.loadedMap[H]=n},a.setGroup=function(H,n){a.groupMap[n]||(a.groupMap[n]=[]),a.groupMap[n].push(H)},a.clearResByGroup=function(H){if(a.groupMap[H]){var n=a.groupMap[H],C=0,r=n.length;for(C=0;C<r;C++)a.clearRes(n[C]);n.length=0}},a.keepCache=function(H,n){if(H&&n){var C=a.cacheSet[n];C?-1==C.indexOf(H)&&C.push(H):a.cacheSet[n]=[H]}},a.clearCache=function(H,n){if(H&&n){var C=a.cacheSet[n];if(C){var r=C.indexOf(H);if(-1!==r){var N=C.length-1;0==N?(delete a.cacheSet[n],0<a.imgMgrSet[n]?g.imgMgrFree(n,a.imgMgrSet[n]):a.clearRes(n,!0)):(C[r]=C[N],C.length=N)}}}},a.saveObject=function(H,n,C){if(n&&H){var r=a.objectSet[H];r?(console.warn("Loader.saveObject: "+H),r[0]=n,r[1]=C):a.objectSet[H]=[n,C,[]]}},a.findObject=function(H){if(H){var n=a.objectSet[H];if(n)return n[0]}return null},a.keepObject=function(H,n){if(H&&n){var C=a.objectSet[n];C&&-1===C[2].indexOf(H)&&C[2].push(H)}},a.clearObject=function(H,n){if(H&&n){var C=a.objectSet[n];if(C){var r=C[2],N=r.indexOf(H);if(-1!==N){var Q=r.length-1;0==Q?(delete a.objectSet[n],C[1]&&C[1].call(null,C[0])):(r[N]=r[Q],r.length=Q)}}}},a.TEXT="text",a.JSON="json",a.XML="xml",a.BUFFER="arraybuffer",a.IMAGE="image",a.SOUND="sound",a.ATLAS="atlas",a.FONT="font",a.TTF="ttf",a.PLF="plf",a.PKM="pkm",a.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},a.parserMap={},a.groupMap={},a.maxTimeOut=100,a.loadedMap={},a.preLoadedMap={},a.atlasMap={},a._loaders=[],a._isWorking=!1,a._startIndex=0,a.imgCache={},a.cacheSet={},a.objectSet={},a.imgMgrSet={},a}(),PH=function(H){var o;function g(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},g.__super.call(this);for(var H=0;H<this._maxPriority;H++)this._resInfos[H]=[]}l(g,"laya.net.LoaderManager",t);var n=g.prototype;return n.create=function(H,C,n,r,N,Q,I,A){if(null==Q&&(Q=2),null==I&&(I=!0),H instanceof Array){var P=H,t=P.length,R=0;if(n)var y=c.create(n.caller,n.method,n.args,!1);for(var o=0;o<t;o++){var g=P[o];"string"==typeof g&&(g=P[o]={url:g}),g.progress=0}for(o=0;o<t;o++){g=P[o];var M=n?c.create(null,f,[g],!1):null,j=n||C?c.create(null,l,[g]):null;this._create(g.url,j,M,g.clas||r,g.params||N,null!=g.priority&&0<=g.priority?g.priority:Q,I,g.group||A)}function l(H,n){R++,H.progress=1,R===t&&C&&C.run()}function f(H,n){H.progress=n;for(var C=0,r=0;r<t;r++){C+=P[r].progress}var N=C/t;y.runWith(N)}return!0}return this._create(H,C,n,r,N,Q,I,A)},n._create=function(n,C,H,r,N,Q,I,A){n&&""!=n||console.error("加载的url不合法 "+n),null==Q&&(Q=2),null==I&&(I=!0);var P=e.formatURL(n),t=this.getRes(P);if(t)!t.hasOwnProperty("loaded")||t.loaded?(H&&H.runWith(1),C&&C.run()):C&&F.loader._createListener(n,C.caller,C.method,C.args,!0,!1);else{var R=u.getFileExtension(n),y=g.createMap[R];if(!y)throw new Error("LoaderManager:unknown file("+n+") extension with: "+R+".");r||(r=y[0]);var o=y[1];if("atlas"==R)this.load(n,C,H,o,Q,I);else{r===RH&&(o="htmlimage"),(t=r?new r:null).hasOwnProperty("_loaded")&&(t._loaded=!1),t._setUrl(n),A&&t._setGroup(A),this._createLoad(t,n,c.create(null,function(H){t&&!t.destroyed&&H&&t.onAsynLoaded.call(t,n,H,N),C&&C.run();F.loader.event(n)}),H,o,Q,!1,A,!0),I&&this.cacheRes(P,t)}}return t},n.load=function(H,n,C,r,N,Q,I,A){H&&""!=H||console.error("加载的url不合法 "+H);var P=this;if(null==N&&(N=2),null==Q&&(Q=!0),void 0===A&&(A=!1),H instanceof Array)return this._loadAssets(H,n,C,r,N,Q,I);var t=AH.getRes(H);if(null!=t)F.timer.frameOnce(1,null,function(){C&&C.runWith(1),n&&n.runWith(t),P._loaderCount||P.event("complete")});else{var R=g._resMap[H];R?(n&&R._createListener("complete",n.caller,n.method,n.args,!1,!1),C&&R._createListener("progress",C.caller,C.method,C.args,!1,!1)):((R=this._infoPool.length?this._infoPool.pop():new o).url=H,R.clas=null,R.type=r,R.cache=Q,R.group=I,R.ignoreCache=A,R.priority=N,n&&R.on("complete",n.caller,n.method,n.args),C&&R.on("progress",C.caller,C.method,C.args),g._resMap[H]=R,N=N<this._maxPriority?0<=N?N:0:this._maxPriority-1,this._resInfos[N].push(R),this._next())}return this},n.cancel=function(H,n,C){if(t=g._resMap[H]){n&&t.off("complete",n.caller,n.method,!1),C&&t.off("progress",C.caller,C.method,!1);var r=t.getListener("complete"),N=t.getListener("progress");if(!(r&&r.head||N&&N.head)){if(t.loader){var Q=t.loader;Q.imageCancel(H),Q.offAll(),Q._data=null,Q._customParse=!1,Q._url=null,Q._class=null,Q._type=null,this._loaders.push(Q),this._loaderCount--,delete this._loaderMap[t.url]}for(var I=0;I<this._maxPriority;I++)for(var A=this._resInfos[I],P=A.length-1;-1<P;P--){var t;(t=A[P])&&t.url===H&&(A[P]=null,t.destroy(),t.offAll(),this._infoPool.push(t))}delete g._resMap[H],this._next()}}},n._createLoad=function(H,n,C,r,N,Q,I,A,P){var t=this;if(null==Q&&(Q=2),null==I&&(I=!0),void 0===P&&(P=!1),n instanceof Array)return this._loadAssets(n,C,r,N,Q,I,A);var R=AH.getRes(n);if(null!=R)F.timer.frameOnce(1,null,function(){r&&r.runWith(1),C&&C.runWith(R),t._loaderCount||t.event("complete")});else{var y=g._resMap[n];y?(C&&y._createListener("complete",C.caller,C.method,C.args,!1,!1),r&&y._createListener("progress",r.caller,r.method,r.args,!1,!1)):((y=this._infoPool.length?this._infoPool.pop():new o).url=n,y.clas=H,y.type=N,y.cache=I,y.group=A,y.ignoreCache=P,y.priority=Q,C&&y.on("complete",C.caller,C.method,C.args),r&&y.on("progress",r.caller,r.method,r.args),g._resMap[n]=y,Q=Q<this._maxPriority?0<=Q?Q:0:this._maxPriority-1,this._resInfos[Q].push(y),this._next())}return this},n._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var H=0;H<this._maxPriority;H++)for(var n=this._resInfos[H];0<n.length;){var C=n.shift();if(C)return this._doLoad(C)}this._loaderCount||this.event("complete")}},n._doLoad=function(n){var C=this._loaders.length?this._loaders.pop():new AH;this._loaderCount++,(this._loaderMap[n.url]=C).on("complete",null,N),C.on("progress",null,function(H){n.event("progress",H)}),C.on("error",null,function(H){N(null)}),n.loader=C;var r=this;function N(H){C.offAll(),C._data=null,C._customParse=!1,C._url=null,C._class=null,C._type=null,r._loaders.push(C),r._loaderCount--,delete r._loaderMap[n.url],r._endLoad(n,H instanceof Array?[H]:H),r._next()}C._class=n.clas,1<=n.priority?(C.priority=n.priority,C.realTime=!1):(C.priority=0,C.realTime=!0),C.load(n.url,n.type,n.cache,n.group,n.ignoreCache)},n._endLoad=function(H,n){var C=H.url;if(null==n){var r=this._failRes[C]||0;if(r<this.retryNum)return console.warn("[warn]Retry to load:",C),this._failRes[C]=r+1,void F.timer.once(this.retryDelay,this,this._addReTry,[H],!1);console.warn("[error]Failed to load:",C),this.event("error",C)}this._failRes[C]&&(this._failRes[C]=0),delete g._resMap[C],H.event("complete",n),H.destroy(),H.offAll(),this._infoPool.push(H)},n._addReTry=function(H){this._resInfos[this._maxPriority-1].push(H),this._next()},n.clearRes=function(H,n){void 0===n&&(n=!1),AH.clearRes(H,n)},n.getRes=function(H){return AH.getRes(H)},n.cacheRes=function(H,n){AH.cacheRes(H,n)},n.clearTextureRes=function(H){AH.clearTextureRes(H)},n.setGroup=function(H,n){AH.setGroup(H,n)},n.clearResByGroup=function(H){AH.clearResByGroup(H)},n.clearUnLoaded=function(){for(var H=0;H<this._maxPriority;H++){for(var n=this._resInfos[H],C=n.length-1;-1<C;C--){var r=n[C];r&&(r.destroy(),r.offAll(),this._infoPool.push(r))}n.length=0}this._loaderCount=0,g._resMap={}},n.cancelLoadByUrls=function(H){if(H)for(var n=0,C=H.length;n<C;n++)this.cancelLoadByUrl(H[n])},n.cancelLoadByUrl=function(H){for(var n=0;n<this._maxPriority;n++)for(var C=this._resInfos[n],r=C.length-1;-1<r;r--){var N=C[r];N&&N.url===H&&(C[r]=null,N.destroy(),N.offAll(),this._infoPool.push(N))}g._resMap[H]&&delete g._resMap[H]},n._loadAssets=function(H,C,I,n,r,N,Q){null==r&&(r=2),null==N&&(N=!0);for(var A=H.length,P=0,t=0,R=[],y=!0,o=0;o<A;o++){var g=H[o];if(!g)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+H);"string"==typeof g&&(g={url:g,type:n,size:1,priority:r}),g.size||(g.size=1),g.progress=0,t+=g.size,R.push(g);var M=I?c.create(null,f,[g],!1):null,j=C||I?c.create(null,l,[g]):null;this.load(g.url,j,M,g.type,null!=g.priority&&0<=g.priority?g.priority:2,N,g.group||Q)}function l(H,n){P++,H.progress=1,n||(y=!1),P===A&&C&&C.runWith(y)}function f(H,n){if(null!=I){H.progress=n;for(var C=0,r=0;r<R.length;r++){var N=R[r];C+=N.size*N.progress}var Q=C/t;I.runWith(Q)}}return this},g.cacheRes=function(H,n){AH.cacheRes(H,n)},g._resMap={},P(g,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),g.__init$=function(){o=function(H){function n(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,n.__super.call(this)}return l(n,"",t),n.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},n}()},g}(),tH=(function(H){function N(H){N.__super.call(this),H||(H=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var n=0,C=0,r=0;r<20;r++)r%5!=4?this._mat[n++]=H[r]:this._alpha[C++]=H[r];this._action=b.createFilterAction(32),this._action.data=this}l(N,"laya.filters.ColorFilter",K);var n=N.prototype;F.imps(n,{"laya.filters.IFilter":!0}),n.callNative=function(H){H._$P.cf=this;H.conchModel&&H.conchModel.setFilterMatrix&&H.conchModel.setFilterMatrix(this._mat,this._alpha)},R(0,n,"type",function(){return 32}),R(0,n,"action",function(){return this._action})}(),function(H){function r(H,n,C){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===n&&(n=0),r.__super.call(this),this._byteClass=C||U,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,H&&0<n&&n<65535&&this.connect(H,n)}l(r,"laya.net.Socket",t);var n=r.prototype;n.connect=function(H,n){var C="ws://"+H+":"+n;C="https:"==_.window.location.protocol?"wss://"+H+":"+n:"ws://"+H+":"+n,this.connectByUrl(C)},n.connectByUrl=function(H){var n=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new _.window.WebSocket(H,this.protocols):this._socket=new _.window.WebSocket(H),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(H){n._onOpen(H)},this._socket.onmessage=function(H){n._onMessage(H)},this._socket.onclose=function(H){n._onClose(H)},this._socket.onerror=function(H){n._onError(H)}},n.cleanSocket=function(){try{this._socket.close()}catch(H){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},n.close=function(){if(null!=this._socket)try{this._socket.close()}catch(H){}},n._onOpen=function(H){this._connected=!0,this.event("open",H)},n._onMessage=function(H){if(H&&H.data){var n=H.data;if(this.disableInput&&n)this.event("message",n);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var C=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,n&&("string"==typeof n?this._input.writeUTFBytes(n):this._input.writeArrayBuffer(n),this._addInputPosition=this._input.pos,this._input.pos=C),this.event("message",n)}}},n._onClose=function(H){this._connected=!1,this.event("close",H)},n._onError=function(H){this.event("error",H)},n.send=function(H){this._socket.send(H)},n.flush=function(){if(this._output&&0<this._output.length){var n;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(H){n=H}this._output.endian=this.endian,this._output.clear(),n&&this.event("error",n)}},R(0,n,"input",function(){return this._input}),R(0,n,"output",function(){return this._output}),R(0,n,"connected",function(){return this._connected}),R(0,n,"endian",function(){return this._endian},function(H){this._endian=H,null!=this._input&&(this._input.endian=H),null!=this._output&&(this._output.endian=H)}),r.LITTLE_ENDIAN="littleEndian",r.BIG_ENDIAN="bigEndian"}(),function(H){function A(){A.__super.call(this),this._$1__id=++A._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(A._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,d.currentResourceManager&&d.currentResourceManager.addResource(this)}l(A,"laya.resource.Resource",t);var n=A.prototype;return F.imps(n,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),n._setUrl=function(H){var n;this._url!==H&&(this._url&&((n=A._urlResourcesMap[this._url]).splice(n.indexOf(this),1),0===n.length&&delete A._urlResourcesMap[this._url]),H&&((n=A._urlResourcesMap[H])||(A._urlResourcesMap[H]=n=[]),n.push(this)),this._url=H)},n._getGroup=function(){return this._group},n._setGroup=function(H){var n;this._group!==H&&(this._group&&((n=A._groupResourcesMap[this._group]).splice(n.indexOf(this),1),0===n.length&&delete A._groupResourcesMap[this._group]),H&&((n=A._groupResourcesMap[H])||(A._groupResourcesMap[H]=n=[]),n.push(this)),this._group=H)},n._addReference=function(){this._referenceCount++},n._removeReference=function(){this._referenceCount--},n._clearReference=function(){this._referenceCount=0},n._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},n.recreateResource=function(){this.completeCreate()},n.disposeResource=function(){},n.activeResource=function(H){void 0===H&&(H=!1),this._lastUseFrameCount=G.loopCount,!this._destroyed&&this.__loaded&&(this._released||H)&&this.recreateResource()},n.releaseResource=function(H){return void 0===H&&(H=!0),!(!H&&this.lock)&&(!(this._released&&!H)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},n.onAsynLoaded=function(H,n,C){throw new Error("Resource: must override this function!")},n.destroy=function(){var H;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete A._idResourcesMap[this.id],this._url&&((H=A._urlResourcesMap[this._url])&&(H.splice(H.indexOf(this),1),0===H.length&&delete A._urlResourcesMap[this.url]),AH.clearRes(this._url),this.__loaded||b.cancelLoadByUrl(this._url)),this._group&&((H=A._groupResourcesMap[this._group]).splice(H.indexOf(this),1),0===H.length&&delete A._groupResourcesMap[this.url]))},n.completeCreate=function(){this._released=!1,this.event("recovered",this)},n.dispose=function(){this.destroy()},R(0,n,"memorySize",function(){return this._memorySize},function(H){var n=H-this._memorySize;this._memorySize=H,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,n),this.resourceManager&&this.resourceManager.addSize(n)}),R(0,n,"_loaded",null,function(H){this.__loaded=H}),R(0,n,"loaded",function(){return this.__loaded}),R(0,n,"id",function(){return this._$1__id}),R(0,n,"destroyed",function(){return this._destroyed}),R(0,n,"group",function(){return this._getGroup()},function(H){this._setGroup(H)}),R(0,n,"resourceManager",function(){return this._resourceManager}),R(0,n,"url",function(){return this._url}),R(0,n,"released",function(){return this._released}),R(0,n,"referenceCount",function(){return this._referenceCount}),A.getResourceByID=function(H){return A._idResourcesMap[H]},A.getResourceByURL=function(H,n){return void 0===n&&(n=0),null==A._urlResourcesMap[H]?null:A._urlResourcesMap[H][n]},A.getResourceCountByURL=function(H){return A._urlResourcesMap[H].length},A.destroyUnusedResources=function(H){var n;if(H){var C=A._groupResourcesMap[H];if(C)for(var r=C.slice(),N=0,Q=r.length;N<Q;N++)(n=r[N]).lock||0!==n._referenceCount||n.destroy()}else for(var I in A._idResourcesMap)(n=A._idResourcesMap[I]).lock||0!==n._referenceCount||n.destroy()},A._uniqueIDCounter=0,A._idResourcesMap={},A._urlResourcesMap={},A._groupResourcesMap={},A}()),RH=function(H){function a(H,n){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,a.__super.call(this),H&&null!=H._addReference&&H._addReference(),this.setTo(H,n)}l(a,"laya.resource.Texture",t);var n=a.prototype;return n._setUrl=function(H){this.url=H},n.setTo=function(H,n){if(H instanceof g.HTMLElement){var C=KH.create("2D",H);this.bitmap=C}else this.bitmap=H;if(this.uv=n||a.DEF_UV,H){this._w=H.width,this._h=H.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var r=this;if(this._loaded)b.addToAtlas&&b.addToAtlas(r);else{var N=H;N instanceof laya.resource.HTMLImage&&N.image&&N.image.addEventListener("load",function(H){b.addToAtlas&&b.addToAtlas(r)},!1)}}},n.active=function(){this.bitmap&&this.bitmap.activeResource()},n.destroy=function(H){if(void 0===H&&(H=!1),this.alphaTexture&&(this.alphaTexture.destroy(H),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var n=this.bitmap;H?(Z.isConchApp&&n.source&&n.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,n.dispose(),n._clearReference()):(n._removeReference(),0==n.referenceCount&&(Z.isConchApp&&n.source&&n.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,n.dispose())),this.url&&this===F.loader.getRes(this.url)&&F.loader.clearRes(this.url,H),this._loaded=!1}},n.load=function(H){var n=this;this._loaded=!1,H=e.customFormat(H);var C=this.bitmap||(this.bitmap=wH.create(H));C.uri=H,C&&C._addReference();var r=this;C.onload=function(){C.onload=null,r._loaded=!0,n.sourceWidth=n._w=C.width,n.sourceHeight=n._h=C.height,r.event("loaded",this),b.addToAtlas&&b.addToAtlas(r)}},n.addTextureToAtlas=function(H){b.addTextureToAtlas(this)},n.getPixels=function(H,n,C,r){if(Z.isConchApp){var N=this.bitmap;if(N.source&&N.source.getImageData){var Q=N.source.getImageData(H,n,C,r),I=new Uint8Array(Q);return Array.from(I)}return null}return Z.isWebGL?b.getTexturePixels(this,H,n,C,r):(_.canvas.size(C,r),_.canvas.clear(),_.context.drawTexture(this,-H,-n,this.width,this.height,0,0),_.context.getImageData(0,0,C,r).data)},n.onAsynLoaded=function(H,n){if(n){if("function"!=typeof n._addReference)throw new Error("bitmap._addReference is not a function. "+n.className+" "+typeof n._addReference+" "+n.constructor);n._addReference()}this.setTo(n,this.uv),this._loaded&&this.event("loaded",this)},R(0,n,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),R(0,n,"loaded",function(){return this._loaded}),R(0,n,"released",function(){return!this.bitmap||this.bitmap.released}),R(0,n,"width",function(){return this._w?this._w:this.uv&&this.uv!==a.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(H){this._w=H,this.sourceWidth||(this.sourceWidth=H)}),R(0,n,"repeat",function(){return!Z.isWebGL||!this.bitmap||this.bitmap.repeat},function(H){H&&Z.isWebGL&&this.bitmap&&(this.bitmap.repeat=H)&&(this.bitmap.enableMerageInAtlas=!1)}),R(0,n,"height",function(){return this._h?this._h:this.uv&&this.uv!==a.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(H){this._h=H,this.sourceHeight||(this.sourceHeight=H)}),R(0,n,"isLinearSampling",function(){return!Z.isWebGL||9728!=this.bitmap.minFifter},function(H){!H&&Z.isWebGL&&(H||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),a.moveUV=function(H,n,C){for(var r=0;r<8;r+=2)C[r]+=H,C[r+1]+=n;return C},a.create=function(H,n,C,r,N,Q,I,A,P){void 0===Q&&(Q=0),void 0===I&&(I=0),void 0===A&&(A=0),void 0===P&&(P=0);var t=H instanceof laya.resource.Texture,R=t?H.uv:a.DEF_UV,y=t?H.bitmap:H,o=b.isAtlas(y);if(o){var g=y._atlaser,M=H._atlasID;if(-1==M)throw new Error("create texture error");y=g._inAtlasTextureBitmapValue[M],R=g._inAtlasTextureOriUVValue[M]}var j=new a(y,null);if(!y)return null;y.width&&n+r>y.width&&(r=y.width-n),y.height&&C+N>y.height&&(N=y.height-C),j.width=r,j.height=N,j.offsetX=Q,j.offsetY=I,j.sourceWidth=A||r,j.sourceHeight=P||N;var l=1/y.width,f=1/y.height;n*=l,C*=f,r*=l,N*=f;var c=j.uv[0],K=j.uv[1],W=j.uv[4],z=j.uv[5],w=W-c,F=z-K,k=a.moveUV(R[0],R[1],[n,C,n+r,C,n+r,C+N,n,C+N]);j.uv=[c+k[0]*w,K+k[1]*F,W-(1-k[2])*w,K+k[3]*F,W-(1-k[4])*w,z-(1-k[5])*F,c+k[6]*w,z-(1-k[7])*F],o&&j.addTextureToAtlas();var i=y.scaleRate;return i&&1!=i?(j.sourceWidth/=i,j.sourceHeight/=i,j.width/=i,j.height/=i,j.scaleRate=i,j.offsetX/=i,j.offsetY/=i):j.scaleRate=1,j},a.createFromTexture=function(H,n,C,r,N){var Q=H.scaleRate;1!=Q&&(n*=Q,C*=Q,r*=Q,N*=Q);var I=i.TEMP.setTo(n-H.offsetX,C-H.offsetY,r,N),A=I.intersection(a._rect1.setTo(0,0,H.width,H.height),a._rect2);if(!A)return null;var P=a.create(H,A.x,A.y,A.width,A.height,A.x-I.x,A.y-I.y,r,N);if(P.bitmap&&P.bitmap._removeReference)return P.bitmap._removeReference(),P;var t="bitmap:"+(P.bitmap?P.bitmap.constructor?P.bitmap.constructor.name:P.bitmap.__className:"")+", url:"+(H.url+" | "+(P.bitmap?P.bitmap.url:H.url))+", x="+n+",y="+C+",width="+r+",height="+N+", result="+(A?A.x+","+A.y+","+A.width+","+A.height:"null")+", rect="+I.x+","+I.y+","+I.width+","+I.height;throw new Error("报错：bitmap._removeReference is not a function  "+t)},a.DEF_UV=[0,0,1,0,1,1,0,1],a.INV_UV=[0,1,1,1,1,0,0,0],a._rect1=new i,a._rect2=new i,a}(),H=function(H){var A;function Q(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,Q.__super.call(this)}l(Q,"laya.utils.TimeLine",t);var n=Q.prototype;return n.to=function(H,n,C,r,N){return void 0===N&&(N=0),this._create(H,n,C,r,N,!0)},n.from=function(H,n,C,r,N){return void 0===N&&(N=0),this._create(H,n,C,r,N,!1)},n._create=function(H,n,C,r,N,Q){var I=E.getItemByClass("tweenData",A);return I.isTo=Q,I.type=0,I.target=H,I.duration=C,I.data=n,I.startTime=this._startTime+N,I.endTime=I.startTime+I.duration,I.ease=r,this._startTime=Math.max(I.endTime,this._startTime),this._tweenDataList.push(I),this._startTimeSort=!0,this._endTimeSort=!0,this},n.addLabel=function(H,n){var C=E.getItemByClass("tweenData",A);return C.type=1,C.data=H,C.endTime=C.startTime=this._startTime+n,this._labelDic||(this._labelDic={}),this._labelDic[H]=C,this._tweenDataList.push(C),this},n.removeLabel=function(H){if(this._labelDic&&this._labelDic[H]){var n=this._labelDic[H];if(n){var C=this._tweenDataList.indexOf(n);-1<C&&this._tweenDataList.splice(C,1)}delete this._labelDic[H]}},n.gotoTime=function(H){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var n,C,r,N;for(var Q in this._firstTweenDic)if(C=this._firstTweenDic[Q])for(var I in C)C.diyTarget.hasOwnProperty(I)&&(C.diyTarget[I]=C[I]);for(Q in this._tweenDic)(n=this._tweenDic[Q]).clear(),delete this._tweenDic[Q];if(this._index=0,this._gidIndex=0,this._currTime=H,this._lastTime=_.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=r=this._tweenDataList.concat(),r.sort(function(H,n){return H.endTime>n.endTime?1:H.endTime<n.endTime?-1:0})}else r=this._endTweenDataList;for(var A=0,P=r.length;A<P;A++)if(0==(N=r[A]).type){if(!(H>=N.endTime))break;this._index=Math.max(this._index,A+1);var t=N.data;if(N.isTo)for(var R in t)N.target[R]=t[R]}for(A=0,P=this._tweenDataList.length;A<P;A++)0==(N=this._tweenDataList[A]).type&&H>=N.startTime&&H<N.endTime&&(this._index=Math.max(this._index,A+1),this._gidIndex++,(n=E.getItemByClass("tween",Y))._create(N.target,N.data,N.duration,N.ease,c.create(this,this._animComplete,[this._gidIndex]),0,!1,N.isTo,!0,!1),n.setStartTime(this._currTime-(H-N.startTime)),n._updateEase(this._currTime),n.gid=this._gidIndex,this._tweenDic[this._gidIndex]=n)}},n.gotoLabel=function(H){if(null!=this._labelDic){var n=this._labelDic[H];n&&this.gotoTime(n.startTime)}},n.pause=function(){F.timer.clear(this,this._update)},n.resume=function(){this.play(this._currTime,this._loopKey)},n.play=function(H,n){if(void 0===H&&(H=0),void 0===n&&(n=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(H,n){return H.startTime>n.startTime?1:H.startTime<n.startTime?-1:0});for(var C=0,r=this._tweenDataList.length;C<r;C++){var N=this._tweenDataList[C];if(null!=N&&0==N.type){var Q=N.target,I=Q.$_GID||(Q.$_GID=u.getGID()),A=null;for(var P in null==this._firstTweenDic[I]?((A={}).diyTarget=Q,this._firstTweenDic[I]=A):A=this._firstTweenDic[I],N.data)null==A[P]&&(A[P]=Q[P])}}}"string"==typeof H?this.gotoLabel(H):this.gotoTime(H),this._loopKey=n,this._lastTime=_.now(),F.timer.frameLoop(1,this,this._update)}},n._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var H in this._tweenDic)(n=this._tweenDic[H]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var n,C=_.now(),r=C-this._lastTime,N=this._currTime+=r*this.scale;for(H in this._lastTime=C,this._tweenDic)(n=this._tweenDic[H])._updateEase(N);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var Q=this._tweenDataList[this._index];N>=Q.startTime&&(this._index++,0==Q.type?(this._gidIndex++,(n=E.getItemByClass("tween",Y))._create(Q.target,Q.data,Q.duration,Q.ease,c.create(this,this._animComplete,[this._gidIndex]),0,!1,Q.isTo,!0,!1),n.setStartTime(N),n.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=n)._updateEase(N)):this.event("label",Q.data))}},n._animComplete=function(H){this._tweenDic[H]&&delete this._tweenDic[H]},n._complete=function(){this.event("complete")},n.reset=function(){var H;if(this._labelDic)for(H in this._labelDic)delete this._labelDic[H];for(H in this._tweenDic)this._tweenDic[H].clear(),delete this._tweenDic[H];for(H in this._firstTweenDic)delete this._firstTweenDic[H];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var n,C=0;for(n=this._tweenDataList.length,C=0;C<n;C++)this._tweenDataList[C]&&this._tweenDataList[C].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,F.timer.clear(this,this._update)},n.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},R(0,n,"index",function(){return this._frameIndex},function(H){this._frameIndex=H,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),R(0,n,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),Q.to=function(H,n,C,r,N){return void 0===N&&(N=0),(new Q).to(H,n,C,r,N)},Q.from=function(H,n,C,r,N){return void 0===N&&(N=0),(new Q).from(H,n,C,r,N)},Q.__init$=function(){A=function(){function H(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return l(H,""),H.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,E.recover("tweenData",this)},H}()},Q}(),yH=function(N){function C(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,C.__super.call(this),this._style=A.EMPTY}l(C,"laya.display.Sprite",N);var H=C.prototype;return F.imps(H,{"laya.display.ILayout":!0}),H.createConchModel=function(){return new ConchNode},H.destroy=function(H){if(void 0===H&&(H=!0),this._releaseMem(),!this._destroyed){this.filters=null;var n=this.mask;n&&(this.mask=null,n.destroy(H))}N.prototype.destroy.call(this,H),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},H.updateZOrder=function(){u.updateOrder(this._childs)&&this.repaint()},H.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},H.setBounds=function(H){this._set$P("uBounds",H)},H.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new i),i._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},H.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new i),i._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},H._boundPointsToParent=function(H){void 0===H&&(H=!1);var n=0,C=0;this._style&&(n=this._style._tf.translateX,C=this._style._tf.translateY,H=H||0!==this._style._tf.rotate,this._style.scrollRect&&(n+=this._style.scrollRect.x,C+=this._style.scrollRect.y));var r=this._getBoundPointsM(H);if(!r||r.length<1)return r;if(8!=r.length&&(r=H?z.scanPList(r):i._getWrapRec(r,i.TEMP)._getBoundPoints()),!this.transform)return u.transPointList(r,this._x-n,this._y-C),r;var N=k.TEMP,Q=0,I=r.length;for(Q=0;Q<I;Q+=2)N.x=r[Q],N.y=r[Q+1],this.toParentPoint(N),r[Q]=N.x,r[Q+1]=N.y;return r},H.getGraphicBounds=function(H){return void 0===H&&(H=!1),this._graphics?this._graphics.getBounds(H):i.TEMP.setTo(0,0,0,0)},H._getBoundPointsM=function(H){if(void 0===H&&(H=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var n=u.clearArray(this._$P.temBM),C=i.TEMP;return C.copyFrom(this.scrollRect),u.concatArray(n,C._getBoundPoints()),n}for(var r,N,Q,I=this._graphics?this._graphics.getBoundPoints():u.clearArray(this._$P.temBM),A=0,P=(Q=this._childs).length;A<P;A++)(r=Q[A])instanceof laya.display.Sprite&&1==r.visible&&(N=r._boundPointsToParent(H))&&(I=I?u.concatArray(I,N):N);return I},H.getStyle=function(){return this._style===A.EMPTY&&(this._style=new A),this._style},H.setStyle=function(H){this._style=H},H._adjustTransform=function(){this._tfChanged=!1;var H,n=this._style._tf,C=n.scaleX,r=n.scaleY;if(n.rotate||1!==C||1!==r||n.skewX||n.skewY){(H=this._transform||(this._transform=h.create())).bTransform=!0;var N=.0174532922222222*(n.rotate-n.skewX),Q=.0174532922222222*(n.rotate+n.skewY),I=Math.cos(Q),A=Math.sin(Q),P=Math.sin(N),t=Math.cos(N);return H.a=C*I,H.b=C*A,H.c=-r*P,H.d=r*t,H.tx=H.ty=0,H}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,H},H.pos=function(H,n,C){if(void 0===C&&(C=!1),this._x!==H||this._y!==n){if(this.destroyed)return this;if(C){this._x=H,this._y=n,this.conchModel&&this.conchModel.pos(this._x,this._y);var r=this._parent;r&&0===r._repaint&&(r._repaint=1,r.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=H,this.y=n}return this},H.pivot=function(H,n){return this.pivotX=H,this.pivotY=n,this},H.size=function(H,n){return this.width=H,this.height=n,this},H.scale=function(H,n,C){void 0===C&&(C=!1);var r=this.getStyle(),N=r._tf;if(N.scaleX!=H||N.scaleY!=n){if(this.destroyed)return this;if(C){r.setScale(H,n),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(H,n),this._renderType|=4;var Q=this._parent;Q&&0===Q._repaint&&(Q._repaint=1,Q.parentRepaint())}else this.scaleX=H,this.scaleY=n}return this},H.skew=function(H,n){return this.skewX=H,this.skewY=n,this},H.render=function(H,n,C){G.spriteCount++,p.renders[this._renderType]._fun(this,H,n+this._x,C+this._y),this._repaint=0},H.drawToCanvas=function(H,n,C,r){if(Z.isConchNode){var N=KH.create("2D");return new q(H,n,N).ctx.setCanvasType(1),this.conchModel.drawToCanvas(N.source,C,r),N}return b.drawToCanvas(this,this._renderType,H,n,C,r)},H.customRender=function(H,n,C){this._renderType|=1024},H._applyFilters=function(){var H;if(!Z.isWebGL&&((H=this._$P.filters)&&!(H.length<1)))for(var n=0,C=H.length;n<C;n++)H[n].action.apply(this._$P.cacheCanvas)},H._isHaveGlowFilter=function(){var H,n=0;if(this.filters)for(n=0;n<this.filters.length;n++)if(8==this.filters[n].type)return!0;for(n=0,H=this._childs.length;n<H;n++)if(this._childs[n]._isHaveGlowFilter())return!0;return!1},H.localToGlobal=function(H,n){void 0===n&&(n=!1),!0===n&&(H=new k(H.x,H.y));for(var C=this;C&&C!=F.stage;)H=C.toParentPoint(H),C=C.parent;return H},H.globalToLocal=function(H,n){void 0===n&&(n=!1),n&&(H=new k(H.x,H.y));for(var C=this,r=[];C&&C!=F.stage;)r.push(C),C=C.parent;for(var N=r.length-1;0<=N;)H=(C=r[N]).fromParentPoint(H),N--;return H},H.toParentPoint=function(H){if(!H)return H;H.x-=this.pivotX,H.y-=this.pivotY,this.transform&&this._transform.transformPoint(H),H.x+=this._x,H.y+=this._y;var n=this._style.scrollRect;return n&&(H.x-=n.x,H.y-=n.y),H},H.fromParentPoint=function(H){if(!H)return H;H.x-=this._x,H.y-=this._y;var n=this._style.scrollRect;return n&&(H.x+=n.x,H.y+=n.y),this.transform&&this._transform.invertTransformPoint(H),H.x+=this.pivotX,H.y+=this.pivotY,H},H.on=function(H,n,C,r){return 1!==this._mouseEnableState&&this.isMouseEvent(H)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(H,n,C,r,!1)):N.prototype.on.call(this,H,n,C,r)},H.once=function(H,n,C,r){return 1!==this._mouseEnableState&&this.isMouseEvent(H)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(H,n,C,r,!0)):N.prototype.once.call(this,H,n,C,r)},H._$2__onDisplay=function(){if(1!==this._mouseEnableState){var H=this;for(H=H.parent;H&&1!==H._mouseEnableState&&!H._getBit(2);)H.mouseEnabled=!0,H._setBit(2,!0),H=H.parent}},H.loadImage=function(H,n,C,r,N,Q){var I=this;return void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0),void 0===N&&(N=0),this.graphics.loadImage(H,n,C,r,N,function(H){I.destroyed||(I.size(n+(r||H.width),C+(N||H.height)),I.repaint(),Q&&Q.runWith(H))}),this},H.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},H._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},H._childChanged=function(H){this._childs.length?this._renderType|=2048:this._renderType&=-2049,H&&this._get$P("hasZorder")&&F.timer.callLater(this,this.updateZOrder),this.repaint()},H.parentRepaint=function(){var H=this._parent;H&&0===H._repaint&&(H._repaint=1,H.parentRepaint())},H.startDrag=function(H,n,C,r,N,Q,I){void 0===n&&(n=!1),void 0===C&&(C=0),void 0===r&&(r=300),void 0===Q&&(Q=!1),void 0===I&&(I=.92),this._$P.dragging||this._set$P("dragging",new O),this._$P.dragging.start(this,H,n,C,r,N,Q,I)},H.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},H._releaseMem=function(){if(this._$P){var H=this._$P.cacheCanvas;H&&H.ctx&&(E.recover("RenderContext",H.ctx),H.ctx.canvas.size(0,0),H.ctx=null);var n=this._$P._filterCache;n&&(n.destroy(),n.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},H._setDisplay=function(H){H||this._releaseMem(),N.prototype._setDisplay.call(this,H)},H.hitTestPoint=function(H,n){var C=this.globalToLocal(k.TEMP.setTo(H,n));return H=C.x,n=C.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?i.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(H,n)},H.getMousePoint=function(){return this.globalToLocal(k.TEMP.setTo(F.stage.mouseX,F.stage.mouseY))},H._getWords=function(){return null},H._addChildsToLayout=function(H){var n=this._getWords();if(null==n&&0==this._childs.length)return!1;if(n)for(var C=0,r=n.length;C<r;C++)H.push(n[C]);C=0;for(var N=this._childs.length;C<N;++C){var Q=this._childs[C];Q._style._enableLayout()&&Q._addToLayout(H)}return!0},H._addToLayout=function(H){this._style.absolute||(this._style.block?H.push(this):this._addChildsToLayout(H)&&(this.x=this.y=0))},H._isChar=function(){return!1},H._getCSSStyle=function(){return this._style.getCSSStyle()},H._setAttributes=function(H,n){switch(H){case"x":this.x=parseFloat(n);break;case"y":this.y=parseFloat(n);break;case"width":this.width=parseFloat(n);break;case"height":this.height=parseFloat(n);break;default:this[H]=n}},H._layoutLater=function(){this.parent&&this.parent._layoutLater()},R(0,H,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(H){this._optimizeScrollRect!=H&&(this._optimizeScrollRect=H,this.conchModel&&this.conchModel.optimizeScrollRect(H))}),R(0,H,"customRenderEnable",null,function(H){if(H&&(this._renderType|=1024,Z.isConchNode)){C.CustomList.push(this);var n=new KH("2d");n._setContext(new CanvasRenderingContext2D),this.customContext=new q(0,0,n),n.context.setCanvasType&&n.context.setCanvasType(2),this.conchModel.custom(n.context)}}),R(0,H,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(H){this.cacheAs=H?this._$P.hasFilter?"none":"normal":"none"}),R(0,H,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(H){var n=this._$P.cacheCanvas;if(H!==(n?n.type:"none")){if("none"!==H)this._getBit(1)||this._setUpNoticeType(1),n||(n=this._set$P("cacheCanvas",E.getItemByClass("cacheCanvas",Object))),n.type=H,n.reCache=!0,this._renderType|=16,"bitmap"==H&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(n){var C=n;C&&C.ctx&&(E.recover("RenderContext",C.ctx),C.ctx.canvas.size(0,0),C.ctx=null),E.recover("cacheCanvas",n)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),R(0,H,"zOrder",function(){return this._zOrder},function(H){this._zOrder!=H&&(this._zOrder=H,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(H),this._parent&&(H&&this._parent._set$P("hasZorder",!0),F.timer.callLater(this._parent,this.updateZOrder)))}),R(0,H,"rotation",function(){return this._style._tf.rotate},function(H){var n=this.getStyle();if(n._tf.rotate!==H){n.setRotate(H),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(H),this._renderType|=4;var C=this._parent;C&&0===C._repaint&&(C._repaint=1,C.parentRepaint())}}),R(0,H,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(H){this._width!==H&&(this._width=H,this.conchModel&&this.conchModel.size(H,this._height),this.repaint())}),R(0,H,"x",function(){return this._x},function(H){if(this._x!==H){if(this.destroyed)return;this._x=H,this.conchModel&&this.conchModel.pos(H,this._y);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),R(0,H,"globalScaleY",function(){for(var H=1,n=this;n&&n!==F.stage;)H*=n.scaleY,n=n.parent;return H}),R(0,H,"hitArea",function(){return this._$P.hitArea},function(H){this._set$P("hitArea",H)}),R(0,H,"staticCache",function(){return this._$P.staticCache},function(H){this._set$P("staticCache",H),H||this.reCache()}),R(0,H,"texture",function(){return this._texture},function(H){this._texture!=H&&(this._texture=H,this.graphics.cleanByTexture(H,0,0))}),R(0,H,"y",function(){return this._y},function(H){if(this._y!==H){if(this.destroyed)return;this._y=H,this.conchModel&&this.conchModel.pos(this._x,H);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),R(0,H,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(H){this._height!==H&&(this._height=H,this.conchModel&&this.conchModel.size(this._width,H),this.repaint())}),R(0,H,"blendMode",function(){return this._style.blendMode},function(H){this.getStyle().blendMode=H,this.conchModel&&this.conchModel.blendMode(H),H&&"source-over"!=H?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),R(0,H,"scaleX",function(){return this._style._tf.scaleX},function(H){var n=this.getStyle();if(n._tf.scaleX!==H){n.setScaleX(H),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(H,n._tf.scaleY),this._renderType|=4;var C=this._parent;C&&0===C._repaint&&(C._repaint=1,C.parentRepaint())}}),R(0,H,"scaleY",function(){return this._style._tf.scaleY},function(H){var n=this.getStyle();if(n._tf.scaleY!==H){n.setScaleY(H),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(n._tf.scaleX,H),this._renderType|=4;var C=this._parent;C&&0===C._repaint&&(C._repaint=1,C.parentRepaint())}}),R(0,H,"stage",function(){return F.stage}),R(0,H,"skewX",function(){return this._style._tf.skewX},function(H){var n=this.getStyle();if(n._tf.skewX!==H){n.setSkewX(H),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(H,n._tf.skewY),this._renderType|=4;var C=this._parent;C&&0===C._repaint&&(C._repaint=1,C.parentRepaint())}}),R(0,H,"scrollRect",function(){return this._style.scrollRect},function(H){this.getStyle().scrollRect=H,this.repaint(),H?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(H.x,H.y,H.width,H.height)):(this._renderType&=-129,this.conchModel&&(C.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),R(0,H,"skewY",function(){return this._style._tf.skewY},function(H){var n=this.getStyle();if(n._tf.skewY!==H){n.setSkewY(H),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(n._tf.skewX,H),this._renderType|=4;var C=this._parent;C&&0===C._repaint&&(C._repaint=1,C.parentRepaint())}}),R(0,H,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(H){this._tfChanged=!1,(this._transform=H)&&(this._x=H.tx,this._y=H.ty,H.tx=H.ty=0,this.conchModel&&this.conchModel.transform(H.a,H.b,H.c,H.d,this._x,this._y)),H?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),R(0,H,"pivotX",function(){return this._style._tf.translateX},function(H){this.getStyle().setTranslateX(H),this.conchModel&&this.conchModel.pivot(H,this._style._tf.translateY),this.repaint()}),R(0,H,"pivotY",function(){return this._style._tf.translateY},function(H){this.getStyle().setTranslateY(H),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,H),this.repaint()}),R(0,H,"alpha",function(){return this._style.alpha},function(H){this._style&&this._style.alpha!==H&&(H=H<0?0:1<H?1:H,this.getStyle().alpha=H,this.conchModel&&this.conchModel.alpha(H),1!==H?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),R(0,H,"visible",function(){return this._style.visible},function(H){this._style&&this._style.visible!==H&&(this.getStyle().visible=H,this.conchModel&&this.conchModel.visible(H),this.parentRepaint())}),R(0,H,"graphics",function(){return this._graphics||(this.graphics=b.createGraphics())},function(H){this._graphics&&(this._graphics._sp=null),(this._graphics=H)?(this._renderType&=-2,this._renderType|=512,(H._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(C.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),R(0,H,"filters",function(){return this._$P.filters},function(H){H&&0===H.length&&(H=null),this._$P.filters!=H&&(this._set$P("filters",H?H.slice():null),Z.isConchApp&&(this.conchModel&&(C.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),Z.isWebGL&&(H&&H.length?this._renderType|=32:this._renderType&=-33),H&&0<H.length?(this._getBit(1)||this._setUpNoticeType(1),Z.isWebGL&&1==H.length&&H[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(Z.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),R(0,H,"parent",N.prototype._$get_parent,function(H){F.superSet(HH,this,"parent",H),H&&this._getBit(2)&&this._$2__onDisplay()}),R(0,H,"mask",function(){return this._$P._mask},function(H){H&&this.mask&&this.mask._$P.maskParent||(H?(this.cacheAs="bitmap",this._set$P("_mask",H),H._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",H),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(H?H.conchModel:null),this._renderType|=64,this.parentRepaint())}),R(0,H,"mouseEnabled",function(){return 1<this._mouseEnableState},function(H){this._mouseEnableState=H?2:1}),R(0,H,"globalScaleX",function(){for(var H=1,n=this;n&&n!==F.stage;)H*=n.scaleX,n=n.parent;return H}),R(0,H,"mouseX",function(){return this.getMousePoint().x}),R(0,H,"mouseY",function(){return this.getMousePoint().y}),C.fromImage=function(H){return(new C).loadImage(H)},C._cachePool=[],C.CustomList=[],P(C,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=g.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),C}(HH),oH=function(H){function n(H){this._audio=null,this._onEnd=null,this._resumePlay=null,n.__super.call(this),this._onEnd=u.bind(this.__onEnd,this),this._resumePlay=u.bind(this.__resumePlay,this),H.addEventListener("ended",this._onEnd),this._audio=H}l(n,"laya.media.h5audio.AudioSoundChannel",rH);var C=n.prototype;return C.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(F.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},C.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,_.container.appendChild(this._audio),this._audio.play()}catch(H){this.event("error")}},C.play=function(H){this.isStopped=!1;try{this._audio.playbackRate=L.playbackRate,this._audio.currentTime=this.startTime}catch(H){return void this._audio.addEventListener("canplay",this._resumePlay)}L.addChannel(this),_.container.appendChild(this._audio),!H&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},C.stop=function(){this.isStopped=!0,L.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&Z.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),_.onIE||this._audio!=CH._musicAudio&&E.recover("audio:"+this.url,this._audio),_.removeElement(this._audio),this._audio=null)},C.pause=function(){this.isStopped=!0,L.removeChannel(this),"pause"in this._audio&&this._audio.pause()},C.resume=function(){this._audio&&(this.isStopped=!1,L.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},R(0,C,"position",function(){return this._audio?this._audio.currentTime:0}),R(0,C,"duration",function(){return this._audio?this._audio.duration:0}),R(0,C,"volume",function(){return this._audio?this._audio.volume:1},function(H){this._audio&&(this._audio.volume=H)}),n}(),gH=function(H){function n(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=QH.ctx,n.__super.call(this),this._onPlayEnd=u.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}l(n,"laya.media.webaudio.WebAudioSoundChannel",rH);var C=n.prototype;return C.play=function(H){if(L.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var n=this.context,C=this.gain,r=n.createBufferSource();(this.bufferSource=r).buffer=this.audioBuffer,r.connect(C),C&&C.disconnect(),C.connect(n.destination),r.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=_.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(r.loop=!0),r.playbackRate.setTargetAtTime?r.playbackRate.setTargetAtTime(L.playbackRate,this.context.currentTime,.1):r.playbackRate.value=L.playbackRate,r.start(0,this.startTime),!H&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},C.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(F.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},C._clearBufferSource=function(){if(this.bufferSource){var H=this.bufferSource;H.stop?H.stop(0):H.noteOff(0),H.disconnect(0),H.onended=null,n._tryCleanFailed||this._tryClearBuffer(H),this.bufferSource=null}},C._tryClearBuffer=function(H){try{H.buffer=null}catch(H){n._tryCleanFailed=!0}},C.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,L.removeChannel(this),this.startHandler=null,this.completeHandler=null},C.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,L.removeChannel(this)},C.resume=function(){this.startTime=this._pauseTime,this.play(!1)},R(0,C,"position",function(){return this.bufferSource?(_.now()-this._startTime)/1e3+this.startTime:0}),R(0,C,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),R(0,C,"volume",function(){return this._volume},function(H){this.isStopped||(this._volume=H,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(H,this.context.currentTime,.1):this.gain.gain.value=H)}),n._tryCleanFailed=!1,n}(),MH=function(H){function n(){n.__super.call(this),this._w=0,this._h=0}l(n,"laya.resource.Bitmap",tH);var C=n.prototype;return R(0,C,"width",function(){return this._w}),R(0,C,"height",function(){return this._h}),R(0,C,"source",function(){return this._source}),n}(),jH=function(n){function H(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,H.__super.call(this),this._interval=r.animationInterval,this._setUpNoticeType(1)}l(H,"laya.display.AnimationPlayerBase",n);var C=H.prototype;return C.play=function(H,n,C,r){void 0===H&&(H=0),void 0===n&&(n=!0),void 0===C&&(C=""),void 0===r&&(r=!0),this._isPlaying=!0,this.index="string"==typeof H?this._getFrameByLabel(H):H,this.loop=n,this._actionName=C,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},C._getFrameByLabel=function(H){var n=0;for(n=0;n<this._count;n++)if(this._labels[n]&&0<=this._labels[n].indexOf(H))return n;return 0},C._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},C._setControlNode=function(H){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=H)&&H!=this&&(H.on("display",this,this._checkResumePlaying),H.on("undisplay",this,this._checkResumePlaying))},C._setDisplay=function(H){n.prototype._setDisplay.call(this,H),this._checkResumePlaying()},C._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},C.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},C.addLabel=function(H,n){this._labels||(this._labels={}),this._labels[n]||(this._labels[n]=[]),this._labels[n].push(H)},C.removeLabel=function(H){if(H){if(this._labels)for(var n in this._labels)this._removeLabelFromLabelList(this._labels[n],H)}else this._labels=null},C._removeLabelFromLabelList=function(H,n){if(H)for(var C=H.length-1;0<=C;C--)H[C]==n&&H.splice(C,1)},C.gotoAndStop=function(H){this.index="string"==typeof H?this._getFrameByLabel(H):H,this.stop()},C._displayToIndex=function(H){},C.clear=function(){this.stop(),this._labels=null},R(0,C,"interval",function(){return this._interval},function(H){this._interval!=H&&(this._frameRateChanged=!0,this._interval=H,this._isPlaying&&0<H&&this.timerLoop(H,this,this._frameLoop,null,!0,!0))}),R(0,C,"isPlaying",function(){return this._isPlaying}),R(0,C,"index",function(){return this._index},function(H){if(this._index=H,this._displayToIndex(H),this._labels&&this._labels[H])for(var n=this._labels[H],C=0,r=n.length;C<r;C++)this.event("label",n[C])}),R(0,C,"count",function(){return this._count}),H.WRAP_POSITIVE=0,H.WRAP_REVERSE=1,H.WRAP_PINGPONG=2,H}(yH),lH=function(n){function j(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,j.__super.call(this),this.overflow=j.VISIBLE,this._style=new nH(this),this._style.wordWrap=!1}l(j,"laya.display.Text",n);var H=j.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._lines=null,this._words&&(this._words.length=0,this._words=null)},H._getBoundPointsM=function(H){void 0===H&&(H=!1);var n=i.TEMP;return n.setTo(0,0,this.width,this.height),n._getBoundPoints()},H.getGraphicBounds=function(H){void 0===H&&(H=!1);var n=i.TEMP;return n.setTo(0,0,this.width,this.height),n},H._getCSSStyle=function(){return this._style},H.lang=function(H,n,C,r,N,Q,I,A,P,t,R){if(H=j.langPacks&&j.langPacks[H]?j.langPacks[H]:H,arguments.length<2)this._text=H;else{for(var y=0,o=arguments.length;y<o;y++)H=H.replace("{"+y+"}",arguments[y+1]);this._text=H}},H._isPassWordMode=function(){var H=this._style.password;return"prompt"in this&&this.prompt==this._text&&(H=!1),H},H._getPassWordTxt=function(H){var n;n="";for(var C=H.length;0<C;C--)n+="●";return n},H.renderText=function(H,n){var C=this.graphics;C.clear(!0);var r=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(_.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);_.context.font=r;var N=this.padding,Q=N[3],I="left",A=this._lines,P=this.leading+this._charSize.height,t=this._currBitmapFont;t&&(P=this.leading+t.getMaxHeight());var R=N[0];if(!t&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(I="right",Q=this._width-N[1]):"center"==this.align&&(I="center",Q=.5*this._width+N[3]-N[1])),0<this._height){var y=this._textHeight>this._height?"top":this.valign;"middle"===y?R=.5*(this._height-n*P)+N[0]-N[2]:"bottom"===y&&(R=this._height-n*P-N[2])}var o=this._style;if(t&&t.autoScaleSize)var g=t.fontSize/this.fontSize;if(this._clipPoint)if(C.save(),t&&t.autoScaleSize){var M=0,j=0;M=this._width?this._width-N[3]-N[1]:this._textWidth,j=this._height?this._height-N[0]-N[2]:this._textHeight,M*=g,j*=g,C.clipRect(N[3],N[0],M,j)}else C.clipRect(N[3],N[0],this._width?this._width-N[3]-N[1]:this._textWidth,this._height?this._height-N[0]-N[2]:this._textHeight);var l=o.password;"prompt"in this&&this.prompt==this._text&&(l=!1);for(var f=0,c=0,K=Math.min(this._lines.length,n+H)||1,W=H;W<K;W++){var z,w=A[W];if(l){var F=w.length;w="";for(var k=F;0<k;k--)w+="●"}if(f=Q-(this._clipPoint?this._clipPoint.x:0),c=R+P*W-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(I,f,c,W),t){var i=this.width;t.autoScaleSize&&(i=this.width*g),t.drawText(w,this,f,c,this.align,i)}else Z.isWebGL?(this._words||(this._words=[]),(z=this._words.length>W-H?this._words[W-H]:new B).setText(w)):z=w,o.stroke?C.fillBorderText(z,f,c,r,this.color,o.strokeColor,o.stroke,I):C.fillText(z,f,c,r,this.color,I)}if(t&&t.autoScaleSize){var a=1/g;this.scale(a,a)}this._clipPoint&&C.restore(),this._startX=Q,this._startY=R},H.drawUnderline=function(H,n,C,r){var N=this._lineWidths[r];switch(H){case"center":n-=N/2;break;case"right":n-=N}C+=this._charSize.height,this._graphics.drawLine(n,C,n+N,C,this.underlineColor||this.color,1)},H.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);_.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new k(0,0)):this._clipPoint=null;var H=this._lines.length;if(this.overflow!=j.VISIBLE){var n=this.overflow==j.HIDDEN?Math.floor:Math.ceil;H=Math.min(H,n((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var C=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(C,H),this.repaint()},H.evalTextSize=function(){var H,n=NaN;H=Math.max.apply(this,this._lineWidths),n=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],H==this._textWidth&&n==this._textHeight||(this._textWidth=H,this._textHeight=n,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},H.checkEnabledViewportOrNot=function(){return this.overflow==j.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},H.changeText=function(H){this._text!==H&&(this.lang(H+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},H.parseLines=function(H){var n=this.wordWrap||this.overflow==j.HIDDEN;if(n)var C=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var r=u.contextMeasureText(j._testWord);Z.isConchApp&&0===r.width&&0===r.height&&(r=u.contextMeasureText("W")),this._charSize.width=r.width,this._charSize.height=r.height||this.fontSize}for(var N=H.replace(/\r\n/g,"\n").split("\n"),Q=0,I=N.length;Q<I;Q++){var A=N[Q];n?this.parseLine(A,C):(this._lineWidths.push(this.getTextWidth(A)),this._lines.push(A))}},H.parseLine=function(H,n){_.context;var C,r=this._lines,N=0,Q=NaN,I=NaN,A=0;if((Q=this.getTextWidth(H))<=n)return r.push(H),void this._lineWidths.push(Q);if(j.WordSplitStr&&0==new RegExp(j.WordSplitStr,"g").test(H))return r.push(H),void this._lineWidths.push(Q);Q=this._charSize.width,0==(N=Math.floor(n/Q))&&(N=1),I=Q=this.getTextWidth(H.substring(0,N));for(var P=N,t=H.length;P<t;P++)if(n<(I+=Q=this.getTextWidth(H.charAt(P))))if(this.wordWrap){var R=H.substring(A,P);if(j.WordSplitArr){var y=-1,o=0;for(o=0;o<j.WordSplitArr.length;o++)y=Math.max(y,R.lastIndexOf(j.WordSplitArr[o]));if(-1==y){var g=H.substring(A,H.length);for(o=0;o<j.WordSplitArr.length;o++){var M=g.indexOf(j.WordSplitArr[o]);y=0<=y?0<=M?Math.min(y,M):y:M}R=-1==y?(P=H.length,g):(P=y+1+A,H.substring(A,P))}else P=y+1+A,R=H.substring(A,P);r.push(R),this._lineWidths.push(this.getTextWidth(r[r.length-1])),I=0,A=P}else{if(R.charCodeAt(R.length-1)<255?(C=/(?:\w|-)+$/.exec(R))&&(P=C.index+A,0==C.index?P+=R.length:R=H.substring(A,P)):j.RightToLeft&&(C=/([\u0600-\u06FF])+$/.exec(R))&&(P=C.index+A,0==C.index?P+=R.length:R=H.substring(A,P)),r.push(R),this._lineWidths.push(I-Q),!((A=P)+N<t)){r.push(H.substring(A,t)),this._lineWidths.push(this.getTextWidth(r[r.length-1])),A=-1;break}P+=N,I=Q=this.getTextWidth(H.substring(A,P)),P--}}else if(this.overflow==j.HIDDEN)return r.push(H.substring(0,P)),void this._lineWidths.push(this.getTextWidth(r[r.length-1]));this.wordWrap&&-1!=A&&A<t&&(r.push(H.substring(A,t)),this._lineWidths.push(this.getTextWidth(r[r.length-1])))},H.getTextWidth=function(H){return this._currBitmapFont?this._currBitmapFont.getTextWidth(H):u.contextMeasureText(H).width},H.getWordWrapWidth=function(){var H=this.padding,n=NaN;return(n=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(n=this.wordWrap?100:_.width),n<=0&&(n=100),n-H[3]-H[1]},H.getCharPoint=function(H,n){this._isChanged&&F.timer.runCallLater(this,this.typeset);for(var C=0,r=this._lines,N=0,Q=0,I=r.length;Q<I;Q++){if(H<(C+=r[Q].length)){var A=Q;break}N=C}var P=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;_.context.font=P;var t=this.getTextWidth(this._text.substring(N,H));return(n||new k).setTo(this._startX+t-(this._clipPoint?this._clipPoint.x:0),this._startY+A*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},R(0,H,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(H){H!=this._width&&(F.superSet(yH,this,"width",H),this.isChanged=!0)}),R(0,H,"textWidth",function(){return this._isChanged&&F.timer.runCallLater(this,this.typeset),this._textWidth}),R(0,H,"height",function(){return this._height?this._height:this.textHeight},function(H){H!=this._height&&(F.superSet(yH,this,"height",H),this.isChanged=!0)}),R(0,H,"textHeight",function(){return this._isChanged&&F.timer.runCallLater(this,this.typeset),this._textHeight}),R(0,H,"padding",function(){return this._getCSSStyle().padding},function(H){this._getCSSStyle().padding=H,this.isChanged=!0}),R(0,H,"bold",function(){return this._getCSSStyle().bold},function(H){this._getCSSStyle().bold=H,this.isChanged=!0}),R(0,H,"text",function(){return this._text||""},function(H){this._text!==H&&(this.lang(H+""),this.isChanged=!0,this.event("change"))}),R(0,H,"color",function(){return this._getCSSStyle().color},function(H){this._getCSSStyle().color!=H&&(this._getCSSStyle().color=H,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),R(0,H,"font",function(){return this._getCSSStyle().fontFamily},function(H){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),j._bitmapFonts&&j._bitmapFonts[H]&&(this._currBitmapFont=j._bitmapFonts[H]),this._getCSSStyle().fontFamily=H,this.isChanged=!0}),R(0,H,"fontSize",function(){return this._getCSSStyle().fontSize},function(H){this._getCSSStyle().fontSize=H,this.isChanged=!0}),R(0,H,"italic",function(){return this._getCSSStyle().italic},function(H){this._getCSSStyle().italic=H,this.isChanged=!0}),R(0,H,"align",function(){return this._getCSSStyle().align},function(H){this._getCSSStyle().align=H,this.isChanged=!0}),R(0,H,"valign",function(){return this._getCSSStyle().valign},function(H){this._getCSSStyle().valign=H,this.isChanged=!0}),R(0,H,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(H){this._getCSSStyle().wordWrap=H,this.isChanged=!0}),R(0,H,"leading",function(){return this._getCSSStyle().leading},function(H){this._getCSSStyle().leading=H,this.isChanged=!0}),R(0,H,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(H){this._getCSSStyle().backgroundColor=H,this.isChanged=!0}),R(0,H,"borderColor",function(){return this._getCSSStyle().borderColor},function(H){this._getCSSStyle().borderColor=H,this.isChanged=!0}),R(0,H,"stroke",function(){return this._getCSSStyle().stroke},function(H){this._getCSSStyle().stroke=H,this.isChanged=!0}),R(0,H,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(H){this._getCSSStyle().strokeColor=H,this.isChanged=!0}),R(0,H,"isChanged",null,function(H){this._isChanged!==H&&(this._isChanged=H)&&F.timer.callLater(this,this.typeset)}),R(0,H,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(H){if(!(this.overflow!=j.SCROLL||this.textWidth<this._width)&&this._clipPoint){H=H<this.padding[3]?this.padding[3]:H;var n=this._textWidth-this._width;H=n<H?n:H;var C=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=H,this.renderText(this._lastVisibleLineIndex,C)}}),R(0,H,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(H){if(!(this.overflow!=j.SCROLL||this.textHeight<this._height)&&this._clipPoint){H=H<this.padding[0]?this.padding[0]:H;var n=this._textHeight-this._height,C=(H=n<H?n:H)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=C;var r=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=H,this.renderText(C,r)}}),R(0,H,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),R(0,H,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),R(0,H,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),R(0,H,"underlineColor",function(){return this._underlineColor},function(H){this._underlineColor=H,this._isChanged=!0,this.typeset()}),j.registerBitmapFont=function(H,n){j._bitmapFonts||(j._bitmapFonts={}),j._bitmapFonts[H]=n},j.unregisterBitmapFont=function(H,n){if(void 0===n&&(n=!0),j._bitmapFonts&&j._bitmapFonts[H]){var C=j._bitmapFonts[H];n&&C.destroy(),delete j._bitmapFonts[H]}},j.setTextRightToLeft=function(){var H;(H=_.canvas.source.style).display="none",H.position="absolute",H.direction="rtl",Z._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,_.document.body.appendChild(_.canvas.source)},j.supportFont=function(H){_.context.font="10px sans-serif";var n=u.contextMeasureText("abcji").width;_.context.font="10px "+H;var C=u.contextMeasureText("abcji").width;return console.log(n,C),n!==C},j._testWord="游",j.langPacks=null,j.VISIBLE="visible",j.SCROLL="scroll",j.HIDDEN="hidden",j.CharacterCache=!0,j.RightToLeft=!1,j.WordSplitArr=null,j.WordSplitStr=null,j._bitmapFonts=null,P(j,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),j}(yH),fH=function(o){function I(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",I.__super.call(this),this.offset=new k,this._canvasTransform=new h,this._previousOrientation=_.window.orientation;var n=this;this.transform=h.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0,this._lastStamp=0;var H=_.window,C=this;H.addEventListener("focus",function(){n._isFocused=!0,C.event("focus"),C.event("focuschange")}),H.addEventListener("blur",function(){n._isFocused=!1,C.event("blur"),C.event("focuschange"),C._isInputting()&&(zH.inputElement.target.focus=!1)});var r="visibilityState",N="visibilitychange",Q=H.document;void 0!==Q.hidden?(N="visibilitychange",r="visibilityState"):void 0!==Q.mozHidden?(N="mozvisibilitychange",r="mozVisibilityState"):void 0!==Q.msHidden?(N="msvisibilitychange",r="msVisibilityState"):void 0!==Q.webkitHidden&&(N="webkitvisibilitychange",r="webkitVisibilityState"),H.document.addEventListener(N,function(){"hidden"==_.document[r]?C._setStageVisible(!1):C._setStageVisible(!0)}),H.document.addEventListener("qbrowserVisibilityChange",function(H){C._setStageVisible(!H.hidden)}),H.addEventListener("resize",function(){var H=_.window.orientation;null!=H&&H!=n._previousOrientation&&C._isInputting()&&(zH.inputElement.target.focus=!1),n._previousOrientation=H,C._isInputting()||C._resetCanvas()}),H.addEventListener("orientationchange",function(H){C._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),_.onMobile&&this.on("mousedown",this,this._onmouseMove)}l(I,"laya.display.Stage",o);var H=I.prototype;return H._setStageVisible=function(H){this._isVisibility!=H&&(this._isVisibility=H,this._isVisibility||this._isInputting()&&(zH.inputElement.target.focus=!1),this.event("visibilitychange"))},H._isInputting=function(){return _.onMobile&&zH.isInputting},H._changeCanvasSize=function(){this.setScreenSize(_.clientWidth*_.pixelRatio,_.clientHeight*_.pixelRatio)},H._resetCanvas=function(){if(this.screenAdaptationEnabled){var H=Z._mainCanvas;H.source.style;H.size(1,1),F.timer.once(100,this,this._changeCanvasSize)}},H.setScreenSize=function(H,n){var C=!1;if("none"!==this._screenMode&&(C=(H/n<1?"vertical":"horizontal")!==this._screenMode)){var r=n;n=H,H=r}this.canvasRotation=C;var N=Z._mainCanvas,Q=N.source.style,I=this._canvasTransform.identity(),A=this._scaleMode,P=H/this.designWidth,t=n/this.designHeight,R=this.designWidth,y=this.designHeight,o=H,g=n,M=_.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,A){case"noscale":P=t=1,o=this.designWidth,g=this.designHeight;break;case"showall":P=t=Math.min(P,t),R=o=Math.round(this.designWidth*P),y=g=Math.round(this.designHeight*t);break;case"noborder":P=t=Math.max(P,t),o=Math.round(this.designWidth*P),g=Math.round(this.designHeight*t);break;case"full":P=t=1,this._width=R=H,this._height=y=n;break;case"fixedwidth":t=P,this._height=y=Math.round(n/P);break;case"fixedheight":P=t,this._width=R=Math.round(H/t);break;case"fixedauto":H/n<this.designWidth/this.designHeight?(t=P,this._height=y=Math.round(n/P)):(P=t,this._width=R=Math.round(H/t))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,R=R+1&2147483646,y=y+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),P*=this.scaleX,t*=this.scaleY,1===P&&1===t?this.transform.identity():(this.transform.a=this._formatData(P/(o/R)),this.transform.d=this._formatData(t/(g/y)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),N.size(R,y),b.changeWebGLSize(R,y),I.scale(o/R/M,g/y/M),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(H-o)/M:this.offset.x=.5*(H-o)/M,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(n-g)/M:this.offset.y=.5*(n-g)/M,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),I.translate(this.offset.x,this.offset.y),this.canvasDegree=0,C&&("horizontal"===this._screenMode?(I.rotate(Math.PI/2),I.translate(n/M,0),this.canvasDegree=90):(I.rotate(-Math.PI/2),I.translate(0,H/M),this.canvasDegree=-90)),I.a=this._formatData(I.a),I.d=this._formatData(I.d),I.tx=this._formatData(I.tx),I.ty=this._formatData(I.ty),Q.transformOrigin=Q.webkitTransformOrigin=Q.msTransformOrigin=Q.mozTransformOrigin=Q.oTransformOrigin="0px 0px 0px",Q.transform=Q.webkitTransform=Q.msTransform=Q.mozTransform=Q.oTransform="matrix("+I.toString()+")",I.translate(parseInt(Q.left)||0,parseInt(Q.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},H._formatData=function(H){return Math.abs(H)<1e-6?0:Math.abs(1-H)<.001?0<H?1:-1:H},H.getMousePoint=function(){return k.TEMP.setTo(this.mouseX,this.mouseY)},H.repaint=function(){this._repaint=1},H.parentRepaint=function(){},H._loop=function(H){return this.render(Z.context,0,0,H),!0},H._onmouseMove=function(H){this._mouseMoveTime=_.now()},H.getTimeFromFrameStart=function(){return _.now()-this._frameStartTime},H.render=function(H,n,C,r){if(!(3!=g.ENV&&6!=g.ENV&&0<r&&r-this._lastStamp<16)){if(this._lastStamp=r,"sleep"===this._frameRate&&!Z.isConchApp){var N=_.now();if(!(200<=N-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(G.loopCount++,j.instance.runEvent(),F.timer._update()));this._frameStartTime=N}if(this._renderCount++,Z.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=_.now();var Q="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),I=this._renderCount%2==0;if(G.renderSlow=!Q,Q||I||Z.isConchApp){var A;G.loopCount++,j.instance.runEvent(),F.timer._update(),b.update3DLoop();var P=0,t=0;if(Z.isConchNode)for(P=0,t=this._scenes.length;P<t;P++)(A=this._scenes[P])&&A._updateSceneConch();else for(P=0,t=this._scenes.length;P<t;P++)(A=this._scenes[P])&&A._updateScene();if(Z.isConchNode){var R=yH.CustomList;for(P=0,t=R.length;P<t;P++){var y=R[P];y.customRender(y.customContext,0,0)}return}}Z.isConchNode||this.renderingEnabled&&(Q||!I||Z.isConchWebGL)&&(Z.isWebGL?Z.WebGL.mainContext&&!Z.WebGL.mainContext.isContextLost()&&(H.clear(),o.prototype.render.call(this,H,n,C),G._show&&G._sp&&G._sp.render(H,n,C),b.clear(this._bgColor),b.beginFlush(),H.flush(),b.endFinish(),X.instance&&X.getInstance().endDispose()):(b.clear(this._bgColor),o.prototype.render.call(this,H,n,C),G._show&&G._sp&&G._sp.render(H,n,C)))}else this._renderCount%5==0&&(G.loopCount++,j.instance.runEvent(),F.timer._update())}},H._requestFullscreen=function(){var H=_.document.documentElement;H.requestFullscreen?H.requestFullscreen():H.mozRequestFullScreen?H.mozRequestFullScreen():H.webkitRequestFullscreen?H.webkitRequestFullscreen():H.msRequestFullscreen&&H.msRequestFullscreen()},H._fullScreenChanged=function(){F.stage.event("fullscreenchange")},H.exitFullscreen=function(){var H=_.document;H.exitFullscreen?H.exitFullscreen():H.mozCancelFullScreen?H.mozCancelFullScreen():H.webkitExitFullscreen&&H.webkitExitFullscreen()},R(0,H,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),R(0,H,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),R(0,H,"frameRate",function(){return this._frameRate},function(H){if(this._frameRate=H,Z.isConchApp)switch(this._frameRate){case"slow":_.window.conch&&_.window.conchConfig.setSlowFrame&&_.window.conchConfig.setSlowFrame(!0);break;case"fast":_.window.conch&&_.window.conchConfig.setSlowFrame&&_.window.conchConfig.setSlowFrame(!1);break;case"mouse":_.window.conch&&_.window.conchConfig.setMouseFrame&&_.window.conchConfig.setMouseFrame(2e3);break;case"sleep":_.window.conch&&_.window.conchConfig.setLimitFPS&&_.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),R(0,H,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),R(0,H,"width",o.prototype._$get_width,function(H){this.designWidth=H,F.superSet(yH,this,"width",H),F.timer.callLater(this,this._changeCanvasSize)}),R(0,H,"alignH",function(){return this._alignH},function(H){this._alignH=H,F.timer.callLater(this,this._changeCanvasSize)}),R(0,H,"isFocused",function(){return this._isFocused}),R(0,H,"height",o.prototype._$get_height,function(H){this.designHeight=H,F.superSet(yH,this,"height",H),F.timer.callLater(this,this._changeCanvasSize)}),R(0,H,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||h.create()},o.prototype._$set_transform),R(0,H,"isVisibility",function(){return this._isVisibility}),R(0,H,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),R(0,H,"scaleMode",function(){return this._scaleMode},function(H){this._scaleMode=H,F.timer.callLater(this,this._changeCanvasSize)}),R(0,H,"alignV",function(){return this._alignV},function(H){this._alignV=H,F.timer.callLater(this,this._changeCanvasSize)}),R(0,H,"bgColor",function(){return this._bgColor},function(H){this._bgColor=H,this.conchModel&&this.conchModel.bgColor(H),Z.isWebGL&&(H?I._wgColor=x.create(H)._color:_.onMiniGame||(I._wgColor=null)),_.onLimixiu?I._wgColor=x.create(H)._color:Z.canvas.style.background=H||"none"}),R(0,H,"mouseX",function(){return Math.round(j.instance.mouseX/this.clientScaleX)}),R(0,H,"mouseY",function(){return Math.round(j.instance.mouseY/this.clientScaleY)}),R(0,H,"screenMode",function(){return this._screenMode},function(H){this._screenMode=H}),R(0,H,"visible",o.prototype._$get_visible,function(H){this.visible!==H&&(F.superSet(yH,this,"visible",H),Z._mainCanvas.source.style.visibility=H?"visible":"hidden")}),R(0,H,"fullScreenEnabled",null,function(H){var n=_.document,C=Z.canvas;H?(C.addEventListener("mousedown",this._requestFullscreen),C.addEventListener("touchstart",this._requestFullscreen),n.addEventListener("fullscreenchange",this._fullScreenChanged),n.addEventListener("mozfullscreenchange",this._fullScreenChanged),n.addEventListener("webkitfullscreenchange",this._fullScreenChanged),n.addEventListener("msfullscreenchange",this._fullScreenChanged)):(C.removeEventListener("mousedown",this._requestFullscreen),C.removeEventListener("touchstart",this._requestFullscreen),n.removeEventListener("fullscreenchange",this._fullScreenChanged),n.removeEventListener("mozfullscreenchange",this._fullScreenChanged),n.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),n.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),I.SCALE_NOSCALE="noscale",I.SCALE_EXACTFIT="exactfit",I.SCALE_SHOWALL="showall",I.SCALE_NOBORDER="noborder",I.SCALE_FULL="full",I.SCALE_FIXED_WIDTH="fixedwidth",I.SCALE_FIXED_HEIGHT="fixedheight",I.SCALE_FIXED_AUTO="fixedauto",I.ALIGN_LEFT="left",I.ALIGN_RIGHT="right",I.ALIGN_CENTER="center",I.ALIGN_TOP="top",I.ALIGN_MIDDLE="middle",I.ALIGN_BOTTOM="bottom",I.SCREEN_NONE="none",I.SCREEN_HORIZONTAL="horizontal",I.SCREEN_VERTICAL="vertical",I.FRAME_FAST="fast",I.FRAME_SLOW="slow",I.FRAME_MOUSE="mouse",I.FRAME_SLEEP="sleep",I.FRAME_MOUSE_THREDHOLD=2e3,P(I,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),I}(yH),cH=(function(H){function n(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,n.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}l(n,"laya.media.SoundNode",yH);var C=n.prototype;C._onParentChange=function(){this.target=this.parent},C.play=function(H,n){void 0===H&&(H=1),isNaN(H)&&(H=1),this.url&&(this.stop(),this._channel=L.playSound(this.url,H,null,n))},C.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},C._setPlayAction=function(H,n,C,r){void 0===r&&(r=!0),this[C]&&H&&(r?H.on(n,this,this[C]):H.off(n,this,this[C]))},C._setPlayActions=function(H,n,C,r){if(void 0===r&&(r=!0),H&&n){var N,Q=n.split(","),I=0;for(N=Q.length,I=0;I<N;I++)this._setPlayAction(H,Q[I],C,r)}},R(0,C,"playEvent",null,function(H){(this._playEvents=H)&&this._tar&&this._setPlayActions(this._tar,H,"play")}),R(0,C,"target",null,function(H){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=H,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),R(0,C,"stopEvent",null,function(H){(this._stopEvents=H)&&this._tar&&this._setPlayActions(this._tar,H,"stop")})}(),function(H){function n(){this._src=null,this._onload=null,this._onerror=null,n.__super.call(this)}l(n,"laya.resource.FileBitmap",MH);var C=n.prototype;return R(0,C,"src",function(){return this._src},function(H){this._src=H}),R(0,C,"onload",null,function(H){}),R(0,C,"onerror",null,function(H){}),n}()),KH=function(H){function C(H,n){this._is2D=!1,C.__super.call(this);var r=this;if(this._source=this,"2D"===H||"AUTO"===H&&!Z.isWebGL){this._is2D=!0,this._source=n||_.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var N=this;N.getContext=function(H,n){if(r._ctx)return r._ctx;var C=r._ctx=r._source.getContext(H,n);return C&&(C._canvas=N,Z.isFlash||_.onLimixiu||(C.size=function(H,n){})),C}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}l(C,"laya.resource.HTMLCanvas",MH);var n=C.prototype;return n.clear=function(){this._ctx&&this._ctx.clear()},n.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},n.release=function(){},n._setContext=function(H){this._ctx=H},n.getContext=function(H,n){return this._ctx?this._ctx:this._ctx=C._createContext(this)},n.getMemSize=function(){return 0},n.size=function(H,n){(this._w!=H||this._h!=n||this._source&&(this._source.width!=H||this._source.height!=n))&&(this._w=H,this._h=n,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(H,n),this._source&&(this._source.height=n,this._source.width=H))},n.getCanvas=function(){return this._source},n.toBase64=function(H,n,C){if(this._source)if(Z.isConchApp&&this._source.toBase64)this._source.toBase64(H,n,C);else{var r=this._source.toDataURL(H,n);C.call(this,r)}},R(0,n,"context",function(){return this._ctx}),R(0,n,"asBitmap",null,function(H){}),C.create=function(H,n){return new C(H,n)},C.TYPE2D="2D",C.TYPE3D="3D",C.TYPEAUTO="AUTO",C._createContext=null,C}(),WH=(function(H){function P(H,n,C,r,N,Q,I,A){throw P.__super.call(this),new Error("不允许new！")}l(P,"laya.resource.HTMLSubImage",MH),P.create=function(H,n,C,r,N,Q,I,A){return void 0===A&&(A=!1),new P(H,n,C,r,N,Q,I,A)}}(),function(H){function y(){this._frames=null,this._url=null,y.__super.call(this),this._setControlNode(this)}l(y,"laya.display.Animation",H);var n=y.prototype;n.destroy=function(H){void 0===H&&(H=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,H),this._frames=null,this._labels=null},n.play=function(H,n,C,r){void 0===H&&(H=0),void 0===n&&(n=!0),void 0===C&&(C=""),void 0===r&&(r=!0),C&&this._setFramesFromCache(C,r),this._isPlaying=!0,this.index="string"==typeof H?this._getFrameByLabel(H):H,this.loop=n,this._actionName=C,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},n._setFramesFromCache=function(H,n){var C;return void 0===n&&(n=!1),this._url&&(H=this._url+"#"+H),H&&y.framesMap[H]?((C=y.framesMap[H])instanceof Array?(this._frames=y.framesMap[H],this._count=this._frames.length):(C.nodeRoot&&(y.framesMap[H]=this._parseGraphicAnimationByData(C),C=y.framesMap[H]),this._frames=C.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=C.interval),this._labels=this._copyLabels(C.labels)),!0):(n&&console.log("ani not found:",H),!1)},n._copyLabels=function(H){if(!H)return null;var n,C;for(C in n={},H)n[C]=u.copyArray([],H[C]);return n},n._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&H.prototype._frameLoop.call(this)},n._displayToIndex=function(H){this._frames&&(this.graphics=this._frames[H])},n.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},n.loadImages=function(H,n){return void 0===n&&(n=""),this._url="",this._setFramesFromCache(n)||(this.frames=y.framesMap[n]?y.framesMap[n]:y.createFrames(H,n)),this},n.loadAtlas=function(n,C,r){void 0===r&&(r=""),this._url="";var N=this;function H(H){n===H&&(N.frames=y.framesMap[r]?y.framesMap[r]:y.createFrames(n,r),C&&C.run())}return N._setFramesFromCache(r)||(AH.getAtlas(n)?H(n):F.loader.load(n,c.create(null,H,[n]),null,"atlas")),this},n.loadAnimation=function(H,n,C){this._url=H;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,n&&n.run()):!C||AH.getAtlas(C)?this._loadAnimationData(H,n,C):F.loader.load(C,c.create(this,this._loadAnimationData,[H,n,C]),null,"atlas"),this},n._loadAnimationData=function(A,P,H){var t=this;if(!H||AH.getAtlas(H)){var R=this;AH.getRes(A)?n(A):F.loader.load(A,c.create(null,n,[A]),null,"json"),AH.clearRes(A)}else console.warn("atlas load fail:"+H);function n(H){if(AH.getRes(H)&&A===H){var n;if(y.framesMap[A+"#"])R._setFramesFromCache(t._actionName,!0),t.index=0,t._checkResumePlaying();else{var C=R._parseGraphicAnimation(AH.getRes(A));if(!C)return;var r,N=C.animationList,Q=0,I=N.length;for(Q=0;Q<I;Q++)n=N[Q],y.framesMap[A+"#"+n.name]=n,r||(r=n);r&&(y.framesMap[A+"#"]=r,R._setFramesFromCache(t._actionName,!0),t.index=0),t._checkResumePlaying()}P&&P.run()}}},n._parseGraphicAnimation=function(H){return FH.parseAnimationData(H)},n._parseGraphicAnimationByData=function(H){return FH.parseAnimationByData(H)},R(0,n,"frames",function(){return this._frames},function(H){(this._frames=H)&&(this._count=H.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),R(0,n,"autoPlay",null,function(H){H?this.play():this.stop()}),R(0,n,"source",null,function(H){-1<H.indexOf(".ani")?this.loadAnimation(H):-1<H.indexOf(".json")||-1<H.indexOf("als")||-1<H.indexOf("atlas")?this.loadAtlas(H):this.loadImages(H.split(","))}),R(0,n,"autoAnimation",null,function(H){this.play(0,!0,H,!1)}),y.createFrames=function(H,n){var C,r,N=0,Q=0;if("string"==typeof H){var I=AH.getAtlas(H);if(I&&I.length)for(C=[],N=0,Q=I.length;N<Q;N++)(r=new b.createGraphics).drawTexture(AH.getRes(I[N]),0,0),C.push(r)}else if(H instanceof Array)for(C=[],N=0,Q=H.length;N<Q;N++)(r=new b.createGraphics).loadImage(H[N],0,0),C.push(r);return n&&(y.framesMap[n]=C),C},y.clearCache=function(H){var n,C=y.framesMap,r=H+"#";for(n in C)n!==H&&0!=n.indexOf(r)||delete y.framesMap[n]},y.framesMap={}}(jH),function(H){function Q(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,Q.__super.call(this),null==Q._sortIndexFun&&(Q._sortIndexFun=w.sortByKey("index",!1,!0))}l(Q,"laya.display.FrameAnimation",H);var n=Q.prototype;return n._setUp=function(H,n){this._labels=null,this._animationNewFrames=null,this._targetDic=H,this._animationData=n,this.interval=1e3/n.frameRate,n.parsed?(this._count=n.count,this._labels=n.labels,this._animationNewFrames=n.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),n.parsed=!0,n.labels=this._labels,n.count=this._count,n.animationNewFrames=this._animationNewFrames},n.clear=function(){H.prototype.clear.call(this),this._targetDic=null,this._animationData=null},n._displayToIndex=function(H){if(this._animationData){H<0&&(H=0),H>this._count&&(H=this._count);var n=this._animationData.nodes,C=0,r=n.length;for(C=0;C<r;C++)this._displayNodeToFrame(n[C],H)}},n._displayNodeToFrame=function(H,n,C){C||(C=this._targetDic);var r=C[H.target];if(r){var N,Q,I,A=H.frames,P=H.keys,t=0,R=P.length;for(t=0;t<R;t++)I=(Q=A[N=P[t]]).length>n?Q[n]:Q[Q.length-1],r[N]=I}},n._calculateDatas=function(){if(this._animationData){var H,n=this._animationData.nodes,C=0,r=n.length;for(C=this._count=0;C<r;C++)H=n[C],this._calculateNodeKeyFrames(H);this._count+=1}},n._calculateNodeKeyFrames=function(H){var n,C,r=H.keyframes,N=H.target;for(n in H.frames||(H.frames={}),H.keys?H.keys.length=0:H.keys=[],H.initValues||(H.initValues={}),r)C=r[n],H.frames[n]||(H.frames[n]=[]),this._targetDic&&this._targetDic[N]&&(H.initValues[n]=this._targetDic[N][n]),C.sort(Q._sortIndexFun),H.keys.push(n),this._calculateNodePropFrames(C,H.frames[n],n,N)},n.resetToInitState=function(){if(this._targetDic&&this._animationData){var H,n,C=this._animationData.nodes,r=0,N=C.length;for(r=0;r<N;r++)if(n=(H=C[r]).initValues){var Q,I=this._targetDic[H.target];if(I)for(Q in n)I[Q]=n[Q]}}},n._calculateNodePropFrames=function(H,n,C,r){var N=0,Q=H.length-1;if(0<Q){for(n.length=H[Q].index+1,N=0;N<Q;N++)this._dealKeyFrame(H[N]),this._calculateFrameValues(H[N],H[N+1],n);this._dealKeyFrame(H[N])}0==Q&&(n[H[0].index]=H[0].value,this._animationNewFrames&&(this._animationNewFrames[H[0].index]=!0))},n._dealKeyFrame=function(H){H.label&&""!=H.label&&this.addLabel(H.label,H.index)},n._calculateFrameValues=function(H,n,C){var r,N=0,Q=H.index,I=n.index,A=H.value,P=n.value-H.value,t=I-Q;if(I>this._count&&(this._count=I),H.tween)for(null==(r=S[H.tweenMethod])&&(r=S.linearNone),N=Q;N<I;N++)C[N]=r(N-Q,A,P,t),this._animationNewFrames&&(this._animationNewFrames[N]=!0);else for(N=Q;N<I;N++)C[N]=A;this._animationNewFrames&&(this._animationNewFrames[H.index]=!0,this._animationNewFrames[n.index]=!0),C[n.index]=n.value},Q._sortIndexFun=null,Q}(jH)),zH=function(n){function Q(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",Q.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=lH.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}l(Q,"laya.display.Input",n);var H=Q.prototype;return H.setSelection=function(H,n){this.focus=!0,laya.display.Input.inputElement.selectionStart=H,laya.display.Input.inputElement.selectionEnd=n},H._onUnDisplay=function(H){this.focus=!1},H._onMouseDown=function(H){this.focus=!0},H._syncInputTransform=function(){var H=this.nativeInput,n=u.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),C=this._width-this.padding[1]-this.padding[3],r=this._height-this.padding[0]-this.padding[2];if(Z.isConchApp)H.setScale(n.scaleX,n.scaleY),H.setSize(C,r),H.setPos(n.x,n.y);else{var N=1===_.scroll_input_top;N&&H.style.backgroundColor&&(H.style.backgroundColor=null),Q.inputContainer.style.transform=Q.inputContainer.style.webkitTransform="scale("+n.scaleX+","+n.scaleY+") rotate("+F.stage.canvasDegree+"deg)",H.style.width=N?"720px":C+"px",H.style.height=r+"px",Q.inputContainer.style.left=N?"0px":n.x+"px",Q.inputContainer.style.top=N?"0px":n.y+"px"}},H.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},H._setInputMethod=function(){Q.input.parentElement&&Q.inputContainer.removeChild(Q.input),Q.area.parentElement&&Q.inputContainer.removeChild(Q.area),Q.inputElement=this._multiline?Q.area:Q.input,Q.inputContainer.appendChild(Q.inputElement),lH.RightToLeft&&(Q.inputElement.style.direction="rtl")},H._focusIn=function(){laya.display.Input.isInputting=!0;var H=this.nativeInput;this._focus=!0;var n=H.style;n.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),H.readOnly=!this._editable,Z.isConchApp&&(H.setType(this._type),H.setForbidEdit(!this._editable)),H.maxLength=this._maxChars;this.padding;if(H.type=this._type,H.value=this._content,H.placeholder=this._prompt,F.stage.off("keydown",this,this._onKeyDown),F.stage.on("keydown",this,this._onKeyDown),(F.stage.focus=this).event("focus"),_.onPC&&H.focus(),!_.onMiniGame){this._text;this._text=null}this.typeset(),H.setColor(this._originColor),H.setFontSize(this.fontSize),H.setFontFace(_.onIPhone&&lH._fontFamilyMap[this.font]||this.font),Z.isConchApp&&H.setMultiAble&&H.setMultiAble(this._multiline),n.lineHeight=this.leading+this.fontSize+"px",n.fontStyle=this.italic?"italic":"normal",n.fontWeight=this.bold?"bold":"normal",n.textAlign=this.align,n.padding="0 0",this._syncInputTransform(),!Z.isConchApp&&_.onPC&&F.timer.frameLoop(1,this,this._syncInputTransform)},H._setPromptColor=function(){(Q.promptStyleDOM=_.getElementById("promptStyle"))||((Q.promptStyleDOM=_.createElement("style")).setAttribute("id","promptStyle"),_.document.head.appendChild(Q.promptStyleDOM)),Q.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},H._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(F.superSet(lH,this,"text",this._content),F.superSet(lH,this,"color",this._originColor)):(F.superSet(lH,this,"text",this._prompt),F.superSet(lH,this,"color",this._promptColor)),F.stage.off("keydown",this,this._onKeyDown),F.stage.focus=null,this.event("blur"),Z.isConchApp&&this.nativeInput.blur(),_.onPC&&F.timer.clear(this,this._syncInputTransform)},H._onKeyDown=function(H){13===H.keyCode&&(_.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},H.changeText=function(H){this._content=H,this._focus?(this.nativeInput.value=H||"",this.event("change")):n.prototype.changeText.call(this,H)},R(0,H,"color",n.prototype._$get_color,function(H){this._focus&&this.nativeInput.setColor(H),F.superSet(lH,this,"color",this._content?H:this._promptColor),this._originColor=H}),R(0,H,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(H){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),R(0,H,"multiline",function(){return this._multiline},function(H){this._multiline=H,this.valign=H?"top":"middle"}),R(0,H,"maxChars",function(){return this._maxChars},function(H){H<=0&&(H=1e5),this._maxChars=H}),R(0,H,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(H){F.superSet(lH,this,"color",this._originColor),H+="",this._focus?(this.nativeInput.value=H||"",this.event("change")):(this._multiline||(H=H.replace(/\r?\n/g,"")),(this._content=H)?F.superSet(lH,this,"text",H):(F.superSet(lH,this,"text",this._prompt),F.superSet(lH,this,"color",this.promptColor)))}),R(0,H,"nativeInput",function(){return this._multiline?Q.area:Q.input}),R(0,H,"prompt",function(){return this._prompt},function(H){!this._text&&H&&F.superSet(lH,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?F.superSet(lH,this,"text",this._text==this._prompt?H:this._text):F.superSet(lH,this,"text",H),this._prompt=lH.langPacks&&lH.langPacks[H]?lH.langPacks[H]:H}),R(0,H,"focus",function(){return this._focus},function(H){var n=this.nativeInput;this._focus!==H&&(H?(n.target?n.target._focusOut():this._setInputMethod(),(n.target=this)._focusIn()):(n.target=null,this._focusOut(),_.document.body.scrollTop=0,n.blur(),Z.isConchApp?n.setPos(-1e4,-1e4):Q.inputContainer.contains(n)&&Q.inputContainer.removeChild(n)))}),R(0,H,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(H){H?(-1<(H="[^"+H+"]").indexOf("^^")&&(H=H.replace("^^","")),this._restrictPattern=new RegExp(H,"g")):this._restrictPattern=null}),R(0,H,"editable",function(){return this._editable},function(H){this._editable=H,Z.isConchApp&&Q.input.setForbidEdit(!H)}),R(0,H,"promptColor",function(){return this._promptColor},function(H){this._promptColor=H,this._content||F.superSet(lH,this,"color",H)}),R(0,H,"type",function(){return this._type},function(H){this._getCSSStyle().password="password"==H,this._type=H,Z.isConchApp&&this.nativeInput.setType(H)}),R(0,H,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(H){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),R(0,H,"asPassword",function(){return this._getCSSStyle().password},function(H){this._getCSSStyle().password=H,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),Q.__init__=function(){Q._createInputElement(),_.onMobile&&Z.canvas.addEventListener(Q.IOS_IFRAME?_.onMiniGame?"touchend":"click":"touchend",Q._popupInputMethod)},Q._popupInputMethod=function(H){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},Q._createInputElement=function(){Q._initInput(Q.area=_.createElement("textarea")),Q._initInput(Q.input=_.createElement("input")),(Q.inputContainer=_.createElement("div")).style.position="absolute",Q.inputContainer.style.zIndex=1e5,_.container.appendChild(Q.inputContainer),Q.inputContainer.setPos=function(H,n){Q.inputContainer.style.left=H+"px",Q.inputContainer.style.top=n+"px"}},Q._initInput=function(n){var H=n.style;H.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",H.resize="none",H.backgroundColor="transparent",H.border="none",H.outline="none",H.zIndex=1,n.addEventListener("input",Q._processInputting),n.addEventListener("mousemove",Q._stopEvent),n.addEventListener("mousedown",Q._stopEvent),n.addEventListener("touchmove",Q._stopEvent),n.setFontFace=function(H){n.style.fontFamily=H},Z.isConchApp||(n.setColor=function(H){n.style.color=H},n.setFontSize=function(H){n.style.fontSize=H+"px"})},Q._processInputting=function(H){var n=laya.display.Input.inputElement.target;if(n){var C=laya.display.Input.inputElement.value;n._restrictPattern&&(C=C.replace(/\u2006|\x27/g,""),n._restrictPattern.test(C)&&(C=C.replace(n._restrictPattern,""),laya.display.Input.inputElement.value=C)),n._text=C,n.event("input")}},Q._stopEvent=function(H){"touchmove"==H.type&&H.preventDefault(),H.stopPropagation&&H.stopPropagation()},Q.TYPE_TEXT="text",Q.TYPE_PASSWORD="password",Q.TYPE_EMAIL="email",Q.TYPE_URL="url",Q.TYPE_NUMBER="number",Q.TYPE_RANGE="range",Q.TYPE_DATE="date",Q.TYPE_MONTH="month",Q.TYPE_WEEK="week",Q.TYPE_TIME="time",Q.TYPE_DATE_TIME="datetime",Q.TYPE_DATE_TIME_LOCAL="datetime-local",Q.TYPE_SEARCH="search",Q.input=null,Q.area=null,Q.inputElement=null,Q.inputContainer=null,Q.confirmButton=null,Q.promptStyleDOM=null,Q.inputHeight=45,Q.isInputting=!1,Q.stageMatrix=null,P(Q,["IOS_IFRAME",function(){return this.IOS_IFRAME=_.onIOS&&_.window.top!=_.window.self}]),Q}(lH),wH=function(H){function C(H,n){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,C.__super.call(this),H&&this._init_(H,n)}l(C,"laya.resource.HTMLImage",cH);var n=C.prototype;return n._init_=function(H,n){this._src=H,this._source=new _.window.Image,n&&(n.onload&&(this.onload=n.onload),n.onerror&&(this.onerror=n.onerror),n.onCreate&&n.onCreate(this)),0!=H.indexOf("data:image")&&(this._source.crossOrigin=""),H&&(this._source.src=H)},n.recreateResource=function(){var H=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var n=this;this._source=new _.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(n._needReleaseAgain)return n._needReleaseAgain=!1,n._source.onload=null,void(n._source=null);n._source.onload=null,n.memorySize=H._w*H._h*4,n._recreateLock=!1,n.completeCreate()},this._source.src=this._src}},n.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},n.onresize=function(){this._w=this._source.width,this._h=this._source.height},R(0,n,"onload",null,function(H){var n=this;this._onload=H,this._source&&(this._source.onload=null!=this._onload?function(){n.onresize(),n._onload()}:null)}),R(0,n,"onerror",null,function(H){var n=this;this._onerror=H,this._source&&(this._source.onerror=null!=this._onerror?function(){n._onerror()}:null)}),R(0,n,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(H){this._enableMerageInAtlas=H,Z.isConchApp&&this._source&&(this._source.enableMerageInAtlas=H)}),C.create=function(H,n){return new C(H,n)},C}(),FH=(function(Q){function H(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,H.__super.call(this)}l(H,"laya.display.EffectAnimation",Q);var n=H.prototype;n._onOtherBegin=function(H){H!=this&&this.stop()},n.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},n._onPlayAction=function(){this.play(0,!1)},n.play=function(H,n,C,r){void 0===H&&(H=0),void 0===n&&(n=!0),void 0===C&&(C=""),void 0===r&&(r=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,H,n,C,r))},n._recordInitData=function(){if(this._aniKeys){var H,n,C=0;for(H=this._aniKeys.length,C=0;C<H;C++)n=this._aniKeys[C],this._initData[n]=this._target[n]}},n._displayToIndex=function(H){if(this._animationData){H<0&&(H=0),H>this._count&&(H=this._count);var n=this._animationData.nodes,C=0,r=n.length;for(r=1<r?1:r,C=0;C<r;C++)this._displayNodeToFrame(n[C],H)}},n._displayNodeToFrame=function(H,n,C){if(this._target){var r;r=this._target;var N,Q,I,A,P=H.frames,t=H.keys,R=0,y=t.length;A=H.secondFrames;var o,g,M,j,l=0;for(R=0;R<y;R++)Q=P[N=t[R]],I=-1==(l=A[N])?this._initData[N]:n<l?(M=(g=H.keyframes[N])[0]).tween?(null==(o=S[M.tweenMethod])&&(o=S.linearNone),j=g[1],o(n,this._initData[N],j.value-this._initData[N],j.index)):this._initData[N]:Q.length>n?Q[n]:Q[Q.length-1],r[N]=I}},n._calculateNodeKeyFrames=function(H){Q.prototype._calculateNodeKeyFrames.call(this,H);var n,C,r,N=H.keyframes;H.target;for(n in r={},H.secondFrames=r,N)(C=N[n]).length<=1?r[n]=-1:r[n]=C[1].index},R(0,n,"target",function(){return this._target},function(H){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=H,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),R(0,n,"playEvent",null,function(H){(this._playEvents=H)&&this.addEvent()}),R(0,n,"effectData",null,function(H){var n;H&&((n=H.animations)&&n[0]&&(this._setUp({},n[0]),n[0].nodes&&n[0].nodes[0]&&(this._aniKeys=n[0].nodes[0].keys)))}),R(0,n,"effectClass",null,function(H){var n,C;(this._effectClass=$.getClass(H),this._effectClass)&&((n=this._effectClass.uiView)&&(C=n.animations)&&C[0]&&(this._setUp({},C[0]),C[0].nodes&&C[0].nodes[0]&&(this._aniKeys=C[0].nodes[0].keys)))}),H.EffectAnimationBegin="effectanimationbegin"}(WH),function(n){var D;function L(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,L.__super.call(this)}l(L,"laya.utils.GraphicAnimation",n);var H=L.prototype;return H._parseNodeList=function(H){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[H.compId]=H.props,H.compId&&this._nodeList.push(H.compId);var n=H.child;if(n){var C=0,r=n.length;for(C=0;C<r;C++)this._parseNodeList(n[C])}},H._calGraphicData=function(H){var n;if(this._setUp(null,H),this._createGraphicData(),this._nodeIDAniDic)for(n in this._nodeIDAniDic)this._nodeIDAniDic[n]=null},H._createGraphicData=function(){var H,n=[],C=0,r=this.count,N=this._animationNewFrames;for(N||(N=[]),C=0;C<r;C++)!N[C]&&H||(H=this._createFrameGraphic(C)),n.push(H);this._gList=n},H._createFrameGraphic=function(H){var n=b.createGraphics();return L._rootMatrix||(L._rootMatrix=new h),this._updateNodeGraphic(this._rootNode,H,L._rootMatrix,n),n},H._updateNodeGraphic=function(H,n,C,r,N){var Q;void 0===N&&(N=1);var I,A,P,t=(Q=this._nodeGDic[H.compId]=this._getNodeGraphicData(H.compId,n,this._nodeGDic[H.compId])).alpha*N;if(!(t<.01)&&(Q.resultTransform||(Q.resultTransform=h.create()),I=Q.resultTransform,h.mul(Q.transform,C,I),Q.skin&&(A=this._getTextureByUrl(Q.skin))&&(I._checkTransform()?(r.drawTexture(A,0,0,Q.width,Q.height,I,t),Q.resultTransform=null):r.drawTexture(A,I.tx,I.ty,Q.width,Q.height,null,t)),P=H.child)){var R,y=0;for(R=P.length,y=0;y<R;y++)this._updateNodeGraphic(P[y],n,I,r,t)}},H._updateNoChilds=function(H,n){if(H.skin){var C=this._getTextureByUrl(H.skin);if(C){var r=H.transform;r._checkTransform();!r.bTransform?n.drawTexture(C,r.tx,r.ty,H.width,H.height,null,H.alpha):n.drawTexture(C,0,0,H.width,H.height,r.clone(),H.alpha)}}},H._updateNodeGraphic2=function(H,n,C){var r;if(r=this._nodeGDic[H.compId]=this._getNodeGraphicData(H.compId,n,this._nodeGDic[H.compId]),H.child){var N=r.transform;N._checkTransform();var Q,I;I=(Q=!N.bTransform)&&(0!=N.tx||0!=N.ty);var A,P,t;if((A=N.bTransform||1!=r.alpha)&&C.save(),1!=r.alpha&&C.alpha(r.alpha),Q?I&&C.translate(N.tx,N.ty):C.transform(N.clone()),P=H.child,r.skin&&(t=this._getTextureByUrl(r.skin))&&C.drawTexture(t,0,0,r.width,r.height),P){var R,y=0;for(R=P.length,y=0;y<R;y++)this._updateNodeGraphic2(P[y],n,C)}A?C.restore():Q?I&&C.translate(-N.tx,-N.ty):C.transform(N.clone().invert())}else this._updateNoChilds(r,C)},H._calculateNodeKeyFrames=function(H){n.prototype._calculateNodeKeyFrames.call(this,H),this._nodeIDAniDic[H.target]=H},H.getNodeDataByID=function(H){return this._nodeIDAniDic[H]},H._getParams=function(H,n,C,r){var N=L._temParam;N.length=n.length;var Q=0,I=n.length;for(Q=0;Q<I;Q++)N[Q]=this._getObjVar(H,n[Q][0],C,n[Q][1],r);return N},H._getObjVar=function(H,n,C,r,N){if(H.hasOwnProperty(n)){var Q=H[n];if(C>=Q.length&&(C=Q.length-1),null!=H[n][C])return H[n][C]}return N.hasOwnProperty(n)?N[n]:r},H._getNodeGraphicData=function(H,n,C){C||(C=D.create()),C.transform?C.transform.identity():C.transform=h.create();var r=this.getNodeDataByID(H);if(!r)return C;var N,Q,I=r.frames,A=this._getParams(I,L._drawTextureCmd,n,this._nodeDefaultProps[H]),P=A[0],t=NaN,R=NaN,y=A[5],o=A[6],g=A[13],M=A[14],j=A[7],l=A[8],f=A[9],c=A[11],K=A[12];t=A[3],R=A[4],0!=t&&0!=R||(P=null),-1==t&&(t=0),-1==R&&(R=0),C.skin=P,C.width=t,C.height=R,P&&((N=this._getTextureByUrl(P))?(t||(t=N.sourceWidth),R||(R=N.sourceHeight)):console.warn("lost skin:",P,",you may load pics first")),C.alpha=A[10],Q=C.transform,0!=g&&(y=g*t),0!=M&&(o=M*R),0==y&&0==o||Q.translate(-y,-o);var W=null;if(f||1!==j||1!==l||c||K){(W=L._tempMt).identity(),W.bTransform=!0;var z=.0174532922222222*(f-c),w=.0174532922222222*(f+K),F=Math.cos(w),k=Math.sin(w),i=Math.sin(z),a=Math.cos(z);W.a=j*F,W.b=j*k,W.c=-l*i,W.d=l*a,W.tx=W.ty=0}return W&&(Q=h.mul(Q,W,Q)),Q.translate(A[1],A[2]),C},H._getTextureByUrl=function(H){return AH.getRes(H)},H.setAniData=function(H,n){if(H.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=H,this._parseNodeList(H);var C,r={},N=[],Q=H.animations,I=0,A=Q.length;for(I=0;I<A;I++)if(C=Q[I],this._labels=null,(!n||n==C.name)&&C){try{this._calGraphicData(C)}catch(H){console.warn("parse animation fail:"+C.name+",empty animation created"),this._gList=[]}var P={};P.interval=1e3/C.frameRate,P.frames=this._gList,P.labels=this._labels,P.name=C.name,N.push(P),r[C.name]=P}this.animationList=N,this.animationDic=r}L._temParam.length=0},H.parseByData=function(H){var n,C;n=H.nodeRoot,C=H.aniO,delete H.nodeRoot,delete H.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=n,this._parseNodeList(n),this._labels=null;try{this._calGraphicData(C)}catch(H){console.warn("parse animation fail:"+C.name+",empty animation created"),this._gList=[]}var r=H;return r.interval=1e3/C.frameRate,r.frames=this._gList,r.labels=this._labels,r.name=C.name,r},H.setUpAniData=function(H){if(H.animations){var n,C={},r=[],N=H.animations,Q=0,I=N.length;for(Q=0;Q<I;Q++)if(n=N[Q]){var A={};A.name=n.name,A.aniO=n,A.nodeRoot=H,r.push(A),C[n.name]=A}this.animationList=r,this.animationDic=C}},H._clear=function(){var H,n;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(H in this._nodeGDic)(n=this._nodeGDic[H])&&n.recover();this._nodeGDic=null},L.parseAnimationByData=function(H){var n;return L._I||(L._I=new L),n=L._I.parseByData(H),L._I._clear(),n},L.parseAnimationData=function(H){var n;return L._I||(L._I=new L),L._I.setUpAniData(H),(n={}).animationList=L._I.animationList,n.animationDic=L._I.animationDic,L._I._clear(),n},L._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],L._temParam=[],L._I=null,L._rootMatrix=null,P(L,["_tempMt",function(){return this._tempMt=new h}]),L.__init$=function(){D=function(){function H(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return l(H,""),H.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),E.recover("GraphicNode",this)},H.create=function(){return E.getItemByClass("GraphicNode",H)},H}()},L}(WH));F.__init([t,PH,Z,_,J,a,H,FH])}(window,document,Laya),function(H,n,C){C.un,C.uns,C.static;var r=C.class;C.getset,C.__newvec;new(function(){function H(){}return r(H,"LayaMain"),H}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(H,n){"use strict";for(var C in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var r=Laya[C];r&&r.__isclass&&(n[C]=r)}}),function(N,H,w){w.un,w.uns;var I=w.static,o=w.class,r=w.getset,Q=w.__newvec,R=laya.maths.Arith,y=laya.maths.Bezier,C=laya.resource.Bitmap,g=laya.utils.Browser,P=laya.utils.Byte,M=laya.utils.Color,F=(laya.filters.ColorFilter,w.Config),A=laya.resource.Context,k=(laya.events.Event,laya.filters.Filter),t=laya.display.Graphics,j=laya.resource.HTMLCanvas,l=(laya.utils.HTMLChar,laya.resource.HTMLImage),n=laya.resource.HTMLSubImage,i=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),a=laya.maths.Point,D=laya.maths.Rectangle,f=laya.renders.Render,c=(laya.renders.RenderContext,laya.renders.RenderSprite),K=laya.resource.Resource,W=laya.resource.ResourceManager,z=laya.utils.RunDriver,L=laya.display.Sprite,b=laya.display.Stage,h=laya.utils.Stat,v=laya.utils.StringKey,e=(laya.display.css.Style,laya.system.System),Z=laya.display.Text,q=laya.resource.Texture,p=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),m=laya.utils.VectorGraphManager;laya.utils.WordText;w.interface("laya.webgl.shapes.IShape"),w.interface("laya.webgl.submit.ISubmit"),w.interface("laya.webgl.text.ICharSegment"),w.interface("laya.webgl.canvas.save.ISaveData"),w.interface("laya.webgl.resource.IMergeAtlasBitmap"),w.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var d=function(){function H(){}o(H,"laya.filters.webgl.FilterActionGL");var n=H.prototype;return w.imps(n,{"laya.filters.IFilterActionGL":!0}),n.setValue=function(H){},n.setValueMix=function(H){},n.apply3d=function(H,n,C,r,N){return null},n.apply=function(H){return null},r(0,n,"typeMix",function(){return 0}),H}(),_=function(){function H(){}return o(H,"laya.webgl.shader.ShaderValue"),H}(),U=function(){var r,N;function H(H,n,C){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new N,void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),this._cells=null,this._rowInfo=null,this._init(H,n),this._atlasID=C}o(H,"laya.webgl.atlas.AtlasGrid");var n=H.prototype;return n.getAltasID=function(){return this._atlasID},n.setAltasID=function(H){0<=H&&(this._atlasID=H)},n.addTex=function(H,n,C){var r=this._get(n,C);return 0==r.ret||(this._fill(r.x,r.y,n,C,H),this._texCount++),r},n._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},n._init=function(H,n){if(this._width=H,this._height=n,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=Q(this._height);for(var C=0;C<this._height;C++)this._rowInfo[C]=new r;return this._clear(),!0},n._get=function(H,n){var C=new $;if(H>=this._failSize.width&&n>=this._failSize.height)return C;for(var r=-1,N=-1,Q=this._width,I=this._height,A=this._cells,P=0;P<I;P++)if(!(this._rowInfo[P].spaceCount<H))for(var t=0;t<Q;){var R=3*(P*Q+t);if(0!=A[R]||A[1+R]<H||A[2+R]<n)t+=A[1+R];else{r=t,N=P;for(var y=0;y<H;y++)if(A[3*y+R+2]<n){r=-1;break}if(!(r<0))return C.ret=!0,C.x=r,C.y=N,C;t+=A[1+R]}}return C},n._fill=function(H,n,C,r,N){var Q=this._width,I=this._height;this._check(H+C<=Q&&n+r<=I);for(var A=n;A<r+n;++A){this._check(this._rowInfo[A].spaceCount>=C),this._rowInfo[A].spaceCount-=C;for(var P=0;P<C;P++){var t=3*(H+A*Q+P);this._check(0==this._cells[t]),this._cells[t]=N,this._cells[1+t]=C,this._cells[2+t]=r}}if(0<H)for(A=0;A<r;++A){var R=0;for(P=H-1;0<=P&&0==this._cells[3*((n+A)*Q+P)];--P,++R);for(P=R;0<P;--P)this._cells[3*((n+A)*Q+H-P)+1]=P,this._check(0<P)}if(0<n)for(P=H;P<H+C;++P){for(R=0,A=n-1;0<=A&&0==this._cells[3*(P+A*Q)];--A,R++);for(A=R;0<A;--A)this._cells[3*(P+(n-A)*Q)+2]=A,this._check(0<A)}},n._check=function(H){0==H&&console.log("xtexMerger 错误啦")},n._clear=function(){for(var H=this._texCount=0;H<this._height;H++)this._rowInfo[H].spaceCount=this._width;for(var n=0;n<this._height;n++)for(var C=0;C<this._width;C++){var r=3*(n*this._width+C);this._cells[r]=0,this._cells[1+r]=this._width-C,this._cells[2+r]=this._width-n}this._failSize.width=this._width+1,this._failSize.height=this._height+1},H.__init$=function(){r=function(){function H(){this.spaceCount=0}return o(H,""),H}(),N=function(){function H(){this.width=0,this.height=0}return o(H,""),H}()},H}(),s=function(){function f(H,n,C,r){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=H,this._height=n,this._gridSize=C,this._maxAtlaserCount=r,this._gridNumX=H/C,this._gridNumY=n/C,this._curAtlasIndex=0,this._atlaserArray=[]}o(f,"laya.webgl.atlas.AtlasResourceManager");var H=f.prototype;return H.setAtlasParam=function(H,n,C,r){if(1==this._setAtlasParam)return f._sid_=0,this._width=H,this._height=n,this._gridSize=C,this._maxAtlaserCount=r,this._gridNumX=H/C,this._gridNumY=n/C,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},H.pushData=function(H){var n,C=H.bitmap,r=-1,N=null,Q=0,I=0;for(Q=0,n=this._atlaserArray.length;Q<n&&(I=(this._curAtlasIndex+Q)%n,-1==(r=(N=this._atlaserArray[I]).findBitmapIsExist(C)));Q++);if(-1!=r){var A=N.InAtlasWebGLImagesOffsetValue[r];return M=A[0],j=A[1],N.addToAtlas(H,M,j),!0}this._setAtlasParam=!1;for(var P=Math.ceil((H.bitmap.width+2)/this._gridSize),t=Math.ceil((H.bitmap.height+2)/this._gridSize),R=!1,y=0;y<2;y++){var o=this._maxAtlaserCount;for(Q=0;Q<o;Q++){I=(this._curAtlasIndex+Q)%o,this._atlaserArray.length-1>=I||this._atlaserArray.push(new DH(this._gridNumX,this._gridNumY,this._width,this._height,f._sid_++));var g=this._atlaserArray[I],M=0,j=0,l=g.addTex(1,P,t);if(l.ret){M=l.x*this._gridSize+1,j=l.y*this._gridSize+1,C.lock=!0,g.addToAtlasTexture(C,M,j),g.addToAtlas(H,M,j),R=!0,this._curAtlasIndex=I;break}}if(R)break;this._atlaserArray.push(new DH(this._gridNumX,this._gridNumY,this._width,this._height,f._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return R||console.log(">>>AtlasManager pushData error"),R},H.addToAtlas=function(H){laya.webgl.atlas.AtlasResourceManager.instance.pushData(H)},H.garbageCollection=function(){if(!0===this._needGC){for(var H=this._atlaserArray.length-this._maxAtlaserCount,n=0;n<H;n++)this._atlaserArray[n].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+H),this._atlaserArray.splice(0,H),this._needGC=!1}return!0},H.freeAll=function(){for(var H=0,n=this._atlaserArray.length;H<n;H++)this._atlaserArray[H].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},H.getAtlaserCount=function(){return this._atlaserArray.length},H.getAtlaserByIndex=function(H){return this._atlaserArray[H]},r(1,f,"instance",function(){return f._Instance||(f._Instance=new f(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),f._Instance}),r(1,f,"enabled",function(){return F.atlasEnable}),r(1,f,"atlasLimitWidth",function(){return f._atlasLimitWidth},function(H){f._atlasLimitWidth=H}),r(1,f,"atlasLimitHeight",function(){return f._atlasLimitHeight},function(H){f._atlasLimitHeight=H}),f._enable=function(){F.atlasEnable=!0},f._disable=function(){F.atlasEnable=!1},f.__init__=function(){f.atlasTextureWidth=2048,f.atlasTextureHeight=2048,f.maxTextureCount=6,f.atlasLimitWidth=512,f.atlasLimitHeight=512},f._atlasLimitWidth=0,f._atlasLimitHeight=0,f.gridSize=16,f.atlasTextureWidth=0,f.atlasTextureHeight=0,f.maxTextureCount=0,f._atlasRestore=0,f.BOARDER_TYPE_NO=0,f.BOARDER_TYPE_RIGHT=1,f.BOARDER_TYPE_LEFT=2,f.BOARDER_TYPE_BOTTOM=4,f.BOARDER_TYPE_TOP=8,f.BOARDER_TYPE_ALL=15,f._sid_=0,f._Instance=null,f}(),$=function(){function H(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return o(H,"laya.webgl.atlas.MergeFillInfo"),H}(),x=function(){function n(){}return o(n,"laya.webgl.canvas.BlendMode"),n._init_=function(H){n.fns=[n.BlendNormal,n.BlendAdd,n.BlendMultiply,n.BlendScreen,n.BlendOverlay,n.BlendLight,n.BlendMask,n.BlendDestinationOut],n.targetFns=[n.BlendNormalTarget,n.BlendAddTarget,n.BlendMultiplyTarget,n.BlendScreenTarget,n.BlendOverlayTarget,n.BlendLightTarget,n.BlendMask,n.BlendDestinationOut]},n.BlendNormal=function(H){H.blendFunc(1,771)},n.BlendAdd=function(H){H.blendFunc(1,772)},n.BlendMultiply=function(H){H.blendFunc(774,771)},n.BlendScreen=function(H){H.blendFunc(1,1)},n.BlendOverlay=function(H){H.blendFunc(1,769)},n.BlendLight=function(H){H.blendFunc(1,1)},n.BlendNormalTarget=function(H){H.blendFunc(1,771)},n.BlendAddTarget=function(H){H.blendFunc(1,772)},n.BlendMultiplyTarget=function(H){H.blendFunc(774,771)},n.BlendScreenTarget=function(H){H.blendFunc(1,1)},n.BlendOverlayTarget=function(H){H.blendFunc(1,769)},n.BlendLightTarget=function(H){H.blendFunc(1,1)},n.BlendMask=function(H){H.blendFunc(0,770)},n.BlendDestinationOut=function(H){H.blendFunc(0,0)},n.activeBlendFunction=null,n.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],n.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},n.NORMAL="normal",n.ADD="add",n.MULTIPLY="multiply",n.SCREEN="screen",n.LIGHT="light",n.OVERLAY="overlay",n.DESTINATIONOUT="destination-out",n.fns=[],n.targetFns=[],n}(),O=function(){function C(H){this._color=M.create("black"),this.setValue(H)}o(C,"laya.webgl.canvas.DrawStyle");var H=C.prototype;return H.setValue=function(H){if(H){if("string"==typeof H)return void(this._color=M.create(H));if(H instanceof laya.utils.Color)return void(this._color=H)}},H.reset=function(){this._color=M.create("black")},H.equal=function(H){return"string"==typeof H?this._color.strColor===H:H instanceof laya.utils.Color&&this._color.numColor===H.numColor},H.toColorStr=function(){return this._color.strColor},C.create=function(H){var n;if(H&&("string"==typeof H?n=M.create(H):H instanceof laya.utils.Color&&(n=H),n))return n._drawStyle||(n._drawStyle=new C(H));return laya.webgl.canvas.DrawStyle.DEFAULT},I(C,["DEFAULT",function(){return this.DEFAULT=new C("#000000")}]),C}(),S=function(){function H(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];WH.mainContext;this.ib=VH.create(35048),this.vb=BH.create(5)}o(H,"laya.webgl.canvas.Path");var n=H.prototype;return n.addPoint=function(H,n){this.tempArray.push(H,n)},n.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},n.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},n.polygon=function(H,n,C,r,N,Q){var I;return this.geomatrys.push(this._curGeomatry=I=new vH(H,n,C,r,N,Q)),r||(I.fill=!1),null==Q&&(I.borderWidth=0),I},n.setGeomtry=function(H){this.geomatrys.push(this._curGeomatry=H)},n.drawLine=function(H,n,C,r,N){var Q;return this.closePath?this.geomatrys.push(this._curGeomatry=Q=new hH(H,n,C,r,N)):this.geomatrys.push(this._curGeomatry=Q=new bH(H,n,C,r,N)),Q.fill=!1,Q},n.update=function(){var H=this.ib._byteLength,n=this.geomatrys.length;this.offset=H;for(var C=this.geoStart;C<n;C++)this.geomatrys[C].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=n,this.count=(this.ib._byteLength-H)/jH.BYTES_PIDX},n.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},n.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},H}(),T=function(){function A(){}o(A,"laya.webgl.canvas.save.SaveBase");var H=A.prototype;return w.imps(H,{"laya.webgl.canvas.save.ISaveData":!0}),H.isSaveMark=function(){return!1},H.restore=function(H){this._dataObj[this._valueName]=this._value,(A._cache[A._cache._length++]=this)._newSubmit&&(H._curSubmit=QH.RENDERBASE,H._renderKey=0)},A._createArray=function(){var H=[];return H._length=0,H},A._init=function(){var H=A._namemap={};return H[1]="ALPHA",H[2]="fillStyle",H[8]="font",H[256]="lineWidth",H[512]="strokeStyle",H[8192]="_mergeID",H[1024]=H[2048]=H[4096]=[],H[16384]="textBaseline",H[32768]="textAlign",H[65536]="_nBlendType",H[1048576]="shader",H[2097152]="filters",H},A.save=function(H,n,C,r){if((H._saveMark._saveuse&n)!==n){H._saveMark._saveuse|=n;var N=A._cache,Q=0<N._length?N[--N._length]:new A;Q._value=C[Q._valueName=A._namemap[n]],Q._dataObj=C,Q._newSubmit=r;var I=H._save;I[I._length++]=Q}},A._cache=laya.webgl.canvas.save.SaveBase._createArray(),A._namemap=A._init(),A}(),E=function(){function Q(){this._clipRect=new D}o(Q,"laya.webgl.canvas.save.SaveClipRect");var H=Q.prototype;return w.imps(H,{"laya.webgl.canvas.save.ISaveData":!0}),H.isSaveMark=function(){return!1},H.restore=function(H){H._clipRect=this._clipSaveRect,(Q._cache[Q._cache._length++]=this)._submitScissor.submitLength=H._submits._length-this._submitScissor.submitIndex,H._curSubmit=QH.RENDERBASE,H._renderKey=0},Q.save=function(H,n){if(131072!=(131072&H._saveMark._saveuse)){H._saveMark._saveuse|=131072;var C=Q._cache,r=0<C._length?C[--C._length]:new Q;r._clipSaveRect=H._clipRect,H._clipRect=r._clipRect.copyFrom(H._clipRect),r._submitScissor=n;var N=H._save;N[N._length++]=r}},I(Q,["_cache",function(){return this._cache=T._createArray()}]),Q}(),G=function(){function g(){this._contextX=0,this._contextY=0,this._clipRect=new D,this._rect=new D,this._matrix=new i}o(g,"laya.webgl.canvas.save.SaveClipRectStencil");var H=g.prototype;return w.imps(H,{"laya.webgl.canvas.save.ISaveData":!0}),H.isSaveMark=function(){return!1},H.restore=function(H){RH.restore(H,this._rect,this._saveMatrix,this._contextX,this._contextY),H._clipRect=this._clipSaveRect,H._curMat=this._saveMatrix,H._x=this._contextX,H._y=this._contextY,g._cache[g._cache._length++]=this,H._curSubmit=QH.RENDERBASE},g.save=function(H,n,C,r,N,Q,I,A,P,t){if(262144!=(262144&H._saveMark._saveuse)){H._saveMark._saveuse|=262144;var R=g._cache,y=0<R._length?R[--R._length]:new g;y._clipSaveRect=H._clipRect,y._clipRect.setTo(I,A,P,t),H._clipRect=y._clipRect,y._rect.x=C,y._rect.y=r,y._rect.width=N,y._rect.height=Q,y._contextX=H._x,y._contextY=H._y,y._saveMatrix=H._curMat,H._curMat.copyTo(y._matrix),H._curMat=y._matrix,y._submitStencil=n;var o=H._save;o[o._length++]=y}},I(g,["_cache",function(){return this._cache=T._createArray()}]),g}(),J=function(){function r(){this._saveuse=0}o(r,"laya.webgl.canvas.save.SaveMark");var H=r.prototype;return w.imps(H,{"laya.webgl.canvas.save.ISaveData":!0}),H.isSaveMark=function(){return!0},H.restore=function(H){H._saveMark=this._preSaveMark,r._no[r._no._length++]=this},r.Create=function(H){var n=r._no,C=0<n._length?n[--n._length]:new r;return C._saveuse=0,C._preSaveMark=H._saveMark,H._saveMark=C},I(r,["_no",function(){return this._no=T._createArray()}]),r}(),Y=function(){function Q(){this._matrix=new i}o(Q,"laya.webgl.canvas.save.SaveTransform");var H=Q.prototype;return w.imps(H,{"laya.webgl.canvas.save.ISaveData":!0}),H.isSaveMark=function(){return!1},H.restore=function(H){H._curMat=this._savematrix,Q._no[Q._no._length++]=this},Q.save=function(H){var n=H._saveMark;if(2048!=(2048&n._saveuse)){n._saveuse|=2048;var C=Q._no,r=0<C._length?C[--C._length]:new Q;r._savematrix=H._curMat,H._curMat=H._curMat.copyTo(r._matrix);var N=H._save;N[N._length++]=r}},I(Q,["_no",function(){return this._no=T._createArray()}]),Q}(),u=function(){function N(){}o(N,"laya.webgl.canvas.save.SaveTranslate");var H=N.prototype;return w.imps(H,{"laya.webgl.canvas.save.ISaveData":!0}),H.isSaveMark=function(){return!1},H.restore=function(H){H._curMat;H._x=this._x,H._y=this._y,N._no[N._no._length++]=this},N.save=function(H){var n=N._no,C=0<n._length?n[--n._length]:new N;C._x=H._x,C._y=H._y;var r=H._save;r[r._length++]=C},I(N,["_no",function(){return this._no=T._createArray()}]),N}(),X=function(){function H(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new D}o(H,"laya.webgl.resource.RenderTargetMAX");var n=H.prototype;return n.setSP=function(H){this._sp=H},n.size=function(H,n){var C=this;this._width!==H||this._height!==n?(this.repaint=!0,this._width=H,this._height=n,this.target?this.target.size(H,n):this.target=mH.create(H,n),this.target.hasListener("recovered")||this.target.on("recovered",this,function(H){w.timer.callLater(C._sp,C._sp.repaint)})):this.target.size(H,n)},n._flushToTarget=function(H,n){if(!n._destroy){var C=cH.worldScissorTest,r=cH.worldClipRect;cH.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,cH.worldScissorTest=!1,WH.mainContext.disable(3089);var N=cH.worldAlpha,Q=cH.worldMatrix4,I=cH.worldMatrix,A=cH.worldFilters,P=cH.worldShaderDefines;if(cH.worldMatrix=i.EMPTY,cH.restoreTempArray(),cH.worldMatrix4=cH.TEMPMAT4_ARRAY,cH.worldAlpha=1,cH.worldFilters=null,cH.worldShaderDefines=null,pH.activeShader=null,n.start(),F.showCanvasMark?n.clear(0,1,0,.3):n.clear(0,0,0,0),H.flush(),n.end(),pH.activeShader=null,cH.worldAlpha=N,cH.worldMatrix4=Q,cH.worldMatrix=I,cH.worldFilters=A,cH.worldShaderDefines=P,cH.worldScissorTest=C){var t=cH.height-r.y-r.height;WH.mainContext.scissor(r.x,t,r.width,r.height),WH.mainContext.enable(3089)}cH.worldClipRect=r}},n.flush=function(H){this.repaint&&(this._flushToTarget(H,this.target),this.repaint=!1)},n.drawTo=function(H,n,C,r,N){H.drawTexture(this.target.getTexture(),n,C,r,N,0,0)},n.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},H}(),V=function(){function H(){this.ALPHA=1,this.shaderType=0,this.defines=new LH}return o(H,"laya.webgl.shader.d2.Shader2D"),H.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},H.__init__=function(){var H,n;JH.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),JH.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),JH.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),JH.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),JH.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),JH.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),JH.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),JH.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),H="attribute vec4 position;\n",H+="attribute vec2 texcoord;\n",H+="uniform vec2 size;\n\n",H+="#ifdef WORLDMAT\n",H+="  uniform mat4 mmat;\n",H+="#endif\n",H+="varying vec2 v_texcoord;\n",H+="void main() {\n",H+="  #ifdef WORLDMAT\n",H+="  vec4 pos=mmat*position;\n",H+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",H+="  #else\n",H+="  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n",H+="  #endif\n\n",H+="  v_texcoord = texcoord;\n",H+="}",n="precision mediump float;\n",n+="varying vec2 v_texcoord;\n",n+="uniform sampler2D texture;\n\n",n+="#ifdef COLORMUL\n",n+="  uniform vec4 colorMul;\n",n+="#endif\n\n",n+="#ifdef TXTALPHA\n",n+="  uniform sampler2D texture1;\n",n+="#endif\n\n",n+="uniform float alpha;\n",n+='#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n',n+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',n+='#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n',n+='#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\n',n+="void main() {\n",n+="   vec4 color= texture2D(texture, v_texcoord);\n\n",n+="   #ifdef TXTCOMPRESS\n",n+="      color.rgb *= color.a;\n",n+="   #endif\n\n",n+="   #ifdef TXTALPHA\n",n+="      color.rgba *= texture2D(texture1, v_texcoord).a;\n",n+="   #endif\n\n",n+="   color.a*=alpha;\n",n+="   color.rgb*=alpha;\n",n+="   #ifdef COLORMUL\n",n+="      color.rgba *= colorMul;\n",n+="   #endif\n\n",n+="   gl_FragColor=color;\n",n+='   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";\n',n+='   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n',n+='   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',n+='   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n',n+="}",JH.preCompile2D(0,1,H,n,null),H="attribute vec4 position;\n",H+="uniform vec2 size;\n",H+="uniform mat4 mmat;\n",H+="void main() {\n",H+="  vec4 pos=mmat*position;\n",H+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",H+="}",n="precision mediump float;\n",n+="uniform vec4 color;\n",n+="uniform float alpha;\n",n+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',n+="void main() {\n",n+="\t vec4 a = vec4(color.r, color.g, color.b, color.a);\n",n+="\t a.w = alpha;\n",n+="\t a.xyz *= alpha;\n",n+="\t gl_FragColor = a;\n",n+='\t #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',n+="}",JH.preCompile2D(0,2,H,n,null),H="attribute vec4 position;\n",H+="attribute vec3 a_color;\n",H+="uniform mat4 mmat;\n",H+="uniform mat4 u_mmat2;\n",H+="uniform vec2 u_pos;\n",H+="uniform vec2 size;\n",H+="varying vec3 color;\n",H+="void main(){\n",H+="  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n",H+="  vec4 pos=mmat*u_mmat2*tPos;\n",H+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",H+="  color=a_color;\n",H+="}",n="precision mediump float;\n",n+="varying vec3 color;\n",n+="uniform float alpha;\n",n+="void main(){\n",n+="  gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n",n+="\t gl_FragColor.rgb*=alpha;\n",n+="}",JH.preCompile2D(0,4,H,n,null),H="attribute vec4 position;\n",H+="attribute vec2 texcoord;\n",H+="uniform vec2 size;\n\n",H+="#ifdef WORLDMAT\n",H+="  uniform mat4 mmat;\n",H+="#endif\n",H+="varying vec2 v_texcoord;\n",H+="void main() {\n",H+="  #ifdef WORLDMAT\n",H+="    vec4 pos=mmat*position;\n",H+="    gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",H+="  #else\n",H+="    gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n",H+="  #endif\n\n",H+="  v_texcoord = texcoord;\n",H+="}",n="#ifdef FSHIGHPRECISION\n",n+="   precision highp float;\n",n+="#else\n",n+="   precision mediump float;\n",n+="#endif\n",n+="varying vec2 v_texcoord;\n",n+="uniform sampler2D texture;\n\n",n+="#ifdef TXTALPHA\n",n+="   uniform sampler2D texture1;\n",n+="#endif\n\n",n+="uniform float alpha;\n",n+="uniform vec4 u_TexRange;\n",n+="uniform vec2 u_offset;\n",n+='#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n',n+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',n+='#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n',n+='#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\n',n+="void main() {\n",n+="   vec2 newTexCoord;\n",n+="   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n",n+="   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n",n+="   vec4 color= texture2D(texture, newTexCoord);\n\n",n+="   #ifdef TXTALPHA\n",n+="      color.a = texture2D(texture1, newTexCoord).a;\n",n+="   #endif\n\n",n+="   color.a*=alpha;\n",n+="   gl_FragColor=color;\n",n+='   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";\n',n+='   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n',n+='   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',n+='   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n',n+="}",JH.preCompile2D(0,256,H,n,null),H="attribute vec2 position;\n",H+="attribute vec2 texcoord;\n",H+="attribute vec4 color;\n",H+="uniform vec2 size;\n",H+="uniform float offsetX;\n",H+="uniform float offsetY;\n",H+="uniform mat4 mmat;\n",H+="uniform mat4 u_mmat2;\n",H+="varying vec2 v_texcoord;\n",H+="varying vec4 v_color;\n",H+="void main() {\n",H+="  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n",H+="  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",H+="  v_color = color;\n",H+="  v_color.rgb *= v_color.a;\n",H+="  v_texcoord = texcoord;  \n",H+="}",n="precision mediump float;\n",n+="varying vec2 v_texcoord;\n",n+="varying vec4 v_color;\n",n+="uniform sampler2D texture;\n\n",n+="#ifdef TXTALPHA\n",n+="  uniform sampler2D texture1;\n",n+="#endif\n\n",n+="uniform float alpha;\n",n+="void main() {\n",n+="\t vec4 t_color = texture2D(texture, v_texcoord);\n\n",n+="  #ifdef TXTALPHA\n",n+="    t_color.a = texture2D(texture1, v_texcoord).a;\n",n+="  #endif\n\n",n+="\t gl_FragColor = t_color.rgba * v_color;\n",n+="\t gl_FragColor *= alpha;\n",n+="}",JH.preCompile2D(0,512,H,n,null)},H}(),B=function(){function n(H,n,C){this._value=0,this._name2int=H,this._int2name=n,this._int2nameMap=C}o(n,"laya.webgl.shader.ShaderDefines");var H=n.prototype;return H.add=function(H){return"string"==typeof H&&(H=this._name2int[H]),this._value|=H,this._value},H.addInt=function(H){return this._value|=H,this._value},H.remove=function(H){return"string"==typeof H&&(H=this._name2int[H]),this._value&=~H,this._value},H.isDefine=function(H){return(this._value&H)===H},H.getValue=function(){return this._value},H.setValue=function(H){this._value=H},H.toNameDic=function(){var H=this._int2nameMap[this._value];return H||n._toText(this._value,this._int2name,this._int2nameMap)},n._reg=function(H,n,C,r){r[C[H]=n]=H},n._toText=function(H,n,C){var r=C[H];if(r)return r;for(var N={},Q=1,I=0;I<32&&!(H<(Q=1<<I));I++)if(H&Q){var A=n[Q];A&&(N[A]="")}return C[H]=N},n._toInt=function(H,n){for(var C=H.split("."),r=0,N=0,Q=C.length;N<Q;N++){var I=n[C[N]];if(!I)throw new Error("Defines to int err:"+H+"/"+C[N]);r|=I}return r},n}(),HH=function(){function I(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new i}o(I,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var H=I.prototype;return H.init=function(H,n,C){if(n)this._vs=n;else{this._vs=[];var r=H.width,N=H.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(r,0,1,0,1,1,1,1),this._vs.push(r,N,1,1,1,1,1,1),this._vs.push(0,N,0,1,1,1,1,1)}C?this._ps=C:(I._defaultPS||(I._defaultPS=[]).push(0,1,3,3,1,2),this._ps=I._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=H},H.init2=function(H,n,C,r,N){this.transform&&(this.transform=null),C?this._ps=C:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=r,this._uvs=N,this.mEleNum=this._ps.length,this.mTexture=H,(f.isConchNode||f.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},H._initMyData=function(){var H=0,n=0,C=4*this._verticles.length;this._vs=I._tempVS;var r=!1;if(f.isConchNode||f.isConchApp?(this._vs.length=C,r=!0):this._vs.length<C&&(this._vs.length=C,r=!0),I._tVSLen=C,r)for(;H<C;)this._vs[H]=this._verticles[n],this._vs[H+1]=this._verticles[n+1],this._vs[H+2]=this._uvs[n],this._vs[H+3]=this._uvs[n+1],this._vs[H+4]=1,this._vs[H+5]=1,this._vs[H+6]=1,this._vs[H+7]=1,H+=8,n+=2;else for(;H<C;)this._vs[H]=this._verticles[n],this._vs[H+1]=this._verticles[n+1],this._vs[H+2]=this._uvs[n],this._vs[H+3]=this._uvs[n+1],H+=8,n+=2},H.getData2=function(H,n,C){var r;this.mVBBuffer=H,this.mIBBuffer=n,this._initMyData(),H.appendEx2(this._vs,Float32Array,I._tVSLen,4),this._indexStart=n._byteLength,(r=I._tempIB).length<this._ps.length&&(r.length=this._ps.length);for(var N=0,Q=this._ps.length;N<Q;N++)r[N]=this._ps[N]+C;n.appendEx2(r,Uint16Array,this._ps.length,2)},H.getData=function(H,n,C){if(this.mVBBuffer=H,this.mIBBuffer=n,H.append(this.mVBData),this._indexStart=n._byteLength,this.mIBData.start!=C){for(var r=0,N=this._ps.length;r<N;r++)this.mIBData[r]=this._ps[r]+C;this.mIBData.start=C}n.append(this.mIBData)},H.render=function(H,n,C){if(f.isWebGL&&this.mTexture){H._renderKey=0,H._shader2D.glTexture=null,nH.getInstance().addSkinMesh(this);var r=QH.createShape(H,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,kH.create(512,0));this.transform||(this.transform=i.EMPTY),this.transform.translate(n,C),i.mul(this.transform,H._curMat,this._tempMatrix),this.transform.translate(-n,-C);var N=r.shaderValue,Q=N.u_mmat2||cH.getMatrArray();cH.mat2MatArray(this._tempMatrix,Q),N.textureHost=this.mTexture,N.offsetX=0,N.offsetY=0,N.u_mmat2=Q,N.ALPHA=H._shader2D.ALPHA,H._submits[H._submits._length++]=r}else f.isConchApp&&this.mTexture&&(this.transform||(this.transform=i.EMPTY),H.setSkinMesh&&H.setSkinMesh(n,C,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},I._tempVS=[],I._tempIB=[],I._defaultPS=null,I._tVSLen=0,I}(),nH=function(){function H(){this.ib=null,this.vb=null;WH.mainContext;this.ib=VH.create(35048),this.vb=BH.create(8)}o(H,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var n=H.prototype;return n.addSkinMesh=function(H){H.getData2(this.vb,this.ib,this.vb._byteLength/32)},n.reset=function(){this.vb.clear(),this.ib.clear()},H.getInstance=function(){return H.instance=H.instance||new H},H.instance=null,H}(),CH=function(){function H(H,n,C,r,N,Q,I,A,P){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===P&&(P=0),this.x=H,this.y=n,this.width=C,this.height=r,this.edges=N,this.color=Q,this.borderWidth=I,this.borderColor=A}o(H,"laya.webgl.shapes.BasePoly");var n=H.prototype;return w.imps(n,{"laya.webgl.shapes.IShape":!0}),n.getData=function(H,n,C){},n.rebuild=function(H){},n.setMatrix=function(H){},n.needUpdate=function(H){return!0},n.sector=function(H,n,C){var r=this.x,N=this.y,Q=this.edges,I=(this.r1-this.r0)/Q,A=this.width,P=this.height,t=this.color,R=(t>>16&255)/255,y=(t>>8&255)/255,o=(255&t)/255;H.push(r,N,R,y,o);for(var g=0;g<Q+1;g++)H.push(r+Math.sin(I*g+this.r0)*A,N+Math.cos(I*g+this.r0)*P),H.push(R,y,o);for(g=0;g<Q;g++)n.push(C,C+g+1,C+g+2)},n.createLine2=function(H,n,C,r,N,Q){var I,A,P,t,R,y,o,g,M,j,l,f,c,K,W,z,w,F,k,i,a=H.concat(),D=N,L=this.borderColor,b=(L>>16&255)/255,h=(L>>8&255)/255,v=(255&L)/255,e=a.length/2,Z=r,q=C/2;P=a[0],t=a[1],j=P-(R=a[2]),M=(M=-(t-(y=a[3])))/(i=Math.sqrt(M*M+j*j))*q,j=j/i*q,D.push(P-M+this.x,t-j+this.y,b,h,v,P+M+this.x,t+j+this.y,b,h,v);for(var p=1;p<e-1;p++)P=a[2*(p-1)],t=a[2*(p-1)+1],R=a[2*p],y=a[2*p+1],o=a[2*(p+1)],g=a[2*(p+1)+1],j=P-R,f=R-o,W=(-(M=(M=-(t-y))/(i=Math.sqrt(M*M+j*j))*q)+P)*(-(j=j/i*q)+y)-(-M+R)*(-j+t),F=(-(l=(l=-(y-g))/(i=Math.sqrt(l*l+f*f))*q)+o)*(-(f=f/i*q)+y)-(-l+R)*(-f+g),k=(c=-j+t-(-j+y))*(w=-l+R-(-l+o))-(z=-f+g-(-f+y))*(K=-M+R-(-M+P)),Math.abs(k)<.1?(k+=10.1,D.push(R-M+this.x,y-j+this.y,b,h,v,R+M+this.x,y+j+this.y,b,h,v)):(((I=(K*F-w*W)/k)-R)*(I-R)+((A=(z*W-c*F)/k)-y)+(A-y),D.push(I+this.x,A+this.y,b,h,v,R-(I-R)+this.x,y-(A-y)+this.y,b,h,v));P=a[a.length-4],t=a[a.length-3],j=P-(R=a[a.length-2]),M=(M=-(t-(y=a[a.length-1])))/(i=Math.sqrt(M*M+j*j))*q,j=j/i*q,D.push(R-M+this.x,y-j+this.y,b,h,v,R+M+this.x,y+j+this.y,b,h,v);var m=Q;for(p=1;p<m;p++)n.push(Z+2*(p-1),Z+2*(p-1)+1,Z+2*p+1,Z+2*p+1,Z+2*p,Z+2*(p-1));return D},n.createLine=function(H,n,C,r){var N=H.concat(),Q=H,I=this.borderColor,A=(I>>16&255)/255,P=(I>>8&255)/255,t=(255&I)/255;N.splice(0,5);var R,y,o,g,M,j,l,f,c,K,W,z,w,F,k,i,a,D,L,b,h=N.length/5,v=r,e=C/2;o=N[0],g=N[1],K=o-(M=N[5]),c=(c=-(g-(j=N[6])))/(b=Math.sqrt(c*c+K*K))*e,K=K/b*e,Q.push(o-c,g-K,A,P,t,o+c,g+K,A,P,t);for(var Z=1;Z<h-1;Z++)o=N[5*(Z-1)],g=N[5*(Z-1)+1],M=N[5*Z],j=N[5*Z+1],l=N[5*(Z+1)],f=N[5*(Z+1)+1],K=o-M,z=M-l,k=(-(c=(c=-(g-j))/(b=Math.sqrt(c*c+K*K))*e)+o)*(-(K=K/b*e)+j)-(-c+M)*(-K+g),D=(-(W=(W=-(j-f))/(b=Math.sqrt(W*W+z*z))*e)+l)*(-(z=z/b*e)+j)-(-W+M)*(-z+f),L=(w=-K+g-(-K+j))*(a=-W+M-(-W+l))-(i=-z+f-(-z+j))*(F=-c+M-(-c+o)),Math.abs(L)<.1?(L+=10.1,Q.push(M-c,j-K,A,P,t,M+c,j+K,A,P,t)):(((R=(F*D-a*k)/L)-M)*(R-M)+((y=(i*k-w*D)/L)-j)+(y-j),Q.push(R,y,A,P,t,M-(R-M),j-(y-j),A,P,t));o=N[N.length-10],g=N[N.length-9],K=o-(M=N[N.length-5]),c=(c=-(g-(j=N[N.length-4])))/(b=Math.sqrt(c*c+K*K))*e,K=K/b*e,Q.push(M-c,j-K,A,P,t,M+c,j+K,A,P,t);var q=this.edges+1;for(Z=1;Z<q;Z++)n.push(v+2*(Z-1),v+2*(Z-1)+1,v+2*Z+1,v+2*Z+1,v+2*Z,v+2*(Z-1));return Q},n.createLoopLine=function(H,n,C,r,N,Q){var I=H.concat(),A=N||H,P=this.borderColor,t=(P>>16&255)/255,R=(P>>8&255)/255,y=(255&P)/255;I.splice(0,5);var o=[I[0],I[1]],g=[I[I.length-5],I[I.length-4]],M=g[0]+.5*(o[0]-g[0]),j=g[1]+.5*(o[1]-g[1]);I.unshift(M,j,0,0,0),I.push(M,j,0,0,0);var l,f,c,K,W,z,w,F,k,i,a,D,L,b,h,v,e,Z,q,p,m=I.length/5,d=r,_=C/2;c=I[0],K=I[1],i=c-(W=I[5]),k=(k=-(K-(z=I[6])))/(p=Math.sqrt(k*k+i*i))*_,i=i/p*_,A.push(c-k,K-i,t,R,y,c+k,K+i,t,R,y);for(var U=1;U<m-1;U++)c=I[5*(U-1)],K=I[5*(U-1)+1],W=I[5*U],z=I[5*U+1],w=I[5*(U+1)],F=I[5*(U+1)+1],i=c-W,D=W-w,h=(-(k=(k=-(K-z))/(p=Math.sqrt(k*k+i*i))*_)+c)*(-(i=i/p*_)+z)-(-k+W)*(-i+K),Z=(-(a=(a=-(z-F))/(p=Math.sqrt(a*a+D*D))*_)+w)*(-(D=D/p*_)+z)-(-a+W)*(-D+F),q=(L=-i+K-(-i+z))*(e=-a+W-(-a+w))-(v=-D+F-(-D+z))*(b=-k+W-(-k+c)),Math.abs(q)<.1?(q+=10.1,A.push(W-k,z-i,t,R,y,W+k,z+i,t,R,y)):(((l=(b*Z-e*h)/q)-W)*(l-W)+((f=(v*h-L*Z)/q)-z)+(f-z),A.push(l,f,t,R,y,W-(l-W),z-(f-z),t,R,y));Q&&(n=Q);var s=this.edges+1;for(U=1;U<s;U++)n.push(d+2*(U-1),d+2*(U-1)+1,d+2*U+1,d+2*U+1,d+2*U,d+2*(U-1));return n.push(d+2*(U-1),d+2*(U-1)+1,d+1,d+1,d,d+2*(U-1)),A},H}(),rH=function(){function j(){}return o(j,"laya.webgl.shapes.Earcut"),j.earcut=function(H,n,C){C=C||2;var r,N,Q,I,A,P,t,R=n&&n.length,y=R?n[0]*C:H.length,o=j.linkedList(H,0,y,C,!0),g=[];if(!o)return g;if(R&&(o=j.eliminateHoles(H,n,o,C)),H.length>80*C){r=Q=H[0],N=I=H[1];for(var M=C;M<y;M+=C)(A=H[M])<r&&(r=A),(P=H[M+1])<N&&(N=P),Q<A&&(Q=A),I<P&&(I=P);t=0!==(t=Math.max(Q-r,I-N))?1/t:0}return j.earcutLinked(o,g,C,r,N,t),g},j.linkedList=function(H,n,C,r,N){var Q,I;if(N===0<j.signedArea(H,n,C,r))for(Q=n;Q<C;Q+=r)I=j.insertNode(Q,H[Q],H[Q+1],I);else for(Q=C-r;n<=Q;Q-=r)I=j.insertNode(Q,H[Q],H[Q+1],I);return I&&j.equals(I,I.next)&&(j.removeNode(I),I=I.next),I},j.filterPoints=function(H,n){if(!H)return H;n||(n=H);var C,r=H;do{if(C=!1,r.steiner||!j.equals(r,r.next)&&0!==j.area(r.prev,r,r.next))r=r.next;else{if(j.removeNode(r),(r=n=r.prev)===r.next)break;C=!0}}while(C||r!==n);return n},j.earcutLinked=function(H,n,C,r,N,Q,I){if(H){!I&&Q&&j.indexCurve(H,r,N,Q);for(var A,P,t=H;H.prev!==H.next;)if(A=H.prev,P=H.next,Q?j.isEarHashed(H,r,N,Q):j.isEar(H))n.push(A.i/C),n.push(H.i/C),n.push(P.i/C),j.removeNode(H),H=P.next,t=P.next;else if((H=P)===t){I?1===I?(H=j.cureLocalIntersections(H,n,C),j.earcutLinked(H,n,C,r,N,Q,2)):2===I&&j.splitEarcut(H,n,C,r,N,Q):j.earcutLinked(j.filterPoints(H,null),n,C,r,N,Q,1);break}}},j.isEar=function(H){var n=H.prev,C=H,r=H.next;if(0<=j.area(n,C,r))return!1;for(var N=H.next.next;N!==H.prev;){if(j.pointInTriangle(n.x,n.y,C.x,C.y,r.x,r.y,N.x,N.y)&&0<=j.area(N.prev,N,N.next))return!1;N=N.next}return!0},j.isEarHashed=function(H,n,C,r){var N=H.prev,Q=H,I=H.next;if(0<=j.area(N,Q,I))return!1;for(var A=N.x<Q.x?N.x<I.x?N.x:I.x:Q.x<I.x?Q.x:I.x,P=N.y<Q.y?N.y<I.y?N.y:I.y:Q.y<I.y?Q.y:I.y,t=N.x>Q.x?N.x>I.x?N.x:I.x:Q.x>I.x?Q.x:I.x,R=N.y>Q.y?N.y>I.y?N.y:I.y:Q.y>I.y?Q.y:I.y,y=j.zOrder(A,P,n,C,r),o=j.zOrder(t,R,n,C,r),g=H.nextZ;g&&g.z<=o;){if(g!==H.prev&&g!==H.next&&j.pointInTriangle(N.x,N.y,Q.x,Q.y,I.x,I.y,g.x,g.y)&&0<=j.area(g.prev,g,g.next))return!1;g=g.nextZ}for(g=H.prevZ;g&&g.z>=y;){if(g!==H.prev&&g!==H.next&&j.pointInTriangle(N.x,N.y,Q.x,Q.y,I.x,I.y,g.x,g.y)&&0<=j.area(g.prev,g,g.next))return!1;g=g.prevZ}return!0},j.cureLocalIntersections=function(H,n,C){var r=H;do{var N=r.prev,Q=r.next.next;!j.equals(N,Q)&&j.intersects(N,r,r.next,Q)&&j.locallyInside(N,Q)&&j.locallyInside(Q,N)&&(n.push(N.i/C),n.push(r.i/C),n.push(Q.i/C),j.removeNode(r),j.removeNode(r.next),r=H=Q),r=r.next}while(r!==H);return r},j.splitEarcut=function(H,n,C,r,N,Q){var I=H;do{for(var A=I.next.next;A!==I.prev;){if(I.i!==A.i&&j.isValidDiagonal(I,A)){var P=j.splitPolygon(I,A);return I=j.filterPoints(I,I.next),P=j.filterPoints(P,P.next),j.earcutLinked(I,n,C,r,N,Q),void j.earcutLinked(P,n,C,r,N,Q)}A=A.next}I=I.next}while(I!==H)},j.eliminateHoles=function(H,n,C,r){var N,Q,I,A,P,t=[];for(N=0,Q=n.length;N<Q;N++)I=n[N]*r,A=N<Q-1?n[N+1]*r:H.length,(P=j.linkedList(H,I,A,r,!1))===P.next&&(P.steiner=!0),t.push(j.getLeftmost(P));for(t.sort(j.compareX),N=0;N<t.length;N++)j.eliminateHole(t[N],C),C=j.filterPoints(C,C.next);return C},j.compareX=function(H,n){return H.x-n.x},j.eliminateHole=function(H,n){if(n=j.findHoleBridge(H,n)){var C=j.splitPolygon(n,H);j.filterPoints(C,C.next)}},j.findHoleBridge=function(H,n){var C,r=n,N=H.x,Q=H.y,I=-1/0;do{if(Q<=r.y&&Q>=r.next.y&&r.next.y!==r.y){var A=r.x+(Q-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(A<=N&&I<A){if((I=A)===N){if(Q===r.y)return r;if(Q===r.next.y)return r.next}C=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!C)return null;if(N===I)return C.prev;var P,t=C,R=C.x,y=C.y,o=1/0;for(r=C.next;r!==t;)N>=r.x&&r.x>=R&&N!==r.x&&j.pointInTriangle(Q<y?N:I,Q,R,y,Q<y?I:N,Q,r.x,r.y)&&((P=Math.abs(Q-r.y)/(N-r.x))<o||P===o&&r.x>C.x)&&j.locallyInside(r,H)&&(C=r,o=P),r=r.next;return C},j.indexCurve=function(H,n,C,r){for(var N=H;null===N.z&&(N.z=j.zOrder(N.x,N.y,n,C,r)),N.prevZ=N.prev,N.nextZ=N.next,(N=N.next)!==H;);N.prevZ.nextZ=null,N.prevZ=null,j.sortLinked(N)},j.sortLinked=function(H){var n,C,r,N,Q,I,A,P,t=1;do{for(C=H,Q=H=null,I=0;C;){for(I++,r=C,n=A=0;n<t&&(A++,r=r.nextZ);n++);for(P=t;0<A||0<P&&r;)0!==A&&(0===P||!r||C.z<=r.z)?(C=(N=C).nextZ,A--):(r=(N=r).nextZ,P--),Q?Q.nextZ=N:H=N,N.prevZ=Q,Q=N;C=r}Q.nextZ=null,t*=2}while(1<I);return H},j.zOrder=function(H,n,C,r,N){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H=32767*(H-C)*N)|H<<8))|H<<4))|H<<2))|H<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*N)|n<<8))|n<<4))|n<<2))|n<<1))<<1},j.getLeftmost=function(H){for(var n=H,C=H;n.x<C.x&&(C=n),(n=n.next)!==H;);return C},j.pointInTriangle=function(H,n,C,r,N,Q,I,A){return 0<=(N-I)*(n-A)-(H-I)*(Q-A)&&0<=(H-I)*(r-A)-(C-I)*(n-A)&&0<=(C-I)*(Q-A)-(N-I)*(r-A)},j.isValidDiagonal=function(H,n){return H.next.i!==n.i&&H.prev.i!==n.i&&!j.intersectsPolygon(H,n)&&j.locallyInside(H,n)&&j.locallyInside(n,H)&&j.middleInside(H,n)},j.area=function(H,n,C){return(n.y-H.y)*(C.x-n.x)-(n.x-H.x)*(C.y-n.y)},j.equals=function(H,n){return H.x===n.x&&H.y===n.y},j.intersects=function(H,n,C,r){return!!(j.equals(H,n)&&j.equals(C,r)||j.equals(H,r)&&j.equals(C,n))||0<j.area(H,n,C)!=0<j.area(H,n,r)&&0<j.area(C,r,H)!=0<j.area(C,r,n)},j.intersectsPolygon=function(H,n){var C=H;do{if(C.i!==H.i&&C.next.i!==H.i&&C.i!==n.i&&C.next.i!==n.i&&j.intersects(C,C.next,H,n))return!0;C=C.next}while(C!==H);return!1},j.locallyInside=function(H,n){return j.area(H.prev,H,H.next)<0?0<=j.area(H,n,H.next)&&0<=j.area(H,H.prev,n):j.area(H,n,H.prev)<0||j.area(H,H.next,n)<0},j.middleInside=function(H,n){for(var C=H,r=!1,N=(H.x+n.x)/2,Q=(H.y+n.y)/2;C.y>Q!=C.next.y>Q&&C.next.y!==C.y&&N<(C.next.x-C.x)*(Q-C.y)/(C.next.y-C.y)+C.x&&(r=!r),(C=C.next)!==H;);return r},j.splitPolygon=function(H,n){var C=new NH(H.i,H.x,H.y),r=new NH(n.i,n.x,n.y),N=H.next,Q=n.prev;return(H.next=n).prev=H,(C.next=N).prev=C,(r.next=C).prev=r,(Q.next=r).prev=Q,r},j.insertNode=function(H,n,C,r){var N=new NH(H,n,C);return r?(N.next=r.next,(N.prev=r).next.prev=N,r.next=N):(N.prev=N).next=N,N},j.removeNode=function(H){H.next.prev=H.prev,H.prev.next=H.next,H.prevZ&&(H.prevZ.nextZ=H.nextZ),H.nextZ&&(H.nextZ.prevZ=H.prevZ)},j.signedArea=function(H,n,C,r){for(var N=0,Q=n,I=C-r;Q<C;Q+=r)N+=(H[I]-H[Q])*(H[Q+1]+H[I+1]),I=Q;return N},j}(),NH=function(){function H(H,n,C){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=H,this.x=n,this.y=C,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return o(H,"laya.webgl.shapes.EarcutNode"),H}(),QH=(function(){function H(H,n,C,r,N,Q,I){this.lineWidth=H,this.lineColor=n,this.lineAlpha=C,this.fillColor=r,this.fillAlpha=N,this.shape=I,this.fill=Q}o(H,"laya.webgl.shapes.GeometryData");var n=H.prototype;n.clone=function(){return new H(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},n.getIndexData=function(){return null},n.getVertexData=function(){return null},n.destroy=function(){this.shape=null}}(),function(){function H(H){if(H instanceof Float32Array)this.points=H;else if(H instanceof Array){H.length;this.points=new Float32Array(H)}}o(H,"laya.webgl.shapes.Vertex");var n=H.prototype;w.imps(n,{"laya.webgl.shapes.IShape":!0}),n.getData=function(H,n,C){},n.needUpdate=function(H){return!1},n.rebuild=function(H){},n.setMatrix=function(H){}}(),function(){function P(H){void 0===H&&(H=1e4),this._renderType=H}o(P,"laya.webgl.submit.Submit");var H=P.prototype;return w.imps(H,{"laya.webgl.submit.ISubmit":!0}),H.releaseRender=function(){var H=P._cache;(H[H._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},H.getRenderType=function(){return this._renderType},H.renderSubmit=function(){if(0===this._numEle)return 1;var H=this.shaderValue.textureHost;if(H){var n=H.source;if(!H.bitmap||!n)return 1;this.shaderValue.texture=n,H.alphaTexture&&H.alphaTexture.source&&(this.shaderValue.texture1=H.alphaTexture.source)}this._vb.bind_upload(this._ib);var C=WH.mainContext;return this.shaderValue.upload(),x.activeBlendFunction!==this._blendFn&&(C.enable(3042),this._blendFn(C),x.activeBlendFunction=this._blendFn),h.drawCall++,h.trianglesFaces+=this._numEle/3,C.drawElements(4,this._numEle,5123,this._startIdx),1},P.__init__=function(){var H=P.RENDERBASE=new P(-1);H.shaderValue=new kH(0,0),H.shaderValue.ALPHA=-1234},P.createSubmit=function(H,n,C,r,N){var Q=P._cache._length?P._cache[--P._cache._length]:new P;null==C&&((C=Q._selfVb||(Q._selfVb=BH.create(-1))).clear(),r=0),Q._ib=n,Q._vb=C,Q._startIdx=r*jH.BYTES_PIDX,Q._numEle=0;var I=H._nBlendType;Q._blendFn=H._targets?x.targetFns[I]:x.fns[I],Q.shaderValue=N,Q.shaderValue.setValue(H._shader2D);var A=H._shader2D.filters;return A&&Q.shaderValue.setFilters(A),Q},P.createShape=function(H,n,C,r,N,Q){var I=P._cache._length?P._cache[--P._cache._length]:new P;I._ib=n,I._vb=C,I._numEle=r,I._startIdx=N,I.shaderValue=Q,I.shaderValue.setValue(H._shader2D);var A=H._nBlendType;return I._blendFn=H._targets?x.targetFns[A]:x.fns[A],I},P.TYPE_2D=1e4,P.TYPE_CANVAS=10003,P.TYPE_CMDSETRT=10004,P.TYPE_CUSTOM=10005,P.TYPE_BLURRT=10006,P.TYPE_CMDDESTORYPRERT=10007,P.TYPE_DISABLESTENCIL=10008,P.TYPE_OTHERIBVB=10009,P.TYPE_PRIMITIVE=10010,P.TYPE_RT=10011,P.TYPE_BLUR_RT=10012,P.TYPE_TARGET=10013,P.TYPE_CHANGE_VALUE=10014,P.TYPE_SHAPE=10015,P.TYPE_TEXTURE=10016,P.TYPE_FILLTEXTURE=10017,P.RENDERBASE=null,P._cache=((P._cache=[])._length=0,P._cache),P}()),IH=function(){function r(){this.fun=null,this.args=null}o(r,"laya.webgl.submit.SubmitCMD");var H=r.prototype;return w.imps(H,{"laya.webgl.submit.ISubmit":!0}),H.renderSubmit=function(){return this.fun.apply(null,this.args),1},H.getRenderType=function(){return 0},H.releaseRender=function(){var H=r._cache;H[H._length++]=this},r.create=function(H,n){var C=r._cache._length?r._cache[--r._cache._length]:new r;return C.fun=n,C.args=H,C},r._cache=((r._cache=[])._length=0,r._cache),r}(),AH=function(){function n(){this.variables={}}o(n,"laya.webgl.submit.SubmitCMDScope");var H=n.prototype;return H.getValue=function(H){return this.variables[H]},H.addValue=function(H,n){return this.variables[H]=n},H.setValue=function(H,n){return this.variables.hasOwnProperty(H)?this.variables[H]=n:null},H.clear=function(){for(var H in this.variables)delete this.variables[H]},H.recycle=function(){this.clear(),n.POOL.push(this)},n.create=function(){var H=n.POOL.pop();return H||(H=new n),H},n.POOL=[],n}(),PH=function(){function y(){this.offset=0,this.startIndex=0,this._mat=i.create()}o(y,"laya.webgl.submit.SubmitOtherIBVB");var H=y.prototype;return w.imps(H,{"laya.webgl.submit.ISubmit":!0}),H.releaseRender=function(){var H=y._cache;(H[H._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},H.getRenderType=function(){return 10009},H.renderSubmit=function(){var H=this._shaderValue.textureHost;if(H){var n=H.source;if(!H.bitmap||!n)return 1;this._shaderValue.texture=n}this._vb.bind_upload(this._ib);var C=cH.worldMatrix4,r=i.TEMP;i.mulPre(this._mat,C[0],C[1],C[4],C[5],C[12],C[13],r);var N=cH.worldMatrix4=y.tempMatrix4;N[0]=r.a,N[1]=r.b,N[4]=r.c,N[5]=r.d,N[12]=r.tx,N[13]=r.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var Q=WH.mainContext;return x.activeBlendFunction!==this._blendFn&&(Q.enable(3042),this._blendFn(Q),x.activeBlendFunction=this._blendFn),h.drawCall++,h.trianglesFaces+=this._numEle/3,Q.drawElements(4,this._numEle,5123,this.startIndex),cH.worldMatrix4=C,pH.activeShader=null,1},y.create=function(H,n,C,r,N,Q,I,A,P){void 0===P&&(P=0);var t=y._cache._length?y._cache[--y._cache._length]:new y;t._ib=C,t._vb=n,t._numEle=r,t._shader=N,t._shaderValue=Q;var R=H._nBlendType;switch(t._blendFn=H._targets?x.targetFns[R]:x.fns[R],P){case 0:t.offset=0,t.startIndex=A/(jH.BYTES_PE*n.vertexStride)*1.5,t.startIndex*=jH.BYTES_PIDX;break;case 1:t.startIndex=I,t.offset=A}return t},y._cache=((y._cache=[])._length=0,y._cache),y.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y}(),tH=function(){function C(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new D,this.screenRect=new D}o(C,"laya.webgl.submit.SubmitScissor");var H=C.prototype;return w.imps(H,{"laya.webgl.submit.ISubmit":!0}),H._scissor=function(H,n,C,r){var N=cH.worldMatrix4,Q=N[0],I=N[5],A=N[12],P=N[13];if(r*=I,(C*=Q)<1||r<1)return!1;var t=(H=H*Q+A)+C,R=(n=n*I+P)+r;H<0&&(C=t-(H=0)),n<0&&(r=R-(n=0));var y=cH.worldClipRect;if(H=Math.max(H,y.x),n=Math.max(n,y.y),C=Math.min(t,y.right)-H,r=Math.min(R,y.bottom)-n,C<1||r<1)return!1;var o=cH.worldScissorTest;return this.screenRect.copyFrom(y),y.x=H,y.y=n,y.width=C,y.height=r,cH.worldScissorTest=!0,n=cH.height-n-r,WH.mainContext.scissor(H,n,C,r),WH.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(n=cH.height-this.screenRect.y-this.screenRect.height,WH.mainContext.scissor(this.screenRect.x,n,this.screenRect.width,this.screenRect.height),WH.mainContext.enable(3089)):(WH.mainContext.disable(3089),cH.worldScissorTest=!1),y.copyFrom(this.screenRect),!0},H._scissorWithTagart=function(H,n,C,r){if(C<1||r<1)return!1;var N=H+C,Q=n+r;H<0&&(C=N-(H=0)),n<0&&(r=Q-(n=0));var I=cH.worldClipRect;if(H=Math.max(H,I.x),n=Math.max(n,I.y),C=Math.min(N,I.right)-H,r=Math.min(Q,I.bottom)-n,C<1||r<1)return!1;var A=cH.worldScissorTest;return this.screenRect.copyFrom(I),cH.worldScissorTest=!0,I.x=H,I.y=n,I.width=C,I.height=r,n=cH.height-n-r,WH.mainContext.scissor(H,n,C,r),WH.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),A?(n=cH.height-this.screenRect.y-this.screenRect.height,WH.mainContext.scissor(this.screenRect.x,n,this.screenRect.width,this.screenRect.height),WH.mainContext.enable(3089)):(WH.mainContext.disable(3089),cH.worldScissorTest=!1),I.copyFrom(this.screenRect),!0},H.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},H.getRenderType=function(){return 0},H.releaseRender=function(){var H=C._cache;(H[H._length++]=this).context=null},C.create=function(H){var n=C._cache._length?C._cache[--C._cache._length]:new C;return n.context=H,n},C._cache=((C._cache=[])._length=0,C._cache),C}(),RH=function(){function P(){this.step=0,this.blendMode=null,this.level=0}o(P,"laya.webgl.submit.SubmitStencil");var H=P.prototype;return w.imps(H,{"laya.webgl.submit.ISubmit":!0}),H.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},H.getRenderType=function(){return 0},H.releaseRender=function(){var H=P._cache;H[H._length++]=this},H.do1=function(){var H=WH.mainContext;H.enable(2960),H.clear(1024),H.colorMask(!1,!1,!1,!1),H.stencilFunc(514,this.level,255),H.stencilOp(7680,7680,7682)},H.do2=function(){var H=WH.mainContext;H.stencilFunc(514,this.level+1,255),H.colorMask(!0,!0,!0,!0),H.stencilOp(7680,7680,7680)},H.do3=function(){var H=WH.mainContext;H.colorMask(!0,!0,!0,!0),H.stencilOp(7680,7680,7680),H.clear(1024),H.disable(2960)},H.do4=function(){var H=WH.mainContext;0==this.level&&(H.enable(2960),H.clear(1024)),H.colorMask(!1,!1,!1,!1),H.stencilFunc(519,0,255),H.stencilOp(7680,7680,7682)},H.do5=function(){var H=WH.mainContext;H.stencilFunc(514,this.level,255),H.colorMask(!0,!0,!0,!0),H.stencilOp(7680,7680,7680)},H.do6=function(){var H=WH.mainContext;x.targetFns[x.TOINT[this.blendMode]](H)},H.do7=function(){var H=WH.mainContext;H.colorMask(!1,!1,!1,!1),H.stencilOp(7680,7680,7683)},H.do8=function(){var H=WH.mainContext;H.colorMask(!0,!0,!0,!0),H.stencilFunc(514,this.level,255),H.stencilOp(7680,7680,7680)},P.restore=function(H,n,C,r,N){var Q;if((H._renderKey=0)<P._mask&&P._mask--,0==P._mask)Q=laya.webgl.submit.SubmitStencil.create(3),H.addRenderObject(Q),H._curSubmit=QH.RENDERBASE;else{Q=laya.webgl.submit.SubmitStencil.create(7),H.addRenderObject(Q);var I=H._vb;I._byteLength;if(lH.fillRectImgVb(I,null,n.x,n.y,n.width,n.height,q.DEF_UV,C,r,N,0,0)){H._shader2D.glTexture=null;var A=H._curSubmit=QH.createSubmit(H,H._ib,I,(I._byteLength-64)/32*3,kH.create(2,0));A.shaderValue.ALPHA=1,H._submits[H._submits._length++]=A,H._curSubmit._numEle+=6,H._curSubmit=QH.RENDERBASE}else alert("clipRect calc stencil rect error");Q=laya.webgl.submit.SubmitStencil.create(8),H.addRenderObject(Q)}},P.restore2=function(H,n){var C;(H._renderKey=0)<P._mask&&P._mask--,0==P._mask?(C=laya.webgl.submit.SubmitStencil.create(3),H.addRenderObject(C),H._curSubmit=QH.RENDERBASE):(C=laya.webgl.submit.SubmitStencil.create(7),H.addRenderObject(C),H._submits[H._submits._length++]=n,C=laya.webgl.submit.SubmitStencil.create(8),H.addRenderObject(C))},P.create=function(H){var n=P._cache._length?P._cache[--P._cache._length]:new P;return 5==(n.step=H)&&++P._mask,n.level=P._mask,n},P._cache=((P._cache=[])._length=0,P._cache),P._mask=0,P}(),yH=function(){function A(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}o(A,"laya.webgl.submit.SubmitTarget");var H=A.prototype;return w.imps(H,{"laya.webgl.submit.ISubmit":!0}),H.renderSubmit=function(){this._vb.bind_upload(this._ib);var H=this.scope.getValue(this.proName);return H&&(this.shaderValue.texture=H.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[H.width,H.height]),this.shaderValue.upload(),this.blend(),h.drawCall++,h.trianglesFaces+=this._numEle/3,WH.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},H.blend=function(){if(x.activeBlendFunction!==x.fns[this.blendType]){var H=WH.mainContext;H.enable(3042),x.fns[this.blendType](H),x.activeBlendFunction=x.fns[this.blendType]}},H.getRenderType=function(){return 0},H.releaseRender=function(){var H=A._cache;(H[H._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},A.create=function(H,n,C,r,N,Q){var I=A._cache._length?A._cache[--A._cache._length]:new A;return I._ib=n,I._vb=C,I.proName=Q,I._startIdx=r*jH.BYTES_PIDX,I._numEle=0,I.blendType=H._nBlendType,I.shaderValue=N,I.shaderValue.setValue(H._shader2D),I},A._cache=((A._cache=[])._length=0,A._cache),A}(),oH=function(){function H(){this._sourceStr=null}o(H,"laya.webgl.text.CharSegment");var n=H.prototype;return w.imps(n,{"laya.webgl.text.ICharSegment":!0}),n.textToSpit=function(H){this._sourceStr=H},n.getChar=function(H){return this._sourceStr.charAt(H)},n.getCharCode=function(H){return this._sourceStr.charCodeAt(H)},n.length=function(){return this._sourceStr.length},H}(),gH=function(){var H;function h(){}return o(h,"laya.webgl.text.DrawText"),h.__init__=function(){h._charsTemp=new Array,h._drawValue=new H,h._charSeg=new oH},h.customCharSeg=function(H){h._charSeg=H},h.getChar=function(H,n,C){var r=TH.createOneChar(H,C);return-1!=n&&(h._charsCache[n]=r),r},h._drawSlow=function(H,n,C,r,N,Q,I,A,P,t,R,y,o,g,M){var j,l,f=h._drawValue.value(Q,A,P,t,o,g,M),c=0,K=0,W=h._charsTemp,z=0,w=NaN;if(r)for(W.length=r.length,c=0,K=r.length;c<K;c++)(l=r[c])&&(w=l.charNum+f.txtID,W[c]=j=h._charsCache[w]||h.getChar(l.char,w,f),j.active());else{var F=C instanceof laya.utils.WordText?C.toString():C;if(Z.CharacterCache){h._charSeg.textToSpit(F);var k=h._charSeg.length();for(c=0,K=W.length=k;c<K;c++)w=h._charSeg.getCharCode(c)+f.txtID,W[c]=j=h._charsCache[w]||h.getChar(h._charSeg.getChar(c),w,f),j.active(),z+=j.cw}else W.length=0,(j=h.getChar(F,-1,f)).active(),z+=j.cw,W[0]=j}var i=0;null!==I&&"left"!==I&&(i=-("center"==I?z/2:z));var a,D,L=NaN,b=0;if(r)for(c=0,K=W.length;c<K;c++)j=W[c],l=r[c],j&&l&&!j.isSpace&&(L=j.borderSize,a=j.texture,n._drawText(a,R+i+l.x*o-L,y+l.y*g-L,a.width,a.height,N,0,0,0,0));else{for(c=0,K=W.length;c<K;c++)(j=W[c])&&!j.isSpace&&(L=j.borderSize,a=j.texture,n._drawText(a,R+i-L,y-L,a.width,a.height,N,0,0,0,0),H&&((D=H[b++])||(D=H[b-1]=[]),D[0]=a,D[1]=i-L,D[2]=-L)),i+=j.cw;H&&(H.length=b)}},h._drawFast=function(H,n,C,r,N){for(var Q,I,A=0,P=H.length;A<P;A++)(Q=(I=H[A])[0]).active(),n._drawText(Q,r+I[1],N+I[2],Q.width,Q.height,C,0,0,0,0)},h.drawText=function(H,n,C,r,N,Q,I,A,P,t,R,y){if(void 0===y&&(y=0),!(n&&0===n.length||C&&0===C.length)){var o=r.a,g=r.d;(0!==r.b||0!==r.c)&&(o=g=1);var M=1!==o||1!==g;if(M&&w.stage.transform){var j=w.stage.transform;M=j.a===o&&j.d===g}else M=!1;if(M){var l=(r=r.copyTo(FH._tmpMatrix)).tx,f=r.ty;r.scale(1/o,1/g),r._checkTransform(),t*=o,R*=g,t+=l-r.tx,R+=f-r.ty}else o=g=1;if(C)h._drawSlow(null,H,n,C,r,N,Q,I,A,P,t,R,o,g,y);else{if(null===n.toUpperCase){var c=o+1e5*g,K=n;return void(K.changed||K.id!==c?(K.id=c,K.changed=!1,h._drawSlow(K.save,H,n,C,r,N,Q,I,A,P,t,R,o,g,y)):h._drawFast(K.save,H,r,t,R))}var W=n+N.toString()+I+A+P+o+g+Q,z=h._textsCache[W];Z.CharacterCache?z?h._drawFast(z,H,r,t,R):(h._textsCache.__length||(h._textsCache.__length=0),h._textsCache.__length>F.WebGLTextCacheCount&&((h._textsCache={}).__length=0,h._curPoolIndex=0),h._textCachesPool[h._curPoolIndex]?(z=h._textsCache[W]=h._textCachesPool[h._curPoolIndex]).length=0:h._textCachesPool[h._curPoolIndex]=z=h._textsCache[W]=[],h._textsCache.__length++,h._curPoolIndex++,h._drawSlow(z,H,n,C,r,N,Q,I,A,P,t,R,o,g,y)):h._drawSlow(z,H,n,C,r,N,Q,I,A,P,t,R,o,g,y)}}},h._charsTemp=null,h._textCachesPool=[],h._curPoolIndex=0,h._charsCache={},h._textsCache={},h._drawValue=null,h.d=[],h._charSeg=null,h.__init$=function(){H=function(){function P(){}return o(P,""),P.prototype.value=function(H,n,C,r,N,Q,I){this.font=H,this.fillColor=n,this.borderColor=C,this.lineWidth=r,this.scaleX=N,this.scaleY=Q,this.underLine=I;var A=H.toString()+N+Q+r+(n?n.toLowerCase():" ")+(C?C.toLowerCase():" ")+I;return this.txtID=P._keymap[A],this.txtID||(this.txtID=1e-7*++P._keymapCount,P._keymap[A]=this.txtID),this},P.clear=function(){P._keymap={},P._keymapCount=1},P._keymap={},P._keymapCount=1,P}()},h}(),MH=function(){function N(H){this._index=0,this._size=14,this._italic=-2,N._cache2=N._cache2||[],this.setFont(H||"14px Arial")}o(N,"laya.webgl.text.FontInContext");var H=N.prototype;return H.setFont=function(H){var n=N._cache2[H];if(n)this._words=n[0],this._size=n[1];else{this._words=H.split(" ");for(var C=0,r=this._words.length;C<r;C++)if(0<this._words[C].indexOf("px")){this._index=C;break}this._size=parseInt(this._words[this._index]),N._cache2[H]=[this._words,this._size]}this._text=null,this._italic=-2},H.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},H.hasType=function(H){for(var n=0,C=this._words.length;n<C;n++)if(this._words[n]===H)return n;return-1},H.removeType=function(H){for(var n=0,C=this._words.length;n<C;n++)if(this._words[n]===H){this._words.splice(n,1),this._index>n&&this._index--;break}this._text=null,this._italic=-2},H.copyTo=function(H){return H._text=this._text,H._size=this._size,H._index=this._index,H._words=this._words.slice(),H._italic=-2,H},H.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},r(0,H,"size",function(){return this._size},function(H){this._size=H,this._words[this._index]=H+"px",this._text=null}),N.create=function(H){var n=N._cache[H];return n||(n=N._cache[H]=new N(H))},N.EMPTY=new N,N._cache={},N._cache2=null,N}(),jH=function(){function H(){}return o(H,"laya.webgl.utils.CONST3D2D"),H.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],H.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],H.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],H._TMPARRAY=[],H._OFFSETX=0,H._OFFSETY=0,I(H,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),H}(),lH=function(){function M(){}return o(M,"laya.webgl.utils.GlUtils"),M.make2DProjection=function(H,n,C){return[2/H,0,0,0,0,-2/n,0,0,0,0,2/C,0,-1,1,0,1]},M.fillIBQuadrangle=function(H,n){if(65535/4<n)throw Error("IBQuadrangle count:"+n+" must<:"+Math.floor(65535/4));n=Math.floor(n),H._resizeBuffer(6*(n+1)*2,!1),H.byteLength=H.bufferLength;for(var C=H.getUint16Array(),r=0,N=0;N<n;N++)C[r++]=4*N,C[r++]=4*N+2,C[r++]=4*N+1,C[r++]=4*N,C[r++]=4*N+3,C[r++]=4*N+2;return H.setNeedUpload(),!0},M.expandIBQuadrangle=function(H,n){H.bufferLength>=6*n*2||M.fillIBQuadrangle(H,n)},M.mathCeilPowerOfTwo=function(H){return H--,H|=H>>1,H|=H>>2,H|=H>>4,H|=H>>8,H|=H>>16,++H},M.fillQuadrangleImgVb=function(H,n,C,r,N,Q,I,A){var P=16+(H._byteLength>>2);H.byteLength=P<<2;var t=H.getFloat32Array();t[(P-=16)+2]=N[0],t[P+3]=N[1],t[P+6]=N[2],t[P+7]=N[3],t[P+10]=N[4],t[P+11]=N[5],t[P+14]=N[6],t[P+15]=N[7];var R=Q.a,y=Q.b,o=Q.c,g=Q.d;if(1!==R||0!==y||0!==o||1!==g){Q.bTransform=!0;var M=Q.tx+I,j=Q.ty+A;t[P]=(r[0]+n)*R+(r[1]+C)*o+M,t[P+1]=(r[0]+n)*y+(r[1]+C)*g+j,t[P+4]=(r[2]+n)*R+(r[3]+C)*o+M,t[P+5]=(r[2]+n)*y+(r[3]+C)*g+j,t[P+8]=(r[4]+n)*R+(r[5]+C)*o+M,t[P+9]=(r[4]+n)*y+(r[5]+C)*g+j,t[P+12]=(r[6]+n)*R+(r[7]+C)*o+M,t[P+13]=(r[6]+n)*y+(r[7]+C)*g+j}else Q.bTransform=!1,n+=Q.tx+I,C+=Q.ty+A,t[P]=n+r[0],t[P+1]=C+r[1],t[P+4]=n+r[2],t[P+5]=C+r[3],t[P+8]=n+r[4],t[P+9]=C+r[5],t[P+12]=n+r[6],t[P+13]=C+r[7];return H._upload=!0},M.fillTranglesVB=function(H,n,C,r,N,Q,I){var A=(H._byteLength>>2)+r.length;H.byteLength=A<<2;var P=H.getFloat32Array();A-=r.length;for(var t=r.length,R=N.a,y=N.b,o=N.c,g=N.d,M=0;M<t;M+=4)if(P[A+M+2]=r[M+2],P[A+M+3]=r[M+3],1!==R||0!==y||0!==o||1!==g){N.bTransform=!0;var j=N.tx+Q,l=N.ty+I;P[A+M]=(r[M]+n)*R+(r[M+1]+C)*o+j,P[A+M+1]=(r[M]+n)*y+(r[M+1]+C)*g+l}else N.bTransform=!1,n+=N.tx+Q,C+=N.ty+I,P[A+M]=n+r[M],P[A+M+1]=C+r[M+1];return H._upload=!0},M.copyPreImgVb=function(H,n,C){var r=H._byteLength>>2;H.byteLength=r+16<<2;for(var N=H.getFloat32Array(),Q=0,I=r-16;Q<4;Q++)N[r]=N[I]+n,++I,N[++r]=N[I]+C,++I,N[++r]=N[I],++I,N[++r]=N[I],++r,++I;H._upload=!0},M.fillRectImgVb=function(H,n,C,r,N,Q,I,A,P,t,R,y,o){void 0===o&&(o=!1);var g,M,j,l,f,c,K,W,z,w,F,k,i,a,D,L,b=1,h=A.a,v=A.b,e=A.c,Z=A.d,q=n&&n.width<99999999;if(1!==h||0!==v||0!==e||1!==Z?(A.bTransform=!0,0===v&&0===e&&(b=23,z=N+C,w=Q+r,g=h*C+(F=A.tx+P),j=h*z+F,M=Z*r+(k=A.ty+t),l=Z*w+k)):(b=23,A.bTransform=!1,j=(g=C+A.tx+P)+N,l=(M=r+A.ty+t)+Q),q&&(f=n.x,c=n.y,K=n.width+f,W=n.height+c),1!==b){if(Math.min(g,j)>=K)return!1;if(Math.min(M,l)>=W)return!1;if(Math.max(j,g)<=f)return!1;if(Math.max(l,M)<=c)return!1}var p=H._byteLength>>2;H.byteLength=16+p<<2;var m=H.getFloat32Array();switch(m[2+p]=I[0],m[3+p]=I[1],m[6+p]=I[2],m[7+p]=I[3],m[10+p]=I[4],m[11+p]=I[5],m[14+p]=I[6],m[15+p]=I[7],b){case 1:F=A.tx+P,k=A.ty+t;var d=h*C,_=e*r,U=Z*r,s=v*C,$=h*(z=N+C),x=e*(w=Q+r),O=Z*w,S=v*z;o?(i=d+_+F,D=Math.round(i)-i,a=U+s+k,L=Math.round(a)-a,m[p]=i+D,m[1+p]=a+L,m[4+p]=$+_+F+D,m[5+p]=U+S+k+L,m[8+p]=$+x+F+D,m[9+p]=O+S+k+L,m[12+p]=d+x+F+D,m[13+p]=O+s+k+L):(m[p]=d+_+F,m[1+p]=U+s+k,m[4+p]=$+_+F,m[5+p]=U+S+k,m[8+p]=$+x+F,m[9+p]=O+S+k,m[12+p]=d+x+F,m[13+p]=O+s+k);break;case 23:o?(i=g+R,D=Math.round(i)-i,a=M,L=Math.round(a)-a,m[p]=i+D,m[1+p]=a+L,m[4+p]=j+R+D,m[5+p]=M+L,m[8+p]=j+D,m[9+p]=l+L,m[12+p]=g+D,m[13+p]=l+L):(m[p]=g+R,m[1+p]=M,m[4+p]=j+R,m[5+p]=M,m[8+p]=j,m[9+p]=l,m[12+p]=g,m[13+p]=l)}return H._upload=!0},M.fillLineVb=function(H,n,C,r,N,Q,I,A){var P=.5*I,t=M._fillLineArray,R=-(r-Q),y=C-N,o=Math.sqrt(R*R+y*y);R/=o,y/=o,R*=P,y*=P,t[0]=C-R,t[1]=r-y,t[4]=C+R,t[5]=r+y,t[8]=N+R,t[9]=Q+y,t[12]=N-R,t[13]=Q-y,A&&A.transformPointArray(t,t);var g=16+(H._byteLength>>2);return H.byteLength=g<<2,H.insertData(t,g-16),!0},M._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M}(),fH=(function(){function P(){}o(P,"laya.webgl.utils.MatirxArray"),P.ArrayMul=function(H,n,C){if(H)if(n)for(var r=NaN,N=NaN,Q=NaN,I=NaN,A=0;A<4;A++)r=H[A],N=H[A+4],Q=H[A+8],I=H[A+12],C[A]=r*n[0]+N*n[1]+Q*n[2]+I*n[3],C[A+4]=r*n[4]+N*n[5]+Q*n[6]+I*n[7],C[A+8]=r*n[8]+N*n[9]+Q*n[10]+I*n[11],C[A+12]=r*n[12]+N*n[13]+Q*n[14]+I*n[15];else P.copyArray(H,C);else P.copyArray(n,C)},P.copyArray=function(H,n){if(H&&n)for(var C=0;C<H.length;C++)n[C]=H[C]}}(),function(){function n(H,n,C){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=H,this._vb=new BH(H,35048),n&&this._vb._resizeBuffer(n,!1),this._ib=new VH,C&&this._ib._resizeBuffer(C,!1)}o(n,"laya.webgl.utils.Mesh2D");var H=n.prototype;return H.cloneWithNewVB=function(){var H=new n(this._stride,0,0);return H._ib=this._ib,H._quadNum=this._quadNum,H._attribInfo=this._attribInfo,H},H.cloneWithNewVBIB=function(){var H=new n(this._stride,0,0);return H._attribInfo=this._attribInfo,H},H.getVBW=function(){return this._vb.setNeedUpload(),this._vb},H.getVBR=function(){return this._vb},H.getIBR=function(){return this._ib},H.getIBW=function(){return this._ib.setNeedUpload(),this._ib},H.createQuadIB=function(H){this._quadNum=H,this._ib._resizeBuffer(6*H*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var n=this._ib.getUint16Array(),C=0,r=0,N=0;N<H;N++)n[C++]=r,n[C++]=r+2,n[C++]=r+1,n[C++]=r,n[C++]=r+3,n[C++]=r+2,r+=4;this._ib.setNeedUpload()},H.setAttributes=function(H){if(this._attribInfo=H,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},H.getEleNum=function(){return this._ib.getBuffer().byteLength/2},H.releaseMesh=function(){},H.destroy=function(){},H.clearVB=function(){this._vb.clear()},n._gvaoid=0,n}()),cH=function(){function N(){}return o(N,"laya.webgl.utils.RenderState2D"),N.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},N.mat2MatArray=function(H,n){var C=H,r=n;return r[0]=C.a,r[1]=C.b,r[2]=N.EMPTYMAT4_ARRAY[2],r[3]=N.EMPTYMAT4_ARRAY[3],r[4]=C.c,r[5]=C.d,r[6]=N.EMPTYMAT4_ARRAY[6],r[7]=N.EMPTYMAT4_ARRAY[7],r[8]=N.EMPTYMAT4_ARRAY[8],r[9]=N.EMPTYMAT4_ARRAY[9],r[10]=N.EMPTYMAT4_ARRAY[10],r[11]=N.EMPTYMAT4_ARRAY[11],r[12]=C.tx,r[13]=C.ty,r[14]=N.EMPTYMAT4_ARRAY[14],r[15]=N.EMPTYMAT4_ARRAY[15],n},N.restoreTempArray=function(){N.TEMPMAT4_ARRAY[0]=1,N.TEMPMAT4_ARRAY[1]=0,N.TEMPMAT4_ARRAY[4]=0,N.TEMPMAT4_ARRAY[5]=1,N.TEMPMAT4_ARRAY[12]=0,N.TEMPMAT4_ARRAY[13]=0},N.clear=function(){N.worldScissorTest=!1,N.worldShaderDefines=null,N.worldFilters=null,N.worldAlpha=1,N.worldClipRect.x=N.worldClipRect.y=0,N.worldClipRect.width=N.width,N.worldClipRect.height=N.height,N.curRenderTarget=null},N._MAXSIZE=99999999,N.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],N.worldMatrix4=N.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],N.worldAlpha=1,N.worldScissorTest=!1,N.worldFilters=null,N.worldShaderDefines=null,N.curRenderTarget=null,N.width=0,N.height=0,I(N,["worldMatrix",function(){return this.worldMatrix=new i},"worldClipRect",function(){return this.worldClipRect=new D(0,0,99999999,99999999)}]),N}(),KH=function(){var c,C;function K(H,n,C,r,N){var Q=this;function I(H){var n=[],C=new c(n);return Q._compileToTree(C,H.split("\n"),0,n,N),C}var A=g.now();this._VS=I(n),this._PS=I(C),this._nameMap=r,2<g.now()-A&&console.log("ShaderCompile use time:"+(g.now()-A)+"  size:"+n.length+"/"+C.length)}o(K,"laya.webgl.utils.ShaderCompile");var H=K.prototype;return H._compileToTree=function(H,n,C,r,N){var Q,I,A,P,t,R,y,o=0,g=0,M=0,j=0;for(g=C;g<n.length;g++)if(!((A=n[g]).length<1)&&0!==(o=A.indexOf("//"))){if(0<=o&&(A=A.substr(0,o)),Q=y||new c(r),y=null,Q.text=A,Q.noCompile=!0,0<=(o=A.indexOf("#"))){for(P="#",j=o+1,M=A.length;j<M;j++){var l=A.charAt(j);if(" "===l||"\t"===l||"\r"===l||"\n"===l||"?"===l)break;P+=l}switch(Q.name=P){case"#ifdef":case"#ifndef":if(Q.src=A,Q.noCompile=null!=A.match(/[!&|()=<>]/),Q.noCompile?console.log("function():Boolean{return "+A.substr(o+Q.name.length)+"}"):(R=A.replace(/^\s*/,"").split(/\s+/),Q.setCondition(R[1],"#ifdef"===P?1:2),Q.text="//"+Q.text),Q.setParent(H),H=Q,N)for(R=A.substr(j).split(K._splitToWordExps3),j=0;j<R.length;j++)(A=R[j]).length&&(N[A]=!0);continue;case"#if":if(Q.src=A,Q.noCompile=!0,Q.setParent(H),H=Q,N)for(R=A.substr(j).split(K._splitToWordExps3),j=0;j<R.length;j++)(A=R[j]).length&&"defined"!=A&&(N[A]=!0);continue;case"#else":Q.src=A,I=(H=H.parent).childs[H.childs.length-1],Q.noCompile=I.noCompile,Q.noCompile||(Q.condition=I.condition,Q.conditionType=1==I.conditionType?2:1,Q.text="//"+Q.text+" "+I.text+" "+Q.conditionType),Q.setParent(H),H=Q;continue;case"#endif":I=(H=H.parent).childs[H.childs.length-1],Q.noCompile=I.noCompile,Q.noCompile||(Q.text="//"+Q.text),Q.setParent(H);continue;case"#include":R=K.splitToWords(A,null);var f=K.includes[R[1]];if(!f)throw"ShaderCompile error no this include file:"+R[1];if((o=R[0].indexOf("?"))<0){Q.setParent(H),A=f.getWith("with"==R[2]?R[3]:null),this._compileToTree(Q,A.split("\n"),0,r,N),Q.text="";continue}Q.setCondition(R[0].substr(o+1),1),Q.text=f.getWith("with"==R[2]?R[3]:null);break;case"#import":t=(R=K.splitToWords(A,null))[1],r.push({node:Q,file:K.includes[t],ofs:Q.text.length});continue}}else{if((I=H.childs[H.childs.length-1])&&!I.name){0<r.length&&K.splitToWords(A,I),y=Q,I.text+="\n"+A;continue}0<r.length&&K.splitToWords(A,Q)}Q.setParent(H)}},H.createShader=function(H,n,C){var r={},N="";if(H)for(var Q in H)N+="#define "+Q+"\n",r[Q]=!0;var I=this._VS.toscript(r,[]),A=this._PS.toscript(r,[]);return(C||JH.create)(N+I.join("\n"),N+A.join("\n"),n,this._nameMap)},K._parseOne=function(H,n,C,r,N,Q){var I={type:K.shaderParamsMap[C[r+1]],name:C[r+2],size:isNaN(parseInt(C[r+3]))?1:parseInt(C[r+3])};return Q&&("attribute"==N?H.push(I):n.push(I)),":"==C[r+3]&&(I.type=C[r+4],r+=2),r+=2},K.addInclude=function(H,n){if(!n||0===n.length)throw new Error("add shader include file err:"+H);if(K.includes[H])throw new Error("add shader include file err, has add:"+H);K.includes[H]=new C(n)},K.preGetParams=function(H,n){var C=[H,n],r={},N=[],Q=[],I={},A=[];r.attributes=N,r.uniforms=Q,r.defines=I;for(var P=0,t=0,R=0;R<2;R++){C[R]=C[R].replace(K._removeAnnotation,"");var y,o=C[R].match(K._reg);for(P=0,t=o.length;P<t;P++){var g=o[P];if("attribute"==g||"uniform"==g)P=K._parseOne(N,Q,o,P,g,!0);else{if("#define"==g){A[g=o[++P]]=1;continue}if("#ifdef"==g){I[y=o[++P]]=I[y]||[];for(P++;P<t;P++)if("attribute"==(g=o[P])||"uniform"==g)P=K._parseOne(N,Q,o,P,g,A[y]);else if("#else"==g)for(P++;P<t;P++)if("attribute"==(g=o[P])||"uniform"==g)P=K._parseOne(N,Q,o,P,g,!A[y]);else if("#endif"==g)break}}}}return r},K.splitToWords=function(H,n){for(var C,r,N=[],Q=-1,I=0,A=H.length;I<A;I++)if(C=H.charAt(I),0<=" \t=+-*/&%!<>()'\",;".indexOf(C)){if(0<=Q&&1<I-Q&&(r=H.substr(Q,I-Q),N.push(r)),'"'==C||"'"==C){var P=H.indexOf(C,I+1);if(P<0)throw"Sharder err:"+H;N.push(H.substr(I+1,P-I-1)),I=P,Q=-1;continue}"("==C&&n&&0<N.length&&(r=N[N.length-1]+";","vec4;main;".indexOf(r)<0&&(n.useFuns+=r)),Q=-1}else Q<0&&(Q=I);return Q<A&&1<A-Q&&(r=H.substr(Q,A-Q),N.push(r)),N},K.IFDEF_NO=0,K.IFDEF_YES=1,K.IFDEF_ELSE=2,K.IFDEF_PARENT=3,K._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),K._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),K._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),K.includes={},I(K,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),K.__init$=function(){c=function(){function C(H){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=H}o(C,"");var H=C.prototype;return H.setParent=function(H){H.childs.push(this),this.z=H.z+1,this.parent=H},H.setCondition=function(H,n){H&&(this.conditionType=n,H=H.replace(/(\s*$)/g,""),this.condition=function(){return this[H]},this.condition.__condition=H)},H.toscript=function(H,n){return this._toscript(H,n,++C.__id)},H._toscript=function(r,N,Q){if(this.childs.length<1&&!this.text)return N;N.length;if(this.condition){var H=!!this.condition.call(r);if(2===this.conditionType&&(H=!H),!H)return N}if(this.text&&N.push(this.text),0<this.childs.length&&this.childs.forEach(function(H,n,C){H._toscript(r,N,Q)}),0<this.includefiles.length&&0<this.useFuns.length)for(var n,C=0,I=this.includefiles.length;C<I;C++)this.includefiles[C].curUseID!=Q&&0<(n=this.includefiles[C].file.getFunsScript(this.useFuns)).length&&(this.includefiles[C].curUseID=Q,N[0]=n+N[0]);return N},C.__id=1,C}(),C=function(){function H(H){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=H;for(var n=0,C=0,r=0;!((n=H.indexOf("#begin",n))<0);){for(r=n+5;!((r=H.indexOf("#end",r))<0)&&"i"===H.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+H;C=H.indexOf("\n",n);var N=K.splitToWords(H.substr(n,C-n),null);"code"==N[1]?this.codes[N[2]]=H.substr(C+1,r-C-1):"function"==N[1]&&(C=H.indexOf("function",n),C+="function".length,this.funs[N[3]]=H.substr(C+1,r-C-1),this.funnames+=N[3]+";"),n=r+1}}o(H,"");var n=H.prototype;return n.getWith=function(H){var n=H?this.codes[H]:this.script;if(!n)throw"get with error:"+H;return n},n.getFunsScript=function(H){var n="";for(var C in this.funs)0<=H.indexOf(C+";")&&(n+=this.funs[C]);return n},H}()},K}(),WH=function(){function I(){}return o(I,"laya.webgl.WebGL"),I._uint8ArraySlice=function(){for(var H=this.length,n=new Uint8Array(this.length),C=0;C<H;C++)n[C]=this[C];return n},I._float32ArraySlice=function(){for(var H=this.length,n=new Float32Array(this.length),C=0;C<H;C++)n[C]=this[C];return n},I._uint16ArraySlice=function(H){var n,C=arguments,r=0,N=0;if(0===C.length)for(r=this.length,n=new Uint16Array(r),N=0;N<r;N++)n[N]=this[N];else if(2===C.length){var Q=C[0],I=C[1];if(Q<I)for(r=I-Q,n=new Uint16Array(r),N=Q;N<I;N++)n[N-Q]=this[N];else n=new Uint16Array(0)}return n},I.expandContext=function(){var H=A.prototype,n=CanvasRenderingContext2D.prototype;n.fillTrangles=H.fillTrangles,YH.__int__(null),n.setIBVB=function(H,n,C,r,N,Q,I,A,P,t){void 0===P&&(P=0),void 0===t&&(t=0),null===C&&(this._ib=this._ib||VH.QuadrangleIB,C=this._ib,lH.expandIBQuadrangle(C,r._byteLength/64+8)),this._setIBVB(H,n,C,r,N,Q,I,A,P,t)},n.fillTrangles=function(H,n,C,r,N){this._curMat=this._curMat||i.create(),this._vb=this._vb||BH.create(),this._ib||(this._ib=VH.create(),lH.fillIBQuadrangle(this._ib,I/4));var Q=this._vb,I=r.length>>4;lH.fillTranglesVB(Q,n,C,r,N||this._curMat,0,0),lH.expandIBQuadrangle(this._ib,Q._byteLength/64+8);var A=new kH(1,0);A.textureHost=H;var P=new XH("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");Q._vertType=3,this._setIBVB(n,C,this._ib,Q,6*I,N,P,A,0,0)}},I.enable=function(){if(g.__init__(),f.isConchApp&&!f.isConchWebGL)return z.skinAniSprite=function(){return new HH},I.expandContext(),!1;if(z.getWebGLContext=function(H){for(var n,C=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=0;r<C.length;r++){try{n=H.getContext(C[r],{stencil:F.isStencil,alpha:F.isAlpha,antialias:F.isAntialias,premultipliedAlpha:F.premultipliedAlpha,preserveDrawingBuffer:F.preserveDrawingBuffer})}catch(H){}if(n)return n}return null},null==(I.mainContext=I.mainContext||z.getWebGLContext(f._mainCanvas)))return!1;if(f.isWebGL)return!0;l.create=function(H,n){return new Hn(H,n)},n.create=function(H,n,C,r,N,Q,I){return new GH(H,n,C,r,N,Q,I)},f.WebGL=I,f.isWebGL=!0,gH.__init__(),z.createRenderSprite=function(H,n){return new iH(H,n)},z.createWebGLContext2D=function(H){return new FH(H)},z.changeWebGLSize=function(H,n){laya.webgl.WebGL.onStageResize(H,n)},z.createGraphics=function(){return new wH};var H=z.createFilterAction;return z.createFilterAction=H||function(H){return new aH},z.clear=function(H){cH.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var n=f.context.ctx,C=0==n._submits._length||F.preserveDrawingBuffer?M.create(H)._color:b._wgColor;C&&n.clearBG(C[0],C[1],C[2],C[3]),cH.clear()},z.addToAtlas=function(H,n){void 0===n&&(n=!1);var C=H.bitmap;f.optimizeTextureMemory(H.url,H)?w.__typeof(C,"laya.webgl.resource.IMergeAtlasBitmap")&&C.allowMerageInAtlas&&C.on("recovered",H,H.addTextureToAtlas):C.enableMerageInAtlas=!1},z.isAtlas=function(H){return H instanceof laya.webgl.atlas.AtlasWebGLCanvas},s._enable(),z.beginFlush=function(){for(var H=s.instance,n=H.getAtlaserCount(),C=0;C<n;C++){var r=H.getAtlaserByIndex(C).texture;r._flashCacheImageNeedFlush&&z.flashFlushImage(r)}},z.drawToCanvas=function(H,n,C,r,N,Q){(C<=0||r<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),C|=0,r|=0,N|=0,Q|=0;var I=mH.create(C,r,6408,5121,0,!1);I.start(),I.clear(0,0,0,0),f.context.clear(),c.renders[n]._fun(H,f.context,N,cH.height-r+Q),f.context.flush(),I.end();var A=I.getData(0,0,C,r);if(I.recycle(),A.byteLength==C*r*4){var P=new SH;P._canvas=g.createElement("canvas"),P.size(C,r);var t=P._canvas.getContext("2d");g.canvas.size(C,r);var R=g.context,y=R.createImageData(C,r);return y.data.set(new Uint8ClampedArray(A.buffer)),P._imgData=y,R.putImageData(y,0,0),t.save(),t.translate(0,r),t.scale(1,-1),t.drawImage(g.canvas.source,0,0),t.restore(),P}console.log("drawToCanvas error: w:"+C+",h:"+r+",datalen:"+A.byteLength)},z.createFilterAction=function(H){var n;switch(H){case 32:n=new aH}return n},z.addTextureToAtlas=function(H){H._uvID++,s._atlasRestore++,H.bitmap.enableMerageInAtlas&&s.instance.addToAtlas(H)},z.getTexturePixels=function(H,n,C,r,N){f.context.ctx.clear();var Q=new L;Q.graphics.drawTexture(H,-n,-C);var I=mH.create(r,N);I.start(),I.clear(0,0,0,0),Q.render(f.context,0,0),f.context.ctx.flush(),I.end();for(var A=I.getData(0,0,r,N),P=[],t=0,R=N-1;0<=R;R--)for(var y=0;y<r;y++)t=4*(R*r+y),P.push(A[t]),P.push(A[t+1]),P.push(A[t+2]),P.push(A[t+3]);return P},z.skinAniSprite=function(){return new HH},j.create=function(H,n){var C=new SH;return C._imgData=n,C.flipY=!1,C},k._filterStart=function(H,n,C,r,N){var Q=H.getValue("bounds"),I=mH.create(Q.width,Q.height);if(I.start(),I.clear(0,0,0,0),H.addValue("src",I),H.addValue("ScissorTest",cH.worldScissorTest),cH.worldScissorTest){var A=new D;A.copyFrom(C.ctx._clipRect),H.addValue("clipRect",A),cH.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},k._filterEnd=function(H,n,C,r,N){var Q=H.getValue("bounds");H.getValue("src").end();var I=mH.create(Q.width,Q.height);I.start(),I.clear(0,0,0,0),H.addValue("out",I),n._set$P("_filterCache",I),n._set$P("_isHaveGlowFilter",H.getValue("_isHaveGlowFilter"))},k._EndTarget=function(H,n){if(H.getValue("src").recycle(),H.getValue("out").end(),H.getValue("ScissorTest")){cH.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),n.ctx.save();var C=H.getValue("clipRect");n.ctx.clipRect(C.x,C.y,C.width,C.height)}},k._useSrc=function(H){var n=H.getValue("out");n.end(),(n=H.getValue("src")).start(),n.clear(0,0,0,0)},k._endSrc=function(H){H.getValue("src").end()},k._useOut=function(H){var n=H.getValue("src");n.end(),(n=H.getValue("out")).start(),n.clear(0,0,0,0)},k._endOut=function(H){H.getValue("out").end()},k._recycleScope=function(H){H.recycle()},k._filter=function(H,n,C,r){var N=this._next;if(N){var Q,I,A=H.filters,P=A.length;if(1==P&&32==A[0].type)return n.ctx.save(),n.ctx.setFilters([A[0]]),N._fun.call(N,H,n,C,r),void n.ctx.restore();var t=AH.create(),R=a.TEMP,y=n.ctx._getTransformMatrix(),o=i.create();y.copyTo(o);var g=0,M=0,j=!1,l=H._$P._filterCache?H._$P._filterCache:null;if(!l||H._repaint){j=H._isHaveGlowFilter(),t.addValue("_isHaveGlowFilter",j),j&&(g=50,M=25),(I=new D).copyFrom(H.getSelfBounds()),I.x+=H.x,I.y+=H.y,I.x-=H.pivotX+4,I.y-=H.pivotY+4;var f=I.x,c=I.y;if(I.width+=g+8,I.height+=g+8,R.x=I.x*o.a+I.y*o.c,R.y=I.y*o.d+I.x*o.b,I.x=R.x,I.y=R.y,R.x=I.width*o.a+I.height*o.c,R.y=I.height*o.d+I.width*o.b,I.width=R.x,I.height=R.y,I.width<=0||I.height<=0)return;l&&l.recycle(),t.addValue("bounds",I);var K=IH.create([t,H,n,0,0],k._filterStart);n.addRenderObject(K),n.ctx._renderKey=0,n.ctx._shader2D.glTexture=null;var W=H.x-f+M,z=H.y-c+M;N._fun.call(N,H,n,W,z),K=IH.create([t,H,n,0,0],k._filterEnd),n.addRenderObject(K);for(var w=0;w<P;w++){0!=w&&(K=IH.create([t],k._useSrc),n.addRenderObject(K),Q=kH.create(1,0),i.TEMP.identity(),n.ctx.drawTarget(t,0,0,I.width,I.height,i.TEMP,"out",Q,null,x.TOINT.overlay),K=IH.create([t],k._useOut),n.addRenderObject(K)),A[w].action.apply3d(t,H,n,0,0)}K=IH.create([t,n],k._EndTarget),n.addRenderObject(K)}else{if((j=!!H._$P._isHaveGlowFilter&&H._$P._isHaveGlowFilter)&&(g=50,M=25),(I=H.getBounds()).width<=0||I.height<=0)return;I.width+=g,I.height+=g,R.x=I.x*o.a+I.y*o.c,R.y=I.y*o.d+I.x*o.b,I.x=R.x,I.y=R.y,R.x=I.width*o.a+I.height*o.c,R.y=I.height*o.d+I.width*o.b,I.width=R.x,I.height=R.y,t.addValue("out",l)}C=C-M-H.x,r=r-M-H.y,R.setTo(C,r),o.transformPoint(R),C=R.x+I.x,r=R.y+I.y,Q=kH.create(1,0),i.TEMP.identity(),n.ctx.drawTarget(t,C,r,I.width,I.height,i.TEMP,"out",Q,null,x.TOINT.overlay),K=IH.create([t],k._recycleScope),n.addRenderObject(K),o.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=I._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=I._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=I._uint8ArraySlice),!0},I.onStageResize=function(H,n){null!=I.mainContext&&(I.mainContext.viewport(0,0,H,n),cH.width=H,cH.height=n)},I.onInvalidGLRes=function(){s.instance.freeAll(),W.releaseContentManagers(!0),I.doNodeRepaint(w.stage),I.mainContext.viewport(0,0,cH.width,cH.height),w.stage.event("devicelost")},I.doNodeRepaint=function(H){0==H.numChildren&&H.repaint();for(var n=0;n<H.numChildren;n++)I.doNodeRepaint(H.getChildAt(n))},I.init=function(H,n,C){I.mainCanvas=H,j._createContext=function(H){return new FH(H)},SH._createContext=function(H){return new FH(H)};var r=laya.webgl.WebGL.mainContext;if(null!=r.getShaderPrecisionFormat){var N=r.getShaderPrecisionFormat(35633,36338),Q=r.getShaderPrecisionFormat(35632,36338);I.shaderHighPrecision=!(!N.precision||!Q.precision)}else I.shaderHighPrecision=!1;if(I.compressAstc=r.getExtension("WEBGL_compressed_texture_astc"),I.compressAtc=r.getExtension("WEBGL_compressed_texture_atc"),I.compressEtc=r.getExtension("WEBGL_compressed_texture_etc"),I.compressEtc1=r.getExtension("WEBGL_compressed_texture_etc1"),I.compressPvrtc=r.getExtension("WEBGL_compressed_texture_pvrtc"),I.compressS3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),I.compressS3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),I.compressAstc=I.compressAstc?I.compressAstc:{},I.compressAtc=I.compressAtc?I.compressAtc:{},I.compressEtc=I.compressEtc?I.compressEtc:{},I.compressEtc1=I.compressEtc1?I.compressEtc1:{},I.compressPvrtc=I.compressPvrtc?I.compressPvrtc:{},I.compressS3tc=I.compressS3tc?I.compressS3tc:{},I.compressS3tc_srgb=I.compressS3tc_srgb?I.compressS3tc_srgb:{},r.deleteTexture1=r.deleteTexture,r.deleteTexture=function(H){H==zH.curBindTexValue&&(zH.curBindTexValue=null),r.deleteTexture1(H)},I.onStageResize(n,C),null==I.mainContext)throw new Error("webGL getContext err!");e.__init__(),s.__init__(),LH.__init__(),QH.__init__(),FH.__init__(),kH.__init__(),V.__init__(),YH.__int__(r),x._init_(r),f.isConchApp&&conch.setOnInvalidGLRes(I.onInvalidGLRes)},I.mainCanvas=null,I.antialias=!0,I.shaderHighPrecision=!1,I._bg_null=[0,0,0,0],I}(),zH=function(){function r(){}return o(r,"laya.webgl.WebGLContext"),r.UseProgram=function(H){return r._useProgram!==H&&(WH.mainContext.useProgram(H),r._useProgram=H,!0)},r.setDepthTest=function(H,n){n!==r._depthTest&&((r._depthTest=n)?H.enable(2929):H.disable(2929))},r.setDepthMask=function(H,n){n!==r._depthMask&&(r._depthMask=n,H.depthMask(n))},r.setDepthFunc=function(H,n){n!==r._depthFunc&&(r._depthFunc=n,H.depthFunc(n))},r.setBlend=function(H,n){n!==r._blend&&((r._blend=n)?H.enable(3042):H.disable(3042))},r.setBlendFunc=function(H,n,C){(n!==r._sFactor||C!==r._dFactor)&&(r._sFactor=n,r._dFactor=C,H.blendFunc(n,C))},r.setCullFace=function(H,n){n!==r._cullFace&&((r._cullFace=n)?H.enable(2884):H.disable(2884))},r.setFrontFace=function(H,n){n!==r._frontFace&&(r._frontFace=n,H.frontFace(n))},r.bindTexture=function(H,n,C){H.bindTexture(n,C),r.curBindTexTarget=n,r.curBindTexValue=C},r.DEPTH_BUFFER_BIT=256,r.STENCIL_BUFFER_BIT=1024,r.COLOR_BUFFER_BIT=16384,r.POINTS=0,r.LINES=1,r.LINE_LOOP=2,r.LINE_STRIP=3,r.TRIANGLES=4,r.TRIANGLE_STRIP=5,r.TRIANGLE_FAN=6,r.ZERO=0,r.ONE=1,r.SRC_COLOR=768,r.ONE_MINUS_SRC_COLOR=769,r.SRC_ALPHA=770,r.ONE_MINUS_SRC_ALPHA=771,r.DST_ALPHA=772,r.ONE_MINUS_DST_ALPHA=773,r.DST_COLOR=774,r.ONE_MINUS_DST_COLOR=775,r.SRC_ALPHA_SATURATE=776,r.FUNC_ADD=32774,r.BLEND_EQUATION=32777,r.BLEND_EQUATION_RGB=32777,r.BLEND_EQUATION_ALPHA=34877,r.FUNC_SUBTRACT=32778,r.FUNC_REVERSE_SUBTRACT=32779,r.BLEND_DST_RGB=32968,r.BLEND_SRC_RGB=32969,r.BLEND_DST_ALPHA=32970,r.BLEND_SRC_ALPHA=32971,r.CONSTANT_COLOR=32769,r.ONE_MINUS_CONSTANT_COLOR=32770,r.CONSTANT_ALPHA=32771,r.ONE_MINUS_CONSTANT_ALPHA=32772,r.BLEND_COLOR=32773,r.ARRAY_BUFFER=34962,r.ELEMENT_ARRAY_BUFFER=34963,r.ARRAY_BUFFER_BINDING=34964,r.ELEMENT_ARRAY_BUFFER_BINDING=34965,r.STREAM_DRAW=35040,r.STATIC_DRAW=35044,r.DYNAMIC_DRAW=35048,r.BUFFER_SIZE=34660,r.BUFFER_USAGE=34661,r.CURRENT_VERTEX_ATTRIB=34342,r.FRONT=1028,r.BACK=1029,r.CULL_FACE=2884,r.FRONT_AND_BACK=1032,r.BLEND=3042,r.DITHER=3024,r.STENCIL_TEST=2960,r.DEPTH_TEST=2929,r.SCISSOR_TEST=3089,r.POLYGON_OFFSET_FILL=32823,r.SAMPLE_ALPHA_TO_COVERAGE=32926,r.SAMPLE_COVERAGE=32928,r.NO_ERROR=0,r.INVALID_ENUM=1280,r.INVALID_VALUE=1281,r.INVALID_OPERATION=1282,r.OUT_OF_MEMORY=1285,r.CW=2304,r.CCW=2305,r.LINE_WIDTH=2849,r.ALIASED_POINT_SIZE_RANGE=33901,r.ALIASED_LINE_WIDTH_RANGE=33902,r.CULL_FACE_MODE=2885,r.FRONT_FACE=2886,r.DEPTH_RANGE=2928,r.DEPTH_WRITEMASK=2930,r.DEPTH_CLEAR_VALUE=2931,r.DEPTH_FUNC=2932,r.STENCIL_CLEAR_VALUE=2961,r.STENCIL_FUNC=2962,r.STENCIL_FAIL=2964,r.STENCIL_PASS_DEPTH_FAIL=2965,r.STENCIL_PASS_DEPTH_PASS=2966,r.STENCIL_REF=2967,r.STENCIL_VALUE_MASK=2963,r.STENCIL_WRITEMASK=2968,r.STENCIL_BACK_FUNC=34816,r.STENCIL_BACK_FAIL=34817,r.STENCIL_BACK_PASS_DEPTH_FAIL=34818,r.STENCIL_BACK_PASS_DEPTH_PASS=34819,r.STENCIL_BACK_REF=36003,r.STENCIL_BACK_VALUE_MASK=36004,r.STENCIL_BACK_WRITEMASK=36005,r.VIEWPORT=2978,r.SCISSOR_BOX=3088,r.COLOR_CLEAR_VALUE=3106,r.COLOR_WRITEMASK=3107,r.UNPACK_ALIGNMENT=3317,r.PACK_ALIGNMENT=3333,r.MAX_TEXTURE_SIZE=3379,r.MAX_VIEWPORT_DIMS=3386,r.SUBPIXEL_BITS=3408,r.RED_BITS=3410,r.GREEN_BITS=3411,r.BLUE_BITS=3412,r.ALPHA_BITS=3413,r.DEPTH_BITS=3414,r.STENCIL_BITS=3415,r.POLYGON_OFFSET_UNITS=10752,r.POLYGON_OFFSET_FACTOR=32824,r.TEXTURE_BINDING_2D=32873,r.SAMPLE_BUFFERS=32936,r.SAMPLES=32937,r.SAMPLE_COVERAGE_VALUE=32938,r.SAMPLE_COVERAGE_INVERT=32939,r.NUM_COMPRESSED_TEXTURE_FORMATS=34466,r.COMPRESSED_TEXTURE_FORMATS=34467,r.DONT_CARE=4352,r.FASTEST=4353,r.NICEST=4354,r.GENERATE_MIPMAP_HINT=33170,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.DEPTH_COMPONENT=6402,r.ALPHA=6406,r.RGB=6407,r.RGBA=6408,r.LUMINANCE=6409,r.LUMINANCE_ALPHA=6410,r.UNSIGNED_SHORT_4_4_4_4=32819,r.UNSIGNED_SHORT_5_5_5_1=32820,r.UNSIGNED_SHORT_5_6_5=33635,r.FRAGMENT_SHADER=35632,r.VERTEX_SHADER=35633,r.MAX_VERTEX_ATTRIBS=34921,r.MAX_VERTEX_UNIFORM_VECTORS=36347,r.MAX_VARYING_VECTORS=36348,r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,r.MAX_TEXTURE_IMAGE_UNITS=34930,r.MAX_FRAGMENT_UNIFORM_VECTORS=36349,r.SHADER_TYPE=35663,r.DELETE_STATUS=35712,r.LINK_STATUS=35714,r.VALIDATE_STATUS=35715,r.ATTACHED_SHADERS=35717,r.ACTIVE_UNIFORMS=35718,r.ACTIVE_ATTRIBUTES=35721,r.SHADING_LANGUAGE_VERSION=35724,r.CURRENT_PROGRAM=35725,r.NEVER=512,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.NOTEQUAL=517,r.GEQUAL=518,r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.VENDOR=7936,r.RENDERER=7937,r.VERSION=7938,r.NEAREST=9728,r.LINEAR=9729,r.NEAREST_MIPMAP_NEAREST=9984,r.LINEAR_MIPMAP_NEAREST=9985,r.NEAREST_MIPMAP_LINEAR=9986,r.LINEAR_MIPMAP_LINEAR=9987,r.TEXTURE_MAG_FILTER=10240,r.TEXTURE_MIN_FILTER=10241,r.TEXTURE_WRAP_S=10242,r.TEXTURE_WRAP_T=10243,r.TEXTURE_2D=3553,r.TEXTURE=5890,r.TEXTURE_CUBE_MAP=34067,r.TEXTURE_BINDING_CUBE_MAP=34068,r.TEXTURE_CUBE_MAP_POSITIVE_X=34069,r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,r.MAX_CUBE_MAP_TEXTURE_SIZE=34076,r.TEXTURE0=33984,r.TEXTURE1=33985,r.TEXTURE2=33986,r.TEXTURE3=33987,r.TEXTURE4=33988,r.TEXTURE5=33989,r.TEXTURE6=33990,r.TEXTURE7=33991,r.TEXTURE8=33992,r.TEXTURE9=33993,r.TEXTURE10=33994,r.TEXTURE11=33995,r.TEXTURE12=33996,r.TEXTURE13=33997,r.TEXTURE14=33998,r.TEXTURE15=33999,r.TEXTURE16=34e3,r.TEXTURE17=34001,r.TEXTURE18=34002,r.TEXTURE19=34003,r.TEXTURE20=34004,r.TEXTURE21=34005,r.TEXTURE22=34006,r.TEXTURE23=34007,r.TEXTURE24=34008,r.TEXTURE25=34009,r.TEXTURE26=34010,r.TEXTURE27=34011,r.TEXTURE28=34012,r.TEXTURE29=34013,r.TEXTURE30=34014,r.TEXTURE31=34015,r.ACTIVE_TEXTURE=34016,r.REPEAT=10497,r.CLAMP_TO_EDGE=33071,r.MIRRORED_REPEAT=33648,r.FLOAT_VEC2=35664,r.FLOAT_VEC3=35665,r.FLOAT_VEC4=35666,r.INT_VEC2=35667,r.INT_VEC3=35668,r.INT_VEC4=35669,r.BOOL=35670,r.BOOL_VEC2=35671,r.BOOL_VEC3=35672,r.BOOL_VEC4=35673,r.FLOAT_MAT2=35674,r.FLOAT_MAT3=35675,r.FLOAT_MAT4=35676,r.SAMPLER_2D=35678,r.SAMPLER_CUBE=35680,r.VERTEX_ATTRIB_ARRAY_ENABLED=34338,r.VERTEX_ATTRIB_ARRAY_SIZE=34339,r.VERTEX_ATTRIB_ARRAY_STRIDE=34340,r.VERTEX_ATTRIB_ARRAY_TYPE=34341,r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,r.VERTEX_ATTRIB_ARRAY_POINTER=34373,r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,r.COMPILE_STATUS=35713,r.LOW_FLOAT=36336,r.MEDIUM_FLOAT=36337,r.HIGH_FLOAT=36338,r.LOW_INT=36339,r.MEDIUM_INT=36340,r.HIGH_INT=36341,r.FRAMEBUFFER=36160,r.RENDERBUFFER=36161,r.RGBA4=32854,r.RGB5_A1=32855,r.RGB565=36194,r.DEPTH_COMPONENT16=33189,r.STENCIL_INDEX=6401,r.STENCIL_INDEX8=36168,r.DEPTH_STENCIL=34041,r.RENDERBUFFER_WIDTH=36162,r.RENDERBUFFER_HEIGHT=36163,r.RENDERBUFFER_INTERNAL_FORMAT=36164,r.RENDERBUFFER_RED_SIZE=36176,r.RENDERBUFFER_GREEN_SIZE=36177,r.RENDERBUFFER_BLUE_SIZE=36178,r.RENDERBUFFER_ALPHA_SIZE=36179,r.RENDERBUFFER_DEPTH_SIZE=36180,r.RENDERBUFFER_STENCIL_SIZE=36181,r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,r.COLOR_ATTACHMENT0=36064,r.DEPTH_ATTACHMENT=36096,r.STENCIL_ATTACHMENT=36128,r.DEPTH_STENCIL_ATTACHMENT=33306,r.NONE=0,r.FRAMEBUFFER_COMPLETE=36053,r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,r.FRAMEBUFFER_UNSUPPORTED=36061,r.FRAMEBUFFER_BINDING=36006,r.RENDERBUFFER_BINDING=36007,r.MAX_RENDERBUFFER_SIZE=34024,r.INVALID_FRAMEBUFFER_OPERATION=1286,r.UNPACK_FLIP_Y_WEBGL=37440,r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,r.CONTEXT_LOST_WEBGL=37442,r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,r.BROWSER_DEFAULT_WEBGL=37444,r._useProgram=null,r._depthTest=!0,r._depthMask=!0,r._blend=!1,r._cullFace=!1,r.curBindTexTarget=null,r.curBindTexValue=null,I(r,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),r}(),wH=function(H){function n(){n.__super.call(this)}o(n,"laya.webgl.display.GraphicsGL",t);var C=n.prototype;return C.setShader=function(H){this._saveToCmd(f.context._setShader,[H])},C.setIBVB=function(H,n,C,r,N,Q){this._saveToCmd(f.context._setIBVB,[H,n,C,r,N,Q])},C.drawParticle=function(H,n,C){var r=z.createParticleTemplate2D(C);r.x=H,r.y=n,this._saveToCmd(f.context._drawParticle,[r])},n}(),FH=function(H){var C;function U(H){this._x=0,this._y=0,this._id=++U._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,U.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=U.MAXCLIPRECT,this.mOutPoint,this._canvas=H,this._canvas._addReference(),U._contextcount++,f.isFlash?(this._ib=VH.create(35044),lH.fillIBQuadrangle(this._ib,16)):this._ib=VH.QuadrangleIB,this.clear()}o(U,"laya.webgl.canvas.WebGLContext2D",A);var n=U.prototype;return n.setIsMainContext=function(){this._isMain=!0},n.clearBG=function(H,n,C,r){var N=WH.mainContext;N.clearColor(H,n,C,r),N.clear(16384)},n._getSubmits=function(){return this._submits},n._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var H=0,n=this._submits._length;H<n;H++)this._submits[H].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},n.destroy=function(){--U._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=VH.QuadrangleIB&&this._ib.releaseResource()},n.clear=function(){this._submits||(this._other=C.DEFAULT,this._curMat=i.create(),this._vb=BH.create(-1),this._submits=[],this._save=[J.Create(this)],this._save.length=10,this._shader2D=new V,this._triangleMesh=qH.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=C.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=U.MAXCLIPRECT,this._curSubmit=QH.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=O.DEFAULT;for(var H=0,n=this._submits._length;H<n;H++)this._submits[H].releaseRender(),this._submits[H]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},n.size=function(H,n){if(this._width!=H||this._height!=n)if(0==H||0==n){0!=this._vb._byteLength&&(this._width=H,this._height=n,this._vb.clear(),this._vb.upload());for(var C=0,r=this._submits._length;C<r;C++)this._submits[C].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=H,this._height=n,this._targets&&this._targets.size(H,n),this._canvas.memorySize-=this._canvas.memorySize;0===H&&0===n&&this._releaseMem()},n._getTransformMatrix=function(){return this._curMat},n.translate=function(H,n){0===H&&0===n||(u.save(this),this._curMat.bTransform&&(Y.save(this),this._curMat.transformPointN(a.TEMP.setTo(H,n)),H=a.TEMP.x,n=a.TEMP.y),this._x+=H,this._y+=n)},n.save=function(){this._save[this._save._length++]=J.Create(this)},n.restore=function(){var H=this._save._length;if(!(H<1))for(var n=H-1;0<=n;n--){var C=this._save[n];if(C.restore(this),C.isSaveMark())return void(this._save._length=n)}},n._fillText=function(H,n,C,r,N,Q,I,A,P,t){void 0===t&&(t=0);var R=this._shader2D,y=this._curSubmit.shaderValue,o=N?MH.create(N):this._other.font;if(s.enabled)R.ALPHA!==y.ALPHA&&(R.glTexture=null),gH.drawText(this,H,n,this._curMat,o,P||this._other.textAlign,Q,I,A,C,r,t);else{this._shader2D.defines.getValue();var g=Q?M.create(Q)._color:R.colorAdd;R.ALPHA===y.ALPHA&&g===R.colorAdd&&y.colorAdd===R.colorAdd||(R.glTexture=null,R.colorAdd=g),gH.drawText(this,H,n,this._curMat,o,P||this._other.textAlign,Q,I,A,C,r,t)}},n.fillWords=function(H,n,C,r,N,Q){this._fillText(null,H,n,C,r,N,null,-1,null,Q)},n.fillBorderWords=function(H,n,C,r,N,Q,I){this._fillBorderText(null,H,n,C,r,N,Q,I,null)},n.fillText=function(H,n,C,r,N,Q){this._fillText(H,null,n,C,r,N,null,-1,Q)},n.strokeText=function(H,n,C,r,N,Q,I){this._fillText(H,null,n,C,r,null,N,Q||1,I)},n.fillBorderText=function(H,n,C,r,N,Q,I,A){this._fillBorderText(H,null,n,C,r,N,Q,I,A)},n._fillBorderText=function(H,n,C,r,N,Q,I,A,P){if(!s.enabled)return this._fillText(H,n,C,r,N,null,I,A||1,P),void this._fillText(H,n,C,r,N,Q,null,-1,P);var t=this._shader2D,R=this._curSubmit.shaderValue;t.ALPHA!==R.ALPHA&&(t.glTexture=null);var y=N?(U._fontTemp.setFont(N),U._fontTemp):this._other.font;gH.drawText(this,H,n,this._curMat,y,P||this._other.textAlign,Q,I,A||1,C,r,0)},n.fillRect=function(H,n,C,r,N){var Q=this._vb;if(lH.fillRectImgVb(Q,this._clipRect,H,n,C,r,q.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var I=this._shader2D.fillStyle;N&&(this._shader2D.fillStyle=O.create(N));var A=this._shader2D,P=this._curSubmit.shaderValue;if(A.fillStyle!==P.fillStyle||A.ALPHA!==P.ALPHA){A.glTexture=null;var t=this._curSubmit=QH.createSubmit(this,this._ib,Q,(Q._byteLength-64)/32*3,kH.create(2,0));t.shaderValue.color=A.fillStyle._color._color,t.shaderValue.ALPHA=A.ALPHA,this._submits[this._submits._length++]=t}this._curSubmit._numEle+=6,this._shader2D.fillStyle=I}},n.fillTexture=function(H,n,C,r,N,Q,I,A){if(H.loaded&&H.bitmap&&H.source){var P=this._vb,t=H.bitmap.width,R=H.bitmap.height,y=H.uv,o=I.x%H.width,g=I.y%H.height;if(t!=A.w||R!=A.h){if(!A.w&&!A.h)switch(A.oy=A.ox=0,Q){case"repeat":A.width=r,A.height=N;break;case"repeat-x":A.width=r,g<0?H.height+g>N?A.height=N:A.height=H.height+g:(A.oy=g,H.height+g>N?A.height=N-g:A.height=H.height);break;case"repeat-y":o<0?H.width+o>r?A.width=r:A.width=H.width+o:(A.ox=o,H.width+o>r?A.width=r-o:A.width=H.width),A.height=N;break;case"no-repeat":o<0?H.width+o>r?A.width=r:A.width=H.width+o:(A.ox=o,H.width+o>r?A.width=r-o:A.width=H.width),g<0?H.height+g>N?A.height=N:A.height=H.height+g:(A.oy=g,H.height+g>N?A.height=N-g:A.height=H.height);break;default:A.width=r,A.height=N}A.w=t,A.h=R,A.uv=[0,0,A.width/t,0,A.width/t,A.height/R,0,A.height/R]}if(n+=A.ox,C+=A.oy,o-=A.ox,g-=A.oy,lH.fillRectImgVb(P,this._clipRect,n,C,A.width,A.height,A.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var M=ZH.create(this,this._ib,P,(P._byteLength-64)/32*3,kH.create(256,0)),j=(this._submits[this._submits._length++]=M).shaderValue;j.textureHost=H;var l=y[0]*t,f=y[1]*R,c=(y[2]-y[0])*t,K=(y[5]-y[3])*R,W=-o/t,z=-g/R;j.u_TexRange[0]=l/t,j.u_TexRange[1]=c/t,j.u_TexRange[2]=f/R,j.u_TexRange[3]=K/R,j.u_offset[0]=W,j.u_offset[1]=z,s.enabled&&!this._isMain&&M.addTexture(H,(P._byteLength>>2)-16),(this._curSubmit=M)._renderType=10017,M._numEle+=6}}else this.sprite&&w.timer.callLater(this,this._repaintSprite)},n.setShader=function(H){T.save(this,1048576,this._shader2D,!0),this._shader2D.shader=H},n.setFilters=function(H){T.save(this,2097152,this._shader2D,!0),this._shader2D.filters=H,this._curSubmit=QH.RENDERBASE,this._renderKey=0,this._drawCount++},n.drawTexture=function(H,n,C,r,N,Q,I){this._drawTextureM(H,n,C,r,N,Q,I,null,1)},n.addTextureVb=function(H,n,C){var r=this._curSubmit._vb||this._vb,N=r._byteLength>>2;r.byteLength=N+16<<2;for(var Q=r.getFloat32Array(),I=0;I<16;I+=4)Q[N++]=H[I]+n,Q[N++]=H[I+1]+C,Q[N++]=H[I+2],Q[N++]=H[I+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),r._upload=!0},n.willDrawTexture=function(H,n){if(!(H.loaded&&H.bitmap&&H.source))return this.sprite&&w.timer.callLater(this,this._repaintSprite),0;var C=H.bitmap,r=C.id+this._shader2D.ALPHA*n+10016;if(r==this._renderKey)return r;var N=this._shader2D,Q=N.ALPHA,I=this._curSubmit.shaderValue;N.ALPHA*=n,this._renderKey=r,this._drawCount++,N.glTexture=C;var A=this._vb,P=null,t=A._byteLength/32*3,R=I.textureHost&&I.textureHost==H&&I.textureHost.alphaTexture==H.alphaTexture;return P=ZH.create(this,this._ib,A,t,kH.create(1,0)),(this._submits[this._submits._length++]=P).shaderValue.textureHost=H,P._renderType=10016,P._preIsSameTextureShader=10016===this._curSubmit._renderType&&N.ALPHA===I.ALPHA&&R,this._curSubmit=P,N.ALPHA=Q,r},n.drawTextures=function(H,n,C,r){if(H.loaded&&H.bitmap&&H.source){var N=this._clipRect;if(this._clipRect=U.MAXCLIPRECT,this._drawTextureM(H,n[0],n[1],H.width,H.height,C,r,null,1)){if(this._clipRect=N,h.drawCall++,!(n.length<4)){for(var Q=this._curSubmit._vb||this._vb,I=this._curMat.a,A=this._curMat.d,P=2,t=n.length;P<t;P+=2)lH.copyPreImgVb(Q,(n[P]-n[P-2])*I,(n[P+1]-n[P-1])*A),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&w.timer.callLater(this,this._repaintSprite)},n._drawTextureM=function(H,n,C,r,N,Q,I,A,P){if(!H.loaded||!H.source)return this.sprite&&w.timer.callLater(this,this._repaintSprite),!1;var t=this._curSubmit._vb||this._vb,R=H.bitmap;n+=Q,C+=I,this._drawCount++;var y=R.id+this._shader2D.ALPHA*P+10016;if(y!=this._renderKey){this._renderKey=y;var o=this._curSubmit.shaderValue,g=this._shader2D,M=g.ALPHA;g.ALPHA*=P,g.glTexture=R;var j=this._vb,l=null,f=j._byteLength/32*3,c=o.textureHost&&o.textureHost==H&&o.textureHost.alphaTexture==H.alphaTexture;l=ZH.create(this,this._ib,j,f,kH.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=H,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&g.ALPHA===o.ALPHA&&c,this._curSubmit=l,t=this._curSubmit._vb||this._vb,g.ALPHA=M}return!!lH.fillRectImgVb(t,this._clipRect,n,C,r||H.width,N||H.height,H.uv,A||this._curMat,this._x,this._y,0,0)&&(s.enabled&&!this._isMain&&this._curSubmit.addTexture(H,(t._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},n._repaintSprite=function(){this.sprite&&this.sprite.repaint()},n._drawText=function(H,n,C,r,N,Q,I,A,P,t){var R=H.bitmap;this._drawCount++;var y=R.id+this._shader2D.ALPHA+10016;if(y!=this._renderKey){this._renderKey=y;var o=this._curSubmit.shaderValue,g=this._shader2D;g.glTexture=R;var M=this._vb,j=null,l=M._byteLength/32*3,f=o.textureHost&&o.textureHost==H&&o.textureHost.alphaTexture==H.alphaTexture;(j=s.enabled?ZH.create(this,this._ib,M,l,kH.create(1,0)):ZH.create(this,this._ib,M,l,uH.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&g.ALPHA===o.ALPHA&&f,(this._submits[this._submits._length++]=j).shaderValue.textureHost=H,j._renderType=10016,this._curSubmit=j}H.active();var c=this._curSubmit._vb||this._vb;lH.fillRectImgVb(c,this._clipRect,n+I,C+A,r||H.width,N||H.height,H.uv,Q||this._curMat,this._x,this._y,P,t,!0)&&(s.enabled&&!this._isMain&&this._curSubmit.addTexture(H,(c._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},n.drawTextureWithTransform=function(H,n,C,r,N,Q,I,A,P){if(Q){var t=this._curMat,R=this._x,y=this._y;(0!==I||0!==A)&&(this._x=I*t.a+A*t.c,this._y=A*t.d+I*t.b),Q&&t.bTransform?(i.mul(Q,t,U._tmpMatrix),(Q=U._tmpMatrix)._checkTransform()):(this._x+=t.tx,this._y+=t.ty),this._drawTextureM(H,n,C,r,N,0,0,Q,P),this._x=R,this._y=y}else this._drawTextureM(H,n,C,r,N,I,A,null,P)},n.fillQuadrangle=function(H,n,C,r,N){var Q=this._curSubmit,I=this._vb,A=this._shader2D,P=Q.shaderValue;if(this._renderKey=0,H.bitmap){var t=H.bitmap;A.glTexture==t&&A.ALPHA===P.ALPHA||(A.glTexture=t,(Q=this._curSubmit=QH.createSubmit(this,this._ib,I,I._byteLength/32*3,kH.create(1,0))).shaderValue.glTexture=t,this._submits[this._submits._length++]=Q),lH.fillQuadrangleImgVb(I,n,C,r,H.uv,N||this._curMat,this._x,this._y)}else Q.shaderValue.fillStyle&&Q.shaderValue.fillStyle.equal(H)&&A.ALPHA===P.ALPHA||(A.glTexture=null,(Q=this._curSubmit=QH.createSubmit(this,this._ib,I,I._byteLength/32*3,kH.create(2,0))).shaderValue.defines.add(2),Q.shaderValue.fillStyle=O.create(H),this._submits[this._submits._length++]=Q),lH.fillQuadrangleImgVb(I,n,C,r,q.DEF_UV,N||this._curMat,this._x,this._y);Q._numEle+=6},n.drawTexture2=function(H,n,C,r,N,Q,I,A){if(0!=Q){var P=this._curMat;if(this._x=H*P.a+n*P.c,this._y=n*P.d+H*P.b,N&&(N=P.bTransform||N.bTransform?(i.mul(N,P,U._tmpMatrix),U._tmpMatrix):(this._x+=N.tx+P.tx,this._y+=N.ty+P.ty,i.EMPTY)),1!==Q||I){var t=this._shader2D.ALPHA,R=this._nBlendType;this._shader2D.ALPHA=Q,I&&(this._nBlendType=x.TOINT(I)),this._drawTextureM(A[0],A[1]-C,A[2]-r,A[3],A[4],0,0,N,1),this._shader2D.ALPHA=t,this._nBlendType=R}else this._drawTextureM(A[0],A[1]-C,A[2]-r,A[3],A[4],0,0,N,1);this._x=this._y=0}},n.drawCanvas=function(H,n,C,r,N){var Q=H.context;if(this._renderKey=0,Q._targets)this._submits[this._submits._length++]=eH.create(Q,0,null),this._curSubmit=QH.RENDERBASE,Q._targets.drawTo(this,n,C,r,N);else{var I=this._submits[this._submits._length++]=eH.create(Q,this._shader2D.ALPHA,this._shader2D.filters),A=r/H.width,P=N/H.height,t=I._matrix;this._curMat.copyTo(t),1!=A&&1!=P&&t.scale(A,P);var R=t.tx,y=t.ty;t.tx=t.ty=0,t.transformPoint(a.TEMP.setTo(n,C)),t.translate(a.TEMP.x+R,a.TEMP.y+y),this._curSubmit=QH.RENDERBASE}F.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=Q._targets?"yellow":"green",this.strokeRect(n-1,C-1,r+2,N+2,1),this.strokeRect(n,C,r,N,1),this.restore())},n.drawTarget=function(H,n,C,r,N,Q,I,A,P,t){void 0===t&&(t=-1);var R=this._vb;if(lH.fillRectImgVb(R,this._clipRect,n,C,r,N,P||q.DEF_UV,Q||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var y=this._curSubmit=yH.create(this,this._ib,R,(R._byteLength-64)/32*3,A,I);y.blendType=-1==t?this._nBlendType:t,y.scope=H,this._submits[this._submits._length++]=y,this._curSubmit._numEle+=6}},n.mixRGBandAlpha=function(H){return this._mixRGBandAlpha(H,this._shader2D.ALPHA)},n._mixRGBandAlpha=function(H,n){var C=(4278190080&H)>>>24;return 0!=C?C*=n:C=255*n,16777215&H|C<<24},n.drawTriangles=function(H,n,C,r,N,Q,I,A,P,t){if(!H.loaded||!H.source)return this.sprite&&w.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;H.bitmap;var R=this._mixRGBandAlpha(4294967295,A),y=(r.length,Q.length);this._renderKey=-1;var o=this._curSubmit=ZH.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,kH.create(1,0));return o.shaderValue.textureHost=H,o._renderType=10016,this._submits[this._submits._length++]=o,I?(U._tmpMatrix.a=I.a,U._tmpMatrix.b=I.b,U._tmpMatrix.c=I.c,U._tmpMatrix.d=I.d,U._tmpMatrix.tx=I.tx+n,U._tmpMatrix.ty=I.ty+C,i.mul(U._tmpMatrix,this._curMat,U._tmpMatrix)):(U._tmpMatrix.a=this._curMat.a,U._tmpMatrix.b=this._curMat.b,U._tmpMatrix.c=this._curMat.c,U._tmpMatrix.d=this._curMat.d,U._tmpMatrix.tx=this._curMat.tx+n,U._tmpMatrix.ty=this._curMat.ty+C),this._triangleMesh.addData(r,N,Q,U._tmpMatrix,R,this),this._curSubmit._numEle+=y,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},n.transform=function(H,n,C,r,N,Q){Y.save(this),i.mul(i.TEMP.setTo(H,n,C,r,N,Q),this._curMat,this._curMat),this._curMat._checkTransform()},n.setTransformByMatrix=function(H){H.copyTo(this._curMat)},n.transformByMatrix=function(H){Y.save(this),i.mul(H,this._curMat,this._curMat),this._curMat._checkTransform()},n.rotate=function(H){Y.save(this),this._curMat.rotateEx(H)},n.scale=function(H,n){Y.save(this),this._curMat.scaleEx(H,n)},n.clipRect=function(H,n,C,r){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var N=RH.create(4);this.addRenderObject(N);var Q=this._vb,I=Q._byteLength>>2;if(lH.fillRectImgVb(Q,null,H,n,C,r,q.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var A=this._curSubmit=QH.createSubmit(this,this._ib,Q,(Q._byteLength-64)/32*3,kH.create(2,0));A.shaderValue.ALPHA=1,this._submits[this._submits._length++]=A,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var P=RH.create(5);this.addRenderObject(P);var t=Q.getFloat32Array(),R=Math.min(Math.min(Math.min(t[0+I],t[4+I]),t[8+I]),t[12+I]),y=Math.max(Math.max(Math.max(t[0+I],t[4+I]),t[8+I]),t[12+I]),o=Math.min(Math.min(Math.min(t[1+I],t[5+I]),t[9+I]),t[13+I]),g=Math.max(Math.max(Math.max(t[1+I],t[5+I]),t[9+I]),t[13+I]);G.save(this,P,H,n,C,r,R,o,y-R,g-o),this._curSubmit=QH.RENDERBASE}else{C*=this._curMat.a,r*=this._curMat.d;var M=a.TEMP;this._curMat.transformPoint(M.setTo(H,n)),C<0&&(M.x=M.x+C,C=-C),r<0&&(M.y=M.y+r,r=-r),this._renderKey=0;var j=this._curSubmit=tH.create(this);(this._submits[this._submits._length++]=j).submitIndex=this._submits._length,j.submitLength=9999999,E.save(this,j);var l=this._clipRect,f=l.x,c=l.y,K=M.x+C,W=M.y+r;f<M.x&&(l.x=M.x),c<M.y&&(l.y=M.y),l.width=Math.min(K,f+l.width)-l.x,l.height=Math.min(W,c+l.height)-l.y,this._shader2D.glTexture=null,j.clipRect.copyFrom(l),this._curSubmit=QH.RENDERBASE}},n.setIBVB=function(H,n,C,r,N,Q,I,A,P,t,R){if(void 0===P&&(P=0),void 0===t&&(t=0),void 0===R&&(R=0),null===C){if(f.isFlash){var y=r;y._selfIB||(y._selfIB=VH.create(35044)),y._selfIB.clear(),C=y._selfIB}else C=this._ib;lH.expandIBQuadrangle(C,r._byteLength/(4*r.vertexStride*4))}if(!A||!I)throw Error("setIBVB must input:shader shaderValues");var o=PH.create(this,r,C,N,I,A,P,t,R);Q||(Q=i.EMPTY),Q.translate(H,n),i.mul(Q,this._curMat,o._mat),Q.translate(-H,-n),this._submits[this._submits._length++]=o,this._curSubmit=QH.RENDERBASE,this._renderKey=0},n.addRenderObject=function(H){this._submits[this._submits._length++]=H},n.fillTrangles=function(H,n,C,r,N){var Q=this._curSubmit,I=this._vb,A=this._shader2D,P=Q.shaderValue,t=r.length>>4,R=H.bitmap;this._renderKey=0,A.glTexture==R&&A.ALPHA===P.ALPHA||((Q=this._curSubmit=QH.createSubmit(this,this._ib,I,I._byteLength/32*3,kH.create(1,0))).shaderValue.textureHost=H,this._submits[this._submits._length++]=Q),lH.fillTranglesVB(I,n,C,r,N||this._curMat,this._x,this._y),Q._numEle+=6*t},n.submitElement=function(H,n){var C=this._submits;for(n<0&&(n=C._length);H<n;)H+=C[H].renderSubmit()},n.finish=function(){WH.mainContext.finish()},n.flush=function(){var H=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(H>this._ib.bufferLength/12&&lH.expandIBQuadrangle(this._ib,H),!this._isMain&&s.enabled&&s._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=s._atlasRestore;for(var n=this._submits,C=0,r=n._length;C<r;C++){var N=n[C];10016===N.getRenderType()&&N.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),nH.instance&&nH.getInstance().reset();var Q;for(C=0,Q=this.meshlist.length;C<Q;C++){var I=this.meshlist[C];I.canReuse?I.releaseMesh():I.destroy()}return this.meshlist.length=0,this._curSubmit=QH.RENDERBASE,this._renderKey=0,this._triangleMesh=qH.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},n.setPathId=function(H){if(this.mId=H,-1!=this.mId){this.mHaveKey=!1;var n=m.getInstance();n.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,n.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},n.movePath=function(H,n){var C=H,r=n;H=this._curMat.a*C+this._curMat.c*r+this._curMat.tx,n=this._curMat.b*C+this._curMat.d*r+this._curMat.ty,this.mX+=H,this.mY+=n},n.beginPath=function(){var H=this._getPath();H.tempArray.length=0,H.closePath=!1,this.mX=0,this.mY=0},n.closePath=function(){this._path.closePath=!0},n.fill=function(H){void 0===H&&(H=!1);var n=this._getPath();this.drawPoly(0,0,n.tempArray,this.fillStyle._color.numColor,0,0,H)},n.stroke=function(){var H=this._getPath();if(0<this.lineWidth){if(-1==this.mId)H.drawLine(0,0,H.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var n=m.getInstance().shapeLineDic[this.mId];n.rebuild(H.tempArray),H.setGeomtry(n)}else m.getInstance().addLine(this.mId,H.drawLine(0,0,H.tempArray,this.lineWidth,this.strokeStyle._color.numColor));H.update();var C=[this.mX,this.mY],r=QH.createShape(this,H.ib,H.vb,H.count,H.offset,kH.create(4,0));r.shaderValue.ALPHA=this._shader2D.ALPHA,r.shaderValue.u_pos=C,r.shaderValue.u_mmat2=cH.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=r,this._renderKey=-1}},n.line=function(H,n,C,r,N,Q){var I=this._curSubmit,A=this._vb;if(lH.fillLineVb(A,this._clipRect,H,n,C,r,N,Q)){this._renderKey=0;var P=this._shader2D,t=I.shaderValue;P.strokeStyle===t.strokeStyle&&P.ALPHA===t.ALPHA||(P.glTexture=null,(I=this._curSubmit=QH.createSubmit(this,this._ib,A,(A._byteLength-64)/32*3,kH.create(2,0))).shaderValue.strokeStyle=P.strokeStyle,I.shaderValue.mainID=2,I.shaderValue.ALPHA=P.ALPHA,this._submits[this._submits._length++]=I),I._numEle+=6}},n.moveTo=function(H,n,C){void 0===C&&(C=!0);var r=this._getPath();if(C){var N=H,Q=n;H=this._curMat.a*N+this._curMat.c*Q,n=this._curMat.b*N+this._curMat.d*Q}r.addPoint(H,n)},n.lineTo=function(H,n,C){void 0===C&&(C=!0);var r=this._getPath();if(C){var N=H,Q=n;H=this._curMat.a*N+this._curMat.c*Q,n=this._curMat.b*N+this._curMat.d*Q}r.addPoint(H,n)},n.drawCurves=function(H,n,C){this.setPathId(-1),this.beginPath(),this.strokeStyle=C[3],this.lineWidth=C[4];var r=C[2];H+=C[0],n+=C[1],this.movePath(H,n),this.moveTo(r[0],r[1]);for(var N=2,Q=r.length;N<Q;)this.quadraticCurveTo(r[N++],r[N++],r[N++],r[N++]);this.stroke()},n.arcTo=function(H,n,C,r,N){if(-1==this.mId||!this.mHaveKey){var Q=0,I=0,A=0,P=this._getPath();this._curMat.copyTo(U._tmpMatrix),U._tmpMatrix.tx=U._tmpMatrix.ty=0,U._tempPoint.setTo(P.getEndPointX(),P.getEndPointY()),U._tmpMatrix.invertTransformPoint(U._tempPoint);var t=U._tempPoint.x-H,R=U._tempPoint.y-n,y=Math.sqrt(t*t+R*R);if(!(y<=1e-6)){var o=t/y,g=R/y,M=C-H,j=r-n,l=M*M+j*j,f=Math.sqrt(l);if(!(f<=1e-6)){var c=M/f,K=j/f,W=o+c,z=g+K,w=Math.sqrt(W*W+z*z);if(!(w<=1e-6)){var F=W/w,k=z/w,i=Math.acos(F*o+k*g),a=Math.PI/2-i,D=(y=N/Math.tan(a))*o+H,L=y*g+n,b=Math.sqrt(y*y+N*N),h=H+F*b,v=n+k*b,e=0,Z=0;if(0<=o*K-g*c){var q=2*a/U.SEGNUM;e=Math.sin(q),Z=Math.cos(q)}else q=2*-a/U.SEGNUM,e=Math.sin(q),Z=Math.cos(q);I=this._curMat.a*D+this._curMat.c*L,A=this._curMat.b*D+this._curMat.d*L,I==this._path.getEndPointX()&&A==this._path.getEndPointY()||P.addPoint(I,A);var p=D-h,m=L-v;for(Q=0;Q<U.SEGNUM;Q++){var d=p*Z+m*e,_=-p*e+m*Z;I=d+h,A=_+v,H=this._curMat.a*I+this._curMat.c*A,A=n=this._curMat.b*I+this._curMat.d*A,(I=H)==this._path.getEndPointX()&&A==this._path.getEndPointY()||P.addPoint(I,A),p=d,m=_}}}}}},n.arc=function(H,n,C,r,N,Q,I){if(void 0===Q&&(Q=!1),void 0===I&&(I=!0),-1!=this.mId){var A=m.getInstance().shapeDic[this.mId];if(A&&this.mHaveKey&&!A.needUpdate(this._curMat))return;n=H=0}var P,t=0,R=0,y=0,o=0,g=0,M=0,j=0;if(R=N-r,Q)if(Math.abs(R)>=2*Math.PI)R=2*-Math.PI;else for(;0<R;)R-=2*Math.PI;else if(Math.abs(R)>=2*Math.PI)R=2*Math.PI;else for(;R<0;)R+=2*Math.PI;P=R/(j=C<101?Math.max(10,R*C/5):C<201?Math.max(10,R*C/20):Math.max(10,R*C/40))/2,y=Math.abs(4/3*(1-Math.cos(P))/Math.sin(P)),Q&&(y=-y);var l=this._getPath(),f=NaN,c=NaN;for(M=0;M<=j;M++)t=r+R*(M/j),o=H+Math.cos(t)*C,g=n+Math.sin(t)*C,I&&(f=o,c=g,o=this._curMat.a*f+this._curMat.c*c,g=this._curMat.b*f+this._curMat.d*c),o==this._path.getEndPointX()&&g==this._path.getEndPointY()||l.addPoint(o,g);o=H+Math.cos(N)*C,g=n+Math.sin(N)*C,I&&(f=o,c=g,o=this._curMat.a*f+this._curMat.c*c,g=this._curMat.b*f+this._curMat.d*c),o==this._path.getEndPointX()&&g==this._path.getEndPointY()||l.addPoint(o,g)},n.quadraticCurveTo=function(H,n,C,r){var N=y.I,Q=C,I=r;C=this._curMat.a*Q+this._curMat.c*I,r=this._curMat.b*Q+this._curMat.d*I,Q=H,I=n,H=this._curMat.a*Q+this._curMat.c*I,n=this._curMat.b*Q+this._curMat.d*I;for(var A=N.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),H,n,C,r],30,2),P=0,t=A.length/2;P<t;P++)this.lineTo(A[2*P],A[2*P+1],!1);this.lineTo(C,r,!1)},n.rect=function(H,n,C,r){this._other=this._other.make(),this._other.path||(this._other.path=new S),this._other.path.rect(H,n,C,r)},n.strokeRect=function(H,n,C,r,N){var Q=.5*N;this.line(H-Q,n,H+C+Q,n,N,this._curMat),this.line(H+C,n,H+C,n+r,N,this._curMat),this.line(H,n,H,n+r,N,this._curMat),this.line(H-Q,n+r,H+C+Q,n+r,N,this._curMat)},n.clip=function(){},n.drawPoly=function(H,n,C,r,N,Q,I){void 0===I&&(I=!1),this._renderKey=0,this._shader2D.glTexture=null;var A=this._getPath();if(-1==this.mId)A.polygon(H,n,C,r,N||1,Q);else if(this.mHaveKey){var P=m.getInstance().shapeDic[this.mId];P.setMatrix(this._curMat),P.rebuild(A.tempArray),A.setGeomtry(P)}else{var t=A.polygon(H,n,C,r,N||1,Q);m.getInstance().addShape(this.mId,t),t.setMatrix(this._curMat)}A.update();var R,y=[this.mX,this.mY];if((R=QH.createShape(this,A.ib,A.vb,A.count,A.offset,kH.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,R.shaderValue.u_pos=y,R.shaderValue.u_mmat2=cH.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=R,0<N){if(this.mHaveLineKey){var o=m.getInstance().shapeLineDic[this.mId];o.rebuild(A.tempArray),A.setGeomtry(o)}else m.getInstance().addShape(this.mId,A.drawLine(H,n,C,N,Q));A.update(),(R=QH.createShape(this,A.ib,A.vb,A.count,A.offset,kH.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,R.shaderValue.u_mmat2=cH.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=R}},n.drawParticle=function(H,n,C){C.x=H,C.y=n,this._submits[this._submits._length++]=C},n._getPath=function(){return this._path||(this._path=new S)},r(0,n,"globalCompositeOperation",function(){return x.NAMES[this._nBlendType]},function(H){var n=x.TOINT[H];null==n||this._nBlendType===n||(T.save(this,65536,this,!0),this._curSubmit=QH.RENDERBASE,this._renderKey=0,this._nBlendType=n)}),r(0,n,"strokeStyle",function(){return this._shader2D.strokeStyle},function(H){this._shader2D.strokeStyle.equal(H)||(T.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=O.create(H))}),r(0,n,"globalAlpha",function(){return this._shader2D.ALPHA},function(H){(H=Math.floor(1e3*H)/1e3)!=this._shader2D.ALPHA&&(T.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=H)}),r(0,n,"asBitmap",null,function(H){if(H){if(this._targets||(this._targets=new X),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),r(0,n,"fillStyle",function(){return this._shader2D.fillStyle},function(H){this._shader2D.fillStyle.equal(H)||(T.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=O.create(H))}),r(0,n,"textAlign",function(){return this._other.textAlign},function(H){this._other.textAlign===H||(this._other=this._other.make(),T.save(this,32768,this._other,!1),this._other.textAlign=H)}),r(0,n,"lineWidth",function(){return this._other.lineWidth},function(H){this._other.lineWidth===H||(this._other=this._other.make(),T.save(this,256,this._other,!1),this._other.lineWidth=H)}),r(0,n,"textBaseline",function(){return this._other.textBaseline},function(H){this._other.textBaseline===H||(this._other=this._other.make(),T.save(this,16384,this._other,!1),this._other.textBaseline=H)}),r(0,n,"font",null,function(H){H!=this._other.font.toString()&&(this._other=this._other.make(),T.save(this,8,this._other,!1),this._other.font===MH.EMPTY?this._other.font=new MH(H):this._other.font.setFont(H))}),U.__init__=function(){C.DEFAULT=new C},U._tempPoint=new a,U._SUBMITVBSIZE=32e3,U._MAXSIZE=99999999,U._RECTVBSIZE=16,U.MAXCLIPRECT=new D(0,0,99999999,99999999),U._COUNT=0,U._tmpMatrix=new i,U.SEGNUM=32,U._contextcount=0,I(U,["_fontTemp",function(){return this._fontTemp=new MH},"_drawStyleTemp",function(){return this._drawStyleTemp=new O(null)}]),U.__init$=function(){C=function(){function H(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=MH.EMPTY}o(H,"");var n=H.prototype;return n.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=MH.EMPTY},n.make=function(){return this===H.DEFAULT?new H:this},H.DEFAULT=null,H}()},U}(),kH=function(H){function r(H,n){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,r.__super.call(this),this.defines=new LH,this.position=r._POSITION,this.mainID=H,this.subID=n,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.colorMul=N.ShieldColor?M.create(N.ShieldColor)._color:null,this.glTexture=null,this.u_mmat2=null,this._cacheID=H|n,this._inClassCache=r._cache[this._cacheID],0<H&&!this._inClassCache&&(this._inClassCache=r._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}o(r,"laya.webgl.shader.d2.value.Value2D",_);var n=r.prototype;return n.setValue=function(H){},n.refresh=function(){var H=this.size;return H[0]=cH.width,H[1]=cH.height,this.alpha=this.ALPHA*cH.worldAlpha,this.mmat=cH.worldMatrix4,this},n._ShaderWithCompile=function(){return JH.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,XH.create)},n._withWorldShaderDefines=function(){var H=cH.worldShaderDefines,n=JH.sharders[this.mainID|this.defines._value|H.getValue()];if(!n){var C,r={};for(C in this.defines.toNameDic())r[C]="";for(C in H.toNameDic())r[C]="";n=JH.withCompile2D(0,this.mainID,r,this.mainID|this.defines._value|H.getValue(),XH.create)}var N=cH.worldFilters;if(!N)return n;for(var Q,I=N.length,A=0;A<I;A++)(Q=N[A])&&Q.action.setValue(this);return n},n.upload=function(){var H=cH;this.alpha=this.ALPHA*H.worldAlpha,cH.worldMatrix4!==cH.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),N.ShieldColor&&!this.colorMul?this.colorMul=N.ShieldColor?M.create(N.ShieldColor)._color:null:!N.ShieldColor&&this.colorMul&&(this.colorMul=null),this.colorMul?this.defines.add(16384):this.defines.remove(16384),WH.shaderHighPrecision&&this.defines.add(1024);var n,C=H.worldShaderDefines?this._withWorldShaderDefines():JH.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=H.width,this.size[1]=H.height,this.mmat=H.worldMatrix4,pH.activeShader!==C?C._shaderValueWidth!==H.width||C._shaderValueHeight!==H.height?(C._shaderValueWidth=H.width,C._shaderValueHeight=H.height):n=C._params2dQuick2||C._make2dQuick2():C._shaderValueWidth!==H.width||C._shaderValueHeight!==H.height?(C._shaderValueWidth=H.width,C._shaderValueHeight=H.height):n=C._params2dQuick1||C._make2dQuick1(),C.upload(this,n)},n.setFilters=function(H){if(this.filters=H)for(var n,C=H.length,r=0;r<C;r++)(n=H[r])&&(this.defines.add(n.type),n.action.setValue(this))},n.clear=function(){this.defines.setValue(this.subID)},n.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},r._initone=function(H,n){r._typeClass[H]=n,r._cache[H]=[],r._cache[H]._length=0},r.__init__=function(){r._POSITION=[2,5126,!1,4*jH.BYTES_PE,0],r._TEXCOORD=[2,5126,!1,4*jH.BYTES_PE,2*jH.BYTES_PE],r._initone(2,UH),r._initone(4,xH),r._initone(256,sH),r._initone(512,_H),r._initone(1,$H),r._initone(65,uH),r._initone(9,$H)},r.create=function(H,n){var C=r._cache[H|n];return C._length?C[--C._length]:new r._typeClass[H|n](n)},r._POSITION=null,r._TEXCOORD=null,r._cache=[],r._typeClass=[],r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r}(),iH=function(H){function l(H,n){l.__super.call(this,H,n)}o(l,"laya.webgl.utils.RenderSprite3D",c);var n=l.prototype;return n.onCreate=function(H){switch(H){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},n._mask=function(H,n,C,r){var N,Q,I=this._next,A=H.mask;if(A){n.ctx.save();var P=n.ctx.globalCompositeOperation,t=new D;if(t.copyFrom(A.getBounds()),t.width=Math.round(t.width),t.height=Math.round(t.height),t.x=Math.round(t.x),t.y=Math.round(t.y),0<t.width&&0<t.height){var R=H._style._tf,y=AH.create();y.addValue("bounds",t),N=IH.create([y,n],laya.webgl.utils.RenderSprite3D.tmpTarget),n.addRenderObject(N),A.render(n,-t.x,-t.y),N=IH.create([y],laya.webgl.utils.RenderSprite3D.endTmpTarget),n.addRenderObject(N),n.ctx.save(),n.clipRect(C-R.translateX+t.x,r-R.translateY+t.y,t.width,t.height),I._fun.call(I,H,n,C,r),n.ctx.restore(),Q=RH.create(6),P=n.ctx.globalCompositeOperation,Q.blendMode="mask",n.addRenderObject(Q),i.TEMP.identity();var o=kH.create(1,0),g=q.INV_UV,M=t.width,j=t.height;(t.width<32||t.height<32)&&((g=l.tempUV)[0]=0,g[1]=0,g[2]=32<=t.width?1:t.width/32,g[3]=0,g[4]=32<=t.width?1:t.width/32,g[5]=32<=t.height?1:t.height/32,g[6]=0,g[7]=32<=t.height?1:t.height/32,t.width=32<=t.width?t.width:32,t.height=32<=t.height?t.height:32,g[1]*=-1,g[3]*=-1,g[5]*=-1,g[7]*=-1,g[1]+=1,g[3]+=1,g[5]+=1,g[7]+=1),n.ctx.drawTarget(y,C+t.x-R.translateX,r+t.y-R.translateY,M,j,i.TEMP,"tmpTarget",o,g,6),N=IH.create([y],laya.webgl.utils.RenderSprite3D.recycleTarget),n.addRenderObject(N),(Q=RH.create(6)).blendMode=P,n.addRenderObject(Q)}n.ctx.restore()}else I._fun.call(I,H,n,C,r)},n._blend=function(H,n,C,r){var N=H._style,Q=this._next;N.blendMode?(n.ctx.save(),n.ctx.globalCompositeOperation=N.blendMode,Q._fun.call(Q,H,n,C,r),n.ctx.restore()):Q._fun.call(Q,H,n,C,r)},n._transform=function(H,n,C,r){var N=H.transform,Q=this._next;if(N&&Q!=c.NORENDER){var I=n.ctx;H._style;N.tx=C,N.ty=r;var A=I._getTransformMatrix(),P=A.clone();i.mul(N,A,A),A._checkTransform(),N.tx=N.ty=0,Q._fun.call(Q,H,n,0,0),P.copyTo(A),P.destroy()}else Q._fun.call(Q,H,n,C,r)},l.tmpTarget=function(H,n){var C=H.getValue("bounds"),r=mH.create(C.width,C.height);r.start(),r.clear(0,0,0,0),H.addValue("tmpTarget",r)},l.endTmpTarget=function(H){H.getValue("tmpTarget").end()},l.recycleTarget=function(H){H.getValue("tmpTarget").recycle(),H.recycle()},I(l,["tempUV",function(){return this.tempUV=new Array(8)}]),l}(),aH=function(H){function n(){this.data=null,n.__super.call(this)}o(n,"laya.filters.webgl.ColorFilterActionGL",d);var C=n.prototype;return w.imps(C,{"laya.filters.IFilterActionGL":!0}),C.setValue=function(H){H.colorMat=this.data._mat,H.colorAlpha=this.data._alpha},C.apply3d=function(H,n,C,r,N){var Q=H.getValue("bounds"),I=kH.create(1,0);I.setFilters([this.data]);var A=i.TEMP;A.identity(),C.ctx.drawTarget(H,0,0,Q.width,Q.height,A,"src",I)},n}(),DH=function(H){function Q(H,n,C,r,N){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,Q.__super.call(this,H,n,N),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new OH,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=C,this._atlasCanvas.height=r,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}o(Q,"laya.webgl.atlas.Atlaser",U);var n=Q.prototype;return n.computeUVinAtlasTexture=function(H,n,C,r){var N=s.atlasTextureWidth,Q=s.atlasTextureHeight,I=C/N,A=r/Q,P=(C+H.bitmap.width)/N,t=(r+H.bitmap.height)/Q,R=H.bitmap.width/N,y=H.bitmap.height/Q;H.uv=[I+n[0]*R,A+n[1]*y,P-(1-n[2])*R,A+n[3]*y,P-(1-n[4])*R,t-(1-n[5])*y,I+n[6]*R,t-(1-n[7])*y]},n.findBitmapIsExist=function(H){if(H instanceof laya.webgl.resource.WebGLImage){var n=H,C=n.url,r=this._InAtlasWebGLImagesKey[C||n.id];if(r)return r.offsetInfoID}return-1},n.addToAtlasTexture=function(H,n,C){if(H instanceof laya.webgl.resource.WebGLImage){var r=H,N=r.url;this._InAtlasWebGLImagesKey[N||r.id]={bitmap:H,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([n,C])}this._atlasCanvas.texSubImage2D(n,C,H.atlasSource),H.clearAtlasSource()},n.addToAtlas=function(H,n,C){H._atlasID=this._inAtlasTextureKey.length;var r=H.uv.slice(),N=H.bitmap;this._inAtlasTextureKey.push(H),this._inAtlasTextureOriUVValue.push(r),this._inAtlasTextureBitmapValue.push(N),this.computeUVinAtlasTexture(H,r,n,C),H.bitmap=this._atlasCanvas},n.clear=function(){for(var H=0,n=this._inAtlasTextureKey.length;H<n;H++)this._inAtlasTextureKey[H].bitmap=this._inAtlasTextureBitmapValue[H],this._inAtlasTextureKey[H].uv=this._inAtlasTextureOriUVValue[H],this._inAtlasTextureKey[H]._atlasID=-1,this._inAtlasTextureKey[H].bitmap.lock=!1,this._inAtlasTextureKey[H].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},n.dispose=function(){this.clear(),this._atlasCanvas.destroy()},r(0,n,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),r(0,n,"texture",function(){return this._atlasCanvas}),r(0,n,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),Q}(),LH=function(H){function C(){C.__super.call(this,C.__name2int,C.__int2name,C.__int2nameMap)}return o(C,"laya.webgl.shader.d2.ShaderDefines2D",B),C.__init__=function(){C.reg("TEXTURE2D",1),C.reg("COLOR2D",2),C.reg("PRIMITIVE",4),C.reg("GLOW_FILTER",8),C.reg("BLUR_FILTER",16),C.reg("COLOR_FILTER",32),C.reg("COLOR_ADD",64),C.reg("WORLDMAT",128),C.reg("FILLTEXTURE",256),C.reg("FSHIGHPRECISION",1024),C.reg("TXTALPHA",2048),C.reg("TXTCOMPRESS",4096),C.reg("COLORMUL",16384)},C.reg=function(H,n){B._reg(H,n,C.__name2int,C.__int2name)},C.toText=function(H,n,C){return B._toText(H,n,C)},C.toInt=function(H){return B._toInt(H,C.__name2int)},C.TEXTURE2D=1,C.COLOR2D=2,C.PRIMITIVE=4,C.FILTERGLOW=8,C.FILTERBLUR=16,C.FILTERCOLOR=32,C.COLORADD=64,C.WORLDMAT=128,C.FILLTEXTURE=256,C.SKINMESH=512,C.SHADERDEFINE_FSHIGHPRECISION=1024,C.TXTALPHA=2048,C.TXTCOMPRESS=4096,C.COLORMUL=16384,C.__name2int={},C.__int2name=[],C.__int2nameMap=[],C}(),bH=(function(H){function A(H,n,C,r,N,Q,I){A.__super.call(this,H,n,C,r,40,N,Q,I)}o(A,"laya.webgl.shapes.Ellipse",CH)}(),function(H){function Q(H,n,C,r,N){this._points=[],this.rebuild(C),Q.__super.call(this,H,n,0,0,0,N,r,N,0)}o(Q,"laya.webgl.shapes.Line",CH);var n=Q.prototype;return n.rebuild=function(H){var n=H.length;n!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(n/2-1)),this.mFloat32Array=new Float32Array(5*n)),this._points.length=0;for(var C=NaN,r=NaN,N=-1,Q=-1,I=H.length/2,A=0;A<I;A++)C=H[2*A],r=H[2*A+1],(.01<Math.abs(N-C)||.01<Math.abs(Q-r))&&this._points.push(C,r),N=C,Q=r},n.getData=function(H,n,C){var r=[],N=[];0<this.borderWidth&&this.createLine2(this._points,r,this.borderWidth,C,N,this._points.length/2),this.mUint16Array.set(r,0),this.mFloat32Array.set(N,0),H.append(this.mUint16Array),n.append(this.mFloat32Array)},Q}()),hH=function(H){function y(H,n,C,r,N){this._points=[];for(var Q=NaN,I=NaN,A=-1,P=-1,t=C.length/2-1,R=0;R<t;R++)Q=C[2*R],I=C[2*R+1],(.01<Math.abs(A-Q)||.01<Math.abs(P-I))&&this._points.push(Q,I),A=Q,P=I;Q=C[2*t],I=C[2*t+1],A=this._points[0],P=this._points[1],(.01<Math.abs(A-Q)||.01<Math.abs(P-I))&&this._points.push(Q,I),y.__super.call(this,H,n,0,0,this._points.length/2,0,r,N)}o(y,"laya.webgl.shapes.LoopLine",CH);var n=y.prototype;return n.getData=function(H,n,C){if(0<this.borderWidth){for(var r=this.color,N=(r>>16&255)/255,Q=(r>>8&255)/255,I=(255&r)/255,A=[],P=0,t=0,R=[],y=Math.floor(this._points.length/2),o=0;o<y;o++)P=this._points[2*o],t=this._points[2*o+1],A.push(this.x+P,this.y+t,N,Q,I);this.createLoopLine(A,R,this.borderWidth,C+A.length/5),H.append(new Uint16Array(R)),n.append(new Float32Array(A))}},n.createLoopLine=function(H,n,C,r,N,Q){H.length;var I=H.concat(),A=N||H,P=this.borderColor,t=(P>>16&255)/255,R=(P>>8&255)/255,y=(255&P)/255,o=[I[0],I[1]],g=[I[I.length-5],I[I.length-4]],M=g[0]+.5*(o[0]-g[0]),j=g[1]+.5*(o[1]-g[1]);I.unshift(M,j,0,0,0),I.push(M,j,0,0,0);var l,f,c,K,W,z,w,F,k,i,a,D,L,b,h,v,e,Z,q,p,m=I.length/5,d=r,_=C/2;c=I[0],K=I[1],i=c-(W=I[5]),k=(k=-(K-(z=I[6])))/(p=Math.sqrt(k*k+i*i))*_,i=i/p*_,A.push(c-k,K-i,t,R,y,c+k,K+i,t,R,y);for(var U=1;U<m-1;U++)c=I[5*(U-1)],K=I[5*(U-1)+1],W=I[5*U],z=I[5*U+1],w=I[5*(U+1)],F=I[5*(U+1)+1],i=c-W,D=W-w,h=(-(k=(k=-(K-z))/(p=Math.sqrt(k*k+i*i))*_)+c)*(-(i=i/p*_)+z)-(-k+W)*(-i+K),Z=(-(a=(a=-(z-F))/(p=Math.sqrt(a*a+D*D))*_)+w)*(-(D=D/p*_)+z)-(-a+W)*(-D+F),q=(L=-i+K-(-i+z))*(e=-a+W-(-a+w))-(v=-D+F-(-D+z))*(b=-k+W-(-k+c)),Math.abs(q)<.1?(q+=10.1,A.push(W-k,z-i,t,R,y,W+k,z+i,t,R,y)):(((l=(b*Z-e*h)/q)-W)*(l-W)+((f=(v*h-L*Z)/q)-z)+(f-z),A.push(l,f,t,R,y,W-(l-W),z-(f-z),t,R,y));Q&&(n=Q);var s=this.edges+1;for(U=1;U<s;U++)n.push(d+2*(U-1),d+2*(U-1)+1,d+2*U+1,d+2*U+1,d+2*U,d+2*(U-1));return n.push(d+2*(U-1),d+2*(U-1)+1,d+1,d+1,d,d+2*(U-1)),A},y}(),vH=function(H){function I(H,n,C,r,N,Q){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=i.create(),this._points=C.slice(0,C.length),I.__super.call(this,H,n,0,0,this._points.length/2,r,N,Q)}o(I,"laya.webgl.shapes.Polygon",CH);var n=I.prototype;return n.rebuild=function(H){this._repaint||(this._points.length=0,this._points=this._points.concat(H))},n.setMatrix=function(H){H.copyTo(this._mat)},n.needUpdate=function(H){return this._repaint=this._mat.a==H.a&&this._mat.b==H.b&&this._mat.c==H.c&&this._mat.d==H.d&&this._mat.tx==H.tx&&this._mat.ty==H.ty,!this._repaint},n.getData=function(H,n,C){var r,N=0,Q=this._points,I=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=C){for(this._start=C,r=[],I=this.earcutTriangles.length,N=0;N<I;N++)r.push(this.earcutTriangles[N]+C);this.mUint16Array=new Uint16Array(r)}}else{this._start=C,r=[];var A=[],P=[],t=this.color,R=(t>>16&255)/255,y=(t>>8&255)/255,o=(255&t)/255;for(I=Math.floor(Q.length/2),N=0;N<I;N++)A.push(this.x+Q[2*N],this.y+Q[2*N+1],R,y,o),P.push(this.x+Q[2*N],this.y+Q[2*N+1]);for(this.earcutTriangles=rH.earcut(P,null,2),I=this.earcutTriangles.length,N=0;N<I;N++)r.push(this.earcutTriangles[N]+C);this.mUint16Array=new Uint16Array(r),this.mFloat32Array=new Float32Array(A)}H.append(this.mUint16Array),n.append(this.mFloat32Array)},I}(),eH=function(H){function Q(){this._matrix=new i,this._matrix4=jH.defaultMatrix4.concat(),Q.__super.call(this,1e4),this.shaderValue=new kH(0,0)}o(Q,"laya.webgl.submit.SubmitCanvas",QH);var n=Q.prototype;return n.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var H=cH.worldAlpha,n=cH.worldMatrix4,C=cH.worldMatrix,r=cH.worldFilters,N=cH.worldShaderDefines,Q=this.shaderValue,I=this._matrix,A=this._matrix4,P=i.TEMP;return i.mul(I,C,P),A[0]=P.a,A[1]=P.b,A[4]=P.c,A[5]=P.d,A[12]=P.tx,A[13]=P.ty,cH.worldMatrix=P.clone(),cH.worldMatrix4=A,cH.worldAlpha=cH.worldAlpha*Q.alpha,Q.filters&&Q.filters.length&&(cH.worldFilters=Q.filters,cH.worldShaderDefines=Q.defines),this._ctx_src.flush(),cH.worldAlpha=H,cH.worldMatrix4=n,cH.worldMatrix.destroy(),cH.worldMatrix=C,cH.worldFilters=r,cH.worldShaderDefines=N,1},n.releaseRender=function(){var H=Q._cache;this._ctx_src=null,H[H._length++]=this},n.getRenderType=function(){return 10003},Q.create=function(H,n,C){var r=Q._cache._length?Q._cache[--Q._cache._length]:new Q;r._ctx_src=H;var N=r.shaderValue;return N.alpha=n,N.defines.setValue(0),C&&C.length&&N.setFilters(C),r},Q._cache=((Q._cache=[])._length=0,Q._cache),Q}(),ZH=function(H){function t(H){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===H&&(H=1e4),t.__super.call(this,H)}o(t,"laya.webgl.submit.SubmitTexture",QH);var n=t.prototype;return n.releaseRender=function(){var H=t._cache;(H[H._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},n.addTexture=function(H,n){this._texsID[this._texs.length]=H._uvID,this._texs.push(H),this._vbPos.push(n)},n.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var H=this.shaderValue.textureHost.bitmap;if(null!==H)for(var n=this._vb.getFloat32Array(),C=0,r=this._texs.length;C<r;C++){var N=this._texs[C];N.active();var Q=N.uv;if(this._texsID[C]!==N._uvID){this._texsID[C]=N._uvID;var I=this._vbPos[C];n[I+2]=Q[0],n[I+3]=Q[1],n[I+6]=Q[2],n[I+7]=Q[3],n[I+10]=Q[4],n[I+11]=Q[5],n[I+14]=Q[6],n[I+15]=Q[7],this._vb.setNeedUpload()}N.bitmap!==H&&(this._isSameTexture=!1)}}},n.renderSubmit=function(){if(0===this._numEle)return t._shaderSet=!1,1;var H=this.shaderValue.textureHost;if(H){var n=H.source;if(!H.bitmap||!n)return t._shaderSet=!1,1;this.shaderValue.texture=n,H.alphaTexture&&H.alphaTexture.source&&(this.shaderValue.texture1=H.alphaTexture.source)}this._vb.bind_upload(this._ib);var C=WH.mainContext;if(x.activeBlendFunction!==this._blendFn&&(C.enable(3042),this._blendFn(C),x.activeBlendFunction=this._blendFn),h.drawCall++,h.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&pH.activeShader&&t._shaderSet?(pH.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&pH.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),t._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var r=H.bitmap,N=0,Q=pH.activeShader,I=0,A=this._texs.length;I<A;I++){var P=this._texs[I];P.bitmap===r&&I+1!==A||(Q.uploadTexture2D(P.source),C.drawElements(4,6*(I-N+1),5123,this._startIdx+6*N*jH.BYTES_PIDX),r=P.bitmap,N=I)}else C.drawElements(4,this._numEle,5123,this._startIdx);return 1},t.create=function(H,n,C,r,N){var Q=t._cache._length?t._cache[--t._cache._length]:new t;null==C&&((C=Q._selfVb||(Q._selfVb=BH.create(-1))).clear(),r=0),Q._ib=n,Q._vb=C,Q._startIdx=r*jH.BYTES_PIDX,Q._numEle=0;var I=H._nBlendType;Q._blendFn=H._targets?x.targetFns[I]:x.fns[I],Q.shaderValue=N,Q.shaderValue.setValue(H._shader2D);var A=H._shader2D.filters;return A&&Q.shaderValue.setFilters(A),Q},t._cache=((t._cache=[])._length=0,t._cache),t._shaderSet=!0,t}(),qH=function(H){function f(){f.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}o(f,"laya.webgl.utils.MeshTexture",fH);var n=f.prototype;return n.addData=function(H,n,C,r,N,Q){for(var I=H.length/2,A=this._vb.needSize(I*f.const_stride)>>2,P=this._vb.getFloat32Array(),t=0,R=0;R<I;R++){var y=H[t],o=H[t+1],g=y*r.a+o*r.c+r.tx,M=y*r.b+o*r.d+r.ty;P[A++]=g,P[A++]=M,P[A++]=n[t],P[A++]=n[t+1],t+=2}this._vb.setNeedUpload();var j=this.vertNum;if(0<j){(I=C.length)>f.tmpIdx.length&&(f.tmpIdx=new Uint16Array(I));for(var l=0;l<I;l++)f.tmpIdx[l]=C[l]+j;this._ib.appendU16Array(f.tmpIdx,C.length)}else this._ib.append(C);this._ib.setNeedUpload(),this.vertNum+=I,this.indexNum+=C.length},n.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},n.destroy=function(){this._ib.destroy(),this._vb.destroy()},f.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new f},f.const_stride=16,f._POOL=[],I(f,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),f}(),pH=function(H){function n(){n.__super.call(this),this.lock=!0}return o(n,"laya.webgl.shader.BaseShader",K),n.activeShader=null,n.bindShader=null,n}(),mH=function(n){function R(H,n,C,r,N,Q,I,A,P){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===C&&(C=6408),void 0===r&&(r=5121),void 0===N&&(N=34041),void 0===Q&&(Q=!1),void 0===I&&(I=!1),void 0===A&&(A=-1),void 0===P&&(P=-1),this._type=1,this._w=H,this._h=n,this._surfaceFormat=C,this._surfaceType=r,this._depthStencilFormat=N,f.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=Q,this._repeat=I,this._minFifter=A,this._magFifter=P,this._createWebGLRenderTarget(),this.bitmap.lock=!0,R.__super.call(this,this.bitmap,q.INV_UV)}o(R,"laya.webgl.resource.RenderTarget2D",n);var H=R.prototype;return w.imps(H,{"laya.resource.IDispose":!0}),H.getType=function(){return this._type},H.getTexture=function(){return this},H.size=function(H,n){this._w==H&&this._h==n||(this._w=H,this._h=n,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},H.release=function(){this.destroy()},H.recycle=function(){R.POOL.push(this)},H.start=function(){var H=WH.mainContext;return this._preRenderTarget=cH.curRenderTarget,cH.curRenderTarget=this,H.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(H.viewport(0,0,this._w,this._h),this._svWidth=cH.width,this._svHeight=cH.height,cH.width=this._w,cH.height=this._h,pH.activeShader=null),this},H.clear=function(H,n,C,r){void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=1);var N=WH.mainContext;N.clearColor(H,n,C,r);var Q=16384;switch(this._depthStencilFormat){case 33189:Q|=256;break;case 36168:Q|=1024;break;case 34041:Q|=256,Q|=1024}N.clear(Q)},H.end=function(){var H=WH.mainContext;H.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,cH.curRenderTarget=this._preRenderTarget,1==this._type?(H.viewport(0,0,this._svWidth,this._svHeight),cH.width=this._svWidth,cH.height=this._svHeight,pH.activeShader=null):H.viewport(0,0,w.stage.width,w.stage.height)},H.getData=function(H,n,C,r){var N=WH.mainContext;if(N.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===N.checkFramebufferStatus(36160)))return N.bindFramebuffer(36160,null),null;var Q=new Uint8Array(this._w*this._h*4);return N.readPixels(H,n,C,r,this._surfaceFormat,this._surfaceType,Q),N.bindFramebuffer(36160,null),Q},H.destroy=function(H){void 0===H&&(H=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,n.prototype.destroy.call(this))},H.dispose=function(){},H._createWebGLRenderTarget=function(){this.bitmap=new EH(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(H){this.event("recovered")})},r(0,H,"surfaceFormat",function(){return this._surfaceFormat}),r(0,H,"magFifter",function(){return this._magFifter}),r(0,H,"surfaceType",function(){return this._surfaceType}),r(0,H,"mipMap",function(){return this._mipMap}),r(0,H,"depthStencilFormat",function(){return this._depthStencilFormat}),r(0,H,"minFifter",function(){return this._minFifter}),r(0,H,"source",function(){return this._alreadyResolved?w.superGet(q,this,"source"):null}),R.create=function(H,n,C,r,N,Q,I,A,P){void 0===C&&(C=6408),void 0===r&&(r=5121),void 0===N&&(N=34041),void 0===Q&&(Q=!1),void 0===I&&(I=!1),void 0===A&&(A=-1),void 0===P&&(P=-1);var t=R.POOL.pop();return t||(t=new R(H,n)),t.bitmap&&t._w==H&&t._h==n&&t._surfaceFormat==C&&t._surfaceType==r&&t._depthStencilFormat==N&&t._mipMap==Q&&t._repeat==I&&t._minFifter==A&&t._magFifter==P||(t._w=H,t._h=n,t._surfaceFormat=C,t._surfaceType=r,t._depthStencilFormat=N,f.isConchWebGL&&34041===t._depthStencilFormat&&(t._depthStencilFormat=33189),t._mipMap=Q,t._repeat=I,t._minFifter=A,t._magFifter=P,t.release(),t._createWebGLRenderTarget()),t},R.TYPE2D=1,R.TYPE3D=2,R.POOL=[],R}(q),dH=function(H){function n(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,n.__super.call(this),n._gl=WH.mainContext}o(n,"laya.webgl.utils.Buffer",K);var C=n.prototype;return C._bind=function(){this.activeResource(),n._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(n._bindVertexBuffer=this._glBuffer),n._gl.bindBuffer(this._bufferType,n._bindActive[this._bufferType]=this._glBuffer),pH.activeShader=null)},C.recreateResource=function(){this._glBuffer||(this._glBuffer=n._gl.createBuffer()),this.completeCreate()},C.disposeResource=function(){this._glBuffer&&(WH.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},r(0,C,"bufferUsage",function(){return this._bufferUsage}),n._gl=null,n._bindActive={},n._bindVertexBuffer=null,n._enableAtributes=[],n}(),_H=function(H){function C(H){this.texcoord=null,this.offsetX=300,this.offsetY=0,C.__super.call(this,512,0);var n=8*jH.BYTES_PE;this.position=[2,5126,!1,n,0],this.texcoord=[2,5126,!1,n,2*jH.BYTES_PE],this.color=[4,5126,!1,n,4*jH.BYTES_PE]}return o(C,"laya.webgl.shader.d2.skinAnishader.SkinSV",kH),C}(),UH=function(H){function n(H){n.__super.call(this,2,0),this.color=[]}return o(n,"laya.webgl.shader.d2.value.Color2dSV",kH),n.prototype.setValue=function(H){H.fillStyle&&(this.color=H.fillStyle._color._color),H.strokeStyle&&(this.color=H.strokeStyle._color._color)},n}(),sH=function(H){function n(H){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=kH._TEXCOORD,n.__super.call(this,256,0)}o(n,"laya.webgl.shader.d2.value.FillTextureSV",kH);var C=n.prototype;return C.setValue=function(H){this.ALPHA=H.ALPHA,H.filters&&this.setFilters(H.filters)},C.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},n}(),$H=function(H){function n(H){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=kH._TEXCOORD,void 0===H&&(H=0),n.__super.call(this,1,H)}o(n,"laya.webgl.shader.d2.value.TextureSV",kH);var C=n.prototype;return C.setValue=function(H){this.ALPHA=H.ALPHA,H.filters&&this.setFilters(H.filters)},C.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},n}(),xH=function(H){function n(H){this.a_color=null,this.u_pos=[0,0],n.__super.call(this,4,0),this.position=[2,5126,!1,5*jH.BYTES_PE,0],this.a_color=[3,5126,!1,5*jH.BYTES_PE,2*jH.BYTES_PE]}return o(n,"laya.webgl.shader.d2.value.PrimitiveSV",kH),n}(),OH=function(H){function n(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,n.__super.call(this)}o(n,"laya.webgl.atlas.AtlasWebGLCanvas",H);var C=n.prototype;return C.recreateResource=function(){var H=WH.mainContext,n=this._source=H.createTexture(),C=zH.curBindTexTarget,r=zH.curBindTexValue;zH.bindTexture(H,3553,n),H.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),H.texParameteri(3553,10241,9729),H.texParameteri(3553,10240,9729),H.texParameteri(3553,10242,33071),H.texParameteri(3553,10243,33071),C&&r&&zH.bindTexture(H,C,r),this.memorySize=this._w*this._h*4,this.completeCreate()},C.disposeResource=function(){this._source&&(WH.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},C.texSubImage2D=function(H,n,C){if(f.isFlash){this._flashCacheImage||(this._flashCacheImage=l.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var r=C.bitmapdata;this._flashCacheImage._image.copyPixels(r,0,0,r.width,r.height,H,n),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var N=WH.mainContext,Q=zH.curBindTexTarget,I=zH.curBindTexValue;zH.bindTexture(N,3553,this._source),N.pixelStorei(37441,!0),0<=H-1&&N.texSubImage2D(3553,0,H-1,n,6408,5121,C),H+1<=this._w&&N.texSubImage2D(3553,0,H+1,n,6408,5121,C),0<=n-1&&N.texSubImage2D(3553,0,H,n-1,6408,5121,C),n+1<=this._h&&N.texSubImage2D(3553,0,H,n+1,6408,5121,C),N.texSubImage2D(3553,0,H,n,6408,5121,C),N.pixelStorei(37441,!1),Q&&I&&zH.bindTexture(N,Q,I)}},C.texSubImage2DPixel=function(H,n,C,r,N){var Q=WH.mainContext,I=zH.curBindTexTarget,A=zH.curBindTexValue;zH.bindTexture(Q,3553,this._source);var P=new Uint8Array(N.data);Q.pixelStorei(37441,!0),Q.texSubImage2D(3553,0,H,n,C,r,6408,5121,P),Q.pixelStorei(37441,!1),I&&A&&zH.bindTexture(Q,I,A)},r(0,C,"width",H.prototype._$get_width,function(H){this._w=H}),r(0,C,"height",H.prototype._$get_height,function(H){this._h=H}),n}(C),SH=function(H){function N(){this.flipY=!0,this.alwaysChange=!1,N.__super.call(this)}o(N,"laya.webgl.resource.WebGLCanvas",C);var n=N.prototype;return n.getCanvas=function(){return this._canvas},n.clear=function(){this._ctx&&this._ctx.clear()},n.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},n._setContext=function(H){this._ctx=H},n.getContext=function(H,n){return this._ctx?this._ctx:this._ctx=N._createContext(this)},n.size=function(H,n){this._w==H&&this._h==n||(this._w=H,this._h=n,this._ctx&&this._ctx.size(H,n),this._canvas&&(this._canvas.height=n,this._canvas.width=H))},n.activeResource=function(H){void 0===H&&(H=!1),this._source||this.recreateResource()},n.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},n.disposeResource=function(){this._source&&!this.iscpuSource&&(WH.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n.createWebGlTexture=function(){var H=WH.mainContext;this._canvas;var n=this._source=H.createTexture();this.iscpuSource=!1;var C=zH.curBindTexTarget,r=zH.curBindTexValue;zH.bindTexture(H,3553,n),H.pixelStorei(37440,this.flipY?1:0),N.premulAlpha&&H.pixelStorei(37441,!0),H.texImage2D(3553,0,6408,6408,5121,this._imgData),N.premulAlpha&&H.pixelStorei(37441,!1),H.texParameteri(3553,10240,9729),H.texParameteri(3553,10241,9729),H.texParameteri(3553,10242,33071),H.texParameteri(3553,10243,33071),H.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,C&&r&&zH.bindTexture(H,C,r)},n.reloadCanvasData=function(){var H=WH.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var n=zH.curBindTexTarget,C=zH.curBindTexValue;zH.bindTexture(H,3553,this._source),N.premulAlpha&&H.pixelStorei(37441,!0),H.texImage2D(3553,0,6408,6408,5121,this._imgData),N.premulAlpha&&H.pixelStorei(37441,!1),H.pixelStorei(37440,0),n&&C&&zH.bindTexture(H,n,C)},n.texSubImage2D=function(H,n,C){var r=WH.mainContext,N=zH.curBindTexTarget,Q=zH.curBindTexValue;zH.bindTexture(r,3553,this._source),r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,n,C,6408,5121,H._source),r.pixelStorei(37441,!1),N&&Q&&zH.bindTexture(r,N,Q)},n.toBase64=function(H,n,C){var r=null;this._canvas&&(r=this._canvas.toDataURL(H,n)),C.call(this,r)},r(0,n,"context",function(){return this._ctx}),r(0,n,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),r(0,n,"asBitmap",null,function(H){this._ctx&&(this._ctx.asBitmap=H)}),N._createContext=null,N.premulAlpha=!1,N}(),TH=function(H){function Q(H,n){this.CborderSize=12,Q.__super.call(this),this.char=H,this.isSpace=" "===H,this.xs=n.scaleX,this.ys=n.scaleY,this.font=n.font.toString(),this.fontSize=n.font.size,this.fillColor=n.fillColor,this.borderColor=n.borderColor,this.lineWidth=n.lineWidth,this.underLine=n.underLine;var C,r=f.isConchApp;r?((C=ConchTextCanvas)._source=ConchTextCanvas,C._source.canvas=ConchTextCanvas):C=g.canvas.source,this.canvas=C,this._enableMerageInAtlas=!0,this._ctx=r?C:this.canvas.getContext("2d",void 0);var N=p.measureText(this.char,this.font);this.cw=N.width*this.xs,this.ch=(N.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new q(this)}o(Q,"laya.webgl.resource.WebGLCharImage",C);var n=Q.prototype;return w.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n.active=function(){this.texture.active()},n.recreateResource=function(){var H=f.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),H){var n=this.fontSize;1==this.xs&&1==this.ys||(n=parseInt(n*(this.xs>this.ys?this.xs:this.ys)+""));var C="normal 100 "+this.font;C=C.replace(Q._fontSizeReg,n),this.borderColor&&(C+=" 1 "+this.borderColor),this._ctx.font=C,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,Z.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var r=this._ctx.measureText(this.char);r||(r={width:16});var N=r.width+1;this._ctx.lineTo(N,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},n.onresize=function(H,n){this._w=H,this._h=n,this._allowMerageInAtlas=!0},n.clearAtlasSource=function(){},r(0,n,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),r(0,n,"atlasSource",function(){return this.canvas}),r(0,n,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(H){this._enableMerageInAtlas=H}),Q.createOneChar=function(H,n){return new Q(H,n)},Q._fontSizeReg=new RegExp("\\d+(?=px)","g"),Q}(),EH=function(H){function t(H,n,C,r,N,Q,I,A,P){void 0===C&&(C=6408),void 0===r&&(r=5121),void 0===N&&(N=34041),void 0===Q&&(Q=!1),void 0===I&&(I=!1),void 0===A&&(A=-1),void 0===P&&(P=1),t.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=H,this._h=n,this._surfaceFormat=C,this._surfaceType=r,this._depthStencilFormat=N,this._mipMap=Q,this._repeat=I,this._minFifter=A,this._magFifter=P}o(t,"laya.webgl.resource.WebGLRenderTarget",C);var n=t.prototype;return n.recreateResource=function(){var H=WH.mainContext;this._frameBuffer||(this._frameBuffer=H.createFramebuffer()),this._source||(this._source=H.createTexture());var n=zH.curBindTexTarget,C=zH.curBindTexValue;zH.bindTexture(H,3553,this._source),H.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var r=this._minFifter,N=this._magFifter,Q=this._repeat?10497:33071,I=R.isPOT(this._w,this._h);if(I?(this._mipMap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==N||(N=9729),H.texParameteri(3553,10241,r),H.texParameteri(3553,10240,N),H.texParameteri(3553,10242,Q),H.texParameteri(3553,10243,Q),this._mipMap&&H.generateMipmap(3553)):(-1!==r||(r=9729),-1!==N||(N=9729),H.texParameteri(3553,10241,r),H.texParameteri(3553,10240,N),H.texParameteri(3553,10242,33071),H.texParameteri(3553,10243,33071)),H.bindFramebuffer(36160,this._frameBuffer),H.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=H.createRenderbuffer()),H.bindRenderbuffer(36161,this._depthStencilBuffer),H.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:H.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:H.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:H.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}H.bindFramebuffer(36160,null),n&&C&&zH.bindTexture(H,n,C),H.bindRenderbuffer(36161,null),I&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},n.disposeResource=function(){this._frameBuffer&&(WH.mainContext.deleteTexture(this._source),WH.mainContext.deleteFramebuffer(this._frameBuffer),WH.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},r(0,n,"depthStencilBuffer",function(){return this._depthStencilBuffer}),r(0,n,"frameBuffer",function(){return this._frameBuffer}),t}(),GH=function(H){function A(H,n,C,r,N,Q,I){this.offsetX=0,this.offsetY=0,A.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=Q,this.canvas=H,this._ctx=H.getContext("2d",void 0),this._w=r,this._h=N,this.offsetX=n,this.offsetY=C,this.src=I,this._enableMerageInAtlas=!0,s.enabled&&this._w<s.atlasLimitWidth&&this._h<s.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}o(A,"laya.webgl.resource.WebGLSubImage",C);var n=A.prototype;return w.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n.size=function(H,n){this._w=H,this._h=n,this._ctx&&this._ctx.size(H,n),this.canvas&&(this.canvas.height=n,this.canvas.width=H)},n.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},n.createWebGlTexture=function(){var H=WH.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var n=this._source=H.createTexture(),C=zH.curBindTexTarget,r=zH.curBindTexValue;zH.bindTexture(H,3553,n),H.pixelStorei(37441,!0),H.texImage2D(3553,0,6408,6408,5121,this.canvas),H.pixelStorei(37441,!1);var N=this.minFifter,Q=this.magFifter,I=this.repeat?10497:33071,A=R.isPOT(this.width,this.height);A?(this.mipmap?-1!==N||(N=9987):-1!==N||(N=9729),-1!==Q||(Q=9729),H.texParameteri(3553,10240,Q),H.texParameteri(3553,10241,N),H.texParameteri(3553,10242,I),H.texParameteri(3553,10243,I),this.mipmap&&H.generateMipmap(3553)):(-1!==N||(N=9729),-1!==Q||(Q=9729),H.texParameteri(3553,10241,N),H.texParameteri(3553,10240,Q),H.texParameteri(3553,10242,33071),H.texParameteri(3553,10243,33071)),C&&r&&zH.bindTexture(H,C,r),this.canvas=null,A&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},n.disposeResource=function(){s.enabled&&this._allowMerageInAtlas||!this._source||(WH.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n.clearAtlasSource=function(){},r(0,n,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),r(0,n,"atlasSource",function(){return this.canvas}),r(0,n,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(H){this._allowMerageInAtlas=H}),A}(),JH=function(H){function t(H,n,C,r){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,t.__super.call(this),!H||!n)throw"Shader Error";this._id=++t._count,this._vs=H,this._ps=n,this._nameMap=r||{},null!=C&&(t.sharders[C]=this)}o(t,"laya.webgl.shader.Shader",pH);var n=t.prototype;return n.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},n.disposeResource=function(){WH.mainContext.deleteShader(this._vshader),WH.mainContext.deleteShader(this._pshader),WH.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},n._compile=function(){if(!WH.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var H=[this._vs,this._ps],n=WH.mainContext;if(this._program=n.createProgram(),this._vshader=t._createShader(n,H[0],35633),this._pshader=t._createShader(n,H[1],35632),n.attachShader(this._program,this._vshader),n.attachShader(this._program,this._pshader),n.linkProgram(this._program),!f.isConchApp&&!n.getProgramParameter(this._program,35714))throw n.getProgramInfoLog(this._program);var C,r,N=0,Q=0;for(Q=f.isConchApp?n.getProgramParameterEx(this._vs,this._ps,"",35721):n.getProgramParameter(this._program,35721),N=0;N<Q;N++){var I=null;C={vartype:"attribute",glfun:null,ivartype:0,attrib:I=f.isConchApp?n.getActiveAttribEx(this._vs,this._ps,"",N):n.getActiveAttrib(this._program,N),location:n.getAttribLocation(this._program,I.name),name:I.name,type:I.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(C)}var A=0;for(A=f.isConchApp?n.getProgramParameterEx(this._vs,this._ps,"",35718):n.getProgramParameter(this._program,35718),N=0;N<A;N++){var P=null;P=f.isConchApp?n.getActiveUniformEx(this._vs,this._ps,"",N):n.getActiveUniform(this._program,N),0<(C={vartype:"uniform",glfun:null,ivartype:1,attrib:I,location:n.getUniformLocation(this._program,P.name),name:P.name,type:P.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(C.name=C.name.substr(0,C.name.length-3),C.isArray=!0,C.location=n.getUniformLocation(this._program,C.name)),this._params.push(C)}for(N=0,r=this._params.length;N<r;N++)if((C=this._params[N]).indexOfParams=N,C.index=1,C.value=[C.location,null],C.codename=C.name,C.name=this._nameMap[C.codename]?this._nameMap[C.codename]:C.codename,(this._paramsMap[C.name]=C)._this=this,C.uploadedValue=[],"attribute"!==C.vartype)switch(C.type){case 5124:C.fun=C.isArray?this._uniform1iv:this._uniform1i;break;case 5126:C.fun=C.isArray?this._uniform1fv:this._uniform1f;break;case 35664:C.fun=C.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:C.fun=C.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:C.fun=C.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:C.fun=this._uniform_sampler2D;break;case 35680:C.fun=this._uniform_samplerCube;break;case 35676:C.glfun=n.uniformMatrix4fv,C.fun=this._uniformMatrix4fv;break;case 35670:C.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else C.fun=this._attribute}},n.getUniform=function(H){return this._paramsMap[H]},n._attribute=function(H,n){var C=WH.mainContext,r=dH._enableAtributes,N=H.location;return r[N]||C.enableVertexAttribArray(N),C.vertexAttribPointer(N,n[0],n[1],n[2],n[3],n[4]+this._offset),r[N]=dH._bindVertexBuffer,1},n._uniform1f=function(H,n){var C=H.uploadedValue;return C[0]!==n?(WH.mainContext.uniform1f(H.location,C[0]=n),1):0},n._uniform1fv=function(H,n){if(n.length<4){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(WH.mainContext.uniform1fv(H.location,n),C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3],1):0}return WH.mainContext.uniform1fv(H.location,n),1},n._uniform_vec2=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]?(WH.mainContext.uniform2f(H.location,C[0]=n[0],C[1]=n[1]),1):0},n._uniform_vec2v=function(H,n){if(n.length<2){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(WH.mainContext.uniform2fv(H.location,n),C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3],1):0}return WH.mainContext.uniform2fv(H.location,n),1},n._uniform_vec3=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]?(WH.mainContext.uniform3f(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2]),1):0},n._uniform_vec3v=function(H,n){return WH.mainContext.uniform3fv(H.location,n),1},n._uniform_vec4=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(WH.mainContext.uniform4f(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3]),1):0},n._uniform_vec4v=function(H,n){return WH.mainContext.uniform4fv(H.location,n),1},n._uniformMatrix2fv=function(H,n){return WH.mainContext.uniformMatrix2fv(H.location,!1,n),1},n._uniformMatrix3fv=function(H,n){return WH.mainContext.uniformMatrix3fv(H.location,!1,n),1},n._uniformMatrix4fv=function(H,n){return WH.mainContext.uniformMatrix4fv(H.location,!1,n),1},n._uniform1i=function(H,n){var C=H.uploadedValue;return C[0]!==n?(WH.mainContext.uniform1i(H.location,C[0]=n),1):0},n._uniform1iv=function(H,n){return WH.mainContext.uniform1iv(H.location,n),1},n._uniform_ivec2=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]?(WH.mainContext.uniform2i(H.location,C[0]=n[0],C[1]=n[1]),1):0},n._uniform_ivec2v=function(H,n){return WH.mainContext.uniform2iv(H.location,n),1},n._uniform_vec3i=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]?(WH.mainContext.uniform3i(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2]),1):0},n._uniform_vec3vi=function(H,n){return WH.mainContext.uniform3iv(H.location,n),1},n._uniform_vec4i=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(WH.mainContext.uniform4i(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3]),1):0},n._uniform_vec4vi=function(H,n){return WH.mainContext.uniform4iv(H.location,n),1},n._uniform_sampler2D=function(H,n){var C=WH.mainContext,r=H.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,C.uniform1i(H.location,this._curActTexIndex),C.activeTexture(t._TEXTURES[this._curActTexIndex]),zH.bindTexture(C,3553,n),this._curActTexIndex++,1):(C.activeTexture(t._TEXTURES[r[0]]),zH.bindTexture(C,3553,n),0)},n._uniform_samplerCube=function(H,n){var C=WH.mainContext,r=H.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,C.uniform1i(H.location,this._curActTexIndex),C.activeTexture(t._TEXTURES[this._curActTexIndex]),zH.bindTexture(C,34067,n),this._curActTexIndex++,1):(C.activeTexture(t._TEXTURES[r[0]]),zH.bindTexture(C,34067,n),0)},n._noSetValue=function(H){console.log("no....:"+H.name)},n.uploadOne=function(H,n){this.activeResource(),zH.UseProgram(this._program);var C=this._paramsMap[H];C.fun.call(this,C,n)},n.uploadTexture2D=function(H){h.shaderCall++;var n=WH.mainContext;n.activeTexture(33984),zH.bindTexture(n,3553,H)},n.uploadTexture2D1=function(H){h.shaderCall++;var n=WH.mainContext;n.activeTexture(33985),zH.bindTexture(n,3553,H)},n.upload=function(H,n){pH.activeShader=pH.bindShader=this,this._lastUseFrameCount===h.loopCount||this.activeResource(),zH.UseProgram(this._program),this._reCompile?(n=this._params,this._reCompile=!1):n=n||this._params;WH.mainContext;for(var C,r,N=n.length,Q=0,I=0;I<N;I++)null!==(r=H[(C=n[I]).name])&&(Q+=C.fun.call(this,C,r));h.shaderCall+=Q},n.uploadArray=function(H,n,C){pH.activeShader=this,(pH.bindShader=this).activeResource(),zH.UseProgram(this._program);this._params;for(var r,N,Q=0,I=n-2;0<=I;I-=2)(N=this._paramsMap[H[I]])&&null!=(r=H[I+1])&&(C&&C[N.name]&&C[N.name].bind(),Q+=N.fun.call(this,N,r));h.shaderCall+=Q},n.getParams=function(){return this._params},t.getShader=function(H){return t.sharders[H]},t.create=function(H,n,C,r){return new t(H,n,C,r)},t.withCompile=function(H,n,C,r){if(C&&t.sharders[C])return t.sharders[C];var N=t._preCompileShader[2e-4*H];if(!N)throw new Error("withCompile shader err!"+H);return N.createShader(n,C,r)},t.withCompile2D=function(H,n,C,r,N){if(r&&t.sharders[r])return t.sharders[r];var Q=t._preCompileShader[2e-4*H+n];if(!Q)throw new Error("withCompile shader err!"+H+" "+n);return Q.createShader(C,r,N)},t.addInclude=function(H,n){KH.addInclude(H,n)},t.preCompile=function(H,n,C,r){var N=2e-4*H;t._preCompileShader[N]=new KH(N,n,C,r)},t.preCompile2D=function(H,n,C,r,N){var Q=2e-4*H+n;t._preCompileShader[Q]=new KH(Q,C,r,N)},t._createShader=function(H,n,C){var r=H.createShader(C);return H.shaderSource(r,n),H.compileShader(r),r},t._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],t._count=0,t._preCompileShader={},t.SHADERNAME2ID=2e-4,t.sharders=((t.sharders=[]).length=32,t.sharders),I(t,["nameKey",function(){return this.nameKey=new v}]),t}(),YH=function(H){function n(){this._maxsize=0,this._upload=!0,this._uploadSize=0,n.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}o(n,"laya.webgl.utils.Buffer2D",H);var C=n.prototype;return C.needSize=function(H){var n=this._byteLength;if(H){var C=this._byteLength+H;C<=this._buffer.byteLength||this._resizeBuffer(C<<1,!0),this._byteLength=C}return n},C._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),h.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,dH._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),dH._gl.bufferSubData(this._bufferType,0,this._buffer)},C._bufferSubData=function(H,n,C){if(void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),this._maxsize=Math.max(this._maxsize,this._byteLength),h.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,dH._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),n||C){var r=this._buffer.slice(n,C);dH._gl.bufferSubData(this._bufferType,H,r)}else dH._gl.bufferSubData(this._bufferType,H,this._buffer)},C._checkArrayUse=function(){},C._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},C._bind_subUpload=function(H,n,C){return void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(H,n,C),!0)},C._resizeBuffer=function(H,n){if(H<this._buffer.byteLength)return this;if(this.memorySize=H,n&&this._buffer&&0<this._buffer.byteLength){var C=new ArrayBuffer(H);new Uint8Array(C).set(new Uint8Array(this._buffer),0),this._buffer=C}else this._buffer=new ArrayBuffer(H);return this._checkArrayUse(),this._upload=!0,this},C.append=function(H){this._upload=!0;var n,C;n=H.byteLength,H instanceof Uint8Array?(this._resizeBuffer(this._byteLength+n,!0),C=new Uint8Array(this._buffer,this._byteLength)):H instanceof Uint16Array?(this._resizeBuffer(this._byteLength+n,!0),C=new Uint16Array(this._buffer,this._byteLength)):H instanceof Float32Array&&(this._resizeBuffer(this._byteLength+n,!0),C=new Float32Array(this._buffer,this._byteLength)),C.set(H,0),this._byteLength+=n,this._checkArrayUse()},C.appendU16Array=function(H,n){this._resizeBuffer(this._byteLength+2*n,!0);for(var C=new Uint16Array(this._buffer,this._byteLength,n),r=0;r<n;r++)C[r]=H[r];this._byteLength+=2*n,this._checkArrayUse()},C.appendEx=function(H,n){this._upload=!0;var C;C=H.byteLength,this._resizeBuffer(this._byteLength+C,!0),new n(this._buffer,this._byteLength).set(H,0),this._byteLength+=C,this._checkArrayUse()},C.appendEx2=function(H,n,C,r){void 0===r&&(r=1),this._upload=!0;var N,Q;N=C*r,this._resizeBuffer(this._byteLength+N,!0),Q=new n(this._buffer,this._byteLength);var I=0;for(I=0;I<C;I++)Q[I]=H[I];this._byteLength+=N,this._checkArrayUse()},C.getBuffer=function(){return this._buffer},C.setNeedUpload=function(){this._upload=!0},C.getNeedUpload=function(){return this._upload},C.upload=function(){var H=this._bind_upload();return dH._gl.bindBuffer(this._bufferType,null),dH._bindActive[this._bufferType]=null,pH.activeShader=null,H},C.subUpload=function(H,n,C){void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0);var r=this._bind_subUpload();return dH._gl.bindBuffer(this._bufferType,null),dH._bindActive[this._bufferType]=null,pH.activeShader=null,r},C.disposeResource=function(){H.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},C.clear=function(){this._byteLength=0,this._upload=!0},r(0,C,"bufferLength",function(){return this._buffer.byteLength}),r(0,C,"byteLength",null,function(H){this._byteLength!==H&&(H<=this._buffer.byteLength||this._resizeBuffer(2*H+256,!0),this._byteLength=H)}),n.__int__=function(H){VH.QuadrangleIB=VH.create(35044),lH.fillIBQuadrangle(VH.QuadrangleIB,16)},n.FLOAT32=4,n.SHORT=2,n}(dH),uH=(function(n){function C(H){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,C.__super.call(this,9)}o(C,"laya.webgl.shader.d2.value.GlowSV",n);var H=C.prototype;H.setValue=function(H){n.prototype.setValue.call(this,H)},H.clear=function(){n.prototype.clear.call(this)}}($H),function(H){function n(H){n.__super.call(this,64),this.defines.add(64)}o(n,"laya.webgl.shader.d2.value.TextSV",H);var C=n.prototype;return C.release=function(){(n.pool[n._length++]=this).clear()},C.clear=function(){H.prototype.clear.call(this)},n.create=function(){return n._length?n.pool[--n._length]:new n(null)},n.pool=[],n._length=0,n}($H)),XH=function(H){function N(H,n,C,r){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,N.__super.call(this,H,n,C,r)}o(N,"laya.webgl.shader.d2.Shader2X",H);var n=N.prototype;return n.upload2dQuick1=function(H){this.upload(H,this._params2dQuick1||this._make2dQuick1())},n._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var H,n=this._params,C=0,r=n.length;C<r;C++)H=n[C],(f.isFlash||"size"!==H.name&&"position"!==H.name&&"texcoord"!==H.name)&&this._params2dQuick1.push(H)}return this._params2dQuick1},n.disposeResource=function(){H.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},n.upload2dQuick2=function(H){this.upload(H,this._params2dQuick2||this._make2dQuick2())},n._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var H,n=this._params,C=0,r=n.length;C<r;C++)H=n[C],(f.isFlash||"size"!==H.name)&&this._params2dQuick2.push(H)}return this._params2dQuick2},N.create=function(H,n,C,r){return new N(H,n,C,r)},N}(JH),VH=function(H){function n(H){this._uint8Array=null,this._uint16Array=null,void 0===H&&(H=35044),n.__super.call(this),this._bufferUsage=H,this._bufferType=34963,f.isFlash||(this._buffer=new ArrayBuffer(8))}o(n,"laya.webgl.utils.IndexBuffer2D",YH);var C=n.prototype;return C._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},C.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},C.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},C.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},n.QuadrangleIB=null,n.create=function(H){return void 0===H&&(H=35044),new n(H)},n}(),BH=function(H){function C(H,n){this._floatArray32=null,this._vertexStride=0,C.__super.call(this),this._vertexStride=H,this._bufferUsage=n,this._bufferType=34962,f.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}o(C,"laya.webgl.utils.VertexBuffer2D",H);var n=C.prototype;return n.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},n.bind=function(H){H&&H._bind(),this._bind()},n.insertData=function(H,n){this.getFloat32Array().set(H,n),this._upload=!0},n.bind_upload=function(H){H._bind_upload()||H._bind(),this._bind_upload()||this._bind()},n._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},n.disposeResource=function(){H.prototype.disposeResource.call(this)},n.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},r(0,n,"vertexStride",function(){return this._vertexStride}),C.create=function(H,n){return void 0===n&&(n=35048),new C(H,n)},C}(YH),Hn=function(H){function A(H,n,C,r,N,Q){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===C&&(C=6408),void 0===r&&(r=!0),A.__super.call(this,H,n),H){if(this._format=C,this._mipmap=r,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof H)this._url=H,this._src=H,this._image=new g.window.Image,n&&(n.onload&&(this.onload=n.onload),n.onerror&&(this.onerror=n.onerror),n.onCreate&&n.onCreate(this)),this._image.crossOrigin=H&&0==H.indexOf("data:")?null:"",H&&(this._image.src=H);else if(H instanceof ArrayBuffer){this._src=n,this._url=this._src;var I=new P(H);I.readUTFBytes(4),I.readUTFBytes(2),I.getInt16();I.endian="bigEndian",this._w=I.getInt16(),this._h=I.getInt16();I.getInt16(),I.getInt16();this._image=new Uint8Array(H,I.pos),this._format=WH.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,s.enabled&&this._w<s.atlasLimitWidth&&this._h<s.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(H instanceof Uint8Array))return this._src=n,this._url=this._src,this._image=H.source||H,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=n,this._url=this._src,this._w=N,this._h=Q,this._image=H,this._format=0===C?H.byteLength/(N*Q)==4?6408:6407:C}this._$5__enableMerageInAtlas=!0}}o(A,"laya.webgl.resource.WebGLImage",l);var n=A.prototype;return w.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n._init_=function(H,n){},n._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var H=WH.mainContext,n=this._source=H.createTexture(),C=zH.curBindTexTarget,r=zH.curBindTexValue;zH.bindTexture(H,3553,n);var N=this.minFifter,Q=this.magFifter,I=this.repeat?10497:33071,A=R.isPOT(this._w,this._h),P=!1;switch(A?(this.mipmap?-1!==N||(N=9987):-1!==N||(N=9729),-1!==Q||(Q=9729),H.texParameteri(3553,10241,N),H.texParameteri(3553,10240,Q),H.texParameteri(3553,10242,I),H.texParameteri(3553,10243,I),this.mipmap&&H.generateMipmap(3553)):(-1!==N||(N=9729),-1!==Q||(Q=9729),H.texParameteri(3553,10241,N),H.texParameteri(3553,10240,Q),H.texParameteri(3553,10242,33071),H.texParameteri(3553,10243,33071)),H.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&H.pixelStorei(H.UNPACK_ALIGNMENT,1),H.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&H.pixelStorei(H.UNPACK_ALIGNMENT,1),H.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:P=!0,H.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case WH.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:P=!0,H.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}H.pixelStorei(37441,!1),C&&r&&zH.bindTexture(H,C,r),this.uri||(this.uri=this._url),P?this.memorySize=this._image.length:A&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},n.recreateResource=function(){var H=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var n=this;this._image=new g.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(n._needReleaseAgain)return n._needReleaseAgain=!1,n._image.onload=null,void(n._image=null);n._allowMerageInAtlas&&n._enableMerageInAtlas?(H.memorySize=0,H._recreateLock=!1):n._createWebGlTexture(),n.completeCreate()},this._image.src=this._src}},n.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&WH.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},n.onresize=function(){this._w=this._image.width,this._h=this._image.height,s.enabled&&this._w<s.atlasLimitWidth&&this._h<s.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},n.clearAtlasSource=function(){this._image=null},r(0,n,"format",function(){return this._format}),r(0,n,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(H){this._$5__enableMerageInAtlas=H}),r(0,n,"mipmap",function(){return this._mipmap}),r(0,n,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),r(0,n,"atlasSource",function(){return this._image}),r(0,n,"onload",null,function(H){var n=this;this._onload=H,this._image&&(this._image.onload=null!=this._onload?function(){n.onresize(),n._onload()}:null)}),r(0,n,"onerror",null,function(H){var n=this;this._onerror=H,this._image&&(this._image.onerror=null!=this._onerror?function(){n._onerror()}:null)}),A}();w.__init([gH,U,FH,KH])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(H,n){"use strict";for(var C in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var r=Laya[C];r&&r.__isclass&&(n[C]=r)}}),function(Q,H,O){O.un,O.uns;var r=O.static,N=O.class,I=O.getset,A=(O.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),M=laya.utils.ClassUtils,y=(laya.events.Event,laya.utils.HTMLChar),P=laya.net.Loader,t=(laya.display.Node,laya.maths.Rectangle),R=laya.renders.Render,o=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),g=laya.utils.Stat,S=laya.display.Text,j=laya.resource.Texture,l=laya.net.URL,f=laya.utils.Utils,c=function(){function g(){}return N(g,"laya.html.utils.HTMLParse"),g.parse=function(H,n,C){n=(n="<root>"+(n=n.replace(/<br>/g,"<br/>"))+"</root>").replace(g.spacePattern,g.char255);var r=f.parseXMLFromString(n);g._parseXML(H,r.childNodes[0].childNodes,C)},g._parseXML=function(H,n,C,r){var N=0,Q=0;if(n.join||n.item)for(N=0,Q=n.length;N<Q;++N)g._parseXML(H,n[N],C,r);else{var I,A,P;if(3==n.nodeType)return void(H instanceof laya.html.dom.HTMLDivElement?(null==n.nodeName&&(n.nodeName="#text"),A=n.nodeName.toLowerCase(),0<(P=n.textContent.replace(/^\s+|\s+$/g,"")).length&&(I=M.getInstance(A))&&(H.addChild(I),I.innerTEXT=P.replace(g.char255AndOneSpacePattern," "))):0<(P=n.textContent.replace(/^\s+|\s+$/g,"")).length&&(H.innerTEXT=P.replace(g.char255AndOneSpacePattern," ")));if("#comment"==(A=n.nodeName.toLowerCase()))return;if(I=M.getInstance(A)){(I=H.addChild(I)).URI=C,I.href=r;var t=n.attributes;if(t&&0<t.length)for(N=0,Q=t.length;N<Q;++N){var R=t[N],y=R.nodeName,o=R.value;I._setAttributes(y,o)}g._parseXML(I,n.childNodes,C,I.href)}else g._parseXML(H,n.childNodes,C,r)}},g.char255=String.fromCharCode(255),g.spacePattern=/&nbsp;|&#160;/g,g.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),g}(),K=function(){function x(){}return N(x,"laya.html.utils.Layout"),x.later=function(H){null==x._will&&(x._will=[],O.stage.frameLoop(1,null,function(){if(!(x._will.length<1)){for(var H=0;H<x._will.length;H++)laya.html.utils.Layout.layout(x._will[H]);x._will.length=0}})),x._will.push(H)},x.layout=function(H){if(!H||!H._style)return null;if(0==(512&H._style._type))return null;H.getStyle()._type&=-513;var n=x._multiLineLayout(H);return R.isConchApp&&H.layaoutCallNative&&H.layaoutCallNative(),n},x._multiLineLayout=function(H){if(S.RightToLeft)return x._multiLineLayout2(H);var n=new Array;H._addChildsToLayout(n);var C,r,N,Q,I,A=0,P=n.length,t=H._getCSSStyle(),R=t.letterSpacing,y=t.leading,o=t.lineHeight,g=t._widthAuto()||!t.wordWrap,M=g?999999:H.width,j=(H.height,0),l=t.italic?t.fontSize/3:0,f=t._getAlign(),c=t._getValign(),K=0!==c||0!==f||0!=o,W=0,z=0,w=0,F=0,k=new Array,i=k[0]=new T,a=!1,D=!1;i.h=0,t.italic&&(M-=t.fontSize/3);var L=0,b=!0;function h(){i.y=z,z+=i.h+y,0==i.h&&(z+=o),i.mWidth=L,L=0,i=new T,k.push(i),i.h=0,a=!(b=!(W=0))}if(S.WordSplitArr&&S.WordSplitArr.length){var v,e=[],Z=[],q=0,p=0,m=0;for(A=0;A<P;A++)if(v=n[A],Z.push(v),v?(m+=p=v instanceof laya.html.dom.HTMLBrElement?0:v._isChar()?v.width+R:(N=v._getCSSStyle().padding,v.width*v._style._tf.scaleX+N[1]+N[3]+R),q+=p,v&&v instanceof laya.html.dom.HTMLBrElement||v&&"\n"===v.char||A==P-1?(e.push(Z),Z=[],m=0):-1!=O.Text.WordSplitArr.indexOf(v.char)&&(e.push(Z),Z=[],m=0)):(m+=x.DIV_ELEMENT_PADDING,q+=x.DIV_ELEMENT_PADDING),v&&v instanceof laya.html.dom.HTMLBrElement||v&&"\n"===v.char||A==P-1||M<q){q=m;for(var d=0;d<e.length;d++)for(var _=0;_<e[d].length;_++)null!=(C=e[d][_])?(b=!1,C instanceof laya.html.dom.HTMLBrElement?i.y=z:(C._isChar()?((Q=C).isWord?i.wordStartIndex=i.elements.length:(w=Q.width+Q.style.letterSpacing,L+=Q.width),w=Q.width+R,F=Q.height,i.minTextHeight=Math.min(i.minTextHeight,C.height)):(r=C._getCSSStyle(),I=C,N=r.padding,0===r._getCssFloat()||(K=!0),a=D||r.lineElement,w=I.width*I._style._tf.scaleX+N[1]+N[3]+R,F=I.height*I._style._tf.scaleY+N[0]+N[2]),i.elements.push(C),i.h=Math.max(i.h,F),C.x=W,C.y=z,W+=w,i.w=W-R,i.y=z,j=Math.max(W+l,j))):(b||(W+=x.DIV_ELEMENT_PADDING),i.wordStartIndex=i.elements.length);e=[],A<P-1&&h()}}else for(A=0;A<P;A++)if(null!=(C=n[A]))if(b=!1,C instanceof laya.html.dom.HTMLBrElement)h(),i.y=z;else{if(C._isChar()){if((Q=C).isWord)a=D||"\n"===Q.char,i.wordStartIndex=i.elements.length;else{if(w=Q.width+Q.style.letterSpacing,0<k.length&&M<W+w&&0<i.wordStartIndex){var U;U=i.elements.length-i.wordStartIndex+1,i.elements.length=i.wordStartIndex,A-=U,h();continue}a=!1,L+=Q.width}w=Q.width+R,F=Q.height,D=!1,(a=a||M<W+w)&&h(),i.minTextHeight=Math.min(i.minTextHeight,C.height)}else r=C._getCSSStyle(),I=C,N=r.padding,0===r._getCssFloat()||(K=!0),a=D||r.lineElement,w=I.width*I._style._tf.scaleX+N[1]+N[3]+R,F=I.height*I._style._tf.scaleY+N[0]+N[2],D=r.lineElement,(a=a||M<W+w&&r.wordWrap)&&h();i.elements.push(C),i.h=Math.max(i.h,F),C.x=W,C.y=z,W+=w,i.w=W-R,i.y=z,j=Math.max(W+l,j)}else b||(W+=x.DIV_ELEMENT_PADDING),i.wordStartIndex=i.elements.length;if(z=i.y+i.h,K){var s=0,$=M;for(g&&0<H.width&&($=H.width),A=0,P=k.length;A<P;A++)k[A].updatePos(0,$,A,s,f,c,o),s+=Math.max(o,k[A].h+y);z=s}return g&&(H.width=j),z>H.height&&(H.height=z),[j,z]},x._multiLineLayout2=function(H){var n=new Array;H._addChildsToLayout(n);var C,r,N,Q,I,A=0,P=n.length,t=H._getCSSStyle(),R=t.letterSpacing,y=t.leading,o=t.lineHeight,g=t._widthAuto()||!t.wordWrap,M=g?999999:H.width,j=(H.height,0),l=t.italic?t.fontSize/3:0,f=2-t._getAlign(),c=t._getValign(),K=0!==c||0!=f||0!=o,W=0,z=0,w=0,F=0,k=new Array,i=k[0]=new T,a=!1,D=!1;i.h=0,t.italic&&(M-=t.fontSize/3);var L=0,b=!0;function h(){i.y=z,z+=i.h+y,0==i.h&&(z+=o),i.mWidth=L,L=0,i=new T,k.push(i),i.h=0,a=!(b=!(W=0))}if(S.WordSplitArr&&S.WordSplitArr.length){var v,e=[],Z=[],q=0,p=0,m=0;for(A=0;A<P;A++)if(v=n[A],Z.push(v),v?(m+=p=v instanceof laya.html.dom.HTMLBrElement?0:v._isChar()?v.width+R:(N=v._getCSSStyle().padding,v.width*v._style._tf.scaleX+N[1]+N[3]+R),q+=p,v&&v instanceof laya.html.dom.HTMLBrElement||v&&"\n"===v.char||A==P-1?(e.push(Z),Z=[],m=0):-1!=O.Text.WordSplitArr.indexOf(v.char)&&(e.push(Z),Z=[],m=0)):(m+=x.DIV_ELEMENT_PADDING,q+=x.DIV_ELEMENT_PADDING),v&&v instanceof laya.html.dom.HTMLBrElement||v&&"\n"===v.char||A==P-1||M<q){q=m;for(var d=0;d<e.length;d++)for(var _=0;_<e[d].length;_++)null!=(C=e[d][_])?(b=!1,C instanceof laya.html.dom.HTMLBrElement?i.y=z:(C._isChar()?((Q=C).isWord?i.wordStartIndex=i.elements.length:(w=Q.width+Q.style.letterSpacing,L+=Q.width),w=Q.width+R,F=Q.height,i.minTextHeight=Math.min(i.minTextHeight,C.height)):(r=C._getCSSStyle(),I=C,N=r.padding,0===r._getCssFloat()||(K=!0),a=D||r.lineElement,w=I.width*I._style._tf.scaleX+N[1]+N[3]+R,F=I.height*I._style._tf.scaleY+N[0]+N[2]),i.elements.push(C),i.h=Math.max(i.h,F),C.x=W,C.y=z,W+=w,i.w=W-R,i.y=z,j=Math.max(W+l,j))):(b||(W+=x.DIV_ELEMENT_PADDING),i.wordStartIndex=i.elements.length);e=[],A<P-1&&h()}}else for(A=0;A<P;A++)if(null!=(C=n[A]))if(b=!1,C instanceof laya.html.dom.HTMLBrElement)h(),i.y=z;else{if(C._isChar()){if((Q=C).isWord)a=D||"\n"===Q.char,i.wordStartIndex=i.elements.length;else{if(0<k.length&&M<W+w&&0<i.wordStartIndex){var U;U=i.elements.length-i.wordStartIndex+1,i.elements.length=i.wordStartIndex,A-=U,h();continue}a=!1,L+=Q.width}w=Q.width+R,F=Q.height,D=!1,(a=a||M<W+w)&&h(),i.minTextHeight=Math.min(i.minTextHeight,C.height)}else r=C._getCSSStyle(),I=C,N=r.padding,0===r._getCssFloat()||(K=!0),a=D||r.lineElement,w=I.width*I._style._tf.scaleX+N[1]+N[3]+R,F=I.height*I._style._tf.scaleY+N[0]+N[2],D=r.lineElement,(a=a||M<W+w&&r.wordWrap)&&h();i.elements.push(C),i.h=Math.max(i.h,F),C.x=W,C.y=z,W+=w,i.w=W-R,i.y=z,j=Math.max(W+l,j)}else b||(W+=x.DIV_ELEMENT_PADDING),i.wordStartIndex=i.elements.length;if(z=i.y+i.h,K){var s=0,$=M;for(A=0,P=k.length;A<P;A++)k[A].updatePos(0,$,A,s,f,c,o),s+=Math.max(o,k[A].h+y);z=s}for(g&&(H.width=j),z>H.height&&(H.height=z),A=0,P=k.length;A<P;A++)k[A].revertOrder(M);return[j,z]},x._will=null,x.DIV_ELEMENT_PADDING=0,x}(),T=function(){function H(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}N(H,"laya.html.utils.LayoutLine");var n=H.prototype;return n.updatePos=function(H,n,C,r,N,Q,I){var A,P=0;0<this.elements.length&&(P=(A=this.elements[this.elements.length-1]).x+A.width-this.elements[0].x);var t=0,R=NaN;1===N&&(t=(n-P)/2),2===N&&(t=n-P),0===I||0!=Q||(Q=1);for(var y=0,o=this.elements.length;y<o;y++){var g=(A=this.elements[y])._getCSSStyle();switch(0!==t&&(A.x+=t),g._getValign()){case 0:A.y=r;break;case 1:var M=0;99999!=this.minTextHeight&&(M=this.minTextHeight);var j=(M+I)/2;j=Math.max(j,this.h),R=(laya.html.dom.HTMLImageElement,r+j-A.height),A.y=R;break;case 2:A.y=r+(I-A.height)}}},n.revertOrder=function(H){var n;if(0<this.elements.length){var C,r=0;for(C=this.elements.length,r=0;r<C;r++)(n=this.elements[r]).x=H-n.x-n.width}},H}(),W=function(C){function n(){this.URI=null,this._href=null,n.__super.call(this),this._text=n._EMPTYTEXT,this.setStyle(new A(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}N(n,"laya.html.dom.HTMLElement",C);var H=n.prototype;return H.layaoutCallNative=function(){var H=0;if(this._childs&&0<(H=this._childs.length))for(var n=0;n<H;n++)this._childs[n].layaoutCallNative&&this._childs[n].layaoutCallNative();var C=this._getWords();C?laya.html.dom.HTMLElement.fillWords(this,C,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},H.appendChild=function(H){return this.addChild(H)},H._getWords2=function(){var H=this._text.text;if(!H||0===H.length)return null;var n,C,r=0,N=0;if(this._text.drawWords)C=this._text.drawWords;else{for(N=(n=H.split(" ")).length-1,C=[],r=0;r<N;r++)C.push(n[r]," ");0<=N&&C.push(n[N]),this._text.drawWords=C}var Q,I=this._text.words;if(I&&I.length===C.length)return I;null===I&&(this._text.words=I=[]),I.length=C.length;var A=this.style,P=A.font;for(r=0,N=C.length;r<N;r++){Q=f.measureText(C[r],P);var t=I[r]=new y(C[r],Q.width,Q.height||A.fontSize,A);if(1<t.char.length&&(t.charNum=t.char),this.href){var R=new o;this.addChild(R),t.setSprite(R)}}return I},H._getWords=function(){if(!S.CharacterCache)return this._getWords2();var H=this._text.text;if(!H||0===H.length)return null;var n,C=this._text.words;if(C&&C.length===H.length)return C;null===C&&(this._text.words=C=[]),C.length=H.length;for(var r=this.style,N=r.font,Q=0,I=H.length;Q<I;Q++)if(n=f.measureText(H.charAt(Q),N)){var A=C[Q]=new y(H.charAt(Q),n.width,n.height||r.fontSize,r);if(this.href){var P=new o;this.addChild(P),A.setSprite(P)}}else console.warn("_getWords size is null"+H.charAt(Q),N);return C},H.showLinkSprite=function(){var H=this._text.words;if(H)for(var n,C,r=[],N=0;N<H.length;N++)C=H[N],(n=new o).graphics.drawRect(0,0,C.width,C.height,"#ff0000"),n.width=C.width,n.height=C.height,this.addChild(n),r.push(n)},H._layoutLater=function(){var H=this.style;512&H._type||(H.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&H.block?(K.later(this),H._type|=512):this.parent&&this.parent._layoutLater())},H._setAttributes=function(H,n){switch(H){case"style":return void this.style.cssText(n);case"class":return void(this.className=n)}C.prototype._setAttributes.call(this,H,n)},H.updateHref=function(){if(null!=this._href){var H=this._getWords();if(H)for(var n,C,r=0;r<H.length;r++)(C=(n=H[r]).getSprite())&&(C.size(n.width,n.height),C.on("click",this,this.onLinkHandler))}},H.onLinkHandler=function(H){switch(H.type){case"click":for(var n=this;n;)n.event("link",[this.href]),n=n.parent}},H.formatURL=function(H){return this.URI?l.formatURL(H,this.URI?this.URI.path:null):H},I(0,H,"href",function(){return this._href},function(H){null!=(this._href=H)&&(this._getCSSStyle().underLine=1,this.updateHref())}),I(0,H,"color",null,function(H){this.style.color=H}),I(0,H,"onClick",null,function(H){O._runScript("fn=function(event){"+H+";}"),this.on("click",this,void 0)}),I(0,H,"id",null,function(H){z.document.setElementById(H,this)}),I(0,H,"innerTEXT",function(){return this._text.text},function(H){this.text=H}),I(0,H,"style",function(){return this._style}),I(0,H,"text",function(){return this._text.text},function(H){this._text==n._EMPTYTEXT?this._text={text:H,words:null}:(this._text.text=H,this._text.words&&(this._text.words.length=0)),R.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),I(0,H,"parent",C.prototype._$get_parent,function(H){if(H instanceof laya.html.dom.HTMLElement){var n=H;this.URI||(this.URI=n.URI),this.style.inherit(n.style)}O.superSet(o,this,"parent",H)}),I(0,H,"className",null,function(H){this.style.attrs(z.document.styleSheets["."+H])}),n.fillWords=function(H,n,C,r,N,Q,I){H.graphics.clear();for(var A=0,P=n.length;A<P;A++){var t=n[A];H.graphics.fillText(t.char,t.x+C,t.y+r,N,Q,"left",I)}},n._EMPTYTEXT={text:null,words:null},n}(o),n=(function(H){function n(){n.__super.call(this),this.style.lineElement=!0,this.style.block=!0}N(n,"laya.html.dom.HTMLBrElement",W)}(),function(H){function n(){this.contextHeight=NaN,this.contextWidth=NaN,n.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}N(n,"laya.html.dom.HTMLDivElement",H);var C=n.prototype;return C.appendHTML=function(H){c.parse(this,H,this.URI),this.layout()},C._addChildsToLayout=function(n){var H=this._getWords();if(null==H&&0==this._childs.length)return!1;H&&H.forEach(function(H){n.push(H)});for(var C=!0,r=0,N=this._childs.length;r<N;r++){var Q=this._childs[r];C?C=!1:n.push(null),Q._addToLayout(n)}return!0},C._addToLayout=function(H){this.layout()},C.layout=function(){if(this.style){this.style._type|=512;var H=K.layout(this);if(H){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new t);var n=this._$P.mHtmlBounds;n.x=n.y=0,n.width=this.contextWidth=H[0],n.height=this.contextHeight=H[1],this.setBounds(n)}}},I(0,C,"height",function(){return this._height?this._height:this.contextHeight},H.prototype._$set_height),I(0,C,"innerHTML",null,function(H){this.destroyChildren(),this.appendHTML(H)}),I(0,C,"width",function(){return this._width?this._width:this.contextWidth},function(H){var n=!1;n=0===H?H!=this._width:H!=this.width,O.superSet(W,this,"width",H),n&&this.layout()}),n}(W)),z=function(H){function n(){this.all=new Array,this.styleSheets=A.styleSheets,n.__super.call(this)}N(n,"laya.html.dom.HTMLDocument",W);var C=n.prototype;return C.getElementById=function(H){return this.all[H]},C.setElementById=function(H,n){this.all[H]=n},r(n,["document",function(){return this.document=new n}]),n}();(function(H){function n(){this._tex=null,this._url=null,this._renderArgs=[],n.__super.call(this),this.style.block=!0}N(n,"laya.html.dom.HTMLImageElement",W);var C=n.prototype;C._addToLayout=function(H){!this._style.absolute&&H.push(this)},C.render=function(H,n,C){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(g.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,H.ctx.drawTexture2(n,C,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},C.layaoutCallNative=function(){var H=0;if(this._childs&&0<(H=this._childs.length))for(var n=0;n<H;n++)this._childs[n].layaoutCallNative&&this._childs[n].layaoutCallNative()},I(0,C,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(H){this._width!==H&&(this._width=H,this._style.width=H,this.repaint())}),I(0,C,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(H){this._height!==H&&(this._height=H,this._style.height=H,this.repaint())}),C.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),P.clearCache(this,this._url),this._tex=null),W.prototype.destroy.call(this)},C.onloaded=function(){var H=this._style;H&&!H.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),H&&!H.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),R.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},C._loadImageComplete=function(H,n,C){if(!this._destroyed)if(null!=C)if(C instanceof ArrayBuffer){var r=new DataView(C);new laya.webgl.resource.WebGLImage(new Uint8Array(C,8),H,0,!1,r.getUint32(0),r.getUint32(4));this.onloaded()}else if(C instanceof j)P.imgMgrSet[H]=n,Q.imgMgrLock(H,P.imgMgrSet[H]),this._url=H,this._tex=C,P.keepCache(this,H),P.cacheRes(H,this._tex),this.onloaded();else{var N=-1!=H.indexOf(".png",H.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(C,H,N,!1,C.width,C.height);this.onloaded()}else this.event("error","Load image failed")},I(0,C,"src",null,function(H){(H=this.formatURL(H),this._url!=H)&&(null!=this._tex&&(P.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=H,(this._tex=P.getRes(H))?(P.keepCache(this,H),this.onloaded()):Q.imgMgrLoad(H,this._loadImageComplete.bind(this),2,!1))})})(),function(H){function n(){this.type=null,n.__super.call(this),this.visible=!1}N(n,"laya.html.dom.HTMLLinkElement",H);var C=n.prototype;C._onload=function(H){switch(this.type){case"text/css":A.parseCSS(H,this.URI)}},I(0,C,"href",H.prototype._$get_href,function(H){var n=this;H=this.formatURL(H),this.URI=new l(H);var C=new P;C.once("complete",null,function(H){n._onload(H)}),C.load(H,"text")}),n._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(W),function(H){function n(){n.__super.call(this),this.visible=!1}N(n,"laya.html.dom.HTMLStyleElement",H),I(0,n.prototype,"text",H.prototype._$get_text,function(H){A.parseCSS(H,null)})}(W),function(H){function n(){n.__super.call(this),this._getCSSStyle().valign="middle"}N(n,"laya.html.dom.HTMLIframeElement",H),I(0,n.prototype,"href",H.prototype._$get_href,function(C){var r=this;C=this.formatURL(C);var H=new P;H.once("complete",null,function(H){var n=r.URI;r.URI=new l(C),r.innerHTML=H,!n||(r.URI=n)}),H.load(C,"text")})}(n)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(H,n){"use strict";for(var C in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var r=Laya[C];r&&r.__isclass&&(n[C]=r)}}),function(N,H,j){j.un,j.uns;var r=j.static,Q=j.class,I=j.getset,C=(j.__newvec,laya.display.Animation),A=laya.utils.Browser,l=laya.utils.ClassUtils,P=laya.filters.ColorFilter,t=laya.utils.Ease,R=laya.events.Event,y=(laya.events.EventDispatcher,laya.display.css.Font),o=laya.display.FrameAnimation,n=laya.display.Graphics,g=laya.utils.Handler,M=laya.display.Input,c=laya.net.Loader,f=(laya.display.Node,laya.maths.Point),K=laya.maths.Rectangle,W=laya.renders.Render,z=laya.display.Sprite,w=laya.display.Text,F=laya.resource.Texture,k=laya.utils.Tween,i=laya.utils.Utils,a=laya.utils.WeakObject;j.interface("laya.ui.IItem"),j.interface("laya.ui.ISelect"),j.interface("laya.ui.IRender"),j.interface("laya.ui.IComponent"),j.interface("laya.ui.IBox","IComponent");var D=function(){function H(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return Q(H,"laya.ui.LayoutStyle"),r(H,["EMPTY",function(){return this.EMPTY=new H}]),H}(),L=function(){function H(){}return Q(H,"laya.ui.Styles"),H.labelColor="#000000",H.buttonStateNum=3,H.scrollBarMinNum=15,H.scrollBarDelayTime=500,r(H,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),H}(),b=function(){function N(){}return Q(N,"laya.ui.UIUtils"),N.fillArray=function(H,n,C){var r=H.concat();if(n)for(var N=n.split(","),Q=0,I=Math.min(r.length,N.length);Q<I;Q++){var A=N[Q];r[Q]="true"==A||"false"!=A&&A,null!=C&&(r[Q]=C(A))}return r},N.toColor=function(H){return i.toHexColor(H)},N.gray=function(H,n){void 0===n&&(n=!0),n?N.addFilter(H,N.grayFilter):N.clearFilter(H,P)},N.addFilter=function(H,n){var C=H.filters||[];C.push(n),H.filters=C},N.clearFilter=function(H,n){var C=H.filters;if(null!=C&&0<C.length){for(var r=C.length-1;-1<r;r--){var N=C[r];j.__typeof(N,n)&&C.splice(r,1)}H.filters=C}},N._getReplaceStr=function(H){return N.escapeSequence[H]},N.adptString=function(H){return H.replace(/\\(\w)/g,N._getReplaceStr)},N.getBindFun=function(H){var n=N._funMap.get(H);if(null==n){var C='"'+H+'"',r="(function(data){if(data==null)return;with(data){try{\nreturn "+(C=C.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";n=j._runScript(r),N._funMap.set(H,n)}return n},r(N,["grayFilter",function(){return this.grayFilter=new P([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new a}]),N}(),h=function(){function H(){}return Q(H,"UIConfig"),H.touchScrollEnable=!0,H.mouseWheelEnable=!0,H.showButtons=!0,H.popupBgColor="#000000",H.popupBgAlpha=.5,H.closeDialogOnSide=!0,H}(),v=function(C){function f(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,f.__super.call(this),this._weakKeys=[]}Q(f,"laya.ui.AutoBitmap",C);var H=f.prototype;return H.destroy=function(){if(c.clearObject(this,this._weakKey),this._weakKeys){for(var H=0,n=this._weakKeys.length;H<n;++H)c.clearObject(this,this._weakKeys[H]);this._weakKeys=null}C.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},H._setChanged=function(){this._isChanged||(this._isChanged=!0,j.timer.callLater(this,this.changeSource))},H.changeSource=function(){this._isChanged=!1;var H=this._source;if(H&&H.bitmap){var n=this.width,C=this.height,r=this._sizeGrid,N=H.sourceWidth,Q=H.sourceHeight;if(!r||N===n&&Q===C)this.cleanByTexture(H,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,n,C);else{c.clearObject(this,this._weakKey),H.$_GID||(H.$_GID=i.getGID());var I=H.$_GID+"."+n+"."+C+"."+r.join("."),A=c.findObject(I);if(i.isOKCmdList(A))return this._weakKey=I,c.keepObject(this,this._weakKey),void(this.cmds=A);this.clear();var P,t,R=r[0],y=r[1],o=r[2],g=r[3],M=r[4],j=!1;if(n==N&&(g=y=0),C==Q&&(R=o=0),n<g+y){var l=n;j=!0,n=g+y,this.save(),this.clipRect(0,0,l,C)}g&&R&&(P=f.getTexture(H,0,0,g,R),t=this._weakKeys[0],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[0]=P.weakKey),this.drawTexture(P,0,0,g,R)):(c.clearObject(this,t),this._weakKeys[0]="")),y&&R&&(P=f.getTexture(H,N-y,0,y,R),t=this._weakKeys[1],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[1]=P.weakKey),this.drawTexture(P,n-y,0,y,R)):(c.clearObject(this,t),this._weakKeys[1]="")),g&&o&&(P=f.getTexture(H,0,Q-o,g,o),t=this._weakKeys[2],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[2]=P.weakKey),this.drawTexture(P,0,C-o,g,o)):(c.clearObject(this,t),this._weakKeys[2]="")),y&&o&&(P=f.getTexture(H,N-y,Q-o,y,o),t=this._weakKeys[3],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[3]=P.weakKey),this.drawTexture(P,n-y,C-o,y,o)):(c.clearObject(this,t),this._weakKeys[3]="")),R&&(P=f.getTexture(H,g,0,N-g-y,R),t=this._weakKeys[4],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[4]=P.weakKey),this.drawBitmap(M,P,g,0,n-g-y,R)):(c.clearObject(this,t),this._weakKeys[4]="")),o&&(P=f.getTexture(H,g,Q-o,N-g-y,o),t=this._weakKeys[5],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[5]=P.weakKey),this.drawBitmap(M,P,g,C-o,n-g-y,o)):(c.clearObject(this,t),this._weakKeys[5]="")),g&&(P=f.getTexture(H,0,R,g,Q-R-o),t=this._weakKeys[6],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[6]=P.weakKey),this.drawBitmap(M,P,0,R,g,C-R-o)):(c.clearObject(this,t),this._weakKeys[6]="")),y&&(P=f.getTexture(H,N-y,R,y,Q-R-o),t=this._weakKeys[7],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[7]=P.weakKey),this.drawBitmap(M,P,n-y,R,y,C-R-o)):(c.clearObject(this,t),this._weakKeys[7]="")),P=f.getTexture(H,g,R,N-g-y,Q-R-o),t=this._weakKeys[8],P?(t!=P.weakKey&&(c.clearObject(this,t),c.keepObject(this,P.weakKey),this._weakKeys[8]=P.weakKey),this.drawBitmap(M,P,g,R,n-g-y,C-R-o)):(c.clearObject(this,t),this._weakKeys[8]=""),j&&this.restore(),this.autoCacheCmd&&!W.isConchApp&&(c.saveObject(I,this.cmds,null),this._weakKey=I,c.keepObject(this,this._weakKey))}this._repaint()}},H.drawBitmap=function(H,n,C,r,N,Q){void 0===N&&(N=0),void 0===Q&&(Q=0),N<.1||Q<.1||(!H||n.width==N&&n.height==Q?this.drawTexture(n,C,r,N,Q):this.fillTexture(n,C,r,N,Q))},H.clear=function(H){void 0===H&&(H=!0),C.prototype.clear.call(this,!1)},I(0,H,"sizeGrid",function(){return this._sizeGrid},function(H){this._sizeGrid=H,this._setChanged()}),I(0,H,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(H){this._width!=H&&(this._width=H,this._setChanged())}),I(0,H,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(H){this._height!=H&&(this._height=H,this._setChanged())}),I(0,H,"source",function(){return this._source},function(H){H?(this._source=H,this._setChanged()):(this._source=null,this.clear())}),f.getTexture=function(H,n,C,r,N){r<=0&&(r=1),N<=0&&(N=1),H.$_GID||(H.$_GID=i.getGID());var Q=H.$_GID+"."+n+"."+C+"."+r+"."+N,I=c.findObject(Q);if((!I||!I.source)&&(I=F.createFromTexture(H,n,C,r,N))){if(H.alphaTexture){var A=H.width/H.alphaTexture.width;I.alphaTexture=F.createFromTexture(H.alphaTexture,n/A,C/A,r/A,N/A)}c.saveObject(Q,I),I.weakKey=Q}return I},f}(n),e=(function(H){function n(){n.__super.call(this)}Q(n,"laya.ui.UIEvent",R),n.SHOW_TIP="showtip",n.HIDE_TIP="hidetip"}(),function(n){function H(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,H.__super.call(this),this._layout=D.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}Q(H,"laya.ui.Component",n);var C=H.prototype;return j.imps(C,{"laya.ui.IComponent":!0}),C.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},C.preinitialize=function(){},C.createChildren=function(){},C.initialize=function(){},C.callLater=function(H,n){j.timer.callLater(this,H,n)},C.runCallLater=function(H){j.timer.runCallLater(this,H)},C.commitMeasure=function(){},C.changeSize=function(){this.event("resize")},C.getLayout=function(){return this._layout===D.EMPTY&&(this._layout=new D),this._layout},C._setLayoutEnabled=function(H){this._layout&&this._layout.enable!=H&&(this._layout.enable=H,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},C.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},C.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},C.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},C.resetLayoutX=function(){var H=this._layout;if(isNaN(H.anchorX)||(this.pivotX=H.anchorX*this.width),this.layoutEnabled){var n=this.parent;n&&(isNaN(H.centerX)?isNaN(H.left)?isNaN(H.right)||(this.x=Math.round(n.width-this.displayWidth-H.right+this.pivotX*this.scaleX)):(this.x=Math.round(H.left+this.pivotX*this.scaleX),isNaN(H.right)||(this.width=(n._width-H.left-H.right)/(this.scaleX||.01))):this.x=Math.round(.5*(n.width-this.displayWidth)+H.centerX+this.pivotX*this.scaleX))}},C.resetLayoutY=function(){var H=this._layout;if(isNaN(H.anchorY)||(this.pivotY=H.anchorY*this.height),this.layoutEnabled){var n=this.parent;n&&(isNaN(H.centerY)?isNaN(H.top)?isNaN(H.bottom)||(this.y=Math.round(n.height-this.displayHeight-H.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(H.top+this.pivotY*this.scaleY),isNaN(H.bottom)||(this.height=(n._height-H.top-H.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(n.height-this.displayHeight)+H.centerY+this.pivotY*this.scaleY))}},C.onMouseOver=function(H){j.stage.event("showtip",this._toolTip)},C.onMouseOut=function(H){j.stage.event("hidetip",this._toolTip)},I(0,C,"displayWidth",function(){return this.width*this.scaleX}),I(0,C,"width",function(){return this._width?this._width:this.measureWidth},function(H){this._width!=H&&(this._width=H,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),I(0,C,"measureWidth",function(){var H=0;this.commitMeasure();for(var n=this.numChildren-1;-1<n;n--){var C=this.getChildAt(n);C.visible&&(H=Math.max(C.x+C.width*C.scaleX,H))}return H}),I(0,C,"displayHeight",function(){return this.height*this.scaleY}),I(0,C,"height",function(){return this._height?this._height:this.measureHeight},function(H){this._height!=H&&(this._height=H,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),I(0,C,"dataSource",function(){return this._dataSource},function(H){for(var n in this._dataSource=H,this._dataSource)this.hasOwnProperty(n)&&"function"!=typeof this[n]&&(this[n]=this._dataSource[n])}),I(0,C,"scaleY",n.prototype._$get_scaleY,function(H){j.superGet(z,this,"scaleY")!=H&&(j.superSet(z,this,"scaleY",H),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),I(0,C,"measureHeight",function(){var H=0;this.commitMeasure();for(var n=this.numChildren-1;-1<n;n--){var C=this.getChildAt(n);C.visible&&(H=Math.max(C.y+C.height*C.scaleY,H))}return H}),I(0,C,"scaleX",n.prototype._$get_scaleX,function(H){j.superGet(z,this,"scaleX")!=H&&(j.superSet(z,this,"scaleX",H),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),I(0,C,"top",function(){return this._layout.top},function(H){H!=this._layout.top&&(this.getLayout().top=H,this._setLayoutEnabled(!0)),this.resetLayoutY()}),I(0,C,"bottom",function(){return this._layout.bottom},function(H){H!=this._layout.bottom&&(this.getLayout().bottom=H,this._setLayoutEnabled(!0)),this.resetLayoutY()}),I(0,C,"left",function(){return this._layout.left},function(H){H!=this._layout.left&&(this.getLayout().left=H,this._setLayoutEnabled(!0)),this.resetLayoutX()}),I(0,C,"right",function(){return this._layout.right},function(H){H!=this._layout.right&&(this.getLayout().right=H,this._setLayoutEnabled(!0)),this.resetLayoutX()}),I(0,C,"centerX",function(){return this._layout.centerX},function(H){H!=this._layout.centerX&&(this.getLayout().centerX=H,this._setLayoutEnabled(!0)),this.resetLayoutX()}),I(0,C,"centerY",function(){return this._layout.centerY},function(H){H!=this._layout.centerY&&(this.getLayout().centerY=H,this._setLayoutEnabled(!0)),this.resetLayoutY()}),I(0,C,"anchorX",function(){return this._layout.anchorX},function(H){H!=this._layout.anchorX&&(this.getLayout().anchorX=H,this._setLayoutEnabled(!0)),this.resetLayoutX()}),I(0,C,"anchorY",function(){return this._layout.anchorY},function(H){H!=this._layout.anchorY&&(this.getLayout().anchorY=H,this._setLayoutEnabled(!0)),this.resetLayoutY()}),I(0,C,"tag",function(){return this._tag},function(H){this._tag=H}),I(0,C,"toolTip",function(){return this._toolTip},function(H){this._toolTip!=H&&(null!=(this._toolTip=H)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),I(0,C,"comXml",function(){return this._comXml},function(H){this._comXml=H}),I(0,C,"gray",function(){return this._gray},function(H){H!==this._gray&&(this._gray=H,b.gray(this,H))}),I(0,C,"disabled",function(){return this._disabled},function(H){H!==this._disabled&&(this.gray=this._disabled=H,this.mouseEnabled=!H)}),H}(z)),Z=function(H){function n(){this.lockLayer=null,this.popupEffect=function(H){H.scale(1,1),k.from(H,{x:j.stage.width/2,y:j.stage.height/2,scaleX:0,scaleY:0},300,t.backOut,g.create(this,this.doOpen,[H]))},this.closeEffect=function(H,n){k.to(H,{x:j.stage.width/2,y:j.stage.height/2,scaleX:0,scaleY:0},300,t.strongOut,g.create(this,this.doClose,[H,n]))},n.__super.call(this),this.maskLayer=new z,this.popupEffectHandler=g.create(this,this.popupEffect,null,!1),this.closeEffectHandler=g.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,j.stage.addChild(this),j.stage.on("resize",this,this._onResize),h.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}Q(n,"laya.ui.DialogManager",z);var C=n.prototype;return C._closeOnSide=function(){var H=this.getChildAt(this.numChildren-1);H instanceof laya.ui.Dialog&&H.close("side")},C.setLockView=function(H){this.lockLayer||(this.lockLayer=new q,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(j.stage.width,j.stage.height)),this.lockLayer.removeChildren(),H&&(H.centerX=H.centerY=0,this.lockLayer.addChild(H))},C._onResize=function(H){var n=this.maskLayer.width=j.stage.width,C=this.maskLayer.height=j.stage.height;this.lockLayer&&this.lockLayer.size(n,C),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,n,C,h.popupBgColor),this.maskLayer.alpha=h.popupBgAlpha;for(var r=this.numChildren-1;-1<r;r--){var N=this.getChildAt(r);N.popupCenter&&this._centerDialog(N)}},C._centerDialog=function(H){H.x=Math.round((j.stage.width-H.width>>1)+H.pivotX),H.y=Math.round((j.stage.height-H.height>>1)+H.pivotY)},C.open=function(H,n,C){void 0===n&&(n=!1),void 0===C&&(C=!1),n&&this._closeAll(),H.popupCenter&&this._centerDialog(H),this.addChild(H),(H.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),C&&null!=H.popupEffect?H.popupEffect.runWith(H):this.doOpen(H),this.event("open")},C.doOpen=function(H){H.onOpened()},C.lock=function(H){this.lockLayer&&(H?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},C.close=function(H,n,C){void 0===C&&(C=!1),C&&null!=H.closeEffect?H.closeEffect.runWith([H,n]):this.doClose(H,n),this.event("close")},C.doClose=function(H,n){H.removeSelf(),H.isModal&&this._checkMask(),H.closeHandler&&H.closeHandler.runWith(n),H.onClosed(n)},C.closeAll=function(){this._closeAll(),this.event("close")},C._closeAll=function(){for(var H=this.numChildren-1;-1<H;H--){var n=this.getChildAt(H);n&&null!=n.close&&this.doClose(n)}},C.getDialogsByGroup=function(H){for(var n=[],C=this.numChildren-1;-1<C;C--){var r=this.getChildAt(C);r&&r.group===H&&n.push(r)}return n},C.closeByGroup=function(H){for(var n=[],C=this.numChildren-1;-1<C;C--){var r=this.getChildAt(C);r&&r.group===H&&(r.close(),n.push(r))}return n},C._checkMask=function(){this.maskLayer.removeSelf();for(var H=this.numChildren-1;-1<H;H--){var n=this.getChildAt(H);if(n&&n.isModal)return 1<n.zOrder?this.maskLayer.zOrder=n.zOrder-1:this.maskLayer.zOrder=0,void this.addChildAt(this.maskLayer,H)}},n}(),q=function(H){function n(){n.__super.call(this)}Q(n,"laya.ui.Box",H);var C=n.prototype;return j.imps(C,{"laya.ui.IBox":!0}),I(0,C,"dataSource",H.prototype._$get_dataSource,function(H){for(var n in this._dataSource=H){var C=this.getChildByName(n);C?C.dataSource=H[n]:this.hasOwnProperty(n)&&"function"!=typeof this[n]&&(this[n]=H[n])}}),n}(e),p=function(n){function C(H,n){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,C.__super.call(this),this._labelColors=L.buttonLabelColors,this._stateNum=L.buttonStateNum,void 0===n&&(n=""),this.skin=H,this.label=n}Q(C,"laya.ui.Button",n);var H=C.prototype;return j.imps(H,{"laya.ui.ISelect":!0}),H.destroy=function(H){this.clearEvent(),c.clearCache(this,this._skin),c.clearObject(this,this._weakKey),void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(H),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},H.clearEvent=function(){this._skin&&N.atalsNotify&&N.atalsNotify.off(this._skin,this,this._setBtnSource)},H.createChildren=function(){this.graphics=this._bitmap=new v},H.createText=function(){this._text||(this._text=new w,this._text.overflow=w.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},H.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},H.onMouse=function(H){if(!1!==this.toggle||!this._selected)return"click"===H.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=C.stateMap[H.type]))},H.changeClips=function(){var H=c.getRes(this._skin);if(H)if(this._skin&&""!=this._skin){c.clearObject(this,this._weakKey);var n=H.sourceWidth,C=H.sourceHeight/this._stateNum;H.$_GID||(H.$_GID=i.getGID());var r=H.$_GID+"-"+this._stateNum,N=c.findObject(r);if(i.isOkTextureList(N)||(N=null),N)this._weakKey=r,c.keepObject(this,this._weakKey),this._sources=N;else{if(this._sources=[],1===this._stateNum)this._sources.push(H);else for(var Q=0;Q<this._stateNum;Q++){var I=F.createFromTexture(H,0,C*Q,n,C);if(H.alphaTexture){var A=H.width/H.alphaTexture.width;I.alphaTexture=F.createFromTexture(H.alphaTexture,0/A,C*Q/A,n/A,C/A)}this._sources.push(I)}c.saveObject(r,this._sources),this._weakKey=r,c.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||n,this._bitmap.height=this._height||C,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=n)}else console.warn("lose skin ",this._skin,this.name,this.__className)},H.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var H=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[H]),this.label&&(this._text.color=this._labelColors[H],this._strokeColors&&(this._text.strokeColor=this._strokeColors[H]))},H._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},I(0,H,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(H){this.createText(),this._text.strokeColor=H}),I(0,H,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),I(0,H,"skin",function(){return this._skin},function(H){if(A.window.handleRes&&(H=A.window.handleRes(H)),this._skin!=H)if(this.clearEvent(),c.clearCache(this,this._skin),this._skin=H,c.keepCache(this,this._skin),c.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var n=N.resAtalsObj&&N.resAtalsObj[this._skin];n?(N.atalsNotify&&N.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=n.sourceW),0==this.height&&(this.height=n.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),H._setBtnSource=function(H,n){H===this._skin&&n&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},I(0,H,"state",function(){return this._state},function(H){this._state!=H&&(this._state=H,this._setStateChanged())}),I(0,H,"text",function(){return this.createText(),this._text}),I(0,H,"stateNum",function(){return this._stateNum},function(H){"string"==typeof H&&(H=parseInt(H)),this._stateNum!=H&&(this._stateNum=H<1?1:3<H?3:H,this.callLater(this.changeClips))}),I(0,H,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(H){this._strokeColors=b.fillArray(L.buttonLabelColors,H,String),this._setStateChanged()}),I(0,H,"labelColors",function(){return this._labelColors.join(",")},function(H){this._labelColors=b.fillArray(L.buttonLabelColors,H,String),this._setStateChanged()}),I(0,H,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),I(0,H,"label",function(){return this._text?this._text.text:null},function(H){(this._text||H)&&(this.createText(),this._text.text!=H&&(H&&!this._text.parent&&this.addChild(this._text),this._text.text=(H+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),I(0,H,"selected",function(){return this._selected},function(H){this._selected!=H&&(this._selected=H,this.state=this._selected?2:0,this.event("change"))}),I(0,H,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(H){this.createText(),this._text.padding=b.fillArray(L.labelPadding,H,Number)}),I(0,H,"labelSize",function(){return this.createText(),this._text.fontSize},function(H){this.createText(),this._text.fontSize=H}),I(0,H,"labelStroke",function(){return this.createText(),this._text.stroke},function(H){this.createText(),this._text.stroke=H}),I(0,H,"labelBold",function(){return this.createText(),this._text.bold},function(H){this.createText(),this._text.bold=H}),I(0,H,"labelFont",function(){return this.createText(),this._text.font},function(H){this.createText(),this._text.font=H}),I(0,H,"labelAlign",function(){return this.createText(),this._text.align},function(H){this.createText(),this._text.align=H}),I(0,H,"clickHandler",function(){return this._clickHandler},function(H){this._clickHandler=H}),I(0,H,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(H){this._bitmap.sizeGrid=b.fillArray(L.defaultSizeGrid,H,Number)}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(e,this,"width",H),this._autoSize&&(this._bitmap.width=H,this._text&&(this._text.width=H))}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(e,this,"height",H),this._autoSize&&(this._bitmap.height=H,this._text&&(this._text.height=H))}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)||"string"==typeof H?this.label=H+"":j.superSet(e,this,"dataSource",H)}),I(0,H,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(H){this._bitmap._offset=H?b.fillArray([1,1],H,Number):[]}),r(C,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),C}(e),m=function(n){function r(H,n,C){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,r.__super.call(this),void 0===n&&(n=1),void 0===C&&(C=1),this._clipX=n,this._clipY=C,this.skin=H}Q(r,"laya.ui.Clip",n);var H=r.prototype;return H.destroy=function(H){this.clearEvent(),this.clearLoad(),c.clearCache(this,this._skin),c.clearObject(this,this._weakKey),void 0===H&&(H=!0),n.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},H.dispose=function(){this.destroy(!0),j.loader.clearRes(this._skin)},H.createChildren=function(){this.graphics=this._bitmap=new v},H._onDisplay=function(H){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},H.changeClip=function(){if(this._clipChanged=!1,this._skin){var H=c.getRes(this._skin);if(H)this.loadComplete(this._skin,H);else{if(N.resAtalsObj&&N.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=g.create(this,this.loadComplete,[this._skin]),this._progress=null,j.loader.load(this._skin,this._complete,this._progress)}}},H.loadComplete=function(H,n){if(H===this._skin&&n){c.clearObject(this,this._weakKey);var C=this._clipWidth||Math.ceil(n.sourceWidth/this._clipX),r=this._clipHeight||Math.ceil(n.sourceHeight/this._clipY),N=this._skin+C+r,Q=c.findObject(N);if(i.isOkTextureList(Q)||(Q=null),Q)this._weakKey=N,c.keepObject(this,this._weakKey),this._sources=Q;else{this._sources=[];for(var I=0;I<this._clipY;I++)for(var A=0;A<this._clipX;A++){var P=F.createFromTexture(n,C*A,r*I,C,r);if(n.alphaTexture){var t=n.width/n.alphaTexture.width;P.alphaTexture=F.createFromTexture(n.alphaTexture,C*A/t,r*I/t,C/t,r/t)}this._sources.push(P)}c.saveObject(N,this._sources),this._weakKey=N,c.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},H.play=function(H,n){void 0===H&&(H=0),void 0===n&&(n=-1),this._isPlaying=!0,this.index=H,this._toIndex=n,this._index++,j.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},H._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},H.stop=function(){this._isPlaying=!1,j.timer.clear(this,this._loop),this.event("complete")},H._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},I(0,H,"interval",function(){return this._interval},function(H){this._interval!=H&&(this._interval=H,this._isPlaying&&this.play())}),H.clearEvent=function(){this._skin&&N.atalsNotify&&N.atalsNotify.off(this._skin,this,this._setBtnSource)},H.clearLoad=function(){this._skin&&((this._complete||this._progress)&&j.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},I(0,H,"skin",function(){return this._skin},function(H){if(A.window.handleRes&&(H=A.window.handleRes(H)),this._skin!=H)if(this.clearLoad(),this.clearEvent(),c.clearCache(this,this._skin),this._skin=H){c.keepCache(this,this._skin);var n=c.getRes(H),C=N.resAtalsObj&&N.resAtalsObj[this._skin];!n&&C?N.atalsNotify&&N.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),H._setBtnSource=function(H,n){H===this._skin&&n&&(this.loadComplete(H,n),this.clearEvent())},I(0,H,"sources",function(){return this._sources},function(H){this._sources=H,this.index=this._index,this.event("loaded")}),I(0,H,"clipX",function(){return this._clipX},function(H){this._clipX=H||1,this._setClipChanged()}),I(0,H,"clipY",function(){return this._clipY},function(H){this._clipY=H||1,this._setClipChanged()}),I(0,H,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),I(0,H,"clipWidth",function(){return this._clipWidth},function(H){this._clipWidth=H,this._setClipChanged()}),I(0,H,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(H){this._bitmap.sizeGrid=b.fillArray(L.defaultSizeGrid,H,Number)}),I(0,H,"group",function(){return this._group},function(H){H&&this._skin&&c.setGroup(this._skin,H),this._group=H}),I(0,H,"clipHeight",function(){return this._clipHeight},function(H){this._clipHeight=H,this._setClipChanged()}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(e,this,"width",H),this._bitmap.width=H}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(e,this,"height",H),this._bitmap.height=H}),I(0,H,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),I(0,H,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),I(0,H,"index",function(){return this._index},function(H){this._index=H,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[H]),this.event("change")}),I(0,H,"autoPlay",function(){return this._autoPlay},function(H){this._autoPlay!=H&&((this._autoPlay=H)?this.play():this.stop())}),I(0,H,"isPlaying",function(){return this._isPlaying},function(H){this._isPlaying=H}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)&&Math.floor(H)==H||"string"==typeof H?this.index=parseInt(H):j.superSet(e,this,"dataSource",H)}),I(0,H,"bitmap",function(){return this._bitmap}),r}(e),d=function(n){function H(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,H.__super.call(this)}Q(H,"laya.ui.ColorPicker",n);var C=H.prototype;return C.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._colorPanel&&this._colorPanel.destroy(H),this._colorButton&&this._colorButton.destroy(H),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},C.createChildren=function(){this.addChild(this._colorButton=new p),this._colorPanel=new q,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new z),this._colorPanel.addChild(this._colorBlock=new z),this._colorPanel.addChild(this._colorInput=new M)},C.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},C.onPanelMouseDown=function(H){H.stopPropagation()},C.changePanel=function(){this._panelChanged=!1;var H=this._colorPanel.graphics;H.clear(),H.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(H=this._colorTiles.graphics).clear();for(var n=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],C=0;C<12;C++)for(var r=0;r<20;r++){var N=0;N=0===r?n[C]:1===r?0:51*(((3*C+r/6)%3<<0)+3*(C/6<<0))<<16|r%6*51<<8|(C<<0)%6*51;var Q=b.toColor(N);this._colors.push(Q);var I=r*this._gridSize,A=C*this._gridSize;H.drawRect(I,A,this._gridSize,this._gridSize,Q,"#000000")}},C.onColorButtonClick=function(H){this._colorPanel.parent?this.close():this.open()},C.open=function(){var H=this.localToGlobal(new f),n=H.x+this._colorPanel.width<=j.stage.width?H.x:j.stage.width-this._colorPanel.width,C=H.y+this._colorButton.height;C=C+this._colorPanel.height<=j.stage.height?C:H.y-this._colorPanel.height,this._colorPanel.pos(n,C),this._colorPanel.zOrder=1001,j._currentStage.addChild(this._colorPanel),j.stage.on("mousedown",this,this.removeColorBox)},C.close=function(){j.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},C.removeColorBox=function(H){this.close()},C.onColorFieldKeyDown=function(H){13==H.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),H.stopPropagation())},C.onColorInputChange=function(H){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},C.onColorTilesClick=function(H){this.selectedColor=this.getColorByMouse(),this.close()},C.onColorTilesMouseMove=function(H){this._colorInput.focus=!1;var n=this.getColorByMouse();this._colorInput.text=n,this.drawBlock(n)},C.getColorByMouse=function(){var H=this._colorTiles.getMousePoint(),n=Math.floor(H.x/this._gridSize),C=Math.floor(H.y/this._gridSize);return this._colors[20*C+n]},C.drawBlock=function(H){var n=this._colorBlock.graphics;n.clear();var C=H||"#ffffff";n.drawRect(0,0,50,20,C,this._borderColor),H||n.drawLine(0,0,50,20,"#ff0000")},C.changeColor=function(){var H=this.graphics;H.clear();var n=this._selectedColor||"#000000";H.drawRect(0,0,this._colorButton.width,this._colorButton.height,n)},C._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},I(0,C,"inputBgColor",function(){return this._inputBgColor},function(H){this._inputBgColor=H,this._setPanelChanged()}),I(0,C,"selectedColor",function(){return this._selectedColor},function(H){this._selectedColor!=H&&(this._selectedColor=this._colorInput.text=H,this.drawBlock(H),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",R.EMPTY.setTo("change",this,this)))}),I(0,C,"skin",function(){return this._colorButton.skin},function(H){this._colorButton.skin=H,this.changeColor()}),I(0,C,"bgColor",function(){return this._bgColor},function(H){this._bgColor=H,this._setPanelChanged()}),I(0,C,"borderColor",function(){return this._borderColor},function(H){this._borderColor=H,this._setPanelChanged()}),I(0,C,"inputColor",function(){return this._inputColor},function(H){this._inputColor=H,this._setPanelChanged()}),H}(e),_=function(n){function C(H,n){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,C.__super.call(this),this._itemColors=L.comboBoxItemColors,this.skin=H,this.labels=n}Q(C,"laya.ui.ComboBox",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._button&&this._button.destroy(H),this._list&&this._list.destroy(H),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},H.createChildren=function(){this.addChild(this._button=new p),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},H._createList=function(){this._list=new J,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},H._setListEvent=function(H){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=g.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},H.onListDown=function(H){H.stopPropagation()},H.onScrollBarDown=function(H){H.stopPropagation()},H.onButtonMouseDown=function(H){this.callLater(this.switchTo,[!this._isOpen])},H.changeList=function(){this._listChanged=!1;var H=this.width-2,n=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:H,height:this._itemHeight,fontSize:this._itemSize,color:n}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},H.onlistItemMouse=function(H,n){var C=H.type;if("mouseover"===C||"mouseout"===C){if(this._isCustomList)return;var r=this._list.getCell(n);if(!r)return;var N=r.getChildByName("label");N&&("mouseover"===C?(N.bgColor=this._itemColors[0],N.color=this._itemColors[1]):(N.bgColor=null,N.color=this._itemColors[2]))}else"click"===C&&(this.selectedIndex=n,this.isOpen=!1)},H.switchTo=function(H){this.isOpen=H},H.changeOpen=function(){this.isOpen=!this._isOpen},H.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var H=this._list.graphics;H.clear(),H.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var n=this._list.array||[],C=n.length=0,r=this._labels.length;C<r;C++)n.push({label:this._labels[C]});this._list.height=this._listHeight,this._list.array=n},H.changeSelected=function(){this._button.label=this.selectedLabel},H._onStageMouseWheel=function(H){this._list&&!this._list.contains(H.target)&&this.removeList(null)},H.removeList=function(H){j.stage.off("mousedown",this,this.removeList),j.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},I(0,H,"selectedIndex",function(){return this._selectedIndex},function(H){this._selectedIndex!=H&&(this._selectedIndex=H,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[R.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),I(0,H,"measureHeight",function(){return this._button.height}),I(0,H,"skin",function(){return this._button.skin},function(H){this._button.skin!=H&&(this._button.skin=H,this._listChanged=!0)}),I(0,H,"measureWidth",function(){return this._button.width}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(e,this,"width",H),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),I(0,H,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(H){this.selectedIndex=this._labels.indexOf(H)}),I(0,H,"labels",function(){return this._labels.join(",")},function(H){0<this._labels.length&&(this.selectedIndex=-1),H?this._labels=H.split(","):this._labels.length=0,this._itemChanged=!0}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(e,this,"height",H),this._button.height=this._height}),I(0,H,"selectHandler",function(){return this._selectHandler},function(H){this._selectHandler=H}),I(0,H,"visibleNum",function(){return this._visibleNum},function(H){this._visibleNum=H,this._listChanged=!0}),I(0,H,"labelBold",function(){return this._button.text.bold},function(H){this._button.text.bold=H}),I(0,H,"itemColors",function(){return String(this._itemColors)},function(H){this._itemColors=b.fillArray(this._itemColors,H,String),this._listChanged=!0}),I(0,H,"itemSize",function(){return this._itemSize},function(H){this._itemSize=H,this._listChanged=!0}),I(0,H,"scrollBar",function(){return this.list.scrollBar}),I(0,H,"isOpen",function(){return this._isOpen},function(H){if(this._isOpen!=H)if(this._isOpen=H,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var n=this.localToGlobal(f.TEMP.setTo(0,0)),C=n.y+this._button.height;C=C+this._listHeight<=j.stage.height?C:n.y-this._listHeight,this._list.pos(n.x,C),this._list.zOrder=1001,j._currentStage.addChild(this._list),j.stage.once("mousedown",this,this.removeList),j.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),I(0,H,"scrollBarSkin",function(){return this._scrollBarSkin},function(H){this._scrollBarSkin=H}),I(0,H,"sizeGrid",function(){return this._button.sizeGrid},function(H){this._button.sizeGrid=H}),I(0,H,"button",function(){return this._button}),I(0,H,"list",function(){return this._list||this._createList(),this._list},function(H){H&&(H.removeSelf(),this._isCustomList=!0,this._list=H,this._setListEvent(H),this._itemHeight=H.getCell(0).height+H.spaceY)}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)&&Math.floor(H)==H||"string"==typeof H?this.selectedIndex=parseInt(H):H instanceof Array?this.labels=H.join(","):j.superSet(e,this,"dataSource",H)}),I(0,H,"labelColors",function(){return this._button.labelColors},function(H){this._button.labelColors!=H&&(this._button.labelColors=H)}),I(0,H,"labelPadding",function(){return this._button.text.padding.join(",")},function(H){this._button.text.padding=b.fillArray(L.labelPadding,H,Number)}),I(0,H,"labelSize",function(){return this._button.text.fontSize},function(H){this._button.text.fontSize=H}),I(0,H,"labelFont",function(){return this._button.text.font},function(H){this._button.text.font=H}),I(0,H,"stateNum",function(){return this._button.stateNum},function(H){this._button.stateNum=H}),C}(e),U=function(n){function C(H){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=200,this.elasticBackTime=100,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,C.__super.call(this),this._showButtons=h.showButtons,this._touchScrollEnable=h.touchScrollEnable,this._mouseWheelEnable=h.mouseWheelEnable,this.skin=H,this.max=1}Q(C,"laya.ui.ScrollBar",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),this.stopScroll(),this.target=null,n.prototype.destroy.call(this,H),this.upButton&&this.upButton.destroy(H),this.downButton&&this.downButton.destroy(H),this.slider&&this.slider.destroy(H),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},H.createChildren=function(){this.addChild(this.slider=new s),this.addChild(this.upButton=new p),this.addChild(this.downButton=new p)},H.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},H.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},H.onButtonMouseDown=function(H){var n=H.currentTarget===this.upButton;this.slide(n),j.timer.once(L.scrollBarDelayTime,this,this.startLoop,[n]),j.stage.once("mouseup",this,this.onStageMouseUp)},H.startLoop=function(H){j.timer.frameLoop(1,this,this.slide,[H])},H.slide=function(H){H?this.value-=this._scrollSize:this.value+=this._scrollSize},H.onStageMouseUp=function(H){j.timer.clear(this,this.startLoop),j.timer.clear(this,this.slide)},H.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},H.changeSize=function(){n.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},H.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},H.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},H.setScroll=function(H,n,C){this.runCallLater(this.changeSize),this.slider.setSlider(H,n,C),this.slider.bar.visible=0<n,!this._hide&&this.autoHide&&(this.visible=!1)},H.onTargetMouseWheel=function(H){this.value-=H.delta*this._scrollSize,this.target=this._target},H.onTargetMouseDown=function(H){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new f),this._lastPoint.setTo(j.stage.mouseX,j.stage.mouseY),j.timer.clear(this,this.tweenMove),k.clearTween(this),j.stage.once("mouseup",this,this.onStageMouseUp2),j.stage.once("mouseout",this,this.onStageMouseUp2),j.timer.frameLoop(1,this,this.loop)},H.loop=function(){var H=j.stage.mouseY,n=j.stage.mouseX;if(this._lastOffset=this.isVertical?H-this._lastPoint.y:n-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?j.stage._canvasTransform.getScaleY():j.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=n,this._lastPoint.y=H,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},H.onStageMouseUp2=function(H){if(j.stage.off("mouseup",this,this.onStageMouseUp2),j.stage.off("mouseout",this,this.onStageMouseUp2),j.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?k.to(this,{value:this.min},this.elasticBackTime,t.sineOut,g.create(this,this.elasticOver)):this._value>this.max&&k.to(this,{value:this.max},this.elasticBackTime,t.sineOut,g.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?j.stage.mouseY-this._lastPoint.y:j.stage.mouseX-this._lastPoint.x);for(var n=0,C=Math.min(this._offsets.length,3),r=0;r<C;r++)n+=this._offsets[this._offsets.length-1-r];if(this._lastOffset=n/C,(n=Math.abs(this._lastOffset))<2)return void this.event("end");60<n&&(this._lastOffset=0<this._lastOffset?60:-60);var N=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));j.timer.frameLoop(1,this,this.tweenMove,[N])}},H.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&k.to(this,{alpha:0},500),this.event("end")},H.tweenMove=function(H){this._lastOffset*=this.rollRatio;var n=NaN;if(100<H&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,n=.5*-(this.min-H-this.value),this._lastOffset>n&&(this._lastOffset=n)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,n=.5*-(this.max+H-this.value),this._lastOffset<n&&(this._lastOffset=n))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(j.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?k.to(this,{value:this.min},this.elasticBackTime,t.sineOut,g.create(this,this.elasticOver)):this._value>this.max?k.to(this,{value:this.max},this.elasticBackTime,t.sineOut,g.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&k.to(this,{alpha:0},500)}},H.stopScroll=function(){this.onStageMouseUp2(null),j.timer.clear(this,this.tweenMove),k.clearTween(this)},I(0,H,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),I(0,H,"skin",function(){return this._skin},function(H){this._skin!=H&&(this._skin=H,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),I(0,H,"max",function(){return this.slider.max},function(H){this.slider.max=H}),I(0,H,"showButtons",function(){return this._showButtons},function(H){this._showButtons=H,this.callLater(this.changeScrollBar)}),I(0,H,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),I(0,H,"min",function(){return this.slider.min},function(H){this.slider.min=H}),I(0,H,"value",function(){return this._value},function(H){H!==this._value&&(this._value=H,this._isElastic||(this.slider._value!=H&&(this.slider._value=H,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),I(0,H,"isVertical",function(){return this.slider.isVertical},function(H){this.slider.isVertical=H}),I(0,H,"sizeGrid",function(){return this.slider.sizeGrid},function(H){this.slider.sizeGrid=H}),I(0,H,"scrollSize",function(){return this._scrollSize},function(H){this._scrollSize=H}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)||"string"==typeof H?this.value=Number(H):j.superSet(e,this,"dataSource",H)}),I(0,H,"thumbPercent",function(){return this._thumbPercent},function(H){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),H=1<=H?.99:H,this._thumbPercent=H,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*H,L.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*H,L.scrollBarMinNum))}),I(0,H,"target",function(){return this._target},function(H){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=H)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),I(0,H,"hide",function(){return this._hide},function(H){this._hide=H,this.visible=!H}),I(0,H,"touchScrollEnable",function(){return this._touchScrollEnable},function(H){this._touchScrollEnable=H,this.target=this._target}),I(0,H,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(H){this._mouseWheelEnable=H,this.target=this._target}),I(0,H,"tick",function(){return this.slider.tick},function(H){this.slider.tick=H}),C}(e),s=function(n){function C(H){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,C.__super.call(this),this.skin=H}Q(C,"laya.ui.Slider",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._bg&&this._bg.destroy(H),this._bar&&this._bar.destroy(H),this._progress&&this._progress.destroy(H),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},H.createChildren=function(){this.addChild(this._bg=new $),this.addChild(this._bar=new p)},H.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},H.onBarMouseDown=function(H){this._globalSacle||(this._globalSacle=new f),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=j.stage.mouseX,this._ty=j.stage.mouseY,j.stage.on("mousemove",this,this.mouseMove),j.stage.once("mouseup",this,this.mouseUp),j.stage.once("mouseout",this,this.mouseUp),this.showValueText()},H.showValueText=function(){if(this.showLabel){var H=laya.ui.Slider.label;this.addChild(H),H.textField.changeText(this._value+""),this.isVertical?(H.x=this._bar.x+20,H.y=.5*(this._bar.height-H.height)+this._bar.y):(H.y=this._bar.y-20,H.x=.5*(this._bar.width-H.width)+this._bar.x)}},H.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},H.mouseUp=function(H){j.stage.off("mousemove",this,this.mouseMove),j.stage.off("mouseup",this,this.mouseUp),j.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},H.mouseMove=function(H){var n=this._value;this.isVertical?(this._bar.y+=(j.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(j.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=j.stage.mouseX,this._ty=j.stage.mouseY;var C=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*C)/C,this._value!=n&&this.sendChangeEvent(),this.showValueText()},H.sendChangeEvent=function(H){void 0===H&&(H="change"),this.event(H),this.changeHandler&&this.changeHandler.runWith(this._value)},H.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},H.changeSize=function(){n.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},H.setSlider=function(H,n,C){this._value=-1,this._min=H,this._max=H<n?n:H,this.value=C<H?H:n<C?n:C},H.changeValue=function(){var H=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*H)/H,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var n=this._max-this._min;0===n&&(n=1),this.isVertical?(this._bar.y=(this._value-this._min)/n*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/n*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},H.onBgMouseDown=function(H){var n=this._bg.getMousePoint();this.isVertical?this.value=n.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=n.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},I(0,H,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),I(0,H,"skin",function(){return this._skin},function(H){if(A.window.handleRes&&(H=A.window.handleRes(H)),this._skin!=H){this._skin=H,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var n=this._skin.replace(".png","$progress.png");c.getRes(n)&&(this._progress||(this.addChild(this._progress=new $),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=n),this.setBarPoint(),this.callLater(this.changeValue)}}),I(0,H,"allowClickBack",function(){return this._allowClickBack},function(H){this._allowClickBack!=H&&((this._allowClickBack=H)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),I(0,H,"max",function(){return this._max},function(H){this._max!=H&&(this._max=H,this.callLater(this.changeValue))}),I(0,H,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),I(0,H,"tick",function(){return this._tick},function(H){this._tick!=H&&(this._tick=H,this.callLater(this.changeValue))}),I(0,H,"sizeGrid",function(){return this._bg.sizeGrid},function(H){this._bg.sizeGrid=H,this._bar.sizeGrid=H,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),I(0,H,"min",function(){return this._min},function(H){this._min!=H&&(this._min=H,this.callLater(this.changeValue))}),I(0,H,"value",function(){return this._value},function(H){if(this._value!=H){var n=this._value;this._value=H,this.changeValue(),this._value!=n&&this.sendChangeEvent()}}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)||"string"==typeof H?this.value=Number(H):j.superSet(e,this,"dataSource",H)}),I(0,H,"bar",function(){return this._bar}),r(C,["label",function(){return this.label=new x}]),C}(e),$=function(n){function C(H){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,C.__super.call(this),this.skin=H}Q(C,"laya.ui.Image",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,c.clearCache(this,this._skin)},H.dispose=function(){this.destroy(!0),c.clearCache(this,this._skin),this.clearEvent()},H.createChildren=function(){this.graphics=this._bitmap=new v},H.setSource=function(H,n){this.destroyed||H===this._skin&&n&&(this.source=n,this.onCompResize(),this.clearEvent())},H.clearEvent=function(){this._skin&&N.atalsNotify&&N.atalsNotify.off(this._skin,this,this.setSource)},H.clearLoad=function(){this._skin&&((this._complete||this._progress)&&j.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},I(0,H,"source",function(){return this._bitmap.source},function(H){this._bitmap&&(this._bitmap.source=H,this.event("loaded"),this.repaint())}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"string"==typeof(this._dataSource=H)?this.skin=H:j.superSet(e,this,"dataSource",H)}),I(0,H,"measureHeight",function(){return this._bitmap.height}),I(0,H,"skin",function(){return this._skin},function(H){if(A.window.handleRes&&(H=A.window.handleRes(H)),this._skin!=H)if(c.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=H){c.keepCache(this,this._skin);var n=c.getRes(H),C=N.resAtalsObj&&N.resAtalsObj[this._skin];n?(this.source=n,this.onCompResize()):C?(N.atalsNotify&&N.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=C.sourceW),0==this.height&&(this.height=C.sourceH)):(this._complete=g.create(this,this.setSource,[this._skin]),this._progress=null,j.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),I(0,H,"group",function(){return this._group},function(H){H&&this._skin&&c.setGroup(this._skin,H),this._group=H}),I(0,H,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(H){this._bitmap.sizeGrid=b.fillArray(L.defaultSizeGrid,H,Number)}),I(0,H,"measureWidth",function(){return this._bitmap.width}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(e,this,"width",H),this._bitmap.width=0==H?1e-7:H}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(e,this,"height",H),this._bitmap.height=0==H?1e-7:H}),C}(e),x=function(n){function C(H){this._tf=null,C.__super.call(this),void 0===H&&(H=""),y.defaultColor=L.labelColor,this.text=H}Q(C,"laya.ui.Label",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._tf=null},H.createChildren=function(){this.addChild(this._tf=new w)},H.changeText=function(H){this._tf.changeText(H)},I(0,H,"padding",function(){return this._tf.padding.join(",")},function(H){this._tf.padding=b.fillArray(L.labelPadding,H,Number)}),I(0,H,"bold",function(){return this._tf.bold},function(H){this._tf.bold=H}),I(0,H,"align",function(){return this._tf.align},function(H){this._tf.align=H}),I(0,H,"text",function(){return this._tf.text},function(H){this._tf.text!=H&&(H&&(H=b.adptString(H+"")),this._tf.text=H,this.event("change"),this._width&&this._height||this.onCompResize())}),I(0,H,"italic",function(){return this._tf.italic},function(H){this._tf.italic=H}),I(0,H,"wordWrap",function(){return this._tf.wordWrap},function(H){this._tf.wordWrap=H}),I(0,H,"font",function(){return this._tf.font},function(H){this._tf.font=H}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)||"string"==typeof H?this.text=H+"":j.superSet(e,this,"dataSource",H)}),I(0,H,"color",function(){return this._tf.color},function(H){this._tf.color=H}),I(0,H,"valign",function(){return this._tf.valign},function(H){this._tf.valign=H}),I(0,H,"leading",function(){return this._tf.leading},function(H){this._tf.leading=H}),I(0,H,"fontSize",function(){return this._tf.fontSize},function(H){this._tf.fontSize=H}),I(0,H,"bgColor",function(){return this._tf.bgColor},function(H){this._tf.bgColor=H}),I(0,H,"borderColor",function(){return this._tf.borderColor},function(H){this._tf.borderColor=H}),I(0,H,"stroke",function(){return this._tf.stroke},function(H){this._tf.stroke=H}),I(0,H,"strokeColor",function(){return this._tf.strokeColor},function(H){this._tf.strokeColor=H}),I(0,H,"textField",function(){return this._tf}),I(0,H,"measureWidth",function(){return this._tf.width}),I(0,H,"measureHeight",function(){return this._tf.height}),I(0,H,"width",function(){return this._width||this._tf.text?j.superGet(e,this,"width"):0},function(H){j.superSet(e,this,"width",H),this._tf.width=H}),I(0,H,"height",function(){return this._height||this._tf.text?j.superGet(e,this,"height"):0},function(H){j.superSet(e,this,"height",H),this._tf.height=H}),I(0,H,"overflow",function(){return this._tf.overflow},function(H){this._tf.overflow=H}),I(0,H,"underline",function(){return this._tf.underline},function(H){this._tf.underline=H}),I(0,H,"underlineColor",function(){return this._tf.underlineColor},function(H){this._tf.underlineColor=H}),C}(e),O=function(n){function C(H){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,C.__super.call(this),this.skin=H}Q(C,"laya.ui.ProgressBar",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._bg&&this._bg.destroy(H),this._bar&&this._bar.destroy(H),this._bg=this._bar=null,this.changeHandler=null},H.createChildren=function(){this.addChild(this._bg=new $),this.addChild(this._bar=new $)},H.changeValue=function(){if(this.sizeGrid){var H=this.sizeGrid.split(","),n=Number(H[3]),C=Number(H[1]),r=(this.width-n-C)*this._value;this._bar.width=n+C+r,this._bar.visible=this._bar.width>n+C}else this._bar.width=this.width*this._value},I(0,H,"measureHeight",function(){return this._bg.height}),I(0,H,"skin",function(){return this._skin},function(H){this._skin!=H&&(this._skin=H,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),I(0,H,"measureWidth",function(){return this._bg.width}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(e,this,"height",H),this._bg.height=this._height,this._bar.height=this._height}),I(0,H,"bar",function(){return this._bar}),I(0,H,"value",function(){return this._value},function(H){this._value!=H&&(H=1<H?1:H<0?0:H,this._value=H,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(H))}),I(0,H,"bg",function(){return this._bg}),I(0,H,"sizeGrid",function(){return this._bg.sizeGrid},function(H){this._bg.sizeGrid=this._bar.sizeGrid=H}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(e,this,"width",H),this._bg.width=this._width,this.callLater(this.changeValue)}),I(0,H,"dataSource",n.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)||"string"==typeof H?this.value=Number(H):j.superSet(e,this,"dataSource",H)}),C}(e),S=(function(H){function C(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,C.__super.call(this),this._tipBox=new e,this._tipBox.addChild(this._tipText=new w),this._tipText.x=this._tipText.y=5,this._tipText.color=C.tipTextColor,this._defaultTipHandler=this._showDefaultTip,j.stage.on("showtip",this,this._onStageShowTip),j.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}Q(C,"laya.ui.TipManager",e);var n=C.prototype;n._onStageHideTip=function(H){j.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},n._onStageShowTip=function(H){j.timer.once(C.tipDelay,this,this._showTip,[H],!0)},n._showTip=function(H){if("string"==typeof H){var n=String(H);Boolean(n)&&this._defaultTipHandler(n)}else H instanceof laya.utils.Handler?H.run():"function"==typeof H&&H.apply();j.stage.on("mousemove",this,this._onStageMouseMove),j.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},n._onStageMouseDown=function(H){this.closeAll()},n._onStageMouseMove=function(H){this._showToStage(this,C.offsetX,C.offsetY)},n._showToStage=function(H,n,C){void 0===n&&(n=0),void 0===C&&(C=0);var r=H.getBounds();H.x=j.stage.mouseX+n,H.y=j.stage.mouseY+C,H.x+r.width>j.stage.width&&(H.x-=r.width+n),H.y+r.height>j.stage.height&&(H.y-=r.height+C)},n.closeAll=function(){j.timer.clear(this,this._showTip),j.stage.off("mousemove",this,this._onStageMouseMove),j.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},n.showDislayTip=function(H){this.addChild(H),this._showToStage(this),j._currentStage.addChild(this)},n._showDefaultTip=function(H){this._tipText.text=H;var n=this._tipBox.graphics;n.clear(),n.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,C.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),j._currentStage.addChild(this)},I(0,n,"defaultTipHandler",function(){return this._defaultTipHandler},function(H){this._defaultTipHandler=H}),C.offsetX=10,C.offsetY=15,C.tipTextColor="#ffffff",C.tipBackColor="#111111",C.tipDelay=200}(),function(H){var g;function M(){this._idMap=null,this._aniList=null,this._watchMap={},M.__super.call(this)}Q(M,"laya.ui.View",q);var n=M.prototype;return n.createView=function(H){if(H.animations&&!this._idMap&&(this._idMap={}),M.createComp(H,this,this),H.animations){var n,C,r=[],N=H.animations,Q=0,I=N.length;for(Q=0;Q<I;Q++){switch(n=new o,C=N[Q],n._setUp(this._idMap,C),(this[C.name]=n)._setControlNode(this),C.action){case 1:n.play(0,!1);break;case 2:n.play(0,!0)}r.push(n)}this._aniList=r}0<this._width&&null==H.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},n.onEvent=function(H,n){},n.loadUI=function(H){var n=M.uiMap[H];n&&this.createView(n)},n.destroy=function(H){void 0===H&&(H=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,H)},n.changeData=function(H){var n=this._watchMap[H];if(n){console.log("change",H);for(var C=0,r=n.length;C<r;C++){n[C].exe(this)}}},M._regs=function(){for(var H in M.uiClassMap)l.regClass(H,M.uiClassMap[H])},M.createComp=function(H,n,C,r){if(!(n=n||M.getCompInstance(H)))return console.warn("can not create:"+H.type),null;var N=H.child;if(N)for(var Q=n instanceof laya.ui.List,I=0,A=N.length;I<A;I++){var P=N[I];if(!n.hasOwnProperty("itemRender")||"render"!=P.props.name&&"render"!==P.props.renderType)if("Graphic"==P.type)l.addGraphicsToSprite(P,n);else if(l.isDrawType(P.type))l.addGraphicToSprite(P,n,!0);else{if(Q){var t=[],R=M.createComp(P,null,C,t);t.length&&(R._$bindData=t)}else R=M.createComp(P,null,C,r);"Script"==P.type?"owner"in R?R.owner=n:"target"in R&&(R.target=n):"mask"==P.props.renderType||"mask"==P.props.name?n.mask=R:R instanceof laya.display.Sprite&&n.addChild(R)}else n.itemRender=P}var y=H.props;for(var o in y){var g=y[o];M.eventDic[o]?g&&C&&n.on(o,C,C.onEvent,[g]):M.setCompValue(n,o,g,C,r)}return j.__typeof(n,"laya.ui.IItem")&&n.initItems(),H.compId&&C&&C._idMap&&(C._idMap[H.compId]=n),n},M.setCompValue=function(H,n,C,r,N){if("string"==typeof C&&-1<C.indexOf("${")){if(M._sheet||(M._sheet=l.getClass("laya.data.Table")),!M._sheet)return void console.warn("Can not find class Sheet");if(N)N.push(H,n,C);else if(r){-1==C.indexOf("].")&&(C=C.replace(".","[0]."));var Q,I,A=new g(H,n,C);A.exe(r);for(var P=C.replace(/\[.*?\]\./g,".");null!=(Q=M._parseWatchData.exec(P));){for(var t=Q[1];null!=(I=M._parseKeyWord.exec(t));){var R=I[0],y=r._watchMap[R]||(r._watchMap[R]=[]);y.push(A),M._sheet.I.notifer.on(R,r,r.changeData,[R])}(y=r._watchMap[t]||(r._watchMap[t]=[])).push(A),M._sheet.I.notifer.on(t,r,r.changeData,[t])}}}else if("var"===n&&r)r[C]=H;else if("onClick"==n){var o=j._runScript("(function(){"+C+"})");H.on("click",r,o)}else H[n]="true"===C||"false"!==C&&C},M.getCompInstance=function(H){var n,C=H.props?H.props.runtime:null;return n=C?M.viewClassMap[C]||M.uiClassMap[C]||j.__classmap[C]:M.uiClassMap[H.type],H.props&&H.props.hasOwnProperty("renderType")&&"instance"==H.props.renderType?n.instance:n?new n:null},M.regComponent=function(H,n){M.uiClassMap[H]=n,l.regClass(H,n)},M.regViewRuntime=function(H,n){M.viewClassMap[H]=n},M.uiMap={},M.viewClassMap={},M._sheet=null,r(M,["uiClassMap",function(){return this.uiClassMap={ViewStack:nH,LinkButton:p,TextArea:RH,ColorPicker:d,Box:q,Button:p,CheckBox:T,Clip:m,ComboBox:_,Component:e,HScrollBar:Y,HSlider:X,Image:$,Label:x,List:J,Panel:u,ProgressBar:O,Radio:B,RadioGroup:PH,ScrollBar:U,Slider:s,Tab:tH,TextInput:rH,View:M,VScrollBar:CH,VSlider:NH,Tree:HH,HBox:IH,VBox:AH,Sprite:z,Animation:C,Text:w,FontClip:G}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),M.__init$=function(){M._regs(),g=function(){function H(H,n,C){this.comp=null,this.prop=null,this.value=null,this.comp=H,this.prop=n,this.value=C}return Q(H,""),H.prototype.exe=function(H){var n=b.getBindFun(this.value);this.comp[this.prop]=n.call(this,H)},H}()},M}()),T=function(H){function C(H,n){void 0===n&&(n=""),C.__super.call(this,H,n)}Q(C,"laya.ui.CheckBox",H);var n=C.prototype;return n.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},n.initialize=function(){H.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},I(0,n,"dataSource",H.prototype._$get_dataSource,function(H){"boolean"==typeof(this._dataSource=H)?this.selected=H:"string"==typeof H?this.selected="true"===H:j.superSet(p,this,"dataSource",H)}),C}(p),E=function(H){function n(){this._space=0,this._align="none",this._itemChanged=!1,n.__super.call(this)}Q(n,"laya.ui.LayoutBox",q);var C=n.prototype;return C.addChild=function(H){return H.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,H)},C.onResize=function(H){this._setItemChanged()},C.addChildAt=function(H,n){return H.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,H,n)},C.removeChild=function(H){return H.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,H)},C.removeChildAt=function(H){return this.getChildAt(H).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,H)},C.refresh=function(){this._setItemChanged()},C.changeItems=function(){this._itemChanged=!1},C.sortItem=function(H){H&&H.sort(function(H,n){return H.y-n.y})},C._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},I(0,C,"space",function(){return this._space},function(H){this._space=H,this._setItemChanged()}),I(0,C,"align",function(){return this._align},function(H){this._align=H,this._setItemChanged()}),n}(),G=function(n){function C(H,n){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,C.__super.call(this),H&&(this.skin=H),n&&(this.sheet=n)}Q(C,"laya.ui.FontClip",n);var H=C.prototype;return H.createChildren=function(){this._bitmap=new v,this.on("loaded",this,this._onClipLoaded)},H._onClipLoaded=function(){this.callLater(this.changeValue)},H.changeValue=function(){var H;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),H=this._sources[0]))){var n="horizontal"===this._direction;n?(this._wordsW=this._valueArr.length*(H.sourceWidth+this.spaceX),this._wordsH=H.sourceHeight):(this._wordsW=H.sourceWidth,this._wordsH=(H.sourceHeight+this.spaceY)*this._valueArr.length);var C=0;if(this._width)switch(this._align){case"center":C=.5*(this._width-this._wordsW);break;case"right":C=this._width-this._wordsW;break;default:C=0}for(var r=0,N=this._valueArr.length;r<N;r++){var Q=this._indexMap[this._valueArr.charAt(r)];this.sources[Q]&&(H=this.sources[Q],n?this.graphics.drawTexture(H,C+r*(H.sourceWidth+this.spaceX),0,H.sourceWidth,H.sourceHeight):this.graphics.drawTexture(H,0+C,r*(H.sourceHeight+this.spaceY),H.sourceWidth,H.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},H.destroy=function(H){void 0===H&&(H=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),n.prototype.destroy.call(this,H)},I(0,H,"sheet",function(){return this._sheet},function(H){H+="";var n=(this._sheet=H).split(" ");this._clipX=String(n[0]).length,this.clipY=n.length,this._indexMap={};for(var C=0;C<this._clipY;C++)for(var r=n[C].split(""),N=0,Q=r.length;N<Q;N++)this._indexMap[r[N]]=C*this._clipX+N}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(m,this,"height",H),this.callLater(this.changeValue)}),I(0,H,"direction",function(){return this._direction},function(H){this._direction=H,this.callLater(this.changeValue)}),I(0,H,"value",function(){return this._valueArr?this._valueArr:""},function(H){H+="",this._valueArr=H,this.callLater(this.changeValue)}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(m,this,"width",H),this.callLater(this.changeValue)}),I(0,H,"spaceX",function(){return this._spaceX},function(H){this._spaceX=H,"horizontal"===this._direction&&this.callLater(this.changeValue)}),I(0,H,"spaceY",function(){return this._spaceY},function(H){this._spaceY=H,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),I(0,H,"align",function(){return this._align},function(H){this._align=H,this.callLater(this.changeValue)}),I(0,H,"measureWidth",function(){return this._wordsW}),I(0,H,"measureHeight",function(){return this._wordsH}),C}(m),J=function(H){function n(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new f,n.__super.call(this)}Q(n,"laya.ui.List",H);var C=n.prototype;return j.imps(C,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),C.destroy=function(H){void 0===H&&(H=!0),this._content&&this._content.destroy(H),this._scrollBar&&this._scrollBar.destroy(H),laya.ui.Component.prototype.destroy.call(this,H),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},C.createChildren=function(){this.addChild(this._content=new q)},C.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=j.superGet(q,this,"cacheAs")),j.superSet(q,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},C.onScrollEnd=function(){j.superSet(q,this,"cacheAs",this._$P.cacheAs)},C._removePreScrollBar=function(){var H=this.removeChildByName("scrollBar");H&&H.destroy(!0)},C.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var H=this._getOneCell(),n=H.width+this._spaceX||1,C=H.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/n):Math.ceil(this._width/n)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/C):Math.round(this._height/C));var r=this._width?this._width:n*this.repeatX-this._spaceX,N=this._height?this._height:C*this.repeatY-this._spaceY;this._cellSize=this._isVertical?C:n,this._cellOffset=this._isVertical?C*Math.max(this._repeatY2,this._repeatY)-N-this._spaceY:n*Math.max(this._repeatX2,this._repeatX)-r-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=N:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=r),this.setContentSize(r,N);var Q=this._isVertical?this.repeatX:this.repeatY,I=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,Q,I),this._createdLine=I,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},C._getOneCell=function(){if(0===this._cells.length){var H=this.createItem();if(this._offset.setTo(H.x,H.y),this.cacheContent)return H;this._cells.push(H)}return this._cells[0]},C._createItems=function(H,n,C){var r=this._content,N=this._getOneCell(),Q=N.width+this._spaceX,I=N.height+this._spaceY;if(this.cacheContent){var A=new q;A.cacheAsBitmap=!0,A.pos((this._isVertical?0:H)*Q,(this._isVertical?H:0)*I),this._content.addChild(A),this._content.optimizeScrollRect=!0,r=A}else{for(var P=[],t=this._cells.length-1;-1<t;t--){var R=this._cells[t];R.removeSelf(),P.push(R)}this._cells.length=0}for(var y=H;y<C;y++)for(var o=0;o<n;o++)(N=P&&P.length?P.pop():this.createItem()).x=(this._isVertical?o:y)*Q-r.x,N.y=(this._isVertical?y:o)*I-r.y,N.name="item"+(y*n+o),r.addChild(N),this.addCell(N)},C.createItem=function(){var H=[];if("function"==typeof this._itemRender)var n=new this._itemRender;else n=S.createComp(this._itemRender,null,null,H);if(0==H.length&&n._watchMap){var C=n._watchMap;for(var r in C)for(var N=C[r],Q=0;Q<N.length;Q++){var I=N[Q];H.push(I.comp,I.prop,I.value)}}return H.length&&(n._$bindData=H),n},C.addCell=function(H){H.on("click",this,this.onCellMouse),H.on("rightclick",this,this.onCellMouse),H.on("mouseover",this,this.onCellMouse),H.on("mouseout",this,this.onCellMouse),H.on("mousedown",this,this.onCellMouse),H.on("mouseup",this,this.onCellMouse),this._cells.push(H)},C.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var H=0,n=H=0;n<1e4;n++){var C=this.getChildByName("item"+n);if(!C)break;this.addCell(C),H++}this.repeatY=H}},C.setContentSize=function(H,n){this._content.width=H,this._content.height=n,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new K),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,H,n),this._content.scrollRect=this._content.scrollRect),this.event("resize")},C.onCellMouse=function(H){"mousedown"===H.type&&(this._isMoved=!1);var n=H.currentTarget,C=this._startIndex+this._cells.indexOf(n);C<0||("click"===H.type||"rightclick"===H.type?this.selectEnable&&!this._isMoved?this.selectedIndex=C:this.changeCellState(n,!0,0):"mouseover"!==H.type&&"mouseout"!==H.type||this._selectedIndex===C||this.changeCellState(n,"mouseover"===H.type,0),this.mouseHandler&&this.mouseHandler.runWith([H,C]))},C.changeCellState=function(H,n,C){var r=H.getChildByName("selectBox");r&&(this.selectEnable=!0,r.visible=n,r.index=C)},C.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},C.onScrollBarChange=function(H){this.runCallLater(this.changeCells);var n=this._scrollBar.value,C=this._isVertical?this.repeatX:this.repeatY,r=this._isVertical?this.repeatY:this.repeatX,N=Math.floor(n/this._cellSize);if(this.cacheContent)I=r+1,this._createdLine-N<I&&(this._createItems(this._createdLine,C,this._createdLine+I),this.renderItems(this._createdLine*C,0),this._createdLine+=I);else{var Q=N*C,I=0;if(Q>this._startIndex){I=Q-this._startIndex;var A=!0,P=this._startIndex+C*(r+1);this._isMoved=!0}else Q<this._startIndex&&(I=this._startIndex-Q,A=!1,P=this._startIndex-1,this._isMoved=!0);for(var t=0;t<I;t++){if(A){var R=this._cells.shift();this._cells[this._cells.length]=R;var y=P+t}else R=this._cells.pop(),this._cells.unshift(R),y=P-t;var o=Math.floor(y/C)*this._cellSize;this._isVertical?R.y=o:R.x=o,this.renderItem(R,y)}this._startIndex=Q,this.changeSelectStatus()}var g=this._content.scrollRect;this._isVertical?(g.y=n-this._offset.y,g.x=-this._offset.x):(g.y=-this._offset.y,g.x=n-this._offset.x),this._content.scrollRect=g},C.posCell=function(H,n){if(this._scrollBar){var C=this._isVertical?this.repeatX:this.repeatY,r=(this._isVertical?this.repeatY:this.repeatX,Math.floor(n/C)*this._cellSize);this._isVertical?H.y=r:H.x=r}},C.changeSelectStatus=function(){for(var H=0,n=this._cells.length;H<n;H++)this.changeCellState(this._cells[H],this._selectedIndex===this._startIndex+H,1)},C.renderItems=function(H,n){void 0===H&&(H=0),void 0===n&&(n=0);for(var C=H,r=n||this._cells.length;C<r;C++)this.renderItem(this._cells[C],this._startIndex+C);this.changeSelectStatus(),this._twDone=!0},C.renderItem=function(H,n){this._array&&0<=n&&n<this._array.length?(H.visible=!0,H._$bindData?(H._dataSource=this._array[n],this._bindData(H,this._array[n])):H.dataSource=this._array[n],this.cacheContent||this.posCell(H,n),this.hasListener("render")&&this.event("render",[H,n]),this.renderHandler&&this.renderHandler.runWith([H,n]),this.renderTwHandler&&this.renderTwHandler.runWith([H,n])):H?(H.visible=!1,H.dataSource=null):j.recordError("找不到cell","_itemRender为:"+this._itemRender)},C._bindData=function(H,n){for(var C=H._$bindData,r=0,N=C.length;r<N;r++){var Q=C[r++],I=C[r++],A=C[r],P=b.getBindFun(A);Q[I]=P.call(this,n)}},C.refresh=function(){this.array=this._array},C.getItem=function(H){return-1<H&&H<this._array.length?this._array[H]:null},C.changeItem=function(H,n){-1<H&&H<this._array.length&&(this._array[H]=n,H>=this._startIndex&&H<this._startIndex+this._cells.length&&this.renderItem(this.getCell(H),H))},C.setItem=function(H,n){this.changeItem(H,n)},C.addItem=function(H){this._array.push(H),this.array=this._array},C.addItemAt=function(H,n){this._array.splice(n,0,H),this.array=this._array},C.deleteItem=function(H){this._array.splice(H,1),this.array=this._array},C.getCell=function(H){return this.runCallLater(this.changeCells),-1<H&&this._cells?this._cells[(H-this._startIndex)%this._cells.length]:null},C.scrollTo=function(H){if(this._scrollBar){var n=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(H/n)*this._cellSize}else this.startIndex=H},C.tweenTo=function(H,n,C){if(void 0===n&&(n=200),this._scrollBar){var r=this._isVertical?this.repeatX:this.repeatY;k.to(this._scrollBar,{value:Math.floor(H/r)*this._cellSize},n,null,C,0,!0)}else this.startIndex=H,C&&C.run()},C._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},C.commitMeasure=function(){this.runCallLater(this.changeCells)},I(0,C,"cacheAs",H.prototype._$get_cacheAs,function(H){j.superSet(q,this,"cacheAs",H),this._scrollBar&&(this._$P.cacheAs=null,"none"!==H?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),I(0,C,"content",function(){return this._content}),I(0,C,"height",H.prototype._$get_height,function(H){H!=this._height&&(j.superSet(q,this,"height",H),this._setCellChanged())}),I(0,C,"itemRender",function(){return this._itemRender},function(H){if(this._itemRender!=H){this._itemRender=H;for(var n=this._cells.length-1;-1<n;n--)this._cells[n].destroy();this._cells.length=0,this._setCellChanged()}}),I(0,C,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(H){this._removePreScrollBar();var n=new CH;n.name="scrollBar",n.right=0,H&&" "!=H&&(n.skin=H),this.scrollBar=n,this.addChild(n),this._setCellChanged()}),I(0,C,"page",function(){return this._page},function(H){this._page=H,this._array&&(this._page=0<H?H:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),I(0,C,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(H){this._removePreScrollBar();var n=new Y;n.name="scrollBar",n.bottom=0,H&&" "!=H&&(n.skin=H),this.scrollBar=n,this.addChild(n),this._setCellChanged()}),I(0,C,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(H){this._repeatX=H,this._setCellChanged()}),I(0,C,"scrollBar",function(){return this._scrollBar},function(H){this._scrollBar!=H&&(this._scrollBar=H)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),I(0,C,"width",H.prototype._$get_width,function(H){H!=this._width&&(j.superSet(q,this,"width",H),this._setCellChanged())}),I(0,C,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(H){this._repeatY=H,this._setCellChanged()}),I(0,C,"spaceX",function(){return this._spaceX},function(H){this._spaceX=H,this._setCellChanged()}),I(0,C,"spaceY",function(){return this._spaceY},function(H){this._spaceY=H,this._setCellChanged()}),I(0,C,"selectedIndex",function(){return this._selectedIndex},function(H){this._selectedIndex!=H&&(this._selectedIndex=H,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(H),this.startIndex=this._startIndex)}),I(0,C,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(H){this.selectedIndex=this._array.indexOf(H)}),I(0,C,"length",function(){return this._array?this._array.length:0}),I(0,C,"selection",function(){return this.getCell(this._selectedIndex)},function(H){this.selectedIndex=this._startIndex+this._cells.indexOf(H)}),I(0,C,"startIndex",function(){return this._startIndex},function(H){this._startIndex=0<H?H:0,this.callLater(this.renderItems)}),I(0,C,"twSwitch",function(){return this._twSwitch},function(H){this._twSwitch=H}),I(0,C,"twDone",function(){return this._twDone},function(H){this._twDone=H}),I(0,C,"array",function(){return this._array},function(H){this.runCallLater(this.changeCells),this._array=H||[];var n=this._array.length;if(this.totalPage=Math.ceil(n/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<n?this._selectedIndex:n-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var C=this._isVertical?this.repeatX:this.repeatY,r=this._isVertical?this.repeatY:this.repeatX,N=Math.ceil(n/C);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=r/N,this._scrollBar.setScroll(0,(N-r)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),I(0,C,"dataSource",H.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)&&Math.floor(H)==H||"string"==typeof H?this.selectedIndex=parseInt(H):H instanceof Array?this.array=H:j.superSet(q,this,"dataSource",H)}),I(0,C,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),n}(q),Y=function(H){function n(){n.__super.call(this)}return Q(n,"laya.ui.HScrollBar",H),n.prototype.initialize=function(){H.prototype.initialize.call(this),this.slider.isVertical=!1},n}(U),u=function(H){function n(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,n.__super.call(this),this.width=this.height=100}Q(n,"laya.ui.Panel",H);var C=n.prototype;return C.destroy=function(H){void 0===H&&(H=!0),laya.ui.Component.prototype.destroy.call(this,H),this._content&&this._content.destroy(H),this._vScrollBar&&this._vScrollBar.destroy(H),this._hScrollBar&&this._hScrollBar.destroy(H),this._vScrollBar=null,this._hScrollBar=null,this._content=null},C.destroyChildren=function(){this._content.destroyChildren()},C.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new q)},C.addChild=function(H){return H.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(H)},C.onResize=function(){this._setScrollChanged()},C.addChildAt=function(H,n){return H.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(H,n)},C.removeChild=function(H){return H.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(H)},C.removeChildAt=function(H){return this.getChildAt(H).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(H)},C.removeChildren=function(H,n){return void 0===H&&(H=0),void 0===n&&(n=2147483647),this._content.removeChildren(H,n),this._setScrollChanged(),this},C.getChildAt=function(H){return this._content.getChildAt(H)},C.getChildByName=function(H){return this._content.getChildByName(H)},C.getChildIndex=function(H){return this._content.getChildIndex(H)},C.changeScroll=function(){this._scrollChanged=!1;var H=this.contentWidth||1,n=this.contentHeight||1,C=this._vScrollBar,r=this._hScrollBar,N=C&&n>this._height,Q=r&&H>this._width,I=N?this._width-C.width:this._width,A=Q?this._height-r.height:this._height;C&&(C.x=this._width-C.width,C.y=0,C.height=this._height-(Q?r.height:0),C.scrollSize=Math.max(.033*this._height,1),C.thumbPercent=A/n,C.setScroll(0,n-A,C.value)),r&&(r.x=0,r.y=this._height-r.height,r.width=this._width-(N?C.width:0),r.scrollSize=Math.max(.033*this._width,1),r.thumbPercent=I/H,r.setScroll(0,H-I,r.value))},C.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},C.setContentSize=function(H,n){var C=this._content;C.width=H,C.height=n,C.scrollRect||(C.scrollRect=new K),C.scrollRect.setTo(0,0,H,n),C.scrollRect=C.scrollRect},C.onScrollBarChange=function(H){var n=this._content.scrollRect;if(n){var C=Math.round(H.value);H.isVertical?n.y=C:n.x=C,this._content.scrollRect=n}},C.scrollTo=function(H,n){void 0===H&&(H=0),void 0===n&&(n=0),this.vScrollBar&&(this.vScrollBar.value=n),this.hScrollBar&&(this.hScrollBar.value=H)},C.refresh=function(){this.changeScroll()},C.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=j.superGet(q,this,"cacheAs")),j.superSet(q,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},C.onScrollEnd=function(){j.superSet(q,this,"cacheAs",this._$P.cacheAs)},C._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},I(0,C,"numChildren",function(){return this._content.numChildren}),I(0,C,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(H){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new Y),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=H}),I(0,C,"contentWidth",function(){for(var H=0,n=this._content.numChildren-1;-1<n;n--){var C=this._content.getChildAt(n);H=Math.max(C.x+C.width*C.scaleX,H)}return H}),I(0,C,"contentHeight",function(){for(var H=0,n=this._content.numChildren-1;-1<n;n--){var C=this._content.getChildAt(n);H=Math.max(C.y+C.height*C.scaleY,H)}return H}),I(0,C,"width",H.prototype._$get_width,function(H){j.superSet(q,this,"width",H),this._setScrollChanged()}),I(0,C,"hScrollBar",function(){return this._hScrollBar}),I(0,C,"content",function(){return this._content}),I(0,C,"height",H.prototype._$get_height,function(H){j.superSet(q,this,"height",H),this._setScrollChanged()}),I(0,C,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(H){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new CH),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=H}),I(0,C,"vScrollBar",function(){return this._vScrollBar}),I(0,C,"cacheAs",H.prototype._$get_cacheAs,function(H){j.superSet(q,this,"cacheAs",H),this._$P.cacheAs=null,"none"!==H?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),n}(q),X=function(H){function n(H){n.__super.call(this,H),this.isVertical=!1}return Q(n,"laya.ui.HSlider",s),n}(),V=function(H){function C(H,n){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,C.__super.call(this),this.skin=n,this.labels=H}Q(C,"laya.ui.UIGroup",H);var n=C.prototype;return j.imps(n,{"laya.ui.IItem":!0}),n.preinitialize=function(){this.mouseEnabled=!0},n.destroy=function(H){void 0===H&&(H=!0),laya.ui.Component.prototype.destroy.call(this,H),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},n.addItem=function(H,n){void 0===n&&(n=!0);var C=H,r=this._items.length;if(C.name="item"+r,this.addChild(C),this.initItems(),n&&0<r){var N=this._items[r-1];"horizontal"==this._direction?C.x=N.x+N.width+this._space:C.y=N.y+N.height+this._space}else n&&(C.x=0,C.y=0);return r},n.delItem=function(H,n){void 0===n&&(n=!0);var C=this._items.indexOf(H);if(-1!=C){var r=H;this.removeChild(r);for(var N=C+1,Q=this._items.length;N<Q;N++){var I=this._items[N];I.name="item"+(N-1),n&&("horizontal"==this._direction?I.x-=r.width+this._space:I.y-=r.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var A;A=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=A}}},n.initItems=function(){this._items||(this._items=[]);for(var H=this._items.length=0;H<1e4;H++){var n=this.getChildByName("item"+H);if(null==n)break;this._items.push(n),n.selected=H===this._selectedIndex,n.clickHandler=g.create(this,this.itemClick,[H],!1)}},n.itemClick=function(H){this.selectedIndex=H},n.setSelect=function(H,n){this._items&&-1<H&&H<this._items.length&&(this._items[H].selected=n)},n.createItem=function(H,n){return null},n.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var H=0,n=0,C=this._items.length;n<C;n++){var r=this._items[n];this._skin&&(r.skin=this._skin),this._labelColors&&(r.labelColors=this._labelColors),this._labelSize&&(r.labelSize=this._labelSize),this._labelStroke&&(r.labelStroke=this._labelStroke),this._labelStrokeColor&&(r.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(r.strokeColors=this._strokeColors),this._labelBold&&(r.labelBold=this._labelBold),this._labelPadding&&(r.labelPadding=this._labelPadding),this._labelAlign&&(r.labelAlign=this._labelAlign),this._stateNum&&(r.stateNum=this._stateNum),this._labelFont&&(r.labelFont=this._labelFont),"horizontal"===this._direction?(r.y=0,r.x=H,H+=r.width+this._space):(r.x=0,r.y=H,H+=r.height+this._space)}this.changeSize()},n.commitMeasure=function(){this.runCallLater(this.changeLabels)},n._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},I(0,n,"labelStrokeColor",function(){return this._labelStrokeColor},function(H){this._labelStrokeColor!=H&&(this._labelStrokeColor=H,this._setLabelChanged())}),I(0,n,"skin",function(){return this._skin},function(H){this._skin!=H&&(this._skin=H,this._setLabelChanged())}),I(0,n,"selectedIndex",function(){return this._selectedIndex},function(H){this._selectedIndex!=H&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=H,this.setSelect(H,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),I(0,n,"labels",function(){return this._labels},function(H){if(this._labels!=H){if(this._labels=H,this.removeChildren(),this._setLabelChanged(),this._labels)for(var n=this._labels.split(","),C=0,r=n.length;C<r;C++){var N=this.createItem(this._skin,n[C]);N.name="item"+C,this.addChild(N)}this.initItems()}}),I(0,n,"strokeColors",function(){return this._strokeColors},function(H){this._strokeColors!=H&&(this._strokeColors=H,this._setLabelChanged())}),I(0,n,"labelColors",function(){return this._labelColors},function(H){this._labelColors!=H&&(this._labelColors=H,this._setLabelChanged())}),I(0,n,"labelStroke",function(){return this._labelStroke},function(H){this._labelStroke!=H&&(this._labelStroke=H,this._setLabelChanged())}),I(0,n,"labelSize",function(){return this._labelSize},function(H){this._labelSize!=H&&(this._labelSize=H,this._setLabelChanged())}),I(0,n,"stateNum",function(){return this._stateNum},function(H){this._stateNum!=H&&(this._stateNum=H,this._setLabelChanged())}),I(0,n,"labelBold",function(){return this._labelBold},function(H){this._labelBold!=H&&(this._labelBold=H,this._setLabelChanged())}),I(0,n,"labelFont",function(){return this._labelFont},function(H){this._labelFont!=H&&(this._labelFont=H,this._setLabelChanged())}),I(0,n,"labelPadding",function(){return this._labelPadding},function(H){this._labelPadding!=H&&(this._labelPadding=H,this._setLabelChanged())}),I(0,n,"direction",function(){return this._direction},function(H){this._direction=H,this._setLabelChanged()}),I(0,n,"space",function(){return this._space},function(H){this._space=H,this._setLabelChanged()}),I(0,n,"items",function(){return this._items}),I(0,n,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(H){this.selectedIndex=this._items.indexOf(H)}),I(0,n,"dataSource",H.prototype._$get_dataSource,function(H){"number"==typeof(this._dataSource=H)&&Math.floor(H)==H||"string"==typeof H?this.selectedIndex=parseInt(H):H instanceof Array?this.labels=H.join(","):j.superSet(q,this,"dataSource",H)}),C}(q),B=function(n){function C(H,n){this._value=null,void 0===n&&(n=""),C.__super.call(this,H,n)}Q(C,"laya.ui.Radio",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._value=null},H.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},H.initialize=function(){n.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},H.onClick=function(H){this.selected=!0},I(0,H,"value",function(){return null!=this._value?this._value:this.label},function(H){this._value=H}),C}(p),HH=function(H){function n(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,n.__super.call(this),this.width=this.height=200}Q(n,"laya.ui.Tree",H);var C=n.prototype;return j.imps(C,{"laya.ui.IRender":!0}),C.destroy=function(H){void 0===H&&(H=!0),laya.ui.Component.prototype.destroy.call(this,H),this._list&&this._list.destroy(H),this._list=null,this._source=null,this._renderHandler=null},C.createChildren=function(){this.addChild(this._list=new J),this._list.renderHandler=g.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},C.onListChange=function(H){this.event("change")},C.getArray=function(){var H,n=[];for(var C in this._source)H=this._source[C],this.getParentOpenStatus(H)&&(H.x=this._spaceLeft*this.getDepth(H),n.push(H));return n},C.getDepth=function(H,n){return void 0===n&&(n=0),null==H.nodeParent?n:this.getDepth(H.nodeParent,n+1)},C.getParentOpenStatus=function(H){var n=H.nodeParent;return null==n||!!n.isOpen&&(null==n.nodeParent||this.getParentOpenStatus(n))},C.renderItem=function(H,n){var C=H.dataSource;if(C){H.left=C.x;var r=H.getChildByName("arrow");r&&(C.hasChild?(r.visible=!0,r.index=C.isOpen?1:0,r.tag=n,r.off("click",this,this.onArrowClick),r.on("click",this,this.onArrowClick)):r.visible=!1);var N=H.getChildByName("folder");N&&(2==N.clipY?N.index=C.isDirectory?0:1:N.index=C.isDirectory?C.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([H,n])}},C.onArrowClick=function(H){var n=H.currentTarget.tag;this._list.array[n].isOpen=!this._list.array[n].isOpen,this.event("open"),this._list.array=this.getArray()},C.setItemState=function(H,n){this._list.array[H]&&(this._list.array[H].isOpen=n,this._list.array=this.getArray())},C.fresh=function(){this._list.array=this.getArray(),this.repaint()},C.parseXml=function(H,n,C,r){var N,Q=H.childNodes,I=Q.length;if(!r){N={};var A,P=H.attributes;for(var t in P){var R=(A=P[t]).nodeName,y=A.nodeValue;N[R]="true"==y||"false"!=y&&y}N.nodeParent=C,0<I&&(N.isDirectory=!0),N.hasChild=0<I,n.push(N)}for(var o=0;o<I;o++){var g=Q[o];this.parseXml(g,n,N,!1)}},C.parseOpenStatus=function(H,n){for(var C=0,r=n.length;C<r;C++){var N=n[C];if(N.isDirectory)for(var Q=0,I=H.length;Q<I;Q++){var A=H[Q];if(A.isDirectory&&this.isSameParent(A,N)&&N.label==A.label){N.isOpen=A.isOpen;break}}}},C.isSameParent=function(H,n){return null==H.nodeParent&&null==n.nodeParent||null!=H.nodeParent&&null!=n.nodeParent&&(H.nodeParent.label==n.nodeParent.label&&this.isSameParent(H.nodeParent,n.nodeParent))},C.filter=function(H){if(Boolean(H)){var n=[];this.getFilterSource(this._source,n,H),this._list.array=n}else this._list.array=this.getArray()},C.getFilterSource=function(H,n,C){var r;for(var N in C=C.toLocaleLowerCase(),H)!(r=H[N]).isDirectory&&-1<String(r.label).toLowerCase().indexOf(C)&&(r.x=0,n.push(r)),r.child&&0<r.child.length&&this.getFilterSource(r.child,n,C)},I(0,C,"spaceBottom",function(){return this._list.spaceY},function(H){this._list.spaceY=H}),I(0,C,"keepStatus",function(){return this._keepStatus},function(H){this._keepStatus=H}),I(0,C,"itemRender",function(){return this._list.itemRender},function(H){this._list.itemRender=H}),I(0,C,"array",function(){return this._list.array},function(H){this._keepStatus&&this._list.array&&H&&this.parseOpenStatus(this._list.array,H),this._source=H,this._list.array=this.getArray()}),I(0,C,"mouseHandler",function(){return this._list.mouseHandler},function(H){this._list.mouseHandler=H}),I(0,C,"dataSource",H.prototype._$get_dataSource,function(H){this._dataSource=H,j.superSet(q,this,"dataSource",H)}),I(0,C,"source",function(){return this._source}),I(0,C,"scrollBar",function(){return this._list.scrollBar}),I(0,C,"list",function(){return this._list}),I(0,C,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(H){this._list.vScrollBarSkin=H}),I(0,C,"renderHandler",function(){return this._renderHandler},function(H){this._renderHandler=H}),I(0,C,"selectedIndex",function(){return this._list.selectedIndex},function(H){this._list.selectedIndex=H}),I(0,C,"spaceLeft",function(){return this._spaceLeft},function(H){this._spaceLeft=H}),I(0,C,"selectedItem",function(){return this._list.selectedItem},function(H){this._list.selectedItem=H}),I(0,C,"width",H.prototype._$get_width,function(H){j.superSet(q,this,"width",H),this._list.width=H}),I(0,C,"height",H.prototype._$get_height,function(H){j.superSet(q,this,"height",H),this._list.height=H}),I(0,C,"xml",null,function(H){var n=[];this.parseXml(H.childNodes[0],n,null,!0),this.array=n}),I(0,C,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),n}(q),nH=function(H){function n(){this._items=null,this._selectedIndex=0,n.__super.call(this),this._setIndexHandler=g.create(this,this.setIndex,null,!1)}Q(n,"laya.ui.ViewStack",H);var C=n.prototype;return j.imps(C,{"laya.ui.IItem":!0}),C.setItems=function(H){this.removeChildren();for(var n=0,C=0,r=H.length;C<r;C++){var N=H[C];N&&(N.name="item"+n,this.addChild(N),n++)}this.initItems()},C.addItem=function(H){H.name="item"+this._items.length,this.addChild(H),this.initItems()},C.initItems=function(){this._items=[];for(var H=0;H<1e4;H++){var n=this.getChildByName("item"+H);if(null==n)break;this._items.push(n),n.visible=H==this._selectedIndex}},C.setSelect=function(H,n){this._items&&-1<H&&H<this._items.length&&(this._items[H].visible=n)},C.setIndex=function(H){this.selectedIndex=H},I(0,C,"dataSource",H.prototype._$get_dataSource,function(H){if("number"==typeof(this._dataSource=H)&&Math.floor(H)==H||"string"==typeof H)this.selectedIndex=parseInt(H);else for(var n in this._dataSource)this.hasOwnProperty(n)&&(this[n]=this._dataSource[n])}),I(0,C,"selectedIndex",function(){return this._selectedIndex},function(H){this._selectedIndex!=H&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=H,this.setSelect(this._selectedIndex,!0))}),I(0,C,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(H){this.selectedIndex=this._items.indexOf(H)}),I(0,C,"items",function(){return this._items}),I(0,C,"setIndexHandler",function(){return this._setIndexHandler},function(H){this._setIndexHandler=H}),n}(q),CH=function(H){function n(){n.__super.call(this)}return Q(n,"laya.ui.VScrollBar",U),n}(),rH=function(n){function C(H){this._bg=null,this._skin=null,C.__super.call(this),void 0===H&&(H=""),this.text=H,this.skin=this.skin}Q(C,"laya.ui.TextInput",n);var H=C.prototype;return H.preinitialize=function(){this.mouseEnabled=!0},H.destroy=function(H){c.clearCache(this,this._skin),void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._bg&&this._bg.destroy(),this._bg=null},H.createChildren=function(){this.addChild(this._tf=new M),this._tf.padding=L.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},H._onFocus=function(){this.event("focus",this)},H._onBlur=function(){this.event("blur",this)},H._onInput=function(){this.event("input",this)},H._onEnter=function(){this.event("enter",this)},H.initialize=function(){this.width=128,this.height=22},H.select=function(){this._tf.select()},H.setSelection=function(H,n){this._tf.setSelection(H,n)},I(0,H,"text",n.prototype._$get_text,function(H){this._tf.text!=H&&(H+="",this._tf.text=H,this.event("change"))}),I(0,H,"bg",function(){return this._bg},function(H){this.graphics=this._bg=H}),I(0,H,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(H){this._tf.inputElementYAdjuster=H}),I(0,H,"multiline",function(){return this._tf.multiline},function(H){this._tf.multiline=H}),I(0,H,"skin",function(){return this._skin},function(H){this._skin!=H&&(c.clearCache(this,this._skin),this._skin=H,this._bg||(this.graphics=this._bg=new v),c.keepCache(this,this._skin),this._bg.source=c.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),I(0,H,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(H){this._bg||(this.graphics=this._bg=new v),this._bg.sizeGrid=b.fillArray(L.defaultSizeGrid,H,Number)}),I(0,H,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(H){this._tf.inputElementXAdjuster=H}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(x,this,"width",H),this._bg&&(this._bg.width=H)}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(x,this,"height",H),this._bg&&(this._bg.height=H)}),I(0,H,"editable",function(){return this._tf.editable},function(H){this._tf.editable=H}),I(0,H,"restrict",function(){return this._tf.restrict},function(H){this._tf.restrict=H}),I(0,H,"prompt",function(){return this._tf.prompt},function(H){this._tf.prompt=H}),I(0,H,"promptColor",function(){return this._tf.promptColor},function(H){this._tf.promptColor=H}),I(0,H,"maxChars",function(){return this._tf.maxChars},function(H){this._tf.maxChars=H}),I(0,H,"focus",function(){return this._tf.focus},function(H){this._tf.focus=H}),I(0,H,"type",function(){return this._tf.type},function(H){this._tf.type=H}),I(0,H,"asPassword",function(){return this._tf.asPassword},function(H){this._tf.asPassword=H}),C}(x),NH=function(H){function n(){n.__super.call(this)}return Q(n,"laya.ui.VSlider",s),n}(),QH=function(H){function r(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,r.__super.call(this)}Q(r,"laya.ui.Dialog",H);var n=r.prototype;return n.initialize=function(){this.popupEffect=r.manager.popupEffectHandler,this.closeEffect=r.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},n._dealDragArea=function(){var H=this.getChildByName("drag");H&&(this.dragArea=H.x+","+H.y+","+H.width+","+H.height,H.removeSelf())},n._onClick=function(H){var n=H.target;if(n)switch(n.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(n.name)}},n.show=function(H,n){void 0===H&&(H=!1),void 0===n&&(n=!0),this._open(!1,H,n)},n.popup=function(H,n){void 0===H&&(H=!1),void 0===n&&(n=!0),this._open(!0,H,n)},n._open=function(H,n,C){r.manager.lock(!1),this.isModal=H,r.manager.open(this,n,C)},n.onOpened=function(){},n.close=function(H,n){void 0===n&&(n=!0),r.manager.close(this,H,n)},n.onClosed=function(H){},n._onMouseDown=function(H){var n=this.getMousePoint();this._dragArea.contains(n.x,n.y)?this.startDrag():this.stopDrag()},I(0,n,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(H){if(H){var n=b.fillArray([0,0,0,0],H,Number);this._dragArea=new K(n[0],n[1],n[2],n[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),I(0,n,"isPopup",function(){return null!=this.parent}),I(0,n,"zOrder",H.prototype._$get_zOrder,function(H){j.superSet(S,this,"zOrder",H),r.manager._checkMask()}),I(1,r,"manager",function(){return r._manager=r._manager||new Z},function(H){r._manager=H}),r.setLockView=function(H){r.manager.setLockView(H)},r.lock=function(H){r.manager.lock(H)},r.closeAll=function(){r.manager.closeAll()},r.getDialogsByGroup=function(H){return r.manager.getDialogsByGroup(H)},r.closeByGroup=function(H){return r.manager.closeByGroup(H)},r.CLOSE="close",r.CANCEL="cancel",r.SURE="sure",r.NO="no",r.OK="ok",r.YES="yes",r._manager=null,r}(S),IH=function(H){function n(){n.__super.call(this)}Q(n,"laya.ui.HBox",H);var C=n.prototype;return C.sortItem=function(H){H&&H.sort(function(H,n){return H.x-n.x})},C.changeItems=function(){this._itemChanged=!1;for(var H=[],n=0,C=0,r=this.numChildren;C<r;C++){var N=this.getChildAt(C);N&&N.layoutEnabled&&(H.push(N),n=this._height?this._height:Math.max(n,N.height*N.scaleY))}this.sortItem(H);var Q=0;for(C=0,r=H.length;C<r;C++)(N=H[C]).x=Q,Q+=N.width*N.scaleX+this._space,"top"==this._align?N.y=0:"middle"==this._align?N.y=.5*(n-N.height*N.scaleY):"bottom"==this._align&&(N.y=n-N.height*N.scaleY);this.changeSize()},I(0,C,"height",H.prototype._$get_height,function(H){this._height!=H&&(j.superSet(E,this,"height",H),this.callLater(this.changeItems))}),n.NONE="none",n.TOP="top",n.MIDDLE="middle",n.BOTTOM="bottom",n}(E),AH=function(H){function n(){n.__super.call(this)}Q(n,"laya.ui.VBox",H);var C=n.prototype;return C.changeItems=function(){this._itemChanged=!1;for(var H=[],n=0,C=0,r=this.numChildren;C<r;C++){var N=this.getChildAt(C);N&&N.layoutEnabled&&(H.push(N),n=this._width?this._width:Math.max(n,N.width*N.scaleX))}this.sortItem(H);var Q=0;for(C=0,r=H.length;C<r;C++)(N=H[C]).y=Q,Q+=N.height*N.scaleY+this._space,"left"==this._align?N.x=0:"center"==this._align?N.x=.5*(n-N.width*N.scaleX):"right"==this._align&&(N.x=n-N.width*N.scaleX);this.changeSize()},I(0,C,"width",H.prototype._$get_width,function(H){this._width!=H&&(j.superSet(E,this,"width",H),this.callLater(this.changeItems))}),n.NONE="none",n.LEFT="left",n.CENTER="center",n.RIGHT="right",n}(E),PH=function(H){function n(){n.__super.call(this)}return Q(n,"laya.ui.RadioGroup",V),n.prototype.createItem=function(H,n){return new B(H,n)},n}(),tH=function(H){function n(){n.__super.call(this)}return Q(n,"laya.ui.Tab",V),n.prototype.createItem=function(H,n){return new p(H,n)},n}(),RH=function(n){function C(H){this._vScrollBar=null,this._hScrollBar=null,void 0===H&&(H=""),C.__super.call(this,H)}Q(C,"laya.ui.TextArea",n);var H=C.prototype;return H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},H.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},H.onVBarChanged=function(H){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},H.onHBarChanged=function(H){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},H.changeScroll=function(){var H=this._vScrollBar&&0<this._tf.maxScrollY,n=this._hScrollBar&&0<this._tf.maxScrollX,C=H?this._width-this._vScrollBar.width:this._width,r=n?this._height-this._hScrollBar.height:this._height,N=this._tf.padding||L.labelPadding;this._tf.width=C,this._tf.height=r,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-N[2],this._vScrollBar.y=N[1],this._vScrollBar.height=this._height-(n?this._hScrollBar.height:0)-N[1]-N[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=r/Math.max(this._tf.textHeight,r),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=H),this._hScrollBar&&(this._hScrollBar.x=N[0],this._hScrollBar.y=this._height-this._hScrollBar.height-N[3],this._hScrollBar.width=this._width-(H?this._vScrollBar.width:0)-N[0]-N[2],this._hScrollBar.scrollSize=Math.max(.033*C,1),this._hScrollBar.thumbPercent=C/Math.max(this._tf.textWidth,C),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=n)},H.scrollTo=function(H){this.commitMeasure(),this._tf.scrollY=H},I(0,H,"scrollY",function(){return this._tf.scrollY}),I(0,H,"width",n.prototype._$get_width,function(H){j.superSet(rH,this,"width",H),this.callLater(this.changeScroll)}),I(0,H,"hScrollBar",function(){return this._hScrollBar}),I(0,H,"height",n.prototype._$get_height,function(H){j.superSet(rH,this,"height",H),this.callLater(this.changeScroll)}),I(0,H,"maxScrollX",function(){return this._tf.maxScrollX}),I(0,H,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(H){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new CH),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=H}),I(0,H,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(H){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new Y),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=H}),I(0,H,"vScrollBar",function(){return this._vScrollBar}),I(0,H,"maxScrollY",function(){return this._tf.maxScrollY}),I(0,H,"scrollX",function(){return this._tf.scrollX}),C}(rH);!function(H){function n(){this._uiView=null,this.isCloseOther=!1,n.__super.call(this)}Q(n,"laya.ui.AsynDialog",QH);var C=n.prototype;C.createView=function(H){this._uiView=H},C._open=function(H,n,C){this.isModal=H,this.isCloseOther=n,QH.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},C.onCreated=function(){this.createUI(),this.onOpen()},C.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},C.onOpen=function(){QH.manager.open(this,this.isCloseOther),QH.manager.lock(!1)},C.close=function(H,n){void 0===n&&(n=!0),QH.manager.close(this),this.onClose()},C.onClose=function(){},C.destroy=function(H){void 0===H&&(H=!0),laya.ui.View.prototype.destroy.call(this,H),this._uiView=null,this.onDestroy()},C.onDestroy=function(){}}();j.__init([S])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(H,n){"use strict";for(var C in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var r=Laya[C];r&&r.__isclass&&(n[C]=r)}}),function(o,H,z){z.un,z.uns;var y=z.static,g=z.class,M=z.getset,r=z.__newvec,W=laya.maths.Arith,I=laya.webgl.atlas.AtlasResourceManager,C=laya.webgl.shader.BaseShader,v=laya.utils.Browser,A=laya.webgl.utils.Buffer,w=laya.utils.Byte,P=laya.utils.ClassUtils,t=z.Config,Q=(laya.events.Event,laya.events.EventDispatcher),D=laya.utils.Handler,f=laya.net.Loader,n=laya.net.LoaderManager,R=(laya.maths.MathUtil,laya.display.Node),j=laya.renders.Render,N=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),l=laya.resource.Resource,c=laya.utils.RunDriver,K=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),F=laya.display.Sprite,k=laya.utils.Stat,i=laya.utils.StringKey,L=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),a=laya.utils.Utils,b=laya.webgl.WebGL,h=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;z.interface("laya.d3.core.IClone"),z.interface("laya.d3.graphics.IVertex"),z.interface("laya.d3.core.render.IUpdate"),z.interface("laya.d3.core.scene.ITreeNode"),z.interface("laya.d3.core.render.IRenderable");(function(){function q(){}g(q,"laya.d3.animation.AnimationClipParser01"),q.READ_DATA=function(){q._DATA.offset=q._reader.getUint32(),q._DATA.size=q._reader.getUint32()},q.READ_BLOCK=function(){for(var H=q._BLOCK.count=q._reader.getUint16(),n=q._BLOCK.blockStarts=[],C=q._BLOCK.blockLengths=[],r=0;r<H;r++)n.push(q._reader.getUint32()),C.push(q._reader.getUint32())},q.READ_STRINGS=function(){var H=q._reader.getUint32(),n=q._reader.getUint16(),C=q._reader.pos;q._reader.pos=H+q._DATA.offset;for(var r=0;r<n;r++)q._strings[r]=q._reader.readUTFString();q._reader.pos=C},q.parse=function(H,n){q._animationClip=H;(q._reader=n).__getBuffer();q.READ_DATA(),q.READ_BLOCK(),q.READ_STRINGS();for(var C=0,r=q._BLOCK.count;C<r;C++){var N=n.getUint16(),Q=q._strings[N],I=q["READ_"+Q];if(null==I)throw new Error("model file err,no this function:"+N+" "+Q);I.call()}},q.READ_ANIMATIONS=function(){var H,n=0,C=0,r=q._reader,N=r.__getBuffer(),Q=[],I=r.getUint8();for(Q.length=I,n=0;n<I;n++)Q[n]=r.getUint16();var A=[],P=r.getUint16();for(A.length=P,n=0;n<P;n++)A[n]=r.getFloat32();var t=q._animationClip;t.name=q._strings[r.getUint16()];var R=t._duration=r.getFloat32();t.islooping=!!r.getByte(),t._frameRate=r.getInt16();var y=r.getInt16(),o=t._nodes=new Array;o.length=y,(t._publicClipDatas=[]).length=y;var g=t._nodesMap={},M=0,j=0;for(n=0;n<y;n++){H=o[n]=new x;var l=r.getUint16(),f=H.path=[];for(f.length=l,C=0;C<l;C++)f[C]=q._strings[r.getUint16()];var c=f.join("/"),K=g[c];K||(g[c]=K=[]),K.push(H);var W=r.getInt16();-1!==W&&(H.componentType=q._strings[W]);var z=s._propertyIndexDic[q._strings[r.getUint16()]];if(null==z)throw new Error("AnimationClipParser01:unknown property name.");var w=z<4,F=!w||w&&""===f[0];(H._cacheProperty=F)?M++:j++,H.propertyNameID=z;var k=Q[r.getUint8()];H.keyFrameWidth=k/4;var i=H.keyFrames=[],a=i.length=r.getUint16(),D=null,L=NaN;for(C=0;C<a;C++){var b=i[C]=new $;L=b.startTime=A[r.getUint16()];var h=r.pos;b.inTangent=new Float32Array(N.slice(h,h+k)),r.pos+=k,h=r.pos,b.outTangent=new Float32Array(N.slice(h,h+k)),r.pos+=k,h=r.pos,b.data=new Float32Array(N.slice(h,h+k)),r.pos+=k,D&&(D.next=b,D.duration=L-D.startTime),D=b}b.next=null,b.duration=R-L}var v=t._nodeToCachePropertyMap=new Int32Array(y),e=t._cachePropertyMap=new Int32Array(M),Z=t._unCachePropertyMap=new Int32Array(j);for(M=j=0,n=0;n<y;n++)(H=o[n])._cacheProperty?(v[n]=M,e[M++]=n):Z[j++]=n},q._animationClip=null,q._reader=null,q._strings=[],y(q,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function _(){}g(_,"laya.d3.animation.AnimationClipParser02"),_.READ_DATA=function(){_._DATA.offset=_._reader.getUint32(),_._DATA.size=_._reader.getUint32()},_.READ_BLOCK=function(){for(var H=_._BLOCK.count=_._reader.getUint16(),n=_._BLOCK.blockStarts=[],C=_._BLOCK.blockLengths=[],r=0;r<H;r++)n.push(_._reader.getUint32()),C.push(_._reader.getUint32())},_.READ_STRINGS=function(){var H=_._reader.getUint32(),n=_._reader.getUint16(),C=_._reader.pos;_._reader.pos=H+_._DATA.offset;for(var r=0;r<n;r++)_._strings[r]=_._reader.readUTFString();_._reader.pos=C},_.parse=function(H,n){_._animationClip=H;(_._reader=n).__getBuffer();_.READ_DATA(),_.READ_BLOCK(),_.READ_STRINGS();for(var C=0,r=_._BLOCK.count;C<r;C++){var N=n.getUint16(),Q=_._strings[N],I=_["READ_"+Q];if(null==I)throw new Error("model file err,no this function:"+N+" "+Q);I.call()}},_.READ_ANIMATIONS=function(){var H,n=0,C=0,r=_._reader,N=r.__getBuffer(),Q=[],I=r.getUint8();for(Q.length=I,n=0;n<I;n++)Q[n]=r.getUint16();var A=[],P=r.getUint16();for(A.length=P,n=0;n<P;n++)A[n]=r.getFloat32();var t=_._animationClip;t.name=_._strings[r.getUint16()];var R=t._duration=r.getFloat32();t.islooping=!!r.getByte(),t._frameRate=r.getInt16();var y=r.getInt16(),o=t._nodes=new Array;o.length=y,(t._publicClipDatas=[]).length=y;var g=t._nodesMap={},M=0,j=0;for(n=0;n<y;n++){H=o[n]=new x;var l=r.getUint16(),f=H.path=[];for(f.length=l,C=0;C<l;C++)f[C]=_._strings[r.getUint16()];var c=f.join("/"),K=g[c];K||(g[c]=K=[]),K.push(H);var W=r.getInt16();-1!==W&&(H.componentType=_._strings[W]);var z=s._propertyIndexDic[_._strings[r.getUint16()]];if(null==z)throw new Error("AnimationClipParser02:unknown property name.");var w=z<4,F=!w||w&&""===f[0];(H._cacheProperty=F)?M++:j++,H.propertyNameID=z;var k=Q[r.getUint8()];H.keyFrameWidth=k/4;var i=H.keyFrames=[],a=i.length=r.getUint16(),D=null,L=NaN;for(C=0;C<a;C++){var b=i[C]=new $;L=b.startTime=A[r.getUint16()];var h=r.pos;b.inTangent=new Float32Array(N.slice(h,h+k)),r.pos+=k,h=r.pos,b.outTangent=new Float32Array(N.slice(h,h+k)),r.pos+=k,h=r.pos,b.data=new Float32Array(N.slice(h,h+k)),r.pos+=k,D&&(D.next=b,D.duration=L-D.startTime),D=b}b.next=null,b.duration=R-L}var v=r.getUint16();for(n=0;n<v;n++){var e,Z=new U;Z.time=r.getFloat32(),Z.eventName=_._strings[r.getUint16()];var q=r.getUint16();for(0<q&&(Z.params=e=[]),C=0;C<q;C++){switch(r.getByte()){case 0:e.push(!!r.getByte());break;case 1:e.push(r.getInt32());break;case 2:e.push(r.getFloat32());break;case 3:e.push(_._strings[r.getUint16()]);break;default:throw new Error("unknown type.")}}t.addEvent(Z)}var p=t._nodeToCachePropertyMap=new Int32Array(y),m=t._cachePropertyMap=new Int32Array(M),d=t._unCachePropertyMap=new Int32Array(j);for(M=j=0,n=0;n<y;n++)(H=o[n])._cacheProperty?(p[n]=M,m[M++]=n):d[j++]=n},_._animationClip=null,_._reader=null,_._strings=[],y(_,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var U=function(){function H(){this.time=NaN,this.eventName=null,this.params=null}return g(H,"laya.d3.animation.AnimationEvent"),H}(),s=function(){function r(){this._childs=[],this.transform=new zn(this)}g(r,"laya.d3.animation.AnimationNode");var H=r.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.addChild=function(H){H._parent=this,H.transform.setParent(this.transform),this._childs.push(H)},H.removeChild=function(H){var n=this._childs.indexOf(H);-1!==n&&this._childs.splice(n,1)},H.getChildByName=function(H){for(var n=0,C=this._childs.length;n<C;n++){var r=this._childs[n];if(r.name===H)return r}return null},H.getChildByIndex=function(H){return this._childs[H]},H.getChildCount=function(){return this._childs.length},H.cloneTo=function(H){var n=H;n.name=this.name;for(var C=0,r=this._childs.length;C<r;C++){var N=this._childs[C],Q=N.clone();n.addChild(Q);var I=N.transform,A=Q.transform;A.setLocalPosition(I.getLocalPosition()),A.setLocalRotation(I.getLocalRotation()),A.setLocalScale(I.getLocalScale()),A._localRotationEuler=I._localRotationEuler,A._setWorldMatrixIgnoreUpdate(I.getWorldMatrix())}},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},r.__init__=function(){r.registerAnimationNodeProperty("localPosition",r._getLocalPosition,r._setLocalPosition),r.registerAnimationNodeProperty("localRotation",r._getLocalRotation,r._setLocalRotation),r.registerAnimationNodeProperty("localScale",r._getLocalScale,r._setLocalScale),r.registerAnimationNodeProperty("localRotationEuler",r._getLocalRotationEuler,r._setLocalRotationEuler),r.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",r._getParticleRenderSharedMaterialTintColor,r._setParticleRenderSharedMaterialTintColor),r.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",r._getMeshRenderSharedMaterialTilingOffset,r._setMeshRenderSharedMaterialTilingOffset),r.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",r._getMeshRenderSharedMaterialAlbedo,r._setMeshRenderSharedMaterialAlbedo),r.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",r._getSkinnedMeshRenderSharedMaterialTilingOffset,r._setSkinnedMeshRenderSharedMaterialTilingOffset),r.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",r._getSkinnedMeshRenderSharedMaterialAlbedo,r._setSkinnedMeshRenderSharedMaterialAlbedo),r.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",r._getMeshRenderSharedMaterialAlbedo,r._setMeshRenderSharedMaterialAlbedo),r.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",r._getSkinnedMeshRenderSharedMaterialAlbedo,r._setSkinnedMeshRenderSharedMaterialAlbedo),r.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",r._getMeshRenderSharedMaterialIntensity,r._setMeshRenderSharedMaterialIntensity),r.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",r._getMeshRenderSharedMaterialAlpha,r._setMeshRenderSharedMaterialAlpha),r.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",r._getMeshRenderSharedMaterialAlphaColor,r._setMeshRenderSharedMaterialAlphaColor),r.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",r._getMeshRenderSharedMaterialBaseColor,r._setMeshRenderSharedMaterialBaseColor),r.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",r._getMeshRenderSharedMaterialDissolve,r._setMeshRenderSharedMaterialDissolve),r.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",r._getMeshRenderSharedMaterialDissolveSpeed,r._setMeshRenderSharedMaterialDissolveSpeed),r.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",r._getMeshRenderSharedMaterialMMultiplier,r._setMeshRenderSharedMaterialMMultiplier),r.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",r._getMeshRenderSharedMaterialBaseScrollSpeedX,r._setMeshRenderSharedMaterialBaseScrollSpeedX),r.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",r._getMeshRenderSharedMaterialBaseScrollSpeedY,r._setMeshRenderSharedMaterialBaseScrollSpeedY),r.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",r._getMeshRenderSharedMaterialSecondScrollSpeedX,r._setMeshRenderSharedMaterialSecondScrollSpeedX),r.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",r._getMeshRenderSharedMaterialSecondScrollSpeedY,r._setMeshRenderSharedMaterialSecondScrollSpeedY),r.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",r._getMeshRenderSharedMaterialDetailTilingOffset,r._setMeshRenderSharedMaterialDetailTilingOffset),r.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",r._getMeshRenderSharedMaterialDissolveTilingOffset,r._setMeshRenderSharedMaterialDissolveTilingOffset),r.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",r._getMeshRenderSharedMaterialMaskTilingOffset,r._setMeshRenderSharedMaterialMaskTilingOffset)},r.registerAnimationNodeProperty=function(H,n,C){if(r._propertyIndexDic[H])throw new Error("AnimationNode: this propertyName has registered.");r._propertyIndexDic[H]=r._propertyIDCounter,r._propertyGetFuncs[r._propertyIDCounter]=n,r._propertySetFuncs[r._propertyIDCounter]=C,r._propertyIDCounter++},r._getLocalPosition=function(H,n){return H?H.transform.getLocalPosition():n._transform.localPosition.elements},r._setLocalPosition=function(H,n,C){if(H)H.transform.setLocalPosition(C);else{var r=n._transform,N=r.localPosition;N.elements=C,r.localPosition=N}},r._getLocalRotation=function(H,n){return H?H.transform.getLocalRotation():n._transform.localRotation.elements},r._setLocalRotation=function(H,n,C){if(H)H.transform.setLocalRotation(C);else{var r=n._transform,N=r.localRotation;N.elements=C,r.localRotation=N}},r._getLocalScale=function(H,n){return H?H.transform.getLocalScale():n._transform.localScale.elements},r._setLocalScale=function(H,n,C){if(H)H.transform.setLocalScale(C);else{var r=n._transform,N=r.localScale;N.elements=C,r.localScale=N}},r._getLocalRotationEuler=function(H,n){return H?H.transform.getLocalRotationEuler():n._transform.localRotationEuler.elements},r._setLocalRotationEuler=function(H,n,C){if(H)H.transform.setLocalRotationEuler(C);else{var r=n._transform,N=r.localRotationEuler;N.elements=C,r.localRotationEuler=N}},r._getMeshRenderSharedMaterialTilingOffset=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return n.meshRender.sharedMaterial.tilingOffset.elements},r._setMeshRenderSharedMaterialTilingOffset=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).tilingOffset).elements=C,r.tilingOffset=N)}else(N=(r=n.meshRender.material).tilingOffset).elements=C,r.tilingOffset=N},r._getMeshRenderSharedMaterialAlbedo=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.albedoColor.elements:null}return n.meshRender.sharedMaterial.albedoColor.elements},r._setMeshRenderSharedMaterialAlbedo=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).albedoColor).elements=C,r.albedoColor=N)}else(N=(r=n.meshRender.material).albedoColor).elements=C,r.albedoColor=N},r._getSkinnedMeshRenderSharedMaterialTilingOffset=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return n.skinnedMeshRender.sharedMaterial.tilingOffset.elements},r._setSkinnedMeshRenderSharedMaterialTilingOffset=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.skinnedMeshRender.material).tilingOffset).elements=C,r.tilingOffset=N)}else(N=(r=n.skinnedMeshRender.material).tilingOffset).elements=C,r.tilingOffset=N},r._getSkinnedMeshRenderSharedMaterialAlbedo=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return n.skinnedMeshRender.sharedMaterial.albedoColor.elements},r._setSkinnedMeshRenderSharedMaterialAlbedo=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.skinnedMeshRender.material).albedoColor).elements=C,r.albedoColor=N)}else(N=(r=n.skinnedMeshRender.material).albedoColor).elements=C,r.albedoColor=N},r._getParticleRenderSharedMaterialTintColor=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.particleRender.sharedMaterial.tintColor.elements:null}return n.particleRender.sharedMaterial.tintColor.elements},r._setParticleRenderSharedMaterialTintColor=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.particleRender.material).tintColor).elements=C,r.tintColor=N)}else(N=(r=n.particleRender.material).tintColor).elements=C,r.tintColor=N},r._getMeshRenderSharedMaterialAlphaColor=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.alphaColor.elements:null}return n.meshRender.sharedMaterial.alphaColor.elements},r._setMeshRenderSharedMaterialAlphaColor=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).alphaColor).elements=C,r.alphaColor=N)}else(N=(r=n.meshRender.material).alphaColor).elements=C,r.alphaColor=N},r._getMeshRenderSharedMaterialBaseColor=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.baseColor.elements:null}return n.meshRender.sharedMaterial.baseColor.elements},r._setMeshRenderSharedMaterialBaseColor=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).baseColor).elements=C,r.baseColor=N)}else(N=(r=n.meshRender.material).baseColor).elements=C,r.baseColor=N},r._getMeshRenderSharedMaterialDissolve=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.dissolve:0}return n.meshRender.sharedMaterial.dissolve},r._setMeshRenderSharedMaterialDissolve=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.dissolve=C[0])}else n.meshRender.material.dissolve=C[0]},r._getMeshRenderSharedMaterialDissolveSpeed=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.dissolveSpeed:0}return n.meshRender.sharedMaterial.dissolveSpeed},r._setMeshRenderSharedMaterialDissolveSpeed=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.dissolveSpeed=C[0])}else n.meshRender.material.dissolveSpeed=C[0]},r._getMeshRenderSharedMaterialMMultiplier=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.mMultiplier:0}return n.meshRender.sharedMaterial.mMultiplier},r._setMeshRenderSharedMaterialMMultiplier=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.mMultiplier=C[0])}else n.meshRender.material.mMultiplier=C[0]},r._getMeshRenderSharedMaterialBaseScrollSpeedX=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return n.meshRender.sharedMaterial.baseScrollSpeedX},r._setMeshRenderSharedMaterialBaseScrollSpeedX=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.baseScrollSpeedX=C[0])}else n.meshRender.material.baseScrollSpeedX=C[0]},r._getMeshRenderSharedMaterialBaseScrollSpeedY=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return n.meshRender.sharedMaterial.baseScrollSpeedY},r._setMeshRenderSharedMaterialBaseScrollSpeedY=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.baseScrollSpeedY=C[0])}else n.meshRender.material.baseScrollSpeedY=C[0]},r._getMeshRenderSharedMaterialSecondScrollSpeedX=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return n.meshRender.sharedMaterial.secondScrollSpeedX},r._setMeshRenderSharedMaterialSecondScrollSpeedX=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.secondScrollSpeedX=C[0])}else n.meshRender.material.secondScrollSpeedX=C[0]},r._getMeshRenderSharedMaterialSecondScrollSpeedY=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return n.meshRender.sharedMaterial.secondScrollSpeedY},r._setMeshRenderSharedMaterialSecondScrollSpeedY=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.secondScrollSpeedY=C[0])}else n.meshRender.material.secondScrollSpeedY=C[0]},r._getMeshRenderSharedMaterialAlpha=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.alpha:0}return n.meshRender.sharedMaterial.alpha},r._setMeshRenderSharedMaterialAlpha=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.alpha=C[0])}else n.meshRender.material.alpha=C[0]},r._getMeshRenderSharedMaterialIntensity=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.intensity:0}return n.meshRender.sharedMaterial.intensity},r._setMeshRenderSharedMaterialIntensity=function(H,n,C){if(H){var r=H.transform._entity;r&&(r.owner.meshRender.material.intensity=C[0])}else n.meshRender.material.intensity=C[0]},r._getMeshRenderSharedMaterialDetailTilingOffset=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return n.meshRender.sharedMaterial.detailTilingOffset.elements},r._setMeshRenderSharedMaterialDetailTilingOffset=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).detailTilingOffset).elements=C,r.detailTilingOffset=N)}else(N=(r=n.meshRender.material).detailTilingOffset).elements=C,r.detailTilingOffset=N},r._getMeshRenderSharedMaterialDissolveTilingOffset=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return n.meshRender.sharedMaterial.dissolveTilingOffset.elements},r._setMeshRenderSharedMaterialDissolveTilingOffset=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).dissolveTilingOffset).elements=C,r.dissolveTilingOffset=N)}else(N=(r=n.meshRender.material).dissolveTilingOffset).elements=C,r.dissolveTilingOffset=N},r._getMeshRenderSharedMaterialMaskTilingOffset=function(H,n){if(H){var C=H.transform._entity;return C?C.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return n.meshRender.sharedMaterial.maskTilingOffset.elements},r._setMeshRenderSharedMaterialMaskTilingOffset=function(H,n,C){var r,N;if(H){var Q=H.transform._entity;Q&&((N=(r=Q.owner.meshRender.material).maskTilingOffset).elements=C,r.maskTilingOffset=N)}else(N=(r=n.meshRender.material).maskTilingOffset).elements=C,r.maskTilingOffset=N},r._propertyIDCounter=0,r._propertyIndexDic={},r._propertySetFuncs=[],r._propertyGetFuncs=[],r}(),$=function(){function H(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return g(H,"laya.d3.animation.Keyframe"),H}(),x=function(){function H(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return g(H,"laya.d3.animation.KeyframeNode"),H}(),e=(function(){function H(){this._tempVector30=new Pn,this._tempVector31=new Pn,this._tempVector32=new Pn,this._a=new Pn,this._b=new Pn,this._c=new Pn,this._d=new Pn}g(H,"laya.d3.core.glitter.SplineCurvePositionVelocity");var n=H.prototype;n.Init=function(H,n,C,r){H.cloneTo(this._d),n.cloneTo(this._c),Pn.scale(H,2,this._a),Pn.scale(C,2,this._tempVector30),Pn.subtract(this._a,this._tempVector30,this._a),Pn.add(this._a,n,this._a),Pn.add(this._a,r,this._a),Pn.scale(C,3,this._b),Pn.scale(H,3,this._tempVector30),Pn.subtract(this._b,this._tempVector30,this._b),Pn.subtract(this._b,r,this._b),Pn.scale(n,2,this._tempVector30),Pn.subtract(this._b,this._tempVector30,this._b)},n.Slerp=function(H,n){Pn.scale(this._a,H*H*H,this._tempVector30),Pn.scale(this._b,H*H,this._tempVector31),Pn.scale(this._c,H,this._tempVector32),Pn.add(this._tempVector30,this._tempVector31,n),Pn.add(n,this._tempVector32,n),Pn.add(n,this._d,n)}}(),function(){function m(H,n,C,r){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=H,this._h=n,this._minHeight=C,this._maxHeight=r}g(m,"laya.d3.core.HeightMap");var H=m.prototype;H._inBounds=function(H,n){return 0<=H&&H<this._h&&0<=n&&n<this._w},H.getHeight=function(H,n){return this._inBounds(H,n)?this._datas[H][n]:NaN},M(0,H,"width",function(){return this._w}),M(0,H,"height",function(){return this._h}),M(0,H,"maxHeight",function(){return this._maxHeight}),M(0,H,"minHeight",function(){return this._minHeight}),m.creatFromMesh=function(H,n,C,r){for(var N=[],Q=[],I=H.getSubMeshCount(),A=0;A<I;A++){for(var P=H.getSubMesh(A),t=P._getVertexBuffer(),R=t.getData(),y=[],o=0;o<R.length;o+=t.vertexDeclaration.vertexStride/4){var g=new Pn(R[o+0],R[o+1],R[o+2]);y.push(g)}N.push(y);var M=P._getIndexBuffer();Q.push(M.getData())}var j=H.boundingBox,l=j.min.x,f=j.min.z,c=j.max.x,K=j.max.z,W=j.min.y,z=j.max.y,w=c-l,F=K-f,k=r.elements[0]=w/(n-1),i=r.elements[1]=F/(C-1),a=new m(n,C,W,z),D=m._tempRay,L=D.direction.elements;L[0]=0,L[1]=-1,L[2]=0;var b=z+.1;D.origin.elements[1]=b;for(var h=0;h<C;h++){var v=f+h*i;a._datas[h]=[];for(var e=0;e<n;e++){var Z=l+e*k,q=D.origin.elements;q[0]=Z,q[2]=v;var p=m._getPosition(D,N,Q);a._datas[h][e]=p===Number.MAX_VALUE?NaN:b-p}}return a},m.createFromImage=function(H,n,C){for(var r=H.width,N=H.height,Q=new m(r,N,n,C),I=(C-n)/254,A=H.getPixels(),P=0,t=0;t<N;t++)for(var R=Q._datas[t]=[],y=0;y<r;y++){var o=A[P++],g=A[P++],M=A[P++],j=A[P++];R[y]=255==o&&255==g&&255==M&&255==j?NaN:(o+g+M)/3*I+n}return Q},m._getPosition=function(H,n,C){for(var r=Number.MAX_VALUE,N=0;N<n.length;N++)for(var Q=n[N],I=C[N],A=0;A<I.length;A+=3){var P=Q[I[A+0]],t=Q[I[A+1]],R=Q[I[A+2]],y=ln.rayIntersectsTriangle(H,P,t,R);!isNaN(y)&&y<r&&(r=y)}return r},y(m,["_tempRay",function(){return this._tempRay=new In(new Pn,new Pn)}])}(),function(){function N(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}g(N,"laya.d3.core.Layer");var H=N.prototype;return H._binarySearchIndex=function(){for(var H=0,n=N._collsionTestList.length-1,C=0;H<=n;){C=Math.floor((H+n)/2);var r=N._collsionTestList[C];if(r==this._number)return C;r>this._number?n=C-1:H=C+1}return H},H._addCollider=function(H){0===this._colliders.length&&N._collsionTestList.splice(this._binarySearchIndex(),0,this._number),H._isRigidbody?(this._colliders.unshift(H),this._nonRigidbodyOffset++):this._colliders.push(H)},H._removeCollider=function(H){var n=this._colliders.indexOf(H);n<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(n,1),0===this._colliders.length&&N._collsionTestList.splice(N._collsionTestList.indexOf(this._number),1)},M(0,H,"number",function(){return this._number}),M(0,H,"visible",function(){return this._visible},function(H){this._visible=H,N._visibleLayers=H?N._visibleLayers|this.mask:N._visibleLayers&~this.mask}),M(0,H,"mask",function(){return this._mask}),M(1,N,"visibleLayers",function(){return N._visibleLayers},function(H){N._visibleLayers=H;for(var n=0,C=N._layerList.length;n<C;n++){var r=N._layerList[n];r._visible=0!=(r._mask&N._visibleLayers)}}),N.__init__=function(){N._layerList.length=31;for(var H=0;H<31;H++){var n=new N;N._layerList[H]=n,0===H?(n.name="Default Layer",n.visible=!0):(n.name="Layer-"+H,n.visible=!1),n._number=H,n._mask=Math.pow(2,H)}N.currentCreationLayer=N._layerList[0]},N.getLayerByNumber=function(H){if(H<0||30<H)throw new Error("无法返回指定Layer，该number超出范围！");return N._layerList[H]},N.getLayerByName=function(H){for(var n=0;n<31;n++)if(N._layerList[n].name===H)return N._layerList[n];throw new Error("无法返回指定Layer,该name不存在")},N.isVisible=function(H){return 0!=(H&N._currentCameraCullingMask&N._visibleLayers)},N._layerList=[],N._visibleLayers=2147483647,N._collsionTestList=[],N._currentCameraCullingMask=2147483647,N.maxCount=31,N.currentCreationLayer=null,N}()),Z=(function(){function H(H,n,C){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=H,this._minCount=n,this._maxCount=C}g(H,"laya.d3.core.particleShuriKen.module.Burst");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.cloneTo=function(H){var n=H;n._time=this._time,n._minCount=this._minCount,n._maxCount=this._maxCount},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"time",function(){return this._time}),M(0,n,"minCount",function(){return this._minCount}),M(0,n,"maxCount",function(){return this._maxCount})}(),function(){function H(H){this._color=null,this.enbale=!1,this._color=H}g(H,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var n=H.prototype;n.cloneTo=function(H){var n=H;this._color.cloneTo(n._color),n.enbale=this.enbale},n.clone=function(){var H;switch(this._color.type){case 0:H=p.createByConstant(this._color.constant.clone());break;case 1:H=p.createByGradient(this._color.gradient.clone());break;case 2:H=p.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:H=p.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var n=new this.constructor(H);return n.enbale=this.enbale,n},M(0,n,"color",function(){return this._color})}(),function(){function H(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}g(H,"laya.d3.core.particleShuriKen.module.Emission");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),n._destroy=function(){this._bursts=null,this._destroyed=!0},n.getBurstsCount=function(){return this._bursts.length},n.getBurstByIndex=function(H){return this._bursts[H]},n.addBurst=function(H){var n=this._bursts.length;if(0<n)for(var C=0;C<n;C++)this._bursts[C].time>H.time&&this._bursts.splice(C,0,H);this._bursts.push(H)},n.removeBurst=function(H){var n=this._bursts.indexOf(H);-1!==n&&this._bursts.splice(n,1)},n.removeBurstByIndex=function(H){this._bursts.splice(H,1)},n.clearBurst=function(){this._bursts.length=0},n.cloneTo=function(H){var n=H,C=n._bursts;C.length=this._bursts.length;for(var r=0,N=this._bursts.length;r<N;r++){var Q=C[r];Q?this._bursts[r].cloneTo(Q):C[r]=this._bursts[r].clone()}n._emissionRate=this._emissionRate,n.enbale=this.enbale},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"destroyed",function(){return this._destroyed}),M(0,n,"emissionRate",function(){return this._emissionRate},function(H){if(H<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=H})}(),function(){function r(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}g(r,"laya.d3.core.particleShuriKen.module.FrameOverTime");var H=r.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.cloneTo=function(H){var n=H;n._type=this._type,n._constant=this._constant,this._overTime.cloneTo(n._overTime),n._constantMin=this._constantMin,n._constantMax=this._constantMax,this._overTimeMin.cloneTo(n._overTimeMin),this._overTimeMax.cloneTo(n._overTimeMax)},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,H,"frameOverTimeData",function(){return this._overTime}),M(0,H,"constant",function(){return this._constant}),M(0,H,"type",function(){return this._type}),M(0,H,"frameOverTimeDataMin",function(){return this._overTimeMin}),M(0,H,"constantMin",function(){return this._constantMin}),M(0,H,"frameOverTimeDataMax",function(){return this._overTimeMax}),M(0,H,"constantMax",function(){return this._constantMax}),r.createByConstant=function(H){var n=new r;return n._type=0,n._constant=H,n},r.createByOverTime=function(H){var n=new r;return n._type=1,n._overTime=H,n},r.createByRandomTwoConstant=function(H,n){var C=new r;return C._type=2,C._constantMin=H,C._constantMax=n,C},r.createByRandomTwoOverTime=function(H,n){var C=new r;return C._type=3,C._overTimeMin=H,C._overTimeMax=n,C},r}()),q=function(){function t(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}g(t,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var H=t.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.cloneTo=function(H){var n=H;n._type=this._type,n._separateAxes=this._separateAxes,n._constant=this._constant,this._constantSeparate.cloneTo(n._constantSeparate),this._gradient.cloneTo(n._gradient),this._gradientX.cloneTo(n._gradientX),this._gradientY.cloneTo(n._gradientY),this._gradientZ.cloneTo(n._gradientZ),n._constantMin=this._constantMin,n._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(n._constantMinSeparate),this._constantMaxSeparate.cloneTo(n._constantMaxSeparate),this._gradientMin.cloneTo(n._gradientMin),this._gradientMax.cloneTo(n._gradientMax),this._gradientXMin.cloneTo(n._gradientXMin),this._gradientXMax.cloneTo(n._gradientXMax),this._gradientYMin.cloneTo(n._gradientYMin),this._gradientYMax.cloneTo(n._gradientYMax),this._gradientZMin.cloneTo(n._gradientZMin),this._gradientZMax.cloneTo(n._gradientZMax)},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,H,"gradientZ",function(){return this._gradientZ}),M(0,H,"constant",function(){return this._constant}),M(0,H,"gradient",function(){return this._gradient}),M(0,H,"separateAxes",function(){return this._separateAxes}),M(0,H,"type",function(){return this._type}),M(0,H,"constantSeparate",function(){return this._constantSeparate}),M(0,H,"gradientX",function(){return this._gradientX}),M(0,H,"gradientY",function(){return this._gradientY}),M(0,H,"gradientW",function(){return this._gradientW}),M(0,H,"gradientMin",function(){return this._gradientMin}),M(0,H,"constantMin",function(){return this._constantMin}),M(0,H,"gradientMax",function(){return this._gradientMax}),M(0,H,"constantMax",function(){return this._constantMax}),M(0,H,"gradientWMin",function(){return this._gradientWMin}),M(0,H,"constantMinSeparate",function(){return this._constantMinSeparate}),M(0,H,"constantMaxSeparate",function(){return this._constantMaxSeparate}),M(0,H,"gradientXMin",function(){return this._gradientXMin}),M(0,H,"gradientXMax",function(){return this._gradientXMax}),M(0,H,"gradientWMax",function(){return this._gradientWMax}),M(0,H,"gradientYMin",function(){return this._gradientYMin}),M(0,H,"gradientYMax",function(){return this._gradientYMax}),M(0,H,"gradientZMin",function(){return this._gradientZMin}),M(0,H,"gradientZMax",function(){return this._gradientZMax}),t.createByConstant=function(H){var n=new t;return n._type=0,n._separateAxes=!1,n._constant=H,n},t.createByConstantSeparate=function(H){var n=new t;return n._type=0,n._separateAxes=!0,n._constantSeparate=H,n},t.createByGradient=function(H){var n=new t;return n._type=1,n._separateAxes=!1,n._gradient=H,n},t.createByGradientSeparate=function(H,n,C,r){var N=new t;return N._type=1,N._separateAxes=!0,N._gradientX=H,N._gradientY=n,N._gradientZ=C,N._gradientW=r,N},t.createByRandomTwoConstant=function(H,n){var C=new t;return C._type=2,C._separateAxes=!1,C._constantMin=H,C._constantMax=n,C},t.createByRandomTwoConstantSeparate=function(H,n){var C=new t;return C._type=2,C._separateAxes=!0,C._constantMinSeparate=H,C._constantMaxSeparate=n,C},t.createByRandomTwoGradient=function(H,n){var C=new t;return C._type=3,C._separateAxes=!1,C._gradientMin=H,C._gradientMax=n,C},t.createByRandomTwoGradientSeparate=function(H,n,C,r,N,Q,I,A){var P=new t;return P._type=3,P._separateAxes=!0,P._gradientXMin=H,P._gradientXMax=n,P._gradientYMin=C,P._gradientYMax=r,P._gradientZMin=N,P._gradientZMax=Q,P._gradientWMin=I,P._gradientWMax=A,P},t}(),p=function(){function r(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}g(r,"laya.d3.core.particleShuriKen.module.GradientColor");var H=r.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.cloneTo=function(H){var n=H;n._type=this._type,this._constant.cloneTo(n._constant),this._constantMin.cloneTo(n._constantMin),this._constantMax.cloneTo(n._constantMax),this._gradient.cloneTo(n._gradient),this._gradientMin.cloneTo(n._gradientMin),this._gradientMax.cloneTo(n._gradientMax)},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,H,"gradient",function(){return this._gradient}),M(0,H,"constant",function(){return this._constant}),M(0,H,"type",function(){return this._type}),M(0,H,"gradientMin",function(){return this._gradientMin}),M(0,H,"constantMin",function(){return this._constantMin}),M(0,H,"gradientMax",function(){return this._gradientMax}),M(0,H,"constantMax",function(){return this._constantMax}),r.createByConstant=function(H){var n=new r;return n._type=0,n._constant=H,n},r.createByGradient=function(H){var n=new r;return n._type=1,n._gradient=H,n},r.createByRandomTwoConstant=function(H,n){var C=new r;return C._type=2,C._constantMin=H,C._constantMax=n,C},r.createByRandomTwoGradient=function(H,n){var C=new r;return C._type=3,C._gradientMin=H,C._gradientMax=n,C},r}(),m=(function(){function H(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}g(H,"laya.d3.core.particleShuriKen.module.GradientDataColor");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.addAlpha=function(H,n){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==H&&(H=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=H,this._alphaElements[this._alphaCurrentLength++]=n):DEBUG},n.addRGB=function(H,n){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==H&&(H=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=H,this._rgbElements[this._rgbCurrentLength++]=n.x,this._rgbElements[this._rgbCurrentLength++]=n.y,this._rgbElements[this._rgbCurrentLength++]=n.z):DEBUG},n.cloneTo=function(H){var n=H,C=0,r=0;n._alphaCurrentLength=this._alphaCurrentLength;var N=n._alphaElements;for(N.length=this._alphaElements.length,C=0,r=this._alphaElements.length;C<r;C++)N[C]=this._alphaElements[C];n._rgbCurrentLength=this._rgbCurrentLength;var Q=n._rgbElements;for(Q.length=this._rgbElements.length,C=0,r=this._rgbElements.length;C<r;C++)Q[C]=this._rgbElements[C]},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),M(0,n,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function H(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}g(H,"laya.d3.core.particleShuriKen.module.GradientDataInt");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.add=function(H,n){this._currentLength<8?(6===this._currentLength&&1!==H&&(H=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=H,this._elements[this._currentLength++]=n):console.log("Warning:data count must lessEqual than 4")},n.cloneTo=function(H){var n=H;n._currentLength=this._currentLength;var C=n._elements;C.length=this._elements.length;for(var r=0,N=this._elements.length;r<N;r++)C[r]=this._elements[r]},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"gradientCount",function(){return this._currentLength/2})}(),function(){function H(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}g(H,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.add=function(H,n){this._currentLength<8?(6===this._currentLength&&1!==H&&(H=1,DEBUG),this._elements[this._currentLength++]=H,this._elements[this._currentLength++]=n):DEBUG},n.getKeyByIndex=function(H){return this._elements[2*H]},n.getValueByIndex=function(H){return this._elements[2*H+1]},n.getAverageValue=function(){for(var H=0,n=this._currentLength-2;H<n;H+=2){this._elements[H+1];this._elements[H+3],this._elements[H+2]-this._elements[H]}return 0},n.cloneTo=function(H){var n=H;n._currentLength=this._currentLength;var C=n._elements;C.length=this._elements.length;for(var r=0,N=this._elements.length;r<N;r++)C[r]=this._elements[r]},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"gradientCount",function(){return this._currentLength/2})}(),function(){function H(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}g(H,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.add=function(H,n){this._currentLength<8?(6===this._currentLength&&1!==H&&(H=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=H,this._elements[this._currentLength++]=n.x,this._elements[this._currentLength++]=n.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},n.cloneTo=function(H){var n=H;n._currentLength=this._currentLength;var C=n._elements;C.length=this._elements.length;for(var r=0,N=this._elements.length;r<N;r++)C[r]=this._elements[r]},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"gradientCount",function(){return this._currentLength/3})}(),function(){function A(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}g(A,"laya.d3.core.particleShuriKen.module.GradientSize");var H=A.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.getMaxSizeInGradient=function(){var H=0,n=0,C=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(H=0,n=this._gradientX.gradientCount;H<n;H++)C=Math.max(C,this._gradientX.getValueByIndex(H));for(H=0,n=this._gradientY.gradientCount;H<n;H++)C=Math.max(C,this._gradientY.getValueByIndex(H))}else for(H=0,n=this._gradient.gradientCount;H<n;H++)C=Math.max(C,this._gradient.getValueByIndex(H));break;case 1:C=this._separateAxes?(C=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),C=Math.max(C,this._constantMinSeparate.y),Math.max(C,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(H=0,n=this._gradientXMin.gradientCount;H<n;H++)C=Math.max(C,this._gradientXMin.getValueByIndex(H));for(H=0,n=this._gradientXMax.gradientCount;H<n;H++)C=Math.max(C,this._gradientXMax.getValueByIndex(H));for(H=0,n=this._gradientYMin.gradientCount;H<n;H++)C=Math.max(C,this._gradientYMin.getValueByIndex(H));for(H=0,n=this._gradientZMax.gradientCount;H<n;H++)C=Math.max(C,this._gradientZMax.getValueByIndex(H))}else{for(H=0,n=this._gradientMin.gradientCount;H<n;H++)C=Math.max(C,this._gradientMin.getValueByIndex(H));for(H=0,n=this._gradientMax.gradientCount;H<n;H++)C=Math.max(C,this._gradientMax.getValueByIndex(H))}}return C},H.cloneTo=function(H){var n=H;n._type=this._type,n._separateAxes=this._separateAxes,this._gradient.cloneTo(n._gradient),this._gradientX.cloneTo(n._gradientX),this._gradientY.cloneTo(n._gradientY),this._gradientZ.cloneTo(n._gradientZ),n._constantMin=this._constantMin,n._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(n._constantMinSeparate),this._constantMaxSeparate.cloneTo(n._constantMaxSeparate),this._gradientMin.cloneTo(n._gradientMin),this._gradientMax.cloneTo(n._gradientMax),this._gradientXMin.cloneTo(n._gradientXMin),this._gradientXMax.cloneTo(n._gradientXMax),this._gradientYMin.cloneTo(n._gradientYMin),this._gradientYMax.cloneTo(n._gradientYMax),this._gradientZMin.cloneTo(n._gradientZMin),this._gradientZMax.cloneTo(n._gradientZMax)},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,H,"gradientZ",function(){return this._gradientZ}),M(0,H,"gradient",function(){return this._gradient}),M(0,H,"separateAxes",function(){return this._separateAxes}),M(0,H,"type",function(){return this._type}),M(0,H,"gradientMin",function(){return this._gradientMin}),M(0,H,"constantMin",function(){return this._constantMin}),M(0,H,"gradientX",function(){return this._gradientX}),M(0,H,"gradientY",function(){return this._gradientY}),M(0,H,"gradientMax",function(){return this._gradientMax}),M(0,H,"constantMax",function(){return this._constantMax}),M(0,H,"constantMinSeparate",function(){return this._constantMinSeparate}),M(0,H,"constantMaxSeparate",function(){return this._constantMaxSeparate}),M(0,H,"gradientXMin",function(){return this._gradientXMin}),M(0,H,"gradientXMax",function(){return this._gradientXMax}),M(0,H,"gradientYMin",function(){return this._gradientYMin}),M(0,H,"gradientYMax",function(){return this._gradientYMax}),M(0,H,"gradientZMin",function(){return this._gradientZMin}),M(0,H,"gradientZMax",function(){return this._gradientZMax}),A.createByGradient=function(H){var n=new A;return n._type=0,n._separateAxes=!1,n._gradient=H,n},A.createByGradientSeparate=function(H,n,C){var r=new A;return r._type=0,r._separateAxes=!0,r._gradientX=H,r._gradientY=n,r._gradientZ=C,r},A.createByRandomTwoConstant=function(H,n){var C=new A;return C._type=1,C._separateAxes=!1,C._constantMin=H,C._constantMax=n,C},A.createByRandomTwoConstantSeparate=function(H,n){var C=new A;return C._type=1,C._separateAxes=!0,C._constantMinSeparate=H,C._constantMaxSeparate=n,C},A.createByRandomTwoGradient=function(H,n){var C=new A;return C._type=2,C._separateAxes=!1,C._gradientMin=H,C._gradientMax=n,C},A.createByRandomTwoGradientSeparate=function(H,n,C,r,N,Q){var I=new A;return I._type=2,I._separateAxes=!0,I._gradientXMin=H,I._gradientXMax=n,I._gradientYMin=C,I._gradientYMax=r,I._gradientZMin=N,I._gradientZMax=Q,I},A}()),d=function(){function A(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}g(A,"laya.d3.core.particleShuriKen.module.GradientVelocity");var H=A.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.cloneTo=function(H){var n=H;n._type=this._type,this._constant.cloneTo(n._constant),this._gradientX.cloneTo(n._gradientX),this._gradientY.cloneTo(n._gradientY),this._gradientZ.cloneTo(n._gradientZ),this._constantMin.cloneTo(n._constantMin),this._constantMax.cloneTo(n._constantMax),this._gradientXMin.cloneTo(n._gradientXMin),this._gradientXMax.cloneTo(n._gradientXMax),this._gradientYMin.cloneTo(n._gradientYMin),this._gradientYMax.cloneTo(n._gradientYMax),this._gradientZMin.cloneTo(n._gradientZMin),this._gradientZMax.cloneTo(n._gradientZMax)},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,H,"gradientZ",function(){return this._gradientZ}),M(0,H,"constant",function(){return this._constant}),M(0,H,"type",function(){return this._type}),M(0,H,"gradientXMax",function(){return this._gradientXMax}),M(0,H,"constantMin",function(){return this._constantMin}),M(0,H,"gradientX",function(){return this._gradientX}),M(0,H,"gradientY",function(){return this._gradientY}),M(0,H,"gradientXMin",function(){return this._gradientXMin}),M(0,H,"constantMax",function(){return this._constantMax}),M(0,H,"gradientYMin",function(){return this._gradientYMin}),M(0,H,"gradientYMax",function(){return this._gradientYMax}),M(0,H,"gradientZMin",function(){return this._gradientZMin}),M(0,H,"gradientZMax",function(){return this._gradientZMax}),A.createByConstant=function(H){var n=new A;return n._type=0,n._constant=H,n},A.createByGradient=function(H,n,C){var r=new A;return r._type=1,r._gradientX=H,r._gradientY=n,r._gradientZ=C,r},A.createByRandomTwoConstant=function(H,n){var C=new A;return C._type=2,C._constantMin=H,C._constantMax=n,C},A.createByRandomTwoGradient=function(H,n,C,r,N,Q){var I=new A;return I._type=3,I._gradientXMin=H,I._gradientXMax=n,I._gradientYMin=C,I._gradientYMax=r,I._gradientZMin=N,I._gradientZMax=Q,I},A}(),_=(function(){function H(H){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=H}g(H,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.cloneTo=function(H){var n=H;this._angularVelocity.cloneTo(n._angularVelocity),n.enbale=this.enbale},n.clone=function(){var H;switch(this._angularVelocity.type){case 0:H=this._angularVelocity.separateAxes?q.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):q.createByConstant(this._angularVelocity.constant);break;case 1:H=this._angularVelocity.separateAxes?q.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):q.createByGradient(this._angularVelocity.gradient.clone());break;case 2:H=this._angularVelocity.separateAxes?q.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):q.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:H=this._angularVelocity.separateAxes?q.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):q.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var n=new this.constructor(H);return n.enbale=this.enbale,n},M(0,n,"angularVelocity",function(){return this._angularVelocity})}(),function(){function H(){this.enable=!1,this.randomDirection=!1}g(H,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var n=H.prototype;return z.imps(n,{"laya.d3.core.IClone":!0}),n._getShapeBoundBox=function(H){throw new Error("BaseShape: must override it.")},n._getSpeedBoundBox=function(H){throw new Error("BaseShape: must override it.")},n.generatePositionAndDirection=function(H,n,C,r){throw new Error("BaseShape: must override it.")},n._calculateProceduralBounds=function(H,n,C){this._getShapeBoundBox(H);var r=H.min,N=H.max;Pn.multiply(r,n,r),Pn.multiply(N,n,N);var Q=new YH(new Pn,new Pn);this.randomDirection?(Q.min=new Pn(-1,-1,-1),Q.max=new Pn(1,1,1)):this._getSpeedBoundBox(Q);var I=new YH(new Pn,new Pn),A=I.min,P=I.max;Pn.scale(Q.min,C.y,A),Pn.scale(Q.max,C.y,P),Pn.add(H.min,A,A),Pn.add(H.max,P,P),Pn.min(H.min,A,H.min),Pn.max(H.max,A,H.max);var t=new YH(new Pn,new Pn),R=t.min,y=t.max;Pn.scale(Q.min,C.x,R),Pn.scale(Q.max,C.x,y),Pn.min(t.min,y,A),Pn.max(t.min,y,P),Pn.min(H.min,A,H.min),Pn.max(H.max,A,H.max)},n.cloneTo=function(H){H.enable=this.enable},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},H}()),O=function(){function Q(){}return g(Q,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),Q._randomPointUnitArcCircle=function(H,n,C){var r=n.elements,N=NaN;N=C?C.getFloat()*H:Math.random()*H,r[0]=Math.cos(N),r[1]=Math.sin(N)},Q._randomPointInsideUnitArcCircle=function(H,n,C){var r=n.elements;Q._randomPointUnitArcCircle(H,n,C);var N=NaN;N=C?Math.pow(C.getFloat(),.5):Math.pow(Math.random(),.5),r[0]=r[0]*N,r[1]=r[1]*N},Q._randomPointUnitCircle=function(H,n){var C=H.elements,r=NaN;r=n?n.getFloat()*Math.PI*2:Math.random()*Math.PI*2,C[0]=Math.cos(r),C[1]=Math.sin(r)},Q._randomPointInsideUnitCircle=function(H,n){var C=H.elements;Q._randomPointUnitCircle(H);var r=NaN;r=n?Math.pow(n.getFloat(),.5):Math.pow(Math.random(),.5),C[0]=C[0]*r,C[1]=C[1]*r},Q._randomPointUnitSphere=function(H,n){var C=H.elements,r=NaN,N=NaN;N=n?(r=C[2]=2*n.getFloat()-1,n.getFloat()*Math.PI*2):(r=C[2]=2*Math.random()-1,Math.random()*Math.PI*2);var Q=Math.sqrt(1-r*r);C[0]=Q*Math.cos(N),C[1]=Q*Math.sin(N)},Q._randomPointInsideUnitSphere=function(H,n){var C=H.elements;Q._randomPointUnitSphere(H);var r=NaN;r=n?Math.pow(n.getFloat(),1/3):Math.pow(Math.random(),1/3),C[0]=C[0]*r,C[1]=C[1]*r,C[2]=C[2]*r},Q._randomPointInsideHalfUnitBox=function(H,n){var C=H.elements;n?(C[0]=n.getFloat()-.5,C[1]=n.getFloat()-.5,C[2]=n.getFloat()-.5):(C[0]=Math.random()-.5,C[1]=Math.random()-.5,C[2]=Math.random()-.5)},Q}(),S=(function(){function H(H){this._size=null,this.enbale=!1,this._size=H}g(H,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.cloneTo=function(H){var n=H;this._size.cloneTo(n._size),n.enbale=this.enbale},n.clone=function(){var H;switch(this._size.type){case 0:H=this._size.separateAxes?m.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):m.createByGradient(this._size.gradient.clone());break;case 1:H=this._size.separateAxes?m.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):m.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:H=this._size.separateAxes?m.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):m.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var n=new this.constructor(H);return n.enbale=this.enbale,n},M(0,n,"size",function(){return this._size})}(),function(){function r(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}g(r,"laya.d3.core.particleShuriKen.module.StartFrame");var H=r.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.cloneTo=function(H){var n=H;n._type=this._type,n._constant=this._constant,n._constantMin=this._constantMin,n._constantMax=this._constantMax},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,H,"constant",function(){return this._constant}),M(0,H,"type",function(){return this._type}),M(0,H,"constantMin",function(){return this._constantMin}),M(0,H,"constantMax",function(){return this._constantMax}),r.createByConstant=function(H){var n=new r;return n._type=0,n._constant=H,n},r.createByRandomTwoConstant=function(H,n){var C=new r;return C._type=1,C._constantMin=H,C._constantMax=n,C},r}()),T=(function(){function H(H,n){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new An(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=H,this._startFrame=n}g(H,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.cloneTo=function(H){var n=H;this.tiles.cloneTo(n.tiles),n.type=this.type,n.randomRow=this.randomRow,this._frame.cloneTo(n._frame),this._startFrame.cloneTo(n._startFrame),n.cycles=this.cycles,n.enableUVChannels=this.enableUVChannels,n.enable=this.enable},n.clone=function(){var H,n;switch(this._frame.type){case 0:H=Z.createByConstant(this._frame.constant);break;case 1:H=Z.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:H=Z.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:H=Z.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:n=S.createByConstant(this._startFrame.constant);break;case 1:n=S.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var C=new this.constructor(H,n);return this.tiles.cloneTo(C.tiles),C.type=this.type,C.randomRow=this.randomRow,C.cycles=this.cycles,C.enableUVChannels=this.enableUVChannels,C.enable=this.enable,C},M(0,n,"frame",function(){return this._frame}),M(0,n,"startFrame",function(){return this._startFrame})}(),function(){function H(H){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=H}g(H,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var n=H.prototype;z.imps(n,{"laya.d3.core.IClone":!0}),n.cloneTo=function(H){var n=H;this._velocity.cloneTo(n._velocity),n.enbale=this.enbale,n.space=this.space},n.clone=function(){var H;switch(this._velocity.type){case 0:H=d.createByConstant(this._velocity.constant.clone());break;case 1:H=d.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:H=d.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:H=d.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var n=new this.constructor(H);return n.enbale=this.enbale,n.space=this.space,n},M(0,n,"velocity",function(){return this._velocity})}(),function(){function H(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new Mn,this._vb=Sn.create(H._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=On.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$n.nameKey.getID("LINE"),this._shaderCompile=Ln._preCompileShader[this._sharderNameID]}g(H,"laya.d3.core.PhasorSpriter3D");var n=H.prototype;return n.line=function(H,n,C,r){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(H.x,H.y,H.z,n.x,n.y,n.z,n.w),this.addVertex(C.x,C.y,C.z,r.x,r.y,r.z,r.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},n.circle=function(H,n,C,r,N,Q){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*n,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/n,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*H,Math.cos(this._tempNumver0)*H,0,C,r,N,Q),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},n.plane=function(H,n,C,r,N,Q,I,A,P){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=r/2,this._tempNumver1=N/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(H-this._tempNumver0,n+this._tempNumver1,C,Q,I,A,P),this.addVertex(H+this._tempNumver0,n+this._tempNumver1,C,Q,I,A,P),this.addVertex(H-this._tempNumver0,n-this._tempNumver1,C,Q,I,A,P),this.addVertex(H+this._tempNumver0,n-this._tempNumver1,C,Q,I,A,P),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},n.box=function(H,n,C,r,N,Q,I,A,P,t){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=r/2,this._tempNumver1=N/2,this._tempNumver2=Q/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(H-this._tempNumver0,n+this._tempNumver1,C+this._tempNumver2,I,A,P,t),this.addVertex(H+this._tempNumver0,n+this._tempNumver1,C+this._tempNumver2,I,A,P,t),this.addVertex(H-this._tempNumver0,n-this._tempNumver1,C+this._tempNumver2,I,A,P,t),this.addVertex(H+this._tempNumver0,n-this._tempNumver1,C+this._tempNumver2,I,A,P,t),this.addVertex(H+this._tempNumver0,n+this._tempNumver1,C-this._tempNumver2,I,A,P,t),this.addVertex(H-this._tempNumver0,n+this._tempNumver1,C-this._tempNumver2,I,A,P,t),this.addVertex(H+this._tempNumver0,n-this._tempNumver1,C-this._tempNumver2,I,A,P,t),this.addVertex(H-this._tempNumver0,n-this._tempNumver1,C-this._tempNumver2,I,A,P,t),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},n.cone=function(H,n,C,r,N,Q,I){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*C+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*C>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/C,this.addVertexIndex(0,n,0,r,N,Q,I,this._tempUint0),this.addVertexIndex(0,0,0,r,N,Q,I,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<C;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(H*this._tempNumver2,0,H*this._tempNumver3,r,N,Q,I,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==C-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(H*this._tempNumver2,0,H*this._tempNumver3,r,N,Q,I,this._tempUint0+(this._tempInt0+C)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==C-1?this.addIndexes(this._tempUint1+C+2):this.addIndexes(this._tempUint1+this._tempInt0+C+1),this.addIndexes(this._tempUint1+this._tempInt0+C),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},n.boundingBoxLine=function(H,n,C,r,N,Q,I,A,P,t){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(H,N,Q,I,A,P,t),this.addVertex(r,N,Q,I,A,P,t),this.addVertex(H,n,Q,I,A,P,t),this.addVertex(r,n,Q,I,A,P,t),this.addVertex(r,N,C,I,A,P,t),this.addVertex(H,N,C,I,A,P,t),this.addVertex(r,n,C,I,A,P,t),this.addVertex(H,n,C,I,A,P,t),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},n.addVertex=function(H,n,C,r,N,Q,I){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=H,this._vbData[this._posInVBData+1]=n,this._vbData[this._posInVBData+2]=C,this._vbData[this._posInVBData+3]=r,this._vbData[this._posInVBData+4]=N,this._vbData[this._posInVBData+5]=Q,this._vbData[this._posInVBData+6]=I,this._posInVBData+=this._floatSizePerVer,this},n.addVertexIndex=function(H,n,C,r,N,Q,I,A){return this._hasBegun||this.addVertexIndexException(),this._vbData[A]=H,this._vbData[A+1]=n,this._vbData[A+2]=C,this._vbData[A+3]=r,this._vbData[A+4]=N,this._vbData[A+5]=Q,this._vbData[A+6]=I,(A+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=A),this},n.addIndexes=function(H){var n=arguments;this._hasBegun||this.addVertexIndexException();for(var C=0;C<n.length;C++)this._ibData[this._posInIBData]=n[C],this._posInIBData++;return this},n.begin=function(H,n){return this._hasBegun&&this.beginException0(),1!==H&&4!==H&&this.beginException1(),this._primitiveType=H,this._camera=n,this._hasBegun=!0,this},n.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},n.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(H._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),k.drawCall++,b.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},n.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},n.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},n.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},n.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},n.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},n.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(28,[new IH(0,"vector3",0),new IH(12,"vector4",1)])}]),H}()),E=function(){function H(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++H._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new Mn}g(H,"laya.d3.core.render.RenderElement");var n=H.prototype;return n.getDynamicBatchBakedVertexs=function(H){for(var n=this._renderObj._getVertexBuffer(H),C=n.getData().slice(),r=n.vertexDeclaration,N=r.getVertexElementByUsage(0).offset/4,Q=r.getVertexElementByUsage(3).offset/4,I=this._sprite3D.transform,A=I.worldMatrix,P=I.rotation,t=r.vertexStride/4,R=0,y=C.length;R<y;R+=t){var o=R+N,g=R+Q;Kn.transformVector3ArrayToVector3ArrayCoordinate(C,o,A,C,o),Kn.transformVector3ArrayByQuat(C,g,P,C,g)}return C},n.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},n._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},M(0,n,"id",function(){return this._id}),M(0,n,"renderObj",function(){return this._renderObj},function(H){this._renderObj!==H&&(this._renderObj=H)}),H._uniqueIDCounter=0,H}(),G=function(){function n(H){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++n._uniqueIDCounter,this._needSort=!1,this._scene=H,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}g(n,"laya.d3.core.render.RenderQueue");var H=n.prototype;return H._sortOpaqueFunc=function(H,n){if(H._render&&n._render){var C=H._material.renderQueue-n._material.renderQueue;return 0==C?H._material.constructor&&n._material.constructor&&H._material.constructor.name&&n._material.constructor.name&&H._material.constructor.name==H._material.constructor.name&&H._sprite3D&&n._sprite3D&&H._sprite3D.name&&n._sprite3D.name&&H._sprite3D.name===n._sprite3D.name?0:H._render._distanceForSort-n._render._distanceForSort:C}return 0},H._sortAlphaFunc=function(H,n){if(H._render&&n._render){var C=H._material.renderQueue-n._material.renderQueue;return 0==C?H._material.constructor&&n._material.constructor&&H._material.constructor.name&&n._material.constructor.name&&H._material.constructor.name==H._material.constructor.name&&H._sprite3D&&n._sprite3D&&H._sprite3D.name&&n._sprite3D.name&&H._sprite3D.name===n._sprite3D.name?0:n._render._distanceForSort-H._render._distanceForSort:C}return 0},H._begainRenderElement=function(H,n,C){return!!n._beforeRender(H)},H._sortAlpha=function(H){n._cameraPosition=H,this._finalElements.sort(this._sortAlphaFunc)},H._sortOpaque=function(H){n._cameraPosition=H,this._finalElements.sort(this._sortOpaqueFunc)},H._preRender=function(H){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},H._render=function(H,n){for(var C,r,N,Q,I,A,P=k.loopCount,t=this._scene,R=H.camera,y=(R.id,!1),o=0,g=this._finalElements.length;o<g;o++){var M,j,l,f=this._finalElements[o];if(null!=f._onPreRenderFunction&&f._onPreRenderFunction.call(f._sprite3D,H),0===f._type){if(H.owner=l=f._sprite3D,H.renderElement=f,l._preRenderUpdateComponents(H),M=f.renderObj,j=f._material,this._begainRenderElement(H,M,j)){if(C=M._getVertexBuffers(),!(N=(r=M._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[r.id]){this._errorRecord[r.id]=1;var c="vertexBuffer:"+("("+r._destroyed+","+r._released+","+r._referenceCount+","+r._buffer+")")+", material:"+(j?j.__className+"("+j._destroyed+","+j._released+")":"null")+", owner:"+(l?l.__className+"("+l._destroyed+","+l._activeInHierarchy+","+l._displayedInStage+")":"null")+", renderObj:"+(M?M.__className+"("+M._destroyed+","+M._released+","+M._referenceCount+")":"")+", parent:, url:"+(l?l.url:"")+", disposeStack:"+r.disposeStack;z.recordError("报错：unknown vertexDeclaration  "+c)}continue}if(y=(Q=H._shader=j._getShader(t._shaderDefineValue,N.shaderDefineValue,l._shaderDefineValue)).bind()||P!==Q._uploadLoopCount,C){if(Q._uploadVertexBuffer!==C||y){for(var K=0;K<C.length;K++){var W=C[K];Q.uploadAttributesX(W.vertexDeclaration.shaderValues.data,W)}Q._uploadVertexBuffer=C}}else(Q._uploadVertexBuffer!==r||y)&&(Q.uploadAttributes(N.shaderValues.data,null),Q._uploadVertexBuffer=r);(Q._uploadScene!==t||y)&&(Q.uploadSceneUniforms(t._shaderValues.data),Q._uploadScene=t),(R!==Q._uploadCamera||Q._uploadSprite3D!==l||y)&&(Q.uploadSpriteUniforms(l._shaderValues.data),Q._uploadSprite3D=l),(R!==Q._uploadCamera||y)&&(Q.uploadCameraUniforms(R._shaderValues.data),Q._uploadCamera=R),(Q._uploadMaterial!==j||y)&&(j._upload(),Q._uploadMaterial=j),I!==j?(j._setRenderStateBlendDepth(),j._setRenderStateFrontFace(n,l.transform),I=j,A=l):A!==l&&(j._setRenderStateFrontFace(n,l.transform),A=l),M._render(H),Q._uploadLoopCount=P}l._postRenderUpdateComponents(H)}else if(2===f._type){f.renderObj;H.owner=l=f._sprite3D,H.renderElement=f,H._batchIndexStart=f._tempBatchIndexStart,H._batchIndexEnd=f._tempBatchIndexEnd,M=f.renderObj,j=f._material,this._begainRenderElement(H,M,j)&&(N=(r=M._getVertexBuffer(0)).vertexDeclaration,y=(Q=H._shader=j._getShader(t._shaderDefineValue,N.shaderDefineValue,l._shaderDefineValue)).bind()||P!==Q._uploadLoopCount,(Q._uploadVertexBuffer!==r||y)&&(Q.uploadAttributes(N.shaderValues.data,null),Q._uploadVertexBuffer=r),(Q._uploadScene!==t||y)&&(Q.uploadSceneUniforms(t._shaderValues.data),Q._uploadScene=t),(R!==Q._uploadCamera||Q._uploadSprite3D!==l||y)&&(Q.uploadSpriteUniforms(l._shaderValues.data),Q._uploadSprite3D=l),(R!==Q._uploadCamera||y)&&(Q.uploadCameraUniforms(R._shaderValues.data),Q._uploadCamera=R),(Q._uploadMaterial!==j||y)&&(j._upload(),Q._uploadMaterial=j),I!==j?(j._setRenderStateBlendDepth(),j._setRenderStateFrontFace(n,l.transform),I=j,A=l):A!==l&&(j._setRenderStateFrontFace(n,l.transform),A=l),M._render(H),Q._uploadLoopCount=P)}}},H._renderShadow=function(H,n){for(var C,r,N,Q,I,A=k.loopCount,P=this._scene,t=H.camera,R=!1,y=0,o=this._finalElements.length;y<o;y++){var g,M,j,l=this._finalElements[y];0===l._type&&(H.owner=j=l._sprite3D,n||j._projectionViewWorldUpdateCamera===t&&j._projectionViewWorldUpdateLoopCount===k.loopCount||(j._render._renderUpdate(H._projectionViewMatrix),j._projectionViewWorldUpdateLoopCount=k.loopCount,j._projectionViewWorldUpdateCamera=t),H.renderElement=l,j._preRenderUpdateComponents(H),g=l.renderObj,M=l._material,this._begainRenderElement(H,g,null)&&(r=(C=g._getVertexBuffer(0)).vertexDeclaration,R=(N=H._shader=M._getShader(P._shaderDefineValue,r.shaderDefineValue,j._shaderDefineValue)).bind()||A!==N._uploadLoopCount,(N._uploadVertexBuffer!==C||R)&&(N.uploadAttributes(r.shaderValues.data,null),N._uploadVertexBuffer=C),(t!==N._uploadCamera||N._uploadSprite3D!==j||R)&&(N.uploadSpriteUniforms(j._shaderValues.data),N._uploadSprite3D=j),(t!==N._uploadCamera||R)&&(N.uploadCameraUniforms(t._shaderValues.data),N._uploadCamera=t),(N._uploadMaterial!==M||R)&&(M._upload(),N._uploadMaterial=M),N._uploadRenderElement,Q!==M?(M._setRenderStateFrontFace(!1,j.transform),Q=M,I=j):I!==j&&(M._setRenderStateFrontFace(!1,j.transform),I=j),g._render(H),N._uploadLoopCount=A),j._postRenderUpdateComponents(H))}},H._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},H._addRenderElement=function(H){this._renderElements.push(H),this._needSort=!0},H._addDynamicBatchElement=function(H){this._dynamicBatchCombineRenderElements.push(H)},M(0,H,"id",function(){return this._id}),n._uniqueIDCounter=0,n._cameraPosition=null,n}(),J=function(){function H(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return g(H,"laya.d3.core.render.RenderState"),H.clientWidth=0,H.clientHeight=0,H}(),Y=function(){function I(H,n){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new XH(new Pn,0),this._corners=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn],this._boundingBoxCenter=new Pn,this._children=r(8),this._objects=[],this._tempBoundBoxCorners=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn],this._scene=H,this._currentDepth=n}g(I,"laya.d3.core.scene.OctreeNode");var H=I.prototype;return z.imps(H,{"laya.d3.core.scene.ITreeNode":!0}),H.init=function(H,n){var C=new Pn,r=new Pn;Pn.scale(n,-.5,C),Pn.scale(n,.5,r),Pn.add(C,H,C),Pn.add(r,H,r),this.exactBox=new YH(C,r),this.relaxBox=new YH(C,r)},H.addTreeNode=function(H){1===VH.boxContainsBox(this._relaxBox,H.boundingBox)?this.addNodeDown(H,0):this.addObject(H)},H.addChild=function(H){var n=this._children[H];if(null==n){n=new I(this._scene,this._currentDepth+1),(this._children[H]=n)._parent=this,Pn.subtract(this._exactBox.max,this._exactBox.min,I.tempSize),Pn.multiply(I.tempSize,I._octreeSplit[H],I.tempCenter),Pn.add(this._exactBox.min,I.tempCenter,I.tempCenter),Pn.scale(I.tempSize,.25,I.tempSize);var C=new Pn,r=new Pn;Pn.subtract(I.tempCenter,I.tempSize,C),Pn.add(I.tempCenter,I.tempSize,r),n.exactBox=new YH(C,r),Pn.scale(I.tempSize,I.relax,I.tempSize);var N=new Pn,Q=new Pn;Pn.subtract(I.tempCenter,I.tempSize,N),Pn.add(I.tempCenter,I.tempSize,Q),n.relaxBox=new YH(N,Q)}return n},H.addObject=function(H){(H._treeNode=this)._objects.push(H)},H.removeObject=function(H){if(H._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var n=this._objects.indexOf(H);return-1!==n&&(this._objects.splice(n,1),!0)},H.clearObject=function(){this._objects.length=0},H.addNodeUp=function(H,n){this._parent&&1!==VH.boxContainsBox(this._exactBox,H.boundingBox)?this._parent.addNodeUp(H,n-1):this.addNodeDown(H,n)},H.addNodeDown=function(H,n){if(n<this._scene.treeLevel){var C=this.inChildIndex(H.boundingBoxCenter),r=this.addChild(C);1===VH.boxContainsBox(r._relaxBox,H.boundingBox)?r.addNodeDown(H,++n):this.addObject(H)}else this.addObject(H)},H.inChildIndex=function(H){return 4*(H.z<this._boundingBoxCenter.z?0:1)+2*(H.y<this._boundingBoxCenter.y?0:1)+(H.x<this._boundingBoxCenter.x?0:1)},H.updateObject=function(H){1===VH.boxContainsBox(this._relaxBox,H.boundingBox)?(this.removeObject(H),H._treeNode=null,this.addNodeDown(H,this._currentDepth)):this._parent&&(this.removeObject(H),H._treeNode=null,this._parent.addNodeUp(H,this._currentDepth-1))},H.cullingObjects=function(H,n,C,r,N){var Q,I=0,A=0,P=0,t=this._scene._dynamicBatchManager;for(I=0,Q=this._objects.length;I<Q;I++){var R=this._objects[I];if(e.isVisible(R._owner.layer.mask)&&R.enable){if(n&&(k.treeSpriteCollision+=1,0===H.containsBoundSphere(R.boundingSphere)))continue;R._renderUpdate(N),R._distanceForSort=Pn.distance(R.boundingSphere.center,r)+R.sortingFudge;var y=R._renderElements;for(A=0,P=y.length;A<P;A++){var o=y[A],g=o._staticBatch;if(g&&g._material===o._material)g._addBatchRenderElement(o);else{var M=o.renderObj;M.triangleCount<10&&1===M._vertexBufferCount&&M._getIndexBuffer()&&o._material.renderQueue<2&&o._canDynamicBatch&&!R._owner.isStatic?t._addPrepareRenderElement(o):this._scene.getRenderQueue(o._material.renderQueue)._addRenderElement(o)}}}}for(I=0;I<8;I++){var j=this._children[I];if(null!=j){var l=n;if(n){var f=H.containsBoundBox(j._relaxBox);if(k.treeNodeCollision+=1,0===f)continue;l=2===f}j.cullingObjects(H,l,C,r,N)}}},H.cullingShadowObjects=function(H,n,C,r,N){var Q,I=0,A=0,P=0;this._scene._dynamicBatchManager;for(I=0,Q=this._objects.length;I<Q;I++){var t=this._objects[I];if(t.castShadow&&e.isVisible(t._owner.layer.mask)&&t.enable){if(C&&0===H[0].containsBoundSphere(t.boundingSphere))continue;for(var R=1,y=H.length;R<y;R++){var o=n[R-1];if(0!==H[R].containsBoundSphere(t.boundingSphere)){var g=t._renderElements;for(A=0,P=g.length;A<P;A++)o._addRenderElement(g[A])}}}}for(I=0;I<8;I++){var M=this._children[I];if(null!=M){var j=C;if(C){var l=H[0].containsBoundBox(M._relaxBox);if(0===l)continue;j=2===l}M.cullingShadowObjects(H,n,j,r,N)}}},H.cullingShadowObjectsOnePSSM=function(H,n,C,r,N,Q){var I,A=n[0],P=0,t=0,R=0;for(P=0,I=this._objects.length;P<I;P++){var y=this._objects[P];if(y.castShadow&&e.isVisible(y._owner.layer.mask)&&y.enable){if(r&&0===H.containsBoundSphere(y.boundingSphere))continue;y._renderUpdate(C);var o=y._renderElements;for(t=0,R=o.length;t<R;t++)A._addRenderElement(o[t])}}for(P=0;P<8;P++){var g=this._children[P];if(null!=g){var M=r;if(r){var j=H.containsBoundBox(g._relaxBox);if(0===j)continue;M=2===j}g.cullingShadowObjectsOnePSSM(H,n,C,M,N,Q)}}},H.renderBoudingBox=function(H){this._renderBoudingBox(H);for(var n=0;n<8;++n){var C=this._children[n];C&&C.renderBoudingBox(H)}},H.buildAllChild=function(H){if(H<this._scene.treeLevel)for(var n=0;n<8;n++){this.addChild(n).buildAllChild(H+1)}},H._renderBoudingBox=function(H){},M(0,H,"exactBox",function(){return this._exactBox},function(H){this._exactBox=H,Pn.add(H.min,H.max,this._boundingBoxCenter),Pn.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),M(0,H,"relaxBox",function(){return this._relaxBox},function(H){(this._relaxBox=H).getCorners(this._corners),XH.createfromPoints(this._corners,this._boundingSphere)}),I.debugMode=!1,I.relax=1.15,I.CHILDNUM=8,y(I,["tempVector0",function(){return this.tempVector0=new Pn},"tempSize",function(){return this.tempSize=new Pn},"tempCenter",function(){return this.tempCenter=new Pn},"_octreeSplit",function(){return this._octreeSplit=[new Pn(.25,.25,.25),new Pn(.75,.25,.25),new Pn(.25,.75,.25),new Pn(.75,.75,.25),new Pn(.25,.25,.75),new Pn(.75,.25,.75),new Pn(.25,.75,.75),new Pn(.75,.75,.75)]}]),I}(),u=(function(){function H(){}g(H,"laya.d3.core.scene.SceneManager")}(),function(){function H(H,n,C,r){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===H&&(H=1),void 0===n&&(n=1),void 0===C&&(C=1),void 0===r&&(r=1),this._r=H,this._g=n,this._b=C,this._a=r}return g(H,"laya.d3.core.trail.module.Color",null,"Color$1"),H.prototype.cloneTo=function(H){H._r=this._r,H._g=this._g,H._b=this._b,H._a=this._a},y(H,["RED",function(){return this.RED=new H(1,0,0,1)},"GREEN",function(){return this.GREEN=new H(0,1,0,1)},"BLUE",function(){return this.BLUE=new H(0,0,1,1)},"CYAN",function(){return this.CYAN=new H(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new H(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new H(1,0,1,1)},"GRAY",function(){return this.GRAY=new H(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new H(1,1,1,1)},"BLACK",function(){return this.BLACK=new H(0,0,0,1)}]),H}()),X=(function(){function H(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}g(H,"laya.d3.core.trail.module.Gradient");var n=H.prototype;n.setKeys=function(H,n){var C,r;this._colorKeys=H;for(var N=this.index=0;N<H.length;N++){var Q=(C=H[N]).color;this._colorKeyData[this.index++]=Q._r,this._colorKeyData[this.index++]=Q._g,this._colorKeyData[this.index++]=Q._b,this._colorKeyData[this.index++]=C.time}this._alphaKeys=n;for(var I=this.index=0;I<n.length;I++)r=n[I],this._alphaKeyData[this.index++]=r.alpha,this._alphaKeyData[this.index++]=r.time},n.cloneTo=function(H){var n=0,C=0,r=this.colorKeys,N=[];for(n=0,C=r.length;n<C;n++){var Q=new V;r[n].cloneTo(Q),N.push(Q)}var I=this.alphaKeys,A=[];for(n=0,C=I.length;n<C;n++){var P=new X;I[n].cloneTo(P),A.push(P)}H.setKeys(N,A)},M(0,n,"mode",function(){return this._mode},function(H){this._mode=H}),M(0,n,"colorKeys",function(){return this._colorKeys},function(H){this._colorKeys=H;for(var n=this.index=0;n<H.length;n++){var C=H[n],r=C.color;this._colorKeyData[this.index++]=r._r,this._colorKeyData[this.index++]=r._g,this._colorKeyData[this.index++]=r._b,this._colorKeyData[this.index++]=C.time}}),M(0,n,"alphaKeys",function(){return this._alphaKeys},function(H){this._alphaKeys=H;for(var n=this.index=0;n<H.length;n++){var C=H[n];this._alphaKeyData[this.index++]=C.alpha,this._alphaKeyData[this.index++]=C.time}})}(),function(){function H(H,n){this._alpha=NaN,this._time=NaN,void 0===H&&(H=0),void 0===n&&(n=0),this._alpha=H,this._time=n}g(H,"laya.d3.core.trail.module.GradientAlphaKey");var n=H.prototype;return n.cloneTo=function(H){H.alpha=this.alpha,H.time=this.time},M(0,n,"alpha",function(){return this._alpha},function(H){this._alpha=H}),M(0,n,"time",function(){return this._time},function(H){this._time=H}),H}()),V=function(){function H(H,n){this._color=null,this._time=NaN,void 0===n&&(n=0),this._color=H||new u,this._time=n}g(H,"laya.d3.core.trail.module.GradientColorKey");var n=H.prototype;return n.cloneTo=function(H){this.color.cloneTo(H.color),H.time=this.time},M(0,n,"color",function(){return this._color},function(H){this._color=H}),M(0,n,"time",function(){return this._time},function(H){this._time=H}),H}(),B=(function(){function H(){}g(H,"laya.d3.core.trail.module.GradientMode"),H.Blend=0,H.Fixed=1}(),function(){function H(){}g(H,"laya.d3.core.trail.module.TextureMode"),H.Stretch=0,H.Tile=1}(),function(){function H(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}g(H,"laya.d3.core.trail.module.TrailKeyFrame"),H.prototype.cloneTo=function(H){H.time=this.time,H.inTangent=this.inTangent,H.outTangent=this.outTangent,H.value=this.value}}(),function(){function n(H){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new Pn,this._curPosition=new Pn,this._delVector3=new Pn,this._lastFixedVertexPosition=new Pn,this._pointAtoBVector3=new Pn,this._pointA=new Pn,this._pointB=new Pn,this._owner=H,this._id=n.renderElementCount++,0==this._id?H._owner.transform.position.cloneTo(this._lastPosition):H._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new Sn(B.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new Sn(B.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}g(n,"laya.d3.core.trail.TrailRenderElement");var H=n.prototype;z.imps(H,{"laya.d3.core.render.IRenderable":!0}),H._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},H._addTrailByFirstPosition=function(H,n){Pn.subtract(n,H,this._delVector3),Pn.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Pn.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Pn.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(H),H.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},H._addTrailByNextPosition=function(H){Pn.subtract(H,this._lastFixedVertexPosition,this._delVector3),Pn.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),Pn.normalize(this._pointAtoBVector3,this._pointAtoBVector3),Pn.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=Pn.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=BH.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(H),H.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(H),this._virtualVerticesCount=2)},H._updateVerticesByPosition=function(H){this._pointe=H.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},H._updateVertexBuffer2=function(){var H,n=0,C=0,r=0;for(r=0,H=(this._verticesCount+this._virtualVerticesCount)/2;r<H;r++)C=0==this._owner.textureMode?(this._VerticesToTailLength[r]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[r],this._vertices2[n++]=1-C,this._vertices2[n++]=1-C;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},H._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},H._updateDisappear=function(){var H,n=0;for(n=this._curDisappearIndex,H=(this._verticesCount+this._virtualVerticesCount)/2;n<H;n++)this._owner._curtime-this._everyGroupVertexBirthTime[n]>=this._owner.time+BH.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},H._beforeRender=function(H){return this._camera=H.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),Pn.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},H._render=function(H){this._isDead||(b.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),k.drawCall++,k.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},H._getVertexBuffer=function(H){return void 0===H&&(H=0),0===H?this._vertexBuffer1:1===H?this._vertexBuffer2:null},H._getVertexBuffers=function(){return this._vertexBuffers},H._getIndexBuffer=function(){return null},H.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},H._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},M(0,H,"_vertexBufferCount",function(){return this._vertexBuffers.length}),M(0,H,"triangleCount",function(){return 0}),n.renderElementCount=0}(),function(){function H(){}g(H,"laya.d3.core.trail.VertexTrail");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration1}),M(1,H,"vertexDeclaration1",function(){return H._vertexDeclaration1}),M(1,H,"vertexDeclaration2",function(){return H._vertexDeclaration2}),y(H,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new QH(32,[new IH(0,"vector3",0),new IH(12,"vector3",41),new IH(24,"single",33),new IH(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new QH(4,[new IH(0,"single",38)])}]),H}()),HH=function(){function W(H){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=H}g(W,"laya.d3.graphics.DynamicBatch");var H=W.prototype;return z.imps(H,{"laya.d3.core.render.IRenderable":!0}),H._getVertexBuffer=function(H){return void 0===H&&(H=0),0===H?this._vertexBuffer:null},H._getIndexBuffer=function(){return this._indexBuffer},H._getCombineRenderElementFromPool=function(H,n,C){var r=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return r||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=r=new E,r._sprite3D=new HC),r._sprite3D._render._renderUpdate(C),r},H._getRenderElement=function(H,n,C){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*W.maxVertexCount),this._indexDatas=new Uint16Array(W.maxIndexCount),this._vertexBuffer=Sn.create(this._vertexDeclaration,W.maxVertexCount,35048),this._indexBuffer=On.create("ushort",W.maxIndexCount,35048));for(var r=this._merageElements.length=0,N=0,Q=0,I=this._combineRenderElements.length;Q<I;Q++){var A=this._combineRenderElements[Q],P=A.getDynamicBatchBakedVertexs(0),t=A.getBakedIndices(),R=A._sprite3D.transform._isFrontFaceInvert,y=r/(this._vertexDeclaration.vertexStride/4),o=N,g=o+t.length;A._tempBatchIndexStart=o,A._tempBatchIndexEnd=g,this._indexDatas.set(t,N);var M=0;if(R)for(M=o;M<g;M+=3){this._indexDatas[M]=y+this._indexDatas[M];var j=this._indexDatas[M+1],l=this._indexDatas[M+2];this._indexDatas[M+1]=y+l,this._indexDatas[M+2]=y+j}else for(M=o;M<g;M+=3)this._indexDatas[M]=y+this._indexDatas[M],this._indexDatas[M+1]=y+this._indexDatas[M+1],this._indexDatas[M+2]=y+this._indexDatas[M+2];N+=t.length,this._vertexDatas.set(P,r),r+=P.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),Q=this._combineRenderElementPoolIndex=0,I=this._materials.length;Q<I;Q++){var f=this._getCombineRenderElementFromPool(H,n,C);f._type=2,f._staticBatch=null;var c=(f.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[Q]]._tempBatchIndexStart,K=Q+1===this._materialToRenderElementsOffsets.length?N:this._combineRenderElements[this._materialToRenderElementsOffsets[Q+1]]._tempBatchIndexStart;f._tempBatchIndexStart=c,f._tempBatchIndexEnd=K,f._material=this._materials[Q],this._merageElements.push(f)}},H._addCombineRenderObjTest=function(H){var n=H.renderObj,C=this._currentCombineIndexCount+n._getIndexBuffer().indexCount,r=this._currentCombineVertexCount+n._getVertexBuffer().vertexCount;return!(W.maxVertexCount<r||W.maxIndexCount<C)},H._addCombineRenderObj=function(H){var n=H.renderObj;this._combineRenderElements.push(H),this._currentCombineIndexCount=this._currentCombineIndexCount+n._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+n._getVertexBuffer().vertexCount},H._addCombineMaterial=function(H){this._materials.push(H)},H._addMaterialToRenderElementOffset=function(H){this._materialToRenderElementsOffsets.push(H)},H._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},H._addToRenderQueue=function(H,n,C,r){this._getRenderElement(n,C,r);for(var N=0,Q=this._materials.length;N<Q;N++)H.getRenderQueue(this._materials[N].renderQueue)._addDynamicBatchElement(this._merageElements[N])},H._beforeRender=function(H){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},H._render=function(H){var n=H._batchIndexEnd-H._batchIndexStart;b.mainContext.drawElements(4,n,5123,2*H._batchIndexStart),k.drawCall++,k.trianglesFaces+=n/3},H._getVertexBuffers=function(){return null},M(0,H,"_vertexBufferCount",function(){return 1}),M(0,H,"triangleCount",function(){return this._indexBuffer.indexCount/3}),M(0,H,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),W.maxVertexCount=2e4,W.maxIndexCount=4e4,W.maxCombineTriangleCount=10,W}(),nH=function(){function W(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}g(W,"laya.d3.graphics.DynamicBatchManager");var H=W.prototype;return H.getDynamicBatch=function(H,n){var C,r=H.id.toString()+n;return this._dynamicBatches[r]?C=this._dynamicBatches[r]:this._dynamicBatches[r]=C=new HH(H),C},H._garbageCollection=function(){for(var H in this._dynamicBatches)0===this._dynamicBatches[H].combineRenderElementsCount&&delete this._dynamicBatches[H]},H._addPrepareRenderElement=function(H){this._prepareDynamicBatchCombineElements.push(H)},H._finishCombineDynamicBatch=function(H){var n,C,r;this._prepareDynamicBatchCombineElements.sort(W._sortPrepareDynamicBatch);for(var N,Q,I,A,P,t=-1,R=!0,y=0,o=-1,g=0,M=this._prepareDynamicBatchCombineElements.length;g<M;g++){var j=(Q=this._prepareDynamicBatchCombineElements[g]).renderObj._getVertexBuffer(0).vertexDeclaration,l=C!==j;l&&(y=0,C=j);var f=y!==t;if(f&&(t=y),(l||f)&&(I=this.getDynamicBatch(j,y),n=null),R)if(I._addCombineRenderObjTest(Q)){if(n!==(N=Q._material))A&&(H.getRenderQueue(P._material.renderQueue)._addRenderElement(P),P=A=null,o=-1),A=N,o=I.combineRenderElementsCount,P=Q,n=N;else if(A){var c=P.renderObj,K=Q.renderObj;c._getVertexBuffer().vertexCount+K._getVertexBuffer().vertexCount>HH.maxVertexCount||c._getIndexBuffer().indexCount+K._getIndexBuffer().indexCount>HH.maxIndexCount?(H.getRenderQueue(P._material.renderQueue)._addRenderElement(P),A=N,o=I.combineRenderElementsCount,P=Q):(I._addCombineMaterial(A),I._addMaterialToRenderElementOffset(o),I._addCombineRenderObj(P),P=A=null,o=-1,I._addCombineRenderObj(Q))}else I._addCombineRenderObj(Q);R=!0}else A&&(H.getRenderQueue(P._material.renderQueue)._addRenderElement(P),P=A=null,o=-1),y++,R=!1;else r=this._prepareDynamicBatchCombineElements[g-1],I._addMaterialToRenderElementOffset(I.combineRenderElementsCount),n=r._material,I._addCombineMaterial(n),I._addCombineRenderObj(r),R=!0,n!==(N=Q._material)?(A=N,o=I.combineRenderElementsCount,P=Q):I._addCombineRenderObj(Q),n=N}A&&(H.getRenderQueue(P._material.renderQueue)._addRenderElement(P),P=A=null,o=-1),this._prepareDynamicBatchCombineElements.length=0},H._clearRenderElements=function(){for(var H in this._dynamicBatches)this._dynamicBatches[H]._clearRenderElements()},H._addToRenderQueue=function(H,n,C,r){for(var N in this._dynamicBatches){var Q=this._dynamicBatches[N];0<Q.combineRenderElementsCount&&Q._addToRenderQueue(H,n,C,r)}},H.dispose=function(){this._dynamicBatches=null},W._sortPrepareDynamicBatch=function(H,n){return H._mainSortID-n._mainSortID},W}(),CH=function(){function H(){}return g(H,"laya.d3.graphics.FrustumCulling"),H.renderShadowObjectCulling=function(H,n,C,r,N){var Q=0,I=0,A=0,P=0;for(Q=0,A=C.length;Q<A;Q++){var t=C[Q];t&&t._clearRenderElements()}var R,y,o,g=H._cullingRenders;if(1<N){for(Q=0,A=H._cullingRendersLength;Q<A;Q++)if((R=g[Q]).castShadow&&e.isVisible(R._owner.layer.mask)&&R.enable)for(var M=1,j=n.length;M<j;M++)if(y=C[M-1],0!==n[M].containsBoundSphere(R.boundingSphere))for(I=0,P=(o=R._renderElements).length;I<P;I++)y._addRenderElement(o[I])}else for(Q=0,A=H._cullingRendersLength;Q<A;Q++)if((R=g[Q]).castShadow&&e.isVisible(R._owner.layer.mask)&&R.enable&&0!==n[0].containsBoundSphere(R.boundingSphere))for(R._renderUpdate(r),y=C[0],I=0,P=(o=R._renderElements).length;I<P;I++)y._addRenderElement(o[I])},H.renderShadowObjectCullingOctree=function(H,n,C,r,N){for(var Q=0,I=C.length;Q<I;Q++){var A=C[Q];A&&A._clearRenderElements()}1<N?H.treeRoot.cullingShadowObjects(n,C,!0,0,H):H.treeRoot.cullingShadowObjectsOnePSSM(n[0],C,r,!0,0,H)},H.renderObjectCulling=function(H,n,C,r,N,Q){var I=0,A=0,P=0,t=0,R=n._quenes,y=n._dynamicBatchManager,o=n._cullingRenders;for(I=0,A=R.length;I<A;I++){var g=R[I];g&&g._clearRenderElements()}var M=rH._staticBatchManagers;for(I=0,A=M.length;I<A;I++)M[I]._clearRenderElements();y._clearRenderElements();var j=C.transform.position;for(I=0,A=n._cullingRendersLength;I<A;I++){var l=o[I];if(e.isVisible(l._owner.layer.mask)&&l.enable&&0!==H.containsBoundSphere(l.boundingSphere)&&l._renderUpdate(Q)){l._distanceForSort=Pn.distance(l.boundingSphere.center,j)+l.sortingFudge;var f=l._renderElements;for(P=0,t=f.length;P<t;P++){var c=f[P],K=c._staticBatch;if(K&&K._material===c._material)K._addBatchRenderElement(c);else{var W=c.renderObj;W.triangleCount<10&&1===W._vertexBufferCount&&W._getIndexBuffer()&&c._material.renderQueue<2&&c._canDynamicBatch&&!l._owner.isStatic?y._addPrepareRenderElement(c):n.getRenderQueue(c._material.renderQueue)._addRenderElement(c)}}}}for(I=0,A=M.length;I<A;I++)M[I]._addToRenderQueue(n,r,N,Q);y._finishCombineDynamicBatch(n),y._addToRenderQueue(n,r,N,Q)},H.renderObjectCullingOctree=function(H,n,C,r,N,Q){var I=0,A=0,P=n._quenes,t=n._dynamicBatchManager;for(I=0,A=P.length;I<A;I++){var R=P[I];R&&R._clearRenderElements()}var y=rH._staticBatchManagers;for(I=0,A=y.length;I<A;I++)y[I]._clearRenderElements();for(t._clearRenderElements(),n._cullingRenders.length=0,n.treeRoot.cullingObjects(H,!0,0,C.transform.position,Q),I=0,A=y.length;I<A;I++)y[I]._addToRenderQueue(n,r,N,Q);t._finishCombineDynamicBatch(n),t._addToRenderQueue(n,r,N,Q)},H.renderObjectCullingNoBoundFrustum=function(H,n,C,r,N){var Q=0,I=0,A=0,P=0,t=H._quenes,R=H._dynamicBatchManager,y=H._cullingRenders;for(Q=0,I=t.length;Q<I;Q++){var o=t[Q];o&&o._clearRenderElements()}var g=rH._staticBatchManagers;for(Q=0,I=g.length;Q<I;Q++)g[Q]._clearRenderElements();R._clearRenderElements();var M=n.transform.position;for(Q=0,I=H._cullingRendersLength;Q<I;Q++){var j=y[Q];if(e.isVisible(j._owner.layer.mask)&&j.enable){j._renderUpdate(N),j._distanceForSort=Pn.distance(j.boundingSphere.center,M)+j.sortingFudge;var l=j._renderElements;for(A=0,P=l.length;A<P;A++){var f=l[A],c=f._staticBatch;if(c&&c._material===f._material)c._addBatchRenderElement(f);else{var K=f.renderObj;K.triangleCount<10&&1===K._vertexBufferCount&&K._getIndexBuffer()&&f._material.renderQueue<2&&f._canDynamicBatch&&!j._owner.isStatic?R._addPrepareRenderElement(f):H.getRenderQueue(f._material.renderQueue)._addRenderElement(f)}}}}for(Q=0,I=g.length;Q<I;Q++)g[Q]._addToRenderQueue(H,C,r,N);R._finishCombineDynamicBatch(H),R._addToRenderQueue(H,C,r,N)},H}(),rH=function(){function Q(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}g(Q,"laya.d3.graphics.StaticBatchManager");var H=Q.prototype;return H._finishInit=function(){for(var H in this._staticBatches)this._staticBatches[H]._finishInit();this._initBatchRenderElements.length=0},H._initStaticBatchs=function(H){throw new Error("StaticBatchManager:must override this function.")},H._addInitBatchSprite=function(H){for(var n=H._render._renderElements,C=0,r=n.length;C<r;C++)this._initBatchRenderElements.push(n[C])},H._clearRenderElements=function(){for(var H in this._staticBatches)this._staticBatches[H]._clearRenderElements()},H._garbageCollection=function(H){var n=H._staticBatch,C=n._initBatchRenderElements,r=C.indexOf(H);C.splice(r,1),0===C.length&&(n.dispose(),delete this._staticBatches[n._key])},H._addToRenderQueue=function(H,n,C,r){for(var N in this._staticBatches){var Q=this._staticBatches[N];0<Q._batchRenderElements.length&&Q._updateToRenderQueue(H,r)}},H.dispose=function(){this._staticBatches=null},Q._addToStaticBatchQueue=function(H){H instanceof laya.d3.core.RenderableSprite3D&&H._addToInitStaticBatchManager();for(var n=0,C=H.numChildren;n<C;n++)Q._addToStaticBatchQueue(H._childs[n])},Q.combine=function(H,n){var C,r=0,N=0;if(n)for(r=0,N=n.length;r<N;r++){n[r]._addToInitStaticBatchManager()}else H&&Q._addToStaticBatchQueue(H);for(r=0,N=Q._staticBatchManagers.length;r<N;r++)(C=Q._staticBatchManagers[r])._initStaticBatchs(H),C._finishInit()},Q._staticBatchManagers=[],Q}(),NH=function(){function H(H,n,C){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=H,this._manager=n,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=C}g(H,"laya.d3.graphics.StaticBatch");var n=H.prototype;return z.imps(n,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),n._binarySearch=function(H){for(var n=0,C=this._batchRenderElements.length-1,r=0;n<=C;)r=Math.floor((n+C)/2),this._compareBatchRenderElement(this._batchRenderElements[r],H)?C=r-1:n=r+1;return n},n._compareBatchRenderElement=function(H,n){throw new Error("StaticBatch:must override this function.")},n._getVertexDecLightMap=function(H){return H===dH.vertexDeclaration?eH.vertexDeclaration:H===mH.vertexDeclaration?vH.vertexDeclaration:H===iH.vertexDeclaration?WH.vertexDeclaration:H===$H.vertexDeclaration?null:H===jH.vertexDeclaration?lH.vertexDeclaration:H===UH.vertexDeclaration?qH.vertexDeclaration:H===bH.vertexDeclaration?hH.vertexDeclaration:H===_H.vertexDeclaration?ZH.vertexDeclaration:H===mH.vertexDeclaration?vH.vertexDeclaration:H===aH.vertexDeclaration?zH.vertexDeclaration:H===$H.vertexDeclaration?null:H===jH.vertexDeclaration?lH.vertexDeclaration:H===sH.vertexDeclaration?pH.vertexDeclaration:H===bH.vertexDeclaration?hH.vertexDeclaration:H},n._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},n._addBatchRenderElement=function(H){this._batchRenderElements.splice(this._binarySearch(H),0,H)},n._updateToRenderQueue=function(H,n){this._combineRenderElementPoolIndex=0,this._getRenderElement(H.getRenderQueue(this._material.renderQueue)._renderElements,H,n)},n._getRenderElement=function(H,n,C){throw new Error("StaticBatch:must override this function.")},n._finishInit=function(){throw new Error("StaticBatch:must override this function.")},n._clearRenderElements=function(){this._batchRenderElements.length=0},n.dispose=function(){},n._getVertexBuffer=function(H){return void 0===H&&(H=0),null},n._getIndexBuffer=function(){return null},n._beforeRender=function(H){return!0},n._render=function(H){},n._getVertexBuffers=function(){return null},M(0,n,"_vertexBufferCount",function(){return 1}),M(0,n,"triangleCount",function(){return 0}),H.combine=function(H){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),rH.combine(H)},H.maxBatchVertexCount=65535,H}(),QH=function(){function I(H,n){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++I._uniqueIDCounter,this._id>I.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",I.maxVertexDeclaration);this._shaderValues=new Mn,this._vertexElementsDic={},this._vertexStride=H,this._vertexElements=n;for(var C=0;C<n.length;C++){var r=n[C],N=r.elementUsage;this._vertexElementsDic[N]=r;var Q=[I._getTypeSize(r.elementFormat)/4,5126,!1,this._vertexStride,r.offset];switch(this._shaderValues.setValue(N,Q),N){case 1:this._addShaderDefine(Ln.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(Ln.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(Ln.SHADERDEFINE_UV1)}}}g(I,"laya.d3.graphics.VertexDeclaration");var H=I.prototype;return H._addShaderDefine=function(H){this._shaderDefineValue|=H},H._removeShaderDefine=function(H){this._shaderDefineValue&=~H},H.getVertexElements=function(){return this._vertexElements.slice()},H.getVertexElementByUsage=function(H){return this._vertexElementsDic[H]},H.unBinding=function(){},M(0,H,"shaderDefineValue",function(){return this._shaderDefineValue}),M(0,H,"id",function(){return this._id}),M(0,H,"vertexStride",function(){return this._vertexStride}),M(0,H,"shaderValues",function(){return this._shaderValues}),I._getTypeSize=function(H){switch(H){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},I.getVertexStride=function(H){for(var n=0,C=0;C<H.Length;C++){var r=H[C],N=r.offset+I._getTypeSize(r.elementFormat);n<N&&(n=N)}return n},I._maxVertexDeclarationBit=1e3,I._uniqueIDCounter=1,y(I,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),I}(),IH=function(){function H(H,n,C){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=H,this.elementFormat=n,this.elementUsage=C}return g(H,"laya.d3.graphics.VertexElement"),H}(),AH=(function(){function H(){}g(H,"laya.d3.graphics.VertexElementFormat"),H.Single="single",H.Vector2="vector2",H.Vector3="vector3",H.Vector4="vector4",H.Color="color",H.Byte4="byte4",H.Short2="short2",H.Short4="short4",H.NormalizedShort2="normalizedshort2",H.NormalizedShort4="normalizedshort4",H.HalfVector2="halfvector2",H.HalfVector4="halfvector4"}(),function(){function H(){}g(H,"laya.d3.graphics.VertexElementUsage"),H.POSITION0=0,H.COLOR0=1,H.TEXTURECOORDINATE0=2,H.NORMAL0=3,H.BINORMAL0=4,H.TANGENT0=5,H.BLENDINDICES0=6,H.BLENDWEIGHT0=7,H.DEPTH0=8,H.FOG0=9,H.POINTSIZE0=10,H.SAMPLE0=11,H.TESSELLATEFACTOR0=12,H.COLOR1=13,H.NEXTTEXTURECOORDINATE0=14,H.TEXTURECOORDINATE1=15,H.NEXTTEXTURECOORDINATE1=16,H.CORNERTEXTURECOORDINATE0=17,H.VELOCITY0=18,H.STARTCOLOR0=19,H.STARTSIZE=20,H.AGEADDSCALE0=21,H.STARTROTATION=22,H.ENDCOLOR0=23,H.STARTLIFETIME=24,H.TIME0=33,H.SHAPEPOSITIONSTARTLIFETIME=30,H.DIRECTIONTIME=32,H.SIZEROTATION0=27,H.RADIUS0=28,H.RADIAN0=29,H.STARTSPEED=31,H.RANDOM0=34,H.RANDOM1=35,H.SIMULATIONWORLDPOSTION=36,H.SIMULATIONWORLDROTATION=37,H.TEXTURECOORDINATE0X=38,H.TEXTURECOORDINATE0X1=39,H.TEXTURECOORDINATE0Y=40,H.OFFSETVECTOR=41}(),function(){function H(H,n,C){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=H,this._textureCoordinate0=n,this._time=C}g(H,"laya.d3.graphics.VertexGlitter");var n=H.prototype;z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate0}),M(0,n,"position",function(){return this._position}),M(0,n,"time",function(){return this._time}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(24,[new IH(0,"vector3",0),new IH(12,"vector2",2),new IH(20,"single",33)])}])}(),function(){function H(H,n,C,r,N,Q,I,A,P,t){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=H,this._position=n,this._velocity=C,this._startColor=r,this._endColor=N,this._sizeRotation=Q,this._radius=I,this._radian=A,this._ageAddScale=P,this._time=t}g(H,"laya.d3.graphics.VertexParticle");var n=H.prototype;z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"endColor",function(){return this._endColor}),M(0,n,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),M(0,n,"sizeRotation",function(){return this._sizeRotation}),M(0,n,"velocity",function(){return this._velocity}),M(0,n,"position",function(){return this._position}),M(0,n,"startColor",function(){return this._startColor}),M(0,n,"radius",function(){return this._radius}),M(0,n,"radian",function(){return this._radian}),M(0,n,"ageAddScale",function(){return this._ageAddScale}),M(0,n,"time",function(){return this._time}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(116,[new IH(0,"vector4",17),new IH(16,"vector3",0),new IH(28,"vector3",18),new IH(40,"vector4",19),new IH(56,"vector4",23),new IH(72,"vector3",27),new IH(84,"vector2",28),new IH(92,"vector4",29),new IH(108,"single",24),new IH(112,"single",33)])}])}(),function(){function H(H){this._position=null,this._position=H}g(H,"laya.d3.graphics.VertexPosition");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(12,[new IH(0,"vector3",0)])}]),H}()),PH=function(){function H(H,n){this._position=null,this._normal=null,this._position=H,this._normal=n}g(H,"laya.d3.graphics.VertexPositionNormal");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(24,[new IH(0,"vector3",0),new IH(12,"vector3",3)])}]),H}(),tH=function(){function H(H,n,C){this._position=null,this._normal=null,this._color=null,this._position=H,this._normal=n,this._color=C}g(H,"laya.d3.graphics.VertexPositionNormalColor");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(40,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1)])}]),H}(),RH=function(){function H(H,n,C,r,N){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=H,this._normal=n,this._color=C,this._blendIndex=r,this._blendWeight=N}g(H,"laya.d3.graphics.VertexPositionNormalColorSkin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(72,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector4",7),new IH(56,"vector4",6)])}]),H}(),yH=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._tangent=r,this._blendIndex=N,this._blendWeight=Q}g(H,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(88,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector4",7),new IH(56,"vector4",6),new IH(72,"vector4",5)])}]),H}(),oH=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._tangent=r,this._blendIndex=N,this._blendWeight=Q}g(H,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(84,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector4",7),new IH(56,"vector4",6),new IH(72,"vector3",5)])}]),H}(),gH=function(){function H(H,n,C,r){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._tangent=r}g(H,"laya.d3.graphics.VertexPositionNormalColorSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(56,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector4",5)])}]),H}(),MH=function(){function H(H,n,C,r){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._tangent=r}g(H,"laya.d3.graphics.VertexPositionNormalColorTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(52,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector3",5)])}]),H}(),jH=function(){function H(H,n,C,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate=r}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(48,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2)])}]),H}(),lH=function(){function H(H,n,C,r,N){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate0=r,this._textureCoordinate1=N}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(56,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector2",15)])}]),H}(),fH=function(){function H(H,n,C,r,N,Q,I){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate0=r,this._textureCoordinate1=N,this._blendIndex=Q,this._blendWeight=I}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(88,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector2",15),new IH(56,"vector4",7),new IH(72,"vector4",6)])}]),H}(),cH=function(){function H(H,n,C,r,N,Q,I,A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate0=r,this._textureCoordinate1=N,this._tangent=Q,this._blendIndex=I,this._blendWeight=A}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(104,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector2",15),new IH(56,"vector4",7),new IH(72,"vector4",6),new IH(88,"vector4",5)])}]),H}(),KH=function(){function H(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),n.VertexPositionNormalColorTexture0SkinTangent=function(H,n,C,r,N,Q,I,A){this._position=H,this._normal=n,this._color=C,this._textureCoordinate0=r,this._textureCoordinate1=N,this._tangent=Q,this._blendIndex=I,this._blendWeight=A},M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(100,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector2",15),new IH(56,"vector4",7),new IH(72,"vector4",6),new IH(88,"vector3",5)])}]),H}(),WH=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate0=r,this._textureCoordinate1=N,this._tangent=Q}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(72,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector2",15),new IH(56,"vector4",5)])}]),H}(),zH=function(){function H(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}g(H,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),n.VertexPositionNormalColorTexture0Tangent=function(H,n,C,r,N,Q){this._position=H,this._normal=n,this._color=C,this._textureCoordinate0=r,this._textureCoordinate1=N,this._tangent=Q},M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(68,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector2",15),new IH(56,"vector3",5)])}]),H}(),wH=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate=r,this._blendIndex=N,this._blendWeight=Q}g(H,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(80,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector4",7),new IH(64,"vector4",6)])}]),H}(),FH=function(){function H(H,n,C,r,N,Q,I){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate=r,this._tangent=N,this._blendIndex=Q,this._blendWeight=I}g(H,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(96,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector4",7),new IH(64,"vector4",6),new IH(80,"vector4",5)])}]),H}(),kH=function(){function H(H,n,C,r,N,Q,I){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate=r,this._tangent=N,this._blendIndex=Q,this._blendWeight=I}g(H,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"color",function(){return this._color}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(92,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector4",7),new IH(64,"vector4",6),new IH(80,"vector3",5)])}]),H}(),iH=function(){function H(H,n,C,r,N){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate=r,this._tangent=N}g(H,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(64,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector4",5)])}]),H}(),aH=function(){function H(H,n,C,r,N){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=H,this._normal=n,this._color=C,this._textureCoordinate=r,this._tangent=N}g(H,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"color",function(){return this._color}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(60,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",1),new IH(40,"vector2",2),new IH(48,"vector3",5)])}]),H}(),DH=function(){function H(H,n,C){this._position=null,this._normal=null,this._tangent=null,this._position=H,this._normal=n,this._tangent=C}g(H,"laya.d3.graphics.VertexPositionNormalSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(40,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector4",5)])}]),H}(),LH=function(){function H(H,n,C){this._position=null,this._normal=null,this._tangent=null,this._position=H,this._normal=n,this._tangent=C}g(H,"laya.d3.graphics.VertexPositionNormalTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(36,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector3",5)])}]),H}(),bH=function(){function H(H,n,C){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=H,this._normal=n,this._textureCoordinate=C}g(H,"laya.d3.graphics.VertexPositionNormalTexture");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(32,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2)])}]),H}(),hH=function(){function H(H,n,C,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=H,this._normal=n,this._textureCoordinate0=C,this._textureCoordinate1=r}g(H,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(40,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15)])}]),H}(),vH=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=H,this._normal=n,this._textureCoordinate0=C,this._textureCoordinate1=r,this._blendIndex=N,this._blendWeight=Q}g(H,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(72,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15),new IH(40,"vector4",7),new IH(56,"vector4",6)])}]),H}(),eH=function(){function H(H,n,C,r,N,Q,I){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._textureCoordinate0=C,this._textureCoordinate1=r,this._tangent=N,this._blendIndex=Q,this._blendWeight=I}g(H,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(88,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15),new IH(40,"vector4",7),new IH(56,"vector4",6),new IH(72,"vector4",5)])}]),H}(),ZH=function(){function H(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}g(H,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),n.VertexPositionNormalTexture0SkinTangent=function(H,n,C,r,N,Q,I){this._position=H,this._normal=n,this._textureCoordinate0=C,this._textureCoordinate1=r,this._tangent=N,this._blendIndex=Q,this._blendWeight=I},M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(84,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15),new IH(40,"vector4",7),new IH(56,"vector4",6),new IH(72,"vector3",5)])}]),H}(),qH=function(){function H(H,n,C,r,N){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=H,this._normal=n,this._textureCoordinate0=C,this._textureCoordinate1=r,this._tangent=N}g(H,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(56,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15),new IH(40,"vector4",5)])}]),H}(),pH=function(){function H(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}g(H,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),n.VertexPositionNormalTexture0Tangent=function(H,n,C,r,N){this._position=H,this._normal=n,this._textureCoordinate0=C,this._textureCoordinate1=r,this._tangent=N},M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(52,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15),new IH(40,"vector3",5)])}]),H}(),mH=function(){function H(H,n,C,r,N){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=H,this._normal=n,this._textureCoordinate=C,this._blendIndex=r,this._blendWeight=N}g(H,"laya.d3.graphics.VertexPositionNormalTextureSkin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(64,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector4",7),new IH(48,"vector4",6)])}]),H}(),dH=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._textureCoordinate=C,this._tangent=r,this._blendIndex=N,this._blendWeight=Q}g(H,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(80,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector4",7),new IH(48,"vector4",6),new IH(64,"vector4",5)])}]),H}(),_H=function(){function H(H,n,C,r,N,Q){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=H,this._normal=n,this._textureCoordinate=C,this._tangent=r,this._blendIndex=N,this._blendWeight=Q}g(H,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(76,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector4",7),new IH(48,"vector4",6),new IH(64,"vector3",5)])}]),H}(),UH=function(){function H(H,n,C,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=H,this._normal=n,this._textureCoordinate=C,this._tangent=r}g(H,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(48,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector4",5)])}]),H}(),sH=function(){function H(H,n,C,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=H,this._normal=n,this._textureCoordinate=C,this._tangent=r}g(H,"laya.d3.graphics.VertexPositionNormalTextureTangent");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(44,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector3",5)])}]),H}(),$H=function(){function H(H,n,C){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=H,this._normal=n,this._textureCoordinate=C}g(H,"laya.d3.graphics.VertexPositionNTBTexture");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(56,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector3",5),new IH(36,"vector3",4),new IH(48,"vector2",2)])}]),H}(),xH=function(){function H(H,n,C,r,N,Q,I,A){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=H,this._normal=n,this._textureCoordinate0=r,this._textureCoordinate1=N,this._tangent=Q,C=C,this._blendIndex=I,this._blendWeight=A}g(H,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"tangent",function(){return this._tangent}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(0,n,"textureCoordinate1",function(){return this._textureCoordinate1}),M(0,n,"blendIndex",function(){return this._blendIndex}),M(0,n,"blendWeight",function(){return this._blendWeight}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(96,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector3",5),new IH(36,"vector3",4),new IH(48,"vector2",2),new IH(56,"vector2",15),new IH(64,"vector4",7),new IH(80,"vector4",6)])}]),H}(),OH=function(){function H(H,n,C){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=H,this._normal=n,this._textureCoordinate=C}g(H,"laya.d3.graphics.VertexPositionNTBTextureSkin");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"textureCoordinate",function(){return this._textureCoordinate}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(88,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector3",5),new IH(36,"vector3",4),new IH(48,"vector2",2),new IH(56,"vector4",7),new IH(72,"vector4",6)])}]),H}(),SH=(function(){function H(H,n,C,r){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=H,this._normal=n,this._textureCoord0=C,this._textureCoord1=r}g(H,"laya.d3.graphics.VertexPositionTerrain");var n=H.prototype;z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"normal",function(){return this._normal}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoord0",function(){return this._textureCoord0}),M(0,n,"textureCoord1",function(){return this._textureCoord1}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(40,[new IH(0,"vector3",0),new IH(12,"vector3",3),new IH(24,"vector2",2),new IH(32,"vector2",15)])}])}(),function(){function H(H,n){this._position=null,this._textureCoordinate0=null,this._position=H,this._textureCoordinate0=n}g(H,"laya.d3.graphics.VertexPositionTexture0");var n=H.prototype;return z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"position",function(){return this._position}),M(0,n,"textureCoordinate0",function(){return this._textureCoordinate0}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(20,[new IH(0,"vector3",0),new IH(12,"vector2",2)])}]),H}()),TH=(function(){function H(H,n,C,r,N,Q,I,A,P,t,R,y,o,g){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=H,this._positionStartLifeTime=n,this._velocity=C,this._startColor=r,this._startSize=N,this._startRotation0=Q,this._startRotation1=I,this._startRotation2=A,this._startLifeTime=P,this._time=t,this._startSpeed=R,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=g}g(H,"laya.d3.graphics.VertexShurikenParticleBillboard");var n=H.prototype;z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),M(0,n,"random1",function(){return this._randoms1}),M(0,n,"startRotation2",function(){return this._startRotation2}),M(0,n,"positionStartLifeTime",function(){return this._positionStartLifeTime}),M(0,n,"velocity",function(){return this._velocity}),M(0,n,"random0",function(){return this._randoms0}),M(0,n,"startSize",function(){return this._startSize}),M(0,n,"startColor",function(){return this._startColor}),M(0,n,"startRotation0",function(){return this._startRotation0}),M(0,n,"startRotation1",function(){return this._startRotation1}),M(0,n,"startLifeTime",function(){return this._startLifeTime}),M(0,n,"time",function(){return this._time}),M(0,n,"startSpeed",function(){return this._startSpeed}),M(0,n,"simulationWorldPostion",function(){return this._simulationWorldPostion}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(152,[new IH(0,"vector4",17),new IH(16,"vector4",30),new IH(32,"vector4",32),new IH(48,"vector4",19),new IH(64,"vector3",20),new IH(76,"vector3",22),new IH(88,"single",31),new IH(92,"vector4",34),new IH(108,"vector4",35),new IH(124,"vector3",36),new IH(136,"vector4",37)])}])}(),function(){function H(H,n,C,r,N,Q,I,A,P,t,R,y,o,g){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=H,this._positionStartLifeTime=n,this._velocity=C,this._startColor=r,this._startSize=N,this._startRotation0=Q,this._startRotation1=I,this._startRotation2=A,this._startLifeTime=P,this._time=t,this._startSpeed=R,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=g}g(H,"laya.d3.graphics.VertexShurikenParticleMesh");var n=H.prototype;z.imps(n,{"laya.d3.graphics.IVertex":!0}),M(0,n,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),M(0,n,"velocity",function(){return this._velocity}),M(0,n,"position",function(){return this._positionStartLifeTime}),M(0,n,"random0",function(){return this._randoms0}),M(0,n,"startSize",function(){return this._startSize}),M(0,n,"startColor",function(){return this._startColor}),M(0,n,"startRotation0",function(){return this._startRotation0}),M(0,n,"startRotation1",function(){return this._startRotation1}),M(0,n,"random1",function(){return this._randoms1}),M(0,n,"startRotation2",function(){return this._startRotation2}),M(0,n,"startLifeTime",function(){return this._startLifeTime}),M(0,n,"time",function(){return this._time}),M(0,n,"startSpeed",function(){return this._startSpeed}),M(0,n,"simulationWorldPostion",function(){return this._simulationWorldPostion}),M(0,n,"vertexDeclaration",function(){return H._vertexDeclaration}),M(1,H,"vertexDeclaration",function(){return H._vertexDeclaration}),y(H,["_vertexDeclaration",function(){return this._vertexDeclaration=new QH(172,[new IH(0,"vector3",0),new IH(12,"vector4",1),new IH(28,"vector2",2),new IH(36,"vector4",30),new IH(52,"vector4",32),new IH(68,"vector4",19),new IH(84,"vector3",20),new IH(96,"vector3",22),new IH(108,"single",31),new IH(112,"vector4",34),new IH(128,"vector4",35),new IH(144,"vector3",36),new IH(156,"vector4",37)])}])}(),function(){function K(H,n,C,r,N,Q){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=C,this._materials=r,this._subMeshes=N,this._materialMap=Q,this._version=n,this._onLoaded(H)}g(K,"laya.d3.loaders.LoadModelV01");var H=K.prototype;return H._onLoaded=function(H){this._readData=H,this.READ_BLOCK();for(var n=0;n<this._BLOCK.count;n++){var C=this._readData.getUint16(),r=this._strings[C],N=this["READ_"+r];if(null==N)throw new Error("model file err,no this function:"+C+" "+r);if(!N.call(this))break}return this._mesh},H.onError=function(){},H._readString=function(){return this._strings[this._readData.getUint16()]},H.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},H.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},H.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var H=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var n=0;n<this._STRINGS.size;n++)this._strings[n]=this._readData.readUTFString();return this._readData.pos=H,!0},H.READ_MATERIAL=function(){var H=this._readData.getUint16(),n=(this._readString(),this._readString());return this._materials[H]="null"!==n?f.getRes(this._materialMap[n]):new en,!0},H.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var H,n=this._readData.__getBuffer(),C=0,r=this._readData.getUint32(),N=this._readData.getUint32(),Q=(new Float32Array(n.slice(r+this._DATA.offset,r+this._DATA.offset+N)),this._readData.getUint32()),I=this._readData.getUint32(),A=new Float32Array(n.slice(Q+this._DATA.offset,Q+this._DATA.offset+I));for(this.mesh._inverseBindPoses=[],C=0,H=A.length;C<H;C+=16){var P=new nn(A[C+0],A[C+1],A[C+2],A[C+3],A[C+4],A[C+5],A[C+6],A[C+7],A[C+8],A[C+9],A[C+10],A[C+11],A[C+12],A[C+13],A[C+14],A[C+15]);this.mesh._inverseBindPoses.push(P)}break;default:throw new Error("LoadModel:unknown version.")}return!0},H.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var H=this._readString();this._shaderAttributes=H.match(K._attrReg);var n=this._readData.getUint32(),C=this._readData.getUint32(),r=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),N=this._readData.getUint32(),Q=this._readData.getUint32(),I=this._readData.getUint32(),A=this._readData.__getBuffer(),P=new yn(this._mesh),t=this._getVertexDeclaration(),R=Sn.create(t,N/t.vertexStride,35044,!0),y=r+this._DATA.offset,o=A.slice(y,y+N);R.setData(new Float32Array(o));for(var g=(P._vertexBuffer=R).vertexDeclaration.getVertexElements(),M=0;M<g.length;M++)P._bufferUsage[g[M].elementUsage]=R;var j=On.create("ushort",C/2,35044,!0),l=n+this._DATA.offset,f=A.slice(l,l+C);j.setData(new Uint16Array(f)),P._indexBuffer=j;var c=A.slice(Q+this._DATA.offset,Q+this._DATA.offset+I);return P._boneIndicesList[0]=new Uint8Array(c),this._subMeshes.push(P),!0},H.READ_DATAAREA=function(){return!1},H._getVertexDeclaration=function(){for(var H,n=!1,C=!1,r=!1,N=!1,Q=!1,I=!1,A=!1,P=!1,t=!1,R=0;R<this._shaderAttributes.length;R+=8)switch(this._shaderAttributes[R]){case"POSITION":n=!0;break;case"NORMAL":C=!0;break;case"COLOR":r=!0;break;case"UV":N=!0;break;case"UV1":Q=!0;break;case"BLENDWEIGHT":A=!0;break;case"BLENDINDICES":P=!0;break;case"TANGENT":I=!0;break;case"BINORMAL":t=!0}return n&&C&&r&&N&&Q&&A&&P&&I?H=KH.vertexDeclaration:n&&C&&r&&N&&Q&&A&&P?H=fH.vertexDeclaration:n&&C&&N&&Q&&A&&P&&I?H=ZH.vertexDeclaration:n&&C&&N&&Q&&A&&P?H=vH.vertexDeclaration:n&&C&&r&&N&&A&&P&&I?H=kH.vertexDeclaration:n&&C&&r&&N&&A&&P?H=wH.vertexDeclaration:n&&C&&I&&t&&N&&A&&P?H=OH.vertexDeclaration:n&&C&&N&&A&&P&&I?H=_H.vertexDeclaration:n&&C&&N&&A&&P?H=mH.vertexDeclaration:n&&C&&r&&A&&P&&I?H=oH.vertexDeclaration:n&&C&&r&&A&&P?H=RH.vertexDeclaration:n&&C&&r&&N&&Q&&I?H=zH.vertexDeclaration:n&&C&&r&&N&&Q?H=lH.vertexDeclaration:n&&C&&N&&Q&&I?H=pH.vertexDeclaration:n&&C&&N&&Q?H=hH.vertexDeclaration:n&&C&&r&&N&&I?H=aH.vertexDeclaration:n&&C&&N&&I&&t?H=$H.vertexDeclaration:n&&C&&r&&N?H=jH.vertexDeclaration:n&&C&&N&&I?H=sH.vertexDeclaration:n&&C&&N?H=bH.vertexDeclaration:n&&C&&r&&I?H=MH.vertexDeclaration:n&&C&&r&&(H=tH.vertexDeclaration),H},M(0,H,"mesh",function(){return this._mesh}),K._attrReg=new RegExp("(\\w+)|([:,;])","g"),K}()),EH=function(){function F(){}return g(F,"laya.d3.loaders.LoadModelV02"),F.parse=function(H,n,C,r,N,Q){F._mesh=C,F._materials=r,F._subMeshes=N,F._materialMap=Q,F._version=n,F._readData=H,F.READ_DATA(),F.READ_BLOCK(),F.READ_STRINGS();for(var I=0,A=F._BLOCK.count;I<A;I++){F._readData.pos=F._BLOCK.blockStarts[I];var P=F._readData.getUint16(),t=F._strings[P],R=F["READ_"+t];if(null==R)throw new Error("model file err,no this function:"+P+" "+t);R.call()}F._strings.length=0,F._readData=null,F._version=null,F._mesh=null,F._materials=null,F._subMeshes=null,F._materialMap=null},F._readString=function(){return F._strings[F._readData.getUint16()]},F.READ_DATA=function(){F._DATA.offset=F._readData.getUint32(),F._DATA.size=F._readData.getUint32()},F.READ_BLOCK=function(){for(var H=F._BLOCK.count=F._readData.getUint16(),n=F._BLOCK.blockStarts=[],C=F._BLOCK.blockLengths=[],r=0;r<H;r++)n.push(F._readData.getUint32()),C.push(F._readData.getUint32())},F.READ_STRINGS=function(){var H=F._readData.getUint32(),n=F._readData.getUint16(),C=F._readData.pos;F._readData.pos=H+F._DATA.offset;for(var r=0;r<n;r++)F._strings[r]=F._readData.readUTFString();F._readData.pos=C},F.READ_MATERIAL=function(){F._readString(),F._readString();var H=F._readString();return""!==H&&F._materials.push(f.getRes(F._materialMap[H])),!0},F.READ_MESH=function(){F._readString();var H,n=F._readData.__getBuffer(),C=0,r=F._readData.getInt16(),N=F._DATA.offset;for(C=0;C<r;C++){var Q=N+F._readData.getUint32(),I=F._readData.getUint32(),A=new Float32Array(n.slice(Q,Q+I)),P=F._readString().match(F._attrReg),t=F._getVertexDeclaration(P),R=Sn.create(t,4*A.length/t.vertexStride,35044,!0);R.setData(A),F._mesh._vertexBuffers.push(R)}var y=N+F._readData.getUint32(),o=F._readData.getUint32(),g=new Uint16Array(n.slice(y,y+o)),M=On.create("ushort",o/2,35044,!0);M.setData(g),F._mesh._indexBuffer=M;var j=F._mesh._boneNames=[],l=F._readData.getUint16();for(j.length=l,C=0;C<l;C++)j[C]=F._strings[F._readData.getUint16()];var f=F._readData.getUint32(),c=F._readData.getUint32(),K=(new Float32Array(n.slice(N+f,N+f+c)),F._readData.getUint32()),W=F._readData.getUint32(),z=new Float32Array(n.slice(N+K,N+K+W));for(F._mesh._inverseBindPoses=[],C=0,H=z.length;C<H;C+=16){var w=new nn(z[C+0],z[C+1],z[C+2],z[C+3],z[C+4],z[C+5],z[C+6],z[C+7],z[C+8],z[C+9],z[C+10],z[C+11],z[C+12],z[C+13],z[C+14],z[C+15]);F._mesh._inverseBindPoses.push(w)}return F._mesh._skinnedDatas=new Float32Array(16*z.length),!0},F.READ_SUBMESH=function(){var H=F._readData.__getBuffer(),n=new yn(F._mesh),C=F._readData.getInt16(),r=F._readData.getUint32(),N=F._readData.getUint32();n._vertexBuffer=F._mesh._vertexBuffers[C],n._vertexStart=r,n._vertexCount=N;var Q=F._readData.getUint32(),I=F._readData.getUint32(),A=F._mesh._indexBuffer;n._indexBuffer=A,n._indexStart=Q,n._indexCount=I,n._indices=new Uint16Array(A.getData().buffer,2*Q,I);var P=F._DATA.offset,t=n._subIndexBufferStart,R=n._subIndexBufferCount,y=n._boneIndicesList,o=F._readData.getUint16();t.length=o,R.length=o,y.length=o;for(var g=0;g<o;g++){t[g]=F._readData.getUint32(),R[g]=F._readData.getUint32();var M=F._readData.getUint32(),j=F._readData.getUint32();n._boneIndicesList[g]=new Uint8Array(H.slice(P+M,P+M+j))}return F._subMeshes.push(n),!0},F._getVertexDeclaration=function(H){for(var n,C=!1,r=!1,N=!1,Q=!1,I=!1,A=!1,P=!1,t=!1,R=!1,y=0;y<H.length;y++)switch(H[y]){case"POSITION":C=!0;break;case"NORMAL":r=!0;break;case"COLOR":N=!0;break;case"UV":Q=!0;break;case"UV1":I=!0;break;case"BLENDWEIGHT":P=!0;break;case"BLENDINDICES":t=!0;break;case"TANGENT":A=!0;break;case"BINORMAL":R=!0}return C&&r&&N&&Q&&I&&P&&t&&A?n=KH.vertexDeclaration:C&&r&&N&&Q&&I&&P&&t?n=fH.vertexDeclaration:C&&r&&Q&&I&&P&&t&&A?n=ZH.vertexDeclaration:C&&r&&Q&&I&&P&&t?n=vH.vertexDeclaration:C&&r&&N&&Q&&P&&t&&A?n=kH.vertexDeclaration:C&&r&&N&&Q&&P&&t?n=wH.vertexDeclaration:C&&r&&Q&&P&&t&&A?n=_H.vertexDeclaration:C&&r&&Q&&P&&t?n=mH.vertexDeclaration:C&&r&&N&&P&&t&&A?n=oH.vertexDeclaration:C&&r&&N&&P&&t?n=RH.vertexDeclaration:C&&r&&N&&Q&&I&&A?n=zH.vertexDeclaration:C&&r&&N&&Q&&I?n=lH.vertexDeclaration:C&&r&&Q&&I&&A?n=pH.vertexDeclaration:C&&r&&Q&&I?n=hH.vertexDeclaration:C&&r&&N&&Q&&A?n=aH.vertexDeclaration:C&&r&&Q&&A&&R?n=$H.vertexDeclaration:C&&r&&N&&Q?n=jH.vertexDeclaration:C&&r&&Q&&A?n=sH.vertexDeclaration:C&&r&&Q?n=bH.vertexDeclaration:C&&r&&N&&A?n=MH.vertexDeclaration:C&&r&&N&&(n=tH.vertexDeclaration),n},F._attrReg=new RegExp("(\\w+)|([:,;])","g"),F._strings=[],F._readData=null,F._version=null,F._mesh=null,F._materials=null,F._subMeshes=null,F._materialMap=null,y(F,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),F}(),GH=function(){function w(){}return g(w,"laya.d3.loaders.LoadModelV03"),w.parse=function(H,n,C,r,N){w._mesh=C,w._subMeshes=r,w._materialMap=N,w._version=n,w._readData=H,w.READ_DATA(),w.READ_BLOCK(),w.READ_STRINGS();for(var Q=0,I=w._BLOCK.count;Q<I;Q++){w._readData.pos=w._BLOCK.blockStarts[Q];var A=w._readData.getUint16(),P=w._strings[A],t=w["READ_"+P];if(null==t)throw new Error("model file err,no this function:"+A+" "+P);t.call()}w._strings.length=0,w._readData=null,w._version=null,w._mesh=null,w._subMeshes=null,w._materialMap=null},w._readString=function(){return w._strings[w._readData.getUint16()]},w.READ_DATA=function(){w._DATA.offset=w._readData.getUint32(),w._DATA.size=w._readData.getUint32()},w.READ_BLOCK=function(){for(var H=w._BLOCK.count=w._readData.getUint16(),n=w._BLOCK.blockStarts=[],C=w._BLOCK.blockLengths=[],r=0;r<H;r++)n.push(w._readData.getUint32()),C.push(w._readData.getUint32())},w.READ_STRINGS=function(){var H=w._readData.getUint32(),n=w._readData.getUint16(),C=w._readData.pos;w._readData.pos=H+w._DATA.offset;for(var r=0;r<n;r++)w._strings[r]=w._readData.readUTFString();w._readData.pos=C},w.READ_MESH=function(){var H,n=w._readString(),C=w._readData.__getBuffer(),r=0,N=w._readData.getInt16(),Q=w._DATA.offset;for(r=0;r<N;r++){var I,A=Q+w._readData.getUint32(),P=w._readData.getUint32(),t=new Float32Array(C.slice(A,A+P)),R=w._readString();switch(w._version){case"LAYAMODEL:03":I=w._vertexDeclarationMap_Discard[R];break;case"LAYAMODEL:0301":I=w._vertexDeclarationMap[R];break;default:throw new Error("LoadModelV03: unknown version.")}if(!I)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+w._version+"  bufferAttribute="+R+"  name="+n+"  url="+(w._mesh?w._mesh.url:"null"));var y=Sn.create(I,4*t.length/I.vertexStride,35044,!0,w._mesh._url+"_"+r);y.setData(t),w._mesh._vertexBuffers.push(y)}var o=Q+w._readData.getUint32(),g=w._readData.getUint32(),M=new Uint16Array(C.slice(o,o+g)),j=On.create("ushort",g/2,35044,!0,w._mesh._url);j.setData(M),w._mesh._indexBuffer=j;var l=w._mesh._boneNames=[],f=w._readData.getUint16();for(l.length=f,r=0;r<f;r++)l[r]=w._strings[w._readData.getUint16()];w._readData.pos+=8;var c=w._readData.getUint32(),K=w._readData.getUint32(),W=new Float32Array(C.slice(Q+c,Q+c+K));for(w._mesh._inverseBindPoses=[],r=0,H=W.length;r<H;r+=16){var z=new nn(W[r+0],W[r+1],W[r+2],W[r+3],W[r+4],W[r+5],W[r+6],W[r+7],W[r+8],W[r+9],W[r+10],W[r+11],W[r+12],W[r+13],W[r+14],W[r+15]);w._mesh._inverseBindPoses.push(z)}return w._mesh._skinnedDatas=new Float32Array(16*W.length),!0},w.READ_SUBMESH=function(){var H=w._readData.__getBuffer(),n=new yn(w._mesh),C=w._readData.getInt16(),r=w._readData.getUint32(),N=w._readData.getUint32();n._vertexBuffer=w._mesh._vertexBuffers[C],n._vertexStart=r,n._vertexCount=N;var Q=w._readData.getUint32(),I=w._readData.getUint32(),A=w._mesh._indexBuffer;n._indexBuffer=A,n._indexStart=Q,n._indexCount=I,n._indices=new Uint16Array(A.getData().buffer,2*Q,I);var P=w._DATA.offset,t=n._subIndexBufferStart,R=n._subIndexBufferCount,y=n._boneIndicesList,o=w._readData.getUint16();t.length=o,R.length=o,y.length=o;for(var g=0;g<o;g++){t[g]=w._readData.getUint32(),R[g]=w._readData.getUint32();var M=w._readData.getUint32(),j=w._readData.getUint32();y[g]=new Uint8Array(H.slice(P+M,P+M+j))}return w._subMeshes.push(n),!0},w._strings=[],w._readData=null,w._version=null,w._mesh=null,w._subMeshes=null,w._materialMap=null,y(w,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":KH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":fH.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":xH.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":ZH.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":vH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":kH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":wH.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":_H.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":mH.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":oH.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":RH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":zH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":lH.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":pH.vertexDeclaration,"POSITION,NORMAL,UV,UV1":hH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":aH.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$H.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":jH.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":sH.vertexDeclaration,"POSITION,NORMAL,UV":bH.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":MH.vertexDeclaration,"POSITION,NORMAL,COLOR":tH.vertexDeclaration,"POSITION,NORMAL,TANGENT":LH.vertexDeclaration,"POSITION,NORMAL":PH.vertexDeclaration,"POSITION,UV":SH.vertexDeclaration,POSITION:AH.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":cH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":fH.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":xH.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":eH.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":vH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":FH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":wH.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":dH.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":mH.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":yH.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":RH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":WH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":lH.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":qH.vertexDeclaration,"POSITION,NORMAL,UV,UV1":hH.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":iH.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$H.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":jH.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":UH.vertexDeclaration,"POSITION,NORMAL,UV":bH.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":gH.vertexDeclaration,"POSITION,NORMAL,COLOR":tH.vertexDeclaration,"POSITION,NORMAL,TANGENT":DH.vertexDeclaration,"POSITION,NORMAL":PH.vertexDeclaration,"POSITION,UV":SH.vertexDeclaration,POSITION:AH.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),w}(),JH=function(){function A(){}return g(A,"laya.d3.loaders.MeshReader"),A.read=function(H,n,C,r,N){var Q=new w(H);Q.pos=0;var I=Q.readUTFString();switch(I){case"LAYAMODEL:01":case"LAYASKINANI:01":A._readVersion01(Q,I,n,C,r,N);break;case"LAYAMODEL:02":EH.parse(Q,I,n,C,r,N);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":GH.parse(Q,I,n,r,N);break;default:throw new Error("MeshReader: unknown mesh version. version:"+I+", mesh:"+(n?n.url:""))}n._setSubMeshes(r)},A._readVersion01=function(H,n,C,r,N,Q){new TH(H,n,C,r,N,Q)},A}(),YH=function(){function H(H,n){this.min=null,this.max=null,this.min=H,this.max=n}g(H,"laya.d3.math.BoundBox");var n=H.prototype;return z.imps(n,{"laya.d3.core.IClone":!0}),n.getCorners=function(H){H.length=8;var n=this.min.elements,C=this.max.elements,r=n[0],N=n[1],Q=n[2],I=C[0],A=C[1],P=C[2];H[0]=new Pn(r,A,P),H[1]=new Pn(I,A,P),H[2]=new Pn(I,N,P),H[3]=new Pn(r,N,P),H[4]=new Pn(r,A,Q),H[5]=new Pn(I,A,Q),H[6]=new Pn(I,N,Q),H[7]=new Pn(r,N,Q)},n.toDefault=function(){this.min.toDefault(),this.max.toDefault()},n.cloneTo=function(H){var n=H;this.min.cloneTo(n.min),this.max.cloneTo(n.max)},n.clone=function(){var H=new this.constructor(new Pn,new Pn);return this.cloneTo(H),H},H.createfromPoints=function(H,n){if(null==H)throw new Error("points");var C=n.min,r=n.max,N=C.elements;N[0]=Number.MAX_VALUE,N[1]=Number.MAX_VALUE,N[2]=Number.MAX_VALUE;var Q=r.elements;Q[0]=-Number.MAX_VALUE,Q[1]=-Number.MAX_VALUE,Q[2]=-Number.MAX_VALUE;for(var I=0,A=H.length;I<A;++I)Pn.min(C,H[I],C),Pn.max(r,H[I],r)},H.merge=function(H,n,C){Pn.min(H.min,n.min,C.min),Pn.max(H.max,n.max,C.max)},H}(),uH=function(){function t(H){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=H,this._near=new rn(new Pn),this._far=new rn(new Pn),this._left=new rn(new Pn),this._right=new rn(new Pn),this._top=new rn(new Pn),this._bottom=new rn(new Pn),t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}g(t,"laya.d3.math.BoundFrustum");var H=t.prototype;return H.equalsBoundFrustum=function(H){return this._matrix.equalsOtherMatrix(H.matrix)},H.equalsObj=function(H){if(H instanceof laya.d3.math.BoundFrustum){var n=H;return this.equalsBoundFrustum(n)}return!1},H.getPlane=function(H){switch(H){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},H.getCorners=function(H){t._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(H[0]),t._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(H[1]),t._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(H[2]),t._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(H[3]),t._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(H[4]),t._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(H[5]),t._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(H[6]),t._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(H[7])},H.containsPoint=function(H){for(var n=rn.PlaneIntersectionType_Front,C=rn.PlaneIntersectionType_Front,r=0;r<6;r++){switch(r){case 0:C=VH.intersectsPlaneAndPoint(this._near,H);break;case 1:C=VH.intersectsPlaneAndPoint(this._far,H);break;case 2:C=VH.intersectsPlaneAndPoint(this._left,H);break;case 3:C=VH.intersectsPlaneAndPoint(this._right,H);break;case 4:C=VH.intersectsPlaneAndPoint(this._top,H);break;case 5:C=VH.intersectsPlaneAndPoint(this._bottom,H)}switch(C){case rn.PlaneIntersectionType_Back:return 0;case rn.PlaneIntersectionType_Intersecting:n=rn.PlaneIntersectionType_Intersecting}}switch(n){case rn.PlaneIntersectionType_Intersecting:return 2;default:return 1}},H.containsBoundBox=function(H){for(var n,C=t._tempV30,r=t._tempV31,N=1,Q=0;Q<6;Q++){if(n=this.getPlane(Q),this._getBoxToPlanePVertexNVertex(H,n.normal,C,r),VH.intersectsPlaneAndPoint(n,C)===rn.PlaneIntersectionType_Back)return 0;VH.intersectsPlaneAndPoint(n,r)===rn.PlaneIntersectionType_Back&&(N=2)}return N},H.containsBoundSphere=function(H){for(var n=rn.PlaneIntersectionType_Front,C=rn.PlaneIntersectionType_Front,r=0;r<6;r++){switch(r){case 0:C=VH.intersectsPlaneAndSphere(this._near,H);break;case 1:C=VH.intersectsPlaneAndSphere(this._far,H);break;case 2:C=VH.intersectsPlaneAndSphere(this._left,H);break;case 3:C=VH.intersectsPlaneAndSphere(this._right,H);break;case 4:C=VH.intersectsPlaneAndSphere(this._top,H);break;case 5:C=VH.intersectsPlaneAndSphere(this._bottom,H)}switch(C){case rn.PlaneIntersectionType_Back:return 0;case rn.PlaneIntersectionType_Intersecting:n=rn.PlaneIntersectionType_Intersecting}}switch(n){case rn.PlaneIntersectionType_Intersecting:return 2;default:return 1}},H._getBoxToPlanePVertexNVertex=function(H,n,C,r){var N=H.min,Q=N.elements,I=H.max,A=I.elements,P=n.elements,t=P[0],R=P[1],y=P[2];N.cloneTo(C);var o=C.elements;0<=t&&(o[0]=A[0]),0<=R&&(o[1]=A[1]),0<=y&&(o[2]=A[2]),I.cloneTo(r);var g=r.elements;0<=t&&(g[0]=Q[0]),0<=R&&(g[1]=Q[1]),0<=y&&(g[2]=Q[2])},M(0,H,"top",function(){return this._top}),M(0,H,"matrix",function(){return this._matrix},function(H){this._matrix=H,t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),M(0,H,"near",function(){return this._near}),M(0,H,"far",function(){return this._far}),M(0,H,"left",function(){return this._left}),M(0,H,"right",function(){return this._right}),M(0,H,"bottom",function(){return this._bottom}),t._getPlanesFromMatrix=function(H,n,C,r,N,Q,I){var A=H.elements,P=A[0],t=A[1],R=A[2],y=A[3],o=A[4],g=A[5],M=A[6],j=A[7],l=A[8],f=A[9],c=A[10],K=A[11],W=A[12],z=A[13],w=A[14],F=A[15],k=n.normal.elements;k[0]=y+R,k[1]=j+M,k[2]=K+c,n.distance=F+w,n.normalize();var i=C.normal.elements;i[0]=y-R,i[1]=j-M,i[2]=K-c,C.distance=F-w,C.normalize();var a=r.normal.elements;a[0]=y+P,a[1]=j+o,a[2]=K+l,r.distance=F+W,r.normalize();var D=N.normal.elements;D[0]=y-P,D[1]=j-o,D[2]=K-l,N.distance=F-W,N.normalize();var L=Q.normal.elements;L[0]=y-t,L[1]=j-g,L[2]=K-f,Q.distance=F-z,Q.normalize();var b=I.normal.elements;b[0]=y+t,b[1]=j+g,b[2]=K+f,I.distance=F+z,I.normalize()},t._get3PlaneInterPoint=function(H,n,C){var r=H.normal,N=n.normal,Q=C.normal;Pn.cross(N,Q,t._tempV30),Pn.cross(Q,r,t._tempV31),Pn.cross(r,N,t._tempV32);var I=Pn.dot(r,t._tempV30),A=Pn.dot(N,t._tempV31),P=Pn.dot(Q,t._tempV32);return Pn.scale(t._tempV30,-H.distance/I,t._tempV33),Pn.scale(t._tempV31,-n.distance/A,t._tempV34),Pn.scale(t._tempV32,-C.distance/P,t._tempV35),Pn.add(t._tempV33,t._tempV34,t._tempV36),Pn.add(t._tempV35,t._tempV36,t._tempV37),t._tempV37},y(t,["_tempV30",function(){return this._tempV30=new Pn},"_tempV31",function(){return this._tempV31=new Pn},"_tempV32",function(){return this._tempV32=new Pn},"_tempV33",function(){return this._tempV33=new Pn},"_tempV34",function(){return this._tempV34=new Pn},"_tempV35",function(){return this._tempV35=new Pn},"_tempV36",function(){return this._tempV36=new Pn},"_tempV37",function(){return this._tempV37=new Pn}]),t}(),XH=function(){function R(H,n){this.center=null,this.radius=NaN,this.center=H,this.radius=n}g(R,"laya.d3.math.BoundSphere");var H=R.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.toDefault=function(){this.center.toDefault(),this.radius=0},H.intersectsRayDistance=function(H){return VH.intersectsRayAndSphereRD(H,this)},H.intersectsRayPoint=function(H,n){return VH.intersectsRayAndSphereRP(H,this,n)},H.cloneTo=function(H){var n=H;this.center.cloneTo(n.center),n.radius=this.radius},H.clone=function(){var H=new this.constructor(new Pn,new Pn);return this.cloneTo(H),H},R.createFromSubPoints=function(H,n,C,r){if(null==H)throw new Error("points");if(n<0||n>=H.length)throw new Error("start"+n+"Must be in the range [0, "+(H.length-1)+"]");if(C<0||n+C>H.length)throw new Error("count"+C+"Must be in the range <= "+H.length+"}");var N=n+C,Q=R._tempVector3;Q.elements[0]=0,Q.elements[1]=0,Q.elements[2]=0;for(var I=n;I<N;++I)Pn.add(H[I],Q,Q);var A=r.center;Pn.scale(Q,1/C,A);var P=0;for(I=n;I<N;++I){var t=Pn.distanceSquared(A,H[I]);P<t&&(P=t)}r.radius=Math.sqrt(P)},R.createfromPoints=function(H,n){if(null==H)throw new Error("points");R.createFromSubPoints(H,0,H.length,n)},y(R,["_tempVector3",function(){return this._tempVector3=new Pn}]),R}(),VH=function(){function u(){}return g(u,"laya.d3.math.Collision"),u.distancePlaneToPoint=function(H,n){return Pn.dot(H.normal,n)-H.distance},u.distanceBoxToPoint=function(H,n){var C=H.min.elements,r=C[0],N=C[1],Q=C[2],I=H.max.elements,A=I[0],P=I[1],t=I[2],R=n.elements,y=R[0],o=R[1],g=R[2],M=0;return y<r&&(M+=(r-y)*(r-y)),A<y&&(M+=(A-y)*(A-y)),o<N&&(M+=(N-o)*(N-o)),P<o&&(M+=(P-o)*(P-o)),g<Q&&(M+=(Q-g)*(Q-g)),t<g&&(M+=(t-g)*(t-g)),Math.sqrt(M)},u.distanceBoxToBox=function(H,n){var C=H.min.elements,r=C[0],N=C[1],Q=C[2],I=H.max.elements,A=I[0],P=I[1],t=I[2],R=n.min.elements,y=R[0],o=R[1],g=R[2],M=n.max.elements,j=M[0],l=M[1],f=M[2],c=0,K=NaN;return j<r?c+=(K=r-j)*K:A<y&&(c+=(K=y-A)*K),l<N?c+=(K=N-l)*K:P<o&&(c+=(K=o-P)*K),f<Q?c+=(K=Q-f)*K:t<g&&(c+=(K=g-t)*K),Math.sqrt(c)},u.distanceSphereToPoint=function(H,n){var C=Math.sqrt(Pn.distanceSquared(H.center,n));return C-=H.radius,Math.max(C,0)},u.distanceSphereToSphere=function(H,n){var C=Math.sqrt(Pn.distanceSquared(H.center,n.center));return C-=H.radius+n.radius,Math.max(C,0)},u.intersectsRayAndTriangleRD=function(H,n,C,r,N){var Q=H.origin.elements,I=Q[0],A=Q[1],P=Q[2],t=H.direction.elements,R=t[0],y=t[1],o=t[2],g=n.elements,M=g[0],j=g[1],l=g[2],f=C.elements,c=f[0],K=f[1],W=f[2],z=r.elements,w=z[0],F=z[1],k=z[2],i=u._tempV30.elements,a=i[0],D=i[1],L=i[2];a=c-M,D=K-j,L=W-l;var b=u._tempV31.elements,h=b[0],v=b[1],e=b[2];h=w-M,v=F-j,e=k-l;var Z=u._tempV32.elements,q=Z[0],p=Z[1],m=Z[2],d=a*(q=y*e-o*v)+D*(p=o*h-R*e)+L*(m=R*v-y*h);if(BH.isZero(d))return 0,!1;var _=1/d,U=u._tempV33.elements,s=U[0],$=U[1],x=U[2],O=(s=I-M)*q+($=A-j)*p+(x=P-l)*m;if((O*=_)<0||1<O)return 0,!1;var S=u._tempV34.elements,T=S[0],E=S[1],G=S[2],J=R*(T=$*L-x*D)+y*(E=x*a-s*L)+o*(G=s*D-$*a);if((J*=_)<0||1<O+J)return 0,!1;var Y=h*T+v*E+e*G;return(Y*=_)<0?(0,!1):(Y,!0)},u.intersectsRayAndTriangleRP=function(H,n,C,r,N){return u.intersectsRayAndTriangleRD(H,n,C,r,NaN)?(Pn.scale(H.direction,NaN,u._tempV30),Pn.add(H.origin,u._tempV30,N),!0):(N=Pn.ZERO,!1)},u.intersectsRayAndPoint=function(H,n){Pn.subtract(H.origin,n,u._tempV30);var C=Pn.dot(u._tempV30,H.direction),r=Pn.dot(u._tempV30,u._tempV30)-BH.zeroTolerance;return!(0<r&&0<C)&&!(C*C-r<0)},u.intersectsRayAndRay=function(H,n,C){var r=H.origin,N=r.elements,Q=N[0],I=N[1],A=N[2],P=H.direction,t=P.elements,R=t[0],y=t[1],o=t[2],g=n.origin,M=g.elements,j=M[0],l=M[1],f=M[2],c=n.direction,K=c.elements,W=K[0],z=K[1],w=K[2];Pn.cross(P,c,u._tempV30);var F=u._tempV30.elements,k=Pn.scalarLengthSquared(u._tempV30);if(BH.isZero(k)&&BH.nearEqual(j,Q)&&BH.nearEqual(l,I)&&BH.nearEqual(f,A))return Pn.ZERO.cloneTo(C),!0;var i=j-Q,a=l-I,D=f-A,L=W,b=z,h=w,v=F[0],e=F[1],Z=F[2],q=(i*b*Z+a*h*v+D*L*e-i*h*e-a*L*Z-D*b*v)/k,p=(i*(b=y)*Z+a*(h=o)*v+D*(L=R)*e-i*h*e-a*L*Z-D*b*v)/k;Pn.scale(P,q,u._tempV30),Pn.scale(c,p,u._tempV31),Pn.add(r,u._tempV30,u._tempV32),Pn.add(g,u._tempV31,u._tempV33);var m=u._tempV32.elements,d=u._tempV33.elements;return BH.nearEqual(d[0],m[0])&&BH.nearEqual(d[1],m[1])&&BH.nearEqual(d[2],m[2])?(u._tempV32.cloneTo(C),!0):(Pn.ZERO.cloneTo(C),!1)},u.intersectsPlaneAndTriangle=function(H,n,C,r){var N=u.intersectsPlaneAndPoint(H,n),Q=u.intersectsPlaneAndPoint(H,C),I=u.intersectsPlaneAndPoint(H,r);return N==rn.PlaneIntersectionType_Front&&Q==rn.PlaneIntersectionType_Front&&I==rn.PlaneIntersectionType_Front?rn.PlaneIntersectionType_Front:N==rn.PlaneIntersectionType_Back&&Q==rn.PlaneIntersectionType_Back&&I==rn.PlaneIntersectionType_Back?rn.PlaneIntersectionType_Back:rn.PlaneIntersectionType_Intersecting},u.intersectsRayAndPlaneRD=function(H,n,C){var r=n.normal,N=Pn.dot(r,H.direction);if(BH.isZero(N))return 0,!1;var Q=Pn.dot(r,H.origin);return!((-n.distance-Q)/N<0)||(0,!1)},u.intersectsRayAndPlaneRP=function(H,n,C){return u.intersectsRayAndPlaneRD(H,n,NaN)?(Pn.scale(H.direction,NaN,u._tempV30),Pn.add(H.origin,u._tempV30,u._tempV31),u._tempV31,!0):(Pn.ZERO,!1)},u.intersectsRayAndBoxRD=function(H,n){var C=H.origin.elements,r=C[0],N=C[1],Q=C[2],I=H.direction.elements,A=I[0],P=I[1],t=I[2],R=n.min.elements,y=R[0],o=R[1],g=R[2],M=n.max.elements,j=M[0],l=M[1],f=M[2],c=0,K=BH.MaxValue;if(BH.isZero(A)){if(r<y||j<r)return-1}else{var W=1/A,z=(y-r)*W,w=(j-r)*W;if(w<z){var F=z;z=w,w=F}if(c=Math.max(z,c),(K=Math.min(w,K))<c)return-1}if(BH.isZero(P)){if(N<o||l<N)return-1}else{var k=1/P,i=(o-N)*k,a=(l-N)*k;if(a<i){var D=i;i=a,a=D}if(c=Math.max(i,c),(K=Math.min(a,K))<c)return-1}if(BH.isZero(t)){if(Q<g||f<Q)return-1}else{var L=1/t,b=(g-Q)*L,h=(f-Q)*L;if(h<b){var v=b;b=h,h=v}if(c=Math.max(b,c),(K=Math.min(h,K))<c)return-1}return c},u.intersectsRayAndBoxRP=function(H,n,C){var r=u.intersectsRayAndBoxRD(H,n);return-1===r?Pn.ZERO.cloneTo(C):(Pn.scale(H.direction,r,u._tempV30),Pn.add(H.origin,u._tempV30,u._tempV31),u._tempV31.cloneTo(C)),r},u.intersectsRayAndSphereRD=function(H,n){var C=n.radius;Pn.subtract(H.origin,n.center,u._tempV30);var r=Pn.dot(u._tempV30,H.direction),N=Pn.dot(u._tempV30,u._tempV30)-C*C;if(0<N&&0<r)return-1;var Q=r*r-N;if(Q<0)return-1;var I=-r-Math.sqrt(Q);return I<0&&(I=0),I},u.intersectsRayAndSphereRP=function(H,n,C){var r=u.intersectsRayAndSphereRD(H,n);return-1===r?Pn.ZERO.cloneTo(C):(Pn.scale(H.direction,r,u._tempV30),Pn.add(H.origin,u._tempV30,u._tempV31),u._tempV31.cloneTo(C)),r},u.intersectsSphereAndTriangle=function(H,n,C,r){var N=H.center,Q=H.radius;return u.closestPointPointTriangle(N,n,C,r,u._tempV30),Pn.subtract(u._tempV30,N,u._tempV31),Pn.dot(u._tempV31,u._tempV31)<=Q*Q},u.intersectsPlaneAndPoint=function(H,n){var C=Pn.dot(H.normal,n)+H.distance;return 0<C?rn.PlaneIntersectionType_Front:C<0?rn.PlaneIntersectionType_Back:rn.PlaneIntersectionType_Intersecting},u.intersectsPlaneAndPlane=function(H,n){Pn.cross(H.normal,n.normal,u._tempV30);var C=Pn.dot(u._tempV30,u._tempV30);return!BH.isZero(C)},u.intersectsPlaneAndPlaneRL=function(H,n,C){var r=H.normal,N=n.normal;Pn.cross(r,N,u._tempV34);var Q=Pn.dot(u._tempV34,u._tempV34);return!BH.isZero(Q)&&(Pn.scale(N,H.distance,u._tempV30),Pn.scale(r,n.distance,u._tempV31),Pn.subtract(u._tempV30,u._tempV31,u._tempV32),Pn.cross(u._tempV32,u._tempV34,u._tempV33),Pn.normalize(u._tempV34,u._tempV34),new In(u._tempV33,u._tempV34),!0)},u.intersectsPlaneAndBox=function(H,n){var C=H.distance,r=H.normal,N=r.elements,Q=N[0],I=N[1],A=N[2],P=n.min.elements,t=P[0],R=P[1],y=P[2],o=n.max.elements,g=o[0],M=o[1],j=o[2];u._tempV30.elements[0]=0<Q?t:g,u._tempV30.elements[1]=0<I?R:M,u._tempV30.elements[2]=0<A?y:j,u._tempV31.elements[0]=0<Q?g:t,u._tempV31.elements[1]=0<I?M:R,u._tempV31.elements[2]=0<A?j:y;var l=Pn.dot(r,u._tempV30);return 0<l+C?rn.PlaneIntersectionType_Front:(l=Pn.dot(r,u._tempV31))+C<0?rn.PlaneIntersectionType_Back:rn.PlaneIntersectionType_Intersecting},u.intersectsPlaneAndSphere=function(H,n){var C=n.radius,r=Pn.dot(H.normal,n.center)+H.distance;return C<r?rn.PlaneIntersectionType_Front:r<-C?rn.PlaneIntersectionType_Back:rn.PlaneIntersectionType_Intersecting},u.intersectsBoxAndBox=function(H,n){var C=H.min.elements,r=H.max.elements,N=n.min.elements,Q=n.max.elements;return!(C[0]>Q[0]||N[0]>r[0])&&(!(C[1]>Q[1]||N[1]>r[1])&&!(C[2]>Q[2]||N[2]>r[2]))},u.intersectsBoxAndSphere=function(H,n){var C=n.center,r=n.radius;return Pn.Clamp(C,H.min,H.max,u._tempV30),Pn.distanceSquared(C,u._tempV30)<=r*r},u.intersectsSphereAndSphere=function(H,n){var C=H.radius+n.radius;return Pn.distanceSquared(H.center,n.center)<=C*C},u.boxContainsPoint=function(H,n){var C=H.min.elements,r=H.max.elements,N=n.elements;return C[0]<=N[0]&&r[0]>=N[0]&&C[1]<=N[1]&&r[1]>=N[1]&&C[2]<=N[2]&&r[2]>=N[2]?1:0},u.boxContainsBox=function(H,n){var C=H.min.elements,r=C[0],N=C[1],Q=C[2],I=H.max.elements,A=I[0],P=I[1],t=I[2],R=n.min.elements,y=R[0],o=R[1],g=R[2],M=n.max.elements,j=M[0],l=M[1],f=M[2];return A<y||j<r?0:P<o||l<N?0:t<g||f<Q?0:r<=y&&j<=j&&N<=o&&l<=P&&Q<=g&&f<=t?1:2},u.boxContainsSphere=function(H,n){var C=H.min,r=C.elements,N=r[0],Q=r[1],I=r[2],A=H.max,P=A.elements,t=P[0],R=P[1],y=P[2],o=n.center,g=o.elements,M=g[0],j=g[1],l=g[2],f=n.radius;return Pn.Clamp(o,C,A,u._tempV30),f*f<Pn.distanceSquared(o,u._tempV30)?0:N+f<=M&&M<=t-f&&f<t-N&&Q+f<=j&&j<=R-f&&f<R-Q&&I+f<=l&&l<=y-f&&f<y-I?1:2},u.sphereContainsPoint=function(H,n){return Pn.distanceSquared(n,H.center)<=H.radius*H.radius?1:0},u.sphereContainsTriangle=function(H,n,C,r){var N=u.sphereContainsPoint(H,n),Q=u.sphereContainsPoint(H,C),I=u.sphereContainsPoint(H,r);return 1==N&&1==Q&&1==I?1:u.intersectsSphereAndTriangle(H,n,C,r)?2:0},u.sphereContainsBox=function(H,n){var C=H.center.elements,r=C[0],N=C[1],Q=C[2],I=H.radius,A=n.min.elements,P=A[0],t=A[1],R=A[2],y=n.max.elements,o=y[0],g=y[1],M=y[2],j=u._tempV30.elements;j[0],j[1],j[2];if(!u.intersectsBoxAndSphere(n,H))return 0;var l=I*I;return r-P,N-g,Q-M,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-o,N-g,Q-M,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-o,N-t,Q-M,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-P,N-t,Q-M,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-P,N-g,Q-R,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-o,N-g,Q-R,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-o,N-t,Q-R,Pn.scalarLengthSquared(u._tempV30)>l?2:(r-P,N-t,Q-R,Pn.scalarLengthSquared(u._tempV30)>l?2:1)))))))},u.sphereContainsSphere=function(H,n){var C=H.radius,r=n.radius,N=Pn.distance(H.center,n.center);return C+r<N?0:C-r<N?2:1},u.closestPointPointTriangle=function(H,n,C,r,N){Pn.subtract(C,n,u._tempV30),Pn.subtract(r,n,u._tempV31),Pn.subtract(H,n,u._tempV32),Pn.subtract(H,C,u._tempV33),Pn.subtract(H,r,u._tempV34);var Q=Pn.dot(u._tempV30,u._tempV32),I=Pn.dot(u._tempV31,u._tempV32),A=Pn.dot(u._tempV30,u._tempV33),P=Pn.dot(u._tempV31,u._tempV33),t=Pn.dot(u._tempV30,u._tempV34),R=Pn.dot(u._tempV31,u._tempV34);if(Q<=0&&I<=0)n.cloneTo(N);else if(0<=A&&P<=A)C.cloneTo(N);else{var y=Q*P-A*I;if(y<=0&&0<=Q&&A<=0){var o=Q/(Q-A);return Pn.scale(u._tempV30,o,N),void Pn.add(n,N,N)}if(0<=R&&t<=R)r.cloneTo(N);else{var g=t*I-Q*R;if(g<=0&&0<=I&&R<=0){var M=I/(I-R);return Pn.scale(u._tempV31,M,N),void Pn.add(n,N,N)}var j=A*R-t*P;if(j<=0&&0<=P-A&&0<=t-R){var l=(P-A)/(P-A+(t-R));return Pn.subtract(r,C,N),Pn.scale(N,l,N),void Pn.add(C,N,N)}var f=1/(j+g+y),c=g*f,K=y*f;Pn.scale(u._tempV30,c,u._tempV35),Pn.scale(u._tempV31,K,u._tempV36),Pn.add(u._tempV35,u._tempV36,N),Pn.add(n,N,N)}}},u.closestPointPlanePoint=function(H,n,C){var r=H.normal,N=Pn.dot(r,n)-H.distance;Pn.scale(r,N,u._tempV30),Pn.subtract(n,u._tempV30,C)},u.closestPointBoxPoint=function(H,n,C){Pn.max(n,H.min,u._tempV30),Pn.min(u._tempV30,H.max,C)},u.closestPointSpherePoint=function(H,n,C){var r=H.center;Pn.subtract(n,r,C),Pn.normalize(C,C),Pn.scale(C,H.radius,C),Pn.add(C,r,C)},u.closestPointSphereSphere=function(H,n,C){var r=H.center;Pn.subtract(n.center,r,C),Pn.normalize(C,C),Pn.scale(C,H.radius,C),Pn.add(C,r,C)},y(u,["_tempV30",function(){return this._tempV30=new Pn},"_tempV31",function(){return this._tempV31=new Pn},"_tempV32",function(){return this._tempV32=new Pn},"_tempV33",function(){return this._tempV33=new Pn},"_tempV34",function(){return this._tempV34=new Pn},"_tempV35",function(){return this._tempV35=new Pn},"_tempV36",function(){return this._tempV36=new Pn}]),u}(),BH=(function(){function H(){}g(H,"laya.d3.math.ContainmentType"),H.Disjoint=0,H.Contains=1,H.Intersects=2}(),function(){function C(){}return g(C,"laya.d3.math.MathUtils3D"),C.isZero=function(H){return Math.abs(H)<C.zeroTolerance},C.nearEqual=function(H,n){return!!C.isZero(H-n)},C.fastInvSqrt=function(H){return C.isZero(H)?H:1/Math.sqrt(H)},y(C,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),C}()),Hn=function(){function P(){var H=this.elements=new Float32Array(9);H[0]=1,H[1]=0,H[2]=0,H[3]=0,H[4]=1,H[5]=0,H[6]=0,H[7]=0,H[8]=1}g(P,"laya.d3.math.Matrix3x3");var H=P.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.determinant=function(){var H=this.elements,n=H[0],C=H[1],r=H[2],N=H[3],Q=H[4],I=H[5],A=H[6],P=H[7],t=H[8];return n*(t*Q-I*P)+C*(-t*N+I*A)+r*(P*N-Q*A)},H.translate=function(H,n){var C=n.elements,r=this.elements,N=H.elements,Q=r[0],I=r[1],A=r[2],P=r[3],t=r[4],R=r[5],y=r[6],o=r[7],g=r[8],M=N[0],j=N[1];C[0]=Q,C[1]=I,C[2]=A,C[3]=P,C[4]=t,C[5]=R,C[6]=M*Q+j*P+y,C[7]=M*I+j*t+o,C[8]=M*A+j*R+g},H.rotate=function(H,n){var C=n.elements,r=this.elements,N=r[0],Q=r[1],I=r[2],A=r[3],P=r[4],t=r[5],R=r[6],y=r[7],o=r[8],g=Math.sin(H),M=Math.cos(H);C[0]=M*N+g*A,C[1]=M*Q+g*P,C[2]=M*I+g*t,C[3]=M*A-g*N,C[4]=M*P-g*Q,C[5]=M*t-g*I,C[6]=R,C[7]=y,C[8]=o},H.scale=function(H,n){var C=n.elements,r=this.elements,N=H.elements,Q=N[0],I=N[1];C[0]=Q*r[0],C[1]=Q*r[1],C[2]=Q*r[2],C[3]=I*r[3],C[4]=I*r[4],C[5]=I*r[5],C[6]=r[6],C[7]=r[7],C[8]=r[8]},H.invert=function(H){var n=H.elements,C=this.elements,r=C[0],N=C[1],Q=C[2],I=C[3],A=C[4],P=C[5],t=C[6],R=C[7],y=C[8],o=y*A-P*R,g=-y*I+P*t,M=R*I-A*t,j=r*o+N*g+Q*M;j||(H=null),j=1/j,n[0]=o*j,n[1]=(-y*N+Q*R)*j,n[2]=(P*N-Q*A)*j,n[3]=g*j,n[4]=(y*r-Q*t)*j,n[5]=(-P*r+Q*I)*j,n[6]=M*j,n[7]=(-R*r+N*t)*j,n[8]=(A*r-N*I)*j},H.transpose=function(H){var n=H.elements,C=this.elements;if(H===this){var r=C[1],N=C[2],Q=C[5];n[1]=C[3],n[2]=C[6],n[3]=r,n[5]=C[7],n[6]=N,n[7]=Q}else n[0]=C[0],n[1]=C[3],n[2]=C[6],n[3]=C[1],n[4]=C[4],n[5]=C[7],n[6]=C[2],n[7]=C[5],n[8]=C[8]},H.identity=function(){var H=this.elements;H[0]=1,H[1]=0,H[2]=0,H[3]=0,H[4]=1,H[5]=0,H[6]=0,H[7]=0,H[8]=1},H.cloneTo=function(H){var n,C,r;if((C=this.elements)!==(r=H.elements))for(n=0;n<9;++n)r[n]=C[n]},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},P.createFromTranslation=function(H,n){n.elements;var C=H.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=C[0],n[7]=C[1],n[8]=1},P.createFromRotation=function(H,n){var C=n.elements,r=Math.sin(H),N=Math.cos(H);C[0]=N,C[1]=r,C[2]=0,C[3]=-r,C[4]=N,C[5]=0,C[6]=0,C[7]=0,C[8]=1},P.createFromScaling=function(H,n){var C=n.elements,r=H.elements;C[0]=r[0],C[1]=0,C[2]=0,C[3]=0,C[4]=r[1],C[5]=0,C[6]=0,C[7]=0,C[8]=1},P.createFromMatrix4x4=function(H,n){n[0]=H[0],n[1]=H[1],n[2]=H[2],n[3]=H[4],n[4]=H[5],n[5]=H[6],n[6]=H[8],n[7]=H[9],n[8]=H[10]},P.multiply=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements,I=N[0],A=N[1],P=N[2],t=N[3],R=N[4],y=N[5],o=N[6],g=N[7],M=N[8],j=Q[0],l=Q[1],f=Q[2],c=Q[3],K=Q[4],W=Q[5],z=Q[6],w=Q[7],F=Q[8];r[0]=j*I+l*t+f*o,r[1]=j*A+l*R+f*g,r[2]=j*P+l*y+f*M,r[3]=c*I+K*t+W*o,r[4]=c*A+K*R+W*g,r[5]=c*P+K*y+W*M,r[6]=z*I+w*t+F*o,r[7]=z*A+w*R+F*g,r[8]=z*P+w*y+F*M},P.lookAt=function(H,n,C,r){Pn.subtract(H,n,P._tempV30),Pn.normalize(P._tempV30,P._tempV30),Pn.cross(C,P._tempV30,P._tempV31),Pn.normalize(P._tempV31,P._tempV31),Pn.cross(P._tempV30,P._tempV31,P._tempV32);var N=P._tempV30.elements,Q=P._tempV31.elements,I=P._tempV32.elements,A=r.elements;A[0]=Q[0],A[3]=Q[1],A[6]=Q[2],A[1]=I[0],A[4]=I[1],A[7]=I[2],A[2]=N[0],A[5]=N[1],A[8]=N[2]},P.DEFAULT=new P,y(P,["_tempV30",function(){return this._tempV30=new Pn},"_tempV31",function(){return this._tempV31=new Pn},"_tempV32",function(){return this._tempV32=new Pn}]),P}(),nn=function(){function i(H,n,C,r,N,Q,I,A,P,t,R,y,o,g,M,j){void 0===H&&(H=1),void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0),void 0===N&&(N=0),void 0===Q&&(Q=1),void 0===I&&(I=0),void 0===A&&(A=0),void 0===P&&(P=0),void 0===t&&(t=0),void 0===R&&(R=1),void 0===y&&(y=0),void 0===o&&(o=0),void 0===g&&(g=0),void 0===M&&(M=0),void 0===j&&(j=1);var l=this.elements=new Float32Array(16);l[0]=H,l[1]=n,l[2]=C,l[3]=r,l[4]=N,l[5]=Q,l[6]=I,l[7]=A,l[8]=P,l[9]=t,l[10]=R,l[11]=y,l[12]=o,l[13]=g,l[14]=M,l[15]=j}g(i,"laya.d3.math.Matrix4x4");var H=i.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.getElementByRowColumn=function(H,n){if(H<0||3<H)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(n<0||3<n)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*H+n]},H.setElementByRowColumn=function(H,n,C){if(H<0||3<H)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(n<0||3<n)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*H+n]=C},H.equalsOtherMatrix=function(H){var n=this.elements,C=H.elements;return BH.nearEqual(n[0],C[0])&&BH.nearEqual(n[1],C[1])&&BH.nearEqual(n[2],C[2])&&BH.nearEqual(n[3],C[3])&&BH.nearEqual(n[4],C[4])&&BH.nearEqual(n[5],C[5])&&BH.nearEqual(n[6],C[6])&&BH.nearEqual(n[7],C[7])&&BH.nearEqual(n[8],C[8])&&BH.nearEqual(n[9],C[9])&&BH.nearEqual(n[10],C[10])&&BH.nearEqual(n[11],C[11])&&BH.nearEqual(n[12],C[12])&&BH.nearEqual(n[13],C[13])&&BH.nearEqual(n[14],C[14])&&BH.nearEqual(n[15],C[15])},H.decomposeTransRotScale=function(H,n,C){var r=i._tempMatrix4x4;return this.decomposeTransRotMatScale(H,r,C)?(Nn.createFromMatrix4x4(r,n),!0):(n.identity(),!1)},H.decomposeTransRotMatScale=function(H,n,C){var r=this.elements,N=H.elements,Q=n.elements,I=C.elements;N[0]=r[12],N[1]=r[13],N[2]=r[14];var A=r[0],P=r[1],t=r[2],R=r[4],y=r[5],o=r[6],g=r[8],M=r[9],j=r[10],l=I[0]=Math.sqrt(A*A+P*P+t*t),f=I[1]=Math.sqrt(R*R+y*y+o*o),c=I[2]=Math.sqrt(g*g+M*M+j*j);if(BH.isZero(l)||BH.isZero(f)||BH.isZero(c))return Q[1]=Q[2]=Q[3]=Q[4]=Q[6]=Q[7]=Q[8]=Q[9]=Q[11]=Q[12]=Q[13]=Q[14]=0,Q[0]=Q[5]=Q[10]=Q[15]=1,!1;var K=i._tempVector0,W=K.elements;W[0]=g/c,W[1]=M/c,W[2]=j/c;var z=i._tempVector1,w=z.elements;w[0]=A/l,w[1]=P/l,w[2]=t/l;var F=i._tempVector2;Pn.cross(K,z,F);var k=i._tempVector1;return Pn.cross(F,K,k),Q[3]=Q[7]=Q[11]=Q[12]=Q[13]=Q[14]=0,Q[15]=1,Q[0]=k.x,Q[1]=k.y,Q[2]=k.z,Q[4]=F.x,Q[5]=F.y,Q[6]=F.z,Q[8]=K.x,Q[9]=K.y,Q[10]=K.z,Q[0]*A+Q[1]*P+Q[2]*t<0&&(I[0]=-l),Q[4]*R+Q[5]*y+Q[6]*o<0&&(I[1]=-f),Q[8]*g+Q[9]*M+Q[10]*j<0&&(I[2]=-c),!0},H.decomposeYawPitchRoll=function(H){var n=H.elements,C=Math.asin(-this.elements[9]);n[1]=C,Math.cos(C)>BH.zeroTolerance?(n[2]=Math.atan2(this.elements[1],this.elements[5]),n[0]=Math.atan2(this.elements[8],this.elements[10])):(n[2]=Math.atan2(-this.elements[4],this.elements[0]),n[0]=0)},H.normalize=function(){var H=this.elements,n=H[0],C=H[1],r=H[2],N=Math.sqrt(n*n+C*C+r*r);if(!N)return H[0]=0,H[1]=0,void(H[2]=0);1!=N&&(N=1/N,H[0]=n*N,H[1]=C*N,H[2]=r*N)},H.transpose=function(){var H,n;return n=(H=this.elements)[1],H[1]=H[4],H[4]=n,n=H[2],H[2]=H[8],H[8]=n,n=H[3],H[3]=H[12],H[12]=n,n=H[6],H[6]=H[9],H[9]=n,n=H[7],H[7]=H[13],H[13]=n,n=H[11],H[11]=H[14],H[14]=n,this},H.invert=function(H){var n=this.elements,C=H.elements,r=n[0],N=n[1],Q=n[2],I=n[3],A=n[4],P=n[5],t=n[6],R=n[7],y=n[8],o=n[9],g=n[10],M=n[11],j=n[12],l=n[13],f=n[14],c=n[15],K=r*P-N*A,W=r*t-Q*A,z=r*R-I*A,w=N*t-Q*P,F=N*R-I*P,k=Q*R-I*t,i=y*l-o*j,a=y*f-g*j,D=y*c-M*j,L=o*f-g*l,b=o*c-M*l,h=g*c-M*f,v=K*h-W*b+z*L+w*D-F*a+k*i;0!==Math.abs(v)&&(v=1/v,C[0]=(P*h-t*b+R*L)*v,C[1]=(Q*b-N*h-I*L)*v,C[2]=(l*k-f*F+c*w)*v,C[3]=(g*F-o*k-M*w)*v,C[4]=(t*D-A*h-R*a)*v,C[5]=(r*h-Q*D+I*a)*v,C[6]=(f*z-j*k-c*W)*v,C[7]=(y*k-g*z+M*W)*v,C[8]=(A*b-P*D+R*i)*v,C[9]=(N*D-r*b-I*i)*v,C[10]=(j*F-l*z+c*K)*v,C[11]=(o*z-y*F-M*K)*v,C[12]=(P*a-A*L-t*i)*v,C[13]=(r*L-N*a+Q*i)*v,C[14]=(l*W-j*w-f*K)*v,C[15]=(y*w-o*W+g*K)*v)},H.identity=function(){var H=this.elements;H[1]=H[2]=H[3]=H[4]=H[6]=H[7]=H[8]=H[9]=H[11]=H[12]=H[13]=H[14]=0,H[0]=H[5]=H[10]=H[15]=1},H.cloneTo=function(H){var n,C,r;if((C=this.elements)!==(r=H.elements))for(n=0;n<16;++n)r[n]=C[n]},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},H.getTranslationVector=function(H){var n=this.elements,C=H.elements;C[0]=n[12],C[1]=n[13],C[2]=n[14]},H.setTranslationVector=function(H){var n=this.elements,C=H.elements;n[12]=C[0],n[13]=C[1],n[14]=C[2]},H.getForward=function(H){var n=this.elements,C=H.elements;C[0]=-n[8],C[1]=-n[9],C[2]=-n[10]},H.setForward=function(H){var n=this.elements,C=H.elements;n[8]=-C[0],n[9]=-C[1],n[10]=-C[2]},i.createRotationX=function(H,n){var C=n.elements,r=Math.sin(H),N=Math.cos(H);C[1]=C[2]=C[3]=C[4]=C[7]=C[8]=C[11]=C[12]=C[13]=C[14]=0,C[0]=C[15]=1,C[5]=C[10]=N,C[6]=r,C[9]=-r},i.createRotationY=function(H,n){var C=n.elements,r=Math.sin(H),N=Math.cos(H);C[1]=C[3]=C[4]=C[6]=C[7]=C[9]=C[11]=C[12]=C[13]=C[14]=0,C[5]=C[15]=1,C[0]=C[10]=N,C[2]=-r,C[8]=r},i.createRotationZ=function(H,n){var C=n.elements,r=Math.sin(H),N=Math.cos(H);C[2]=C[3]=C[6]=C[7]=C[8]=C[9]=C[11]=C[12]=C[13]=C[14]=0,C[10]=C[15]=1,C[0]=C[5]=N,C[1]=r,C[4]=-r},i.createRotationYawPitchRoll=function(H,n,C,r){Nn.createFromYawPitchRoll(H,n,C,i._tempQuaternion),i.createRotationQuaternion(i._tempQuaternion,r)},i.createRotationAxis=function(H,n,C){var r=H.elements,N=r[0],Q=r[1],I=r[2],A=Math.cos(n),P=Math.sin(n),t=N*N,R=Q*Q,y=I*I,o=N*Q,g=N*I,M=Q*I,j=C.elements;j[3]=j[7]=j[11]=j[12]=j[13]=j[14]=0,j[15]=1,j[0]=t+A*(1-t),j[1]=o-A*o+P*I,j[2]=g-A*g-P*Q,j[4]=o-A*o-P*I,j[5]=R+A*(1-R),j[6]=M-A*M+P*N,j[8]=g-A*g+P*Q,j[9]=M-A*M-P*N,j[10]=y+A*(1-y)},i.createRotationQuaternion=function(H,n){var C=H.elements,r=n.elements,N=C[0],Q=C[1],I=C[2],A=C[3],P=N*N,t=Q*Q,R=I*I,y=N*Q,o=I*A,g=I*N,M=Q*A,j=Q*I,l=N*A;r[3]=r[7]=r[11]=r[12]=r[13]=r[14]=0,r[15]=1,r[0]=1-2*(t+R),r[1]=2*(y+o),r[2]=2*(g-M),r[4]=2*(y-o),r[5]=1-2*(R+P),r[6]=2*(j+l),r[8]=2*(g+M),r[9]=2*(j-l),r[10]=1-2*(t+P)},i.createTranslate=function(H,n){var C=H.elements,r=n.elements;r[4]=r[8]=r[1]=r[9]=r[2]=r[6]=r[3]=r[7]=r[11]=0,r[0]=r[5]=r[10]=r[15]=1,r[12]=C[0],r[13]=C[1],r[14]=C[2]},i.createScaling=function(H,n){var C=H.elements,r=n.elements;r[0]=C[0],r[5]=C[1],r[10]=C[2],r[1]=r[4]=r[8]=r[12]=r[9]=r[13]=r[2]=r[6]=r[14]=r[3]=r[7]=r[11]=0,r[15]=1},i.multiply=function(H,n,C){var r,N,Q,I,A,P,t,R;for(N=C.elements,Q=H.elements,N===(I=n.elements)&&(I=I.slice()),r=0;r<4;r++)A=Q[r],P=Q[r+4],t=Q[r+8],R=Q[r+12],N[r]=A*I[0]+P*I[1]+t*I[2]+R*I[3],N[r+4]=A*I[4]+P*I[5]+t*I[6]+R*I[7],N[r+8]=A*I[8]+P*I[9]+t*I[10]+R*I[11],N[r+12]=A*I[12]+P*I[13]+t*I[14]+R*I[15]},i.createFromQuaternion=function(H,n){var C=n.elements,r=H.elements,N=r[0],Q=r[1],I=r[2],A=r[3],P=N+N,t=Q+Q,R=I+I,y=N*P,o=Q*P,g=Q*t,M=I*P,j=I*t,l=I*R,f=A*P,c=A*t,K=A*R;C[0]=1-g-l,C[1]=o+K,C[2]=M-c,C[3]=0,C[4]=o-K,C[5]=1-y-l,C[6]=j+f,C[7]=0,C[8]=M+c,C[9]=j-f,C[10]=1-y-g,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1},i.createAffineTransformation=function(H,n,C,r){var N=H.elements,Q=n.elements,I=C.elements,A=r.elements,P=Q[0],t=Q[1],R=Q[2],y=Q[3],o=P+P,g=t+t,M=R+R,j=P*o,l=P*g,f=P*M,c=t*g,K=t*M,W=R*M,z=y*o,w=y*g,F=y*M,k=I[0],i=I[1],a=I[2];A[0]=(1-(c+W))*k,A[1]=(l+F)*k,A[2]=(f-w)*k,A[3]=0,A[4]=(l-F)*i,A[5]=(1-(j+W))*i,A[6]=(K+z)*i,A[7]=0,A[8]=(f+w)*a,A[9]=(K-z)*a,A[10]=(1-(j+c))*a,A[11]=0,A[12]=N[0],A[13]=N[1],A[14]=N[2],A[15]=1},i.createLookAt=function(H,n,C,r){var N=r.elements,Q=i._tempVector0,I=i._tempVector1,A=i._tempVector2;Pn.subtract(H,n,A),Pn.normalize(A,A),Pn.cross(C,A,Q),Pn.normalize(Q,Q),Pn.cross(A,Q,I),r.identity(),N[0]=Q.x,N[4]=Q.y,N[8]=Q.z,N[1]=I.x,N[5]=I.y,N[9]=I.z,N[2]=A.x,N[6]=A.y,N[10]=A.z,N[12]=-Pn.dot(Q,H),N[13]=-Pn.dot(I,H),N[14]=-Pn.dot(A,H)},i.createPerspective=function(H,n,C,r,N){var Q=N.elements,I=1/Math.tan(H/2),A=1/(C-r);Q[0]=I/n,Q[5]=I,Q[10]=(r+C)*A,Q[11]=-1,Q[14]=2*r*C*A,Q[1]=Q[2]=Q[3]=Q[4]=Q[6]=Q[7]=Q[8]=Q[9]=Q[12]=Q[13]=Q[15]=0},i.createOrthoOffCenterRH=function(H,n,C,r,N,Q,I){var A=I.elements,P=1/(H-n),t=1/(C-r),R=1/(N-Q);A[1]=A[2]=A[3]=A[4]=A[6]=A[7]=A[8]=A[9]=A[11]=0,A[15]=1,A[0]=-2*P,A[5]=-2*t,A[10]=2*R,A[12]=(H+n)*P,A[13]=(r+C)*t,A[14]=(Q+N)*R},i.translation=function(H,n){var C=H.elements,r=n.elements;r[0]=r[5]=r[10]=r[15]=1,r[12]=C[0],r[13]=C[1],r[14]=C[2]},y(i,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new i},"_tempVector0",function(){return this._tempVector0=new Pn},"_tempVector1",function(){return this._tempVector1=new Pn},"_tempVector2",function(){return this._tempVector2=new Pn},"_tempQuaternion",function(){return this._tempQuaternion=new Nn},"DEFAULT",function(){return this.DEFAULT=new i},"ZERO",function(){return this.ZERO=new i(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),i}(),Cn=function(){function K(H,n){this.extents=null,this.transformation=null,this.extents=H,this.transformation=n}g(K,"laya.d3.math.OrientedBoundBox");var H=K.prototype;return H.getCorners=function(H){var n=K._tempV30.elements,C=K._tempV31.elements,r=K._tempV32.elements,N=this.extents.elements;n[0]=N[0],n[1]=n[2]=0,C[1]=N[1],C[0]=C[2]=0,r[2]=N[2],r[0]=r[1]=0,Pn.TransformNormal(K._tempV30,this.transformation,K._tempV30),Pn.TransformNormal(K._tempV31,this.transformation,K._tempV31),Pn.TransformNormal(K._tempV32,this.transformation,K._tempV32);var Q=K._tempV33;this.transformation.getTranslationVector(Q),H.length=8,Pn.add(Q,K._tempV30,K._tempV34),Pn.add(K._tempV34,K._tempV31,K._tempV34),Pn.add(K._tempV34,K._tempV32,H[0]),Pn.add(Q,K._tempV30,K._tempV34),Pn.add(K._tempV34,K._tempV31,K._tempV34),Pn.subtract(K._tempV34,K._tempV32,H[1]),Pn.subtract(Q,K._tempV30,K._tempV34),Pn.add(K._tempV34,K._tempV31,K._tempV34),Pn.subtract(K._tempV34,K._tempV32,H[2]),Pn.subtract(Q,K._tempV30,K._tempV34),Pn.add(K._tempV34,K._tempV31,K._tempV34),Pn.add(K._tempV34,K._tempV32,H[3]),Pn.add(Q,K._tempV30,K._tempV34),Pn.subtract(K._tempV34,K._tempV31,K._tempV34),Pn.add(K._tempV34,K._tempV32,H[4]),Pn.add(Q,K._tempV30,K._tempV34),Pn.subtract(K._tempV34,K._tempV31,K._tempV34),Pn.subtract(K._tempV34,K._tempV32,H[5]),Pn.subtract(Q,K._tempV30,K._tempV34),Pn.subtract(K._tempV34,K._tempV31,K._tempV34),Pn.subtract(K._tempV34,K._tempV32,H[6]),Pn.subtract(Q,K._tempV30,K._tempV34),Pn.subtract(K._tempV34,K._tempV31,K._tempV34),Pn.add(K._tempV34,K._tempV32,H[7])},H.transform=function(H){nn.multiply(this.transformation,H,this.transformation)},H.scale=function(H){Pn.multiply(this.extents,H,this.extents)},H.translate=function(H){this.transformation.getTranslationVector(K._tempV30),Pn.add(K._tempV30,H,K._tempV31),this.transformation.setTranslationVector(K._tempV31)},H.Size=function(H){Pn.scale(this.extents,2,H)},H.getSize=function(H){var n=this.extents.elements;K._tempV30.x=n[0],K._tempV31.y=n[1],K._tempV32.z=n[2],Pn.TransformNormal(K._tempV30,this.transformation,K._tempV30),Pn.TransformNormal(K._tempV31,this.transformation,K._tempV31),Pn.TransformNormal(K._tempV31,this.transformation,K._tempV32);var C=H.elements;C[0]=Pn.scalarLength(K._tempV30),C[1]=Pn.scalarLength(K._tempV31),C[2]=Pn.scalarLength(K._tempV32)},H.getSizeSquared=function(H){var n=this.extents.elements;K._tempV30.x=n[0],K._tempV31.y=n[1],K._tempV32.z=n[2],Pn.TransformNormal(K._tempV30,this.transformation,K._tempV30),Pn.TransformNormal(K._tempV31,this.transformation,K._tempV31),Pn.TransformNormal(K._tempV31,this.transformation,K._tempV32);var C=H.elements;C[0]=Pn.scalarLengthSquared(K._tempV30),C[1]=Pn.scalarLengthSquared(K._tempV31),C[2]=Pn.scalarLengthSquared(K._tempV32)},H.getCenter=function(H){this.transformation.getTranslationVector(H)},H.containsPoint=function(H){var n=this.extents.elements,C=n[0],r=n[1],N=n[2];this.transformation.invert(K._tempM0),Pn.transformCoordinate(H,K._tempM0,K._tempV30);var Q=K._tempV30.elements,I=Math.abs(Q[0]),A=Math.abs(Q[1]),P=Math.abs(Q[2]);return BH.nearEqual(I,C)&&BH.nearEqual(A,r)&&BH.nearEqual(P,N)?2:I<C&&A<r&&P<N?1:0},H.containsPoints=function(H){var n=this.extents.elements,C=n[0],r=n[1],N=n[2];this.transformation.invert(K._tempM0);for(var Q=!0,I=!1,A=0;A<H.length;A++){Pn.transformCoordinate(H[A],K._tempM0,K._tempV30);var P=K._tempV30.elements,t=Math.abs(P[0]),R=Math.abs(P[1]),y=Math.abs(P[2]);BH.nearEqual(t,C)&&BH.nearEqual(R,r)&&BH.nearEqual(y,N)&&(I=!0),t<C&&R<r&&y<N?I=!0:Q=!1}return Q?1:I?2:0},H.containsSphere=function(H,n){void 0===n&&(n=!1);var C=this.extents.elements,r=C[0],N=C[1],Q=C[2],I=H.radius;this.transformation.invert(K._tempM0),Pn.transformCoordinate(H.center,K._tempM0,K._tempV30);var A=NaN;if(A=n?I:(Pn.scale(Pn.UnitX,I,K._tempV31),Pn.TransformNormal(K._tempV31,K._tempM0,K._tempV31),Pn.scalarLength(K._tempV31)),Pn.scale(this.extents,-1,K._tempV32),Pn.Clamp(K._tempV30,K._tempV32,this.extents,K._tempV33),A*A<Pn.distanceSquared(K._tempV30,K._tempV33))return 0;var P=K._tempV30.elements,t=P[0],R=P[1],y=P[2],o=K._tempV32.elements,g=o[0],M=o[1],j=o[2];return g+A<=t&&t<=r-A&&A<r-g&&M+A<=R&&R<=N-A&&A<N-M&&j+A<=y&&y<=Q-A&&A<Q-j?1:2},H.containsOrientedBoundBox=function(H){var n=0,C=0;H.getCorners(K._corners);var r=this.containsPoints(K._corners);if(0!=r)return r;var N=this.extents.elements;H.extents.cloneTo(K._tempV35);var Q=K._tempV35.elements;K._getRows(this.transformation,K._rows1),K._getRows(H.transformation,K._rows2);var I=NaN;for(n=0;n<4;n++)for(C=0;C<4;C++)3==n||3==C?(K._tempM0.setElementByRowColumn(n,C,0),K._tempM1.setElementByRowColumn(n,C,0)):(I=Pn.dot(K._rows1[n],K._rows2[C]),K._tempM0.setElementByRowColumn(n,C,I),K._tempM1.setElementByRowColumn(n,C,Math.abs(I)));H.getCenter(K._tempV34),this.getCenter(K._tempV36),Pn.subtract(K._tempV34,K._tempV36,K._tempV30);var A=K._tempV31.elements;A[0]=Pn.dot(K._tempV30,K._rows1[0]),A[1]=Pn.dot(K._tempV30,K._rows1[1]),A[2]=Pn.dot(K._tempV30,K._rows1[2]);var P=K._tempV32.elements,t=K._tempV33.elements;for(n=0;n<3;n++)if(P[0]=K._tempM1.getElementByRowColumn(n,0),P[1]=K._tempM1.getElementByRowColumn(n,1),P[2]=K._tempM1.getElementByRowColumn(n,2),N[n]+Pn.dot(K._tempV35,K._tempV32)<Math.abs(A[n]))return 0;for(C=0;C<3;C++)if(P[0]=K._tempM1.getElementByRowColumn(0,C),P[1]=K._tempM1.getElementByRowColumn(1,C),P[2]=K._tempM1.getElementByRowColumn(2,C),t[0]=K._tempM0.getElementByRowColumn(0,C),t[1]=K._tempM0.getElementByRowColumn(1,C),t[2]=K._tempM0.getElementByRowColumn(2,C),Pn.dot(this.extents,K._tempV32)+Q[C]<Math.abs(Pn.dot(K._tempV31,K._tempV33)))return 0;for(n=0;n<3;n++)for(C=0;C<3;C++){var R=(n+1)%3,y=(n+2)%3,o=(C+1)%3,g=(C+2)%3;if(N[R]*K._tempM1.getElementByRowColumn(y,C)+N[y]*K._tempM1.getElementByRowColumn(R,C)+(Q[o]*K._tempM1.getElementByRowColumn(n,g)+Q[g]*K._tempM1.getElementByRowColumn(n,o))<Math.abs(A[y]*K._tempM0.getElementByRowColumn(R,C)-A[R]*K._tempM0.getElementByRowColumn(y,C)))return 0}return 2},H.containsLine=function(H,n){K._corners[0]=H,K._corners[1]=n;var C=this.containsPoints(K._corners);if(0!=C)return C;var r=this.extents.elements,N=r[0],Q=r[1],I=r[2];this.transformation.invert(K._tempM0),Pn.transformCoordinate(H,K._tempM0,K._tempV30),Pn.transformCoordinate(n,K._tempM0,K._tempV31),Pn.add(K._tempV30,K._tempV31,K._tempV32),Pn.scale(K._tempV32,.5,K._tempV32),Pn.subtract(K._tempV30,K._tempV32,K._tempV33);var A=K._tempV33.elements,P=A[0],t=A[1],R=A[2],y=K._tempV34.elements,o=y[0]=Math.abs(A[0]),g=y[1]=Math.abs(A[1]),M=y[2]=Math.abs(A[2]),j=K._tempV32.elements,l=j[0],f=j[1],c=j[2];return Math.abs(l)>N+o?0:Math.abs(f)>Q+g?0:Math.abs(c)>I+M?0:Math.abs(f*R-c*t)>Q*M+I*g?0:Math.abs(l*R-c*P)>N*M+I*o?0:Math.abs(l*t-f*P)>N*g+Q*o?0:2},H.containsBoundBox=function(H){var n=0,C=0,r=H.min,N=H.max;H.getCorners(K._corners);var Q=this.containsPoints(K._corners);if(0!=Q)return Q;Pn.subtract(N,r,K._tempV30),Pn.scale(K._tempV30,.5,K._tempV30),Pn.add(r,K._tempV30,K._tempV30),Pn.subtract(N,K._tempV30,K._tempV31);var I=this.extents.elements,A=K._tempV31.elements;K._getRows(this.transformation,K._rows1),this.transformation.invert(K._tempM0);for(n=0;n<3;n++)for(C=0;C<3;C++)K._tempM1.setElementByRowColumn(n,C,Math.abs(K._tempM0.getElementByRowColumn(n,C)));this.getCenter(K._tempV35),Pn.subtract(K._tempV30,K._tempV35,K._tempV32);var P=K._tempV31.elements;P[0]=Pn.dot(K._tempV32,K._rows1[0]),P[1]=Pn.dot(K._tempV32,K._rows1[1]),P[2]=Pn.dot(K._tempV32,K._rows1[2]);var t=K._tempV33.elements,R=K._tempV34.elements;for(n=0;n<3;n++)if(t[0]=K._tempM1.getElementByRowColumn(n,0),t[1]=K._tempM1.getElementByRowColumn(n,1),t[2]=K._tempM1.getElementByRowColumn(n,2),I[n]+Pn.dot(K._tempV31,K._tempV33)<Math.abs(P[n]))return 0;for(C=0;C<3;C++)if(t[0]=K._tempM1.getElementByRowColumn(0,C),t[1]=K._tempM1.getElementByRowColumn(1,C),t[2]=K._tempM1.getElementByRowColumn(2,C),R[0]=K._tempM0.getElementByRowColumn(0,C),R[1]=K._tempM0.getElementByRowColumn(1,C),R[2]=K._tempM0.getElementByRowColumn(2,C),Pn.dot(this.extents,K._tempV33)+A[C]<Math.abs(Pn.dot(K._tempV31,K._tempV34)))return 0;for(n=0;n<3;n++)for(C=0;C<3;C++){var y=(n+1)%3,o=(n+2)%3,g=(C+1)%3,M=(C+2)%3;if(I[y]*K._tempM1.getElementByRowColumn(o,C)+I[o]*K._tempM1.getElementByRowColumn(y,C)+(A[g]*K._tempM1.getElementByRowColumn(n,M)+A[M]*K._tempM1.getElementByRowColumn(n,g))<Math.abs(P[o]*K._tempM0.getElementByRowColumn(y,C)-P[y]*K._tempM0.getElementByRowColumn(o,C)))return 0}return 2},H.intersectsRay=function(H,n){Pn.scale(this.extents,-1,K._tempV30),this.transformation.invert(K._tempM0),Pn.TransformNormal(H.direction,K._tempM0,K._ray.direction),Pn.transformCoordinate(H.origin,K._tempM0,K._ray.origin),K._boxBound1.min=K._tempV30,K._boxBound1.max=this.extents;var C=VH.intersectsRayAndBoxRP(K._ray,K._boxBound1,n);return-1!==C&&Pn.transformCoordinate(n,this.transformation,n),C},H._getLocalCorners=function(H){H.length=8;var n=this.extents.elements;K._tempV30.x=n[0],K._tempV31.y=n[1],K._tempV32.z=n[2],Pn.add(K._tempV30,K._tempV31,K._tempV33),Pn.add(K._tempV33,K._tempV32,H[0]),Pn.add(K._tempV30,K._tempV31,K._tempV33),Pn.subtract(K._tempV33,K._tempV32,H[1]),Pn.subtract(K._tempV31,K._tempV30,K._tempV33),Pn.subtract(K._tempV33,K._tempV30,H[2]),Pn.subtract(K._tempV31,K._tempV30,K._tempV33),Pn.add(K._tempV33,K._tempV32,H[3]),Pn.subtract(K._tempV30,K._tempV31,K._tempV33),Pn.add(K._tempV33,K._tempV32,H[4]),Pn.subtract(K._tempV30,K._tempV31,K._tempV33),Pn.subtract(K._tempV33,K._tempV32,H[5]),Pn.scale(H[0],-1,H[6]),Pn.subtract(K._tempV32,K._tempV30,K._tempV33),Pn.subtract(K._tempV33,K._tempV31,H[7])},H.equals=function(H){return this.extents==H.extents&&this.transformation==H.transformation},H.cloneTo=function(H){var n=H;this.extents.cloneTo(n.extents),this.transformation.cloneTo(n.transformation)},K.createByBoundBox=function(H,n){var C=H.min,r=H.max;Pn.subtract(r,C,K._tempV30),Pn.scale(K._tempV30,.5,K._tempV30),Pn.add(C,K._tempV30,K._tempV31),Pn.subtract(r,K._tempV31,K._tempV32),nn.translation(K._tempV31,K._tempM0);var N=K._tempV32.clone(),Q=K._tempM0.clone();n.extents=N,n.transformation=Q},K.createByMinAndMaxVertex=function(H,n){return Pn.subtract(n,H,K._tempV30),Pn.scale(K._tempV30,.5,K._tempV30),Pn.add(H,K._tempV30,K._tempV31),Pn.subtract(n,K._tempV31,K._tempV32),nn.translation(K._tempV31,K._tempM0),new K(K._tempV32,K._tempM0)},K._getRows=function(H,n){n.length=3;var C=H.elements,r=n[0].elements;r[0]=C[0],r[1]=C[1],r[2]=C[2];var N=n[1].elements;N[0]=C[4],N[1]=C[5],N[2]=C[6];var Q=n[2].elements;Q[0]=C[8],Q[1]=C[9],Q[2]=C[10]},K.getObbtoObbMatrix4x4=function(H,n,C,r){var N=H.transformation,Q=n.transformation;if(C){K._getRows(N,K._rows1),K._getRows(Q,K._rows2);for(var I=0;I<3;I++)for(var A=0;A<3;A++)r.setElementByRowColumn(I,A,Pn.dot(K._rows2[I],K._rows1[A]));n.getCenter(K._tempV30),H.getCenter(K._tempV31),Pn.subtract(K._tempV30,K._tempV31,K._tempV32);var P=r.elements;P[12]=Pn.dot(K._tempV32,K._rows1[0]),P[13]=Pn.dot(K._tempV32,K._rows1[1]),P[14]=Pn.dot(K._tempV32,K._rows1[2]),P[15]=1}else N.invert(K._tempM0),nn.multiply(Q,K._tempM0,r)},K.merge=function(H,n,C){var r=H.extents,N=H.transformation;K.getObbtoObbMatrix4x4(H,n,C,K._tempM0),n._getLocalCorners(K._corners),Pn.transformCoordinate(K._corners[0],K._tempM0,K._corners[0]),Pn.transformCoordinate(K._corners[1],K._tempM0,K._corners[1]),Pn.transformCoordinate(K._corners[2],K._tempM0,K._corners[2]),Pn.transformCoordinate(K._corners[3],K._tempM0,K._corners[3]),Pn.transformCoordinate(K._corners[4],K._tempM0,K._corners[4]),Pn.transformCoordinate(K._corners[5],K._tempM0,K._corners[5]),Pn.transformCoordinate(K._corners[6],K._tempM0,K._corners[6]),Pn.transformCoordinate(K._corners[7],K._tempM0,K._corners[7]),Pn.scale(r,-1,K._boxBound1.min),r.cloneTo(K._boxBound1.max),YH.createfromPoints(K._corners,K._boxBound2),YH.merge(K._boxBound2,K._boxBound1,K._boxBound3);var Q=K._boxBound3.min,I=K._boxBound3.max;Pn.subtract(I,Q,K._tempV30),Pn.scale(K._tempV30,.5,K._tempV30),Pn.add(Q,K._tempV30,K._tempV32),Pn.subtract(I,K._tempV32,r),Pn.transformCoordinate(K._tempV32,N,K._tempV33)},y(K,["_tempV30",function(){return this._tempV30=new Pn},"_tempV31",function(){return this._tempV31=new Pn},"_tempV32",function(){return this._tempV32=new Pn},"_tempV33",function(){return this._tempV33=new Pn},"_tempV34",function(){return this._tempV34=new Pn},"_tempV35",function(){return this._tempV35=new Pn},"_tempV36",function(){return this._tempV36=new Pn},"_tempM0",function(){return this._tempM0=new nn},"_tempM1",function(){return this._tempM1=new nn},"_corners",function(){return this._corners=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn]},"_rows1",function(){return this._rows1=[new Pn,new Pn,new Pn]},"_rows2",function(){return this._rows2=[new Pn,new Pn,new Pn]},"_ray",function(){return this._ray=new In(new Pn,new Pn)},"_boxBound1",function(){return this._boxBound1=new YH(new Pn,new Pn)},"_boxBound2",function(){return this._boxBound2=new YH(new Pn,new Pn)},"_boxBound3",function(){return this._boxBound3=new YH(new Pn,new Pn)}]),K}(),rn=function(){function z(H,n){this.normal=null,this.distance=NaN,void 0===n&&(n=0),this.normal=H,this.distance=n}return g(z,"laya.d3.math.Plane"),z.prototype.normalize=function(){var H=this.normal.elements,n=H[0],C=H[1],r=H[2],N=1/Math.sqrt(n*n+C*C+r*r);H[0]=n*N,H[1]=C*N,H[2]=r*N,this.distance*=N},z.createPlaneBy3P=function(H,n,C){var r=H.elements,N=n.elements,Q=C.elements,I=N[0]-r[0],A=N[1]-r[1],P=N[2]-r[2],t=Q[0]-r[0],R=Q[1]-r[1],y=Q[2]-r[2],o=A*y-P*R,g=P*t-I*y,M=I*R-A*t,j=1/Math.sqrt(o*o+g*g+M*M),l=o*j,f=g*j,c=M*j,K=z._TEMPVec3.elements;K[0]=l,K[1]=f,K[2]=c;var W=-(l*r[0]+f*r[1]+c*r[2]);return new z(z._TEMPVec3,W)},z.PlaneIntersectionType_Back=0,z.PlaneIntersectionType_Front=1,z.PlaneIntersectionType_Intersecting=2,y(z,["_TEMPVec3",function(){return this._TEMPVec3=new Pn}]),z}(),Nn=function(){function N(H,n,C,r){this.elements=new Float32Array(4),void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=1),this.elements[0]=H,this.elements[1]=n,this.elements[2]=C,this.elements[3]=r}g(N,"laya.d3.math.Quaternion");var H=N.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.scaling=function(H,n){var C=n.elements,r=this.elements;C[0]=r[0]*H,C[1]=r[1]*H,C[2]=r[2]*H,C[3]=r[3]*H},H.normalize=function(H){var n=H.elements,C=this.elements,r=C[0],N=C[1],Q=C[2],I=C[3],A=r*r+N*N+Q*Q+I*I;0<A&&(A=1/Math.sqrt(A),n[0]=r*A,n[1]=N*A,n[2]=Q*A,n[3]=I*A)},H.length=function(){var H=this.elements,n=H[0],C=H[1],r=H[2],N=H[3];return Math.sqrt(n*n+C*C+r*r+N*N)},H.rotateX=function(H,n){var C=n.elements,r=this.elements;H*=.5;var N=r[0],Q=r[1],I=r[2],A=r[3],P=Math.sin(H),t=Math.cos(H);C[0]=N*t+A*P,C[1]=Q*t+I*P,C[2]=I*t-Q*P,C[3]=A*t-N*P},H.rotateY=function(H,n){var C=n.elements,r=this.elements;H*=.5;var N=r[0],Q=r[1],I=r[2],A=r[3],P=Math.sin(H),t=Math.cos(H);C[0]=N*t-I*P,C[1]=Q*t+A*P,C[2]=I*t+N*P,C[3]=A*t-Q*P},H.rotateZ=function(H,n){var C=n.elements,r=this.elements;H*=.5;var N=r[0],Q=r[1],I=r[2],A=r[3],P=Math.sin(H),t=Math.cos(H);C[0]=N*t+Q*P,C[1]=Q*t-N*P,C[2]=I*t+A*P,C[3]=A*t-I*P},H.getYawPitchRoll=function(H){Pn.transformQuat(Pn.ForwardRH,this,N.TEMPVector31),Pn.transformQuat(Pn.Up,this,N.TEMPVector32);var n=N.TEMPVector32.elements;N.angleTo(Pn.ZERO,N.TEMPVector31,N.TEMPVector33);var C=N.TEMPVector33.elements;C[0]==Math.PI/2?(C[1]=N.arcTanAngle(n[2],n[0]),C[2]=0):C[0]==-Math.PI/2?(C[1]=N.arcTanAngle(-n[2],-n[0]),C[2]=0):(nn.createRotationY(-C[1],N.TEMPMatrix0),nn.createRotationX(-C[0],N.TEMPMatrix1),Pn.transformCoordinate(N.TEMPVector32,N.TEMPMatrix0,N.TEMPVector32),Pn.transformCoordinate(N.TEMPVector32,N.TEMPMatrix1,N.TEMPVector32),C[2]=N.arcTanAngle(n[1],-n[0])),C[1]<=-Math.PI&&(C[1]=Math.PI),C[2]<=-Math.PI&&(C[2]=Math.PI),C[1]>=Math.PI&&C[2]>=Math.PI&&(C[1]=0,C[2]=0,C[0]=Math.PI-C[0]);var r=H.elements;r[0]=C[1],r[1]=C[0],r[2]=C[2]},H.invert=function(H){var n=H.elements,C=this.elements,r=C[0],N=C[1],Q=C[2],I=C[3],A=r*r+N*N+Q*Q+I*I,P=A?1/A:0;n[0]=-r*P,n[1]=-N*P,n[2]=-Q*P,n[3]=I*P},H.identity=function(){var H=this.elements;H[0]=0,H[1]=0,H[2]=0,H[3]=1},H.fromArray=function(H,n){void 0===n&&(n=0),this.elements[0]=H[n+0],this.elements[1]=H[n+1],this.elements[2]=H[n+2],this.elements[3]=H[n+3]},H.cloneTo=function(H){var n,C,r;if((C=this.elements)!==(r=H.elements))for(n=0;n<4;++n)r[n]=C[n]},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},H.equals=function(H){var n=this.elements,C=H.elements;return BH.nearEqual(n[0],C[0])&&BH.nearEqual(n[1],C[1])&&BH.nearEqual(n[2],C[2])&&BH.nearEqual(n[3],C[3])},H.lengthSquared=function(){var H=this.elements[0],n=this.elements[1],C=this.elements[2],r=this.elements[3];return H*H+n*n+C*C+r*r},M(0,H,"x",function(){return this.elements[0]}),M(0,H,"y",function(){return this.elements[1]}),M(0,H,"z",function(){return this.elements[2]}),M(0,H,"w",function(){return this.elements[3]}),N.createFromYawPitchRoll=function(H,n,C,r){var N=.5*C,Q=.5*n,I=.5*H,A=Math.sin(N),P=Math.cos(N),t=Math.sin(Q),R=Math.cos(Q),y=Math.sin(I),o=Math.cos(I),g=r.elements;g[0]=o*t*P+y*R*A,g[1]=y*R*P-o*t*A,g[2]=o*R*A-y*t*P,g[3]=o*R*P+y*t*A},N.multiply=function(H,n,C){var r=H.elements,N=n.elements,Q=C.elements,I=r[0],A=r[1],P=r[2],t=r[3],R=N[0],y=N[1],o=N[2],g=N[3],M=A*o-P*y,j=P*R-I*o,l=I*y-A*R,f=I*R+A*y+P*o;Q[0]=I*g+R*t+M,Q[1]=A*g+y*t+j,Q[2]=P*g+o*t+l,Q[3]=t*g-f},N.arcTanAngle=function(H,n){return 0==H?1==n?Math.PI/2:-Math.PI/2:0<H?Math.atan(n/H):H<0?0<n?Math.atan(n/H)+Math.PI:Math.atan(n/H)-Math.PI:0},N.angleTo=function(H,n,C){Pn.subtract(n,H,N.TEMPVector30),Pn.normalize(N.TEMPVector30,N.TEMPVector30),C.elements[0]=Math.asin(N.TEMPVector30.y),C.elements[1]=N.arcTanAngle(-N.TEMPVector30.z,-N.TEMPVector30.x)},N.createFromAxisAngle=function(H,n,C){var r=C.elements,N=H.elements;n*=.5;var Q=Math.sin(n);r[0]=Q*N[0],r[1]=Q*N[1],r[2]=Q*N[2],r[3]=Math.cos(n)},N.createFromMatrix3x3=function(H,n){var C,r=n.elements,N=H.elements,Q=N[0]+N[4]+N[8];if(0<Q)C=Math.sqrt(Q+1),r[3]=.5*C,C=.5/C,r[0]=(N[5]-N[7])*C,r[1]=(N[6]-N[2])*C,r[2]=(N[1]-N[3])*C;else{var I=0;N[4]>N[0]&&(I=1),N[8]>N[3*I+I]&&(I=2);var A=(I+1)%3,P=(I+2)%3;C=Math.sqrt(N[3*I+I]-N[3*A+A]-N[3*P+P]+1),r[I]=.5*C,C=.5/C,r[3]=(N[3*A+P]-N[3*P+A])*C,r[A]=(N[3*A+I]+N[3*I+A])*C,r[P]=(N[3*P+I]+N[3*I+P])*C}},N.createFromMatrix4x4=function(H,n){var C,r,N=H.elements,Q=n.elements,I=N[0]+N[5]+N[10];0<I?(C=Math.sqrt(I+1),Q[3]=.5*C,C=.5/C,Q[0]=(N[6]-N[9])*C,Q[1]=(N[8]-N[2])*C,Q[2]=(N[1]-N[4])*C):N[0]>=N[5]&&N[0]>=N[10]?(r=.5/(C=Math.sqrt(1+N[0]-N[5]-N[10])),Q[0]=.5*C,Q[1]=(N[1]+N[4])*r,Q[2]=(N[2]+N[8])*r,Q[3]=(N[6]-N[9])*r):N[5]>N[10]?(r=.5/(C=Math.sqrt(1+N[5]-N[0]-N[10])),Q[0]=(N[4]+N[1])*r,Q[1]=.5*C,Q[2]=(N[9]+N[6])*r,Q[3]=(N[8]-N[2])*r):(r=.5/(C=Math.sqrt(1+N[10]-N[0]-N[5])),Q[0]=(N[8]+N[2])*r,Q[1]=(N[9]+N[6])*r,Q[2]=.5*C,Q[3]=(N[1]-N[4])*r)},N.slerp=function(H,n,C,r){var N,Q,I,A,P,t=H.elements,R=n.elements,y=r.elements,o=t[0],g=t[1],M=t[2],j=t[3],l=R[0],f=R[1],c=R[2],K=R[3];return(Q=o*l+g*f+M*c+j*K)<0&&(Q=-Q,l=-l,f=-f,c=-c,K=-K),P=1e-6<1-Q?(N=Math.acos(Q),I=Math.sin(N),A=Math.sin((1-C)*N)/I,Math.sin(C*N)/I):(A=1-C,C),y[0]=A*o+P*l,y[1]=A*g+P*f,y[2]=A*M+P*c,y[3]=A*j+P*K,y},N.lerp=function(H,n,C,r){var N=r.elements,Q=H.elements,I=n.elements,A=Q[0],P=Q[1],t=Q[2],R=Q[3];N[0]=A+C*(I[0]-A),N[1]=P+C*(I[1]-P),N[2]=t+C*(I[2]-t),N[3]=R+C*(I[3]-R)},N.add=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]+Q[0],r[1]=N[1]+Q[1],r[2]=N[2]+Q[2],r[3]=N[3]+Q[3]},N.dot=function(H,n){var C=H.elements,r=n.elements;return C[0]*r[0]+C[1]*r[1]+C[2]*r[2]+C[3]*r[3]},N.rotationLookAt=function(H,n,C){N.lookAt(Pn.ZERO,H,n,C)},N.lookAt=function(H,n,C,r){Hn.lookAt(H,n,C,N._tempMatrix3x3),N.rotationMatrix(N._tempMatrix3x3,r)},N.invert=function(H,n){var C=H.elements,r=n.elements,N=H.lengthSquared();BH.isZero(N)||(N=1/N,r[0]=-C[0]*N,r[1]=-C[1]*N,r[2]=-C[2]*N,r[3]=C[3]*N)},N.rotationMatrix=function(H,n){var C=H.elements,r=C[0],N=C[1],Q=C[2],I=C[3],A=C[4],P=C[5],t=C[6],R=C[7],y=C[8],o=n.elements,g=NaN,M=NaN,j=r+A+y;0<j?(g=Math.sqrt(j+1),o[3]=.5*g,g=.5/g,o[0]=(P-R)*g,o[1]=(t-Q)*g,o[2]=(N-I)*g):A<=r&&y<=r?(M=.5/(g=Math.sqrt(1+r-A-y)),o[0]=.5*g,o[1]=(N+I)*M,o[2]=(Q+t)*M,o[3]=(P-R)*M):y<A?(M=.5/(g=Math.sqrt(1+A-r-y)),o[0]=(I+N)*M,o[1]=.5*g,o[2]=(R+P)*M,o[3]=(t-Q)*M):(M=.5/(g=Math.sqrt(1+y-r-A)),o[0]=(t+Q)*M,o[1]=(R+P)*M,o[2]=.5*g,o[3]=(N-I)*M)},N.DEFAULT=new N,y(N,["TEMPVector30",function(){return this.TEMPVector30=new Pn},"TEMPVector31",function(){return this.TEMPVector31=new Pn},"TEMPVector32",function(){return this.TEMPVector32=new Pn},"TEMPVector33",function(){return this.TEMPVector33=new Pn},"TEMPMatrix0",function(){return this.TEMPMatrix0=new nn},"TEMPMatrix1",function(){return this.TEMPMatrix1=new nn},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new Hn},"NAN",function(){return this.NAN=new N(NaN,NaN,NaN,NaN)}]),N}(),Qn=function(){function H(H){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=H,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}g(H,"laya.d3.math.Rand");var n=H.prototype;return n.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},n.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},n.getSignedFloat=function(){return 2*this.getFloat()-1},M(0,n,"seed",function(){return this.seeds[0]},function(H){this.seeds[0]=H,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),H.getFloatFromInt=function(H){return 1/8388607*(8388607&H)},H.getByteFromInt=function(H){return(8388607&H)>>>15},H}(),In=(function(){function N(H){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(H instanceof Array)||4!==H.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|H[0],this._state0L=0|H[1],this._state1U=0|H[2],this._state1L=0|H[3]}g(N,"laya.d3.math.RandX");var H=N.prototype;H.randomint=function(){var H=this._state0U,n=this._state0L,C=this._state1U,r=this._state1L,N=(r>>>0)+(n>>>0),Q=C+H+(N/2>>>31)>>>0,I=N>>>0,A=0,P=0;A=(H^=A=H<<23|(-512&n)>>>9)^(this._state0U=C),P=(n^=P=n<<23)^(this._state0L=r);A^=H>>>18,P^=n>>>18|(262143&H)<<14;return A^=C>>>5,P^=r>>>5|(31&C)<<27,this._state1U=A,this._state1L=P,[Q,I]},H.random=function(){var H=this.randomint(),n=H[0],C=1023<<20|n>>>12,r=0|(H[1]>>>12|(4095&n)<<20);return N._CONVERTION_BUFFER.setUint32(0,C,!1),N._CONVERTION_BUFFER.setUint32(4,r,!1),Qn._CONVERTION_BUFFER.getFloat64(0,!1)-1},y(N,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new Qn([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function H(H,n){this.origin=null,this.direction=null,this.origin=H,this.direction=n}return g(H,"laya.d3.math.Ray"),H}()),An=function(){function H(H,n){this.elements=new Float32Array(2),void 0===H&&(H=0),void 0===n&&(n=0);var C=this.elements;C[0]=H,C[1]=n}g(H,"laya.d3.math.Vector2");var n=H.prototype;return z.imps(n,{"laya.d3.core.IClone":!0}),n.fromArray=function(H,n){void 0===n&&(n=0),this.elements[0]=H[n+0],this.elements[1]=H[n+1]},n.cloneTo=function(H){var n=H.elements,C=this.elements;n[0]=C[0],n[1]=C[1]},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"x",function(){return this.elements[0]},function(H){this.elements[0]=H}),M(0,n,"y",function(){return this.elements[1]},function(H){this.elements[1]=H}),H.scale=function(H,n,C){var r=C.elements,N=H.elements;r[0]=N[0]*n,r[1]=N[1]*n},y(H,["ZERO",function(){return this.ZERO=new H(0,0)},"ONE",function(){return this.ONE=new H(1,1)}]),H}(),Pn=function(){function R(H,n,C){this.elements=new Float32Array(3),void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0);var r=this.elements;r[0]=H,r[1]=n,r[2]=C}g(R,"laya.d3.math.Vector3");var H=R.prototype;return z.imps(H,{"laya.d3.core.IClone":!0}),H.fromArray=function(H,n){void 0===n&&(n=0),this.elements[0]=H[n+0],this.elements[1]=H[n+1],this.elements[2]=H[n+2]},H.cloneTo=function(H){var n=H.elements,C=this.elements;n[0]=C[0],n[1]=C[1],n[2]=C[2]},H.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},H.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},H.reset=function(H,n,C){this.elements[0]=H,this.elements[1]=n,this.elements[2]=C},M(0,H,"x",function(){return this.elements[0]},function(H){this.elements[0]=H}),M(0,H,"y",function(){return this.elements[1]},function(H){this.elements[1]=H}),M(0,H,"z",function(){return this.elements[2]},function(H){this.elements[2]=H}),R.distanceSquared=function(H,n){var C=H.elements,r=n.elements,N=C[0]-r[0],Q=C[1]-r[1],I=C[2]-r[2];return N*N+Q*Q+I*I},R.distance=function(H,n){var C=H.elements,r=n.elements,N=C[0]-r[0],Q=C[1]-r[1],I=C[2]-r[2];return Math.sqrt(N*N+Q*Q+I*I)},R.min=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=Math.min(N[0],Q[0]),r[1]=Math.min(N[1],Q[1]),r[2]=Math.min(N[2],Q[2])},R.max=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=Math.max(N[0],Q[0]),r[1]=Math.max(N[1],Q[1]),r[2]=Math.max(N[2],Q[2])},R.transformQuat=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements,I=N[0],A=N[1],P=N[2],t=Q[0],R=Q[1],y=Q[2],o=Q[3],g=o*I+R*P-y*A,M=o*A+y*I-t*P,j=o*P+t*A-R*I,l=-t*I-R*A-y*P;r[0]=g*o+l*-t+M*-y-j*-R,r[1]=M*o+l*-R+j*-t-g*-y,r[2]=j*o+l*-y+g*-R-M*-t},R.scalarLength=function(H){var n=H.elements,C=n[0],r=n[1],N=n[2];return Math.sqrt(C*C+r*r+N*N)},R.scalarLengthSquared=function(H){var n=H.elements,C=n[0],r=n[1],N=n[2];return C*C+r*r+N*N},R.normalize=function(H,n){var C=H.elements,r=n.elements,N=C[0],Q=C[1],I=C[2],A=N*N+Q*Q+I*I;0<A&&(A=1/Math.sqrt(A),r[0]=C[0]*A,r[1]=C[1]*A,r[2]=C[2]*A)},R.multiply=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]*Q[0],r[1]=N[1]*Q[1],r[2]=N[2]*Q[2]},R.scale=function(H,n,C){var r=C.elements,N=H.elements;r[0]=N[0]*n,r[1]=N[1]*n,r[2]=N[2]*n},R.lerp=function(H,n,C,r){var N=r.elements,Q=H.elements,I=n.elements,A=Q[0],P=Q[1],t=Q[2];N[0]=A+C*(I[0]-A),N[1]=P+C*(I[1]-P),N[2]=t+C*(I[2]-t)},R.transformV3ToV3=function(H,n,C){var r=R._tempVector4;R.transformV3ToV4(H,n,r);var N=r.elements,Q=C.elements;Q[0]=N[0],Q[1]=N[1],Q[2]=N[2]},R.transformV3ToV4=function(H,n,C){var r=H.elements,N=r[0],Q=r[1],I=r[2],A=n.elements,P=C.elements;P[0]=N*A[0]+Q*A[4]+I*A[8]+A[12],P[1]=N*A[1]+Q*A[5]+I*A[9]+A[13],P[2]=N*A[2]+Q*A[6]+I*A[10]+A[14],P[3]=N*A[3]+Q*A[7]+I*A[11]+A[15]},R.TransformNormal=function(H,n,C){var r=H.elements,N=r[0],Q=r[1],I=r[2],A=n.elements,P=C.elements;P[0]=N*A[0]+Q*A[4]+I*A[8],P[1]=N*A[1]+Q*A[5]+I*A[9],P[2]=N*A[2]+Q*A[6]+I*A[10]},R.transformCoordinate=function(H,n,C){var r=R._tempVector4.elements,N=H.elements,Q=N[0],I=N[1],A=N[2],P=n.elements;r[0]=Q*P[0]+I*P[4]+A*P[8]+P[12],r[1]=Q*P[1]+I*P[5]+A*P[9]+P[13],r[2]=Q*P[2]+I*P[6]+A*P[10]+P[14],r[3]=1/(Q*P[3]+I*P[7]+A*P[11]+P[15]);var t=C.elements;t[0]=r[0]*r[3],t[1]=r[1]*r[3],t[2]=r[2]*r[3]},R.Clamp=function(H,n,C,r){var N=H.elements,Q=N[0],I=N[1],A=N[2],P=n.elements,t=P[0],R=P[1],y=P[2],o=C.elements,g=o[0],M=o[1],j=o[2],l=r.elements;Q=(Q=g<Q?g:Q)<t?t:Q,I=(I=M<I?M:I)<R?R:I,A=(A=j<A?j:A)<y?y:A,l[0]=Q,l[1]=I,l[2]=A},R.add=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]+Q[0],r[1]=N[1]+Q[1],r[2]=N[2]+Q[2]},R.subtract=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]-Q[0],r[1]=N[1]-Q[1],r[2]=N[2]-Q[2]},R.cross=function(H,n,C){var r=H.elements,N=n.elements,Q=C.elements,I=r[0],A=r[1],P=r[2],t=N[0],R=N[1],y=N[2];Q[0]=A*y-P*R,Q[1]=P*t-I*y,Q[2]=I*R-A*t},R.dot=function(H,n){var C=H.elements,r=n.elements;return C[0]*r[0]+C[1]*r[1]+C[2]*r[2]},R.equals=function(H,n){var C=H.elements,r=n.elements;return BH.nearEqual(Math.abs(C[0]),Math.abs(r[0]))&&BH.nearEqual(Math.abs(C[1]),Math.abs(r[1]))&&BH.nearEqual(Math.abs(C[2]),Math.abs(r[2]))},R.ZERO=new R(0,0,0),R.ONE=new R(1,1,1),R.NegativeUnitX=new R(-1,0,0),R.UnitX=new R(1,0,0),R.UnitY=new R(0,1,0),R.UnitZ=new R(0,0,1),R.ForwardRH=new R(0,0,-1),R.ForwardLH=new R(0,0,1),R.Up=new R(0,1,0),R.NAN=new R(NaN,NaN,NaN),y(R,["_tempVector4",function(){return this._tempVector4=new tn}]),R}(),tn=function(){function H(H,n,C,r){this.elements=new Float32Array(4),void 0===H&&(H=0),void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=0);var N=this.elements;N[0]=H,N[1]=n,N[2]=C,N[3]=r}g(H,"laya.d3.math.Vector4");var n=H.prototype;return z.imps(n,{"laya.d3.core.IClone":!0}),n.fromArray=function(H,n){void 0===n&&(n=0),this.elements[0]=H[n+0],this.elements[1]=H[n+1],this.elements[2]=H[n+2],this.elements[3]=H[n+3]},n.cloneTo=function(H){var n=H.elements,C=this.elements;n[0]=C[0],n[1]=C[1],n[2]=C[2],n[3]=C[3]},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},M(0,n,"x",function(){return this.elements[0]},function(H){this.elements[0]=H}),M(0,n,"y",function(){return this.elements[1]},function(H){this.elements[1]=H}),M(0,n,"z",function(){return this.elements[2]},function(H){this.elements[2]=H}),M(0,n,"w",function(){return this.elements[3]},function(H){this.elements[3]=H}),H.lerp=function(H,n,C,r){var N=r.elements,Q=H.elements,I=n.elements,A=Q[0],P=Q[1],t=Q[2],R=Q[3];N[0]=A+C*(I[0]-A),N[1]=P+C*(I[1]-P),N[2]=t+C*(I[2]-t),N[3]=R+C*(I[3]-R)},H.transformByM4x4=function(H,n,C){var r=H.elements,N=r[0],Q=r[1],I=r[2],A=r[3],P=n.elements,t=C.elements;t[0]=N*P[0]+Q*P[4]+I*P[8]+A*P[12],t[1]=N*P[1]+Q*P[5]+I*P[9]+A*P[13],t[2]=N*P[2]+Q*P[6]+I*P[10]+A*P[14],t[3]=N*P[3]+Q*P[7]+I*P[11]+A*P[15]},H.equals=function(H,n){var C=H.elements,r=n.elements;return BH.nearEqual(Math.abs(C[0]),Math.abs(r[0]))&&BH.nearEqual(Math.abs(C[1]),Math.abs(r[1]))&&BH.nearEqual(Math.abs(C[2]),Math.abs(r[2]))&&BH.nearEqual(Math.abs(C[3]),Math.abs(r[3]))},H.normalize=function(H,n){var C=H.elements,r=n.elements,N=H.length();0<N&&(r[0]=C[0]*N,r[1]=C[1]*N,r[2]=C[2]*N,r[3]=C[3]*N)},H.add=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]+Q[0],r[1]=N[1]+Q[1],r[2]=N[2]+Q[2],r[3]=N[3]+Q[3]},H.subtract=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]-Q[0],r[1]=N[1]-Q[1],r[2]=N[2]-Q[2],r[3]=N[3]-Q[3]},H.multiply=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=N[0]*Q[0],r[1]=N[1]*Q[1],r[2]=N[2]*Q[2],r[3]=N[3]*Q[3]},H.scale=function(H,n,C){var r=C.elements,N=H.elements;r[0]=N[0]*n,r[1]=N[1]*n,r[2]=N[2]*n,r[3]=N[3]*n},H.Clamp=function(H,n,C,r){var N=H.elements,Q=N[0],I=N[1],A=N[2],P=N[3],t=n.elements,R=t[0],y=t[1],o=t[2],g=t[3],M=C.elements,j=M[0],l=M[1],f=M[2],c=M[3],K=r.elements;Q=(Q=j<Q?j:Q)<R?R:Q,I=(I=l<I?l:I)<y?y:I,A=(A=f<A?f:A)<o?o:A,P=(P=c<P?c:P)<g?g:P,K[0]=Q,K[1]=I,K[2]=A,K[3]=P},H.distanceSquared=function(H,n){var C=H.elements,r=n.elements,N=C[0]-r[0],Q=C[1]-r[1],I=C[2]-r[2],A=C[3]-r[3];return N*N+Q*Q+I*I+A*A},H.distance=function(H,n){var C=H.elements,r=n.elements,N=C[0]-r[0],Q=C[1]-r[1],I=C[2]-r[2],A=C[3]-r[3];return Math.sqrt(N*N+Q*Q+I*I+A*A)},H.dot=function(H,n){var C=H.elements,r=n.elements;return C[0]*r[0]+C[1]*r[1]+C[2]*r[2]+C[3]*r[3]},H.min=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=Math.min(N[0],Q[0]),r[1]=Math.min(N[1],Q[1]),r[2]=Math.min(N[2],Q[2]),r[3]=Math.min(N[3],Q[3])},H.max=function(H,n,C){var r=C.elements,N=H.elements,Q=n.elements;r[0]=Math.max(N[0],Q[0]),r[1]=Math.max(N[1],Q[1]),r[2]=Math.max(N[2],Q[2]),r[3]=Math.max(N[3],Q[3])},y(H,["ZERO",function(){return this.ZERO=new H},"ONE",function(){return this.ONE=new H(1,1,1,1)},"UnitX",function(){return this.UnitX=new H(1,0,0,0)},"UnitY",function(){return this.UnitY=new H(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new H(0,0,1,0)},"UnitW",function(){return this.UnitW=new H(0,0,0,1)}]),H}(),Rn=function(){function Q(H,n,C,r){this.minDepth=0,this.maxDepth=1,this.x=H,this.y=n,this.width=C,this.height=r}g(Q,"laya.d3.math.Viewport");var H=Q.prototype;return H.project=function(H,n,C){Pn.transformV3ToV3(H,n,C);var r=H.elements,N=n.elements,Q=C.elements,I=r[0]*N[3]+r[1]*N[7]+r[2]*N[11]+N[15];1!==I&&(Q[0]=Q[0]/I,Q[1]=Q[1]/I,Q[2]=Q[2]/I),Q[0]=.5*(Q[0]+1)*this.width+this.x,Q[1]=.5*(1-Q[1])*this.height+this.y,Q[2]=Q[2]*(this.maxDepth-this.minDepth)+this.minDepth},H.unprojectFromMat=function(H,n,C){var r=H.elements,N=n.elements,Q=C.elements;Q[0]=(r[0]-this.x)/this.width*2-1,Q[1]=-((r[1]-this.y)/this.height*2-1);var I=(this.maxDepth-this.minDepth)/2;Q[2]=(r[2]-this.minDepth-I)/I;var A=Q[0]*N[3]+Q[1]*N[7]+Q[2]*N[11]+N[15];Pn.transformV3ToV3(C,n,C),1!==A&&(Q[0]=Q[0]/A,Q[1]=Q[1]/A,Q[2]=Q[2]/A)},H.unprojectFromWVP=function(H,n,C,r,N){nn.multiply(n,C,Q._tempMatrix4x4),r&&nn.multiply(Q._tempMatrix4x4,r,Q._tempMatrix4x4),Q._tempMatrix4x4.invert(Q._tempMatrix4x4),this.unprojectFromMat(H,Q._tempMatrix4x4,N)},y(Q,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new nn}]),Q}(),yn=function(){function L(H){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=H,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}g(L,"laya.d3.resource.models.SubMesh");var H=L.prototype;return z.imps(H,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),H._getVertexBuffer=function(H){return void 0===H&&(H=0),0===H?this._vertexBuffer:null},H._getIndexBuffer=function(){return this._indexBuffer},H._getStaticBatchBakedVertexs=function(H,n){var C,r,N=this._vertexBuffer,Q=N.vertexDeclaration,I=Q.getVertexElementByUsage(0).offset/4,A=Q.getVertexElementByUsage(3).offset/4,P=n.meshRender.lightmapScaleOffset,t=0,R=0,y=0,o=0,g=0,M=0;if(P)if(r=Q.getVertexElementByUsage(15))y=Q.vertexStride/4,C=0<this._vertexCount?N.getData().slice(this._vertexStart*y,(this._vertexStart+this._vertexCount)*y):N.getData().slice(),o=r.offset/4;else{y=(M=Q.vertexStride/4)+2,C=this._vertexCount?new Float32Array(this._vertexCount*(N.vertexDeclaration.vertexStride/4+2)):new Float32Array(N.vertexCount*(N.vertexDeclaration.vertexStride/4+2)),o=(g=Q.getVertexElementByUsage(2).offset/4)+2;var j=N.getData();for(t=0,R=j.length/M;t<R;t++){var l=0;l=0<this._vertexCount?(this._vertexStart+t)*M:t*M;var f=t*y,c=0;for(c=0;c<o;c++)C[f+c]=j[l+c];for(c=o;c<M;c++)C[f+c+2]=j[l+c]}}else y=Q.vertexStride/4,C=this._vertexCount?N.getData().slice(this._vertexStart*y,(this._vertexStart+this._vertexCount)*y):N.getData().slice();if(H){var K=H.worldMatrix,W=L._tempMatrix4x40;K.invert(W);var z=L._tempMatrix4x41,w=n.transform.worldMatrix;nn.multiply(W,w,z)}else z=n.transform.worldMatrix;var F=L._tempQuaternion0;for(z.decomposeTransRotScale(L._tempVector30,F,L._tempVector31),t=0,R=C.length/y;t<R;t++){var k=t*y+I,i=t*y+A;if(Kn.transformVector3ArrayToVector3ArrayCoordinate(C,k,z,C,k),Kn.transformVector3ArrayByQuat(C,i,F,C,i),P){var a=t*y+o;if(r)Kn.transformLightingMapTexcoordByUV1Array(C,a,P,C,a);else{var D=t*M+g;Kn.transformLightingMapTexcoordByUV0Array(j,D,P,C,a)}}}return C},H._getVertexBuffers=function(){return null},H._beforeRender=function(H){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},H._render=function(H){var n,C=0,r=H.renderElement;if(1<this._indexCount){var N=this._boneIndicesList.length;if(1<N){for(var Q=0;Q<N;Q++)(n=r._skinAnimationDatas||this._skinAnimationDatas)&&(r._shaderValue.setValue(0,n[Q]),H._shader.uploadRenderElementUniforms(r._shaderValue.data)),b.mainContext.drawElements(4,this._subIndexBufferCount[Q],5123,2*this._subIndexBufferStart[Q]);k.drawCall+=N}else(n=r._skinAnimationDatas||this._skinAnimationDatas)&&(r._shaderValue.setValue(0,n[0]),H._shader.uploadRenderElementUniforms(r._shaderValue.data)),b.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),k.drawCall++;C=this._indexCount}else C=this._indexBuffer.indexCount,(n=r._skinAnimationDatas||this._skinAnimationDatas)&&(r._shaderValue.setValue(0,n[0]),H._shader.uploadRenderElementUniforms(r._shaderValue.data)),b.mainContext.drawElements(4,C,5123,0),k.drawCall++;k.trianglesFaces+=C/3},H.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},H.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},M(0,H,"_vertexBufferCount",function(){return 1}),M(0,H,"triangleCount",function(){return this._indexBuffer.indexCount/3}),y(L,["_tempVector30",function(){return this._tempVector30=new Pn},"_tempVector31",function(){return this._tempVector31=new Pn},"_tempQuaternion0",function(){return this._tempQuaternion0=new Nn},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new nn},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new nn}]),L}(),on=function(){function H(H){this.defineCounter=0,this.defines=null,H?(this.defineCounter=H.defineCounter,this.defines=H.defines.slice()):(this.defineCounter=0,this.defines=[])}return g(H,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),H.prototype.registerDefine=function(H){var n=Math.pow(2,this.defineCounter++);return this.defines[n]=H,n},H}(),gn=function(){function H(){}return g(H,"laya.d3.shader.ShaderInit3D"),H.__init__=function(){var H,n;Ln._globalRegDefine("HIGHPRECISION",Ln.SHADERDEFINE_HIGHPRECISION),Ln._globalRegDefine("FOG",Ln.SHADERDEFINE_FOG),Ln._globalRegDefine("DIRECTIONLIGHT",Ln.SHADERDEFINE_DIRECTIONLIGHT),Ln._globalRegDefine("POINTLIGHT",Ln.SHADERDEFINE_POINTLIGHT),Ln._globalRegDefine("SPOTLIGHT",Ln.SHADERDEFINE_SPOTLIGHT),Ln._globalRegDefine("UV",Ln.SHADERDEFINE_UV0),Ln._globalRegDefine("COLOR",Ln.SHADERDEFINE_COLOR),Ln._globalRegDefine("UV1",Ln.SHADERDEFINE_UV1),Ln._globalRegDefine("CASTSHADOW",jn.SHADERDEFINE_CAST_SHADOW),Ln._globalRegDefine("SHADOWMAP_PSSM1",jn.SHADERDEFINE_SHADOW_PSSM1),Ln._globalRegDefine("SHADOWMAP_PSSM2",jn.SHADERDEFINE_SHADOW_PSSM2),Ln._globalRegDefine("SHADOWMAP_PSSM3",jn.SHADERDEFINE_SHADOW_PSSM3),Ln._globalRegDefine("SHADOWMAP_PCF_NO",jn.SHADERDEFINE_SHADOW_PCF_NO),Ln._globalRegDefine("SHADOWMAP_PCF1",jn.SHADERDEFINE_SHADOW_PCF1),Ln._globalRegDefine("SHADOWMAP_PCF2",jn.SHADERDEFINE_SHADOW_PCF2),Ln._globalRegDefine("SHADOWMAP_PCF3",jn.SHADERDEFINE_SHADOW_PCF3),Ln._globalRegDefine("DEPTHFOG",Ln.SAHDERDEFINE_DEPTHFOG),$n.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$n.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),H={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},n={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var C=$n.nameKey.add("SIMPLE");var r=Ln.add(C,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',H,n);xn.SHADERDEFINE_DIFFUSEMAP=r.registerMaterialDefine("DIFFUSEMAP"),xn.SHADERDEFINE_NORMALMAP=r.registerMaterialDefine("NORMALMAP"),xn.SHADERDEFINE_SPECULARMAP=r.registerMaterialDefine("SPECULARMAP"),xn.SHADERDEFINE_EMISSIVEMAP=r.registerMaterialDefine("EMISSIVEMAP"),xn.SHADERDEFINE_AMBIENTMAP=r.registerMaterialDefine("AMBIENTMAP"),xn.SHADERDEFINE_REFLECTMAP=r.registerMaterialDefine("REFLECTMAP"),xn.SHADERDEFINE_UVTRANSFORM=r.registerMaterialDefine("UVTRANSFORM"),xn.SHADERDEFINE_TILINGOFFSET=r.registerMaterialDefine("TILINGOFFSET"),xn.SHADERDEFINE_ADDTIVEFOG=r.registerMaterialDefine("ADDTIVEFOG")},H}(),Mn=function(){function H(){this._data=null,this._data=[]}g(H,"laya.d3.shader.ValusArray");var n=H.prototype;return n.setValue=function(H,n){this._data[H]=n},M(0,n,"data",function(){return this._data}),H}(),jn=function(){function H(){}return H.SHADERDEFINE_RECEIVE_SHADOW=1,H.SHADERDEFINE_CAST_SHADOW=512,H.SHADERDEFINE_SHADOW_PSSM1=1024,H.SHADERDEFINE_SHADOW_PSSM2=2048,H.SHADERDEFINE_SHADOW_PSSM3=4096,H.SHADERDEFINE_SHADOW_PCF_NO=8192,H.SHADERDEFINE_SHADOW_PCF1=16384,H.SHADERDEFINE_SHADOW_PCF2=32768,H.SHADERDEFINE_SHADOW_PCF3=65536,H.MAX_PSSM_COUNT=3,H}(),ln=(function(){function o(){}g(o,"laya.d3.utils.Physics"),o.__init__=function(){o._layerCollsionMatrix.length=31;for(var H=0;H<31;H++){var n=[],C=31-H;n.length=C;for(var r=0;r<C;r++)n[r]=r===C-1;o._layerCollsionMatrix[H]=n}},o.setLayerCollision=function(H,n,C){o._layerCollsionMatrix[H.number][30-n.number]=C},o.getLayerCollision=function(H,n){return o._layerCollsionMatrix[H.number][30-n.number]},o.setColliderCollision=function(H,n,C){C?(delete H._ignoreCollisonMap[n.id],delete n._ignoreCollisonMap[H.id]):(H._ignoreCollisonMap[n.id]=n)._ignoreCollisonMap[H.id]=H},o.getIColliderCollision=function(H,n){return!!H._ignoreCollisonMap[n.id]},o.rayCast=function(H,n,C,r){void 0===C&&(C=179e306),void 0===r&&(r=0),o._outHitAllInfo.length=0;for(var N=e.getLayerByNumber(r)._colliders,Q=0,I=N.length;Q<I;Q++){var A=N[Q];if(A.enable&&(A.raycast(H,o._outHitInfo,C),-1!==o._outHitInfo.distance&&o._outHitInfo.distance<=C)){var P=new fn;o._outHitInfo.cloneTo(P),o._outHitAllInfo.push(P)}}if(0==o._outHitAllInfo.length)return n.sprite3D=null,void(n.distance=-1);for(var t=Number.MAX_VALUE,R=0,y=0;y<o._outHitAllInfo.length;y++)o._outHitAllInfo[y].distance<t&&(t=o._outHitAllInfo[y].distance,R=y);o._outHitAllInfo[R].cloneTo(n)},o.rayCastAll=function(H,n,C,r){void 0===C&&(C=179e306),void 0===r&&(r=0),n.length=0;for(var N=e.getLayerByNumber(r)._colliders,Q=0,I=N.length;Q<I;Q++){var A=N[Q];if(A.enable&&(o._outHitInfo.distance=-1,o._outHitInfo.sprite3D=null,A.raycast(H,o._outHitInfo,C),-1!==o._outHitInfo.distance&&o._outHitInfo.distance<=C)){var P=new fn;o._outHitInfo.cloneTo(P),n.push(P)}}},o._outHitAllInfo=[],o._layerCollsionMatrix=[],y(o,["_outHitInfo",function(){return this._outHitInfo=new fn},"collisionManager",function(){return this.collisionManager=new CollisionManager},"gravity",function(){return this.gravity=new Pn(0,-9.81,0)}])}(),function(){function G(){}return g(G,"laya.d3.utils.Picker"),G.calculateCursorRay=function(H,n,C,r,N,Q){var I=H.elements[0],A=H.elements[1],P=G._tempVector30,t=P.elements;t[0]=I,t[1]=A,t[2]=n.minDepth;var R=G._tempVector31,y=R.elements;y[0]=I,y[1]=A,y[2]=n.maxDepth;var o=Q.origin,g=G._tempVector32;n.unprojectFromWVP(P,C,r,N,o),n.unprojectFromWVP(R,C,r,N,g);var M=Q.direction.elements;M[0]=g.x-o.x,M[1]=g.y-o.y,M[2]=g.z-o.z,Pn.normalize(Q.direction,Q.direction)},G.rayIntersectsPositionsAndIndices=function(H,n,C,r,N){for(var Q=C.vertexStride/4,I=C.getVertexElementByUsage(0).offset/4,A=Number.MAX_VALUE,P=-1,t=-1,R=-1,y=0;y<r.length;y+=3){var o=G._tempVector35,g=o.elements,M=r[y]*Q,j=M+I;g[0]=n[j],g[1]=n[1+j],g[2]=n[2+j];var l=G._tempVector36,f=l.elements,c=r[y+1]*Q,K=c+I;f[0]=n[K],f[1]=n[1+K],f[2]=n[2+K];var W=G._tempVector37,z=W.elements,w=r[y+2]*Q,F=w+I;z[0]=n[F],z[1]=n[1+F],z[2]=n[2+F];var k=laya.d3.utils.Picker.rayIntersectsTriangle(H,o,l,W);!isNaN(k)&&k<A&&(A=k,P=M,t=c,R=w)}if(A===Number.MAX_VALUE)return N.position.toDefault(),N.distance=Number.MAX_VALUE,N.trianglePositions[0].toDefault(),N.trianglePositions[1].toDefault(),N.trianglePositions[2].toDefault(),N.triangleNormals[0].toDefault(),N.triangleNormals[1].toDefault(),N.triangleNormals[2].toDefault(),!1;N.distance=A,Pn.scale(H.direction,A,N.position),Pn.add(H.origin,N.position,N.position);var i=N.trianglePositions,a=i[0],D=i[1],L=i[2],b=a.elements,h=D.elements,v=L.elements,e=P+I;b[0]=n[e],b[1]=n[e+1],b[2]=n[e+2];var Z=t+I;h[0]=n[Z],h[1]=n[Z+1],h[2]=n[Z+2];var q=R+I;v[0]=n[q],v[1]=n[q+1],v[2]=n[q+2];var p=C.getVertexElementByUsage(3);if(p){var m=p.offset/4,d=N.triangleNormals,_=d[0],U=d[1],s=d[2],$=_.elements,x=U.elements,O=s.elements,S=P+m;$[0]=n[S],$[1]=n[S+1],$[2]=n[S+2];var T=t+m;x[0]=n[T],x[1]=n[T+1],x[2]=n[T+2];var E=R+m;O[0]=n[E],O[1]=n[E+1],O[2]=n[E+2]}return!0},G.rayIntersectsTriangle=function(H,n,C,r){var N=G._tempVector30,Q=G._tempVector31;Pn.subtract(C,n,N),Pn.subtract(r,n,Q);var I,A=G._tempVector32;if(Pn.cross(H.direction,Q,A),(I=Pn.dot(N,A))>-Number.MIN_VALUE&&I<Number.MIN_VALUE)return Number.NaN;var P,t=1/I,R=G._tempVector33;if(Pn.subtract(H.origin,n,R),P=Pn.dot(R,A),(P*=t)<0||1<P)return Number.NaN;var y,o,g=G._tempVector34;return Pn.cross(R,N,g),y=Pn.dot(H.direction,g),(y*=t)<0||1<P+y?Number.NaN:(o=Pn.dot(Q,g),(o*=t)<0?Number.NaN:o)},y(G,["_tempVector30",function(){return this._tempVector30=new Pn},"_tempVector31",function(){return this._tempVector31=new Pn},"_tempVector32",function(){return this._tempVector32=new Pn},"_tempVector33",function(){return this._tempVector33=new Pn},"_tempVector34",function(){return this._tempVector34=new Pn},"_tempVector35",function(){return this._tempVector35=new Pn},"_tempVector36",function(){return this._tempVector36=new Pn},"_tempVector37",function(){return this._tempVector37=new Pn}]),G}()),fn=function(){function H(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new Pn,new Pn,new Pn],this.trianglePositions.length=3,this.triangleNormals=[new Pn,new Pn,new Pn],this.triangleNormals.length=3,this.position=new Pn}return g(H,"laya.d3.utils.RaycastHit"),H.prototype.cloneTo=function(H){H.distance=this.distance,this.trianglePositions[0].cloneTo(H.trianglePositions[0]),this.trianglePositions[1].cloneTo(H.trianglePositions[1]),this.trianglePositions[2].cloneTo(H.trianglePositions[2]),this.triangleNormals[0].cloneTo(H.triangleNormals[0]),this.triangleNormals[1].cloneTo(H.triangleNormals[1]),this.triangleNormals[2].cloneTo(H.triangleNormals[2]),this.position.cloneTo(H.position),H.sprite3D=this.sprite3D},H}(),cn=function(){function H(H,n){this._width=0,this._height=0,this._width=H,this._height=n}g(H,"laya.d3.utils.Size");var n=H.prototype;return M(0,n,"width",function(){return-1===this._width?J.clientWidth:this._width}),M(0,n,"height",function(){return-1===this._height?J.clientHeight:this._height}),M(1,H,"fullScreen",function(){return new H(-1,-1)}),H}(),Kn=function(){function e(){}return g(e,"laya.d3.utils.Utils3D"),e._rotationTransformScaleSkinAnimation=function(H,n,C,r,N,Q,I,A,P,t,R,y){var o,g,M,j,l,f=e._tempArray16_0,c=e._tempArray16_1,K=e._tempArray16_2,W=r+r,z=N+N,w=Q+Q,F=r*W,k=N*W,i=N*z,a=Q*W,D=Q*z,L=Q*w,b=I*W,h=I*z,v=I*w;for(f[15]=1,f[0]=1-i-L,f[1]=k+v,f[2]=a-h,f[4]=k-v,f[5]=1-F-L,f[6]=D+b,f[8]=a+h,f[9]=D-b,f[10]=1-F-i,c[15]=1,c[0]=A,c[5]=P,c[10]=t,o=0;o<4;o++)g=f[o],M=f[o+4],j=f[o+8],l=f[o+12],K[o]=g,K[o+4]=M,K[o+8]=j,K[o+12]=g*H+M*n+j*C+l;for(o=0;o<4;o++)g=K[o],M=K[o+4],j=K[o+8],l=K[o+12],R[o+y]=g*c[0]+M*c[1]+j*c[2]+l*c[3],R[o+y+4]=g*c[4]+M*c[5]+j*c[6]+l*c[7],R[o+y+8]=g*c[8]+M*c[9]+j*c[10]+l*c[11],R[o+y+12]=g*c[12]+M*c[13]+j*c[14]+l*c[15]},e._createNodeByJson=function(H,n,C,r){if(!C)switch(n.type){case"Sprite3D":C=new sn;break;case"MeshSprite3D":C=new HC;break;case"SkinnedMeshSprite3D":C=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":C=new ShuriKenParticle3D;break;case"TrailSprite3D":C=new TrailSprite3D;break;case"Terrain":C=new Terrain;break;case"Camera":C=new Bn;break;case"DirectionLight":C=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var N=n.props;if(N)for(var Q in N)C[Q]=N[Q];var I=n.customProps;I&&(C instanceof laya.d3.core.Sprite3D?(C._parseBaseCustomProps(I),C._parseCustomProps(H,r,I,n),C._parseCustomComponent(H,r,n.components)):C._parseCustomProps(H,r,I,n));var A=n.child;if(A)for(var P=0,t=A.length;P<t;P++){var R=e._createNodeByJson(H,A[P],null,r);C.addChild(R)}return C},e._computeBoneAndAnimationDatasByBindPoseMatrxix=function(H,n,C,r,N,Q){var I,A,P=0,t=0,R=H.length;for(I=0;I<R;P+=H[I].keyframeWidth,t+=16,I++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(n[P+0],n[P+1],n[P+2],n[P+3],n[P+4],n[P+5],n[P+6],n[P+7],n[P+8],n[P+9],r,t),0!=I&&(A=16*H[I].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(r,A,r,t,r,t));var y=C.length;for(I=0;I<y;I++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(r,16*Q[I],C[I],N,16*I)},e._computeAnimationDatasByArrayAndMatrixFast=function(H,n,C,r){for(var N=0,Q=H.length;N<Q;N++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*r[N],H[N],C,16*N)},e._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(H,n,C,r,N){var Q,I,A=0,P=0,t=H.length;for(Q=0;Q<t;A+=H[Q].keyframeWidth,P+=16,Q++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(n[A+7],n[A+8],n[A+9],n[A+3],n[A+4],n[A+5],n[A+6],n[A+0],n[A+1],n[A+2],r,P),0!=Q&&(I=16*H[Q].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(r,I,r,P,r,P));var R=C.length;for(Q=0;Q<R;Q++){var y=16*Q;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(r,y,C[Q],N,y)}},e._computeAnimationDatasByArrayAndMatrixFastOld=function(H,n,C){for(var r=H.length,N=0;N<r;N++){var Q=16*N;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,Q,H[N],C,Q)}},e._computeRootAnimationData=function(H,n,C){for(var r=0,N=0,Q=0,I=H.length;r<I;N+=H[r].keyframeWidth,Q+=16,r++)laya.d3.utils.Utils3D.createAffineTransformationArray(n[N+0],n[N+1],n[N+2],n[N+3],n[N+4],n[N+5],n[N+6],n[N+7],n[N+8],n[N+9],C,Q)},e.transformVector3ArrayByQuat=function(H,n,C,r,N){var Q=C.elements,I=H[n],A=H[n+1],P=H[n+2],t=Q[0],R=Q[1],y=Q[2],o=Q[3],g=o*I+R*P-y*A,M=o*A+y*I-t*P,j=o*P+t*A-R*I,l=-t*I-R*A-y*P;r[N]=g*o+l*-t+M*-y-j*-R,r[N+1]=M*o+l*-R+j*-t-g*-y,r[N+2]=j*o+l*-y+g*-R-M*-t},e.mulMatrixByArray=function(H,n,C,r,N,Q){var I,A,P,t,R;if(N===C){for(C=e._tempArray16_3,I=0;I<16;++I)C[I]=N[Q+I];r=0}for(I=0;I<4;I++)A=H[n+I],P=H[n+I+4],t=H[n+I+8],R=H[n+I+12],N[Q+I]=A*C[r+0]+P*C[r+1]+t*C[r+2]+R*C[r+3],N[Q+I+4]=A*C[r+4]+P*C[r+5]+t*C[r+6]+R*C[r+7],N[Q+I+8]=A*C[r+8]+P*C[r+9]+t*C[r+10]+R*C[r+11],N[Q+I+12]=A*C[r+12]+P*C[r+13]+t*C[r+14]+R*C[r+15]},e.mulMatrixByArrayFast=function(H,n,C,r,N,Q){var I,A,P,t,R;for(I=0;I<4;I++)A=H[n+I],P=H[n+I+4],t=H[n+I+8],R=H[n+I+12],N[Q+I]=A*C[r+0]+P*C[r+1]+t*C[r+2]+R*C[r+3],N[Q+I+4]=A*C[r+4]+P*C[r+5]+t*C[r+6]+R*C[r+7],N[Q+I+8]=A*C[r+8]+P*C[r+9]+t*C[r+10]+R*C[r+11],N[Q+I+12]=A*C[r+12]+P*C[r+13]+t*C[r+14]+R*C[r+15]},e.mulMatrixByArrayAndMatrixFast=function(H,n,C,r,N){var Q,I,A,P,t,R=C.elements,y=R[0],o=R[1],g=R[2],M=R[3],j=R[4],l=R[5],f=R[6],c=R[7],K=R[8],W=R[9],z=R[10],w=R[11],F=R[12],k=R[13],i=R[14],a=R[15],D=n,L=n+4,b=n+8,h=n+12,v=N,e=N+4,Z=N+8,q=N+12;for(Q=0;Q<4;Q++)I=H[D+Q],A=H[L+Q],P=H[b+Q],t=H[h+Q],r[v+Q]=I*y+A*o+P*g+t*M,r[e+Q]=I*j+A*l+P*f+t*c,r[Z+Q]=I*K+A*W+P*z+t*w,r[q+Q]=I*F+A*k+P*i+t*a},e.createAffineTransformationArray=function(H,n,C,r,N,Q,I,A,P,t,R,y){var o=r+r,g=N+N,M=Q+Q,j=r*o,l=r*g,f=r*M,c=N*g,K=N*M,W=Q*M,z=I*o,w=I*g,F=I*M;R[y+0]=(1-(c+W))*A,R[y+1]=(l+F)*A,R[y+2]=(f-w)*A,R[y+3]=0,R[y+4]=(l-F)*P,R[y+5]=(1-(j+W))*P,R[y+6]=(K+z)*P,R[y+7]=0,R[y+8]=(f+w)*t,R[y+9]=(K-z)*t,R[y+10]=(1-(j+c))*t,R[y+11]=0,R[y+12]=H,R[y+13]=n,R[y+14]=C,R[y+15]=1},e.transformVector3ArrayToVector3ArrayCoordinate=function(H,n,C,r,N){var Q=e._tempArray4_0,I=H[n+0],A=H[n+1],P=H[n+2],t=C.elements;Q[0]=I*t[0]+A*t[4]+P*t[8]+t[12],Q[1]=I*t[1]+A*t[5]+P*t[9]+t[13],Q[2]=I*t[2]+A*t[6]+P*t[10]+t[14],Q[3]=1/(I*t[3]+A*t[7]+P*t[11]+t[15]),r[N+0]=Q[0]*Q[3],r[N+1]=Q[1]*Q[3],r[N+2]=Q[2]*Q[3]},e.transformLightingMapTexcoordByUV0Array=function(H,n,C,r,N){var Q=C.elements;r[N+0]=H[n+0]*Q[0]+Q[2],r[N+1]=(H[n+1]-1)*Q[1]+Q[3]},e.transformLightingMapTexcoordByUV1Array=function(H,n,C,r,N){var Q=C.elements;r[N+0]=H[n+0]*Q[0]+Q[2],r[N+1]=1+H[n+1]*Q[1]+Q[3]},e.getURLVerion=function(H){var n=H.indexOf("?");return 0<=n?H.substr(n):null},e._quaternionCreateFromYawPitchRollArray=function(H,n,C,r){var N=.5*C,Q=.5*n,I=.5*H,A=Math.sin(N),P=Math.cos(N),t=Math.sin(Q),R=Math.cos(Q),y=Math.sin(I),o=Math.cos(I);r[0]=o*t*P+y*R*A,r[1]=y*R*P-o*t*A,r[2]=o*R*A-y*t*P,r[3]=o*R*P+y*t*A},e._createAffineTransformationArray=function(H,n,C,r){var N=n[0],Q=n[1],I=n[2],A=n[3],P=N+N,t=Q+Q,R=I+I,y=N*P,o=N*t,g=N*R,M=Q*t,j=Q*R,l=I*R,f=A*P,c=A*t,K=A*R,W=C[0],z=C[1],w=C[2];r[0]=(1-(M+l))*W,r[1]=(o+K)*W,r[2]=(g-c)*W,r[3]=0,r[4]=(o-K)*z,r[5]=(1-(y+l))*z,r[6]=(j+f)*z,r[7]=0,r[8]=(g+c)*w,r[9]=(j-f)*w,r[10]=(1-(y+M))*w,r[11]=0,r[12]=H[0],r[13]=H[1],r[14]=H[2],r[15]=1},e._mulMatrixArray=function(H,n,C,r){var N,Q,I,A,P,t=n.elements,R=t[0],y=t[1],o=t[2],g=t[3],M=t[4],j=t[5],l=t[6],f=t[7],c=t[8],K=t[9],W=t[10],z=t[11],w=t[12],F=t[13],k=t[14],i=t[15],a=r,D=r+4,L=r+8,b=r+12;for(N=0;N<4;N++)Q=H[N],I=H[N+4],A=H[N+8],P=H[N+12],C[a+N]=Q*R+I*y+A*o+P*g,C[D+N]=Q*M+I*j+A*l+P*f,C[L+N]=Q*c+I*K+A*W+P*z,C[b+N]=Q*w+I*F+A*k+P*i},e.getYawPitchRoll=function(H,n){e.transformQuat(Pn.ForwardRH,H,Nn.TEMPVector31),e.transformQuat(Pn.Up,H,Nn.TEMPVector32);var C=Nn.TEMPVector32.elements;e.angleTo(Pn.ZERO,Nn.TEMPVector31,Nn.TEMPVector33);var r=Nn.TEMPVector33.elements;r[0]==Math.PI/2?(r[1]=e.arcTanAngle(C[2],C[0]),r[2]=0):r[0]==-Math.PI/2?(r[1]=e.arcTanAngle(-C[2],-C[0]),r[2]=0):(nn.createRotationY(-r[1],Nn.TEMPMatrix0),nn.createRotationX(-r[0],Nn.TEMPMatrix1),Pn.transformCoordinate(Nn.TEMPVector32,Nn.TEMPMatrix0,Nn.TEMPVector32),Pn.transformCoordinate(Nn.TEMPVector32,Nn.TEMPMatrix1,Nn.TEMPVector32),r[2]=e.arcTanAngle(C[1],-C[0])),r[1]<=-Math.PI&&(r[1]=Math.PI),r[2]<=-Math.PI&&(r[2]=Math.PI),r[1]>=Math.PI&&r[2]>=Math.PI&&(r[1]=0,r[2]=0,r[0]=Math.PI-r[0]),n[0]=r[1],n[1]=r[0],n[2]=r[2]},e.arcTanAngle=function(H,n){return 0==H?1==n?Math.PI/2:-Math.PI/2:0<H?Math.atan(n/H):H<0?0<n?Math.atan(n/H)+Math.PI:Math.atan(n/H)-Math.PI:0},e.angleTo=function(H,n,C){Pn.subtract(n,H,Nn.TEMPVector30),Pn.normalize(Nn.TEMPVector30,Nn.TEMPVector30),C.elements[0]=Math.asin(Nn.TEMPVector30.y),C.elements[1]=e.arcTanAngle(-Nn.TEMPVector30.z,-Nn.TEMPVector30.x)},e.transformQuat=function(H,n,C){var r=C.elements,N=H.elements,Q=n,I=N[0],A=N[1],P=N[2],t=Q[0],R=Q[1],y=Q[2],o=Q[3],g=o*I+R*P-y*A,M=o*A+y*I-t*P,j=o*P+t*A-R*I,l=-t*I-R*A-y*P;r[0]=g*o+l*-t+M*-y-j*-R,r[1]=M*o+l*-R+j*-t-g*-y,r[2]=j*o+l*-y+g*-R-M*-t},e.quaterionNormalize=function(H,n){var C=H[0],r=H[1],N=H[2],Q=H[3],I=C*C+r*r+N*N+Q*Q;0<I&&(I=1/Math.sqrt(I),n[0]=C*I,n[1]=r*I,n[2]=N*I,n[3]=Q*I)},e.matrix4x4MultiplyFFF=function(H,n,C){var r,N,Q,I,A;if(C===n)for(n=new Float32Array(16),r=0;r<16;++r)n[r]=C[r];for(r=0;r<4;r++)N=H[r],Q=H[r+4],I=H[r+8],A=H[r+12],C[r]=N*n[0]+Q*n[1]+I*n[2]+A*n[3],C[r+4]=N*n[4]+Q*n[5]+I*n[6]+A*n[7],C[r+8]=N*n[8]+Q*n[9]+I*n[10]+A*n[11],C[r+12]=N*n[12]+Q*n[13]+I*n[14]+A*n[15]},e.matrix4x4MultiplyMFM=function(H,n,C){e.matrix4x4MultiplyFFF(H.elements,n,C.elements)},y(e,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new Pn},"_tempVector3_1",function(){return this._tempVector3_1=new Pn},"_tempVector3_2",function(){return this._tempVector3_2=new Pn},"_tempVector3_3",function(){return this._tempVector3_3=new Pn},"_tempVector3_4",function(){return this._tempVector3_4=new Pn},"_tempVector3_5",function(){return this._tempVector3_5=new Pn},"_tempVector3_6",function(){return this._tempVector3_6=new Pn},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),e}(),Wn=function(){function h(){}return g(h,"Laya3D"),h._cancelLoadByUrl=function(H){z.loader.cancelLoadByUrl(H),h._innerFirstLevelLoaderManager.cancelLoadByUrl(H),h._innerSecondLevelLoaderManager.cancelLoadByUrl(H),h._innerThirdLevelLoaderManager.cancelLoadByUrl(H),h._innerFourthLevelLoaderManager.cancelLoadByUrl(H)},h._changeWebGLSize=function(H,n){b.onStageResize(H,n),J.clientWidth=H,J.clientHeight=n},h.__init__=function(){var H=n.createMap;H.lh=[sn,"SPRITE3DHIERARCHY"],H.ls=[Un,"SPRITE3DHIERARCHY"],H.lm=[Jn,"MESH"],H.lmat=[xn,"MATERIAL"],H.jpg=[un,"nativeimage"],H.jpeg=[un,"nativeimage"],H.png=[un,"nativeimage"],H.pkm=[un,"arraybuffer"],H.raw=[En,"arraybuffer"],H.mipmaps=[En,"arraybuffer"],f.parserMap.SPRITE3DHIERARCHY=h._loadHierarchy,f.parserMap.MESH=h._loadMesh,f.parserMap.MATERIAL=h._loadMaterial,f.parserMap.TEXTURECUBE=h._loadTextureCube,f.parserMap.TERRAIN=h._loadTerrain,h._innerFirstLevelLoaderManager.on("error",null,h._eventLoadManagerError),h._innerSecondLevelLoaderManager.on("error",null,h._eventLoadManagerError),h._innerThirdLevelLoaderManager.on("error",null,h._eventLoadManagerError),h._innerFourthLevelLoaderManager.on("error",null,h._eventLoadManagerError)},h.READ_BLOCK=function(){return h._readData.pos+=4,!0},h.READ_DATA=function(){return h._DATA.offset=h._readData.getUint32(),h._DATA.size=h._readData.getUint32(),!0},h.READ_STRINGS=function(){var H=[],n={offset:0,size:0};n.offset=h._readData.getUint16(),n.size=h._readData.getUint16();h._readData.pos;h._readData.pos=n.offset+h._DATA.offset;for(var C=0;C<n.size;C++){var r=h._readData.readUTFString();-1===r.lastIndexOf(".lmat")&&-1===r.lastIndexOf(".lpbr")||H.push(r)}return H},h.formatRelativePath=function(H,n){var C;if("."===n.charAt(0)){for(var r=(H+n).split("/"),N=0,Q=r.length;N<Q;N++)if(".."==r[N]){var I=N-1;0<I&&".."!==r[I]&&(r.splice(I,2),N-=2)}C=r.join("/")}else C=H+n;return null!=L.customFormat&&(C=L.customFormat(C,null)),C},h._eventLoadManagerError=function(H){z.loader.event("error",H)},h._addHierarchyInnerUrls=function(H,n,C,r,N,Q){var I=h.formatRelativePath(r,N);C&&(I+=C),H.push({url:I,clas:Q}),n[N]=I},h._getSprite3DHierarchyInnerUrls=function(H,n,C,r,N,Q,I){var A,P=0,t=0;switch(H.type){case"Scene":var R=H.customProps.lightmaps;for(P=0,t=R.length;P<t;P++){var y=R[P].replace(".exr",".png");h._addHierarchyInnerUrls(r,N,Q,I,y,un)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var o;if(H.instanceParams)(o=H.instanceParams.loadPath)&&h._addHierarchyInnerUrls(n,N,Q,I,o,Jn);else{(o=(A=H.customProps).meshPath)&&h._addHierarchyInnerUrls(n,N,Q,I,o,Jn);var g=A.materials;if(g)for(P=0,t=g.length;P<t;P++){for(var M=g[P],j=M.type.split("."),l=v.window,f=0,c=j.length;f<c;++f){l=l[this.clasPaths[f]]}if("function"!=typeof l)throw"_getSprite3DHierarchyInnerUrls 错误: "+M.type+" 不是类";h._addHierarchyInnerUrls(C,N,Q,I,M.path,l)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var K=(A=H.customProps).meshPath;K&&h._addHierarchyInnerUrls(n,N,Q,I,K,Jn);var W=A.material;if(W){j=W.type.split("."),l=v.window;for(f=0,c=j.length;f<c;++f){l=l[this.clasPaths[f]]}h._addHierarchyInnerUrls(C,N,Q,I,W.path,l)}else{var z=A.materialPath;if(z)h._addHierarchyInnerUrls(C,N,Q,I,z,ShurikenParticleMaterial);else{var w=A.texturePath;w&&h._addHierarchyInnerUrls(r,N,Q,I,w,un)}}break;case"Terrain":h._addHierarchyInnerUrls(r,N,Q,I,H.customProps.dataPath,TerrainRes)}var F=H.components;for(var k in F){var i=F[k];switch(k){case"Animator":var a=i.avatarPath;if(a)h._addHierarchyInnerUrls(r,N,Q,I,a,Avatar);else{var D=i.avatar;D&&h._addHierarchyInnerUrls(r,N,Q,I,D.path,Avatar)}var L=i.clipPaths;for(P=0,t=L.length;P<t;P++)h._addHierarchyInnerUrls(r,N,Q,I,L[P],AnimationClip)}}var b=H.child;for(P=0,t=b.length;P<t;P++)h._getSprite3DHierarchyInnerUrls(b[P],n,C,r,N,Q,I)},h._loadHierarchy=function(H){H.on("loaded",null,h._onHierarchylhLoaded,[H,H._class._getGroup()]),H.load(H.url,"json",!1,null,!0)},h._onHierarchylhLoaded=function(H,n,C){if(H._class.destroyed)H.endLoad();else{var r=H.url,N=Kn.getURLVerion(r),Q=L.getPath(r),I=[],A=[],P=[],t={};h._getSprite3DHierarchyInnerUrls(C,I,A,P,t,N,Q);var R=I.length+A.length+P.length,y=R+1,o=1/y;if(h._onProcessChange(H,0,o,1),0<P.length){var g=R/y,M=D.create(null,h._onProcessChange,[H,o,g],!1);h._innerFourthLevelLoaderManager.create(P,D.create(null,h._onHierarchyInnerForthLevResouLoaded,[H,n,M,C,t,I,A,o+g*P.length,g]),M,null,null,1,!0,n)}else h._onHierarchyInnerForthLevResouLoaded(H,n,null,C,t,I,A,o,g)}},h._onHierarchyInnerForthLevResouLoaded=function(H,n,C,r,N,Q,I,A,P){if(H._class.destroyed)H.endLoad();else if(C&&C.recover(),0<I.length){var t=D.create(null,h._onProcessChange,[H,A,P],!1);h._innerSecondLevelLoaderManager.create(I,D.create(null,h._onHierarchyInnerSecondLevResouLoaded,[H,n,t,r,N,Q,A+P*I.length,P]),C,null,null,1,!0,n)}else h._onHierarchyInnerSecondLevResouLoaded(H,n,null,r,N,Q,A,P)},h._onHierarchyInnerSecondLevResouLoaded=function(H,n,C,r,N,Q,I,A){if(H._class.destroyed)H.endLoad();else if(C&&C.recover(),0<Q.length){var P=D.create(null,h._onProcessChange,[H,I,A],!1);h._innerFirstLevelLoaderManager.create(Q,D.create(null,h._onHierarchyInnerFirstLevResouLoaded,[H,P,r,N]),C,null,null,1,!0,n)}else h._onHierarchyInnerFirstLevResouLoaded(H,null,r,N)},h._onHierarchyInnerFirstLevResouLoaded=function(H,n,C,r){n&&n.recover(),H.endLoad([C,r])},h._loadTerrain=function(H){H.on("loaded",null,h._onTerrainLtLoaded,[H,H._class._getGroup()]),H.load(H.url,"json",!1,null,!0)},h._onTerrainLtLoaded=function(H,n,C){if(H._class.destroyed)H.endLoad();else{var r,N,Q=H.url,I=Kn.getURLVerion(Q),A=L.getPath(Q),P=[],t={},R=0,y=0,o=C.heightData;r=o.url,N=h.formatRelativePath(A,r),I&&(N+=I),r=t[r]=N;var g=C.detailTexture;for(R=0,y=g.length;R<y;R++)P.push({url:g[R].diffuse});var M=C.normalMap;for(R=0,y=M.length;R<y;R++)P.push({url:M[R]});var j=C.alphaMap;for(R=0,y=j.length;R<y;R++)P.push({url:j[R],params:[!1,!1,6408,!0]});for(R=0,y=P.length;R<y;R++){var l=P[R].url;N=h.formatRelativePath(A,l),I&&(N+=I),P[R].url=N,t[l]=N}var f=P.length,c=f+2,K=1/c;h._onProcessChange(H,0,K,1);var W={heightMapLoaded:!1,texturesLoaded:!1},z=D.create(null,h._onProcessChange,[H,K,K],!1);h._innerFourthLevelLoaderManager.create(r,D.create(null,h._onTerrainHeightMapLoaded,[H,z,C,t,W]),z,null,[o.numX,o.numZ,o.bitType,o.value],1,!0,n);var w=D.create(null,h._onProcessChange,[H,2*K,f/c],!1);h._innerFourthLevelLoaderManager.create(P,D.create(null,h._onTerrainTexturesLoaded,[H,w,C,t,W]),w,null,null,1,!0,n)}},h._onTerrainHeightMapLoaded=function(H,n,C,r,N){N.heightMapLoaded=!0,N.texturesLoaded&&(H.endLoad([C,r]),n.recover())},h._onTerrainTexturesLoaded=function(H,n,C,r,N){N.texturesLoaded=!0,N.heightMapLoaded&&(H.endLoad([C,r]),n.recover())},h._loadMesh=function(H){H.on("loaded",null,h._onMeshLmLoaded,[H,H._class._getGroup()]),H.load(H.url,"arraybuffer",!1,null,!0)},h._onMeshLmLoaded=function(H,n,C){if(H._class.destroyed)H.endLoad();else{var r,N,Q,I=H.url,A=Kn.getURLVerion(I),P=L.getPath(I),t={},R=0,y=0;switch((h._readData=new w(C)).pos=0,h._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var o=h._readData.getUint32();h._readData.pos=h._readData.pos+4,y=h._readData.getUint16(),h._readData.pos=h._readData.pos+8*y;var g=h._readData.getUint32();for(y=h._readData.getUint16(),h._readData.pos=o+g,r=[],R=0;R<y;R++){var M=h._readData.readUTFString();-1!==M.lastIndexOf(".lmat")&&r.push(M)}break;default:for(h.READ_BLOCK(),R=0;R<2;R++){var j=h._readData.getUint16(),l=h._strings[j],f=h["READ_"+l];if(null==f)throw new Error("model file err,no this function:"+j+" "+l);1===R?r=f.call():f.call()}}for(R=0,Q=r.length;R<Q;R++){var c=r[R];N=h.formatRelativePath(P,c),A&&(N+=A),r[R]=N,t[c]=N}if(0<r.length){h._onProcessChange(H,0,.5,1);var K=D.create(null,h._onProcessChange,[H,.5,.5],!1);h._innerSecondLevelLoaderManager.create(r,D.create(null,h._onMeshMateialLoaded,[H,K,C,t]),K,null,null,1,!0,n)}else H.endLoad([C,t])}},h._onMeshMateialLoaded=function(H,n,C,r){H.endLoad([C,r]),n.recover()},h._getMaterialTexturePath=function(H,n,C){var r=H.length-4;return H.indexOf(".dds")!=r&&H.indexOf(".tga")!=r&&H.indexOf(".exr")!=r&&H.indexOf(".DDS")!=r&&H.indexOf(".TGA")!=r&&H.indexOf(".EXR")!=r||(H=H.substr(0,r)+".png"),H=h.formatRelativePath(C,H),n&&(H+=n),H},h._loadMaterial=function(H){H.on("loaded",null,h._onMaterilLmatLoaded,[H,H._class._getGroup()]),H.load(H.url,"json",!1,null,!0)},h._onMaterilLmatLoaded=function(H,n,C){if(H._class.destroyed)H.endLoad();else{var r,N=H.url,Q=Kn.getURLVerion(N),I=L.getPath(N),A=[],P={},t=C.customProps,R=C.version;if(R)switch(R){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var y=C.props.textures,o=0,g=y.length;o<g;o++){var M=y[o],j=M.path;if(j){var l=j.length-4;j.indexOf(".exr")!=l&&j.indexOf(".EXR")!=l||(j=j.substr(0,l)+".png"),r=h.formatRelativePath(I,j),Q&&(r+=Q),A.push({url:r,params:M.params}),P[j]=r}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var f=t.diffuseTexture.texture2D;if(f&&(r=h._getMaterialTexturePath(f,Q,I),A.push(r),P[f]=r),t.normalTexture){var c=t.normalTexture.texture2D;c&&(r=h._getMaterialTexturePath(c,Q,I),A.push(r),P[c]=r)}if(t.specularTexture){var K=t.specularTexture.texture2D;K&&(r=h._getMaterialTexturePath(K,Q,I),A.push(r),P[K]=r)}if(t.emissiveTexture){var W=t.emissiveTexture.texture2D;W&&(r=h._getMaterialTexturePath(W,Q,I),A.push(r),P[W]=r)}if(t.ambientTexture){var z=t.ambientTexture.texture2D;z&&(r=h._getMaterialTexturePath(z,Q,I),A.push(r),P[z]=r)}if(t.reflectTexture){var w=t.reflectTexture.texture2D;w&&(r=h._getMaterialTexturePath(w,Q,I),A.push(r),P[w]=r)}}var F=A.length,k=F+1,i=1/k;if(h._onProcessChange(H,0,i,1),0<F){var a=D.create(null,h._onProcessChange,[H,i,F/k],!1);h._innerFourthLevelLoaderManager.create(A,D.create(null,h._onMateialTexturesLoaded,[H,a,C,P]),a,un,null,1,!0,n)}else h._onMateialTexturesLoaded(H,null,C,null)}},h._onMateialTexturesLoaded=function(H,n,C,r){H.endLoad([C,r]),n&&n.recover()},h._loadTextureCube=function(H){H.on("loaded",null,h._onTextureCubeLtcLoaded,[H]),H.load(H.url,"json",!1,null,!0)},h._onTextureCubeLtcLoaded=function(H,n){if(H._class.destroyed)H.endLoad();else{var C=L.getPath(H.url),r=[h.formatRelativePath(C,n.px),h.formatRelativePath(C,n.nx),h.formatRelativePath(C,n.py),h.formatRelativePath(C,n.ny),h.formatRelativePath(C,n.pz),h.formatRelativePath(C,n.nz)];h._onProcessChange(H,0,1/7,1);var N=D.create(null,h._onProcessChange,[H,1/7,6/7],!1);h._innerFourthLevelLoaderManager.load(r,D.create(null,h._onTextureCubeImagesLoaded,[H,r,N]),N,"nativeimage")}},h._onTextureCubeImagesLoaded=function(H,n,C){var r=[];r.length=6;for(var N=0;N<6;N++){var Q=n[N];r[N]=f.getRes(Q),f.clearRes(Q)}H.endLoad(r),C.recover()},h._onProcessChange=function(H,n,C,r){(r=n+r*C)<1&&H.event("progress",r)},h.init=function(H,n,C,r,N,Q){if(void 0===C&&(C=!1),void 0===r&&(r=!1),void 0===N&&(N=!0),void 0===Q&&(Q=!0),c.update3DLoop=function(){},c.cancelLoadByUrl=function(H){h._cancelLoadByUrl(H)},t.isAntialias=C,t.isAlpha=r,t.premultipliedAlpha=N,t.isStencil=Q,!b.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");c.changeWebGLSize=h._changeWebGLSize,j.is3DMode=!0,z.init(H,n),e.__init__(),gn.__init__(),HC.__init__(),s.__init__(),h.__init__(),I.maxTextureCount=2,(h.debugMode||Y.debugMode)&&(h._debugPhasorSprite=new T)},h.HIERARCHY="SPRITE3DHIERARCHY",h.MESH="MESH",h.MATERIAL="MATERIAL",h.PBRMATERIAL="PBRMTL",h.TEXTURECUBE="TEXTURECUBE",h.TERRAIN="TERRAIN",h._readData=null,h._debugPhasorSprite=null,h.debugMode=!1,y(h,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new n},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new n},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new n},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new n}]),h}(),zn=function(H){function N(H){N.__super.call(this),this._owner=H,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}g(N,"laya.d3.animation.AnimationTransform3D",Q);var n=N.prototype;return n._getlocalMatrix=function(){return this._localUpdate&&(Kn._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},n._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldTransform()}},n._setWorldMatrixAndUpdate=function(H){if(this._worldMatrix=H,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var n=this._getlocalMatrix(),C=0;C<16;++C)this._worldMatrix[C]=n[C];else Kn.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},n._setWorldMatrixNoUpdate=function(H){this._worldMatrix=H},n._setWorldMatrixIgnoreUpdate=function(H){this._worldMatrix=H,this._worldUpdate=!1},n.getLocalPosition=function(){return this._localPosition},n.setLocalPosition=function(H){if(this._parent)this._localPosition=H,this._localUpdate=!0,this._onWorldTransform();else{var n=this._entity.owner._transform,C=this._entity.localPosition,r=C.elements;r[0]=H[0],r[1]=H[1],r[2]=H[2],n.localPosition=C}},n.getLocalRotation=function(){if(this._localQuaternionUpdate){var H=this._localRotationEuler;Kn._quaternionCreateFromYawPitchRollArray(H[1]/N._angleToRandin,H[0]/N._angleToRandin,H[2]/N._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},n.setLocalRotation=function(H){if(this._parent)this._localRotation=H,Kn.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var n=this._entity.owner._transform,C=this._entity.localRotation,r=C.elements;r[0]=H[0],r[1]=H[1],r[2]=H[2],r[3]=H[3],n.localRotation=C}},n.getLocalScale=function(){return this._localScale},n.setLocalScale=function(H){if(this._parent)this._localScale=H,this._localUpdate=!0,this._onWorldTransform();else{var n=this._entity.owner._transform,C=this._entity.localScale,r=C.elements;r[0]=H[0],r[1]=H[1],r[2]=H[2],n.localScale=C}},n.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){Kn.getYawPitchRoll(this._localRotation,N._tempVector3);var H=N._tempVector3,n=this._localRotationEuler;n[0]=H[1]*N._angleToRandin,n[1]=H[0]*N._angleToRandin,n[2]=H[2]*N._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},n.setLocalRotationEuler=function(H){if(this._parent)Kn._quaternionCreateFromYawPitchRollArray(H[1]/N._angleToRandin,H[0]/N._angleToRandin,H[2]/N._angleToRandin,this._localRotation),this._localRotationEuler=H,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var n=this._entity.owner._transform,C=this._entity.localRotationEuler,r=C.elements;r[0]=H[0],r[1]=H[1],r[2]=H[2],n.localRotationEuler=C}},n.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)Kn.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var H=this._getlocalMatrix(),n=0;n<16;++n)this._worldMatrix[n]=H[n];this._worldUpdate=!1}return this._worldMatrix},n.setParent=function(H){if(this._parent!==H){if(this._parent){var n=this._parent._childs,C=n.indexOf(this);n.splice(C,1)}H&&(H._childs.push(this),H&&this._onWorldTransform()),this._parent=H}},y(N,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),N}(),wn=function(H){function n(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,n.__super.call(this),this._destroyed=!1,this._id=n._uniqueIDCounter,n._uniqueIDCounter++}g(n,"laya.d3.component.Component3D",Q);var C=n.prototype;return z.imps(C,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),C._initialize=function(H){this._owner=H,this._enable=!0,this.started=!1,this._load(H)},C._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},C._load=function(H){},C._start=function(H){},C._update=function(H){},C._lateUpdate=function(H){},C._preRenderUpdate=function(H){},C._postRenderUpdate=function(H){},C._unload=function(H){this.offAll()},C._cloneTo=function(H){},M(0,C,"id",function(){return this._id}),M(0,C,"destroyed",function(){return this._destroyed}),M(0,C,"owner",function(){return this._owner}),M(0,C,"enable",function(){return this._enable},function(H){this._enable!==H&&(this._enable=H,this.event("enablechanged",this._enable))}),M(0,C,"isSingleton",function(){return n._isSingleton}),n._isSingleton=!0,n._uniqueIDCounter=1,n}(),Fn=function(H){function n(){this._destroyed=!1,n.__super.call(this),this._destroyed=!1}g(n,"laya.d3.core.GeometryFilter",Q);var C=n.prototype;return z.imps(C,{"laya.resource.IDestroy":!0}),C._destroy=function(){this.offAll(),this._destroyed=!0},M(0,C,"_isAsyncLoaded",function(){return!0}),M(0,C,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),M(0,C,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),M(0,C,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),M(0,C,"destroyed",function(){return this._destroyed}),n}(),kn=function(H){function r(H){r.__super.call(this),this._id=++r._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new YH(new Pn,new Pn),this._boundingBoxCenter=new Pn,this._boundingSphere=new XH(new Pn,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=H,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}g(r,"laya.d3.core.render.BaseRender",Q);var n=r.prototype;return z.imps(n,{"laya.resource.IDestroy":!0}),n._changeMaterialReference=function(H,n){H&&H._removeReference(),n._addReference()},n._getInstanceMaterial=function(H,n){var C=new H.constructor;return H.cloneTo(C),C.name=C.name+"(Instance)",this._materialsInstance[n]=!0,this._changeMaterialReference(this._materials[n],C),this._materials[n]=C},n._setShaderValuelightMap=function(H){this._setShaderValueTexture(3,H)},n._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},n._renderRenderableBoundBox=function(){var H=Wn._debugPhasorSprite,n=this.boundingBox,C=r._tempBoundBoxCorners;n.getCorners(C),H.line(C[0],r._greenColor,C[1],r._greenColor),H.line(C[2],r._greenColor,C[3],r._greenColor),H.line(C[4],r._greenColor,C[5],r._greenColor),H.line(C[6],r._greenColor,C[7],r._greenColor),H.line(C[0],r._greenColor,C[3],r._greenColor),H.line(C[1],r._greenColor,C[2],r._greenColor),H.line(C[2],r._greenColor,C[6],r._greenColor),H.line(C[3],r._greenColor,C[7],r._greenColor),H.line(C[0],r._greenColor,C[4],r._greenColor),H.line(C[1],r._greenColor,C[5],r._greenColor),H.line(C[4],r._greenColor,C[7],r._greenColor),H.line(C[5],r._greenColor,C[6],r._greenColor)},n._calculateBoundingSphere=function(){throw"BaseRender: must override it."},n._calculateBoundingBox=function(){throw"BaseRender: must override it."},n._setShaderValueTexture=function(H,n){this._owner._shaderValues.setValue(H,n)},n._setShaderValueMatrix4x4=function(H,n){this._owner._shaderValues.setValue(H,n?n.elements:null)},n._setShaderValueColor=function(H,n){this._owner._shaderValues.setValue(H,n?n.elements:null)},n._setShaderValueBuffer=function(H,n){this._owner._shaderValues.setValue(H,n)},n._setShaderValueInt=function(H,n){this._owner._shaderValues.setValue(H,n)},n._setShaderValueBool=function(H,n){this._owner._shaderValues.setValue(H,n)},n._setShaderValueNumber=function(H,n){this._owner._shaderValues.setValue(H,n)},n._setShaderValueVector2=function(H,n){this._owner._shaderValues.setValue(H,n?n.elements:null)},n._addShaderDefine=function(H){this._owner._shaderDefineValue|=H},n._removeShaderDefine=function(H){this._owner._shaderDefineValue&=~H},n._renderUpdate=function(H){return!0},n._applyLightMapParams=function(){if(0<=this._lightmapIndex){var H=this._owner.scene;if(H){var n=H.getlightmaps()[this._lightmapIndex];n?(this._addShaderDefine(Vn.SAHDERDEFINE_LIGHTMAP),n.loaded?this._setShaderValuelightMap(n):n.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(Vn.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(Vn.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(Vn.SAHDERDEFINE_LIGHTMAP)},n._updateOctreeNode=function(){var H=this._treeNode;H&&this._octreeNodeNeedChange&&(H.updateObject(this),this._octreeNodeNeedChange=!1)},n._destroy=function(){this.offAll();var H=0,n=0;for(H=0,n=this._renderElements.length;H<n;H++)this._renderElements[H]._destroy();for(H=0,n=this._materials.length;H<n;H++)this._materials[H]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},M(0,n,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),M(0,n,"id",function(){return this._id}),M(0,n,"material",function(){var H=this._materials[0];if(H&&!this._materialsInstance[0]){var n=this._getInstanceMaterial(H,0);this.event("materialchanged",[this,0,n])}return this._materials[0]},function(H){this.sharedMaterial=H}),M(0,n,"sharedMaterial",function(){return this._materials[0]},function(H){var n=this._materials[0];n!==H&&(this._materials[0]=H,this._materialsInstance[0]=!1,this._changeMaterialReference(n,H),this.event("materialchanged",[this,0,H]))}),M(0,n,"lightmapIndex",function(){return this._lightmapIndex},function(H){this._lightmapIndex=H,this._applyLightMapParams()}),M(0,n,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(H){this._lightmapScaleOffset=H,this._setShaderValueColor(2,H),this._addShaderDefine(Vn.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),M(0,n,"enable",function(){return this._enable},function(H){this._enable=H,this.event("enablechanged",[this,H])}),M(0,n,"materials",function(){for(var H=0,n=this._materials.length;H<n;H++)if(!this._materialsInstance[H]){var C=this._getInstanceMaterial(this._materials[H],H);this.event("materialchanged",[this,H,C])}return this._materials.slice()},function(H){this.sharedMaterials=H}),M(0,n,"sharedMaterials",function(){return this._materials.slice()},function(H){if(!H)throw new Error("MeshRender: shadredMaterials value can't be null.");var n=H.length;this._materialsInstance.length=n;for(var C=0;C<n;C++){var r=this._materials[C];r!==H[C]&&(this._materialsInstance[C]=!1,this._changeMaterialReference(r,H[C]),this.event("materialchanged",[this,C,H[C]]))}this._materials=H}),M(0,n,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),M(0,n,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var H=this.boundingBox;Pn.add(H.min,H.max,this._boundingBoxCenter),Pn.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),M(0,n,"receiveShadow",function(){return this._receiveShadow},function(H){this._receiveShadow!==H&&((this._receiveShadow=H)?this._addShaderDefine(jn.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(jn.SHADERDEFINE_RECEIVE_SHADOW))}),M(0,n,"destroyed",function(){return this._destroyed}),r._uniqueIDCounter=0,y(r,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn]},"_greenColor",function(){return this._greenColor=new tn(0,1,0,1)}]),r}(),an=function(H){function A(H){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,A.__super.call(this),this._localPosition=new Pn,this._localRotation=new Nn(0,0,0,1),this._localScale=new Pn(1,1,1),this._localRotationEuler=new Pn,this._localMatrix=new nn,this._position=new Pn,this._rotation=new Nn(0,0,0,1),this._scale=new Pn(1,1,1),this._worldMatrix=new nn,this._forward=new Pn,this._up=new Pn,this._right=new Pn,this._owner=H,this._childs=[]}g(A,"laya.d3.core.Transform3D",Q);var n=A.prototype;return n._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)nn.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var H=A._tempVector30;Pn.multiply(this.pivot,this._localScale,H);var n=A._tempVector31;Pn.subtract(H,this.pivot,n);var C=A._tempVector32,r=this.localRotation;Pn.transformQuat(H,r,C),Pn.subtract(C,H,C);var N=A._tempVector33;Pn.subtract(this._localPosition,n,N),Pn.subtract(N,C,N),nn.createAffineTransformation(N,r,this._localScale,this._localMatrix)}},n._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldPositionRotationTransform()}},n._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldPositionScaleTransform()}},n._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldPositionTransform()}},n._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldPositionRotationTransform()}},n._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldPositionScaleTransform()}},n._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._onWorldTransform()}},n.translate=function(H,n){void 0===n&&(n=!0),n?(nn.createFromQuaternion(this.localRotation,A._tempMatrix0),Pn.transformCoordinate(H,A._tempMatrix0,A._tempVector30),Pn.add(this.localPosition,A._tempVector30,this._localPosition),this.localPosition=this._localPosition):(Pn.add(this.position,H,this._position),this.position=this._position)},n.rotate=function(H,n,C){var r;void 0===n&&(n=!0),void 0===C&&(C=!0),r=C?H:(Pn.scale(H,Math.PI/180,A._tempVector30),A._tempVector30),Nn.createFromYawPitchRoll(r.y,r.x,r.z,A._tempQuaternion0),n?(Nn.multiply(this._localRotation,A._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Nn.multiply(A._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},n.lookAt=function(H,n,C){void 0===C&&(C=!1);var r,N=H.elements;if(C){if(r=this._localPosition.elements,Math.abs(r[0]-N[0])<BH.zeroTolerance&&Math.abs(r[1]-N[1])<BH.zeroTolerance&&Math.abs(r[2]-N[2])<BH.zeroTolerance)return;Nn.lookAt(this._localPosition,H,n,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var Q=this.position;if(r=Q.elements,Math.abs(r[0]-N[0])<BH.zeroTolerance&&Math.abs(r[1]-N[1])<BH.zeroTolerance&&Math.abs(r[2]-N[2])<BH.zeroTolerance)return;Nn.lookAt(Q,H,n,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},M(0,n,"_isFrontFaceInvert",function(){var H=this.scale,n=H.x<0;return H.y<0&&(n=!n),H.z<0&&(n=!n),n}),M(0,n,"owner",function(){return this._owner}),M(0,n,"localRotation",function(){if(this._localQuaternionUpdate){var H=this._localRotationEuler.elements;Nn.createFromYawPitchRoll(H[1]/A._angleToRandin,H[0]/A._angleToRandin,H[2]/A._angleToRandin,this._localRotation)}return this._localRotation},function(H){this._localRotation=H,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),M(0,n,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?nn.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(H){null===this._parent?H.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),nn.multiply(this._localMatrix,H,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=H,this._worldUpdate=!1}),M(0,n,"worldNeedUpdate",function(){return this._worldUpdate}),M(0,n,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(H){this._localMatrix=H,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),M(0,n,"dummy",function(){return this._dummy},function(H){this._dummy!==H&&(this._dummy&&(this._dummy._entity=null),H&&(H._entity=this),this._dummy=H)}),M(0,n,"localPosition",function(){return this._localPosition},function(H){this._localPosition=H,this._localUpdate=!0,this._onWorldPositionTransform()}),M(0,n,"position",function(){if(this._positionUpdate){if(null!=this._parent){var H=this._parent.position;Pn.multiply(this._localPosition,this._parent.scale,A._tempVector30),Pn.transformQuat(A._tempVector30,this._parent.rotation,A._tempVector30),Pn.add(H,A._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(H){if(null!=this._parent){Pn.subtract(H,this._parent.position,this._localPosition);var n=this._parent.scale.elements,C=n[0],r=n[1],N=n[2];if(1!==C||1!==r||1!==N){var Q=A._tempVector30,I=Q.elements;I[0]=1/C,I[1]=1/r,I[2]=1/N,Pn.multiply(this._localPosition,Q,this._localPosition)}this._parent.rotation.invert(A._tempQuaternion0),Pn.transformQuat(this._localPosition,A._tempQuaternion0,this._localPosition)}else H.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=H,this._positionUpdate=!1}),M(0,n,"localScale",function(){return this._localScale},function(H){this._localScale=H,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),M(0,n,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(A._tempVector30);var H=A._tempVector30.elements,n=this._localRotationEuler.elements;n[0]=H[1]*A._angleToRandin,n[1]=H[0]*A._angleToRandin,n[2]=H[2]*A._angleToRandin}return this._localRotationEuler},function(H){this._localRotationEuler=H,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),M(0,n,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?Nn.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(H){null!=this._parent?(this._parent.rotation.invert(A._tempQuaternion0),Nn.multiply(H,A._tempQuaternion0,this._localRotation)):H.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=H,this._rotationUpdate=!1}),M(0,n,"scale",function(){return this._scaleUpdate&&(null!==this._parent?Pn.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(H){if(null!==this._parent){var n=this._parent.scale.elements,C=A._tempVector30.elements;C[0]=1/n[0],C[1]=1/n[1],C[2]=1/n[2],Pn.multiply(H,A._tempVector30,this._localScale)}else H.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=H,this._scaleUpdate=!1}),M(0,n,"rotationEuler",null,function(H){Nn.createFromYawPitchRoll(H.y,H.x,H.z,this._rotation),this.rotation=this._rotation}),M(0,n,"forward",function(){var H=this.worldMatrix.elements;return this._forward.elements[0]=-H[8],this._forward.elements[1]=-H[9],this._forward.elements[2]=-H[10],this._forward}),M(0,n,"up",function(){var H=this.worldMatrix.elements;return this._up.elements[0]=H[4],this._up.elements[1]=H[5],this._up.elements[2]=H[6],this._up}),M(0,n,"right",function(){var H=this.worldMatrix.elements;return this._right.elements[0]=H[0],this._right.elements[1]=H[1],this._right.elements[2]=H[2],this._right}),M(0,n,"parent",function(){return this._parent},function(H){if(this._parent!==H){if(this._parent){var n=this._parent._childs,C=n.indexOf(this);n.splice(C,1)}H&&(H._childs.push(this),H&&this._onWorldTransform()),this._parent=H}}),y(A,["_tempVector30",function(){return this._tempVector30=new Pn},"_tempVector31",function(){return this._tempVector31=new Pn},"_tempVector32",function(){return this._tempVector32=new Pn},"_tempVector33",function(){return this._tempVector33=new Pn},"_tempQuaternion0",function(){return this._tempQuaternion0=new Nn},"_tempMatrix0",function(){return this._tempMatrix0=new nn},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),A}(),Dn=(function(H){function n(){this._rotation=0,this._matNeedUpdte=!1,n.__super.call(this),this._matrix=new nn,this._offset=new An,this._tiling=new An(1,1)}g(n,"laya.d3.core.TransformUV",Q);var C=n.prototype;z.imps(C,{"laya.d3.core.IClone":!0}),C._updateMatrix=function(){n._tempOffsetV3.elements[0]=this._offset.x,n._tempOffsetV3.elements[1]=this._offset.y,Nn.createFromYawPitchRoll(0,0,this._rotation,n._tempRotationQua),n._tempTitlingV3.elements[0]=this._tiling.x,n._tempTitlingV3.elements[1]=this._tiling.y,nn.createAffineTransformation(n._tempOffsetV3,n._tempRotationQua,n._tempTitlingV3,this._matrix)},C.cloneTo=function(H){H._matrix=this._matrix.clone(),H._offset=this._offset.clone(),H._rotation=this._rotation,H._tiling=this._tiling.clone()},C.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,C,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),M(0,C,"tiling",function(){return this._tiling},function(H){this._tiling=H,this._matNeedUpdte=!0}),M(0,C,"offset",function(){return this._offset},function(H){this._offset=H,this._matNeedUpdte=!0}),M(0,C,"rotation",function(){return this._rotation},function(H){this._rotation=H,this._matNeedUpdte=!0}),y(n,["_tempOffsetV3",function(){return this._tempOffsetV3=new Pn(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new Nn},"_tempTitlingV3",function(){return this._tempTitlingV3=new Pn(1,1,1)}])}(),function(C){function H(){this.x=NaN,this.y=NaN,this.z=NaN,H.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}g(H,"laya.d3.core.particleShuriKen.module.shape.BoxShape",C);var n=H.prototype;n._getShapeBoundBox=function(H){var n=H.min.elements;n[0]=.5*-this.x,n[1]=.5*-this.y,n[2]=.5*-this.z;var C=H.max.elements;C[0]=.5*this.x,C[1]=.5*this.y,C[2]=.5*this.z},n._getSpeedBoundBox=function(H){var n=H.min.elements;n[0]=0,n[1]=0,n[2]=0;var C=H.max.elements;C[0]=0,C[1]=1,C[2]=0},n.generatePositionAndDirection=function(H,n,C,r){var N=H.elements,Q=n.elements;C?(C.seed=r[16],O._randomPointInsideHalfUnitBox(H,C),r[16]=C.seed):O._randomPointInsideHalfUnitBox(H),N[0]=this.x*N[0],N[1]=this.y*N[1],N[2]=this.z*N[2],this.randomDirection?C?(C.seed=r[17],O._randomPointUnitSphere(n,C),r[17]=C.seed):O._randomPointUnitSphere(n):(Q[0]=0,Q[1]=0,Q[2]=1)},n.cloneTo=function(H){C.prototype.cloneTo.call(this,H);var n=H;n.x=this.x,n.y=this.y,n.z=this.z,n.randomDirection=this.randomDirection}}(_),function(C){function I(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,I.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}g(I,"laya.d3.core.particleShuriKen.module.shape.CircleShape",C);var H=I.prototype;H._getShapeBoundBox=function(H){var n=H.min.elements;n[0]=n[2]=-this.radius,n[1]=0;var C=H.max.elements;C[0]=C[2]=this.radius,C[1]=0},H._getSpeedBoundBox=function(H){var n=H.min.elements;n[0]=n[1]=-1,n[2]=0;var C=H.max.elements;C[0]=C[1]=1,C[2]=0},H.generatePositionAndDirection=function(H,n,C,r){var N=H.elements,Q=I._tempPositionPoint.elements;C?(C.seed=r[16],this.emitFromEdge?O._randomPointUnitArcCircle(this.arc,I._tempPositionPoint,C):O._randomPointInsideUnitArcCircle(this.arc,I._tempPositionPoint,C),r[16]=C.seed):this.emitFromEdge?O._randomPointUnitArcCircle(this.arc,I._tempPositionPoint):O._randomPointInsideUnitArcCircle(this.arc,I._tempPositionPoint),N[0]=-Q[0],N[1]=Q[1],N[2]=0,Pn.scale(H,this.radius,H),this.randomDirection?C?(C.seed=r[17],O._randomPointUnitSphere(n,C),r[17]=C.seed):O._randomPointUnitSphere(n):H.cloneTo(n)},H.cloneTo=function(H){C.prototype.cloneTo.call(this,H);var n=H;n.radius=this.radius,n.arc=this.arc,n.emitFromEdge=this.emitFromEdge,n.randomDirection=this.randomDirection},y(I,["_tempPositionPoint",function(){return this._tempPositionPoint=new An}])}(_),function(C){function o(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,o.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}g(o,"laya.d3.core.particleShuriKen.module.shape.ConeShape",C);var H=o.prototype;H._getShapeBoundBox=function(H){var n=this.radius+this.length*Math.sin(this.angle),C=this.length*Math.cos(this.angle),r=H.min.elements;r[0]=r[1]=-n,r[2]=0;var N=H.max.elements;N[0]=N[1]=n,N[2]=C},H._getSpeedBoundBox=function(H){var n=Math.sin(this.angle),C=H.min.elements;C[0]=C[1]=-n,C[2]=0;var r=H.max.elements;r[0]=C[1]=n,r[2]=1},H.generatePositionAndDirection=function(H,n,C,r){var N,Q=H.elements,I=n.elements,A=o._tempPositionPoint.elements,P=NaN,t=NaN,R=Math.cos(this.angle),y=Math.sin(this.angle);switch(this.emitType){case 0:C?(C.seed=r[16],O._randomPointInsideUnitCircle(o._tempPositionPoint,C),r[16]=C.seed):O._randomPointInsideUnitCircle(o._tempPositionPoint),P=A[0],t=A[1],Q[0]=P*this.radius,Q[1]=t*this.radius,Q[2]=0,this.randomDirection?(C?(C.seed=r[17],O._randomPointInsideUnitCircle(o._tempDirectionPoint,C),r[17]=C.seed):O._randomPointInsideUnitCircle(o._tempDirectionPoint),N=o._tempDirectionPoint.elements,I[0]=N[0]*y,I[1]=N[1]*y):(I[0]=P*y,I[1]=t*y),I[2]=R;break;case 1:C?(C.seed=r[16],O._randomPointUnitCircle(o._tempPositionPoint,C),r[16]=C.seed):O._randomPointUnitCircle(o._tempPositionPoint),P=A[0],t=A[1],Q[0]=P*this.radius,Q[1]=t*this.radius,Q[2]=0,this.randomDirection?(C?(C.seed=r[17],O._randomPointInsideUnitCircle(o._tempDirectionPoint,C),r[17]=C.seed):O._randomPointInsideUnitCircle(o._tempDirectionPoint),N=o._tempDirectionPoint.elements,I[0]=N[0]*y,I[1]=N[1]*y):(I[0]=P*y,I[1]=t*y),I[2]=R;break;case 2:C?(C.seed=r[16],O._randomPointInsideUnitCircle(o._tempPositionPoint,C)):O._randomPointInsideUnitCircle(o._tempPositionPoint),P=A[0],t=A[1],Q[0]=P*this.radius,Q[1]=t*this.radius,I[Q[2]=0]=P*y,I[1]=t*y,I[2]=R,Pn.normalize(n,n),C?(Pn.scale(n,this.length*C.getFloat(),n),r[16]=C.seed):Pn.scale(n,this.length*Math.random(),n),Pn.add(H,n,H),this.randomDirection&&(C?(C.seed=r[17],O._randomPointUnitSphere(n,C),r[17]=C.seed):O._randomPointUnitSphere(n));break;case 3:C?(C.seed=r[16],O._randomPointUnitCircle(o._tempPositionPoint,C)):O._randomPointUnitCircle(o._tempPositionPoint),P=A[0],t=A[1],Q[0]=P*this.radius,Q[1]=t*this.radius,I[Q[2]=0]=P*y,I[1]=t*y,I[2]=R,Pn.normalize(n,n),C?(Pn.scale(n,this.length*C.getFloat(),n),r[16]=C.seed):Pn.scale(n,this.length*Math.random(),n),Pn.add(H,n,H),this.randomDirection&&(C?(C.seed=r[17],O._randomPointUnitSphere(n,C),r[17]=C.seed):O._randomPointUnitSphere(n));break;default:throw new Error("ConeShape:emitType is invalid.")}},H.cloneTo=function(H){C.prototype.cloneTo.call(this,H);var n=H;n.angle=this.angle,n.radius=this.radius,n.length=this.length,n.emitType=this.emitType,n.randomDirection=this.randomDirection},y(o,["_tempPositionPoint",function(){return this._tempPositionPoint=new An},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new An}])}(_),function(C){function H(){this.radius=NaN,this.emitFromShell=!1,H.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}g(H,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",C);var n=H.prototype;n._getShapeBoundBox=function(H){var n=H.min.elements;n[0]=n[1]=n[2]=-this.radius;var C=H.max.elements;C[0]=C[1]=this.radius,C[2]=0},n._getSpeedBoundBox=function(H){var n=H.min.elements;n[0]=n[1]=-1,n[2]=0;var C=H.max.elements;C[0]=C[1]=C[2]=1},n.generatePositionAndDirection=function(H,n,C,r){var N=H.elements;C?(C.seed=r[16],this.emitFromShell?O._randomPointUnitSphere(H,C):O._randomPointInsideUnitSphere(H,C),r[16]=C.seed):this.emitFromShell?O._randomPointUnitSphere(H):O._randomPointInsideUnitSphere(H),Pn.scale(H,this.radius,H);var Q=N[2];Q<0&&(N[2]=-1*Q),this.randomDirection?C?(C.seed=r[17],O._randomPointUnitSphere(n,C),r[17]=C.seed):O._randomPointUnitSphere(n):H.cloneTo(n)},n.cloneTo=function(H){C.prototype.cloneTo.call(this,H);var n=H;n.radius=this.radius,n.emitFromShell=this.emitFromShell,n.randomDirection=this.randomDirection}}(_),function(C){function H(){this.radius=NaN,this.emitFromShell=!1,H.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}g(H,"laya.d3.core.particleShuriKen.module.shape.SphereShape",C);var n=H.prototype;n._getShapeBoundBox=function(H){var n=H.min.elements;n[0]=n[1]=n[2]=-this.radius;var C=H.max.elements;C[0]=C[1]=C[2]=this.radius},n._getSpeedBoundBox=function(H){var n=H.min.elements;n[0]=n[1]=n[2]=-1;var C=H.max.elements;C[0]=C[1]=C[2]=1},n.generatePositionAndDirection=function(H,n,C,r){C?(C.seed=r[16],this.emitFromShell?O._randomPointUnitSphere(H,C):O._randomPointInsideUnitSphere(H,C),r[16]=C.seed):this.emitFromShell?O._randomPointUnitSphere(H):O._randomPointInsideUnitSphere(H),Pn.scale(H,this.radius,H),this.randomDirection?C?(C.seed=r[17],O._randomPointUnitSphere(n,C),r[17]=C.seed):O._randomPointUnitSphere(n):H.cloneTo(n)},n.cloneTo=function(H){C.prototype.cloneTo.call(this,H);var n=H;n.radius=this.radius,n.emitFromShell=this.emitFromShell,n.randomDirection=this.randomDirection}}(_),function(H){function n(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,n.__super.call(this)}return g(n,"laya.d3.core.render.SubMeshRenderElement",E),n}()),Ln=function(H){function l(H,n,C,r,N,Q){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=H,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[jn.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[Vn.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[Vn.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[en.SHADERDEFINE_ALPHATEST]="ALPHATEST";l.__super.call(this,H,n,C,null,{}),this._attributeMap=r;var I;for(I in N){var A=N[I];switch(A[1]){case 0:this._renderElementUniformMap[I]=A[0];break;case 1:this._materialUniformMap[I]=A[0];break;case 2:this._spriteUniformMap[I]=A[0];break;case 3:this._cameraUniformMap[I]=A[0];break;case 4:this._sceneUniformMap[I]=A[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}g(l,"laya.d3.shader.ShaderCompile3D",K);var n=l.prototype;return n._definesToNameDic=function(H,n){for(var C={},r=1,N=0;N<32&&!(H<(r=1<<N));N++)if(H&r){var Q=n[r];Q&&(C[Q]="")}return C},n.withCompile=function(H,n,C,r){var N,Q,I;if(Q=this.sharders[H])if(I=Q[n]){if(N=I[C])return N}else I=Q[n]=[];else I=(Q=this.sharders[H]=[])[n]=[];var A,P=this._definesToNameDic(H,l._globalInt2name),t=this._definesToNameDic(n,this._spriteInt2name),R=this._definesToNameDic(C,this._materialInt2name);laya.d3.shader.ShaderCompile3D.debugMode;var y={},o="";if(P)for(A in P)o+="#define "+A+"\n",y[A]=!0;if(t)for(A in t)o+="#define "+A+"\n",y[A]=!0;if(R)for(A in R)o+="#define "+A+"\n",y[A]=!0;var g=$n.nameKey.getName(this._name)+" compile ("+H+","+n+","+C+")",M=this._VS.toscript(y,[]),j=this._PS.toscript(y,[]);v.now();if(N=$n.create(o+M.join("\n"),o+j.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,r,g),I[C]=N,laya.d3.shader.ShaderCompile3D.debugMode)v.now();return N},n.precompileShaderWithShaderDefine=function(H,n,C){this.withCompile(H,n,C,!0)},n.addMaterialDefines=function(H){var n=H.defines;for(var C in n){var r=n[C],N=parseInt(C);this._materialInt2name[N]=r,this._materialName2Int[r]=N}},n.addSpriteDefines=function(H){var n=H.defines;for(var C in n){var r=n[C],N=parseInt(C);this._spriteInt2name[N]=r,this._spriteName2Int[r]=N}},n.getMaterialDefineByName=function(H){return this._materialName2Int[H]},n.registerMaterialDefine=function(H){var n=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[n]=H,this._materialName2Int[H]=n},n.registerSpriteDefine=function(H){var n=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[n]=H,this._spriteName2Int[H]=n},l._globalRegDefine=function(H,n){l._globalInt2name[n]=H},l.add=function(H,n,C,r,N){return laya.d3.shader.ShaderCompile3D._preCompileShader[H]=new l(H,n,C,r,N,K.includes)},l.get=function(H){return laya.d3.shader.ShaderCompile3D._preCompileShader[$n.nameKey.getID(H)]},l._preCompileShader={},l._globalInt2name=[],l.debugMode=!1,l.SHADERDEFINE_HIGHPRECISION=1,l.SHADERDEFINE_FOG=4,l.SHADERDEFINE_DIRECTIONLIGHT=8,l.SHADERDEFINE_POINTLIGHT=16,l.SHADERDEFINE_SPOTLIGHT=32,l.SHADERDEFINE_UV0=64,l.SHADERDEFINE_COLOR=128,l.SHADERDEFINE_UV1=256,l.SAHDERDEFINE_DEPTHFOG=131072,l}(),bn=function(H){function M(){M.__super.call(this)}g(M,"laya.d3.graphics.MeshSprite3DStaticBatchManager",rH);var n=M.prototype;return n._getStaticBatch=function(H,n,C,r){var N,Q;return Q=H?H.id.toString()+C.id.toString()+n.id.toString()+r.toString():C.id.toString()+n.id.toString()+r.toString(),this._staticBatches[Q]?N=this._staticBatches[Q]:this._staticBatches[Q]=N=new hn(Q,this,H,n,C),N},n._initStaticBatchs=function(H){var n,C;this._initBatchRenderElements.sort(M._sortPrepareStaticBatch);for(var r,N=!1,Q=0,I=0,A=this._initBatchRenderElements.length;I<A;I++){var P,t=this._initBatchRenderElements[I],R=t.renderObj._getVertexBuffer(0);t._sprite3D;if(C===R.vertexDeclaration&&n===t._material)if(N)r._addCombineBatchRenderObjTest(t)?(P=t._staticBatch)!==r&&(P&&P._deleteCombineBatchRenderObj(t),r._addCombineBatchRenderObj(t)):(N=!1,Q++);else{var y=this._initBatchRenderElements[I-1],o=y.renderObj,g=t.renderObj;N=!(65535<o._getVertexBuffer().vertexCount+g._getVertexBuffer().vertexCount)&&(r=this._getStaticBatch(H,C,n,Q),(P=y._staticBatch)!==r&&(P&&P._deleteCombineBatchRenderObj(y),r._addCombineBatchRenderObj(y)),(P=t._staticBatch)!==r&&(P&&P._deleteCombineBatchRenderObj(t),r._addCombineBatchRenderObj(t)),!0)}else N=!1,Q=0;n=t._material,C=R.vertexDeclaration}},M._sortPrepareStaticBatch=function(H,n){var C=H._render,r=n._render,N=C.lightmapIndex-r.lightmapIndex;if(0!=N)return N;var Q=C.receiveShadow-r.receiveShadow;if(0!=Q)return Q;var I=H._mainSortID-n._mainSortID;return 0==I?H.renderObj.triangleCount-n.renderObj.triangleCount:I},M}(),hn=function(H){function Q(H,n,C,r,N){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,Q.__super.call(this,H,n,C),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=r,this._material=N}g(Q,"laya.d3.graphics.SubMeshStaticBatch",NH);var n=Q.prototype;return n._compareBatchRenderElement=function(H,n){return H._batchIndexStart>n._batchIndexStart},n._addCombineBatchRenderObjTest=function(H){var n=H.renderObj._vertexCount;return!(65535<(0<n?this._currentCombineVertexCount+n:this._currentCombineVertexCount+H.renderObj._getVertexBuffer().vertexCount))},n._addCombineBatchRenderObj=function(H){var n=H.renderObj,C=n._vertexCount;this._initBatchRenderElements.push(H),H._staticBatch=this,0<C?(this._currentCombineIndexCount+=n._indexCount,this._currentCombineVertexCount+=C):(this._currentCombineIndexCount=this._currentCombineIndexCount+n._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+n._getVertexBuffer().vertexCount),this._needFinishCombine=!0},n._deleteCombineBatchRenderObj=function(H){var n=H.renderObj,C=this._initBatchRenderElements.indexOf(H);if(-1!==C){this._initBatchRenderElements.splice(C,1),H._staticBatch=null;var r=n._vertexCount;0<r?(this._currentCombineIndexCount=this._currentCombineIndexCount-n._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-r):(this._currentCombineIndexCount=this._currentCombineIndexCount-n._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-n._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},n._finishInit=function(){if(this._needFinishCombine){var H=0,n=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var C=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),r=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=Sn.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=On.create("ushort",this._currentCombineIndexCount,35044);for(var N=0,Q=this._initBatchRenderElements.length;N<Q;N++){var I=this._initBatchRenderElements[N],A=I.renderObj,P=A._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,I._sprite3D),t=A.getIndices(),R=I._sprite3D.transform._isFrontFaceInvert,y=H/(this._vertexDeclaration.vertexStride/4)-A._vertexStart,o=n,g=o+t.length;I._batchIndexStart=o,I._batchIndexEnd=g,r.set(t,n);var M=0;if(R)for(M=o;M<g;M+=3){r[M]=y+r[M];var j=r[M+1],l=r[M+2];r[M+1]=y+l,r[M+2]=y+j}else for(M=o;M<g;M+=3)r[M]=y+r[M],r[M+1]=y+r[M+1],r[M+2]=y+r[M+2];n+=t.length,C.set(P,H),H+=P.length}this._vertexBuffer.setData(C),this._indexBuffer.setData(r),this._needFinishCombine=!1}},n._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new Dn)},n._getRenderElement=function(H,n,C){for(var r,N,Q=this._batchRenderElements.length,I=!0,A=0;A<Q;A++){var P,t,R=(N=this._batchRenderElements[A])._sprite3D._render;if(0!==A&&(I=(P=(r=this._batchRenderElements[A-1])._sprite3D._render).lightmapIndex!==R.lightmapIndex||P.receiveShadow!==R.receiveShadow||r._batchIndexEnd!==N._batchIndexStart),I){(t=this._getCombineRenderElementFromPool()).renderObj=this,t._material=this._material,t._batchIndexStart=N._batchIndexStart,t._batchIndexEnd=N._batchIndexEnd;var y=R.lightmapIndex,o=y+1,g=this._batchOwnerIndices[o];g||(g=this._batchOwnerIndices[o]=[]);var M,j=g[N._render.receiveShadow?1:0];void 0===j?(g[R.receiveShadow?1:0]=this._batchOwners.length,(M=new HC(null,"StaticBatchMeshSprite3D"))._scene=n,M._transform=this._rootOwner?this._rootOwner._transform:null,M._render.lightmapIndex=y,M._render.receiveShadow=N._render.receiveShadow,this._batchOwners.push(M)):M=this._batchOwners[j],M._render._renderUpdate(C),t._sprite3D=M,H.push(t)}else t._batchIndexEnd=N._batchIndexEnd}},n._beforeRender=function(H){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},n._render=function(H){var n=H.renderElement,C=n._batchIndexStart,r=n._batchIndexEnd-C;b.mainContext.drawElements(4,r,5123,2*C),k.drawCall++,k.trianglesFaces+=r/3},n.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},n._getVertexBuffer=function(H){return void 0===H&&(H=0),this._vertexBuffer},Q}(),vn=function(H){function n(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,n.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}g(n,"laya.d3.core.ComponentNode",R);var C=n.prototype;return C.addComponent=function(H){var n,C=this._componentsMap.indexOf(H);if(-1===C)n=[],this._componentsMap.push(H),this._typeComponentsIndices.push(n);else if(n=this._typeComponentsIndices[C],this._components[n[0]].isSingleton)throw new Error("无法单实例创建"+H+"组件，"+H+"组件已存在！");var r=P.getInstance(H);return n.push(this._components.length),this._components.push(r),r instanceof laya.d3.component.Script&&this._scripts.push(r),r._initialize(this),r},C._removeComponent=function(H,n){var C=this._typeComponentsIndices[H],r=C[n],N=this._components[r];this._components.splice(r,1),N instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(N),1),C.splice(n,1),0===C.length&&(this._typeComponentsIndices.splice(H,1),this._componentsMap.splice(H,1));for(var Q=0,I=this._componentsMap.length;Q<I;Q++)for(var A=(C=this._typeComponentsIndices[Q]).length-1;0<=A;A--){var P=C[A];if(!(r<P))break;C[A]=--P}N._destroy()},C.getComponentByType=function(H,n){void 0===n&&(n=0);var C=this._componentsMap.indexOf(H);return-1===C?null:this._components[this._typeComponentsIndices[C][n]]},C.getComponentsByType=function(H,n){var C=this._componentsMap.indexOf(H);if(-1!==C){var r=this._typeComponentsIndices[C],N=r.length;n.length=N;for(var Q=0;Q<N;Q++)n[Q]=this._components[r[Q]]}else n.length=0},C.getComponentByIndex=function(H){return this._components[H]},C.removeComponentByType=function(H,n){void 0===n&&(n=0);var C=this._componentsMap.indexOf(H);-1!==C&&this._removeComponent(C,n)},C.removeComponentsByType=function(H){var n=this._componentsMap.indexOf(H);if(-1!==n)for(var C=this._typeComponentsIndices[n],r=0,N=C.length;r<N;C.length<N?N--:r++)this._removeComponent(n,r)},C.removeAllComponent=function(){for(var H=0,n=this._componentsMap.length;H<n;this._componentsMap.length<n?n--:H++)this.removeComponentsByType(this._componentsMap[H])},C._updateComponents=function(H){for(var n=0,C=this._components.length;n<C;n++){var r=this._components[n];!r.started&&(r._start(H),r.started=!0),r.enable&&r._update(H)}},C._lateUpdateComponents=function(H){for(var n=0;n<this._components.length;n++){var C=this._components[n];!C.started&&(C._start(H),C.started=!0),C.enable&&C._lateUpdate(H)}},C._preRenderUpdateComponents=function(H){for(var n=0;n<this._components.length;n++){var C=this._components[n];!C.started&&(C._start(H),C.started=!0),C.enable&&C._preRenderUpdate(H)}},C._postRenderUpdateComponents=function(H){for(var n=0;n<this._components.length;n++){var C=this._components[n];!C.started&&(C._start(H),C.started=!0),C.enable&&C._postRenderUpdate(H)}},n}(),en=function(r){function H(){H.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new Mn,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new tn(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}g(H,"laya.d3.core.material.BaseMaterial",r);var n=H.prototype;return z.imps(n,{"laya.d3.core.IClone":!0}),n._addShaderDefine=function(H){this._shaderDefineValue|=H},n._removeShaderDefine=function(H){this._shaderDefineValue&=~H},n._addDisablePublicShaderDefine=function(H){this._disablePublicShaderDefine|=H},n._removeDisablePublicShaderDefine=function(H){this._disablePublicShaderDefine&=~H},n._setBuffer=function(H,n){this._shaderValues.setValue(H,n),this._values[H]=n},n._getBuffer=function(H){return this._values[H]},n._setMatrix4x4=function(H,n){this._shaderValues.setValue(H,n?n.elements:null),this._values[H]=n},n._getMatrix4x4=function(H){return this._values[H]},n._setInt=function(H,n){this._shaderValues.setValue(H,n),this._values[H]=n},n._getInt=function(H){return this._values[H]},n._setNumber=function(H,n){this._shaderValues.setValue(H,n),this._values[H]=n},n._getNumber=function(H){return this._values[H]},n._setBool=function(H,n){this._shaderValues.setValue(H,n),this._values[H]=n},n._getBool=function(H){return this._values[H]},n._setVector2=function(H,n){this._shaderValues.setValue(H,n?n.elements:null),this._values[H]=n},n._getVector2=function(H){return this._values[H]},n._setColor=function(H,n){this._shaderValues.setValue(H,n?n.elements:null),this._values[H]=n},n._getColor=function(H){return this._values[H]},n._setTexture=function(H,n){var C=this._values[H];this._values[H]=n,this._shaderValues.setValue(H,n),0<this.referenceCount&&(C&&C._removeReference(),n&&n._addReference())},n._getTexture=function(H){return this._values[H]},n._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},n._getShader=function(H,n,C){var r=(H|n)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(r,C,this._shaderDefineValue),this._shader},n._setRenderStateBlendDepth=function(){var H=b.mainContext;switch(h.setDepthMask(H,this.depthWrite),0===this.depthTest?h.setDepthTest(H,!1):(h.setDepthTest(H,!0),h.setDepthFunc(H,this.depthTest)),this.blend){case 0:h.setBlend(H,!1);break;case 1:h.setBlend(H,!0),h.setBlendFunc(H,this.srcBlend,this.dstBlend);break;case 2:h.setBlend(H,!0)}},n._setRenderStateFrontFace=function(H,n){var C=b.mainContext,r=0;switch(this.cull){case 0:h.setCullFace(C,!1);break;case 1:h.setCullFace(C,!0),r=H?n&&n._isFrontFaceInvert?2305:2304:n&&n._isFrontFaceInvert?2304:2305,h.setFrontFace(C,r);break;case 2:h.setCullFace(C,!0),r=H?n&&n._isFrontFaceInvert?2304:2305:n&&n._isFrontFaceInvert?2305:2304,h.setFrontFace(C,r)}},n.onAsynLoaded=function(H,n,C){var r=n[0],N=n[1];switch(r.version){case"LAYAMATERIAL:01":var Q=0,I=0,A=r.props;for(var P in A)switch(P){case"vectors":var t=A[P];for(Q=0,I=t.length;Q<I;Q++){var R=t[Q],y=R.value;switch(y.length){case 2:this[R.name]=new An(y[0],y[1]);break;case 3:this[R.name]=new Pn(y[0],y[1],y[2]);break;case 4:this[R.name]=new tn(y[0],y[1],y[2],y[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var o=A[P];for(Q=0,I=o.length;Q<I;Q++){var g=o[Q],M=g.path;M&&(this[g.name]=f.getRes(N[M]))}break;case"defines":var j=A[P];for(Q=0,I=j.length;Q<I;Q++){var l=this._shaderCompile.getMaterialDefineByName(j[Q]);this._addShaderDefine(l)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[P]=A[P];break;case"renderQueue":switch(A[P]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[P]=A[P]}break;case"LAYAMATERIAL:02":for(P in A=r.props)switch(P){case"vectors":for(Q=0,I=(t=A[P]).length;Q<I;Q++)switch((y=(R=t[Q]).value).length){case 2:this[R.name]=new An(y[0],y[1]);break;case 3:this[R.name]=new Pn(y[0],y[1],y[2]);break;case 4:this[R.name]=new tn(y[0],y[1],y[2],y[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(Q=0,I=(o=A[P]).length;Q<I;Q++)(M=(g=o[Q]).path)&&(this[g.name]=f.getRes(N[M]));break;case"defines":for(Q=0,I=(j=A[P]).length;Q<I;Q++)l=this._shaderCompile.getMaterialDefineByName(j[Q]),this._addShaderDefine(l);break;default:this[P]=A[P]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},n._addReference=function(){r.prototype._addReference.call(this);for(var H=0,n=this._values.length;H<n;H++){var C=this._values[H];C&&C instanceof laya.d3.resource.BaseTexture&&C._addReference()}},n._removeReference=function(){r.prototype._removeReference.call(this);for(var H=0,n=this._values.length;H<n;H++){var C=this._values[H];C&&C instanceof laya.d3.resource.BaseTexture&&C._removeReference()}},n.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},n.setShaderName=function(H){var n=$n.nameKey.getID(H);if(-1===n)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=Ln._preCompileShader[n]},n.cloneTo=function(H){var n=H;n.name=this.name,n.cull=this.cull,n.blend=this.blend,n.srcBlend=this.srcBlend,n.dstBlend=this.dstBlend,n.srcBlendRGB=this.srcBlendRGB,n.dstBlendRGB=this.dstBlendRGB,n.srcBlendAlpha=this.srcBlendAlpha,n.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(n.blendConstColor),n.blendEquation=this.blendEquation,n.blendEquationRGB=this.blendEquationRGB,n.blendEquationAlpha=this.blendEquationAlpha,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.renderQueue=this.renderQueue,n._shader=this._shader,n._disablePublicShaderDefine=this._disablePublicShaderDefine,n._shaderDefineValue=this._shaderDefineValue;var C,r=0,N=n._shaderValues;n._shaderValues.data.length=this._shaderValues.data.length;var Q=this._values.length,I=n._values;for(r=0,C=I.length=Q;r<C;r++){var A=this._values[r];if(A)if("number"==typeof A)I[r]=A,N.data[r]=A;else if("number"==typeof A&&Math.floor(A)==A)I[r]=A,N.data[r]=A;else if("boolean"==typeof A)I[r]=A,N.data[r]=A;else if(A instanceof laya.d3.math.Vector2){var P=I[r]||(I[r]=new An);A.cloneTo(P),N.data[r]=P.elements}else if(A instanceof laya.d3.math.Vector3){var t=I[r]||(I[r]=new Pn);A.cloneTo(t),N.data[r]=t.elements}else if(A instanceof laya.d3.math.Vector4){var R=I[r]||(I[r]=new tn);A.cloneTo(R),N.data[r]=R.elements}else if(A instanceof laya.d3.math.Matrix4x4){var y=I[r]||(I[r]=new nn);A.cloneTo(y),N.data[r]=y.elements}else A instanceof laya.d3.resource.BaseTexture&&(I[r]=A,N.data[r]=A)}},n.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},M(0,n,"alphaTestValue",function(){return this._getNumber(0)},function(H){this._setNumber(0,H)}),M(0,n,"alphaTest",function(){return this._alphaTest},function(H){(this._alphaTest=H)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),H.__init__=function(){H.SHADERDEFINE_ALPHATEST=H.shaderDefines.registerDefine("ALPHATEST")},H.RENDERQUEUE_OPAQUE=2e3,H.RENDERQUEUE_ALPHATEST=2450,H.RENDERQUEUE_TRANSPARENT=3e3,H.CULL_NONE=0,H.CULL_FRONT=1,H.CULL_BACK=2,H.BLEND_DISABLE=0,H.BLEND_ENABLE_ALL=1,H.BLEND_ENABLE_SEPERATE=2,H.BLENDPARAM_ZERO=0,H.BLENDPARAM_ONE=1,H.BLENDPARAM_SRC_COLOR=768,H.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,H.BLENDPARAM_DST_COLOR=774,H.BLENDPARAM_ONE_MINUS_DST_COLOR=775,H.BLENDPARAM_SRC_ALPHA=770,H.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,H.BLENDPARAM_DST_ALPHA=772,H.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,H.BLENDPARAM_SRC_ALPHA_SATURATE=776,H.BLENDEQUATION_ADD=0,H.BLENDEQUATION_SUBTRACT=1,H.BLENDEQUATION_REVERSE_SUBTRACT=2,H.DEPTHTEST_OFF=0,H.DEPTHTEST_NEVER=512,H.DEPTHTEST_LESS=513,H.DEPTHTEST_EQUAL=514,H.DEPTHTEST_LEQUAL=515,H.DEPTHTEST_GREATER=516,H.DEPTHTEST_NOTEQUAL=517,H.DEPTHTEST_GEQUAL=518,H.DEPTHTEST_ALWAYS=519,H.SHADERDEFINE_ALPHATEST=1,H.ALPHATESTVALUE=0,y(H,["shaderDefines",function(){return this.shaderDefines=new on}]),H}(l),Zn=function(H){function n(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,n.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}g(n,"laya.d3.resource.BaseTexture",l);var C=n.prototype;return M(0,C,"width",function(){return this._width}),M(0,C,"repeat",function(){return this._repeat},function(H){if(this._repeat!==H&&(this._repeat=H,this._source)){var n=b.mainContext;h.bindTexture(n,this._type,this._source),W.isPOT(this._width,this._height)&&this._repeat?(n.texParameteri(this._type,10242,10497),n.texParameteri(this._type,10243,10497)):(n.texParameteri(this._type,10242,33071),n.texParameteri(this._type,10243,33071))}}),M(0,C,"height",function(){return this._height}),M(0,C,"magFifter",function(){return this._magFifter},function(H){(this._magFifter=H)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(H)}),M(0,C,"wrapModeV",function(){return this._wrapModeV}),M(0,C,"size",function(){return this._size}),M(0,C,"wrapModeU",function(){return this._wrapModeU}),M(0,C,"mipmap",function(){return this._mipmap},function(H){this._mipmap=H,this._mipmap!=H&&this._conchTexture&&this._conchTexture.setMipMap(H)}),M(0,C,"minFifter",function(){return this._minFifter},function(H){this._minFifter=H,this._minFifter!=H&&this._conchTexture&&this._conchTexture.setMinFifter(H)}),M(0,C,"format",function(){return this._format}),M(0,C,"source",function(){return this.activeResource(),this._source}),M(0,C,"defaulteTexture",function(){return Yn.grayTexture}),n.WARPMODE_REPEAT=0,n.WARPMODE_CLAMP=1,n}(),qn=function(H){function n(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,n.__super.call(this),this._boundingBoxCorners=r(8,null)}g(n,"laya.d3.resource.models.BaseMesh",l);var C=n.prototype;return C._getPositions=function(){throw new Error("未Override,请重载该属性！")},C._generateBoundingObject=function(){this._boundingSphere=new XH(new Pn,0),XH.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new YH(new Pn,new Pn),YH.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},C.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},C.getRenderElement=function(H){throw new Error("未Override,请重载该属性！")},M(0,C,"subMeshCount",function(){return this._subMeshCount}),M(0,C,"boundingBox",function(){return this._boundingBox}),M(0,C,"boundingBoxCorners",function(){return this._boundingBoxCorners}),M(0,C,"boundingSphere",function(){return this._boundingSphere}),n}(),pn=function(H){function n(){n.__super.call(this),this._isRigidbody=!1,this._runtimeCollisonMap={},this._runtimeCollisonTestMap={},this._ignoreCollisonMap={},this.isTrigger=!0}g(n,"laya.d3.component.physics.Collider",H);var C=n.prototype;return C._clearCollsionMap=function(){for(var H in this._runtimeCollisonMap){var n=this._runtimeCollisonMap[H];delete n._runtimeCollisonMap[this.id],n._isRigidbody&&delete n._runtimeCollisonTestMap[this.id];var C=n.id;delete this._runtimeCollisonMap[C],this._isRigidbody&&delete this._runtimeCollisonTestMap[C]}},C._unload=function(H){for(var n in this._runtimeCollisonMap){var C=this._runtimeCollisonMap[n];delete C._runtimeCollisonMap[this.id],C._isRigidbody&&delete C._runtimeCollisonTestMap[this.id],delete this._ignoreCollisonMap[n]._ignoreCollisonMap[this.id]}},C._setIsRigidbody=function(H){if(this._isRigidbody!==H){this._isRigidbody=H;var n=this._owner;if(n.displayedInStage){var C=n.layer;C._removeCollider(this),C._addCollider(this)}}},C._getType=function(){return-1},C._collisonTo=function(H){return!1},C.raycast=function(H,n,C){throw void 0===C&&(C=179e306),new Error("Collider:Must override it.")},M(0,C,"enable",H.prototype._$get_enable,function(H){this._enable!==H&&(this._owner.displayedInStage&&(H||this._clearCollsionMap()),this._enable=H,this.event("enablechanged",this._enable))}),M(0,C,"isSingleton",function(){return n._isSingleton}),n._isSingleton=!1,n}(wn),mn=function(H){function n(){n.__super.call(this)}return g(n,"laya.d3.component.Rigidbody",H),M(0,n.prototype,"enable",H.prototype._$get_enable,function(H){if(this._enable!==H){for(var n=this._owner._colliders,C=0,r=n.length;C<r;C++){var N=n[C];N._setIsRigidbody(H);var Q=N._runtimeCollisonMap,I=N._runtimeCollisonTestMap;if(!H)for(var A in Q)delete I[A]}this._enable=H,this.event("enablechanged",this._enable)}}),n}(wn),dn=(function(H){function n(){n.__super.call(this)}g(n,"laya.d3.component.Script",wn);var C=n.prototype;C.onTriggerEnter=function(H){},C.onTriggerExit=function(H){},C.onTriggerStay=function(H){},M(0,C,"isSingleton",function(){return n._isSingleton}),n._isSingleton=!1}(),function(H){function n(H){this._owner=null,this._sharedMesh=null,n.__super.call(this),this._owner=H}g(n,"laya.d3.core.MeshFilter",H);var C=n.prototype;return C._sharedMeshLoaded=function(){this.event("loaded")},C._destroy=function(){H.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},M(0,C,"sharedMesh",function(){return this._sharedMesh},function(H){var n=this._sharedMesh;n&&n._removeReference(),(this._sharedMesh=H)._addReference(),this.event("meshchanged",[this,n,H]),H.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),M(0,C,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),M(0,C,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),M(0,C,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),M(0,C,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),n}(Fn)),_n=function(H){function n(H){n.__super.call(this,H),H.meshFilter.on("meshchanged",this,this._onMeshChanged)}g(n,"laya.d3.core.MeshRender",kn);var C=n.prototype;return C._onMeshChanged=function(H,n,C){C.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:C.once("loaded",this,this._onMeshLoaed)},C._onMeshLoaed=function(H,n){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},C._calculateBoundingSphereByInitSphere=function(H){var n=NaN,C=this._owner.transform,r=C.scale.elements,N=Math.abs(r[0]),Q=Math.abs(r[1]),I=Math.abs(r[2]);n=Q<=N&&I<=N?N:I<=Q?Q:I,Pn.transformCoordinate(H.center,C.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=H.radius*n},C._calculateBoundBoxByInitCorners=function(H){for(var n=this._owner.transform.worldMatrix,C=0;C<8;C++)Pn.transformCoordinate(H[C],n,kn._tempBoundBoxCorners[C]);YH.createfromPoints(kn._tempBoundBoxCorners,this._boundingBox)},C._calculateBoundingSphere=function(){var H=this._owner.meshFilter.sharedMesh;null==H||null==H.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(H.boundingSphere)},C._calculateBoundingBox=function(){var H=this._owner.meshFilter.sharedMesh;null==H||null==H.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(H.boundingBoxCorners)},C._renderUpdate=function(H){var n=this._owner.transform;if(n){this._setShaderValueMatrix4x4(0,n.worldMatrix);var C=this._owner.getProjectionViewWorldMatrix(H);this._setShaderValueMatrix4x4(1,C)}else this._setShaderValueMatrix4x4(0,nn.DEFAULT),this._setShaderValueMatrix4x4(1,H);return Wn.debugMode&&this._renderRenderableBoundBox(),!0},n}(),Un=function(n){function r(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,r.__super.call(this),this._renderState=new J,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new Mn,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new nH,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new Pn(.7,.7,.7),this.ambientColor=new Pn(.212,.227,.259),b.shaderHighPrecision&&this.addShaderDefine(Ln.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}g(r,"laya.d3.core.scene.Scene",n);var H=r.prototype;return z.imps(H,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),H._setUrl=function(H){this._url=H},H._getGroup=function(){return this._group},H._setGroup=function(H){this._group=H},H._display=function(){z.stage._scenes.push(this),z.stage._scenes.sort(r._sortScenes);for(var H=0,n=this._childs.length;H<n;H++){var C=this._childs[H];C.active&&C._activeHierarchy()}},H._unDisplay=function(){var H=z.stage._scenes;H.splice(H.indexOf(this),1);for(var n=0,C=this._childs.length;n<C;n++){var r=this._childs[n];r.active&&r._inActiveHierarchy()}},H._addChild3D=function(H){H.transform._onWorldTransform(),H._setBelongScene(this),this.displayedInStage&&H.active&&H._activeHierarchy()},H._removeChild3D=function(H){H.transform.parent=null,this.displayedInStage&&H.active&&H._inActiveHierarchy(),H._setUnBelongScene()},H.initOctree=function(H,n,C,r,N){void 0===N&&(N=6),this.treeSize=new Pn(H,n,C),this.treeLevel=N,this.treeRoot=new Y(this,0),this.treeRoot.init(r,this.treeSize)},H._prepareUpdateToRenderState=function(H,n){n.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,n.scene=this},H._prepareSceneToRender=function(H){var n=this._lights.length;if(0<n)for(var C=0,r=0;r<n&&!(this._lights[r]._prepareToScene(H)&&++C>=this._enableLightCount);r++);},H._updateChilds=function(H){for(var n=0,C=this._childs.length;n<C;++n)this._childs[n]._update(H)},H._preRenderScene=function(H,n,C){var r,N=n._viewMatrix,Q=n._projectionMatrix,I=n._projectionViewMatrix,A=0,P=n.camera;for(P.useOcclusionCulling?this.treeRoot?CH.renderObjectCullingOctree(C,this,P,N,Q,I):CH.renderObjectCulling(C,this,P,N,Q,I):CH.renderObjectCullingNoBoundFrustum(this,P,N,Q,I),A=0,r=this._quenes.length;A<r;A++)this._quenes[A]&&this._quenes[A]._preRender(n)},H._clear=function(H,n){var C=n._viewport,r=n.camera,N=C.x,Q=r.renderTargetSize.height-C.y-C.height,I=C.width,A=C.height;H.viewport(N,Q,I,A);var P=256,t=r.renderTarget;switch(r.clearFlag){case 0:var R=r.clearColor;if(R){H.enable(3089),H.scissor(N,Q,I,A);var y=R.elements;H.clearColor(y[0],y[1],y[2],y[3]),P|=16384}if(t)switch(R||(P=16384),t.depthStencilFormat){case 33189:P|=256;break;case 36168:P|=1024;break;case 34041:P|=256,P|=1024}H.clear(P),R&&H.disable(3089);break;case 1:case 2:if(t)switch(P=16384,t.depthStencilFormat){case 33189:P|=256;break;case 36168:P|=1024;break;case 34041:P|=256,P|=1024}H.clear(P);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},H._renderScene=function(H,n){var C,r,N=n.camera,Q=0;for(Q=0;Q<2;Q++)(r=this._quenes[Q])&&(N.renderTarget?r._render(n,!0):r._render(n,!1));if(1===N.clearFlag){var I=N.sky;I&&(h.setCullFace(H,!1),h.setDepthFunc(H,515),h.setDepthMask(H,!1),I._render(n),h.setDepthFunc(H,513),h.setDepthMask(H,!0))}for(Q=2,C=this._quenes.length;Q<C;Q++)(r=this._quenes[Q])&&(r._sortAlpha(n.camera.transform.position),N.renderTarget?r._render(n,!0):r._render(n,!1))},H._set3DRenderConfig=function(H){H.disable(3042),h._blend=!1,H.blendFunc(770,771),h._sFactor=770,h._dFactor=771,H.disable(2929),h._depthTest=!1,H.enable(2884),h._cullFace=!0,H.depthMask(1),h._depthMask=!0,H.frontFace(2304),h._frontFace=2304},H._set2DRenderConfig=function(H){h.setBlend(H,!0),h.setBlendFunc(H,1,771),h.setDepthTest(H,!1),h.setCullFace(H,!1),h.setDepthMask(H,!0),h.setFrontFace(H,2305),H.viewport(0,0,N.width,N.height)},H._parseCustomProps=function(H,n,C,r){var N=r.customProps.lightmaps,Q=N.length,I=this._lightmaps;I.length=Q;for(var A=0;A<Q;A++)I[A]=f.getRes(n[N[A].replace(".exr",".png")]);this.setlightmaps(I);var P=r.customProps.ambientColor;P&&(this.ambientColor=new Pn(P[0],P[1],P[2]));var t=r.customProps.fogColor;t&&(this.fogColor=new Pn(t[0],t[1],t[2]))},H._addLight=function(H){this._lights.indexOf(H)<0&&this._lights.push(H)},H._removeLight=function(H){var n=this._lights.indexOf(H);0<=n&&this._lights.splice(n,1)},H._updateScene=function(){var H=this._renderState;this._prepareUpdateToRenderState(b.mainContext,H),this._updateComponents(H),this._updateChilds(H),this._lateUpdateComponents(H),this._time+=H.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},H._updateSceneConch=function(){var H=this._renderState;this._prepareUpdateToRenderState(b.mainContext,H),this._updateComponents(H),this._lateUpdateComponents(H),this._prepareSceneToRender(H);for(var n=0,C=this._cameraPool.length;n<C;n++){var r=this._cameraPool[n];(H.camera=r)._prepareCameraToRender()}},H._preRenderShadow=function(H,n,C,r,N){this.treeRoot?CH.renderShadowObjectCullingOctree(this,n,C,r,N):CH.renderShadowObjectCulling(this,n,C,r,N);for(var Q=0,I=C.length;Q<I;Q++)C[Q]&&C[Q]._preRender(H)},H._renderShadowMap=function(H,n,C){var r=this.parallelSplitShadowMaps[0];r._calcAllLightCameraInfo(C);var N,Q,I,A=r.PSSMNum;if(this._preRenderShadow(n,r._lightCulling,r._shadowQuenes,r._lightVPMatrix[0],A),this.addShaderDefine(jn.SHADERDEFINE_CAST_SHADOW),1<A)for(var P=0;P<A;P++)N=r.getRenderTarget(P+1),r.beginRenderTarget(P+1),H.clearColor(1,1,1,1),H.clear(16640),H.viewport(0,0,N.width,N.height),n.camera=I=r.getLightCamera(P),I._prepareCameraToRender(),I._prepareCameraViewProject(I.viewMatrix,I.projectionMatrix),n._projectionViewMatrix=r._lightVPMatrix[P+1],(Q=r._shadowQuenes[P])._preRender(n),Q._renderShadow(n,!1),r.endRenderTarget(P+1);else N=r.getRenderTarget(1),r.beginRenderTarget(1),H.clearColor(1,1,1,1),H.clear(16640),H.viewport(0,0,N.width,N.height),n.camera=I=r.getLightCamera(0),I._prepareCameraToRender(),I._prepareCameraViewProject(I.viewMatrix,I.projectionMatrix),n._projectionViewMatrix=r._lightVPMatrix[0],(Q=r._shadowQuenes[0])._preRender(n),Q._renderShadow(n,!0),r.endRenderTarget(1);this.removeShaderDefine(jn.SHADERDEFINE_CAST_SHADOW)},H.addTreeNode=function(H){this.treeRoot.addTreeNode(H)},H.removeTreeNode=function(H){this.treeSize&&H._treeNode&&H._treeNode.removeObject(H)},H.setlightmaps=function(H){this._lightmaps=H;for(var n=0,C=this._renderableSprite3Ds.length;n<C;n++)this._renderableSprite3Ds[n]._render._applyLightMapParams()},H.getlightmaps=function(){return this._lightmaps},H.addChildAt=function(H,n){if(!(H instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(H&&H.__className));if(!H||this.destroyed||H===this)return H;if(H.zOrder&&this._set$P("hasZorder",!0),0<=n&&n<=this._childs.length){if(H._parent===this){var C=this.getChildIndex(H);this._childs.splice(C,1),this._childs.splice(n,0,H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,n)),this._childChanged()}else H.parent&&H.parent.removeChild(H),this._childs===R.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(n,0,H),this.conchModel&&this.conchModel.addChildAt(H.conchModel,n),(H.parent=this)._addChild3D(H);return H}throw new Error("appendChildAt:The index is out of bounds")},H.addChild=function(H){if(!(H instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!H||this.destroyed||H===this)return H;if(H.zOrder&&this._set$P("hasZorder",!0),H._parent===this){var n=this.getChildIndex(H);n!==this._childs.length-1&&(this._childs.splice(n,1),this._childs.push(H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,this._childs.length-1)),this._childChanged())}else H.parent&&H.parent.removeChild(H),this._childs===R.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(H),this.conchModel&&this.conchModel.addChildAt(H.conchModel,this._childs.length-1),(H.parent=this)._childChanged(),this._addChild3D(H);return H},H.removeChildAt=function(H){var n=this.getChildAt(H);return n&&(this._removeChild3D(n),this._childs.splice(H,1),this.conchModel&&this.conchModel.removeChild(n.conchModel),n.parent=null),n},H.removeChildren=function(H,n){if(void 0===H&&(H=0),void 0===n&&(n=2147483647),this._childs&&0<this._childs.length){var C=this._childs;if(0===H&&Q<=n){var r=C;this._childs=R.ARRAY_EMPTY}else r=C.splice(H,n-H);for(var N=0,Q=r.length;N<Q;N++)this._removeChild3D(r[N]),r[N].parent=null,this.conchModel&&this.conchModel.removeChild(r[N].conchModel)}return this},H.addFrustumCullingObject=function(H){this.treeRoot?this.addTreeNode(H):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(H):this._cullingRenders[this._cullingRendersLength]=H,H._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},H.removeFrustumCullingObject=function(H){if(this.treeRoot)this.removeTreeNode(H);else{this._cullingRendersLength--;var n=H._indexInSceneFrustumCullingObjects;if(n!==this._cullingRendersLength){var C=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[n]=C)._indexInSceneFrustumCullingObjects=n,H._indexInSceneFrustumCullingObjects=-1}}},H.getRenderQueue=function(H){return H<3e3?this._quenes[1]||(this._quenes[1]=new G(this)):this._quenes[2]||(this._quenes[2]=new G(this))},H.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new G(this)},H.addShaderDefine=function(H){this._shaderDefineValue|=H},H.removeShaderDefine=function(H){this._shaderDefineValue&=~H},H.addScript=function(H){return this._addComponent(H)},H.getScriptByType=function(H,n){return void 0===n&&(n=0),this._getComponentByType(H,n)},H.getScriptsByType=function(H,n){this._getComponentsByType(H,n)},H.getScriptByIndex=function(H){return this._getComponentByIndex(H)},H.removeScriptByType=function(H,n){void 0===n&&(n=0),this._removeComponentByType(H,n)},H.removeScriptsByType=function(H){this._removeComponentByType(H)},H.removeAllScript=function(){this._removeAllComponent()},H.render=function(H,n,C){(j._context.ctx._renderKey=0)<this._childs.length&&H.addRenderObject(this)},H.renderSubmit=function(){var H=b.mainContext,n=this._renderState;this._set3DRenderConfig(H),this._prepareSceneToRender(this._renderState);var C,r=0,N=0;if(Wn.debugMode||Y.debugMode)for(r=0,N=this._cameraPool.length;r<N;r++)C=this._cameraPool[r],Wn._debugPhasorSprite.begin(1,C),C.activeInHierarchy&&C._renderCamera(H,n,this),Wn._debugPhasorSprite.end();else for(r=0,N=this._cameraPool.length;r<N;r++)(C=this._cameraPool[r]).activeInHierarchy&&C._renderCamera(H,n,this);return this._set2DRenderConfig(H),1},H.onAsynLoaded=function(H,n,C){var r=n[0];if("Scene"!==r.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var N=n[1];Kn._createNodeByJson(this,r,this,N),this.event("hierarchyloaded",[this]),this.__loaded=!0},H.destroy=function(H){void 0===H&&(H=!0),this.destroyed||(n.prototype.destroy.call(this,H),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,f.clearRes(this.url),this.loaded||Wn._cancelLoadByUrl(this.url))},H.getRenderType=function(){return 0},H.releaseRender=function(){},H._addComponent=function(H){var n,C=this._componentsMap.indexOf(H);if(-1===C)n=[],this._componentsMap.push(H),this._typeComponentsIndices.push(n);else if(n=this._typeComponentsIndices[C],this._components[n[0]].isSingleton)throw new Error("无法单实例创建"+H+"组件，"+H+"组件已存在！");var r=P.getInstance(H);n.push(this._components.length),this._components.push(r);return r._initialize(this),r},H._removeComponent=function(H,n){var C=this._typeComponentsIndices[H],r=C[n],N=this._components[r];this._components.splice(r,1),C.splice(n,1),0===C.length&&(this._typeComponentsIndices.splice(H,1),this._componentsMap.splice(H,1));for(var Q=0,I=this._componentsMap.length;Q<I;Q++)for(var A=(C=this._typeComponentsIndices[Q]).length-1;0<=A;A--){var P=C[A];if(!(r<P))break;C[A]=--P}N._destroy()},H._getComponentByType=function(H,n){void 0===n&&(n=0);var C=this._componentsMap.indexOf(H);return-1===C?null:this._components[this._typeComponentsIndices[C][n]]},H._getComponentsByType=function(H,n){var C=this._componentsMap.indexOf(H);if(-1!==C){var r=this._typeComponentsIndices[C],N=r.length;n.length=N;for(var Q=0;Q<N;Q++)n[Q]=this._components[r[Q]]}else n.length=0},H._getComponentByIndex=function(H){return this._components[H]},H._removeComponentByType=function(H,n){void 0===n&&(n=0);var C=this._componentsMap.indexOf(H);-1!==C&&this._removeComponent(C,n)},H._removeComponentsByType=function(H){var n=this._componentsMap.indexOf(H);if(-1!==n)for(var C=this._typeComponentsIndices[n],r=0,N=C.length;r<N;C.length<N?N--:r++)this._removeComponent(n,r)},H._removeAllComponent=function(){for(var H=0,n=this._componentsMap.length;H<n;this._componentsMap.length<n?n--:H++)this._removeComponentsByType(this._componentsMap[H])},H._updateComponents=function(H){for(var n=0,C=this._components.length;n<C;n++){var r=this._components[n];!r.started&&(r._start(H),r.started=!0),r.enable&&r._update(H)}},H._lateUpdateComponents=function(H){for(var n=0;n<this._components.length;n++){var C=this._components[n];!C.started&&(C._start(H),C.started=!0),C.enable&&C._lateUpdate(H)}},H._preRenderUpdateComponents=function(H){for(var n=0;n<this._components.length;n++){var C=this._components[n];!C.started&&(C._start(H),C.started=!0),C.enable&&C._preRenderUpdate(H)}},H._postRenderUpdateComponents=function(H){for(var n=0;n<this._components.length;n++){var C=this._components[n];!C.started&&(C._start(H),C.started=!0),C.enable&&C._postRenderUpdate(H)}},M(0,H,"_loaded",null,function(H){this.__loaded=H}),M(0,H,"fogColor",function(){return this._fogColor},function(H){this._fogColor=H,this._shaderValues.setValue(0,H.elements)}),M(0,H,"enableFog",function(){return this._enableFog},function(H){this._enableFog!==H&&((this._enableFog=H)?(this.addShaderDefine(Ln.SHADERDEFINE_FOG),this.removeShaderDefine(Ln.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(Ln.SHADERDEFINE_FOG))}),M(0,H,"url",function(){return this._url}),M(0,H,"loaded",function(){return this.__loaded}),M(0,H,"enableDepthFog",function(){return this._enableDepthFog},function(H){this._enableDepthFog!=H&&((this._enableDepthFog=H)?(this.addShaderDefine(Ln.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(Ln.SHADERDEFINE_FOG)):this.removeShaderDefine(Ln.SAHDERDEFINE_DEPTHFOG))}),M(0,H,"fogStart",function(){return this._fogStart},function(H){this._fogStart=H,this._shaderValues.setValue(1,H)}),M(0,H,"fogRange",function(){return this._fogRange},function(H){this._fogRange=H,this._shaderValues.setValue(2,H)}),M(0,H,"ambientColor",function(){return this._ambientColor},function(H){this._ambientColor=H,this._shaderValues.setValue(21,H.elements)}),M(0,H,"scene",function(){return this}),M(0,H,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),r._sortScenes=function(H,n){if(H.parent!==z.stage||n.parent!==z.stage)return H.parent!==z.stage&&n.parent!==z.stage?r._sortScenes(H.parent,n.parent):H.parent===z.stage?-1:1;var C=z.stage._childs;return C.indexOf(H)-C.indexOf(n)},r.load=function(H){return z.loader.create(H,null,null,r)},r.FOGCOLOR=0,r.FOGSTART=1,r.FOGRANGE=2,r.LIGHTDIRECTION=3,r.LIGHTDIRCOLOR=4,r.POINTLIGHTPOS=5,r.POINTLIGHTRANGE=6,r.POINTLIGHTATTENUATION=7,r.POINTLIGHTCOLOR=8,r.SPOTLIGHTPOS=9,r.SPOTLIGHTDIRECTION=10,r.SPOTLIGHTSPOT=11,r.SPOTLIGHTRANGE=12,r.SPOTLIGHTATTENUATION=13,r.SPOTLIGHTCOLOR=14,r.SHADOWDISTANCE=15,r.SHADOWLIGHTVIEWPROJECT=16,r.SHADOWMAPPCFOFFSET=17,r.SHADOWMAPTEXTURE1=18,r.SHADOWMAPTEXTURE2=19,r.SHADOWMAPTEXTURE3=20,r.AMBIENTCOLOR=21,r.TIME=22,r}(F),sn=function(H){function n(H){n.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new nn,this._shaderValues=new Mn,this._colliders=[],this._id=++n._uniqueIDCounter,this._transform=new an(this),this.name=H||"Sprite3D-"+n._nameNumberCounter++,this.layer=e.currentCreationLayer,this.active=!0}g(n,"laya.d3.core.Sprite3D",vn);var C=n.prototype;return z.imps(C,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),C._setUrl=function(H){this._url=H},C._getGroup=function(){return this._group},C._setGroup=function(H){this._group=H},C._addChild3D=function(H){H.transform.parent=this.transform,this._hierarchyAnimator&&(!H._hierarchyAnimator&&H._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(H,!0,[H.name])),this._scene&&(H._setBelongScene(this._scene),this._activeInHierarchy&&H._active&&H._activeHierarchy())},C._removeChild3D=function(H){H.transform.parent=null,this._scene&&(this._activeInHierarchy&&H._active&&H._inActiveHierarchy(),H._setUnBelongScene()),this._hierarchyAnimator&&(H._hierarchyAnimator==this._hierarchyAnimator&&H._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(H,!1,[H.name]))},C._parseBaseCustomProps=function(H){var n=this.transform.localPosition;H.translate?(n.fromArray(H.translate),n.x*=100,n.y*=100,n.z*=100):n.elements.fill(0),this.transform.localPosition=n;var C=this.transform.localRotation;H.rotation?C.fromArray(H.rotation):C.fromArray([0,0,0,-1]),this.transform.localRotation=C;var r=this.transform.localScale;H.scale?r.fromArray(H.scale):r.elements.fill(1),this.transform.localScale=r;var N=H.layer;null!=N&&(this.layer=e.getLayerByNumber(N))},C._parseCustomComponent=function(H,n,C){for(var r in C){var N=C[r];switch(r){case"Animator":var Q=this.addComponent(Animator);if(N.avatarPath)Q.avatar=f.getRes(n[N.avatarPath]);else{var I=N.avatar;if(I){Q.avatar=f.getRes(n[I.path]);var A=I.linkSprites;A&&H.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[Q,A])}}for(var P=N.clipPaths,t=P.length,R=0;R<t;R++)Q.addClip(f.getRes(n[P[R]]));Q.clip=f.getRes(n[P[0]]);var y=N.playOnWake;void 0!==y&&(Q.playOnWake=y);break;case"Rigidbody":this.addComponent(mn);break;case"SphereCollider":var o=this.addComponent(SphereCollider);o.isTrigger=N.isTrigger;var g=o.center;g.fromArray(N.center),o.center=g,o.radius=N.radius;break;case"BoxCollider":var M=this.addComponent(Tn);M.isTrigger=N.isTrigger,M.center.fromArray(N.center);var j=M.size;j.fromArray(N.size),M.size=j;break;case"MeshCollider":this.addComponent(MeshCollider)}}},C._onRootNodeHierarchyLoaded=function(H,n){for(var C in n){for(var r=this,N=n[C],Q=0,I=N.length;Q<I;Q++){var A=N[Q];if(""===A)break;if(!(r=r.getChildByName(A)))break}r&&H.linkSprite3DToAvatarNode(C,r)}},C._setHierarchyAnimator=function(H,n){this._changeHierarchyAnimator(H);for(var C=0,r=this._childs.length;C<r;C++){var N=this._childs[C];N._hierarchyAnimator==n&&N._setHierarchyAnimator(H,n)}},C._clearHierarchyAnimator=function(H,n){this._changeHierarchyAnimator(n);for(var C=0,r=this._childs.length;C<r;C++){var N=this._childs[C];N._hierarchyAnimator==H&&N._clearHierarchyAnimator(H,n)}},C._getAnimatorToLinkSprite3D=function(H,n,C){var r=this.getComponentByType(Animator);if(r&&(r.avatar?r.avatar._version||H._setAnimatorToLinkAvatar(r,n):H._setAnimatorToLinkSprite3DNoAvatar(r,n,C)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){C.unshift(this._parent.name);var N=this._parent;N._hierarchyAnimator&&N._getAnimatorToLinkSprite3D(H,n,C)}},C._setAnimatorToLinkSprite3DNoAvatar=function(H,n,C){var r=0,N=0;for(r=0,N=H.getClipCount();r<N;r++)H._handleSpriteOwnersBySprite(r,n,C,this);for(r=0,N=this._childs.length;r<N;r++){var Q=this._childs[r],I=C.length;C.push(Q.name),Q._setAnimatorToLinkSprite3DNoAvatar(H,n,C),C.splice(I,1)}},C._changeHierarchyAnimator=function(H){this._hierarchyAnimator=H},C._isLinkSpriteToAnimationNode=function(H,n,C){var r=H._avatarNodes.indexOf(n),N=H._cacheSpriteToNodesMap;if(C)this._transform.dummy=n.transform,H._cacheNodesToSpriteMap[r]=N.length,N.push(r);else{this._transform.dummy=null;var Q=H._cacheNodesToSpriteMap[r];H._cacheNodesToSpriteMap[r]=null,N.splice(Q,1)}},C._setBelongScene=function(H){this._scene=H;for(var n=0,C=this._childs.length;n<C;n++)this._childs[n]._setBelongScene(H)},C._setUnBelongScene=function(){this._scene=null;for(var H=0,n=this._childs.length;H<n;H++)this._childs[H]._setUnBelongScene()},C._activeHierarchy=function(){var H=0,n=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),H=0,n=this._colliders.length;H<n;H++)this._layer._addCollider(this._colliders[H]);for(this.event("activeinhierarchychanged",!0),H=0,n=this._childs.length;H<n;H++){var C=this._childs[H];C._active&&C._activeHierarchy()}},C._inActiveHierarchy=function(){var H=0,n=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),H=0,n=this._colliders.length;H<n;H++){var C=this._colliders[H];C._clearCollsionMap(),this._layer._removeCollider(C)}for(this.event("activeinhierarchychanged",!1),H=0,n=this._childs.length;H<n;H++){var r=this._childs[H];r._active&&r._inActiveHierarchy()}},C.addComponent=function(H){var n,C=this._componentsMap.indexOf(H);if(-1===C)n=[],this._componentsMap.push(H),this._typeComponentsIndices.push(n);else if(n=this._typeComponentsIndices[C],this._components[n[0]].isSingleton)throw new Error("无法单实例创建"+H+"组件，"+H+"组件已存在！");var r=P.getInstance(H);if(n.push(this._components.length),this._components.push(r),r instanceof laya.d3.component.physics.Collider)this.getComponentByType(mn)&&(r._isRigidbody=!0),this._activeInHierarchy&&this._layer._addCollider(r),this._colliders.push(r);else if(r instanceof laya.d3.component.Rigidbody)for(var N=0,Q=this._colliders.length;N<Q;N++)this._colliders[N]._setIsRigidbody(!0);return r instanceof laya.d3.component.Script&&this._scripts.push(r),r._initialize(this),r},C._removeComponent=function(H,n){var C=0,r=0,N=this._typeComponentsIndices[H],Q=N[n],I=this._components[Q];if(I instanceof laya.d3.component.physics.Collider){var A=I;this._activeInHierarchy&&this._layer._removeCollider(A),this._colliders.splice(this._colliders.indexOf(A),1)}else if(I instanceof laya.d3.component.Rigidbody)for(C=0,r=this._colliders.length;C<r;C++){var P=this._colliders[C];P._setIsRigidbody(!1);var t=P._runtimeCollisonMap,R=P._runtimeCollisonTestMap;for(var y in t)delete R[y]}for(I instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(I),1),N.splice(n,1),0===N.length&&(this._typeComponentsIndices.splice(H,1),this._componentsMap.splice(H,1)),C=0,r=this._componentsMap.length;C<r;C++)for(var o=(N=this._typeComponentsIndices[C]).length-1;0<=o;o--){var g=N[o];if(!(Q<g))break;N[o]=--g}I._destroy()},C._clearSelfRenderObjects=function(){},C._addSelfRenderObjects=function(){},C._parseCustomProps=function(H,n,C,r){},C._updateChilds=function(H){var n=this._childs.length;if(0!==n)for(var C=0;C<n;++C)this._childs[C]._update(H)},C._getSortID=function(H,n){return 1e3*n.id+H._getVertexBuffer().vertexDeclaration.id},C._update=function(H){(H.owner=this)._activeInHierarchy&&(this._updateComponents(H),this._lateUpdateComponents(H),k.spriteCount++,this._childs.length&&this._updateChilds(H))},C.getProjectionViewWorldMatrix=function(H){return nn.multiply(H,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},C.loadHierarchy=function(H){this.addChild(laya.d3.core.Sprite3D.load(H))},C.addChildAt=function(H,n){if(!(H instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!H||this.destroyed||H===this)return H;if(H.zOrder&&this._set$P("hasZorder",!0),0<=n&&n<=this._childs.length){if(H._parent===this){var C=this.getChildIndex(H);this._childs.splice(C,1),this._childs.splice(n,0,H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,n)),this._childChanged()}else H.parent&&H.parent.removeChild(H),this._childs===R.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(n,0,H),this.conchModel&&this.conchModel.addChildAt(H.conchModel,n),(H.parent=this)._addChild3D(H);return H}throw new Error("appendChildAt:The index is out of bounds")},C.addChild=function(H){if(!(H instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!H||this.destroyed||H===this)return H;if(H.zOrder&&this._set$P("hasZorder",!0),H._parent===this){var n=this.getChildIndex(H);n!==this._childs.length-1&&(this._childs.splice(n,1),this._childs.push(H),this.conchModel&&(this.conchModel.removeChild(H.conchModel),this.conchModel.addChildAt(H.conchModel,this._childs.length-1)),this._childChanged())}else H.parent&&H.parent.removeChild(H),this._childs===R.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(H),this.conchModel&&this.conchModel.addChildAt(H.conchModel,this._childs.length-1),(H.parent=this)._childChanged(),this._addChild3D(H);return H},C.removeChildAt=function(H){var n=this.getChildAt(H);return n&&(this._removeChild3D(n),this._childs.splice(H,1),this.conchModel&&this.conchModel.removeChild(n.conchModel),n.parent=null),n},C.removeChildren=function(H,n){if(void 0===H&&(H=0),void 0===n&&(n=2147483647),this._childs&&0<this._childs.length){var C=this._childs;if(0===H&&Q<=n){var r=C;this._childs=R.ARRAY_EMPTY}else r=C.splice(H,n-H);for(var N=0,Q=r.length;N<Q;N++)this._removeChild3D(r[N]),r[N].parent=null,this.conchModel&&this.conchModel.removeChild(r[N].conchModel)}return this},C.onAsynLoaded=function(H,n,C){var r=n[0];if("Sprite3D"!==r.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var N=n[1];Kn._createNodeByJson(this,r,this,N),this.event("hierarchyloaded",[this]),this.__loaded=!0},C.cloneTo=function(H){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var n=H;n.name=this.name,n._destroyed=this._destroyed,n.timer=this.timer,n._$P=this._$P,n.active=this._active;var C=n.transform.localPosition;this.transform.localPosition.cloneTo(C),n.transform.localPosition=C;var r=n.transform.localRotation;this.transform.localRotation.cloneTo(r),n.transform.localRotation=r;var N=n.transform.localScale;this.transform.localScale.cloneTo(N),n.transform.localScale=N,n.isStatic=this.isStatic;var Q=0,I=0;for(Q=0,I=this._componentsMap.length;Q<I;Q++){var A=n.addComponent(this._componentsMap[Q]);this._components[Q]._cloneTo(A)}for(Q=0,I=this._childs.length;Q<I;Q++)n.addChild(this._childs[Q].clone());var P=n.getComponentByType(Animator);if(P){var t=P._linkSpritesData;if(t)for(var R in t){for(var y=t[R],o=n,g=0,M=y.length;g<M&&(o=o.getChildByName(y[g]));g++);if(o){var j=P._avatarNodeMap[R];o._isLinkSpriteToAnimationNode(P,j,!0)}}}},C.clone=function(){var H=new this.constructor;return this.cloneTo(H),H},C.destroy=function(H){if(void 0===H&&(H=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,H);var n,C=0;for(C=0,n=this._components.length;C<n;C++)this._components[C]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,f.clearRes(this.url),this.loaded||Wn._cancelLoadByUrl(this.url)}},C._handleSpriteToAvatar=function(H,n){H._avatarNodes;var C=H._avatarNodeMap[this.name];C&&C.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(H,C,n)},C._setAnimatorToLinkAvatar=function(H,n){this._handleSpriteToAvatar(H,n);for(var C=0,r=this._childs.length;C<r;C++){this._childs[C]._setAnimatorToLinkAvatar(H,n)}},M(0,C,"activeInHierarchy",function(){return this._activeInHierarchy}),M(0,C,"_loaded",null,function(H){this.__loaded=H}),M(0,C,"active",function(){return this._active},function(H){this._active!==H&&(this._active=H,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(H?this._activeHierarchy():this._inActiveHierarchy()))}),M(0,C,"componentsCount",function(){return this._components.length}),M(0,C,"loaded",function(){return this.__loaded}),M(0,C,"id",function(){return this._id}),M(0,C,"url",function(){return this._url}),M(0,C,"layer",function(){return this._layer},function(H){if(this._layer!==H){if(!H)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var n=0,C=this._colliders.length;if(this._layer)for(n=0;n<C;n++)this._layer._removeCollider(this._colliders[n]);for(n=0;n<C;n++)H._addCollider(this._colliders[n])}this._layer=H,this.event("layerchanged",H)}}),M(0,C,"scene",function(){return this._scene}),M(0,C,"transform",function(){return this._transform}),n.instantiate=function(H,n,C,r,N){void 0===C&&(C=!0);var Q=H.clone();n&&n.addChild(Q);var I=Q.transform;if(C){var A=I.worldMatrix;H.transform.worldMatrix.cloneTo(A),I.worldMatrix=A}else r&&(I.position=r),N&&(I.rotation=N);return Q},n.load=function(H){return z.loader.create(H,null,null,n)},n.WORLDMATRIX=0,n.MVPMATRIX=1,n._uniqueIDCounter=0,n._nameNumberCounter=0,n}(),$n=function(H){function R(H,n,C,r,N,Q,I,A,P,t){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],R.__super.call(this),!H||!n)throw"Shader Error";this._id=++R._count,this._vs=H,this._ps=n,this._attributeMap=C,this._sceneUniformMap=r,this._cameraUniformMap=N,this._spriteUniformMap=Q,this._materialUniformMap=I,this._renderElementUniformMap=A,this._precompile=P,this._define=t,this._precompile&&R.extCompileObj&&R.extCompileFunc?R.extCompileFunc.call(R.extCompileObj,H,n,t):this.recreateResource()}g(R,"laya.d3.shader.Shader3D",C);var n=R.prototype;return n.recreateResource=function(){v.now();this._compile(),this.completeCreate(),this.memorySize=0},n.disposeResource=function(){b.mainContext.deleteShader(this._vshader),b.mainContext.deleteShader(this._pshader),b.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},n._compile=function(){if(!b.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var H=[this._vs,this._ps],n=b.mainContext;if(this._program=n.createProgram(),this._vshader=R._createShader(n,H[0],35633),this._pshader=R._createShader(n,H[1],35632),n.attachShader(this._program,this._vshader),n.attachShader(this._program,this._pshader),n.linkProgram(this._program),!j.isConchApp&&Ln.debugMode&&!n.getProgramParameter(this._program,35714))throw n.getProgramInfoLog(this._program);var C,r=0,N=0,Q=0;for(Q=j.isConchApp?n.getProgramParameterEx(this._vs,this._ps,"",35721):n.getProgramParameter(this._program,35721),r=0;r<Q;r++){var I=null;C={vartype:"attribute",ivartype:0,attrib:I=j.isConchApp?n.getActiveAttribEx(this._vs,this._ps,"",r):n.getActiveAttrib(this._program,r),location:n.getAttribLocation(this._program,I.name),name:I.name,type:I.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(C)}var A=0;for(A=j.isConchApp?n.getProgramParameterEx(this._vs,this._ps,"",35718):n.getProgramParameter(this._program,35718),r=0;r<A;r++){var P=null;P=j.isConchApp?n.getActiveUniformEx(this._vs,this._ps,"",r):n.getActiveUniform(this._program,r),0<(C={vartype:"uniform",ivartype:1,attrib:I,location:n.getUniformLocation(this._program,P.name),name:P.name,type:P.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(C.name=C.name.substr(0,C.name.length-3),C.isArray=!0,C.location=n.getUniformLocation(this._program,C.name)),this._uniformParams.push(C)}for(r=0,N=this._attributeParams.length;r<N;r++)(C=this._attributeParams[r]).indexOfParams=r,C.index=1,C.value=[C.location,null],C.codename=C.name,C.name=null!=this._attributeMap[C.codename]?this._attributeMap[C.codename]:C.codename,this._attributeParamsMap.push(C.name),this._attributeParamsMap.push(C),C._this=this,C.uploadedValue=[],C.fun=this._attribute;for(r=0,N=this._uniformParams.length;r<N;r++)switch((C=this._uniformParams[r]).indexOfParams=r,C.index=1,C.value=[C.location,null],C.codename=C.name,null!=this._sceneUniformMap[C.codename]?(C.name=this._sceneUniformMap[C.codename],this._sceneUniformParamsMap.push(C.name),this._sceneUniformParamsMap.push(C)):null!=this._cameraUniformMap[C.codename]?(C.name=this._cameraUniformMap[C.codename],this._cameraUniformParamsMap.push(C.name),this._cameraUniformParamsMap.push(C)):null!=this._spriteUniformMap[C.codename]?(C.name=this._spriteUniformMap[C.codename],this._spriteUniformParamsMap.push(C.name),this._spriteUniformParamsMap.push(C)):null!=this._materialUniformMap[C.codename]?(C.name=this._materialUniformMap[C.codename],this._materialUniformParamsMap.push(C.name),this._materialUniformParamsMap.push(C)):null!=this._renderElementUniformMap[C.codename]?(C.name=this._renderElementUniformMap[C.codename],this._renderElementUniformParamsMap.push(C.name),this._renderElementUniformParamsMap.push(C)):console.log("Shader:can't find uinform name:"+C.codename+" in shader file."),C._this=this,C.uploadedValue=[],C.type){case 5124:C.fun=C.isArray?this._uniform1iv:this._uniform1i;break;case 5126:C.fun=C.isArray?this._uniform1fv:this._uniform1f;break;case 35664:C.fun=C.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:C.fun=C.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:C.fun=C.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:C.fun=this._uniform_sampler2D;break;case 35680:C.fun=this._uniform_samplerCube;break;case 35676:C.fun=this._uniformMatrix4fv;break;case 35670:C.fun=this._uniform1i;break;case 35674:C.fun=this._uinformMatrix2fv;break;case 35675:C.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},n._attribute=function(H,n){var C=b.mainContext,r=A._enableAtributes,N=H.location;return r[N]||C.enableVertexAttribArray(N),C.vertexAttribPointer(N,n[0],n[1],n[2],n[3],n[4]),r[N]=A._bindVertexBuffer,1},n._uniform1f=function(H,n){var C=H.uploadedValue;return C[0]!==n?(b.mainContext.uniform1f(H.location,C[0]=n),1):0},n._uniform1fv=function(H,n){if(n.length<4){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(b.mainContext.uniform1fv(H.location,n),C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3],1):0}return b.mainContext.uniform1fv(H.location,n),1},n._uniform_vec2=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]?(b.mainContext.uniform2f(H.location,C[0]=n[0],C[1]=n[1]),1):0},n._uniform_vec2v=function(H,n){if(n.length<2){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(b.mainContext.uniform2fv(H.location,n),C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3],1):0}return b.mainContext.uniform2fv(H.location,n),1},n._uniform_vec3=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]?(b.mainContext.uniform3f(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2]),1):0},n._uniform_vec3v=function(H,n){return b.mainContext.uniform3fv(H.location,n),1},n._uniform_vec4=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(b.mainContext.uniform4f(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3]),1):0},n._uniform_vec4v=function(H,n){return b.mainContext.uniform4fv(H.location,n),1},n._uniformMatrix2fv=function(H,n){return b.mainContext.uniformMatrix2fv(H.location,!1,n),1},n._uniformMatrix3fv=function(H,n){return b.mainContext.uniformMatrix3fv(H.location,!1,n),1},n._uniformMatrix4fv=function(H,n){return b.mainContext.uniformMatrix4fv(H.location,!1,n),1},n._uinformMatrix2fv=function(H,n){return b.mainContext.uniformMatrix2fv(H.location,!1,n),1},n._uinformMatrix3fv=function(H,n){return b.mainContext.uniformMatrix3fv(H.location,!1,n),1},n._uniform1i=function(H,n){var C=H.uploadedValue;return C[0]!==n?(b.mainContext.uniform1i(H.location,C[0]=n),1):0},n._uniform1iv=function(H,n){return b.mainContext.uniform1iv(H.location,n),1},n._uniform_ivec2=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]?(b.mainContext.uniform2i(H.location,C[0]=n[0],C[1]=n[1]),1):0},n._uniform_ivec2v=function(H,n){return b.mainContext.uniform2iv(H.location,n),1},n._uniform_vec3i=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]?(b.mainContext.uniform3i(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2]),1):0},n._uniform_vec3vi=function(H,n){return b.mainContext.uniform3iv(H.location,n),1},n._uniform_vec4i=function(H,n){var C=H.uploadedValue;return C[0]!==n[0]||C[1]!==n[1]||C[2]!==n[2]||C[3]!==n[3]?(b.mainContext.uniform4i(H.location,C[0]=n[0],C[1]=n[1],C[2]=n[2],C[3]=n[3]),1):0},n._uniform_vec4vi=function(H,n){return b.mainContext.uniform4iv(H.location,n),1},n._uniform_sampler2D=function(H,n){var C=n.source||n.defaulteTexture.source,r=b.mainContext,N=H.uploadedValue;if(null!=N[0])return r.activeTexture(R._TEXTURES[N[0]]),C&&h.bindTexture(r,3553,C),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return N[0]=this._curActTexIndex,r.uniform1i(H.location,this._curActTexIndex),r.activeTexture(R._TEXTURES[this._curActTexIndex]),C&&h.bindTexture(r,3553,C),this._curActTexIndex++,1},n._uniform_samplerCube=function(H,n){var C=n.source||n.defaulteTexture.source,r=b.mainContext,N=H.uploadedValue;if(null!=N[0])return r.activeTexture(R._TEXTURES[N[0]]),C?h.bindTexture(r,34067,C):h.bindTexture(r,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return N[0]=this._curActTexIndex,r.uniform1i(H.location,this._curActTexIndex),r.activeTexture(R._TEXTURES[this._curActTexIndex]),C?h.bindTexture(r,34067,C):h.bindTexture(r,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},n._noSetValue=function(H){console.log("no....:"+H.name)},n.bind=function(){return C.activeShader=this,(C.bindShader=this).activeResource(),h.UseProgram(this._program)},n.uploadAttributes=function(H,n){for(var C,r,N=0,Q=0,I=this._attributeParamsMap.length;Q<I;Q+=2)r=this._attributeParamsMap[Q+1],null!=(C=H[this._attributeParamsMap[Q]])&&(n&&n[r.name]&&n[r.name].bind(),N+=r.fun.call(this,r,C));k.shaderCall+=N},n.uploadAttributesX=function(H,n){for(var C,r,N=0,Q=0,I=this._attributeParamsMap.length;Q<I;Q+=2)r=this._attributeParamsMap[Q+1],null!=(C=H[this._attributeParamsMap[Q]])&&(n._bind(),N+=r.fun.call(this,r,C));k.shaderCall+=N},n.uploadSceneUniforms=function(H){for(var n,C,r=0,N=0,Q=this._sceneUniformParamsMap.length;N<Q;N+=2)C=this._sceneUniformParamsMap[N+1],null!=(n=H[this._sceneUniformParamsMap[N]])&&(r+=C.fun.call(this,C,n));k.shaderCall+=r},n.uploadCameraUniforms=function(H){for(var n,C,r=0,N=0,Q=this._cameraUniformParamsMap.length;N<Q;N+=2)C=this._cameraUniformParamsMap[N+1],null!=(n=H[this._cameraUniformParamsMap[N]])&&(r+=C.fun.call(this,C,n));k.shaderCall+=r},n.uploadSpriteUniforms=function(H){for(var n,C,r=0,N=0,Q=this._spriteUniformParamsMap.length;N<Q;N+=2)C=this._spriteUniformParamsMap[N+1],null!=(n=H[this._spriteUniformParamsMap[N]])&&(r+=C.fun.call(this,C,n));k.shaderCall+=r},n.uploadMaterialUniforms=function(H){for(var n,C,r=0,N=0,Q=this._materialUniformParamsMap.length;N<Q;N+=2)C=this._materialUniformParamsMap[N+1],null!=(n=H[this._materialUniformParamsMap[N]])&&(r+=C.fun.call(this,C,n));k.shaderCall+=r},n.uploadRenderElementUniforms=function(H){for(var n,C,r=0,N=0,Q=this._renderElementUniformParamsMap.length;N<Q;N+=2)C=this._renderElementUniformParamsMap[N+1],null!=(n=H[this._renderElementUniformParamsMap[N]])&&(r+=C.fun.call(this,C,n));k.shaderCall+=r},R.create=function(H,n,C,r,N,Q,I,A,P,t){return new R(H,n,C,r,N,Q,I,A,P,t)},R.addInclude=function(H,n){K.addInclude(H,n)},R._createShader=function(H,n,C){var r=H.createShader(C);if(H.shaderSource(r,n),H.compileShader(r),Ln.debugMode&&!H.getShaderParameter(r,35713))throw H.getShaderInfoLog(r);return r},R.PERIOD_RENDERELEMENT=0,R.PERIOD_MATERIAL=1,R.PERIOD_SPRITE=2,R.PERIOD_CAMERA=3,R.PERIOD_SCENE=4,R._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],R._count=0,R._preCompile=!1,R.extCompileFunc=null,R.extCompileObj=null,y(R,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new i}]),R}(),xn=function(A){function P(){this._transformUV=null,P.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new Pn(.6,.6,.6)),this._setColor(10,new Pn(1,1,1)),this._setColor(11,new tn(1,1,1,8)),this._setColor(12,new Pn(1,1,1)),this._setColor(7,new tn(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new tn(1,1,0,0)),this.renderMode=1}g(P,"laya.d3.core.material.StandardMaterial",A);var H=P.prototype;return H.disableLight=function(){this._addDisablePublicShaderDefine(Ln.SHADERDEFINE_POINTLIGHT|Ln.SHADERDEFINE_SPOTLIGHT|Ln.SHADERDEFINE_DIRECTIONLIGHT)},H.disableFog=function(){this._addDisablePublicShaderDefine(Ln.SHADERDEFINE_FOG)},H.onAsynLoaded=function(H,n,C){var r=n[0];if(r.version)A.prototype.onAsynLoaded.call(this,H,n,C);else{var N=n[1],Q=r.props;for(var I in Q)this[I]=Q[I];P._parseStandardMaterial(N,this,r),this._endLoaded()}},H.cloneTo=function(H){A.prototype.cloneTo.call(this,H);var n=H;this._transformUV&&(n._transformUV=this._transformUV.clone())},M(0,H,"ambientColor",function(){return this._getColor(9)},function(H){this._setColor(9,H)}),M(0,H,"ambientTexture",function(){return this._getTexture(5)},function(H){H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,H)}),M(0,H,"renderMode",null,function(H){switch(H){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(P.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(H)}),M(0,H,"reflectColor",function(){return this._getColor(12)},function(H){this._setColor(12,H)}),M(0,H,"tilingOffset",function(){return this._getColor(15)},function(H){if(H){var n=H.elements;1!=n[0]||1!=n[1]||0!=n[2]||0!=n[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,H)}),M(0,H,"albedo",function(){return this._getColor(7)},function(H){this._setColor(7,H)}),M(0,H,"diffuseColor",function(){return this._getColor(10)},function(H){this._setColor(10,H)}),M(0,H,"albedoColor",function(){return this._getColor(7)},function(H){this._setColor(7,H)}),M(0,H,"specularColor",function(){return this._getColor(11)},function(H){this._setColor(11,H)}),M(0,H,"diffuseTexture",function(){return this._getTexture(1)},function(H){H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,H)}),M(0,H,"normalTexture",function(){return this._getTexture(2)},function(H){H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,H)}),M(0,H,"specularTexture",function(){return this._getTexture(3)},function(H){H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,H)}),M(0,H,"emissiveTexture",function(){return this._getTexture(4)},function(H){H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,H)}),M(0,H,"reflectTexture",function(){return this._getTexture(6)},function(H){H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,H)}),M(0,H,"transformUV",function(){return this._transformUV},function(H){this._transformUV=H,this._setMatrix4x4(13,H.matrix),H?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,H.matrix.elements,0)}),P.__init__=function(){P.SHADERDEFINE_DIFFUSEMAP=P.shaderDefines.registerDefine("DIFFUSEMAP"),P.SHADERDEFINE_NORMALMAP=P.shaderDefines.registerDefine("NORMALMAP"),P.SHADERDEFINE_SPECULARMAP=P.shaderDefines.registerDefine("SPECULARMAP"),P.SHADERDEFINE_EMISSIVEMAP=P.shaderDefines.registerDefine("EMISSIVEMAP"),P.SHADERDEFINE_AMBIENTMAP=P.shaderDefines.registerDefine("AMBIENTMAP"),P.SHADERDEFINE_REFLECTMAP=P.shaderDefines.registerDefine("REFLECTMAP"),P.SHADERDEFINE_UVTRANSFORM=P.shaderDefines.registerDefine("UVTRANSFORM"),P.SHADERDEFINE_TILINGOFFSET=P.shaderDefines.registerDefine("TILINGOFFSET"),P.SHADERDEFINE_ADDTIVEFOG=P.shaderDefines.registerDefine("ADDTIVEFOG")},P.load=function(H){return z.loader.create(H,null,null,P)},P._parseStandardMaterial=function(H,n,C){var r=C.customProps,N=r.ambientColor;n.ambientColor=new Pn(N[0],N[1],N[2]);var Q=r.diffuseColor;n.diffuseColor=new Pn(Q[0],Q[1],Q[2]);var I=r.specularColor;n.specularColor=new tn(I[0],I[1],I[2],I[3]);var A=r.reflectColor;n.reflectColor=new Pn(A[0],A[1],A[2]);var P=r.albedoColor;P&&(n.albedo=new tn(P[0],P[1],P[2],P[3]));var t=r.diffuseTexture.texture2D;t&&(n.diffuseTexture=f.getRes(H[t]));var R=r.normalTexture.texture2D;R&&(n.normalTexture=f.getRes(H[R]));var y=r.specularTexture.texture2D;y&&(n.specularTexture=f.getRes(H[y]));var o=r.emissiveTexture.texture2D;o&&(n.emissiveTexture=f.getRes(H[o]));var g=r.ambientTexture.texture2D;g&&(n.ambientTexture=f.getRes(H[g]));var M=r.reflectTexture.texture2D;M&&(n.reflectTexture=f.getRes(H[M]))},P.RENDERMODE_OPAQUE=1,P.RENDERMODE_OPAQUEDOUBLEFACE=2,P.RENDERMODE_CUTOUT=3,P.RENDERMODE_CUTOUTDOUBLEFACE=4,P.RENDERMODE_TRANSPARENT=13,P.RENDERMODE_TRANSPARENTDOUBLEFACE=14,P.RENDERMODE_ADDTIVE=15,P.RENDERMODE_ADDTIVEDOUBLEFACE=16,P.RENDERMODE_DEPTHREAD_TRANSPARENT=5,P.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,P.RENDERMODE_DEPTHREAD_ADDTIVE=7,P.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,P.RENDERMODE_NONDEPTH_TRANSPARENT=9,P.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,P.RENDERMODE_NONDEPTH_ADDTIVE=11,P.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,P.SHADERDEFINE_DIFFUSEMAP=0,P.SHADERDEFINE_NORMALMAP=0,P.SHADERDEFINE_SPECULARMAP=0,P.SHADERDEFINE_EMISSIVEMAP=0,P.SHADERDEFINE_AMBIENTMAP=0,P.SHADERDEFINE_REFLECTMAP=0,P.SHADERDEFINE_UVTRANSFORM=0,P.SHADERDEFINE_TILINGOFFSET=0,P.SHADERDEFINE_ADDTIVEFOG=0,P.DIFFUSETEXTURE=1,P.NORMALTEXTURE=2,P.SPECULARTEXTURE=3,P.EMISSIVETEXTURE=4,P.AMBIENTTEXTURE=5,P.REFLECTTEXTURE=6,P.ALBEDO=7,P.UVANIAGE=8,P.MATERIALAMBIENT=9,P.MATERIALDIFFUSE=10,P.MATERIALSPECULAR=11,P.MATERIALREFLECT=12,P.UVMATRIX=13,P.UVAGE=14,P.TILINGOFFSET=15,y(P,["defaultMaterial",function(){var H=new P;return H.lock=!0,this.defaultMaterial=H},"shaderDefines",function(){return this.shaderDefines=new on(en.shaderDefines)}]),P}(en),On=function(H){function I(H,n,C,r,N){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===C&&(C=35044),void 0===r&&(r=!1),I.__super.call(this),this._indexType=H,this._indexCount=n,this._bufferUsage=C,this._bufferType=34963,this._canRead=r;var Q;if("ushort"==H)this._indexTypeByteCount=2;else{if("ubyte"!=H)throw new Error("unidentification index type.");this._indexTypeByteCount=1}Q=this._indexTypeByteCount*n,this._byteLength=Q,this._bind(),A._gl.bufferData(this._bufferType,Q,this._bufferUsage),this.uri=N,r?("ushort"==H?this._buffer=new Uint16Array(n):"ubyte"==H&&(this._buffer=new Uint8Array(n)),this.memorySize=2*Q):this.memorySize=Q}g(I,"laya.d3.graphics.IndexBuffer3D",H);var n=I.prototype;return n.setData=function(H,n,C,r){void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=4294967295);var N=0;if("ushort"==this._indexType?(N=2,0===C&&4294967295===r||(H=new Uint16Array(H.buffer,C*N,r))):"ubyte"==this._indexType&&(N=1,0===C&&4294967295===r||(H=new Uint8Array(H.buffer,C*N,r))),this._bind(),A._gl.bufferSubData(this._bufferType,n*N,H),this._canRead)if(0!==n||0!==C||4294967295!==r){var Q=this._buffer.length-n;Q<r&&(r=Q);for(var I=0;I<r;I++)this._buffer[n+I]=H[I]}else this._buffer=H},n.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},n.disposeResource=function(){H.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},M(0,n,"indexType",function(){return this._indexType}),M(0,n,"indexTypeByteCount",function(){return this._indexTypeByteCount}),M(0,n,"indexCount",function(){return this._indexCount}),M(0,n,"canRead",function(){return this._canRead}),I.INDEXTYPE_UBYTE="ubyte",I.INDEXTYPE_USHORT="ushort",I.create=function(H,n,C,r,N){return void 0===C&&(C=35044),void 0===r&&(r=!1),new I(H,n,C,r,N)},I}(A),Sn=function(Q){function I(H,n,C,r,N){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===r&&(r=!1),I.__super.call(this),this._vertexDeclaration=H,this._vertexCount=n,this._bufferUsage=C,this._bufferType=34962,this._canRead=r,this.uri=N,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*n,this._bind(),A._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),r&&(this._buffer=new Float32Array(this._byteLength/4))}g(I,"laya.d3.graphics.VertexBuffer3D",Q);var H=I.prototype;return H.bindWithIndexBuffer=function(H){H&&H._bind(),this._bind()},H.setData=function(H,n,C,r){if(void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=4294967295),0===C&&4294967295===r||(H=new Float32Array(H.buffer,4*C,r)),this._bind(),A._gl.bufferSubData(this._bufferType,4*n,H),this._canRead)if(0!==n||0!==C||4294967295!==r){var N=this._buffer.length-n;N<r&&(r=N);for(var Q=0;Q<r;Q++)this._buffer[n+Q]=H[Q]}else this._buffer=H},H.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},H.disposeResource=function(){for(var H=b.mainContext,n=this._vertexDeclaration.getVertexElements(),C=A._enableAtributes,r=0,N=n.length;r<N;r++)C[r]===this._glBuffer&&(H.disableVertexAttribArray(r),C[r]=null);Q.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},M(0,H,"vertexDeclaration",function(){return this._vertexDeclaration}),M(0,H,"vertexCount",function(){return this._vertexCount}),M(0,H,"canRead",function(){return this._canRead}),I.create=function(H,n,C,r,N){return void 0===C&&(C=35044),void 0===r&&(r=!1),new I(H,n,C,r,N)},I}(A),Tn=function(H){function P(){this._size=null,this._transformOrientedBoundBox=null,this.center=null,P.__super.call(this),this._needUpdate=!1}g(P,"laya.d3.component.physics.BoxCollider",pn);var n=P.prototype;return n._updateCollider=function(){if(this._needUpdate){var H=this._transformOrientedBoundBox.transformation,n=this._owner.transform,C=n.rotation,r=n.scale,N=this.center.elements;0===N[0]&&0===N[1]&&0===N[2]?nn.createAffineTransformation(n.position,C,Pn.ONE,H):(Pn.multiply(this.center,r,P._deviationV3),Pn.transformQuat(P._deviationV3,C,P._deviationV3),Pn.add(n.position,P._deviationV3,P._deviationV3),nn.createAffineTransformation(P._deviationV3,C,Pn.ONE,H)),this._transformOrientedBoundBox.transformation=H;var Q=this._transformOrientedBoundBox.extents.elements,I=this._size.elements,A=r.elements;Q[0]=.5*I[0]*A[0],Q[1]=.5*I[1]*A[1],Q[2]=.5*I[2]*A[2],this._needUpdate=!1}},n._onWorldMatrixChanged=function(){for(var H in this._needUpdate=!0,this._runtimeCollisonMap)this._runtimeCollisonTestMap[H]=!0,this._runtimeCollisonMap[H]._runtimeCollisonTestMap[this.id]=!0},n._initialize=function(H){laya.d3.component.Component3D.prototype._initialize.call(this,H),this._transformOrientedBoundBox=new Cn(new Pn,new nn),this._size=new Pn,this.center=new Pn,H.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged),this._needUpdate=!0},n._getType=function(){return 1},n._collisonTo=function(H){switch(H._getType()){case 0:return 0!==this.boundBox.containsSphere(H.boundSphere);case 1:return 0!==this.boundBox.containsOrientedBoundBox(H.boundBox);case 2:var n=H;if(0===this.boundBox.containsBoundBox(n._boundBox))return!1;for(var C=H.mesh._positions,r=0,N=C.length;r<N;r++)if(1===this.boundBox.containsPoint(C[r]))return!0;return!1;default:throw new Error("BoxCollider:unknown collider type.")}},n._cloneTo=function(H){var n=H,C=n.size;this.size.cloneTo(C),n.size=C,this.center.cloneTo(n.center)},n.raycast=function(H,n,C){void 0===C&&(C=179e306),this._updateCollider();var r=this._transformOrientedBoundBox.intersectsRay(H,n.position);return-1!==r&&r<=C?(n.distance=r,n.sprite3D=this._owner,!0):(n.distance=-1,n.sprite3D=null,!1)},n.setFromBoundBox=function(H){Cn.createByBoundBox(H,this._transformOrientedBoundBox);var n=this._transformOrientedBoundBox.extents;this._size=new Pn(2*n.x,2*n.y,2*n.z),this.center=new Pn,Pn.add(H.min,H.max,this.center),Pn.scale(this.center,.5,this.center),this._needUpdate=!0},M(0,n,"boundBox",function(){return this._updateCollider(),this._transformOrientedBoundBox}),M(0,n,"size",function(){return this._size},function(H){this._size=H,this._needUpdate=!0}),y(P,["_deviationV3",function(){return this._deviationV3=new Pn},"_obbCenterV3",function(){return this._obbCenterV3=new Pn}]),P}(),En=function(H){function K(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,K.__super.call(this),this._type=3553}g(K,"laya.d3.resource.DataTexture2D",Zn);var n=K.prototype;return n.genDebugMipmaps=function(){var H=[];return H.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),H.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),H.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),H.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),H.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),H.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),H.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),H.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),H.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),H.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),H},n._onTextureLoaded=function(H){},n._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var H=b.mainContext,n=this._source=H.createTexture(),C=this._width,r=this._height,N=h.curBindTexTarget,Q=h.curBindTexValue,I=!1;if(h.bindTexture(H,this._type,n),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var A=0;H.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var P=0;P<this._mipmaps.length;P++){if(this._mipmaps[P].byteLength!=t*R*4)throw"mipmap size error  level:"+P;H.texSubImage2D(this._type,0,K.simLodRect[A++],K.simLodRect[A++],K.simLodRect[A++],K.simLodRect[A++],6408,5121,new Uint8Array(this._mipmaps[P]))}this.minFifter=9729,this.magFifter=9729}else{var t=this._width,R=this._height;for(A=0,H.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),P=0;P<this._mipmaps.length;P++){if(this._mipmaps[P].byteLength!=t*R*4)throw"mipmap size error  level:"+P;H.texImage2D(this._type,P,6408,t,R,0,6408,5121,new Uint8Array(this._mipmaps[P])),(t/=2)<1&&(t=1),(R/=2)<1&&(R=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&H.pixelStorei(H.UNPACK_ALIGNMENT,1),H.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var y=0,o=!1,g=!1;this._buffer.byteLength==4*C*r?(y=6408,o=!0):this._buffer.byteLength==3*C*r?(y=6407,g=!0):y=this._format,o||g?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),g&&H.pixelStorei(H.UNPACK_ALIGNMENT,1),H.texImage2D(this._type,0,y,C,r,0,y,5121,this._buffer)):H&&y==H.ALPHA?(H.texImage2D(3553,0,y,C,r,0,y,H.UNSIGNED_BYTE,this._buffer),I=!0):0!=y&&(H.compressedTexImage2D(3553,0,y,C,r,0,this._buffer),I=!0)}var M=this._minFifter,j=this._magFifter,l=0==this._wrapModeU?10497:33071,f=0==this._wrapModeV?10497:33071,c=W.isPOT(C,r);c?(this._mipmap||this._mipmaps?-1!==M||(M=9987):-1!==M||(M=9729),-1!==j||(j=9729),H.texParameteri(this._type,10241,M),H.texParameteri(this._type,10240,j),H.texParameteri(this._type,10242,l),H.texParameteri(this._type,10243,f),this._mipmap&&H.generateMipmap(this._type)):(-1!==M||(M=9729),-1!==j||(j=9729),H.texParameteri(this._type,10241,M),H.texParameteri(this._type,10240,j),H.texParameteri(this._type,10242,33071),H.texParameteri(this._type,10243,33071)),N&&Q&&h.bindTexture(H,N,Q),this.memorySize=I?this._buffer.length:c?C*r*4*(1+1/3):C*r*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},n.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},n.onAsynLoaded=function(H,n,C){var r;C&&(r=C[0].call(this,n)),r&&(this._width=r.width,this._height=r.height,this._buffer=r.data),this._src=H,this._size=new cn(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},n.getPixels=function(){return new Uint8Array(this._buffer)},n.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(b.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},M(0,n,"src",function(){return this._src}),K.create=function(H,n,C,r,N,Q,I){if(void 0===r&&(r=9729),void 0===N&&(N=9729),void 0===Q&&(Q=!0),!H||H.byteLength<n*C*4)throw"DataTexture2D create error";var A=new K;return A.uri=I,A._buffer=H,A._width=n,A._height=C,A._mipmap=Q,A._magFifter=r,A._minFifter=N,A._size=new cn(A._width,A._height),A._conchTexture?alert("怎么给runtime传递datatexture数据"):A.activeResource(),A},K.load=function(H,n,C,r,N){if(void 0===n&&(n=0),void 0===C&&(C=0),void 0===r&&(r=9729),void 0===N&&(N=9729),"mipmaps"===a.getFileExtension(H)){var Q=z.loader.create(H,null,null,K,[function(H){this._mipmaps=[];var n=new Uint32Array(H);this._width=n[0];var C=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,C=1024),this._width!=C)throw"现在只支持512x256的环境贴图。当前的是"+n[0];this._height=n[1];for(var r=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,N=this._height,Q=8;;){var I=r*N*4;if(Q+I>H.byteLength)throw"load mipmaps data size error ";var A=new Uint8Array(H,Q,I);if(this._mipmaps.push(A),Q+=I,1==r&&1==N)break;(r/=2)<1&&(r=1),(N/=2)<1&&(N=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){Q.simLodInfo=new Float32Array(40);for(var I=0;I<Q.simLodInfo.length;)Q.simLodInfo[I]=(K.simLodRect[I]+.5)/1024,I++,Q.simLodInfo[I]=(K.simLodRect[I]+.5)/256,I++,Q.simLodInfo[I]=Math.max(K.simLodRect[I]-1,.1)/1024,I++,Q.simLodInfo[I]=Math.max(K.simLodRect[I]-1.5,.1)/256,I++}return Q}if("number"==typeof n)return z.loader.create(H,null,null,K,[function(H){return this._width=n,this._height=C,this._buffer=H,null}]);if("function"==typeof n)return z.loader.create(H,null,null,K,[n]);throw new Error("unknown params.")},K.lodasatlas=!1,y(K,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),K}(),Gn=function(H){function n(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,n.__super.call(this)}g(n,"laya.d3.resource.models.PrimitiveMesh",qn);var C=n.prototype;return z.imps(C,{"laya.d3.core.render.IRenderable":!0}),C._getVertexBuffer=function(H){return void 0===H&&(H=0),0===H?this._vertexBuffer:null},C._getVertexBuffers=function(){return null},C._getIndexBuffer=function(){return this._indexBuffer},C._getPositions=function(){var H,n=[],C=this._vertexBuffer.vertexDeclaration.getVertexElements(),r=0;for(r=0;r<C.length;r++){var N=C[r];if("vector3"===N.elementFormat&&0===N.elementUsage){H=N;break}}var Q=this._vertexBuffer.getData();for(r=0;r<Q.length;r+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var I=r+H.offset/4,A=new Pn(Q[I+0],Q[I+1],Q[I+2]);n.push(A)}return n},C.getRenderElement=function(H){return this},C.getRenderElementsCount=function(){return 1},C.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},C._beforeRender=function(H){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},C._render=function(H){b.mainContext.drawElements(4,this._numberIndices,5123,0),k.drawCall++,k.trianglesFaces+=this._numberIndices/3},M(0,C,"_vertexBufferCount",function(){return 1}),M(0,C,"triangleCount",function(){return this._indexBuffer.indexCount/3}),n}(),Jn=function(H){function n(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,n.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}g(n,"laya.d3.resource.models.Mesh",qn);var C=n.prototype;return C._getPositions=function(){var H,n,C,r,N,Q=[],I=0,A=0,P=0;if(0!==this._vertexBuffers.length){var t=this._vertexBuffers.length;for(I=0;I<t;I++){for(C=(H=this._vertexBuffers[I]).vertexDeclaration.getVertexElements(),A=0;A<C.length;A++)if("vector3"===(r=C[A]).elementFormat&&0===r.elementUsage){n=r;break}for(N=H.getData(),A=0;A<N.length;A+=H.vertexDeclaration.vertexStride/4)P=A+n.offset/4,Q.push(new Pn(N[P+0],N[P+1],N[P+2]))}}else{var R=this._subMeshes.length;for(I=0;I<R;I++){for(C=(H=this._subMeshes[I]._getVertexBuffer()).vertexDeclaration.getVertexElements(),A=0;A<C.length;A++)if("vector3"===(r=C[A]).elementFormat&&0===r.elementUsage){n=r;break}for(N=H.getData(),A=0;A<N.length;A+=H.vertexDeclaration.vertexStride/4)P=A+n.offset/4,Q.push(new Pn(N[P+0],N[P+1],N[P+2]))}}return Q},C._setSubMeshes=function(H){this._subMeshes=H,this._subMeshCount=H.length;for(var n=0;n<this._subMeshCount;n++)H[n]._indexInMesh=n;this._positions=this._getPositions(),this._generateBoundingObject()},C.onAsynLoaded=function(H,n,C){var r=n[0],N=n[1];JH.read(r,this,this._materials,this._subMeshes,N),this.completeCreate(),this._endLoaded()},C.getSubMesh=function(H){return this._subMeshes[H]},C.getSubMeshCount=function(){return this._subMeshes.length},C.getRenderElementsCount=function(){return this._subMeshes.length},C.getRenderElement=function(H){return this._subMeshes[H]},C.disposeResource=function(){for(var H=0;H<this._subMeshes.length;H++)this._subMeshes[H].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},M(0,C,"materials",function(){return this._materials.slice()}),M(0,C,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),n.load=function(H){return z.loader.create(H,null,null,n)},n}(),Yn=(function(H){function t(H,n,C,r,N,Q,I,A,P){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===C&&(C=6408),void 0===r&&(r=5121),void 0===N&&(N=33189),void 0===Q&&(Q=!1),void 0===I&&(I=!1),void 0===A&&(A=-1),void 0===P&&(P=-1),t.__super.call(this),this._type=3553,this._width=H,this._height=n,this._size=new cn(H,n),this._surfaceFormat=C,this._surfaceType=r,this._depthStencilFormat=N,j.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=Q,this._repeat=I,this._minFifter=A,this._magFifter=P,this.activeResource(),this._alreadyResolved=!0}g(t,"laya.d3.resource.RenderTexture",Zn);var n=t.prototype;n.recreateResource=function(){var H=b.mainContext;this._frameBuffer=H.createFramebuffer(),this._source=H.createTexture();var n=h.curBindTexTarget,C=h.curBindTexValue;h.bindTexture(H,this._type,this._source),H.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var r=this._minFifter,N=this._magFifter,Q=this._repeat?10497:33071;if(W.isPOT(this._width,this._height)?(this._mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==N||(N=9729),H.texParameteri(this._type,10241,r),H.texParameteri(this._type,10240,N),H.texParameteri(this._type,10242,Q),H.texParameteri(this._type,10243,Q),this._mipmap&&H.generateMipmap(this._type)):(-1!==r||(r=9729),-1!==N||(N=9729),H.texParameteri(this._type,10241,r),H.texParameteri(this._type,10240,N),H.texParameteri(this._type,10242,33071),H.texParameteri(this._type,10243,33071)),n&&C&&h.bindTexture(H,n,C),H.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=H.createRenderbuffer(),H.bindRenderbuffer(36161,this._depthStencilBuffer),H.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),H.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:H.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:H.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:H.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}H.framebufferTexture2D(36160,36064,3553,this._source,0),H.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},n.start=function(){b.mainContext.bindFramebuffer(36160,this.frameBuffer),(t._currentRenderTarget=this)._alreadyResolved=!1},n.end=function(){b.mainContext.bindFramebuffer(36160,null),t._currentRenderTarget=null,this._alreadyResolved=!0},n.getData=function(H,n,C,r){var N=b.mainContext;if(N.bindFramebuffer(36160,this._frameBuffer),!(36053===N.checkFramebufferStatus(36160)))return N.bindFramebuffer(36160,null),null;var Q=new Uint8Array(this._width*this._height*4);return N.readPixels(H,n,C,r,this._surfaceFormat,this._surfaceType,Q),N.bindFramebuffer(36160,null),Q},n.disposeResource=function(){if(this._frameBuffer){var H=b.mainContext;H.deleteTexture(this._source),H.deleteFramebuffer(this._frameBuffer),H.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},M(0,n,"surfaceFormat",function(){return this._surfaceFormat}),M(0,n,"surfaceType",function(){return this._surfaceType}),M(0,n,"depthStencilFormat",function(){return this._depthStencilFormat}),M(0,n,"source",function(){return this._alreadyResolved?z.superGet(Zn,this,"source"):null}),M(0,n,"depthStencilBuffer",function(){return this._depthStencilBuffer}),M(0,n,"frameBuffer",function(){return this._frameBuffer}),t._currentRenderTarget=null}(),function(H){function n(H){this._color=null,this._pixels=null,n.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new cn(this.width,this.height),this._color=H,this._pixels=new Uint8Array([255*H.x,255*H.y,255*H.z,255*H.w]),this.uri="SolidColorTexture2D_"+this.id}g(n,"laya.d3.resource.SolidColorTexture2D",Zn);var C=n.prototype;return C._createWebGlTexture=function(){var H=b.mainContext,n=this._source=H.createTexture(),C=this._width,r=this._height,N=h.curBindTexTarget,Q=h.curBindTexValue;h.bindTexture(H,this._type,n),H.texImage2D(this._type,0,6408,C,r,0,6408,5121,this._pixels);var I=this._minFifter,A=this._magFifter,P=this._repeat?10497:33071,t=W.isPOT(C,r);t?(this._mipmap?-1!==I||(I=9987):-1!==I||(I=9729),-1!==A||(A=9729),H.texParameteri(this._type,10241,I),H.texParameteri(this._type,10240,A),H.texParameteri(this._type,10242,P),H.texParameteri(this._type,10243,P),this._mipmap&&H.generateMipmap(this._type)):(-1!==I||(I=9729),-1!==A||(A=9729),H.texParameteri(this._type,10241,I),H.texParameteri(this._type,10240,A),H.texParameteri(this._type,10242,33071),H.texParameteri(this._type,10243,33071)),N&&Q&&h.bindTexture(H,N,Q),this.memorySize=t?C*r*4*(1+1/3):C*r*4},C.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},C.disposeResource=function(){this._source&&(b.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},y(n,["magentaTexture",function(){var H=new n(new tn(1,0,1,1));return H.lock=!0,this.magentaTexture=H},"grayTexture",function(){var H=new n(new tn(.5,.5,.5,1));return H.lock=!0,this.grayTexture=H}]),n}()),un=function(H){function N(H,n,C,r){this._canRead=!1,this._image=null,this._pixels=null,void 0===H&&(H=!1),void 0===n&&(n=!0),void 0===C&&(C=6408),void 0===r&&(r=!0),N.__super.call(this),this._type=3553,this._repeat=n,this._canRead=H,this._format=C,this._mipmap=r}g(N,"laya.d3.resource.Texture2D",Zn);var n=N.prototype;return n._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var H=b.mainContext,n=this._source=H.createTexture(),C=this._width,r=this._height,N=h.curBindTexTarget,Q=h.curBindTexValue;switch(h.bindTexture(H,this._type,n),this._format){case 6407:case 6408:this._canRead?H.texImage2D(this._type,0,this._format,C,r,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?H.texImage2D(this._type,0,this._image._format,C,r,0,this._image._format,5121,this._image.atlasSource):H.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case b.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:H.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var I=this._minFifter,A=this._magFifter,P=this._repeat?10497:33071,t=0==this._wrapModeU?10497:33071,R=0==this._wrapModeV?10497:33071,y=W.isPOT(C,r);y?(this._mipmap?-1!==I||(I=9987):-1!==I||(I=9729),-1!==A||(A=9729),H.texParameteri(this._type,10241,I),H.texParameteri(this._type,10240,A),H.texParameteri(this._type,10242,P),H.texParameteri(this._type,10243,P),H.texParameteri(this._type,10242,t),H.texParameteri(this._type,10243,R),this._mipmap&&H.generateMipmap(this._type)):(-1!==I||(I=9729),-1!==A||(A=9729),H.texParameteri(this._type,10241,I),H.texParameteri(this._type,10240,A),H.texParameteri(this._type,10242,33071),H.texParameteri(this._type,10243,33071)),N&&Q&&h.bindTexture(H,N,Q),this._image.onload=null,this._image=null,this.memorySize=y?C*r*4*(1+1/3):C*r*4},n.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},n.onAsynLoaded=function(H,n,C){if(C){var r=C[0];void 0!==r&&(this._canRead=r);var N=C[1];void 0!==N&&(this._repeat=N);var Q=C[2];void 0!==Q&&(this._format=Q);var I=C[3];void 0!==I&&(this._mipmap=I);var A=C.wrapModeU;void 0!==A&&(this._wrapModeU=A);var P=C.wrapModeV;void 0!==P&&(this._wrapModeV=P)}switch(this._format){case 6407:case 6408:var t=(this._image=n).width,R=n.height;this._width=t,this._height=R,this._size=new cn(t,R),this._canRead&&(j.isConchApp?n instanceof o.HTMLElement&&(this._pixels=new Uint8Array(n.getImageData(0,0,t,R))):(v.canvas.size(t,R),v.canvas.clear(),v.context.drawImage(n,0,0,t,R),this._pixels=new Uint8Array(v.context.getImageData(0,0,t,R).data.buffer)));break;case b.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var y=new w(n);y.readUTFBytes(4),y.readUTFBytes(2),y.getInt16();y.endian="bigEndian",this._width=y.getInt16(),this._height=y.getInt16(),this._size=new cn(this._width,this._height);y.getInt16(),y.getInt16();this._image=new Uint8Array(n,y.pos)}this.recreateResource(),this._endLoaded()},n.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},n.disposeResource=function(){this._source&&(b.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},M(0,n,"_src",function(){return this.url}),M(0,n,"src",function(){return this.url}),N.load=function(H){return z.loader.create(H,null,null,N)},N}(),Xn=function(n){function C(H,n){C.__super.call(this),void 0===H&&(H=.3),void 0===n&&(n=1e3),this._tempVector3=new Pn,this._position=new Pn,this._up=new Pn,this._forward=new Pn,this._right=new Pn,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=cn.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=H,this._farPlane=n,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),z.stage.on("resize",this,this._onScreenSizeChanged)}g(C,"laya.d3.core.BaseCamera",n);var H=C.prototype;return H._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var H=this.scene._cameraPool,n=H.length-1,C=0;C<n;C++)if(H[C].renderingOrder>H[n].renderingOrder){var r=H[C];H[C]=H[n],H[n]=r}},H._calculateProjectionMatrix=function(){},H._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},H._prepareCameraToRender=function(){e._currentCameraCullingMask=this.cullingMask;var H=this._shaderValues;H.setValue(0,this.transform.position.elements),H.setValue(5,this.forward.elements),H.setValue(6,this.up.elements)},H._prepareCameraViewProject=function(H,n){var C=this._shaderValues;C.setValue(1,H.elements),C.setValue(2,n.elements)},H._renderCamera=function(H,n,C){},H.addLayer=function(H){29!==H.number&&30!=H.number&&(this.cullingMask=this.cullingMask|H.mask)},H.removeLayer=function(H){29!==H.number&&30!=H.number&&(this.cullingMask=this.cullingMask&~H.mask)},H.addAllLayers=function(){this.cullingMask=2147483647},H.removeAllLayers=function(){this.cullingMask=0|e.getLayerByNumber(29).mask|e.getLayerByNumber(30).mask},H.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},H.moveForward=function(H){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=H,this.transform.translate(this._tempVector3)},H.moveRight=function(H){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=H,this.transform.translate(this._tempVector3)},H.moveVertical=function(H){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=H,this.transform.translate(this._tempVector3,!1)},H._addSelfRenderObjects=function(){var H=this.scene._cameraPool,n=H.length;if(0<n){for(var C=n-1;0<=C;C--)if(this.renderingOrder<=H[C].renderingOrder){H.splice(C+1,0,this);break}}else H.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},H._clearSelfRenderObjects=function(){var H=this.scene._cameraPool;H.splice(H.indexOf(this),1)},H.destroy=function(H){void 0===H&&(H=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,z.stage.off("resize",this,this._onScreenSizeChanged),n.prototype.destroy.call(this,H)},M(0,H,"sky",function(){return this._sky},function(H){(this._sky=H)._ownerCamera=this}),M(0,H,"forward",function(){var H=this.transform.worldMatrix.elements,n=this._forward.elements;return n[0]=-H[8],n[1]=-H[9],n[2]=-H[10],this._forward}),M(0,H,"position",function(){var H=this.transform.worldMatrix.elements,n=this._position.elements;return n[0]=H[12],n[1]=H[13],n[2]=H[14],this._position}),M(0,H,"renderTarget",function(){return this._renderTarget},function(H){null!=(this._renderTarget=H)&&(this._renderTargetSize=H.size)}),M(0,H,"up",function(){var H=this.transform.worldMatrix.elements,n=this._up.elements;return n[0]=H[4],n[1]=H[5],n[2]=H[6],this._up}),M(0,H,"right",function(){var H=this.transform.worldMatrix.elements,n=this._right.elements;return n[0]=H[0],n[1]=H[1],n[2]=H[2],this._right}),M(0,H,"renderTargetSize",function(){return this._renderTargetSize},function(H){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=H,this._calculateProjectionMatrix()}),M(0,H,"fieldOfView",function(){return this._fieldOfView},function(H){this._fieldOfView=H,this._calculateProjectionMatrix()}),M(0,H,"nearPlane",function(){return this._nearPlane},function(H){this._nearPlane=H,this._calculateProjectionMatrix()}),M(0,H,"farPlane",function(){return this._farPlane},function(H){this._farPlane=H,this._calculateProjectionMatrix()}),M(0,H,"orthographic",function(){return this._orthographic},function(H){this._orthographic=H,this._calculateProjectionMatrix()}),M(0,H,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(H){this._orthographicVerticalSize=H,this._calculateProjectionMatrix()}),M(0,H,"renderingOrder",function(){return this._renderingOrder},function(H){this._renderingOrder=H,this._sortCamerasByRenderingOrder()}),C.CAMERAPOS=0,C.VIEWMATRIX=1,C.PROJECTMATRIX=2,C.VPMATRIX=3,C.VPMATRIX_NO_TRANSLATE=4,C.CAMERADIRECTION=5,C.CAMERAUP=6,C.ENVIRONMENTDIFFUSE=7,C.ENVIRONMENTSPECULAR=8,C.SIMLODINFO=9,C.DIFFUSEIRRADMATR=10,C.DIFFUSEIRRADMATG=11,C.DIFFUSEIRRADMATB=12,C.HDREXPOSURE=13,C.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",C.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",C.CLEARFLAG_SOLIDCOLOR=0,C.CLEARFLAG_SKY=1,C.CLEARFLAG_DEPTHONLY=2,C.CLEARFLAG_NONE=3,y(C,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new nn(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new nn},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new nn}]),C}(sn),Vn=function(C){function n(H){this._render=null,this._geometryFilter=null,n.__super.call(this,H)}g(n,"laya.d3.core.RenderableSprite3D",C);var H=n.prototype;return H._addToInitStaticBatchManager=function(){},H._setBelongScene=function(H){C.prototype._setBelongScene.call(this,H),H._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},H._setUnBelongScene=function(){var H=this._scene._renderableSprite3Ds,n=H.indexOf(this);H.splice(n,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),C.prototype._setUnBelongScene.call(this)},H._update=function(H){(H.owner=this)._activeInHierarchy&&(this._updateComponents(H),this._render._updateOctreeNode(),this._lateUpdateComponents(H),k.spriteCount++,this._childs.length&&this._updateChilds(H))},H.destroy=function(H){void 0===H&&(H=!0),C.prototype.destroy.call(this,H),this._render._destroy(),this._render=null},n.__init__=function(){n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=n.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),n.SAHDERDEFINE_LIGHTMAP=n.shaderDefines.registerDefine("LIGHTMAP")},n.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,n.SAHDERDEFINE_LIGHTMAP=4,n.LIGHTMAPSCALEOFFSET=2,n.LIGHTMAP=3,y(n,["shaderDefines",function(){return this.shaderDefines=new on}]),n}(sn),Bn=(function(H){function r(H,n,C){this._long=NaN,this._width=NaN,this._height=NaN,void 0===H&&(H=1),void 0===n&&(n=1),void 0===C&&(C=1),r.__super.call(this),this._long=H,this._width=n,this._height=C,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}g(r,"laya.d3.resource.models.BoxMesh",Gn);var n=r.prototype;n.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var H=bH.vertexDeclaration,n=(H.vertexStride,this._long/2),C=this._height/2,r=this._width/2,N=new Float32Array([-n,C,-r,0,1,0,0,0,n,C,-r,0,1,0,1,0,n,C,r,0,1,0,1,1,-n,C,r,0,1,0,0,1,-n,-C,-r,0,-1,0,0,1,n,-C,-r,0,-1,0,1,1,n,-C,r,0,-1,0,1,0,-n,-C,r,0,-1,0,0,0,-n,C,-r,-1,0,0,0,0,-n,C,r,-1,0,0,1,0,-n,-C,r,-1,0,0,1,1,-n,-C,-r,-1,0,0,0,1,n,C,-r,1,0,0,1,0,n,C,r,1,0,0,0,0,n,-C,r,1,0,0,0,1,n,-C,-r,1,0,0,1,1,-n,C,r,0,0,1,0,0,n,C,r,0,0,1,1,0,n,-C,r,0,0,1,1,1,-n,-C,r,0,0,1,0,1,-n,C,-r,0,0,-1,1,0,n,C,-r,0,0,-1,0,0,n,-C,-r,0,0,-1,0,1,-n,-C,-r,0,0,-1,1,1]),Q=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new Sn(H,this._numberVertices,35044,!0),this._indexBuffer=new On("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(N),this._indexBuffer.setData(Q),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},M(0,n,"long",function(){return this._long},function(H){this._long!==H&&(this._long=H,this.releaseResource(),this.activeResource())}),M(0,n,"width",function(){return this._width},function(H){this._width!==H&&(this._width=H,this.releaseResource(),this.activeResource())}),M(0,n,"height",function(){return this._height},function(H){this._height!==H&&(this._height=H,this.releaseResource(),this.activeResource())})}(),function(H){function N(H,n,C,r){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===H&&(H=10),void 0===n&&(n=10),void 0===C&&(C=10),void 0===r&&(r=10),N.__super.call(this),this._long=H,this._width=n,this._stacks=C,this._slices=r,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}g(N,"laya.d3.resource.models.PlaneMesh",Gn);var n=N.prototype;n.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var H=new Uint16Array(this._numberIndices),n=bH.vertexDeclaration,C=n.vertexStride/4,r=new Float32Array(this._numberVertices*C),N=this._long/2,Q=this._width/2,I=this._long/this._stacks,A=this._width/this._slices,P=0,t=0;t<=this._slices;t++)for(var R=0;R<=this._stacks;R++)r[P++]=R*I-N,r[P++]=0,r[P++]=t*A-Q,r[P++]=0,r[P++]=1,r[P++]=0,r[P++]=1*R/this._stacks,r[P++]=1*t/this._slices;var y=0;for(t=0;t<this._slices;t++)for(R=0;R<this._stacks;R++)H[y++]=(t+1)*(this._stacks+1)+R,H[y++]=t*(this._stacks+1)+R,H[y++]=(t+1)*(this._stacks+1)+R+1,H[y++]=t*(this._stacks+1)+R,H[y++]=t*(this._stacks+1)+R+1,H[y++]=(t+1)*(this._stacks+1)+R+1;this._vertexBuffer=new Sn(n,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new On("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData(r),this._indexBuffer.setData(H),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},M(0,n,"long",function(){return this._long},function(H){this._long!==H&&(this._long=H,this.releaseResource(),this.activeResource())}),M(0,n,"width",function(){return this._width},function(H){this._width!==H&&(this._width=H,this.releaseResource(),this.activeResource())}),M(0,n,"stacks",function(){return this._stacks},function(H){this._stacks!==H&&(this._stacks=H,this.releaseResource(),this.activeResource())}),M(0,n,"slices",function(){return this._slices},function(H){this._slices!==H&&(this._slices=H,this.releaseResource(),this.activeResource())})}(),function(H){function C(H,n){this._long=NaN,this._width=NaN,void 0===H&&(H=1),void 0===n&&(n=1),C.__super.call(this),this._long=H,this._width=n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}g(C,"laya.d3.resource.models.QuadMesh",Gn);var n=C.prototype;n.recreateResource=function(){this.disposeResource(),this._numberVertices=4,this._numberIndices=6;var H=bH.vertexDeclaration,n=(H.vertexStride,this._long/2),C=this._width/2,r=new Float32Array([-n,C,0,0,0,1,0,0,n,C,0,0,0,1,1,0,-n,-C,0,0,0,1,0,1,n,-C,0,0,0,1,1,1]),N=new Uint16Array([0,1,2,3,2,1]);this._vertexBuffer=new Sn(H,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new On("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData(r),this._indexBuffer.setData(N),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},n.reset=function(H,n){this._long===H&&this._width===n||(this._long=H,this._width=n,this.releaseResource(),this.activeResource())},M(0,n,"long",function(){return this._long},function(H){this._long!==H&&(this._long=H,this.releaseResource(),this.activeResource())}),M(0,n,"width",function(){return this._width},function(H){this._width!==H&&(this._width=H,this.releaseResource(),this.activeResource())})}(),function(H){function I(H,n,C){void 0===H&&(H=0),void 0===n&&(n=.3),void 0===C&&(C=1e3),this._viewMatrix=new nn,this._projectionMatrix=new nn,this._projectionViewMatrix=new nn,this._viewport=new Rn(0,0,0,0),this._normalizedViewport=new Rn(0,0,1,1),this._aspectRatio=H,this._boundFrustumUpdate=!0,this._boundFrustum=new uH(nn.DEFAULT),I.__super.call(this,n,C),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}g(I,"laya.d3.core.Camera",Xn);var n=I.prototype;return n._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},n._parseCustomProps=function(H,n,C,r){var N=C.clearColor;this.clearColor=new tn(N[0],N[1],N[2],N[3]);var Q=C.viewport;this.normalizedViewport=new Rn(Q[0],Q[1],Q[2],Q[3])},n._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var H=this.orthographicVerticalSize*this.aspectRatio*.5,n=.5*this.orthographicVerticalSize;nn.createOrthoOffCenterRH(-H,H,-n,n,this.nearPlane,this.farPlane,this._projectionMatrix)}else nn.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},n._update=function(H){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,H)},n._renderCamera=function(H,n,C){var r,N;C.parallelSplitShadowMaps[0]&&C._renderShadowMap(H,n,this),(n.camera=this)._prepareCameraToRender(),C._preRenderUpdateComponents(n),r=n._viewMatrix=this.viewMatrix;var Q=this._renderTarget;Q?(Q.start(),nn.multiply(Xn._invertYScaleMatrix,this._projectionMatrix,Xn._invertYProjectionMatrix),nn.multiply(Xn._invertYScaleMatrix,this.projectionViewMatrix,Xn._invertYProjectionViewMatrix),N=n._projectionMatrix=Xn._invertYProjectionMatrix,n._projectionViewMatrix=Xn._invertYProjectionViewMatrix):(N=n._projectionMatrix=this._projectionMatrix,n._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(r,N),n._viewport=this.viewport,C._preRenderScene(H,n,this.boundFrustum),C._clear(H,n),C._renderScene(H,n),C._postRenderUpdateComponents(n),Q&&Q.end()},n.viewportPointToRay=function(H,n){ln.calculateCursorRay(H,this.viewport,this._projectionMatrix,this.viewMatrix,null,n)},n.normalizedViewportPointToRay=function(H,n){var C=I._tempVector20,r=this.viewport,N=H.elements,Q=C.elements;Q[0]=N[0]*r.width,Q[1]=N[1]*r.height,ln.calculateCursorRay(C,this.viewport,this._projectionMatrix,this.viewMatrix,null,n)},n.worldToViewportPoint=function(H,n){nn.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(H,this._projectionViewMatrix,n);var C=n.elements;C[0]=C[0]/z.stage.clientScaleX,C[1]=C[1]/z.stage.clientScaleY},n.worldToNormalizedViewportPoint=function(H,n){nn.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(H,this._projectionViewMatrix,n);var C=n.elements;C[0]=C[0]/z.stage.clientScaleX,C[1]=C[1]/z.stage.clientScaleY},n.convertScreenCoordToOrthographicCoord=function(H,n,C){if(void 0===C&&(C=!0),this._orthographic){var r=J.clientWidth,N=J.clientHeight,Q=this.orthographicVerticalSize*this.aspectRatio/r,I=this.orthographicVerticalSize/N,A=H.elements,P=n.elements;return P[0]=(-r/2+A[0])*Q,P[1]=(N/2-A[1])*I,P[2]=(this.nearPlane-this.farPlane)*(A[2]+1)/2-this.nearPlane,C&&Pn.transformCoordinate(n,this.transform.worldMatrix,n),!0}return!1},M(0,n,"projectionViewMatrix",function(){return nn.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),M(0,n,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var H=this.viewport;return H.width/H.height},function(H){if(H<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=H,this._calculateProjectionMatrix()}),M(0,n,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),M(0,n,"needViewport",function(){var H=this.normalizedViewport;return 0===H.x&&0===H.y&&1===H.width&&1===H.height}),M(0,n,"viewport",function(){if(this._viewportExpressedInClipSpace){var H=this._normalizedViewport,n=this.renderTargetSize,C=n.width,r=n.height;this._viewport.x=H.x*C,this._viewport.y=H.y*r,this._viewport.width=H.width*C,this._viewport.height=H.height*r}return this._viewport},function(H){if(null!=this.renderTarget&&(H.x<0||H.y<0||0==H.width||0==H.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=H,this._calculateProjectionMatrix()}),M(0,n,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var H=this._viewport,n=this.renderTargetSize,C=n.width,r=n.height;this._normalizedViewport.x=H.x/C,this._normalizedViewport.y=H.y/r,this._normalizedViewport.width=H.width/C,this._normalizedViewport.height=H.height/r}return this._normalizedViewport},function(H){H.x<0&&(H.x=0,console.warn("Camera: viewport.x must large than 0.0.")),H.y<0&&(H.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<H.x+H.width&&(H.width=1-H.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<H.y+H.height&&(H.height=1-H.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=H,this._calculateProjectionMatrix()}),M(0,n,"projectionMatrix",function(){return this._projectionMatrix},function(H){this._projectionMatrix=H,this._useUserProjectionMatrix=!0}),M(0,n,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),y(I,["_tempVector20",function(){return this._tempVector20=new An}]),I}()),HC=function(C){function r(H,n){r.__super.call(this,n),this._geometryFilter=new dn(this),this._render=new _n(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),H&&(this._geometryFilter.sharedMesh=H)instanceof laya.d3.resource.models.Mesh&&(H.loaded?this._render.sharedMaterials=H.materials:H.once("loaded",this,this._applyMeshMaterials))}g(r,"laya.d3.core.MeshSprite3D",C);var H=r.prototype;return H._changeRenderObjectByMesh=function(H){var n=this._render._renderElements,C=n[H];C||(C=n[H]=new Dn),C._render=this._render;var r=this._render.sharedMaterials[H];r||(r=xn.defaultMaterial);var N=this._geometryFilter.sharedMesh.getRenderElement(H);return C._mainSortID=this._getSortID(N,r),C._sprite3D=this,C.renderObj=N,C._material=r,C},H._changeRenderObjectByMaterial=function(H,n){var C=this._render._renderElements[H];n||(n=xn.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(H);return C._mainSortID=this._getSortID(r,n),C._sprite3D=this,C.renderObj=r,C._material=n,C},H._changeRenderObjectsByMesh=function(){var H=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=H;for(var n=0;n<H;n++)this._changeRenderObjectByMesh(n)},H._onMeshChanged=function(H){var n=H.sharedMesh;n.loaded?this._changeRenderObjectsByMesh():n.once("loaded",this,this._onMeshLoaded)},H._onMeshLoaded=function(H){H===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},H._onMaterialChanged=function(H,n,C){n<this._render._renderElements.length&&this._changeRenderObjectByMaterial(n,C)},H._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},H._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},H._parseCustomProps=function(H,n,C,r){var N=this.meshRender,Q=C.lightmapIndex;null!=Q&&(N.lightmapIndex=Q);var I,A,P=C.lightmapScaleOffset;if(P&&(N.lightmapScaleOffset=new tn(P[0],P[1],P[2],P[3])),r.instanceParams)(I=r.instanceParams.loadPath)&&(A=f.getRes(n[I]),(this.meshFilter.sharedMesh=A).loaded?N.sharedMaterials=A.materials:A.once("loaded",this,this._applyMeshMaterials));else{(I=C.meshPath)&&(A=f.getRes(n[I]),this.meshFilter.sharedMesh=A);var t=C.materials;if(t){var R=N.sharedMaterials,y=t.length;R.length=y;for(var o=0;o<y;o++)R[o]=f.getRes(n[t[o].path]);N.sharedMaterials=R}}},H._applyMeshMaterials=function(H){for(var n=this._render.sharedMaterials,C=H.materials,r=0,N=C.length;r<N;r++)n[r]||(n[r]=C[r]);this._render.sharedMaterials=n},H._addToInitStaticBatchManager=function(){r._staticBatchManager._addInitBatchSprite(this)},H.cloneTo=function(H){var n=H;n._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var C=this._render,r=n._render;r.enable=C.enable,r.sharedMaterials=C.sharedMaterials,r.castShadow=C.castShadow;var N=C.lightmapScaleOffset;N&&(r.lightmapScaleOffset=N.clone()),r.lightmapIndex=C.lightmapIndex,r.receiveShadow=C.receiveShadow,r.sortingFudge=C.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,H)},H.destroy=function(H){if(void 0===H&&(H=!0),!this.destroyed){var n=this.meshFilter.sharedMesh;null!=n&&(n.loaded||n.off("loaded",this,this._applyMeshMaterials)),C.prototype.destroy.call(this,H),this._geometryFilter._destroy()}},M(0,H,"meshFilter",function(){return this._geometryFilter}),M(0,H,"meshRender",function(){return this._render}),r.__init__=function(){rH._staticBatchManagers.push(r._staticBatchManager)},r.load=function(H){return z.loader.create(H,null,null,r)},y(r,["_staticBatchManager",function(){return this._staticBatchManager=new bn}]),r}(Vn)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(H,n){"use strict";for(var C in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var r=Laya[C];r&&r.__isclass&&(n[C]=r)}}),function(H,n,vH){vH.un,vH.uns;var C=vH.static,r=vH.class,Q=vH.getset,j=vH.__newvec,A=laya.maths.Bezier,y=laya.utils.Browser,eH=laya.utils.Byte,N=(laya.events.Event,laya.events.EventDispatcher),I=laya.display.Graphics,P=(laya.resource.HTMLCanvas,laya.utils.Handler),t=laya.net.Loader,o=laya.maths.MathUtil,ZH=laya.maths.Matrix,l=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),R=(laya.renders.RenderContext,laya.resource.Resource),g=laya.utils.RunDriver,NH=laya.display.Sprite,M=laya.utils.Stat,qH=laya.resource.Texture,f=(laya.net.URL,laya.utils.Utils),h=function(){function H(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return r(H,"laya.ani.AnimationContent"),H}(),v=function(){function H(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return r(H,"laya.ani.AnimationNodeContent"),H}(),K=function(){function H(){}return r(H,"laya.ani.AnimationParser01"),H.parse=function(H,n){var C=n.__getBuffer(),r=0,N=0,Q=0,I=0,A=0,P=0,t=0,R=n.readUTFString();H._aniClassName=R;var y,o=n.readUTFString().split("\n"),g=n.getUint8(),M=n.getUint32(),j=n.getUint32();0<M&&(y=C.slice(M,j));var l=new eH(y);for(0<j&&(H._publicExtData=C.slice(j,C.byteLength)),H._useParent=!!n.getUint8(),H._anis.length=g,r=0;r<g;r++){var f=H._anis[r]=new h;f.nodes=new Array;var c=f.name=o[n.getUint16()];H._aniMap[c]=r,f.bone3DMap={},f.playTime=n.getFloat32(),f.playTime<=0&&console.error("播放时间不能为0  url="+H.url+" name="+f.name);var K=f.nodes.length=n.getUint8();for(N=f.totalKeyframeDatasLength=0;N<K;N++){var W=f.nodes[N]=new v;W.childs=[];var z=n.getInt16();0<=z&&(W.name=o[z],f.bone3DMap[W.name]=N),W.keyFrame=new Array,W.parentIndex=n.getInt16(),-1==W.parentIndex?W.parent=null:W.parent=f.nodes[W.parentIndex],W.lerpType=n.getUint8();var w=n.getUint32();l.pos=w;var F=W.keyframeWidth=l.getUint16();if(f.totalKeyframeDatasLength+=F,0===W.lerpType||1===W.lerpType)for(W.interpolationMethod=[],W.interpolationMethod.length=F,Q=0;Q<F;Q++)W.interpolationMethod[Q]=q.interpolation[l.getUint8()];null!=W.parent&&W.parent.childs.push(W);var k=n.getUint16();0<k&&(W.extenData=C.slice(n.pos,n.pos+k),n.pos+=k);var i,a=n.getUint16(),D=0;for(Q=0,I=W.keyFrame.length=a;Q<I;Q++){if((i=W.keyFrame[Q]=new e).duration=n.getFloat32(),i.startTime=D,2===W.lerpType){i.interpolationData=[];var L,b=n.getUint8();switch(L=n.getFloat32()){case 254:for(i.interpolationData.length=F,t=0;t<F;t++)i.interpolationData[t]=0;break;case 255:for(i.interpolationData.length=F,t=0;t<F;t++)i.interpolationData[t]=5;break;default:for(i.interpolationData.push(L),P=1;P<b;P++)i.interpolationData.push(n.getFloat32())}}for(i.data=new Float32Array(F),A=0;A<F;A++)i.data[A]=n.getFloat32(),-1e-8<i.data[A]&&i.data[A]<1e-8&&(i.data[A]=0);D+=i.duration}i.startTime=f.playTime,W.playTime=f.playTime,H._calculateKeyFrame(W,a,F)}}},H}(),W=function(){function z(){}return r(z,"laya.ani.AnimationParser02"),z.READ_DATA=function(){z._DATA.offset=z._reader.getUint32(),z._DATA.size=z._reader.getUint32()},z.READ_BLOCK=function(){for(var H=z._BLOCK.count=z._reader.getUint16(),n=z._BLOCK.blockStarts=[],C=z._BLOCK.blockLengths=[],r=0;r<H;r++)n.push(z._reader.getUint32()),C.push(z._reader.getUint32())},z.READ_STRINGS=function(){var H=z._reader.getUint32(),n=z._reader.getUint16(),C=z._reader.pos;z._reader.pos=H+z._DATA.offset;for(var r=0;r<n;r++)z._strings[r]=z._reader.readUTFString();z._reader.pos=C},z.parse=function(H,n){z._templet=H;(z._reader=n).__getBuffer();z.READ_DATA(),z.READ_BLOCK(),z.READ_STRINGS();for(var C=0,r=z._BLOCK.count;C<r;C++){var N=n.getUint16(),Q=z._strings[N],I=z["READ_"+Q];if(null==I)throw new Error("model file err,no this function:"+N+" "+Q);I.call()}},z.READ_ANIMATIONS=function(){var H=z._reader,n=H.__getBuffer(),C=0,r=0,N=0,Q=0,I=H.getUint16(),A=[];for(A.length=I,C=0;C<I;C++)A[C]=q.interpolation[H.getByte()];var P=H.getUint8();for(z._templet._anis.length=P,C=0;C<P;C++){var t=z._templet._anis[C]={};t.nodes=new Array;var R=t.name=z._strings[H.getUint16()];z._templet._aniMap[R]=C,t.bone3DMap={},t.playTime=H.getFloat32();var y=t.nodes.length=H.getInt16();for(r=t.totalKeyframeDatasLength=0;r<y;r++){var o=t.nodes[r]={};o.keyframeWidth=I,o.childs=[];var g=H.getUint16();0<=g&&(o.name=z._strings[g],t.bone3DMap[o.name]=r),o.keyFrame=new Array,o.parentIndex=H.getInt16(),-1==o.parentIndex?o.parent=null:o.parent=t.nodes[o.parentIndex],t.totalKeyframeDatasLength+=I,o.interpolationMethod=A,null!=o.parent&&o.parent.childs.push(o);var M=H.getUint16(),j=null,l=null;for(N=0,Q=o.keyFrame.length=M;N<Q;N++){(j=o.keyFrame[N]={}).startTime=H.getFloat32(),l&&(l.duration=j.startTime-l.startTime);var f=z._DATA.offset,c=H.getUint32(),K=4*I,W=n.slice(f+c,f+c+K);j.data=new Float32Array(W),l=j}j.duration=0,o.playTime=t.playTime,z._templet._calculateKeyFrame(o,M,I)}}},z._templet=null,z._reader=null,z._strings=[],C(z,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),z}(),pH=(function(){function H(){}r(H,"laya.ani.AnimationState"),H.stopped=0,H.paused=1,H.playing=2}(),function(){function N(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new JH,this.resultMatrix=new ZH,this._children=[]}r(N,"laya.ani.bone.Bone");var H=N.prototype;return H.setTempMatrix=function(H){this._tempMatrix=H;var n,C=0;for(C=0,n=this._children.length;C<n;C++)this._children[C].setTempMatrix(this._tempMatrix)},H.update=function(H){var n;if(this.rotation=this.transform.skX,H)n=this.resultTransform.getMatrix(),ZH.mul(n,H,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)n=this.resultTransform.getMatrix(),ZH.mul(n,this.parentBone.resultMatrix,this.resultMatrix);else{var C=this.parentBone,r=NaN,N=NaN,Q=NaN,I=this.parentBone.resultMatrix;n=this.resultTransform.getMatrix();var A=I.a*n.tx+I.c*n.ty+I.tx,P=I.b*n.tx+I.d*n.ty+I.ty,t=new ZH;this.inheritRotation?(r=Math.atan2(C.resultMatrix.b,C.resultMatrix.a),N=Math.cos(r),Q=Math.sin(r),t.setTo(N,Q,-Q,N,0,0),ZH.mul(this._tempMatrix,t,ZH.TEMP),ZH.TEMP.copyTo(t),n=this.resultTransform.getMatrix(),ZH.mul(n,t,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,n=this.resultTransform.getMatrix(),ZH.TEMP.identity(),ZH.TEMP.d=this.d,ZH.mul(n,ZH.TEMP,this.resultMatrix)),this.resultMatrix.tx=A,this.resultMatrix.ty=P}else(n=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var R,y=0;for(y=0,R=this._children.length;y<R;y++)this._children[y].update()},H.updateChild=function(){var H,n=0;for(n=0,H=this._children.length;n<H;n++)this._children[n].update()},H.setRotation=function(H){this._sprite&&(this._sprite.rotation=180*H/Math.PI)},H.updateDraw=function(H,n){N.ShowBones&&!N.ShowBones[this.name]||(this._sprite||(this._sprite=new NH,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),vH.stage.addChild(this._sprite)),this._sprite.x=H+this.resultMatrix.tx,this._sprite.y=n+this.resultMatrix.ty);var C,r=0;for(r=0,C=this._children.length;r<C;r++)this._children[r].updateDraw(H,n)},H.addChild=function(H){this._children.push(H),H.parentBone=this},H.findBone=function(H){if(this.name==H)return this;var n,C,r=0;for(r=0,n=this._children.length;r<n;r++)if(C=this._children[r].findBone(H))return C;return null},H.localToWorld=function(H){var n=H[0],C=H[1];H[0]=n*this.resultMatrix.a+C*this.resultMatrix.c+this.resultMatrix.tx,H[1]=n*this.resultMatrix.b+C*this.resultMatrix.d+this.resultMatrix.ty},N.ShowBones={},N}()),mH=function(){function j(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}r(j,"laya.ani.bone.BoneSlot");var H=j.prototype;return H.showSlotData=function(H,n){void 0===n&&(n=!0),this.currSlotData=H,n&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},H.showDisplayByName=function(H){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(H))},H.replaceDisplayByName=function(H,n){if(this.currSlotData){var C;C=this.currSlotData.getDisplayByName(H);var r;r=this.currSlotData.getDisplayByName(n),this.replaceDisplayByIndex(C,r)}},H.replaceDisplayByIndex=function(H,n){this.currSlotData&&(this._replaceDic[H]=n,this.displayIndex==H&&this.showDisplayByIndex(H))},H.showDisplayByIndex=function(H){if(null!=this._replaceDic[H]&&(H=this._replaceDic[H]),this.currSlotData&&-1<H&&H<this.currSlotData.displayArr.length){if(this.displayIndex=H,this.currDisplayData=this.currSlotData.displayArr[H],this.currDisplayData){var n=this.currDisplayData.name;this.currTexture=this.templet.getTexture(n),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!l.isConchApp||l.isConchApp&&"0.9.15"<NH.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},H.replaceSkin=function(H){this._diyTexture=H,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},H.setParentMatrix=function(H){this._parentMatrix=H},H.draw=function(H,n,C,r){if(void 0===C&&(C=!1),void 0===r&&(r=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var N,Q=this.currTexture;switch(this._diyTexture&&(Q=this._diyTexture),this.currDisplayData.type){case 0:if(H){var I=this.getDisplayMatrix();if(this._parentMatrix){var A=!1;if(I){var P;if(ZH.mul(I,this._parentMatrix,ZH.TEMP),P=C?(null==this._resultMatrix&&(this._resultMatrix=new ZH),this._resultMatrix):new ZH,!l.isWebGL&&this.currDisplayData.uvs||l.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var t=j._tempMatrix;t.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(t.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(A=!0,t.rotate(-Math.PI/2)),ZH.mul(t,ZH.TEMP,P)}else ZH.TEMP.copyTo(P);A?H.drawTexture(Q,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,P):H.drawTexture(Q,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,P)}}}break;case 1:if(null==(N=C?(null==this._skinSprite&&(this._skinSprite=j.createSkinMesh()),this._skinSprite):j.createSkinMesh()))return;var R;if(null==this.currDisplayData.bones){var y,o=this.currDisplayData.weights;this.deformData&&(o=this.deformData),y=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=F.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=F.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=o;this.currDisplayData.triangles.length;R=this.currDisplayData.triangles,N.init2(Q,null,R,this._mVerticleArr,y);var g,M=this.getDisplayMatrix();if(this._parentMatrix)if(M)ZH.mul(M,this._parentMatrix,ZH.TEMP),g=C?(null==this._resultMatrix&&(this._resultMatrix=new ZH),this._resultMatrix):new ZH,ZH.TEMP.copyTo(g),N.transform=g}else this.skinMesh(n,N,r);H.drawSkin(N);break;case 2:if(null==(N=C?(null==this._skinSprite&&(this._skinSprite=j.createSkinMesh()),this._skinSprite):j.createSkinMesh()))return;this.skinMesh(n,N,r),H.drawSkin(N)}}},H.skinMesh=function(H,n,C){var r,N=this.currTexture,Q=this.currDisplayData.bones;r=this._diyTexture?(N=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=F.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=F.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var I,A,P=this.currDisplayData.weights,t=this.currDisplayData.triangles,R=0,y=0,o=0,g=NaN,M=NaN,j=0,l=0,f=[],c=0,K=0;if(this.deformData&&0<this.deformData.length){var W=0;for(c=0,K=Q.length;c<K;){for(o=Q[c++]+c,y=R=0;c<o;c++)A=H[Q[c]],g=P[j]+this.deformData[W++],M=P[j+1]+this.deformData[W++],l=P[j+2],R+=(g*A.a+M*A.c+A.tx)*l,y+=(g*A.b+M*A.d+A.ty)*l,j+=3;f.push(R,y)}}else for(c=0,K=Q.length;c<K;){for(o=Q[c++]+c,y=R=0;c<o;c++)A=H[Q[c]],g=P[j],M=P[j+1],l=P[j+2],R+=(g*A.a+M*A.c+A.tx)*l,y+=(g*A.b+M*A.d+A.ty)*l,j+=3;f.push(R,y)}this._mVerticleArr=f,I=t,n.init2(N,null,I,this._mVerticleArr,r)},H.drawBonePoint=function(H){H&&this._parentMatrix&&H.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},H.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},H.getMatrix=function(){return this._resultMatrix},H.copy=function(){var H=new j;return H.type="copy",H.name=this.name,H.attachmentName=this.attachmentName,H.srcDisplayIndex=this.srcDisplayIndex,H.parent=this.parent,H.displayIndex=this.displayIndex,H.templet=this.templet,H.currSlotData=this.currSlotData,H.currTexture=this.currTexture,H.currDisplayData=this.currDisplayData,H},j.createSkinMesh=function(){return l.isWebGL||l.isConchApp?g.skinAniSprite():(l.isWebGL,null)},C(j,["_tempMatrix",function(){return this._tempMatrix=new ZH}]),j}(),dH=function(){function H(){this.skinName=null,this.deformSlotDataList=[]}return r(H,"laya.ani.bone.DeformAniData"),H}(),_H=function(){function H(){this.deformSlotDisplayList=[]}return r(H,"laya.ani.bone.DeformSlotData"),H}(),UH=function(){function H(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}r(H,"laya.ani.bone.DeformSlotDisplayData");var n=H.prototype;return n.binarySearch1=function(H,n){var C=0,r=H.length-2;if(0==r)return 1;for(var N=r>>>1;;){if(H[Math.floor(N+1)]<=n?C=N+1:r=N,C==r)return C+1;N=C+r>>>1}return 0},n.apply=function(H,n,C){if(void 0===C&&(C=1),H+=.05,!(this.timeList.length<=0)){var r=0;if(!(H<this.timeList[0])){var N=this.vectices[0].length,Q=[],I=this.binarySearch1(this.timeList,H);if(this.frameIndex=I,H>=this.timeList[this.timeList.length-1]){var A=this.vectices[this.vectices.length-1];if(C<1)for(r=0;r<N;r++)Q[r]+=(A[r]-Q[r])*C;else for(r=0;r<N;r++)Q[r]=A[r];this.deformData=Q}else{this.tweenKeyList[this.frameIndex];var P=this.vectices[this.frameIndex-1],t=this.vectices[this.frameIndex],R=this.timeList[this.frameIndex-1],y=this.timeList[this.frameIndex];C=this.tweenKeyList[I-1]?(H-R)/(y-R):0;var o=NaN;for(r=0;r<N;r++)o=P[r],Q[r]=o+(t[r]-o)*C;this.deformData=Q}}}},H}(),sH=function(){function H(){this.time=NaN,this.drawOrder=[]}return r(H,"laya.ani.bone.DrawOrderData"),H}(),$H=function(){function H(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return r(H,"laya.ani.bone.EventData"),H}(),c=function(){function rH(H,n){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=H,this._targetBone=n[H.targetBoneIndex],this.isSpine=H.isSpine,null==this._bones&&(this._bones=[]);for(var C=this._bones.length=0,r=H.boneIndexs.length;C<r;C++)this._bones.push(n[H.boneIndexs[C]]);this.name=H.name,this.mix=H.mix,this.bendDirection=H.bendDirection}r(rH,"laya.ani.bone.IkConstraint");var H=rH.prototype;return H.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},H._applyIk1=function(H,n,C,r){var N=H.parentBone,Q=1/(N.resultMatrix.a*N.resultMatrix.d-N.resultMatrix.b*N.resultMatrix.c),I=n-N.resultMatrix.tx,A=C-N.resultMatrix.ty,P=(I*N.resultMatrix.d-A*N.resultMatrix.c)*Q-H.transform.x,t=(A*N.resultMatrix.a-I*N.resultMatrix.b)*Q-H.transform.y,R=Math.atan2(t,P)*rH.radDeg-0-H.transform.skX;H.transform.scX<0&&(R+=180),180<R?R-=360:R<-180&&(R+=360),H.transform.skX=H.transform.skY=H.transform.skX+R*r,H.update()},H.updatePos=function(H,n){this._sp&&this._sp.pos(H,n)},H._applyIk2=function(H,n,C,r,N,Q){if(0!=Q){var I=H.resultTransform.x,A=H.resultTransform.y,P=H.transform.scX,t=H.transform.scY,R=n.transform.scX,y=0,o=0,g=0;g=P<0?(P=-P,y=180,-1):(y=0,1),t<0&&(t=-t,g=-g),o=R<0?(R=-R,180):0;var M=n.resultTransform.x,j=NaN,l=NaN,f=NaN,c=H.resultMatrix.a,K=H.resultMatrix.c,W=H.resultMatrix.b,z=H.resultMatrix.d,w=Math.abs(P-t)<=1e-4;f=w?(l=c*M+K*(j=n.resultTransform.y)+H.resultMatrix.tx,W*M+z*j+H.resultMatrix.ty):(j=0,l=c*M+H.resultMatrix.tx,W*M+H.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new NH,vH.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(C,r,15,"#ffff00"),this._sp.graphics.drawCircle(l,f,15,"#ff00ff")),H.setRotation(Math.atan2(f-H.resultMatrix.ty,l-H.resultMatrix.tx));var F=H.parentBone;c=F.resultMatrix.a,K=F.resultMatrix.c,W=F.resultMatrix.b;var k=1/(c*(z=F.resultMatrix.d)-K*W),i=C-F.resultMatrix.tx,a=r-F.resultMatrix.ty,D=(i*z-a*K)*k-I,L=(a*c-i*W)*k-A,b=((i=l-F.resultMatrix.tx)*z-(a=f-F.resultMatrix.ty)*K)*k-I,h=(a*c-i*W)*k-A,v=Math.sqrt(b*b+h*h),e=n.length*R,Z=NaN,q=NaN;if(w){var p=(D*D+L*L-v*v-(e*=P)*e)/(2*v*e);p<-1?p=-1:1<p&&(p=1),q=Math.acos(p)*N,c=v+e*p,K=e*Math.sin(q),Z=Math.atan2(L*c-D*K,D*c+L*K)}else{var m=(c=P*e)*c,d=(K=t*e)*K,_=D*D+L*L,U=Math.atan2(L,D),s=-2*d*v,$=d-m;if(0<(z=s*s-4*$*(W=d*v*v+m*_-m*d))){var x=Math.sqrt(z);s<0&&(x=-x);var O=(x=-(s+x)/2)/$,S=W/x,T=Math.abs(O)<Math.abs(S)?O:S;T*T<=_&&(a=Math.sqrt(_-T*T)*N,Z=U-Math.atan2(a,T),q=Math.atan2(a/t,(T-v)/P))}var E=0,G=Number.MAX_VALUE,J=0,Y=0,u=0,X=0,V=0,B=0;X<(z=(i=v+c)*i)&&(u=0,X=z,V=i),(z=(i=v-c)*i)<G&&(E=Math.PI,G=z,J=i);var HH=Math.acos(-c*v/(m-d));(z=(i=c*Math.cos(HH)+v)*i+(a=K*Math.sin(HH))*a)<G&&(E=HH,G=z,J=i,Y=a),X<z&&(u=HH,X=z,V=i,B=a),q=_<=(G+X)/2?(Z=U-Math.atan2(Y*N,J),E*N):(Z=U-Math.atan2(B*N,V),u*N)}var nH=Math.atan2(j,M)*g,CH=H.resultTransform.skX;180<(Z=(Z-nH)*rH.radDeg+y-CH)?Z-=360:Z<-180&&(Z+=360),H.resultTransform.x=I,H.resultTransform.y=A,H.resultTransform.skX=H.resultTransform.skY=CH+Z*Q,CH=n.resultTransform.skX,180<(q=((q+nH)*rH.radDeg-0)*g+o-(CH%=360))?q-=360:q<-180&&(q+=360),n.resultTransform.x=M,n.resultTransform.y=j,n.resultTransform.skX=n.resultTransform.skY=n.resultTransform.skY+q*Q,H.update()}},H._applyIk3=function(H,n,C,r,N,Q){if(0!=Q){var I,A,P=n.resultMatrix.a*n.length,t=n.resultMatrix.b*n.length,R=P*P+t*t,y=Math.sqrt(R),o=H.resultMatrix.tx,g=H.resultMatrix.ty,M=n.resultMatrix.tx,j=n.resultMatrix.ty,l=M-o,f=j-g,c=l*l+f*f,K=Math.sqrt(c),W=(l=C-H.resultMatrix.tx)*l+(f=r-H.resultMatrix.ty)*f,z=Math.sqrt(W);if(y+K<=z||z+y<=K||z+K<=y){var w=NaN;M=o+(w=y+K<=z?1:-1)*(C-o)*K/z,j=g+w*(r-g)*K/z}else{var F=(c-R+W)/(2*W),k=Math.sqrt(c-F*F*W)/z,i=o+l*F,a=g+f*F,D=-f*k,L=l*k;j=0<N?(M=i-D,a-L):(M=i+D,a+L)}I=M,A=j,this.isDebug&&(this._sp||(this._sp=new NH,vH.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(o,g,15,"#ff00ff"),this._sp.graphics.drawCircle(C,r,15,"#ffff00"),this._sp.graphics.drawCircle(I,A,15,"#ff00ff"));var b,h;b=Math.atan2(A-H.resultMatrix.ty,I-H.resultMatrix.tx),H.setRotation(b),(h=rH._tempMatrix).identity(),h.rotate(b),h.scale(H.resultMatrix.getScaleX(),H.resultMatrix.getScaleY()),h.translate(H.resultMatrix.tx,H.resultMatrix.ty),h.copyTo(H.resultMatrix),H.updateChild();var v,e;v=Math.atan2(r-A,C-I),n.setRotation(v),(e=rH._tempMatrix).identity(),e.rotate(v),e.scale(n.resultMatrix.getScaleX(),n.resultMatrix.getScaleY()),e.translate(I,A),h.copyTo(n.resultMatrix),n.updateChild()}},C(rH,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new ZH}]),rH}(),xH=function(){function H(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return r(H,"laya.ani.bone.IkConstraintData"),H}(),z=function(){function e(H,n){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=H,this.position=H.position,this.spacing=H.spacing,this.rotateMix=H.rotateMix,this.translateMix=H.translateMix,this.bones=[];for(var C=this.data.bones,r=0,N=C.length;r<N;r++)this.bones.push(n[C[r]])}r(e,"laya.ani.bone.PathConstraint");var H=e.prototype;return H.apply=function(H,n){if(this.target){var C=this.translateMix,r=this.translateMix,N=0<r,Q=this.data.spacingMode,I="length"==Q,A=this.data.rotateMode,P="tangent"==A,t="chainScale"==A,R=[],y=this.bones.length,o=P?y:y+1,g=[];(this._spaces=g)[0]=this.position;var M=this.spacing;if(t||I)for(var j=0,l=o-1;j<l;){var f=this.bones[j],c=f.length,K=c*f.resultMatrix.a,W=c*f.resultMatrix.b;c=Math.sqrt(K*K+W*W),t&&(R[j]=c),g[++j]=I?Math.max(0,c+M):M}else for(j=1;j<o;j++)g[j]=M;var z=this.computeWorldPositions(this.target,H,n,o,P,"percent"==this.data.positionMode,"percent"==Q);if(this._debugKey){for(j=0;j<z.length;j++)n.drawCircle(z[j++],z[j++],5,"#00ff00");var w=[];for(j=0;j<z.length;j++)w.push(z[j++],z[j++]);n.drawLines(0,0,w,"#ff0000")}var F=z[0],k=z[1],i=this.data.offsetRotation,a="chain"==A&&0==i,D=NaN;for(j=0,D=3;j<y;j++,D+=3){(f=this.bones[j]).resultMatrix.tx+=(F-f.resultMatrix.tx)*C,f.resultMatrix.ty+=(k-f.resultMatrix.ty)*C;var L=(K=z[D])-F,b=(W=z[D+1])-k;if(t&&0!=(c=R[j])){var h=(Math.sqrt(L*L+b*b)/c-1)*r+1;f.resultMatrix.a*=h,f.resultMatrix.c*=h}if(F=K,k=W,N){var v=f.resultMatrix.a,e=f.resultMatrix.c,Z=f.resultMatrix.b,q=f.resultMatrix.d,p=NaN,m=NaN,d=NaN;p=P?z[D-1]:0==g[j+1]?z[D+2]:Math.atan2(b,L),p-=Math.atan2(Z,v)-i/180*Math.PI,a&&(m=Math.cos(p),d=Math.sin(p),F+=((c=f.length)*(m*v-d*Z)-L)*r,k+=(c*(d*v+m*Z)-b)*r),p>Math.PI?p-=2*Math.PI:p<-Math.PI&&(p+=2*Math.PI),p*=r,m=Math.cos(p),d=Math.sin(p),f.resultMatrix.a=m*v-d*Z,f.resultMatrix.c=m*e-d*q,f.resultMatrix.b=d*v+m*Z,f.resultMatrix.d=d*e+m*q}}}},H.computeWorldVertices2=function(H,n,C,r,N,Q){var I,A,P=H.currDisplayData.bones,t=H.currDisplayData.weights,R=H.currDisplayData.triangles,y=0,o=0,g=0,M=0,j=0,l=0,f=0,c=0,K=0,W=0,z=0;if(null!=P){for(y=0;y<C;y+=2)o+=(M=P[o])+1,g+=M;var w=n;for(j=Q,l=3*g;j<r;j+=2){for(c=f=0,M=P[o++],M+=o;o<M;o++,l+=3){I=w[P[o]].resultMatrix,K=t[l],W=t[l+1];var F=t[l+2];f+=(K*I.a+W*I.c+I.tx)*F,c+=(K*I.b+W*I.d+I.ty)*F}N[j]=f,N[j+1]=c}}else{var k,i;if(R||(R=t),H.deformData&&(R=H.deformData),k=H.parent,n)for(z=n.length,y=0;y<z;y++)if(n[y].name==k){A=n[y];break}A&&(i=A.resultMatrix),i||(i=e._tempMt);var a=i.tx,D=i.ty,L=i.a,b=i.b,h=i.c,v=i.d;for(A&&(v*=A.d),o=C,j=Q;j<r;o+=2,j+=2)K=R[o],W=R[o+1],N[j]=K*L+W*b+a,N[j+1]=-(K*h+W*v+D)}},H.computeWorldPositions=function(H,n,C,r,N,Q,I){H.currDisplayData.bones,H.currDisplayData.weights,H.currDisplayData.triangles;var A=[],P=0,t=H.currDisplayData.verLen,R=this.position,y=this._spaces,o=[],g=[],M=t/6,j=-1,l=NaN,f=0,c=0,K=NaN,W=NaN,z=NaN,w=NaN;if(M--,t-=4,this.computeWorldVertices2(H,n,2,t,A,0),this._debugKey)for(P=0;P<A.length;)C.drawCircle(A[P++],A[P++],10,"#ff0000");o=A,this._curves.length=M;var F=this._curves,k=o[l=0],i=o[1],a=0,D=0,L=0,b=0,h=0,v=0,e=NaN,Z=NaN,q=NaN,p=NaN,m=NaN,d=NaN,_=NaN,U=NaN,s=0;for(P=0,s=2;P<M;P++,s+=6)a=o[s],D=o[s+1],L=o[s+2],b=o[s+3],m=2*(e=.1875*(k-2*a+L))+(q=.09375*(3*(a-L)-k+(h=o[s+4]))),d=2*(Z=.1875*(i-2*D+b))+(p=.09375*(3*(D-b)-i+(v=o[s+5]))),_=.75*(a-k)+e+.16666667*q,U=.75*(D-i)+Z+.16666667*p,l+=Math.sqrt(_*_+U*U),_+=m,U+=d,m+=q,d+=p,l+=Math.sqrt(_*_+U*U),_+=m,U+=d,l+=Math.sqrt(_*_+U*U),_+=m+q,U+=d+p,l+=Math.sqrt(_*_+U*U),F[P]=l,k=h,i=v;if(Q&&(R*=l),I)for(P=0;P<r;P++)y[P]*=l;var $=this._segments,x=0,O=0;for(O=c=f=P=0;P<r;P++,f+=3)if((K=R+=W=y[P])<0)this.addBeforePosition(K,o,0,g,f);else if(l<K)this.addAfterPosition(K-l,o,t-4,g,f);else{for(;;c++)if(!((w=F[c])<K)){0==c?K/=w:K=(K-(z=F[c-1]))/(w-z);break}if(c!=j){var S=6*(j=c);for(k=o[S],i=o[S+1],a=o[S+2],D=o[S+3],L=o[S+4],b=o[S+5],m=2*(e=.03*(k-2*a+L))+(q=.006*(3*(a-L)-k+(h=o[S+6]))),d=2*(Z=.03*(i-2*D+b))+(p=.006*(3*(D-b)-i+(v=o[S+7]))),_=.3*(a-k)+e+.16666667*q,U=.3*(D-i)+Z+.16666667*p,x=Math.sqrt(_*_+U*U),$[0]=x,S=1;S<8;S++)_+=m,U+=d,m+=q,d+=p,x+=Math.sqrt(_*_+U*U),$[S]=x;_+=m,U+=d,x+=Math.sqrt(_*_+U*U),$[8]=x,_+=m+q,U+=d+p,x+=Math.sqrt(_*_+U*U),$[9]=x,O=0}for(K*=x;;O++)if(!((w=$[O])<K)){0==O?K/=w:K=O+(K-(z=$[O-1]))/(w-z);break}this.addCurvePosition(.1*K,k,i,a,D,L,b,h,v,g,f,N||0<P&&0==W)}return g},H.addBeforePosition=function(H,n,C,r,N){var Q=n[C],I=n[C+1],A=n[C+2]-Q,P=n[C+3]-I,t=Math.atan2(P,A);r[N]=Q+H*Math.cos(t),r[N+1]=I+H*Math.sin(t),r[N+2]=t},H.addAfterPosition=function(H,n,C,r,N){var Q=n[C+2],I=n[C+3],A=Q-n[C],P=I-n[C+1],t=Math.atan2(P,A);r[N]=Q+H*Math.cos(t),r[N+1]=I+H*Math.sin(t),r[N+2]=t},H.addCurvePosition=function(H,n,C,r,N,Q,I,A,P,t,R,y){0==H&&(H=1e-4);var o=H*H,g=o*H,M=1-H,j=M*M,l=j*M,f=M*H,c=3*f,K=M*c,W=c*H,z=n*l+r*K+Q*W+A*g,w=C*l+N*K+I*W+P*g;t[R]=z,t[R+1]=w,t[R+2]=y?Math.atan2(w-(C*j+N*f*2+I*o),z-(n*j+r*f*2+Q*o)):0},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,C(e,["_tempMt",function(){return this._tempMt=new ZH}]),e}(),OH=function(){function H(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return r(H,"laya.ani.bone.PathConstraintData"),H}(),SH=function(){function H(){this.name=null,this.slotArr=[]}return r(H,"laya.ani.bone.SkinData"),H}(),TH=function(){function H(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}r(H,"laya.ani.bone.SkinSlotDisplayData");var n=H.prototype;return n.createTexture=function(H){return this.texture||(this.texture=new qH(H.bitmap,this.uvs),H.bitmap.alphaTexture&&(this.texture.alphaTexture=new qH(H.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=H.height,this.texture.height=H.width,this.texture.offsetX=-H.offsetX,this.texture.offsetY=-H.offsetY,this.texture.sourceWidth=H.sourceHeight,this.texture.sourceHeight=H.sourceWidth):(this.texture.width=H.width,this.texture.height=H.height,this.texture.offsetX=-H.offsetX,this.texture.offsetY=-H.offsetY,this.texture.sourceWidth=H.sourceWidth,this.texture.sourceHeight=H.sourceHeight),l.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},n.destory=function(){this.texture&&this.texture.destroy()},H}(),EH=function(){function H(){this.name=null,this.displayArr=[]}return r(H,"laya.ani.bone.SlotData"),H.prototype.getDisplayByName=function(H){for(var n=0,C=this.displayArr.length;n<C;n++)if(this.displayArr[n].attachmentName==H)return n;return-1},H}(),w=function(){function H(H,n){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=j(2,0),this._data=H,null==this._bones&&(this._bones=[]),this.target=n[H.targetIndex];var C,r=0;for(r=0,C=H.boneIndexs.length;r<C;r++)this._bones.push(n[H.boneIndexs[r]]);this.rotateMix=H.rotateMix,this.translateMix=H.translateMix,this.scaleMix=H.scaleMix,this.shearMix=H.shearMix}return r(H,"laya.ani.bone.TfConstraint"),H.prototype.apply=function(){for(var H,n=this.target.resultMatrix.a,C=this.target.resultMatrix.b,r=this.target.resultMatrix.c,N=this.target.resultMatrix.d,Q=0,I=this._bones.length;Q<I;Q++){if(H=this._bones[Q],0<this.rotateMix){var A=H.resultMatrix.a,P=H.resultMatrix.b,t=H.resultMatrix.c,R=H.resultMatrix.d,y=Math.atan2(r,n)-Math.atan2(t,A)+this._data.offsetRotation*Math.PI/180;y>Math.PI?y-=2*Math.PI:y<-Math.PI&&(y+=2*Math.PI),y*=this.rotateMix;var o=Math.cos(y),g=Math.sin(y);H.resultMatrix.a=o*A-g*t,H.resultMatrix.b=o*P-g*R,H.resultMatrix.c=g*A+o*t,H.resultMatrix.d=g*P+o*R}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),H.resultMatrix.tx+=(this._temp[0]-H.resultMatrix.tx)*this.translateMix,H.resultMatrix.ty+=(this._temp[1]-H.resultMatrix.ty)*this.translateMix,H.updateChild()),0<this.scaleMix){var M=Math.sqrt(H.resultMatrix.a*H.resultMatrix.a+H.resultMatrix.c*H.resultMatrix.c),j=Math.sqrt(n*n+r*r),l=1e-5<M?(M+(j-M+this._data.offsetScaleX)*this.scaleMix)/M:0;H.resultMatrix.a*=l,H.resultMatrix.c*=l,M=Math.sqrt(H.resultMatrix.b*H.resultMatrix.b+H.resultMatrix.d*H.resultMatrix.d),j=Math.sqrt(C*C+N*N),l=1e-5<M?(M+(j-M+this._data.offsetScaleY)*this.scaleMix)/M:0,H.resultMatrix.b*=l,H.resultMatrix.d*=l}if(0<this.shearMix){P=H.resultMatrix.b,R=H.resultMatrix.d;var f=Math.atan2(R,P);(y=Math.atan2(N,C)-Math.atan2(r,n)-(f-Math.atan2(H.resultMatrix.c,H.resultMatrix.a)))>Math.PI?y-=2*Math.PI:y<-Math.PI&&(y+=2*Math.PI),y=f+(y+this._data.offsetShearY*Math.PI/180)*this.shearMix,l=Math.sqrt(P*P+R*R),H.resultMatrix.b=Math.cos(y)*l,H.resultMatrix.d=Math.sin(y)*l}}},H}(),GH=function(){function H(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return r(H,"laya.ani.bone.TfConstraintData"),H}(),JH=function(){function H(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}r(H,"laya.ani.bone.Transform");var n=H.prototype;return n.initData=function(H){null!=H.x&&(this.x=H.x),null!=H.y&&(this.y=H.y),null!=H.skX&&(this.skX=H.skX),null!=H.skY&&(this.skY=H.skY),null!=H.scX&&(this.scX=H.scX),null!=H.scY&&(this.scY=H.scY)},n.getMatrix=function(){var H;return(H=this.mMatrix?this.mMatrix:this.mMatrix=new ZH).identity(),H.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(H,this.skewX*Math.PI/180,this.skewY*Math.PI/180),H.rotate(this.skX*Math.PI/180),H.translate(this.x,this.y),H},n.skew=function(H,n,C){var r=Math.sin(C),N=Math.cos(C),Q=Math.sin(n),I=Math.cos(n);return H.setTo(H.a*I-H.b*r,H.a*Q+H.b*N,H.c*I-H.d*r,H.c*Q+H.d*N,H.tx*I-H.ty*r,H.tx*Q+H.ty*N),H},H}(),F=function(){function H(){}return r(H,"laya.ani.bone.UVTools"),H.getRelativeUV=function(H,n,C){var r=H[0],N=H[2]-H[0],Q=H[1],I=H[5]-H[1];C||(C=[]),C.length=n.length;var A,P=0;A=C.length;var t=1/N,R=1/I;for(P=0;P<A;P+=2)C[P]=(n[P]-r)*t,C[P+1]=(n[P+1]-Q)*R;return C},H.getAbsoluteUV=function(H,n,C){if(0==H[0]&&0==H[1]&&1==H[4]&&1==H[5])return C?(f.copyArray(C,n),C):n;var r=H[0],N=H[2]-H[0],Q=H[1],I=H[5]-H[1];C||(C=[]),C.length=n.length;var A,P=0;for(A=C.length,P=0;P<A;P+=2)C[P]=n[P]*N+r,C[P+1]=n[P+1]*I+Q;return C},H}(),e=function(){function H(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return r(H,"laya.ani.KeyFramesContent"),H}(),k=function(){function R(){}return r(R,"laya.ani.math.BezierLerp"),R.getBezierRate=function(H,n,C,r,N){var Q=R._getBezierParamKey(n,C,r,N),I=100*Q+H;if(R._bezierResultCache[I])return R._bezierResultCache[I];var A,P=R._getBezierPoints(n,C,r,N,Q),t=0;for(A=P.length,t=0;t<A;t+=2)if(H<=P[t])return R._bezierResultCache[I]=P[t+1],P[t+1];return R._bezierResultCache[I]=1},R._getBezierParamKey=function(H,n,C,r){return 100*(100*(100*(100*H+n)+C)+r)},R._getBezierPoints=function(H,n,C,r,N){return R._bezierPointsCache[N]?R._bezierPointsCache[N]:(Q=[0,0,H,n,C,r,1,1],I=(new A).getBezierPoints(Q,100,3),R._bezierPointsCache[N]=I);var Q,I},R._bezierResultCache={},R._bezierPointsCache={},R}(),i=function(H){function n(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,n.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}r(n,"laya.ani.AnimationPlayer",N);var C=n.prototype;return vH.imps(C,{"laya.resource.IDestroy":!0}),C._onTempletLoadedComputeFullKeyframeIndices=function(H,n,C){this._templet===C&&this._cachePlayRate===H&&this._cacheFrameRate===n&&this._computeFullKeyframeIndices()},C._computeFullKeyframeIndices=function(){for(var H=this._fullFrames=[],n=this._templet,C=this._cacheFrameRateInterval*this._cachePlayRate,r=0,N=n.getAnimationCount();r<N;r++){for(var Q=[],I=0,A=n.getAnimation(r).nodes.length;I<A;I++){for(var P=n.getAnimation(r).nodes[I],t=Math.floor(P.playTime/C+.01),R=new Uint16Array(t+1),y=-1,o=0,g=P.keyFrame.length;o<g;o++){var M=P.keyFrame[o],j=M.startTime,l=j+M.duration+C;do{for(var f=Math.floor(j/C+.5),c=y+1;c<f;c++)R[c]=o;R[y=f]=o,j+=C}while(j<=l)}Q.push(R)}H.push(Q)}},C._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},C._calculatePlayDuration=function(){if(0!==this.state){var H=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=H),this._playEnd>H&&(this._playEnd=H),this._playDuration=this._playEnd-this._playStart}},C._setPlayParams=function(H,n){this._currentTime=H,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/n+.01),0),this._currentFrameTime=this._currentKeyframeIndex*n},C._setPlayParamsWhenStop=function(H,n){this._currentTime=H,this._currentKeyframeIndex=Math.max(Math.floor(H/n+.01),0),this._currentFrameTime=this._currentKeyframeIndex*n,this._currentAnimationClipIndex=-1},C._update=function(H){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var n=this._cacheFrameRateInterval*this._cachePlayRate,C=0;this._startUpdateLoopCount!==M.loopCount&&(C=H*this.playbackRate,this._elapsedPlaybackTime+=C);var r=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=r)return this._setPlayParamsWhenStop(r,n),void this.event("stopped");if(C+=this._currentTime,0<r)if(r<=C)do{if(C-=r,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(r,n),this._stopWhenCircleFinish=!1,void this.event("stopped");C<r&&(this._setPlayParams(C,n),this.event("complete"))}while(r<=C);else this._setPlayParams(C,n);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(r,n),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},C._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},C.play=function(H,n,C,r,N){if(void 0===H&&(H=0),void 0===n&&(n=1),void 0===C&&(C=2147483647),void 0===r&&(r=0),void 0===N&&(N=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(C<0||r<0||N<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==N&&N<r)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=n,this._overallDuration=C,this._playStart=r,this._playEnd=N,this._paused=!1,this._currentAnimationClipIndex=H,this._currentKeyframeIndex=0,this._startUpdateLoopCount=M.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},C.playByFrame=function(H,n,C,r,N,Q){void 0===H&&(H=0),void 0===n&&(n=1),void 0===C&&(C=2147483647),void 0===r&&(r=0),void 0===N&&(N=0),void 0===Q&&(Q=30);var I=1e3/Q;this.play(H,n,C,r*I,N*I)},C.stop=function(H){void 0===H&&(H=!0),H?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},Q(0,C,"playEnd",function(){return this._playEnd}),Q(0,C,"templet",function(){return this._templet},function(H){0===!this.state&&this.stop(!0),this._templet!==H&&((this._templet=H).loaded?this._computeFullKeyframeIndices():H.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),Q(0,C,"playStart",function(){return this._playStart}),Q(0,C,"playDuration",function(){return this._playDuration}),Q(0,C,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),Q(0,C,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),Q(0,C,"overallDuration",function(){return this._overallDuration}),Q(0,C,"currentFrameTime",function(){return this._currentFrameTime}),Q(0,C,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),Q(0,C,"currentPlayTime",function(){return this._currentTime+this._playStart}),Q(0,C,"cachePlayRate",function(){return this._cachePlayRate},function(H){this._cachePlayRate!==H&&(this._cachePlayRate=H,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[H,this._cacheFrameRate])))}),Q(0,C,"cacheFrameRate",function(){return this._cacheFrameRate},function(H){this._cacheFrameRate!==H&&(this._cacheFrameRate=H,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,H])))}),Q(0,C,"currentTime",null,function(H){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(H<this._playStart||H>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=M.loopCount;var n=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=H,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/n),0),this._currentFrameTime=this._currentKeyframeIndex*n}}),Q(0,C,"paused",function(){return this._paused},function(H){(this._paused=H)&&this.event("paused")}),Q(0,C,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),Q(0,C,"destroyed",function(){return this._destroyed}),n}(),Z=function(H){function n(){n.__super.call(this),l.isConchNode&&(this.drawSkin=function(H){H.transform||(H.transform=ZH.EMPTY),this._addCmd([H]),this.setSkinMesh&&this.setSkinMesh(H._ps,H.mVBData,H.mEleNum,0,H.mTexture,H.transform)})}return r(n,"laya.ani.GraphicsAni",I),n.prototype.drawSkin=function(H){var n=[H];this._saveToCmd(l._context._drawSkin,n)},n.create=function(){return n._caches.pop()||new n},n.recycle=function(H){H.clear(),n._caches.push(H)},n._caches=[],n}(),q=function(H){function c(){this._aniMap={},this.unfixedLastAniIndex=-1,c.__super.call(this),this._anis=new Array}r(c,"laya.ani.AnimationTemplet",R);var n=c.prototype;return n.parse=function(H){var n=new eH(H);this._aniVersion=n.readUTFString(),K.parse(this,n)},n._calculateKeyFrame=function(H,n,C){var r=H.keyFrame;r[n]=r[0];for(var N=0;N<n;N++){var Q=r[N];Q.nextData=0===Q.duration?Q.data:r[N+1].data}r.length--},n.onAsynLoaded=function(H,n,C){var r=new eH(n);switch(this._aniVersion=r.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":W.parse(this,r);break;default:K.parse(this,r)}this._endLoaded()},n.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},n.getAnimationCount=function(){return this._anis.length},n.getAnimation=function(H){return this._anis[H]},n.getAniDuration=function(H){return this._anis[H].playTime},n.getNodes=function(H){return this._anis[H].nodes},n.getNodeIndexWithName=function(H,n){return this._anis[H].bone3DMap[n]},n.getNodeCount=function(H){return this._anis[H].nodes.length},n.getTotalkeyframesLength=function(H){return this._anis[H].totalKeyframeDatasLength},n.getPublicExtData=function(){return this._publicExtData},n.getAnimationDataWithCache=function(H,n,C,r){var N=n[C];if(N){var Q=N[H];return Q?Q[r]:null}return null},n.setAnimationDataWithCache=function(H,n,C,r,N){var Q=n[C]||(n[C]={});(Q[H]||(Q[H]=[]))[r]=N},n.getOriginalData=function(H,n,C,r,N){for(var Q=this._anis[H].nodes,I=0,A=0,P=Q.length,t=0;A<P;A++){var R,y=Q[A];R=y.keyFrame[C[A][r]],y.dataOffset=t;var o=N-R.startTime,g=y.lerpType;if(g)switch(g){case 0:case 1:for(I=0;I<y.keyframeWidth;)I+=y.interpolationMethod[I](y,I,n,t+I,R.data,o,null,R.duration,R.nextData);break;case 2:var M=R.interpolationData,j=M.length,l=0;for(I=0;I<j;){var f=M[I];switch(f){case 6:case 7:I+=c.interpolation[f](y,l,n,t+l,R.data,o,null,R.duration,R.nextData,M,I+1);break;default:I+=c.interpolation[f](y,l,n,t+l,R.data,o,null,R.duration,R.nextData)}l++}}else for(I=0;I<y.keyframeWidth;)I+=y.interpolationMethod[I](y,I,n,t+I,R.data,o,null,R.duration,R.nextData);t+=y.keyframeWidth}},n.getNodesCurrentFrameIndex=function(H,n){var C=this._anis[H].nodes;H!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(C.length),this.unfixedCurrentTimes=new Float32Array(C.length),this.unfixedLastAniIndex=H);for(var r=0,N=C.length;r<N;r++){var Q=C[r];for(n<this.unfixedCurrentTimes[r]&&(this.unfixedCurrentFrameIndexes[r]=0),this.unfixedCurrentTimes[r]=n;this.unfixedCurrentFrameIndexes[r]<Q.keyFrame.length&&!(Q.keyFrame[this.unfixedCurrentFrameIndexes[r]].startTime>this.unfixedCurrentTimes[r]);)this.unfixedCurrentFrameIndexes[r]++;this.unfixedCurrentFrameIndexes[r]--}return this.unfixedCurrentFrameIndexes},n.getOriginalDataUnfixedRate=function(H,n,C){var r=this._anis[H].nodes;H!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(r.length),this.unfixedCurrentTimes=new Float32Array(r.length),this.unfixedKeyframes=j(r.length),this.unfixedLastAniIndex=H);for(var N=0,Q=0,I=r.length,A=0;Q<I;Q++){var P=r[Q];for(C<this.unfixedCurrentTimes[Q]&&(this.unfixedCurrentFrameIndexes[Q]=0),this.unfixedCurrentTimes[Q]=C;this.unfixedCurrentFrameIndexes[Q]<P.keyFrame.length&&!(P.keyFrame[this.unfixedCurrentFrameIndexes[Q]].startTime>this.unfixedCurrentTimes[Q]);)this.unfixedKeyframes[Q]=P.keyFrame[this.unfixedCurrentFrameIndexes[Q]],this.unfixedCurrentFrameIndexes[Q]++;var t=this.unfixedKeyframes[Q];P.dataOffset=A;var R=C-t.startTime;if(P.lerpType)switch(P.lerpType){case 0:case 1:for(N=0;N<P.keyframeWidth;)N+=P.interpolationMethod[N](P,N,n,A+N,t.data,R,null,t.duration,t.nextData);break;case 2:var y=t.interpolationData,o=y.length,g=0;for(N=0;N<o;){var M=y[N];switch(M){case 6:case 7:N+=c.interpolation[M](P,g,n,A+g,t.data,R,null,t.duration,t.nextData,y,N+1);break;default:N+=c.interpolation[M](P,g,n,A+g,t.data,R,null,t.duration,t.nextData)}g++}}else for(N=0;N<P.keyframeWidth;)N+=P.interpolationMethod[N](P,N,n,A+N,t.data,R,null,t.duration,t.nextData);A+=P.keyframeWidth}},c._LinearInterpolation_0=function(H,n,C,r,N,Q,I,A,P,t){var R=0===A?0:Q/A;return C[r]=(1-R)*N[n]+R*P[n],1},c._QuaternionInterpolation_1=function(H,n,C,r,N,Q,I,A,P,t){var R=0===A?0:Q/A;return o.slerpQuaternionArray(N,n,P,n,R,C,r),4},c._AngleInterpolation_2=function(H,n,C,r,N,Q,I,A,P,t){return 0},c._RadiansInterpolation_3=function(H,n,C,r,N,Q,I,A,P,t){return 0},c._Matrix4x4Interpolation_4=function(H,n,C,r,N,Q,I,A,P,t){for(var R=0;R<16;R++,n++)C[r+R]=N[n]+Q*I[n];return 16},c._NoInterpolation_5=function(H,n,C,r,N,Q,I,A,P,t){return C[r]=N[n],1},c._BezierInterpolation_6=function(H,n,C,r,N,Q,I,A,P,t,R){return void 0===R&&(R=0),C[r]=N[n]+(P[n]-N[n])*k.getBezierRate(Q/A,t[R],t[R+1],t[R+2],t[R+3]),5},c._BezierInterpolation_7=function(H,n,C,r,N,Q,I,A,P,t,R){return void 0===R&&(R=0),C[r]=t[R+4]+t[R+5]*k.getBezierRate((.001*Q+t[R+6])/t[R+7],t[R],t[R+1],t[R+2],t[R+3]),9},c.load=function(H){return vH.loader.create(H,null,null,c)},c.interpolation=[c._LinearInterpolation_0,c._QuaternionInterpolation_1,c._AngleInterpolation_2,c._RadiansInterpolation_3,c._Matrix4x4Interpolation_4,c._NoInterpolation_5,c._BezierInterpolation_6,c._BezierInterpolation_7],c}(),a=function(n){function C(H,n){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,C.__super.call(this),void 0===n&&(n=0),H&&this.init(H,n)}r(C,"laya.ani.bone.Skeleton",n);var H=C.prototype;return H.init=function(H,n){void 0===n&&(n=0);var C,r,N,Q=0,I=0;if(1==n)for(this._graphicsCache=[],Q=0,I=H.getAnimationCount();Q<I;Q++)this._graphicsCache.push([]);if(this._yReverseMatrix=H.yReverseMatrix,this._aniMode=n,this._templet=H,this._player=new i,this._player.cacheFrameRate=H.rate,this._player.templet=H,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=H.mBoneArr,this._rootBone=H.mRootBone,this._aniSectionDic=H.aniSectionDic,0<H.ikArr.length)for(this._ikArr=[],Q=0,I=H.ikArr.length;Q<I;Q++)this._ikArr.push(new c(H.ikArr[Q],this._boneList));if(0<H.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),Q=0,I=H.pathArr.length;Q<I;Q++)C=H.pathArr[Q],r=new z(C,this._boneList),(N=this._boneSlotDic[C.name])&&((r=new z(C,this._boneList)).target=N),this._pathDic[C.name]=r;if(0<H.tfArr.length)for(this._tfArr=[],Q=0,I=H.tfArr.length;Q<I;Q++)this._tfArr.push(new w(H.tfArr[Q],this._boneList));if(0<H.skinDataArray.length){var A=this._templet.skinDataArray[this._skinIndex];this._skinName=A.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},H.load=function(H,n,C){},H._onLoaded=function(){},H._parseComplete=function(){var H=D.TEMPLET_DICTIONARY[this._aniPath];H&&(this.init(H,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},H._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},H._onPlay=function(){this.event("played")},H._onStop=function(){var H,n=this._templet.eventAniArr[this._aniClipIndex];if(n&&this._eventIndex<n.length)for(;this._eventIndex<n.length;this._eventIndex++)(H=n[this._eventIndex]).time>=this._player.playStart&&H.time<=this._player.playEnd&&this.event("label",H);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},H._onPause=function(){this.event("paused")},H._parseSrcBoneMatrix=function(){var H=0,n=0;for(n=this._templet.srcBoneMatrixArr.length,H=0;H<n;H++)this._boneMatrixArray.push(new ZH);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var C,r,N=this._templet.boneSlotArray;for(H=0,n=N.length;H<n;H++)C=N[H],null==(r=this._bindBoneBoneSlotDic[C.parent])&&(this._bindBoneBoneSlotDic[C.parent]=r=[]),this._boneSlotDic[C.name]=C=C.copy(),r.push(C),this._boneSlotArray.push(C)}},H._emitMissedEvents=function(H,n,C){void 0===C&&(C=0);var r=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(r){var N,Q,I=0;for(N=r.length,I=C;I<N;I++)(Q=r[I]).time>=this._player.playStart&&Q.time<=this._player.playEnd&&this.event("label",Q)}},H._update=function(H){if(void 0===H&&(H=!0),!(this._pause||H&&this._indexControl)){var n=this.timer.currTimer,C=this._player.currentKeyframeIndex,r=n-this._lastTime;if(H?this._player._update(r):C=-1,this._lastTime=n,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<r&&this._clipIndex==C&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var N;this._lastUpdateAniClipIndex=this._aniClipIndex,C>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var Q,I=this._templet.eventAniArr[this._aniClipIndex];if(I&&this._eventIndex<I.length&&((N=I[this._eventIndex]).time>=this._player.playStart&&N.time<=this._player.playEnd?this._player.currentPlayTime>=N.time&&(this.event("label",N),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(Q=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=Q&&(this.graphics=Q));var A=0,P=0;for(P=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,P-1)&&0<P;)P--;if(P<this._clipIndex)for(A=P;A<this._clipIndex;A++)this._createGraphics(A)}else if(1==this._aniMode){if(Q=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=Q&&(this.graphics=Q));for(P=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,P-1)&&0<P;)P--;if(P<this._clipIndex)for(A=P;A<this._clipIndex;A++)this._createGraphics(A)}this._createGraphics()}}},H._createGraphics=function(H){void 0===H&&(H=-1),-1==H&&(H=this._clipIndex);var n,C,r=H*this._player.cacheFrameRateInterval,N=this._templet.drawOrderAniArr[this._aniClipIndex];if(N&&0<N.length)for(this._drawOrderIndex=0,n=N[this._drawOrderIndex];r>=n.time&&(this._drawOrder=n.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=N.length));)n=N[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=Z.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=Z.create(),C=this.graphics;var Q=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],H,r);var I,A,P,t,R=this._aniSectionDic[this._aniClipIndex],y=0,o=0,g=0,M=0,j=0,l=this._templet.srcBoneMatrixArr.length;for(j=R[o=0];o<l;o++)t=this._boneList[o],P=this._templet.srcBoneMatrixArr[o],t.resultTransform.scX=P.scX*this._curOriginalData[y++],t.resultTransform.skX=P.skX+this._curOriginalData[y++],t.resultTransform.skY=P.skY+this._curOriginalData[y++],t.resultTransform.scY=P.scY*this._curOriginalData[y++],t.resultTransform.x=P.x+this._curOriginalData[y++],t.resultTransform.y=P.y+this._curOriginalData[y++],8===this._templet.tMatrixDataLen&&(t.resultTransform.skewX=P.skewX+this._curOriginalData[y++],t.resultTransform.skewY=P.skewY+this._curOriginalData[y++]);var f,c={},K={};for(j+=R[1];o<j;o++)c[(f=Q[o]).name]=this._curOriginalData[y++],K[f.name]=this._curOriginalData[y++],this._curOriginalData[y++],this._curOriginalData[y++],this._curOriginalData[y++],this._curOriginalData[y++];var W,z,w={},F={};for(j+=R[2];o<j;o++)w[(f=Q[o]).name]=this._curOriginalData[y++],F[f.name]=this._curOriginalData[y++],this._curOriginalData[y++],this._curOriginalData[y++],this._curOriginalData[y++],this._curOriginalData[y++];if(this._pathDic)for(j+=R[3];o<j;o++){if(f=Q[o],W=this._pathDic[f.name])switch(new eH(f.extenData).getByte()){case 1:W.position=this._curOriginalData[y++];break;case 2:W.spacing=this._curOriginalData[y++];break;case 3:W.rotateMix=this._curOriginalData[y++],W.translateMix=this._curOriginalData[y++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(ZH.TEMP.identity()),this._ikArr)for(o=0,j=this._ikArr.length;o<j;o++)z=this._ikArr[o],w.hasOwnProperty(z.name)&&(z.bendDirection=w[z.name]),F.hasOwnProperty(z.name)&&(z.mix=F[z.name]),z.apply();if(this._pathDic)for(var k in this._pathDic)(W=this._pathDic[k]).apply(this._boneList,C);if(this._tfArr)for(o=0,M=this._tfArr.length;o<M;o++)this._tfArr[o].apply();for(o=0,M=this._boneList.length;o<M;o++)if(t=this._boneList[o],A=this._bindBoneBoneSlotDic[t.name],t.resultMatrix.copyTo(this._boneMatrixArray[o]),A)for(g=0,j=A.length;g<j;g++)(I=A[g])&&I.setParentMatrix(t.resultMatrix);var i,a,D,L,b={},h=this._templet.deformAniArr;if(h&&0<h.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,o=0,j=this._boneSlotArray.length;o<j;o++)(I=this._boneSlotArray[o]).deformData=null;var v,e=h[this._aniClipIndex];for(v in i=e.default,this._setDeform(i,b,this._boneSlotArray,r),e)"default"!=v&&v!=this._skinName&&(i=e[v],this._setDeform(i,b,this._boneSlotArray,r));i=e[this._skinName],this._setDeform(i,b,this._boneSlotArray,r)}if(this._drawOrder)for(o=0,j=this._drawOrder.length;o<j;o++)a=c[(I=this._boneSlotArray[this._drawOrder[o]]).name],D=K[I.name],isNaN(D)||(C.save(),C.alpha(D)),isNaN(a)||-2==a||(this._templet.attachmentNames?I.showDisplayByName(this._templet.attachmentNames[a]):I.showDisplayByIndex(a)),b[this._drawOrder[o]]?(L=b[this._drawOrder[o]],I.currDisplayData&&L[I.currDisplayData.attachmentName]?I.deformData=L[I.currDisplayData.attachmentName]:I.deformData=null):I.deformData=null,isNaN(D)?I.draw(C,this._boneMatrixArray,2==this._aniMode):I.draw(C,this._boneMatrixArray,2==this._aniMode,D),isNaN(D)||C.restore();else for(o=0,j=this._boneSlotArray.length;o<j;o++)a=c[(I=this._boneSlotArray[o]).name],D=K[I.name],isNaN(D)||(C.save(),C.alpha(D)),isNaN(a)||-2==a||(this._templet.attachmentNames?I.showDisplayByName(this._templet.attachmentNames[a]):I.showDisplayByIndex(a)),b[o]?(L=b[o],I.currDisplayData&&L[I.currDisplayData.attachmentName]?I.deformData=L[I.currDisplayData.attachmentName]:I.deformData=null):I.deformData=null,isNaN(D)?I.draw(C,this._boneMatrixArray,2==this._aniMode):I.draw(C,this._boneMatrixArray,2==this._aniMode,D),isNaN(D)||C.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,H,C):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,H,C)},H._setDeform=function(H,n,C,r){if(H){var N,Q,I,A=0,P=0,t=0;if(H)for(A=0,P=H.deformSlotDataList.length;A<P;A++)for(N=H.deformSlotDataList[A],t=0;t<N.deformSlotDisplayList.length;t++)I=C[(Q=N.deformSlotDisplayList[t]).slotIndex],Q.apply(r,I),n[Q.slotIndex]||(n[Q.slotIndex]={}),n[Q.slotIndex][Q.attachment]=Q.deformData}},H.getAnimNum=function(){return this._templet.getAnimationCount()},H.getAniNameByIndex=function(H){return this._templet.getAniNameByIndex(H)},H.getSlotByName=function(H){return this._boneSlotDic[H]},H.showSkinByName=function(H,n){void 0===n&&(n=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(H),n)},H.showSkinByIndex=function(H,n){void 0===n&&(n=!0);for(var C=0;C<this._boneSlotArray.length;C++)this._boneSlotArray[C].showSlotData(null,n);if(this._templet.showSkinByIndex(this._boneSlotDic,H,n)){var r=this._templet.skinDataArray[H];this._skinIndex=H,this._skinName=r.name}this._clearCache()},H.showSlotSkinByIndex=function(H,n){if(0!=this._aniMode){var C=this.getSlotByName(H);C&&C.showDisplayByIndex(n),this._clearCache()}},H.showSlotSkinByName=function(H,n){if(0!=this._aniMode){var C=this.getSlotByName(H);C&&C.showDisplayByName(n),this._clearCache()}},H.replaceSlotSkinName=function(H,n,C){if(0!=this._aniMode){var r=this.getSlotByName(H);r&&r.replaceDisplayByName(n,C),this._clearCache()}},H.replaceSlotSkinByIndex=function(H,n,C){if(0!=this._aniMode){var r=this.getSlotByName(H);r&&r.replaceDisplayByIndex(n,C),this._clearCache()}},H.setSlotSkin=function(H,n){if(0!=this._aniMode){var C=this.getSlotByName(H);C&&C.replaceSkin(n),this._clearCache()}},H._clearCache=function(){if(1==this._aniMode)for(var H=0,n=this._graphicsCache.length;H<n;H++){for(var C=0,r=this._graphicsCache[H].length;C<r;C++){var N=this._graphicsCache[H][C];N!=this.graphics&&Z.recycle(N)}this._graphicsCache[H].length=0}},H.play=function(H,n,C,r,N,Q){void 0===C&&(C=!0),void 0===r&&(r=0),void 0===N&&(N=0),void 0===Q&&(Q=!0),this._indexControl=!1;var I=-1,A=NaN;if(A=n?2147483647:0,"string"==typeof H)for(var P=0,t=this._templet.getAnimationCount();P<t;P++){var R=this._templet.getAnimation(P);if(R&&H==R.name){I=P;break}}else I=H;-1<I&&I<this.getAnimNum()&&(this._aniClipIndex=I,(C||this._pause||this._currAniIndex!=I)&&(this._currAniIndex=I,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(I)),this._drawOrder=null,this._eventIndex=0,this._player.play(I,this._player.playbackRate,A,r,N),Q&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=y.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},H.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},H.playbackRate=function(H){this._player&&(this._player.playbackRate=H)},H.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},H.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=y.now(),this.timer.frameLoop(1,this,this._update,null,!0))},H._getGrahicsDataWithCache=function(H,n){return this._graphicsCache[H][n]},H._setGrahicsDataWithCache=function(H,n,C){this._graphicsCache[H][n]=C},H.destroy=function(H){void 0===H&&(H=!0),n.prototype.destroy.call(this,H),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},Q(0,H,"url",function(){return this._aniPath},function(H){this.load(H)}),Q(0,H,"index",function(){return this._index},function(H){this.player&&(this._index=H,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),Q(0,H,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),Q(0,H,"templet",function(){return this._templet}),Q(0,H,"player",function(){return this._player}),C.useSimpleMeshInCanvas=!1,C}(NH),D=function(n){function N(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,N.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}r(N,"laya.ani.bone.Templet",n);var H=N.prototype;return H.getLoadList=function(){return this._loadList},H.loadAni=function(H){this._skBufferUrl=H,vH.loader.load(H,P.create(this,this.onComplete),null,"arraybuffer")},H.onComplete=function(H){if(this._isDestroyed)this.destroy();else{var n=t.getRes(this._skBufferUrl);n?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,n)):this.event("error","load failed:"+this._skBufferUrl)}},H.parseData=function(H,n,C){void 0===C&&(C=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=H,this._mainTexture&&l.isWebGL&&H.bitmap&&(H.bitmap.enableMerageInAtlas=!1),this._rate=C,this.parse(n)},H.buildArmature=function(H){return void 0===H&&(H=0),new a(this,H)},H.parse=function(H){n.prototype.parse.call(this,H),this._endLoaded(),this._aniVersion!=N.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+N.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},H._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var H=0;this._loadList=[];var n,C=new eH(this.getPublicExtData()),r=0,N=0,Q=0,I=C.getInt32(),A=C.readUTFString(),P=A.split("\n");for(H=0;H<I;H++)n=this._path+P[2*H],A=P[2*H+1],C.getFloat32(),C.getFloat32(),r=C.getFloat32(),N=C.getFloat32(),Q=C.getFloat32(),isNaN(Q)?0:Q,Q=C.getFloat32(),isNaN(Q)?0:Q,Q=C.getFloat32(),isNaN(Q)?r:Q,Q=C.getFloat32(),isNaN(Q)?N:Q,-1==this._loadList.indexOf(n)&&this._loadList.push(n);this.event("inited",this)}},H._textureComplete=function(){for(var H,n,C=0,r=this._loadList.length;C<r;C++)n=this._loadList[C],H=this._textureDic[n]=t.getRes(n),l.isWebGL&&H&&H.bitmap&&(H.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},H._parsePublicExtData=function(){var H=0,n=0,C=0,r=0,N=0;for(H=0,N=this.getAnimationCount();H<N;H++)this._graphicsCache.push([]);var Q;Q="Dragon"!=this._aniClassName;var I,A,P=new eH(this.getPublicExtData()),t=0,R=0,y=0,o=0,g=0,M=0,j=0,l=0,f=0,c=P.getInt32(),K=P.readUTFString(),W=K.split("\n");for(H=0;H<c;H++){if(I=this._mainTexture,A=this._path+W[2*H],K=W[2*H+1],null==this._mainTexture&&(I=this._textureDic[A]),!I)return this.event("error",this),void(this.isParseFail=!0);t=P.getFloat32(),R=P.getFloat32(),y=P.getFloat32(),o=P.getFloat32(),f=P.getFloat32(),g=isNaN(f)?0:f,f=P.getFloat32(),M=isNaN(f)?0:f,f=P.getFloat32(),j=isNaN(f)?y:f,f=P.getFloat32(),l=isNaN(f)?o:f;var z=qH.create(I,t,R,y,o,-g,-M,j,l);if(!z){var w=W[2*H];vH.recordError("Texture.create失败","tTextureNameRealName："+w)}this.subTextureDic[K]=z,I.alphaTexture&&(this.subTextureDic[K].alphaTexture=qH.create(I.alphaTexture,t,R,y,o,-g,-M,j,l))}this._mainTexture=I;var F,k,i,a,D,L=P.getUint16();for(H=0;H<L;H++)(F=[]).push(P.getUint16()),F.push(P.getUint16()),F.push(P.getUint16()),F.push(P.getUint16()),this.aniSectionDic[H]=F;var b,h=P.getInt16(),v={};for(H=0;H<h;H++)k=new pH,0==H?b=k:k.root=b,k.d=Q?-1:1,a=P.readUTFString(),D=P.readUTFString(),k.length=P.getFloat32(),1==P.getByte()&&(k.inheritRotation=!1),1==P.getByte()&&(k.inheritScale=!1),k.name=a,D&&((i=v[D])?i.addChild(k):this.mRootBone=k),v[a]=k,this.mBoneArr.push(k);this.tMatrixDataLen=P.getUint16();var e,Z,q=P.getUint16(),p=Math.floor(q/this.tMatrixDataLen),m=this.srcBoneMatrixArr;for(H=0;H<p;H++)(e=new JH).scX=P.getFloat32(),e.skX=P.getFloat32(),e.skY=P.getFloat32(),e.scY=P.getFloat32(),e.x=P.getFloat32(),e.y=P.getFloat32(),8===this.tMatrixDataLen&&(e.skewX=P.getFloat32(),e.skewY=P.getFloat32()),m.push(e),(k=this.mBoneArr[H]).transform=e;var d,_=P.getUint16(),U=0;for(H=0;H<_;H++){for(Z=new xH,U=P.getUint16(),n=0;n<U;n++)Z.boneNames.push(P.readUTFString()),Z.boneIndexs.push(P.getInt16());Z.name=P.readUTFString(),Z.targetBoneName=P.readUTFString(),Z.targetBoneIndex=P.getInt16(),Z.bendDirection=P.getFloat32(),Z.mix=P.getFloat32(),Z.isSpine=Q,this.ikArr.push(Z)}var s,$=P.getUint16(),x=0;for(H=0;H<$;H++){for(d=new GH,x=P.getUint16(),n=0;n<x;n++)d.boneIndexs.push(P.getInt16());d.name=P.getUTFString(),d.targetIndex=P.getInt16(),d.rotateMix=P.getFloat32(),d.translateMix=P.getFloat32(),d.scaleMix=P.getFloat32(),d.shearMix=P.getFloat32(),d.offsetRotation=P.getFloat32(),d.offsetX=P.getFloat32(),d.offsetY=P.getFloat32(),d.offsetScaleX=P.getFloat32(),d.offsetScaleY=P.getFloat32(),d.offsetShearY=P.getFloat32(),this.tfArr.push(d)}var O=P.getUint16(),S=0;for(H=0;H<O;H++){for((s=new OH).name=P.readUTFString(),S=P.getUint16(),n=0;n<S;n++)s.bones.push(P.getInt16());s.target=P.readUTFString(),s.positionMode=P.readUTFString(),s.spacingMode=P.readUTFString(),s.rotateMode=P.readUTFString(),s.offsetRotation=P.getFloat32(),s.position=P.getFloat32(),s.spacing=P.getFloat32(),s.rotateMix=P.getFloat32(),s.translateMix=P.getFloat32(),this.pathArr.push(s)}var T,E,G,J,Y,u=0,X=0,V=0,B=NaN,HH=0,nH=P.getInt16();for(H=0;H<nH;H++){var CH=P.getUint8(),rH={};this.deformAniArr.push(rH);for(var NH=0;NH<CH;NH++)for((T=new dH).skinName=P.getUTFString(),rH[T.skinName]=T,u=P.getInt16(),n=0;n<u;n++)for(E=new _H,T.deformSlotDataList.push(E),X=P.getInt16(),C=0;C<X;C++)for(G=new UH,E.deformSlotDisplayList.push(G),G.slotIndex=P.getInt16(),G.attachment=P.getUTFString(),V=P.getInt16(),r=0;r<V;r++)for(1==P.getByte()?G.tweenKeyList.push(!0):G.tweenKeyList.push(!1),B=P.getFloat32(),G.timeList.push(B),J=[],G.vectices.push(J),HH=P.getInt16(),N=0;N<HH;N++)J.push(P.getFloat32())}var QH,IH,AH=P.getInt16(),PH=0,tH=0;for(H=0;H<AH;H++){for(PH=P.getInt16(),Y=[],n=0;n<PH;n++){for((QH=new sH).time=P.getFloat32(),tH=P.getInt16(),C=0;C<tH;C++)QH.drawOrder.push(P.getInt16());Y.push(QH)}this.drawOrderAniArr.push(Y)}var RH,yH=P.getInt16(),oH=0;for(H=0;H<yH;H++){for(oH=P.getInt16(),IH=[],n=0;n<oH;n++)(RH=new $H).name=P.getUTFString(),RH.intValue=P.getInt32(),RH.floatValue=P.getFloat32(),RH.stringValue=P.getUTFString(),RH.time=P.getFloat32(),IH.push(RH);this.eventAniArr.push(IH)}var gH=P.getInt16();if(0<gH)for(this.attachmentNames=[],H=0;H<gH;H++)this.attachmentNames.push(P.getUTFString());var MH,jH,lH=P.getInt16();for(H=0;H<lH;H++)(MH=new mH).name=P.readUTFString(),MH.parent=P.readUTFString(),MH.attachmentName=P.readUTFString(),MH.srcDisplayIndex=MH.displayIndex=P.getInt16(),(MH.templet=this).boneSlotDic[MH.name]=MH,null==(jH=this.bindBoneBoneSlotDic[MH.parent])&&(this.bindBoneBoneSlotDic[MH.parent]=jH=[]),jH.push(MH),this.boneSlotArray.push(MH);var fH,cH,KH,WH=P.readUTFString().split("\n"),zH=0,wH=P.getUint8(),FH=0,kH=0,iH=0,aH=0,DH=0,LH=0,bH=0;for(H=0;H<wH;H++){for((fH=new SH).name=WH[zH++],FH=P.getUint8(),n=0;n<FH;n++){for((cH=new EH).name=WH[zH++],MH=this.boneSlotDic[cH.name],kH=P.getUint8(),C=0;C<kH;C++){if(KH=new TH,this.skinSlotDisplayDataArr.push(KH),KH.name=WH[zH++],KH.attachmentName=WH[zH++],KH.transform=new JH,KH.transform.scX=P.getFloat32(),KH.transform.skX=P.getFloat32(),KH.transform.skY=P.getFloat32(),KH.transform.scY=P.getFloat32(),KH.transform.x=P.getFloat32(),KH.transform.y=P.getFloat32(),cH.displayArr.push(KH),KH.width=P.getFloat32(),KH.height=P.getFloat32(),KH.type=P.getUint8(),KH.verLen=P.getUint16(),0<(h=P.getUint16()))for(KH.bones=[],r=0;r<h;r++){var hH=P.getUint16();KH.bones.push(hH)}if(0<(iH=P.getUint16()))for(KH.uvs=[],r=0;r<iH;r++)KH.uvs.push(P.getFloat32());if(0<(aH=P.getUint16()))for(KH.weights=[],r=0;r<aH;r++)KH.weights.push(P.getFloat32());if(0<(DH=P.getUint16()))for(KH.triangles=[],r=0;r<DH;r++)KH.triangles.push(P.getUint16());if(0<(LH=P.getUint16()))for(KH.vertices=[],r=0;r<LH;r++)KH.vertices.push(P.getFloat32());if(0<(bH=P.getUint16()))for(KH.lengths=[],r=0;r<bH;r++)KH.lengths.push(P.getFloat32())}fH.slotArr.push(cH)}this.skinDic[fH.name]=fH,this.skinDataArray.push(fH)}1==P.getUint8()?(this.yReverseMatrix=new ZH(1,0,0,-1,0,0),b&&b.setTempMatrix(this.yReverseMatrix)):b&&b.setTempMatrix(new ZH),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},H.getTexture=function(H){var n=this.subTextureDic[H];return n||(n=this.subTextureDic[H.substr(0,H.length-1)]),null==n?this._mainTexture:n},H.showSkinByIndex=function(H,n,C){if(void 0===C&&(C=!0),n<0&&n>=this.skinDataArray.length)return!1;var r,N,Q=0,I=0,A=this.skinDataArray[n];if(A){for(Q=0,I=A.slotArr.length;Q<I;Q++)(N=A.slotArr[Q])&&(r=H[N.name])&&(r.showSlotData(N,C),C&&"undefined"!=r.attachmentName&&"null"!=r.attachmentName?r.showDisplayByName(r.attachmentName):r.showDisplayByIndex(r.displayIndex));return!0}return!1},H.getSkinIndexByName=function(H){for(var n=0,C=this.skinDataArray.length;n<C;n++)if(this.skinDataArray[n].name==H)return n;return-1},H.getGrahicsDataWithCache=function(H,n){return this._graphicsCache[H][n]},H.setGrahicsDataWithCache=function(H,n,C){this._graphicsCache[H][n]=C},H.destroy=function(){var H;for(var n in this._isDestroyed=!0,this.subTextureDic)(H=this.subTextureDic[n])&&H.destroy();for(n in this._textureDic)(H=this._textureDic[n])&&H.destroy();for(var C=0,r=this.skinSlotDisplayDataArr.length;C<r;C++)this.skinSlotDisplayDataArr[C].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete N.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},H.getAniNameByIndex=function(H){var n=this.getAnimation(H);return n?n.name:null},Q(0,H,"rate",function(){return this._rate},function(H){this._rate=H}),N.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",N.TEMPLET_DICTIONARY=null,N}(q)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(H,n){"use strict";for(var C in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var r=Laya[C];r&&r.__isclass&&(n[C]=r)}}),function(H,n){"object"==typeof exports&&"object"==typeof module?window?window.Matter=n():module.exports=n():"function"==typeof define&&define.amd?define("Matter",[],n):"object"==typeof exports?exports.Matter=n():H.Matter=n()}(this,function(){return function(C){var r={};function N(H){if(r[H])return r[H].exports;var n=r[H]={i:H,l:!1,exports:{}};return C[H].call(n.exports,n,n.exports,N),n.l=!0,n.exports}return N.m=C,N.c=r,N.d=function(H,n,C){N.o(H,n)||Object.defineProperty(H,n,{enumerable:!0,get:C})},N.r=function(H){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(H,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(H,"__esModule",{value:!0})},N.t=function(n,H){if(1&H&&(n=N(n)),8&H)return n;if(4&H&&"object"==typeof n&&n&&n.__esModule)return n;var C=Object.create(null);if(N.r(C),Object.defineProperty(C,"default",{enumerable:!0,value:n}),2&H&&"string"!=typeof n)for(var r in n)N.d(C,r,function(H){return n[H]}.bind(null,r));return C},N.n=function(H){var n=H&&H.__esModule?function(){return H.default}:function(){return H};return N.d(n,"a",n),n},N.o=function(H,n){return Object.prototype.hasOwnProperty.call(H,n)},N.p="",N(N.s=21)}([function(H,n){var P={};H.exports=P,function(){P._nextId=0,P._seed=0,P._nowStartTime=+new Date,P._warnedOnce={},P._decomp=null,P.extend=function(H,n){var C,r;r="boolean"==typeof n?(C=2,n):(C=1,!0);for(var N=C;N<arguments.length;N++){var Q=arguments[N];if(Q)for(var I in Q)r&&Q[I]&&Q[I].constructor===Object?H[I]&&H[I].constructor!==Object?H[I]=Q[I]:(H[I]=H[I]||{},P.extend(H[I],r,Q[I])):H[I]=Q[I]}return H},P.clone=function(H,n){return P.extend({},n,H)},P.keys=function(H){if(Object.keys)return Object.keys(H);var n=[];for(var C in H)n.push(C);return n},P.values=function(H){var n=[];if(Object.keys){for(var C=Object.keys(H),r=0;r<C.length;r++)n.push(H[C[r]]);return n}for(var N in H)n.push(H[N]);return n},P.get=function(H,n,C,r){n=n.split(".").slice(C,r);for(var N=0;N<n.length;N+=1)H=H[n[N]];return H},P.set=function(H,n,C,r,N){var Q=n.split(".").slice(r,N);return P.get(H,n,0,-1)[Q[Q.length-1]]=C},P.shuffle=function(H){for(var n=H.length-1;0<n;n--){var C=Math.floor(P.random()*(n+1)),r=H[n];H[n]=H[C],H[C]=r}return H},P.choose=function(H){return H[Math.floor(P.random()*H.length)]},P.isElement=function(H){return"undefined"!=typeof HTMLElement?H instanceof HTMLElement:!!(H&&H.nodeType&&H.nodeName)},P.isArray=function(H){return"[object Array]"===Object.prototype.toString.call(H)},P.isFunction=function(H){return"function"==typeof H},P.isPlainObject=function(H){return"object"==typeof H&&H.constructor===Object},P.isString=function(H){return"[object String]"===toString.call(H)},P.clamp=function(H,n,C){return H<n?n:C<H?C:H},P.sign=function(H){return H<0?-1:1},P.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-P._nowStartTime},P.random=function(H,n){return n=void 0!==n?n:1,(H=void 0!==H?H:0)+C()*(n-H)};var C=function(){return P._seed=(9301*P._seed+49297)%233280,P._seed/233280};P.colorToNumber=function(H){return 3==(H=H.replace("#","")).length&&(H=H.charAt(0)+H.charAt(0)+H.charAt(1)+H.charAt(1)+H.charAt(2)+H.charAt(2)),parseInt(H,16)},P.logLevel=1,P.log=function(){console&&0<P.logLevel&&P.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},P.info=function(){console&&0<P.logLevel&&P.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},P.warn=function(){console&&0<P.logLevel&&P.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},P.warnOnce=function(){var H=Array.prototype.slice.call(arguments).join(" ");P._warnedOnce[H]||(P.warn(H),P._warnedOnce[H]=!0)},P.deprecated=function(H,n,C){H[n]=P.chain(function(){P.warnOnce("🔅 deprecated 🔅",C)},H[n])},P.nextId=function(){return P._nextId++},P.indexOf=function(H,n){if(H.indexOf)return H.indexOf(n);for(var C=0;C<H.length;C++)if(H[C]===n)return C;return-1},P.map=function(H,n){if(H.map)return H.map(n);for(var C=[],r=0;r<H.length;r+=1)C.push(n(H[r]));return C},P.topologicalSort=function(H){var n=[],C=[],r=[];for(var N in H)C[N]||r[N]||P._topologicalSort(N,C,r,H,n);return n},P._topologicalSort=function(H,n,C,r,N){var Q=r[H]||[];C[H]=!0;for(var I=0;I<Q.length;I+=1){var A=Q[I];C[A]||(n[A]||P._topologicalSort(A,n,C,r,N))}C[H]=!1,n[H]=!0,N.push(H)},P.chain=function(){for(var Q=[],H=0;H<arguments.length;H+=1){var n=arguments[H];n._chained?Q.push.apply(Q,n._chained):Q.push(n)}function C(){for(var H,n=new Array(arguments.length),C=0,r=arguments.length;C<r;C++)n[C]=arguments[C];for(C=0;C<Q.length;C+=1){var N=Q[C].apply(H,n);void 0!==N&&(H=N)}return H}return C._chained=Q,C},P.chainPathBefore=function(H,n,C){return P.set(H,n,P.chain(C,P.get(H,n)))},P.chainPathAfter=function(H,n,C){return P.set(H,n,P.chain(P.get(H,n),C))},P.setDecomp=function(H){P._decomp=H},P.getDecomp=function(){var n=P._decomp;try{n||"undefined"==typeof window||(n=window.decomp),n||"undefined"==typeof global||(n=global.decomp)}catch(H){n=null}return n}}()},function(H,n){var C={};(H.exports=C).create=function(H){var n={min:{x:0,y:0},max:{x:0,y:0}};return H&&C.update(n,H),n},C.update=function(H,n,C){H.min.x=1/0,H.max.x=-1/0,H.min.y=1/0,H.max.y=-1/0;for(var r=0;r<n.length;r++){var N=n[r];N.x>H.max.x&&(H.max.x=N.x),N.x<H.min.x&&(H.min.x=N.x),N.y>H.max.y&&(H.max.y=N.y),N.y<H.min.y&&(H.min.y=N.y)}C&&(0<C.x?H.max.x+=C.x:H.min.x+=C.x,0<C.y?H.max.y+=C.y:H.min.y+=C.y)},C.contains=function(H,n){return n.x>=H.min.x&&n.x<=H.max.x&&n.y>=H.min.y&&n.y<=H.max.y},C.overlaps=function(H,n){return H.min.x<=n.max.x&&H.max.x>=n.min.x&&H.max.y>=n.min.y&&H.min.y<=n.max.y},C.translate=function(H,n){H.min.x+=n.x,H.max.x+=n.x,H.min.y+=n.y,H.max.y+=n.y},C.shift=function(H,n){var C=H.max.x-H.min.x,r=H.max.y-H.min.y;H.min.x=n.x,H.max.x=n.x+C,H.min.y=n.y,H.max.y=n.y+r}},function(H,n){var C={};(H.exports=C).create=function(H,n){return{x:H||0,y:n||0}},C.clone=function(H){return{x:H.x,y:H.y}},C.magnitude=function(H){return Math.sqrt(H.x*H.x+H.y*H.y)},C.magnitudeSquared=function(H){return H.x*H.x+H.y*H.y},C.rotate=function(H,n,C){var r=Math.cos(n),N=Math.sin(n);C||(C={});var Q=H.x*r-H.y*N;return C.y=H.x*N+H.y*r,C.x=Q,C},C.rotateAbout=function(H,n,C,r){var N=Math.cos(n),Q=Math.sin(n);r||(r={});var I=C.x+((H.x-C.x)*N-(H.y-C.y)*Q);return r.y=C.y+((H.x-C.x)*Q+(H.y-C.y)*N),r.x=I,r},C.normalise=function(H){var n=C.magnitude(H);return 0===n?{x:0,y:0}:{x:H.x/n,y:H.y/n}},C.dot=function(H,n){return H.x*n.x+H.y*n.y},C.cross=function(H,n){return H.x*n.y-H.y*n.x},C.cross3=function(H,n,C){return(n.x-H.x)*(C.y-H.y)-(n.y-H.y)*(C.x-H.x)},C.add=function(H,n,C){return C||(C={}),C.x=H.x+n.x,C.y=H.y+n.y,C},C.sub=function(H,n,C){return C||(C={}),C.x=H.x-n.x,C.y=H.y-n.y,C},C.mult=function(H,n){return{x:H.x*n,y:H.y*n}},C.div=function(H,n){return{x:H.x/n,y:H.y/n}},C.perp=function(H,n){return{x:(n=!0===n?-1:1)*-H.y,y:n*H.x}},C.neg=function(H){return{x:-H.x,y:-H.y}},C.angle=function(H,n){return Math.atan2(n.y-H.y,n.x-H.x)},C._temp=[C.create(),C.create(),C.create(),C.create(),C.create(),C.create()]},function(H,n,C){var A={};H.exports=A;var W=C(2),z=C(0);A.create=function(H,n){for(var C=[],r=0;r<H.length;r++){var N=H[r],Q={x:N.x,y:N.y,index:r,body:n,isInternal:!1};C.push(Q)}return C},A.fromPath=function(H,n){var r=[];return H.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,function(H,n,C){r.push({x:parseFloat(n),y:parseFloat(C)})}),A.create(r,n)},A.centre=function(H){for(var n,C,r,N=A.area(H,!0),Q={x:0,y:0},I=0;I<H.length;I++)r=(I+1)%H.length,n=W.cross(H[I],H[r]),C=W.mult(W.add(H[I],H[r]),n),Q=W.add(Q,C);return W.div(Q,6*N)},A.mean=function(H){for(var n={x:0,y:0},C=0;C<H.length;C++)n.x+=H[C].x,n.y+=H[C].y;return W.div(n,H.length)},A.area=function(H,n){for(var C=0,r=H.length-1,N=0;N<H.length;N++)C+=(H[r].x-H[N].x)*(H[r].y+H[N].y),r=N;return n?C/2:Math.abs(C)/2},A.inertia=function(H,n){for(var C,r,N=0,Q=0,I=H,A=0;A<I.length;A++)r=(A+1)%I.length,N+=(C=Math.abs(W.cross(I[r],I[A])))*(W.dot(I[r],I[r])+W.dot(I[r],I[A])+W.dot(I[A],I[A])),Q+=C;return n/6*(N/Q)},A.translate=function(H,n,C){C=void 0!==C?C:1;var r,N=H.length,Q=n.x*C,I=n.y*C;for(r=0;r<N;r++)H[r].x+=Q,H[r].y+=I;return H},A.rotate=function(H,n,C){if(0!==n){var r,N,Q,I,A=Math.cos(n),P=Math.sin(n),t=C.x,R=C.y,y=H.length;for(I=0;I<y;I++)N=(r=H[I]).x-t,Q=r.y-R,r.x=t+(N*A-Q*P),r.y=R+(N*P+Q*A);return H}},A.contains=function(H,n){for(var C,r=n.x,N=n.y,Q=H.length,I=H[Q-1],A=0;A<Q;A++){if(C=H[A],0<(r-I.x)*(C.y-I.y)+(N-I.y)*(I.x-C.x))return!1;I=C}return!0},A.scale=function(H,n,C,r){if(1===n&&1===C)return H;var N,Q;r=r||A.centre(H);for(var I=0;I<H.length;I++)N=H[I],Q=W.sub(N,r),H[I].x=r.x+Q.x*n,H[I].y=r.y+Q.y*C;return H},A.chamfer=function(H,n,C,r,N){n="number"==typeof n?[n]:n||[8],C=void 0!==C?C:-1,r=r||2,N=N||14;for(var Q=[],I=0;I<H.length;I++){var A=H[0<=I-1?I-1:H.length-1],P=H[I],t=H[(I+1)%H.length],R=n[I<n.length?I:n.length-1];if(0!==R){var y=W.normalise({x:P.y-A.y,y:A.x-P.x}),o=W.normalise({x:t.y-P.y,y:P.x-t.x}),g=Math.sqrt(2*Math.pow(R,2)),M=W.mult(z.clone(y),R),j=W.normalise(W.mult(W.add(y,o),.5)),l=W.sub(P,W.mult(j,g)),f=C;-1===C&&(f=1.75*Math.pow(R,.32)),(f=z.clamp(f,r,N))%2==1&&(f+=1);for(var c=Math.acos(W.dot(y,o))/f,K=0;K<f;K++)Q.push(W.add(W.rotate(M,c*K),l))}else Q.push(P)}return Q},A.clockwiseSort=function(H){var C=A.mean(H);return H.sort(function(H,n){return W.angle(C,H)-W.angle(C,n)}),H},A.isConvex=function(H){var n,C,r,N,Q=0,I=H.length;if(I<3)return null;for(n=0;n<I;n++)if(r=(n+2)%I,N=(H[C=(n+1)%I].x-H[n].x)*(H[r].y-H[C].y),(N-=(H[C].y-H[n].y)*(H[r].x-H[C].x))<0?Q|=1:0<N&&(Q|=2),3===Q)return!1;return 0!==Q||null},A.hull=function(H){var n,C,r=[],N=[];for((H=H.slice(0)).sort(function(H,n){var C=H.x-n.x;return 0!=C?C:H.y-n.y}),C=0;C<H.length;C+=1){for(n=H[C];2<=N.length&&W.cross3(N[N.length-2],N[N.length-1],n)<=0;)N.pop();N.push(n)}for(C=H.length-1;0<=C;C-=1){for(n=H[C];2<=r.length&&W.cross3(r[r.length-2],r[r.length-1],n)<=0;)r.pop();r.push(n)}return r.pop(),N.pop(),r.concat(N)}},function(H,n,C){var r={};H.exports=r;var R=C(0);r.on=function(H,n,C){for(var r,N=n.split(" "),Q=0;Q<N.length;Q++)r=N[Q],H.events=H.events||{},H.events[r]=H.events[r]||[],H.events[r].push(C);return C},r.off=function(H,n,C){if(n){"function"==typeof n&&(C=n,n=R.keys(H.events).join(" "));for(var r=n.split(" "),N=0;N<r.length;N++){var Q=H.events[r[N]],I=[];if(C&&Q)for(var A=0;A<Q.length;A++)Q[A]!==C&&I.push(Q[A]);H.events[r[N]]=I}}else H.events={}},r.trigger=function(H,n,C){var r,N,Q,I,A=H.events;if(A&&0<R.keys(A).length){C||(C={}),r=n.split(" ");for(var P=0;P<r.length;P++)if(Q=A[N=r[P]]){(I=R.clone(C,!1)).name=N,I.source=H;for(var t=0;t<Q.length;t++)Q[t].apply(H,[I])}}}},function(H,n,C){var y={};H.exports=y;var I=C(4),A=C(0),Q=C(1),o=C(6);y.create=function(H){return A.extend({id:A.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},H)},y.setModified=function(H,n,C,r){if((H.isModified=n)&&H.cache&&(H.cache.allBodies=null,H.cache.allConstraints=null,H.cache.allComposites=null),C&&H.parent&&y.setModified(H.parent,n,C,r),r)for(var N=0;N<H.composites.length;N++){var Q=H.composites[N];y.setModified(Q,n,C,r)}},y.add=function(H,n,C){var r=[].concat(n);I.trigger(H,"beforeAdd",{object:n});for(var N=0;N<r.length;N++){var Q=r[N];switch(Q.type){case"body":if(Q.parent!==Q){A.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}0<=C&&C<H.bodies.length?y.addBodyAt(H,Q,C):y.addBody(H,Q);break;case"constraint":y.addConstraint(H,Q);break;case"composite":y.addComposite(H,Q);break;case"mouseConstraint":y.addConstraint(H,Q.constraint)}}return I.trigger(H,"afterAdd",{object:n}),H},y.remove=function(H,n,C){var r=[].concat(n);I.trigger(H,"beforeRemove",{object:n});for(var N=0;N<r.length;N++){var Q=r[N];switch(Q.type){case"body":y.removeBody(H,Q,C);break;case"constraint":y.removeConstraint(H,Q,C);break;case"composite":y.removeComposite(H,Q,C);break;case"mouseConstraint":y.removeConstraint(H,Q.constraint)}}return I.trigger(H,"afterRemove",{object:n}),H},y.addComposite=function(H,n){return H.composites.push(n),n.parent=H,y.setModified(H,!0,!0,!1),H},y.removeComposite=function(H,n,C){var r=A.indexOf(H.composites,n);if(-1!==r&&y.removeCompositeAt(H,r),C)for(var N=0;N<H.composites.length;N++)y.removeComposite(H.composites[N],n,!0);return H},y.removeCompositeAt=function(H,n){return H.composites.splice(n,1),y.setModified(H,!0,!0,!1),H},y.addBodyAt=function(H,n,C){return 0<=C&&C<H.bodies.length?H.bodies.splice(C,0,n):H.bodies.push(n),y.setModified(H,!0,!0,!1),H},y.addBody=function(H,n){return H.bodies.push(n),y.setModified(H,!0,!0,!1),H},y.removeBody=function(H,n,C){var r=A.indexOf(H.bodies,n);if(-1!==r&&y.removeBodyAt(H,r),C)for(var N=0;N<H.composites.length;N++)y.removeBody(H.composites[N],n,!0);return H},y.removeBodyAt=function(H,n){return H.bodies.splice(n,1),y.setModified(H,!0,!0,!1),H},y.addConstraint=function(H,n){return H.constraints.push(n),y.setModified(H,!0,!0,!1),H},y.removeConstraint=function(H,n,C){var r=A.indexOf(H.constraints,n);if(-1!==r&&y.removeConstraintAt(H,r),C)for(var N=0;N<H.composites.length;N++)y.removeConstraint(H.composites[N],n,!0);return H},y.removeConstraintAt=function(H,n){return H.constraints.splice(n,1),y.setModified(H,!0,!0,!1),H},y.clear=function(H,n,C){if(C)for(var r=0;r<H.composites.length;r++)y.clear(H.composites[r],n,!0);return n?H.bodies=H.bodies.filter(function(H){return H.isStatic}):H.bodies.length=0,H.constraints.length=0,H.composites.length=0,y.setModified(H,!0,!0,!1),H},y.allBodies=function(H){if(H.cache&&H.cache.allBodies)return H.cache.allBodies;for(var n=[].concat(H.bodies),C=0;C<H.composites.length;C++)n=n.concat(y.allBodies(H.composites[C]));return H.cache&&(H.cache.allBodies=n),n},y.allConstraints=function(H){if(H.cache&&H.cache.allConstraints)return H.cache.allConstraints;for(var n=[].concat(H.constraints),C=0;C<H.composites.length;C++)n=n.concat(y.allConstraints(H.composites[C]));return H.cache&&(H.cache.allConstraints=n),n},y.allComposites=function(H){if(H.cache&&H.cache.allComposites)return H.cache.allComposites;for(var n=[].concat(H.composites),C=0;C<H.composites.length;C++)n=n.concat(y.allComposites(H.composites[C]));return H.cache&&(H.cache.allComposites=n),n},y.get=function(H,n,C){var r,N;switch(C){case"body":r=y.allBodies(H);break;case"constraint":r=y.allConstraints(H);break;case"composite":r=y.allComposites(H).concat(H)}return r?0===(N=r.filter(function(H){return H.id.toString()===n.toString()})).length?null:N[0]:null},y.move=function(H,n,C){return y.remove(H,n),y.add(C,n),H},y.rebase=function(H){for(var n=y.allBodies(H).concat(y.allConstraints(H)).concat(y.allComposites(H)),C=0;C<n.length;C++)n[C].id=A.nextId();return H},y.translate=function(H,n,C){for(var r=C?y.allBodies(H):H.bodies,N=0;N<r.length;N++)o.translate(r[N],n);return H},y.rotate=function(H,n,C,r){for(var N=Math.cos(n),Q=Math.sin(n),I=r?y.allBodies(H):H.bodies,A=0;A<I.length;A++){var P=I[A],t=P.position.x-C.x,R=P.position.y-C.y;o.setPosition(P,{x:C.x+(t*N-R*Q),y:C.y+(t*Q+R*N)}),o.rotate(P,n)}return H},y.scale=function(H,n,C,r,N){for(var Q=N?y.allBodies(H):H.bodies,I=0;I<Q.length;I++){var A=Q[I],P=A.position.x-r.x,t=A.position.y-r.y;o.setPosition(A,{x:r.x+P*n,y:r.y+t*C}),o.scale(A,n,C)}return H},y.bounds=function(H){for(var n=y.allBodies(H),C=[],r=0;r<n.length;r+=1){var N=n[r];C.push(N.bounds.min,N.bounds.max)}return Q.create(C)}},function(H,n,C){var t={};H.exports=t;var y=C(3),o=C(2),N=C(7),Q=(C(16),C(0)),g=C(1),M=C(11);!function(){t._inertiaScale=4,t._nextCollidingGroupId=1,t._nextNonCollidingGroupId=-1,t._nextCategory=1,t.create=function(H){var n={id:Q.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:y.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,positionRc:{cpx:0,cpy:0,ppx:0,ppy:0},friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},C=Q.extend(n,H);return r(C,H),C},t.nextGroup=function(H){return H?t._nextNonCollidingGroupId--:t._nextCollidingGroupId++},t.nextCategory=function(){return t._nextCategory=t._nextCategory<<1,t._nextCategory};var r=function(H,n){n=n||{},t.set(H,{bounds:H.bounds||g.create(H.vertices),worldBounds:n.worldBounds,positionPrev:H.positionPrev||o.clone(H.position),anglePrev:H.anglePrev||H.angle,vertices:H.vertices,parts:H.parts||[H],isStatic:H.isStatic,isSleeping:H.isSleeping,parent:H.parent||H}),y.rotate(H.vertices,H.angle,H.position),M.rotate(H.axes,H.angle),g.update(H.bounds,H.vertices,H.velocity),t.set(H,{axes:n.axes||H.axes,area:n.area||H.area,mass:n.mass||H.mass,inertia:n.inertia||H.inertia});var C=H.isStatic?"#14151f":Q.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),r=H.isStatic?"#555":"#ccc",N=H.isStatic&&null===H.render.fillStyle?1:0;H.render.fillStyle=H.render.fillStyle||C,H.render.strokeStyle=H.render.strokeStyle||r,H.render.lineWidth=H.render.lineWidth||N,H.render.sprite.xOffset+=-(H.bounds.min.x-H.position.x)/(H.bounds.max.x-H.bounds.min.x),H.render.sprite.yOffset+=-(H.bounds.min.y-H.position.y)/(H.bounds.max.y-H.bounds.min.y)};t.set=function(H,n,C){var r;for(r in"string"==typeof n&&(r=n,(n={})[r]=C),n)if(Object.prototype.hasOwnProperty.call(n,r))switch(C=n[r],r){case"isStatic":t.setStatic(H,C);break;case"isSleeping":N.set(H,C);break;case"mass":t.setMass(H,C);break;case"density":t.setDensity(H,C);break;case"inertia":t.setInertia(H,C);break;case"vertices":t.setVertices(H,C);break;case"position":t.setPosition(H,C);break;case"angle":t.setAngle(H,C);break;case"velocity":t.setVelocity(H,C);break;case"angularVelocity":t.setAngularVelocity(H,C);break;case"parts":t.setParts(H,C);break;case"centre":t.setCentre(H,C);break;default:H[r]=C}},t.setStatic=function(H,n){for(var C=0;C<H.parts.length;C++){var r=H.parts[C];(r.isStatic=n)?(r._original={restitution:r.restitution,friction:r.friction,mass:r.mass,inertia:r.inertia,density:r.density,inverseMass:r.inverseMass,inverseInertia:r.inverseInertia},r.restitution=0,r.friction=1,r.mass=r.inertia=r.density=1/0,r.inverseMass=r.inverseInertia=0,r.positionPrev.x=r.position.x,r.positionPrev.y=r.position.y,r.anglePrev=r.angle,r.angularVelocity=0,r.speed=0,r.angularSpeed=0,r.motion=0):r._original&&(r.restitution=r._original.restitution,r.friction=r._original.friction,r.mass=r._original.mass,r.inertia=r._original.inertia,r.density=r._original.density,r.inverseMass=r._original.inverseMass,r.inverseInertia=r._original.inverseInertia,r._original=null)}},t.setMass=function(H,n){var C=H.inertia/(H.mass/6);H.inertia=n/6*C,H.inverseInertia=1/H.inertia,H.mass=n,H.inverseMass=1/H.mass,H.density=H.mass/H.area},t.setDensity=function(H,n){t.setMass(H,n*H.area),H.density=n},t.setInertia=function(H,n){H.inertia=n,H.inverseInertia=1/H.inertia},t.setVertices=function(H,n){n[0].body===H?H.vertices=n:H.vertices=y.create(n,H),H.axes=M.fromVertices(H.vertices),H.area=y.area(H.vertices),t.setMass(H,H.density*H.area);var C=y.centre(H.vertices);y.translate(H.vertices,C,-1),t.setInertia(H,t._inertiaScale*y.inertia(H.vertices,H.mass)),y.translate(H.vertices,H.position),g.update(H.bounds,H.vertices,H.velocity)},t.setParts=function(H,n,C){var r;for(n=n.slice(0),H.parts.length=0,H.parts.push(H),H.parent=H,r=0;r<n.length;r++){var N=n[r];N!==H&&(N.parent=H).parts.push(N)}if(1!==H.parts.length){if(C=void 0===C||C){var Q=[];for(r=0;r<n.length;r++)Q=Q.concat(n[r].vertices);y.clockwiseSort(Q);var I=y.hull(Q),A=y.centre(I);t.setVertices(H,I),y.translate(H.vertices,A)}var P=t._totalProperties(H);H.area=P.area,(H.parent=H).position.x=P.centre.x,H.position.y=P.centre.y,H.positionPrev.x=P.centre.x,H.positionPrev.y=P.centre.y,t.setMass(H,P.mass),t.setInertia(H,P.inertia),t.setPosition(H,P.centre)}},t.setCentre=function(H,n,C){C?(H.positionPrev.x+=n.x,H.positionPrev.y+=n.y,H.position.x+=n.x,H.position.y+=n.y):(H.positionPrev.x=n.x-(H.position.x-H.positionPrev.x),H.positionPrev.y=n.y-(H.position.y-H.positionPrev.y),H.position.x=n.x,H.position.y=n.y)},t.setPosition=function(H,n){var C=o.sub(n,H.position);H.positionPrev.x+=C.x,H.positionPrev.y+=C.y;for(var r=0;r<H.parts.length;r++){var N=H.parts[r];N.position.x+=C.x,N.position.y+=C.y,y.translate(N.vertices,C),g.update(N.bounds,N.vertices,H.velocity)}},t.setAngle=function(H,n){var C=n-H.angle;H.anglePrev+=C;for(var r=0;r<H.parts.length;r++){var N=H.parts[r];N.angle+=C,y.rotate(N.vertices,C,H.position),M.rotate(N.axes,C),g.update(N.bounds,N.vertices,H.velocity),0<r&&o.rotateAbout(N.position,C,H.position,N.position)}},t.setVelocity=function(H,n){H.positionPrev.x=H.position.x-n.x,H.positionPrev.y=H.position.y-n.y,H.velocity.x=n.x,H.velocity.y=n.y,H.speed=o.magnitude(H.velocity)},t.setAngularVelocity=function(H,n){H.anglePrev=H.angle-n,H.angularVelocity=n,H.angularSpeed=Math.abs(H.angularVelocity)},t.translate=function(H,n){t.setPosition(H,o.add(H.position,n))},t.rotate=function(H,n,C){if(C){var r=Math.cos(n),N=Math.sin(n),Q=H.position.x-C.x,I=H.position.y-C.y;t.setPosition(H,{x:C.x+(Q*r-I*N),y:C.y+(Q*N+I*r)}),t.setAngle(H,H.angle+n)}else t.setAngle(H,H.angle+n)},t.scale=function(H,n,C,r){var N=0,Q=0;r=r||H.position;for(var I=0;I<H.parts.length;I++){var A=H.parts[I];y.scale(A.vertices,n,C,r),A.axes=M.fromVertices(A.vertices),A.area=y.area(A.vertices),t.setMass(A,H.density*A.area),y.translate(A.vertices,{x:-A.position.x,y:-A.position.y}),t.setInertia(A,t._inertiaScale*y.inertia(A.vertices,A.mass)),y.translate(A.vertices,{x:A.position.x,y:A.position.y}),0<I&&(N+=A.area,Q+=A.inertia),A.position.x=r.x+(A.position.x-r.x)*n,A.position.y=r.y+(A.position.y-r.y)*C,g.update(A.bounds,A.vertices,H.velocity)}1<H.parts.length&&(H.area=N,H.isStatic||(t.setMass(H,H.density*N),t.setInertia(H,Q))),H.circleRadius&&(n===C?H.circleRadius*=n:H.circleRadius=null)},t.update=function(H,n,C,r){var N=Math.pow(n*C*H.timeScale,2),Q=1-H.frictionAir*C*H.timeScale,I=H.position.x-H.positionPrev.x,A=H.position.y-H.positionPrev.y,P=H.positionRc;P.ppx=H.position.x,P.ppy=H.position.y,H.velocity.x=I*Q*r+H.force.x/H.mass*N,H.velocity.y=A*Q*r+H.force.y/H.mass*N,H.positionPrev.x=H.position.x,H.positionPrev.y=H.position.y,H.position.x+=H.velocity.x,H.position.y+=H.velocity.y,P.cpx=H.position.x,P.cpy=H.position.y,H.angularVelocity=(H.angle-H.anglePrev)*Q*r+H.torque/H.inertia*N,H.anglePrev=H.angle,H.angle+=H.angularVelocity,H.speed=o.magnitude(H.velocity),H.angularSpeed=Math.abs(H.angularVelocity);for(var t=0;t<H.parts.length;t++){var R=H.parts[t];y.translate(R.vertices,H.velocity),0<t&&(R.position.x+=H.velocity.x,R.position.y+=H.velocity.y),0!==H.angularVelocity&&(y.rotate(R.vertices,H.angularVelocity,H.position),M.rotate(R.axes,H.angularVelocity),0<t&&o.rotateAbout(R.position,H.angularVelocity,H.position,R.position)),g.update(R.bounds,R.vertices,H.velocity)}},t.applyForce=function(H,n,C){H.force.x+=C.x,H.force.y+=C.y;var r=n.x-H.position.x,N=n.y-H.position.y;H.torque+=r*C.y-N*C.x},t._totalProperties=function(H){for(var n={mass:0,area:0,inertia:0,centre:{x:0,y:0}},C=1===H.parts.length?0:1;C<H.parts.length;C++){var r=H.parts[C],N=r.mass!==1/0?r.mass:1;n.mass+=N,n.area+=r.area,n.inertia+=r.inertia,n.centre=o.add(n.centre,o.mult(r.position,N))}return n.centre=o.div(n.centre,n.mass),n}}()},function(H,n,C){var R={};H.exports=R;var r=C(4);R._motionWakeThreshold=.18,R._motionSleepThreshold=.08,R._minBias=.9,R.update=function(H,n){for(var C=n*n*n,r=0;r<H.length;r++){var N=H[r],Q=N.speed*N.speed+N.angularSpeed*N.angularSpeed;if(0===N.force.x&&0===N.force.y){var I=Math.min(N.motion,Q),A=Math.max(N.motion,Q);N.motion=R._minBias*I+(1-R._minBias)*A,0<N.sleepThreshold&&N.motion<R._motionSleepThreshold*C?(N.sleepCounter+=1,N.sleepCounter>=N.sleepThreshold&&R.set(N,!0)):0<N.sleepCounter&&(N.sleepCounter-=1)}else R.set(N,!1)}},R.afterCollisions=function(H,n){for(var C=n*n*n,r=0;r<H.length;r++){var N=H[r];if(N.isActive){var Q=N.collision,I=Q.bodyA.parent,A=Q.bodyB.parent;if(!(I.isSleeping&&A.isSleeping||I.isStatic||A.isStatic)&&(I.isSleeping||A.isSleeping)){var P=I.isSleeping&&!I.isStatic?I:A,t=P===I?A:I;!P.isStatic&&t.motion>R._motionWakeThreshold*C&&R.set(P,!1)}}}},R.set=function(H,n){var C=H.isSleeping;n?(H.isSleeping=!0,H.sleepCounter=H.sleepThreshold,H.positionImpulse.x=0,H.positionImpulse.y=0,H.positionPrev.x=H.position.x,H.positionPrev.y=H.position.y,H.anglePrev=H.angle,H.speed=0,H.angularSpeed=0,H.motion=0,C||r.trigger(H,"sleepStart")):(H.isSleeping=!1,H.sleepCounter=0,C&&r.trigger(H,"sleepEnd"))}},function(H,n,C){var M={};H.exports=M;var l,j,f,c=C(3),K=C(9);l=[],j={overlap:0,axis:null},f={overlap:0,axis:null},M.create=function(H,n){return{pair:null,collided:!1,bodyA:H,bodyB:n,parentA:H.parent,parentB:n.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},M.collides=function(H,n,C){if(M._overlapAxes(j,H.vertices,n.vertices,H.axes),j.overlap<=0)return null;if(M._overlapAxes(f,n.vertices,H.vertices,n.axes),f.overlap<=0)return null;var r,N,Q=C&&C.table[K.id(H,n)];Q?r=Q.collision:((r=M.create(H,n)).collided=!0,r.bodyA=H.id<n.id?H:n,r.bodyB=H.id<n.id?n:H,r.parentA=r.bodyA.parent,r.parentB=r.bodyB.parent),H=r.bodyA,n=r.bodyB,N=j.overlap<f.overlap?j:f;var I=r.normal,A=r.supports,P=N.axis,t=P.x,R=P.y;t*(n.position.x-H.position.x)+R*(n.position.y-H.position.y)<0?(I.x=t,I.y=R):(I.x=-t,I.y=-R),r.tangent.x=-I.y,r.tangent.y=I.x,r.depth=N.overlap,r.penetration.x=I.x*r.depth,r.penetration.y=I.y*r.depth;var y=M._findSupports(H,n,I,1),o=0;if(c.contains(H.vertices,y[0])&&(A[o++]=y[0]),c.contains(H.vertices,y[1])&&(A[o++]=y[1]),o<2){var g=M._findSupports(n,H,I,-1);c.contains(n.vertices,g[0])&&(A[o++]=g[0]),o<2&&c.contains(n.vertices,g[1])&&(A[o++]=g[1])}return 0===o&&(A[o++]=y[0]),A.length=o,r},M._overlapAxes=function(H,n,C,r){var N,Q,I,A,P,t,R=n.length,y=C.length,o=n[0].x,g=n[0].y,M=C[0].x,j=C[0].y,l=r.length,f=Number.MAX_VALUE,c=0;for(P=0;P<l;P++){var K=r[P],W=K.x,z=K.y,w=o*W+g*z,F=M*W+j*z,k=w,i=F;for(t=1;t<R;t+=1)k<(A=n[t].x*W+n[t].y*z)?k=A:A<w&&(w=A);for(t=1;t<y;t+=1)i<(A=C[t].x*W+C[t].y*z)?i=A:A<F&&(F=A);if((N=(Q=k-F)<(I=i-w)?Q:I)<f&&(c=P,(f=N)<=0))break}H.axis=r[c],H.overlap=f},M._projectToAxis=function(H,n,C){for(var r=n[0].x*C.x+n[0].y*C.y,N=r,Q=1;Q<n.length;Q+=1){var I=n[Q].x*C.x+n[Q].y*C.y;N<I?N=I:I<r&&(r=I)}H.min=r,H.max=N},M._findSupports=function(H,n,C,r){var N,Q,I,A,P,t=n.vertices,R=t.length,y=H.position.x,o=H.position.y,g=C.x*r,M=C.y*r,j=Number.MAX_VALUE;for(P=0;P<R;P+=1)(A=g*(y-(Q=t[P]).x)+M*(o-Q.y))<j&&(j=A,N=Q);return j=g*(y-(I=t[(R+N.index-1)%R]).x)+M*(o-I.y),g*(y-(Q=t[(N.index+1)%R]).x)+M*(o-Q.y)<j?(l[0]=N,l[1]=Q):(l[0]=N,l[1]=I),l}},function(H,n,C){var Q={};H.exports=Q;var g=C(17);Q.create=function(H,n){var C=H.bodyA,r=H.bodyB,N={id:Q.id(C,r),bodyA:C,bodyB:r,collision:H,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:C.isSensor||r.isSensor,timeCreated:n,timeUpdated:n,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return Q.update(N,H,n),N},Q.update=function(H,n,C){var r=H.contacts,N=n.supports,Q=H.activeContacts,I=n.parentA,A=n.parentB,P=I.vertices.length;H.isActive=!0,H.timeUpdated=C,H.collision=n,H.separation=n.depth,H.inverseMass=I.inverseMass+A.inverseMass,H.friction=I.friction<A.friction?I.friction:A.friction,H.frictionStatic=I.frictionStatic>A.frictionStatic?I.frictionStatic:A.frictionStatic,H.restitution=I.restitution>A.restitution?I.restitution:A.restitution,H.slop=I.slop>A.slop?I.slop:A.slop,n.pair=H;for(var t=Q.length=0;t<N.length;t++){var R=N[t],y=R.body===I?R.index:P+R.index,o=r[y];o?Q.push(o):Q.push(r[y]=g.create(R))}},Q.setActive=function(H,n,C){n?(H.isActive=!0,H.timeUpdated=C):(H.isActive=!1,H.activeContacts.length=0)},Q.id=function(H,n){return H.id<n.id?"A"+H.id+"B"+n.id:"A"+n.id+"B"+H.id}},function(H,n,C){var z={};H.exports=z;var I=C(3),w=C(2),A=C(7),P=C(1),t=C(11),R=C(0);z._warming=.4,z._torqueDampen=1,z._minLength=1e-6,z.create=function(H){var n=H;n.bodyA&&!n.pointA&&(n.pointA={x:0,y:0}),n.bodyB&&!n.pointB&&(n.pointB={x:0,y:0});var C=n.bodyA?w.add(n.bodyA.position,n.pointA):n.pointA,r=n.bodyB?w.add(n.bodyB.position,n.pointB):n.pointB,N=w.magnitude(w.sub(C,r));n.length=void 0!==n.length?n.length:N,n.id=n.id||R.nextId(),n.label=n.label||"Constraint",n.type="constraint",n.stiffness=n.stiffness||(0<n.length?1:.7),n.damping=n.damping||0,n.angularStiffness=n.angularStiffness||0,n.angleA=n.bodyA?n.bodyA.angle:n.angleA,n.angleB=n.bodyB?n.bodyB.angle:n.angleB,n.plugin={};var Q={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===n.length&&.1<n.stiffness?(Q.type="pin",Q.anchors=!1):n.stiffness<.9&&(Q.type="spring"),n.render=R.extend(Q,n.render),n},z.preSolveAll=function(H){for(var n=0;n<H.length;n+=1){var C=H[n],r=C.constraintImpulse;C.isStatic||0===r.x&&0===r.y&&0===r.angle||(C.position.x+=r.x,C.position.y+=r.y,C.angle+=r.angle)}},z.solveAll=function(H,n){for(var C=0;C<H.length;C+=1){var r=H[C],N=!r.bodyA||r.bodyA&&r.bodyA.isStatic,Q=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(N||Q)&&z.solve(H[C],n)}for(C=0;C<H.length;C+=1)N=!(r=H[C]).bodyA||r.bodyA&&r.bodyA.isStatic,Q=!r.bodyB||r.bodyB&&r.bodyB.isStatic,N||Q||z.solve(H[C],n)},z.solve=function(H,n){var C=H.bodyA,r=H.bodyB,N=H.pointA,Q=H.pointB;if(C||r){C&&!C.isStatic&&(w.rotate(N,C.angle-H.angleA,N),H.angleA=C.angle),r&&!r.isStatic&&(w.rotate(Q,r.angle-H.angleB,Q),H.angleB=r.angle);var I=N,A=Q;if(C&&(I=w.add(C.position,N)),r&&(A=w.add(r.position,Q)),I&&A){var P=w.sub(I,A),t=w.magnitude(P);t<z._minLength&&(t=z._minLength);var R,y,o,g,M,j=(t-H.length)/t,l=H.stiffness<1?H.stiffness*n:H.stiffness,f=w.mult(P,j*l),c=(C?C.inverseMass:0)+(r?r.inverseMass:0),K=c+((C?C.inverseInertia:0)+(r?r.inverseInertia:0));if(H.damping){var W=w.create();o=w.div(P,t),M=w.sub(r&&w.sub(r.position,r.positionPrev)||W,C&&w.sub(C.position,C.positionPrev)||W),g=w.dot(o,M)}C&&!C.isStatic&&(y=C.inverseMass/c,C.constraintImpulse.x-=f.x*y,C.constraintImpulse.y-=f.y*y,C.position.x-=f.x*y,C.position.y-=f.y*y,H.damping&&(C.positionPrev.x-=H.damping*o.x*g*y,C.positionPrev.y-=H.damping*o.y*g*y),R=w.cross(N,f)/K*z._torqueDampen*C.inverseInertia*(1-H.angularStiffness),C.constraintImpulse.angle-=R,C.angle-=R),r&&!r.isStatic&&(y=r.inverseMass/c,r.constraintImpulse.x+=f.x*y,r.constraintImpulse.y+=f.y*y,r.position.x+=f.x*y,r.position.y+=f.y*y,H.damping&&(r.positionPrev.x+=H.damping*o.x*g*y,r.positionPrev.y+=H.damping*o.y*g*y),R=w.cross(Q,f)/K*z._torqueDampen*r.inverseInertia*(1-H.angularStiffness),r.constraintImpulse.angle+=R,r.angle+=R)}}},z.postSolveAll=function(H){for(var n=0;n<H.length;n++){var C=H[n],r=C.constraintImpulse;if(!(C.isStatic||0===r.x&&0===r.y&&0===r.angle)){A.set(C,!1);for(var N=0;N<C.parts.length;N++){var Q=C.parts[N];I.translate(Q.vertices,r),0<N&&(Q.position.x+=r.x,Q.position.y+=r.y),0!==r.angle&&(I.rotate(Q.vertices,r.angle,C.position),t.rotate(Q.axes,r.angle),0<N&&w.rotateAbout(Q.position,r.angle,C.position,Q.position)),P.update(Q.bounds,Q.vertices,C.velocity)}r.angle*=z._warming,r.x*=z._warming,r.y*=z._warming}}},z.pointAWorld=function(H){return{x:(H.bodyA?H.bodyA.position.x:0)+H.pointA.x,y:(H.bodyA?H.bodyA.position.y:0)+H.pointA.y}},z.pointBWorld=function(H){return{x:(H.bodyB?H.bodyB.position.x:0)+H.pointB.x,y:(H.bodyB?H.bodyB.position.y:0)+H.pointB.y}}},function(H,n,C){var r={};H.exports=r;var I=C(2),A=C(0);r.fromVertices=function(H){for(var n={},C=0;C<H.length;C++){var r=(C+1)%H.length,N=I.normalise({x:H[r].y-H[C].y,y:H[C].x-H[r].x}),Q=0===N.y?1/0:N.x/N.y;n[Q=Q.toFixed(3).toString()]=N}return A.values(n)},r.rotate=function(H,n){if(0!==n)for(var C=Math.cos(n),r=Math.sin(n),N=0;N<H.length;N++){var Q,I=H[N];Q=I.x*C-I.y*r,I.y=I.x*r+I.y*C,I.x=Q}}},function(H,n,C){var M={};H.exports=M;var L=C(3),b=C(0),h=C(6),v=C(1),e=C(2);M.rectangle=function(H,n,C,r,N){N=N||{};var Q={label:"Rectangle Body",position:{x:H,y:n},vertices:L.fromPath("L 0 0 L "+C+" 0 L "+C+" "+r+" L 0 "+r)};if(N.chamfer){var I=N.chamfer;Q.vertices=L.chamfer(Q.vertices,I.radius,I.quality,I.qualityMin,I.qualityMax),delete N.chamfer}return h.create(b.extend({},Q,N))},M.trapezoid=function(H,n,C,r,N,Q){Q=Q||{};var I,A=C*(N*=.5),P=A+(1-2*N)*C,t=P+A;I=N<.5?"L 0 0 L "+A+" "+-r+" L "+P+" "+-r+" L "+t+" 0":"L 0 0 L "+P+" "+-r+" L "+t+" 0";var R={label:"Trapezoid Body",position:{x:H,y:n},vertices:L.fromPath(I)};if(Q.chamfer){var y=Q.chamfer;R.vertices=L.chamfer(R.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete Q.chamfer}return h.create(b.extend({},R,Q))},M.circle=function(H,n,C,r,N){r=r||{};var Q={label:"Circle Body",circleRadius:C};N=N||25;var I=Math.ceil(Math.max(10,Math.min(N,C)));return I%2==1&&(I+=1),M.polygon(H,n,I,C,b.extend({},Q,r))},M.polygon=function(H,n,C,r,N){if(N=N||{},C<3)return M.circle(H,n,r,N);for(var Q=2*Math.PI/C,I="",A=.5*Q,P=0;P<C;P+=1){var t=A+P*Q,R=Math.cos(t)*r,y=Math.sin(t)*r;I+="L "+R.toFixed(3)+" "+y.toFixed(3)+" "}var o={label:"Polygon Body",position:{x:H,y:n},vertices:L.fromPath(I)};if(N.chamfer){var g=N.chamfer;o.vertices=L.chamfer(o.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete N.chamfer}return h.create(b.extend({},o,N))},M.fromVertices=function(H,n,C,r,N,Q,I,A){var P,t,R,y,o,g,M,j,l,f,c=b.getDecomp();for(P=Boolean(c&&c.quickDecomp),r=r||{},R=[],N=void 0!==N&&N,Q=void 0!==Q?Q:.01,I=void 0!==I?I:10,A=void 0!==A?A:.01,b.isArray(C[0])||(C=[C]),l=0;l<C.length;l+=1)if(o=C[l],!(y=L.isConvex(o))&&!P&&b.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),y||!P)o=y?L.clockwiseSort(o):L.hull(o),R.push({position:{x:H,y:n},vertices:o});else{var K=o.map(function(H){return[H.x,H.y]});c.makeCCW(K),!1!==Q&&c.removeCollinearPoints(K,Q),!1!==A&&c.removeDuplicatePoints&&c.removeDuplicatePoints(K,A);var W=c.quickDecomp(K);for(g=0;g<W.length;g++){var z=W[g].map(function(H){return{x:H[0],y:H[1]}});0<I&&L.area(z)<I||R.push({position:L.centre(z),vertices:z})}}for(g=0;g<R.length;g++)R[g]=h.create(b.extend(R[g],r));if(N)for(g=0;g<R.length;g++){var w=R[g];for(M=g+1;M<R.length;M++){var F=R[M];if(v.overlaps(w.bounds,F.bounds)){var k=w.vertices,i=F.vertices;for(j=0;j<w.vertices.length;j++)for(f=0;f<F.vertices.length;f++){var a=e.magnitudeSquared(e.sub(k[(j+1)%k.length],i[f])),D=e.magnitudeSquared(e.sub(k[j],i[(f+1)%i.length]));a<5&&D<5&&(k[j].isInternal=!0,i[f].isInternal=!0)}}}}return 1<R.length?(t=h.create(b.extend({parts:R.slice(0)},r)),h.setPosition(t,{x:H,y:n}),t):R[0]}},function(H,n,C){var r={};H.exports=r;var N=C(0);r.create=function(H){var C={};return H||N.log("Mouse.create: element was undefined, defaulting to document.body","warn"),C.element=H||document.body,C.absolute={x:0,y:0},C.position={x:0,y:0},C.mousedownPosition={x:0,y:0},C.mouseupPosition={x:0,y:0},C.mouseoutPosition={x:0,y:0},C.offset={x:0,y:0},C.scale={x:1,y:1},C.wheelDelta=0,C.button=-1,C.pixelRatio=parseInt(C.element.getAttribute("data-pixel-ratio"),10)||1,C.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mouseout:null,mousewheel:null},C.mousemove=function(H){var n=r._getRelativeMousePosition(H,C.element,C.pixelRatio);H.changedTouches&&(C.button=0,H.preventDefault()),C.absolute.x=n.x,C.absolute.y=n.y,C.position.x=C.absolute.x*C.scale.x+C.offset.x,C.position.y=C.absolute.y*C.scale.y+C.offset.y,C.sourceEvents.mousemove=H},C.mousedown=function(H){var n=r._getRelativeMousePosition(H,C.element,C.pixelRatio);H.changedTouches?(C.button=0,H.preventDefault()):C.button=H.button,C.absolute.x=n.x,C.absolute.y=n.y,C.position.x=C.absolute.x*C.scale.x+C.offset.x,C.position.y=C.absolute.y*C.scale.y+C.offset.y,C.mousedownPosition.x=C.position.x,C.mousedownPosition.y=C.position.y,C.sourceEvents.mousedown=H},C.mouseup=function(H){var n=r._getRelativeMousePosition(H,C.element,C.pixelRatio);H.changedTouches&&H.preventDefault(),C.button=-1,C.absolute.x=n.x,C.absolute.y=n.y,C.position.x=C.absolute.x*C.scale.x+C.offset.x,C.position.y=C.absolute.y*C.scale.y+C.offset.y,C.mouseupPosition.x=C.position.x,C.mouseupPosition.y=C.position.y,C.sourceEvents.mouseup=H},C.mouseout=function(H){var n=r._getRelativeMousePosition(H,C.element,C.pixelRatio);H.changedTouches&&H.preventDefault(),C.button=-1,C.absolute.x=n.x,C.absolute.y=n.y,C.position.x=C.absolute.x*C.scale.x+C.offset.x,C.position.y=C.absolute.y*C.scale.y+C.offset.y,C.mouseoutPosition.x=C.position.x,C.mouseoutPosition.y=C.position.y,C.sourceEvents.mouseout=H},C.mousewheel=function(H){C.wheelDelta=Math.max(-1,Math.min(1,H.wheelDelta||-H.detail)),H.preventDefault()},r.setElement(C,C.element),C},r.setElement=function(H,n){(H.element=n).addEventListener("mousemove",H.mousemove),n.addEventListener("mousedown",H.mousedown),n.addEventListener("mouseup",H.mouseup),n.addEventListener("mouseout",H.mouseout),n.addEventListener("mousewheel",H.mousewheel),n.addEventListener("DOMMouseScroll",H.mousewheel),n.addEventListener("touchmove",H.mousemove),n.addEventListener("touchstart",H.mousedown),n.addEventListener("touchend",H.mouseup),n.addEventListener("touchcancel",H.mouseup)},r.clearSourceEvents=function(H){H.sourceEvents.mousemove=null,H.sourceEvents.mousedown=null,H.sourceEvents.mouseup=null,H.sourceEvents.mouseout=null,H.sourceEvents.mousewheel=null,H.wheelDelta=0},r.setOffset=function(H,n){H.offset.x=n.x,H.offset.y=n.y,H.position.x=H.absolute.x*H.scale.x+H.offset.x,H.position.y=H.absolute.y*H.scale.y+H.offset.y},r.setScale=function(H,n){H.scale.x=n.x,H.scale.y=n.y,H.position.x=H.absolute.x*H.scale.x+H.offset.x,H.position.y=H.absolute.y*H.scale.y+H.offset.y},r._getRelativeMousePosition=function(H,n,C){var r,N,Q=n.getBoundingClientRect(),I=document.documentElement||document.body.parentNode||document.body,A=void 0!==window.pageXOffset?window.pageXOffset:I.scrollLeft,P=void 0!==window.pageYOffset?window.pageYOffset:I.scrollTop,t=H.changedTouches;A=A||0,P=P||0,N=t?(r=t[0].pageX-Q.left-A,t[0].pageY-Q.top-P):(r=H.pageX-Q.left-A,H.pageY-Q.top-P);var R=n.clientWidth||n.width,y=n.clientHeight||n.height;return{x:r/(R/(n.width||R)*C),y:N/(y/(n.height||y)*C)}}},function(H,n,C){var a={};H.exports=a;var r=C(0),D=C(8),R=C(2);a.create=function(H){return r.extend({bodies:[],pairs:null},H)},a.setBodies=function(H,n){H.bodies=n.slice(0)},a.clear=function(H){H.bodies=[]},a.collisions=function(H){var n,C,r=[],N=H.pairs,Q=H.bodies,I=Q.length,A=a.canCollide,P=D.collides;for(Q.sort(a._compareBoundsX),n=0;n<I;n++){var t=Q[n],R=t.bounds,y=t.bounds.max.x,o=t.bounds.max.y,g=t.bounds.min.y,M=t.isStatic||t.isSleeping,j=t.parts.length,l=1===j;for(C=n+1;C<I;C++){var f=Q[C];if((i=f.bounds).min.x>y)break;if(!(o<i.min.y||g>i.max.y)&&(!M||!f.isStatic&&!f.isSleeping)&&A(t.collisionFilter,f.collisionFilter)){var c=f.parts.length;if(l&&1===c)(F=P(t,f,N))&&r.push(F);else for(var K=1<c?1:0,W=1<j?1:0;W<j;W++)for(var z=t.parts[W],w=(R=z.bounds,K);w<c;w++){var F,k=f.parts[w],i=k.bounds;R.min.x>i.max.x||R.max.x<i.min.x||R.max.y<i.min.y||R.min.y>i.max.y||(F=P(z,k,N))&&r.push(F)}}}}return r},a.canCollide=function(H,n){return H.group===n.group&&0!==H.group?0<H.group:0!=(H.mask&n.category)&&0!=(n.mask&H.category)},a._compareBoundsX=function(H,n){return H.bounds.min.x-n.bounds.min.x},a.worldBoundsLimit=function(H,n){if(H.worldBounds&&(H.bounds.max.x<H.worldBounds.min.x||H.bounds.min.x>H.worldBounds.max.x||H.bounds.max.y<H.worldBounds.min.y||H.bounds.min.y>H.worldBounds.max.y)){var C=R.dot(H.velocity,n.collision.normal),r=R.sub(H.velocity,R.mult(n.collision.normal,C)),N=C*(H.restitution-1),Q=R.add(R.mult(n.collision.normal,N),r),I=H.position.x-H.bounds.min.x,A=H.bounds.max.x-H.position.x,P=H.position.y-H.bounds.min.y,t=H.bounds.max.y-H.position.y;Q.x=Q.x<H.worldBounds.min.x+I?H.worldBounds.min.x+I+100:Q.x>H.worldBounds.max.x-A?H.worldBounds.max.x-A-100:Q.x,Q.y=Q.y<H.worldBounds.min.y+P?H.worldBounds.min.y+P+100:Q.y>H.worldBounds.max.y-t?H.worldBounds.max.y-t-100:Q.y,Body.translate(H,{x:Q.x,y:Q.y})}}},function(H,n,C){var A={};H.exports=A;var P=C(0);A._registry={},A.register=function(H){if(A.isPlugin(H)||P.warn("Plugin.register:",A.toString(H),"does not implement all required fields."),H.name in A._registry){var n=A._registry[H.name],C=A.versionParse(H.version).number,r=A.versionParse(n.version).number;r<C?(P.warn("Plugin.register:",A.toString(n),"was upgraded to",A.toString(H)),A._registry[H.name]=H):C<r?P.warn("Plugin.register:",A.toString(n),"can not be downgraded to",A.toString(H)):H!==n&&P.warn("Plugin.register:",A.toString(H),"is already registered to different plugin object")}else A._registry[H.name]=H;return H},A.resolve=function(H){return A._registry[A.dependencyParse(H).name]},A.toString=function(H){return"string"==typeof H?H:(H.name||"anonymous")+"@"+(H.version||H.range||"0.0.0")},A.isPlugin=function(H){return H&&H.name&&H.version&&H.install},A.isUsed=function(H,n){return-1<H.used.indexOf(n)},A.isFor=function(H,n){var C=H.for&&A.dependencyParse(H.for);return!H.for||n.name===C.name&&A.versionSatisfies(n.version,C.range)},A.use=function(H,n){if(H.uses=(H.uses||[]).concat(n||[]),0!==H.uses.length){for(var C=A.dependencies(H),r=P.topologicalSort(C),N=[],Q=0;Q<r.length;Q+=1)if(r[Q]!==H.name){var I=A.resolve(r[Q]);I?A.isUsed(H,I.name)||(A.isFor(I,H)||(P.warn("Plugin.use:",A.toString(I),"is for",I.for,"but installed on",A.toString(H)+"."),I._warned=!0),I.install?I.install(H):(P.warn("Plugin.use:",A.toString(I),"does not specify an install function."),I._warned=!0),I._warned?(N.push("🔶 "+A.toString(I)),delete I._warned):N.push("✅ "+A.toString(I)),H.used.push(I.name)):N.push("❌ "+r[Q])}0<N.length&&P.info(N.join("  "))}else P.warn("Plugin.use:",A.toString(H),"does not specify any dependencies to install.")},A.dependencies=function(r,H){var N=A.dependencyParse(r),n=N.name;if(!(n in(H=H||{}))){r=A.resolve(r)||r,H[n]=P.map(r.uses||[],function(H){A.isPlugin(H)&&A.register(H);var n=A.dependencyParse(H),C=A.resolve(H);return C&&!A.versionSatisfies(C.version,n.range)?(P.warn("Plugin.dependencies:",A.toString(C),"does not satisfy",A.toString(n),"used by",A.toString(N)+"."),C._warned=!0,r._warned=!0):C||(P.warn("Plugin.dependencies:",A.toString(H),"used by",A.toString(N),"could not be resolved."),r._warned=!0),n.name});for(var C=0;C<H[n].length;C+=1)A.dependencies(H[n][C],H);return H}},A.dependencyParse=function(H){return P.isString(H)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(H)||P.warn("Plugin.dependencyParse:",H,"is not a valid dependency string."),{name:H.split("@")[0],range:H.split("@")[1]||"*"}):{name:H.name,range:H.range||H.version}},A.versionParse=function(H){var n=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;n.test(H)||P.warn("Plugin.versionParse:",H,"is not a valid version or range.");var C=n.exec(H),r=Number(C[4]),N=Number(C[5]),Q=Number(C[6]);return{isRange:Boolean(C[1]||C[2]),version:C[3],range:H,operator:C[1]||C[2]||"",major:r,minor:N,patch:Q,parts:[r,N,Q],prerelease:C[7],number:1e8*r+1e4*N+Q}},A.versionSatisfies=function(H,n){n=n||"*";var C=A.versionParse(n),r=A.versionParse(H);if(C.isRange){if("*"===C.operator||"*"===H)return!0;if(">"===C.operator)return r.number>C.number;if(">="===C.operator)return r.number>=C.number;if("~"===C.operator)return r.major===C.major&&r.minor===C.minor&&r.patch>=C.patch;if("^"===C.operator)return 0<C.major?r.major===C.major&&r.number>=C.number:0<C.minor?r.minor===C.minor&&r.patch>=C.patch:r.patch===C.patch}return H===n||"*"===H}},function(H,n,C){var F={};H.exports=F;var k=C(0),i=C(5),a=C(1),D=C(4),L=C(2),b=C(13);!function(){F._goodFps=30,F._goodDelta=1e3/60,F.create=function(H){var n={controller:F,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!H.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},C=k.extend(n,H);return C.canvas&&(C.canvas.width=C.options.width||C.canvas.width,C.canvas.height=C.options.height||C.canvas.height),C.mouse=H.mouse,C.engine=H.engine,C.canvas=C.canvas||r(C.options.width,C.options.height),C.context=C.canvas.getContext("2d"),C.textures={},C.bounds=C.bounds||{min:{x:0,y:0},max:{x:C.canvas.width,y:C.canvas.height}},C.options.showBroadphase=!1,1!==C.options.pixelRatio&&F.setPixelRatio(C,C.options.pixelRatio),k.isElement(C.element)?C.element.appendChild(C.canvas):C.canvas.parentNode||k.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),C},F.run=function(H){Laya.timer.clear(this,F.loop),Laya.timer.frameLoop(1,this,F.loop,[H])},F.loop=function(H){var n=k.now();C(H,n),F.world(H,n),(H.options.showStats||H.options.showDebug)&&F.stats(H,H.context,n),(H.options.showPerformance||H.options.showDebug)&&F.performance(H,H.context,n)},F.stop=function(H){Laya.timer.clear(this,F.loop)},F.setPixelRatio=function(H,n){var C=H.options,r=H.canvas;"auto"===n&&(n=N(r)),C.pixelRatio=n,r.setAttribute("data-pixel-ratio",n),r.width=C.width*n,r.height=C.height*n,r.style.width=C.width+"px",r.style.height=C.height+"px"},F.lookAt=function(H,n,C,r){r=void 0===r||r,n=k.isArray(n)?n:[n],C=C||{x:0,y:0};for(var N={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},Q=0;Q<n.length;Q+=1){var I=n[Q],A=I.bounds?I.bounds.min:I.min||I.position||I,P=I.bounds?I.bounds.max:I.max||I.position||I;A&&P&&(A.x<N.min.x&&(N.min.x=A.x),P.x>N.max.x&&(N.max.x=P.x),A.y<N.min.y&&(N.min.y=A.y),P.y>N.max.y&&(N.max.y=P.y))}var t=N.max.x-N.min.x+2*C.x,R=N.max.y-N.min.y+2*C.y,y=H.canvas.height,o=H.canvas.width/y,g=t/R,M=1,j=1;o<g?j=g/o:M=o/g,H.options.hasBounds=!0,H.bounds.min.x=N.min.x,H.bounds.max.x=N.min.x+t*M,H.bounds.min.y=N.min.y,H.bounds.max.y=N.min.y+R*j,r&&(H.bounds.min.x+=.5*t-t*M*.5,H.bounds.max.x+=.5*t-t*M*.5,H.bounds.min.y+=.5*R-R*j*.5,H.bounds.max.y+=.5*R-R*j*.5),H.bounds.min.x-=C.x,H.bounds.max.x-=C.x,H.bounds.min.y-=C.y,H.bounds.max.y-=C.y,H.mouse&&(b.setScale(H.mouse,{x:(H.bounds.max.x-H.bounds.min.x)/H.canvas.width,y:(H.bounds.max.y-H.bounds.min.y)/H.canvas.height}),b.setOffset(H.mouse,H.bounds.min))},F.startViewTransform=function(H){var n=H.bounds.max.x-H.bounds.min.x,C=H.bounds.max.y-H.bounds.min.y,r=n/H.options.width,N=C/H.options.height;H.context.setTransform(H.options.pixelRatio/r,0,0,H.options.pixelRatio/N,0,0),H.context.translate(-H.bounds.min.x,-H.bounds.min.y)},F.endViewTransform=function(H){H.context.setTransform(H.options.pixelRatio,0,0,H.options.pixelRatio,0,0)},F.world=function(H,n){var C,r=k.now(),N=H.engine,Q=N.world,I=H.canvas,A=H.context,P=H.options,t=H.timing,R=i.allBodies(Q),y=i.allConstraints(Q),o=P.wireframes?P.wireframeBackground:P.background,g=[],M=[],j={timestamp:N.timing.timestamp};if(D.trigger(H,"beforeRender",j),H.currentBackground!==o&&w(H,o),A.globalCompositeOperation="source-in",A.fillStyle="transparent",A.fillRect(0,0,I.width,I.height),A.globalCompositeOperation="source-over",P.hasBounds){for(C=0;C<R.length;C++){var l=R[C];a.overlaps(l.bounds,H.bounds)&&g.push(l)}for(C=0;C<y.length;C++){var f=y[C],c=f.bodyA,K=f.bodyB,W=f.pointA,z=f.pointB;c&&(W=L.add(c.position,f.pointA)),K&&(z=L.add(K.position,f.pointB)),W&&z&&((a.contains(H.bounds,W)||a.contains(H.bounds,z))&&M.push(f))}F.startViewTransform(H),H.mouse&&(b.setScale(H.mouse,{x:(H.bounds.max.x-H.bounds.min.x)/H.options.width,y:(H.bounds.max.y-H.bounds.min.y)/H.options.height}),b.setOffset(H.mouse,H.bounds.min))}else M=y,g=R,1!==H.options.pixelRatio&&H.context.setTransform(H.options.pixelRatio,0,0,H.options.pixelRatio,0,0);!P.wireframes||N.enableSleeping&&P.showSleeping?F.bodies(H,g,A):(P.showConvexHulls&&F.bodyConvexHulls(H,g,A),F.bodyWireframes(H,g,A)),P.showBounds&&F.bodyBounds(H,g,A),(P.showAxes||P.showAngleIndicator)&&F.bodyAxes(H,g,A),P.showPositions&&F.bodyPositions(H,g,A),P.showVelocity&&F.bodyVelocity(H,g,A),P.showIds&&F.bodyIds(H,g,A),P.showSeparations&&F.separations(H,N.pairs.list,A),P.showCollisions&&F.collisions(H,N.pairs.list,A),P.showVertexNumbers&&F.vertexNumbers(H,g,A),P.showMousePosition&&F.mousePosition(H,H.mouse,A),F.constraints(M,A),P.hasBounds&&F.endViewTransform(H),D.trigger(H,"afterRender",j),t.lastElapsed=k.now()-r},F.stats=function(H,n,C){for(var r=H.engine,N=r.world,Q=i.allBodies(N),I=0,A=0,P=0;P<Q.length;P+=1)I+=Q[P].parts.length;var t={Part:I,Body:Q.length,Cons:i.allConstraints(N).length,Comp:i.allComposites(N).length,Pair:r.pairs.list.length};for(var R in n.fillStyle="#0e0f19",n.fillRect(A,0,302.5,44),n.font="12px Arial",n.textBaseline="top",n.textAlign="right",t){var y=t[R];n.fillStyle="#aaa",n.fillText(R,A+55,8),n.fillStyle="#eee",n.fillText(y,A+55,26),A+=55}},F.performance=function(H,n){var C=H.engine,r=H.timing,N=r.deltaHistory,Q=r.elapsedHistory,I=r.timestampElapsedHistory,A=r.engineDeltaHistory,P=r.engineElapsedHistory,t=C.timing.lastDelta,R=l(N),y=l(Q),o=l(A),g=l(P),M=l(I)/R||0,j=1e3/R||0;n.fillStyle="#0e0f19",n.fillRect(0,50,370,34),F.status(n,10,69,60,4,N.length,Math.round(j)+" fps",j/F._goodFps,function(H){return N[H]/R-1}),F.status(n,82,69,60,4,A.length,t.toFixed(2)+" dt",F._goodDelta/t,function(H){return A[H]/o-1}),F.status(n,154,69,60,4,P.length,g.toFixed(2)+" ut",1-g/F._goodFps,function(H){return P[H]/g-1}),F.status(n,226,69,60,4,Q.length,y.toFixed(2)+" rt",1-y/F._goodFps,function(H){return Q[H]/y-1}),F.status(n,298,69,60,4,I.length,M.toFixed(2)+" x",M*M*M,function(H){return(I[H]/N[H]/M||0)-1})},F.status=function(H,n,C,r,N,Q,I,A,P){H.strokeStyle="#888",H.fillStyle="#444",H.lineWidth=1,H.fillRect(n,C+7,r,1),H.beginPath(),H.moveTo(n,C+7-N*k.clamp(.4*P(0),-2,2));for(var t=0;t<r;t+=1)H.lineTo(n+t,C+7-(t<Q?N*k.clamp(.4*P(t),-2,2):0));H.stroke(),H.fillStyle="hsl("+k.clamp(25+95*A,0,120)+",100%,60%)",H.fillRect(n,C-7,4,4),H.font="12px Arial",H.textBaseline="middle",H.textAlign="right",H.fillStyle="#eee",H.fillText(I,n+r,C-5)},F.constraints=function(H,n){for(var C=n,r=0;r<H.length;r++){var N=H[r];if(N.render.visible&&N.pointA&&N.pointB){var Q,I,A=N.bodyA,P=N.bodyB;if(Q=A?L.add(A.position,N.pointA):N.pointA,"pin"===N.render.type)C.beginPath(),C.arc(Q.x,Q.y,3,0,2*Math.PI),C.closePath();else{if(I=P?L.add(P.position,N.pointB):N.pointB,C.beginPath(),C.moveTo(Q.x,Q.y),"spring"===N.render.type)for(var t,R=L.sub(I,Q),y=L.perp(L.normalise(R)),o=Math.ceil(k.clamp(N.length/5,12,20)),g=1;g<o;g+=1)t=g%2==0?1:-1,C.lineTo(Q.x+R.x*(g/o)+y.x*t*4,Q.y+R.y*(g/o)+y.y*t*4);C.lineTo(I.x,I.y)}N.render.lineWidth&&(C.lineWidth=N.render.lineWidth,C.strokeStyle=N.render.strokeStyle,C.stroke()),N.render.anchors&&(C.fillStyle=N.render.strokeStyle,C.beginPath(),C.arc(Q.x,Q.y,3,0,2*Math.PI),C.arc(I.x,I.y,3,0,2*Math.PI),C.closePath(),C.fill())}}},F.bodies=function(H,n,C){var r,N,Q,I,A=C,P=(H.engine,H.options),t=P.showInternalEdges||!P.wireframes;for(Q=0;Q<n.length;Q++)if((r=n[Q]).render.visible)for(I=1<r.parts.length?1:0;I<r.parts.length;I++)if((N=r.parts[I]).render.visible){if(P.showSleeping&&r.isSleeping?A.globalAlpha=.5*N.render.opacity:1!==N.render.opacity&&(A.globalAlpha=N.render.opacity),N.render.sprite&&N.render.sprite.texture&&!P.wireframes){var R=N.render.sprite,y=g(H,R.texture);A.translate(N.position.x,N.position.y),A.rotate(N.angle),A.drawImage(y,y.width*-R.xOffset*R.xScale,y.height*-R.yOffset*R.yScale,y.width*R.xScale,y.height*R.yScale),A.rotate(-N.angle),A.translate(-N.position.x,-N.position.y)}else{if(N.circleRadius)A.beginPath(),A.arc(N.position.x,N.position.y,N.circleRadius,0,2*Math.PI);else{A.beginPath(),A.moveTo(N.vertices[0].x,N.vertices[0].y);for(var o=1;o<N.vertices.length;o++)!N.vertices[o-1].isInternal||t?A.lineTo(N.vertices[o].x,N.vertices[o].y):A.moveTo(N.vertices[o].x,N.vertices[o].y),N.vertices[o].isInternal&&!t&&A.moveTo(N.vertices[(o+1)%N.vertices.length].x,N.vertices[(o+1)%N.vertices.length].y);A.lineTo(N.vertices[0].x,N.vertices[0].y),A.closePath()}P.wireframes?(A.lineWidth=1,A.strokeStyle="#bbb",A.stroke()):(A.fillStyle=N.render.fillStyle,N.render.lineWidth&&(A.lineWidth=N.render.lineWidth,A.strokeStyle=N.render.strokeStyle,A.stroke()),A.fill())}A.globalAlpha=1}},F.bodyWireframes=function(H,n,C){var r,N,Q,I,A,P=C,t=H.options.showInternalEdges;for(P.beginPath(),Q=0;Q<n.length;Q++)if((r=n[Q]).render.visible)for(A=1<r.parts.length?1:0;A<r.parts.length;A++){for(N=r.parts[A],P.moveTo(N.vertices[0].x,N.vertices[0].y),I=1;I<N.vertices.length;I++)!N.vertices[I-1].isInternal||t?P.lineTo(N.vertices[I].x,N.vertices[I].y):P.moveTo(N.vertices[I].x,N.vertices[I].y),N.vertices[I].isInternal&&!t&&P.moveTo(N.vertices[(I+1)%N.vertices.length].x,N.vertices[(I+1)%N.vertices.length].y);P.lineTo(N.vertices[0].x,N.vertices[0].y)}P.lineWidth=1,P.strokeStyle="#bbb",P.stroke()},F.bodyConvexHulls=function(H,n,C){var r,N,Q,I=C;for(I.beginPath(),N=0;N<n.length;N++)if((r=n[N]).render.visible&&1!==r.parts.length){for(I.moveTo(r.vertices[0].x,r.vertices[0].y),Q=1;Q<r.vertices.length;Q++)I.lineTo(r.vertices[Q].x,r.vertices[Q].y);I.lineTo(r.vertices[0].x,r.vertices[0].y)}I.lineWidth=1,I.strokeStyle="rgba(255,255,255,0.2)",I.stroke()},F.vertexNumbers=function(H,n,C){var r,N,Q,I=C;for(r=0;r<n.length;r++){var A=n[r].parts;for(Q=1<A.length?1:0;Q<A.length;Q++){var P=A[Q];for(N=0;N<P.vertices.length;N++)I.fillStyle="rgba(255,255,255,0.2)",I.fillText(r+"_"+N,P.position.x+.8*(P.vertices[N].x-P.position.x),P.position.y+.8*(P.vertices[N].y-P.position.y))}}},F.mousePosition=function(H,n,C){var r=C;r.fillStyle="rgba(255,255,255,0.8)",r.fillText(n.position.x+"  "+n.position.y,n.position.x+5,n.position.y-5)},F.bodyBounds=function(H,n,C){var r=C,N=(H.engine,H.options);r.beginPath();for(var Q=0;Q<n.length;Q++){if(n[Q].render.visible)for(var I=n[Q].parts,A=1<I.length?1:0;A<I.length;A++){var P=I[A];r.rect(P.bounds.min.x,P.bounds.min.y,P.bounds.max.x-P.bounds.min.x,P.bounds.max.y-P.bounds.min.y)}}N.wireframes?r.strokeStyle="rgba(255,255,255,0.08)":r.strokeStyle="rgba(0,0,0,0.1)",r.lineWidth=1,r.stroke()},F.bodyAxes=function(H,n,C){var r,N,Q,I,A=C,P=(H.engine,H.options);for(A.beginPath(),N=0;N<n.length;N++){var t=n[N],R=t.parts;if(t.render.visible)if(P.showAxes)for(Q=1<R.length?1:0;Q<R.length;Q++)for(r=R[Q],I=0;I<r.axes.length;I++){var y=r.axes[I];A.moveTo(r.position.x,r.position.y),A.lineTo(r.position.x+20*y.x,r.position.y+20*y.y)}else for(Q=1<R.length?1:0;Q<R.length;Q++)for(r=R[Q],I=0;I<r.axes.length;I++)A.moveTo(r.position.x,r.position.y),A.lineTo((r.vertices[0].x+r.vertices[r.vertices.length-1].x)/2,(r.vertices[0].y+r.vertices[r.vertices.length-1].y)/2)}P.wireframes?(A.strokeStyle="indianred",A.lineWidth=1):(A.strokeStyle="rgba(255, 255, 255, 0.4)",A.globalCompositeOperation="overlay",A.lineWidth=2),A.stroke(),A.globalCompositeOperation="source-over"},F.bodyPositions=function(H,n,C){var r,N,Q,I,A=C,P=(H.engine,H.options);for(A.beginPath(),Q=0;Q<n.length;Q++)if((r=n[Q]).render.visible)for(I=0;I<r.parts.length;I++)N=r.parts[I],A.arc(N.position.x,N.position.y,3,0,2*Math.PI,!1),A.closePath();for(P.wireframes?A.fillStyle="indianred":A.fillStyle="rgba(0,0,0,0.5)",A.fill(),A.beginPath(),Q=0;Q<n.length;Q++)(r=n[Q]).render.visible&&(A.arc(r.positionPrev.x,r.positionPrev.y,2,0,2*Math.PI,!1),A.closePath());A.fillStyle="rgba(255,165,0,0.8)",A.fill()},F.bodyVelocity=function(H,n,C){var r=C;r.beginPath();for(var N=0;N<n.length;N++){var Q=n[N];Q.render.visible&&(r.moveTo(Q.position.x,Q.position.y),r.lineTo(Q.position.x+2*(Q.position.x-Q.positionPrev.x),Q.position.y+2*(Q.position.y-Q.positionPrev.y)))}r.lineWidth=3,r.strokeStyle="cornflowerblue",r.stroke()},F.bodyIds=function(H,n,C){var r,N,Q=C;for(r=0;r<n.length;r++)if(n[r].render.visible){var I=n[r].parts;for(N=1<I.length?1:0;N<I.length;N++){var A=I[N];Q.font="12px Arial",Q.fillStyle="rgba(255,255,255,0.5)",Q.fillText(A.id,A.position.x+10,A.position.y-10)}}},F.collisions=function(H,n,C){var r,N,Q,I,A=C,P=H.options;for(A.beginPath(),Q=0;Q<n.length;Q++)if((r=n[Q]).isActive)for(N=r.collision,I=0;I<r.activeContacts.length;I++){var t=r.activeContacts[I].vertex;A.rect(t.x-1.5,t.y-1.5,3.5,3.5)}for(P.wireframes?A.fillStyle="rgba(255,255,255,0.7)":A.fillStyle="orange",A.fill(),A.beginPath(),Q=0;Q<n.length;Q++)if((r=n[Q]).isActive&&(N=r.collision,0<r.activeContacts.length)){var R=r.activeContacts[0].vertex.x,y=r.activeContacts[0].vertex.y;2===r.activeContacts.length&&(R=(r.activeContacts[0].vertex.x+r.activeContacts[1].vertex.x)/2,y=(r.activeContacts[0].vertex.y+r.activeContacts[1].vertex.y)/2),N.bodyB===N.supports[0].body||!0===N.bodyA.isStatic?A.moveTo(R-8*N.normal.x,y-8*N.normal.y):A.moveTo(R+8*N.normal.x,y+8*N.normal.y),A.lineTo(R,y)}P.wireframes?A.strokeStyle="rgba(255,165,0,0.7)":A.strokeStyle="orange",A.lineWidth=1,A.stroke()},F.separations=function(H,n,C){var r,N,Q,I,A,P=C,t=H.options;for(P.beginPath(),A=0;A<n.length;A++)if((r=n[A]).isActive){Q=(N=r.collision).bodyA;var R=1;(I=N.bodyB).isStatic||Q.isStatic||(R=.5),I.isStatic&&(R=0),P.moveTo(I.position.x,I.position.y),P.lineTo(I.position.x-N.penetration.x*R,I.position.y-N.penetration.y*R),R=1,I.isStatic||Q.isStatic||(R=.5),Q.isStatic&&(R=0),P.moveTo(Q.position.x,Q.position.y),P.lineTo(Q.position.x+N.penetration.x*R,Q.position.y+N.penetration.y*R)}t.wireframes?P.strokeStyle="rgba(255,165,0,0.5)":P.strokeStyle="orange",P.stroke()},F.inspector=function(H,n){H.engine;var C,r=H.selected,N=H.render,Q=N.options;if(Q.hasBounds){var I=N.bounds.max.x-N.bounds.min.x,A=N.bounds.max.y-N.bounds.min.y,P=I/N.options.width,t=A/N.options.height;n.scale(1/P,1/t),n.translate(-N.bounds.min.x,-N.bounds.min.y)}for(var R=0;R<r.length;R++){var y=r[R].data;switch(n.translate(.5,.5),n.lineWidth=1,n.strokeStyle="rgba(255,165,0,0.9)",n.setLineDash([1,2]),y.type){case"body":C=y.bounds,n.beginPath(),n.rect(Math.floor(C.min.x-3),Math.floor(C.min.y-3),Math.floor(C.max.x-C.min.x+6),Math.floor(C.max.y-C.min.y+6)),n.closePath(),n.stroke();break;case"constraint":var o=y.pointA;y.bodyA&&(o=y.pointB),n.beginPath(),n.arc(o.x,o.y,10,0,2*Math.PI),n.closePath(),n.stroke()}n.setLineDash([]),n.translate(-.5,-.5)}null!==H.selectStart&&(n.translate(.5,.5),n.lineWidth=1,n.strokeStyle="rgba(255,165,0,0.6)",n.fillStyle="rgba(255,165,0,0.1)",C=H.selectBounds,n.beginPath(),n.rect(Math.floor(C.min.x),Math.floor(C.min.y),Math.floor(C.max.x-C.min.x),Math.floor(C.max.y-C.min.y)),n.closePath(),n.stroke(),n.fill(),n.translate(-.5,-.5)),Q.hasBounds&&n.setTransform(1,0,0,1,0,0)};var C=function(H,n){var C=H.engine,r=H.timing,N=r.historySize,Q=C.timing.timestamp;r.delta=n-r.lastTime||F._goodDelta,r.lastTime=n,r.timestampElapsed=Q-r.lastTimestamp||0,r.lastTimestamp=Q,r.deltaHistory.unshift(r.delta),r.deltaHistory.length=Math.min(r.deltaHistory.length,N),r.engineDeltaHistory.unshift(C.timing.lastDelta),r.engineDeltaHistory.length=Math.min(r.engineDeltaHistory.length,N),r.timestampElapsedHistory.unshift(r.timestampElapsed),r.timestampElapsedHistory.length=Math.min(r.timestampElapsedHistory.length,N),r.engineElapsedHistory.unshift(C.timing.lastElapsed),r.engineElapsedHistory.length=Math.min(r.engineElapsedHistory.length,N),r.elapsedHistory.unshift(r.lastElapsed),r.elapsedHistory.length=Math.min(r.elapsedHistory.length,N)},l=function(H){for(var n=0,C=0;C<H.length;C+=1)n+=H[C];return n/H.length||0},r=function(H,n){var C=document.createElement("canvas");return C.width=H,C.height=n,C.oncontextmenu=function(){return!1},C.onselectstart=function(){return!1},C},N=function(H){var n=H.getContext("2d");return(window.devicePixelRatio||1)/(n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1)},g=function(H,n){var C=H.textures[n];return C||((C=H.textures[n]=new Image).src=n,C)},w=function(H,n){var C=n;/(jpg|gif|png)$/.test(n)&&(C="url("+n+")"),H.canvas.style.background=C,H.canvas.style.backgroundSize="contain",H.currentBackground=n}}()},function(H,n){var C={};(H.exports=C).create=function(H){return{vertex:H,normalImpulse:0,tangentImpulse:0}}},function(H,n,C){var j={};H.exports=j;var l=C(7),f=C(19),c=C(14),K=C(20),W=C(4),z=C(5),w=C(10),F=C(0),A=C(6);C(2);j.create=function(H){H=H||{};var n=F.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},H);return n.world=H.world||z.create({label:"World"}),n.pairs=H.pairs||K.create(),n.detector=H.detector||c.create(),n.grid={buckets:[]},n.world.gravity=n.gravity,n.broadphase=n.grid,n.metrics={},n},j.update=function(H,n,C){var r=F.now();n=n||1e3/60,C=C||1;var N=H.world,Q=H.detector,I=H.pairs,A=H.timing,P=A.timestamp;A.timestamp+=n*A.timeScale,A.lastDelta=n*A.timeScale;var t={timestamp:A.timestamp};W.trigger(H,"beforeUpdate",t);var R=z.allBodies(N),y=z.allConstraints(N);for(N.isModified&&c.setBodies(Q,R),N.isModified&&z.setModified(N,!1,!1,!0),H.enableSleeping&&l.update(R,A.timeScale),j._bodiesApplyGravity(R,H.gravity),j._bodiesUpdate(R,n,A.timeScale,C,N.bounds),w.preSolveAll(R),g=0;g<H.constraintIterations;g++)w.solveAll(y,A.timeScale);w.postSolveAll(R),Q.pairs=H.pairs;var o=c.collisions(Q);for(K.update(I,o,P),H.enableSleeping&&l.afterCollisions(I.list,A.timeScale),0<I.collisionStart.length&&W.trigger(H,"collisionStart",{pairs:I.collisionStart}),f.preSolvePosition(I.list),g=0;g<H.positionIterations;g++)f.solvePosition(I.list,A.timeScale);f.postSolvePosition(R);for(var g=0;g<I.list.length;g++){var M=I.list[g];M.isActive&&0<M.collision.depth&&(c.worldBoundsLimit(M.bodyA,M),c.worldBoundsLimit(M.bodyB,M))}for(w.preSolveAll(R),g=0;g<H.constraintIterations;g++)w.solveAll(y,A.timeScale);for(w.postSolveAll(R),f.preSolveVelocity(I.list),g=0;g<H.velocityIterations;g++)f.solveVelocity(I.list,A.timeScale);return 0<I.collisionActive.length&&W.trigger(H,"collisionActive",{pairs:I.collisionActive}),0<I.collisionEnd.length&&W.trigger(H,"collisionEnd",{pairs:I.collisionEnd}),j._bodiesClearForces(R),W.trigger(H,"afterUpdate",t),H.timing.lastElapsed=F.now()-r,H},j.merge=function(H,n){if(F.extend(H,n),n.world){H.world=n.world,j.clear(H);for(var C=z.allBodies(H.world),r=0;r<C.length;r++){var N=C[r];l.set(N,!1),N.id=F.nextId()}}},j.clear=function(H){K.clear(H.pairs),c.clear(H.detector)},j._bodiesClearForces=function(H){for(var n=0;n<H.length;n++){var C=H[n];C.force.x=0,C.force.y=0,C.torque=0}},j._bodiesApplyGravity=function(H,n){var C=void 0!==n.scale?n.scale:.001;if((0!==n.x||0!==n.y)&&0!==C)for(var r=0;r<H.length;r++){var N=H[r];N.isStatic||N.isSleeping||(N.force.y+=N.mass*n.y*C,N.force.x+=N.mass*n.x*C)}},j._bodiesUpdate=function(H,n,C,r,N){for(var Q=0;Q<H.length;Q++){var I=H[Q];I.isStatic||I.isSleeping||A.update(I,n,C,r)}}},function(H,n,C){var u={};H.exports=u;var g=C(3),M=C(1);u._restingThresh=4,u._restingThreshTangent=6,u._positionDampen=.9,u._positionWarming=.8,u._frictionNormalMultiplier=5,u.preSolvePosition=function(H){var n,C,r,N=H.length;for(n=0;n<N;n++)(C=H[n]).isActive&&(r=C.activeContacts.length,C.collision.parentA.totalContacts+=r,C.collision.parentB.totalContacts+=r)},u.solvePosition=function(H,n){var C,r,N,Q,I,A,P,t,R=u._positionDampen,y=H.length;for(C=0;C<y;C++)(r=H[C]).isActive&&!r.isSensor&&(Q=(N=r.collision).parentA,I=N.parentB,A=N.normal,r.separation=A.x*(I.positionImpulse.x+N.penetration.x-Q.positionImpulse.x)+A.y*(I.positionImpulse.y+N.penetration.y-Q.positionImpulse.y));for(C=0;C<y;C++)(r=H[C]).isActive&&!r.isSensor&&(Q=(N=r.collision).parentA,I=N.parentB,A=N.normal,t=(r.separation-r.slop)*n,(Q.isStatic||I.isStatic)&&(t*=2),Q.isStatic||Q.isSleeping||(P=R/Q.totalContacts,Q.positionImpulse.x+=A.x*t*P,Q.positionImpulse.y+=A.y*t*P),I.isStatic||I.isSleeping||(P=R/I.totalContacts,I.positionImpulse.x-=A.x*t*P,I.positionImpulse.y-=A.y*t*P))},u.postSolvePosition=function(H){for(var n=u._positionWarming,C=H.length,r=g.translate,N=M.update,Q=0;Q<C;Q++){var I=H[Q],A=I.positionImpulse,P=A.x,t=A.y,R=I.velocity;if((I.totalContacts=0)!==P||0!==t){for(var y=0;y<I.parts.length;y++){var o=I.parts[y];r(o.vertices,A),N(o.bounds,o.vertices,R),o.position.x+=P,o.position.y+=t}I.positionPrev.x+=P,I.positionPrev.y+=t,P*R.x+t*R.y<0?(A.x=0,A.y=0):(A.x*=n,A.y*=n)}}},u.preSolveVelocity=function(H){var n,C,r=H.length;for(n=0;n<r;n++){var N=H[n];if(N.isActive&&!N.isSensor){var Q=N.activeContacts,I=Q.length,A=N.collision,P=A.parentA,t=A.parentB,R=A.normal,y=A.tangent;for(C=0;C<I;C++){var o=Q[C],g=o.vertex,M=o.normalImpulse,j=o.tangentImpulse;if(0!==M||0!==j){var l=R.x*M+y.x*j,f=R.y*M+y.y*j;P.isStatic||P.isSleeping||(P.positionPrev.x+=l*P.inverseMass,P.positionPrev.y+=f*P.inverseMass,P.anglePrev+=P.inverseInertia*((g.x-P.position.x)*f-(g.y-P.position.y)*l)),t.isStatic||t.isSleeping||(t.positionPrev.x-=l*t.inverseMass,t.positionPrev.y-=f*t.inverseMass,t.anglePrev-=t.inverseInertia*((g.x-t.position.x)*f-(g.y-t.position.y)*l))}}}}},u.solveVelocity=function(H,n){var C,r,N,Q,I=n*n,A=u._restingThresh*I,P=u._frictionNormalMultiplier,t=u._restingThreshTangent*I,R=Number.MAX_VALUE,y=H.length;for(N=0;N<y;N++){var o=H[N];if(o.isActive&&!o.isSensor){var g=o.collision,M=g.parentA,j=g.parentB,l=M.velocity,f=j.velocity,c=g.normal.x,K=g.normal.y,W=g.tangent.x,z=g.tangent.y,w=o.activeContacts,F=w.length,k=1/F,i=M.inverseMass+j.inverseMass,a=o.friction*o.frictionStatic*P*I;for(l.x=M.position.x-M.positionPrev.x,l.y=M.position.y-M.positionPrev.y,f.x=j.position.x-j.positionPrev.x,f.y=j.position.y-j.positionPrev.y,M.angularVelocity=M.angle-M.anglePrev,j.angularVelocity=j.angle-j.anglePrev,Q=0;Q<F;Q++){var D=w[Q],L=D.vertex,b=L.x-M.position.x,h=L.y-M.position.y,v=L.x-j.position.x,e=L.y-j.position.y,Z=l.x-h*M.angularVelocity,q=l.y+b*M.angularVelocity,p=Z-(f.x-e*j.angularVelocity),m=q-(f.y+v*j.angularVelocity),d=c*p+K*m,_=W*p+z*m,U=o.separation+d,s=Math.min(U,1),$=(s=U<0?0:s)*a;$<_||$<-_?(r=0<_?_:-_,(C=o.friction*(0<_?1:-1)*I)<-r?C=-r:r<C&&(C=r)):(C=_,r=R);var x=b*K-h*c,O=v*K-e*c,S=k/(i+M.inverseInertia*x*x+j.inverseInertia*O*O),T=(1+o.restitution)*d*S;if(C*=S,A<d*d&&d<0)D.normalImpulse=0;else{var E=D.normalImpulse;D.normalImpulse+=T,D.normalImpulse=Math.min(D.normalImpulse,0),T=D.normalImpulse-E}if(t<_*_)D.tangentImpulse=0;else{var G=D.tangentImpulse;D.tangentImpulse+=C,D.tangentImpulse<-r&&(D.tangentImpulse=-r),D.tangentImpulse>r&&(D.tangentImpulse=r),C=D.tangentImpulse-G}var J=c*T+W*C,Y=K*T+z*C;M.isStatic||M.isSleeping||(M.positionPrev.x+=J*M.inverseMass,M.positionPrev.y+=Y*M.inverseMass,M.anglePrev+=(b*Y-h*J)*M.inverseInertia),j.isStatic||j.isSleeping||(j.positionPrev.x-=J*j.inverseMass,j.positionPrev.y-=Y*j.inverseMass,j.anglePrev-=(v*Y-e*J)*j.inverseInertia)}}}}},function(H,n,C){var r={};H.exports=r;var j=C(9),N=C(0);r.create=function(H){return N.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},H)},r.update=function(H,n,C){var r,N,Q,I,A=H.list,P=A.length,t=H.table,R=n.length,y=H.collisionStart,o=H.collisionEnd,g=H.collisionActive;for(y.length=0,o.length=0,I=g.length=0;I<P;I++)A[I].confirmedActive=!1;for(I=0;I<R;I++)(Q=(r=n[I]).pair)?(Q.isActive?g.push(Q):y.push(Q),j.update(Q,r,C),Q.confirmedActive=!0):(t[(Q=j.create(r,C)).id]=Q,y.push(Q),A.push(Q));var M=[];for(P=A.length,I=0;I<P;I++)(Q=A[I]).confirmedActive||(j.setActive(Q,!1,C),o.push(Q),Q.collision.bodyA.isSleeping||Q.collision.bodyB.isSleeping||M.push(I));for(I=0;I<M.length;I++)Q=A[N=M[I]-I],A.splice(N,1),delete t[Q.id]},r.clear=function(H){return H.table={},H.list.length=0,H.collisionStart.length=0,H.collisionActive.length=0,H.collisionEnd.length=0,H}},function(H,n,C){var r=H.exports=C(22);r.Axes=C(11),r.Bodies=C(12),r.Body=C(6),r.Bounds=C(1),r.Collision=C(8),r.Common=C(0),r.Composite=C(5),r.Composites=C(23),r.Constraint=C(10),r.Contact=C(17),r.Detector=C(14),r.Engine=C(18),r.Events=C(4),r.Grid=C(24),r.Mouse=C(13),r.MouseConstraint=C(25),r.Pair=C(9),r.Pairs=C(20),r.Plugin=C(15),r.Query=C(26),r.Render=C(16),r.Resolver=C(19),r.Runner=C(27),r.SAT=C(28),r.Sleeping=C(7),r.Svg=C(29),r.Vector=C(2),r.Vertices=C(3),r.World=C(30),r.Engine.run=r.Runner.run,r.Common.deprecated(r.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(H,n,C){var r={};H.exports=r;var N=C(15),Q=C(0);r.name="matter-js",r.version="0.18.0",r.uses=[],r.used=[],r.use=function(){N.use(r,Array.prototype.slice.call(arguments))},r.before=function(H,n){return H=H.replace(/^Matter./,""),Q.chainPathBefore(r,H,n)},r.after=function(H,n){return H=H.replace(/^Matter./,""),Q.chainPathAfter(r,H,n)}},function(H,n,C){var g={};H.exports=g;var c=C(5),j=C(10),l=C(0),K=C(6),M=C(12),r=l.deprecated;g.stack=function(H,n,C,r,N,Q,I){for(var A,P=c.create({label:"Stack"}),t=H,R=n,y=0,o=0;o<r;o++){for(var g=0,M=0;M<C;M++){var j=I(t,R,M,o,A,y);if(j){var l=j.bounds.max.y-j.bounds.min.y,f=j.bounds.max.x-j.bounds.min.x;g<l&&(g=l),K.translate(j,{x:.5*f,y:.5*l}),t=j.bounds.max.x+N,c.addBody(P,j),A=j,y+=1}else t+=N}R+=g+Q,t=H}return P},g.chain=function(H,n,C,r,N,Q){for(var I=H.bodies,A=1;A<I.length;A++){var P=I[A-1],t=I[A],R=P.bounds.max.y-P.bounds.min.y,y=P.bounds.max.x-P.bounds.min.x,o=t.bounds.max.y-t.bounds.min.y,g={bodyA:P,pointA:{x:y*n,y:R*C},bodyB:t,pointB:{x:(t.bounds.max.x-t.bounds.min.x)*r,y:o*N}},M=l.extend(g,Q);c.addConstraint(H,j.create(M))}return H.label+=" Chain",H},g.mesh=function(H,n,C,r,N){var Q,I,A,P,t,R=H.bodies;for(Q=0;Q<C;Q++){for(I=1;I<n;I++)A=R[I-1+Q*n],P=R[I+Q*n],c.addConstraint(H,j.create(l.extend({bodyA:A,bodyB:P},N)));if(0<Q)for(I=0;I<n;I++)A=R[I+(Q-1)*n],P=R[I+Q*n],c.addConstraint(H,j.create(l.extend({bodyA:A,bodyB:P},N))),r&&0<I&&(t=R[I-1+(Q-1)*n],c.addConstraint(H,j.create(l.extend({bodyA:t,bodyB:P},N)))),r&&I<n-1&&(t=R[I+1+(Q-1)*n],c.addConstraint(H,j.create(l.extend({bodyA:t,bodyB:P},N))))}return H.label+=" Mesh",H},g.pyramid=function(P,H,t,R,y,n,o){return g.stack(P,H,t,R,y,n,function(H,n,C,r,N,Q){var I=Math.min(R,Math.ceil(t/2)),A=N?N.bounds.max.x-N.bounds.min.x:0;if(!(I<r||C<(r=I-r)||t-1-r<C))return 1===Q&&K.translate(N,{x:(C+(t%2==1?1:-1))*A,y:0}),o(P+(N?C*A:0)+C*y,n,C,r,N,Q)})},g.newtonsCradle=function(H,n,C,r,N){for(var Q=c.create({label:"Newtons Cradle"}),I=0;I<C;I++){var A=M.circle(H+I*(1.9*r),n+N,r,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),P=j.create({pointA:{x:H+I*(1.9*r),y:n},bodyB:A});c.addBody(Q,A),c.addConstraint(Q,P)}return Q},r(g,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),g.car=function(H,n,C,r,N){var Q=K.nextGroup(!0),I=.5*-C+20,A=.5*C-20,P=c.create({label:"Car"}),t=M.rectangle(H,n,C,r,{collisionFilter:{group:Q},chamfer:{radius:.5*r},density:2e-4}),R=M.circle(H+I,n+0,N,{collisionFilter:{group:Q},friction:.8}),y=M.circle(H+A,n+0,N,{collisionFilter:{group:Q},friction:.8}),o=j.create({bodyB:t,pointB:{x:I,y:0},bodyA:R,stiffness:1,length:0}),g=j.create({bodyB:t,pointB:{x:A,y:0},bodyA:y,stiffness:1,length:0});return c.addBody(P,t),c.addBody(P,R),c.addBody(P,y),c.addConstraint(P,o),c.addConstraint(P,g),P},r(g,"car","Composites.car ➤ moved to car example"),g.softBody=function(H,n,C,r,N,Q,I,A,P,t){P=l.extend({inertia:1/0},P),t=l.extend({stiffness:.2,render:{type:"line",anchors:!1}},t);var R=g.stack(H,n,C,r,N,Q,function(H,n){return M.circle(H,n,A,P)});return g.mesh(R,C,r,I,t),R.label="Soft Body",R},r(g,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(H,n,C){var f={};H.exports=f;var R=C(9),P=C(0),r=P.deprecated;f.create=function(H){return P.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},H)},f.update=function(H,n,C,r){var N,Q,I,A,P,t=C.world,R=H.buckets,y=!1;for(N=0;N<n.length;N++){var o=n[N];if((!o.isSleeping||r)&&(!t.bounds||!(o.bounds.max.x<t.bounds.min.x||o.bounds.min.x>t.bounds.max.x||o.bounds.max.y<t.bounds.min.y||o.bounds.min.y>t.bounds.max.y))){var g=f._getRegion(H,o);if(!o.region||g.id!==o.region.id||r){o.region&&!r||(o.region=g);var M=f._regionUnion(g,o.region);for(Q=M.startCol;Q<=M.endCol;Q++)for(I=M.startRow;I<=M.endRow;I++){A=R[P=f._getBucketId(Q,I)];var j=Q>=g.startCol&&Q<=g.endCol&&I>=g.startRow&&I<=g.endRow,l=Q>=o.region.startCol&&Q<=o.region.endCol&&I>=o.region.startRow&&I<=o.region.endRow;!j&&l&&l&&A&&f._bucketRemoveBody(H,A,o),(o.region===g||j&&!l||r)&&(A||(A=f._createBucket(R,P)),f._bucketAddBody(H,A,o))}o.region=g,y=!0}}}y&&(H.pairsList=f._createActivePairsList(H))},r(f,"update","Grid.update ➤ replaced by Matter.Detector"),f.clear=function(H){H.buckets={},H.pairs={},H.pairsList=[]},r(f,"clear","Grid.clear ➤ replaced by Matter.Detector"),f._regionUnion=function(H,n){var C=Math.min(H.startCol,n.startCol),r=Math.max(H.endCol,n.endCol),N=Math.min(H.startRow,n.startRow),Q=Math.max(H.endRow,n.endRow);return f._createRegion(C,r,N,Q)},f._getRegion=function(H,n){var C=n.bounds,r=Math.floor(C.min.x/H.bucketWidth),N=Math.floor(C.max.x/H.bucketWidth),Q=Math.floor(C.min.y/H.bucketHeight),I=Math.floor(C.max.y/H.bucketHeight);return f._createRegion(r,N,Q,I)},f._createRegion=function(H,n,C,r){return{id:H+","+n+","+C+","+r,startCol:H,endCol:n,startRow:C,endRow:r}},f._getBucketId=function(H,n){return"C"+H+"R"+n},f._createBucket=function(H,n){return H[n]=[]},f._bucketAddBody=function(H,n,C){var r,N=H.pairs,Q=R.id,I=n.length;for(r=0;r<I;r++){var A=n[r];if(!(C.id===A.id||C.isStatic&&A.isStatic)){var P=Q(C,A),t=N[P];t?t[2]+=1:N[P]=[C,A,1]}}n.push(C)},f._bucketRemoveBody=function(H,n,C){var r,N=H.pairs,Q=R.id;n.splice(P.indexOf(n,C),1);var I=n.length;for(r=0;r<I;r++){var A=N[Q(C,n[r])];A&&(A[2]-=1)}},f._createActivePairsList=function(H){var n,C,r=H.pairs,N=P.keys(r),Q=N.length,I=[];for(C=0;C<Q;C++)0<(n=r[N[C]])[2]?I.push(n):delete r[N[C]];return I}},function(H,n,C){var Q={};H.exports=Q;var P=C(3),t=C(7),I=C(13),R=C(4),y=C(14),A=C(10),o=C(5),g=C(0),M=C(1);Q.create=function(n,H){var C=(n?n.mouse:null)||(H?H.mouse:null);C||(n&&n.render&&n.render.canvas?C=I.create(n.render.canvas):H&&H.element?C=I.create(H.element):(C=I.create(),g.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var r={type:"mouseConstraint",mouse:C,element:null,body:null,constraint:A.create({label:"Mouse Constraint",pointA:C.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},N=g.extend(r,H);return R.on(n,"beforeUpdate",function(){var H=o.allBodies(n.world);Q.update(N,H),Q._triggerEvents(N)}),N},Q.update=function(H,n){var C=H.mouse,r=H.constraint,N=H.body;if(0===C.button){if(r.bodyB)t.set(r.bodyB,!1),r.pointA=C.position;else for(var Q=0;Q<n.length;Q++)if(N=n[Q],M.contains(N.bounds,C.position)&&y.canCollide(N.collisionFilter,H.collisionFilter))for(var I=1<N.parts.length?1:0;I<N.parts.length;I++){var A=N.parts[I];if(P.contains(A.vertices,C.position)){r.pointA=C.position,r.bodyB=H.body=N,r.pointB={x:C.position.x-N.position.x,y:C.position.y-N.position.y},r.angleB=N.angle,t.set(N,!1),R.trigger(H,"startdrag",{mouse:C,body:N});break}}}else r.bodyB=H.body=null,r.pointB=null,N&&R.trigger(H,"enddrag",{mouse:C,body:N})},Q._triggerEvents=function(H){var n=H.mouse,C=n.sourceEvents;C.mousemove&&R.trigger(H,"mousemove",{mouse:n}),C.mousedown&&R.trigger(H,"mousedown",{mouse:n}),C.mouseup&&R.trigger(H,"mouseup",{mouse:n}),C.mouseout&&R.trigger(H,"mouseout",{mouse:n}),I.clearSourceEvents(n)}},function(H,n,C){var o={};H.exports=o;var g=C(2),M=C(8),j=C(1),l=C(12),A=C(3);o.collides=function(H,n){for(var C=[],r=n.length,N=H.bounds,Q=M.collides,I=j.overlaps,A=0;A<r;A++){var P=n[A],t=P.parts.length,R=1===t?0:1;if(I(P.bounds,N))for(var y=R;y<t;y++){var o=P.parts[y];if(I(o.bounds,N)){var g=Q(o,H);if(g){C.push(g);break}}}}return C},o.ray=function(H,n,C,r){r=r||1e-100;for(var N=g.angle(n,C),Q=g.magnitude(g.sub(n,C)),I=.5*(C.x+n.x),A=.5*(C.y+n.y),P=l.rectangle(I,A,Q,r,{angle:N}),t=o.collides(P,H),R=0;R<t.length;R+=1){var y=t[R];y.body=y.bodyB=y.bodyA}return t},o.region=function(H,n,C){for(var r=[],N=0;N<H.length;N++){var Q=H[N],I=j.overlaps(Q.bounds,n);(I&&!C||!I&&C)&&r.push(Q)}return r},o.point=function(H,n){for(var C=[],r=0;r<H.length;r++){var N=H[r];if(j.contains(N.bounds,n))for(var Q=1===N.parts.length?0:1;Q<N.parts.length;Q++){var I=N.parts[Q];if(j.contains(I.bounds,n)&&A.contains(I.vertices,n)){C.push(N);break}}}return C}},function(H,n,C){var r={};H.exports=r;var A=C(4),P=C(18),N=C(0);r.create=function(H){var n=N.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},H);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(.5*n.fps),n.fps=1e3/n.delta,n},r.run=function(H,n){return void 0!==H.positionIterations&&(n=H,H=r.create()),Laya.timer.clear(this,r.render),Laya.timer.frameLoop(1,this,r.render,[H,n]),H},r.render=function(H,n){H.enabled&&r.tick(H,n,N.now())},r.tick=function(H,n,C){var r,N=n.timing,Q=1,I={timestamp:N.timestamp};A.trigger(H,"beforeTick",I),H.isFixed?r=H.delta:(r=C-H.timePrev||H.delta,H.timePrev=C,H.deltaHistory.push(r),H.deltaHistory=H.deltaHistory.slice(-H.deltaSampleSize),Q=(r=(r=(r=Math.min.apply(null,H.deltaHistory))<H.deltaMin?H.deltaMin:r)>H.deltaMax?H.deltaMax:r)/H.delta,H.delta=r),0!==H.timeScalePrev&&(Q*=N.timeScale/H.timeScalePrev),0===N.timeScale&&(Q=0),H.timeScalePrev=N.timeScale,H.correction=Q,H.frameCounter+=1,1e3<=C-H.counterTimestamp&&(H.fps=H.frameCounter*((C-H.counterTimestamp)/1e3),H.counterTimestamp=C,H.frameCounter=0),A.trigger(H,"tick",I),A.trigger(H,"beforeUpdate",I),P.update(n,r,Q),A.trigger(H,"afterUpdate",I),A.trigger(H,"afterTick",I)},r.stop=function(H){Laya.timer.clear(this,r.render)},r.start=function(H,n){r.run(H,n)}},function(H,n,C){var r={};H.exports=r;var N=C(8),Q=C(0).deprecated;r.collides=function(H,n){return N.collides(H,n)},Q(r,"collides","SAT.collides ➤ replaced by Collision.collides")},function(H,n,C){var K={};H.exports=K;C(1);var W=C(0);K.pathToVertices=function(H,n){"undefined"==typeof window||"SVGPathSeg"in window||W.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var C,r,N,Q,I,A,P,t,R,y,o,g=[],M=0,j=0,l=0;function f(H,n,C){var r=C%2==1&&1<C;if(!R||H!=R.x||n!=R.y){o=R&&r?(y=R.x,R.y):y=0;var N={x:y+H,y:o+n};!r&&R||(R=N),g.push(N),j=y+H,l=o+n}}function c(H){var n=H.pathSegTypeAsLetter.toUpperCase();if("Z"!==n){switch(n){case"M":case"L":case"T":case"C":case"S":case"Q":j=H.x,l=H.y;break;case"H":j=H.x;break;case"V":l=H.y}f(j,l,H.pathSegType)}}for(n=n||15,K._svgPathToAbsolute(H),N=H.getTotalLength(),A=[],C=0;C<H.pathSegList.numberOfItems;C+=1)A.push(H.pathSegList.getItem(C));for(P=A.concat();M<N;){if((I=A[H.getPathSegAtLength(M)])!=t){for(;P.length&&P[0]!=I;)c(P.shift());t=I}switch(I.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":Q=H.getPointAtLength(M),f(Q.x,Q.y,0)}M+=n}for(C=0,r=P.length;C<r;++C)c(P[C]);return g},K._svgPathToAbsolute=function(H){for(var n,C,r,N,Q,I,A=H.pathSegList,P=0,t=0,R=A.numberOfItems,y=0;y<R;++y){var o=A.getItem(y),g=o.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(g))"x"in o&&(P=o.x),"y"in o&&(t=o.y);else switch("x1"in o&&(r=P+o.x1),"x2"in o&&(Q=P+o.x2),"y1"in o&&(N=t+o.y1),"y2"in o&&(I=t+o.y2),"x"in o&&(P+=o.x),"y"in o&&(t+=o.y),g){case"m":A.replaceItem(H.createSVGPathSegMovetoAbs(P,t),y);break;case"l":A.replaceItem(H.createSVGPathSegLinetoAbs(P,t),y);break;case"h":A.replaceItem(H.createSVGPathSegLinetoHorizontalAbs(P),y);break;case"v":A.replaceItem(H.createSVGPathSegLinetoVerticalAbs(t),y);break;case"c":A.replaceItem(H.createSVGPathSegCurvetoCubicAbs(P,t,r,N,Q,I),y);break;case"s":A.replaceItem(H.createSVGPathSegCurvetoCubicSmoothAbs(P,t,Q,I),y);break;case"q":A.replaceItem(H.createSVGPathSegCurvetoQuadraticAbs(P,t,r,N),y);break;case"t":A.replaceItem(H.createSVGPathSegCurvetoQuadraticSmoothAbs(P,t),y);break;case"a":A.replaceItem(H.createSVGPathSegArcAbs(P,t,o.r1,o.r2,o.angle,o.largeArcFlag,o.sweepFlag),y);break;case"z":case"Z":P=n,t=C}"M"!=g&&"m"!=g||(n=P,C=t)}}},function(H,n,C){var r={};H.exports=r;var N=C(5);C(0);r.create=N.create,r.add=N.add,r.remove=N.remove,r.clear=N.clear,r.addComposite=N.addComposite,r.addBody=N.addBody,r.addBodyAt=N.addBodyAt,r.addConstraint=N.addConstraint}])}),function(H){if("object"==typeof exports&&"undefined"!=typeof module)window?window.decomp=H():module.exports=H();else if("function"==typeof define&&define.amd)define([],H);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.decomp=H()}}(function(){return function N(Q,I,A){function P(C,H){if(!I[C]){if(!Q[C]){var n="function"==typeof require&&require;if(!H&&n)return n(C,!0);if(t)return t(C,!0);throw new Error("Cannot find module '"+C+"'")}var r=I[C]={exports:{}};Q[C][0].call(r.exports,function(H){var n=Q[C][1][H];return P(n||H)},r,r.exports,N,Q,I,A)}return I[C].exports}for(var t="function"==typeof require&&require,H=0;H<A.length;H++)P(A[H]);return P}({1:[function(H,n,C){function P(H,n,C){C=C||0;var r,N,Q,I,A,P,t,R=[0,0];return r=H[1][1]-H[0][1],N=H[0][0]-H[1][0],Q=r*H[0][0]+N*H[0][1],I=n[1][1]-n[0][1],A=n[0][0]-n[1][0],P=I*n[0][0]+A*n[0][1],l(t=r*A-I*N,0,C)||(R[0]=(A*Q-N*P)/t,R[1]=(r*P-I*Q)/t),R}function N(H,n,C,r){var N=n[0]-H[0],Q=n[1]-H[1],I=r[0]-C[0],A=r[1]-C[1];if(I*Q-A*N==0)return!1;var P=(N*(C[1]-H[1])+Q*(H[0]-C[0]))/(I*Q-A*N),t=(I*(H[1]-C[1])+A*(C[0]-H[0]))/(A*N-I*Q);return 0<=P&&P<=1&&0<=t&&t<=1}function t(H,n,C){return(n[0]-H[0])*(C[1]-H[1])-(C[0]-H[0])*(n[1]-H[1])}function k(H,n,C){return 0<t(H,n,C)}function i(H,n,C){return 0<=t(H,n,C)}function a(H,n,C){return t(H,n,C)<0}function D(H,n,C){return t(H,n,C)<=0}n.exports={decomp:function(H){var n=function H(n){var C=[],r=[],N=[],Q=[];var I=Number.MAX_VALUE;for(var A=0;A<n.length;++A)if(v(n,A))for(var P=0;P<n.length;++P)if(M(n,A,P)){r=H(j(n,A,P,Q)),N=H(j(n,P,A,Q));for(var t=0;t<N.length;t++)r.push(N[t]);r.length<I&&(I=(C=r).length,C.push([b(n,A),b(n,P)]))}return C}(H);return 0<n.length?function H(n,C){if(0===C.length)return[n];{if(C instanceof Array&&C.length&&C[0]instanceof Array&&2===C[0].length&&C[0][0]instanceof Array){for(var r=[n],N=0;N<C.length;N++)for(var Q=C[N],I=0;I<r.length;I++){var A=r[I],P=H(A,Q);if(P){r.splice(I,1),r.push(P[0],P[1]);break}}return r}var Q=C,N=n.indexOf(Q[0]),I=n.indexOf(Q[1]);return-1!==N&&-1!==I&&[j(n,N,I),j(n,I,N)]}}(H,n):[H]},quickDecomp:function H(n,C,r,N,Q,I,A){I=I||100;A=A||0;Q=Q||25;C=void 0!==C?C:[];r=r||[];N=N||[];var P=[0,0],t=[0,0],R=[0,0];var y=0,o=0,g=0,M=0;var j=0,l=0,f=0;var c=[],K=[];var W=n,z=n;if(z.length<3)return C;A++;if(I<A)return console.warn("quickDecomp: max level ("+I+") reached."),C;for(var w=0;w<n.length;++w)if(v(W,w)){r.push(W[w]),y=o=Number.MAX_VALUE;for(var F=0;F<n.length;++F)k(b(W,w-1),b(W,w),b(W,F))&&D(b(W,w-1),b(W,w),b(W,F-1))&&(R=Z(b(W,w-1),b(W,w),b(W,F),b(W,F-1)),a(b(W,w+1),b(W,w),R)&&(g=L(W[w],R))<o&&(o=g,t=R,l=F)),k(b(W,w+1),b(W,w),b(W,F+1))&&D(b(W,w+1),b(W,w),b(W,F))&&(R=Z(b(W,w+1),b(W,w),b(W,F),b(W,F+1)),k(b(W,w-1),b(W,w),R)&&(g=L(W[w],R))<y&&(y=g,P=R,j=F));if(l===(j+1)%n.length)R[0]=(t[0]+P[0])/2,R[1]=(t[1]+P[1])/2,N.push(R),w<j?(h(c,W,w,j+1),c.push(R),K.push(R),0!==l&&h(K,W,l,W.length),h(K,W,0,w+1)):(0!==w&&h(c,W,w,W.length),h(c,W,0,j+1),c.push(R),K.push(R),h(K,W,l,w+1));else{if(j<l&&(j+=n.length),M=Number.MAX_VALUE,j<l)return C;for(var F=l;F<=j;++F)i(b(W,w-1),b(W,w),b(W,F))&&D(b(W,w+1),b(W,w),b(W,F))&&(g=L(b(W,w),b(W,F)))<M&&e(W,w,F)&&(M=g,f=F%n.length);w<f?(h(c,W,w,f+1),0!==f&&h(K,W,f,z.length),h(K,W,0,w+1)):(0!==w&&h(c,W,w,z.length),h(c,W,0,f+1),h(K,W,f,w+1))}return c.length<K.length?(H(c,C,r,N,Q,I,A),H(K,C,r,N,Q,I,A)):(H(K,C,r,N,Q,I,A),H(c,C,r,N,Q,I,A)),C}C.push(n);return C},isSimple:function(H){var n,C=H;for(n=0;n<C.length-1;n++)for(var r=0;r<n-1;r++)if(N(C[n],C[n+1],C[r],C[r+1]))return!1;for(n=1;n<C.length-2;n++)if(N(C[0],C[C.length-1],C[n],C[n+1]))return!1;return!0},removeCollinearPoints:function(H,n){for(var C=0,r=H.length-1;3<H.length&&0<=r;--r)Q(b(H,r-1),b(H,r),b(H,r+1),n)&&(H.splice(r%H.length,1),C++);return C},removeDuplicatePoints:function(H,n){for(var C=H.length-1;1<=C;--C)for(var r=H[C],N=C-1;0<=N;--N)Q=r,I=H[N],A=n,l(Q[0],I[0],A)&&l(Q[1],I[1],A)&&H.splice(C,1);var Q,I,A},makeCCW:function(H){for(var n=0,C=H,r=1;r<H.length;++r)(C[r][1]<C[n][1]||C[r][1]===C[n][1]&&C[r][0]>C[n][0])&&(n=r);return!k(b(H,n-1),b(H,n),b(H,n+1))&&(function(H){for(var n=[],C=H.length,r=0;r!==C;r++)n.push(H.pop());for(var r=0;r!==C;r++)H[r]=n[r]}(H),!0)}};var R=[],y=[];function Q(H,n,C,r){if(r){var N=R,Q=y;N[0]=n[0]-H[0],N[1]=n[1]-H[1],Q[0]=C[0]-n[0],Q[1]=C[1]-n[1];var I=N[0]*Q[0]+N[1]*Q[1],A=Math.sqrt(N[0]*N[0]+N[1]*N[1]),P=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]);return Math.acos(I/(A*P))<r}return 0===t(H,n,C)}function L(H,n){var C=n[0]-H[0],r=n[1]-H[1];return C*C+r*r}function b(H,n){var C=H.length;return H[n<0?n%C+C:n%C]}function h(H,n,C,r){for(var N=C;N<r;N++)H.push(n[N])}function v(H,n){return a(b(H,n-1),b(H,n),b(H,n+1))}var o=[],g=[];function M(H,n,C){var r,N,Q=o,I=g;if(i(b(H,n+1),b(H,n),b(H,C))&&D(b(H,n-1),b(H,n),b(H,C)))return!1;N=L(b(H,n),b(H,C));for(var A=0;A!==H.length;++A)if((A+1)%H.length!==n&&A!==n&&i(b(H,n),b(H,C),b(H,A+1))&&D(b(H,n),b(H,C),b(H,A))&&(Q[0]=b(H,n),Q[1]=b(H,C),I[0]=b(H,A),I[1]=b(H,A+1),r=P(Q,I),L(b(H,n),r)<N))return!1;return!0}function e(H,n,C){for(var r=0;r!==H.length;++r)if(r!==n&&r!==C&&(r+1)%H.length!==n&&(r+1)%H.length!==C&&N(b(H,n),b(H,C),b(H,r),b(H,r+1)))return!1;return!0}function j(H,n,C,r){var N=r||[];if(function(H){H.length=0}(N),n<C)for(var Q=n;Q<=C;Q++)N.push(H[Q]);else{for(Q=0;Q<=C;Q++)N.push(H[Q]);for(Q=n;Q<H.length;Q++)N.push(H[Q])}return N}function Z(H,n,C,r,N){N=N||0;var Q=n[1]-H[1],I=H[0]-n[0],A=Q*H[0]+I*H[1],P=r[1]-C[1],t=C[0]-r[0],R=P*C[0]+t*C[1],y=Q*t-P*I;return l(y,0,N)?[0,0]:[(t*A-I*R)/y,(Q*R-P*A)/y]}function l(H,n,C){return C=C||0,Math.abs(H-n)<=C}},{}]},{},[1])(1)}),function(){var c={},r=Matter.Common,K=Matter.Composite,W=Matter.Bounds,n=Matter.Events,z=(Matter.Grid,Matter.Vector);c.create=function(H){var n={controller:c,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222222",hasBounds:!!H.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},C=r.extend(n,H);return C.mouse=H.mouse,C.engine=H.engine,C.container=C.container||Laya.stage,C.bounds=C.bounds||{min:{x:0,y:0},max:{x:C.width,y:C.height}},C},c.run=function(H){Laya.timer.frameLoop(1,this,c.world,[H]),n.on(H.engine.world,"afterRemove",c.onRemoveSprite)},c.stop=function(H){Laya.timer.clear(this,c.world),n.off(H.engine.world,"afterRemove",c.onRemoveSprite)},c.onRemoveSprite=function(H){var n=H.object.layaSprite;n&&n.parent&&n.parent.removeChild(n)},c.world=function(H){var n,C=H.engine.world,r=(H.renderer,H.container),N=H.options,Q=K.allBodies(C),I=K.allConstraints(C),A=[];N.wireframes?c.setBackground(H,N.wireframeBackground):c.setBackground(H,N.background);var P=H.bounds.max.x-H.bounds.min.x,t=H.bounds.max.y-H.bounds.min.y,R=P/H.options.width,y=t/H.options.height;if(N.hasBounds){for(n=0;n<Q.length;n++){var o=Q[n];o.render.sprite.visible=W.overlaps(o.bounds,H.bounds)}for(n=0;n<I.length;n++){var g=I[n],M=g.bodyA,j=g.bodyB,l=g.pointA,f=g.pointB;M&&(l=z.add(M.position,g.pointA)),j&&(f=z.add(j.position,g.pointB)),l&&f&&((W.contains(H.bounds,l)||W.contains(H.bounds,f))&&A.push(g))}r.scale(1/R,1/y),r.pos(-H.bounds.min.x*(1/R),-H.bounds.min.y*(1/y))}else A=I;for(n=0;n<Q.length;n++)c.body(H,Q[n]);for(n=0;n<A.length;n++)c.constraint(H,A[n])},c.setBackground=function(H,n){if(H.currentBackground!==n){var C=n.indexOf&&-1!==n.indexOf("#");H.container.graphics.clear(),C?H.container.bgColor=n:(H.container.loadImage(n),H.container.bgColor="#FFFFFF"),H.currentBackground=n}},c.body=function(H,n){H.engine;var C=n.render;if(C.visible){if(C.sprite&&C.sprite.texture){n.id;var r=n.layaSprite,N=H.container;r||(r=n.layaSprite=P(H,n),n.effPendant&&!n.effPendant.parent&&r.addChild(n.effPendant)),N.contains(r)||(0<=n.childIndex&&n.childIndex<N.numChildren?N.addChildAt(r,n.childIndex):N.addChild(r)),r.x=n.position.x,r.y=n.position.y,r.rotation=180*n.angle/Math.PI,r.scaleX=C.sprite.xScale||1,r.scaleY=C.sprite.yScale||1,r.width=C.sprite.width,r.height=C.sprite.height,C.sprite.sizeGrid&&(r.sizeGrid=C.sprite.sizeGrid)}else{n.id,r=n.layaSprite,N=H.container;r||((r=n.layaSprite=t(H,n)).initialAngle=n.angle,n.effPendant&&!n.effPendant.parent&&r.addChild(n.effPendant)),N.contains(r)||(0<=n.childIndex&&n.childIndex<N.numChildren?N.addChildAt(r,n.childIndex):N.addChild(r)),r.x=n.position.x,r.y=n.position.y,r.rotation=180*(n.angle-r.initialAngle)/Math.PI}var Q=n.text;if(Q){var I=r.lbl;I||((I=r.lbl=new Laya.Label).fontSize=30,I.anchorX=.5,I.anchorY=.5,I.color=n.textClr?n.textClr:"#ffffff",I.strokeColor="#000000",I.stroke=2,I.centerX=0,I.centerY=0,r.addChild(I),void 0!==n.shapeType&&(0===n.shapeType&&(I.centerX=-10),2===n.shapeType&&(I.rotation=-r.rotation)),I.text=Q+"",n.lbl=I)}if(n.pendant&&!r.pendantSpr){var A=new Laya.Image;A.skin=n.pendant,r.addChild(A),r.pendantSpr=A}}};var P=function(H,n){var C=n.render.sprite.texture,r=new Laya.Image;return r.skin=C,r.pivotX=n.render.sprite.xOffset,r.pivotY=n.render.sprite.yOffset,r},t=function(H,n){var C,r,N,Q,I=n.render,A=H.options,P=new Laya.Sprite,t=P.graphics;t.clear();for(var R=1<n.parts.length?1:0;R<n.parts.length;R++){Q=n.parts[R];var y=[];N=A.wireframes?(C=null,r="#bbbbbb",1):(C=I.fillStyle,r=I.strokeStyle,I.lineWidth),y.push(Q.vertices[0].x-n.position.x,Q.vertices[0].y-n.position.y);for(var o=1;o<Q.vertices.length;o++)y.push(Q.vertices[o].x-n.position.x,Q.vertices[o].y-n.position.y);y.push(Q.vertices[0].x-n.position.x,Q.vertices[0].y-n.position.y),t.drawPoly(0,0,y,C,r,N),(A.showAngleIndicator||A.showAxes)&&(N=1,r=A.wireframes?"#CD5C5C":I.strokeStyle,t.drawLine(Q.position.x-n.position.x,Q.position.y-n.position.y,(Q.vertices[0].x+Q.vertices[Q.vertices.length-1].x)/2-n.position.x,(Q.vertices[0].y+Q.vertices[Q.vertices.length-1].y)/2-n.position.y))}return P};c.constraint=function(H,n){H.engine;var C=n.bodyA,r=n.bodyB,N=n.pointA,Q=n.pointB,I=H.container,A=n.render,P=(n.id,n.layaSprite);P||(P=n.layaSprite=new Laya.Sprite);var t,R,y,o,g=P.graphics;A.visible&&n.pointA&&n.pointB?(I.contains(P)||I.addChild(P),g.clear(),R=C?(t=C.position.x+N.x,C.position.y+N.y):(t=N.x,N.y),o=r?(y=r.position.x+Q.x,r.position.y+Q.y):(y=Q.x,Q.y),g.drawLine(t,R,y,o,A.strokeStyle,A.lineWidth)):g.clear()},window.LayaRender=c}();