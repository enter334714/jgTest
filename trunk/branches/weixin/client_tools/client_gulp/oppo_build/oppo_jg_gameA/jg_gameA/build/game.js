!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);i(1),i(2),i(3),i(8),i(10),i(12),i(13);console.info("0 进入游戏包"),window.lastError,qg.onError((function(t){if(t){var e={id:window.PF_INFO.roleId,role:window.PF_INFO.roleName,level:window.PF_INFO.roleLevel,user:window.PF_INFO.account,version:window.PF_INFO.lastVersion,gamever:window.config.game_ver,cdn:window.PF_INFO.cdn,serverid:window.PF_INFO.selectedServer?window.PF_INFO.selectedServer.server_id:0,systemInfo:window.systemInfo,error:"MiniProgramError",stack:t?t.message:""},i=JSON.stringify(e);console.error("脚本错误："+i),window.lastError&&window.lastError==e.error||(window.lastError=e.error,window.clientlog(e))}})),window.Parser=i(5),console.info("1 初始化"),Laya.Stage.FRAME_SLOW="fast",Laya.Stage.FRAME_SLEEP="slow";if(new window.ServerLoading({showLoadingBtn:!0}),window.ServerLoading.instance.openAuthor(),window.compareVersion=function(t,e){if(!t||!e)return 0;t=t.split("."),e=e.split(".");const i=Math.max(t.length,e.length);for(;t.length<i;)t.push("0");for(;e.length<i;)e.push("0");for(var n=0;n<i;n++){const i=parseInt(t[n]),r=parseInt(e[n]);if(i>r)return 1;if(i<r)return-1}return 0},window.SDKVersion=qg.getSystemInfoSync().platformVersionCode,console.log("vivo基础库版本："+window.SDKVersion),window.SDKVersion>=1083){const t=qg.getUpdateManager();t.onCheckForUpdate((function(t){console.log("是否有新版本："+t.hasUpdate)})),t.onUpdateReady((function(){qg.showDialog({title:"更新提示",message:"新版本已经准备好，是否重启应用？",buttons:[{text:"确定"}],success:function(e){t.applyUpdate()}})})),t.onUpdateFailed((function(){console.log("新版本下载失败 ")}))}else qg.onUpdateReady((function(t){console.log("新版本已经准备好"+t),1==t&&qg.applyUpdate()}));window.loadProbuf=function(){console.log("protobuf 分包加载");var t=qg.loadSubpackage({name:"probuf",success:function(t){console.log("protobuf 分包加载成功"),console.log(t),t?(window.loadProbPkg=!0,window.initMain(),window.enterToGame()):setTimeout((function(){window.loadProbuf()}),500)},fail:function(t){console.log("protobuf 分包加载失败"),console.log(t),setTimeout((function(){window.loadProbuf()}),500)}});t&&t.onProgressUpdate(t=>{})},window.loadMain=function(){console.log("Main 分包加载");var t=qg.loadSubpackage({name:"sub",success:function(t){console.log("Main 分包加载成功"),console.log(t),t?(window.loadMainPkg=!0,window.initMain(),window.enterToGame()):setTimeout((function(){window.loadMain()}),500)},fail:function(t){console.log("Main 分包加载失败"),console.log(t),setTimeout((function(){window.loadMain()}),500)}});t&&t.onProgressUpdate(t=>{})},window.SDKVersion>=1052?(console.log("vivo基础库版本符合分包版本要求："+window.SDKVersion+">=1052"),window.sdkInit(),window.loadProbuf(),window.loadMain()):(i(14),i(15),window.reqRecordInfo("vivo基础库版本过低",window.SDKVersion)),window.systemInfo="",qg.getSystemInfo({success(t){window.systemInfo="品牌："+t.brand+"，型号："+t.model+"，系统及版本："+t.osType+","+t.osVersionName+","+t.osVersionCode+"，运行平台版本名："+t.platformVersionName+"，运行平台版本号："+t.platformVersionCode,console.log(window.systemInfo),console.log("屏幕宽度："+t.screenWidth+"，屏幕高度："+t.screenHeight+"，刘海屏高度："+t.statusBarHeight+"，安全区域："+(t.safeArea?t.safeArea.top+","+t.safeArea.bottom+","+t.safeArea.left+","+t.safeArea.right:""));var e=t.osType?t.osType.toLowerCase():"",i=t.model?t.model.toLowerCase().replace(" ",""):"";window.PF_INFO.wxIOS=-1!=e.indexOf("ios"),window.PF_INFO.wxAndroid=-1!=e.indexOf("android"),window.PF_INFO.wxPhone=-1!=e.indexOf("ios")||-1!=e.indexOf("android"),window.PF_INFO.wxPC=-1!=e.indexOf("windows")||-1!=e.indexOf("mac"),window.PF_INFO.wxPlatform=t.platform?t.platform.toLowerCase():"",window.PF_INFO.wxLimitLoad=!1,window.PF_INFO.wxBenchmarkLevel=2,-1!=e.indexOf("android")?t.benchmarkLevel>=24?window.PF_INFO.wxBenchmarkLevel=3:window.PF_INFO.wxBenchmarkLevel=2:-1!=e.indexOf("ios")?t.benchmarkLevel&&t.benchmarkLevel>=20?window.PF_INFO.wxBenchmarkLevel=3:-1!=i.indexOf("iphone5")||-1!=i.indexOf("iphone6")||-1!=i.indexOf("iphone7")||-1!=i.indexOf("iphonese")||-1!=i.indexOf("ipad")?window.PF_INFO.wxBenchmarkLevel=2:window.PF_INFO.wxBenchmarkLevel=3:window.PF_INFO.wxBenchmarkLevel=2,console.log("加载限制："+window.PF_INFO.wxLimitLoad+"，设备限制等级："+window.PF_INFO.wxBenchmarkLevel)}}),qg.getBatteryInfo({success:function(t){console.log("电量："+100*t.level+"%，是否正在充电："+t.isCharging)}}),qg.getNetworkType({success:function(t){console.log("网络类型："+t.type)}}),qg.setKeepScreenOn({keepSrceenOn:!0}),qg.subscribeNetworkStatus((function(t){console.log("网络类型："+t.type+"，是否按照流量计费："+t.metered)})),qg.onShow((function(t){window.onShowData=t,window.onShowCallback&&window.onShowData&&(console.info("小游戏切前台事件，场景值："+window.onShowData.scene),window.onShowCallback(window.onShowData),window.onShowData=null)})),window.memoryWarningNum=0,window.onMemoryWarningCallBack=null},function(t,e,i){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=15)}([function(t,e){class i{constructor(t,e){this._type=t,this._target=null,this._eventPhase=2,this._currentTarget=null,this._canceled=!1,this._stopped=!1,this._passiveListener=null,this._timeStamp=Date.now()}get type(){return this._type}get target(){return this._target}get currentTarget(){return this._currentTarget}get isTrusted(){return!1}get timeStamp(){return this._timeStamp}composedPath(){const t=this._currentTarget;return null===t?[]:[t]}get eventPhase(){return this._eventPhase}stopPropagation(){}stopImmediatePropagation(){this._stopped=!0}get bubbles(){return!1}get cancelable(){return!0}preventDefault(){null===this._passiveListener?this.cancelable&&(this._canceled=!0):console.warn("Event#preventDefault() was called from a passive listener:",this._passiveListener)}get defaultPrevented(){return this._canceled}get composed(){return!1}get timeStamp(){return this._timeStamp}}i.NONE=0,i.CAPTURING_PHASE=1,i.AT_TARGET=2,i.BUBBLING_PHASE=3,t.exports=i},function(t,e,i){const n=i(7);t.exports=class extends n{constructor(t=""){super(),this.tagName=t.toUpperCase(),this.className="",this.children=[],this.style={width:window.innerWidth+"px",height:window.innerHeight+"px"},this.innerHTML="",this.parentElement=mainCanvas}setAttribute(t,e){this[t]=e}getAttribute(t){return this[t]}focus(){}}},function(t,e){var i=0,n={touch:{},mouse:{},keyboard:{},devicemotion:{}},r={touch:0,mouse:0,keyboard:0,devicemotion:0},s={touch:null,mouse:null,keyboard:null,devicemotion:null},a={touch:null,mouse:null,keyboard:null,devicemotion:null};const o={touch:["touchstart","touchmove","touchend","touchcancel"],mouse:["mousedown","mousemove","mouseup","mousewheel"],keyboard:["keydown","keyup","keypress"],devicemotion:["devicemotion"]};function h(t){return t&&"object"==typeof t}t.exports=class{constructor(){this._targetID=++i,this._listenerCount={touch:0,mouse:0,keyboard:0,devicemotion:0},this._listeners=new Map}_associateSystemEventListener(t){for(var e in o)if(o[e].indexOf(t)>-1){s[e]&&0===r[e]&&s[e](),0===this._listenerCount[e]&&(n[e][this._targetID]=this),++this._listenerCount[e],++r[e];break}}_dissociateSystemEventListener(t){for(var e in o)if(o[e].indexOf(t)>-1){this._listenerCount[e]<=0&&delete n[e][this._targetID],--r[e],a[e]&&0===r[e]&&a[e]();break}}addEventListener(t,e,i){if(!e)return!1;if("function"!=typeof e&&!h(e))throw new TypeError("'listener' should be a function or an object.");const n=this._listeners,r=h(i),s=(r?Boolean(i.capture):Boolean(i))?1:2,a={listener:e,listenerType:s,passive:r&&Boolean(i.passive),once:r&&Boolean(i.once),next:null};let o=n.get(t);if(void 0===o)return n.set(t,a),this._associateSystemEventListener(t),!0;let l=null;for(;o;){if(o.listener===e&&o.listenerType===s)return!1;l=o,o=o.next}return l.next=a,this._associateSystemEventListener(t),!0}removeEventListener(t,e,i){if(!e)return!1;const n=this._listeners,r=(h(i)?Boolean(i.capture):Boolean(i))?1:2;let s=null,a=n.get(t);for(;a;){if(a.listener===e&&a.listenerType===r)return s?s.next=a.next:a.next?n.set(t,a.next):n.delete(t),this._dissociateSystemEventListener(t),!0;s=a,a=a.next}return!1}dispatchEvent(t){if(!t||"string"!=typeof t.type)throw new TypeError('"event.type" should be a string.');const e=t.type;var i=this["on"+e];if(i&&"function"==typeof i&&(t._target=t._currentTarget=this,i.call(this,t),t._target=t._currentTarget=null,t._eventPhase=0,t._passiveListener=null,t.defaultPrevented))return!1;const n=this._listeners;let r=n.get(e);if(!r)return!0;t._target=t._currentTarget=this;let s=null;for(;r&&(r.once?s?s.next=r.next:r.next?n.set(e,r.next):n.delete(e):s=r,t._passiveListener=r.passive?r.listener:null,"function"==typeof r.listener&&r.listener.call(this,t),!t._stopped);)r=r.next;return t._target=t._currentTarget=null,t._eventPhase=0,t._passiveListener=null,!t.defaultPrevented}}},function(t,e,i){const n=i(1),r=i(25);t.exports=class extends n{constructor(t){super(t),this._volume=1,this._duration=0,this._isEnded=!1,this._isMute=!1,this._readyState=0,this._error=new r}addTextTrack(){}captureStream(){}fastSeek(){}load(){}pause(){}play(){}canPlayType(t){return""}set volume(t){this._volume=t}get volume(){return this._volume}get duration(){return this._duration}get ended(){return this._isEnded}get muted(){return this._isMute}get readyState(){return this._readyState}get error(){return this._error}get currentTime(){return 0}}},function(t,e){function i(t,e){for(var i in t)e[i]=t[i]}function n(t,e){var n=t.prototype;if(!(n instanceof e)){function r(){}r.prototype=e.prototype,i(n,r=new r),t.prototype=n=r}n.constructor!=t&&("function"!=typeof t&&console.error("unknow Class:"+t),n.constructor=t)}var r={},s=r.ELEMENT_NODE=1,a=r.ATTRIBUTE_NODE=2,o=r.TEXT_NODE=3,h=r.CDATA_SECTION_NODE=4,l=r.ENTITY_REFERENCE_NODE=5,c=r.ENTITY_NODE=6,u=r.PROCESSING_INSTRUCTION_NODE=7,d=r.COMMENT_NODE=8,_=r.DOCUMENT_NODE=9,f=r.DOCUMENT_TYPE_NODE=10,p=r.DOCUMENT_FRAGMENT_NODE=11,m=r.NOTATION_NODE=12,g={},v={},y=(g.INDEX_SIZE_ERR=(v[1]="Index size error",1),g.DOMSTRING_SIZE_ERR=(v[2]="DOMString size error",2),g.HIERARCHY_REQUEST_ERR=(v[3]="Hierarchy request error",3)),x=(g.WRONG_DOCUMENT_ERR=(v[4]="Wrong document",4),g.INVALID_CHARACTER_ERR=(v[5]="Invalid character",5),g.NO_DATA_ALLOWED_ERR=(v[6]="No data allowed",6),g.NO_MODIFICATION_ALLOWED_ERR=(v[7]="No modification allowed",7),g.NOT_FOUND_ERR=(v[8]="Not found",8)),w=(g.NOT_SUPPORTED_ERR=(v[9]="Not supported",9),g.INUSE_ATTRIBUTE_ERR=(v[10]="Attribute in use",10));g.INVALID_STATE_ERR=(v[11]="Invalid state",11),g.SYNTAX_ERR=(v[12]="Syntax error",12),g.INVALID_MODIFICATION_ERR=(v[13]="Invalid modification",13),g.NAMESPACE_ERR=(v[14]="Invalid namespace",14),g.INVALID_ACCESS_ERR=(v[15]="Invalid access",15);function b(t,e){if(e instanceof Error)var i=e;else i=this,Error.call(this,v[t]),this.message=v[t],Error.captureStackTrace&&Error.captureStackTrace(this,b);return i.code=t,e&&(this.message=this.message+": "+e),i}function S(){}function T(t,e){this._node=t,this._refresh=e,C(this)}function C(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var n=t._refresh(t._node);et(t,"length",n.length),i(n,t),t._inc=e}}function M(){}function I(t,e){for(var i=t.length;i--;)if(t[i]===e)return i}function E(t,e,i,n){if(n?e[I(e,n)]=i:e[e.length++]=i,t){i.ownerElement=t;var r=t.ownerDocument;r&&(n&&B(r,t,n),function(t,e,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(e._nsMap[i.prefix?i.localName:""]=i.value)}(r,t,i))}}function A(t,e,i){var n=I(e,i);if(!(n>=0))throw b(x,new Error(t.tagName+"@"+i));for(var r=e.length-1;n<r;)e[n]=e[++n];if(e.length=r,t){var s=t.ownerDocument;s&&(B(s,t,i),i.ownerElement=null)}}function D(t){if(this._features={},t)for(var e in t)this._features=t[e]}function P(){}function R(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function N(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(N(t,e))return!0}while(t=t.nextSibling)}function L(){}function B(t,e,i,n){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete e._nsMap[i.prefix?i.localName:""]}function O(t,e,i){if(t&&t._inc){t._inc++;var n=e.childNodes;if(i)n[n.length++]=i;else{for(var r=e.firstChild,s=0;r;)n[s++]=r,r=r.nextSibling;n.length=s}}}function F(t,e){var i=e.previousSibling,n=e.nextSibling;return i?i.nextSibling=n:t.firstChild=n,n?n.previousSibling=i:t.lastChild=i,O(t.ownerDocument,t),e}function k(t,e,i){var n=e.parentNode;if(n&&n.removeChild(e),e.nodeType===p){var r=e.firstChild;if(null==r)return e;var s=e.lastChild}else r=s=e;var a=i?i.previousSibling:t.lastChild;r.previousSibling=a,s.nextSibling=i,a?a.nextSibling=r:t.firstChild=r,null==i?t.lastChild=s:i.previousSibling=s;do{r.parentNode=t}while(r!==s&&(r=r.nextSibling));return O(t.ownerDocument||t,t),e.nodeType==p&&(e.firstChild=e.lastChild=null),e}function V(){this._nsMap={}}function U(){}function H(){}function z(){}function W(){}function G(){}function Y(){}function X(){}function j(){}function K(){}function q(){}function Z(){}function Q(){}function J(t,e){var i=[],n=9==this.nodeType&&this.documentElement||this,r=n.prefix,s=n.namespaceURI;if(s&&null==r&&null==(r=n.lookupPrefix(s)))var a=[{namespace:s,prefix:null}];return tt(this,i,t,e,a),i.join("")}function $(t,e,i){var n=t.prefix||"",r=t.namespaceURI;if(!n&&!r)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===r||"http://www.w3.org/2000/xmlns/"==r)return!1;for(var s=i.length;s--;){var a=i[s];if(a.prefix==n)return a.namespace!=r}return!0}function tt(t,e,i,n,r){if(n){if(!(t=n(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case s:r||(r=[]);r.length;var c=t.attributes,m=c.length,g=t.firstChild,v=t.tagName;i="http://www.w3.org/1999/xhtml"===t.namespaceURI||i,e.push("<",v);for(var y=0;y<m;y++){"xmlns"==(x=c.item(y)).prefix?r.push({prefix:x.localName,namespace:x.value}):"xmlns"==x.nodeName&&r.push({prefix:"",namespace:x.value})}for(y=0;y<m;y++){var x;if($(x=c.item(y),0,r)){var w=x.prefix||"",b=x.namespaceURI,S=w?" xmlns:"+w:" xmlns";e.push(S,'="',b,'"'),r.push({prefix:w,namespace:b})}tt(x,e,i,n,r)}if($(t,0,r)){w=t.prefix||"",b=t.namespaceURI,S=w?" xmlns:"+w:" xmlns";e.push(S,'="',b,'"'),r.push({prefix:w,namespace:b})}if(g||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(e.push(">"),i&&/^script$/i.test(v))for(;g;)g.data?e.push(g.data):tt(g,e,i,n,r),g=g.nextSibling;else for(;g;)tt(g,e,i,n,r),g=g.nextSibling;e.push("</",v,">")}else e.push("/>");return;case _:case p:for(g=t.firstChild;g;)tt(g,e,i,n,r),g=g.nextSibling;return;case a:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,R),'"');case o:return e.push(t.data.replace(/[<&]/g,R));case h:return e.push("<![CDATA[",t.data,"]]>");case d:return e.push("\x3c!--",t.data,"--\x3e");case f:var T=t.publicId,C=t.systemId;if(e.push("<!DOCTYPE ",t.name),T)e.push(' PUBLIC "',T),C&&"."!=C&&e.push('" "',C),e.push('">');else if(C&&"."!=C)e.push(' SYSTEM "',C,'">');else{var M=t.internalSubset;M&&e.push(" [",M,"]"),e.push(">")}return;case u:return e.push("<?",t.target," ",t.data,"?>");case l:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function et(t,e,i){t[e]=i}b.prototype=Error.prototype,i(g,b),S.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var i=[],n=0;n<this.length;n++)tt(this[n],i,t,e);return i.join("")}},T.prototype.item=function(t){return C(this),this[t]},n(T,S),M.prototype={length:0,item:S.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var i=this[e];if(i.nodeName==t)return i}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new b(w);var i=this.getNamedItem(t.nodeName);return E(this._ownerElement,this,t,i),i},setNamedItemNS:function(t){var e,i=t.ownerElement;if(i&&i!=this._ownerElement)throw new b(w);return e=this.getNamedItemNS(t.namespaceURI,t.localName),E(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return A(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var i=this.getNamedItemNS(t,e);return A(this._ownerElement,this,i),i},getNamedItemNS:function(t,e){for(var i=this.length;i--;){var n=this[i];if(n.localName==e&&n.namespaceURI==t)return n}return null}},D.prototype={hasFeature:function(t,e){var i=this._features[t.toLowerCase()];return!(!i||e&&!(e in i))},createDocument:function(t,e,i){var n=new L;if(n.implementation=this,n.childNodes=new S,n.doctype=i,i&&n.appendChild(i),e){var r=n.createElementNS(t,e);n.appendChild(r)}return n},createDocumentType:function(t,e,i){var n=new Y;return n.name=t,n.nodeName=t,n.publicId=e,n.systemId=i,n}},P.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return k(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return F(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,i,n){var r=new i.constructor;for(var o in i){var h=i[o];"object"!=typeof h&&h!=r[o]&&(r[o]=h)}i.childNodes&&(r.childNodes=new S);switch(r.ownerDocument=e,r.nodeType){case s:var l=i.attributes,c=r.attributes=new M,u=l.length;c._ownerElement=r;for(var d=0;d<u;d++)r.setAttributeNode(t(e,l.item(d),!0));break;case a:n=!0}if(n)for(var _=i.firstChild;_;)r.appendChild(t(e,_,n)),_=_.nextSibling;return r}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==o&&t.nodeType==o?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var i=e._nsMap;if(i)for(var n in i)if(i[n]==t)return n;e=e.nodeType==a?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var i=e._nsMap;if(i&&t in i)return i[t];e=e.nodeType==a?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},i(r,P),i(r,P.prototype),L.prototype={nodeName:"#document",nodeType:_,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==p){for(var i=t.firstChild;i;){var n=i.nextSibling;this.insertBefore(i,e),i=n}return t}return null==this.documentElement&&t.nodeType==s&&(this.documentElement=t),k(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),F(this,t)},importNode:function(t,e){return function t(e,i,n){var r;switch(i.nodeType){case s:(r=i.cloneNode(!1)).ownerDocument=e;case p:break;case a:n=!0}r||(r=i.cloneNode(!1));if(r.ownerDocument=e,r.parentNode=null,n)for(var o=i.firstChild;o;)r.appendChild(t(e,o,n)),o=o.nextSibling;return r}(this,t,e)},getElementById:function(t){var e=null;return N(this.documentElement,(function(i){if(i.nodeType==s&&i.getAttribute("id")==t)return e=i,!0})),e},createElement:function(t){var e=new V;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new S,(e.attributes=new M)._ownerElement=e,e},createDocumentFragment:function(){var t=new q;return t.ownerDocument=this,t.childNodes=new S,t},createTextNode:function(t){var e=new z;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new W;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new G;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var i=new Z;return i.ownerDocument=this,i.tagName=i.target=t,i.nodeValue=i.data=e,i},createAttribute:function(t){var e=new U;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new K;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var i=new V,n=e.split(":"),r=i.attributes=new M;return i.childNodes=new S,i.ownerDocument=this,i.nodeName=e,i.tagName=e,i.namespaceURI=t,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,r._ownerElement=i,i},createAttributeNS:function(t,e){var i=new U,n=e.split(":");return i.ownerDocument=this,i.nodeName=e,i.name=e,i.namespaceURI=t,i.specified=!0,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,i}},n(L,P),V.prototype={nodeType:s,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var i=this.ownerDocument.createAttribute(t);i.value=i.nodeValue=""+e,this.setAttributeNode(i)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===p?this.insertBefore(t,null):function(t,e){var i=e.parentNode;if(i){var n=t.lastChild;i.removeChild(e);n=t.lastChild}return n=t.lastChild,e.parentNode=t,e.previousSibling=n,e.nextSibling=null,n?n.nextSibling=e:t.firstChild=e,t.lastChild=e,O(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);i&&this.removeAttributeNode(i)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);return i&&i.value||""},setAttributeNS:function(t,e,i){var n=this.ownerDocument.createAttributeNS(t,e);n.value=n.nodeValue=""+i,this.setAttributeNode(n)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new T(this,(function(e){var i=[];return N(e,(function(n){n===e||n.nodeType!=s||"*"!==t&&n.tagName!=t||i.push(n)})),i}))},getElementsByTagNameNS:function(t,e){return new T(this,(function(i){var n=[];return N(i,(function(r){r===i||r.nodeType!==s||"*"!==t&&r.namespaceURI!==t||"*"!==e&&r.localName!=e||n.push(r)})),n}))}},L.prototype.getElementsByTagName=V.prototype.getElementsByTagName,L.prototype.getElementsByTagNameNS=V.prototype.getElementsByTagNameNS,n(V,P),U.prototype.nodeType=a,n(U,P),H.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(v[y])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,i){i=this.data.substring(0,t)+i+this.data.substring(t+e),this.nodeValue=this.data=i,this.length=i.length}},n(H,P),z.prototype={nodeName:"#text",nodeType:o,splitText:function(t){var e=this.data,i=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},n(z,H),W.prototype={nodeName:"#comment",nodeType:d},n(W,H),G.prototype={nodeName:"#cdata-section",nodeType:h},n(G,H),Y.prototype.nodeType=f,n(Y,P),X.prototype.nodeType=m,n(X,P),j.prototype.nodeType=c,n(j,P),K.prototype.nodeType=l,n(K,P),q.prototype.nodeName="#document-fragment",q.prototype.nodeType=p,n(q,P),Z.prototype.nodeType=u,n(Z,P),Q.prototype.serializeToString=function(t,e,i){return J.call(t,e,i)},P.prototype.toString=J;try{if(Object.defineProperty){Object.defineProperty(T.prototype,"length",{get:function(){return C(this),this.$$length}}),Object.defineProperty(P.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case s:case p:var i=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&i.push(t(e)),e=e.nextSibling;return i.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case s:case p:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),et=function(t,e,i){t["$$"+e]=i}}}catch(t){}e.DOMImplementation=D,e.XMLSerializer=Q},function(t,e){const i=(window.mainCanvas||qg.createCanvas()).constructor;t.exports=i},function(t,e){const i={href:"game.js",pathname:"game.js",search:"",hash:"",reload(){}};t.exports=i},function(t,e,i){const n=i(8),r=i(24);t.exports=class extends n{constructor(){super(),this.className="",this.children=[],this.clientLeft=0,this.clientTop=0,this.scrollLeft=0,this.scrollTop=0}get clientWidth(){return 0}get clientHeight(){return 0}getBoundingClientRect(){return new r(0,0,window.innerWidth,window.innerHeight)}removeAttribute(t){}}},function(t,e,i){const n=i(2);t.exports=class extends n{constructor(){super(),this.childNodes=[],this.parentNode=mainCanvas}appendChild(t){this.childNodes.push(t)}insertBefore(t,e){return t}replaceChild(t,e){return e}cloneNode(){const t=Object.create(this);return Object.assign(t,this),t}removeChild(t){const e=this.childNodes.findIndex(e=>e===t);return e>-1?this.childNodes.splice(e,1):null}contains(t){return this.childNodes.indexOf(t)>-1}}},function(t,e){const i=qg.createImage();t.exports=i.constructor},function(t,e,i){const n=i(11);t.exports=function(t){return new n(t)}},function(t,e,i){const n=i(3),r=new WeakMap,s=new WeakMap;new WeakMap,new WeakMap;class a extends n{constructor(t){super("audio"),s.set(this,"");const e=qg.createInnerAudioContext();r.set(this,e),e.onEnded(()=>{this._paused=r.get(this).paused,!1===r.get(this).loop&&this.dispatchEvent({type:"ended"}),this.readyState=4}),t&&(r.get(this).src=t),this._paused=e.paused,this._volume=e.volume,this._muted=!1}load(){console.warn("HTMLAudioElement.load() is not implemented.")}play(){r.get(this).play(),-1===r.get(this).id&&this.dispatchEvent({type:"error"})}pause(){r.get(this).pause()}destroy(){}canPlayType(t=""){return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}get currentTime(){return r.get(this).currentTime}set currentTime(t){r.get(this).seek(t)}get duration(){return r.get(this).duration}get src(){return s.get(this)}set src(t){s.set(this,t),r.get(this).src=t}get loop(){return r.get(this).loop}set loop(t){r.get(this).loop=t}get autoplay(){return!1}set autoplay(t){}get paused(){return r.get(this).paused}get volume(){return this._volume}set volume(t){this._volume=t,this._muted||(r.get(this).volume=t)}get muted(){return this._muted}set muted(t){this._muted=t,r.get(this).volume=t?0:this._volume}cloneNode(){const t=new a;return t.loop=r.get(this).loop,t.src=this.src,t}}t.exports=a},function(t,e,i){const n=i(3);t.exports=class extends n{constructor(){super("video")}canPlayType(t){return!1}}},function(t,e,i){const n=i(1);i(0);t.exports=class extends n{constructor(t,e){super("script")}set src(t){}}},function(t,e,i){const n=i(2),r=i(0);t.exports=class extends n{constructor(){super(),this._status="loading"}get status(){return this._status}set onloading(t){this.addEventListener("loading",t)}set onloadingdone(t){this.addEventListener("loadingdone",t)}set onloadingerror(t){this.addEventListener("loadingerror",t)}add(t){this._status=t._status="loading",this.dispatchEvent(new r("loading"));let e=qg.loadFont(t.family,t.source);setTimeout(()=>{e?(t._status=this._status="loaded",t._resolveCB(),this.dispatchEvent(new r("loadingdone"))):(t._status=this._status="error",t._rejectCB(),this.dispatchEvent(new r("loadingerror")))},0)}clear(){}delete(){}load(){}ready(){}}},function(t,e,i){window._isAdapted||(i(16),window._isAdapted=!0)},function(t,e,i){const{btoa:n,atob:r}=i(17);window.btoa=n,window.atob=r;const{Blob:s,URL:a}=i(18);window.Blob=s,window.URL=a,window.DOMParser=i(20).DOMParser,window.CanvasRenderingContext2D=qg.getCanvasRenderingContext2D(),window.top=window.parent=window,window.ontouchstart=null,window.ontouchmove=null,window.ontouchend=null,window.ontouchcancel=null,window.pageXOffset=window.pageYOffset=window.clientTop=window.clientLeft=0,window.outerWidth=window.innerWidth,window.outerHeight=window.innerHeight,window.mainCanvas=qg.createCanvas(),window.HTMLCanvasElement=i(5),window.location=i(6),window.document=i(23),window.Element=i(7),window.HTMLElement=i(1),window.HTMLImageElement=i(26),window.HTMLMediaElement=i(3),window.HTMLAudioElement=i(11),window.HTMLVideoElement=i(12),window.HTMLScriptElement=i(13),window.navigator=i(27),window.Image=i(9),window.Audio=i(10),window.FileReader=i(29),window.FontFace=i(30),window.FontFaceSet=i(14),window.EventTarget=i(2),window.Event=i(0),window.TouchEvent=i(31),window.MouseEvent=i(32),window.KeyboardEvent=i(33),window.DeviceMotionEvent=i(34);var o=0;switch(qg.getDeviceRotation()){case 1:o=90;break;case 2:o=180;break;case 3:o=-90}window.orientation=o,window.devicePixelRatio=1,window.screen={availTop:0,availLeft:0,availHeight:window.innerWidth,availWidth:window.innerHeight,colorDepth:8,pixelDepth:8,left:0,top:0,width:window.innerWidth,height:window.innerHeight,orientation:{type:"portrait-primary"},onorientationchange:function(t){}},window.addEventListener=function(t,e,i){window.mainCanvas.addEventListener(t,e,i)},window.removeEventListener=function(t,e,i){window.mainCanvas.removeEventListener(t,e,i)},window.dispatchEvent=function(t){window.mainCanvas.dispatchEvent(t)},window.getComputedStyle=function(t){return{position:"absolute",left:"0px",top:"0px",height:"0px"}},window.focus=function(){},window.scroll=function(){},window.resize=function(t,e){window.innerWidth=t,window.innerHeight=e,window.outerWidth=window.innerWidth,window.outerHeight=window.innerHeight,window.mainCanvas._width=window.innerWidth,window.mainCanvas._height=window.innerHeight,window.screen.availWidth=window.innerWidth,window.screen.availHeight=window.innerHeight,window.screen.width=window.innerWidth,window.screen.height=window.innerHeight},window.localStorage=i(35),window.alert=console.error.bind(console),window.close=qg.getClose?qg.getClose:function(){}},function(t,e,i){!function(){function t(t){this.message=t}var i=e,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=new Error,t.prototype.name="InvalidCharacterError",i.btoa||(i.btoa=function(e){for(var i,r,s=String(e),a=0,o=n,h="";s.charAt(0|a)||(o="=",a%1);h+=o.charAt(63&i>>8-a%1*8)){if((r=s.charCodeAt(a+=.75))>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|r}return h}),i.atob||(i.atob=function(e){var i=String(e).replace(/[=]+$/,"");if(i.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,a=0,o=0,h="";s=i.charAt(o++);~s&&(r=a%4?64*r+s:s,a++%4)?h+=String.fromCharCode(255&r>>(-2*a&6)):0)s=n.indexOf(s);return h})}()},function(t,e,i){(function(i){var n,r,s;!function(i){r=[e],void 0===(s="function"==typeof(n=function(t){"use strict";if(t.URL=i.URL||i.webkitURL,i.Blob&&i.URL)try{return void new Blob}catch(t){}var e=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||function(){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(t,e,i){this.data=t,this.size=t.length,this.type=e,this.encoding=i},s=n.prototype,a=r.prototype,o=i.FileReaderSync,h=function(t){this.code=this[this.name=t]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,u=i.URL||i.webkitURL||t,d=u.createObjectURL,_=u.revokeObjectURL,f=u,p=i.btoa,m=i.atob,g=i.ArrayBuffer,v=i.Uint8Array,y=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(r.fake=a.fake=!0;c--;)h.prototype[l[c]]=c+1;return u.createObjectURL||(f=t.URL=function(t){var e,i=document.createElementNS("http://www.w3.org/1999/xhtml","a");return i.href=t,"origin"in i||("data:"===i.protocol.toLowerCase()?i.origin=null:(e=t.match(y),i.origin=e&&e[1])),i}),f.createObjectURL=function(t){var e,i=t.type;return null===i&&(i="application/octet-stream"),t instanceof r?(e="data:"+i,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):d?d.call(u,t):void 0},f.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&_&&_.call(u,t)},s.append=function(t){var i=this.data;if(v&&(t instanceof g||t instanceof v)){for(var n="",s=new v(t),a=0,l=s.length;a<l;a++)n+=String.fromCharCode(s[a]);i.push(n)}else if("Blob"===e(t)||"File"===e(t)){if(!o)throw new h("NOT_READABLE_ERR");var c=new o;i.push(c.readAsBinaryString(t))}else t instanceof r?"base64"===t.encoding&&m?i.push(m(t.data)):"URI"===t.encoding?i.push(decodeURIComponent(t.data)):"raw"===t.encoding&&i.push(t.data):("string"!=typeof t&&(t+=""),i.push(unescape(encodeURIComponent(t))))},s.getBlob=function(t){return arguments.length||(t=null),new r(this.data.join(""),t,"raw")},s.toString=function(){return"[object BlobBuilder]"},a.slice=function(t,e,i){var n=arguments.length;return n<3&&(i=null),new r(this.data.slice(t,n>1?e:this.data.length),i,this.encoding)},a.toString=function(){return"[object Blob]"},a.close=function(){this.size=0,delete this.data},n}();t.Blob=function(t,i){var n=i&&i.type||"",r=new e;if(t)for(var s=0,a=t.length;s<a;s++)Uint8Array&&t[s]instanceof Uint8Array?r.append(t[s].buffer):r.append(t[s]);var o=r.getBlob(n);return!o.slice&&o.webkitSlice&&(o.slice=o.webkitSlice),o};var n=Object.getPrototypeOf||function(t){return t.__proto__};t.Blob.prototype=n(new t.Blob)})?n.apply(e,r):n)||(t.exports=s)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0!==i&&i||this.content||this)}).call(e,i(19))},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){function n(t){this.options=t||{locator:{}}}function r(){this.cdata=!1}function s(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function a(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function o(t,e,i){return"string"==typeof t?t.substr(e,i):t.length>=e+i||e?new java.lang.String(t,e,i)+"":t}function h(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}n.prototype.parseFromString=function(t,e){var i=this.options,n=new c,s=i.domBuilder||new r,o=i.errorHandler,h=i.locator,u=i.xmlns||{},d=/\/x?html?$/.test(e),_=d?l.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return h&&s.setDocumentLocator(h),n.errorHandler=function(t,e,i){if(!t){if(e instanceof r)return e;t=e}var n={},s=t instanceof Function;function o(e){var r=t[e];!r&&s&&(r=2==t.length?function(i){t(e,i)}:t),n[e]=r&&function(t){r("[xmldom "+e+"]\t"+t+a(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),n}(o,s,h),n.domBuilder=i.domBuilder||s,d&&(u[""]="http://www.w3.org/1999/xhtml"),u.xml=u.xml||"http://www.w3.org/XML/1998/namespace",t?n.parse(t,u,_):n.errorHandler.error("invalid doc source"),s.doc},r.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,i,n){var r=this.doc,a=r.createElementNS(t,i||e),o=n.length;h(this,a),this.currentElement=a,this.locator&&s(this.locator,a);for(var l=0;l<o;l++){t=n.getURI(l);var c=n.getValue(l),u=(i=n.getQName(l),r.createAttributeNS(t,i));this.locator&&s(n.getLocator(l),u),u.value=u.nodeValue=c,a.setAttributeNode(u)}},endElement:function(t,e,i){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var i=this.doc.createProcessingInstruction(t,e);this.locator&&s(this.locator,i),h(this,i)},ignorableWhitespace:function(t,e,i){},characters:function(t,e,i){if(t=o.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(t);else n=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(t)&&this.doc.appendChild(n),this.locator&&s(this.locator,n)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,i){t=o.apply(this,arguments);var n=this.doc.createComment(t);this.locator&&s(this.locator,n),h(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,i){var n=this.doc.implementation;if(n&&n.createDocumentType){var r=n.createDocumentType(t,e,i);this.locator&&s(this.locator,r),h(this,r)}},warning:function(t){console.warn("[xmldom warning]\t"+t,a(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,a(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]\t"+t,a(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(t){r.prototype[t]=function(){return null}}));var l=i(21),c=i(22).XMLReader,u=e.DOMImplementation=i(4).DOMImplementation;e.XMLSerializer=i(4).XMLSerializer,e.DOMParser=n},function(t,e){e.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},function(t,e){var i=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+i.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),r=new RegExp("^"+i.source+n.source+"*(?::"+i.source+n.source+"*)?$");function s(){}function a(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function o(t,e,i,n,r,s){for(var a,o=++e,h=0;;){var l=t.charAt(o);switch(l){case"=":if(1===h)a=t.slice(e,o),h=3;else{if(2!==h)throw new Error("attribute equal must after attrName");h=3}break;case"'":case'"':if(3===h||1===h){if(1===h&&(s.warning('attribute value must after "="'),a=t.slice(e,o)),e=o+1,!((o=t.indexOf(l,e))>0))throw new Error("attribute value no end '"+l+"' match");c=t.slice(e,o).replace(/&#?\w+;/g,r),i.add(a,c,e-1),h=5}else{if(4!=h)throw new Error('attribute value must after "="');c=t.slice(e,o).replace(/&#?\w+;/g,r),i.add(a,c,e),s.warning('attribute "'+a+'" missed start quot('+l+")!!"),e=o+1,h=5}break;case"/":switch(h){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:h=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==h&&i.setTagName(t.slice(e,o)),o;case">":switch(h){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(c=t.slice(e,o)).slice(-1)&&(i.closed=!0,c=c.slice(0,-1));case 2:2===h&&(c=a),4==h?(s.warning('attribute "'+c+'" missed quot(")!!'),i.add(a,c.replace(/&#?\w+;/g,r),e)):("http://www.w3.org/1999/xhtml"===n[""]&&c.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),i.add(c,c,e));break;case 3:throw new Error("attribute value missed!!")}return o;case"":l=" ";default:if(l<=" ")switch(h){case 0:i.setTagName(t.slice(e,o)),h=6;break;case 1:a=t.slice(e,o),h=2;break;case 4:var c=t.slice(e,o).replace(/&#?\w+;/g,r);s.warning('attribute "'+c+'" missed quot(")!!'),i.add(a,c,e);case 5:h=6}else switch(h){case 2:i.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&a.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),i.add(a,a,e),e=o,h=1;break;case 5:s.warning('attribute space is required"'+a+'"!!');case 6:h=1,e=o;break;case 3:h=4,e=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function h(t,e,i){for(var n=t.tagName,r=null,s=t.length;s--;){var a=t[s],o=a.qName,h=a.value;if((_=o.indexOf(":"))>0)var l=a.prefix=o.slice(0,_),c=o.slice(_+1),d="xmlns"===l&&c;else c=o,l=null,d="xmlns"===o&&"";a.localName=c,!1!==d&&(null==r&&(r={},u(i,i={})),i[d]=r[d]=h,a.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(d,h))}for(s=t.length;s--;){(l=(a=t[s]).prefix)&&("xml"===l&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(a.uri=i[l||""]))}var _;(_=n.indexOf(":"))>0?(l=t.prefix=n.slice(0,_),c=t.localName=n.slice(_+1)):(l=null,c=t.localName=n);var f=t.uri=i[l||""];if(e.startElement(f,c,n,t),!t.closed)return t.currentNSMap=i,t.localNSMap=r,!0;if(e.endElement(f,c,n),r)for(l in r)e.endPrefixMapping(l)}function l(t,e,i,n,r){if(/^(?:script|textarea)$/i.test(i)){var s=t.indexOf("</"+i+">",e),a=t.substring(e+1,s);if(/[&<]/.test(a))return/^script$/i.test(i)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,n),r.characters(a,0,a.length),s)}return e+1}function c(t,e,i,n){var r=n[i];return null==r&&((r=t.lastIndexOf("</"+i+">"))<e&&(r=t.lastIndexOf("</"+i)),n[i]=r),r<e}function u(t,e){for(var i in t)e[i]=t[i]}function d(t,e,i,n){switch(t.charAt(e+2)){case"-":return"-"===t.charAt(e+3)?(r=t.indexOf("--\x3e",e+4))>e?(i.comment(t,e+4,r-e-4),r+3):(n.error("Unclosed comment"),-1):-1;default:if("CDATA["==t.substr(e+3,6)){var r=t.indexOf("]]>",e+9);return i.startCDATA(),i.characters(t,e+9,r-e-9),i.endCDATA(),r+3}var s=function(t,e){var i,n=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=e,r.exec(t);for(;i=r.exec(t);)if(n.push(i),i[1])return n}(t,e),a=s.length;if(a>1&&/!doctype/i.test(s[0][0])){var o=s[1][0],h=a>3&&/^public$/i.test(s[2][0])&&s[3][0],l=a>4&&s[4][0],c=s[a-1];return i.startDTD(o,h&&h.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),c.index+c[0].length}}return-1}function _(t,e,i){var n=t.indexOf("?>",e);if(n){var r=t.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){r[0].length;return i.processingInstruction(r[1],r[2]),n+2}return-1}return-1}function f(t){}s.prototype={parse:function(t,e,i){var n=this.domBuilder;n.startDocument(),u(e,e={}),function(t,e,i,n,r){function s(t){var e=t.slice(1,-1);return e in i?i[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),i=56320+(1023&t);return String.fromCharCode(e,i)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(r.error("entity not found:"+t),t)}function u(e){if(e>b){var i=t.substring(b,e).replace(/&#?\w+;/g,s);y&&p(b),n.characters(i,0,e-b),b=e}}function p(e,i){for(;e>=g&&(i=v.exec(t));)m=i.index,g=m+i[0].length,y.lineNumber++;y.columnNumber=e-m+1}var m=0,g=0,v=/.*(?:\r\n?|\n)|.*$/g,y=n.locator,x=[{currentNSMap:e}],w={},b=0;for(;;){try{var S=t.indexOf("<",b);if(S<0){if(!t.substr(b).match(/^\s*$/)){var T=n.doc,C=T.createTextNode(t.substr(b));T.appendChild(C),n.currentElement=C}return}switch(S>b&&u(S),t.charAt(S+1)){case"/":var M=t.indexOf(">",S+3),I=t.substring(S+2,M),E=x.pop();M<0?(I=t.substring(S+2).replace(/[\s<].*/,""),r.error("end tag name: "+I+" is not complete:"+E.tagName),M=S+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),r.error("end tag name: "+I+" maybe not complete"),M=S+1+I.length);var A=E.localNSMap,D=E.tagName==I;if(D||E.tagName&&E.tagName.toLowerCase()==I.toLowerCase()){if(n.endElement(E.uri,E.localName,I),A)for(var P in A)n.endPrefixMapping(P);D||r.fatalError("end tag name: "+I+" is not match the current start tagName:"+E.tagName)}else x.push(E);M++;break;case"?":y&&p(S),M=_(t,S,n);break;case"!":y&&p(S),M=d(t,S,n,r);break;default:y&&p(S);var R=new f,N=x[x.length-1].currentNSMap,L=(M=o(t,S,R,N,s,r),R.length);if(!R.closed&&c(t,M,R.tagName,w)&&(R.closed=!0,i.nbsp||r.warning("unclosed xml attribute")),y&&L){for(var B=a(y,{}),O=0;O<L;O++){var F=R[O];p(F.offset),F.locator=a(y,{})}n.locator=B,h(R,n,N)&&x.push(R),n.locator=y}else h(R,n,N)&&x.push(R);"http://www.w3.org/1999/xhtml"!==R.uri||R.closed?M++:M=l(t,M,R.tagName,s,n)}}catch(t){r.error("element parse error: "+t),M=-1}M>b?b=M:u(Math.max(S,b)+1)}}(t,e,i,n,this.errorHandler),n.endDocument()}},f.prototype={setTagName:function(t){if(!r.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,i){if(!r.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:i}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},e.XMLReader=s},function(t,e,i){const n=i(1),r=i(9),s=i(10),a=i(5),o=i(12),h=i(13),l=i(8),c=i(14);let u=new class extends l{constructor(){super(),this.readyState="complete",this.visibilityState="visible",this.documentElement=window,this.hidden=!1,this.style={},this.location=i(6),this.head=new n("head"),this.body=new n("body"),this.fonts=new c,this.scripts=[]}createElementNS(t,e,i){return this.createElement(e)}createElement(t){return"canvas"===t?new a:"audio"===t?new s:"img"===t?new r:"video"===t?new o:"script"===t?new h:new n(t)}getElementById(t){return t===mainCanvas.id||"canvas"===t?mainCanvas:new n(t)}getElementsByTagName(t){return"head"===t?[u.head]:"body"===t?[u.body]:"canvas"===t?[mainCanvas]:[new n(t)]}getElementsByName(t){return"head"===t?[u.head]:"body"===t?[u.body]:"canvas"===t?[mainCanvas]:[new n(t)]}querySelector(t){return"head"===t?u.head:"body"===t?u.body:"canvas"===t||t==="#"+mainCanvas.id?mainCanvas:new n(t)}querySelectorAll(t){return"head"===t?[u.head]:"body"===t?[u.body]:"canvas"===t?[mainCanvas]:[new n(t)]}createTextNode(){return new n("text")}elementFromPoint(){return window.canvas}createEvent(t){return window[t]?new window[t]:null}};t.exports=u},function(t,e){t.exports=class{constructor(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.left=this.x,this.top=this.y,this.right=this.x+this.width,this.bottom=this.y+this.height}}},function(t,e){t.exports=class{constructor(){}get code(){return 1}get message(){return""}}},function(t,e){const i=qg.createImage();t.exports=i.constructor},function(t,e,i){const{noop:n}=i(28),r={platform:qg.getOS(),language:qg.getCurrentLanguage(),appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:qg.getUserAgent(),onLine:!0,geolocation:{getCurrentPosition:n,watchPosition:n,clearWatch:n},maxTouchPoints:10};qg.subscribeNetworkStatus({callback:function(t){r.onLine="none"!==t.type}}),t.exports=r},function(t,e){t.exports=function(){}},function(t,e,i){const n=i(2);t.exports=class extends n{construct(){this.result=null}abort(){}readAsArrayBuffer(){}readAsDataURL(t){this.result="data:image/png;base64,"+window.btoa(t);var e=new Event("load");this.dispatchEvent(e)}readAsText(){}}},function(t,e){t.exports=class{constructor(t,e,i){this.family=t,this.source=e,this.descriptors=i,this._status="unloaded",this._loaded=new Promise((t,e)=>{this._resolveCB=t,this._rejectCB=e})}load(){}get status(){return this._status}get loaded(){return this._loaded}}},function(t,e,i){const n=i(0);t.exports=class extends n{constructor(t,e){super(t),this.touches=[],this.targetTouches=[],this.changedTouches=[]}}},function(t,e,i){const n=i(0);t.exports=class extends n{constructor(t,e){super(t),this._button=e.button,this._which=e.which,this._wheelDelta=e.wheelDelta,this._clientX=e.clientX,this._clientY=e.clientY,this._screenX=e.screenX,this._screenY=e.screenY,this._pageX=e.pageX,this._pageY=e.pageY}get button(){return this._button}get which(){return this._which}get wheelDelta(){return this._wheelDelta}get clientX(){return this._clientX}get clientY(){return this._clientY}get screenX(){return this._screenX}get screenY(){return this._screenY}get pageX(){return this._pageX}get pageY(){return this._pageY}}},function(t,e,i){const n=i(0),r={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"("};var s=!1;t.exports=class extends n{constructor(t,e){super(t),"object"==typeof e?(this._altKeyActive=!!e.altKey&&e.altKey,this._ctrlKeyActive=!!e.ctrlKey&&e.ctrlKey,this._metaKeyActive=!!e.metaKey&&e.metaKey,this._shiftKeyActive=!!e.shiftKey&&e.shiftKey,this._keyCode=e.keyCode?e.keyCode:-1,this._repeat=!!e.repeat&&e.repeat):(this._altKeyActive=!1,this._ctrlKeyActive=!1,this._metaKeyActive=!1,this._shiftKeyActive=!1,this._keyCode=-1,this._repeat=!1);var i=this._keyCode;if(i>=48&&i<=57){var n=i-48;this._code="Digit"+n,this._key=this._shiftKeyActive?r[i]:""+n}else if(i>=10048&&i<=10057){n=(i=this._keyCode=i-1e4)-48;this._code="Numpad"+n,this._key=""+n}else if(i>=65&&i<=90){var a=String.fromCharCode(i);this._code="Key"+a,this._key=this._shiftKeyActive||s?a:a.toLowerCase()}else i>=112&&i<=123?this._code=this._key="F"+(i-111):27===i?this._code=this._key="Escape":189===i?(this._code="Minus",this._key=this._shiftKeyActive?"_":"-"):187===i?(this._code="Equal",this._key=this._shiftKeyActive?"+":"="):220===i?(this._code="Backslash",this._key=this._shiftKeyActive?"|":"\\"):192===i?(this._code="Backquote",this._key=this._shiftKeyActive?"~":"`"):8===i?this._code=this._key="Backspace":13===i?this._code=this._key="Enter":219===i?(this._code="BracketLeft",this._key=this._shiftKeyActive?"{":"["):221===i?(this._code="BracketRight",this._key=this._shiftKeyActive?"}":"]"):186===i?(this._code="Semicolon",this._key=this._shiftKeyActive?":":";"):222===i?(this._code="Quote",this._key=this._shiftKeyActive?'"':"'"):9===i?this._code=this._key="Tab":17===i?(this._code="ControlLeft",this._key="Control"):20017===i?(this._keyCode=17,this._code="ControlRight",this._key="Control"):16===i?(this._code="ShiftLeft",this._key="Shift"):20016===i?(this._keyCode=16,this._code="ShiftRight",this._key="Shift"):18===i?(this._code="AltLeft",this._key="Alt"):20018===i?(this._keyCode=18,this._code="AltRight",this._key="Alt"):91===i?(this._code="MetaLeft",this._key="Meta"):93===i?(this._code="MetaRight",this._key="Meta"):37===i?this._code=this._key="ArrowLeft":38===i?this._code=this._key="ArrowUp":39===i?this._code=this._key="ArrowRight":40===i?this._code=this._key="ArrowDown":20093===i?(this._keyCode=93,this._code=this._key="ContextMenu"):20013===i?(this._keyCode=13,this._code="NumpadEnter",this._key="Enter"):107===i?(this._code="NumpadAdd",this._key="+"):109===i?(this._code="NumpadSubtract",this._key="-"):106===i?(this._code="NumpadMultiply",this._key="*"):111===i?(this._code="NumpadDivide",this._key="/"):12===i?(this._code="NumLock",this._key="Clear"):124===i?this._code=this._key="F13":36===i?this._code=this._key="Home":33===i?this._code=this._key="PageUp":34===i?this._code=this._key="PageDown":35===i?this._code=this._key="End":188===i?(this._code="Comma",this._key=this._shiftKeyActive?"<":","):190===i?(this._code="Period",this._key=this._shiftKeyActive?">":"."):191===i?(this._code="Slash",this._key=this._shiftKeyActive?"?":"/"):32===i?(this._code="Space",this._key=" "):46===i?this._code=this._key="Delete":110===i?(this._code="NumpadDecimal",this._key="."):20===i?(this._code=this._key="CapsLock","keyup"===t&&(s=!s)):console.log("Unknown keyCode: "+this._keyCode)}getModifierState(){return!1}get altKey(){return this._altKeyActive}get code(){return this._code}get ctrlKey(){return this._ctrlKeyActive}get isComposing(){return!1}get key(){return this._key}get keyCode(){return this._keyCode}get location(){return 0}get metaKey(){return this._metaKeyActive}get repeat(){return this._repeat}get shiftKey(){return this._shiftKeyActive}}},function(t,e,i){const n=i(0);t.exports=class extends n{constructor(t){super("devicemotion"),t?(this._acceleration=t.acceleration?t.acceleration:{x:0,y:0,z:0},this._accelerationIncludingGravity=t.accelerationIncludingGravity?t.accelerationIncludingGravity:{x:0,y:0,z:0},this._rotationRate=t.rotationRate?t.rotationRate:{alpha:0,beta:0,gamma:0},this._interval=t.interval):(this._acceleration={x:0,y:0,z:0},this._accelerationIncludingGravity={x:0,y:0,z:0},this._rotationRate={alpha:0,beta:0,gamma:0},this._interval=0)}get acceleration(){return this._acceleration}get accelerationIncludingGravity(){return this._accelerationIncludingGravity}get rotationRate(){return this._rotationRate}get interval(){return this._interval}}},function(t,e){const i={get length(){const{keys:t}=qg.getStorageInfoSync();return t.length},key(t){const{keys:e}=qg.getStorageInfoSync();return e[t]},getItem:t=>qg.getStorageSync({key:t}),setItem(t,e){qg.setStorageSync({key:t,value:e})},removeItem(t){qg.deleteStorageSync({key:t})},clear(){qg.clearStorageSync()}};t.exports=i}])},function(t,e,i){var n;!function(r){"use strict";function s(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function a(t,e,i,n,r,a){return s(function(t,e){return t<<e|t>>>32-e}(s(s(e,t),s(n,a)),r),i)}function o(t,e,i,n,r,s,o){return a(e&i|~e&n,t,e,r,s,o)}function h(t,e,i,n,r,s,o){return a(e&n|i&~n,t,e,r,s,o)}function l(t,e,i,n,r,s,o){return a(e^i^n,t,e,r,s,o)}function c(t,e,i,n,r,s,o){return a(i^(e|~n),t,e,r,s,o)}function u(t,e){var i,n,r,a,u;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var d=1732584193,_=-271733879,f=-1732584194,p=271733878;for(i=0;i<t.length;i+=16)_=c(_=c(_=c(_=c(_=l(_=l(_=l(_=l(_=h(_=h(_=h(_=h(_=o(_=o(_=o(_=o(r=_,f=o(a=f,p=o(u=p,d=o(n=d,_,f,p,t[i],7,-680876936),_,f,t[i+1],12,-389564586),d,_,t[i+2],17,606105819),p,d,t[i+3],22,-1044525330),f=o(f,p=o(p,d=o(d,_,f,p,t[i+4],7,-176418897),_,f,t[i+5],12,1200080426),d,_,t[i+6],17,-1473231341),p,d,t[i+7],22,-45705983),f=o(f,p=o(p,d=o(d,_,f,p,t[i+8],7,1770035416),_,f,t[i+9],12,-1958414417),d,_,t[i+10],17,-42063),p,d,t[i+11],22,-1990404162),f=o(f,p=o(p,d=o(d,_,f,p,t[i+12],7,1804603682),_,f,t[i+13],12,-40341101),d,_,t[i+14],17,-1502002290),p,d,t[i+15],22,1236535329),f=h(f,p=h(p,d=h(d,_,f,p,t[i+1],5,-165796510),_,f,t[i+6],9,-1069501632),d,_,t[i+11],14,643717713),p,d,t[i],20,-373897302),f=h(f,p=h(p,d=h(d,_,f,p,t[i+5],5,-701558691),_,f,t[i+10],9,38016083),d,_,t[i+15],14,-660478335),p,d,t[i+4],20,-405537848),f=h(f,p=h(p,d=h(d,_,f,p,t[i+9],5,568446438),_,f,t[i+14],9,-1019803690),d,_,t[i+3],14,-187363961),p,d,t[i+8],20,1163531501),f=h(f,p=h(p,d=h(d,_,f,p,t[i+13],5,-1444681467),_,f,t[i+2],9,-51403784),d,_,t[i+7],14,1735328473),p,d,t[i+12],20,-1926607734),f=l(f,p=l(p,d=l(d,_,f,p,t[i+5],4,-378558),_,f,t[i+8],11,-2022574463),d,_,t[i+11],16,1839030562),p,d,t[i+14],23,-35309556),f=l(f,p=l(p,d=l(d,_,f,p,t[i+1],4,-1530992060),_,f,t[i+4],11,1272893353),d,_,t[i+7],16,-155497632),p,d,t[i+10],23,-1094730640),f=l(f,p=l(p,d=l(d,_,f,p,t[i+13],4,681279174),_,f,t[i],11,-358537222),d,_,t[i+3],16,-722521979),p,d,t[i+6],23,76029189),f=l(f,p=l(p,d=l(d,_,f,p,t[i+9],4,-640364487),_,f,t[i+12],11,-421815835),d,_,t[i+15],16,530742520),p,d,t[i+2],23,-995338651),f=c(f,p=c(p,d=c(d,_,f,p,t[i],6,-198630844),_,f,t[i+7],10,1126891415),d,_,t[i+14],15,-1416354905),p,d,t[i+5],21,-57434055),f=c(f,p=c(p,d=c(d,_,f,p,t[i+12],6,1700485571),_,f,t[i+3],10,-1894986606),d,_,t[i+10],15,-1051523),p,d,t[i+1],21,-2054922799),f=c(f,p=c(p,d=c(d,_,f,p,t[i+8],6,1873313359),_,f,t[i+15],10,-30611744),d,_,t[i+6],15,-1560198380),p,d,t[i+13],21,1309151649),f=c(f,p=c(p,d=c(d,_,f,p,t[i+4],6,-145523070),_,f,t[i+11],10,-1120210379),d,_,t[i+2],15,718787259),p,d,t[i+9],21,-343485551),d=s(d,n),_=s(_,r),f=s(f,a),p=s(p,u);return[d,_,f,p]}function d(t){var e,i="",n=32*t.length;for(e=0;e<n;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function _(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var n=8*t.length;for(e=0;e<n;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function f(t){var e,i,n="0123456789abcdef",r="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),r+=n.charAt(e>>>4&15)+n.charAt(15&e);return r}function p(t){return unescape(encodeURIComponent(t))}function m(t){return function(t){return d(u(_(t),8*t.length))}(p(t))}function g(t,e){return function(t,e){var i,n,r=_(t),s=[],a=[];for(s[15]=a[15]=void 0,16<r.length&&(r=u(r,8*t.length)),i=0;i<16;i+=1)s[i]=909522486^r[i],a[i]=1549556828^r[i];return n=u(s.concat(_(e)),512+8*e.length),d(u(a.concat(n),640))}(p(t),p(e))}function v(t,e,i){return e?i?g(e,t):function(t,e){return f(g(t,e))}(e,t):i?m(t):function(t){return f(m(t))}(t)}void 0===(n=function(){return window.md5=v,v}.call(e,i,e,t))||(t.exports=n)}()},function(t,e,i){"use strict";(function(e){var i;(function(){var t=void 0,e=window;function i(i,n){var r,s=i.split("."),a=e;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(r=s.shift());)s.length||n===t?a=a[r]?a[r]:a[r]={}:a[r]=n}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function r(t){var e,i,r,s,a,o,h,l,c,u,d=t.length,_=0,f=Number.POSITIVE_INFINITY;for(l=0;l<d;++l)t[l]>_&&(_=t[l]),t[l]<f&&(f=t[l]);for(e=1<<_,i=new(n?Uint32Array:Array)(e),r=1,s=0,a=2;r<=_;){for(l=0;l<d;++l)if(t[l]===r){for(o=0,h=s,c=0;c<r;++c)o=o<<1|1&h,h>>=1;for(u=r<<16|l,c=o;c<e;c+=a)i[c]=u;++s}++r,s<<=1,a<<=1}return[i,_,f]}function s(t,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=n?new Uint8Array(t):t,this.m=!1,this.i=o,this.r=!1,!e&&(e={})||(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case a:this.b=32768,this.c=new(n?Uint8Array:Array)(32768+this.h+258);break;case o:this.b=0,this.c=new(n?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var a=0,o=1,h={t:a,s:o};s.prototype.k=function(){for(;!this.m;){var e=I(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var i=this.input,s=this.a,h=this.c,l=this.b,c=i.length,u=t,_=h.length,f=t;if(this.d=this.f=0,s+1>=c)throw Error("invalid uncompressed block header: LEN");if(u=i[s++]|i[s++]<<8,s+1>=c)throw Error("invalid uncompressed block header: NLEN");if(u===~(i[s++]|i[s++]<<8))throw Error("invalid uncompressed block header: length verify");if(s+u>i.length)throw Error("input buffer is broken");switch(this.i){case a:for(;l+u>h.length;){if(u-=f=_-l,n)h.set(i.subarray(s,s+f),l),l+=f,s+=f;else for(;f--;)h[l++]=i[s++];this.b=l,h=this.e(),l=this.b}break;case o:for(;l+u>h.length;)h=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(n)h.set(i.subarray(s,s+u),l),l+=u,s+=u;else for(;u--;)h[l++]=i[s++];this.a=s,this.b=l,this.c=h;break;case 1:this.j(T,M);break;case 2:var p,m,g,v,y=I(this,5)+257,x=I(this,5)+1,w=I(this,4)+4,b=new(n?Uint8Array:Array)(d.length),S=t,C=t,A=t,D=t,P=t;for(P=0;P<w;++P)b[d[P]]=I(this,3);if(!n)for(P=w,w=b.length;P<w;++P)b[d[P]]=0;for(p=r(b),S=new(n?Uint8Array:Array)(y+x),P=0,v=y+x;P<v;)switch(C=E(this,p),C){case 16:for(D=3+I(this,2);D--;)S[P++]=A;break;case 17:for(D=3+I(this,3);D--;)S[P++]=0;A=0;break;case 18:for(D=11+I(this,7);D--;)S[P++]=0;A=0;break;default:A=S[P++]=C}m=r(n?S.subarray(0,y):S.slice(0,y)),g=r(n?S.subarray(y):S.slice(y)),this.j(m,g);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var l,c,u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=n?new Uint16Array(u):u,_=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],f=n?new Uint16Array(_):_,p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],m=n?new Uint8Array(p):p,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],v=n?new Uint16Array(g):g,y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=n?new Uint8Array(y):y,w=new(n?Uint8Array:Array)(288);for(l=0,c=w.length;l<c;++l)w[l]=143>=l?8:255>=l?9:279>=l?7:8;var b,S,T=r(w),C=new(n?Uint8Array:Array)(30);for(b=0,S=C.length;b<S;++b)C[b]=5;var M=r(C);function I(t,e){for(var i,n=t.f,r=t.d,s=t.input,a=t.a,o=s.length;r<e;){if(a>=o)throw Error("input buffer is broken");n|=s[a++]<<r,r+=8}return i=n&(1<<e)-1,t.f=n>>>e,t.d=r-e,t.a=a,i}function E(t,e){for(var i,n,r=t.f,s=t.d,a=t.input,o=t.a,h=a.length,l=e[0],c=e[1];s<c&&!(o>=h);)r|=a[o++]<<s,s+=8;if((n=(i=l[r&(1<<c)-1])>>>16)>s)throw Error("invalid code length: "+n);return t.f=r>>n,t.d=s-n,t.a=o,65535&i}function A(t,e){var i,n;switch(this.input=t,this.a=0,!e&&(e={})||(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),i=t[this.a++],n=t[this.a++],15&i){case D:this.method=D;break;default:throw Error("unsupported compression method")}if(0!=((i<<8)+n)%31)throw Error("invalid fcheck flag:"+((i<<8)+n)%31);if(32&n)throw Error("fdict flag is not supported");this.q=new s(t,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}s.prototype.j=function(t,e){var i=this.c,n=this.b;this.o=t;for(var r,s,a,o,h=i.length-258;256!==(r=E(this,t));)if(256>r)n>=h&&(this.b=n,i=this.e(),n=this.b),i[n++]=r;else for(o=f[s=r-257],0<m[s]&&(o+=I(this,m[s])),r=E(this,e),a=v[r],0<x[r]&&(a+=I(this,x[r])),n>=h&&(this.b=n,i=this.e(),n=this.b);o--;)i[n]=i[n++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},s.prototype.w=function(t,e){var i=this.c,n=this.b;this.o=t;for(var r,s,a,o,h=i.length;256!==(r=E(this,t));)if(256>r)n>=h&&(h=(i=this.e()).length),i[n++]=r;else for(o=f[s=r-257],0<m[s]&&(o+=I(this,m[s])),r=E(this,e),a=v[r],0<x[r]&&(a+=I(this,x[r])),n+o>h&&(h=(i=this.e()).length);o--;)i[n]=i[n++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},s.prototype.e=function(){var t,e,i=new(n?Uint8Array:Array)(this.b-32768),r=this.b-32768,s=this.c;if(n)i.set(s.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=s[t+32768];if(this.g.push(i),this.l+=i.length,n)s.set(s.subarray(r,r+32768));else for(t=0;32768>t;++t)s[t]=s[r+t];return this.b=32768,s},s.prototype.z=function(t){var e,i,r,s=this.input.length/this.a+1|0,a=this.input,o=this.c;return t&&("number"==typeof t.p&&(s=t.p),"number"==typeof t.u&&(s+=t.u)),2>s?i=(r=(a.length-this.a)/this.o[2]/2*258|0)<o.length?o.length+r:o.length<<1:i=o.length*s,n?(e=new Uint8Array(i)).set(o):e=o,this.c=e},s.prototype.n=function(){var t,e,i,r,s,a=0,o=this.c,h=this.g,l=new(n?Uint8Array:Array)(this.l+(this.b-32768));if(0===h.length)return n?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(e=0,i=h.length;e<i;++e)for(r=0,s=(t=h[e]).length;r<s;++r)l[a++]=t[r];for(e=32768,i=this.b;e<i;++e)l[a++]=o[e];return this.g=[],this.buffer=l},s.prototype.v=function(){var t,e=this.b;return n?this.r?(t=new Uint8Array(e)).set(this.c.subarray(0,e)):t=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),t=this.c),this.buffer=t},A.prototype.k=function(){var t,e,i=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){e=(i[this.a++]<<24|i[this.a++]<<16|i[this.a++]<<8|i[this.a++])>>>0;var n=t;if("string"==typeof n){var r,s,a=n.split("");for(r=0,s=a.length;r<s;r++)a[r]=(255&a[r].charCodeAt(0))>>>0;n=a}for(var o,h=1,l=0,c=n.length,u=0;0<c;){c-=o=1024<c?1024:c;do{l+=h+=n[u++]}while(--o);h%=65521,l%=65521}if(e!==(l<<16|h)>>>0)throw Error("invalid adler-32 checksum")}return t};var D=8;i("Zlib.Inflate",A),i("Zlib.Inflate.prototype.decompress",A.prototype.k);var P,R,N,L,B={ADAPTIVE:h.s,BLOCK:h.t};if(Object.keys)P=Object.keys(B);else for(R in P=[],N=0,B)P[N++]=R;for(N=0,L=P.length;N<L;++N)i("Zlib.Inflate.BufferType."+(R=P[N]),B[R])}).call(this),function(){function t(t){throw t}var e,i=void 0,n=window;function r(t,e){var r,s=t.split("."),a=n;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(r=s.shift());)s.length||e===i?a=a[r]?a[r]:a[r]={}:a[r]=e}var s,a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;for(new(a?Uint8Array:Array)(256),s=0;256>s;++s)for(var o=(o=s)>>>1;o;o>>>=1)0;var h,l=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c=a?new Uint32Array(l):l;function u(t){var e,i,n,r,s,o,h,l,c,u,d=t.length,_=0,f=Number.POSITIVE_INFINITY;for(l=0;l<d;++l)t[l]>_&&(_=t[l]),t[l]<f&&(f=t[l]);for(e=1<<_,i=new(a?Uint32Array:Array)(e),n=1,r=0,s=2;n<=_;){for(l=0;l<d;++l)if(t[l]===n){for(o=0,h=r,c=0;c<n;++c)o=o<<1|1&h,h>>=1;for(u=n<<16|l,c=o;c<e;c+=s)i[c]=u;++r}++n,r<<=1,s<<=1}return[i,_,f]}n.Uint8Array!==i&&(String.fromCharCode.apply=(h=String.fromCharCode.apply,function(t,e){return h.call(String.fromCharCode,t,Array.prototype.slice.call(e))}));var d,_=[];for(d=0;288>d;d++)switch(!0){case 143>=d:_.push([d+48,8]);break;case 255>=d:_.push([d-144+400,9]);break;case 279>=d:_.push([d-256+0,7]);break;case 287>=d:_.push([d-280+192,8]);break;default:t("invalid literal: "+d)}var f=function(){function e(e){switch(!0){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var i,n,r=[];for(i=3;258>=i;i++)n=e(i),r[i]=n[2]<<24|n[1]<<16|n[0];return r}();function p(e,i){switch(this.l=[],this.m=32768,this.d=this.f=this.c=this.t=0,this.input=a?new Uint8Array(e):e,this.u=!1,this.n=g,this.K=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.m=i.bufferSize),i.bufferType&&(this.n=i.bufferType),i.resize&&(this.K=i.resize)),this.n){case m:this.a=32768,this.b=new(a?Uint8Array:Array)(32768+this.m+258);break;case g:this.a=0,this.b=new(a?Uint8Array:Array)(this.m),this.e=this.W,this.B=this.R,this.q=this.V;break;default:t(Error("invalid inflate mode"))}}a&&new Uint32Array(f);var m=0,g=1;p.prototype.r=function(){for(;!this.u;){var e=O(this,3);switch(1&e&&(this.u=!0),e>>>=1){case 0:var n=this.input,r=this.c,s=this.b,o=this.a,h=n.length,l=i,c=s.length,d=i;switch(this.d=this.f=0,r+1>=h&&t(Error("invalid uncompressed block header: LEN")),l=n[r++]|n[r++]<<8,r+1>=h&&t(Error("invalid uncompressed block header: NLEN")),l===~(n[r++]|n[r++]<<8)&&t(Error("invalid uncompressed block header: length verify")),r+l>n.length&&t(Error("input buffer is broken")),this.n){case m:for(;o+l>s.length;){if(l-=d=c-o,a)s.set(n.subarray(r,r+d),o),o+=d,r+=d;else for(;d--;)s[o++]=n[r++];this.a=o,s=this.e(),o=this.a}break;case g:for(;o+l>s.length;)s=this.e({H:2});break;default:t(Error("invalid inflate mode"))}if(a)s.set(n.subarray(r,r+l),o),o+=l,r+=l;else for(;l--;)s[o++]=n[r++];this.c=r,this.a=o,this.b=s;break;case 1:this.q(N,B);break;case 2:var _,f,p,v,y=O(this,5)+257,x=O(this,5)+1,b=O(this,4)+4,S=new(a?Uint8Array:Array)(w.length),T=i,C=i,M=i,I=i,E=i;for(E=0;E<b;++E)S[w[E]]=O(this,3);if(!a)for(E=b,b=S.length;E<b;++E)S[w[E]]=0;for(_=u(S),T=new(a?Uint8Array:Array)(y+x),E=0,v=y+x;E<v;)switch(C=F(this,_),C){case 16:for(I=3+O(this,2);I--;)T[E++]=M;break;case 17:for(I=3+O(this,3);I--;)T[E++]=0;M=0;break;case 18:for(I=11+O(this,7);I--;)T[E++]=0;M=0;break;default:M=T[E++]=C}f=u(a?T.subarray(0,y):T.slice(0,y)),p=u(a?T.subarray(y):T.slice(y)),this.q(f,p);break;default:t(Error("unknown BTYPE: "+e))}}return this.B()};var v,y,x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w=a?new Uint16Array(x):x,b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],S=a?new Uint16Array(b):b,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],C=a?new Uint8Array(T):T,M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],I=a?new Uint16Array(M):M,E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=a?new Uint8Array(E):E,D=new(a?Uint8Array:Array)(288);for(v=0,y=D.length;v<y;++v)D[v]=143>=v?8:255>=v?9:279>=v?7:8;var P,R,N=u(D),L=new(a?Uint8Array:Array)(30);for(P=0,R=L.length;P<R;++P)L[P]=5;var B=u(L);function O(e,i){for(var n,r=e.f,s=e.d,a=e.input,o=e.c,h=a.length;s<i;)o>=h&&t(Error("input buffer is broken")),r|=a[o++]<<s,s+=8;return n=r&(1<<i)-1,e.f=r>>>i,e.d=s-i,e.c=o,n}function F(e,i){for(var n,r,s=e.f,a=e.d,o=e.input,h=e.c,l=o.length,c=i[0],u=i[1];a<u&&!(h>=l);)s|=o[h++]<<a,a+=8;return(r=(n=c[s&(1<<u)-1])>>>16)>a&&t(Error("invalid code length: "+r)),e.f=s>>r,e.d=a-r,e.c=h,65535&n}function k(t){t=t||{},this.files=[],this.v=t.comment}function V(t,e){e=e||{},this.input=a&&t instanceof Array?new Uint8Array(t):t,this.c=0,this.ba=e.verify||!1,this.j=e.password}(e=p.prototype).q=function(t,e){var i=this.b,n=this.a;this.C=t;for(var r,s,a,o,h=i.length-258;256!==(r=F(this,t));)if(256>r)n>=h&&(this.a=n,i=this.e(),n=this.a),i[n++]=r;else for(o=S[s=r-257],0<C[s]&&(o+=O(this,C[s])),r=F(this,e),a=I[r],0<A[r]&&(a+=O(this,A[r])),n>=h&&(this.a=n,i=this.e(),n=this.a);o--;)i[n]=i[n++-a];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},e.V=function(t,e){var i=this.b,n=this.a;this.C=t;for(var r,s,a,o,h=i.length;256!==(r=F(this,t));)if(256>r)n>=h&&(h=(i=this.e()).length),i[n++]=r;else for(o=S[s=r-257],0<C[s]&&(o+=O(this,C[s])),r=F(this,e),a=I[r],0<A[r]&&(a+=O(this,A[r])),n+o>h&&(h=(i=this.e()).length);o--;)i[n]=i[n++-a];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},e.e=function(){var t,e,i=new(a?Uint8Array:Array)(this.a-32768),n=this.a-32768,r=this.b;if(a)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=r[t+32768];if(this.l.push(i),this.t+=i.length,a)r.set(r.subarray(n,n+32768));else for(t=0;32768>t;++t)r[t]=r[n+t];return this.a=32768,r},e.W=function(t){var e,i,n,r=this.input.length/this.c+1|0,s=this.input,o=this.b;return t&&("number"==typeof t.H&&(r=t.H),"number"==typeof t.P&&(r+=t.P)),2>r?i=(n=(s.length-this.c)/this.C[2]/2*258|0)<o.length?o.length+n:o.length<<1:i=o.length*r,a?(e=new Uint8Array(i)).set(o):e=o,this.b=e},e.B=function(){var t,e,i,n,r,s=0,o=this.b,h=this.l,l=new(a?Uint8Array:Array)(this.t+(this.a-32768));if(0===h.length)return a?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(e=0,i=h.length;e<i;++e)for(n=0,r=(t=h[e]).length;n<r;++n)l[s++]=t[n];for(e=32768,i=this.a;e<i;++e)l[s++]=o[e];return this.l=[],this.buffer=l},e.R=function(){var t,e=this.a;return a?this.K?(t=new Uint8Array(e)).set(this.b.subarray(0,e)):t=this.b.subarray(0,e):(this.b.length>e&&(this.b.length=e),t=this.b),this.buffer=t},k.prototype.L=function(t){this.j=t},k.prototype.s=function(t){var e=65535&t[2]|2;return e*(1^e)>>8&255},k.prototype.k=function(t,e){t[0]=(c[255&(t[0]^e)]^t[0]>>>8)>>>0,t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=(c[255&(t[2]^t[1]>>>24)]^t[2]>>>8)>>>0},k.prototype.T=function(t){var e,i,n=[305419896,591751049,878082192];for(a&&(n=new Uint32Array(n)),e=0,i=t.length;e<i;++e)this.k(n,255&t[e]);return n};var U=0,H=8,z=[80,75,1,2],W=[80,75,3,4],G=[80,75,5,6];function Y(t,e){this.input=t,this.offset=e}function X(t,e){this.input=t,this.offset=e}Y.prototype.parse=function(){var e=this.input,i=this.offset;(e[i++]!==z[0]||e[i++]!==z[1]||e[i++]!==z[2]||e[i++]!==z[3])&&t(Error("invalid file header signature")),this.version=e[i++],this.ia=e[i++],this.Z=e[i++]|e[i++]<<8,this.I=e[i++]|e[i++]<<8,this.A=e[i++]|e[i++]<<8,this.time=e[i++]|e[i++]<<8,this.U=e[i++]|e[i++]<<8,this.p=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.z=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.J=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.h=e[i++]|e[i++]<<8,this.g=e[i++]|e[i++]<<8,this.F=e[i++]|e[i++]<<8,this.ea=e[i++]|e[i++]<<8,this.ga=e[i++]|e[i++]<<8,this.fa=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,this.$=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,a?e.subarray(i,i+=this.h):e.slice(i,i+=this.h)),this.X=a?e.subarray(i,i+=this.g):e.slice(i,i+=this.g),this.v=a?e.subarray(i,i+this.F):e.slice(i,i+this.F),this.length=i-this.offset};var j=1;function K(e){var n,r,s,o,h=[],l={};if(!e.i){if(e.o===i){var c,u=e.input;if(!e.D)t:{var d,_=e.input;for(d=_.length-12;0<d;--d)if(_[d]===G[0]&&_[d+1]===G[1]&&_[d+2]===G[2]&&_[d+3]===G[3]){e.D=d;break t}t(Error("End of Central Directory Record not found"))}c=e.D,(u[c++]!==G[0]||u[c++]!==G[1]||u[c++]!==G[2]||u[c++]!==G[3])&&t(Error("invalid signature")),e.ha=u[c++]|u[c++]<<8,e.ja=u[c++]|u[c++]<<8,e.ka=u[c++]|u[c++]<<8,e.aa=u[c++]|u[c++]<<8,e.Q=(u[c++]|u[c++]<<8|u[c++]<<16|u[c++]<<24)>>>0,e.o=(u[c++]|u[c++]<<8|u[c++]<<16|u[c++]<<24)>>>0,e.w=u[c++]|u[c++]<<8,e.v=a?u.subarray(c,c+e.w):u.slice(c,c+e.w)}for(n=e.o,s=0,o=e.aa;s<o;++s)(r=new Y(e.input,n)).parse(),n+=r.length,h[s]=r,l[r.filename]=s;e.Q<n-e.o&&t(Error("invalid file header size")),e.i=h,e.G=l}}function q(t,e,i){return i^=t.s(e),t.k(e,i),i}X.prototype.parse=function(){var e=this.input,i=this.offset;(e[i++]!==W[0]||e[i++]!==W[1]||e[i++]!==W[2]||e[i++]!==W[3])&&t(Error("invalid local file header signature")),this.Z=e[i++]|e[i++]<<8,this.I=e[i++]|e[i++]<<8,this.A=e[i++]|e[i++]<<8,this.time=e[i++]|e[i++]<<8,this.U=e[i++]|e[i++]<<8,this.p=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.z=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.J=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,this.h=e[i++]|e[i++]<<8,this.g=e[i++]|e[i++]<<8,this.filename=String.fromCharCode.apply(null,a?e.subarray(i,i+=this.h):e.slice(i,i+=this.h)),this.X=a?e.subarray(i,i+=this.g):e.slice(i,i+=this.g),this.length=i-this.offset},(e=V.prototype).Y=function(){var t,e,i,n=[];for(this.i||K(this),t=0,e=(i=this.i).length;t<e;++t)n[t]=i[t].filename;return n},e.r=function(e,n){var r,s;this.G||K(this),(r=this.G[e])===i&&t(Error(e+" not found")),s=n||{};var o,h,l,u,d,_,f,m,g=this.input,v=this.i;if(v||K(this),v[r]===i&&t(Error("wrong index")),h=v[r].$,(o=new X(this.input,h)).parse(),h+=o.length,l=o.z,0!=(o.I&j)){for(!s.password&&!this.j&&t(Error("please set password")),_=this.S(s.password||this.j),f=h,m=h+12;f<m;++f)q(this,_,g[f]);for(f=h+=12,m=h+(l-=12);f<m;++f)g[f]=q(this,_,g[f])}switch(o.A){case U:u=a?this.input.subarray(h,h+l):this.input.slice(h,h+l);break;case H:u=new p(this.input,{index:h,bufferSize:o.J}).r();break;default:t(Error("unknown compression type"))}if(this.ba){var y,x=i,w="number"==typeof x?x:x=0,b=u.length;for(y=-1,w=7&b;w--;++x)y=y>>>8^c[255&(y^u[x])];for(w=b>>3;w--;x+=8)y=(y=(y=(y=(y=(y=(y=(y=y>>>8^c[255&(y^u[x])])>>>8^c[255&(y^u[x+1])])>>>8^c[255&(y^u[x+2])])>>>8^c[255&(y^u[x+3])])>>>8^c[255&(y^u[x+4])])>>>8^c[255&(y^u[x+5])])>>>8^c[255&(y^u[x+6])])>>>8^c[255&(y^u[x+7])];d=(4294967295^y)>>>0,o.p!==d&&t(Error("wrong crc: file=0x"+o.p.toString(16)+", data=0x"+d.toString(16)))}return u},e.L=function(t){this.j=t},e.k=k.prototype.k,e.S=k.prototype.T,e.s=k.prototype.s,r("Zlib.Unzip",V),r("Zlib.Unzip.prototype.decompress",V.prototype.r),r("Zlib.Unzip.prototype.getFilenames",V.prototype.Y),r("Zlib.Unzip.prototype.setPassword",V.prototype.L)}.call(this),i=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,i,n){n.r(i),n.d(i,"encode",(function(){return D})),n.d(i,"decode",(function(){return Y})),n.d(i,"decodeAsync",(function(){return $})),n.d(i,"decodeArrayStream",(function(){return tt})),n.d(i,"decodeStream",(function(){return et})),n.d(i,"Decoder",(function(){return W})),n.d(i,"Encoder",(function(){return E})),n.d(i,"ExtensionCodec",(function(){return T})),n.d(i,"ExtData",(function(){return f})),n.d(i,"EXT_TIMESTAMP",(function(){return g})),n.d(i,"encodeDateToTimeSpec",(function(){return y})),n.d(i,"encodeTimeSpecToTimestamp",(function(){return v})),n.d(i,"decodeTimestampToTimeSpec",(function(){return w})),n.d(i,"encodeTimestampExtension",(function(){return x})),n.d(i,"decodeTimestampExtension",(function(){return b}));var r=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return a},s=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t},a=void 0!==e&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function o(t){for(var e=t.length,i=0,n=0;n<e;){var r=t.charCodeAt(n++);if(0!=(4294967168&r))if(0==(4294965248&r))i+=2;else{if(r>=55296&&r<=56319&&n<e){var s=t.charCodeAt(n);56320==(64512&s)&&(++n,r=((1023&r)<<10)+(1023&s)+65536)}i+=0==(4294901760&r)?3:4}else i++}return i}var h=a?new TextEncoder:void 0,l=void 0!==e?200:0,c=(null==h?void 0:h.encodeInto)?function(t,e,i){h.encodeInto(t,e.subarray(i))}:function(t,e,i){e.set(h.encode(t),i)};function u(t,e,i){for(var n=e,r=n+i,a=[],o="";n<r;){var h=t[n++];if(0==(128&h))a.push(h);else if(192==(224&h)){var l=63&t[n++];a.push((31&h)<<6|l)}else if(224==(240&h)){l=63&t[n++];var c=63&t[n++];a.push((31&h)<<12|l<<6|c)}else if(240==(248&h)){var u=(7&h)<<18|(l=63&t[n++])<<12|(c=63&t[n++])<<6|63&t[n++];u>65535&&(u-=65536,a.push(u>>>10&1023|55296),u=56320|1023&u),a.push(u)}else a.push(h);a.length>=4096&&(o+=String.fromCharCode.apply(String,s(a)),a.length=0)}return a.length>0&&(o+=String.fromCharCode.apply(String,s(a))),o}var d=a?new TextDecoder:null,_=void 0!==e?200:0,f=function(t,e){this.type=t,this.data=e};function p(t,e,i){var n=Math.floor(i/4294967296),r=i;t.setUint32(e,n),t.setUint32(e+4,r)}function m(t,e){return 4294967296*t.getInt32(e)+t.getUint32(e+4)}var g=-1;function v(t){var e,i=t.sec,n=t.nsec;if(i>=0&&n>=0&&i<=17179869183){if(0===n&&i<=4294967295){var r=new Uint8Array(4);return(e=new DataView(r.buffer)).setUint32(0,i),r}var s=i/4294967296,a=4294967295&i;return r=new Uint8Array(8),(e=new DataView(r.buffer)).setUint32(0,n<<2|3&s),e.setUint32(4,a),r}return r=new Uint8Array(12),(e=new DataView(r.buffer)).setUint32(0,n),p(e,4,i),r}function y(t){var e=t.getTime(),i=Math.floor(e/1e3),n=1e6*(e-1e3*i),r=Math.floor(n/1e9);return{sec:i+r,nsec:n-1e9*r}}function x(t){return t instanceof Date?v(y(t)):null}function w(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:var i=e.getUint32(0);return{sec:4294967296*(3&i)+e.getUint32(4),nsec:i>>>2};case 12:return{sec:m(e,4),nsec:e.getUint32(0)};default:throw new Error("Unrecognized data size for timestamp: "+t.length)}}function b(t){var e=w(t);return new Date(1e3*e.sec+e.nsec/1e6)}var S={type:g,encode:x,decode:b},T=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(S)}return t.prototype.register=function(t){var e=t.type,i=t.encode,n=t.decode;if(e>=0)this.encoders[e]=i,this.decoders[e]=n;else{var r=1+e;this.builtInEncoders[r]=i,this.builtInDecoders[r]=n}},t.prototype.tryToEncode=function(t,e){for(var i=0;i<this.builtInEncoders.length;i++)if(null!=(n=this.builtInEncoders[i])&&null!=(r=n(t,e)))return new f(-1-i,r);for(i=0;i<this.encoders.length;i++){var n,r;if(null!=(n=this.encoders[i])&&null!=(r=n(t,e)))return new f(i,r)}return t instanceof f?t:null},t.prototype.decode=function(t,e,i){var n=e<0?this.builtInDecoders[-1-e]:this.decoders[e];return n?n(t,e,i):new f(e,t)},t.defaultCodec=new t,t}();function C(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}var M=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},I=null!=Uint8Array.prototype.slice||null!=Uint8Array.prototype.slice,E=function(){function t(t,e,i,n,r,s,a){void 0===t&&(t=T.defaultCodec),void 0===i&&(i=1e3),void 0===n&&(n=2048),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),this.extensionCodec=t,this.context=e,this.maxDepth=i,this.initialBufferSize=n,this.sortKeys=r,this.forceFloat32=s,this.ignoreUndefined=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.encode=function(t,e){if(e>this.maxDepth)throw new Error("Too deep objects in depth "+e);null==t?this.encodeNil():"boolean"==typeof t?this.encodeBoolean(t):"number"==typeof t?this.encodeNumber(t):"string"==typeof t?this.encodeString(t):this.encodeObject(t,e)},t.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},t.prototype.ensureBufferSizeToWrite=function(t){var e=this.pos+t;this.view.byteLength<e&&this.resizeBuffer(2*e)},t.prototype.resizeBuffer=function(t){var e=new ArrayBuffer(t),i=new Uint8Array(e),n=new DataView(e);i.set(this.bytes),this.view=n,this.bytes=i},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(t){!1===t?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(t){!Number.isSafeInteger||Number.isSafeInteger(t)?t>=0?t<128?this.writeU8(t):t<256?(this.writeU8(204),this.writeU8(t)):t<65536?(this.writeU8(205),this.writeU16(t)):t<4294967296?(this.writeU8(206),this.writeU32(t)):(this.writeU8(207),this.writeU64(t)):t>=-32?this.writeU8(224|t+32):t>=-128?(this.writeU8(208),this.writeI8(t)):t>=-32768?(this.writeU8(209),this.writeI16(t)):t>=-2147483648?(this.writeU8(210),this.writeI32(t)):(this.writeU8(211),this.writeI64(t)):this.forceFloat32?(this.writeU8(202),this.writeF32(t)):(this.writeU8(203),this.writeF64(t))},t.prototype.writeStringHeader=function(t){if(t<32)this.writeU8(160+t);else if(t<256)this.writeU8(217),this.writeU8(t);else if(t<65536)this.writeU8(218),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too long string: "+t+" bytes in UTF-8");this.writeU8(219),this.writeU32(t)}},t.prototype.encodeString=function(t){var e=t.length;if(a&&e>l){var i=o(t);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),c(t,this.bytes,this.pos),this.pos+=i}else i=o(t),this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),function(t,e,i){for(var n=t.length,r=i,s=0;s<n;){var a=t.charCodeAt(s++);if(0!=(4294967168&a)){if(0==(4294965248&a))e[r++]=a>>6&31|192;else{if(a>=55296&&a<=56319&&s<n){var o=t.charCodeAt(s);56320==(64512&o)&&(++s,a=((1023&a)<<10)+(1023&o)+65536)}0==(4294901760&a)?(e[r++]=a>>12&15|224,e[r++]=a>>6&63|128):(e[r++]=a>>18&7|240,e[r++]=a>>12&63|128,e[r++]=a>>6&63|128)}e[r++]=63&a|128}else e[r++]=a}}(t,this.bytes,this.pos),this.pos+=i},t.prototype.encodeObject=function(t,e){var i=this.extensionCodec.tryToEncode(t,this.context);if(null!=i)this.encodeExtension(i);else if(Array.isArray(t))this.encodeArray(t,e);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else{if("object"!=typeof t)throw new Error("Unrecognized object: "+Object.prototype.toString.apply(t));this.encodeMap(t,e)}},t.prototype.encodeBinary=function(t){var e=t.byteLength;if(e<256)this.writeU8(196),this.writeU8(e);else if(e<65536)this.writeU8(197),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large binary: "+e);this.writeU8(198),this.writeU32(e)}var i=C(t);this.writeU8a(i)},t.prototype.encodeArray=function(t,e){var i,n,r=t.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large array: "+r);this.writeU8(221),this.writeU32(r)}try{for(var s=M(t),a=s.next();!a.done;a=s.next()){var o=a.value;this.encode(o,e+1)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}},t.prototype.countWithoutUndefined=function(t,e){var i,n,r=0;try{for(var s=M(e),a=s.next();!a.done;a=s.next())void 0!==t[a.value]&&r++}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return r},t.prototype.encodeMap=function(t,e){var i,n,r=Object.keys(t);this.sortKeys&&r.sort();var s=this.ignoreUndefined?this.countWithoutUndefined(t,r):r.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else{if(!(s<4294967296))throw new Error("Too large map object: "+s);this.writeU8(223),this.writeU32(s)}try{for(var a=M(r),o=a.next();!o.done;o=a.next()){var h=o.value,l=t[h];this.ignoreUndefined&&void 0===l||(this.encodeString(h),this.encode(l,e+1))}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}},t.prototype.encodeExtension=function(t){var e=t.data.length;if(1===e)this.writeU8(212);else if(2===e)this.writeU8(213);else if(4===e)this.writeU8(214);else if(8===e)this.writeU8(215);else if(16===e)this.writeU8(216);else if(e<256)this.writeU8(199),this.writeU8(e);else if(e<65536)this.writeU8(200),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large extension object: "+e);this.writeU8(201),this.writeU32(e)}this.writeI8(t.type),this.writeU8a(t.data)},t.prototype.writeU8=function(t){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,t),this.pos++},t.prototype.writeU8a=function(t){var e=t.length;this.ensureBufferSizeToWrite(e),this.bytes.set(t,this.pos),this.pos+=e},t.prototype.writeI8=function(t){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,t),this.pos++},t.prototype.writeU16=function(t){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,t),this.pos+=2},t.prototype.writeI16=function(t){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,t),this.pos+=2},t.prototype.writeU32=function(t){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,t),this.pos+=4},t.prototype.writeI32=function(t){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,t),this.pos+=4},t.prototype.writeF32=function(t){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,t),this.pos+=4},t.prototype.writeF64=function(t){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,t),this.pos+=8},t.prototype.writeU64=function(t){this.ensureBufferSizeToWrite(8),function(t,e,i){var n=i/4294967296,r=i;t.setUint32(e,n),t.setUint32(e+4,r)}(this.view,this.pos,t),this.pos+=8},t.prototype.writeI64=function(t){this.ensureBufferSizeToWrite(8),p(this.view,this.pos,t),this.pos+=8},t}(),A={};function D(t,e){void 0===e&&(e=A);var i=new E(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined);return i.encode(t,1),i.getUint8Array()}function P(t){return(t<0?"-":"")+"0x"+Math.abs(t).toString(16).padStart(2,"0")}var R=function(){function t(t,e){void 0===t&&(t=16),void 0===e&&(e=16),this.maxKeyLength=t,this.maxLengthPerKey=e,this.caches=[];for(var i=0;i<this.maxKeyLength;i++)this.caches.push([])}return t.prototype.canBeCached=function(t){return t>0&&t<=this.maxKeyLength},t.prototype.get=function(t,e,i){var n=this.caches[i-1],r=n.length;t:for(var s=0;s<r;s++){for(var a=n[s],o=a.bytes,h=0;h<i;h++)if(o[h]!==t[e+h])continue t;return a.value}return null},t.prototype.store=function(t,e){var i=this.caches[t.length-1],n={bytes:t,value:e};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)},t.prototype.decode=function(t,e,i){var n=this.get(t,e,i);if(null!=n)return n;var r,s=u(t,e,i);return r=I?Uint8Array.prototype.slice.call(t,e,e+i):Uint8Array.prototype.subarray.call(t,e,e+i),this.store(r,s),s},t}(),N=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function a(t){try{h(n.next(t))}catch(t){s(t)}}function o(t){try{h(n.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}h((n=n.apply(t,e||[])).next())}))},L=function(t,e){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},B=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,r){!function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)}(n,r,(e=t[i](e)).done,e.value)}))}}},O=function(t){return this instanceof O?(this.v=t,this):new O(t)},F=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){r[t]&&(n[t]=function(e){return new Promise((function(i,n){s.push([t,e,i,n])>1||o(t,e)}))})}function o(t,e){try{(i=r[t](e)).value instanceof O?Promise.resolve(i.value.v).then(h,l):c(s[0][2],i)}catch(t){c(s[0][3],t)}var i}function h(t){o("next",t)}function l(t){o("throw",t)}function c(t,e){t(e),s.shift(),s.length&&o(s[0][0],s[0][1])}},k=new DataView(new ArrayBuffer(0)),V=new Uint8Array(k.buffer),U=function(){try{k.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")}(),H=new U("Insufficient data"),z=new R,W=function(){function t(t,e,i,n,r,s,a,o){void 0===t&&(t=T.defaultCodec),void 0===i&&(i=4294967295),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===s&&(s=4294967295),void 0===a&&(a=4294967295),void 0===o&&(o=z),this.extensionCodec=t,this.context=e,this.maxStrLength=i,this.maxBinLength=n,this.maxArrayLength=r,this.maxMapLength=s,this.maxExtLength=a,this.cachedKeyDecoder=o,this.totalPos=0,this.pos=0,this.view=k,this.bytes=V,this.headByte=-1,this.stack=[]}return t.prototype.setBuffer=function(t){this.bytes=C(t),this.view=function(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=C(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}(this.bytes),this.pos=0},t.prototype.appendBuffer=function(t){if(-1!==this.headByte||this.hasRemaining()){var e=this.bytes.subarray(this.pos),i=C(t),n=new Uint8Array(e.length+i.length);n.set(e),n.set(i,e.length),this.setBuffer(n)}else this.setBuffer(t)},t.prototype.hasRemaining=function(t){return void 0===t&&(t=1),this.view.byteLength-this.pos>=t},t.prototype.createNoExtraBytesError=function(t){var e=this.view,i=this.pos;return new RangeError("Extra "+(e.byteLength-i)+" byte(s) found at buffer["+t+"]")},t.prototype.decodeSingleSync=function(){var t=this.decodeSync();if(this.hasRemaining())throw this.createNoExtraBytesError(this.pos);return t},t.prototype.decodeSingleAsync=function(t){var e,i,n,r;return N(this,void 0,void 0,(function(){var s,a,o,h,l,c,u,d;return L(this,(function(_){switch(_.label){case 0:s=!1,_.label=1;case 1:_.trys.push([1,6,7,12]),e=B(t),_.label=2;case 2:return[4,e.next()];case 3:if((i=_.sent()).done)return[3,5];if(o=i.value,s)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(o);try{a=this.decodeSync(),s=!0}catch(t){if(!(t instanceof U))throw t}this.totalPos+=this.pos,_.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return h=_.sent(),n={error:h},[3,12];case 7:return _.trys.push([7,,10,11]),i&&!i.done&&(r=e.return)?[4,r.call(e)]:[3,9];case 8:_.sent(),_.label=9;case 9:return[3,11];case 10:if(n)throw n.error;return[7];case 11:return[7];case 12:if(s){if(this.hasRemaining())throw this.createNoExtraBytesError(this.totalPos);return[2,a]}throw c=(l=this).headByte,u=l.pos,d=l.totalPos,new RangeError("Insufficient data in parcing "+P(c)+" at "+d+" ("+u+" in the current buffer)")}}))}))},t.prototype.decodeArrayStream=function(t){return this.decodeMultiAsync(t,!0)},t.prototype.decodeStream=function(t){return this.decodeMultiAsync(t,!1)},t.prototype.decodeMultiAsync=function(t,e){return F(this,arguments,(function(){var i,n,r,s,a,o,h,l,c;return L(this,(function(u){switch(u.label){case 0:i=e,n=-1,u.label=1;case 1:u.trys.push([1,13,14,19]),r=B(t),u.label=2;case 2:return[4,O(r.next())];case 3:if((s=u.sent()).done)return[3,12];if(a=s.value,e&&0===n)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(a),i&&(n=this.readArraySize(),i=!1,this.complete()),u.label=4;case 4:u.trys.push([4,9,,10]),u.label=5;case 5:return[4,O(this.decodeSync())];case 6:return[4,u.sent()];case 7:return u.sent(),0==--n?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((o=u.sent())instanceof U))throw o;return[3,10];case 10:this.totalPos+=this.pos,u.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return h=u.sent(),l={error:h},[3,19];case 14:return u.trys.push([14,,17,18]),s&&!s.done&&(c=r.return)?[4,O(c.call(r))]:[3,16];case 15:u.sent(),u.label=16;case 16:return[3,18];case 17:if(l)throw l.error;return[7];case 18:return[7];case 19:return[2]}}))}))},t.prototype.decodeSync=function(){t:for(;;){var t=this.readHeadByte(),e=void 0;if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){if(0!=(n=t-128)){this.pushMapState(n),this.complete();continue t}e={}}else if(t<160){if(0!=(n=t-144)){this.pushArrayState(n),this.complete();continue t}e=[]}else{var i=t-160;e=this.decodeUtf8String(i,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.readI64();else if(217===t)i=this.lookU8(),e=this.decodeUtf8String(i,1);else if(218===t)i=this.lookU16(),e=this.decodeUtf8String(i,2);else if(219===t)i=this.lookU32(),e=this.decodeUtf8String(i,4);else if(220===t){if(0!==(n=this.readU16())){this.pushArrayState(n),this.complete();continue t}e=[]}else if(221===t){if(0!==(n=this.readU32())){this.pushArrayState(n),this.complete();continue t}e=[]}else if(222===t){if(0!==(n=this.readU16())){this.pushMapState(n),this.complete();continue t}e={}}else if(223===t){if(0!==(n=this.readU32())){this.pushMapState(n),this.complete();continue t}e={}}else if(196===t){var n=this.lookU8();e=this.decodeBinary(n,1)}else if(197===t)n=this.lookU16(),e=this.decodeBinary(n,2);else if(198===t)n=this.lookU32(),e=this.decodeBinary(n,4);else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t)n=this.lookU8(),e=this.decodeExtension(n,1);else if(200===t)n=this.lookU16(),e=this.decodeExtension(n,2);else{if(201!==t)throw new Error("Unrecognized type byte: "+P(t));n=this.lookU32(),e=this.decodeExtension(n,4)}this.complete();for(var r=this.stack;r.length>0;){var s=r[r.length-1];if(0===s.type){if(s.array[s.position]=e,s.position++,s.position!==s.size)continue t;r.pop(),e=s.array}else{if(1===s.type){if(a=void 0,"string"!=(a=typeof e)&&"number"!==a)throw new Error("The type of key must be string or number but "+typeof e);s.key=e,s.type=2;continue t}if(s.map[s.key]=e,s.readCount++,s.readCount!==s.size){s.key=null,s.type=1;continue t}r.pop(),e=s.map}}return e}var a},t.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=-1},t.prototype.readArraySize=function(){var t=this.readHeadByte();switch(t){case 220:return this.readU16();case 221:return this.readU32();default:if(t<160)return t-144;throw new Error("Unrecognized array type byte: "+P(t))}},t.prototype.pushMapState=function(t){if(t>this.maxMapLength)throw new Error("Max length exceeded: map length ("+t+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:t,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(t){if(t>this.maxArrayLength)throw new Error("Max length exceeded: array length ("+t+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:t,array:new Array(t),position:0})},t.prototype.decodeUtf8String=function(t,e){var i;if(t>this.maxStrLength)throw new Error("Max length exceeded: UTF-8 byte length ("+t+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+e+t)throw H;var n,r=this.pos+e;return n=this.stateIsMapKey()&&(null===(i=this.cachedKeyDecoder)||void 0===i?void 0:i.canBeCached(t))?this.cachedKeyDecoder.decode(this.bytes,r,t):a&&t>_?function(t,e,i){var n=t.subarray(e,e+i);return d.decode(n)}(this.bytes,r,t):u(this.bytes,r,t),this.pos+=e+t,n},t.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},t.prototype.decodeBinary=function(t,e){if(t>this.maxBinLength)throw new Error("Max length exceeded: bin length ("+t+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(t+e))throw H;var i=this.pos+e,n=this.bytes.subarray(i,i+t);return this.pos+=e+t,n},t.prototype.decodeExtension=function(t,e){if(t>this.maxExtLength)throw new Error("Max length exceeded: ext length ("+t+") > maxExtLength ("+this.maxExtLength+")");var i=this.view.getInt8(this.pos+e),n=this.decodeBinary(t,e+1);return this.extensionCodec.decode(n,i,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var t=this.view.getUint8(this.pos);return this.pos++,t},t.prototype.readI8=function(){var t=this.view.getInt8(this.pos);return this.pos++,t},t.prototype.readU16=function(){var t=this.view.getUint16(this.pos);return this.pos+=2,t},t.prototype.readI16=function(){var t=this.view.getInt16(this.pos);return this.pos+=2,t},t.prototype.readU32=function(){var t=this.view.getUint32(this.pos);return this.pos+=4,t},t.prototype.readI32=function(){var t=this.view.getInt32(this.pos);return this.pos+=4,t},t.prototype.readU64=function(){var t,e,i=(t=this.view,e=this.pos,4294967296*t.getUint32(e)+t.getUint32(e+4));return this.pos+=8,i},t.prototype.readI64=function(){var t=m(this.view,this.pos);return this.pos+=8,t},t.prototype.readF32=function(){var t=this.view.getFloat32(this.pos);return this.pos+=4,t},t.prototype.readF64=function(){var t=this.view.getFloat64(this.pos);return this.pos+=8,t},t}(),G={};function Y(t,e){void 0===e&&(e=G);var i=new W(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength);return i.setBuffer(t),i.decodeSingleSync()}var X=function(t,e){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},j=function(t){return this instanceof j?(this.v=t,this):new j(t)},K=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){r[t]&&(n[t]=function(e){return new Promise((function(i,n){s.push([t,e,i,n])>1||o(t,e)}))})}function o(t,e){try{(i=r[t](e)).value instanceof j?Promise.resolve(i.value.v).then(h,l):c(s[0][2],i)}catch(t){c(s[0][3],t)}var i}function h(t){o("next",t)}function l(t){o("throw",t)}function c(t,e){t(e),s.shift(),s.length&&o(s[0][0],s[0][1])}};function q(t){if(null==t)throw new Error("Assertion Failure: value must not be null nor undefined")}function Z(t){return null!=t[Symbol.asyncIterator]?t:function(t){return K(this,arguments,(function(){var e,i,n,r;return X(this,(function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,j(e.read())];case 3:return i=s.sent(),n=i.done,r=i.value,n?[4,j(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return q(r),[4,j(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}(t)}var Q=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function a(t){try{h(n.next(t))}catch(t){s(t)}}function o(t){try{h(n.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}h((n=n.apply(t,e||[])).next())}))},J=function(t,e){var i,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};function $(t,e){return void 0===e&&(e=G),Q(this,void 0,void 0,(function(){var i;return J(this,(function(n){return i=Z(t),[2,new W(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeSingleAsync(i)]}))}))}function tt(t,e){void 0===e&&(e=G);var i=Z(t);return new W(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeArrayStream(i)}function et(t,e){void 0===e&&(e=G);var i=Z(t);return new W(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeStream(i)}}])},window.msgpack=t.exports=i();var n=function(){function t(){}return t.prototype.bytesAvailable=function(){return this.length-this.cursor},t.prototype.getUint8=function(){return this.input[this.cursor++]},t.prototype.getUint16=function(){var t=this.view.getUint16(this.cursor,this.littleEndian);return this.cursor+=2,t},t.prototype.getUint32=function(){var t=this.view.getUint32(this.cursor,this.littleEndian);return this.cursor+=4,t},t.prototype.getUTF=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=String.fromCharCode(this.input[this.cursor++]);return e.join("")},t.prototype.getBytes=function(t){var e=new Uint8Array(this.input.buffer,this.input.byteOffset+this.cursor,t);return this.cursor+=t,e},t.prototype.skip=function(t){this.cursor+=t},t.prototype.open=function(t,e){void 0===e&&(e=!1),this.cursor=0,this.length=t.byteLength,this.input=t,this.view=new DataView(t.buffer),this.littleEndian=e},t.prototype.close=function(){this.input=null,this.view=null},t}(),r=function(){function t(t,e){this.message=t,this.scanLines=e}return t.prototype=new Error,t.prototype.name="DNLMarkerError",t.constructor=t,t}(),s=function(){function t(t){this.message=t}return t.prototype=new Error,t.prototype.name="EOIMarkerError",t.constructor=t,t}(),a=function(){var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function e(t){var e=void 0===t?{}:t,i=e.decodeTransform,n=void 0===i?null:i,r=e.colorTransform,s=void 0===r?-1:r;this._decodeTransform=n,this._colorTransform=s}function i(t,e){for(var i,n,r=0,s=[],a=16;a>0&&!t[a-1];)a--;s.push({children:[],index:0});var o,h=s[0];for(i=0;i<a;i++){for(n=0;n<t[i];n++){for((h=s.pop()).children[h.index]=e[r];h.index>0;)h=s.pop();for(h.index++,s.push(h);s.length<=i;)s.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o;r++}i+1<a&&(s.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o)}return s[0].children}function n(t,e,i){return 64*((t.blocksPerLine+1)*e+i)}function a(e,i,a,o,h,c,u,d,_,f){void 0===f&&(f=!1);var p=a.mcusPerLine,m=a.progressive,g=i,v=0,y=0;function x(){if(y>0)return y--,v>>y&1;if(255===(v=e[i++])){var t=e[i++];if(t){if(220===t&&f){i+=2;var n=e[i++]<<8|e[i++];if(n>0&&n!==a.scanLines)throw new r("Found DNL marker (0xFFDC) while parsing scan data",n)}else if(217===t)throw new s("Found EOI marker (0xFFD9) while parsing scan data");throw new Error("unexpected marker "+(v<<8|t).toString(16))}}return y=7,v>>>7}function w(t){for(var e=t;;){if("number"==typeof(e=e[x()]))return e;if("object"!=typeof e)throw new Error("invalid huffman sequence")}}function b(t){for(var e=0;t>0;)e=e<<1|x(),t--;return e}function S(t){if(1===t)return 1===x()?1:-1;var e=b(t);return e>=1<<t-1?e:e+(-1<<t)+1}var T=0;var C,M=0;function I(t,e,i,r,s){var a=i%p;e(t,n(t,(i/p|0)*t.v+r,a*t.h+s))}function E(t,e,i){e(t,n(t,i/t.blocksPerLine|0,i%t.blocksPerLine))}var A,D,P,R,N,L,B=o.length;L=m?0===c?0===d?function(t,e){var i=w(t.huffmanTableDC),n=0===i?0:S(i)<<_;t.blockData[e]=t.pred+=n}:function(t,e){t.blockData[e]|=x()<<_}:0===d?function(e,i){if(T>0)T--;else for(var n=c,r=u;n<=r;){var s=w(e.huffmanTableAC),a=15&s,o=s>>4;if(0!==a){var h=t[n+=o];e.blockData[i+h]=S(a)*(1<<_),n++}else{if(o<15){T=b(o)+(1<<o)-1;break}n+=16}}}:function(e,i){for(var n,r,s=c,a=u,o=0;s<=a;){var h=i+t[s],l=e.blockData[h]<0?-1:1;switch(M){case 0:if(o=(r=w(e.huffmanTableAC))>>4,0===(n=15&r))o<15?(T=b(o)+(1<<o),M=4):(o=16,M=1);else{if(1!==n)throw new Error("invalid ACn encoding");C=S(n),M=o?2:3}continue;case 1:case 2:e.blockData[h]?e.blockData[h]+=l*(x()<<_):0===--o&&(M=2===M?3:0);break;case 3:e.blockData[h]?e.blockData[h]+=l*(x()<<_):(e.blockData[h]=C<<_,M=0);break;case 4:e.blockData[h]&&(e.blockData[h]+=l*(x()<<_))}s++}4===M&&0===--T&&(M=0)}:function(e,i){var n=w(e.huffmanTableDC),r=0===n?0:S(n);e.blockData[i]=e.pred+=r;for(var s=1;s<64;){var a=w(e.huffmanTableAC),o=15&a,h=a>>4;if(0!==o){var l=t[s+=h];e.blockData[i+l]=S(o),s++}else{if(h<15)break;s+=16}}};var O,F,k,V,U=0;for(F=1===B?o[0].blocksPerLine*o[0].blocksPerColumn:p*a.mcusPerColumn;U<F;){var H=h?Math.min(F-U,h):F;for(D=0;D<B;D++)o[D].pred=0;if(T=0,1===B)for(A=o[0],N=0;N<H;N++)E(A,L,U),U++;else for(N=0;N<H;N++){for(D=0;D<B;D++)for(k=(A=o[D]).h,V=A.v,P=0;P<V;P++)for(R=0;R<k;R++)I(A,L,U,P,R);U++}y=0,(O=l(e,i))&&O.invalid&&(warn("decodeScan - unexpected MCU data, current marker is: "+O.invalid),i=O.offset);var z=O&&O.marker;if(!z||z<=65280)throw new Error("marker was not found");if(!(z>=65488&&z<=65495))break;i+=2}return(O=l(e,i))&&O.invalid&&(warn("decodeScan - unexpected Scan data, current marker is: "+O.invalid),i=O.offset),i-g}function o(t,e,i){var n,r,s,a,o,h,l,c,u,d,_,f,p,m,g,v,y,x=t.quantizationTable,w=t.blockData;if(!x)throw new Error("missing required Quantization Table.");for(var b=0;b<64;b+=8)u=w[e+b],d=w[e+b+1],_=w[e+b+2],f=w[e+b+3],p=w[e+b+4],m=w[e+b+5],g=w[e+b+6],v=w[e+b+7],u*=x[b],0!=(d|_|f|p|m|g|v)?(d*=x[b+1],_*=x[b+2],f*=x[b+3],p*=x[b+4],m*=x[b+5],r=(n=(n=5793*u+128>>8)+(r=5793*p+128>>8)+1>>1)-r,y=3784*(s=_)+1567*(a=g*=x[b+6])+128>>8,s=1567*s-3784*a+128>>8,l=(o=(o=2896*(d-(v*=x[b+7]))+128>>8)+(l=m<<4)+1>>1)-l,h=(c=(c=2896*(d+v)+128>>8)+(h=f<<4)+1>>1)-h,a=(n=n+(a=y)+1>>1)-a,s=(r=r+s+1>>1)-s,y=2276*o+3406*c+2048>>12,o=3406*o-2276*c+2048>>12,c=y,y=799*h+4017*l+2048>>12,h=4017*h-799*l+2048>>12,l=y,i[b]=n+c,i[b+7]=n-c,i[b+1]=r+l,i[b+6]=r-l,i[b+2]=s+h,i[b+5]=s-h,i[b+3]=a+o,i[b+4]=a-o):(y=5793*u+512>>10,i[b]=y,i[b+1]=y,i[b+2]=y,i[b+3]=y,i[b+4]=y,i[b+5]=y,i[b+6]=y,i[b+7]=y);for(var S=0;S<8;++S)u=i[S],0!=((d=i[S+8])|(_=i[S+16])|(f=i[S+24])|(p=i[S+32])|(m=i[S+40])|(g=i[S+48])|(v=i[S+56]))?(r=(n=4112+((n=5793*u+2048>>12)+(r=5793*p+2048>>12)+1>>1))-r,y=3784*(s=_)+1567*(a=g)+2048>>12,s=1567*s-3784*a+2048>>12,a=y,l=(o=(o=2896*(d-v)+2048>>12)+(l=m)+1>>1)-l,h=(c=(c=2896*(d+v)+2048>>12)+(h=f)+1>>1)-h,y=2276*o+3406*c+2048>>12,o=3406*o-2276*c+2048>>12,c=y,y=799*h+4017*l+2048>>12,h=4017*h-799*l+2048>>12,u=(u=(n=n+a+1>>1)+c)<16?0:u>=4080?255:u>>4,d=(d=(r=r+s+1>>1)+(l=y))<16?0:d>=4080?255:d>>4,_=(_=(s=r-s)+h)<16?0:_>=4080?255:_>>4,f=(f=(a=n-a)+o)<16?0:f>=4080?255:f>>4,p=(p=a-o)<16?0:p>=4080?255:p>>4,m=(m=s-h)<16?0:m>=4080?255:m>>4,g=(g=r-l)<16?0:g>=4080?255:g>>4,v=(v=n-c)<16?0:v>=4080?255:v>>4,w[e+S]=u,w[e+S+8]=d,w[e+S+16]=_,w[e+S+24]=f,w[e+S+32]=p,w[e+S+40]=m,w[e+S+48]=g,w[e+S+56]=v):(y=(y=5793*u+8192>>14)<-2040?0:y>=2024?255:y+2056>>4,w[e+S]=y,w[e+S+8]=y,w[e+S+16]=y,w[e+S+24]=y,w[e+S+32]=y,w[e+S+40]=y,w[e+S+48]=y,w[e+S+56]=y)}function h(t,e){for(var i=e.blocksPerLine,r=e.blocksPerColumn,s=new Int16Array(64),a=0;a<r;a++)for(var h=0;h<i;h++){o(e,n(e,a,h),s)}return e.blockData}function l(t,e,i){function n(e){return t[e]<<8|t[e+1]}void 0===i&&(i=e);var r=t.length-1,s=i<e?i:e;if(e>=r)return null;var a=n(e);if(a>=65472&&a<=65534)return{invalid:null,marker:a,offset:e};for(var o=n(s);!(o>=65472&&o<=65534);){if(++s>=r)return null;o=n(s)}return{invalid:a.toString(16),marker:o,offset:s}}return e.prototype={width:0,height:0,parse:function(e,n){var o=(void 0===n?{}:n).dnlScanLines,c=void 0===o?null:o;function u(){var t=e[m]<<8|e[m+1];return m+=2,t}function d(){var t=u(),i=m+t-2,n=l(e,i,m);n&&n.invalid&&(warn("readDataBlock - incorrect length, current marker is: "+n.invalid),i=n.offset);var r=e.subarray(m,i);return m+=r.length,r}function _(t){for(var e=Math.ceil(t.samplesPerLine/8/t.maxH),i=Math.ceil(t.scanLines/8/t.maxV),n=0;n<t.components.length;n++){Y=t.components[n];var r=Math.ceil(Math.ceil(t.samplesPerLine/8)*Y.h/t.maxH),s=Math.ceil(Math.ceil(t.scanLines/8)*Y.v/t.maxV),a=e*Y.h,o=64*(i*Y.v)*(a+1);Y.blockData=new Int16Array(o),Y.blocksPerLine=r,Y.blocksPerColumn=s}t.mcusPerLine=e,t.mcusPerColumn=i}var f,p,m=0,g=null,v=null,y=0,x=[],w=[],b=[],S=u();if(65496!==S)throw new Error("SOI not found");S=u();t:for(;65497!==S;){var T,C,M;switch(S){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var I=d();65504===S&&74===I[0]&&70===I[1]&&73===I[2]&&70===I[3]&&0===I[4]&&(g={version:{major:I[5],minor:I[6]},densityUnits:I[7],xDensity:I[8]<<8|I[9],yDensity:I[10]<<8|I[11],thumbWidth:I[12],thumbHeight:I[13],thumbData:I.subarray(14,14+3*I[12]*I[13])}),65518===S&&65===I[0]&&100===I[1]&&111===I[2]&&98===I[3]&&101===I[4]&&(v={version:I[5]<<8|I[6],flags0:I[7]<<8|I[8],flags1:I[9]<<8|I[10],transformCode:I[11]});break;case 65499:for(var E=u()+m-2;m<E;){var A=e[m++],D=new Uint16Array(64);if(A>>4==0)for(C=0;C<64;C++)D[t[C]]=e[m++];else{if(A>>4!=1)throw new Error("DQT - invalid table spec");for(C=0;C<64;C++)D[t[C]]=u()}x[15&A]=D}break;case 65472:case 65473:case 65474:if(f)throw new Error("Only single frame JPEGs supported");u(),(f={}).extended=65473===S,f.progressive=65474===S,f.precision=e[m++];var P=u();f.scanLines=c||P,f.samplesPerLine=u(),f.components=[],f.componentIds={};var R,N=e[m++],L=0,B=0;for(T=0;T<N;T++){R=e[m];var O=e[m+1]>>4,F=15&e[m+1];L<O&&(L=O),B<F&&(B=F);var k=e[m+2];M=f.components.push({h:O,v:F,quantizationId:k,quantizationTable:null}),f.componentIds[R]=M-1,m+=3}f.maxH=L,f.maxV=B,_(f);break;case 65476:var V=u();for(T=2;T<V;){var U=e[m++],H=new Uint8Array(16),z=0;for(C=0;C<16;C++,m++)z+=H[C]=e[m];var W=new Uint8Array(z);for(C=0;C<z;C++,m++)W[C]=e[m];T+=17+z,(U>>4==0?b:w)[15&U]=i(H,W)}break;case 65501:u(),p=u();break;case 65498:var G=1==++y&&!c;u();var Y,X=e[m++],j=[];for(T=0;T<X;T++){var K=f.componentIds[e[m++]];Y=f.components[K];var q=e[m++];Y.huffmanTableDC=b[q>>4],Y.huffmanTableAC=w[15&q],j.push(Y)}var Z=e[m++],Q=e[m++],J=e[m++];try{var $=a(e,m,f,j,p,Z,Q,J>>4,15&J,G);m+=$}catch(t){if(t instanceof r)return warn(t.message+" -- attempting to re-parse the JPEG image."),this.parse(e,{dnlScanLines:t.scanLines});if(t instanceof s){warn(t.message+" -- ignoring the rest of the image data.");break t}throw t}break;case 65500:m+=4;break;case 65535:255!==e[m]&&m--;break;default:if(255===e[m-3]&&e[m-2]>=192&&e[m-2]<=254){m-=3;break}var tt=l(e,m-2);if(tt&&tt.invalid){warn("JpegImage.parse - unexpected data, current marker is: "+tt.invalid),m=tt.offset;break}throw new Error("unknown marker "+S.toString(16))}S=u()}for(this.width=f.samplesPerLine,this.height=f.scanLines,this.jfif=g,this.adobe=v,this.components=[],T=0;T<f.components.length;T++){var et=x[(Y=f.components[T]).quantizationId];et&&(Y.quantizationTable=et),this.components.push({output:h(0,Y),scaleX:Y.h/f.maxH,scaleY:Y.v/f.maxV,blocksPerLine:Y.blocksPerLine,blocksPerColumn:Y.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(t,e,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=0),void 0===r&&(r=null);var s,a,o,h,l,c,u,d,_,f,p,m=this.width/t,g=this.height/e,v=0,y=this.components.length,x=t*e*y;3==y&&i&&(x=t*e*4);var w=new ArrayBuffer(x+n),b=new Uint8ClampedArray(w,n),S=new Uint32Array(t);if(3==y&&i){for(u=0;u<y;u++){for(a=(s=this.components[u]).scaleX*m,o=s.scaleY*g,v=u,p=s.output,h=s.blocksPerLine+1<<3,l=0;l<t;l++)d=0|l*a,S[l]=(4294967288&d)<<3|7&d;for(c=0;c<e;c++)for(f=h*(4294967288&(d=0|c*o))|(7&d)<<3,l=0;l<t;l++)b[v]=p[f+S[l]],v+=4}if(v=3,null!=r){var T=0;for(c=0;c<e;c++)for(l=0;l<t;l++)b[v]=r[T++],v+=4}else for(c=0;c<e;c++)for(l=0;l<t;l++)b[v]=255,v+=4}else for(u=0;u<y;u++){for(a=(s=this.components[u]).scaleX*m,o=s.scaleY*g,v=u,p=s.output,h=s.blocksPerLine+1<<3,l=0;l<t;l++)d=0|l*a,S[l]=(4294967288&d)<<3|7&d;for(c=0;c<e;c++)for(f=h*(4294967288&(d=0|c*o))|(7&d)<<3,l=0;l<t;l++)b[v]=p[f+S[l]],v+=y}var C=this._decodeTransform;if(4!==y||C||(C=new Int32Array([-256,255,-256,255,-256,255,-256,255])),C)if(3==y&&i)for(u=0;u<x;){for(d=0,_=0;d<y;d++,u++,_+=2)b[u]=(b[u]*C[_]>>8)+C[_+1];u++}else for(u=0;u<x;)for(d=0,_=0;d<y;d++,u++,_+=2)b[u]=(b[u]*C[_]>>8)+C[_+1];return b},get _isColorConversionNeeded(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0!==this._colorTransform:1===this._colorTransform},_convertYccToRgb:function(t,e){var i,n,r,s,a;if(void 0===e&&(e=!1),e)for(s=0,a=t.length;s<a;s+=3)i=t[s],n=t[s+1],r=t[s+2],t[s]=i-179.456+1.402*r,t[s+1]=i+135.459-.344*n-.714*r,t[s+2]=i-226.816+1.772*n,s++;else for(s=0,a=t.length;s<a;s+=3)i=t[s],n=t[s+1],r=t[s+2],t[s]=i-179.456+1.402*r,t[s+1]=i+135.459-.344*n-.714*r,t[s+2]=i-226.816+1.772*n;return t},_convertYcckToRgb:function(t){for(var e,i,n,r,s=0,a=0,o=t.length;a<o;a+=4)e=t[a],i=t[a+1],n=t[a+2],r=t[a+3],t[s++]=i*(-660635669420364e-19*i+.000437130475926232*n-54080610064599e-18*e+.00048449797120281*r-.154362151871126)-122.67195406894+n*(-.000957964378445773*n+.000817076911346625*e-.00477271405408747*r+1.53380253221734)+e*(.000961250184130688*e-.00266257332283933*r+.48357088451265)+r*(-.000336197177618394*r+.484791561490776),t[s++]=107.268039397724+i*(219927104525741e-19*i-.000640992018297945*n+.000659397001245577*e+.000426105652938837*r-.176491792462875)+n*(-.000778269941513683*n+.00130872261408275*e+.000770482631801132*r-.151051492775562)+e*(.00126935368114843*e-.00265090189010898*r+.25802910206845)+r*(-.000318913117588328*r-.213742400323665),t[s++]=i*(-.000570115196973677*i-263409051004589e-19*n+.0020741088115012*e-.00288260236853442*r+.814272968359295)-20.810012546947+n*(-153496057440975e-19*n-.000132689043961446*e+.000560833691242812*r-.195152027534049)+e*(.00174418132927582*e-.00255243321439347*r+.116935020465145)+r*(-.000343531996510555*r+.24165260232407);return t.subarray(0,s)},_convertYcckToCmyk:function(t){for(var e,i,n,r=0,s=t.length;r<s;r+=4)e=t[r],i=t[r+1],n=t[r+2],t[r]=434.456-e-1.402*n,t[r+1]=119.541-e+.344*i+.714*n,t[r+2]=481.816-e-1.772*i;return t},_convertCmykToRgb:function(t){for(var e,i,n,r,s=0,a=0,o=t.length;a<o;a+=4)e=t[a]*(1/255),i=t[a+1]*(1/255),n=t[a+2]*(1/255),r=t[a+3]*(1/255),t[s++]=255+e*(-4.387332384609988*e+54.48615194189176*i+18.82290502165302*n+212.25662451639585*r-285.2331026137004)+i*(1.7149763477362134*i-5.6096736904047315*n-17.873870861415444*r-5.497006427196366)+n*(-2.5217340131683033*n-21.248923337353073*r+17.5119270841813)-r*(21.86122147463605*r+189.48180835922747),t[s++]=255+e*(8.841041422036149*e+60.118027045597366*i+6.871425592049007*n+31.159100130055922*r-79.2970844816548)+i*(-15.310361306967817*i+17.575251261109482*n+131.35250912493976*r-190.9453302588951)+n*(4.444339102852739*n+9.8632861493405*r-24.86741582555878)-r*(20.737325471181034*r+187.80453709719578),t[s++]=255+e*(.8842522430003296*e+8.078677503112928*i+30.89978309703729*n-.23883238689178934*r-14.183576799673286)+i*(10.49593273432072*i+63.02378494754052*n+50.606957656360734*r-112.23884253719248)+n*(.03296041114873217*n+115.60384449646641*r-193.58209356861505)-r*(22.33816807309886*r+180.12613974708367);return t.subarray(0,s)},getData:function(t,e,i,n,r,s){if(void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=null),this.numComponents>4)throw new Error("Unsupported color mode");var a=this._getLinearizedBlockData(t,e,n,r,s);if(1===this.numComponents&&i){for(var o=a.length,h=new Uint8ClampedArray(3*o),l=0,c=0;c<o;c++){var u=a[c];h[l++]=u,h[l++]=u,h[l++]=u}return h}if(3===this.numComponents&&this._isColorConversionNeeded)return this._convertYccToRgb(a,n);if(4===this.numComponents){if(this._isColorConversionNeeded)return i?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(i)return this._convertCmykToRgb(a)}return a}},e}(),o=function(){function t(){this.segments=[]}return t.create=function(){var e;return null!=t.p_sJob?(e=this.p_sJob,this.p_sJob=this.p_sJob.p_next):e=new t,e},t.free=function(e){e.p_next=this.p_sJob,t.p_sJob=e,e.paleT=null,e.segments.length=0,e.transT=null},t}(),h=function(){function t(){}return t.init=function(){t.p_setHands={IHDR:t.p_IHDR,PLTE:t.p_PLTE,IDAT:t.p_IDAT,tRNS:t.p_TRNS}},t.decode=function(e){var i=o.create(),r=new n;for(r.open(e),r.skip(8);r.bytesAvailable()>0;){var s=r.getUint32(),a=r.getUTF(4),h=t.p_setHands[a];null!=h?h(i,r,s):r.skip(s);r.getUint32()}r.close();var l=t.p_decodePix(i);if(null==l)return null;var c=0,u=0,d=i.w,_=i.h,f=new ArrayBuffer(d*_*t.p_Pix(i)+8),p=new Uint8Array(f,8),m=new DataView(f,0,8);switch(m.setUint32(0,d),m.setUint32(4,_),i.colorT){case 3:t.p_byPale(i,l,p);break;case 2:switch(i.bits){case 8:for(var g=0;g<_;++g){u++;for(var v=0;v<d;++v)p[c++]=l[u++],p[c++]=l[u++],p[c++]=l[u++]}break;case 16:for(g=0;g<_;++g){u++;for(v=0;v<d;++v)p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2,p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2,p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2}}break;case 6:switch(i.bits){case 8:for(g=0;g<_;++g){u++;for(v=0;v<d;++v)p[c++]=l[u++],p[c++]=l[u++],p[c++]=l[u++],p[c++]=l[u++]}break;case 16:for(g=0;g<_;++g){u++;for(v=0;v<d;++v)p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2,p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2,p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2,p[c++]=(l[u]<<8|l[u+1])/65535*255,u+=2}}break;default:console.error("未支持的类型：",i.colorT,i.bits)}return o.free(i),f},t.p_IHDR=function(t,e,i){t.w=e.getUint32(),t.h=e.getUint32(),t.bits=e.getUint8(),t.colorT=e.getUint8(),t.compressT=e.getUint8(),t.filterT=e.getUint8(),t.interT=e.getUint8()},t.p_PLTE=function(t,e,i){t.paleT=e.getBytes(i)},t.p_IDAT=function(t,e,i){t.segments.push(e.getBytes(i))},t.p_TRNS=function(t,e,i){t.transT=e.getBytes(i)},t.p_Pale=function(t){for(var e=t.paleT,i=t.transT,n=e.length,r=new Uint8Array(n/3*4),s=0,a=0,o=i.byteLength,h=0;s<n;)r[a++]=e[s++],r[a++]=e[s++],r[a++]=e[s++],r[a++]=h<o?i[h++]:255;return r},t.p_mergeSeg=function(t){for(var e=0,i=0,n=t;i<n.length;i++){e+=(h=n[i]).byteLength}for(var r=new Uint8Array(e),s=0,a=0,o=t;a<o.length;a++){var h=o[a];r.set(h,s),s+=h.length}return new Zlib.Inflate(r).decompress()},t.p_Pix=function(t){var e=3;return 4&t.colorT&&(e=4),3==t.colorT&&t.transT&&(e=4),e},t.p_Bytes=function(t){var e=1;switch(t.colorT){case 2:e=3;break;case 4:e=2;break;case 6:e=4}return e*t.bits+7>>3},t.p_decodePix=function(t){return 0==t.interT?this.p_decodeInterT(t):null},t.p_decodeInterT=function(e){for(var i=t.p_mergeSeg(e.segments),n=i.byteLength,r=e.h,s=t.p_Bytes(e),a=Math.floor((n-r)/r),o=a+1,h=0,l=0,c=0,u=0,d=0,_=0,f=0,p=0,m=0,g=0;l<n;)switch(i[l++]){case 0:l+=a;break;case 1:for(l+=s,h=s;h<a;++h,++l)i[l]=(i[l]+i[l-s])%256;break;case 2:if(1!=l)for(h=0;h<a;++h,++l)i[l]=(i[l]+i[l-o])%256;break;case 3:if(1==l)for(l+=s,h=s;h<a;++h,++l)i[l]=(i[l]+(i[l-s]>>1))%256;else{for(h=0;h<s;++h,++l)i[l]=(i[l]+(i[l-o]>>1))%256;for(h=s;h<a;++h,++l)i[l]=(i[l]+(i[l-s]+i[l-o]>>1))%256}break;case 4:if(1==s)if(1==l)for(c=i[l++],h=1;h<a;++h,++l)g=c>0?c:0,c=i[l]=(i[l]+g)%256;else for((f=_=u=i[l-o])<0&&(f=-f),(m=_)<0&&(m=-m),g=_<=0?0:0<=m?u:0,c=i[l]=i[l]+g,l++,h=1;h<a;++h,++l)(f=(_=c+(u=i[l-o])-(d=i[l-o-1]))-c)<0&&(f=-f),(p=_-u)<0&&(p=-p),(m=_-d)<0&&(m=-m),g=f<=p&&f<=m?c:p<=m?u:d,c=i[l]=(i[l]+g)%256;else if(1==l)for(l+=s,u=d=0,h=s;h<a;++h,++l)(f=(_=(c=i[l-s])+u-d)-c)<0&&(f=-f),(p=_-u)<0&&(p=-p),(m=_-d)<0&&(m=-m),g=f<=p&&f<=m?c:p<=m?u:d,i[l]=(i[l]+g)%256;else{for(h=0;h<s;++h,++l)(f=(_=(c=0)+(u=i[l-o])-(d=0))-c)<0&&(f=-f),(p=_-u)<0&&(p=-p),(m=_-d)<0&&(m=-m),g=f<=p&&f<=m?c:p<=m?u:d,i[l]=(i[l]+g)%256;for(h=s;h<a;++h,++l)(f=(_=(c=i[l-s])+(u=i[l-o])-(d=i[l-o-s]))-c)<0&&(f=-f),(p=_-u)<0&&(p=-p),(m=_-d)<0&&(m=-m),g=f<=p&&f<=m?c:p<=m?u:d,i[l]=(i[l]+g)%256}break;default:console.log("解析出错："+e.w+", "+e.h+", "+s),console.log(i.byteLength)}return i},t.p_byPale=function(e,i,n){var r=0,s=0,a=e.w,o=e.h,h=e.paleT;if(null!=e.transT)switch(h=t.p_Pale(e),e.bits){case 1:for(var l=0;l<o;++l){s++;for(var c=0;c<a;++c){var u=4*(1&i[s+(c>>3)]);n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2],n[r++]=h[u+3]}s+=a+7>>3}break;case 2:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=4*(3&i[s+(c>>2)]);n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2],n[r++]=h[u+3]}s+=a+3>>2}break;case 4:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=4*(15&i[s+(c>>1)]);n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2],n[r++]=h[u+3]}s+=a+1>>1}break;case 8:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=4*i[s++];n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2],n[r++]=h[u+3]}}}else switch(e.bits){case 1:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=3*(1&i[s+(c>>3)]);n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2]}s+=a+7>>3}break;case 2:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=3*(3&i[s+(c>>2)]);n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2]}s+=a+3>>2}break;case 4:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=3*(15&i[s+(c>>1)]);n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2]}s+=a+1>>1}break;case 8:for(l=0;l<o;++l){s++;for(c=0;c<a;++c){u=3*i[s++];n[r++]=h[u],n[r++]=h[u+1],n[r++]=h[u+2]}}}},t.p_setHands={},t}();window.DecodeTools=function(){function t(){}return t.init=function(){h.init()},t.decodeBuff=function(t,e){var i;if(e)i=new Zlib.Inflate(new Uint8Array(t)).decompress();else{i=new Zlib.Unzip(new Uint8Array(t)).decompress("res")}return i.buffer.slice(i.byteOffset,i.byteLength)},t.decodeImage=function(e,i){if(void 0===i&&(i=null),this.isPng(e))return h.decode(e);var n=new a;n.parse(e);var r=n.width,s=n.height,o=t.p_needAlpha(r,s)||null!=i,l=n.getData(r,s,!0,o,8,i),c=new DataView(l.buffer);return c.setUint32(0,r),c.setUint32(4,s),l.buffer},t.p_needAlpha=function(t,e){return t%2!=0||e%2!=0||(290==t&&340==e||(586==t&&530==e||(602==t&&302==e||638==t&&466==e)))},t.isPng=function(e){for(var i=t.PngHeader,n=0;n<8;++n)if(e[n]!=i[n])return!1;return!0},t.PngHeader=new Uint8Array([137,80,78,71,13,10,26,10]),t}();window.Number.isSafeInteger=Number.isSafeInteger||function(t){return"number"==typeof t&&(Math.round(t)===t||-9007199254740991===t||9007199254740991===t)&&-9007199254740991<=t&&t<=9007199254740991};for(var l=function(t,e,i){if(e=e||0,i=i||this.length,e<0&&(e=this.length+e),i<0&&(i=this.length+i),!(e>=this.length)){for(i>this.length&&(i=this.length);e<i;)this[e++]=t;return this}},c=0,u=[Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray,Int8Array,Int16Array,Int32Array,Float32Array,Float64Array];c<u.length;c++){var d=u[c];d.prototype.fill||(d.prototype.fill=l)}}).call(this,i(4))},function(t,e){var i,n,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var h,l=[],c=!1,u=-1;function d(){c&&h&&(c=!1,h.length?l=h.concat(l):u=-1,l.length&&_())}function _(){if(!c){var t=o(d);c=!0;for(var e=l.length;e;){for(h=l,l=[];++u<e;)h&&h[u].run();u=-1,e=l.length}h=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new f(t,e)),1!==l.length||c||o(_)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){function n(t){this.options=t||{locator:{}}}function r(){this.cdata=!1}function s(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function a(t){return t?"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]":void 0}function o(t,e,i){return"string"==typeof t?t.substr(e,i):t.length>=e+i||e?new java.lang.String(t,e,i)+"":t}function h(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}n.prototype.parseFromString=function(t,e){var i=this.options,n=new l,s=i.domBuilder||new r,o=i.errorHandler,h=i.locator,c=i.xmlns||{},u={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return h&&s.setDocumentLocator(h),n.errorHandler=function(t,e,i){function n(e){var n=t[e];!n&&o&&(n=2==t.length?function(i){t(e,i)}:t),s[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+a(i))}||function(){}}if(!t){if(e instanceof r)return e;t=e}var s={},o=t instanceof Function;return i=i||{},n("warning"),n("error"),n("fatalError"),s}(o,s,h),n.domBuilder=i.domBuilder||s,/\/x?html?$/.test(e)&&(u.nbsp=" ",u.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",t?n.parse(t,c,u):n.errorHandler.error("invalid doc source"),s.doc},r.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,i,n){var r=this.doc,a=r.createElementNS(t,i||e),o=n.length;h(this,a),this.currentElement=a,this.locator&&s(this.locator,a);for(var l=0;o>l;l++){t=n.getURI(l);var c=n.getValue(l),u=(i=n.getQName(l),r.createAttributeNS(t,i));this.locator&&s(n.getLocator(l),u),u.value=u.nodeValue=c,a.setAttributeNode(u)}},endElement:function(){var t=this.currentElement;t.tagName,this.currentElement=t.parentNode},startPrefixMapping:function(){},endPrefixMapping:function(){},processingInstruction:function(t,e){var i=this.doc.createProcessingInstruction(t,e);this.locator&&s(this.locator,i),h(this,i)},ignorableWhitespace:function(){},characters:function(t){if(t=o.apply(this,arguments)){if(this.cdata)var e=this.doc.createCDATASection(t);else e=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(e):/^\s*$/.test(t)&&this.doc.appendChild(e),this.locator&&s(this.locator,e)}},skippedEntity:function(){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t){t=o.apply(this,arguments);var e=this.doc.createComment(t);this.locator&&s(this.locator,e),h(this,e)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,i){var n=this.doc.implementation;if(n&&n.createDocumentType){var r=n.createDocumentType(t,e,i);this.locator&&s(this.locator,r),h(this,r)}},warning:function(t){console.warn("[xmldom warning]\t"+t,a(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,a(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]\t"+t,a(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(t){r.prototype[t]=function(){return null}}));var l=i(6).XMLReader,c=e.DOMImplementation=i(7).DOMImplementation;e.XMLSerializer=i(7).XMLSerializer,e.DOMParser=n},function(t,e){function i(){}function n(t,e,i,n,l){function _(t){var e=t.slice(1,-1);return e in i?i[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),i=56320+(1023&t);return String.fromCharCode(e,i)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(l.error("entity not found:"+t),t)}function f(e){if(e>b){var i=t.substring(b,e).replace(/&#?\w+;/g,_);y&&p(b),n.characters(i,0,e-b),b=e}}function p(e,i){for(;e>=g&&(i=v.exec(t));)m=i.index,g=m+i[0].length,y.lineNumber++;y.columnNumber=e-m+1}for(var m=0,g=0,v=/.*(?:\r\n?|\n)|.*$/g,y=n.locator,x=[{currentNSMap:e}],w={},b=0;;){try{var S=t.indexOf("<",b);if(0>S){if(!t.substr(b).match(/^\s*$/)){var T=n.doc,C=T.createTextNode(t.substr(b));T.appendChild(C),n.currentElement=C}return}switch(S>b&&f(S),t.charAt(S+1)){case"/":var M=t.indexOf(">",S+3),I=t.substring(S+2,M),E=x.pop();0>M?(I=t.substring(S+2).replace(/[\s<].*/,""),l.error("end tag name: "+I+" is not complete:"+E.tagName),M=S+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),l.error("end tag name: "+I+" maybe not complete"),M=S+1+I.length);var A=E.localNSMap,D=E.tagName==I;if(D||E.tagName&&E.tagName.toLowerCase()==I.toLowerCase()){if(n.endElement(E.uri,E.localName,I),A)for(var P in A)n.endPrefixMapping(P);D||l.fatalError("end tag name: "+I+" is not match the current start tagName:"+E.tagName)}else x.push(E);M++;break;case"?":y&&p(S),M=u(t,S,n);break;case"!":y&&p(S),M=c(t,S,n,l);break;default:y&&p(S);var R=new d,N=x[x.length-1].currentNSMap,L=(M=s(t,S,R,N,_,l),R.length);if(!R.closed&&h(t,M,R.tagName,w)&&(R.closed=!0,i.nbsp||l.warning("unclosed xml attribute")),y&&L){for(var B=r(y,{}),O=0;L>O;O++){var F=R[O];p(F.offset),F.locator=r(y,{})}n.locator=B,a(R,n,N)&&x.push(R),n.locator=y}else a(R,n,N)&&x.push(R);"http://www.w3.org/1999/xhtml"!==R.uri||R.closed?M++:M=o(t,M,R.tagName,_,n)}}catch(t){l.error("element parse error: "+t),M=-1}M>b?b=M:f(Math.max(S,b)+1)}}function r(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function s(t,e,i,n,r,s){for(var a,o=++e,h=g;;){var l=t.charAt(o);switch(l){case"=":if(h===v)a=t.slice(e,o),h=x;else{if(h!==y)throw new Error("attribute equal must after attrName");h=x}break;case"'":case'"':if(h===x||h===v){if(h===v&&(s.warning('attribute value must after "="'),a=t.slice(e,o)),e=o+1,!((o=t.indexOf(l,e))>0))throw new Error("attribute value no end '"+l+"' match");c=t.slice(e,o).replace(/&#?\w+;/g,r),i.add(a,c,e-1),h=b}else{if(h!=w)throw new Error('attribute value must after "="');c=t.slice(e,o).replace(/&#?\w+;/g,r),i.add(a,c,e),s.warning('attribute "'+a+'" missed start quot('+l+")!!"),e=o+1,h=b}break;case"/":switch(h){case g:i.setTagName(t.slice(e,o));case b:case S:case T:h=T,i.closed=!0;case w:case v:case y:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),h==g&&i.setTagName(t.slice(e,o)),o;case">":switch(h){case g:i.setTagName(t.slice(e,o));case b:case S:case T:break;case w:case v:"/"===(c=t.slice(e,o)).slice(-1)&&(i.closed=!0,c=c.slice(0,-1));case y:h===y&&(c=a),h==w?(s.warning('attribute "'+c+'" missed quot(")!!'),i.add(a,c.replace(/&#?\w+;/g,r),e)):("http://www.w3.org/1999/xhtml"===n[""]&&c.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),i.add(c,c,e));break;case x:throw new Error("attribute value missed!!")}return o;case"":l=" ";default:if(" ">=l)switch(h){case g:i.setTagName(t.slice(e,o)),h=S;break;case v:a=t.slice(e,o),h=y;break;case w:var c=t.slice(e,o).replace(/&#?\w+;/g,r);s.warning('attribute "'+c+'" missed quot(")!!'),i.add(a,c,e);case b:h=S}else switch(h){case y:i.tagName,"http://www.w3.org/1999/xhtml"===n[""]&&a.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),i.add(a,a,e),e=o,h=v;break;case b:s.warning('attribute space is required"'+a+'"!!');case S:h=v,e=o;break;case x:h=w,e=o;break;case T:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function a(t,e,i){for(var n=t.tagName,r=null,s=t.length;s--;){var a=t[s],o=a.qName,h=a.value;if((_=o.indexOf(":"))>0)var c=a.prefix=o.slice(0,_),u=o.slice(_+1),d="xmlns"===c&&u;else u=o,c=null,d="xmlns"===o&&"";a.localName=u,!1!==d&&(null==r&&(r={},l(i,i={})),i[d]=r[d]=h,a.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(d,h))}for(s=t.length;s--;){(c=(a=t[s]).prefix)&&("xml"===c&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==c&&(a.uri=i[c||""]))}var _;(_=n.indexOf(":"))>0?(c=t.prefix=n.slice(0,_),u=t.localName=n.slice(_+1)):(c=null,u=t.localName=n);var f=t.uri=i[c||""];if(e.startElement(f,u,n,t),!t.closed)return t.currentNSMap=i,t.localNSMap=r,!0;if(e.endElement(f,u,n),r)for(c in r)e.endPrefixMapping(c)}function o(t,e,i,n,r){if(/^(?:script|textarea)$/i.test(i)){var s=t.indexOf("</"+i+">",e),a=t.substring(e+1,s);if(/[&<]/.test(a))return/^script$/i.test(i)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,n),r.characters(a,0,a.length),s)}return e+1}function h(t,e,i,n){var r=n[i];return null==r&&(e>(r=t.lastIndexOf("</"+i+">"))&&(r=t.lastIndexOf("</"+i)),n[i]=r),e>r}function l(t,e){for(var i in t)e[i]=t[i]}function c(t,e,i,n){switch(t.charAt(e+2)){case"-":return"-"===t.charAt(e+3)?(r=t.indexOf("--\x3e",e+4))>e?(i.comment(t,e+4,r-e-4),r+3):(n.error("Unclosed comment"),-1):-1;default:if("CDATA["==t.substr(e+3,6)){var r=t.indexOf("]]>",e+9);return i.startCDATA(),i.characters(t,e+9,r-e-9),i.endCDATA(),r+3}var s=function(t,e){var i,n=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(r.lastIndex=e,r.exec(t);i=r.exec(t);)if(n.push(i),i[1])return n}(t,e),a=s.length;if(a>1&&/!doctype/i.test(s[0][0])){var o=s[1][0],h=a>3&&/^public$/i.test(s[2][0])&&s[3][0],l=a>4&&s[4][0],c=s[a-1];return i.startDTD(o,h&&h.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),c.index+c[0].length}}return-1}function u(t,e,i){var n=t.indexOf("?>",e);if(n){var r=t.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return r?(r[0].length,i.processingInstruction(r[1],r[2]),n+2):-1}return-1}function d(){}function _(t,e){return t.__proto__=e,t}var f=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=new RegExp("[\\-\\.0-9"+f.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),m=new RegExp("^"+f.source+p.source+"*(?::"+f.source+p.source+"*)?$"),g=0,v=1,y=2,x=3,w=4,b=5,S=6,T=7;i.prototype={parse:function(t,e,i){var r=this.domBuilder;r.startDocument(),l(e,e={}),n(t,e,i,r,this.errorHandler),r.endDocument()}},d.prototype={setTagName:function(t){if(!m.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,i){if(!m.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:i}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},_({},_.prototype)instanceof _||(_=function(t,e){function i(){}for(e in i.prototype=e,i=new i,t)i[e]=t[e];return i}),e.XMLReader=i},function(t,e){function i(t,e){for(var i in t)e[i]=t[i]}function n(t,e){function n(){}var r=t.prototype;if(Object.create){var s=Object.create(e.prototype);r.__proto__=s}r instanceof e||(n.prototype=e.prototype,i(r,n=new n),t.prototype=r=n),r.constructor!=t&&("function"!=typeof t&&console.error("unknow Class:"+t),r.constructor=t)}function r(t,e){if(e instanceof Error)var i=e;else i=this,Error.call(this,$[t]),this.message=$[t],Error.captureStackTrace&&Error.captureStackTrace(this,r);return i.code=t,e&&(this.message=this.message+": "+e),i}function s(){}function a(t,e){this._node=t,this._refresh=e,o(this)}function o(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var n=t._refresh(t._node);F(t,"length",n.length),i(n,t),t._inc=e}}function h(){}function l(t,e){for(var i=t.length;i--;)if(t[i]===e)return i}function c(t,e,i,n){if(n?e[l(e,n)]=i:e[e.length++]=i,t){i.ownerElement=t;var r=t.ownerDocument;r&&(n&&g(r,t,n),function(t,e,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(e._nsMap[i.prefix?i.localName:""]=i.value)}(r,t,i))}}function u(t,e,i){var n=l(e,i);if(!(n>=0))throw r(et,new Error(t.tagName+"@"+i));for(var s=e.length-1;s>n;)e[n]=e[++n];if(e.length=s,t){var a=t.ownerDocument;a&&(g(a,t,i),i.ownerElement=null)}}function d(t){if(this._features={},t)for(var e in t)this._features=t[e]}function _(){}function f(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function p(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(p(t,e))return!0}while(t=t.nextSibling)}function m(){}function g(t,e,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete e._nsMap[i.prefix?i.localName:""]}function v(t,e,i){if(t&&t._inc){t._inc++;var n=e.childNodes;if(i)n[n.length++]=i;else{for(var r=e.firstChild,s=0;r;)n[s++]=r,r=r.nextSibling;n.length=s}}}function y(t,e){var i=e.previousSibling,n=e.nextSibling;return i?i.nextSibling=n:t.firstChild=n,n?n.previousSibling=i:t.lastChild=i,v(t.ownerDocument,t),e}function x(t,e,i){var n=e.parentNode;if(n&&n.removeChild(e),e.nodeType===Z){var r=e.firstChild;if(null==r)return e;var s=e.lastChild}else r=s=e;var a=i?i.previousSibling:t.lastChild;r.previousSibling=a,s.nextSibling=i,a?a.nextSibling=r:t.firstChild=r,null==i?t.lastChild=s:i.previousSibling=s;do{r.parentNode=t}while(r!==s&&(r=r.nextSibling));return v(t.ownerDocument||t,t),e.nodeType==Z&&(e.firstChild=e.lastChild=null),e}function w(){this._nsMap={}}function b(){}function S(){}function T(){}function C(){}function M(){}function I(){}function E(){}function A(){}function D(){}function P(){}function R(){}function N(){}function L(t,e){var i=[],n=9==this.nodeType?this.documentElement:this,r=n.prefix,s=n.namespaceURI;if(s&&null==r&&null==(r=n.lookupPrefix(s)))var a=[{namespace:s,prefix:null}];return O(this,i,t,e,a),i.join("")}function B(t,e,i){var n=t.prefix||"",r=t.namespaceURI;if(!n&&!r)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===r||"http://www.w3.org/2000/xmlns/"==r)return!1;for(var s=i.length;s--;){var a=i[s];if(a.prefix==n)return a.namespace!=r}return!0}function O(t,e,i,n,r){if(n){if(!(t=n(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case U:r||(r=[]);var s=(r.length,t.attributes),a=s.length,o=t.firstChild,h=t.tagName;i=k===t.namespaceURI||i,e.push("<",h);for(var l=0;a>l;l++){"xmlns"==(c=s.item(l)).prefix?r.push({prefix:c.localName,namespace:c.value}):"xmlns"==c.nodeName&&r.push({prefix:"",namespace:c.value})}for(l=0;a>l;l++){var c;if(B(c=s.item(l),0,r)){var u=c.prefix||"",d=c.namespaceURI,_=u?" xmlns:"+u:" xmlns";e.push(_,'="',d,'"'),r.push({prefix:u,namespace:d})}O(c,e,i,n,r)}if(B(t,0,r)){u=t.prefix||"",d=t.namespaceURI,_=u?" xmlns:"+u:" xmlns";e.push(_,'="',d,'"'),r.push({prefix:u,namespace:d})}if(o||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(h)){if(e.push(">"),i&&/^script$/i.test(h))for(;o;)o.data?e.push(o.data):O(o,e,i,n,r),o=o.nextSibling;else for(;o;)O(o,e,i,n,r),o=o.nextSibling;e.push("</",h,">")}else e.push("/>");return;case K:case Z:for(o=t.firstChild;o;)O(o,e,i,n,r),o=o.nextSibling;return;case H:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,f),'"');case z:return e.push(t.data.replace(/[<&]/g,f));case W:return e.push("<![CDATA[",t.data,"]]>");case j:return e.push("\x3c!--",t.data,"--\x3e");case q:var p=t.publicId,m=t.systemId;if(e.push("<!DOCTYPE ",t.name),p)e.push(' PUBLIC "',p),m&&"."!=m&&e.push('" "',m),e.push('">');else if(m&&"."!=m)e.push(' SYSTEM "',m,'">');else{var g=t.internalSubset;g&&e.push(" [",g,"]"),e.push(">")}return;case X:return e.push("<?",t.target," ",t.data,"?>");case G:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function F(t,e,i){t[e]=i}var k="http://www.w3.org/1999/xhtml",V={},U=V.ELEMENT_NODE=1,H=V.ATTRIBUTE_NODE=2,z=V.TEXT_NODE=3,W=V.CDATA_SECTION_NODE=4,G=V.ENTITY_REFERENCE_NODE=5,Y=V.ENTITY_NODE=6,X=V.PROCESSING_INSTRUCTION_NODE=7,j=V.COMMENT_NODE=8,K=V.DOCUMENT_NODE=9,q=V.DOCUMENT_TYPE_NODE=10,Z=V.DOCUMENT_FRAGMENT_NODE=11,Q=V.NOTATION_NODE=12,J={},$={},tt=(J.INDEX_SIZE_ERR=($[1]="Index size error",1),J.DOMSTRING_SIZE_ERR=($[2]="DOMString size error",2),J.HIERARCHY_REQUEST_ERR=($[3]="Hierarchy request error",3)),et=(J.WRONG_DOCUMENT_ERR=($[4]="Wrong document",4),J.INVALID_CHARACTER_ERR=($[5]="Invalid character",5),J.NO_DATA_ALLOWED_ERR=($[6]="No data allowed",6),J.NO_MODIFICATION_ALLOWED_ERR=($[7]="No modification allowed",7),J.NOT_FOUND_ERR=($[8]="Not found",8)),it=(J.NOT_SUPPORTED_ERR=($[9]="Not supported",9),J.INUSE_ATTRIBUTE_ERR=($[10]="Attribute in use",10));J.INVALID_STATE_ERR=($[11]="Invalid state",11),J.SYNTAX_ERR=($[12]="Syntax error",12),J.INVALID_MODIFICATION_ERR=($[13]="Invalid modification",13),J.NAMESPACE_ERR=($[14]="Invalid namespace",14),J.INVALID_ACCESS_ERR=($[15]="Invalid access",15);r.prototype=Error.prototype,i(J,r),s.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var i=[],n=0;n<this.length;n++)O(this[n],i,t,e);return i.join("")}},a.prototype.item=function(t){return o(this),this[t]},n(a,s),h.prototype={length:0,item:s.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var i=this[e];if(i.nodeName==t)return i}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new r(it);var i=this.getNamedItem(t.nodeName);return c(this._ownerElement,this,t,i),i},setNamedItemNS:function(t){var e,i=t.ownerElement;if(i&&i!=this._ownerElement)throw new r(it);return e=this.getNamedItemNS(t.namespaceURI,t.localName),c(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return u(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var i=this.getNamedItemNS(t,e);return u(this._ownerElement,this,i),i},getNamedItemNS:function(t,e){for(var i=this.length;i--;){var n=this[i];if(n.localName==e&&n.namespaceURI==t)return n}return null}},d.prototype={hasFeature:function(t,e){var i=this._features[t.toLowerCase()];return!(!i||e&&!(e in i))},createDocument:function(t,e,i){var n=new m;if(n.implementation=this,n.childNodes=new s,n.doctype=i,i&&n.appendChild(i),e){var r=n.createElementNS(t,e);n.appendChild(r)}return n},createDocumentType:function(t,e,i){var n=new I;return n.name=t,n.nodeName=t,n.publicId=e,n.systemId=i,n}},_.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return x(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return y(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,i,n){var r=new i.constructor;for(var a in i){var o=i[a];"object"!=typeof o&&o!=r[a]&&(r[a]=o)}switch(i.childNodes&&(r.childNodes=new s),r.ownerDocument=e,r.nodeType){case U:var l=i.attributes,c=r.attributes=new h,u=l.length;c._ownerElement=r;for(var d=0;u>d;d++)r.setAttributeNode(t(e,l.item(d),!0));break;case H:n=!0}if(n)for(var _=i.firstChild;_;)r.appendChild(t(e,_,n)),_=_.nextSibling;return r}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==z&&t.nodeType==z?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var i=e._nsMap;if(i)for(var n in i)if(i[n]==t)return n;e=e.nodeType==H?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var i=e._nsMap;if(i&&t in i)return i[t];e=e.nodeType==H?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},i(V,_),i(V,_.prototype),m.prototype={nodeName:"#document",nodeType:K,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==Z){for(var i=t.firstChild;i;){var n=i.nextSibling;this.insertBefore(i,e),i=n}return t}return null==this.documentElement&&t.nodeType==U&&(this.documentElement=t),x(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),y(this,t)},importNode:function(t,e){return function t(e,i,n){var r;switch(i.nodeType){case U:(r=i.cloneNode(!1)).ownerDocument=e;case Z:break;case H:n=!0}if(r||(r=i.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var s=i.firstChild;s;)r.appendChild(t(e,s,n)),s=s.nextSibling;return r}(this,t,e)},getElementById:function(t){var e=null;return p(this.documentElement,(function(i){return i.nodeType==U&&i.getAttribute("id")==t?(e=i,!0):void 0})),e},createElement:function(t){var e=new w;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new s,(e.attributes=new h)._ownerElement=e,e},createDocumentFragment:function(){var t=new P;return t.ownerDocument=this,t.childNodes=new s,t},createTextNode:function(t){var e=new T;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new C;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new M;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var i=new R;return i.ownerDocument=this,i.tagName=i.target=t,i.nodeValue=i.data=e,i},createAttribute:function(t){var e=new b;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new D;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var i=new w,n=e.split(":"),r=i.attributes=new h;return i.childNodes=new s,i.ownerDocument=this,i.nodeName=e,i.tagName=e,i.namespaceURI=t,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,r._ownerElement=i,i},createAttributeNS:function(t,e){var i=new b,n=e.split(":");return i.ownerDocument=this,i.nodeName=e,i.name=e,i.namespaceURI=t,i.specified=!0,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,i}},n(m,_),w.prototype={nodeType:U,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var i=this.ownerDocument.createAttribute(t);i.value=i.nodeValue=""+e,this.setAttributeNode(i)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===Z?this.insertBefore(t,null):function(t,e){var i=e.parentNode;if(i){var n=t.lastChild;i.removeChild(e);n=t.lastChild}return n=t.lastChild,e.parentNode=t,e.previousSibling=n,e.nextSibling=null,n?n.nextSibling=e:t.firstChild=e,t.lastChild=e,v(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);i&&this.removeAttributeNode(i)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);return i&&i.value||""},setAttributeNS:function(t,e,i){var n=this.ownerDocument.createAttributeNS(t,e);n.value=n.nodeValue=""+i,this.setAttributeNode(n)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new a(this,(function(e){var i=[];return p(e,(function(n){n===e||n.nodeType!=U||"*"!==t&&n.tagName!=t||i.push(n)})),i}))},getElementsByTagNameNS:function(t,e){return new a(this,(function(i){var n=[];return p(i,(function(r){r===i||r.nodeType!==U||"*"!==t&&r.namespaceURI!==t||"*"!==e&&r.localName!=e||n.push(r)})),n}))}},m.prototype.getElementsByTagName=w.prototype.getElementsByTagName,m.prototype.getElementsByTagNameNS=w.prototype.getElementsByTagNameNS,n(w,_),b.prototype.nodeType=H,n(b,_),S.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(){throw new Error($[tt])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,i){i=this.data.substring(0,t)+i+this.data.substring(t+e),this.nodeValue=this.data=i,this.length=i.length}},n(S,_),T.prototype={nodeName:"#text",nodeType:z,splitText:function(t){var e=this.data,i=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},n(T,S),C.prototype={nodeName:"#comment",nodeType:j},n(C,S),M.prototype={nodeName:"#cdata-section",nodeType:W},n(M,S),I.prototype.nodeType=q,n(I,_),E.prototype.nodeType=Q,n(E,_),A.prototype.nodeType=Y,n(A,_),D.prototype.nodeType=G,n(D,_),P.prototype.nodeName="#document-fragment",P.prototype.nodeType=Z,n(P,_),R.prototype.nodeType=X,n(R,_),N.prototype.serializeToString=function(t,e,i){return L.call(t,e,i)},_.prototype.toString=L;try{Object.defineProperty&&(Object.defineProperty(a.prototype,"length",{get:function(){return o(this),this.$$length}}),Object.defineProperty(_.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case U:case Z:var i=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&i.push(t(e)),e=e.nextSibling;return i.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case U:case Z:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),F=function(t,e,i){t["$$"+e]=i})}catch(t){}e.DOMImplementation=d,e.XMLSerializer=N},function(t,e,i){"use strict";i.r(e);i(9);window.versions={wxVersion:window.config.game_ver},window.DEBUG=!1,window.PLATFORM=3,window.ENV=3,window.PACK=!0,window.WSS=!0,window.workerJsURL="",window.isWaiFangWx=!1,window.PF_INFO={base_cdn:"https://cdn-tjqy.shzbkj.com/weixin_0/",cdn:"https://cdn-tjqy.shzbkj.com/weixin_0/"},PF_INFO.pay_infos={},PF_INFO.package="0",PF_INFO.version=window.versions.wxVersion,PF_INFO.mac="",PF_INFO.os="1",PF_INFO.sdk_name="9130",PF_INFO.apiurl="https://api-tjqytest.shzbkj.com",PF_INFO.logurl="https://log-tjqytest.shzbkj.com",PF_INFO.payurl="https://pay-tjqytest.shzbkj.com",PF_INFO.apikey="MQx0mYlUWO5XYKvgAIPKWgK1w722GKih",PF_INFO.partnerId="1",PF_INFO.pkgName="",PF_INFO.device_id="",PF_INFO.from_scene=0,PF_INFO.serverList={},PF_INFO.channelNum=parseInt(PF_INFO.partnerId),PF_INFO.channel=PF_INFO.partnerId,PF_INFO.selectedServer={},PF_INFO.clientlog="https://jgcenter.sh9130.com/clientlog/",PF_INFO.showLogo=!1,PF_INFO.debugUsers="39927500|58163716|74597555",PF_INFO.tick=Date.now(),PF_INFO.configType="_weixin",PF_INFO.exposeType="_a",PF_INFO.loadingType=1,PF_INFO.lastVersion=1985,PF_INFO.wxVersion=window.versions.wxVersion,PF_INFO.wxShield=!1,PF_INFO.wxIOS=!1,PF_INFO.wxAndroid=!1,PF_INFO.wxPC=!1,window.apiRetryAmount=5,window.isCheckBan=!1,window.loadProbPkg=!1,window.loadMainPkg=!1,window.loadServerRes=!1,window.loadLoadingRes=!1,window.loadVersion=!1,window.loadOption=!1,window.loadServer=!1,window.bEnterGame=!1,window.alert=function(t){console.log("alert",t),qg.hideLoading(),qg.showDialog({title:"提示",message:t,buttons:[{text:"确定"},{text:"取消"}],success(t){0==t.index?console.log("用户点击确定"):1==t.index&&console.log("用户点击取消")}})},window.loginAlert=function(t){console.log("loginAlert",t),wxHideLoading(),qg.showDialog({title:"提示",message:t,buttons:[{text:"重试"},{text:"退出"}],success(t){0==t.index?window.sdkInit():1==t.index&&(console.log("退出游戏"),qg.exitApplication())}})},window.exitAlert=function(t){console.log("exitAlert",t),qg.showDialog({title:"提示",message:t,buttons:[{text:"重登"}],complete(t){console.log("退出游戏"),qg.exitApplication()}})},window.isShowLoading=!1,window.wxShowLoading=function(t){window.isShowLoading=!0,qg.showLoading(t)},window.wxHideLoading=function(){window.isShowLoading&&(window.isShowLoading=!1,qg.hideLoading())},window.changeServerLoading=function(t){window.ServerLoading.instance.changeServerLoading(t)},window.msgCheck=function(t,e){AKSDK.msgCheck(t,(function(t){t&&t.data?1==t.data.state?e(!0):(e(!1),console.info("存在敏感词： "+t.data.msg)):console.log("msgCheck",t)}))},window.getJsURL=function(t){console.log("getJsURL",t)},window.toAllProgress=function(t){},window.toProgress=function(t,e,i){},window.toEnterGame=function(t){console.log("toEnterGame",t),window.ServerLoading.instance.closeAuthor(),window.ServerLoading.instance.closeServer(),window.ServerLoading.instance.closeLoading()},window.onApiError=function(t){window.toErrorAlarm(14,"onApiError "+t),window.loginAlert("on api error");var e={id:window.PF_INFO.roleId,role:window.PF_INFO.roleName,level:window.PF_INFO.roleLevel,account:window.PF_INFO.account,version:window.PF_INFO.lastVersion,cdn:window.PF_INFO.cdn,pkgName:window.PF_INFO.pkgName,gamever:window.config.game_ver,serverid:window.PF_INFO.selectedServer?window.PF_INFO.selectedServer.server_id:0,systemInfo:window.systemInfo,error:"onApiError",stack:t||"on api error"},i=JSON.stringify(e);console.error("API错误："+i),window.clientlog(i)},window.toErrorAlarm=function(t,e){sendApi(PF_INFO.logurl,"log.client_error",{game_pkg:PF_INFO.pkgName,partner_id:PF_INFO.partnerId,server_id:PF_INFO.selectedServer&&PF_INFO.selectedServer.server_id>0?PF_INFO.selectedServer.server_id:0,uid:PF_INFO.account>0?PF_INFO.account:0,type:t,info:e})},window.reqRecordError=function(t){var e=JSON.parse(t);e.gamever=window.config.game_ver,e.serverid=window.PF_INFO.selectedServer?window.PF_INFO.selectedServer.server_id:0,e.systemInfo=window.systemInfo;var i=JSON.stringify(e);console.error("上报错误："+i),window.clientlog(i)},window.reqRecordInfo=function(t,e){var i={id:window.PF_INFO.roleId,role:window.PF_INFO.roleName,level:window.PF_INFO.roleLevel,account:window.PF_INFO.account,version:window.PF_INFO.lastVersion,cdn:window.PF_INFO.cdn,pkgName:window.PF_INFO.pkgName,gamever:window.config.game_ver,serverid:window.PF_INFO.selectedServer?window.PF_INFO.selectedServer.server_id:0,systemInfo:window.systemInfo,error:t,stack:e},n=JSON.stringify(i);console.warn("上报信息："+n),window.clientlog(n)},window.clientlog=function(t){if("devtools"!=window.PF_INFO.wxPlatform){var e=PF_INFO.clientlog+"?account="+PF_INFO.account;qg.request({url:e,method:"POST",data:t,header:{"content-type":"application/json","cache-control":"no-cache"},success:function(i){DEBUG&&console.log("clientlog:",e,t,i)},fail:function(i){DEBUG&&console.log("clientlog:",e,t,i)},complete:function(){}})}},window.guild=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"+"+t()+t()+t()},window.sdkInit=function(){console.log("#SDK 初始化：");var t=AKSDK.getConfig();PF_INFO.channel=t.partner_id,PF_INFO.channelNum=t.partner_id,PF_INFO.partnerId=t.partner_id,PF_INFO.pkgName=t.game_pkg;var e={game_ver:PF_INFO.version};PF_INFO.device_id=this.guild(),wxShowLoading({message:"正在初始化"}),AKSDK.init(e,this.sdkOnInited.bind(this))},window.sdkOnInited=function(t){var e=t.develop;console.log("#初始化成功   提审状态:"+e+"   是否提审:"+(1==e)+"   提审版本号:"+t.game_ver+"   当前版本号:"+window.versions.wxVersion),!t.game_ver||window.compareVersion(window.versions.wxVersion,t.game_ver)<0?(console.log("#正式版============================="),PF_INFO.apiurl="https://api-tjqy.shzbkj.com",PF_INFO.logurl="https://log-tjqy.shzbkj.com",PF_INFO.payurl="https://pay-tjqy.shzbkj.com",PF_INFO.cdn="https://cdn-tjqy-ky.shzbkj.com/weixin_1/",PF_INFO.spareCdn="https://cdn-tjqy-ali.shzbkj.com/weixin_1/",PF_INFO.version_name="xy",PF_INFO.wxShield=!1):0==window.compareVersion(window.versions.wxVersion,t.game_ver)?(console.log("#审核版============================="),PF_INFO.apiurl="https://api-tjqytest.shzbkj.com",PF_INFO.logurl="https://log-tjqytest.shzbkj.com",PF_INFO.payurl="https://pay-tjqytest.shzbkj.com",PF_INFO.cdn="https://cdn-tjqy-ky.shzbkj.com/weixin_0/",PF_INFO.spareCdn="https://cdn-tjqy-ali.shzbkj.com/weixin_1/",PF_INFO.version_name="weixin",PF_INFO.wxShield=!0):(console.log("#开发版============================="),PF_INFO.apiurl="https://api-tjqytest.shzbkj.com",PF_INFO.logurl="https://log-tjqytest.shzbkj.com",PF_INFO.payurl="https://pay-tjqytest.shzbkj.com",PF_INFO.cdn="https://cdn-tjqy-ky.shzbkj.com/weixin_0/",PF_INFO.spareCdn="https://cdn-tjqy-ali.shzbkj.com/weixin_1/",PF_INFO.version_name="weixin",PF_INFO.wxShield=!1),PF_INFO.from_scene=config.from?config.from:0,this.loadVersionConfig(),this.reqPkgOptions(),window.sdkLoginRetry=5,wxShowLoading({message:"正在登录账号"}),AKSDK.login(this.sdkOnLogin.bind(this))},window.sdkOnLogin=function(t,e){if(0==t&&e&&e.token){PF_INFO.sdk_token=e.token,PF_INFO.wx_channel=e.wx_channel,PF_INFO.video_type=e.video_type,PF_INFO.zsy_tp_state=e.zsy_tp_state,PF_INFO.ad_flag=e.ad_flag;wxShowLoading({message:"正在验证账号"}),sendApi(PF_INFO.apiurl,"User.login",{platform:PF_INFO.sdk_name,partner_id:PF_INFO.partnerId,token:e.token,game_pkg:PF_INFO.pkgName,deviceId:PF_INFO.device_id,scene:"WX_"+PF_INFO.from_scene},this.onUserLogin.bind(this),apiRetryAmount,onApiError)}else e&&e.errMsg&&window.sdkLoginRetry>0&&(-1!=e.errMsg.indexOf("fail interrupted")||-1!=e.errMsg.indexOf("network api interrupted")||-1!=e.errMsg.indexOf("Network Error")||-1!=e.errMsg.indexOf("ERR_TIMED_OUT")||-1!=e.errMsg.indexOf("ERR_CONNECTION_ABORTED")||-1!=e.errMsg.indexOf("ERR_CONNECTION_RESET"))?(window.sdkLoginRetry--,AKSDK.login(this.sdkOnLogin.bind(this))):(window.toErrorAlarm(1,"AKSDK.login fail: status="+t+",errMsg="+(e?e.errMsg:"")),window.reqRecordInfo("sdkOnLoginError",JSON.stringify({status:t,data:e})),window.loginAlert("登录/注册失败"+(e&&e.errMsg?"，"+e.errMsg:"")))},window.onUserLogin=function(t){if(!t)return window.toErrorAlarm(2,"User.login fail: response is null"),window.reqRecordInfo("userLoginError","response is null"),void window.loginAlert("User.login failed");if("success"!=t.state)return window.toErrorAlarm(2,"User.login fail: state="+t.state),window.reqRecordInfo("userLoginError",JSON.stringify(t)),void window.loginAlert("User.login failed: "+t.state);if(1!=t.ban_state){PF_INFO.userId=String(t.account),PF_INFO.account=String(t.account),PF_INFO.platform=String(t.platform),PF_INFO.channel=String(t.platform),PF_INFO.platform_uid=String(t.platform_uid),PF_INFO.php_sign=String(t.sign),PF_INFO.php_signtime=String(t.time),PF_INFO.sign="";wxShowLoading({message:"请求服务器"});var e=localStorage.getItem("LastSer_"+PF_INFO.pkgName+PF_INFO.account);if(e&&""!=e){var i=Number(e);this.getCheckServers(i)}else this.getDefaultServers()}else window.loginAlert("账号已被封禁！")},window.getDefaultServers=function(){sendApi(PF_INFO.apiurl,"Server.defaultServer",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,version:PF_INFO.version,game_pkg:PF_INFO.pkgName,device:PF_INFO.device_id},this.onUserLoginDefaultServers.bind(this),apiRetryAmount,onApiError)},window.onUserLoginDefaultServers=function(t){return t?"success"!=t.state?(window.toErrorAlarm(3,"Server.defaultServer failed: "+t.state),void window.loginAlert("Server.defaultServer failed: "+t.state)):t.data&&0!=t.data.length?void this.updCurServer(t):(window.toErrorAlarm(3,"Server.defaultServer failed: data null"),void window.loginAlert("服务器尚未开启")):(window.toErrorAlarm(3,"Server.defaultServer failed"),void window.loginAlert("Server.defaultServer failed"))},window.getCheckServers=function(t){sendApi(PF_INFO.apiurl,"Server.check_server",{server_id:t,time:Date.now()/1e3},this.onUserLoginCheckServers.bind(this),apiRetryAmount,onApiError)},window.onUserLoginCheckServers=function(t){return t?"success"!=t.state?(window.toErrorAlarm(4,"Server.check_server failed: "+t.state),void this.getDefaultServers()):t.data&&0!=t.data.length?void this.updCurServer(t):(window.toErrorAlarm(4,"Server.check_server failed: data null"),void this.getDefaultServers()):(window.toErrorAlarm(4,"Server.check_server failed"),void this.getDefaultServers())},window.updCurServer=function(t){PF_INFO.newRegister=null!=t.is_new?t.is_new:0,PF_INFO.selectedServer={server_id:String(t.data[0].server_id),server_name:String(t.data[0].server_name),entry_ip:t.data[0].entry_ip,entry_port:parseInt(t.data[0].entry_port),status:get_status(t.data[0]),start_time:t.data[0].start_time,maintain_time:t.data[0].maintain_time?t.data[0].maintain_time:"",is_recommend:t.data[0].is_recommend,cdn:PF_INFO.cdn},this.initComplete()},window.initComplete=function(){if(1==PF_INFO.newRegister){var t=PF_INFO.selectedServer.status;if(-1===t||0===t)return window.toErrorAlarm(15,"new register selectedServer status error: id="+PF_INFO.selectedServer.id+",status="+PF_INFO.selectedServer.status),void window.loginAlert(-1===t?"当前服务器在维护中":"当前服务器尚未开启，敬请期待");req_server_check_ban(0,PF_INFO.selectedServer.server_id),window.ServerLoading.instance.openLoading(PF_INFO.newRegister)}else window.ServerLoading.instance.openServer(),wxHideLoading();window.loadServer=!0,window.initMain(),window.enterToGame()},window.loadVersionConfig=function(){console.log("请求1 User.getCdnVersion game_pkg:",PF_INFO.pkgName,"version_name:",PF_INFO.version_name),sendApi(PF_INFO.apiurl,"User.getCdnVersion",{game_pkg:PF_INFO.pkgName,version_name:PF_INFO.version_name},this.reqVersionConfigCallBack.bind(this),apiRetryAmount,onApiError)},window.reqVersionConfigCallBack=function(t){return console.log("请求1 User.getCdnVersion 返回成功:",JSON.stringify(t)),t?"success"!=t.state?(window.toErrorAlarm(5,"User.getCdnVersion failed: state="+t.state),void window.loginAlert("User.getCdnVersion failed: state="+t.state)):t.data&&t.data.version?(t.data.cdn_url&&t.data.cdn_url.length>10&&(PF_INFO.base_cdn=t.data.cdn_url,PF_INFO.cdn=t.data.cdn_url),t.data.version&&(PF_INFO.lastVersion=t.data.version),console.info("lastVersion:"+PF_INFO.lastVersion+", version_name:"+PF_INFO.version_name),window.loadVersion=!0,window.initMain(),void window.enterToGame()):(window.toErrorAlarm(5,"User.getCdnVersion failed: version="+(t.data&&t.data.version)),void window.loginAlert("User.getCdnVersion failed: version="+(t.data&&t.data.version))):(window.toErrorAlarm(5,"User.getCdnVersion failed"),void window.loginAlert("User.getCdnVersion failed"))},window.pkgOptions,window.reqPkgOptions=function(){console.log("请求 Common.get_option_pkg:",PF_INFO.pkgName),sendApi(PF_INFO.apiurl,"Common.get_option_pkg",{game_pkg:PF_INFO.pkgName},this.reqPkgOptionsCallBack.bind(this),apiRetryAmount,onApiError)},window.reqPkgOptionsCallBack=function(t){if(t&&"success"===t.state&&t.data)for(var e in window.pkgOptions=t.data,t.data)PF_INFO[e]=t.data[e];else window.toErrorAlarm(11,"Common.get_option_pkg failed"),console.info("reqPkgOptionsCallBack "+t.state);console.log("请求 Common.get_option_pkg:",JSON.stringify(t.data)),window.loadOption=!0,window.enterToGame()},window.toPay=function(t,e,i,n,r,s,a,o,h,l){r=String(r);var c=a,u=o;PF_INFO.pay_infos[r]={productid:r,productname:c,productdesc:u,roleid:t,rolename:e,rolelevel:i,price:s,callback:h},sendApi(PF_INFO.payurl,"Order.order",{game_pkg:PF_INFO.pkgName,server_id:PF_INFO.selectedServer.server_id,server_name:PF_INFO.selectedServer.server_name,level:i,uid:PF_INFO.account,role_id:t,role_name:e,product_id:r,product_name:c,product_desc:u,money:s,partner_id:PF_INFO.partnerId},toPayCallBack,apiRetryAmount,onApiError)},window.toPayCallBack=function(t){if(!t||200!==t.errCode&&"success"!=t.state){var e=t?"errCode="+t.errCode+",state="+t.state+",info="+t.info:"获取订单失败";window.toErrorAlarm(13,"Order.order fail: "+e),alert(e)}else{var i=PF_INFO.pay_infos[String(t.product_id)];i.callback&&i.callback(t.product_id,t.cp_order_id,-1),AKSDK.pay({cpbill:t.cp_order_id,productid:t.product_id,productname:i.productname,productdesc:i.productdesc,serverid:PF_INFO.selectedServer.server_id,servername:PF_INFO.selectedServer.server_name,roleid:i.roleid,rolename:i.rolename,rolelevel:i.rolelevel,price:i.price,extension:JSON.stringify({cp_order_id:t.cp_order_id})},(function(e,n){i.callback&&0==e&&i.callback(t.product_id,t.cp_order_id,e),console.info(JSON.stringify({type:"paycallback",status:e,data:t,role_name:i.rolename}))}))}},window.loadCreateRole=function(){},window.toCreate=function(t,e,i,n,r){AKSDK.logCreateRole(PF_INFO.selectedServer.server_id,PF_INFO.selectedServer.server_name||PF_INFO.selectedServer.server_id,t,e,i),sendApi(PF_INFO.apiurl,"User.create_role",{game_pkg:PF_INFO.pkgName,server_id:PF_INFO.selectedServer.server_id,role_id:t,uid:PF_INFO.account,role_name:e,role_type:n,level:i})},window.toLogin=function(t,e,i,n,r,s,a,o,h,l){PF_INFO.roleId=t,PF_INFO.roleName=e,PF_INFO.roleLevel=i,AKSDK.logEnterGame(PF_INFO.selectedServer.server_id,PF_INFO.selectedServer.server_name||PF_INFO.selectedServer.server_id,t,e,i),sendApi(PF_INFO.apiurl,"User.update_role",{game_pkg:PF_INFO.pkgName,server_id:PF_INFO.selectedServer.server_id,role_id:t,uid:PF_INFO.account,role_name:e,role_type:n,level:i,evolution:r})},window.toLevelUp=function(t,e,i,n,r,s,a,o,h,l){PF_INFO.roleId=t,PF_INFO.roleName=e,PF_INFO.roleLevel=i,AKSDK.logRoleUpLevel(PF_INFO.selectedServer.server_id,PF_INFO.selectedServer.server_name||PF_INFO.selectedServer.server_id,t,e,i)},window.toRealName=function(t){},window.openShare=function(t){AKSDK.share("share",(function(e){t&&t(e)}))},window.openService=function(){AKSDK.openService()},window.microPortGuide=function(){AKSDK.weiduanHelper()},window.reqSMSCode=function(t,e,i,n,r,s,a,o){o=o||PF_INFO.selectedServer.server_id,sendApi(PF_INFO.apiurl,"User.get_code",{phone:t,role_id:e,uid:PF_INFO.account,game_pkg:PF_INFO.pkgName,partner_id:PF_INFO.partnerId,server_id:o},a,2,null,(function(){return!0}))},window.onShowData=null,window.onShowCallback=null,window.onShow=function(t){window.onShowCallback=t,window.onShowCallback&&window.onShowData&&(console.info("小游戏切前台事件，场景值："+window.onShowData.scene),window.onShowCallback(window.onShowData),window.onShowData=null)},window.reqPlayerAskInfo=function(t,e,i,n){window.send("https://sdk.sh9130.com/game/?ct=min&ac=getInviter",{game_pkg:window.PF_INFO.pkgName,role_id:e,server_id:i},n)},window.openSubscribeMsg=function(t,e){console.log("不支持订阅 ")},window.batteryInfo={isSuccess:!1,level:100,isCharging:!1},window.getBatteryInfo=function(t){qg.getBatteryInfo({success:function(e){var i=window.batteryInfo;i.isSuccess=!0,i.level=Number(100*e.level).toFixed(0),i.isCharging=e.isCharging,t&&t(i.isSuccess,i.level,i.isCharging)},fail:function(e){console.log("调用获取电池信息失败",e.errMsg);var i=window.batteryInfo;t&&t(i.isSuccess,i.level,i.isCharging)}})},window.getNetworkType=function(t){},window.onNetworkStatusChange=function(t){},window.offNetworkStatusChange=function(t){},window.send=function(t,e,i,n,r,s,a,o){console.log("send："+t+", data："+(e?JSON.stringify(e):null)),null==n&&(n=1);var h=function(t,e,i,n,r,s,a,o,h){console.log("重试请求:",t),n-1>0?setTimeout((function(){send(t,e,i,n-1,r,s)}),1e3):r&&r(JSON.stringify({url:t,status:a,response:o,responseType:h}))};qg.request({url:t,dataType:"text",method:a||"GET",header:{"content-type":o||"application/json"},data:e,success:function(a){if(200==a.statusCode||301==a.statusCode){var l=a.data;if(l=JSON.parse(l),console.log("send reply url："+t+", response："+JSON.stringify(l)),!s||s(l))return void(i&&i(l));console.log("url success Fail :",t,"response:",l),console.error(l)}h(t,e,i,n,r,s,a.statusCode,a.data,o)},fail:function(a,l){console.log("url fail:",t,"error:",a,"code:",l),h(t,e,i,n,r,s,-1,{error:a,code:l},o)},complete:function(e){console.log("url request complete:",t,"res:",e)}})},window.sendApi=function(t,e,i,n,r,s,a){i||(i={});var o=Math.floor(Date.now()/1e3);i.time=o,i.method=e;for(var h=Object.keys(i).sort(),l="",c="",u=0;u<h.length;u++)l=l+(0==u?"":"&")+h[u]+i[h[u]],c=c+(0==u?"":"&")+h[u]+"="+encodeURIComponent(i[h[u]]);l+=PF_INFO.apikey;var d="sign="+window.md5(l);send(t+"?"+c+(""==c?"":"&")+d,null,n,r,s,a||function(t){return"success"==t.state},null,"application/x-www-form-urlencoded")},window.onRoleRecordStep=function(t,e){var i=0;PF_INFO.selectedServer&&(i=PF_INFO.selectedServer.server_id),sendApi(PF_INFO.logurl,"UserLog.reportUidStep",{partnerId:PF_INFO.partnerId,gamePkg:PF_INFO.pkgName,logTime:Math.floor(Date.now()/1e3),platformUid:PF_INFO.platform_uid,type:t,serverId:i},null,2,null,(function(){return!0}))},window.req_server_group=function(t){sendApi(PF_INFO.apiurl,"Server.getServerGroup",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,version:PF_INFO.version,game_pkg:PF_INFO.pkgName,device:PF_INFO.device_id},reqServerGroupCallBack,apiRetryAmount,onApiError)},window.reqServerGroupCallBack=function(t){if(t&&"success"===t.state&&t.data)t.data.unshift({id:-2,name:"最新服"}),t.data.unshift({id:-1,name:"已有角色"}),PF_INFO.groupList=t.data,window.initPanel&&window.initPanel.showGroupList();else{PF_INFO.hasGroupReq=!1;var e=t?t.state:"";window.toErrorAlarm(7,"Server.getServerGroup fail: "+e),window.loginAlert("reqServerGroupCallBack "+e)}},window.req_server_owner=function(t){sendApi(PF_INFO.apiurl,"Server.getServerByUid",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,version:PF_INFO.version,game_pkg:PF_INFO.pkgName,device:PF_INFO.device_id},reqServerOwnerCallBack,apiRetryAmount,onApiError)},window.reqServerOwnerCallBack=function(t){if(PF_INFO.hasServerReq=!1,t&&"success"===t.state&&t.data){for(var e=0;e<t.data.length;e++)t.data[e].status=get_status(t.data[e]);PF_INFO.serverList[-1]=window.changeServerName(t.data),window.initPanel.showServerList(-1)}else{var i=t?t.state:"";window.toErrorAlarm(8,"Server.getServerByUid fail: "+i),window.loginAlert("reqServerOwnerCallBack "+i)}},window.req_server_owner_status=function(t){sendApi(PF_INFO.apiurl,"Server.getServerByUid",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,version:PF_INFO.version,game_pkg:PF_INFO.pkgName,device:PF_INFO.device_id},t,apiRetryAmount,onApiError)},window.req_server_list=function(t,e){sendApi(PF_INFO.apiurl,"Server.getServerByGroup",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,version:PF_INFO.version,game_pkg:PF_INFO.pkgName,device:PF_INFO.device_id,server_group_id:e},reqServerListCallBack,apiRetryAmount,onApiError)},window.reqServerListCallBack=function(t){if(PF_INFO.hasServerReq=!1,t&&"success"===t.state&&t.data&&t.data.data){for(var e=t.data.server_group_id,i=[],n=0;n<t.data.data.length;n++)t.data.data[n].status=get_status(t.data.data[n]),0!=i.length&&0==t.data.data[n].status||(i[i.length]=t.data.data[n]);PF_INFO.serverList[e]=window.changeServerName(i),window.initPanel.showServerList(e)}else{var r=t?t.state:"";window.toErrorAlarm(9,"Server.getServerByGroup fail: "+r),window.loginAlert("reqServerListCallBack "+r)}},window.req_recommend_server_list=function(t){sendApi(PF_INFO.apiurl,"Server.getRecommendServerList",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,version:PF_INFO.version,game_pkg:PF_INFO.pkgName,device:PF_INFO.device_id},reqServerRecommendCallBack,apiRetryAmount,onApiError)},window.reqServerRecommendCallBack=function(t){if(PF_INFO.hasServerReq=!1,t&&"success"===t.state&&t.data){for(var e=0;e<t.data.length;e++)t.data[e].status=get_status(t.data[e]);PF_INFO.serverList[-2]=window.changeServerName(t.data),window.initPanel.showServerList(-2)}else{var i=t?t.state:"";window.toErrorAlarm(10,"Server.getRecommendServerList fail: "+i),alert("reqServerRecommendCallBack "+i)}},window.changeServerName=function(t){return t},window.req_server_notice=function(t,e){t=t||PF_INFO.selectedServer.server_id,sendApi(PF_INFO.apiurl,"Common.get_anno",{type:"4",game_pkg:PF_INFO.pkgName,server_id:t},e)},window.req_multi_server_notice=function(t,e,i,n){i=i||PF_INFO.selectedServer.server_id,sendApi(PF_INFO.apiurl,"Common.get_new_anno",{type:t,game_pkg:e,server_id:i},n)},window.req_privacy=function(t,e){sendApi(PF_INFO.apiurl,"Common.get_option_pkg_detail",{game_pkg:t},e)},window.get_status=function(t){return t?1==t.status?3==t.online_status?3:1==t.online_status?2:1:0==t.status?0:-1:-1},window.req_server_check_ban=function(t,e){PF_INFO.last_check_ban={step:t,server_id:e};wxShowLoading({message:"正在验证角色"}),sendApi(PF_INFO.apiurl,"User.checkInfo",{partner_id:PF_INFO.partnerId,uid:PF_INFO.account,game_pkg:PF_INFO.pkgName,server_id:e,platform:PF_INFO.platform,platform_uid:PF_INFO.platform_uid,check_login_time:PF_INFO.php_signtime,check_login_sign:PF_INFO.php_sign,version_name:PF_INFO.version_name},reqServerCheckBanCallBack,apiRetryAmount,onApiError,(function(t){return"success"==t.state||"time_err"==t.info||"sign_err"==t.info}))},window.reqServerCheckBanCallBack=function(t){if(t&&"success"===t.state&&t.data){var e=PF_INFO.selectedServer;e.channel_num=PF_INFO.channelNum,e.sign=String(t.data.login_sign),e.tick=parseInt(t.data.time),t.data.server_num?e.server_num=parseInt(t.data.server_num):e.server_num=parseInt(t.data.server_id),e.is_domain=0,e.cdn=PF_INFO.base_cdn,e.resver=t.data.cdn_version,e.server_options=t.data.server_options,t.data.max_create&&(e.max_create=parseInt(t.data.max_create)),console.log("server_options："+JSON.stringify(e.server_options)),1==PF_INFO.newRegister&&e.server_options&&1==e.server_options.show_btn&&(PF_INFO.showGetBtn=1,window.ServerLoading.instance.setShowBtn()),checkBanSuccess()}else if(PF_INFO.last_check_ban.step>=3){var i=t?t.state:"";window.toErrorAlarm(12,"User.checkInfo fail: "+i),onApiError(JSON.stringify(t)),window.loginAlert("User.checkInfo failed: "+i)}else sendApi(PF_INFO.apiurl,"User.login",{platform:PF_INFO.sdk_name,partner_id:PF_INFO.partnerId,token:PF_INFO.sdk_token,game_pkg:PF_INFO.pkgName,deviceId:PF_INFO.device_id,scene:"WX_"+PF_INFO.from_scene},(function(t){t&&"success"==t.state?(PF_INFO.php_sign=String(t.sign),PF_INFO.php_signtime=String(t.time),setTimeout((function(){req_server_check_ban(PF_INFO.last_check_ban.step+1,PF_INFO.last_check_ban.server_id)}),1500)):window.loginAlert(t.state)}),apiRetryAmount,onApiError,(function(t){return"success"==t.state||"failed"==t.state}))},window.checkBanSuccess=function(){ServerLoading.instance.openLoading(PF_INFO.newRegister),window.isCheckBan=!0,window.enterToGame()},window.initMain=function(){if(window.loadProbPkg&&window.loadMainPkg&&window.loadServerRes&&window.loadLoadingRes&&window.loadVersion&&window.loadServer&&!window.MainWX.instance){console.log("Main 初始化"+window.MainWX.instance);var t={cdn:window.PF_INFO.cdn,spareCdn:window.PF_INFO.spareCdn,newRegister:window.PF_INFO.newRegister,wxPC:window.PF_INFO.wxPC,wxIOS:window.PF_INFO.wxIOS,wxAndroid:window.PF_INFO.wxAndroid,wxParam:{limitLoad:window.PF_INFO.wxLimitLoad,benchmarkLevel:window.PF_INFO.wxBenchmarkLevel,wxFrom:0,wxSDKVersion:window.SDKVersion},configType:window.PF_INFO.configType,exposeType:window.PF_INFO.exposeType,scene:0,video_type:window.PF_INFO.video_type,ad_flag:window.PF_INFO.ad_flag};if(window.pkgOptions)for(var e in window.pkgOptions)t[e]||(t[e]=window.pkgOptions[e]);new window.MainWX(t,window.PF_INFO.lastVersion,window.workerJsURL)}},window.enterToGame=function(){if(window.loadProbPkg&&window.loadMainPkg&&window.loadServerRes&&window.loadLoadingRes&&window.loadVersion&&window.loadServer&&window.isCheckBan&&window.loadOption){if(wxHideLoading(),console.info("【登录】bEnterGame:"+window.bEnterGame+"  MainWX="+window.MainWX.instance),!window.bEnterGame){window.bEnterGame=!0,window.MainWX.instance||window.initMain();var t=0;if(window.SDKVersion>=1083){var e=qg.getMenuButtonBoundingClientRect();e&&(window.PF_INFO.wxPhone&&(t=e.top),console.info("MenuButton  top:"+e.top+",bottom:"+e.bottom+",left:"+e.left+",right:"+e.right+",width:"+e.width+",height:"+e.height))}else console.info("MenuButton  SDKVersion="+window.SDKVersion);var i={};for(const t in PF_INFO.selectedServer)i[t]=PF_INFO.selectedServer[t];var n={channel:window.PF_INFO.channel,account:window.PF_INFO.account,userId:window.PF_INFO.userId,cdn:window.PF_INFO.cdn,data:window.PF_INFO.data,package:window.PF_INFO.package,newRegister:window.PF_INFO.newRegister,pkgName:window.PF_INFO.pkgName,partnerId:window.PF_INFO.partnerId,platform_uid:window.PF_INFO.platform_uid,deviceId:window.PF_INFO.device_id,selectedServer:i,configType:window.PF_INFO.configType,exposeType:window.PF_INFO.exposeType,debugUsers:window.PF_INFO.debugUsers,wxMenuTop:t,wxShield:window.PF_INFO.wxShield,wx_channel:window.PF_INFO.wx_channel,zsy_tp_state:window.PF_INFO.zsy_tp_state};if(window.pkgOptions)for(var r in window.pkgOptions)n[r]=window.pkgOptions[r];window.MainWX.instance.initPlatdata(n),PF_INFO.selectedServer&&PF_INFO.selectedServer.server_id&&localStorage.setItem("LastSer_"+PF_INFO.pkgName+PF_INFO.account,PF_INFO.selectedServer.server_id)}}else console.info("【登录】loadProbPkg:"+window.loadProbPkg+",loadMainPkg:"+window.loadMainPkg+",loadServerRes:"+window.loadServerRes+",loadLoadingRes:"+window.loadLoadingRes+",loadVersion:"+window.loadVersion+",loadServer:"+window.loadServer+",isCheckBan:"+window.isCheckBan+",loadOption:"+window.loadOption)}},function(t,e){var i={game_id:"256",game_pkg:"tjqy_tjqyvivoxyx_DN",partner_id:"238",game_ver:"1.0.81",is_auth:!1,from:null,partner_label:"minvivo"};window.config=i;var n,r=(n={},{order_data:{},init:function(t,e){var i=t&&t.game_ver?t.game_ver:0;console.log("[SDK]CP调用init接口");var n,r=qg.getStorageSync({key:"9130_plat_uuid"});r?n=0:(r=this.uuid(16,32),qg.setStorageSync({key:"9130_plat_uuid",value:r}),n=1);var s=qg.getStorageSync({key:"9130_plat_idfv"});s||(s=this.uuid(16,32),qg.setStorageSync({key:"9130_plat_idfv",value:s}));var a="".scene?"".scene:"";n&&"".query&&"".query.ad_code&&qg.setStorageSync({key:"9130_plat_ad_code",value:"".query.ad_code});var h={install:n,scene:a};this.log("start",h);var l="".query&&"".query.invite?"".query.invite:"",c="".query&&"".query.invite_type?"".query.invite_type:"";l&&(o={invite:l,invite_type:c,is_new:n,scene:a}),i&&this.checkGameVersion(i,(function(t){console.log("[SDK]初始化回调：",t),e&&e(t)}))},login:function(t,e){var i=this,r=qg.getSystemInfoSync().platformVersionCode;n.login="function"==typeof e?e:null,r>=1063?qg.login().then(t=>{if(console.log("[SDK]登录回调",JSON.stringify(t)),t.data.token){h={token:t.data.token};var e=i.getPublicData();if(e.is_from_min=1,e.partner_data=JSON.stringify(h),o&&"object"==typeof o)for(var r in o)e[r]=o[r];var a=Date.now();qg.request({url:"https://"+s+"/partner/auth",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:e,success:function(t){if(console.log("[SDK]登录结果：",JSON.stringify(t)),c&&clearTimeout(c),200===t.statusCode){var e=t.data;if(e.state){var i={userid:e.data.user_id,account:e.data.nick_name,token:e.data.token,invite_uid:e.data.invite_uid||"",invite_nickname:e.data.invite_nickname||"",invite_head_img:e.data.invite_head_img||"",head_img:e.data.head_img||"",is_client:e.data.is_client||"0",ios_pay:e.data.ios_pay||"0"};try{qg.setStorageSync({key:"9130_plat_sdk_token",value:e.data.sdk_token}),qg.setStorageSync({key:"9130_plat_uid",value:e.data.user_id}),qg.setStorageSync({key:"9130_plat_username",value:e.data.username}),e.data.ext&&qg.setStorageSync({key:"9130_plat_session_key",value:e.data.ext})}catch(t){}n.login&&n.login(0,i)}else n.login&&n.login(1,{type:"qg.request.success",errMsg:e.msg,time:Date.now()-a,res:t})}else n.login&&n.login(1,{type:"qg.request.success",errMsg:"请求平台服务器失败！",time:Date.now()-a,res:t})},fail:function(t){console.log("[SDK]登录失败："+JSON.stringify(t)),u=!0,c&&clearTimeout(c),c=null,n.login&&n.login(1,{type:"qg.request.fail",errMsg:t.errMsg,time:Date.now()-a,res:t})}}),u||(c=setTimeout((function(){console.log("[SDK]登录超时"),n.login&&n.login(1,{type:"qg.request",errMsg:"登录超时20秒无返回",time:Date.now()-a}),n.login=null}),2e4))}else n.login&&n.login(1,{type:"qg.login.success",errMsg:t.errMsg})},t=>{console.log("[SDK]登录失败"+JSON.stringify(t)),n.login&&n.login(1,{type:"qg.login.fail",errMsg:"SDK登录失败"})}):n.login&&n.login(1,{errMsg:"SDK登录失败platformVersionCode="+r})},share:function(t){n.share="function"==typeof callback?callback:null;var e=t.type||"share";console.log("[SDK]CP调用分享 type="+e),this.logStartShare(e),qg.share({success:function(t){console.log("share success1",t)},fail:function(t,e){console.log("share fail1",e,t)},cancel:function(){console.log("取消分享")}})},logStartShare:function(t){var e=qg.getStorageSync({key:"9130_plat_sdk_token"});qg.request({url:"https://"+s+"/game/min/?ac=logStartShare",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:i.game_pkg,partner_id:i.partner_id,sdk_token:e,server_id:a?a.server_id:"",role_id:a?a.role_id:"",type:t},success:function(t){}})},checkGameVersion:function(t,e){console.log("[SDK]检查游戏版本"),n.check="function"==typeof e?e:null,qg.request({url:"https://"+s+"/game/min/?ac=checkGameVersion",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:i.game_pkg,partner_id:i.partner_id,game_ver:t},success:function(t){if(console.log("[SDK]获取游戏版本结果",JSON.stringify(t)),u=!0,l&&clearTimeout(l),l=null,200==t.statusCode){var e=t.data;e.state?n.check&&n.check(e.data):n.check&&n.check({develop:0})}else n.check&&n.check({develop:0})},fail:function(t){console.log("[SDK]获取游戏版本失败"),console.log(t),u=!0,l&&clearTimeout(l),l=null,n.check&&n.check({develop:0})}}),u||(l=setTimeout((function(){console.log("[SDK]获取游戏版本超时"),n.check&&n.check({develop:0}),n.check=null}),1e4))},updateShare:function(t,e,n,r,a,o){console.log("[SDK]分享过来的玩家上报给服务器");var h=qg.getStorageSync({key:"9130_plat_sdk_token"});qg.request({url:"https://"+s+"/game/min/?ac=updateShare",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_pkg:i.game_pkg,partner_id:i.partner_id,sdk_token:h,invite:t,invite_type:e,is_new:n,role_id:r,sever_id:a,scene:o},success:function(t){console.log("[SDK]上报分享结果返回:"),console.log(t)}})},pay:function(t,e){this.startPay(t,e)},startPay:function(t,e){console.log("[SDK]调起支付，CP传值：",JSON.stringify(t)),n.pay="function"==typeof e?e:null;var i=qg.getStorageSync({key:"9130_plat_sdk_token"});console.log(i,1010);var r=qg.getStorageSync({key:"9130_plat_session_key"});if(i||r){var a=qg.getSystemInfoSync(),o={cpbill:t.cpbill,productid:t.productid,productname:t.productname,productdesc:t.productdesc,serverid:t.serverid,servername:t.servername,roleid:t.roleid,rolename:t.rolename,rolelevel:t.rolelevel,price:t.price,extension:t.extension,sdk_token:i,session_key:r,platform:a.platform};this.order_data=o;var h=this.getPublicData();h.order_data=JSON.stringify(o),h.is_from_min=1,console.log(h,"支付参数"),qg.request({url:"https://"+s+"/partner/order",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:h,success:function(t){if(console.log("[SDK]完成创建订单",JSON.stringify(t)),200===t.statusCode){var e=t.data;console.log("[SDK]订单data",JSON.stringify(e)),e.state?qg.pay({orderInfo:JSON.stringify(e.data.pay_data),success:function(t){console.log("支付成功",t)},fail:function(t,e){console.log("支付失败",t,e)},complete:function(){console.log("支付完成")}}):n.pay&&n.pay(1,{errMsg:e.msg})}else n.pay&&n.pay(1,{errMsg:"下单失败！"})}})}else n.pay&&n.pay(1,{errMsg:"用户未登录，支付失败！"})},msgCheck:function(t,e){console.log("[SDK]查看文本是否有违规内容");var i={data:{}};i.data.state=1,i.statusCode=200,e&&e(i)},logCreateRole:function(t){var e=qg.getStorageSync({key:"9130_plat_uid"}),i=qg.getStorageSync({key:"9130_plat_username"}),n={};n.user_id=e,n.user_name=i,n.role_id=t.roleid,n.role_lev=t.rolelevel,n.role_name=t.rolename,n.server_id=t.serverid,t.roleid&&t.serverid&&(a={role_id:t.roleid,server_id:t.serverid}),this.log("create",n)},logEnterGame:function(t){var e=qg.getStorageSync({key:"9130_plat_uid"}),i=qg.getStorageSync({key:"9130_plat_username"}),n={};n.user_id=e,n.user_name=i,n.role_id=t.roleid,n.role_lev=t.rolelevel,n.role_name=t.rolename,n.server_id=t.serverid,t.roleid&&t.serverid&&(a={role_id:t.roleid,server_id:t.serverid}),this.log("enter",n),o&&this.updateShare(o.invite,o.invite_type,o.is_new,t.roleid,t.serverid,o.scene)},logRoleUpLevel:function(t){var e=qg.getStorageSync({key:"9130_plat_uid"}),i=qg.getStorageSync({key:"9130_plat_username"}),n={};n.user_id=e,n.user_name=i,n.role_id=t.roleid,n.role_lev=t.rolelevel,n.role_name=t.rolename,n.server_id=t.serverid,t.roleid&&t.serverid&&(a={role_id:t.roleid,server_id:t.serverid}),this.log("levelup",n)},uuid:function(t,e){var i,n,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||r.length,e)for(i=0;i<e;i++)s[i]=r[0|Math.random()*t];else for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",i=0;i<36;i++)s[i]||(n=0|16*Math.random(),s[i]=r[19==i?3&n|8:n]);return s.join("")},getPublicData:function(){var t=qg.getSystemInfoSync(),e=qg.getStorageSync({key:"9130_plat_uuid"}),n=qg.getStorageSync({key:"9130_plat_idfv"}),r=qg.getStorageSync({key:"9130_plat_ad_code"});return{game_id:i.game_id,game_pkg:i.game_pkg,partner_id:i.partner_id,ad_code:r,uuid:e,idfv:n,dname:t.model,mac:"0000",net_type:0==t.wifiSignal?"4G":"WIFI",os_ver:t.osVersionCode,sdk_ver:t.platformVersionCode,game_ver:i.game_ver,device:"android"==t.osType?1:2}},log:function(t,e){var i=this.getPublicData();for(var n in e)i[n]=e[n];console.log("[SDK]上报数据："+t),console.log(i),qg.request({url:"https://"+s+"/partner/h5Log/?type="+t+"&data="+encodeURIComponent(JSON.stringify(i))})},getDate:function(){var t=new Date;return t.getFullYear()+"-"+t.getMonth()+"-"+t.getDate()}}),s="sdk.sh9130.com",a=null,o=null,h={},l=null,c=null,u=!1;function d(t,e,i){t in r&&r[t](e,i)}window.AKSDK={},AKSDK.init=function(t,e){d("init",t,e)},AKSDK.login=function(t){d("login","",t)},AKSDK.pay=function(t,e){d("pay",t,e)},AKSDK.logCreateRole=function(t,e,i,n,r){d("logCreateRole",{serverid:t,servername:e,roleid:i,rolename:n,rolelevel:r})},AKSDK.logEnterGame=function(t,e,i,n,r){d("logEnterGame",{serverid:t,servername:e,roleid:i,rolename:n,rolelevel:r})},AKSDK.logRoleUpLevel=function(t,e,i,n,r){d("logRoleUpLevel",{serverid:t,servername:e,roleid:i,rolename:n,rolelevel:r})},AKSDK.getConfig=function(){return{game_id:i.game_id,game_pkg:i.game_pkg,partner_id:i.partner_id}},AKSDK.msgCheck=function(t,e){d("msgCheck",t,e)}},function(t,e,i){(function(n){var r,s,a,o,h,l,c=window.Laya=(s=window,document,a={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?a.__presubstr.call(this,t):a.__presubstr.call(this,t,0<e?e:this.length+e)},__init:function(t){t.forEach((function(t){t.__init$&&t.__init$()}))},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var n=0;n<t;n++)i[n]=e;return i},__extend:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=Object.getOwnPropertyDescriptor(e,i),r=n.get,s=n.set;r||s?r&&s?Object.defineProperty(t,i,n):(r&&Object.defineProperty(t,i,r),s&&Object.defineProperty(t,i,s)):t[i]=e[i]}function o(){a.un(this,"constructor",t)}o.prototype=e.prototype,t.prototype=new o,a.un(t.prototype,"__imps",a.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;for(var i in t=t||{},e)t[i]=e[i];return t},__package:function(t,e){if(!a.__packages[t]){a.__packages[t]=!0;var i=s,n=t.split(".");if(1<n.length)for(var r=0,o=n.length-1;r<o;r++)i=i[n[r]]||(i[n[r]]={});i[n[n.length-1]]||(i[n[n.length-1]]=e||{})}},__hasOwnProperty:function(t,e){return e=e||this,Object.hasOwnProperty.call(e,t)||function t(e,i){if(Object.hasOwnProperty.call(i.prototype,e))return!0;var n=i.prototype.__super;return null==n?null:t(e,n)}(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},interface:function(t,e){a.__package(t,{});var i=a.__internals,n=i[t]=i[t]||{self:t};if(e){var r=e.split(",");n.extend=[];for(var o=0;o<r.length;o++){var h=r[o];i[h]=i[h]||{self:h},n.extend.push(i[h])}}var l=s,c=t.split(".");for(o=0;o<c.length-1;o++)l=l[c[o]];l[c[c.length-1]]={__interface__:t}},class:function(t,e,i,n){if(i&&a.__extend(t,i),e)if(a.__package(e,t),a.__classmap[e]=t,0<e.indexOf(".")){if(0==e.indexOf("laya.")){var r=e.split(".");n=n||r[r.length-1],a[n]&&console.log("Warning!,this class["+n+"] already exist:",a[n]),a[n]=t}}else"Main"==e?s.Main=t:"MainWX"==e?s.MainWX=t:(a[e]&&console.log("Error!,this class["+e+"] already exist:",a[e]),a[e]=t);var o=a.un,h=t.prototype;o(h,"hasOwnProperty",a.__hasOwnProperty),o(h,"__class",t),o(h,"__super",i),o(h,"__className",e),o(t,"__super",i),o(t,"__className",e),o(t,"__isclass",!0),o(t,"super",(function(t){this.__super.call(t)}))},imps:function(t,e){if(!e)return null;var i=t.__imps||a.un(t,"__imps",{});function n(t){var e,r;if((e=a.__internals[t])&&(i[t]=!0,r=e.extend))for(var s=0;s<r.length;s++)n(r[s].self)}for(var r in e)n(r)},superSet:function(t,e,i,n){var r=t.prototype["_$set_"+i];r&&r.call(e,n)},superGet:function(t,e,i){var n=t.prototype["_$get_"+i];return n?n.call(e):null},getset:function(t,e,i,n,r){t?(n&&(e["_$GET_"+i]=n),r&&(e["_$SET_"+i]=r)):(n&&a.un(e,"_$get_"+i,n),r&&a.un(e,"_$set_"+i,r)),n&&r?Object.defineProperty(e,i,{get:n,set:r,enumerable:!1,configurable:!0}):(n&&Object.defineProperty(e,i,{get:n,enumerable:!1,configurable:!0}),r&&Object.defineProperty(e,i,{set:r,enumerable:!1,configurable:!0}))},static:function(t,e){for(var i=0,n=e.length;i<n;i+=2)if("length"==e[i])t.length=e[i+1].call(t);else{function r(){var n=e[i],r=e[i+1];Object.defineProperty(t,n,{get:function(){return delete this[n],this[n]=r.call(this)},set:function(t){delete this[n],this[n]=t},enumerable:!0,configurable:!0})}r()}},un:function(t,e,i){return i||(i=t[e]),a.__propun.value=i,Object.defineProperty(t,e,a.__propun),i},uns:function(t,e){e.forEach((function(e){a.un(t,e)}))}},s.console=s.console||{log:function(){}},s.trace=s.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),a);window,document,(l=c).un,l.uns,l.static,l.class,l.getset,l.__newvec,function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset;i.__newvec,i.interface("laya.runtime.IMarket"),i.interface("laya.filters.IFilter"),i.interface("laya.display.ILayout"),i.interface("laya.resource.IDispose"),i.interface("laya.runtime.IPlatform"),i.interface("laya.resource.IDestroy"),i.interface("laya.runtime.IConchNode"),i.interface("laya.filters.IFilterAction"),i.interface("laya.runtime.ICPlatformClass"),i.interface("laya.resource.ICreateResource"),i.interface("laya.runtime.IConchRenderObject"),i.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var a=function(){function e(){}return r(e,"laya.utils.RunDriver"),e.FILTER_ACTIONS=[],e.pixelRatio=-1,e._charSizeTestDiv=null,e.now=function(){return Date.now()},e.getWindow=function(){return t},e.getPixelRatio=function(){if(e.pixelRatio<0){var t=F.context,i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;(e.pixelRatio=(F.window.devicePixelRatio||1)/i)<1&&(e.pixelRatio=1)}return e.pixelRatio},e.getIncludeStr=function(t){return null},e.createShaderCondition=function(t){var e="(function() {return "+t+";})";return i._runScript(e)},e.fontMap=[],e.measureText=function(t,i){var n=e.hanzi.test(t);if(n&&e.fontMap[i])return e.fontMap[i];var r=F.context;r.font=i;var s=r.measureText(t);return s||(s={width:16,height:16}),n&&(e.fontMap[i]=s),s},e.getWebGLContext=function(t){},e.beginFlush=function(){},e.endFinish=function(){},e.addToAtlas=null,e.flashFlushImage=function(t){},e.drawToCanvas=function(t,e,i,n,r,s){var a=yt.create("2D"),o=new N(i,n,a);return L.renders[e]._fun(t,o,r,s),a},e.createParticleTemplate2D=null,e.createGLTextur=null,e.createWebGLContext2D=null,e.changeWebGLSize=function(t,e){},e.createRenderSprite=function(t,e){return new L(t,e)},e.createFilterAction=function(t){return new w},e.createGraphics=function(){return new f},e.clear=function(t){R._context.ctx.clear()},e.cancelLoadByUrl=function(t){},e.clearAtlas=function(t){},e.isAtlas=function(t){return!1},e.addTextureToAtlas=function(t){},e.getTexturePixels=function(t,e,i,n,r){return null},e.skinAniSprite=function(){return null},e.update3DLoop=function(){},n(e,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),e}(),o=(s(1,i,"alertGlobalError",null,(function(t){var e=0;F.window.onerror=t?function(t,i,n,r,s){e++<5&&s&&alert(s.stack||s)}:null})),i.init=function(t,e,n){for(var r=[],s=2,a=arguments.length;s<a;s++)r.push(arguments[s]);if(!i._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=i._arrayBufferSlice),i._isinit=!0,F.__init__(),B.__init__(),f.__init__(),i.timer=new j,i.scaleTimer=new j,i.loader=new ot,Q.__init__(),s=0;for(var o=r.length;s<o;s++)r[s].enable&&r[s].enable();return d.__init__(),u.__init__(),O.__init__(),V.beginCheck(),i._currentStage=i.stage=new gt,i.stage.conchModel&&i.stage.conchModel.setRootNode(),i._getUrlPath(),i.render=new R(0,0),i.stage.size(t,e),L.__init__(),g.__init__(),v.instance.__init__(i.stage,R.canvas),wt.__init__(),E.autoStopMusic=!0,A.__init__(),R.canvas}},i._getUrlPath=function(){var t=F.window.location,e=t.pathname;e=e&&":"==e.charAt(2)?e.substring(1):e,P.rootPath=P.basePath=P.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)},i._arrayBufferSlice=function(t,e){var i=new Uint8Array(this,t,e-t),n=new Uint8Array(i.length);return n.set(i),n.buffer},i._runScript=function(t){return F.window[i._evcode](t)},i.stage=null,i.timer=null,i.scaleTimer=null,i.loader=null,i.version="1.8.6",i.render=null,i._currentStage=null,i._isinit=!1,i.isDebug=!1,i.MiniAdpter={init:function(){t.navigator&&t.navigator.userAgent&&-1<t.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},n(i,["conchMarket",function(){return this.conchMarket=t.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=t.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function t(){}return r(t,"Config"),t.WebGLTextCacheCount=500,t.atlasEnable=!1,t.showCanvasMark=!1,t.animationInterval=50,t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t}()),h=function(){function t(){this._events=null}r(t,"laya.events.EventDispatcher");var e=t.prototype;return e.hasListener=function(t){return!(!this._events||!this._events[t])},e.getListener=function(t){return this._events?this._events[t]:null},e.event=function(e,n){if(!this._events||!this._events[e])return!1;var r=this._events[e];if(r.lock)r.queue||(r.queue=[]),r.queue.push(n);else{var s;for(r.lock=!0,r.cursor=r.head;r.cursor;)(s=r.cursor).recover?(r.head=r.tail=r.cursor=null,console.error("node is recover："+s.id)):(r.cursor=s.next,s.once&&t.delNode(r,s),s.method&&(null!=n?s.args?s.method.apply(s.caller,s.args.concat(n)):n instanceof Array?s.method.apply(s.caller,n):s.caller?s.method.call(s.caller,n):i.recordError("事件派发错误","node.caller:"+s.caller+"node.method:"+s.method+"data:"+n+"node.prev"+s.prev):s.method.apply(s.caller,s.args)),s.once&&t.recoverHandler(s));r.lock=!1,!r.head&&this._events&&this._events[e]==r&&delete this._events[e],r.queue&&r.queue.length&&this.event(e,r.queue.shift())}return!0},e.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)},e.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)},e._createListener=function(e,i,n,r,s,a){void 0===a&&(a=!0),a&&this.off(e,i,n,s);var o=t.createHandler(i||this,n,r,s);this._events||(this._events={});var h=this._events,l=h[e];return l?l.tail?(o.prev=l.tail,l.tail.next=o,l.tail=o):l.head=l.tail=o:h[e]={head:o,tail:o,cursor:null,lock:!1},this},e.off=function(e,i,n,r){if(void 0===r&&(r=!1),!this._events||!this._events[e])return this;for(var s=this._events[e],a=s.head;a;){if((!i||a.caller===i)&&a.method===n&&(!r||a.once)){t.delNode(s,a),s.cursor==a&&(s.cursor=a.next),t.recoverHandler(a);break}a=a.next}return this},e.offAll=function(t){var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},e._recoverHandlers=function(e){if(e){for(var i=e.head;i;){t.delNode(e,i);var n=i.next;t.recoverHandler(i),i=n}e.cursor=null}},e.isMouseEvent=function(e){return t.MOUSE_EVENTS[e]},t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},t.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},t.delNode=function(t,e){e.prev?e.prev.next=e.next:t.head=e.next,e.next?e.next.prev=e.prev:t.tail=e.prev},t.createHandler=function(e,n,r,s){var a=500<t._freeHandler.length?t._freeHandler.shift():null;if(a)if(a.recover)a.recover=!1,a.caller=e,a.method=n,a.args=r,a.once=s;else{var o="";try{arguments.propertyIsEnumerable.caller}catch(e){o=e.stack}var h=a.caller?(a.caller.__proto__&&a.caller.__proto__.constructor&&a.caller.__proto__.constructor.name)+"|"+a.caller.__className+"|"+a.caller.name:"",l=a.method?a.method.name:"";i.recordError("EventDispatcher重复创建","caller="+h+"  method="+l+"  stack="+o),a={id:++t._nodeCount,caller:e,method:n,args:r,once:s,recover:!1}}else a={id:++t._nodeCount,caller:e,method:n,args:r,once:s,recover:!1};return a.prev=a.next=null,a},t.recoverHandler=function(e){if(e.recover){if(t._errorCount<5){t._errorCount++;var n="";try{arguments.propertyIsEnumerable.caller}catch(e){n=e.stack}var r=e.caller?(e.caller.__proto__&&e.caller.__proto__.constructor&&e.caller.__proto__.constructor.name)+"|"+e.caller.__className+"|"+e.caller.name:"",s=e.method?e.method.name:"";i.recordError("EventDispatcher重复回收","id="+e.id+"  caller="+r+"  method="+s+"  stack="+n)}e.caller=e.method=e.args=e.prev=null}else e.recover=!0,e.caller=e.method=e.args=e.prev=e.next=null,t._freeHandler&&t._freeHandler.length<3e3&&t._freeHandler.push(e)},t._freeHandler=[],t._nodeCount=0,t._errorCount=0,t}(),l=function(){function t(t,e,i,n){this.once=!1,void(this._id=0)===n&&(n=!1),this.setTo(t,e,i,n)}r(t,"laya.utils.Handler");var e=t.prototype;return e.setTo=function(e,i,n,r){return this._id=t._gid++,this.caller=e,this.method=i,this.args=n,this.once=r,this},e.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},e.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},e.clear=function(){return this.caller=null,this.method=null,this.args=null,this},e.recover=function(){0<this._id&&(this._id=0,this.clear())},t.create=function(e,i,n,r){return void 0===r&&(r=!0),new t(e,i,n,r)},t._gid=1,t}(),c=function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}r(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,i.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],l.create(this,this.onLoaded))},e.onLoaded=function(){this.parseFont(at.getRes(this._path),at.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(t,e);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var n,r=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n=t.getElementsByTagName("char");var s=0;for(s=0;s<n.length;s++){var a=n[s],o=parseInt(a.getAttributeNode("id").nodeValue),h=parseInt(a.getAttributeNode("xoffset").nodeValue)/1,l=parseInt(a.getAttributeNode("yoffset").nodeValue)/1,c=parseInt(a.getAttributeNode("xadvance").nodeValue)/1,u=new I;u.x=parseInt(a.getAttributeNode("x").nodeValue),u.y=parseInt(a.getAttributeNode("y").nodeValue),u.width=parseInt(a.getAttributeNode("width").nodeValue),u.height=parseInt(a.getAttributeNode("height").nodeValue);var d=lt.create(e,u.x,u.y,u.width,u.height,h,l);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[o]=d,this._fontWidthMap[o]=c}}},e.parseFont2=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var n=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];var r=t.getElementsByTagName("char"),s=0;for(s=0;s<r.length;s++){var a=r[s].attributes,o=parseInt(a.id.nodeValue),h=parseInt(a.xoffset.nodeValue)/1,l=parseInt(a.yoffset.nodeValue)/1,c=parseInt(a.xadvance.nodeValue)/1,u=new I;u.x=parseInt(a.x.nodeValue),u.y=parseInt(a.y.nodeValue),u.width=parseInt(a.width.nodeValue),u.height=parseInt(a.height.nodeValue);var d=lt.create(e,u.x,u.y,u.width,u.height,h,l);this._maxWidth=Math.max(this._maxWidth,c+this.letterSpacing),this._fontCharDic[o]=d,this._fontWidthMap[o]=c}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "==t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e.drawText=function(t,e,i,n,r,s){var a,o=this.getTextWidth(t),h=0;"center"===r&&(h=(s-o)/2),"right"===r&&(h=s-o);for(var l=0,c=0,u=t.length;c<u;c++)(a=this.getCharTexture(t.charAt(c)))&&(e.graphics.drawTexture(a,i+l+h,n),l+=this.getCharWidth(t.charAt(c)))},t}(),u=function(){function t(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=t._TF_EMPTY}r(t,"laya.display.css.Style");var e=t.prototype;return e.getTransform=function(){return this._tf},e.setTransform=function(e){this._tf="none"!==e&&e?e:t._TF_EMPTY},e.setTranslateX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.translateX=e},e.setTranslateY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.translateY=e},e.setScaleX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.scaleX=e},e.setScale=function(e,i){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.scaleX=e,this._tf.scaleY=i},e.setScaleY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.scaleY=e},e.setRotate=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.rotate=e},e.setSkewX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.skewX=e},e.setSkewY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new _),this._tf.skewY=e},e.destroy=function(){this.scrollRect=null},e.render=function(t,e,i,n){},e.getCSSStyle=function(){return tt.EMPTY},e._enableLayout=function(){return!1},s(0,e,"scaleX",(function(){return this._tf.scaleX}),(function(t){this.setScaleX(t)})),s(0,e,"transform",(function(){return this.getTransform()}),(function(t){this.setTransform(t)})),s(0,e,"translateX",(function(){return this._tf.translateX}),(function(t){this.setTranslateX(t)})),s(0,e,"translateY",(function(){return this._tf.translateY}),(function(t){this.setTranslateY(t)})),s(0,e,"scaleY",(function(){return this._tf.scaleY}),(function(t){this.setScaleY(t)})),s(0,e,"block",(function(){return 0!=(1&this._type)})),s(0,e,"skewY",(function(){return this._tf.skewY}),(function(t){this.setSkewY(t)})),s(0,e,"rotate",(function(){return this._tf.rotate}),(function(t){this.setRotate(t)})),s(0,e,"skewX",(function(){return this._tf.skewX}),(function(t){this.setSkewX(t)})),s(0,e,"paddingLeft",(function(){return 0})),s(0,e,"paddingTop",(function(){return 0})),s(0,e,"absolute",(function(){return!0})),t.__init__=function(){t._TF_EMPTY=new _,t.EMPTY=new t},t.EMPTY=null,t._TF_EMPTY=null,t}(),d=function(){function t(e){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=H.create(t.defaultColor),this.family=t.defaultFamily,this.stroke=t._STROKE,this.size=t.defaultSize,e&&e!==t.EMPTY&&e.copyTo(this)}r(t,"laya.display.css.Font");var e=t.prototype;return e.set=function(t){this._text=null;for(var e=t.split(" "),i=0,n=e.length;i<n;i++){var r=e[i];switch(r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<r.indexOf("px")&&(this.size=parseInt(r),this.family=e[i+1],i++)}},e.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},e.copyTo=function(e){e._type=this._type,e._text=this._text,e._weight=this._weight,e._color=this._color,e.family=this.family,e.stroke=this.stroke!=t._STROKE?this.stroke.slice():t._STROKE,e.indent=this.indent,e.size=this.size},s(0,e,"password",(function(){return 0!=(1024&this._type)}),(function(t){t?this._type|=1024:this._type&=-1025})),s(0,e,"color",(function(){return this._color.strColor}),(function(t){this._color=H.create(t)})),s(0,e,"italic",(function(){return 0!=(512&this._type)}),(function(t){t?this._type|=512:this._type&=-513})),s(0,e,"bold",(function(){return 0!=(2048&this._type)}),(function(t){t?this._type|=2048:this._type&=-2049})),s(0,e,"weight",(function(){return""+this._weight}),(function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0,e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=parseInt(t)}this._weight=e,this._text=null})),s(0,e,"decoration",(function(){return this._decoration?this._decoration.value:null}),(function(t){var e=t.split(" ");switch(this._decoration||(this._decoration={}),e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=H.create(e)),this._decoration.value=t})),t.__init__=function(){t.EMPTY=new t(null)},t.EMPTY=null,t.defaultColor="#000000",t.defaultSize=12,t.defaultFamily="Arial",t.defaultFont="12px Arial",t._STROKE=[0,"#000000"],t._ITALIC=512,t._PASSWORD=1024,t._BOLD=2048,t}(),_=function(){function t(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return r(t,"laya.display.css.TransformInfo"),t}(),f=function(){function e(){this._one=null,this._cmds=null,this._render=this._renderEmpty,R.isConchNode&&(this._nativeObj=new t._conchGraphics,this.id=this._nativeObj.conchID)}r(e,"laya.display.Graphics");var n=e.prototype;return n.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},n.clear=function(t){void 0===t&&(t=!1);var i=0,n=0;if(t){var r=this._one;if(this._cmds){for(n=this._cmds.length,i=0;i<n;i++)!(r=this._cmds[i])||r.callee!==R._context._drawTexture&&r.callee!==R._context._drawTextureWithTransform||(r[0]=null,e._cache.push(r));this._cmds.length=0}else r&&(!r||r.callee!==R._context._drawTexture&&r.callee!==R._context._drawTextureWithTransform||(r[0]=null,e._cache.push(r)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(i=0,n=this._vectorgraphArray.length;i<n;i++)Z.getInstance().deleteShape(this._vectorgraphArray[i]);this._vectorgraphArray.length=0}},n._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},n._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new p,this._graphicBounds._graphics=this)},n._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},n._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},n.getBounds=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(t)},n.getBoundPoints=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)},n._addCmd=function(t){this._cmds=this._cmds||[],t.callee=t.shift(),this._cmds.push(t)},n.setFilters=function(t){this._saveToCmd(R._context._setFilters,t)},n.drawTexture=function(t,i,n,r,s,a,o){if(void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=1),!t||o<.01)return null;r||(r=t.sourceWidth),s||(s=t.sourceHeight),o=o<0?0:1<o?1:o;var h,l=!R.isWebGL&&(F.onFirefox||F.onEdge||F.onIE||F.onSafari)?.5:0,c=r/t.sourceWidth,u=s/t.sourceHeight;return r=t.width*c,s=t.height*u,t.loaded&&(r<=0||s<=0)?null:(i+=t.offsetX*c,n+=t.offsetY*u,this._sp&&(this._sp._renderType|=512),i-=l,n-=l,r+=2*l,s+=2*l,e._cache.length?((h=e._cache.pop())[0]=t,h[1]=i,h[2]=n,h[3]=r,h[4]=s,h[5]=a,h[6]=o):h=[t,i,n,r,s,a,o],h.callee=a||1!=o?R._context._drawTextureWithTransform:R._context._drawTexture,null!=this._one||a||1!=o?this._saveToCmd(h.callee,h):(this._one=h,this._render=this._renderOneImg),t.loaded||t.once("loaded",this,this._textureLoaded,[t,h]),this._repaint(),h)},n.cleanByTexture=function(t,e,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),!t)return this.clear();if(this._one&&this._render===this._renderOneImg){n||(n=t.sourceWidth),r||(r=t.sourceHeight);var s=n/t.sourceWidth,a=r/t.sourceHeight;n=t.width*s,r=t.height*a,e+=t.offsetX*s,i+=t.offsetY*a,this._one[0]=t,this._one[1]=e,this._one[2]=i,this._one[3]=n,this._one[4]=r,this._repaint()}else this.clear(),t&&this.drawTexture(t,e,i,n,r)},n.drawTextures=function(t,e){t&&this._saveToCmd(R._context._drawTextures,[t,e])},n.fillTexture=function(t,e,i,n,r,s,a){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s="repeat"),t){var o=[t,e,i,n,r,s,a||M.EMPTY,{}];t.loaded||t.once("loaded",this,this._textureLoaded,[t,o]),this._saveToCmd(R._context._fillTexture,o)}},n._textureLoaded=function(t,e){e[3]=e[3]||t.width,e[4]=e[4]||t.height,this._repaint()},n.fillCircle=function(t,e,i,n,r,s,a){i.bitmap.enableMerageInAtlas=!1;var o=new Float32Array(2*(a+1)),h=new Float32Array(2*(a+1)),l=new Uint16Array(3*a),c=2*Math.PI/a,u=0;o[0]=n,o[1]=r,h[0]=n/i.width,h[1]=r/i.height;for(var d=2,_=0;_<a;_++){var f=s*Math.cos(u)+n,p=s*Math.sin(u)+r;o[d]=f,o[d+1]=p,h[d]=f/i.width,h[d+1]=p/i.height,u+=c,d+=2}for(_=d=0;_<a;_++)l[d++]=0,l[d++]=_+1,l[d++]=a+1<=_+2?1:_+2;this.drawTriangles(i,t,e,o,h,l)},n.drawTriangles=function(t,e,i,n,r,s,a,o,h,l){void 0===o&&(o=1),this._saveToCmd(R._context.drawTriangles,[t,e,i,n,r,s,a,o,h,l])},n._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=e,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),e.callee=t,this._repaint(),e},n.clipRect=function(t,e,i,n){this._saveToCmd(R._context._clipRect,[t,e,i,n])},n.fillText=function(t,e,i,n,r,s,a){void 0===a&&(a=0),this._saveToCmd(R._context._fillText,[t,e,i,n||d.defaultFont,r,s])},n.fillBorderText=function(t,e,i,n,r,s,a,o){this._saveToCmd(R._context._fillBorderText,[t,e,i,n||d.defaultFont,r,s,a,o])},n.strokeText=function(t,e,i,n,r,s,a){this._saveToCmd(R._context._strokeText,[t,e,i,n||d.defaultFont,r,s,a])},n.alpha=function(t){t=t<0?0:1<t?1:t,this._saveToCmd(R._context._alpha,[t])},n.setAlpha=function(t){t=t<0?0:1<t?1:t,this._saveToCmd(R._context._setAlpha,[t])},n.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(R._context._transform,[t,e,i])},n.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(R._context._rotate,[t,e,i])},n.scale=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(R._context._scale,[t,e,i,n])},n.translate=function(t,e){this._saveToCmd(R._context._translate,[t,e])},n.save=function(){this._saveToCmd(R._context._save,[])},n.restore=function(){this._saveToCmd(R._context._restore,[])},n.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;-1<i;i--)if(this._isTextCmd(e[i].callee))return e[i][0].toUpperCase?e[i][0]=t:e[i][0].setText(t),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=t:this._one[0].setText(t),!0;return!1},n._isTextCmd=function(t){return t===R._context._fillText||t===R._context._fillBorderText||t===R._context._strokeText},n.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;-1<i;i--)this._isTextCmd(e[i].callee)&&(e[i][4]=t,e[i][0].toUpperCase||(e[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=t,this._one[0].toUpperCase||(this._one[0].changed=!0))},n.loadImage=function(t,e,n,r,s,a){var o=this;void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0);var h=at.getRes(t);function c(t){t&&(o.drawTexture(t,e,n,r,s),null!=a&&a.call(o._sp,t))}h?c(h):i.loader.load(t,l.create(null,c),null,"image")},n._renderEmpty=function(t,e,i,n){},n._renderAll=function(t,e,i,n){for(var r,s=this._cmds,a=0,o=s.length;a<o;a++)(r=s[a]).callee.call(e,i,n,r)},n._renderOne=function(t,e,i,n){this._one.callee.call(e,i,n,this._one)},n._renderOneImg=function(t,e,i,n){this._one.callee.call(e,i,n,this._one),2305!==t._renderType&&(t._renderType|=1)},n.drawLine=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=0;R.isWebGL&&(a=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a));var o=s%2==0?0:.5,h=[t+o,e+o,i+o,n+o,r,s,a];this._saveToCmd(R._context._drawLine,h)},n.drawLines=function(t,e,i,n,r){void 0===r&&(r=1);var s=0;if(i&&!(i.length<4)){R.isWebGL&&(s=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(s));var a=r%2==0?0:.5,o=[t+a,e+a,i,n,r,s];this._saveToCmd(R._context._drawLines,o)}},n.drawCurves=function(t,e,i,n,r){void 0===r&&(r=1);var s=[t,e,i,n,r];this._saveToCmd(R._context._drawCurves,s)},n.drawRect=function(t,e,i,n,r,s,a){void 0===a&&(a=1);var o=s?a/2:0,h=s?a:0,l=[t+o,e+o,i-h,n-h,r,s,a];this._saveToCmd(R._context._drawRect,l)},n.drawCircle=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=r?s/2:0,o=0;R.isWebGL&&(o=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o));var h=[t,e,i-a,n,r,s,o];this._saveToCmd(R._context._drawCircle,h)},n.drawPie=function(t,e,i,n,r,s,a,o){void 0===o&&(o=1);var h=a?o/2:0,l=a?o:0,c=0;R.isWebGL&&(c=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(c));var u=[t+h,e+h,i-l,n,r,s,a,o,c];u[3]=q.toRadian(n),u[4]=q.toRadian(r),this._saveToCmd(R._context._drawPie,u)},n.drawPoly=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=0,o=!1;R.isWebGL&&(a=Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a),o=!(6<i.length));var h=r?s%2==0?0:.5:0,l=[t+h,e+h,i,n,r,s,a,o];this._saveToCmd(R._context._drawPoly,l)},n.drawPath=function(t,e,i,n,r){var s=[t,e,i,n,r];this._saveToCmd(R._context._drawPath,s)},s(0,n,"cmds",(function(){return this._cmds}),(function(t){this._sp&&(this._sp._renderType|=512),this._cmds=t,this._render=this._renderAll,this._repaint()})),e.__init__=function(){if(R.isConchNode){for(var t=laya.display.Graphics.prototype,e=F.window.ConchGraphics.prototype,i=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],n=0,r=i.length;n<=r;n++){var s=i[n];t[s]=e[s]}t._saveToCmd=null,e.drawImageS&&(t.drawTextures=function(t,e){if(t&&t.loaded&&t.bitmap&&t.source){var i=t.uv,n=t.bitmap.width,r=t.bitmap.height;this.drawImageS(t.bitmap.source,i[0]*n,i[1]*r,(i[2]-i[0])*n,(i[5]-i[3])*r,t.offsetX,t.offsetY,t.width,t.height,e)}}),t.drawTexture=function(t,e,i,n,r,s,a){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),t)if(t.loaded){if(t.loaded&&t.bitmap&&t.source&&(n||(n=t.sourceWidth),r||(r=t.sourceHeight),a=a<0?0:1<a?1:a,n=n-t.sourceWidth+t.width,r=r-t.sourceHeight+t.height,!(n<=0||r<=0))){e+=t.offsetX,i+=t.offsetY;var o=t.uv,h=t.bitmap.width,l=t.bitmap.height;o[4]<o[0]&&o[5]<o[1]?this.drawImageM(t.bitmap.source,o[4]*h,o[5]*l,(o[0]-o[4])*h,(o[1]-o[5])*l,e,i,n,r,s,a):this.drawImageM(t.bitmap.source,o[0]*h,o[1]*l,(o[2]-o[0])*h,(o[5]-o[3])*l,e,i,n,r,s,a),this._repaint()}}else t.once("loaded",this,(function(){this.drawTexture(t,e,i,n,r,s)}))},t.fillTexture=function(t,e,i,n,r,s,a){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s="repeat"),t&&t.loaded){var o,h=R._context.ctx,l=t.bitmap.width,c=t.bitmap.height,u=t.uv;o=t.uv!=lt.DEF_UV?h.createPattern(t.bitmap.source,s,u[0]*l,u[1]*c,(u[2]-u[0])*l,(u[5]-u[3])*c):h.createPattern(t.bitmap.source,s);var d=0,_=0;a&&(e+=a.x%t.width,i+=a.y%t.height,d-=a.x%t.width,_-=a.y%t.height),this._fillImage(o,e,i,d,_,n,r)}}}},e._cache=[],e}(),p=function(){function t(){this._cacheBoundsType=!1}r(t,"laya.display.GraphicsBounds");var e=t.prototype;return e.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},e.reset=function(){this._temp&&(this._temp.length=0)},e.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=I._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},e.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=q.copyArray(this._rstBoundPoints,this._temp)},e._getCmdPoints=function(e){void 0===e&&(e=!1);var i,n,r=R._context,s=this._graphics.cmds;if((i=this._temp||(this._temp=[])).length=0,s||null==this._graphics._one||(t._tempCmds.length=0,t._tempCmds.push(this._graphics._one),s=t._tempCmds),!s)return i;(n=t._tempMatrixArrays).length=0;var a=t._initMatrix;a.identity();for(var o,h,l=t._tempMatrix,c=NaN,u=NaN,d=NaN,_=NaN,f=NaN,p=NaN,m=0,g=s.length;m<g;m++)if((o=s[m]).callee)switch(o.callee){case r._save:case 7:n.push(a),a=a.clone();break;case r._restore:case 8:a=n.pop();break;case r._scale:case 5:l.identity(),l.translate(-o[2],-o[3]),l.scale(o[0],o[1]),l.translate(o[2],o[3]),this._switchMatrix(a,l);break;case r._rotate:case 3:l.identity(),l.translate(-o[1],-o[2]),l.rotate(o[0]),l.translate(o[1],o[2]),this._switchMatrix(a,l);break;case r._translate:case 6:l.identity(),l.translate(o[0],o[1]),this._switchMatrix(a,l);break;case r._transform:case 4:l.identity(),l.translate(-o[1],-o[2]),l.concat(o[0]),l.translate(o[1],o[2]),this._switchMatrix(a,l);break;case 16:case 24:t._addPointArrToRst(i,I._getBoundPointS(o[0],o[1],o[2],o[3]),a);break;case 17:a.copyTo(l),l.concat(o[4]),t._addPointArrToRst(i,I._getBoundPointS(o[0],o[1],o[2],o[3]),l);break;case r._drawTexture:h=o[0],e?o[3]&&o[4]?t._addPointArrToRst(i,I._getBoundPointS(o[1],o[2],o[3],o[4]),a):(h=o[0],t._addPointArrToRst(i,I._getBoundPointS(o[1],o[2],h.width,h.height),a)):(c=(o[3]||h.sourceWidth)/h.width,u=(o[4]||h.sourceHeight)/h.height,d=c*h.sourceWidth,_=u*h.sourceHeight,f=0<h.offsetX?h.offsetX:0,p=0<h.offsetY?h.offsetY:0,f*=c,p*=u,t._addPointArrToRst(i,I._getBoundPointS(o[1]-f,o[2]-p,d,_),a));break;case r._fillTexture:o[3]&&o[4]?t._addPointArrToRst(i,I._getBoundPointS(o[1],o[2],o[3],o[4]),a):(h=o[0],t._addPointArrToRst(i,I._getBoundPointS(o[1],o[2],h.width,h.height),a));break;case r._drawTextureWithTransform:var v;v=o[5]?(a.copyTo(l),l.concat(o[5]),l):a,e?o[3]&&o[4]?t._addPointArrToRst(i,I._getBoundPointS(o[1],o[2],o[3],o[4]),v):(h=o[0],t._addPointArrToRst(i,I._getBoundPointS(o[1],o[2],h.width,h.height),v)):(h=o[0],c=(o[3]||h.sourceWidth)/h.width,u=(o[4]||h.sourceHeight)/h.height,d=c*h.sourceWidth,_=u*h.sourceHeight,f=0<h.offsetX?h.offsetX:0,p=0<h.offsetY?h.offsetY:0,f*=c,p*=u,t._addPointArrToRst(i,I._getBoundPointS(o[1]-f,o[2]-p,d,_),v));break;case r._drawRect:case 13:t._addPointArrToRst(i,I._getBoundPointS(o[0],o[1],o[2],o[3]),a);break;case r._drawCircle:case r._fillCircle:case 14:t._addPointArrToRst(i,I._getBoundPointS(o[0]-o[2],o[1]-o[2],o[2]+o[2],o[2]+o[2]),a);break;case r._drawLine:case 20:var y;t._tempPoints.length=0,y=.5*o[5],o[0]==o[2]?t._tempPoints.push(o[0]+y,o[1],o[2]+y,o[3],o[0]-y,o[1],o[2]-y,o[3]):o[1]==o[3]?t._tempPoints.push(o[0],o[1]+y,o[2],o[3]+y,o[0],o[1]-y,o[2],o[3]-y):t._tempPoints.push(o[0],o[1],o[2],o[3]),t._addPointArrToRst(i,t._tempPoints,a);break;case r._drawCurves:case 22:t._addPointArrToRst(i,b.I.getBezierPoints(o[2]),a,o[0],o[1]);break;case r._drawPoly:case r._drawLines:case 18:t._addPointArrToRst(i,o[2],a,o[0],o[1]);break;case r._drawPath:case 19:t._addPointArrToRst(i,this._getPathPoints(o[2]),a,o[0],o[1]);break;case r._drawPie:case 15:t._addPointArrToRst(i,this._getPiePoints(o[0],o[1],o[2],o[3],o[4]),a)}return 200<i.length?i=q.copyArray(i,I._getWrapRec(i)._getBoundPoints()):8<i.length&&(i=S.scanPList(i)),i},e._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},e._getPiePoints=function(e,i,n,r,s){var a=t._tempPoints;t._tempPoints.length=0,a.push(e,i);var o=(s-r)%(2*Math.PI)/10,h=NaN,l=r;for(h=0;h<=10;h++)a.push(e+n*Math.cos(l),i+n*Math.sin(l)),l+=o;return a},e._getPathPoints=function(e){var i,n,r=0,s=t._tempPoints;for(s.length=0,i=e.length,r=0;r<i;r++)1<(n=e[r]).length&&(s.push(n[1],n[2]),3<n.length&&s.push(n[3],n[4]));return s},t._addPointArrToRst=function(e,i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0);var a,o=0;for(a=i.length,o=0;o<a;o+=2)t._addPointToRst(e,i[o]+r,i[o+1]+s,n)},t._addPointToRst=function(t,e,i,n){var r=M.TEMP;r.setTo(e||0,i||0),n.transformPoint(r),t.push(r.x,r.y)},t._tempPoints=[],t._tempMatrixArrays=[],t._tempCmds=[],n(t,["_tempMatrix",function(){return this._tempMatrix=new C},"_initMatrix",function(){return this._initMatrix=new C}]),t}(),m=function(){function t(){}r(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},s(0,e,"stageY",(function(){return i.stage.mouseY})),s(0,e,"charCode",(function(){return this.nativeEvent.charCode})),s(0,e,"touches",(function(){var t=this.nativeEvent.touches;if(t)for(var e=i.stage,n=0,r=t.length;n<r;n++){var s=t[n],a=M.TEMP;a.setTo(s.clientX,s.clientY),e._canvasTransform.invertTransformPoint(a),e.transform.invertTransformPoint(a),s.stageX=a.x,s.stageY=a.y}return t})),s(0,e,"keyLocation",(function(){return this.nativeEvent.keyLocation})),s(0,e,"ctrlKey",(function(){return this.nativeEvent.ctrlKey})),s(0,e,"altKey",(function(){return this.nativeEvent.altKey})),s(0,e,"shiftKey",(function(){return this.nativeEvent.shiftKey})),s(0,e,"stageX",(function(){return i.stage.mouseX})),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.INITED="inited",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.ENABLE_CHANGED="enablechanged",t.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.LAYER_CHANGED="layerchanged",t.HIERARCHY_LOADED="hierarchyloaded",t.RECOVERED="recovered",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.MESH_CHANGED="meshchanged",t.MATERIAL_CHANGED="materialchanged",t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",t.ANIMATION_CHANGED="animationchanged",t.TRIGGER_ENTER="triggerenter",t.TRIGGER_STAY="triggerstay",t.TRIGGER_EXIT="triggerexit",t.TRAIL_FILTER_CHANGE="trailfilterchange",t.DOMINO_FILTER_CHANGE="dominofilterchange",t}(),g=(function(){function t(){}r(t,"laya.events.Keyboard"),t.NUMBER_0=48,t.NUMBER_1=49,t.NUMBER_2=50,t.NUMBER_3=51,t.NUMBER_4=52,t.NUMBER_5=53,t.NUMBER_6=54,t.NUMBER_7=55,t.NUMBER_8=56,t.NUMBER_9=57,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.NUMPAD=21,t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_ADD=107,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.NUMPAD_ENTER=108,t.NUMPAD_MULTIPLY=106,t.NUMPAD_SUBTRACT=109,t.SEMICOLON=186,t.EQUAL=187,t.COMMA=188,t.MINUS=189,t.PERIOD=190,t.SLASH=191,t.BACKQUOTE=192,t.LEFTBRACKET=219,t.BACKSLASH=220,t.RIGHTBRACKET=221,t.QUOTE=222,t.ALTERNATE=18,t.BACKSPACE=8,t.CAPS_LOCK=20,t.COMMAND=15,t.CONTROL=17,t.DELETE=46,t.ENTER=13,t.ESCAPE=27,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.SHIFT=16,t.SPACE=32,t.TAB=9,t.INSERT=45}(),function(){function t(){}return r(t,"laya.events.KeyBoardManager"),t.__init__=function(){t._addEvent("keydown"),t._addEvent("keypress"),t._addEvent("keyup")},t._addEvent=function(t){F.document.addEventListener(t,(function(e){laya.events.KeyBoardManager._dispatch(e,t)}),!0)},t._dispatch=function(e,n){if(t.enabled){t._event._stoped=!1,t._event.nativeEvent=e,t._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===n?t._pressKeys[t._event.keyCode]=!0:"keyup"===n&&(t._pressKeys[t._event.keyCode]=null);for(var r=i.stage.focus&&null!=i.stage.focus.event&&i.stage.focus.displayedInStage?i.stage.focus:i.stage,s=r;s;)s.event(n,t._event.setTo(n,s,r)),s=s.parent}},t.hasKeyDown=function(e){return t._pressKeys[e]},t._pressKeys={},t.enabled=!0,n(t,["_event",function(){return this._event=new m}]),t}()),v=(function(){function t(){}r(t,"laya.events.KeyLocation"),t.STANDARD=0,t.LEFT=1,t.RIGHT=2,t.NUM_PAD=3}(),function(){function t(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=F.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new m,this._matrix=new C,this._point=new M,this._rect=new I,this._prePoint=new M,this._curTouchID=NaN}r(t,"laya.events.MouseManager");var e=t.prototype;return e.__init__=function(e,i){var n=this;this._stage=e;var r=this,s=this._eventList;i.oncontextmenu=function(e){if(t.enabled)return!1},i.addEventListener("mousedown",(function(e){t.enabled&&(F.onIE||e.preventDefault(),s.push(e),r.mouseDownTime=F.now())})),i.addEventListener("mouseup",(function(e){t.enabled&&(e.preventDefault(),s.push(e),r.mouseDownTime=-F.now())}),!0),i.addEventListener("mousemove",(function(e){if(t.enabled){e.preventDefault();var i=F.now();if(i-r._lastMoveTimer<10)return;r._lastMoveTimer=i,s.push(e)}}),!0),i.addEventListener("mouseout",(function(e){t.enabled&&s.push(e)})),i.addEventListener("mouseover",(function(e){t.enabled&&s.push(e)})),i.addEventListener("touchstart",(function(e){t.enabled&&(s.push(e),t._isFirstTouch||wt.isInputting||e.preventDefault(),r.mouseDownTime=F.now())})),i.addEventListener("touchend",(function(e){t.enabled?(t._isFirstTouch||wt.isInputting||e.preventDefault(),t._isFirstTouch=!1,s.push(e),r.mouseDownTime=-F.now()):n._curTouchID=NaN}),!0),i.addEventListener("touchmove",(function(e){t.enabled&&(e.preventDefault(),s.push(e))}),!0),i.addEventListener("touchcancel",(function(e){t.enabled?(e.preventDefault(),s.push(e)):n._curTouchID=NaN}),!0),i.addEventListener("mousewheel",(function(e){t.enabled&&s.push(e)})),i.addEventListener("DOMMouseScroll",(function(e){t.enabled&&s.push(e)}))},e.initEvent=function(t,e){var i,n=this;n._event._stoped=!1,n._event.nativeEvent=e||t,n._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),n.mouseX=this._point.x,n.mouseY=this._point.y,n._event.touchId=t.identifier||0,this._tTouchID=n._event.touchId,(i=y.I._event)._stoped=!1,i.nativeEvent=n._event.nativeEvent,i.touchId=n._event.touchId},e.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=y.I.getLastOvers(),i=0,n=e.length;i<n;i++){var r=e[i];r.event("mousewheel",this._event.setTo("mousewheel",r,this._target))}},e.onMouseMove=function(t){y.I.onMouseMove(t,this._tTouchID)},e.onMouseDown=function(t){if(wt.isInputting&&i.stage.focus&&i.stage.focus.focus&&!i.stage.focus.contains(this._target)){var e=i.stage.focus._tf||i.stage.focus,n=t._tf||t;n instanceof laya.display.Input&&n.multiline==e.multiline?e._focusOut():e.focus=!1}y.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},e.onMouseUp=function(t){y.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},e.check=function(t,e,i,n){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var s=t._childs.length-1;-1<s;s--){var a=t._childs[s];if(!a.destroyed&&a.mouseEnabled&&a.visible&&this.check(a,e,i,n))return!0}}var o=!(!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent)||this.hitTest(t,e,i);return o?(this._target=t,n.call(this,t)):n===this.onMouseUp&&t===this._stage&&(this._target=this._stage,n.call(this,this._target)),o},e.hitTest=function(t,e,i){var n=!1;if(t.scrollRect&&(e-=t.scrollRect.x,i-=t.scrollRect.y),t.hitArea instanceof laya.utils.HitArea)return t.hitArea.isHit(e,i);if(0<t.width&&0<t.height||t.mouseThrough||t.hitArea)if(t.mouseThrough)n=t.getGraphicBounds().contains(e,i);else{var r=this._rect;t.hitArea?r=t.hitArea:r.setTo(0,0,t.width,t.height),n=r.contains(e,i)}return n},e.runEvent=function(){var e=this._eventList.length;if(e){var i=this;i.mouseEventTime=F.now();var n,r=0,s=0,a=0;try{for(;r<e;){var o=this._eventList[r];switch("mousemove"!==o.type&&(this._prePoint.x=this._prePoint.y=-1e6),o.type){case"mousedown":this._touchIDs[0]=this._id++,t._isTouchRespond?t._isTouchRespond=!1:(i._isLeftMouse=0===o.button,i.initEvent(o),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"mouseup":i._isLeftMouse=0===o.button,i.initEvent(o),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-o.clientX)+Math.abs(this._prePoint.y-o.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=o.clientX,this._prePoint.y=o.clientY,i.initEvent(o),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"touchstart":t._isTouchRespond=!0,i._isLeftMouse=!0;var h=o.changedTouches;for(s=0,a=h.length;s<a;s++)n=h[s],(t.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=n.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[n.identifier]=this._id++,i.initEvent(n,o),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"touchend":case"touchcancel":t._isTouchRespond=!0,i._isLeftMouse=!0;var l=o.changedTouches;for(s=0,a=l.length;s<a;s++)n=l[s],(t.multiTouchEnabled||n.identifier==this._curTouchID)&&(this._curTouchID=NaN,i.initEvent(n,o),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp)||i.onMouseUp(null));break;case"touchmove":var c=o.changedTouches;for(s=0,a=c.length;s<a;s++)n=c[s],(t.multiTouchEnabled||n.identifier==this._curTouchID)&&(i.initEvent(n,o),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":i.checkMouseWheel(o);break;case"mouseout":y.I.stageMouseOut();break;case"mouseover":i._stage.event("mouseover",i._event.setTo("mouseover",i._stage,i._stage))}r++}}catch(e){throw this._eventList.length=0,e}this._eventList.length=0}},t.enabled=!0,t.multiTouchEnabled=!0,t._isTouchRespond=!1,t._isFirstTouch=!0,n(t,["instance",function(){return this.instance=new t}]),t}()),y=function(){function t(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new m}r(t,"laya.events.TouchManager");var e=t.prototype;return e._clearTempArrs=function(){t._oldArr.length=0,t._newArr.length=0,t._tEleArr.length=0},e.getTouchFromArr=function(t,e){var i,n,r=0;for(i=e.length,r=0;r<i;r++)if((n=e[r]).id==t)return n;return null},e.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;0<=i;i--)e[i].id==t&&e.splice(i,1)},e.createTouchO=function(t,e){var i;return(i=Y.getItem("TouchData")||{}).id=e,i.tar=t,i},e.onMouseDown=function(e,i,n){var r,s,a,o;void 0===n&&(n=!1),this.enable&&(r=this.getTouchFromArr(i,this.preOvers),a=this.getEles(e,null,t._tEleArr),r?r.tar=e:(s=this.createTouchO(e,i),this.preOvers.push(s)),F.onMobile&&this.sendEvents(a,"mouseover",i),o=n?this.preDowns:this.preRightDowns,(r=this.getTouchFromArr(i,o))?r.tar=e:(s=this.createTouchO(e,i),o.push(s)),this.sendEvents(a,n?"mousedown":"rightmousedown",i),this._clearTempArrs())},e.sendEvents=function(t,e,i){void 0===i&&(i=0);var n,r,s,a=0;for(n=t.length,this._event._stoped=!1,r=t[0],a=0;a<n;a++){if((s=t[a]).destroyed)return;if(s.event(e,this._event.setTo(e,s,r)),this._event._stoped)break}},e.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i},e.checkMouseOutAndOverOfMove=function(e,i,n){if(void 0===n&&(n=0),i!=e){var r,s,a=0,o=0;if(i.contains(e))s=this.getEles(e,i,t._tEleArr),this.sendEvents(s,"mouseover",n);else if(e.contains(i))s=this.getEles(i,e,t._tEleArr),this.sendEvents(s,"mouseout",n);else{var h,l;(s=t._tEleArr).length=0,h=this.getEles(i,null,t._oldArr),l=this.getEles(e,null,t._newArr),o=h.length;var c=0;for(a=0;a<o;a++){if(r=h[a],0<=(c=l.indexOf(r))){l.splice(c,l.length-c);break}s.push(r)}0<s.length&&this.sendEvents(s,"mouseout",n),0<l.length&&this.sendEvents(l,"mouseover",n)}}},e.onMouseMove=function(e,i){var n,r;this.enable&&((n=this.getTouchFromArr(i,this.preOvers))?(this.checkMouseOutAndOverOfMove(e,n.tar),n.tar=e,r=this.getEles(e,null,t._tEleArr)):(r=this.getEles(e,null,t._tEleArr),this.sendEvents(r,"mouseover",i),this.preOvers.push(this.createTouchO(e,i))),this.sendEvents(r,"mousemove",i),this._clearTempArrs())},e.getLastOvers=function(){return(t._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,t._tEleArr):(t._tEleArr.push(i.stage),t._tEleArr)},e.stageMouseOut=function(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,"mouseout",0)},e.onMouseUp=function(e,i,n){if(void 0===n&&(n=!1),this.enable){var r,s,a,o,h,l,c=0,u=0,d=F.onMobile;if(s=this.getEles(e,null,t._tEleArr),this.sendEvents(s,n?"mouseup":"rightmouseup",i),l=n?this.preDowns:this.preRightDowns,r=this.getTouchFromArr(i,l)){var _,f=F.now();if(_=f-this._lastClickTime<300,this._lastClickTime=f,e==r.tar)h=s;else for(a=this.getEles(r.tar,null,t._oldArr),(h=t._newArr).length=0,u=a.length,c=0;c<u;c++)o=a[c],0<=s.indexOf(o)&&h.push(o);0<h.length&&this.sendEvents(h,n?"click":"rightclick",i),n&&_&&this.sendEvents(h,"doubleclick",i),this.removeTouchFromArr(i,l),r.tar=null,Y.recover("TouchData",r)}(r=this.getTouchFromArr(i,this.preOvers))&&d&&((h=this.getEles(r.tar,null,h))&&0<h.length&&this.sendEvents(h,"mouseout",i),this.removeTouchFromArr(i,this.preOvers),r.tar=null,Y.recover("TouchData",r)),this._clearTempArrs()}},t._oldArr=[],t._newArr=[],t._tEleArr=[],n(t,["I",function(){return this.I=new t}]),t}(),x=function(){function t(){this._action=null}r(t,"laya.filters.Filter");var e=t.prototype;return i.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){},s(0,e,"type",(function(){return-1})),s(0,e,"action",(function(){return this._action})),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filterStart=null,t._filterEnd=null,t._EndTarget=null,t._recycleScope=null,t._filter=null,t._useSrc=null,t._endSrc=null,t._useOut=null,t._endOut=null,t}(),w=function(){function t(){this.data=null}r(t,"laya.filters.ColorFilterAction");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.ctx.ctx,i=t.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var n,r=e.getImageData(0,0,i.width,i.height),s=r.data,a=0,o=s.length;a<o;a+=4)n=this.getColor(s[a],s[a+1],s[a+2],s[a+3]),0!=s[a+3]&&(s[a]=n[0],s[a+1]=n[1],s[a+2]=n[2],s[a+3]=n[3]);return e.putImageData(r,0,0),t},e.getColor=function(t,e,i,n){var r=[];if(this.data._mat&&this.data._alpha){var s=this.data._mat,a=this.data._alpha;r[0]=s[0]*t+s[1]*e+s[2]*i+s[3]*n+a[0],r[1]=s[4]*t+s[5]*e+s[6]*i+s[7]*n+a[1],r[2]=s[8]*t+s[9]*e+s[10]*i+s[11]*n+a[2],r[3]=s[12]*t+s[13]*e+s[14]*i+s[15]*n+a[3]}return r},t}(),b=(function(){function t(){}r(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx,t.ty,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty}}(),function(){function t(){this._controlPoints=[new M,new M,new M],this._calFun=this.getPoint2}r(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],s=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,a=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;e.push(s,a)},e.getPoint3=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],s=this._controlPoints[3],a=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+s.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+s.y*Math.pow(t,3);e.push(a,o)},e.insertPoints=function(t,e){var i,n=NaN;for(i=1/(t=0<t?t:5),n=0;n<=1;n+=i)this._calFun(n,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var n,r,s=0;if((n=t.length)<2*(i+1))return[];switch(r=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(new M);for(s=0;s<2*i;s+=2)this._switchPoint(t[s],t[s+1]);for(s=2*i;s<n;s+=2)this._switchPoint(t[s],t[s+1]),s/2%i==0&&this.insertPoints(e,r);return r},n(t,["I",function(){return this.I=new t}]),t}()),S=function(){function t(){}return r(t,"laya.maths.GrahamScan"),t.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},t.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},t._getPoints=function(e,i,n){for(void 0===i&&(i=!1),t._mPointList||(t._mPointList=[]);t._mPointList.length<e;)t._mPointList.push(new M);return n||(n=[]),n.length=0,i?t.getFrom(n,t._mPointList,e):t.getFromR(n,t._mPointList,e),n},t.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t},t.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t},t.pListToPointList=function(e,i){void 0===i&&(i=!1);var n=0,r=e.length/2,s=t._getPoints(r,i,t._tempPointList);for(n=0;n<r;n++)s[n].setTo(e[n+n],e[n+n+1]);return s},t.pointListToPlist=function(e){var i,n=0,r=e.length,s=t._temPList;for(n=s.length=0;n<r;n++)i=e[n],s.push(i.x,i.y);return s},t.scanPList=function(e){return q.copyArray(e,t.pointListToPlist(t.scan(t.pListToPointList(e,!0))))},t.scan=function(e){var i,n,r,s=0,a=0,o=0,h=e.length,l={};for((n=t._temArr).length=0,s=e.length-1;0<=s;s--)r=(i=e[s]).x+"_"+i.y,l.hasOwnProperty(r)||(l[r]=!0,n.push(i));for(h=n.length,q.copyArray(e,n),s=1;s<h;s++)(e[s].y<e[o].y||e[s].y==e[o].y&&e[s].x<e[o].x)&&(o=s);for(i=e[0],e[0]=e[o],e[o]=i,s=1;s<h-1;s++){for(a=(o=s)+1;a<h;a++)(0<t.multiply(e[a],e[o],e[0])||0==t.multiply(e[a],e[o],e[0])&&t.dis(e[0],e[a])<t.dis(e[0],e[o]))&&(o=a);i=e[s],e[s]=e[o],e[o]=i}if((n=t._temArr).length=0,e.length<3)return q.copyArray(n,e);for(n.push(e[0],e[1],e[2]),s=3;s<h;s++){for(;2<=n.length&&0<=t.multiply(e[s],n[n.length-1],n[n.length-2]);)n.pop();e[s]&&n.push(e[s])}return n},t._mPointList=null,t._tempPointList=[],t._temPList=[],t._temArr=[],t}(),T=function(){function t(){}return r(t,"laya.maths.MathUtil"),t.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},t.lerpVector3=function(t,e,i,n){var r=t[0],s=t[1],a=t[2];n[0]=r+i*(e[0]-r),n[1]=s+i*(e[1]-s),n[2]=a+i*(e[2]-a)},t.lerpVector4=function(t,e,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];n[0]=r+i*(e[0]-r),n[1]=s+i*(e[1]-s),n[2]=a+i*(e[2]-a),n[3]=o+i*(e[3]-o)},t.slerpQuaternionArray=function(t,e,i,n,r,s,a){var o,h,l,c,u,d=t[e+0],_=t[e+1],f=t[e+2],p=t[e+3],m=i[n+0],g=i[n+1],v=i[n+2],y=i[n+3];return(h=d*m+_*g+f*v+p*y)<0&&(h=-h,m=-m,g=-g,v=-v,y=-y),u=1e-6<1-h?(o=Math.acos(h),l=Math.sin(o),c=Math.sin((1-r)*o)/l,Math.sin(r*o)/l):(c=1-r,r),s[a+0]=c*d+u*m,s[a+1]=c*_+u*g,s[a+2]=c*f+u*v,s[a+3]=c*p+u*y,s},t.getRotation=function(t,e,i,n){return Math.atan2(n-e,i-t)/Math.PI*180},t.sortBigFirst=function(t,e){return t==e?0:t<e?1:-1},t.sortSmallFirst=function(t,e){return t==e?0:t<e?-1:1},t.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},t.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},t.sortByKey=function(e,i,n){var r;return void 0===i&&(i=!1),void 0===n&&(n=!0),r=i?n?t.sortNumBigFirst:t.sortBigFirst:n?t.sortNumSmallFirst:t.sortSmallFirst,function(t,i){return r(t[e],i[e])}},t}(),C=function(){function t(t,e,i,n,r,s){this.inPool=!1,this.bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this._checkTransform()}r(t,"laya.maths.Matrix");var e=t.prototype;return e.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},e._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},e.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},e.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.scale=function(t,e){this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this.bTransform=!0},e.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this.bTransform=!0},e.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),r=this.a,s=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*r,this.d+=i*s,this},e.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,a=e*r-i*n,o=r/a,h=-i/a,l=-n/a,c=e/a,u=(n*this.ty-r*s)/a,d=-(e*this.ty-i*s)/a;return t.setTo(o*t.x+l*t.y+u,h*t.x+c*t.y+d)},e.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},e.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},e.transformPointArray=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],s=t[n+1];e[n]=this.a*r+this.c*s+this.tx,e[n+1]=this.b*r+this.d*s+this.ty}return e},e.transformPointArrayScale=function(t,e){for(var i=t.length,n=0;n<i;n+=2){var r=t[n],s=t[n+1];e[n]=this.a*r+this.c*s,e[n+1]=this.b*r+this.d*s}return e},e.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},e.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},e.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},e.setTo=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},e.concat=function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},e.scaleEx=function(t,e){var i=this.a,n=this.b,r=this.c,s=this.d;0!==n||0!==r?(this.a=t*i,this.b=t*n,this.c=e*r):(this.a=t*i,this.b=0*s,this.c=0*i),this.d=e*s,this.bTransform=!0},e.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b,s=this.c,a=this.d;0!==r||0!==s?(this.a=e*n+i*s,this.b=e*r+i*a,this.c=-i*n+e*s,this.d=-i*r+e*a):(this.a=e*n,this.b=i*a,this.c=-i*n,this.d=e*a),this.bTransform=!0},e.clone=function(){var e=t.create();return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e.bTransform=this.bTransform,e},e.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){if(!this.inPool){var e=t._cache;this.inPool=!0,e._length||(e._length=0),(e[e._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},t.mul=function(t,e,i){var n=t.a,r=t.b,s=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,c=e.b,u=e.c,d=e.d,_=e.tx,f=e.ty;return 0!==c||0!==u?(i.a=n*l+r*u,i.b=n*c+r*d,i.c=s*l+a*u,i.d=s*c+a*d,i.tx=l*o+u*h+_,i.ty=c*o+d*h+f):(i.a=n*l,i.b=r*d,i.c=s*l,i.d=a*d,i.tx=l*o+_,i.ty=d*h+f),i},t.mul16=function(t,e,i){var n=t.a,r=t.b,s=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,c=e.b,u=e.c,d=e.d,_=e.tx,f=e.ty;return 0!==c||0!==u?(i[0]=n*l+r*u,i[1]=n*c+r*d,i[4]=s*l+a*u,i[5]=s*c+a*d,i[12]=l*o+u*h+_,i[13]=c*o+d*h+f):(i[0]=n*l,i[1]=r*d,i[4]=s*l,i[5]=a*d,i[12]=l*o+_,i[13]=d*h+f),i},t.mulPre=function(t,e,i,n,r,s,a,o){var h=t.a,l=t.b,c=t.c,u=t.d,d=t.tx,_=t.ty;return 0!==i||0!==n?(o.a=h*e+l*n,o.b=h*i+l*r,o.c=c*e+u*n,o.d=c*i+u*r,o.tx=e*d+n*_+s,o.ty=i*d+r*_+a):(o.a=h*e,o.b=l*r,o.c=c*e,o.d=u*r,o.tx=e*d+s,o.ty=r*_+a),o},t.mulPos=function(t,e,i,n,r,s,a,o){var h=t.a,l=t.b,c=t.c,u=t.d,d=t.tx,_=t.ty;return 0!==l||0!==c?(o.a=e*h+i*c,o.b=e*l+i*u,o.c=n*h+r*c,o.d=n*l+r*u,o.tx=h*s+c*a+d,o.ty=l*s+u*a+_):(o.a=e*h,o.b=i*u,o.c=n*h,o.d=r*u,o.tx=h*s+d,o.ty=u*a+_),o},t.preMul=function(t,e,i){var n=t.a,r=t.b,s=t.c,a=t.d,o=e.a,h=e.b,l=e.c,c=e.d,u=e.tx,d=e.ty;return i.a=o*n,i.b=i.c=0,i.d=c*a,i.tx=u*n+t.tx,i.ty=d*a+t.ty,0===h&&0===l&&0===r&&0===s||(i.a+=h*s,i.d+=l*r,i.b+=o*r+h*a,i.c+=l*n+c*s,i.tx+=d*s,i.ty+=u*r),i},t.preMulXY=function(t,e,i,n){var r=t.a,s=t.b,a=t.c,o=t.d;return n.a=r,n.b=s,n.c=a,n.d=o,n.tx=e*r+t.tx+i*a,n.ty=i*o+t.ty+e*s,n},t.create=function(){var e=t._cache,i=e._length?e[--e._length]:new t;return i.inPool=!1,i},t.EMPTY=new t,t.TEMP=new t,t._cache=[],t}(),M=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}r(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(0<t){var e=1/t;this.x*=e,this.y*=e}},t.TEMP=new t,t.EMPTY=new t,t}(),I=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}r(t,"laya.maths.Rectangle");var e=t.prototype;return e.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom},e.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},e.intersection=function(e,i){return this.intersects(e)?(i||(i=new t),i.x=Math.max(this.x,e.x),i.y=Math.max(this.y,e.y),i.width=Math.min(this.right,e.right)-i.x,i.height=Math.min(this.bottom,e.bottom)-i.y,i):null},e.union=function(e,i){return i||(i=new t),this.clone(i),e.width<=0||e.height<=0?i:(i.addPoint(e.x,e.y),i.addPoint(e.right,e.bottom),this)},e.clone=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},e.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},e.equals=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},e.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},e._getBoundPoints=function(){var e=t._temB;return(e.length=0)==this.width||0==this.height||e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),e},e.isEmpty=function(){return this.width<=0||this.height<=0},s(0,e,"right",(function(){return this.x+this.width})),s(0,e,"bottom",(function(){return this.y+this.height})),t._getBoundPointS=function(e,i,n,r){var s=t._temA;return(s.length=0)==n||0==r||s.push(e,i,e+n,i,e,i+r,e+n,i+r),s},t._getWrapRec=function(e,i){if(!e||e.length<1)return i?i.setTo(0,0,0,0):t.TEMP.setTo(0,0,0,0);i=i||new t;var n,r,s,a,o,h=e.length,l=M.TEMP;for(s=o=-(r=a=99999),n=0;n<h;n+=2)l.x=e[n],l.y=e[n+1],r=r<l.x?r:l.x,a=a<l.y?a:l.y,s=s>l.x?s:l.x,o=o>l.y?o:l.y;return i.setTo(r,a,s-r,o-a)},t.EMPTY=new t,t.TEMP=new t,t._temB=[],t._temA=[],t}(),E=function(){function t(){}return r(t,"laya.media.SoundManager"),s(1,t,"useAudioMusic",(function(){return t._useAudioMusic}),(function(e){t._useAudioMusic=e,t._musicClass=e?et:null})),s(1,t,"autoStopMusic",(function(){return t._autoStopMusic}),(function(e){i.stage.off("blur",null,t._stageOnBlur),i.stage.off("focus",null,t._stageOnFocus),i.stage.off("visibilitychange",null,t._visibilityChange),(t._autoStopMusic=e)&&(i.stage.on("blur",null,t._stageOnBlur),i.stage.on("focus",null,t._stageOnFocus),i.stage.on("visibilitychange",null,t._visibilityChange))})),s(1,t,"muted",(function(){return t._muted}),(function(e){e!=t._muted&&(e&&t.stopAllSound(),t.musicMuted=e,t._muted=e)})),s(1,t,"musicMuted",(function(){return t._musicMuted}),(function(e){e!=t._musicMuted&&(e?(t._tMusic&&t._musicChannel&&!t._musicChannel.isStopped?t._musicChannel.pause():t._musicChannel=null,t._musicMuted=e):(t._musicMuted=e,t._tMusic&&t._musicChannel&&t._musicChannel.resume()))})),s(1,t,"soundMuted",(function(){return t._soundMuted}),(function(e){t._soundMuted=e})),t.addChannel=function(e){0<=t._channels.indexOf(e)||(t._channels.push(e),t.autoReleaseSound&&0!=t._notUsedCount&&t._notUsedUrls[e.url]&&(delete t._notUsedUrls[e.url],0==--t._notUsedCount&&i.timer.clear(t,t.disposeSoundIfNotUsed)))},t.removeChannel=function(e){var n=t._channels,r=n.indexOf(e);if(-1!=r&&(n.splice(r,1),t.autoReleaseSound)){var s=e.url,a=t.defaultIntervals[s]||2e4;if(0<a){var o=!0;for(r=n.length-1;0<=r;r--)if(n[r].url==s){o=!1;break}o&&(t._notUsedUrls[s]=Date.now()+a,0==t._notUsedCount++&&i.timer.loop(1e4,t,t.disposeSoundIfNotUsed))}}},t.disposeSoundIfNotUsed=function(){var e=t._notUsedUrls;if(0!=t._notUsedCount){var n=Date.now();for(var r in e)n>=e[r]&&(delete e[r],--t._notUsedCount,t.destroySound(r));if(0!=t._notUsedCount)return}i.timer.clear(t,t.disposeSoundIfNotUsed)},t._visibilityChange=function(){i.stage.isVisibility?t._stageOnFocus():t._stageOnBlur()},t._stageOnBlur=function(){t._isActive=!1,t._musicChannel&&(t._musicChannel.isStopped||(t._blurPaused=!0,t._musicChannel.pause())),t.stopAllSound(),i.stage.once("mousedown",null,t._stageOnFocus)},t._recoverWebAudio=function(){rt.ctx&&"running"!=rt.ctx.state&&rt.ctx.resume&&rt.ctx.resume()},t._stageOnFocus=function(){if(t._isActive=!0,t._recoverWebAudio(),i.stage.off("mousedown",null,t._stageOnFocus),t._blurPaused){var e=t._musicChannel;e&&t._music&&e.isStopped&&(t._blurPaused=!1,t._music._disposed?t.playMusic(e.url,e.loops,e.startHandler,e.completeHandler,e.startTime):e.audioBuffer?e.resume():t._music.play(e.startTime,e.loops,e.startHandler,e))}},t.playSound=function(e,i,n,r,s,a){if(void 0===i&&(i=1),void 0===a&&(a=0),!e)return null;if(t._muted)return null;if(t._recoverWebAudio(),e==t._tMusic){if(t._musicMuted)return null}else{if(!t._isActive)return null;if(t._soundMuted)return null}var o,h=t._pool[e];return s||(s=t._soundClass),h||((h=new s).load(e),t._pool[e]=h),(o=h.play(a,i,n))?(e==t._tMusic&&(t._music=h,t._isActive||(t._blurPaused=!0,o.pause())),o.url=e,o.volume=e==t._tMusic?t.musicVolume:t.soundVolume,o.completeHandler=r,o):null},t.destroySound=function(e){var i=t._pool[e];i&&(delete t._pool[e],i.dispose())},t.playMusic=function(e,i,n,r,s){return void 0===i&&(i=0),void 0===s&&(s=0),t._tMusic=e,t._musicChannel&&t._musicChannel.stop(),t._musicChannel=t.playSound(e,i,n,r,null,s)},t.stopSound=function(e){for(var i,n=t._channels.length-1;0<=n;n--)(i=t._channels[n]).url==e&&i.stop()},t.stopAll=function(){t._tMusic=null;var e=0;for(e=t._channels.length-1;0<=e;e--)t._channels[e].stop()},t.stopAllSound=function(){var e,i=0;for(i=t._channels.length-1;0<=i;i--)(e=t._channels[i]).url!=t._tMusic&&e.stop()},t.stopMusic=function(){t._musicChannel&&t._musicChannel.stop(),t._tMusic=null},t.setSoundVolume=function(e,i){if(i)t._setVolume(i,e);else{t.soundVolume=e;var n,r=0;for(r=t._channels.length-1;0<=r;r--)(n=t._channels[r]).url!=t._tMusic&&(n.volume=e)}},t.setMusicVolume=function(e){t.musicVolume=e,t._setVolume(t._tMusic,e)},t._setVolume=function(e,i){for(var n,r=t._channels.length-1;0<=r;r--)(n=t._channels[r]).url==e&&(n.volume=i)},t.musicVolume=1,t.soundVolume=1,t.playbackRate=1,t._useAudioMusic=!0,t._muted=!1,t._soundMuted=!1,t._musicMuted=!1,t._tMusic=null,t._musicChannel=null,t._music=null,t._channels=[],t._autoStopMusic=!1,t._blurPaused=!1,t._isActive=!0,t._soundClass=null,t._musicClass=null,t.autoReleaseSound=!0,t._pool={},t.defaultIntervals={},t._notUsedUrls={},t._notUsedCount=0,t}(),A=function(){var e;function i(){}return r(i,"laya.net.LocalStorage"),i.__init__=function(){i._baseClass||(i._baseClass=e).init(),i.items=i._baseClass.items,i.support=i._baseClass.support},i.setItem=function(t,e){i._baseClass.setItem(t,e)},i.getItem=function(t){return i._baseClass.getItem(t)},i.setJSON=function(t,e){i._baseClass.setJSON(t,e)},i.getJSON=function(t){return i._baseClass.getJSON(t)},i.removeItem=function(t){i._baseClass.removeItem(t)},i.clear=function(){i._baseClass.clear()},i._baseClass=null,i.items=null,i.support=!1,i.__init$=function(){e=function(){function e(){}return r(e,""),e.init=function(){try{e.support=!0,e.items=t.localStorage,e.setItem("laya","1"),e.removeItem("laya")}catch(t){e.support=!1}e.support||console.log("LocalStorage is not supprot or browser is private mode.")},e.setItem=function(t,i){try{e.support&&e.items.setItem(t,i)}catch(t){console.warn("set localStorage failed",t)}},e.getItem=function(t){return e.support?e.items.getItem(t):null},e.setJSON=function(t,i){try{e.support&&e.items.setItem(t,JSON.stringify(i))}catch(t){console.warn("set localStorage failed",t)}},e.getJSON=function(t){return JSON.parse(e.support?e.items.getItem(t):null)},e.removeItem=function(t){e.support&&e.items.removeItem(t)},e.clear=function(){e.support&&e.items.clear()},e.items=null,e.support=!1,e}()},i}(),D=(function(){function t(){}r(t,"laya.net.ResourceVersion"),t.enable=function(e,n,r){void 0===r&&(r=2),laya.net.ResourceVersion.type=r,i.loader.load(e,l.create(null,t.onManifestLoaded,[n]),null,"json"),P.customFormat=t.addVersionPrefix},t.onManifestLoaded=function(e,i){t.manifest=i,e.run(),i||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},t.addVersionPrefix=function(e){return t.manifest&&t.manifest[e]?2==t.type?t.manifest[e]:t.manifest[e]+"/"+e:e},t.FOLDER_VERSION=1,t.FILENAME_VERSION=2,t.manifest=null,t.type=1}(),function(){function t(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}r(t,"laya.net.TTFLoader");var e=t.prototype;return e.load=function(t){var e=(this._url=t).split(".ttf")[0].split("/");this.fontName=e[e.length-1],F.window.conch?this._loadConch():F.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},e._loadConch=function(){this._http=new st,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},e._onHttpLoaded=function(t){F.window.conch.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()},e._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},e._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},e._complete=function(){i.timer.clear(this,this._complete),i.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},e._checkComplete=function(){a.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},e._loadWithFontFace=function(){var t=new F.window.FontFace(this.fontName,"url('"+this._url+"')");F.window.document.fonts.add(t);var e=this;t.loaded.then((function(){e._complete()})),t.load()},e._createDiv=function(){this._div=F.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",F.document.body.appendChild(this._div)},e._loadWithCSS=function(){var t=this,e=F.createElement("style");e.type="text/css",F.document.body.appendChild(e),e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=a.measureText("LayaTTFFont",this._fontTxt).width;var n=this;e.onload=function(){i.timer.once(1e4,n,t._complete)},i.timer.loop(20,this,this._checkComplete),this._createDiv()},t._testString="LayaTTFFont",t}()),P=function(){function t(e){this._url=null,this._path=null,this._url=t.formatURL(e),this._path=t.getPath(e)}r(t,"laya.net.URL");var e=t.prototype;return s(0,e,"path",(function(){return this._path})),s(0,e,"url",(function(){return this._url})),t.formatURL=function(e,i){if(!e)return"null path";if(0<e.indexOf(":"))return e;null!=t.customFormat&&(e=t.customFormat(e,i));var n=e.charAt(0);if("."===n)return t.formatRelativePath((i||t.basePath)+e);if("~"===n)return t.rootPath+e.substring(1);if("d"===n){if(0===e.indexOf("data:image"))return e}else if("/"===n)return e;return(i||t.basePath)+e},t.formatRelativePath=function(t){for(var e=t.split("/"),i=0,n=e.length;i<n;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},t.isAbsolute=function(t){return 0<t.indexOf(":")||"/"==t.charAt(0)},t.getPath=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(0,e+1):""},t.getFileName=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(e+1):t},t.version={},t.basePath="",t.rootPath="",t.customFormat=function(e){var i=t.version[e];return!R.isConchApp&&i&&(e+="?v="+i),e},t}(),R=function(){function e(t,n){this._timeId=0;var r=e._mainCanvas.source.style;r.position="absolute",r.top=r.left="0px",r.background="#000000",e._mainCanvas.source.id="layaCanvas";var s=laya.renders.Render.isWebGL;e._mainCanvas.source.width=t,e._mainCanvas.source.height=n,s&&e.WebGL.init(e._mainCanvas,t,n),F.container.appendChild(e._mainCanvas.source),(e._context=new N(t,n,s?null:e._mainCanvas)).ctx.setIsMainContext(),F.window.requestAnimationFrame((function t(e){F.window.requestAnimationFrame(t),i.stage._loop(e)})),i.stage.on("visibilitychange",this,this._onVisibilitychange)}r(e,"laya.renders.Render");var n=e.prototype;return n._onVisibilitychange=function(){i.stage.isVisibility?0!=this._timeId&&F.window.clearInterval(this._timeId):this._timeId=F.window.setInterval(this._enterFrame,1e3)},n._enterFrame=function(t){i.stage._loop(0)},s(1,e,"context",(function(){return e._context})),s(1,e,"canvas",(function(){return e._mainCanvas.source})),e._context=null,e._mainCanvas=null,e.WebGL=null,e.isConchNode=!1,e.isConchApp=!1,e.isConchWebGL=!1,e.isWebGL=!1,e.is3DMode=!1,e.optimizeTextureMemory=function(t,e){return!0},e.__init$=function(){t.ConchRenderType=t.ConchRenderType||1,t.ConchRenderType|=t.conch?4:0,e.isConchNode=5==(5&t.ConchRenderType),e.isConchApp=4==(4&t.ConchRenderType),e.isConchWebGL=6==t.ConchRenderType},e}(),N=function(){function t(e,i,n){this.x=0,this.y=0,this._drawTexture=function(t,e,i){i[0].loaded&&this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e)},this._fillTexture=function(t,e,i){i[0].loaded&&this.ctx.fillTexture(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(t,e,i){i[0].loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e,i[6])},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(t,e,i){var n=this.ctx;null!=i[4]&&(n.fillStyle=i[4],n.fillRect(t+i[0],e+i[1],i[2],i[3],null)),null!=i[5]&&(n.strokeStyle=i[5],n.lineWidth=i[6],n.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6]))},this._drawPie=function(t,e,i){var n=this.ctx;R.isWebGL&&n.setPathId(i[8]),n.beginPath(),R.isWebGL?(n.movePath(i[0]+t,i[1]+e),n.moveTo(0,0)):n.moveTo(t+i[0],e+i[1]),n.arc(t+i[0],e+i[1],i[2],i[3],i[4]),n.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._drawCircle=function(e,i,n){var r=this.ctx;R.isWebGL&&r.setPathId(n[6]),X.drawCall++,r.beginPath(),R.isWebGL&&r.movePath(n[0]+e,n[1]+i),r.arc(n[0]+e,n[1]+i,n[2],0,t.PI2),r.closePath(),this._fillAndStroke(n[3],n[4],n[5],!0)},this._fillCircle=function(e,i,n){X.drawCall++;var r=this.ctx;r.beginPath(),r.fillStyle=n[3],r.arc(n[0]+e,n[1]+i,n[2],0,t.PI2),r.fill()},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var n=this.ctx;R.isWebGL&&n.setPathId(i[6]),n.beginPath(),n.strokeStyle=i[4],n.lineWidth=i[5],R.isWebGL?(n.movePath(t,e),n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3])):(n.moveTo(t+i[0],e+i[1]),n.lineTo(t+i[2],e+i[3])),n.stroke()},this._drawLines=function(t,e,i){var n=this.ctx;R.isWebGL&&n.setPathId(i[5]),n.beginPath(),t+=i[0],e+=i[1],R.isWebGL&&n.movePath(t,e),n.strokeStyle=i[3],n.lineWidth=i[4];var r=i[2],s=2,a=r.length;if(R.isWebGL)for(n.moveTo(r[0],r[1]);s<a;)n.lineTo(r[s++],r[s++]);else for(n.moveTo(t+r[0],e+r[1]);s<a;)n.lineTo(t+r[s++],e+r[s++]);n.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(t,e,i){this.ctx.drawCurves(t,e,i)},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(t,e,i){this.ctx.save()},this._restore=function(t,e,i){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._drawPath=function(t,e,i){var n=this.ctx;R.isWebGL&&n.setPathId(-1),n.beginPath(),t+=i[0],e+=i[1],R.isWebGL&&n.movePath(t,e);for(var r=i[2],s=0,a=r.length;s<a;s++){var o=r[s];switch(o[0]){case"moveTo":R.isWebGL?n.moveTo(o[1],o[2]):n.moveTo(t+o[1],e+o[2]);break;case"lineTo":R.isWebGL?n.lineTo(o[1],o[2]):n.lineTo(t+o[1],e+o[2]);break;case"arcTo":R.isWebGL?n.arcTo(o[1],o[2],o[3],o[4],o[5]):n.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":n.closePath()}}var h=i[3];null!=h&&(n.fillStyle=h.fillStyle,n.fill());var l=i[4];null!=l&&(n.strokeStyle=l.strokeStyle,n.lineWidth=l.lineWidth||1,n.lineJoin=l.lineJoin,n.lineCap=l.lineCap,n.miterLimit=l.miterLimit,n.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var n=this.ctx,r=i[2],s=2,a=r.length;if(R.isWebGL)for(n.setPathId(i[6]),n.beginPath(),t+=i[0],e+=i[1],n.movePath(t,e),n.moveTo(r[0],r[1]);s<a;)n.lineTo(r[s++],r[s++]);else for(n.beginPath(),t+=i[0],e+=i[1],n.moveTo(t+r[0],e+r[1]);s<a;)n.lineTo(t+r[s++],e+r[s++]);n.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(t,e,i){var n=i[0];if(n){var r=this.ctx;n.render(r,t,e)}},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},this._setFilters=function(t,e,i){this.ctx.setFilters(i)},n?this.ctx=n.getContext("2d"):(n=yt.create("3D"),this.ctx=a.createWebGLContext2D(n),n._setContext(this.ctx)),n.size(e,i),this.canvas=n}r(t,"laya.renders.RenderContext");var e=t.prototype;return e.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},e.drawTexture=function(t,e,i,n,r){t.loaded&&this.ctx.drawTexture(t,e,i,n,r,this.x,this.y)},e._drawTextures=function(t,e,i){i[0].loaded&&this.ctx.drawTextures(i[0],i[1],t+this.x,e+this.y)},e.drawTextureWithTransform=function(t,e,i,n,r,s,a){t.loaded&&this.ctx.drawTextureWithTransform(t,e,i,n,r,s,this.x,this.y,a)},e.fillQuadrangle=function(t,e,i,n,r){this.ctx.fillQuadrangle(t,e,i,n,r)},e.drawCanvas=function(t,e,i,n,r){this.ctx.drawCanvas(t,e+this.x,i+this.y,n,r)},e.drawRect=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=this.ctx;a.strokeStyle=r,a.lineWidth=s,a.strokeRect(t+this.x,e+this.y,i,n,s)},e._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1);var r=this.ctx;null!=t&&(r.fillStyle=t,R.isWebGL?r.fill(n):r.fill()),null!=e&&0<i&&(r.strokeStyle=e,r.lineWidth=i,r.stroke())},e.clipRect=function(t,e,i,n){this.ctx.clipRect(t+this.x,e+this.y,i,n)},e.fillRect=function(t,e,i,n,r){this.ctx.fillRect(t+this.x,e+this.y,i,n,r)},e.drawCircle=function(e,i,n,r,s){void 0===s&&(s=1),X.drawCall++;var a=this.ctx;a.beginPath(),a.strokeStyle=r,a.lineWidth=s,a.arc(e+this.x,i+this.y,n,0,t.PI2),a.stroke()},e.drawTriangles=function(t,e,i){if(R.isWebGL)this.ctx.drawTriangles(i[0],t+i[1],e+i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9]);else{var n=i[5],r=0,s=n.length,a=this.ctx;for(r=0;r<s;r+=3){var o=2*n[r],h=2*n[r+1],l=2*n[r+2];a.drawTriangle(i[0],i[3],i[4],o,h,l,i[6],!0)}}},e.fillCircle=function(e,i,n,r){X.drawCall++;var s=this.ctx;s.beginPath(),s.fillStyle=r,s.arc(e+this.x,i+this.y,n,0,t.PI2),s.fill()},e.setShader=function(t){this.ctx.setShader(t)},e.drawLine=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=this.ctx;a.beginPath(),a.strokeStyle=r,a.lineWidth=s,a.moveTo(this.x+t,this.y+e),a.lineTo(this.x+i,this.y+n),a.stroke()},e.clear=function(){this.ctx.clear()},e.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},e.setTransform=function(t,e,i,n,r,s){this.ctx.setTransform(t,e,i,n,r,s)},e.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},e.save=function(){this.ctx.save()},e.restore=function(){this.ctx.restore()},e.translate=function(t,e){this.ctx.translate(t,e)},e.transform=function(t,e,i,n,r,s){this.ctx.transform(t,e,i,n,r,s)},e.rotate=function(t){this.ctx.rotate(t)},e.scale=function(t,e){this.ctx.scale(t,e)},e.alpha=function(t){this.ctx.globalAlpha*=t},e.setAlpha=function(t){this.ctx.globalAlpha=t},e.fillWords=function(t,e,i,n,r,s){void 0===s&&(s=0),this.ctx.fillWords(t,e,i,n,r,s)},e.fillBorderWords=function(t,e,i,n,r,s,a){this.ctx.fillBorderWords(t,e,i,n,r,s,a)},e.fillText=function(t,e,i,n,r,s){this.ctx.fillText(t,e+this.x,i+this.y,n,r,s)},e.strokeText=function(t,e,i,n,r,s,a){this.ctx.strokeText(t,e+this.x,i+this.y,n,r,s,a)},e.blendMode=function(t){this.ctx.globalCompositeOperation=t},e.flush=function(){this.ctx.flush&&this.ctx.flush()},e.addRenderObject=function(t){this.ctx.addRenderObject(t)},e.beginClip=function(t,e,i,n){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,n)},e.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},e.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],4<i.length?i[4]:null)},t.PI2=2*Math.PI,t}(),L=function(){function t(e,i){switch(this._next=i||t.NORENDER,e){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=x._filter);case 69905:return void(this._fun=t._initRenderFun)}this.onCreate(e)}r(t,"laya.renders.RenderSprite");var e=t.prototype;return e.onCreate=function(t){},e._style=function(t,e,i,n){t._style.render(t,e,i,n);var r=this._next;r._fun.call(r,t,e,i,n)},e._no=function(t,e,i,n){},e._custom=function(t,e,i,n){t.customRender(e,i,n);var r=t._style._tf;this._next._fun.call(this._next,t,e,i-r.translateX,n-r.translateY)},e._clip=function(e,i,n,r){var s=this._next;if(s!=t.NORENDER){var a=e._style.scrollRect;i.ctx.save(),i.ctx.clipRect(n,r,a.width,a.height),s._fun.call(s,e,i,n-a.x,r-a.y),i.ctx.restore()}},e._blend=function(t,e,i,n){var r=t._style;r.blendMode&&(e.ctx.globalCompositeOperation=r.blendMode);var s=this._next;s._fun.call(s,t,e,i,n),e.ctx.globalCompositeOperation="source-over"},e._mask=function(t,e,i,n){var r=this._next;r._fun.call(r,t,e,i,n);var s=t.mask;s&&(e.ctx.globalCompositeOperation="destination-in",(0<s.numChildren||!s.graphics._isOnlyOne())&&(s.cacheAsBitmap=!0),s.render(e,i-t.pivotX,n-t.pivotY)),e.ctx.globalCompositeOperation="source-over"},e._graphics=function(t,e,i,n){var r=t._style._tf;t._graphics&&t._graphics._render(t,e,i-r.translateX,n-r.translateY);var s=this._next;s._fun.call(s,t,e,i,n)},e._image=function(t,e,i,n){var r=t._style;e.ctx.drawTexture2(i,n,r._tf.translateX,r._tf.translateY,t.transform,r.alpha,r.blendMode,t._graphics._one)},e._image2=function(t,e,i,n){var r=t._style._tf;e.ctx.drawTexture2(i,n,r.translateX,r.translateY,t.transform,1,null,t._graphics._one)},e._alpha=function(t,e,i,n){var r;if(.01<(r=t._style.alpha)||t._needRepaint()){var s=e.ctx.globalAlpha;e.ctx.globalAlpha*=r;var a=this._next;a._fun.call(a,t,e,i,n),e.ctx.globalAlpha=s}},e._transform=function(e,i,n,r){var s=e.transform,a=this._next;s&&a!=t.NORENDER?(i.save(),i.transform(s.a,s.b,s.c,s.d,s.tx+n,s.ty+r),a._fun.call(a,e,i,0,0),i.restore()):a._fun.call(a,e,i,n,r)},e._childs=function(t,e,i,n){var r=t._style,s=r._tf;if(i=i-s.translateX+r.paddingLeft,n=n-s.translateY+r.paddingTop,r._calculation){var a=t._getWords();if(a){var o=r;o&&(o.stroke?e.fillBorderWords(a,i,n,o.font,o.color,o.strokeColor,o.stroke):e.fillWords(a,i,n,o.font,o.color,"none"!=o.textDecoration&&o.underLine?1:0))}}var h,l=t._childs,c=l.length;if(t.viewport||t.optimizeScrollRect&&t._style.scrollRect){var u=t.viewport||t._style.scrollRect,d=u.x,_=u.y,f=u.right,p=u.bottom,m=NaN,g=NaN;for(v=0;v<c;++v)(h=l[v]).visible&&(m=h._x)<f&&m+h.width>d&&(g=h._y)<p&&g+h.height>_&&h.render(e,i,n)}else for(var v=0;v<c;++v)(h=l[v])._style.visible&&h.render(e,i,n)},e._canvas=function(t,e,i,n){var r=t._$P.cacheCanvas;if(r){"bitmap"===r.type?X.canvasBitmap++:X.canvasNormal++;var s=r.ctx;if(t._needRepaint()||!s)this._canvas_repaint(t,e,i,n);else{var a=r._cacheRec;e.drawCanvas(s.canvas,i+a.x,n+a.y,a.width,a.height)}}else this._next._fun.call(this._next,t,e,i,n)},e._canvas_repaint=function(t,e,n,r){var s=t._$P.cacheCanvas,a=this._next;if(s){var o,h,l,c,u=s.ctx,d=t._needRepaint()||!u,_=s.type;if("bitmap"===_?X.canvasBitmap++:X.canvasNormal++,d){var f,p;s._cacheRec||(s._cacheRec=new I),R.isWebGL&&"bitmap"!==_?s._cacheRec.setTo(-t.pivotX,-t.pivotY,1,1):((c=t.getSelfBounds()).x=c.x-t.pivotX,c.y=c.y-t.pivotY,c.x=c.x-16,c.y=c.y-16,c.width=c.width+32,c.height=c.height+32,c.x=Math.floor(c.x+n)-n,c.y=Math.floor(c.y+r)-r,c.width=Math.floor(c.width),c.height=Math.floor(c.height),s._cacheRec.copyFrom(c)),c=s._cacheRec;var m,g=R.isWebGL?1:F.pixelRatio*i.stage.clientScaleX,v=R.isWebGL?1:F.pixelRatio*i.stage.clientScaleY;if(!R.isWebGL){var y,x=1,w=1;for(y=t;y&&y!=i.stage;)x*=y.scaleX,w*=y.scaleY,y=y.parent;R.isWebGL?(x<1&&(g*=x),w<1&&(v*=w)):(1<x&&(g*=x),1<w&&(v*=w))}if(t.scrollRect){var b=t.scrollRect;c.x-=b.x,c.y-=b.y}if(f=c.width*g,p=c.height*v,h=c.x,l=c.y,R.isWebGL&&"bitmap"===_&&(2048<f||2048<p))return console.warn("cache bitmap size larger than 2048,cache ignored"),s.ctx&&(Y.recover("RenderContext",s.ctx),s.ctx.canvas.size(0,0),s.ctx=null),void a._fun.call(a,t,e,n,r);if(u||(u=s.ctx=Y.getItem("RenderContext")||new N(f,p,yt.create("AUTO"))),u.ctx.sprite=t,(o=u.canvas).clear(),(o.width!=f||o.height!=p)&&o.size(f,p),"bitmap"===_?o.context.asBitmap=!0:"normal"===_&&(o.context.asBitmap=!1),1!=g||1!=v){var S=u.ctx;S.save(),S.scale(g,v),!R.isConchWebGL&&R.isConchApp&&(m=t._$P.cf)&&S.setFilterMatrix&&S.setFilterMatrix(m._mat,m._alpha),a._fun.call(a,t,u,-h,-l),S.restore(),R.isConchApp&&!R.isConchWebGL||t._applyFilters()}else S=u.ctx,!R.isConchWebGL&&R.isConchApp&&(m=t._$P.cf)&&S.setFilterMatrix&&S.setFilterMatrix(m._mat,m._alpha),a._fun.call(a,t,u,-h,-l),R.isConchApp&&!R.isConchWebGL||t._applyFilters();t._$P.staticCache&&(s.reCache=!1),X.canvasReCache++}else h=(c=s._cacheRec).x,l=c.y,o=u.canvas;e.drawCanvas(o,n+h,r+l,c.width,c.height)}else a._fun.call(a,t,u,n,r)},t.__init__=function(){var e,i,n=0;for(i=a.createRenderSprite(69905,null),e=t.renders.length=4096,n=0;n<e;n++)t.renders[n]=i;t.renders[0]=a.createRenderSprite(0,null),function(e,i){for(var n=0,r=0;r<e.length;r++)n|=e[r],t.renders[n]=i}([1,512,4,2],new t(1,null)),t.renders[513]=a.createRenderSprite(513,null),t.renders[517]=new t(517,null)},t._initRenderFun=function(e,i,n,r){var s=e._renderType;(t.renders[s]=t._getTypeRender(s))._fun(e,i,n,r)},t._getTypeRender=function(t){for(var e=null,i=2048;1<i;)i&t&&(e=a.createRenderSprite(i,e)),i>>=1;return e},t.IMAGE=1,t.ALPHA=2,t.TRANSFORM=4,t.BLEND=8,t.CANVAS=16,t.FILTERS=32,t.MASK=64,t.CLIP=128,t.STYLE=256,t.GRAPHICS=512,t.CUSTOM=1024,t.CHILDS=2048,t.INIT=69905,t.renders=[],t.NORENDER=new t(0,null),t}(),B=function(){function t(){this._repaint=!1}r(t,"laya.resource.Context");var e=t.prototype;return e.replaceReset=function(){var e,i,n=0;for(e=t.replaceKeys.length,n=0;n<e;n++)i=t.replaceKeys[n],this[t.newKeys[n]]=this[i]},e.replaceResotre=function(){this.__restore(),this.__reset()},e.setIsMainContext=function(){},e.drawTextures=function(t,e,i,n){X.drawCall+=e.length/2;for(var r=t.width,s=t.height,a=0,o=e.length;a<o;a+=2)this.drawTexture(t,e[a],e[a+1],r,s,i,n)},e.drawCanvas=function(t,e,i,n,r){X.drawCall++,this.drawImage(t.source,e,i,n,r)},e.fillRect=function(t,e,i,n,r){X.drawCall++,r&&(this.fillStyle=r),this.__fillRect(t,e,i,n)},e.fillText=function(t,e,i,n,r,s){X.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.fillStyle=r,this.textAlign=s,this.textBaseline="top"),this.__fillText(t,e,i)},e.fillBorderText=function(t,e,i,n,r,s,a,o){X.drawCall++,this.font=n,this.fillStyle=r,this.textBaseline="top",this.strokeStyle=s,this.lineWidth=a,this.textAlign=o,this.__strokeText(t,e,i),this.__fillText(t,e,i)},e.strokeText=function(t,e,i,n,r,s,a){X.drawCall++,3<arguments.length&&null!=n&&(this.font=n,this.strokeStyle=r,this.lineWidth=s,this.textAlign=a,this.textBaseline="top"),this.__strokeText(t,e,i)},e.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.clipRect=function(t,e,i,n){X.drawCall++,this.beginPath(),this.rect(t,e,i,n),this.clip()},e.drawTexture=function(t,e,i,n,r,s,a){X.drawCall++;var o=t.uv,h=t.bitmap.width,l=t.bitmap.height;this.drawImage(t.source,o[0]*h,o[1]*l,(o[2]-o[0])*h,(o[5]-o[3])*l,e+s,i+a,n,r)},e.drawTextureWithTransform=function(t,e,i,n,r,s,a,o,h){X.drawCall++;var l=t.uv,c=t.bitmap.width,u=t.bitmap.height;this.save(),1!=h&&(this.globalAlpha*=h),s?(this.transform(s.a,s.b,s.c,s.d,s.tx+a,s.ty+o),this.drawImage(t.source,l[0]*c,l[1]*u,(l[2]-l[0])*c,(l[5]-l[3])*u,e,i,n,r)):this.drawImage(t.source,l[0]*c,l[1]*u,(l[2]-l[0])*c,(l[5]-l[3])*u,e+a,i+o,n,r),this.restore()},e.drawTexture2=function(t,e,i,n,r,s,a,o){var h=o[0];if(h.loaded&&h.bitmap&&h.source){X.drawCall++;var l=1!==s;if(l){var c=this.globalAlpha;this.globalAlpha*=s}var u=h.uv,d=h.bitmap.width,_=h.bitmap.height;r?(this.save(),this.transform(r.a,r.b,r.c,r.d,r.tx+t,r.ty+e),this.drawImage(h.source,u[0]*d,u[1]*_,(u[2]-u[0])*d,(u[5]-u[3])*_,o[1]-i,o[2]-n,o[3],o[4]),this.restore()):this.drawImage(h.source,u[0]*d,u[1]*_,(u[2]-u[0])*d,(u[5]-u[3])*_,o[1]-i+t,o[2]-n+e,o[3],o[4]),l&&(this.globalAlpha=c)}},e.fillTexture=function(t,e,i,n,r,s,a,o){if(!o.pat){if(t.uv!=lt.DEF_UV){var h=new yt("2D");h.getContext("2d"),h.size(t.width,t.height),h.context.drawTexture(t,0,0,t.width,t.height,0,0),t=new lt(h)}o.pat=this.createPattern(t.bitmap.source,s)}var l=e,c=i,u=0,d=0;a&&(l+=a.x%t.width,c+=a.y%t.height,u-=a.x%t.width,d-=a.y%t.height),this.translate(l,c),this.fillRect(u,d,n,r,o.pat),this.translate(-l,-c)},e.drawTriangle=function(t,e,i,n,r,s,a,o){var h=t.bitmap,l=h.source,c=t.width,u=t.height,d=h.width,_=h.height,f=i[n]*d,p=i[r]*d,m=i[s]*d,g=i[n+1]*_,v=i[r+1]*_,y=i[s+1]*_,x=e[n],w=e[r],b=e[s],S=e[n+1],T=e[r+1],C=e[s+1];if(o){var M=(x+w+b)/3,I=(S+T+C)/3,E=x-M,A=S-I,D=Math.sqrt(E*E+A*A);x=M+E/D*(D+1),S=I+A/D*(D+1),A=T-I,w=M+(E=w-M)/(D=Math.sqrt(E*E+A*A))*(D+1),T=I+A/D*(D+1),A=C-I,b=M+(E=b-M)/(D=Math.sqrt(E*E+A*A))*(D+1),C=I+A/D*(D+1)}this.save(),a&&this.transform(a.a,a.b,a.c,a.d,a.tx,a.ty),this.beginPath(),this.moveTo(x,S),this.lineTo(w,T),this.lineTo(b,C),this.closePath(),this.clip();var P=1/(f*v+g*m+p*y-v*m-g*p-f*y),R=x*v+g*b+w*y-v*b-g*w-x*y,N=f*w+x*m+p*b-w*m-x*p-f*b,L=f*v*b+g*w*m+x*p*y-x*v*m-g*p*b-f*w*y,B=S*v+g*C+T*y-v*C-g*T-S*y,O=f*T+S*m+p*C-T*m-S*p-f*C,F=f*v*C+g*T*m+S*p*y-S*v*m-g*p*C-f*T*y;this.transform(R*P,B*P,N*P,O*P,L*P,F*P),this.drawImage(l,t.uv[0]*d,t.uv[1]*_,c,u,t.uv[0]*d,t.uv[1]*_,c,u),this.restore()},e.flush=function(){return 0},e.fillWords=function(t,e,i,n,r,s){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.textAlign="left";for(var a=0,o=t.length;a<o;a++){var h=t[a];if(this.__fillText(h.char,h.x+e,h.y+i),1===s){var l=h.height,c=.5*h.style.letterSpacing;c||(c=0),this.beginPath(),this.strokeStyle=r,this.lineWidth=1,this.moveTo(e+h.x-c+.5,i+h.y+l+.5),this.lineTo(e+h.x+h.width+c+.5,i+h.y+l+.5),this.stroke()}}},e.fillBorderWords=function(t,e,i,n,r,s,a){n&&(this.font=n),r&&(this.fillStyle=r),this.textBaseline="top",this.lineWidth=a,this.textAlign="left",this.strokeStyle=s;for(var o=0,h=t.length;o<h;o++){var l=t[o];this.__strokeText(l.char,l.x+e,l.y+i),this.__fillText(l.char,l.x+e,l.y+i)}},e.destroy=function(){this.canvas.width=this.canvas.height=0},e.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},e.drawCurves=function(t,e,i){this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.moveTo(t+n[0],e+n[1]);for(var r=2,s=n.length;r<s;)this.quadraticCurveTo(t+n[r++],e+n[r++],t+n[r++],e+n[r++]);this.stroke()},t.__init__=function(t){var e=laya.resource.Context.prototype;(t=t||CanvasRenderingContext2D.prototype).inited||(t.inited=!0,t.__fillText=t.fillText,t.__fillRect=t.fillRect,t.__strokeText=t.strokeText,["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach((function(i){t[i]=e[i]})))},t.replaceCanvasGetSet=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i.configurable)return!1;var n,r={};for(n in i)"set"!=n&&(r[n]=i[n]);var s=i.set;return r.set=function(t){s.call(this,t);var e=this.getContext("2d");e&&"__reset"in e&&e.__reset()},Object.defineProperty(t,e,r),!0},t.replaceGetSet=function(e,i){var n=Object.getOwnPropertyDescriptor(e,i);if(!n||!n.configurable)return!1;var r,s={};for(r in n)"set"!=r&&(s[r]=n[r]);var a=n.set,o="___"+i+"__";return t.newKeys.push(o),s.set=function(t){t!=this[o]&&(this[o]=t,a.call(this,t))},Object.defineProperty(e,i,s),!0},t._default=new t,t.newKeys=[],n(t,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),t}(),O=function(){function t(e){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++t._uniqueIDCounter,this._name=e||"Content Manager",t._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,t._resourceManagers.push(this),this._resources=[],this._records={}}r(t,"laya.resource.ResourceManager");var e=t.prototype;return i.imps(e,{"laya.resource.IDispose":!0}),e.getResourceByIndex=function(t){return this._resources[t]},e.getResourcesLength=function(){return this._resources.length},e.addResource=function(t){return t.resourceManager&&t.resourceManager.removeResource(t),-1===this._resources.indexOf(t)&&((t._resourceManager=this)._resources.push(t),this.addRecord(t.uri,t.__className,t.memorySize),this.addSize(t.memorySize),!0)},e.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e&&(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.memorySize,this.addRecord(t.uri,t.__className,-t.memorySize),!0)},e.unload=function(){for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++)t[e].destroy();t.length=0},e.dispose=function(){if(this===t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");t._resourceManagers.splice(t._resourceManagers.indexOf(this),1),t._isResourceManagersSorted=!1;for(var e=this._resources.slice(0,this._resources.length),i=0;i<e.length;i++){var n=e[i];n.resourceManager.removeResource(n),n.destroy()}e.length=0},e.addSize=function(t){t&&(this.autoRelease&&0<t&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=t)},e.addRecord=function(t,e,i){DEBUG&&i&&!t&&console.error(t,e,i)},e.garbageCollection=function(t){var e=this._resources;(e=e.slice()).sort((function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t._lastUseFrameCount-e._lastUseFrameCount}));for(var i=X.loopCount,n=0,r=e.length;n<r;n++){var s=e[n];if(!(1<i-s._lastUseFrameCount))return void(this._memorySize>=t&&(this._isOverflow=!0));if(s.releaseResource(),this._memorySize<t)return void(this._isOverflow=!1)}},s(0,e,"id",(function(){return this._id})),s(0,e,"name",(function(){return this._name}),(function(e){!e&&""===e||this._name===e||(this._name=e,t._isResourceManagersSorted=!1)})),s(0,e,"memorySize",(function(){return this._memorySize})),s(0,e,"records",(function(){return this._records})),s(1,t,"systemResourceManager",(function(){return t._systemResourceManager})),t.__init__=function(){t.currentResourceManager=t.systemResourceManager},t.getLoadedResourceManagerByIndex=function(e){return t._resourceManagers[e]},t.getLoadedResourceManagersCount=function(){return t._resourceManagers.length},t.recreateContentManagers=function(e){void 0===e&&(e=!1);for(var i=t.currentResourceManager,n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(var r=0;r<t.currentResourceManager._resources.length;r++)t.currentResourceManager._resources[r].releaseResource(e),t.currentResourceManager._resources[r].activeResource(e)}t.currentResourceManager=i},t.releaseContentManagers=function(e){void 0===e&&(e=!1);for(var i=t.currentResourceManager,n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(var r=0;r<t.currentResourceManager._resources.length;r++){var s=t.currentResourceManager._resources[r];!s.released&&s.releaseResource(e)}}t.currentResourceManager=i},t._uniqueIDCounter=0,t._isResourceManagersSorted=!1,t._resourceManagers=[],n(t,["_systemResourceManager",function(){return this._systemResourceManager=new t("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=t._systemResourceManager}]),t}(),F=(function(){function t(){}r(t,"laya.system.System"),t.changeDefinition=function(t,e){i[t]=e;var n=t+"=classObj";i._runScript(n)},t.__init__=function(){R.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function n(){}return r(n,"laya.utils.Browser"),s(1,n,"pixelRatio",(function(){return n.__init__(),-1<n.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:a.getPixelRatio()})),s(1,n,"height",(function(){return n.__init__(),(i.stage&&i.stage.canvasRotation?n.clientWidth:n.clientHeight)*n.pixelRatio})),s(1,n,"clientWidth",(function(){return n.__init__(),n.window.innerWidth||n.document.body.clientWidth})),s(1,n,"window",(function(){return n.__init__(),n._window})),s(1,n,"clientHeight",(function(){return n.__init__(),n.window.innerHeight||n.document.body.clientHeight||n.document.documentElement.clientHeight})),s(1,n,"width",(function(){return n.__init__(),(i.stage&&i.stage.canvasRotation?n.clientHeight:n.clientWidth)*n.pixelRatio})),s(1,n,"container",(function(){return n.__init__(),n._container||((n._container=n.createElement("div")).id="layaContainer",n.document.body.appendChild(n._container)),n._container}),(function(t){n._container=t})),s(1,n,"document",(function(){return n.__init__(),n._document})),n.__init__=function(){if(!n._window){n._window=a.getWindow(),n._document=n.window.document,n._window.addEventListener("message",(function(t){laya.utils.Browser._onMessage(t)}),!1),n.document.__createElement=n.document.createElement,t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)};var i=t.document.body.style;i["-webkit-user-select"]="none",i["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",n.userAgent=n.window.navigator.userAgent,n.onIOS=!!(n.u=n.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),n.onMobile=-1<n.u.indexOf("Mobile"),n.onIPhone=-1<n.u.indexOf("iPhone"),n.onMac=-1<n.u.indexOf("Mac OS X"),n.onIPad=-1<n.u.indexOf("iPad"),n.onAndroid=-1<n.u.indexOf("Android")||-1<n.u.indexOf("Adr"),n.onWP=-1<n.u.indexOf("Windows Phone"),n.onQQBrowser=-1<n.u.indexOf("QQBrowser"),n.onMQQBrowser=-1<n.u.indexOf("MQQBrowser")||-1<n.u.indexOf("Mobile")&&-1<n.u.indexOf("QQ"),n.onIE=!!n.window.ActiveXObject||"ActiveXObject"in n.window,n.onWeiXin=-1<n.u.indexOf("MicroMessenger"),n.onPC=!n.onMobile,n.onSafari=-1<n.u.indexOf("Safari"),n.onFirefox=-1<n.u.indexOf("Firefox"),n.onEdge=-1<n.u.indexOf("Edge"),n.onMiniGame=-1<n.u.indexOf("MiniGame"),n.onLimixiu=-1<n.u.indexOf("limixiu"),n.httpProtocol="http:"==n.window.location.protocol,n.onMiniGame&&null==n.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),n.webAudioEnabled=!!(n.window.AudioContext||n.window.webkitAudioContext||n.window.mozAudioContext),n.soundType=n.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",nt=n.webAudioEnabled?rt:et,n.webAudioEnabled&&rt.initWebAudio(),et._initMusicAudio(),n.enableTouch="ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch,t.focus(),E._soundClass=nt,E._musicClass=et,R._mainCanvas=R._mainCanvas||yt.create("2D"),n.canvas||(n.canvas=yt.create("2D"),n.context=n.canvas.getContext("2d"))}},n._onMessage=function(t){if(t.data&&"size"==t.data.name){if(n.window.innerWidth=t.data.width,n.window.innerHeight=t.data.height,n.window.__innerHeight=t.data.clientHeight,!n.document.createEvent)return void console.warn("no document.createEvent");var e=n.document.createEvent("HTMLEvents");return e.initEvent("resize",!1,!1),void n.window.dispatchEvent(e)}},n.createElement=function(t){return n.__init__(),n.document.__createElement(t)},n.getElementById=function(t){return n.__init__(),n.document.getElementById(t)},n.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},n.now=function(){return a.now()},n._window=null,n._document=null,n._container=null,n.userAgent=null,n.u=null,n.onIOS=!1,n.onMac=!1,n.onMobile=!1,n.onIPhone=!1,n.onIPad=!1,n.onAndroid=!1,n.onWP=!1,n.onQQBrowser=!1,n.onMQQBrowser=!1,n.onSafari=!1,n.onFirefox=!1,n.onEdge=!1,n.onIE=!1,n.onWeiXin=!1,n.onMiniGame=!1,n.onLimixiu=!1,n.onPC=!1,n.httpProtocol=!1,n.webAudioEnabled=!1,n.soundType=null,n.enableTouch=!1,n.canvas=null,n.context=null,n.__init$=function(){},n}()),k=function(){function t(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}r(t,"laya.utils.Byte");var e=t.prototype;return e.___resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(e){throw"___resizeBuffer err:"+t}},e.getString=function(){return this.rUTF(this.getUint16())},e.getFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},e.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},e.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},e.writeFloat32=function(t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},e.writeFloat64=function(t){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},e.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},e.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},e.writeInt32=function(t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},e.writeUint32=function(t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},e.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},e.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},e.writeUint16=function(t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},e.writeInt16=function(t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},e.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},e.writeUint8=function(t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},e._getUInt8=function(t){return this._d_.getUint8(t)},e._getUint16=function(t){return this._d_.getUint16(t,this._xd_)},e._getMatrix=function(){return new C(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},e.rUTF=function(t){for(var e=[],i=this._pos_+t,n=0,r=0,s=0,a=String.fromCharCode,o=this._u8d_;this._pos_<i;)(n=o[this._pos_++])<128?0!=n&&e.push(a(n)):n<224?e.push(a((63&n)<<6|127&o[this._pos_++])):n<240?(r=o[this._pos_++],e.push(a((31&n)<<12|(127&r)<<6|127&o[this._pos_++]))):(r=o[this._pos_++],s=o[this._pos_++],e.push(a((15&n)<<18|(127&r)<<12|s<<6&127|127&o[this._pos_++])));return e.join("")},e.getCustomString=function(t){for(var e=[],i=0,n=0,r=0,s=String.fromCharCode,a=this._u8d_;0<t;)if((n=a[this._pos_])<128)e.push(s(n)),this._pos_++,t--;else for(i=n-128,this._pos_++,t-=i;0<i;)n=a[this._pos_++],r=a[this._pos_++],e.push(s(r<<8|n)),i--;return e.join("")},e.clear=function(){this._pos_=0,this.length=0},e.__getBuffer=function(){return this._d_.buffer},e.writeUTFBytes=function(t){for(var e=0,i=(t+="").length;e<i;e++){var n=t.charCodeAt(e);n<=127?this.writeByte(n):n<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):n<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},e.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;if(65536<=i)throw"writeUTFString byte len more than 65536";this._d_.setUint16(e,i,this._xd_)},e.readUTFString=function(){return this.readUTFBytes(this.getUint16())},e.getUTFString=function(){return this.readUTFString()},e.readUTFBytes=function(t){if(void 0===t&&(t=-1),0==t)return"";var e=this.bytesAvailable;if(e<t)throw"readUTFBytes error - Out of bounds";return t=0<t?t:e,this.rUTF(t)},e.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},e.writeByte=function(t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},e.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},e.getByte=function(){return this.readByte()},e.ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},e.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_),this._pos_+=i},s(0,e,"buffer",(function(){var t=this._d_.buffer;return t.byteLength==this.length?t:t.slice(0,this.length)})),s(0,e,"endian",(function(){return this._xd_?"littleEndian":"bigEndian"}),(function(t){this._xd_="littleEndian"==t})),s(0,e,"length",(function(){return this._length}),(function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t),this._length=t})),s(0,e,"pos",(function(){return this._pos_}),(function(t){this._pos_=t})),s(0,e,"bytesAvailable",(function(){return this._length-this._pos_})),t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?"littleEndian":"bigEndian"}return t._sysEndian},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t._sysEndian=null,t}(),V=function(){function t(){}return r(t,"laya.utils.CacheManager"),t.regCacheByFunction=function(e,i){var n;t.unRegCacheByFunction(e,i),n={tryDispose:e,getCacheList:i},t._cacheList.push(n)},t.unRegCacheByFunction=function(e,i){var n,r=0;for(n=t._cacheList.length,r=0;r<n;r++)if(t._cacheList[r].tryDispose==e&&t._cacheList[r].getCacheList==i)return void t._cacheList.splice(r,1)},t.forceDispose=function(){var e=0,i=t._cacheList.length;for(e=0;e<i;e++)t._cacheList[e].tryDispose(!0)},t.beginCheck=function(e){void 0===e&&(e=15e3),i.timer.loop(e,null,t._checkLoop)},t.stopCheck=function(){i.timer.clear(null,t._checkLoop)},t._checkLoop=function(){var e=t._cacheList;if(!(e.length<1)){var i,n=F.now(),r=0;for(i=r=e.length;0<r&&(e[t._index=++t._index%i].tryDispose(!1),!(F.now()-n>t.loopTimeLimit));)r--}},t.loopTimeLimit=2,t._cacheList=[],t._index=0,t}(),U=function(){function t(){}return r(t,"laya.utils.ClassUtils"),t.regClass=function(e,i){t._classMap[e]=i},t.getRegClass=function(e){return t._classMap[e]},t.getInstance=function(e){var i=t.getClass(e);return i?new i:(console.warn("[error] Undefined class:",e),null)},t.createByJson=function(e,i,n,r,s){"string"==typeof e&&(e=JSON.parse(e));var a=e.props;if(!i&&!(i=s?s.runWith(e):t.getInstance(a.runtime||e.type)))return null;var o=e.child;if(o)for(var h=0,l=o.length;h<l;h++){var c=o[h];if("render"!==c.props.name&&"render"!==c.props.renderType||!i._$set_itemRender)if("Graphic"==c.type)t.addGraphicsToSprite(c,i);else if(t.isDrawType(c.type))t.addGraphicToSprite(c,i,!0);else{var u=t.createByJson(c,null,n,r,s);"Script"==c.type?u.hasOwnProperty("owner")?u.owner=i:u.hasOwnProperty("target")&&(u.target=i):"mask"==c.props.renderType?i.mask=u:i.addChild(u)}else i.itemRender=c}if(a)for(var d in a){var _=a[d];"var"===d&&n?n[_]=i:_ instanceof Array&&"function"==typeof i[d]?i[d].apply(i,_):i[d]=_}return r&&e.customProps&&r.runWith([i,e]),i.created&&i.created(),i},t.addGraphicsToSprite=function(e,i){var n;if((n=e.child)&&!(n.length<1)){var r;r=t._getGraphicsFromSprite(e,i);var s=0,a=0;e.props&&(s=t._getObjVar(e.props,"x",0),a=t._getObjVar(e.props,"y",0)),0!=s&&0!=a&&r.translate(s,a);var o,h=0;for(o=n.length,h=0;h<o;h++)t._addGraphicToGraphics(n[h],r);0!=s&&0!=a&&r.translate(-s,-a)}},t.addGraphicToSprite=function(e,i,n){var r;void 0===n&&(n=!1),r=n?t._getGraphicsFromSprite(e,i):i.graphics,t._addGraphicToGraphics(e,r)},t._getGraphicsFromSprite=function(t,e){var i,n;if(!t||!t.props)return e.graphics;switch(n=t.props.renderType){case"hit":case"unHit":var r;e.hitArea||(e.hitArea=new G),(r=e.hitArea)[n]||(r[n]=new f),i=r[n]}return i||(i=e.graphics),i},t._getTransformData=function(e){var i;(e.hasOwnProperty("pivotX")||e.hasOwnProperty("pivotY"))&&(i=i||new C).translate(-t._getObjVar(e,"pivotX",0),-t._getObjVar(e,"pivotY",0));var n=t._getObjVar(e,"scaleX",1),r=t._getObjVar(e,"scaleY",1),s=t._getObjVar(e,"rotation",0);return t._getObjVar(e,"skewX",0),t._getObjVar(e,"skewY",0),1==n&&1==r&&0==s||((i=i||new C).scale(n,r),i.rotate(.0174532922222222*s)),i},t._addGraphicToGraphics=function(e,i){var n,r;if((n=e.props)&&(r=t.DrawTypeDic[e.type])){var s,a;s=i;var o=t._getParams(n,r[1],r[2],r[3]);((a=t._tM)||1!=t._alpha)&&(s.save(),a&&s.transform(a),1!=t._alpha&&s.alpha(t._alpha)),s[r[0]].apply(s,o),(a||1!=t._alpha)&&s.restore()}},t._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},t._adptTextureData=function(t){return t[0]=at.getRes(t[0]),t},t._adptLinesData=function(e){return e[2]=t._getPointListByStr(e[2]),e},t.isDrawType=function(e){return"Image"!=e&&t.DrawTypeDic.hasOwnProperty(e)},t._getParams=function(e,i,n,r){var s;void 0===n&&(n=0),(s=t._temParam).length=i.length;var a,o,h=0;for(a=i.length,h=0;h<a;h++)s[h]=t._getObjVar(e,i[h][0],i[h][1]);return t._alpha=t._getObjVar(e,"alpha",1),o=t._getTransformData(e),t._tM=o?(n||(n=0),o.translate(s[n],s[n+1]),s[n]=s[n+1]=0,o):null,r&&t[r]&&(s=t[r](s)),s},t._getPointListByStr=function(t){var e,i,n=0;for(i=(e=t.split(",")).length,n=0;n<i;n++)e[n]=parseFloat(e[n]);return e},t._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},t._temParam=[],t._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},t.getClass=function(e){var n=t._classMap[e]||e;return"string"==typeof n?i.__classmap[n]:n},t._tM=null,t._alpha=NaN,n(t,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),t}(),H=function(){function t(e){if(this._color=[],"string"==typeof e){null===(this.strColor=e)&&(e="#000000"),"#"==e.charAt(0)&&(e=e.substr(1));var i=e.length;if(3==i||4==i){for(var n="",r=0;r<i;r++)n+=e[r]+e[r];e=n}var s=this.numColor=parseInt(e,16);if(8==e.length)return void(this._color=[parseInt(e.substr(0,2),16)/255,((16711680&s)>>16)/255,((65280&s)>>8)/255,(255&s)/255])}else s=this.numColor=e,this.strColor=q.toHexColor(s);this._color=[((16711680&s)>>16)/255,((65280&s)>>8)/255,(255&s)/255,1],this._color.__id=++t._COLODID}return r(t,"laya.utils.Color"),t._initDefault=function(){for(var e in t._DEFAULT={},t._COLOR_MAP)t._SAVE[e]=t._DEFAULT[e]=new t(t._COLOR_MAP[e]);return t._DEFAULT},t._initSaveMap=function(){for(var e in t._SAVE_SIZE=0,t._SAVE={},t._DEFAULT)t._SAVE[e]=t._DEFAULT[e]},t.create=function(e){var i=t._SAVE[e+""];return null!=i?i:(t._SAVE_SIZE<1e3||t._initSaveMap(),t._SAVE[e+""]=new t(e))},t._SAVE={},t._SAVE_SIZE=0,t._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},t._DEFAULT=t._initDefault(),t._COLODID=1,t}(),z=(function(){function t(){this._values=[],this._keys=[]}r(t,"laya.utils.Dictionary");var e=t.prototype;e.set=function(t,e){var i=this.indexOf(t);0<=i?this._values[i]=e:(this._keys.push(t),this._values.push(e))},e.indexOf=function(t){var e=this._keys.indexOf(t);return 0<=e?e:(t="string"==typeof t?Number(t):"number"==typeof t?t.toString():t,this._keys.indexOf(t))},e.get=function(t){var e=this.indexOf(t);return e<0?null:this._values[e]},e.remove=function(t){var e=this.indexOf(t);return 0<=e&&(this._keys.splice(e,1),this._values.splice(e,1),!0)},e.clear=function(){this._values.length=0,this._keys.length=0},s(0,e,"values",(function(){return this._values})),s(0,e,"keys",(function(){return this._keys}))}(),function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}r(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,n,r,s,a,o,h){void 0===h&&(h=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=n,this.elasticDistance=e?r:0,this.elasticBackTime=s,this.data=a,this._disableMouseEvent=o,this.ratio=h,1!=t.globalScaleX||1!=t.globalScaleY?this._parent=t.parent:this._parent=i.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,i.stage.on("mouseup",this,this.onStageMouseUp),i.stage.on("mouseout",this,this.onStageMouseUp),i.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){i.timer.clear(this,this.loop),i.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(v.instance.disableMouseEvent=!1,i.stage.off("mouseup",this,this.onStageMouseUp),i.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,n=t.y,r=e-this._lastX,s=n-this._lastY;if(this._clickOnly){if(!(1<Math.abs(r*i.stage._canvasTransform.getScaleX())||1<Math.abs(s*i.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),v.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(r,s);0==r&&0==s||(this._lastX=e,this._lastY=n,this.target.x+=r*this._elasticRateX,this.target.y+=s*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var t=this.area.x-this.target.x;else t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target.y<this.area.y)var e=this.area.y-this.target.y;else e=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(v.instance.disableMouseEvent=!1,i.stage.off("mouseup",this,this.onStageMouseUp),i.stage.off("mouseout",this,this.onStageMouseUp),i.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,n=Math.min(e,6),r=this._offsets.length-n,s=e-1;r<s;s--)this._offsetY+=this._offsets[s--],this._offsetX+=this._offsets[s];this._offsetX=this._offsetX/n*2,this._offsetY=this._offsetY/n*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),i.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target.x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target.y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=K.to(this.target,i,this.elasticBackTime,W.sineOut,l.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(i.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}()),W=function(){function t(){}return r(t,"laya.utils.Ease"),t.linearNone=function(t,e,i,n){return i*t/n+e},t.linearIn=function(t,e,i,n){return i*t/n+e},t.linearInOut=function(t,e,i,n){return i*t/n+e},t.linearOut=function(t,e,i,n){return i*t/n+e},t.bounceIn=function(e,i,n,r){return n-t.bounceOut(r-e,0,n,r)+i},t.bounceInOut=function(e,i,n,r){return e<.5*r?.5*t.bounceIn(2*e,0,n,r)+i:.5*t.bounceOut(2*e-r,0,n,r)+.5*n+i},t.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},t.backIn=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},t.backInOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=.5*n)<1?.5*i*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},t.backOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},t.elasticIn=function(e,i,n,r,s,a){var o;return void 0===s&&(s=0),void 0===a&&(a=0),0==e?i:1==(e/=r)?i+n:(a||(a=.3*r),o=!s||0<n&&s<n||n<0&&s<-n?(s=n,a/4):a/t.PI2*Math.asin(n/s),-s*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*t.PI2/a)+i)},t.elasticInOut=function(e,i,n,r,s,a){var o;return void 0===s&&(s=0),void 0===a&&(a=0),0==e?i:2==(e/=.5*r)?i+n:(a||(a=r*(.3*1.5)),o=!s||0<n&&s<n||n<0&&s<-n?(s=n,a/4):a/t.PI2*Math.asin(n/s),e<1?s*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*t.PI2/a)*-.5+i:s*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*t.PI2/a)*.5+n+i)},t.elasticOut=function(e,i,n,r,s,a){var o;return void 0===s&&(s=0),void 0===a&&(a=0),0==e?i:1==(e/=r)?i+n:(a||(a=.3*r),o=!s||0<n&&s<n||n<0&&s<-n?(s=n,a/4):a/t.PI2*Math.asin(n/s),s*Math.pow(2,-10*e)*Math.sin((e*r-o)*t.PI2/a)+n+i)},t.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e},t.sineIn=function(e,i,n,r){return-n*Math.cos(e/r*t.HALF_PI)+n+i},t.sineOut=function(e,i,n,r){return n*Math.sin(e/r*t.HALF_PI)+i},t.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e},t.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},t.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},t.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e},t.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},t.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},t.quadIn=function(t,e,i,n){return i*(t/=n)*t+e},t.quadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},t.quadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},t.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},t.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e},t.expoOut=function(t,e,i,n){return t==n?e+i:i*(1-Math.pow(2,-10*t/n))+e},t.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},t.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},t.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},t.HALF_PI=.5*Math.PI,t.PI2=2*Math.PI,t}(),G=function(){function t(){this._hit=null,this._unHit=null}r(t,"laya.utils.HitArea");var e=t.prototype;return e.isHit=function(e,i){return!!t.isHitGraphic(e,i,this.hit)&&!t.isHitGraphic(e,i,this.unHit)},e.contains=function(t,e){return this.isHit(t,e)},s(0,e,"hit",(function(){return this._hit||(this._hit=new f),this._hit}),(function(t){this._hit=t})),s(0,e,"unHit",(function(){return this._unHit||(this._unHit=new f),this._unHit}),(function(t){this._unHit=t})),t.isHitGraphic=function(e,i,n){if(!n)return!1;var r;if(!(r=n.cmds)&&n._one&&((r=t._cmds).length=1,r[0]=n._one),!r)return!1;var s,a,o=0;for(s=r.length,o=0;o<s;o++)if(a=r[o]){var h=R._context;switch(a.callee){case h._translate:case 6:e-=a[0],i-=a[1]}if(t.isHitCmd(e,i,a))return!0}return!1},t.isHitCmd=function(e,i,n){if(!n)return!1;var r=R._context,s=!1;switch(n.callee){case r._drawRect:case 13:t._rec.setTo(n[0],n[1],n[2],n[3]),s=t._rec.contains(e,i);break;case r._drawCircle:case r._fillCircle:case 14:s=(e-=n[0])*e+(i-=n[1])*i<n[2]*n[2];break;case r._drawPoly:case 18:e-=n[0],i-=n[1],s=t.ptInPolygon(e,i,n[2])}return s},t.ptInPolygon=function(e,i,n){var r;(r=t._ptPoint).setTo(e,i);var s,a=0,o=NaN,h=NaN,l=NaN,c=NaN;s=n.length;for(var u=0;u<s;u+=2)o=n[u],h=n[u+1],l=n[(u+2)%s],h!=(c=n[(u+3)%s])&&(r.y<Math.min(h,c)||r.y>=Math.max(h,c)||(r.y-h)*(l-o)/(c-h)+o>r.x&&a++);return a%2==1},t._cmds=[],n(t,["_rec",function(){return this._rec=new I},"_ptPoint",function(){return this._ptPoint=new M}]),t}(),Y=(function(){function t(e,i,n,r){this.char=e,this.charNum=e.charCodeAt(0),this._x=this._y=0,this.width=i,this.height=n,this.style=r,this.isWord=!t._isWordRegExp.test(e)}r(t,"laya.utils.HTMLChar");var e=t.prototype;i.imps(e,{"laya.display.ILayout":!0}),e.setSprite=function(t){this._sprite=t},e.getSprite=function(){return this._sprite},e._isChar=function(){return!0},e._getCSSStyle=function(){return this.style},s(0,e,"width",(function(){return this._w}),(function(t){this._w=t})),s(0,e,"x",(function(){return this._x}),(function(t){this._sprite&&(this._sprite.x=t),this._x=t})),s(0,e,"y",(function(){return this._y}),(function(t){this._sprite&&(this._sprite.y=t),this._y=t})),s(0,e,"height",(function(){return this._h}),(function(t){this._h=t})),t._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function t(){}r(t,"laya.utils.Log"),t.enable=function(){t._logdiv||(t._logdiv=F.window.document.createElement("div"),F.window.document.body.appendChild(t._logdiv),t._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},t.toggle=function(){var e=t._logdiv.style;"1px"==e.width?e.width=e.height="50%":e.width=e.height="1px"},t.print=function(e){t._logdiv&&(t.maxCount<=t._count&&t.clear(),t._count++,t._logdiv.innerText+=e+"\n",t._logdiv.scrollTop=t._logdiv.scrollHeight)},t.clear=function(){t._logdiv.innerText="",t._count=0},t._logdiv=null,t._count=0,t.maxCount=20}(),function(){function t(){}r(t,"laya.utils.Mouse"),s(1,t,"cursor",(function(){return t._style.cursor}),(function(e){t._style.cursor=e})),t.hide=function(){"none"!=t.cursor&&(t._preCursor=t.cursor,t.cursor="none")},t.show=function(){"none"==t.cursor&&(t.cursor=t._preCursor?t._preCursor:"auto")},t._preCursor=null,n(t,["_style",function(){return this._style=F.document.body.style}])}(),function(){function t(){}return r(t,"laya.utils.Pool"),t.getPoolBySign=function(e){return t._poolDic[e]||(t._poolDic[e]=[])},t.clearBySign=function(e){t._poolDic[e]&&(t._poolDic[e].length=0)},t.recover=function(e,i){i.__InPool||(i.__InPool=!0,t.getPoolBySign(e).push(i))},t.getItemByClass=function(e,i){var n=t.getPoolBySign(e),r=n.length?n.pop():new i;return r.__InPool=!1,r},t.getItemByCreateFun=function(e,i,n){var r=t.getPoolBySign(e),s=r.length?r.pop():i.call(n);return s.__InPool=!1,s},t.getItem=function(e){var i=t.getPoolBySign(e),n=i.length?i.pop():null;return n&&(n.__InPool=!1),n},t._poolDic={},t.InPoolSign="__InPool",t}()),X=function(){function t(){}return r(t,"laya.utils.Stat"),s(1,t,"onclick",null,(function(e){t._sp&&t._sp.on("click",t._sp,e),t._canvas&&(t._canvas.source.onclick=e,t._canvas.source.style.pointerEvents="")})),t.show=function(e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),!R.isConchApp||R.isConchWebGL){if(R.isConchWebGL||F.onMiniGame||F.onLimixiu||(t._useCanvas=!0),t._show=!0,t._fpsData.length=60,t._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},t._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},t._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},t._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},R.isWebGL)if(t._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},R.is3DMode)if(t._view[0].title="FPS(3D)",t._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},t._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},t._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==n){var r=8;t._view[r++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},t._view[r++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},t._view[r++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},t._view[r++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},t._view[r++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},t._view[r++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},t._view[r++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},t._view[r++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},t._view[r++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else 2==n&&(r=8,t._view[r++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},t._view[r++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},t._view[r++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},t._view[r++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},t._view[r++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},t._view[r++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},t._view[r++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2});else t._view[0].title="FPS(WebGL)",t._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else t._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};t._useCanvas?t.createUIPre(e,i):t.createUI(e,i),t.enable()}else F.window.conch.showFPS&&F.window.conch.showFPS(e,i)},t.createUIPre=function(e,i){var n=F.pixelRatio;t._width=170*n,t._vx=75*n,t._height=n*(12*t._view.length+3*n)+4,t._fontSize=12*n;for(var r=0;r<t._view.length;r++)t._view[r].x=4,t._view[r].y=r*t._fontSize+2*n;t._canvas||((t._canvas=new yt("2D")).size(t._width,t._height),(t._ctx=t._canvas.getContext("2d")).textBaseline="top",t._ctx.font=t._fontSize+"px Sans-serif",t._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+e+"px;top:"+i+"px;width:"+t._width/n+"px;height:"+t._height/n+"px;"),t._first=!0,t.loop(),t._first=!1,F.container.appendChild(t._canvas.source)},t.createUI=function(e,i){var n=t._sp,r=F.pixelRatio;n||(n=new ut,(t._leftText=new mt).pos(5,5),t._leftText.color="#ffffff",n.addChild(t._leftText),(t._txt=new mt).pos(80*r,5),t._txt.color="#ffffff",n.addChild(t._txt),t._sp=n),n.pos(e,i);for(var s="",a=0;a<t._view.length;a++)s+=t._view[a].title+"\n";t._leftText.text=s;var o=170*r,h=r*(12*t._view.length+3*r)+4;t._txt.fontSize=t._fontSize*r,t._leftText.fontSize=t._fontSize*r,n.size(o,h),n.graphics.clear(),n.graphics.setAlpha(.5),n.graphics.drawRect(0,0,o,h,"#999999"),n.graphics.setAlpha(1),t.loop()},t.enable=function(){i.timer.frameLoop(1,t,t.loop)},t.hide=function(){t._show=!1,i.timer.clear(t,t.loop),t._canvas&&F.removeElement(t._canvas.source)},t.clear=function(){t.trianglesFaces=t.drawCall=t.shaderCall=t.spriteCount=t.spriteRenderUseCacheCount=t.treeNodeCollision=t.treeSpriteCollision=t.canvasNormal=t.canvasBitmap=t.canvasReCache=0},t.loop=function(){t._count++;var e=F.now();if(!(e-t._timer<1e3)){var i=t._count;if(t.FPS=Math.round(1e3*i/(e-t._timer)),t._show){t.trianglesFaces=Math.round(t.trianglesFaces/i),t.spriteCount=t._useCanvas?(t.drawCall=Math.round(t.drawCall/i)-2,t.shaderCall=Math.round(t.shaderCall/i),Math.round(t.spriteCount/i)-1):(t.drawCall=Math.round(t.drawCall/i)-2,t.shaderCall=Math.round(t.shaderCall/i)-4,Math.round(t.spriteCount/i)-4),t.spriteRenderUseCacheCount=Math.round(t.spriteRenderUseCacheCount/i),t.canvasNormal=Math.round(t.canvasNormal/i),t.canvasBitmap=Math.round(t.canvasBitmap/i),t.canvasReCache=Math.ceil(t.canvasReCache/i),t.treeNodeCollision=Math.round(t.treeNodeCollision/i),t.treeSpriteCollision=Math.round(t.treeSpriteCollision/i);var n=0<t.FPS?Math.floor(1e3/t.FPS).toString():" ";t._fpsStr=t.FPS+(t.renderSlow?" slow":"")+" "+n,t._spriteStr=t.spriteCount+(t.spriteRenderUseCacheCount?"/"+t.spriteRenderUseCacheCount:""),t._canvasStr=t.canvasReCache+"/"+t.canvasNormal+"/"+t.canvasBitmap,t.currentMemorySize=O.systemResourceManager.memorySize,t._useCanvas?t.renderInfoPre():t.renderInfo(),t.clear()}t._count=0,t._timer=e}},t.renderInfoPre=function(){if(t._canvas){var e=t._ctx;e.clearRect(t._first?0:t._vx,0,t._width,t._height);for(var i=R.WebGL.mainContext,n=0;n<t._view.length;n++){var r=t._view[n];t._first&&(e.fillStyle="white",e.fillText(r.title,r.x,r.y,null,null,null)),e.fillStyle=r.color;var s=-1;if((r=t._view[n]).varying){if(i)switch(r.varying){case 1:s=i.getParameter(i[r.value]);break;case 2:s=i.getExtension(r.value)}}else s=t[r.value];"M"==r.units&&(s=Math.floor(s/1048576*100)/100+" M"),"K"==r.units&&(s=Math.floor(s/1024*100)/100+" K"),"string"==r.units&&(s=s.match(/\d+\.?\d/i)),e.fillText(s+"",r.x+t._vx,r.y,null,null,null)}}},t.renderInfo=function(){for(var e="",i=R.WebGL.mainContext,n=0;n<t._view.length;n++){var r=t._view[n],s=-1;if(r.varying){if(i)switch(r.varying){case 1:s=i.getParameter(i[r.value]);break;case 2:s=i.getExtension(r.value)}}else s=t[r.value];"M"==r.units&&(s=Math.floor(s/1048576*100)/100+" M"),"K"==r.units&&(s=Math.floor(s/1024*100)/100+" K"),"string"==r.units&&(s=s.match(/\d+\.?\d/i)),e+=s+"\n"}t._txt.text=e},t.FPS=0,t.loopCount=0,t.shaderCall=0,t.drawCall=0,t.trianglesFaces=0,t.spriteCount=0,t.spriteRenderUseCacheCount=0,t.treeNodeCollision=0,t.treeSpriteCollision=0,t.canvasNormal=0,t.canvasBitmap=0,t.canvasReCache=0,t.renderSlow=!1,t.currentMemorySize=0,t._fpsStr=null,t._canvasStr=null,t._spriteStr=null,t._fpsData=[],t._timer=0,t._count=0,t._view=[],t._fontSize=12,t._txt=null,t._leftText=null,t._sp=null,t._show=!1,t._useCanvas=!1,t._canvas=null,t._ctx=null,t._first=!1,t._vx=NaN,t._width=0,t._height=100,t}(),j=(function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}r(t,"laya.utils.StringKey");var e=t.prototype;e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e}}(),function(){var t;function e(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}r(e,"laya.utils.Timer");var n=e.prototype;return n._init=function(){i.timer&&i.timer.frameLoop(1,this,this._update)},n._now=function(){return Date.now()},n._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var t=this.currFrame=this.currFrame+this.scale,e=this._now();this._delta=(e-this._lastTimer)*this.scale;var n=this.currTimer=this.currTimer+this._delta;i.isDebug&&6e4<Math.abs(e-this._lastTimer)&&console.error("系统时间错误！"+(e-this._lastTimer)),this._lastTimer=e;var r=this._handlers;for(o=this._count=0,h=r.length;o<h;o++)if(null!==(l=r[o]).method){var s=l.userFrame?t:n;if(s>=l.exeTime)if(l.repeat)if(l.jumpFrame)for(;s>=l.exeTime;)l.exeTime+=l.delay,l.run(!1);else l.exeTime+=l.delay,l.run(!1),s>l.exeTime&&(l.exeTime+=Math.ceil((s-l.exeTime)/l.delay)*l.delay);else l.run(!0)}else this._count++;(30<this._count||t%200==0)&&this._clearHandlers();for(var a=this._laters,o=0,h=a.length-1;o<=h;o++){var l=a[o];this._isIgnoreRecover(l)||(null!==l.method&&(delete this._map[l.key],l.run(!1)),this._recoverHandler(l)),o===h&&(h=a.length-1)}a.length=0}},n._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var n=t[e];null!==n.method||this._isIgnoreRecover(n)?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,this._temp=t,this._temp.length=0},n._recoverHandler=function(t){this._map[t.key]==t&&delete this._map[t.key],t.recover()},n._create=function(e,i,n,r,s,a,o,h){if(!n)return s.apply(r,a),null;if(o){var l=this._getHandler(r,s);if(l)return l.repeat=i,l.userFrame=e,l.delay=n,l.ignoreRecover=h,l.caller=r,l.method=s,l.args=a,l.exeTime=n+(e?this.currFrame:this.currTimer+this._now()-this._lastTimer),l}return(l=t.create()).repeat=i,l.userFrame=e,l.delay=n,l.ignoreRecover=h,l.caller=r,l.method=s,l.args=a,l.exeTime=n+(e?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(l),this._handlers.push(l),l},n._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=q.getGID()):0,r=i.$_TID||(i.$_TID=this._mid++);t.key=n+"_"+r,this._map[t.key]=t},n.once=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!1,!1,t,e,i,n,r,!1)},n.loop=function(t,e,i,n,r,s,a){void 0===r&&(r=!0),void 0===s&&(s=!1),void 0===a&&(a=!1);var o=this._create(!1,!0,t,e,i,n,r,a);o&&(o.jumpFrame=s)},n.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!1,t,e,i,n,r,!1)},n.frameLoop=function(t,e,i,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=!1),this._create(!0,!0,t,e,i,n,r,s)},n.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+t._freeCount},n.clear=function(t,e){var i=this._getHandler(t,e);return!(!i||this._isIgnoreRecover(i)||(delete this._map[i.key],i.key=null,i.clear(),0))},n.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;e<i;e++){var n=this._handlers[e];n.caller===t&&(this._isIgnoreRecover(n)||(delete this._map[n.key],n.key=null,n.clear()))}},n._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=q.getGID()):0,n=e.$_TID||(e.$_TID=this._mid++);return this._map[i+"_"+n]},n._isIgnoreRecover=function(t){if(t.ignoreRecover||t.caller&&"IgnoreRecover"==t.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var e="";try{arguments.propertyIsEnumerable.caller}catch(t){e=t.stack}i.recordError("报错：核心定时器销毁忽略  "+e)}return!0}return!1},n.hasHandler=function(t,e){return this._map[t.$_GID+"_"+e.$_TID]},n.callLater=function(e,i,n){if(null==this._getHandler(e,i)){var r=t.create();r.caller=e,r.method=i,r.args=n,this._indexHandler(r),this._laters.push(r)}},n.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._isIgnoreRecover(i)||(delete this._map[i.key],i.run(!0)))},n.runTimer=function(t,e){this.runCallLater(t,e)},s(0,n,"delta",(function(){return this._delta})),e.__init$=function(){t=function(){function t(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}r(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},e.recover=function(){this.clear(),this.args=t._freeHandler,t._freeHandler=this,t._freeCount++},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,n=this.args;t&&this.clear(),null!=i&&(n?i.apply(e,n):i.call(e))},t._freeHandler=null,t._freeCount=0,t.create=function(){var e=t._freeHandler;return e?(t._freeHandler=e.args,--t._freeCount,e.args=null,e):new t},t}()},e}()),K=function(){function t(){this.gid=0}r(t,"laya.utils.Tween");var e=t.prototype;return e.to=function(t,e,i,n,r,s,a){return void 0===s&&(s=0),void 0===a&&(a=!1),this._create(t,e,i,n,r,s,a,!0,!1,!0)},e.from=function(t,e,i,n,r,s,a){return void 0===s&&(s=0),void 0===a&&(a=!1),this._create(t,e,i,n,r,s,a,!1,!1,!0)},e._create=function(e,n,r,s,a,o,h,l,c,u){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=r,this._ease=s||n.ease||t.easeNone,this._complete=a||n.complete,this._delay=o,this._props=[],this._usedTimer=0,this._startTimer=F.now(),this._usedPool=c,this._delayParam=null,this.update=n.update;var d=e.$_GID||(e.$_GID=q.getGID());return t.tweenMap[d]?(h&&t.clearTween(e),t.tweenMap[d].push(this)):t.tweenMap[d]=[this],u?o<=0?this.firstStart(e,n,l):(this._delayParam=[e,n,l],i.scaleTimer.once(o,this,this.firstStart,this._delayParam)):this._initProps(e,n,l),this},e.firstStart=function(t,e,i){this._delayParam=null,t.destroyed?this.clear():(this._initProps(t,e,i),this._beginLoop())},e._initProps=function(t,e,i){for(var n in e)if("number"==typeof t[n]){var r=i?t[n]:e[n],s=i?e[n]:t[n];this._props.push([n,r,s-r]),i||(t[n]=r)}},e._beginLoop=function(){i.scaleTimer.frameLoop(1,this,this._doEase)},e._doEase=function(){this._updateEase(F.now())},e._updateEase=function(e){var i=this._target;if(i){if(i.destroyed)return t.clearTween(i);var n=this._usedTimer=e-this._startTimer-this._delay;if(!(n<0)){if(n>=this._duration)return this.complete();for(var r=0<n?this._ease(n,0,1,this._duration):0,s=this._props,a=0,o=s.length;a<o;a++){var h=s[a];i[h[0]]=h[1]+r*h[2]}this.update&&this.update.run()}}},e.complete=function(){if(this._target){i.scaleTimer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,n=this._complete,r=0,s=e.length;r<s;r++){var a=e[r];t[a[0]]=a[1]+a[2]}this.update&&this.update.run(),this.clear(),n&&n.run()}},e.pause=function(){var t;i.scaleTimer.clear(this,this._beginLoop),i.scaleTimer.clear(this,this._doEase),i.scaleTimer.clear(this,this.firstStart),(t=F.now()-this._startTimer-this._delay)<0&&(this._usedTimer=t)},e.setStartTime=function(t){this._startTimer=t},e.clear=function(){this._target&&(this._remove(),this._clear())},e._clear=function(){this.pause(),i.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,Y.recover("tween",this))},e.recover=function(){this._usedPool=!0,this._clear()},e._remove=function(){var e=t.tweenMap[this._target.$_GID];if(e)for(var i=0,n=e.length;i<n;i++)if(e[i]===this){e.splice(i,1);break}},e.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=F.now(),this._delayParam)i.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var t=this._props,e=0,n=t.length;e<n;e++){var r=t[e];this._target[r[0]]=r[1]}i.scaleTimer.once(this._delay,this,this._beginLoop)}},e.resume=function(){this._usedTimer>=this._duration||(this._startTimer=F.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?i.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},s(0,e,"progress",null,(function(t){var e=t*this._duration;this._startTimer=F.now()-this._delay-e})),t.to=function(e,i,n,r,s,a,o,h){return void 0===a&&(a=0),void 0===o&&(o=!1),void 0===h&&(h=!0),Y.getItemByClass("tween",t)._create(e,i,n,r,s,a,o,!0,h,!0)},t.from=function(e,i,n,r,s,a,o,h){return void 0===a&&(a=0),void 0===o&&(o=!1),void 0===h&&(h=!0),Y.getItemByClass("tween",t)._create(e,i,n,r,s,a,o,!1,h,!0)},t.clearAll=function(e){if(e&&e.$_GID){var i=t.tweenMap[e.$_GID];if(i){for(var n=0,r=i.length;n<r;n++)i[n]._clear();i.length=0}}},t.clear=function(t){t.clear()},t.clearTween=function(e){t.clearAll(e)},t.easeNone=function(t,e,i,n){return i*t/n+e},t.tweenMap={},t}(),q=function(){function t(){}return r(t,"laya.utils.Utils"),t.toRadian=function(e){return e*t._pi2},t.toAngle=function(e){return e*t._pi},t.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},t.getGID=function(){return t._gid++},t.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t},t.clearArray=function(t){return t&&(t.length=0),t},t.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,n=e.length;for(i=0;i<n;i++)t[i]=e[i];return t},t.getGlobalRecByPoints=function(t,e,i,n,r){var s,a;return s=new M(e,i),s=t.localToGlobal(s),a=new M(n,r),a=t.localToGlobal(a),I._getWrapRec([s.x,s.y,a.x,a.y])},t.getGlobalPosAndScale=function(e){return t.getGlobalRecByPoints(e,0,0,1,1)},t.bind=function(t,e){return t.bind(e)},t.measureText=function(t,e){return a.measureText(t,e)},t.contextMeasureText=function(t){var e=F.context.measureText(t);return e||(e={width:16,height:16}),e},t.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,n=0,r=t.length,s=NaN;i<r;){for(e=t[n=i],s=t[n]._zOrder;-1<--n&&t[n]._zOrder>s;)t[n+1]=t[n];t[n+1]=e,i++}var a=e.parent.conchModel;if(a)if(null!=a.updateZOrder)a.updateZOrder();else{for(i=0;i<r;i++)a.removeChild(t[i].conchModel);for(i=0;i<r;i++)a.addChildAt(t[i].conchModel,i)}return!0},t.transPointList=function(t,e,i){var n=0,r=t.length;for(n=0;n<r;n+=2)t[n]+=e,t[n+1]+=i},t.parseInt=function(t,e){void 0===e&&(e=0);var i=F.window.parseInt(t,e);return isNaN(i)?0:i},t.getFileExtension=function(e){t._extReg.lastIndex=e.lastIndexOf(".");var i=t._extReg.exec(e);return i&&1<i.length?i[1].toLowerCase():null},t.getTransformRelativeToWindow=function(t,e,n){var r=i.stage,s=laya.utils.Utils.getGlobalPosAndScale(t),a=r._canvasTransform.clone(),o=a.tx,h=a.ty;a.rotate(-Math.PI/180*i.stage.canvasDegree),a.scale(i.stage.clientScaleX,i.stage.clientScaleY);var l=i.stage.canvasDegree%180!=0,c=NaN,u=NaN;l?(c=n+s.y,u=e+s.x,c*=a.d,u*=a.a,90==i.stage.canvasDegree?(c=o-c,u+=h):(c+=o,u=h-u)):(c=e+s.x,u=n+s.y,c*=a.a,u*=a.d,c+=o,u+=h);var d,_=NaN;return d=l?(_=a.d*s.height,a.a*s.width):(_=a.a*s.width,a.d*s.height),{x:c,y:u,scaleX:_,scaleY:d}},t.fitDOMElementInArea=function(e,n,r,s,a,o){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");var h=t.getTransformRelativeToWindow(n,r,s);e.style.transform=e.style.webkitTransform="scale("+h.scaleX+","+h.scaleY+") rotate("+i.stage.canvasDegree+"deg)",e.style.width=a+"px",e.style.height=o+"px",e.style.left=h.x+"px",e.style.top=h.y+"px"},t.isOkTextureList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;i<n;i++)if(!(e=t[i])||!e.source)return!1;return!0},t.isOKCmdList=function(t){if(!t)return!1;var e,i,n=0,r=t.length,s=R._context;for(n=0;n<r;n++)switch((e=t[n]).callee){case s._drawTexture:case s._fillTexture:case s._drawTextureWithTransform:if(!(i=e[0])||!i.source)return!1}return!0},t._gid=1,t._pi=180/Math.PI,t._pi2=Math.PI/180,t._extReg=/\.(\w+)\??/g,t.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),-1<(e=(new DOMParser).parseFromString(t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))if(console.error("html error    ===============>>>>>>>  "+t),-1!=t.indexOf("&")||-1!=t.indexOf('"')||-1!=t.indexOf(">")||-1!=t.indexOf("<")){var i=t.slice(6,t.length-7);i="<root>"+(i=(i=(i=(i=i.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/>/g,"&gt;")).replace(/</g,"&lt;"))+"</root>",e=(new DOMParser).parseFromString(i,"text/xml")}else e=(new DOMParser).parseFromString("<root>error...</root>","text/xml");return e},t}(),Z=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],R.isWebGL&&V.regCacheByFunction(q.bind(this.startDispose,this),q.bind(this.getCacheList,this))}r(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),Q=function(){function t(){this._obj=null,this._obj=t.supportWeakMap?new F.window.WeakMap:{},t.supportWeakMap||t._maps.push(this)}r(t,"laya.utils.WeakObject");var e=t.prototype;return e.set=function(e,i){if(null!=e)if(t.supportWeakMap){var n=e;"string"!=typeof e&&"number"!=typeof e||(n=t._keys[e])||(n=t._keys[e]={k:e}),this._obj.set(n,i)}else"string"==typeof e||"number"==typeof e?this._obj[e]=i:(e.$_GID||(e.$_GID=q.getGID()),this._obj[e.$_GID]=i)},e.get=function(e){if(null==e)return null;if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;return i?this._obj.get(i):null}return"string"==typeof e||"number"==typeof e?this._obj[e]:this._obj[e.$_GID]},e.del=function(e){if(null!=e)if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;if(!i)return;this._obj.delete(i)}else"string"==typeof e||"number"==typeof e?delete this._obj[e]:delete this._obj[this._obj.$_GID]},e.has=function(e){if(null==e)return!1;if(t.supportWeakMap){var i="string"==typeof e||"number"==typeof e?t._keys[e]:e;return this._obj.has(i)}return"string"==typeof e||"number"==typeof e?null!=this._obj[e]:null!=this._obj[this._obj.$_GID]},t.__init__=function(){(t.supportWeakMap=null!=F.window.WeakMap)||i.timer.loop(t.delInterval,null,t.clearCache)},t.clearCache=function(){for(var e=0,i=t._maps.length;e<i;e++)t._maps[e]._obj={}},t.supportWeakMap=!1,t.delInterval=3e5,t._keys={},t._maps=[],n(t,["I",function(){return this.I=new t}]),t}(),J=function(){function t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}r(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){this.changed=!0,this._text=t},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN},e.charAt=function(t){return this._text?this._text.charAt(t):null},s(0,e,"length",(function(){return this._text?this._text.length:0})),t}(),$=function(t){function e(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,e.__super.call(this),this._childs=e.ARRAY_EMPTY,this._$P=e.PROP_EMPTY,this.timer=i.scaleTimer,this.conchModel=R.isConchNode?this.createConchModel():null}r(e,"laya.display.Node",h);var n=e.prototype;return n._setBit=function(t,e){1==t&&this._getBit(t)!=e&&this._updateDisplayedInstage(),e?this._bits|=t:this._bits&=~t},n._getBit=function(t){return 0!=(this._bits&t)},n._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},n._setUpNoticeType=function(t){var e=this;for(e._setBit(t,!0),e=e.parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e.parent}},n.on=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!1)},n.once=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,n,!0)},n.createConchModel=function(){return null},n.destroy=function(t){void 0===t&&(t=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},n.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;-1<t;t--)this._childs[t].destroy(!0)},n.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var i=this.getChildIndex(t);i!==this._childs.length-1&&(this._childs.splice(i,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===e.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged();return t},n.addChildren=function(t){for(var e=arguments,i=0,n=e.length;i<n;)this.addChild(e[i++])},n.addChildAt=function(t,i){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=i&&i<=this._childs.length){if(t._parent===this){var n=this.getChildIndex(t);this._childs.splice(n,1),this._childs.splice(i,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,i)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===e.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(i,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,i),t.parent=this;return t}throw new Error("appendChildAt:The index is out of bounds")},n.getChildIndex=function(t){return this._childs.indexOf(t)},n.getChildByName=function(t){var e=this._childs;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.name===t)return r}return null},n._get$P=function(t){return this._$P[t]},n._set$P=function(t,i){return this.destroyed||(this._$P===e.PROP_EMPTY&&(this._$P={}),this._$P[t]=i),i},n.getChildAt=function(t){return this._childs[t]},n.setChildIndex=function(t,e){var i=this._childs;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(t);if(n<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged(),t},n._childChanged=function(t){},n.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)},n.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},n.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},n.removeChildAt=function(t){var e=this.getChildAt(t);if(e){for(var i=this._childs.length-1,n=t;n<i;++n)this._childs[n]=this._childs[n+1];this._childs.length=i,this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null}return e},n.removeChildren=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=2147483647),this._childs&&0<this._childs.length){var n=this._childs;if(0===t&&a<=i){var r=n;this._childs=e.ARRAY_EMPTY}else r=n.splice(t,i-t);for(var s=0,a=r.length;s<a;s++)r[s].parent=null,this.conchModel&&this.conchModel.removeChild(r[s].conchModel)}return this},n.replaceChild=function(t,e){var i=this._childs.indexOf(e);return-1<i?(this._childs.splice(i,1,t),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(t.conchModel,i)),e.parent=null,t.parent=this,t):null},n._updateDisplayedInstage=function(){var t;t=this;var e=i.stage;for(this._displayedInStage=!1;t;){if(t._getBit(1)){this._displayedInStage=t._displayedInStage;break}if(t==e||t._displayedInStage){this._displayedInStage=!0;break}t=t.parent}},n._setDisplay=function(t){this._displayedInStage!==t&&((this._displayedInStage=t)?this.event("display"):this.event("undisplay"))},n._displayChild=function(t,e){var i=t._childs;if(i)for(var n=0;n<i.length;n++){var r=i[n];r&&r._getBit(1)&&(0<r._childs.length?this._displayChild(r,e):r._setDisplay(e))}t._setDisplay(e)},n.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this)return!0;t=t.parent}return!1},n.timerLoop=function(t,e,i,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=!1),this.timer.loop(t,e,i,n,r,s)},n.timerOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!1,!1,t,e,i,n,r)},n.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!0,t,e,i,n,r)},n.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this.timer._create(!0,!1,t,e,i,n,r)},n.clearTimer=function(t,e){this.timer.clear(t,e)},s(0,n,"numChildren",(function(){return this._childs.length})),s(0,n,"destroyed",(function(){return this._destroyed})),s(0,n,"parent",(function(){return this._parent}),(function(t){this._parent!==t&&(t?(this._parent=t,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=t))})),s(0,n,"displayedInStage",(function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage})),e.ARRAY_EMPTY=[],e.PROP_EMPTY={},e.NOTICE_DISPLAY=1,e.MOUSEENABLE=2,e}(),tt=function(t){function e(t){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,e.__super.call(this),this._padding=e._PADDING,this._spacing=e._SPACING,this._aligns=e._ALIGNS,this._font=d.EMPTY,this._ower=t}r(e,"laya.display.css.CSSStyle",t);var i=e.prototype;return i.destroy=function(){this._ower=null,this._font=null,this._rect=null},i.inherit=function(t){this._font=t._font,this._spacing=t._spacing===e._SPACING?e._SPACING:t._spacing.slice(),this.lineHeight=t.lineHeight},i._widthAuto=function(){return 0!=(262144&this._type)},i.widthed=function(t){return 0!=(8&this._type)},i._calculation=function(t,e){if(e.indexOf("%")<0)return!1;var i=this._ower,n=i.parent,r=this._rect;function s(t,e,i){return t*i[0]+e*i[1]+i[2]}function a(t){var e=n.width,a=i.width;r.width&&(i.width=s(e,a,r.width)),r.height&&(i.height=s(e,a,r.height)),r.left&&(i.x=s(e,a,r.left)),r.top&&(i.y=s(e,a,r.top))}null===r&&(n._getCSSStyle()._type|=524288,n.on("resize",this,a),this._rect=r={input:{}});var o=e.split(" ");return o[0]=parseFloat(o[0])/100,1==o.length?o[1]=o[2]=0:(o[1]=parseFloat(o[1])/100,o[2]=parseFloat(o[2])),r[t]=o,r.input[t]=e,a(),!0},i.heighted=function(t){return 0!=(8192&this._type)},i.size=function(t,e){var i=this._ower,n=!1;-1!==t&&t!=this._ower.width&&(this._type|=8,this._ower.width=t,n=!0),-1!==e&&e!=this._ower.height&&(this._type|=8192,this._ower.height=e,n=!0),n&&(i._layoutLater(),524288&this._type&&i.event("resize",this))},i._getAlign=function(){return this._aligns[0]},i._getValign=function(){return this._aligns[1]},i._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},i._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new d(this._font))},i.render=function(t,e,i,n){var r=t.width,s=t.height;i-=t.pivotX,n-=t.pivotY,this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,n,r,s,this._bgground.color),this._border&&this._border.color&&e.drawRect(i,n,r,s,this._border.color.strColor,this._border.size)},i.getCSSStyle=function(){return this},i.cssText=function(t){this.attrs(e.parseOneCSS(t,";"))},i.attrs=function(t){if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];this[n[0]]=n[1]}},i.setTransform=function(t){"none"===t?this._tf=u._TF_EMPTY:this.attrs(e.parseOneCSS(t,","))},i.translate=function(t,e){this._tf===u._TF_EMPTY&&(this._tf=new _),this._tf.translateX=t,this._tf.translateY=e},i.scale=function(t,e){this._tf===u._TF_EMPTY&&(this._tf=new _),this._tf.scaleX=t,this._tf.scaleY=e},i._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},s(0,i,"block",t.prototype._$get_block,(function(t){t?this._type|=1:this._type&=-2})),s(0,i,"valign",(function(){return e._valigndef[this._aligns[1]]}),(function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=e._valigndef[t]})),s(0,i,"height",null,(function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)})),s(0,i,"width",null,(function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(0<=e&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)})),s(0,i,"fontWeight",(function(){return this._font.weight}),(function(t){this._createFont().weight=t})),s(0,i,"left",null,(function(t){var e=this._ower;if("string"==typeof t){if("center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0"),this._calculation("left",t))return;t=parseInt(t)}e.x=t})),s(0,i,"_translate",null,(function(t){this.translate(t[0],t[1])})),s(0,i,"absolute",(function(){return 0!=(4&this._type)})),s(0,i,"top",null,(function(t){var e=this._ower;if("string"==typeof t){if("middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0"),this._calculation("top",t))return;t=parseInt(t)}e.y=t})),s(0,i,"align",(function(){return e._aligndef[this._aligns[0]]}),(function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=e._aligndef[t]})),s(0,i,"bold",(function(){return this._font.bold}),(function(t){this._createFont().bold=t})),s(0,i,"padding",(function(){return this._padding}),(function(t){this._padding=t})),s(0,i,"leading",(function(){return this._spacing[1]}),(function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===e._SPACING&&(this._spacing=[0,0]),this._spacing[1]=t})),s(0,i,"lineElement",(function(){return 0!=(65536&this._type)}),(function(t){t?this._type|=65536:this._type&=-65537})),s(0,i,"cssFloat",(function(){return 0!=(32768&this._type)?"right":"left"}),(function(t){this.lineElement=!1,"right"===t?this._type|=32768:this._type&=-32769})),s(0,i,"textDecoration",(function(){return this._font.decoration}),(function(t){this._createFont().decoration=t})),s(0,i,"whiteSpace",(function(){return 131072&this._type?"nowrap":""}),(function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)})),s(0,i,"background",null,(function(t){t?(this._bgground||(this._bgground={}),this._bgground.color=t,this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._type|=16384,this._ower._renderType|=256):this._bgground=null})),s(0,i,"wordWrap",(function(){return 0==(131072&this._type)}),(function(t){t?this._type&=-131073:this._type|=131072})),s(0,i,"color",(function(){return this._font.color}),(function(t){this._createFont().color=t})),s(0,i,"password",(function(){return this._font.password}),(function(t){this._createFont().password=t})),s(0,i,"backgroundColor",(function(){return this._bgground?this._bgground.color:null}),(function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t),this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._ower._renderType|=256})),s(0,i,"font",(function(){return this._font.toString()}),(function(t){this._createFont().set(t)})),s(0,i,"weight",null,(function(t){this._createFont().weight=t})),s(0,i,"letterSpacing",(function(){return this._spacing[0]}),(function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===e._SPACING&&(this._spacing=[0,0]),this._spacing[0]=t})),s(0,i,"fontSize",(function(){return this._font.size}),(function(t){this._createFont().size=t})),s(0,i,"italic",(function(){return this._font.italic}),(function(t){this._createFont().italic=t})),s(0,i,"fontFamily",(function(){return this._font.family}),(function(t){this._createFont().family=t})),s(0,i,"stroke",(function(){return this._font.stroke[0]}),(function(t){this._createFont().stroke===d._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=t})),s(0,i,"strokeColor",(function(){return this._font.stroke[1]}),(function(t){this._createFont().stroke===d._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=t})),s(0,i,"border",(function(){return this._border?this._border.value:""}),(function(t){if("none"!=t){this._border||(this._border={});var e=(this._border.value=t).split(" ");if(this._border.color=H.create(e[e.length-1]),1==e.length)return this._border.size=1,void(this._border.type="solid");var i=0;0<e[0].indexOf("px")?(this._border.size=parseInt(e[0]),i++):this._border.size=1,this._border.type=e[i],this._ower._renderType|=256}else this._border=null})),s(0,i,"borderColor",(function(){return this._border&&this._border.color?this._border.color.strColor:null}),(function(t){t?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==t?null:H.create(t),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null})),s(0,i,"position",(function(){return 4&this._type?"absolute":""}),(function(t){"absolute"==t?this._type|=4:this._type&=-5})),s(0,i,"display",null,(function(t){switch(t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}})),s(0,i,"paddingLeft",(function(){return this.padding[3]})),s(0,i,"paddingTop",(function(){return this.padding[0]})),s(0,i,"_scale",null,(function(t){this._ower.scale(t[0],t[1])})),s(0,i,"_rotate",null,(function(t){this._ower.rotation=t})),e.parseOneCSS=function(t,i){for(var n,r=[],s=t.split(i),a=0,o=s.length;a<o;a++){var h=s[a],l=h.indexOf(":"),c=h.substr(0,l).replace(/^\s+|\s+$/g,"");if(0!=c.length){var u=h.substr(l+1).replace(/^\s+|\s+$/g,""),d=[c,u];switch(c){case"italic":case"bold":d[1]="true"==u;break;case"line-height":d[0]="lineHeight",d[1]=parseInt(u);break;case"font-size":d[0]="fontSize",d[1]=parseInt(u);break;case"padding":1<(n=u.split(" ")).length||(n[1]=n[2]=n[3]=n[0]),d[1]=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];break;case"rotate":d[0]="_rotate",d[1]=parseFloat(u);break;case"scale":n=u.split(" "),d[0]="_scale",d[1]=[parseFloat(n[0]),parseFloat(n[1])];break;case"translate":n=u.split(" "),d[0]="_translate",d[1]=[parseInt(n[0]),parseInt(n[1])];break;default:(d[0]=e._CSSTOVALUE[c])||(d[0]=c)}r.push(d)}}return r},e.parseCSS=function(t,i){for(var n;null!=(n=e._parseCSSRegExp.exec(t));)e.styleSheets[n[1]]=e.parseOneCSS(n[2],";")},e.EMPTY=new e(null),e._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},e._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),e._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},e._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},e.styleSheets={},e.ALIGN_CENTER=1,e.ALIGN_RIGHT=2,e.VALIGN_MIDDLE=1,e.VALIGN_BOTTOM=2,e._CSS_BLOCK=1,e._DISPLAY_NONE=2,e._ABSOLUTE=4,e._WIDTH_SET=8,e._PADDING=[0,0,0,0],e._RECT=[-1,-1,-1,-1],e._SPACING=[0,0],e._ALIGNS=[0,0,0],e.ADDLAYOUTED=512,e._NEWFONT=4096,e._HEIGHT_SET=8192,e._BACKGROUND_SET=16384,e._FLOAT_RIGHT=32768,e._LINE_ELEMENT=65536,e._NOWARP=131072,e._WIDTHAUTO=262144,e._LISTERRESZIE=524288,e}(u),et=function(t){function e(){this.url=null,this.audio=null,this.loaded=!1,e.__super.call(this)}r(e,"laya.media.h5audio.AudioSound",h);var i=e.prototype;return i.dispose=function(){var t=e._audioCache[this.url];t&&(t.src="",delete e._audioCache[this.url])},i.load=function(t){var i;if(t=P.formatURL(t),(this.url=t)==E._tMusic?(e._initMusicAudio(),(i=e._musicAudio).src!=t&&(e._audioCache[i.src]=null,i=null)):i=e._audioCache[t],i&&2<=i.readyState)this.event("complete");else{i||(i=t==E._tMusic?(e._initMusicAudio(),e._musicAudio):F.createElement("audio"),(e._audioCache[t]=i).src=t),i.addEventListener("canplaythrough",r),i.addEventListener("error",s);var n=this;(this.audio=i).load?i.load():s()}function r(){a(),n.loaded=!0,n.event("complete")}function s(){i.load=null,a(),n.event("error")}function a(){i.removeEventListener("canplaythrough",r),i.removeEventListener("error",s)}},i.play=function(t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=0),!this.url)return null;var r,s;if(!(r=this.url==E._tMusic?e._musicAudio:e._audioCache[this.url]))return null;s=Y.getItem("audio:"+this.url),R.isConchApp?s||((s=F.createElement("audio")).src=this.url):this.url==E._tMusic?(e._initMusicAudio(),(s=e._musicAudio).src=this.url):s=s||r.cloneNode(!0);var a=new dt(s);return a.url=this.url,a.loops=i,a.startTime=t,a.startHandler=n,a.play(!1),E.addChannel(a),a},s(0,i,"duration",(function(){var t;return(t=e._audioCache[this.url])?t.duration:0})),e._initMusicAudio=function(){e._musicAudio||(e._musicAudio||(e._musicAudio=F.createElement("audio")),R.isConchApp||F.document.addEventListener("mousedown",e._makeMusicOK))},e._makeMusicOK=function(){F.document.removeEventListener("mousedown",e._makeMusicOK),e._musicAudio.src?e._musicAudio.play():(e._musicAudio.src="",e._musicAudio.load())},e._audioCache={},e._musicAudio=null,e}(),it=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,e.__super.call(this)}r(e,"laya.media.SoundChannel",h);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},s(0,i,"volume",(function(){return 1}),(function(t){})),s(0,i,"position",(function(){return 0})),s(0,i,"duration",(function(){return 0})),e}(),nt=function(t){function e(){e.__super.call(this)}r(e,"laya.media.Sound",h);var i=e.prototype;return i.load=function(t){},i.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},s(0,i,"duration",(function(){return 0})),e}(),rt=function(t){function e(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,e.__super.call(this)}r(e,"laya.media.webaudio.WebAudioSound",h);var a=e.prototype;return a.load=function(t){this.url=t,this.audioBuffer=e._dataCache[t],this.audioBuffer?this._loaded(this.audioBuffer):(e.e.on("loaded:"+t,this,this._loaded),e.e.on("err:"+t,this,this._err),e.__loadingSound[t]||(e.__loadingSound[t]=!0,i.loader.load(t,l.create(this,this.onloaded),null,at.BUFFER,4,!1,null,!0)))},a.onloaded=function(t){t||this._err(),this._disposed?this._removeLoadEvents():(this.data=t,e.buffs.push({buffer:this.data,url:this.url}),e.decode())},a._err=function(){if(this._removeLoadEvents(),e.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var t,i,n,r=0;for(t=(i=this.__toPlays).length,r=0;r<t;r++)(n=i[r])[3]&&!n[3].isStopped&&n[3].event("error");this.__toPlays.length=0}},a._loaded=function(t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=t,this.loaded=!0,this.event("complete"))},a._removeLoadEvents=function(){e.e.off("loaded:"+this.url,this,this._loaded),e.e.off("err:"+this.url,this,this._err)},a.__playAfterLoaded=function(){if(this.__toPlays){var t,e,i,n=0;for(t=(e=this.__toPlays).length,n=0;n<t;n++)(i=e[n])[3]&&!i[3].isStopped&&this.play(i[0],i[1],i[2],i[3]);this.__toPlays.length=0}},a.play=function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),n=n||new _t,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i,n]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),n.url=this.url,n.loops=e,n.audioBuffer=this.audioBuffer,n.startTime=t,n.startHandler=i,n.play(!1),E.addChannel(n),n},a.dispose=function(){this._disposed=!0,delete e._dataCache[this.url],delete e.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},s(0,a,"duration",(function(){return this.audioBuffer?this.audioBuffer.duration:0})),e.decode=function(){if(!(e.buffs.length<=0||e.isDecoding))if(e.isDecoding=!0,(e.tInfo=e.buffs.shift())&&e.tInfo.buffer&&e.tInfo.buffer.byteLength)try{e.ctx.decodeAudioData(e.tInfo.buffer,e._done,e._fail)}catch(t){console.error("decodeAudioData error  byteLength:"+e.tInfo.buffer.byteLength+"  url:"+e.tInfo.url)}else e._fail()},e._done=function(t){e.e.event("loaded:"+e.tInfo.url,t),e._dataCache[e.tInfo.url]=t,e.isDecoding=!1,e.decode()},e._fail=function(){e.e.event("err:"+e.tInfo.url,null),e.isDecoding=!1,e.decode()},e._playEmptySound=function(){if(null!=e.ctx){if(e._emptySource&&(e._emptySource.stop(),e._emptySource.disconnect(0),!_t._tryCleanFailed))try{e._emptySource.buffer=null}catch(t){_t._tryCleanFailed=!0}var t=e.ctx.createBufferSource();t.buffer=e._miniBuffer,t.connect(e.ctx.destination),t.start(0,0,0),e._emptySource=t}},e._unlock=function(){e._unlocked||(e._playEmptySound(),"running"==e.ctx.state?(F.document.removeEventListener("mousedown",e._unlock,!0),F.document.removeEventListener("touchend",e._unlock,!0),F.document.removeEventListener("touchstart",e._unlock,!0),e._unlocked=!0):"suspended"==e.ctx.state&&E._recoverWebAudio())},e.initWebAudio=function(){"running"!=e.ctx.state&&(e._unlock(),F.document.addEventListener("mousedown",e._unlock,!0),F.document.addEventListener("touchend",e._unlock,!0),F.document.addEventListener("touchstart",e._unlock,!0))},e._emptySource=null,e._dataCache={},e.buffs=[],e.isDecoding=!1,e._unlocked=!1,e.tInfo=null,e.__loadingSound={},n(e,["window",function(){return this.window=F.window},"webAudioEnabled",function(){return this.webAudioEnabled=e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext},"ctx",function(){return this.ctx=e.webAudioEnabled?new(e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=e.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new h}]),e}(),st=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new F.window.XMLHttpRequest}r(e,"laya.net.HttpRequest",h);var i=e.prototype;return i.send=function(t,e,i,n,r){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null;var s=this,a=this._http;if(a.open(i,t,!0),r)for(var o=0;o<r.length;o++)a.setRequestHeader(r[o++],r[o]);else R.isConchApp||(e&&"string"!=typeof e?a.setRequestHeader("Content-Type","application/json"):a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));a.responseType="arraybuffer"!==n?"text":"arraybuffer",a.onerror=function(t){s._onError(t)},a.onabort=function(t){s._onAbort(t)},a.onprogress=function(t){s._onProgress(t)},a.onload=function(t){s._onLoad(t)},a.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(t){this.error("Request was aborted by user")},i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=q.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},s(0,i,"url",(function(){return this._http.responseURL})),s(0,i,"http",(function(){return this._http})),s(0,i,"data",(function(){return this._data})),e}(),at=function(e){function n(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,n.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}r(n,"laya.net.Loader",h);var a=n.prototype;return a.load=function(e,i,r,s,a){return e&&""!=e||console.error("Loader 加载的url不合法 "+e),void 0===r&&(r=!0),void 0===a&&(a=!1),this._url=e,this._base64=!1,0===e.indexOf("data:image")?(this._base64=!0,this._type=i="image"):this._type=i||(i=this.getTypeFromUrl(e)),this._cache=r,this._data=null,!a&&n.loadedMap[e]?(this._data=n.loadedMap[e],this.event("progress",1),void this.event("complete",this._data)):(s&&n.setGroup(e,s),null!=n.parserMap[i]?(this._customParse=!0,void(n.parserMap[i]instanceof laya.utils.Handler?n.parserMap[i].runWith(this):n.parserMap[i].call(null,this))):"image"===i||"htmlimage"===i||"nativeimage"===i?this._loadImage(e):"ttf"===i?this._loadTTF(e):void(n.preLoadedMap[e]?this.onLoaded(n.preLoadedMap[e]):t.resMgrLoad(e,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)))},a.getTypeFromUrl=function(t){var e=q.getFileExtension(t);return e?n.typeMap[e]:(console.warn("Not recognize the resources suffix",t),"text")},a._loadTTF=function(t){t=P.formatURL(t);var e=new D;e.complete=l.create(this,this.onLoaded),e.load(t)},a._loadBase64Image=function(t){t=P.formatURL(t);var e,i=this;function r(){e.onload=null,e.onerror=null,delete n.imgCache[t]}function s(){r(),i.onLoaded(e)}function a(){r(),i.event("error","Load image failed")}"nativeimage"===this._type?((e=new F.window.Image).crossOrigin="",e.onload=s,e.onerror=a,e.src=t,n.imgCache[t]=e):new bt.create(t,{onload:s,onerror:a,onCreate:function(i){e=i,n.imgCache[t]=i}})},a._loadImage=function(e){this._base64?this._loadBase64Image(e):t.imgMgrLoad(e,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},a._loadImageComplete=function(e,i,r){if(null!=r)if(r instanceof ArrayBuffer){var s=new DataView(r),a=new laya.webgl.resource.WebGLImage(new Uint8Array(r,8),e,0,!1,s.getUint32(0),s.getUint32(4));this.onLoaded(a)}else if(r instanceof lt)n.imgMgrSet[e]=i,t.imgMgrLock(e,n.imgMgrSet[e]),this._url=e,this.complete(r);else{var o=-1!=e.indexOf(".png",e.length-4)?6408:6407;a=new laya.webgl.resource.WebGLImage(r,e,o,!1,r.width,r.height),this.onLoaded(a)}else this.event("error","Load image failed")},a.imageCancel=function(e,i,n){t.imgMgrCancel&&t.imgMgrCancel(e,this._onImageCallback)},a._loadSound=function(t){var e=new E._soundClass,i=this;function n(){e.offAll()}e.on("complete",this,(function(){n(),i.onLoaded(e)})),e.on("error",this,(function(){n(),e.dispose(),i.event("error","Load sound failed")})),e.load(t)},a.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},a.onError=function(t){this.event("error",t)},a._loadedComplete=function(t,e,i){if(null!=i)switch(this._type){case"atlas":case"plf":case"json":var n=new k(i);this.onLoaded(JSON.parse(n.readUTFBytes()));break;case"font":n=new k(i),this.onLoaded(q.parseXMLFromString(n.readUTFBytes()));break;default:this.onLoaded(i)}else this.event("error",t)},a.onLoaded=function(t){var e=this._type;if("plf"==e)this.parsePLFData(t),this.complete(t);else if("image"===e){var i=new lt(t);i.url=this._url,this.complete(i)}else if("sound"===e||"htmlimage"===e||"nativeimage"===e)this.complete(t);else if("atlas"===e){if(!t.src&&!t._setContext){if(!this._data){if((this._data=t).meta&&t.meta.image)for(var r=t.meta.image.split(","),s=0<=this._url.indexOf("/")?"/":"\\",a=this._url.lastIndexOf(s),o=0<=a?this._url.substr(0,a+1):"",h=0,l=r.length;h<l;h++)r[h]=o+r[h];else r=[this._url.replace(".json",".png")];r.reverse(),t.toLoads=r,t.pics=[]}return this.event("progress",.3+1/r.length*.6),this._loadImage(r.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(t),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var u=this._data.frames,d=this._url.split("?")[0],_=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:d.substring(0,d.lastIndexOf("."))+"/",f=this._data.pics,p=P.formatURL(this._url),m=n.atlasMap[p]||(n.atlasMap[p]=[]);m.dir=_;var g=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var v in g=parseFloat(this._data.meta.scale),u){var y,x=u[v],w=f[x.frame.idx?x.frame.idx:0],b=P.formatURL(_+v);w.scaleRate=g,y=lt.create(w,x.frame.x,x.frame.y,x.frame.w,x.frame.h,x.spriteSourceSize.x,x.spriteSourceSize.y,x.sourceSize.w,x.sourceSize.h),n.cacheRes(b,y),n.keepCache(this._url,_+v),y.url=b,m.push(b)}else for(v in u)w=f[(x=u[v]).frame.idx?x.frame.idx:0],b=P.formatURL(_+v),n.cacheRes(b,lt.create(w,x.frame.x,x.frame.y,x.frame.w,x.frame.h,x.spriteSourceSize.x,x.spriteSourceSize.y,x.sourceSize.w,x.sourceSize.h)),n.loadedMap[b].url=b,n.keepCache(this._url,_+v),m.push(b);delete this._data.pics,this.complete(this._data)}else if("font"==e){if(!t.src)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var S=new c;S.parseFont(this._data,t);var T=this._url.split(".fnt")[0].split("/"),C=T[T.length-1];mt.registerBitmapFont(C,S),this._data=S,this.complete(this._data)}else if("pkm"==e){var M=bt.create(t,this._url),I=new lt(M);I.url=this._url,this.complete(I)}else this.complete(t)},a.parsePLFData=function(t){var e,i,r;for(e in t)switch(r=t[e],e){case"json":case"text":for(i in r)n.preLoadedMap[P.formatURL(i)]=r[i];break;default:for(i in r)n.preLoadedMap[P.formatURL(i)]=r[i]}},a.complete=function(t){this._data=t,this._customParse?this.event("loaded",t instanceof Array?[t]:t):(n._loaders.push(this),n._isWorking||n.checkNext())},a.endLoad=function(t){t&&(this._data=t),this._cache&&n.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},s(0,a,"url",(function(){return this._url})),s(0,a,"data",(function(){return this._data})),s(0,a,"cache",(function(){return this._cache})),s(0,a,"type",(function(){return this._type})),n.checkNext=function(){n._isWorking=!0;for(var t=F.now();n._startIndex<n._loaders.length;)if(F.now(),n._loaders[n._startIndex].endLoad(),n._startIndex++,F.now()-t>n.maxTimeOut)return console.warn("loader callback cost a long time:"+(F.now()-t)+" url="+n._loaders[n._startIndex-1].url),void i.timer.frameOnce(1,null,n.checkNext);n._loaders.length=0,n._startIndex=0,n._isWorking=!1},n.clearRes=function(t,e){if(null!=t){void 0===e&&(e=!1),t=P.formatURL(t);var i=n.getAtlas(t);if(i){for(var r=0,s=i.length;r<s;r++){var a=i[r],o=n.getRes(a);delete n.loadedMap[a],n.clearCache(t.substring(P.basePath.length),a.substring(P.basePath.length)),o&&o.destroy(e)}i.length=0,delete n.atlasMap[t],delete n.loadedMap[t]}else{var h=n.loadedMap[t];h&&(delete n.loadedMap[t],h instanceof laya.resource.Texture&&h.bitmap&&h.destroy(e))}}},n.clearTextureRes=function(t){t=P.formatURL(t);var e=laya.net.Loader.getAtlas(t),i=e&&0<e.length?laya.net.Loader.getRes(e[0]):laya.net.Loader.getRes(t);i&&i.bitmap&&(R.isConchApp&&!R.isConchWebGL?i.bitmap.source.releaseTexture&&i.bitmap.source.releaseTexture():null==i.bitmap._atlaser&&i.bitmap.releaseResource(!0))},n.getRes=function(t){return n.loadedMap[P.formatURL(t)]},n.getAtlas=function(t){return n.atlasMap[P.formatURL(t)]},n.cacheRes=function(t,e){t=P.formatURL(t),null!=n.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):n.loadedMap[t]=e},n.setGroup=function(t,e){n.groupMap[e]||(n.groupMap[e]=[]),n.groupMap[e].push(t)},n.clearResByGroup=function(t){if(n.groupMap[t]){var e=n.groupMap[t],i=0,r=e.length;for(i=0;i<r;i++)n.clearRes(e[i]);e.length=0}},n.keepCache=function(t,e){if(t&&e){var i=n.cacheSet[e];i?-1==i.indexOf(t)&&i.push(t):n.cacheSet[e]=[t]}},n.clearCache=function(e,i){if(e&&i){var r=n.cacheSet[i];if(r){var s=r.indexOf(e);if(-1!==s){var a=r.length-1;0==a?(delete n.cacheSet[i],0<n.imgMgrSet[i]?t.imgMgrFree(i,n.imgMgrSet[i]):n.clearRes(i,!0)):(r[s]=r[a],r.length=a)}}}},n.saveObject=function(t,e,i){if(e&&t){var r=n.objectSet[t];r?(console.warn("Loader.saveObject: "+t),r[0]=e,r[1]=i):n.objectSet[t]=[e,i,[]]}},n.findObject=function(t){if(t){var e=n.objectSet[t];if(e)return e[0]}return null},n.keepObject=function(t,e){if(t&&e){var i=n.objectSet[e];i&&-1===i[2].indexOf(t)&&i[2].push(t)}},n.clearObject=function(t,e){if(t&&e){var i=n.objectSet[e];if(i){var r=i[2],s=r.indexOf(t);if(-1!==s){var a=r.length-1;0==a?(delete n.objectSet[e],i[1]&&i[1].call(null,i[0])):(r[s]=r[a],r.length=a)}}}},n.TEXT="text",n.JSON="json",n.XML="xml",n.BUFFER="arraybuffer",n.IMAGE="image",n.SOUND="sound",n.ATLAS="atlas",n.FONT="font",n.TTF="ttf",n.PLF="plf",n.PKM="pkm",n.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},n.parserMap={},n.groupMap={},n.maxTimeOut=100,n.loadedMap={},n.preLoadedMap={},n.atlasMap={},n._loaders=[],n._isWorking=!1,n._startIndex=0,n.imgCache={},n.cacheSet={},n.objectSet={},n.imgMgrSet={},n}(),ot=function(t){var e;function s(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},s.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}r(s,"laya.net.LoaderManager",h);var a=s.prototype;return a.create=function(t,e,i,n,r,s,a,o){if(null==s&&(s=2),null==a&&(a=!0),t instanceof Array){var h=t,c=h.length,u=0;if(i)var d=l.create(i.caller,i.method,i.args,!1);for(var _=0;_<c;_++){var f=h[_];"string"==typeof f&&(f=h[_]={url:f}),f.progress=0}for(_=0;_<c;_++){f=h[_];var p=i?l.create(null,v,[f],!1):null,m=i||e?l.create(null,g,[f]):null;this._create(f.url,m,p,f.clas||n,f.params||r,null!=f.priority&&0<=f.priority?f.priority:s,a,f.group||o)}function g(t,i){u++,t.progress=1,u===c&&e&&e.run()}function v(t,e){t.progress=e;for(var i=0,n=0;n<c;n++)i+=h[n].progress;var r=i/c;d.runWith(r)}return!0}return this._create(t,e,i,n,r,s,a,o)},a._create=function(t,e,n,r,a,o,h,c){t&&""!=t||console.error("加载的url不合法 "+t),null==o&&(o=2),null==h&&(h=!0);var u=P.formatURL(t),d=this.getRes(u);if(d)!d.hasOwnProperty("loaded")||d.loaded?(n&&n.runWith(1),e&&e.run()):e&&i.loader._createListener(t,e.caller,e.method,e.args,!0,!1);else{var _=q.getFileExtension(t),f=s.createMap[_];if(!f)throw new Error("LoaderManager:unknown file("+t+") extension with: "+_+".");r||(r=f[0]);var p=f[1];"atlas"==_?this.load(t,e,n,p,o,h):(r===lt&&(p="htmlimage"),(d=r?new r:null).hasOwnProperty("_loaded")&&(d._loaded=!1),d._setUrl(t),c&&d._setGroup(c),this._createLoad(d,t,l.create(null,(function(n){d&&!d.destroyed&&n&&d.onAsynLoaded.call(d,t,n,a),e&&e.run(),i.loader.event(t)})),n,p,o,!1,c,!0),h&&this.cacheRes(u,d))}return d},a.load=function(t,n,r,a,o,h,l,c){t&&""!=t||console.error("加载的url不合法 "+t);var u=this;if(null==o&&(o=2),null==h&&(h=!0),void 0===c&&(c=!1),t instanceof Array)return this._loadAssets(t,n,r,a,o,h,l);var d=at.getRes(t);if(null!=d)i.timer.frameOnce(1,null,(function(){r&&r.runWith(1),n&&n.runWith(d),u._loaderCount||u.event("complete")}));else{var _=s._resMap[t];_?(n&&_._createListener("complete",n.caller,n.method,n.args,!1,!1),r&&_._createListener("progress",r.caller,r.method,r.args,!1,!1)):((_=this._infoPool.length?this._infoPool.pop():new e).url=t,_.clas=null,_.type=a,_.cache=h,_.group=l,_.ignoreCache=c,_.priority=o,n&&_.on("complete",n.caller,n.method,n.args),r&&_.on("progress",r.caller,r.method,r.args),s._resMap[t]=_,o=o<this._maxPriority?0<=o?o:0:this._maxPriority-1,this._resInfos[o].push(_),this._next())}return this},a.cancel=function(t,e,i){if(c=s._resMap[t]){e&&c.off("complete",e.caller,e.method,!1),i&&c.off("progress",i.caller,i.method,!1);var n=c.getListener("complete"),r=c.getListener("progress");if(!(n&&n.head||r&&r.head)){if(c.loader){var a=c.loader;a.imageCancel(t),a.offAll(),a._data=null,a._customParse=!1,a._url=null,a._class=null,a._type=null,this._loaders.push(a),this._loaderCount--,delete this._loaderMap[c.url]}for(var o=0;o<this._maxPriority;o++)for(var h=this._resInfos[o],l=h.length-1;-1<l;l--){var c;(c=h[l])&&c.url===t&&(h[l]=null,c.destroy(),c.offAll(),this._infoPool.push(c))}delete s._resMap[t],this._next()}}},a._createLoad=function(t,n,r,a,o,h,l,c,u){var d=this;if(null==h&&(h=2),null==l&&(l=!0),void 0===u&&(u=!1),n instanceof Array)return this._loadAssets(n,r,a,o,h,l,c);var _=at.getRes(n);if(null!=_)i.timer.frameOnce(1,null,(function(){a&&a.runWith(1),r&&r.runWith(_),d._loaderCount||d.event("complete")}));else{var f=s._resMap[n];f?(r&&f._createListener("complete",r.caller,r.method,r.args,!1,!1),a&&f._createListener("progress",a.caller,a.method,a.args,!1,!1)):((f=this._infoPool.length?this._infoPool.pop():new e).url=n,f.clas=t,f.type=o,f.cache=l,f.group=c,f.ignoreCache=u,f.priority=h,r&&f.on("complete",r.caller,r.method,r.args),a&&f.on("progress",a.caller,a.method,a.args),s._resMap[n]=f,h=h<this._maxPriority?0<=h?h:0:this._maxPriority-1,this._resInfos[h].push(f),this._next())}return this},a._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++)for(var e=this._resInfos[t];0<e.length;){var i=e.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event("complete")}},a._doLoad=function(t){var e=this._loaders.length?this._loaders.pop():new at;this._loaderCount++,(this._loaderMap[t.url]=e).on("complete",null,n),e.on("progress",null,(function(e){t.event("progress",e)})),e.on("error",null,(function(t){n(null)})),t.loader=e;var i=this;function n(n){e.offAll(),e._data=null,e._customParse=!1,e._url=null,e._class=null,e._type=null,i._loaders.push(e),i._loaderCount--,delete i._loaderMap[t.url],i._endLoad(t,n instanceof Array?[n]:n),i._next()}e._class=t.clas,1<=t.priority?(e.priority=t.priority,e.realTime=!1):(e.priority=0,e.realTime=!0),e.load(t.url,t.type,t.cache,t.group,t.ignoreCache)},a._endLoad=function(t,e){var n=t.url;if(null==e){var r=this._failRes[n]||0;if(r<this.retryNum)return console.warn("[warn]Retry to load:",n),this._failRes[n]=r+1,void i.timer.once(this.retryDelay,this,this._addReTry,[t],!1);console.warn("[error]Failed to load:",n),this.event("error",n)}this._failRes[n]&&(this._failRes[n]=0),delete s._resMap[n],t.event("complete",e),t.destroy(),t.offAll(),this._infoPool.push(t)},a._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},a.clearRes=function(t,e){void 0===e&&(e=!1),at.clearRes(t,e)},a.getRes=function(t){return at.getRes(t)},a.cacheRes=function(t,e){at.cacheRes(t,e)},a.clearTextureRes=function(t){at.clearTextureRes(t)},a.setGroup=function(t,e){at.setGroup(t,e)},a.clearResByGroup=function(t){at.clearResByGroup(t)},a.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var e=this._resInfos[t],i=e.length-1;-1<i;i--){var n=e[i];n&&(n.destroy(),n.offAll(),this._infoPool.push(n))}e.length=0}this._loaderCount=0,s._resMap={}},a.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;e<i;e++)this.cancelLoadByUrl(t[e])},a.cancelLoadByUrl=function(t){for(var e=0;e<this._maxPriority;e++)for(var i=this._resInfos[e],n=i.length-1;-1<n;n--){var r=i[n];r&&r.url===t&&(i[n]=null,r.destroy(),r.offAll(),this._infoPool.push(r))}s._resMap[t]&&delete s._resMap[t]},a._loadAssets=function(t,e,i,n,r,s,a){null==r&&(r=2),null==s&&(s=!0);for(var o=t.length,h=0,c=0,u=[],d=!0,_=0;_<o;_++){var f=t[_];if(!f)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+t);"string"==typeof f&&(f={url:f,type:n,size:1,priority:r}),f.size||(f.size=1),f.progress=0,c+=f.size,u.push(f);var p=i?l.create(null,v,[f],!1):null,m=e||i?l.create(null,g,[f]):null;this.load(f.url,m,p,f.type,null!=f.priority&&0<=f.priority?f.priority:2,s,f.group||a)}function g(t,i){h++,t.progress=1,i||(d=!1),h===o&&e&&e.runWith(d)}function v(t,e){if(null!=i){t.progress=e;for(var n=0,r=0;r<u.length;r++){var s=u[r];n+=s.size*s.progress}var a=n/c;i.runWith(a)}}return this},s.cacheRes=function(t,e){at.cacheRes(t,e)},s._resMap={},n(s,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),s.__init$=function(){e=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,e.__super.call(this)}return r(e,"",h),e.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},e}()},s}(),ht=(function(t){function e(t){e.__super.call(this),t||(t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var i=0,n=0,r=0;r<20;r++)r%5!=4?this._mat[i++]=t[r]:this._alpha[n++]=t[r];this._action=a.createFilterAction(32),this._action.data=this}r(e,"laya.filters.ColorFilter",x);var n=e.prototype;i.imps(n,{"laya.filters.IFilter":!0}),n.callNative=function(t){t._$P.cf=this,t.conchModel&&t.conchModel.setFilterMatrix&&t.conchModel.setFilterMatrix(this._mat,this._alpha)},s(0,n,"type",(function(){return 32})),s(0,n,"action",(function(){return this._action}))}(),function(t){function e(t,i,n){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===i&&(i=0),e.__super.call(this),this._byteClass=n||k,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,t&&0<i&&i<65535&&this.connect(t,i)}r(e,"laya.net.Socket",h);var i=e.prototype;i.connect=function(t,e){var i;i="https:"==F.window.location.protocol?"wss://"+t+":"+e:"ws://"+t+":"+e,this.connectByUrl(i)},i.connectByUrl=function(t){var e=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new F.window.WebSocket(t,this.protocols):this._socket=new F.window.WebSocket(t),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(t){e._onOpen(t)},this._socket.onmessage=function(t){e._onMessage(t)},this._socket.onclose=function(t){e._onClose(t)},this._socket.onerror=function(t){e._onError(t)}},i.cleanSocket=function(){try{this._socket.close()}catch(t){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},i.close=function(){if(null!=this._socket)try{this._socket.close()}catch(t){}},i._onOpen=function(t){this._connected=!0,this.event("open",t)},i._onMessage=function(t){if(t&&t.data){var e=t.data;if(this.disableInput&&e)this.event("message",e);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var i=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,e&&("string"==typeof e?this._input.writeUTFBytes(e):this._input.writeArrayBuffer(e),this._addInputPosition=this._input.pos,this._input.pos=i),this.event("message",e)}}},i._onClose=function(t){this._connected=!1,this.event("close",t)},i._onError=function(t){this.event("error",t)},i.send=function(t){this._socket.send(t)},i.flush=function(){if(this._output&&0<this._output.length){var t;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(e){t=e}this._output.endian=this.endian,this._output.clear(),t&&this.event("error",t)}},s(0,i,"input",(function(){return this._input})),s(0,i,"output",(function(){return this._output})),s(0,i,"connected",(function(){return this._connected})),s(0,i,"endian",(function(){return this._endian}),(function(t){this._endian=t,null!=this._input&&(this._input.endian=t),null!=this._output&&(this._output.endian=t)})),e.LITTLE_ENDIAN="littleEndian",e.BIG_ENDIAN="bigEndian"}(),function(t){function e(){e.__super.call(this),this._$1__id=++e._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(e._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,O.currentResourceManager&&O.currentResourceManager.addResource(this)}r(e,"laya.resource.Resource",h);var n=e.prototype;return i.imps(n,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),n._setUrl=function(t){var i;this._url!==t&&(this._url&&((i=e._urlResourcesMap[this._url]).splice(i.indexOf(this),1),0===i.length&&delete e._urlResourcesMap[this._url]),t&&((i=e._urlResourcesMap[t])||(e._urlResourcesMap[t]=i=[]),i.push(this)),this._url=t)},n._getGroup=function(){return this._group},n._setGroup=function(t){var i;this._group!==t&&(this._group&&((i=e._groupResourcesMap[this._group]).splice(i.indexOf(this),1),0===i.length&&delete e._groupResourcesMap[this._group]),t&&((i=e._groupResourcesMap[t])||(e._groupResourcesMap[t]=i=[]),i.push(this)),this._group=t)},n._addReference=function(){this._referenceCount++},n._removeReference=function(){this._referenceCount--},n._clearReference=function(){this._referenceCount=0},n._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},n.recreateResource=function(){this.completeCreate()},n.disposeResource=function(){},n.activeResource=function(t){void 0===t&&(t=!1),this._lastUseFrameCount=X.loopCount,!this._destroyed&&this.__loaded&&(this._released||t)&&this.recreateResource()},n.releaseResource=function(t){return void 0===t&&(t=!0),!(!t&&this.lock||this._released&&!t||(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),0))},n.onAsynLoaded=function(t,e,i){throw new Error("Resource: must override this function!")},n.destroy=function(){var t;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete e._idResourcesMap[this.id],this._url&&((t=e._urlResourcesMap[this._url])&&(t.splice(t.indexOf(this),1),0===t.length&&delete e._urlResourcesMap[this.url]),at.clearRes(this._url),this.__loaded||a.cancelLoadByUrl(this._url)),this._group&&((t=e._groupResourcesMap[this._group]).splice(t.indexOf(this),1),0===t.length&&delete e._groupResourcesMap[this.url]))},n.completeCreate=function(){this._released=!1,this.event("recovered",this)},n.dispose=function(){this.destroy()},s(0,n,"memorySize",(function(){return this._memorySize}),(function(t){var e=t-this._memorySize;this._memorySize=t,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,e),this.resourceManager&&this.resourceManager.addSize(e)})),s(0,n,"_loaded",null,(function(t){this.__loaded=t})),s(0,n,"loaded",(function(){return this.__loaded})),s(0,n,"id",(function(){return this._$1__id})),s(0,n,"destroyed",(function(){return this._destroyed})),s(0,n,"group",(function(){return this._getGroup()}),(function(t){this._setGroup(t)})),s(0,n,"resourceManager",(function(){return this._resourceManager})),s(0,n,"url",(function(){return this._url})),s(0,n,"released",(function(){return this._released})),s(0,n,"referenceCount",(function(){return this._referenceCount})),e.getResourceByID=function(t){return e._idResourcesMap[t]},e.getResourceByURL=function(t,i){return void 0===i&&(i=0),null==e._urlResourcesMap[t]?null:e._urlResourcesMap[t][i]},e.getResourceCountByURL=function(t){return e._urlResourcesMap[t].length},e.destroyUnusedResources=function(t){var i;if(t){var n=e._groupResourcesMap[t];if(n)for(var r=n.slice(),s=0,a=r.length;s<a;s++)(i=r[s]).lock||0!==i._referenceCount||i.destroy()}else for(var o in e._idResourcesMap)(i=e._idResourcesMap[o]).lock||0!==i._referenceCount||i.destroy()},e._uniqueIDCounter=0,e._idResourcesMap={},e._urlResourcesMap={},e._groupResourcesMap={},e}()),lt=function(e){function n(t,e){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,n.__super.call(this),t&&null!=t._addReference&&t._addReference(),this.setTo(t,e)}r(n,"laya.resource.Texture",h);var o=n.prototype;return o._setUrl=function(t){this.url=t},o.setTo=function(e,i){if(e instanceof t.HTMLElement){var r=yt.create("2D",e);this.bitmap=r}else this.bitmap=e;if(this.uv=i||n.DEF_UV,e){this._w=e.width,this._h=e.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var s=this;if(this._loaded)a.addToAtlas&&a.addToAtlas(s);else{var o=e;o instanceof laya.resource.HTMLImage&&o.image&&o.image.addEventListener("load",(function(t){a.addToAtlas&&a.addToAtlas(s)}),!1)}}},o.active=function(){this.bitmap&&this.bitmap.activeResource()},o.destroy=function(t){if(void 0===t&&(t=!1),this.alphaTexture&&(this.alphaTexture.destroy(t),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var e=this.bitmap;t?(R.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose(),e._clearReference()):(e._removeReference(),0==e.referenceCount&&(R.isConchApp&&e.source&&e.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,e.dispose())),this.url&&this===i.loader.getRes(this.url)&&i.loader.clearRes(this.url,t),this._loaded=!1}},o.load=function(t){var e=this;this._loaded=!1,t=P.customFormat(t);var i=this.bitmap||(this.bitmap=bt.create(t));i.uri=t,i&&i._addReference();var n=this;i.onload=function(){i.onload=null,n._loaded=!0,e.sourceWidth=e._w=i.width,e.sourceHeight=e._h=i.height,n.event("loaded",this),a.addToAtlas&&a.addToAtlas(n)}},o.addTextureToAtlas=function(t){a.addTextureToAtlas(this)},o.getPixels=function(t,e,i,n){if(R.isConchApp){var r=this.bitmap;if(r.source&&r.source.getImageData){var s=r.source.getImageData(t,e,i,n),o=new Uint8Array(s);return Array.from(o)}return null}return R.isWebGL?a.getTexturePixels(this,t,e,i,n):(F.canvas.size(i,n),F.canvas.clear(),F.context.drawTexture(this,-t,-e,this.width,this.height,0,0),F.context.getImageData(0,0,i,n).data)},o.onAsynLoaded=function(t,e){if(e){if("function"!=typeof e._addReference)throw new Error("bitmap._addReference is not a function. "+e.className+" "+typeof e._addReference+" "+e.constructor);e._addReference()}this.setTo(e,this.uv),this._loaded&&this.event("loaded",this)},s(0,o,"source",(function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null})),s(0,o,"loaded",(function(){return this._loaded})),s(0,o,"released",(function(){return!this.bitmap||this.bitmap.released})),s(0,o,"width",(function(){return this._w?this._w:this.uv&&this.uv!==n.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width}),(function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)})),s(0,o,"repeat",(function(){return!R.isWebGL||!this.bitmap||this.bitmap.repeat}),(function(t){t&&R.isWebGL&&this.bitmap&&(this.bitmap.repeat=t)&&(this.bitmap.enableMerageInAtlas=!1)})),s(0,o,"height",(function(){return this._h?this._h:this.uv&&this.uv!==n.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height}),(function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)})),s(0,o,"isLinearSampling",(function(){return!R.isWebGL||9728!=this.bitmap.minFifter}),(function(t){!t&&R.isWebGL&&(t||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))})),n.moveUV=function(t,e,i){for(var n=0;n<8;n+=2)i[n]+=t,i[n+1]+=e;return i},n.create=function(t,e,i,r,s,o,h,l,c){void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===c&&(c=0);var u=t instanceof laya.resource.Texture,d=u?t.uv:n.DEF_UV,_=u?t.bitmap:t,f=a.isAtlas(_);if(f){var p=_._atlaser,m=t._atlasID;if(-1==m)throw new Error("create texture error");_=p._inAtlasTextureBitmapValue[m],d=p._inAtlasTextureOriUVValue[m]}var g=new n(_,null);if(!_)return null;_.width&&e+r>_.width&&(r=_.width-e),_.height&&i+s>_.height&&(s=_.height-i),g.width=r,g.height=s,g.offsetX=o,g.offsetY=h,g.sourceWidth=l||r,g.sourceHeight=c||s;var v=1/_.width,y=1/_.height;e*=v,i*=y,r*=v,s*=y;var x=g.uv[0],w=g.uv[1],b=g.uv[4],S=g.uv[5],T=b-x,C=S-w,M=n.moveUV(d[0],d[1],[e,i,e+r,i,e+r,i+s,e,i+s]);g.uv=[x+M[0]*T,w+M[1]*C,b-(1-M[2])*T,w+M[3]*C,b-(1-M[4])*T,S-(1-M[5])*C,x+M[6]*T,S-(1-M[7])*C],f&&g.addTextureToAtlas();var I=_.scaleRate;return I&&1!=I?(g.sourceWidth/=I,g.sourceHeight/=I,g.width/=I,g.height/=I,g.scaleRate=I,g.offsetX/=I,g.offsetY/=I):g.scaleRate=1,g},n.createFromTexture=function(t,e,i,r,s){var a=t.scaleRate;1!=a&&(e*=a,i*=a,r*=a,s*=a);var o=I.TEMP.setTo(e-t.offsetX,i-t.offsetY,r,s),h=o.intersection(n._rect1.setTo(0,0,t.width,t.height),n._rect2);if(!h)return null;var l=n.create(t,h.x,h.y,h.width,h.height,h.x-o.x,h.y-o.y,r,s);if(l.bitmap&&l.bitmap._removeReference)return l.bitmap._removeReference(),l;var c="bitmap:"+(l.bitmap?l.bitmap.constructor?l.bitmap.constructor.name:l.bitmap.__className:"")+", url:"+t.url+" | "+(l.bitmap?l.bitmap.url:t.url)+", x="+e+",y="+i+",width="+r+",height="+s+", result="+(h?h.x+","+h.y+","+h.width+","+h.height:"null")+", rect="+o.x+","+o.y+","+o.width+","+o.height;throw new Error("报错：bitmap._removeReference is not a function  "+c)},n.DEF_UV=[0,0,1,0,1,1,0,1],n.INV_UV=[0,1,1,1,1,0,0,0],n._rect1=new I,n._rect2=new I,n}(),ct=function(t){var e;function n(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,n.__super.call(this)}r(n,"laya.utils.TimeLine",h);var a=n.prototype;return a.to=function(t,e,i,n,r){return void 0===r&&(r=0),this._create(t,e,i,n,r,!0)},a.from=function(t,e,i,n,r){return void 0===r&&(r=0),this._create(t,e,i,n,r,!1)},a._create=function(t,i,n,r,s,a){var o=Y.getItemByClass("tweenData",e);return o.isTo=a,o.type=0,o.target=t,o.duration=n,o.data=i,o.startTime=this._startTime+s,o.endTime=o.startTime+o.duration,o.ease=r,this._startTime=Math.max(o.endTime,this._startTime),this._tweenDataList.push(o),this._startTimeSort=!0,this._endTimeSort=!0,this},a.addLabel=function(t,i){var n=Y.getItemByClass("tweenData",e);return n.type=1,n.data=t,n.endTime=n.startTime=this._startTime+i,this._labelDic||(this._labelDic={}),this._labelDic[t]=n,this._tweenDataList.push(n),this},a.removeLabel=function(t){if(this._labelDic&&this._labelDic[t]){var e=this._labelDic[t];if(e){var i=this._tweenDataList.indexOf(e);-1<i&&this._tweenDataList.splice(i,1)}delete this._labelDic[t]}},a.gotoTime=function(t){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var e,i,n,r;for(var s in this._firstTweenDic)if(i=this._firstTweenDic[s])for(var a in i)i.diyTarget.hasOwnProperty(a)&&(i.diyTarget[a]=i[a]);for(s in this._tweenDic)(e=this._tweenDic[s]).clear(),delete this._tweenDic[s];this._index=0,this._gidIndex=0,this._currTime=t,this._lastTime=F.now(),null==this._endTweenDataList||this._endTimeSort?(this._endTimeSort=!1,this._endTweenDataList=n=this._tweenDataList.concat(),n.sort((function(t,e){return t.endTime>e.endTime?1:t.endTime<e.endTime?-1:0}))):n=this._endTweenDataList;for(var o=0,h=n.length;o<h;o++)if(0==(r=n[o]).type){if(!(t>=r.endTime))break;this._index=Math.max(this._index,o+1);var c=r.data;if(r.isTo)for(var u in c)r.target[u]=c[u]}for(o=0,h=this._tweenDataList.length;o<h;o++)0==(r=this._tweenDataList[o]).type&&t>=r.startTime&&t<r.endTime&&(this._index=Math.max(this._index,o+1),this._gidIndex++,(e=Y.getItemByClass("tween",K))._create(r.target,r.data,r.duration,r.ease,l.create(this,this._animComplete,[this._gidIndex]),0,!1,r.isTo,!0,!1),e.setStartTime(this._currTime-(t-r.startTime)),e._updateEase(this._currTime),e.gid=this._gidIndex,this._tweenDic[this._gidIndex]=e)}},a.gotoLabel=function(t){if(null!=this._labelDic){var e=this._labelDic[t];e&&this.gotoTime(e.startTime)}},a.pause=function(){i.timer.clear(this,this._update)},a.resume=function(){this.play(this._currTime,this._loopKey)},a.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort((function(t,e){return t.startTime>e.startTime?1:t.startTime<e.startTime?-1:0}));for(var n=0,r=this._tweenDataList.length;n<r;n++){var s=this._tweenDataList[n];if(null!=s&&0==s.type){var a=s.target,o=a.$_GID||(a.$_GID=q.getGID()),h=null;for(var l in null==this._firstTweenDic[o]?((h={}).diyTarget=a,this._firstTweenDic[o]=h):h=this._firstTweenDic[o],s.data)null==h[l]&&(h[l]=a[l])}}}"string"==typeof t?this.gotoLabel(t):this.gotoTime(t),this._loopKey=e,this._lastTime=F.now(),i.timer.frameLoop(1,this,this._update)}},a._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var t in this._tweenDic)(e=this._tweenDic[t]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var e,i=F.now(),n=i-this._lastTime,r=this._currTime+=n*this.scale;for(t in this._lastTime=i,this._tweenDic)(e=this._tweenDic[t])._updateEase(r);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var s=this._tweenDataList[this._index];r>=s.startTime&&(this._index++,0==s.type?(this._gidIndex++,(e=Y.getItemByClass("tween",K))._create(s.target,s.data,s.duration,s.ease,l.create(this,this._animComplete,[this._gidIndex]),0,!1,s.isTo,!0,!1),e.setStartTime(r),e.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=e)._updateEase(r)):this.event("label",s.data))}},a._animComplete=function(t){this._tweenDic[t]&&delete this._tweenDic[t]},a._complete=function(){this.event("complete")},a.reset=function(){var t;if(this._labelDic)for(t in this._labelDic)delete this._labelDic[t];for(t in this._tweenDic)this._tweenDic[t].clear(),delete this._tweenDic[t];for(t in this._firstTweenDic)delete this._firstTweenDic[t];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var e,n=0;for(e=this._tweenDataList.length,n=0;n<e;n++)this._tweenDataList[n]&&this._tweenDataList[n].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,i.timer.clear(this,this._update)},a.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},s(0,a,"index",(function(){return this._frameIndex}),(function(t){this._frameIndex=t,this.gotoTime(this._frameIndex/this._frameRate*1e3)})),s(0,a,"total",(function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total})),n.to=function(t,e,i,r,s){return void 0===s&&(s=0),(new n).to(t,e,i,r,s)},n.from=function(t,e,i,r,s){return void 0===s&&(s=0),(new n).from(t,e,i,r,s)},n.__init$=function(){e=function(){function t(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return r(t,""),t.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,Y.recover("tweenData",this)},t}()},n}(),ut=function(e){function o(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,o.__super.call(this),this._style=u.EMPTY}r(o,"laya.display.Sprite",e);var h=o.prototype;return i.imps(h,{"laya.display.ILayout":!0}),h.createConchModel=function(){return new ConchNode},h.destroy=function(t){if(void 0===t&&(t=!0),this._releaseMem(),!this._destroyed){this.filters=null;var i=this.mask;i&&(this.mask=null,i.destroy(t))}e.prototype.destroy.call(this,t),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},h.updateZOrder=function(){q.updateOrder(this._childs)&&this.repaint()},h.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},h.setBounds=function(t){this._set$P("uBounds",t)},h.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new I),I._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},h.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new I),I._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},h._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this._style._tf.translateX,i=this._style._tf.translateY,t=t||0!==this._style._tf.rotate,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(t);if(!n||n.length<1)return n;if(8!=n.length&&(n=t?S.scanPList(n):I._getWrapRec(n,I.TEMP)._getBoundPoints()),!this.transform)return q.transPointList(n,this._x-e,this._y-i),n;var r=M.TEMP,s=0,a=n.length;for(s=0;s<a;s+=2)r.x=n[s],r.y=n[s+1],this.toParentPoint(r),n[s]=r.x,n[s+1]=r.y;return n},h.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):I.TEMP.setTo(0,0,0,0)},h._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var e=q.clearArray(this._$P.temBM),i=I.TEMP;return i.copyFrom(this.scrollRect),q.concatArray(e,i._getBoundPoints()),e}for(var n,r,s,a=this._graphics?this._graphics.getBoundPoints():q.clearArray(this._$P.temBM),o=0,h=(s=this._childs).length;o<h;o++)(n=s[o])instanceof laya.display.Sprite&&1==n.visible&&(r=n._boundPointsToParent(t))&&(a=a?q.concatArray(a,r):r);return a},h.getStyle=function(){return this._style===u.EMPTY&&(this._style=new u),this._style},h.setStyle=function(t){this._style=t},h._adjustTransform=function(){this._tfChanged=!1;var t,e=this._style._tf,i=e.scaleX,n=e.scaleY;if(e.rotate||1!==i||1!==n||e.skewX||e.skewY){(t=this._transform||(this._transform=C.create())).bTransform=!0;var r=.0174532922222222*(e.rotate-e.skewX),s=.0174532922222222*(e.rotate+e.skewY),a=Math.cos(s),o=Math.sin(s),h=Math.sin(r),l=Math.cos(r);return t.a=i*a,t.b=i*o,t.c=-n*h,t.d=n*l,t.tx=t.ty=0,t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,t},h.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._x=t,this._y=e,this.conchModel&&this.conchModel.pos(this._x,this._y);var n=this._parent;n&&0===n._repaint&&(n._repaint=1,n.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=t,this.y=e}return this},h.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},h.size=function(t,e){return this.width=t,this.height=e,this},h.scale=function(t,e,i){void 0===i&&(i=!1);var n=this.getStyle(),r=n._tf;if(r.scaleX!=t||r.scaleY!=e){if(this.destroyed)return this;if(i){n.setScale(t,e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e),this._renderType|=4;var s=this._parent;s&&0===s._repaint&&(s._repaint=1,s.parentRepaint())}else this.scaleX=t,this.scaleY=e}return this},h.skew=function(t,e){return this.skewX=t,this.skewY=e,this},h.render=function(t,e,i){X.spriteCount++,L.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},h.drawToCanvas=function(t,e,i,n){if(R.isConchNode){var r=yt.create("2D");return new N(t,e,r).ctx.setCanvasType(1),this.conchModel.drawToCanvas(r.source,i,n),r}return a.drawToCanvas(this,this._renderType,t,e,i,n)},h.customRender=function(t,e,i){this._renderType|=1024},h._applyFilters=function(){var t;if(!R.isWebGL&&(t=this._$P.filters)&&!(t.length<1))for(var e=0,i=t.length;e<i;e++)t[e].action.apply(this._$P.cacheCanvas)},h._isHaveGlowFilter=function(){var t,e=0;if(this.filters)for(e=0;e<this.filters.length;e++)if(8==this.filters[e].type)return!0;for(e=0,t=this._childs.length;e<t;e++)if(this._childs[e]._isHaveGlowFilter())return!0;return!1},h.localToGlobal=function(t,e){void 0===e&&(e=!1),!0===e&&(t=new M(t.x,t.y));for(var n=this;n&&n!=i.stage;)t=n.toParentPoint(t),n=n.parent;return t},h.globalToLocal=function(t,e){void 0===e&&(e=!1),e&&(t=new M(t.x,t.y));for(var n=this,r=[];n&&n!=i.stage;)r.push(n),n=n.parent;for(var s=r.length-1;0<=s;)t=(n=r[s]).fromParentPoint(t),s--;return t},h.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},h.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},h.on=function(t,i,n,r){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,i,n,r,!1)):e.prototype.on.call(this,t,i,n,r)},h.once=function(t,i,n,r){return 1!==this._mouseEnableState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,i,n,r,!0)):e.prototype.once.call(this,t,i,n,r)},h._$2__onDisplay=function(){if(1!==this._mouseEnableState){var t=this;for(t=t.parent;t&&1!==t._mouseEnableState&&!t._getBit(2);)t.mouseEnabled=!0,t._setBit(2,!0),t=t.parent}},h.loadImage=function(t,e,i,n,r,s){var a=this;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.graphics.loadImage(t,e,i,n,r,(function(t){a.destroyed||(a.size(e+(n||t.width),i+(r||t.height)),a.repaint(),s&&s.runWith(t))})),this},h.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},h._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},h._childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,t&&this._get$P("hasZorder")&&i.timer.callLater(this,this.updateZOrder),this.repaint()},h.parentRepaint=function(){var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint())},h.startDrag=function(t,e,i,n,r,s,a){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===s&&(s=!1),void 0===a&&(a=.92),this._$P.dragging||this._set$P("dragging",new z),this._$P.dragging.start(this,t,e,i,n,r,s,a)},h.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},h._releaseMem=function(){if(this._$P){var t=this._$P.cacheCanvas;t&&t.ctx&&(Y.recover("RenderContext",t.ctx),t.ctx.canvas.size(0,0),t.ctx=null);var e=this._$P._filterCache;e&&(e.destroy(),e.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},h._setDisplay=function(t){t||this._releaseMem(),e.prototype._setDisplay.call(this,t)},h.hitTestPoint=function(t,e){var i=this.globalToLocal(M.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?I.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)},h.getMousePoint=function(){return this.globalToLocal(M.TEMP.setTo(i.stage.mouseX,i.stage.mouseY))},h._getWords=function(){return null},h._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;if(e)for(var i=0,n=e.length;i<n;i++)t.push(e[i]);i=0;for(var r=this._childs.length;i<r;++i){var s=this._childs[i];s._style._enableLayout()&&s._addToLayout(t)}return!0},h._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))},h._isChar=function(){return!1},h._getCSSStyle=function(){return this._style.getCSSStyle()},h._setAttributes=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},h._layoutLater=function(){this.parent&&this.parent._layoutLater()},s(0,h,"optimizeScrollRect",(function(){return this._optimizeScrollRect}),(function(t){this._optimizeScrollRect!=t&&(this._optimizeScrollRect=t,this.conchModel&&this.conchModel.optimizeScrollRect(t))})),s(0,h,"customRenderEnable",null,(function(t){if(t&&(this._renderType|=1024,R.isConchNode)){o.CustomList.push(this);var e=new yt("2d");e._setContext(new CanvasRenderingContext2D),this.customContext=new N(0,0,e),e.context.setCanvasType&&e.context.setCanvasType(2),this.conchModel.custom(e.context)}})),s(0,h,"cacheAsBitmap",(function(){return"none"!==this.cacheAs}),(function(t){this.cacheAs=t?this._$P.hasFilter?"none":"normal":"none"})),s(0,h,"cacheAs",(function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type}),(function(t){var e=this._$P.cacheCanvas;if(t!==(e?e.type:"none")){if("none"!==t)this._getBit(1)||this._setUpNoticeType(1),e||(e=this._set$P("cacheCanvas",Y.getItemByClass("cacheCanvas",Object))),e.type=t,e.reCache=!0,this._renderType|=16,"bitmap"==t&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(e){var i=e;i&&i.ctx&&(Y.recover("RenderContext",i.ctx),i.ctx.canvas.size(0,0),i.ctx=null),Y.recover("cacheCanvas",e)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}})),s(0,h,"zOrder",(function(){return this._zOrder}),(function(t){this._zOrder!=t&&(this._zOrder=t,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(t),this._parent&&(t&&this._parent._set$P("hasZorder",!0),i.timer.callLater(this._parent,this.updateZOrder)))})),s(0,h,"rotation",(function(){return this._style._tf.rotate}),(function(t){var e=this.getStyle();if(e._tf.rotate!==t){e.setRotate(t),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}})),s(0,h,"width",(function(){return this.autoSize?this.getSelfBounds().width:this._width}),(function(t){this._width!==t&&(this._width=t,this.conchModel&&this.conchModel.size(t,this._height),this.repaint())})),s(0,h,"x",(function(){return this._x}),(function(t){if(this._x!==t){if(this.destroyed)return;this._x=t,this.conchModel&&this.conchModel.pos(t,this._y);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}})),s(0,h,"globalScaleY",(function(){for(var t=1,e=this;e&&e!==i.stage;)t*=e.scaleY,e=e.parent;return t})),s(0,h,"hitArea",(function(){return this._$P.hitArea}),(function(t){this._set$P("hitArea",t)})),s(0,h,"staticCache",(function(){return this._$P.staticCache}),(function(t){this._set$P("staticCache",t),t||this.reCache()})),s(0,h,"texture",(function(){return this._texture}),(function(t){this._texture!=t&&(this._texture=t,this.graphics.cleanByTexture(t,0,0))})),s(0,h,"y",(function(){return this._y}),(function(t){if(this._y!==t){if(this.destroyed)return;this._y=t,this.conchModel&&this.conchModel.pos(this._x,t);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}})),s(0,h,"height",(function(){return this.autoSize?this.getSelfBounds().height:this._height}),(function(t){this._height!==t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,t),this.repaint())})),s(0,h,"blendMode",(function(){return this._style.blendMode}),(function(t){this.getStyle().blendMode=t,this.conchModel&&this.conchModel.blendMode(t),t&&"source-over"!=t?this._renderType|=8:this._renderType&=-9,this.parentRepaint()})),s(0,h,"scaleX",(function(){return this._style._tf.scaleX}),(function(t){var e=this.getStyle();if(e._tf.scaleX!==t){e.setScaleX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e._tf.scaleY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}})),s(0,h,"scaleY",(function(){return this._style._tf.scaleY}),(function(t){var e=this.getStyle();if(e._tf.scaleY!==t){e.setScaleY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e._tf.scaleX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}})),s(0,h,"stage",(function(){return i.stage})),s(0,h,"skewX",(function(){return this._style._tf.skewX}),(function(t){var e=this.getStyle();if(e._tf.skewX!==t){e.setSkewX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(t,e._tf.skewY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}})),s(0,h,"scrollRect",(function(){return this._style.scrollRect}),(function(t){this.getStyle().scrollRect=t,this.repaint(),t?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(t.x,t.y,t.width,t.height)):(this._renderType&=-129,this.conchModel&&(o.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))})),s(0,h,"skewY",(function(){return this._style._tf.skewY}),(function(t){var e=this.getStyle();if(e._tf.skewY!==t){e.setSkewY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(e._tf.skewX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}})),s(0,h,"transform",(function(){return this._tfChanged?this._adjustTransform():this._transform}),(function(t){this._tfChanged=!1,(this._transform=t)&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0,this.conchModel&&this.conchModel.transform(t.a,t.b,t.c,t.d,this._x,this._y)),t?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()})),s(0,h,"pivotX",(function(){return this._style._tf.translateX}),(function(t){this.getStyle().setTranslateX(t),this.conchModel&&this.conchModel.pivot(t,this._style._tf.translateY),this.repaint()})),s(0,h,"pivotY",(function(){return this._style._tf.translateY}),(function(t){this.getStyle().setTranslateY(t),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,t),this.repaint()})),s(0,h,"alpha",(function(){return this._style.alpha}),(function(t){this._style&&this._style.alpha!==t&&(t=t<0?0:1<t?1:t,this.getStyle().alpha=t,this.conchModel&&this.conchModel.alpha(t),1!==t?this._renderType|=2:this._renderType&=-3,this.parentRepaint())})),s(0,h,"visible",(function(){return this._style.visible}),(function(t){this._style&&this._style.visible!==t&&(this.getStyle().visible=t,this.conchModel&&this.conchModel.visible(t),this.parentRepaint())})),s(0,h,"graphics",(function(){return this._graphics||(this.graphics=a.createGraphics())}),(function(t){this._graphics&&(this._graphics._sp=null),(this._graphics=t)?(this._renderType&=-2,this._renderType|=512,(t._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(o.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()})),s(0,h,"filters",(function(){return this._$P.filters}),(function(t){t&&0===t.length&&(t=null),this._$P.filters!=t&&(this._set$P("filters",t?t.slice():null),R.isConchApp&&(this.conchModel&&(o.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),R.isWebGL&&(t&&t.length?this._renderType|=32:this._renderType&=-33),t&&0<t.length?(this._getBit(1)||this._setUpNoticeType(1),R.isWebGL&&1==t.length&&t[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(R.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())})),s(0,h,"parent",e.prototype._$get_parent,(function(t){i.superSet($,this,"parent",t),t&&this._getBit(2)&&this._$2__onDisplay()})),s(0,h,"mask",(function(){return this._$P._mask}),(function(t){t&&this.mask&&this.mask._$P.maskParent||(t?(this.cacheAs="bitmap",this._set$P("_mask",t),t._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",t),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(t?t.conchModel:null),this._renderType|=64,this.parentRepaint())})),s(0,h,"mouseEnabled",(function(){return 1<this._mouseEnableState}),(function(t){this._mouseEnableState=t?2:1})),s(0,h,"globalScaleX",(function(){for(var t=1,e=this;e&&e!==i.stage;)t*=e.scaleX,e=e.parent;return t})),s(0,h,"mouseX",(function(){return this.getMousePoint().x})),s(0,h,"mouseY",(function(){return this.getMousePoint().y})),o.fromImage=function(t){return(new o).loadImage(t)},o._cachePool=[],o.CustomList=[],n(o,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=t.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),o}($),dt=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=q.bind(this.__onEnd,this),this._resumePlay=q.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}r(e,"laya.media.h5audio.AudioSoundChannel",it);var n=e.prototype;return n.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},n.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,F.container.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},n.play=function(t){this.isStopped=!1;try{this._audio.playbackRate=E.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}E.addChannel(this),F.container.appendChild(this._audio),!t&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},n.stop=function(){this.isStopped=!0,E.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&R.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),F.onIE||this._audio!=et._musicAudio&&Y.recover("audio:"+this.url,this._audio),F.removeElement(this._audio),this._audio=null)},n.pause=function(){this.isStopped=!0,E.removeChannel(this),"pause"in this._audio&&this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,E.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},s(0,n,"position",(function(){return this._audio?this._audio.currentTime:0})),s(0,n,"duration",(function(){return this._audio?this._audio.duration:0})),s(0,n,"volume",(function(){return this._audio?this._audio.volume:1}),(function(t){this._audio&&(this._audio.volume=t)})),e}(),_t=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=rt.ctx,e.__super.call(this),this._onPlayEnd=q.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}r(e,"laya.media.webaudio.WebAudioSoundChannel",it);var n=e.prototype;return n.play=function(t){if(E.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var e=this.context,i=this.gain,n=e.createBufferSource();(this.bufferSource=n).buffer=this.audioBuffer,n.connect(i),i&&i.disconnect(),i.connect(e.destination),n.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=F.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(n.loop=!0),n.playbackRate.setTargetAtTime?n.playbackRate.setTargetAtTime(E.playbackRate,this.context.currentTime,.1):n.playbackRate.value=E.playbackRate,n.start(0,this.startTime),!t&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},n.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},n._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},n._tryClearBuffer=function(t){try{t.buffer=null}catch(t){e._tryCleanFailed=!0}},n.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,E.removeChannel(this),this.startHandler=null,this.completeHandler=null},n.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,E.removeChannel(this)},n.resume=function(){this.startTime=this._pauseTime,this.play(!1)},s(0,n,"position",(function(){return this.bufferSource?(F.now()-this._startTime)/1e3+this.startTime:0})),s(0,n,"duration",(function(){return this.audioBuffer?this.audioBuffer.duration:0})),s(0,n,"volume",(function(){return this._volume}),(function(t){this.isStopped||(this._volume=t,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(t,this.context.currentTime,.1):this.gain.gain.value=t)})),e._tryCleanFailed=!1,e}(),ft=function(t){function e(){e.__super.call(this),this._w=0,this._h=0}r(e,"laya.resource.Bitmap",ht);var i=e.prototype;return s(0,i,"width",(function(){return this._w})),s(0,i,"height",(function(){return this._h})),s(0,i,"source",(function(){return this._source})),e}(),pt=function(t){function e(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,e.__super.call(this),this._interval=o.animationInterval,this._setUpNoticeType(1)}r(e,"laya.display.AnimationPlayerBase",t);var i=e.prototype;return i.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(t){var e=0;for(e=0;e<this._count;e++)if(this._labels[e]&&0<=this._labels[e].indexOf(t))return e;return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=t)&&t!=this&&(t.on("display",this,this._checkResumePlaying),t.on("undisplay",this,this._checkResumePlaying))},i._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._checkResumePlaying()},i._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromLabelList(this._labels[e],t)}else this._labels=null},i._removeLabelFromLabelList=function(t,e){if(t)for(var i=t.length-1;0<=i;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(t){},i.clear=function(){this.stop(),this._labels=null},s(0,i,"interval",(function(){return this._interval}),(function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&0<t&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))})),s(0,i,"isPlaying",(function(){return this._isPlaying})),s(0,i,"index",(function(){return this._index}),(function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,n=e.length;i<n;i++)this.event("label",e[i])})),s(0,i,"count",(function(){return this._count})),e.WRAP_POSITIVE=0,e.WRAP_REVERSE=1,e.WRAP_PINGPONG=2,e}(ut),mt=function(t){function e(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,e.__super.call(this),this.overflow=e.VISIBLE,this._style=new tt(this),this._style.wordWrap=!1}r(e,"laya.display.Text",t);var a=e.prototype;return a.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._lines=null,this._words&&(this._words.length=0,this._words=null)},a._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=I.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},a.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=I.TEMP;return e.setTo(0,0,this.width,this.height),e},a._getCSSStyle=function(){return this._style},a.lang=function(t,i,n,r,s,a,o,h,l,c,u){if(t=e.langPacks&&e.langPacks[t]?e.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var d=0,_=arguments.length;d<_;d++)t=t.replace("{"+d+"}",arguments[d+1]);this._text=t}},a._isPassWordMode=function(){var t=this._style.password;return"prompt"in this&&this.prompt==this._text&&(t=!1),t},a._getPassWordTxt=function(t){var e;e="";for(var i=t.length;0<i;i--)e+="●";return e},a.renderText=function(t,e){var i=this.graphics;i.clear(!0);var n=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(F.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);F.context.font=n;var r=this.padding,s=r[3],a="left",o=this._lines,h=this.leading+this._charSize.height,l=this._currBitmapFont;l&&(h=this.leading+l.getMaxHeight());var c=r[0];if(!l&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(a="right",s=this._width-r[1]):"center"==this.align&&(a="center",s=.5*this._width+r[3]-r[1])),0<this._height){var u=this._textHeight>this._height?"top":this.valign;"middle"===u?c=.5*(this._height-e*h)+r[0]-r[2]:"bottom"===u&&(c=this._height-e*h-r[2])}var d=this._style;if(l&&l.autoScaleSize)var _=l.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),l&&l.autoScaleSize){var f=0,p=0;f=this._width?this._width-r[3]-r[1]:this._textWidth,p=this._height?this._height-r[0]-r[2]:this._textHeight,f*=_,p*=_,i.clipRect(r[3],r[0],f,p)}else i.clipRect(r[3],r[0],this._width?this._width-r[3]-r[1]:this._textWidth,this._height?this._height-r[0]-r[2]:this._textHeight);var m=d.password;"prompt"in this&&this.prompt==this._text&&(m=!1);for(var g=0,v=0,y=Math.min(this._lines.length,e+t)||1,x=t;x<y;x++){var w,b=o[x];if(m){var S=b.length;b="";for(var T=S;0<T;T--)b+="●"}if(g=s-(this._clipPoint?this._clipPoint.x:0),v=c+h*x-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(a,g,v,x),l){var C=this.width;l.autoScaleSize&&(C=this.width*_),l.drawText(b,this,g,v,this.align,C)}else R.isWebGL?(this._words||(this._words=[]),(w=this._words.length>x-t?this._words[x-t]:new J).setText(b)):w=b,d.stroke?i.fillBorderText(w,g,v,n,this.color,d.strokeColor,d.stroke,a):i.fillText(w,g,v,n,this.color,a)}if(l&&l.autoScaleSize){var M=1/_;this.scale(M,M)}this._clipPoint&&i.restore(),this._startX=s,this._startY=c},a.drawUnderline=function(t,e,i,n){var r=this._lineWidths[n];switch(t){case"center":e-=r/2;break;case"right":e-=r}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)},a.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);F.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new M(0,0)):this._clipPoint=null;var t=this._lines.length;if(this.overflow!=e.VISIBLE){var i=this.overflow==e.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,i((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var n=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(n,t),this.repaint()},a.evalTextSize=function(){var t,e;t=Math.max.apply(this,this._lineWidths),e=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},a.checkEnabledViewportOrNot=function(){return this.overflow==e.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},a.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},a.parseLines=function(t){var i=this.wordWrap||this.overflow==e.HIDDEN;if(i)var n=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var r=q.contextMeasureText(e._testWord);R.isConchApp&&0===r.width&&0===r.height&&(r=q.contextMeasureText("W")),this._charSize.width=r.width,this._charSize.height=r.height||this.fontSize}for(var s=t.replace(/\r\n/g,"\n").split("\n"),a=0,o=s.length;a<o;a++){var h=s[a];i?this.parseLine(h,n):(this._lineWidths.push(this.getTextWidth(h)),this._lines.push(h))}},a.parseLine=function(t,i){F.context;var n,r=this._lines,s=0,a=NaN,o=NaN,h=0;if((a=this.getTextWidth(t))<=i)return r.push(t),void this._lineWidths.push(a);if(e.WordSplitStr&&0==new RegExp(e.WordSplitStr,"g").test(t))return r.push(t),void this._lineWidths.push(a);a=this._charSize.width,0==(s=Math.floor(i/a))&&(s=1),o=a=this.getTextWidth(t.substring(0,s));for(var l=s,c=t.length;l<c;l++)if(i<(o+=a=this.getTextWidth(t.charAt(l))))if(this.wordWrap){var u=t.substring(h,l);if(e.WordSplitArr){var d=-1,_=0;for(_=0;_<e.WordSplitArr.length;_++)d=Math.max(d,u.lastIndexOf(e.WordSplitArr[_]));if(-1==d){var f=t.substring(h,t.length);for(_=0;_<e.WordSplitArr.length;_++){var p=f.indexOf(e.WordSplitArr[_]);d=0<=d?0<=p?Math.min(d,p):d:p}u=-1==d?(l=t.length,f):(l=d+1+h,t.substring(h,l))}else l=d+1+h,u=t.substring(h,l);r.push(u),this._lineWidths.push(this.getTextWidth(r[r.length-1])),o=0,h=l}else{if(u.charCodeAt(u.length-1)<255?(n=/(?:\w|-)+$/.exec(u))&&(l=n.index+h,0==n.index?l+=u.length:u=t.substring(h,l)):e.RightToLeft&&(n=/([\u0600-\u06FF])+$/.exec(u))&&(l=n.index+h,0==n.index?l+=u.length:u=t.substring(h,l)),r.push(u),this._lineWidths.push(o-a),!((h=l)+s<c)){r.push(t.substring(h,c)),this._lineWidths.push(this.getTextWidth(r[r.length-1])),h=-1;break}l+=s,o=a=this.getTextWidth(t.substring(h,l)),l--}}else if(this.overflow==e.HIDDEN)return r.push(t.substring(0,l)),void this._lineWidths.push(this.getTextWidth(r[r.length-1]));this.wordWrap&&-1!=h&&h<c&&(r.push(t.substring(h,c)),this._lineWidths.push(this.getTextWidth(r[r.length-1])))},a.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):q.contextMeasureText(t).width},a.getWordWrapWidth=function(){var t=this.padding,e=NaN;return(e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(e=this.wordWrap?100:F.width),e<=0&&(e=100),e-t[3]-t[1]},a.getCharPoint=function(t,e){this._isChanged&&i.timer.runCallLater(this,this.typeset);for(var n=0,r=this._lines,s=0,a=0,o=r.length;a<o;a++){if(t<(n+=r[a].length)){var h=a;break}s=n}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;F.context.font=l;var c=this.getTextWidth(this._text.substring(s,t));return(e||new M).setTo(this._startX+c-(this._clipPoint?this._clipPoint.x:0),this._startY+h*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},s(0,a,"width",(function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]}),(function(t){t!=this._width&&(i.superSet(ut,this,"width",t),this.isChanged=!0)})),s(0,a,"textWidth",(function(){return this._isChanged&&i.timer.runCallLater(this,this.typeset),this._textWidth})),s(0,a,"height",(function(){return this._height?this._height:this.textHeight}),(function(t){t!=this._height&&(i.superSet(ut,this,"height",t),this.isChanged=!0)})),s(0,a,"textHeight",(function(){return this._isChanged&&i.timer.runCallLater(this,this.typeset),this._textHeight})),s(0,a,"padding",(function(){return this._getCSSStyle().padding}),(function(t){this._getCSSStyle().padding=t,this.isChanged=!0})),s(0,a,"bold",(function(){return this._getCSSStyle().bold}),(function(t){this._getCSSStyle().bold=t,this.isChanged=!0})),s(0,a,"text",(function(){return this._text||""}),(function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))})),s(0,a,"color",(function(){return this._getCSSStyle().color}),(function(t){this._getCSSStyle().color!=t&&(this._getCSSStyle().color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)})),s(0,a,"font",(function(){return this._getCSSStyle().fontFamily}),(function(t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),e._bitmapFonts&&e._bitmapFonts[t]&&(this._currBitmapFont=e._bitmapFonts[t]),this._getCSSStyle().fontFamily=t,this.isChanged=!0})),s(0,a,"fontSize",(function(){return this._getCSSStyle().fontSize}),(function(t){this._getCSSStyle().fontSize=t,this.isChanged=!0})),s(0,a,"italic",(function(){return this._getCSSStyle().italic}),(function(t){this._getCSSStyle().italic=t,this.isChanged=!0})),s(0,a,"align",(function(){return this._getCSSStyle().align}),(function(t){this._getCSSStyle().align=t,this.isChanged=!0})),s(0,a,"valign",(function(){return this._getCSSStyle().valign}),(function(t){this._getCSSStyle().valign=t,this.isChanged=!0})),s(0,a,"wordWrap",(function(){return this._getCSSStyle().wordWrap}),(function(t){this._getCSSStyle().wordWrap=t,this.isChanged=!0})),s(0,a,"leading",(function(){return this._getCSSStyle().leading}),(function(t){this._getCSSStyle().leading=t,this.isChanged=!0})),s(0,a,"bgColor",(function(){return this._getCSSStyle().backgroundColor}),(function(t){this._getCSSStyle().backgroundColor=t,this.isChanged=!0})),s(0,a,"borderColor",(function(){return this._getCSSStyle().borderColor}),(function(t){this._getCSSStyle().borderColor=t,this.isChanged=!0})),s(0,a,"stroke",(function(){return this._getCSSStyle().stroke}),(function(t){this._getCSSStyle().stroke=t,this.isChanged=!0})),s(0,a,"strokeColor",(function(){return this._getCSSStyle().strokeColor}),(function(t){this._getCSSStyle().strokeColor=t,this.isChanged=!0})),s(0,a,"isChanged",null,(function(t){this._isChanged!==t&&(this._isChanged=t)&&i.timer.callLater(this,this.typeset)})),s(0,a,"scrollX",(function(){return this._clipPoint?this._clipPoint.x:0}),(function(t){if(!(this.overflow!=e.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var i=this._textWidth-this._width;t=i<t?i:t;var n=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=t,this.renderText(this._lastVisibleLineIndex,n)}})),s(0,a,"scrollY",(function(){return this._clipPoint?this._clipPoint.y:0}),(function(t){if(!(this.overflow!=e.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var i=this._textHeight-this._height,n=(t=i<t?i:t)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=n;var r=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=t,this.renderText(n,r)}})),s(0,a,"maxScrollX",(function(){return this.textWidth<this._width?0:this._textWidth-this._width})),s(0,a,"maxScrollY",(function(){return this.textHeight<this._height?0:this._textHeight-this._height})),s(0,a,"lines",(function(){return this._isChanged&&this.typeset(),this._lines})),s(0,a,"underlineColor",(function(){return this._underlineColor}),(function(t){this._underlineColor=t,this._isChanged=!0,this.typeset()})),e.registerBitmapFont=function(t,i){e._bitmapFonts||(e._bitmapFonts={}),e._bitmapFonts[t]=i},e.unregisterBitmapFont=function(t,i){if(void 0===i&&(i=!0),e._bitmapFonts&&e._bitmapFonts[t]){var n=e._bitmapFonts[t];i&&n.destroy(),delete e._bitmapFonts[t]}},e.setTextRightToLeft=function(){var t;(t=F.canvas.source.style).display="none",t.position="absolute",t.direction="rtl",R._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,F.document.body.appendChild(F.canvas.source)},e.supportFont=function(t){F.context.font="10px sans-serif";var e=q.contextMeasureText("abcji").width;F.context.font="10px "+t;var i=q.contextMeasureText("abcji").width;return console.log(e,i),e!==i},e._testWord="游",e.langPacks=null,e.VISIBLE="visible",e.SCROLL="scroll",e.HIDDEN="hidden",e.CharacterCache=!0,e.RightToLeft=!1,e.WordSplitArr=null,e.WordSplitStr=null,e._bitmapFonts=null,n(e,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),e}(ut),gt=function(e){function o(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",o.__super.call(this),this.offset=new M,this._canvasTransform=new C,this._previousOrientation=F.window.orientation;var t=this;this.transform=C.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0,this._lastStamp=0;var e=F.window,i=this;e.addEventListener("focus",(function(){t._isFocused=!0,i.event("focus"),i.event("focuschange")})),e.addEventListener("blur",(function(){t._isFocused=!1,i.event("blur"),i.event("focuschange"),i._isInputting()&&(wt.inputElement.target.focus=!1)}));var n="visibilityState",r="visibilitychange",s=e.document;void 0!==s.hidden?(r="visibilitychange",n="visibilityState"):void 0!==s.mozHidden?(r="mozvisibilitychange",n="mozVisibilityState"):void 0!==s.msHidden?(r="msvisibilitychange",n="msVisibilityState"):void 0!==s.webkitHidden&&(r="webkitvisibilitychange",n="webkitVisibilityState"),e.document.addEventListener(r,(function(){"hidden"==F.document[n]?i._setStageVisible(!1):i._setStageVisible(!0)})),e.document.addEventListener("qbrowserVisibilityChange",(function(t){i._setStageVisible(!t.hidden)})),e.addEventListener("resize",(function(){var e=F.window.orientation;null!=e&&e!=t._previousOrientation&&i._isInputting()&&(wt.inputElement.target.focus=!1),t._previousOrientation=e,i._isInputting()||i._resetCanvas()})),e.addEventListener("orientationchange",(function(t){i._resetCanvas()})),this.on("mousemove",this,this._onmouseMove),F.onMobile&&this.on("mousedown",this,this._onmouseMove)}r(o,"laya.display.Stage",e);var h=o.prototype;return h._setStageVisible=function(t){this._isVisibility!=t&&(this._isVisibility=t,this._isVisibility||this._isInputting()&&(wt.inputElement.target.focus=!1),this.event("visibilitychange"))},h._isInputting=function(){return F.onMobile&&wt.isInputting},h._changeCanvasSize=function(){this.setScreenSize(F.clientWidth*F.pixelRatio,F.clientHeight*F.pixelRatio)},h._resetCanvas=function(){if(this.screenAdaptationEnabled){var t=R._mainCanvas;t.source.style,t.size(1,1),i.timer.once(100,this,this._changeCanvasSize)}},h.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode&&(i=(t/e<1?"vertical":"horizontal")!==this._screenMode)){var n=e;e=t,t=n}this.canvasRotation=i;var r=R._mainCanvas,s=r.source.style,o=this._canvasTransform.identity(),h=this._scaleMode,l=t/this.designWidth,c=e/this.designHeight,u=this.designWidth,d=this.designHeight,_=t,f=e,p=F.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,h){case"noscale":l=c=1,_=this.designWidth,f=this.designHeight;break;case"showall":l=c=Math.min(l,c),u=_=Math.round(this.designWidth*l),d=f=Math.round(this.designHeight*c);break;case"noborder":l=c=Math.max(l,c),_=Math.round(this.designWidth*l),f=Math.round(this.designHeight*c);break;case"full":l=c=1,this._width=u=t,this._height=d=e;break;case"fixedwidth":c=l,this._height=d=Math.round(e/l);break;case"fixedheight":l=c,this._width=u=Math.round(t/c);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(c=l,this._height=d=Math.round(e/l)):(l=c,this._width=u=Math.round(t/c))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,u=u+1&2147483646,d=d+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),l*=this.scaleX,c*=this.scaleY,1===l&&1===c?this.transform.identity():(this.transform.a=this._formatData(l/(_/u)),this.transform.d=this._formatData(c/(f/d)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),r.size(u,d),a.changeWebGLSize(u,d),o.scale(_/u/p,f/d/p),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(t-_)/p:this.offset.x=.5*(t-_)/p,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(e-f)/p:this.offset.y=.5*(e-f)/p,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),o.translate(this.offset.x,this.offset.y),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(o.rotate(Math.PI/2),o.translate(e/p,0),this.canvasDegree=90):(o.rotate(-Math.PI/2),o.translate(0,t/p),this.canvasDegree=-90)),o.a=this._formatData(o.a),o.d=this._formatData(o.d),o.tx=this._formatData(o.tx),o.ty=this._formatData(o.ty),s.transformOrigin=s.webkitTransformOrigin=s.msTransformOrigin=s.mozTransformOrigin=s.oTransformOrigin="0px 0px 0px",s.transform=s.webkitTransform=s.msTransform=s.mozTransform=s.oTransform="matrix("+o.toString()+")",o.translate(parseInt(s.left)||0,parseInt(s.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},h._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?0<t?1:-1:t},h.getMousePoint=function(){return M.TEMP.setTo(this.mouseX,this.mouseY)},h.repaint=function(){this._repaint=1},h.parentRepaint=function(){},h._loop=function(t){return this.render(R.context,0,0,t),!0},h._onmouseMove=function(t){this._mouseMoveTime=F.now()},h.getTimeFromFrameStart=function(){return F.now()-this._frameStartTime},h.render=function(n,r,s,o){if(!(3!=t.ENV&&0<o&&o-this._lastStamp<16)){if(this._lastStamp=o,"sleep"===this._frameRate&&!R.isConchApp){var h=F.now();if(!(200<=h-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(X.loopCount++,v.instance.runEvent(),i.timer._update()));this._frameStartTime=h}if(this._renderCount++,R.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=F.now();var l="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),c=this._renderCount%2==0;if(X.renderSlow=!l,l||c||R.isConchApp){var u;X.loopCount++,v.instance.runEvent(),i.timer._update(),a.update3DLoop();var d=0,_=0;if(R.isConchNode)for(d=0,_=this._scenes.length;d<_;d++)(u=this._scenes[d])&&u._updateSceneConch();else for(d=0,_=this._scenes.length;d<_;d++)(u=this._scenes[d])&&u._updateScene();if(R.isConchNode){var f=ut.CustomList;for(d=0,_=f.length;d<_;d++){var p=f[d];p.customRender(p.customContext,0,0)}return}}R.isConchNode||this.renderingEnabled&&(l||!c||R.isConchWebGL)&&(R.isWebGL?R.WebGL.mainContext&&!R.WebGL.mainContext.isContextLost()&&(n.clear(),e.prototype.render.call(this,n,r,s),X._show&&X._sp&&X._sp.render(n,r,s),a.clear(this._bgColor),a.beginFlush(),n.flush(),a.endFinish(),Z.instance&&Z.getInstance().endDispose()):(a.clear(this._bgColor),e.prototype.render.call(this,n,r,s),X._show&&X._sp&&X._sp.render(n,r,s)))}else this._renderCount%5==0&&(X.loopCount++,v.instance.runEvent(),i.timer._update())}},h._requestFullscreen=function(){var t=F.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},h._fullScreenChanged=function(){i.stage.event("fullscreenchange")},h.exitFullscreen=function(){var t=F.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},s(0,h,"clientScaleX",(function(){return this._transform?this._transform.getScaleX():1})),s(0,h,"desginHeight",(function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight})),s(0,h,"frameRate",(function(){return this._frameRate}),(function(t){if(this._frameRate=t,R.isConchApp)switch(this._frameRate){case"slow":F.window.conch&&F.window.conchConfig.setSlowFrame&&F.window.conchConfig.setSlowFrame(!0);break;case"fast":F.window.conch&&F.window.conchConfig.setSlowFrame&&F.window.conchConfig.setSlowFrame(!1);break;case"mouse":F.window.conch&&F.window.conchConfig.setMouseFrame&&F.window.conchConfig.setMouseFrame(2e3);break;case"sleep":F.window.conch&&F.window.conchConfig.setLimitFPS&&F.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}})),s(0,h,"clientScaleY",(function(){return this._transform?this._transform.getScaleY():1})),s(0,h,"width",e.prototype._$get_width,(function(t){this.designWidth=t,i.superSet(ut,this,"width",t),i.timer.callLater(this,this._changeCanvasSize)})),s(0,h,"alignH",(function(){return this._alignH}),(function(t){this._alignH=t,i.timer.callLater(this,this._changeCanvasSize)})),s(0,h,"isFocused",(function(){return this._isFocused})),s(0,h,"height",e.prototype._$get_height,(function(t){this.designHeight=t,i.superSet(ut,this,"height",t),i.timer.callLater(this,this._changeCanvasSize)})),s(0,h,"transform",(function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||C.create()}),e.prototype._$set_transform),s(0,h,"isVisibility",(function(){return this._isVisibility})),s(0,h,"desginWidth",(function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth})),s(0,h,"scaleMode",(function(){return this._scaleMode}),(function(t){this._scaleMode=t,i.timer.callLater(this,this._changeCanvasSize)})),s(0,h,"alignV",(function(){return this._alignV}),(function(t){this._alignV=t,i.timer.callLater(this,this._changeCanvasSize)})),s(0,h,"bgColor",(function(){return this._bgColor}),(function(t){this._bgColor=t,this.conchModel&&this.conchModel.bgColor(t),R.isWebGL&&(t?o._wgColor=H.create(t)._color:F.onMiniGame||(o._wgColor=null)),F.onLimixiu?o._wgColor=H.create(t)._color:R.canvas.style.background=t||"none"})),s(0,h,"mouseX",(function(){return Math.round(v.instance.mouseX/this.clientScaleX)})),s(0,h,"mouseY",(function(){return Math.round(v.instance.mouseY/this.clientScaleY)})),s(0,h,"screenMode",(function(){return this._screenMode}),(function(t){this._screenMode=t})),s(0,h,"visible",e.prototype._$get_visible,(function(t){this.visible!==t&&(i.superSet(ut,this,"visible",t),R._mainCanvas.source.style.visibility=t?"visible":"hidden")})),s(0,h,"fullScreenEnabled",null,(function(t){var e=F.document,i=R.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))})),o.SCALE_NOSCALE="noscale",o.SCALE_EXACTFIT="exactfit",o.SCALE_SHOWALL="showall",o.SCALE_NOBORDER="noborder",o.SCALE_FULL="full",o.SCALE_FIXED_WIDTH="fixedwidth",o.SCALE_FIXED_HEIGHT="fixedheight",o.SCALE_FIXED_AUTO="fixedauto",o.ALIGN_LEFT="left",o.ALIGN_RIGHT="right",o.ALIGN_CENTER="center",o.ALIGN_TOP="top",o.ALIGN_MIDDLE="middle",o.ALIGN_BOTTOM="bottom",o.SCREEN_NONE="none",o.SCREEN_HORIZONTAL="horizontal",o.SCREEN_VERTICAL="vertical",o.FRAME_FAST="fast",o.FRAME_SLOW="slow",o.FRAME_MOUSE="mouse",o.FRAME_SLEEP="sleep",o.FRAME_MOUSE_THREDHOLD=2e3,n(o,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),o}(ut),vt=(function(t){function e(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,e.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}r(e,"laya.media.SoundNode",ut);var i=e.prototype;i._onParentChange=function(){this.target=this.parent},i.play=function(t,e){void 0===t&&(t=1),isNaN(t)&&(t=1),this.url&&(this.stop(),this._channel=E.playSound(this.url,t,null,e))},i.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},i._setPlayAction=function(t,e,i,n){void 0===n&&(n=!0),this[i]&&t&&(n?t.on(e,this,this[i]):t.off(e,this,this[i]))},i._setPlayActions=function(t,e,i,n){if(void 0===n&&(n=!0),t&&e){var r,s=e.split(","),a=0;for(r=s.length,a=0;a<r;a++)this._setPlayAction(t,s[a],i,n)}},s(0,i,"playEvent",null,(function(t){(this._playEvents=t)&&this._tar&&this._setPlayActions(this._tar,t,"play")})),s(0,i,"target",null,(function(t){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=t,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))})),s(0,i,"stopEvent",null,(function(t){(this._stopEvents=t)&&this._tar&&this._setPlayActions(this._tar,t,"stop")}))}(),function(t){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}r(e,"laya.resource.FileBitmap",ft);var i=e.prototype;return s(0,i,"src",(function(){return this._src}),(function(t){this._src=t})),s(0,i,"onload",null,(function(t){})),s(0,i,"onerror",null,(function(t){})),e}()),yt=function(t){function e(t,i){this._is2D=!1,e.__super.call(this);var n=this;if(this._source=this,"2D"===t||"AUTO"===t&&!R.isWebGL){this._is2D=!0,this._source=i||F.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var r=this;r.getContext=function(t,e){if(n._ctx)return n._ctx;var i=n._ctx=n._source.getContext(t,e);return i&&(i._canvas=r,R.isFlash||F.onLimixiu||(i.size=function(t,e){})),i}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}r(e,"laya.resource.HTMLCanvas",ft);var i=e.prototype;return i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},i.release=function(){},i._setContext=function(t){this._ctx=t},i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)},i.getMemSize=function(){return 0},i.size=function(t,e){(this._w!=t||this._h!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._w=t,this._h=e,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},i.getCanvas=function(){return this._source},i.toBase64=function(t,e,i){if(this._source)if(R.isConchApp&&this._source.toBase64)this._source.toBase64(t,e,i);else{var n=this._source.toDataURL(t,e);i.call(this,n)}},s(0,i,"context",(function(){return this._ctx})),s(0,i,"asBitmap",null,(function(t){})),e.create=function(t,i){return new e(t,i)},e.TYPE2D="2D",e.TYPE3D="3D",e.TYPEAUTO="AUTO",e._createContext=null,e}(),xt=(function(t){function e(t,i,n,r,s,a,o,h){throw e.__super.call(this),new Error("不允许new！")}r(e,"laya.resource.HTMLSubImage",ft),e.create=function(t,i,n,r,s,a,o,h){return void 0===h&&(h=!1),new e(t,i,n,r,s,a,o,h)}}(),function(t){function e(){this._frames=null,this._url=null,e.__super.call(this),this._setControlNode(this)}r(e,"laya.display.Animation",t);var n=e.prototype;n.destroy=function(t){void 0===t&&(t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,t),this._frames=null,this._labels=null},n.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),i&&this._setFramesFromCache(i,n),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},n._setFramesFromCache=function(t,i){var n;return void 0===i&&(i=!1),this._url&&(t=this._url+"#"+t),t&&e.framesMap[t]?((n=e.framesMap[t])instanceof Array?(this._frames=e.framesMap[t],this._count=this._frames.length):(n.nodeRoot&&(e.framesMap[t]=this._parseGraphicAnimationByData(n),n=e.framesMap[t]),this._frames=n.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=n.interval),this._labels=this._copyLabels(n.labels)),!0):(i&&console.log("ani not found:",t),!1)},n._copyLabels=function(t){if(!t)return null;var e,i;for(i in e={},t)e[i]=q.copyArray([],t[i]);return e},n._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&t.prototype._frameLoop.call(this)},n._displayToIndex=function(t){this._frames&&(this.graphics=this._frames[t])},n.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},n.loadImages=function(t,i){return void 0===i&&(i=""),this._url="",this._setFramesFromCache(i)||(this.frames=e.framesMap[i]?e.framesMap[i]:e.createFrames(t,i)),this},n.loadAtlas=function(t,n,r){void 0===r&&(r=""),this._url="";var s=this;function a(i){t===i&&(s.frames=e.framesMap[r]?e.framesMap[r]:e.createFrames(t,r),n&&n.run())}return s._setFramesFromCache(r)||(at.getAtlas(t)?a(t):i.loader.load(t,l.create(null,a,[t]),null,"atlas")),this},n.loadAnimation=function(t,e,n){return this._url=t,this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,e&&e.run()):!n||at.getAtlas(n)?this._loadAnimationData(t,e,n):i.loader.load(n,l.create(this,this._loadAnimationData,[t,e,n]),null,"atlas"),this},n._loadAnimationData=function(t,n,r){var s=this;if(!r||at.getAtlas(r)){var a=this;at.getRes(t)?o(t):i.loader.load(t,l.create(null,o,[t]),null,"json"),at.clearRes(t)}else console.warn("atlas load fail:"+r);function o(i){if(at.getRes(i)&&t===i){var r;if(e.framesMap[t+"#"])a._setFramesFromCache(s._actionName,!0),s.index=0,s._checkResumePlaying();else{var o=a._parseGraphicAnimation(at.getRes(t));if(!o)return;var h,l=o.animationList,c=0,u=l.length;for(c=0;c<u;c++)r=l[c],e.framesMap[t+"#"+r.name]=r,h||(h=r);h&&(e.framesMap[t+"#"]=h,a._setFramesFromCache(s._actionName,!0),s.index=0),s._checkResumePlaying()}n&&n.run()}}},n._parseGraphicAnimation=function(t){return St.parseAnimationData(t)},n._parseGraphicAnimationByData=function(t){return St.parseAnimationByData(t)},s(0,n,"frames",(function(){return this._frames}),(function(t){(this._frames=t)&&(this._count=t.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)})),s(0,n,"autoPlay",null,(function(t){t?this.play():this.stop()})),s(0,n,"source",null,(function(t){-1<t.indexOf(".ani")?this.loadAnimation(t):-1<t.indexOf(".json")||-1<t.indexOf("als")||-1<t.indexOf("atlas")?this.loadAtlas(t):this.loadImages(t.split(","))})),s(0,n,"autoAnimation",null,(function(t){this.play(0,!0,t,!1)})),e.createFrames=function(t,i){var n,r,s=0,o=0;if("string"==typeof t){var h=at.getAtlas(t);if(h&&h.length)for(n=[],s=0,o=h.length;s<o;s++)(r=new a.createGraphics).drawTexture(at.getRes(h[s]),0,0),n.push(r)}else if(t instanceof Array)for(n=[],s=0,o=t.length;s<o;s++)(r=new a.createGraphics).loadImage(t[s],0,0),n.push(r);return i&&(e.framesMap[i]=n),n},e.clearCache=function(t){var i,n=e.framesMap,r=t+"#";for(i in n)i!==t&&0!=i.indexOf(r)||delete e.framesMap[i]},e.framesMap={}}(pt),function(t){function e(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,e.__super.call(this),null==e._sortIndexFun&&(e._sortIndexFun=T.sortByKey("index",!1,!0))}r(e,"laya.display.FrameAnimation",t);var i=e.prototype;return i._setUp=function(t,e){this._labels=null,this._animationNewFrames=null,this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._animationNewFrames=e.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._animationNewFrames},i.clear=function(){t.prototype.clear.call(this),this._targetDic=null,this._animationData=null},i._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var n=i[t.target];if(n){var r,s,a,o=t.frames,h=t.keys,l=0,c=h.length;for(l=0;l<c;l++)a=(s=o[r=h[l]]).length>e?s[e]:s[s.length-1],n[r]=a}},i._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,n=e.length;for(i=this._count=0;i<n;i++)t=e[i],this._calculateNodeKeyFrames(t);this._count+=1}},i._calculateNodeKeyFrames=function(t){var i,n,r=t.keyframes,s=t.target;for(i in t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.initValues||(t.initValues={}),r)n=r[i],t.frames[i]||(t.frames[i]=[]),this._targetDic&&this._targetDic[s]&&(t.initValues[i]=this._targetDic[s][i]),n.sort(e._sortIndexFun),t.keys.push(i),this._calculateNodePropFrames(n,t.frames[i],i,s)},i.resetToInitState=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,n=0,r=i.length;for(n=0;n<r;n++)if(e=(t=i[n]).initValues){var s,a=this._targetDic[t.target];if(a)for(s in e)a[s]=e[s]}}},i._calculateNodePropFrames=function(t,e,i,n){var r=0,s=t.length-1;if(0<s){for(e.length=t[s].index+1,r=0;r<s;r++)this._dealKeyFrame(t[r]),this._calculateFrameValues(t[r],t[r+1],e);this._dealKeyFrame(t[r])}0==s&&(e[t[0].index]=t[0].value,this._animationNewFrames&&(this._animationNewFrames[t[0].index]=!0))},i._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},i._calculateFrameValues=function(t,e,i){var n,r=0,s=t.index,a=e.index,o=t.value,h=e.value-t.value,l=a-s;if(a>this._count&&(this._count=a),t.tween)for(null==(n=W[t.tweenMethod])&&(n=W.linearNone),r=s;r<a;r++)i[r]=n(r-s,o,h,l),this._animationNewFrames&&(this._animationNewFrames[r]=!0);else for(r=s;r<a;r++)i[r]=o;this._animationNewFrames&&(this._animationNewFrames[t.index]=!0,this._animationNewFrames[e.index]=!0),i[e.index]=e.value},e._sortIndexFun=null,e}(pt)),wt=function(t){function e(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",e.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=mt.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}r(e,"laya.display.Input",t);var a=e.prototype;return a.setSelection=function(t,e){this.focus=!0,laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},a._onUnDisplay=function(t){this.focus=!1},a._onMouseDown=function(t){this.focus=!0},a._syncInputTransform=function(){var t=this.nativeInput,n=q.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),r=this._width-this.padding[1]-this.padding[3],s=this._height-this.padding[0]-this.padding[2];if(R.isConchApp)t.setScale(n.scaleX,n.scaleY),t.setSize(r,s),t.setPos(n.x,n.y);else{var a=1===F.scroll_input_top;a&&t.style.backgroundColor&&(t.style.backgroundColor=null),e.inputContainer.style.transform=e.inputContainer.style.webkitTransform="scale("+n.scaleX+","+n.scaleY+") rotate("+i.stage.canvasDegree+"deg)",t.style.width=a?"720px":r+"px",t.style.height=s+"px",e.inputContainer.style.left=a?"0px":n.x+"px",e.inputContainer.style.top=a?"0px":n.y+"px"}},a.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},a._setInputMethod=function(){e.input.parentElement&&e.inputContainer.removeChild(e.input),e.area.parentElement&&e.inputContainer.removeChild(e.area),e.inputElement=this._multiline?e.area:e.input,e.inputContainer.appendChild(e.inputElement),mt.RightToLeft&&(e.inputElement.style.direction="rtl")},a._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,R.isConchApp&&(t.setType(this._type),t.setForbidEdit(!this._editable)),t.maxLength=this._maxChars,this.padding,t.type=this._type,t.value=this._content,t.placeholder=this._prompt,i.stage.off("keydown",this,this._onKeyDown),i.stage.on("keydown",this,this._onKeyDown),(i.stage.focus=this).event("focus"),F.onPC&&t.focus(),F.onMiniGame||(this._text,this._text=null),this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(F.onIPhone&&mt._fontFamilyMap[this.font]||this.font),R.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!R.isConchApp&&F.onPC&&i.timer.frameLoop(1,this,this._syncInputTransform)},a._setPromptColor=function(){(e.promptStyleDOM=F.getElementById("promptStyle"))||((e.promptStyleDOM=F.createElement("style")).setAttribute("id","promptStyle"),F.document.head.appendChild(e.promptStyleDOM)),e.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},a._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(i.superSet(mt,this,"text",this._content),i.superSet(mt,this,"color",this._originColor)):(i.superSet(mt,this,"text",this._prompt),i.superSet(mt,this,"color",this._promptColor)),i.stage.off("keydown",this,this._onKeyDown),i.stage.focus=null,this.event("blur"),R.isConchApp&&this.nativeInput.blur(),F.onPC&&i.timer.clear(this,this._syncInputTransform)},a._onKeyDown=function(t){13===t.keyCode&&(F.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},a.changeText=function(e){this._content=e,this._focus?(this.nativeInput.value=e||"",this.event("change")):t.prototype.changeText.call(this,e)},s(0,a,"color",t.prototype._$get_color,(function(t){this._focus&&this.nativeInput.setColor(t),i.superSet(mt,this,"color",this._content?t:this._promptColor),this._originColor=t})),s(0,a,"inputElementYAdjuster",(function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0}),(function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")})),s(0,a,"multiline",(function(){return this._multiline}),(function(t){this._multiline=t,this.valign=t?"top":"middle"})),s(0,a,"maxChars",(function(){return this._maxChars}),(function(t){t<=0&&(t=1e5),this._maxChars=t})),s(0,a,"text",(function(){return this._focus?this.nativeInput.value:this._content||""}),(function(t){i.superSet(mt,this,"color",this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event("change")):(this._multiline||(t=t.replace(/\r?\n/g,"")),(this._content=t)?i.superSet(mt,this,"text",t):(i.superSet(mt,this,"text",this._prompt),i.superSet(mt,this,"color",this.promptColor)))})),s(0,a,"nativeInput",(function(){return this._multiline?e.area:e.input})),s(0,a,"prompt",(function(){return this._prompt}),(function(t){!this._text&&t&&i.superSet(mt,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?i.superSet(mt,this,"text",this._text==this._prompt?t:this._text):i.superSet(mt,this,"text",t),this._prompt=mt.langPacks&&mt.langPacks[t]?mt.langPacks[t]:t})),s(0,a,"focus",(function(){return this._focus}),(function(t){var i=this.nativeInput;this._focus!==t&&(t?(i.target?i.target._focusOut():this._setInputMethod(),(i.target=this)._focusIn()):(i.target=null,this._focusOut(),F.document.body.scrollTop=0,i.blur(),R.isConchApp?i.setPos(-1e4,-1e4):e.inputContainer.contains(i)&&e.inputContainer.removeChild(i)))})),s(0,a,"restrict",(function(){return this._restrictPattern?this._restrictPattern.source:""}),(function(t){t?(-1<(t="[^"+t+"]").indexOf("^^")&&(t=t.replace("^^","")),this._restrictPattern=new RegExp(t,"g")):this._restrictPattern=null})),s(0,a,"editable",(function(){return this._editable}),(function(t){this._editable=t,R.isConchApp&&e.input.setForbidEdit(!t)})),s(0,a,"promptColor",(function(){return this._promptColor}),(function(t){this._promptColor=t,this._content||i.superSet(mt,this,"color",t)})),s(0,a,"type",(function(){return this._type}),(function(t){this._getCSSStyle().password="password"==t,this._type=t,R.isConchApp&&this.nativeInput.setType(t)})),s(0,a,"inputElementXAdjuster",(function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0}),(function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")})),s(0,a,"asPassword",(function(){return this._getCSSStyle().password}),(function(t){this._getCSSStyle().password=t,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0})),e.__init__=function(){e._createInputElement(),F.onMobile&&R.canvas.addEventListener(e.IOS_IFRAME?F.onMiniGame?"touchend":"click":"touchend",e._popupInputMethod)},e._popupInputMethod=function(t){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},e._createInputElement=function(){e._initInput(e.area=F.createElement("textarea")),e._initInput(e.input=F.createElement("input")),(e.inputContainer=F.createElement("div")).style.position="absolute",e.inputContainer.style.zIndex=1e5,F.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(t,i){e.inputContainer.style.left=t+"px",e.inputContainer.style.top=i+"px"}},e._initInput=function(t){var i=t.style;i.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",i.resize="none",i.backgroundColor="transparent",i.border="none",i.outline="none",i.zIndex=1,t.addEventListener("input",e._processInputting),t.addEventListener("mousemove",e._stopEvent),t.addEventListener("mousedown",e._stopEvent),t.addEventListener("touchmove",e._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},R.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})},e._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(e){var i=laya.display.Input.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),laya.display.Input.inputElement.value=i)),e._text=i,e.event("input")}},e._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},e.TYPE_TEXT="text",e.TYPE_PASSWORD="password",e.TYPE_EMAIL="email",e.TYPE_URL="url",e.TYPE_NUMBER="number",e.TYPE_RANGE="range",e.TYPE_DATE="date",e.TYPE_MONTH="month",e.TYPE_WEEK="week",e.TYPE_TIME="time",e.TYPE_DATE_TIME="datetime",e.TYPE_DATE_TIME_LOCAL="datetime-local",e.TYPE_SEARCH="search",e.input=null,e.area=null,e.inputElement=null,e.inputContainer=null,e.confirmButton=null,e.promptStyleDOM=null,e.inputHeight=45,e.isInputting=!1,e.stageMatrix=null,n(e,["IOS_IFRAME",function(){return this.IOS_IFRAME=F.onIOS&&F.window.top!=F.window.self}]),e}(mt),bt=function(t){function e(t,i){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,e.__super.call(this),t&&this._init_(t,i)}r(e,"laya.resource.HTMLImage",vt);var i=e.prototype;return i._init_=function(t,e){this._src=t,this._source=new F.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),0!=t.indexOf("data:image")&&(this._source.crossOrigin=""),t&&(this._source.src=t)},i.recreateResource=function(){var t=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var e=this;this._source=new F.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._source.onload=null,void(e._source=null);e._source.onload=null,e.memorySize=t._w*t._h*4,e._recreateLock=!1,e.completeCreate()},this._source.src=this._src}},i.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},i.onresize=function(){this._w=this._source.width,this._h=this._source.height},s(0,i,"onload",null,(function(t){var e=this;this._onload=t,this._source&&(this._source.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)})),s(0,i,"onerror",null,(function(t){var e=this;this._onerror=t,this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)})),s(0,i,"enableMerageInAtlas",(function(){return this._enableMerageInAtlas}),(function(t){this._enableMerageInAtlas=t,R.isConchApp&&this._source&&(this._source.enableMerageInAtlas=t)})),e.create=function(t,i){return new e(t,i)},e}(),St=(function(t){function e(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,e.__super.call(this)}r(e,"laya.display.EffectAnimation",t);var i=e.prototype;i._onOtherBegin=function(t){t!=this&&this.stop()},i.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},i._onPlayAction=function(){this.play(0,!1)},i.play=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,t,e,i,n))},i._recordInitData=function(){if(this._aniKeys){var t,e,i=0;for(t=this._aniKeys.length,i=0;i<t;i++)e=this._aniKeys[i],this._initData[e]=this._target[e]}},i._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(n=1<n?1:n,i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){if(this._target){var n;n=this._target;var r,s,a,o,h=t.frames,l=t.keys,c=0,u=l.length;o=t.secondFrames;var d,_,f,p,m=0;for(c=0;c<u;c++)s=h[r=l[c]],a=-1==(m=o[r])?this._initData[r]:e<m?(f=(_=t.keyframes[r])[0]).tween?(null==(d=W[f.tweenMethod])&&(d=W.linearNone),p=_[1],d(e,this._initData[r],p.value-this._initData[r],p.index)):this._initData[r]:s.length>e?s[e]:s[s.length-1],n[r]=a}},i._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e);var i,n,r,s=e.keyframes;for(i in e.target,r={},e.secondFrames=r,s)(n=s[i]).length<=1?r[i]=-1:r[i]=n[1].index},s(0,i,"target",(function(){return this._target}),(function(t){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=t,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()})),s(0,i,"playEvent",null,(function(t){(this._playEvents=t)&&this.addEvent()})),s(0,i,"effectData",null,(function(t){var e;t&&(e=t.animations)&&e[0]&&(this._setUp({},e[0]),e[0].nodes&&e[0].nodes[0]&&(this._aniKeys=e[0].nodes[0].keys))})),s(0,i,"effectClass",null,(function(t){var e,i;this._effectClass=U.getClass(t),this._effectClass&&(e=this._effectClass.uiView)&&(i=e.animations)&&i[0]&&(this._setUp({},i[0]),i[0].nodes&&i[0].nodes[0]&&(this._aniKeys=i[0].nodes[0].keys))})),e.EffectAnimationBegin="effectanimationbegin"}(xt),function(t){var e;function i(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,i.__super.call(this)}r(i,"laya.utils.GraphicAnimation",t);var s=i.prototype;return s._parseNodeList=function(t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[t.compId]=t.props,t.compId&&this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,n=e.length;for(i=0;i<n;i++)this._parseNodeList(e[i])}},s._calGraphicData=function(t){var e;if(this._setUp(null,t),this._createGraphicData(),this._nodeIDAniDic)for(e in this._nodeIDAniDic)this._nodeIDAniDic[e]=null},s._createGraphicData=function(){var t,e=[],i=0,n=this.count,r=this._animationNewFrames;for(r||(r=[]),i=0;i<n;i++)!r[i]&&t||(t=this._createFrameGraphic(i)),e.push(t);this._gList=e},s._createFrameGraphic=function(t){var e=a.createGraphics();return i._rootMatrix||(i._rootMatrix=new C),this._updateNodeGraphic(this._rootNode,t,i._rootMatrix,e),e},s._updateNodeGraphic=function(t,e,i,n,r){var s;void 0===r&&(r=1);var a,o,h,l=(s=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId])).alpha*r;if(!(l<.01)&&(s.resultTransform||(s.resultTransform=C.create()),a=s.resultTransform,C.mul(s.transform,i,a),s.skin&&(o=this._getTextureByUrl(s.skin))&&(a._checkTransform()?(n.drawTexture(o,0,0,s.width,s.height,a,l),s.resultTransform=null):n.drawTexture(o,a.tx,a.ty,s.width,s.height,null,l)),h=t.child)){var c,u=0;for(c=h.length,u=0;u<c;u++)this._updateNodeGraphic(h[u],e,a,n,l)}},s._updateNoChilds=function(t,e){if(t.skin){var i=this._getTextureByUrl(t.skin);if(i){var n=t.transform;n._checkTransform(),n.bTransform?e.drawTexture(i,0,0,t.width,t.height,n.clone(),t.alpha):e.drawTexture(i,n.tx,n.ty,t.width,t.height,null,t.alpha)}}},s._updateNodeGraphic2=function(t,e,i){var n;if(n=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),t.child){var r,s,a,o,h,l=n.transform;if(l._checkTransform(),s=(r=!l.bTransform)&&(0!=l.tx||0!=l.ty),(a=l.bTransform||1!=n.alpha)&&i.save(),1!=n.alpha&&i.alpha(n.alpha),r?s&&i.translate(l.tx,l.ty):i.transform(l.clone()),o=t.child,n.skin&&(h=this._getTextureByUrl(n.skin))&&i.drawTexture(h,0,0,n.width,n.height),o){var c,u=0;for(c=o.length,u=0;u<c;u++)this._updateNodeGraphic2(o[u],e,i)}a?i.restore():r?s&&i.translate(-l.tx,-l.ty):i.transform(l.clone().invert())}else this._updateNoChilds(n,i)},s._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e),this._nodeIDAniDic[e.target]=e},s.getNodeDataByID=function(t){return this._nodeIDAniDic[t]},s._getParams=function(t,e,n,r){var s=i._temParam;s.length=e.length;var a=0,o=e.length;for(a=0;a<o;a++)s[a]=this._getObjVar(t,e[a][0],n,e[a][1],r);return s},s._getObjVar=function(t,e,i,n,r){if(t.hasOwnProperty(e)){var s=t[e];if(i>=s.length&&(i=s.length-1),null!=t[e][i])return t[e][i]}return r.hasOwnProperty(e)?r[e]:n},s._getNodeGraphicData=function(t,n,r){r||(r=e.create()),r.transform?r.transform.identity():r.transform=C.create();var s=this.getNodeDataByID(t);if(!s)return r;var a,o,h=s.frames,l=this._getParams(h,i._drawTextureCmd,n,this._nodeDefaultProps[t]),c=l[0],u=NaN,d=NaN,_=l[5],f=l[6],p=l[13],m=l[14],g=l[7],v=l[8],y=l[9],x=l[11],w=l[12];u=l[3],d=l[4],0!=u&&0!=d||(c=null),-1==u&&(u=0),-1==d&&(d=0),r.skin=c,r.width=u,r.height=d,c&&((a=this._getTextureByUrl(c))?(u||(u=a.sourceWidth),d||(d=a.sourceHeight)):console.warn("lost skin:",c,",you may load pics first")),r.alpha=l[10],o=r.transform,0!=p&&(_=p*u),0!=m&&(f=m*d),0==_&&0==f||o.translate(-_,-f);var b=null;if(y||1!==g||1!==v||x||w){(b=i._tempMt).identity(),b.bTransform=!0;var S=.0174532922222222*(y-x),T=.0174532922222222*(y+w),M=Math.cos(T),I=Math.sin(T),E=Math.sin(S),A=Math.cos(S);b.a=g*M,b.b=g*I,b.c=-v*E,b.d=v*A,b.tx=b.ty=0}return b&&(o=C.mul(o,b,o)),o.translate(l[1],l[2]),r},s._getTextureByUrl=function(t){return at.getRes(t)},s.setAniData=function(t,e){if(t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t);var n,r={},s=[],a=t.animations,o=0,h=a.length;for(o=0;o<h;o++)if(n=a[o],this._labels=null,(!e||e==n.name)&&n){try{this._calGraphicData(n)}catch(t){console.warn("parse animation fail:"+n.name+",empty animation created"),this._gList=[]}var l={};l.interval=1e3/n.frameRate,l.frames=this._gList,l.labels=this._labels,l.name=n.name,s.push(l),r[n.name]=l}this.animationList=s,this.animationDic=r}i._temParam.length=0},s.parseByData=function(t){var e,i;e=t.nodeRoot,i=t.aniO,delete t.nodeRoot,delete t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e),this._labels=null;try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=t;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},s.setUpAniData=function(t){if(t.animations){var e,i={},n=[],r=t.animations,s=0,a=r.length;for(s=0;s<a;s++)if(e=r[s]){var o={};o.name=e.name,o.aniO=e,o.nodeRoot=t,n.push(o),i[e.name]=o}this.animationList=n,this.animationDic=i}},s._clear=function(){var t,e;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(t in this._nodeGDic)(e=this._nodeGDic[t])&&e.recover();this._nodeGDic=null},i.parseAnimationByData=function(t){var e;return i._I||(i._I=new i),e=i._I.parseByData(t),i._I._clear(),e},i.parseAnimationData=function(t){var e;return i._I||(i._I=new i),i._I.setUpAniData(t),(e={}).animationList=i._I.animationList,e.animationDic=i._I.animationDic,i._I._clear(),e},i._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],i._temParam=[],i._I=null,i._rootMatrix=null,n(i,["_tempMt",function(){return this._tempMt=new C}]),i.__init$=function(){e=function(){function t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return r(t,""),t.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),Y.recover("GraphicNode",this)},t.create=function(){return Y.getItemByClass("GraphicNode",t)},t}()},i}(xt));i.__init([h,ot,R,F,j,A,ct,St])}(window,document,c),function(t,e,i){i.un,i.uns,i.static;var n=i.class;i.getset,i.__newvec,new(function(){function t(){}return n(t,"LayaMain"),t}())}(window,document,c),void 0!==(r=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),c){var n=c[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))&&(t.exports=r),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,a=i.__newvec,o=laya.maths.Arith,h=laya.maths.Bezier,l=laya.resource.Bitmap,c=laya.utils.Browser,u=laya.utils.Byte,d=laya.utils.Color,_=(laya.filters.ColorFilter,i.Config),f=laya.resource.Context,p=(laya.events.Event,laya.filters.Filter),m=laya.display.Graphics,g=laya.resource.HTMLCanvas,v=(laya.utils.HTMLChar,laya.resource.HTMLImage),y=laya.resource.HTMLSubImage,x=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),w=laya.maths.Point,b=laya.maths.Rectangle,S=laya.renders.Render,T=(laya.renders.RenderContext,laya.renders.RenderSprite),C=laya.resource.Resource,M=laya.resource.ResourceManager,I=laya.utils.RunDriver,E=laya.display.Sprite,A=laya.display.Stage,D=laya.utils.Stat,P=laya.utils.StringKey,R=(laya.display.css.Style,laya.system.System),N=laya.display.Text,L=laya.resource.Texture,B=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),O=laya.utils.VectorGraphManager;laya.utils.WordText,i.interface("laya.webgl.shapes.IShape"),i.interface("laya.webgl.submit.ISubmit"),i.interface("laya.webgl.text.ICharSegment"),i.interface("laya.webgl.canvas.save.ISaveData"),i.interface("laya.webgl.resource.IMergeAtlasBitmap"),i.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var F=function(){function t(){}r(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,n,r){return null},e.apply=function(t){return null},s(0,e,"typeMix",(function(){return 0})),t}(),k=function(){function t(){}return r(t,"laya.webgl.shader.ShaderValue"),t}(),V=function(){var t,e;function i(t,i,n){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new e,void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this._cells=null,this._rowInfo=null,this._init(t,i),this._atlasID=n}r(i,"laya.webgl.atlas.AtlasGrid");var n=i.prototype;return n.getAltasID=function(){return this._atlasID},n.setAltasID=function(t){0<=t&&(this._atlasID=t)},n.addTex=function(t,e,i){var n=this._get(e,i);return 0==n.ret||(this._fill(n.x,n.y,e,i,t),this._texCount++),n},n._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},n._init=function(e,i){if(this._width=e,this._height=i,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=a(this._height);for(var n=0;n<this._height;n++)this._rowInfo[n]=new t;return this._clear(),!0},n._get=function(t,e){var i=new H;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var n=-1,r=-1,s=this._width,a=this._height,o=this._cells,h=0;h<a;h++)if(!(this._rowInfo[h].spaceCount<t))for(var l=0;l<s;){var c=3*(h*s+l);if(0!=o[c]||o[1+c]<t||o[2+c]<e)l+=o[1+c];else{n=l,r=h;for(var u=0;u<t;u++)if(o[3*u+c+2]<e){n=-1;break}if(!(n<0))return i.ret=!0,i.x=n,i.y=r,i;l+=o[1+c]}}return i},n._fill=function(t,e,i,n,r){var s=this._width,a=this._height;this._check(t+i<=s&&e+n<=a);for(var o=e;o<n+e;++o){this._check(this._rowInfo[o].spaceCount>=i),this._rowInfo[o].spaceCount-=i;for(var h=0;h<i;h++){var l=3*(t+o*s+h);this._check(0==this._cells[l]),this._cells[l]=r,this._cells[1+l]=i,this._cells[2+l]=n}}if(0<t)for(o=0;o<n;++o){var c=0;for(h=t-1;0<=h&&0==this._cells[3*((e+o)*s+h)];--h,++c);for(h=c;0<h;--h)this._cells[3*((e+o)*s+t-h)+1]=h,this._check(0<h)}if(0<e)for(h=t;h<t+i;++h){for(c=0,o=e-1;0<=o&&0==this._cells[3*(h+o*s)];--o,c++);for(o=c;0<o;--o)this._cells[3*(h+(e-o)*s)+2]=o,this._check(0<o)}},n._check=function(t){0==t&&console.log("xtexMerger 错误啦")},n._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var n=3*(e*this._width+i);this._cells[n]=0,this._cells[1+n]=this._width-i,this._cells[2+n]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},i.__init$=function(){t=function(){function t(){this.spaceCount=0}return r(t,""),t}(),e=function(){function t(){this.width=0,this.height=0}return r(t,""),t}()},i}(),U=function(){function t(t,e,i,n){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=n,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}r(t,"laya.webgl.atlas.AtlasResourceManager");var e=t.prototype;return e.setAtlasParam=function(e,i,n,r){if(1==this._setAtlasParam)return t._sid_=0,this._width=e,this._height=i,this._gridSize=n,this._maxAtlaserCount=r,this._gridNumX=e/n,this._gridNumY=i/n,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},e.pushData=function(e){var i,n=e.bitmap,r=-1,s=null,a=0,o=0;for(a=0,i=this._atlaserArray.length;a<i&&(o=(this._curAtlasIndex+a)%i,-1==(r=(s=this._atlaserArray[o]).findBitmapIsExist(n)));a++);if(-1!=r){var h=s.InAtlasWebGLImagesOffsetValue[r];return p=h[0],m=h[1],s.addToAtlas(e,p,m),!0}this._setAtlasParam=!1;for(var l=Math.ceil((e.bitmap.width+2)/this._gridSize),c=Math.ceil((e.bitmap.height+2)/this._gridSize),u=!1,d=0;d<2;d++){var _=this._maxAtlaserCount;for(a=0;a<_;a++){o=(this._curAtlasIndex+a)%_,this._atlaserArray.length-1>=o||this._atlaserArray.push(new It(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++));var f=this._atlaserArray[o],p=0,m=0,g=f.addTex(1,l,c);if(g.ret){p=g.x*this._gridSize+1,m=g.y*this._gridSize+1,n.lock=!0,f.addToAtlasTexture(n,p,m),f.addToAtlas(e,p,m),u=!0,this._curAtlasIndex=o;break}}if(u)break;this._atlaserArray.push(new It(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return u||console.log(">>>AtlasManager pushData error"),u},e.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},e.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},e.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},e.getAtlaserCount=function(){return this._atlaserArray.length},e.getAtlaserByIndex=function(t){return this._atlaserArray[t]},s(1,t,"instance",(function(){return t._Instance||(t._Instance=new t(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),t._Instance})),s(1,t,"enabled",(function(){return _.atlasEnable})),s(1,t,"atlasLimitWidth",(function(){return t._atlasLimitWidth}),(function(e){t._atlasLimitWidth=e})),s(1,t,"atlasLimitHeight",(function(){return t._atlasLimitHeight}),(function(e){t._atlasLimitHeight=e})),t._enable=function(){_.atlasEnable=!0},t._disable=function(){_.atlasEnable=!1},t.__init__=function(){t.atlasTextureWidth=2048,t.atlasTextureHeight=2048,t.maxTextureCount=6,t.atlasLimitWidth=512,t.atlasLimitHeight=512},t._atlasLimitWidth=0,t._atlasLimitHeight=0,t.gridSize=16,t.atlasTextureWidth=0,t.atlasTextureHeight=0,t.maxTextureCount=0,t._atlasRestore=0,t.BOARDER_TYPE_NO=0,t.BOARDER_TYPE_RIGHT=1,t.BOARDER_TYPE_LEFT=2,t.BOARDER_TYPE_BOTTOM=4,t.BOARDER_TYPE_TOP=8,t.BOARDER_TYPE_ALL=15,t._sid_=0,t._Instance=null,t}(),H=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return r(t,"laya.webgl.atlas.MergeFillInfo"),t}(),z=function(){function t(){}return r(t,"laya.webgl.canvas.BlendMode"),t._init_=function(e){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight,t.BlendMask,t.BlendDestinationOut],t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget,t.BlendMask,t.BlendDestinationOut]},t.BlendNormal=function(t){t.blendFunc(1,771)},t.BlendAdd=function(t){t.blendFunc(1,772)},t.BlendMultiply=function(t){t.blendFunc(774,771)},t.BlendScreen=function(t){t.blendFunc(1,1)},t.BlendOverlay=function(t){t.blendFunc(1,769)},t.BlendLight=function(t){t.blendFunc(1,1)},t.BlendNormalTarget=function(t){t.blendFunc(1,771)},t.BlendAddTarget=function(t){t.blendFunc(1,772)},t.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},t.BlendScreenTarget=function(t){t.blendFunc(1,1)},t.BlendOverlayTarget=function(t){t.blendFunc(1,769)},t.BlendLightTarget=function(t){t.blendFunc(1,1)},t.BlendMask=function(t){t.blendFunc(0,770)},t.BlendDestinationOut=function(t){t.blendFunc(0,0)},t.activeBlendFunction=null,t.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],t.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},t.NORMAL="normal",t.ADD="add",t.MULTIPLY="multiply",t.SCREEN="screen",t.LIGHT="light",t.OVERLAY="overlay",t.DESTINATIONOUT="destination-out",t.fns=[],t.targetFns=[],t}(),W=function(){function t(t){this._color=d.create("black"),this.setValue(t)}r(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;return e.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=d.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},e.reset=function(){this._color=d.create("black")},e.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color&&this._color.numColor===t.numColor},e.toColorStr=function(){return this._color.strColor},t.create=function(e){var i;return e&&("string"==typeof e?i=d.create(e):e instanceof laya.utils.Color&&(i=e),i)?i._drawStyle||(i._drawStyle=new t(e)):laya.webgl.canvas.DrawStyle.DEFAULT},n(t,["DEFAULT",function(){return this.DEFAULT=new t("#000000")}]),t}(),G=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[],xt.mainContext,this.ib=Jt.create(35048),this.vb=$t.create(5)}r(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,n,r,s){var a;return this.geomatrys.push(this._curGeomatry=a=new Pt(t,e,i,n,r,s)),n||(a.fill=!1),null==s&&(a.borderWidth=0),a},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,n,r){var s;return this.closePath?this.geomatrys.push(this._curGeomatry=s=new Dt(t,e,i,n,r)):this.geomatrys.push(this._curGeomatry=s=new At(t,e,i,n,r)),s.fill=!1,s},e.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/pt.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},e.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},t}(),Y=function(){function t(){}r(t,"laya.webgl.canvas.save.SaveBase");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._dataObj[this._valueName]=this._value,(t._cache[t._cache._length++]=this)._newSubmit&&(e._curSubmit=st.RENDERBASE,e._renderKey=0)},t._createArray=function(){var t=[];return t._length=0,t},t._init=function(){var e=t._namemap={};return e[1]="ALPHA",e[2]="fillStyle",e[8]="font",e[256]="lineWidth",e[512]="strokeStyle",e[8192]="_mergeID",e[1024]=e[2048]=e[4096]=[],e[16384]="textBaseline",e[32768]="textAlign",e[65536]="_nBlendType",e[1048576]="shader",e[2097152]="filters",e},t.save=function(e,i,n,r){if((e._saveMark._saveuse&i)!==i){e._saveMark._saveuse|=i;var s=t._cache,a=0<s._length?s[--s._length]:new t;a._value=n[a._valueName=t._namemap[i]],a._dataObj=n,a._newSubmit=r;var o=e._save;o[o._length++]=a}},t._cache=laya.webgl.canvas.save.SaveBase._createArray(),t._namemap=t._init(),t}(),X=function(){function t(){this._clipRect=new b}r(t,"laya.webgl.canvas.save.SaveClipRect");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._clipRect=this._clipSaveRect,(t._cache[t._cache._length++]=this)._submitScissor.submitLength=e._submits._length-this._submitScissor.submitIndex,e._curSubmit=st.RENDERBASE,e._renderKey=0},t.save=function(e,i){if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;var n=t._cache,r=0<n._length?n[--n._length]:new t;r._clipSaveRect=e._clipRect,e._clipRect=r._clipRect.copyFrom(e._clipRect),r._submitScissor=i;var s=e._save;s[s._length++]=r}},n(t,["_cache",function(){return this._cache=Y._createArray()}]),t}(),j=function(){function t(){this._contextX=0,this._contextY=0,this._clipRect=new b,this._rect=new b,this._matrix=new x}r(t,"laya.webgl.canvas.save.SaveClipRectStencil");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){ct.restore(e,this._rect,this._saveMatrix,this._contextX,this._contextY),e._clipRect=this._clipSaveRect,e._curMat=this._saveMatrix,e._x=this._contextX,e._y=this._contextY,t._cache[t._cache._length++]=this,e._curSubmit=st.RENDERBASE},t.save=function(e,i,n,r,s,a,o,h,l,c){if(262144!=(262144&e._saveMark._saveuse)){e._saveMark._saveuse|=262144;var u=t._cache,d=0<u._length?u[--u._length]:new t;d._clipSaveRect=e._clipRect,d._clipRect.setTo(o,h,l,c),e._clipRect=d._clipRect,d._rect.x=n,d._rect.y=r,d._rect.width=s,d._rect.height=a,d._contextX=e._x,d._contextY=e._y,d._saveMatrix=e._curMat,e._curMat.copyTo(d._matrix),e._curMat=d._matrix,d._submitStencil=i;var _=e._save;_[_._length++]=d}},n(t,["_cache",function(){return this._cache=Y._createArray()}]),t}(),K=function(){function t(){this._saveuse=0}r(t,"laya.webgl.canvas.save.SaveMark");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!0},e.restore=function(e){e._saveMark=this._preSaveMark,t._no[t._no._length++]=this},t.Create=function(e){var i=t._no,n=0<i._length?i[--i._length]:new t;return n._saveuse=0,n._preSaveMark=e._saveMark,e._saveMark=n},n(t,["_no",function(){return this._no=Y._createArray()}]),t}(),q=function(){function t(){this._matrix=new x}r(t,"laya.webgl.canvas.save.SaveTransform");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat=this._savematrix,t._no[t._no._length++]=this},t.save=function(e){var i=e._saveMark;if(2048!=(2048&i._saveuse)){i._saveuse|=2048;var n=t._no,r=0<n._length?n[--n._length]:new t;r._savematrix=e._curMat,e._curMat=e._curMat.copyTo(r._matrix);var s=e._save;s[s._length++]=r}},n(t,["_no",function(){return this._no=Y._createArray()}]),t}(),Z=function(){function t(){}r(t,"laya.webgl.canvas.save.SaveTranslate");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat,e._x=this._x,e._y=this._y,t._no[t._no._length++]=this},t.save=function(e){var i=t._no,n=0<i._length?i[--i._length]:new t;n._x=e._x,n._y=e._y;var r=e._save;r[r._length++]=n},n(t,["_no",function(){return this._no=Y._createArray()}]),t}(),Q=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new b}r(t,"laya.webgl.resource.RenderTargetMAX");var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var n=this;this._width!==t||this._height!==e?(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=Ot.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,(function(t){i.timer.callLater(n._sp,n._sp.repaint)}))):this.target.size(t,e)},e._flushToTarget=function(t,e){if(!e._destroy){var i=vt.worldScissorTest,n=vt.worldClipRect;vt.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,vt.worldScissorTest=!1,xt.mainContext.disable(3089);var r=vt.worldAlpha,s=vt.worldMatrix4,a=vt.worldMatrix,o=vt.worldFilters,h=vt.worldShaderDefines;if(vt.worldMatrix=x.EMPTY,vt.restoreTempArray(),vt.worldMatrix4=vt.TEMPMAT4_ARRAY,vt.worldAlpha=1,vt.worldFilters=null,vt.worldShaderDefines=null,Bt.activeShader=null,e.start(),_.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),Bt.activeShader=null,vt.worldAlpha=r,vt.worldMatrix4=s,vt.worldMatrix=a,vt.worldFilters=o,vt.worldShaderDefines=h,vt.worldScissorTest=i){var l=vt.height-n.y-n.height;xt.mainContext.scissor(n.x,l,n.width,n.height),xt.mainContext.enable(3089)}vt.worldClipRect=n}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,n,r){t.drawTexture(this.target.getTexture(),e,i,n,r,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),J=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new Et}return r(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},t.__init__=function(){var t,e;Kt.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Kt.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Kt.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Kt.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Kt.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Kt.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Kt.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Kt.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),t="attribute vec4 position;\n",t+="attribute vec2 texcoord;\n",t+="uniform vec2 size;\n\n",t+="#ifdef WORLDMAT\n",t+="  uniform mat4 mmat;\n",t+="#endif\n",t+="varying vec2 v_texcoord;\n",t+="void main() {\n",t+="  #ifdef WORLDMAT\n",t+="  vec4 pos=mmat*position;\n",t+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",t+="  #else\n",t+="  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n",t+="  #endif\n\n",t+="  v_texcoord = texcoord;\n",t+="}",e="precision mediump float;\n",e+="varying vec2 v_texcoord;\n",e+="uniform sampler2D texture;\n\n",e+="#ifdef COLORMUL\n",e+="  uniform vec4 colorMul;\n",e+="#endif\n\n",e+="#ifdef TXTALPHA\n",e+="  uniform sampler2D texture1;\n",e+="#endif\n\n",e+="uniform float alpha;\n",e+='#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n',e+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',e+='#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n',e+='#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\n',e+="void main() {\n",e+="   vec4 color= texture2D(texture, v_texcoord);\n\n",e+="   #ifdef TXTCOMPRESS\n",e+="      color.rgb *= color.a;\n",e+="   #endif\n\n",e+="   #ifdef TXTALPHA\n",e+="      color.rgba *= texture2D(texture1, v_texcoord).a;\n",e+="   #endif\n\n",e+="   color.a*=alpha;\n",e+="   color.rgb*=alpha;\n",e+="   #ifdef COLORMUL\n",e+="      color.rgba *= colorMul;\n",e+="   #endif\n\n",e+="   gl_FragColor=color;\n",e+='   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";\n',e+='   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n',e+='   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',e+='   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n',e+="}",Kt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\n",t+="uniform vec2 size;\n",t+="uniform mat4 mmat;\n",t+="void main() {\n",t+="  vec4 pos=mmat*position;\n",t+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",t+="}",e="precision mediump float;\n",e+="uniform vec4 color;\n",e+="uniform float alpha;\n",e+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',e+="void main() {\n",e+="\t vec4 a = vec4(color.r, color.g, color.b, color.a);\n",e+="\t a.w = alpha;\n",e+="\t a.xyz *= alpha;\n",e+="\t gl_FragColor = a;\n",e+='\t #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',e+="}",Kt.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\n",t+="attribute vec3 a_color;\n",t+="uniform mat4 mmat;\n",t+="uniform mat4 u_mmat2;\n",t+="uniform vec2 u_pos;\n",t+="uniform vec2 size;\n",t+="varying vec3 color;\n",t+="void main(){\n",t+="  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n",t+="  vec4 pos=mmat*u_mmat2*tPos;\n",t+="  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",t+="  color=a_color;\n",t+="}",e="precision mediump float;\n",e+="varying vec3 color;\n",e+="uniform float alpha;\n",e+="void main(){\n",e+="  gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n",e+="\t gl_FragColor.rgb*=alpha;\n",e+="}",Kt.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\n",t+="attribute vec2 texcoord;\n",t+="uniform vec2 size;\n\n",t+="#ifdef WORLDMAT\n",t+="  uniform mat4 mmat;\n",t+="#endif\n",t+="varying vec2 v_texcoord;\n",t+="void main() {\n",t+="  #ifdef WORLDMAT\n",t+="    vec4 pos=mmat*position;\n",t+="    gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",t+="  #else\n",t+="    gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n",t+="  #endif\n\n",t+="  v_texcoord = texcoord;\n",t+="}",e="#ifdef FSHIGHPRECISION\n",e+="   precision highp float;\n",e+="#else\n",e+="   precision mediump float;\n",e+="#endif\n",e+="varying vec2 v_texcoord;\n",e+="uniform sampler2D texture;\n\n",e+="#ifdef TXTALPHA\n",e+="   uniform sampler2D texture1;\n",e+="#endif\n\n",e+="uniform float alpha;\n",e+="uniform vec4 u_TexRange;\n",e+="uniform vec2 u_offset;\n",e+='#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n',e+='#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n',e+='#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n',e+='#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\n',e+="void main() {\n",e+="   vec2 newTexCoord;\n",e+="   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n",e+="   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n",e+="   vec4 color= texture2D(texture, newTexCoord);\n\n",e+="   #ifdef TXTALPHA\n",e+="      color.a = texture2D(texture1, newTexCoord).a;\n",e+="   #endif\n\n",e+="   color.a*=alpha;\n",e+="   gl_FragColor=color;\n",e+='   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";\n',e+='   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n',e+='   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n',e+='   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n',e+="}",Kt.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\n",t+="attribute vec2 texcoord;\n",t+="attribute vec4 color;\n",t+="uniform vec2 size;\n",t+="uniform float offsetX;\n",t+="uniform float offsetY;\n",t+="uniform mat4 mmat;\n",t+="uniform mat4 u_mmat2;\n",t+="varying vec2 v_texcoord;\n",t+="varying vec4 v_color;\n",t+="void main() {\n",t+="  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n",t+="  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n",t+="  v_color = color;\n",t+="  v_color.rgb *= v_color.a;\n",t+="  v_texcoord = texcoord;  \n",t+="}",e="precision mediump float;\n",e+="varying vec2 v_texcoord;\n",e+="varying vec4 v_color;\n",e+="uniform sampler2D texture;\n\n",e+="#ifdef TXTALPHA\n",e+="  uniform sampler2D texture1;\n",e+="#endif\n\n",e+="uniform float alpha;\n",e+="void main() {\n",e+="\t vec4 t_color = texture2D(texture, v_texcoord);\n\n",e+="  #ifdef TXTALPHA\n",e+="    t_color.a = texture2D(texture1, v_texcoord).a;\n",e+="  #endif\n\n",e+="\t gl_FragColor = t_color.rgba * v_color;\n",e+="\t gl_FragColor *= alpha;\n",e+="}",Kt.preCompile2D(0,512,t,e,null)},t}(),$=function(){function t(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}r(t,"laya.webgl.shader.ShaderDefines");var e=t.prototype;return e.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},e.addInt=function(t){return this._value|=t,this._value},e.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},e.isDefine=function(t){return(this._value&t)===t},e.getValue=function(){return this._value},e.setValue=function(t){this._value=t},e.toNameDic=function(){return this._int2nameMap[this._value]||t._toText(this._value,this._int2name,this._int2nameMap)},t._reg=function(t,e,i,n){n[i[t]=e]=t},t._toText=function(t,e,i){var n=i[t];if(n)return n;for(var r={},s=1,a=0;a<32&&!(t<(s=1<<a));a++)if(t&s){var o=e[s];o&&(r[o]="")}return i[t]=r},t._toInt=function(t,e){for(var i=t.split("."),n=0,r=0,s=i.length;r<s;r++){var a=e[i[r]];if(!a)throw new Error("Defines to int err:"+t+"/"+i[r]);n|=a}return n},t}(),tt=function(){function t(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new x}r(t,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var e=t.prototype;return e.init=function(e,i,n){if(i)this._vs=i;else{this._vs=[];var r=e.width,s=e.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(r,0,1,0,1,1,1,1),this._vs.push(r,s,1,1,1,1,1,1),this._vs.push(0,s,0,1,1,1,1,1)}n?this._ps=n:(t._defaultPS||(t._defaultPS=[]).push(0,1,3,3,1,2),this._ps=t._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=e},e.init2=function(t,e,i,n,r){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=n,this._uvs=r,this.mEleNum=this._ps.length,this.mTexture=t,(S.isConchNode||S.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},e._initMyData=function(){var e=0,i=0,n=4*this._verticles.length;this._vs=t._tempVS;var r=!1;if((S.isConchNode||S.isConchApp||this._vs.length<n)&&(this._vs.length=n,r=!0),t._tVSLen=n,r)for(;e<n;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],this._vs[e+4]=1,this._vs[e+5]=1,this._vs[e+6]=1,this._vs[e+7]=1,e+=8,i+=2;else for(;e<n;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],e+=8,i+=2},e.getData2=function(e,i,n){var r;this.mVBBuffer=e,this.mIBBuffer=i,this._initMyData(),e.appendEx2(this._vs,Float32Array,t._tVSLen,4),this._indexStart=i._byteLength,(r=t._tempIB).length<this._ps.length&&(r.length=this._ps.length);for(var s=0,a=this._ps.length;s<a;s++)r[s]=this._ps[s]+n;i.appendEx2(r,Uint16Array,this._ps.length,2)},e.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var n=0,r=this._ps.length;n<r;n++)this.mIBData[n]=this._ps[n]+i;this.mIBData.start=i}e.append(this.mIBData)},e.render=function(t,e,i){if(S.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,et.getInstance().addSkinMesh(this);var n=st.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Tt.create(512,0));this.transform||(this.transform=x.EMPTY),this.transform.translate(e,i),x.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var r=n.shaderValue,s=r.u_mmat2||vt.getMatrArray();vt.mat2MatArray(this._tempMatrix,s),r.textureHost=this.mTexture,r.offsetX=0,r.offsetY=0,r.u_mmat2=s,r.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=n}else S.isConchApp&&this.mTexture&&(this.transform||(this.transform=x.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},t._tempVS=[],t._tempIB=[],t._defaultPS=null,t._tVSLen=0,t}(),et=function(){function t(){this.ib=null,this.vb=null,xt.mainContext,this.ib=Jt.create(35048),this.vb=$t.create(8)}r(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),it=function(){function t(t,e,i,n,r,s,a,o,h){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===h&&(h=0),this.x=t,this.y=e,this.width=i,this.height=n,this.edges=r,this.color=s,this.borderWidth=a,this.borderColor=o}r(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return i.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var n=this.x,r=this.y,s=this.edges,a=(this.r1-this.r0)/s,o=this.width,h=this.height,l=this.color,c=(l>>16&255)/255,u=(l>>8&255)/255,d=(255&l)/255;t.push(n,r,c,u,d);for(var _=0;_<s+1;_++)t.push(n+Math.sin(a*_+this.r0)*o,r+Math.cos(a*_+this.r0)*h),t.push(c,u,d);for(_=0;_<s;_++)e.push(i,i+_+1,i+_+2)},e.createLine2=function(t,e,i,n,r,s){var a,o,h,l,c,u,d,_,f,p,m,g,v,y,x,w,b,S,T,C,M=t.concat(),I=r,E=this.borderColor,A=(E>>16&255)/255,D=(E>>8&255)/255,P=(255&E)/255,R=M.length/2,N=n,L=i/2;h=M[0],l=M[1],p=h-(c=M[2]),f=(f=-(l-(u=M[3])))/(C=Math.sqrt(f*f+p*p))*L,p=p/C*L,I.push(h-f+this.x,l-p+this.y,A,D,P,h+f+this.x,l+p+this.y,A,D,P);for(var B=1;B<R-1;B++)h=M[2*(B-1)],l=M[2*(B-1)+1],c=M[2*B],u=M[2*B+1],d=M[2*(B+1)],_=M[2*(B+1)+1],p=h-c,g=c-d,x=(-(f=(f=-(l-u))/(C=Math.sqrt(f*f+p*p))*L)+h)*(-(p=p/C*L)+u)-(-f+c)*(-p+l),S=(-(m=(m=-(u-_))/(C=Math.sqrt(m*m+g*g))*L)+d)*(-(g=g/C*L)+u)-(-m+c)*(-g+_),T=(v=-p+l-(-p+u))*(b=-m+c-(-m+d))-(w=-g+_-(-g+u))*(y=-f+c-(-f+h)),Math.abs(T)<.1?(T+=10.1,I.push(c-f+this.x,u-p+this.y,A,D,P,c+f+this.x,u+p+this.y,A,D,P)):(a=(y*S-b*x)/T,o=(w*x-v*S)/T,I.push(a+this.x,o+this.y,A,D,P,c-(a-c)+this.x,u-(o-u)+this.y,A,D,P));h=M[M.length-4],l=M[M.length-3],p=h-(c=M[M.length-2]),f=(f=-(l-(u=M[M.length-1])))/(C=Math.sqrt(f*f+p*p))*L,p=p/C*L,I.push(c-f+this.x,u-p+this.y,A,D,P,c+f+this.x,u+p+this.y,A,D,P);var O=s;for(B=1;B<O;B++)e.push(N+2*(B-1),N+2*(B-1)+1,N+2*B+1,N+2*B+1,N+2*B,N+2*(B-1));return I},e.createLine=function(t,e,i,n){var r=t.concat(),s=t,a=this.borderColor,o=(a>>16&255)/255,h=(a>>8&255)/255,l=(255&a)/255;r.splice(0,5);var c,u,d,_,f,p,m,g,v,y,x,w,b,S,T,C,M,I,E,A,D=r.length/5,P=n,R=i/2;d=r[0],_=r[1],y=d-(f=r[5]),v=(v=-(_-(p=r[6])))/(A=Math.sqrt(v*v+y*y))*R,y=y/A*R,s.push(d-v,_-y,o,h,l,d+v,_+y,o,h,l);for(var N=1;N<D-1;N++)d=r[5*(N-1)],_=r[5*(N-1)+1],f=r[5*N],p=r[5*N+1],m=r[5*(N+1)],g=r[5*(N+1)+1],y=d-f,w=f-m,T=(-(v=(v=-(_-p))/(A=Math.sqrt(v*v+y*y))*R)+d)*(-(y=y/A*R)+p)-(-v+f)*(-y+_),I=(-(x=(x=-(p-g))/(A=Math.sqrt(x*x+w*w))*R)+m)*(-(w=w/A*R)+p)-(-x+f)*(-w+g),E=(b=-y+_-(-y+p))*(M=-x+f-(-x+m))-(C=-w+g-(-w+p))*(S=-v+f-(-v+d)),Math.abs(E)<.1?(E+=10.1,s.push(f-v,p-y,o,h,l,f+v,p+y,o,h,l)):(c=(S*I-M*T)/E,u=(C*T-b*I)/E,s.push(c,u,o,h,l,f-(c-f),p-(u-p),o,h,l));d=r[r.length-10],_=r[r.length-9],y=d-(f=r[r.length-5]),v=(v=-(_-(p=r[r.length-4])))/(A=Math.sqrt(v*v+y*y))*R,y=y/A*R,s.push(f-v,p-y,o,h,l,f+v,p+y,o,h,l);var L=this.edges+1;for(N=1;N<L;N++)e.push(P+2*(N-1),P+2*(N-1)+1,P+2*N+1,P+2*N+1,P+2*N,P+2*(N-1));return s},e.createLoopLine=function(t,e,i,n,r,s){var a=t.concat(),o=r||t,h=this.borderColor,l=(h>>16&255)/255,c=(h>>8&255)/255,u=(255&h)/255;a.splice(0,5);var d=[a[0],a[1]],_=[a[a.length-5],a[a.length-4]],f=_[0]+.5*(d[0]-_[0]),p=_[1]+.5*(d[1]-_[1]);a.unshift(f,p,0,0,0),a.push(f,p,0,0,0);var m,g,v,y,x,w,b,S,T,C,M,I,E,A,D,P,R,N,L,B,O=a.length/5,F=n,k=i/2;v=a[0],y=a[1],C=v-(x=a[5]),T=(T=-(y-(w=a[6])))/(B=Math.sqrt(T*T+C*C))*k,C=C/B*k,o.push(v-T,y-C,l,c,u,v+T,y+C,l,c,u);for(var V=1;V<O-1;V++)v=a[5*(V-1)],y=a[5*(V-1)+1],x=a[5*V],w=a[5*V+1],b=a[5*(V+1)],S=a[5*(V+1)+1],C=v-x,I=x-b,D=(-(T=(T=-(y-w))/(B=Math.sqrt(T*T+C*C))*k)+v)*(-(C=C/B*k)+w)-(-T+x)*(-C+y),N=(-(M=(M=-(w-S))/(B=Math.sqrt(M*M+I*I))*k)+b)*(-(I=I/B*k)+w)-(-M+x)*(-I+S),L=(E=-C+y-(-C+w))*(R=-M+x-(-M+b))-(P=-I+S-(-I+w))*(A=-T+x-(-T+v)),Math.abs(L)<.1?(L+=10.1,o.push(x-T,w-C,l,c,u,x+T,w+C,l,c,u)):(m=(A*N-R*D)/L,g=(P*D-E*N)/L,o.push(m,g,l,c,u,x-(m-x),w-(g-w),l,c,u));s&&(e=s);var U=this.edges+1;for(V=1;V<U;V++)e.push(F+2*(V-1),F+2*(V-1)+1,F+2*V+1,F+2*V+1,F+2*V,F+2*(V-1));return e.push(F+2*(V-1),F+2*(V-1)+1,F+1,F+1,F,F+2*(V-1)),o},t}(),nt=function(){function t(){}return r(t,"laya.webgl.shapes.Earcut"),t.earcut=function(e,i,n){n=n||2;var r,s,a,o,h,l,c,u=i&&i.length,d=u?i[0]*n:e.length,_=t.linkedList(e,0,d,n,!0),f=[];if(!_)return f;if(u&&(_=t.eliminateHoles(e,i,_,n)),e.length>80*n){r=a=e[0],s=o=e[1];for(var p=n;p<d;p+=n)(h=e[p])<r&&(r=h),(l=e[p+1])<s&&(s=l),a<h&&(a=h),o<l&&(o=l);c=0!==(c=Math.max(a-r,o-s))?1/c:0}return t.earcutLinked(_,f,n,r,s,c),f},t.linkedList=function(e,i,n,r,s){var a,o;if(s===0<t.signedArea(e,i,n,r))for(a=i;a<n;a+=r)o=t.insertNode(a,e[a],e[a+1],o);else for(a=n-r;i<=a;a-=r)o=t.insertNode(a,e[a],e[a+1],o);return o&&t.equals(o,o.next)&&(t.removeNode(o),o=o.next),o},t.filterPoints=function(e,i){if(!e)return e;i||(i=e);var n,r=e;do{if(n=!1,r.steiner||!t.equals(r,r.next)&&0!==t.area(r.prev,r,r.next))r=r.next;else{if(t.removeNode(r),(r=i=r.prev)===r.next)break;n=!0}}while(n||r!==i);return i},t.earcutLinked=function(e,i,n,r,s,a,o){if(e){!o&&a&&t.indexCurve(e,r,s,a);for(var h,l,c=e;e.prev!==e.next;)if(h=e.prev,l=e.next,a?t.isEarHashed(e,r,s,a):t.isEar(e))i.push(h.i/n),i.push(e.i/n),i.push(l.i/n),t.removeNode(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?(e=t.cureLocalIntersections(e,i,n),t.earcutLinked(e,i,n,r,s,a,2)):2===o&&t.splitEarcut(e,i,n,r,s,a):t.earcutLinked(t.filterPoints(e,null),i,n,r,s,a,1);break}}},t.isEar=function(e){var i=e.prev,n=e,r=e.next;if(0<=t.area(i,n,r))return!1;for(var s=e.next.next;s!==e.prev;){if(t.pointInTriangle(i.x,i.y,n.x,n.y,r.x,r.y,s.x,s.y)&&0<=t.area(s.prev,s,s.next))return!1;s=s.next}return!0},t.isEarHashed=function(e,i,n,r){var s=e.prev,a=e,o=e.next;if(0<=t.area(s,a,o))return!1;for(var h=s.x<a.x?s.x<o.x?s.x:o.x:a.x<o.x?a.x:o.x,l=s.y<a.y?s.y<o.y?s.y:o.y:a.y<o.y?a.y:o.y,c=s.x>a.x?s.x>o.x?s.x:o.x:a.x>o.x?a.x:o.x,u=s.y>a.y?s.y>o.y?s.y:o.y:a.y>o.y?a.y:o.y,d=t.zOrder(h,l,i,n,r),_=t.zOrder(c,u,i,n,r),f=e.nextZ;f&&f.z<=_;){if(f!==e.prev&&f!==e.next&&t.pointInTriangle(s.x,s.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=t.area(f.prev,f,f.next))return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&t.pointInTriangle(s.x,s.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=t.area(f.prev,f,f.next))return!1;f=f.prevZ}return!0},t.cureLocalIntersections=function(e,i,n){var r=e;do{var s=r.prev,a=r.next.next;!t.equals(s,a)&&t.intersects(s,r,r.next,a)&&t.locallyInside(s,a)&&t.locallyInside(a,s)&&(i.push(s.i/n),i.push(r.i/n),i.push(a.i/n),t.removeNode(r),t.removeNode(r.next),r=e=a),r=r.next}while(r!==e);return r},t.splitEarcut=function(e,i,n,r,s,a){var o=e;do{for(var h=o.next.next;h!==o.prev;){if(o.i!==h.i&&t.isValidDiagonal(o,h)){var l=t.splitPolygon(o,h);return o=t.filterPoints(o,o.next),l=t.filterPoints(l,l.next),t.earcutLinked(o,i,n,r,s,a),void t.earcutLinked(l,i,n,r,s,a)}h=h.next}o=o.next}while(o!==e)},t.eliminateHoles=function(e,i,n,r){var s,a,o,h,l,c=[];for(s=0,a=i.length;s<a;s++)o=i[s]*r,h=s<a-1?i[s+1]*r:e.length,(l=t.linkedList(e,o,h,r,!1))===l.next&&(l.steiner=!0),c.push(t.getLeftmost(l));for(c.sort(t.compareX),s=0;s<c.length;s++)t.eliminateHole(c[s],n),n=t.filterPoints(n,n.next);return n},t.compareX=function(t,e){return t.x-e.x},t.eliminateHole=function(e,i){if(i=t.findHoleBridge(e,i)){var n=t.splitPolygon(i,e);t.filterPoints(n,n.next)}},t.findHoleBridge=function(e,i){var n,r=i,s=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var h=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=s&&o<h){if((o=h)===s){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==i);if(!n)return null;if(s===o)return n.prev;var l,c=n,u=n.x,d=n.y,_=1/0;for(r=n.next;r!==c;)s>=r.x&&r.x>=u&&s!==r.x&&t.pointInTriangle(a<d?s:o,a,u,d,a<d?o:s,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(s-r.x))<_||l===_&&r.x>n.x)&&t.locallyInside(r,e)&&(n=r,_=l),r=r.next;return n},t.indexCurve=function(e,i,n,r){for(var s=e;null===s.z&&(s.z=t.zOrder(s.x,s.y,i,n,r)),s.prevZ=s.prev,s.nextZ=s.next,(s=s.next)!==e;);s.prevZ.nextZ=null,s.prevZ=null,t.sortLinked(s)},t.sortLinked=function(t){var e,i,n,r,s,a,o,h,l=1;do{for(i=t,s=t=null,a=0;i;){for(a++,n=i,e=o=0;e<l&&(o++,n=n.nextZ);e++);for(h=l;0<o||0<h&&n;)0!==o&&(0===h||!n||i.z<=n.z)?(i=(r=i).nextZ,o--):(n=(r=n).nextZ,h--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,l*=2}while(1<a);return t},t.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},t.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},t.pointInTriangle=function(t,e,i,n,r,s,a,o){return 0<=(r-a)*(e-o)-(t-a)*(s-o)&&0<=(t-a)*(n-o)-(i-a)*(e-o)&&0<=(i-a)*(s-o)-(r-a)*(n-o)},t.isValidDiagonal=function(e,i){return e.next.i!==i.i&&e.prev.i!==i.i&&!t.intersectsPolygon(e,i)&&t.locallyInside(e,i)&&t.locallyInside(i,e)&&t.middleInside(e,i)},t.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},t.equals=function(t,e){return t.x===e.x&&t.y===e.y},t.intersects=function(e,i,n,r){return!!(t.equals(e,i)&&t.equals(n,r)||t.equals(e,r)&&t.equals(n,i))||0<t.area(e,i,n)!=0<t.area(e,i,r)&&0<t.area(n,r,e)!=0<t.area(n,r,i)},t.intersectsPolygon=function(e,i){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&t.intersects(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1},t.locallyInside=function(e,i){return t.area(e.prev,e,e.next)<0?0<=t.area(e,i,e.next)&&0<=t.area(e,e.prev,i):t.area(e,i,e.prev)<0||t.area(e,e.next,i)<0},t.middleInside=function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n},t.splitPolygon=function(t,e){var i=new rt(t.i,t.x,t.y),n=new rt(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n},t.insertNode=function(t,e,i,n){var r=new rt(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r},t.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},t.signedArea=function(t,e,i,n){for(var r=0,s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r},t}(),rt=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return r(t,"laya.webgl.shapes.EarcutNode"),t}(),st=(function(){function t(t,e,i,n,r,s,a){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=n,this.fillAlpha=r,this.shape=a,this.fill=s}r(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null}}(),function(){function t(t){t instanceof Float32Array?this.points=t:t instanceof Array&&(t.length,this.points=new Float32Array(t))}r(t,"laya.webgl.shapes.Vertex");var e=t.prototype;i.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.needUpdate=function(t){return!1},e.rebuild=function(t){},e.setMatrix=function(t){}}(),function(){function t(t){void 0===t&&(t=1e4),this._renderType=t}r(t,"laya.webgl.submit.Submit");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=t._cache;(e[e._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},e.getRenderType=function(){return this._renderType},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e,t.alphaTexture&&t.alphaTexture.source&&(this.shaderValue.texture1=t.alphaTexture.source)}this._vb.bind_upload(this._ib);var i=xt.mainContext;return this.shaderValue.upload(),z.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),z.activeBlendFunction=this._blendFn),D.drawCall++,D.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},t.__init__=function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new Tt(0,0),e.shaderValue.ALPHA=-1234},t.createSubmit=function(e,i,n,r,s){var a=t._cache._length?t._cache[--t._cache._length]:new t;null==n&&((n=a._selfVb||(a._selfVb=$t.create(-1))).clear(),r=0),a._ib=i,a._vb=n,a._startIdx=r*pt.BYTES_PIDX,a._numEle=0;var o=e._nBlendType;a._blendFn=e._targets?z.targetFns[o]:z.fns[o],a.shaderValue=s,a.shaderValue.setValue(e._shader2D);var h=e._shader2D.filters;return h&&a.shaderValue.setFilters(h),a},t.createShape=function(e,i,n,r,s,a){var o=t._cache._length?t._cache[--t._cache._length]:new t;o._ib=i,o._vb=n,o._numEle=r,o._startIdx=s,o.shaderValue=a,o.shaderValue.setValue(e._shader2D);var h=e._nBlendType;return o._blendFn=e._targets?z.targetFns[h]:z.fns[h],o},t.TYPE_2D=1e4,t.TYPE_CANVAS=10003,t.TYPE_CMDSETRT=10004,t.TYPE_CUSTOM=10005,t.TYPE_BLURRT=10006,t.TYPE_CMDDESTORYPRERT=10007,t.TYPE_DISABLESTENCIL=10008,t.TYPE_OTHERIBVB=10009,t.TYPE_PRIMITIVE=10010,t.TYPE_RT=10011,t.TYPE_BLUR_RT=10012,t.TYPE_TARGET=10013,t.TYPE_CHANGE_VALUE=10014,t.TYPE_SHAPE=10015,t.TYPE_TEXTURE=10016,t.TYPE_FILLTEXTURE=10017,t.RENDERBASE=null,t._cache=((t._cache=[])._length=0,t._cache),t}()),at=function(){function t(){this.fun=null,this.args=null}r(t,"laya.webgl.submit.SubmitCMD");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){return this.fun.apply(null,this.args),1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},t.create=function(e,i){var n=t._cache._length?t._cache[--t._cache._length]:new t;return n.fun=i,n.args=e,n},t._cache=((t._cache=[])._length=0,t._cache),t}(),ot=function(){function t(){this.variables={}}r(t,"laya.webgl.submit.SubmitCMDScope");var e=t.prototype;return e.getValue=function(t){return this.variables[t]},e.addValue=function(t,e){return this.variables[t]=e},e.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},e.clear=function(){for(var t in this.variables)delete this.variables[t]},e.recycle=function(){this.clear(),t.POOL.push(this)},t.create=function(){var e=t.POOL.pop();return e||(e=new t),e},t.POOL=[],t}(),ht=function(){function t(){this.offset=0,this.startIndex=0,this._mat=x.create()}r(t,"laya.webgl.submit.SubmitOtherIBVB");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=t._cache;(e[e._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},e.getRenderType=function(){return 10009},e.renderSubmit=function(){var e=this._shaderValue.textureHost;if(e){var i=e.source;if(!e.bitmap||!i)return 1;this._shaderValue.texture=i}this._vb.bind_upload(this._ib);var n=vt.worldMatrix4,r=x.TEMP;x.mulPre(this._mat,n[0],n[1],n[4],n[5],n[12],n[13],r);var s=vt.worldMatrix4=t.tempMatrix4;s[0]=r.a,s[1]=r.b,s[4]=r.c,s[5]=r.d,s[12]=r.tx,s[13]=r.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var a=xt.mainContext;return z.activeBlendFunction!==this._blendFn&&(a.enable(3042),this._blendFn(a),z.activeBlendFunction=this._blendFn),D.drawCall++,D.trianglesFaces+=this._numEle/3,a.drawElements(4,this._numEle,5123,this.startIndex),vt.worldMatrix4=n,Bt.activeShader=null,1},t.create=function(e,i,n,r,s,a,o,h,l){void 0===l&&(l=0);var c=t._cache._length?t._cache[--t._cache._length]:new t;c._ib=n,c._vb=i,c._numEle=r,c._shader=s,c._shaderValue=a;var u=e._nBlendType;switch(c._blendFn=e._targets?z.targetFns[u]:z.fns[u],l){case 0:c.offset=0,c.startIndex=h/(pt.BYTES_PE*i.vertexStride)*1.5,c.startIndex*=pt.BYTES_PIDX;break;case 1:c.startIndex=o,c.offset=h}return c},t._cache=((t._cache=[])._length=0,t._cache),t.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t}(),lt=function(){function t(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new b,this.screenRect=new b}r(t,"laya.webgl.submit.SubmitScissor");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e._scissor=function(t,e,i,n){var r=vt.worldMatrix4,s=r[0],a=r[5],o=r[12],h=r[13];if(n*=a,(i*=s)<1||n<1)return!1;var l=(t=t*s+o)+i,c=(e=e*a+h)+n;t<0&&(i=l-(t=0)),e<0&&(n=c-(e=0));var u=vt.worldClipRect;if(t=Math.max(t,u.x),e=Math.max(e,u.y),i=Math.min(l,u.right)-t,n=Math.min(c,u.bottom)-e,i<1||n<1)return!1;var d=vt.worldScissorTest;return this.screenRect.copyFrom(u),u.x=t,u.y=e,u.width=i,u.height=n,vt.worldScissorTest=!0,e=vt.height-e-n,xt.mainContext.scissor(t,e,i,n),xt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),d?(e=vt.height-this.screenRect.y-this.screenRect.height,xt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),xt.mainContext.enable(3089)):(xt.mainContext.disable(3089),vt.worldScissorTest=!1),u.copyFrom(this.screenRect),!0},e._scissorWithTagart=function(t,e,i,n){if(i<1||n<1)return!1;var r=t+i,s=e+n;t<0&&(i=r-(t=0)),e<0&&(n=s-(e=0));var a=vt.worldClipRect;if(t=Math.max(t,a.x),e=Math.max(e,a.y),i=Math.min(r,a.right)-t,n=Math.min(s,a.bottom)-e,i<1||n<1)return!1;var o=vt.worldScissorTest;return this.screenRect.copyFrom(a),vt.worldScissorTest=!0,a.x=t,a.y=e,a.width=i,a.height=n,e=vt.height-e-n,xt.mainContext.scissor(t,e,i,n),xt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(e=vt.height-this.screenRect.y-this.screenRect.height,xt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),xt.mainContext.enable(3089)):(xt.mainContext.disable(3089),vt.worldScissorTest=!1),a.copyFrom(this.screenRect),!0},e.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;(e[e._length++]=this).context=null},t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;return i.context=e,i},t._cache=((t._cache=[])._length=0,t._cache),t}(),ct=function(){function t(){this.step=0,this.blendMode=null,this.level=0}r(t,"laya.webgl.submit.SubmitStencil");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},e.do1=function(){var t=xt.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},e.do2=function(){var t=xt.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do3=function(){var t=xt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},e.do4=function(){var t=xt.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},e.do5=function(){var t=xt.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do6=function(){var t=xt.mainContext;z.targetFns[z.TOINT[this.blendMode]](t)},e.do7=function(){var t=xt.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},e.do8=function(){var t=xt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},t.restore=function(e,i,n,r,s){var a;if((e._renderKey=0)<t._mask&&t._mask--,0==t._mask)a=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(a),e._curSubmit=st.RENDERBASE;else{a=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(a);var o=e._vb;if(o._byteLength,mt.fillRectImgVb(o,null,i.x,i.y,i.width,i.height,L.DEF_UV,n,r,s,0,0)){e._shader2D.glTexture=null;var h=e._curSubmit=st.createSubmit(e,e._ib,o,(o._byteLength-64)/32*3,Tt.create(2,0));h.shaderValue.ALPHA=1,e._submits[e._submits._length++]=h,e._curSubmit._numEle+=6,e._curSubmit=st.RENDERBASE}else alert("clipRect calc stencil rect error");a=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(a)}},t.restore2=function(e,i){var n;(e._renderKey=0)<t._mask&&t._mask--,0==t._mask?(n=laya.webgl.submit.SubmitStencil.create(3),e.addRenderObject(n),e._curSubmit=st.RENDERBASE):(n=laya.webgl.submit.SubmitStencil.create(7),e.addRenderObject(n),e._submits[e._submits._length++]=i,n=laya.webgl.submit.SubmitStencil.create(8),e.addRenderObject(n))},t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;return 5==(i.step=e)&&++t._mask,i.level=t._mask,i},t._cache=((t._cache=[])._length=0,t._cache),t._mask=0,t}(),ut=function(){function t(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}r(t,"laya.webgl.submit.SubmitTarget");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),D.drawCall++,D.trianglesFaces+=this._numEle/3,xt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},e.blend=function(){if(z.activeBlendFunction!==z.fns[this.blendType]){var t=xt.mainContext;t.enable(3042),z.fns[this.blendType](t),z.activeBlendFunction=z.fns[this.blendType]}},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;(e[e._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},t.create=function(e,i,n,r,s,a){var o=t._cache._length?t._cache[--t._cache._length]:new t;return o._ib=i,o._vb=n,o.proName=a,o._startIdx=r*pt.BYTES_PIDX,o._numEle=0,o.blendType=e._nBlendType,o.shaderValue=s,o.shaderValue.setValue(e._shader2D),o},t._cache=((t._cache=[])._length=0,t._cache),t}(),dt=function(){function t(){this._sourceStr=null}r(t,"laya.webgl.text.CharSegment");var e=t.prototype;return i.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),_t=function(){var t;function e(){}return r(e,"laya.webgl.text.DrawText"),e.__init__=function(){e._charsTemp=new Array,e._drawValue=new t,e._charSeg=new dt},e.customCharSeg=function(t){e._charSeg=t},e.getChar=function(t,i,n){var r=Yt.createOneChar(t,n);return-1!=i&&(e._charsCache[i]=r),r},e._drawSlow=function(t,i,n,r,s,a,o,h,l,c,u,d,_,f,p){var m,g,v=e._drawValue.value(a,h,l,c,_,f,p),y=0,x=0,w=e._charsTemp,b=0,S=NaN;if(r)for(w.length=r.length,y=0,x=r.length;y<x;y++)(g=r[y])&&(S=g.charNum+v.txtID,w[y]=m=e._charsCache[S]||e.getChar(g.char,S,v),m.active());else{var T=n instanceof laya.utils.WordText?n.toString():n;if(N.CharacterCache){e._charSeg.textToSpit(T);var C=e._charSeg.length();for(y=0,x=w.length=C;y<x;y++)S=e._charSeg.getCharCode(y)+v.txtID,w[y]=m=e._charsCache[S]||e.getChar(e._charSeg.getChar(y),S,v),m.active(),b+=m.cw}else w.length=0,(m=e.getChar(T,-1,v)).active(),b+=m.cw,w[0]=m}var M=0;null!==o&&"left"!==o&&(M=-("center"==o?b/2:b));var I,E,A=NaN,D=0;if(r)for(y=0,x=w.length;y<x;y++)m=w[y],g=r[y],m&&g&&!m.isSpace&&(A=m.borderSize,I=m.texture,i._drawText(I,u+M+g.x*_-A,d+g.y*f-A,I.width,I.height,s,0,0,0,0));else{for(y=0,x=w.length;y<x;y++)(m=w[y])&&!m.isSpace&&(A=m.borderSize,I=m.texture,i._drawText(I,u+M-A,d-A,I.width,I.height,s,0,0,0,0),t&&((E=t[D++])||(E=t[D-1]=[]),E[0]=I,E[1]=M-A,E[2]=-A)),M+=m.cw;t&&(t.length=D)}},e._drawFast=function(t,e,i,n,r){for(var s,a,o=0,h=t.length;o<h;o++)(s=(a=t[o])[0]).active(),e._drawText(s,n+a[1],r+a[2],s.width,s.height,i,0,0,0,0)},e.drawText=function(t,n,r,s,a,o,h,l,c,u,d,f){if(void 0===f&&(f=0),!(n&&0===n.length||r&&0===r.length)){var p=s.a,m=s.d;(0!==s.b||0!==s.c)&&(p=m=1);var g=1!==p||1!==m;if(g&&i.stage.transform){var v=i.stage.transform;g=v.a===p&&v.d===m}else g=!1;if(g){var y=(s=s.copyTo(St._tmpMatrix)).tx,x=s.ty;s.scale(1/p,1/m),s._checkTransform(),u*=p,d*=m,u+=y-s.tx,d+=x-s.ty}else p=m=1;if(r)e._drawSlow(null,t,n,r,s,a,o,h,l,c,u,d,p,m,f);else{if(null===n.toUpperCase){var w=p+1e5*m,b=n;return void(b.changed||b.id!==w?(b.id=w,b.changed=!1,e._drawSlow(b.save,t,n,r,s,a,o,h,l,c,u,d,p,m,f)):e._drawFast(b.save,t,s,u,d))}var S=n+a.toString()+h+l+c+p+m+o,T=e._textsCache[S];N.CharacterCache?T?e._drawFast(T,t,s,u,d):(e._textsCache.__length||(e._textsCache.__length=0),e._textsCache.__length>_.WebGLTextCacheCount&&((e._textsCache={}).__length=0,e._curPoolIndex=0),e._textCachesPool[e._curPoolIndex]?(T=e._textsCache[S]=e._textCachesPool[e._curPoolIndex]).length=0:e._textCachesPool[e._curPoolIndex]=T=e._textsCache[S]=[],e._textsCache.__length++,e._curPoolIndex++,e._drawSlow(T,t,n,r,s,a,o,h,l,c,u,d,p,m,f)):e._drawSlow(T,t,n,r,s,a,o,h,l,c,u,d,p,m,f)}}},e._charsTemp=null,e._textCachesPool=[],e._curPoolIndex=0,e._charsCache={},e._textsCache={},e._drawValue=null,e.d=[],e._charSeg=null,e.__init$=function(){t=function(){function t(){}return r(t,""),t.prototype.value=function(e,i,n,r,s,a,o){this.font=e,this.fillColor=i,this.borderColor=n,this.lineWidth=r,this.scaleX=s,this.scaleY=a,this.underLine=o;var h=e.toString()+s+a+r+(i?i.toLowerCase():" ")+(n?n.toLowerCase():" ")+o;return this.txtID=t._keymap[h],this.txtID||(this.txtID=1e-7*++t._keymapCount,t._keymap[h]=this.txtID),this},t.clear=function(){t._keymap={},t._keymapCount=1},t._keymap={},t._keymapCount=1,t}()},e}(),ft=function(){function t(e){this._index=0,this._size=14,this._italic=-2,t._cache2=t._cache2||[],this.setFont(e||"14px Arial")}r(t,"laya.webgl.text.FontInContext");var e=t.prototype;return e.setFont=function(e){var i=t._cache2[e];if(i)this._words=i[0],this._size=i[1];else{this._words=e.split(" ");for(var n=0,r=this._words.length;n<r;n++)if(0<this._words[n].indexOf("px")){this._index=n;break}this._size=parseInt(this._words[this._index]),t._cache2[e]=[this._words,this._size]}this._text=null,this._italic=-2},e.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},e.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},e.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},e.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},e.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},s(0,e,"size",(function(){return this._size}),(function(t){this._size=t,this._words[this._index]=t+"px",this._text=null})),t.create=function(e){var i=t._cache[e];return i||(t._cache[e]=new t(e))},t.EMPTY=new t,t._cache={},t._cache2=null,t}(),pt=function(){function t(){}return r(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,n(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),mt=function(){function t(){}return r(t,"laya.webgl.utils.GlUtils"),t.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},t.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),n=0,r=0;r<e;r++)i[n++]=4*r,i[n++]=4*r+2,i[n++]=4*r+1,i[n++]=4*r,i[n++]=4*r+3,i[n++]=4*r+2;return t.setNeedUpload(),!0},t.expandIBQuadrangle=function(e,i){e.bufferLength>=6*i*2||t.fillIBQuadrangle(e,i)},t.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},t.fillQuadrangleImgVb=function(t,e,i,n,r,s,a,o){var h=16+(t._byteLength>>2);t.byteLength=h<<2;var l=t.getFloat32Array();l[2+(h-=16)]=r[0],l[h+3]=r[1],l[h+6]=r[2],l[h+7]=r[3],l[h+10]=r[4],l[h+11]=r[5],l[h+14]=r[6],l[h+15]=r[7];var c=s.a,u=s.b,d=s.c,_=s.d;if(1!==c||0!==u||0!==d||1!==_){s.bTransform=!0;var f=s.tx+a,p=s.ty+o;l[h]=(n[0]+e)*c+(n[1]+i)*d+f,l[h+1]=(n[0]+e)*u+(n[1]+i)*_+p,l[h+4]=(n[2]+e)*c+(n[3]+i)*d+f,l[h+5]=(n[2]+e)*u+(n[3]+i)*_+p,l[h+8]=(n[4]+e)*c+(n[5]+i)*d+f,l[h+9]=(n[4]+e)*u+(n[5]+i)*_+p,l[h+12]=(n[6]+e)*c+(n[7]+i)*d+f,l[h+13]=(n[6]+e)*u+(n[7]+i)*_+p}else s.bTransform=!1,e+=s.tx+a,i+=s.ty+o,l[h]=e+n[0],l[h+1]=i+n[1],l[h+4]=e+n[2],l[h+5]=i+n[3],l[h+8]=e+n[4],l[h+9]=i+n[5],l[h+12]=e+n[6],l[h+13]=i+n[7];return t._upload=!0},t.fillTranglesVB=function(t,e,i,n,r,s,a){var o=(t._byteLength>>2)+n.length;t.byteLength=o<<2;var h=t.getFloat32Array();o-=n.length;for(var l=n.length,c=r.a,u=r.b,d=r.c,_=r.d,f=0;f<l;f+=4)if(h[o+f+2]=n[f+2],h[o+f+3]=n[f+3],1!==c||0!==u||0!==d||1!==_){r.bTransform=!0;var p=r.tx+s,m=r.ty+a;h[o+f]=(n[f]+e)*c+(n[f+1]+i)*d+p,h[o+f+1]=(n[f]+e)*u+(n[f+1]+i)*_+m}else r.bTransform=!1,e+=r.tx+s,i+=r.ty+a,h[o+f]=e+n[f],h[o+f+1]=i+n[f+1];return t._upload=!0},t.copyPreImgVb=function(t,e,i){var n=t._byteLength>>2;t.byteLength=n+16<<2;for(var r=t.getFloat32Array(),s=0,a=n-16;s<4;s++)r[n]=r[a]+e,++a,r[++n]=r[a]+i,++a,r[++n]=r[a],++a,r[++n]=r[a],++n,++a;t._upload=!0},t.fillRectImgVb=function(t,e,i,n,r,s,a,o,h,l,c,u,d){void 0===d&&(d=!1);var _,f,p,m,g,v,y,x,w,b,S,T,C,M,I,E,A=1,D=o.a,P=o.b,R=o.c,N=o.d,L=e&&e.width<99999999;if(1!==D||0!==P||0!==R||1!==N?(o.bTransform=!0,0===P&&0===R&&(A=23,w=r+i,b=s+n,_=D*i+(S=o.tx+h),p=D*w+S,f=N*n+(T=o.ty+l),m=N*b+T)):(A=23,o.bTransform=!1,p=(_=i+o.tx+h)+r,m=(f=n+o.ty+l)+s),L&&(g=e.x,v=e.y,y=e.width+g,x=e.height+v),1!==A){if(Math.min(_,p)>=y)return!1;if(Math.min(f,m)>=x)return!1;if(Math.max(p,_)<=g)return!1;if(Math.max(m,f)<=v)return!1}var B=t._byteLength>>2;t.byteLength=16+B<<2;var O=t.getFloat32Array();switch(O[2+B]=a[0],O[3+B]=a[1],O[6+B]=a[2],O[7+B]=a[3],O[10+B]=a[4],O[11+B]=a[5],O[14+B]=a[6],O[15+B]=a[7],A){case 1:S=o.tx+h,T=o.ty+l;var F=D*i,k=R*n,V=N*n,U=P*i,H=D*(w=r+i),z=R*(b=s+n),W=N*b,G=P*w;d?(C=F+k+S,I=Math.round(C)-C,M=V+U+T,E=Math.round(M)-M,O[B]=C+I,O[1+B]=M+E,O[4+B]=H+k+S+I,O[5+B]=V+G+T+E,O[8+B]=H+z+S+I,O[9+B]=W+G+T+E,O[12+B]=F+z+S+I,O[13+B]=W+U+T+E):(O[B]=F+k+S,O[1+B]=V+U+T,O[4+B]=H+k+S,O[5+B]=V+G+T,O[8+B]=H+z+S,O[9+B]=W+G+T,O[12+B]=F+z+S,O[13+B]=W+U+T);break;case 23:d?(C=_+c,I=Math.round(C)-C,M=f,E=Math.round(M)-M,O[B]=C+I,O[1+B]=M+E,O[4+B]=p+c+I,O[5+B]=f+E,O[8+B]=p+I,O[9+B]=m+E,O[12+B]=_+I,O[13+B]=m+E):(O[B]=_+c,O[1+B]=f,O[4+B]=p+c,O[5+B]=f,O[8+B]=p,O[9+B]=m,O[12+B]=_,O[13+B]=m)}return t._upload=!0},t.fillLineVb=function(e,i,n,r,s,a,o,h){var l=.5*o,c=t._fillLineArray,u=-(r-a),d=n-s,_=Math.sqrt(u*u+d*d);u/=_,d/=_,u*=l,d*=l,c[0]=n-u,c[1]=r-d,c[4]=n+u,c[5]=r+d,c[8]=s+u,c[9]=a+d,c[12]=s-u,c[13]=a-d,h&&h.transformPointArray(c,c);var f=16+(e._byteLength>>2);return e.byteLength=f<<2,e.insertData(c,f-16),!0},t._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t}(),gt=(function(){function t(){}r(t,"laya.webgl.utils.MatirxArray"),t.ArrayMul=function(e,i,n){if(e)if(i)for(var r=NaN,s=NaN,a=NaN,o=NaN,h=0;h<4;h++)r=e[h],s=e[h+4],a=e[h+8],o=e[h+12],n[h]=r*i[0]+s*i[1]+a*i[2]+o*i[3],n[h+4]=r*i[4]+s*i[5]+a*i[6]+o*i[7],n[h+8]=r*i[8]+s*i[9]+a*i[10]+o*i[11],n[h+12]=r*i[12]+s*i[13]+a*i[14]+o*i[15];else t.copyArray(e,n);else t.copyArray(i,n)},t.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function t(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new $t(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new Jt,i&&this._ib._resizeBuffer(i,!1)}r(t,"laya.webgl.utils.Mesh2D");var e=t.prototype;return e.cloneWithNewVB=function(){var e=new t(this._stride,0,0);return e._ib=this._ib,e._quadNum=this._quadNum,e._attribInfo=this._attribInfo,e},e.cloneWithNewVBIB=function(){var e=new t(this._stride,0,0);return e._attribInfo=this._attribInfo,e},e.getVBW=function(){return this._vb.setNeedUpload(),this._vb},e.getVBR=function(){return this._vb},e.getIBR=function(){return this._ib},e.getIBW=function(){return this._ib.setNeedUpload(),this._ib},e.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,n=0,r=0;r<t;r++)e[i++]=n,e[i++]=n+2,e[i++]=n+1,e[i++]=n,e[i++]=n+3,e[i++]=n+2,n+=4;this._ib.setNeedUpload()},e.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},e.getEleNum=function(){return this._ib.getBuffer().byteLength/2},e.releaseMesh=function(){},e.destroy=function(){},e.clearVB=function(){this._vb.clear()},t._gvaoid=0,t}()),vt=function(){function t(){}return r(t,"laya.webgl.utils.RenderState2D"),t.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.mat2MatArray=function(e,i){var n=e,r=i;return r[0]=n.a,r[1]=n.b,r[2]=t.EMPTYMAT4_ARRAY[2],r[3]=t.EMPTYMAT4_ARRAY[3],r[4]=n.c,r[5]=n.d,r[6]=t.EMPTYMAT4_ARRAY[6],r[7]=t.EMPTYMAT4_ARRAY[7],r[8]=t.EMPTYMAT4_ARRAY[8],r[9]=t.EMPTYMAT4_ARRAY[9],r[10]=t.EMPTYMAT4_ARRAY[10],r[11]=t.EMPTYMAT4_ARRAY[11],r[12]=n.tx,r[13]=n.ty,r[14]=t.EMPTYMAT4_ARRAY[14],r[15]=t.EMPTYMAT4_ARRAY[15],i},t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1,t.TEMPMAT4_ARRAY[1]=0,t.TEMPMAT4_ARRAY[4]=0,t.TEMPMAT4_ARRAY[5]=1,t.TEMPMAT4_ARRAY[12]=0,t.TEMPMAT4_ARRAY[13]=0},t.clear=function(){t.worldScissorTest=!1,t.worldShaderDefines=null,t.worldFilters=null,t.worldAlpha=1,t.worldClipRect.x=t.worldClipRect.y=0,t.worldClipRect.width=t.width,t.worldClipRect.height=t.height,t.curRenderTarget=null},t._MAXSIZE=99999999,t.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldMatrix4=t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldAlpha=1,t.worldScissorTest=!1,t.worldFilters=null,t.worldShaderDefines=null,t.curRenderTarget=null,t.width=0,t.height=0,n(t,["worldMatrix",function(){return this.worldMatrix=new x},"worldClipRect",function(){return this.worldClipRect=new b(0,0,99999999,99999999)}]),t}(),yt=function(){var t,e;function i(e,i,n,r,s){var a=this;function o(e){var i=[],n=new t(i);return a._compileToTree(n,e.split("\n"),0,i,s),n}var h=c.now();this._VS=o(i),this._PS=o(n),this._nameMap=r,2<c.now()-h&&console.log("ShaderCompile use time:"+(c.now()-h)+"  size:"+i.length+"/"+n.length)}r(i,"laya.webgl.utils.ShaderCompile");var s=i.prototype;return s._compileToTree=function(e,n,r,s,a){var o,h,l,c,u,d,_,f=0,p=0,m=0,g=0;for(p=r;p<n.length;p++)if(!((l=n[p]).length<1)&&0!==(f=l.indexOf("//"))){if(0<=f&&(l=l.substr(0,f)),o=_||new t(s),_=null,o.text=l,o.noCompile=!0,0<=(f=l.indexOf("#"))){for(c="#",g=f+1,m=l.length;g<m;g++){var v=l.charAt(g);if(" "===v||"\t"===v||"\r"===v||"\n"===v||"?"===v)break;c+=v}switch(o.name=c){case"#ifdef":case"#ifndef":if(o.src=l,o.noCompile=null!=l.match(/[!&|()=<>]/),o.noCompile?console.log("function():Boolean{return "+l.substr(f+o.name.length)+"}"):(d=l.replace(/^\s*/,"").split(/\s+/),o.setCondition(d[1],"#ifdef"===c?1:2),o.text="//"+o.text),o.setParent(e),e=o,a)for(d=l.substr(g).split(i._splitToWordExps3),g=0;g<d.length;g++)(l=d[g]).length&&(a[l]=!0);continue;case"#if":if(o.src=l,o.noCompile=!0,o.setParent(e),e=o,a)for(d=l.substr(g).split(i._splitToWordExps3),g=0;g<d.length;g++)(l=d[g]).length&&"defined"!=l&&(a[l]=!0);continue;case"#else":o.src=l,h=(e=e.parent).childs[e.childs.length-1],o.noCompile=h.noCompile,o.noCompile||(o.condition=h.condition,o.conditionType=1==h.conditionType?2:1,o.text="//"+o.text+" "+h.text+" "+o.conditionType),o.setParent(e),e=o;continue;case"#endif":h=(e=e.parent).childs[e.childs.length-1],o.noCompile=h.noCompile,o.noCompile||(o.text="//"+o.text),o.setParent(e);continue;case"#include":d=i.splitToWords(l,null);var y=i.includes[d[1]];if(!y)throw"ShaderCompile error no this include file:"+d[1];if((f=d[0].indexOf("?"))<0){o.setParent(e),l=y.getWith("with"==d[2]?d[3]:null),this._compileToTree(o,l.split("\n"),0,s,a),o.text="";continue}o.setCondition(d[0].substr(f+1),1),o.text=y.getWith("with"==d[2]?d[3]:null);break;case"#import":u=(d=i.splitToWords(l,null))[1],s.push({node:o,file:i.includes[u],ofs:o.text.length});continue}}else{if((h=e.childs[e.childs.length-1])&&!h.name){0<s.length&&i.splitToWords(l,h),_=o,h.text+="\n"+l;continue}0<s.length&&i.splitToWords(l,o)}o.setParent(e)}},s.createShader=function(t,e,i){var n={},r="";if(t)for(var s in t)r+="#define "+s+"\n",n[s]=!0;var a=this._VS.toscript(n,[]),o=this._PS.toscript(n,[]);return(i||Kt.create)(r+a.join("\n"),r+o.join("\n"),e,this._nameMap)},i._parseOne=function(t,e,n,r,s,a){var o={type:i.shaderParamsMap[n[r+1]],name:n[r+2],size:isNaN(parseInt(n[r+3]))?1:parseInt(n[r+3])};return a&&("attribute"==s?t.push(o):e.push(o)),":"==n[r+3]&&(o.type=n[r+4],r+=2),r+2},i.addInclude=function(t,n){if(!n||0===n.length)throw new Error("add shader include file err:"+t);if(i.includes[t])throw new Error("add shader include file err, has add:"+t);i.includes[t]=new e(n)},i.preGetParams=function(t,e){var n=[t,e],r={},s=[],a=[],o={},h=[];r.attributes=s,r.uniforms=a,r.defines=o;for(var l=0,c=0,u=0;u<2;u++){n[u]=n[u].replace(i._removeAnnotation,"");var d,_=n[u].match(i._reg);for(l=0,c=_.length;l<c;l++){var f=_[l];if("attribute"==f||"uniform"==f)l=i._parseOne(s,a,_,l,f,!0);else{if("#define"==f){h[f=_[++l]]=1;continue}if("#ifdef"==f)for(o[d=_[++l]]=o[d]||[],l++;l<c;l++)if("attribute"==(f=_[l])||"uniform"==f)l=i._parseOne(s,a,_,l,f,h[d]);else if("#else"==f)for(l++;l<c;l++)if("attribute"==(f=_[l])||"uniform"==f)l=i._parseOne(s,a,_,l,f,!h[d]);else if("#endif"==f)break}}}return r},i.splitToWords=function(t,e){for(var i,n,r=[],s=-1,a=0,o=t.length;a<o;a++)if(i=t.charAt(a),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=s&&1<a-s&&(n=t.substr(s,a-s),r.push(n)),'"'==i||"'"==i){var h=t.indexOf(i,a+1);if(h<0)throw"Sharder err:"+t;r.push(t.substr(a+1,h-a-1)),a=h,s=-1;continue}"("==i&&e&&0<r.length&&(n=r[r.length-1]+";","vec4;main;".indexOf(n)<0&&(e.useFuns+=n)),s=-1}else s<0&&(s=a);return s<o&&1<o-s&&(n=t.substr(s,o-s),r.push(n)),r},i.IFDEF_NO=0,i.IFDEF_YES=1,i.IFDEF_ELSE=2,i.IFDEF_PARENT=3,i._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),i._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),i._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),i.includes={},n(i,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),i.__init$=function(){t=function(){function t(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}r(t,"");var e=t.prototype;return e.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},e.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},e.toscript=function(e,i){return this._toscript(e,i,++t.__id)},e._toscript=function(t,e,i){if(this.childs.length<1&&!this.text)return e;if(e.length,this.condition){var n=!!this.condition.call(t);if(2===this.conditionType&&(n=!n),!n)return e}if(this.text&&e.push(this.text),0<this.childs.length&&this.childs.forEach((function(n,r,s){n._toscript(t,e,i)})),0<this.includefiles.length&&0<this.useFuns.length)for(var r,s=0,a=this.includefiles.length;s<a;s++)this.includefiles[s].curUseID!=i&&0<(r=this.includefiles[s].file.getFunsScript(this.useFuns)).length&&(this.includefiles[s].curUseID=i,e[0]=r+e[0]);return e},t.__id=1,t}(),e=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,n=0,r=0;!((e=t.indexOf("#begin",e))<0);){for(r=e+5;!((r=t.indexOf("#end",r))<0)&&"i"===t.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+t;n=t.indexOf("\n",e);var s=i.splitToWords(t.substr(e,n-e),null);"code"==s[1]?this.codes[s[2]]=t.substr(n+1,r-n-1):"function"==s[1]&&(n=t.indexOf("function",e),n+="function".length,this.funs[s[3]]=t.substr(n+1,r-n-1),this.funnames+=s[3]+";"),e=r+1}}r(t,"");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}()},i}(),xt=function(){function t(){}return r(t,"laya.webgl.WebGL"),t._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},t._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},t._uint16ArraySlice=function(t){var e,i=arguments,n=0,r=0;if(0===i.length)for(n=this.length,e=new Uint16Array(n),r=0;r<n;r++)e[r]=this[r];else if(2===i.length){var s=i[0],a=i[1];if(s<a)for(n=a-s,e=new Uint16Array(n),r=s;r<a;r++)e[r-s]=this[r];else e=new Uint16Array(0)}return e},t.expandContext=function(){var t=f.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,qt.__int__(null),e.setIBVB=function(t,e,i,n,r,s,a,o,h,l){void 0===h&&(h=0),void 0===l&&(l=0),null===i&&(this._ib=this._ib||Jt.QuadrangleIB,i=this._ib,mt.expandIBQuadrangle(i,n._byteLength/64+8)),this._setIBVB(t,e,i,n,r,s,a,o,h,l)},e.fillTrangles=function(t,e,i,n,r){this._curMat=this._curMat||x.create(),this._vb=this._vb||$t.create(),this._ib||(this._ib=Jt.create(),mt.fillIBQuadrangle(this._ib,a/4));var s=this._vb,a=n.length>>4;mt.fillTranglesVB(s,e,i,n,r||this._curMat,0,0),mt.expandIBQuadrangle(this._ib,s._byteLength/64+8);var o=new Tt(1,0);o.textureHost=t;var h=new Qt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");s._vertType=3,this._setIBVB(e,i,this._ib,s,6*a,r,h,o,0,0)}},t.enable=function(){if(c.__init__(),S.isConchApp&&!S.isConchWebGL)return I.skinAniSprite=function(){return new tt},t.expandContext(),!1;if(I.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;n++){try{e=t.getContext(i[n],{stencil:_.isStencil,alpha:_.isAlpha,antialias:_.isAntialias,premultipliedAlpha:_.premultipliedAlpha,preserveDrawingBuffer:_.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null==(t.mainContext=t.mainContext||I.getWebGLContext(S._mainCanvas)))return!1;if(S.isWebGL)return!0;v.create=function(t,e){return new te(t,e)},y.create=function(t,e,i,n,r,s,a){return new jt(t,e,i,n,r,s,a)},S.WebGL=t,S.isWebGL=!0,_t.__init__(),I.createRenderSprite=function(t,e){return new Ct(t,e)},I.createWebGLContext2D=function(t){return new St(t)},I.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},I.createGraphics=function(){return new bt};var e=I.createFilterAction;return I.createFilterAction=e||function(t){return new Mt},I.clear=function(t){vt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=S.context.ctx,i=0==e._submits._length||_.preserveDrawingBuffer?d.create(t)._color:A._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),vt.clear()},I.addToAtlas=function(t,e){void 0===e&&(e=!1);var n=t.bitmap;S.optimizeTextureMemory(t.url,t)?i.__typeof(n,"laya.webgl.resource.IMergeAtlasBitmap")&&n.allowMerageInAtlas&&n.on("recovered",t,t.addTextureToAtlas):n.enableMerageInAtlas=!1},I.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},U._enable(),I.beginFlush=function(){for(var t=U.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var n=t.getAtlaserByIndex(i).texture;n._flashCacheImageNeedFlush&&I.flashFlushImage(n)}},I.drawToCanvas=function(t,e,i,n,r,s){(i<=0||n<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),i|=0,n|=0,r|=0,s|=0;var a=Ot.create(i,n,6408,5121,0,!1);a.start(),a.clear(0,0,0,0),S.context.clear(),T.renders[e]._fun(t,S.context,r,vt.height-n+s),S.context.flush(),a.end();var o=a.getData(0,0,i,n);if(a.recycle(),o.byteLength==i*n*4){var h=new Gt;h._canvas=c.createElement("canvas"),h.size(i,n);var l=h._canvas.getContext("2d");c.canvas.size(i,n);var u=c.context,d=u.createImageData(i,n);return d.data.set(new Uint8ClampedArray(o.buffer)),h._imgData=d,u.putImageData(d,0,0),l.save(),l.translate(0,n),l.scale(1,-1),l.drawImage(c.canvas.source,0,0),l.restore(),h}console.log("drawToCanvas error: w:"+i+",h:"+n+",datalen:"+o.byteLength)},I.createFilterAction=function(t){var e;switch(t){case 32:e=new Mt}return e},I.addTextureToAtlas=function(t){t._uvID++,U._atlasRestore++,t.bitmap.enableMerageInAtlas&&U.instance.addToAtlas(t)},I.getTexturePixels=function(t,e,i,n,r){S.context.ctx.clear();var s=new E;s.graphics.drawTexture(t,-e,-i);var a=Ot.create(n,r);a.start(),a.clear(0,0,0,0),s.render(S.context,0,0),S.context.ctx.flush(),a.end();for(var o=a.getData(0,0,n,r),h=[],l=0,c=r-1;0<=c;c--)for(var u=0;u<n;u++)l=4*(c*n+u),h.push(o[l]),h.push(o[l+1]),h.push(o[l+2]),h.push(o[l+3]);return h},I.skinAniSprite=function(){return new tt},g.create=function(t,e){var i=new Gt;return i._imgData=e,i.flipY=!1,i},p._filterStart=function(t,e,i,n,r){var s=t.getValue("bounds"),a=Ot.create(s.width,s.height);if(a.start(),a.clear(0,0,0,0),t.addValue("src",a),t.addValue("ScissorTest",vt.worldScissorTest),vt.worldScissorTest){var o=new b;o.copyFrom(i.ctx._clipRect),t.addValue("clipRect",o),vt.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},p._filterEnd=function(t,e,i,n,r){var s=t.getValue("bounds");t.getValue("src").end();var a=Ot.create(s.width,s.height);a.start(),a.clear(0,0,0,0),t.addValue("out",a),e._set$P("_filterCache",a),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},p._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){vt.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},p._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},p._endSrc=function(t){t.getValue("src").end()},p._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},p._endOut=function(t){t.getValue("out").end()},p._recycleScope=function(t){t.recycle()},p._filter=function(t,e,i,n){var r=this._next;if(r){var s,a,o=t.filters,h=o.length;if(1==h&&32==o[0].type)return e.ctx.save(),e.ctx.setFilters([o[0]]),r._fun.call(r,t,e,i,n),void e.ctx.restore();var l=ot.create(),c=w.TEMP,u=e.ctx._getTransformMatrix(),d=x.create();u.copyTo(d);var _=0,f=0,m=!1,g=t._$P._filterCache?t._$P._filterCache:null;if(!g||t._repaint){m=t._isHaveGlowFilter(),l.addValue("_isHaveGlowFilter",m),m&&(_=50,f=25),(a=new b).copyFrom(t.getSelfBounds()),a.x+=t.x,a.y+=t.y,a.x-=t.pivotX+4,a.y-=t.pivotY+4;var v=a.x,y=a.y;if(a.width+=_+8,a.height+=_+8,c.x=a.x*d.a+a.y*d.c,c.y=a.y*d.d+a.x*d.b,a.x=c.x,a.y=c.y,c.x=a.width*d.a+a.height*d.c,c.y=a.height*d.d+a.width*d.b,a.width=c.x,a.height=c.y,a.width<=0||a.height<=0)return;g&&g.recycle(),l.addValue("bounds",a);var S=at.create([l,t,e,0,0],p._filterStart);e.addRenderObject(S),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var T=t.x-v+f,C=t.y-y+f;r._fun.call(r,t,e,T,C),S=at.create([l,t,e,0,0],p._filterEnd),e.addRenderObject(S);for(var M=0;M<h;M++)0!=M&&(S=at.create([l],p._useSrc),e.addRenderObject(S),s=Tt.create(1,0),x.TEMP.identity(),e.ctx.drawTarget(l,0,0,a.width,a.height,x.TEMP,"out",s,null,z.TOINT.overlay),S=at.create([l],p._useOut),e.addRenderObject(S)),o[M].action.apply3d(l,t,e,0,0);S=at.create([l,e],p._EndTarget),e.addRenderObject(S)}else{if((m=!!t._$P._isHaveGlowFilter&&t._$P._isHaveGlowFilter)&&(_=50,f=25),(a=t.getBounds()).width<=0||a.height<=0)return;a.width+=_,a.height+=_,c.x=a.x*d.a+a.y*d.c,c.y=a.y*d.d+a.x*d.b,a.x=c.x,a.y=c.y,c.x=a.width*d.a+a.height*d.c,c.y=a.height*d.d+a.width*d.b,a.width=c.x,a.height=c.y,l.addValue("out",g)}i=i-f-t.x,n=n-f-t.y,c.setTo(i,n),d.transformPoint(c),i=c.x+a.x,n=c.y+a.y,s=Tt.create(1,0),x.TEMP.identity(),e.ctx.drawTarget(l,i,n,a.width,a.height,x.TEMP,"out",s,null,z.TOINT.overlay),S=at.create([l],p._recycleScope),e.addRenderObject(S),d.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=t._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=t._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=t._uint8ArraySlice),!0},t.onStageResize=function(e,i){null!=t.mainContext&&(t.mainContext.viewport(0,0,e,i),vt.width=e,vt.height=i)},t.onInvalidGLRes=function(){U.instance.freeAll(),M.releaseContentManagers(!0),t.doNodeRepaint(i.stage),t.mainContext.viewport(0,0,vt.width,vt.height),i.stage.event("devicelost")},t.doNodeRepaint=function(e){0==e.numChildren&&e.repaint();for(var i=0;i<e.numChildren;i++)t.doNodeRepaint(e.getChildAt(i))},t.init=function(e,i,n){t.mainCanvas=e,g._createContext=function(t){return new St(t)},Gt._createContext=function(t){return new St(t)};var r=laya.webgl.WebGL.mainContext;if(null!=r.getShaderPrecisionFormat){var s=r.getShaderPrecisionFormat(35633,36338),a=r.getShaderPrecisionFormat(35632,36338);t.shaderHighPrecision=!(!s.precision||!a.precision)}else t.shaderHighPrecision=!1;if(t.compressAstc=r.getExtension("WEBGL_compressed_texture_astc"),t.compressAtc=r.getExtension("WEBGL_compressed_texture_atc"),t.compressEtc=r.getExtension("WEBGL_compressed_texture_etc"),t.compressEtc1=r.getExtension("WEBGL_compressed_texture_etc1"),t.compressPvrtc=r.getExtension("WEBGL_compressed_texture_pvrtc"),t.compressS3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),t.compressS3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),t.compressAstc=t.compressAstc?t.compressAstc:{},t.compressAtc=t.compressAtc?t.compressAtc:{},t.compressEtc=t.compressEtc?t.compressEtc:{},t.compressEtc1=t.compressEtc1?t.compressEtc1:{},t.compressPvrtc=t.compressPvrtc?t.compressPvrtc:{},t.compressS3tc=t.compressS3tc?t.compressS3tc:{},t.compressS3tc_srgb=t.compressS3tc_srgb?t.compressS3tc_srgb:{},r.deleteTexture1=r.deleteTexture,r.deleteTexture=function(t){t==wt.curBindTexValue&&(wt.curBindTexValue=null),r.deleteTexture1(t)},t.onStageResize(i,n),null==t.mainContext)throw new Error("webGL getContext err!");R.__init__(),U.__init__(),Et.__init__(),st.__init__(),St.__init__(),Tt.__init__(),J.__init__(),qt.__int__(r),z._init_(r),S.isConchApp&&conch.setOnInvalidGLRes(t.onInvalidGLRes)},t.mainCanvas=null,t.antialias=!0,t.shaderHighPrecision=!1,t._bg_null=[0,0,0,0],t}(),wt=function(){function t(){}return r(t,"laya.webgl.WebGLContext"),t.UseProgram=function(e){return t._useProgram!==e&&(xt.mainContext.useProgram(e),t._useProgram=e,!0)},t.setDepthTest=function(e,i){i!==t._depthTest&&((t._depthTest=i)?e.enable(2929):e.disable(2929))},t.setDepthMask=function(e,i){i!==t._depthMask&&(t._depthMask=i,e.depthMask(i))},t.setDepthFunc=function(e,i){i!==t._depthFunc&&(t._depthFunc=i,e.depthFunc(i))},t.setBlend=function(e,i){i!==t._blend&&((t._blend=i)?e.enable(3042):e.disable(3042))},t.setBlendFunc=function(e,i,n){(i!==t._sFactor||n!==t._dFactor)&&(t._sFactor=i,t._dFactor=n,e.blendFunc(i,n))},t.setCullFace=function(e,i){i!==t._cullFace&&((t._cullFace=i)?e.enable(2884):e.disable(2884))},t.setFrontFace=function(e,i){i!==t._frontFace&&(t._frontFace=i,e.frontFace(i))},t.bindTexture=function(e,i,n){e.bindTexture(i,n),t.curBindTexTarget=i,t.curBindTexValue=n},t.DEPTH_BUFFER_BIT=256,t.STENCIL_BUFFER_BIT=1024,t.COLOR_BUFFER_BIT=16384,t.POINTS=0,t.LINES=1,t.LINE_LOOP=2,t.LINE_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6,t.ZERO=0,t.ONE=1,t.SRC_COLOR=768,t.ONE_MINUS_SRC_COLOR=769,t.SRC_ALPHA=770,t.ONE_MINUS_SRC_ALPHA=771,t.DST_ALPHA=772,t.ONE_MINUS_DST_ALPHA=773,t.DST_COLOR=774,t.ONE_MINUS_DST_COLOR=775,t.SRC_ALPHA_SATURATE=776,t.FUNC_ADD=32774,t.BLEND_EQUATION=32777,t.BLEND_EQUATION_RGB=32777,t.BLEND_EQUATION_ALPHA=34877,t.FUNC_SUBTRACT=32778,t.FUNC_REVERSE_SUBTRACT=32779,t.BLEND_DST_RGB=32968,t.BLEND_SRC_RGB=32969,t.BLEND_DST_ALPHA=32970,t.BLEND_SRC_ALPHA=32971,t.CONSTANT_COLOR=32769,t.ONE_MINUS_CONSTANT_COLOR=32770,t.CONSTANT_ALPHA=32771,t.ONE_MINUS_CONSTANT_ALPHA=32772,t.BLEND_COLOR=32773,t.ARRAY_BUFFER=34962,t.ELEMENT_ARRAY_BUFFER=34963,t.ARRAY_BUFFER_BINDING=34964,t.ELEMENT_ARRAY_BUFFER_BINDING=34965,t.STREAM_DRAW=35040,t.STATIC_DRAW=35044,t.DYNAMIC_DRAW=35048,t.BUFFER_SIZE=34660,t.BUFFER_USAGE=34661,t.CURRENT_VERTEX_ATTRIB=34342,t.FRONT=1028,t.BACK=1029,t.CULL_FACE=2884,t.FRONT_AND_BACK=1032,t.BLEND=3042,t.DITHER=3024,t.STENCIL_TEST=2960,t.DEPTH_TEST=2929,t.SCISSOR_TEST=3089,t.POLYGON_OFFSET_FILL=32823,t.SAMPLE_ALPHA_TO_COVERAGE=32926,t.SAMPLE_COVERAGE=32928,t.NO_ERROR=0,t.INVALID_ENUM=1280,t.INVALID_VALUE=1281,t.INVALID_OPERATION=1282,t.OUT_OF_MEMORY=1285,t.CW=2304,t.CCW=2305,t.LINE_WIDTH=2849,t.ALIASED_POINT_SIZE_RANGE=33901,t.ALIASED_LINE_WIDTH_RANGE=33902,t.CULL_FACE_MODE=2885,t.FRONT_FACE=2886,t.DEPTH_RANGE=2928,t.DEPTH_WRITEMASK=2930,t.DEPTH_CLEAR_VALUE=2931,t.DEPTH_FUNC=2932,t.STENCIL_CLEAR_VALUE=2961,t.STENCIL_FUNC=2962,t.STENCIL_FAIL=2964,t.STENCIL_PASS_DEPTH_FAIL=2965,t.STENCIL_PASS_DEPTH_PASS=2966,t.STENCIL_REF=2967,t.STENCIL_VALUE_MASK=2963,t.STENCIL_WRITEMASK=2968,t.STENCIL_BACK_FUNC=34816,t.STENCIL_BACK_FAIL=34817,t.STENCIL_BACK_PASS_DEPTH_FAIL=34818,t.STENCIL_BACK_PASS_DEPTH_PASS=34819,t.STENCIL_BACK_REF=36003,t.STENCIL_BACK_VALUE_MASK=36004,t.STENCIL_BACK_WRITEMASK=36005,t.VIEWPORT=2978,t.SCISSOR_BOX=3088,t.COLOR_CLEAR_VALUE=3106,t.COLOR_WRITEMASK=3107,t.UNPACK_ALIGNMENT=3317,t.PACK_ALIGNMENT=3333,t.MAX_TEXTURE_SIZE=3379,t.MAX_VIEWPORT_DIMS=3386,t.SUBPIXEL_BITS=3408,t.RED_BITS=3410,t.GREEN_BITS=3411,t.BLUE_BITS=3412,t.ALPHA_BITS=3413,t.DEPTH_BITS=3414,t.STENCIL_BITS=3415,t.POLYGON_OFFSET_UNITS=10752,t.POLYGON_OFFSET_FACTOR=32824,t.TEXTURE_BINDING_2D=32873,t.SAMPLE_BUFFERS=32936,t.SAMPLES=32937,t.SAMPLE_COVERAGE_VALUE=32938,t.SAMPLE_COVERAGE_INVERT=32939,t.NUM_COMPRESSED_TEXTURE_FORMATS=34466,t.COMPRESSED_TEXTURE_FORMATS=34467,t.DONT_CARE=4352,t.FASTEST=4353,t.NICEST=4354,t.GENERATE_MIPMAP_HINT=33170,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.DEPTH_COMPONENT=6402,t.ALPHA=6406,t.RGB=6407,t.RGBA=6408,t.LUMINANCE=6409,t.LUMINANCE_ALPHA=6410,t.UNSIGNED_SHORT_4_4_4_4=32819,t.UNSIGNED_SHORT_5_5_5_1=32820,t.UNSIGNED_SHORT_5_6_5=33635,t.FRAGMENT_SHADER=35632,t.VERTEX_SHADER=35633,t.MAX_VERTEX_ATTRIBS=34921,t.MAX_VERTEX_UNIFORM_VECTORS=36347,t.MAX_VARYING_VECTORS=36348,t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,t.MAX_TEXTURE_IMAGE_UNITS=34930,t.MAX_FRAGMENT_UNIFORM_VECTORS=36349,t.SHADER_TYPE=35663,t.DELETE_STATUS=35712,t.LINK_STATUS=35714,t.VALIDATE_STATUS=35715,t.ATTACHED_SHADERS=35717,t.ACTIVE_UNIFORMS=35718,t.ACTIVE_ATTRIBUTES=35721,t.SHADING_LANGUAGE_VERSION=35724,t.CURRENT_PROGRAM=35725,t.NEVER=512,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.NOTEQUAL=517,t.GEQUAL=518,t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.VENDOR=7936,t.RENDERER=7937,t.VERSION=7938,t.NEAREST=9728,t.LINEAR=9729,t.NEAREST_MIPMAP_NEAREST=9984,t.LINEAR_MIPMAP_NEAREST=9985,t.NEAREST_MIPMAP_LINEAR=9986,t.LINEAR_MIPMAP_LINEAR=9987,t.TEXTURE_MAG_FILTER=10240,t.TEXTURE_MIN_FILTER=10241,t.TEXTURE_WRAP_S=10242,t.TEXTURE_WRAP_T=10243,t.TEXTURE_2D=3553,t.TEXTURE=5890,t.TEXTURE_CUBE_MAP=34067,t.TEXTURE_BINDING_CUBE_MAP=34068,t.TEXTURE_CUBE_MAP_POSITIVE_X=34069,t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,t.MAX_CUBE_MAP_TEXTURE_SIZE=34076,t.TEXTURE0=33984,t.TEXTURE1=33985,t.TEXTURE2=33986,t.TEXTURE3=33987,t.TEXTURE4=33988,t.TEXTURE5=33989,t.TEXTURE6=33990,t.TEXTURE7=33991,t.TEXTURE8=33992,t.TEXTURE9=33993,t.TEXTURE10=33994,t.TEXTURE11=33995,t.TEXTURE12=33996,t.TEXTURE13=33997,t.TEXTURE14=33998,t.TEXTURE15=33999,t.TEXTURE16=34e3,t.TEXTURE17=34001,t.TEXTURE18=34002,t.TEXTURE19=34003,t.TEXTURE20=34004,t.TEXTURE21=34005,t.TEXTURE22=34006,t.TEXTURE23=34007,t.TEXTURE24=34008,t.TEXTURE25=34009,t.TEXTURE26=34010,t.TEXTURE27=34011,t.TEXTURE28=34012,t.TEXTURE29=34013,t.TEXTURE30=34014,t.TEXTURE31=34015,t.ACTIVE_TEXTURE=34016,t.REPEAT=10497,t.CLAMP_TO_EDGE=33071,t.MIRRORED_REPEAT=33648,t.FLOAT_VEC2=35664,t.FLOAT_VEC3=35665,t.FLOAT_VEC4=35666,t.INT_VEC2=35667,t.INT_VEC3=35668,t.INT_VEC4=35669,t.BOOL=35670,t.BOOL_VEC2=35671,t.BOOL_VEC3=35672,t.BOOL_VEC4=35673,t.FLOAT_MAT2=35674,t.FLOAT_MAT3=35675,t.FLOAT_MAT4=35676,t.SAMPLER_2D=35678,t.SAMPLER_CUBE=35680,t.VERTEX_ATTRIB_ARRAY_ENABLED=34338,t.VERTEX_ATTRIB_ARRAY_SIZE=34339,t.VERTEX_ATTRIB_ARRAY_STRIDE=34340,t.VERTEX_ATTRIB_ARRAY_TYPE=34341,t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,t.VERTEX_ATTRIB_ARRAY_POINTER=34373,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,t.COMPILE_STATUS=35713,t.LOW_FLOAT=36336,t.MEDIUM_FLOAT=36337,t.HIGH_FLOAT=36338,t.LOW_INT=36339,t.MEDIUM_INT=36340,t.HIGH_INT=36341,t.FRAMEBUFFER=36160,t.RENDERBUFFER=36161,t.RGBA4=32854,t.RGB5_A1=32855,t.RGB565=36194,t.DEPTH_COMPONENT16=33189,t.STENCIL_INDEX=6401,t.STENCIL_INDEX8=36168,t.DEPTH_STENCIL=34041,t.RENDERBUFFER_WIDTH=36162,t.RENDERBUFFER_HEIGHT=36163,t.RENDERBUFFER_INTERNAL_FORMAT=36164,t.RENDERBUFFER_RED_SIZE=36176,t.RENDERBUFFER_GREEN_SIZE=36177,t.RENDERBUFFER_BLUE_SIZE=36178,t.RENDERBUFFER_ALPHA_SIZE=36179,t.RENDERBUFFER_DEPTH_SIZE=36180,t.RENDERBUFFER_STENCIL_SIZE=36181,t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,t.COLOR_ATTACHMENT0=36064,t.DEPTH_ATTACHMENT=36096,t.STENCIL_ATTACHMENT=36128,t.DEPTH_STENCIL_ATTACHMENT=33306,t.NONE=0,t.FRAMEBUFFER_COMPLETE=36053,t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,t.FRAMEBUFFER_UNSUPPORTED=36061,t.FRAMEBUFFER_BINDING=36006,t.RENDERBUFFER_BINDING=36007,t.MAX_RENDERBUFFER_SIZE=34024,t.INVALID_FRAMEBUFFER_OPERATION=1286,t.UNPACK_FLIP_Y_WEBGL=37440,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,t.CONTEXT_LOST_WEBGL=37442,t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,t.BROWSER_DEFAULT_WEBGL=37444,t._useProgram=null,t._depthTest=!0,t._depthMask=!0,t._blend=!1,t._cullFace=!1,t.curBindTexTarget=null,t.curBindTexValue=null,n(t,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),t}(),bt=function(t){function e(){e.__super.call(this)}r(e,"laya.webgl.display.GraphicsGL",m);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(S.context._setShader,[t])},i.setIBVB=function(t,e,i,n,r,s){this._saveToCmd(S.context._setIBVB,[t,e,i,n,r,s])},i.drawParticle=function(t,e,i){var n=I.createParticleTemplate2D(i);n.x=t,n.y=e,this._saveToCmd(S.context._drawParticle,[n])},e}(),St=function(t){var e;function a(t){this._x=0,this._y=0,this._id=++a._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,a.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=a.MAXCLIPRECT,this.mOutPoint,this._canvas=t,this._canvas._addReference(),a._contextcount++,S.isFlash?(this._ib=Jt.create(35044),mt.fillIBQuadrangle(this._ib,16)):this._ib=Jt.QuadrangleIB,this.clear()}r(a,"laya.webgl.canvas.WebGLContext2D",f);var o=a.prototype;return o.setIsMainContext=function(){this._isMain=!0},o.clearBG=function(t,e,i,n){var r=xt.mainContext;r.clearColor(t,e,i,n),r.clear(16384)},o._getSubmits=function(){return this._submits},o._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},o.destroy=function(){--a._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=Jt.QuadrangleIB&&this._ib.releaseResource()},o.clear=function(){this._submits||(this._other=e.DEFAULT,this._curMat=x.create(),this._vb=$t.create(-1),this._submits=[],this._save=[K.Create(this)],this._save.length=10,this._shader2D=new J,this._triangleMesh=Lt.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=e.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=a.MAXCLIPRECT,this._curSubmit=st.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=W.DEFAULT;for(var t=0,i=this._submits._length;t<i;t++)this._submits[t].releaseRender(),this._submits[t]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},o.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,n=this._submits._length;i<n;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0===t&&0===e&&this._releaseMem()},o._getTransformMatrix=function(){return this._curMat},o.translate=function(t,e){0===t&&0===e||(Z.save(this),this._curMat.bTransform&&(q.save(this),this._curMat.transformPointN(w.TEMP.setTo(t,e)),t=w.TEMP.x,e=w.TEMP.y),this._x+=t,this._y+=e)},o.save=function(){this._save[this._save._length++]=K.Create(this)},o.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},o._fillText=function(t,e,i,n,r,s,a,o,h,l){void 0===l&&(l=0);var c=this._shader2D,u=this._curSubmit.shaderValue,_=r?ft.create(r):this._other.font;if(U.enabled)c.ALPHA!==u.ALPHA&&(c.glTexture=null),_t.drawText(this,t,e,this._curMat,_,h||this._other.textAlign,s,a,o,i,n,l);else{this._shader2D.defines.getValue();var f=s?d.create(s)._color:c.colorAdd;c.ALPHA===u.ALPHA&&f===c.colorAdd&&u.colorAdd===c.colorAdd||(c.glTexture=null,c.colorAdd=f),_t.drawText(this,t,e,this._curMat,_,h||this._other.textAlign,s,a,o,i,n,l)}},o.fillWords=function(t,e,i,n,r,s){this._fillText(null,t,e,i,n,r,null,-1,null,s)},o.fillBorderWords=function(t,e,i,n,r,s,a){this._fillBorderText(null,t,e,i,n,r,s,a,null)},o.fillText=function(t,e,i,n,r,s){this._fillText(t,null,e,i,n,r,null,-1,s)},o.strokeText=function(t,e,i,n,r,s,a){this._fillText(t,null,e,i,n,null,r,s||1,a)},o.fillBorderText=function(t,e,i,n,r,s,a,o){this._fillBorderText(t,null,e,i,n,r,s,a,o)},o._fillBorderText=function(t,e,i,n,r,s,o,h,l){if(!U.enabled)return this._fillText(t,e,i,n,r,null,o,h||1,l),void this._fillText(t,e,i,n,r,s,null,-1,l);var c=this._shader2D,u=this._curSubmit.shaderValue;c.ALPHA!==u.ALPHA&&(c.glTexture=null);var d=r?(a._fontTemp.setFont(r),a._fontTemp):this._other.font;_t.drawText(this,t,e,this._curMat,d,l||this._other.textAlign,s,o,h||1,i,n,0)},o.fillRect=function(t,e,i,n,r){var s=this._vb;if(mt.fillRectImgVb(s,this._clipRect,t,e,i,n,L.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var a=this._shader2D.fillStyle;r&&(this._shader2D.fillStyle=W.create(r));var o=this._shader2D,h=this._curSubmit.shaderValue;if(o.fillStyle!==h.fillStyle||o.ALPHA!==h.ALPHA){o.glTexture=null;var l=this._curSubmit=st.createSubmit(this,this._ib,s,(s._byteLength-64)/32*3,Tt.create(2,0));l.shaderValue.color=o.fillStyle._color._color,l.shaderValue.ALPHA=o.ALPHA,this._submits[this._submits._length++]=l}this._curSubmit._numEle+=6,this._shader2D.fillStyle=a}},o.fillTexture=function(t,e,n,r,s,a,o,h){if(t.loaded&&t.bitmap&&t.source){var l=this._vb,c=t.bitmap.width,u=t.bitmap.height,d=t.uv,_=o.x%t.width,f=o.y%t.height;if(c!=h.w||u!=h.h){if(!h.w&&!h.h)switch(h.oy=h.ox=0,a){case"repeat":h.width=r,h.height=s;break;case"repeat-x":h.width=r,f<0?t.height+f>s?h.height=s:h.height=t.height+f:(h.oy=f,t.height+f>s?h.height=s-f:h.height=t.height);break;case"repeat-y":_<0?t.width+_>r?h.width=r:h.width=t.width+_:(h.ox=_,t.width+_>r?h.width=r-_:h.width=t.width),h.height=s;break;case"no-repeat":_<0?t.width+_>r?h.width=r:h.width=t.width+_:(h.ox=_,t.width+_>r?h.width=r-_:h.width=t.width),f<0?t.height+f>s?h.height=s:h.height=t.height+f:(h.oy=f,t.height+f>s?h.height=s-f:h.height=t.height);break;default:h.width=r,h.height=s}h.w=c,h.h=u,h.uv=[0,0,h.width/c,0,h.width/c,h.height/u,0,h.height/u]}if(e+=h.ox,n+=h.oy,_-=h.ox,f-=h.oy,mt.fillRectImgVb(l,this._clipRect,e,n,h.width,h.height,h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var p=Nt.create(this,this._ib,l,(l._byteLength-64)/32*3,Tt.create(256,0)),m=(this._submits[this._submits._length++]=p).shaderValue;m.textureHost=t;var g=d[0]*c,v=d[1]*u,y=(d[2]-d[0])*c,x=(d[5]-d[3])*u,w=-_/c,b=-f/u;m.u_TexRange[0]=g/c,m.u_TexRange[1]=y/c,m.u_TexRange[2]=v/u,m.u_TexRange[3]=x/u,m.u_offset[0]=w,m.u_offset[1]=b,U.enabled&&!this._isMain&&p.addTexture(t,(l._byteLength>>2)-16),(this._curSubmit=p)._renderType=10017,p._numEle+=6}}else this.sprite&&i.timer.callLater(this,this._repaintSprite)},o.setShader=function(t){Y.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},o.setFilters=function(t){Y.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=st.RENDERBASE,this._renderKey=0,this._drawCount++},o.drawTexture=function(t,e,i,n,r,s,a){this._drawTextureM(t,e,i,n,r,s,a,null,1)},o.addTextureVb=function(t,e,i){var n=this._curSubmit._vb||this._vb,r=n._byteLength>>2;n.byteLength=r+16<<2;for(var s=n.getFloat32Array(),a=0;a<16;a+=4)s[r++]=t[a]+e,s[r++]=t[a+1]+i,s[r++]=t[a+2],s[r++]=t[a+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),n._upload=!0},o.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&i.timer.callLater(this,this._repaintSprite),0;var n=t.bitmap,r=n.id+this._shader2D.ALPHA*e+10016;if(r==this._renderKey)return r;var s=this._shader2D,a=s.ALPHA,o=this._curSubmit.shaderValue;s.ALPHA*=e,this._renderKey=r,this._drawCount++,s.glTexture=n;var h=this._vb,l=null,c=h._byteLength/32*3,u=o.textureHost&&o.textureHost==t&&o.textureHost.alphaTexture==t.alphaTexture;return l=Nt.create(this,this._ib,h,c,Tt.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&s.ALPHA===o.ALPHA&&u,this._curSubmit=l,s.ALPHA=a,r},o.drawTextures=function(t,e,n,r){if(t.loaded&&t.bitmap&&t.source){var s=this._clipRect;if(this._clipRect=a.MAXCLIPRECT,this._drawTextureM(t,e[0],e[1],t.width,t.height,n,r,null,1)){if(this._clipRect=s,D.drawCall++,!(e.length<4)){for(var o=this._curSubmit._vb||this._vb,h=this._curMat.a,l=this._curMat.d,c=2,u=e.length;c<u;c+=2)mt.copyPreImgVb(o,(e[c]-e[c-2])*h,(e[c+1]-e[c-1])*l),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&i.timer.callLater(this,this._repaintSprite)},o._drawTextureM=function(t,e,n,r,s,a,o,h,l){if(!t.loaded||!t.source)return this.sprite&&i.timer.callLater(this,this._repaintSprite),!1;var c=this._curSubmit._vb||this._vb,u=t.bitmap;e+=a,n+=o,this._drawCount++;var d=u.id+this._shader2D.ALPHA*l+10016;if(d!=this._renderKey){this._renderKey=d;var _=this._curSubmit.shaderValue,f=this._shader2D,p=f.ALPHA;f.ALPHA*=l,f.glTexture=u;var m=this._vb,g=null,v=m._byteLength/32*3,y=_.textureHost&&_.textureHost==t&&_.textureHost.alphaTexture==t.alphaTexture;g=Nt.create(this,this._ib,m,v,Tt.create(1,0)),(this._submits[this._submits._length++]=g).shaderValue.textureHost=t,g._renderType=10016,g._preIsSameTextureShader=10016===this._curSubmit._renderType&&f.ALPHA===_.ALPHA&&y,this._curSubmit=g,c=this._curSubmit._vb||this._vb,f.ALPHA=p}return!!mt.fillRectImgVb(c,this._clipRect,e,n,r||t.width,s||t.height,t.uv,h||this._curMat,this._x,this._y,0,0)&&(U.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(c._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},o._repaintSprite=function(){this.sprite&&this.sprite.repaint()},o._drawText=function(t,e,i,n,r,s,a,o,h,l){var c=t.bitmap;this._drawCount++;var u=c.id+this._shader2D.ALPHA+10016;if(u!=this._renderKey){this._renderKey=u;var d=this._curSubmit.shaderValue,_=this._shader2D;_.glTexture=c;var f=this._vb,p=null,m=f._byteLength/32*3,g=d.textureHost&&d.textureHost==t&&d.textureHost.alphaTexture==t.alphaTexture;(p=U.enabled?Nt.create(this,this._ib,f,m,Tt.create(1,0)):Nt.create(this,this._ib,f,m,Zt.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===d.ALPHA&&g,(this._submits[this._submits._length++]=p).shaderValue.textureHost=t,p._renderType=10016,this._curSubmit=p}t.active();var v=this._curSubmit._vb||this._vb;mt.fillRectImgVb(v,this._clipRect,e+a,i+o,n||t.width,r||t.height,t.uv,s||this._curMat,this._x,this._y,h,l,!0)&&(U.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(v._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},o.drawTextureWithTransform=function(t,e,i,n,r,s,o,h,l){if(s){var c=this._curMat,u=this._x,d=this._y;(0!==o||0!==h)&&(this._x=o*c.a+h*c.c,this._y=h*c.d+o*c.b),s&&c.bTransform?(x.mul(s,c,a._tmpMatrix),(s=a._tmpMatrix)._checkTransform()):(this._x+=c.tx,this._y+=c.ty),this._drawTextureM(t,e,i,n,r,0,0,s,l),this._x=u,this._y=d}else this._drawTextureM(t,e,i,n,r,o,h,null,l)},o.fillQuadrangle=function(t,e,i,n,r){var s=this._curSubmit,a=this._vb,o=this._shader2D,h=s.shaderValue;if(this._renderKey=0,t.bitmap){var l=t.bitmap;o.glTexture==l&&o.ALPHA===h.ALPHA||(o.glTexture=l,(s=this._curSubmit=st.createSubmit(this,this._ib,a,a._byteLength/32*3,Tt.create(1,0))).shaderValue.glTexture=l,this._submits[this._submits._length++]=s),mt.fillQuadrangleImgVb(a,e,i,n,t.uv,r||this._curMat,this._x,this._y)}else s.shaderValue.fillStyle&&s.shaderValue.fillStyle.equal(t)&&o.ALPHA===h.ALPHA||(o.glTexture=null,(s=this._curSubmit=st.createSubmit(this,this._ib,a,a._byteLength/32*3,Tt.create(2,0))).shaderValue.defines.add(2),s.shaderValue.fillStyle=W.create(t),this._submits[this._submits._length++]=s),mt.fillQuadrangleImgVb(a,e,i,n,L.DEF_UV,r||this._curMat,this._x,this._y);s._numEle+=6},o.drawTexture2=function(t,e,i,n,r,s,o,h){if(0!=s){var l=this._curMat;if(this._x=t*l.a+e*l.c,this._y=e*l.d+t*l.b,r&&(r=l.bTransform||r.bTransform?(x.mul(r,l,a._tmpMatrix),a._tmpMatrix):(this._x+=r.tx+l.tx,this._y+=r.ty+l.ty,x.EMPTY)),1!==s||o){var c=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=s,o&&(this._nBlendType=z.TOINT(o)),this._drawTextureM(h[0],h[1]-i,h[2]-n,h[3],h[4],0,0,r,1),this._shader2D.ALPHA=c,this._nBlendType=u}else this._drawTextureM(h[0],h[1]-i,h[2]-n,h[3],h[4],0,0,r,1);this._x=this._y=0}},o.drawCanvas=function(t,e,i,n,r){var s=t.context;if(this._renderKey=0,s._targets)this._submits[this._submits._length++]=Rt.create(s,0,null),this._curSubmit=st.RENDERBASE,s._targets.drawTo(this,e,i,n,r);else{var a=this._submits[this._submits._length++]=Rt.create(s,this._shader2D.ALPHA,this._shader2D.filters),o=n/t.width,h=r/t.height,l=a._matrix;this._curMat.copyTo(l),1!=o&&1!=h&&l.scale(o,h);var c=l.tx,u=l.ty;l.tx=l.ty=0,l.transformPoint(w.TEMP.setTo(e,i)),l.translate(w.TEMP.x+c,w.TEMP.y+u),this._curSubmit=st.RENDERBASE}_.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=s._targets?"yellow":"green",this.strokeRect(e-1,i-1,n+2,r+2,1),this.strokeRect(e,i,n,r,1),this.restore())},o.drawTarget=function(t,e,i,n,r,s,a,o,h,l){void 0===l&&(l=-1);var c=this._vb;if(mt.fillRectImgVb(c,this._clipRect,e,i,n,r,h||L.DEF_UV,s||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null,this._curSubmit.shaderValue;var u=this._curSubmit=ut.create(this,this._ib,c,(c._byteLength-64)/32*3,o,a);u.blendType=-1==l?this._nBlendType:l,u.scope=t,this._submits[this._submits._length++]=u,this._curSubmit._numEle+=6}},o.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},o._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},o.drawTriangles=function(t,e,n,r,s,o,h,l,c,u){if(!t.loaded||!t.source)return this.sprite&&i.timer.callLater(this,this._repaintSprite),!1;this._drawCount++,t.bitmap;var d=this._mixRGBandAlpha(4294967295,l),_=(r.length,o.length);this._renderKey=-1;var f=this._curSubmit=Nt.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Tt.create(1,0));return f.shaderValue.textureHost=t,f._renderType=10016,this._submits[this._submits._length++]=f,h?(a._tmpMatrix.a=h.a,a._tmpMatrix.b=h.b,a._tmpMatrix.c=h.c,a._tmpMatrix.d=h.d,a._tmpMatrix.tx=h.tx+e,a._tmpMatrix.ty=h.ty+n,x.mul(a._tmpMatrix,this._curMat,a._tmpMatrix)):(a._tmpMatrix.a=this._curMat.a,a._tmpMatrix.b=this._curMat.b,a._tmpMatrix.c=this._curMat.c,a._tmpMatrix.d=this._curMat.d,a._tmpMatrix.tx=this._curMat.tx+e,a._tmpMatrix.ty=this._curMat.ty+n),this._triangleMesh.addData(r,s,o,a._tmpMatrix,d,this),this._curSubmit._numEle+=_,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},o.transform=function(t,e,i,n,r,s){q.save(this),x.mul(x.TEMP.setTo(t,e,i,n,r,s),this._curMat,this._curMat),this._curMat._checkTransform()},o.setTransformByMatrix=function(t){t.copyTo(this._curMat)},o.transformByMatrix=function(t){q.save(this),x.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},o.rotate=function(t){q.save(this),this._curMat.rotateEx(t)},o.scale=function(t,e){q.save(this),this._curMat.scaleEx(t,e)},o.clipRect=function(t,e,i,n){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var r=ct.create(4);this.addRenderObject(r);var s=this._vb,a=s._byteLength>>2;if(mt.fillRectImgVb(s,null,t,e,i,n,L.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var o=this._curSubmit=st.createSubmit(this,this._ib,s,(s._byteLength-64)/32*3,Tt.create(2,0));o.shaderValue.ALPHA=1,this._submits[this._submits._length++]=o,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var h=ct.create(5);this.addRenderObject(h);var l=s.getFloat32Array(),c=Math.min(Math.min(Math.min(l[0+a],l[4+a]),l[8+a]),l[12+a]),u=Math.max(Math.max(Math.max(l[0+a],l[4+a]),l[8+a]),l[12+a]),d=Math.min(Math.min(Math.min(l[1+a],l[5+a]),l[9+a]),l[13+a]),_=Math.max(Math.max(Math.max(l[1+a],l[5+a]),l[9+a]),l[13+a]);j.save(this,h,t,e,i,n,c,d,u-c,_-d),this._curSubmit=st.RENDERBASE}else{i*=this._curMat.a,n*=this._curMat.d;var f=w.TEMP;this._curMat.transformPoint(f.setTo(t,e)),i<0&&(f.x=f.x+i,i=-i),n<0&&(f.y=f.y+n,n=-n),this._renderKey=0;var p=this._curSubmit=lt.create(this);(this._submits[this._submits._length++]=p).submitIndex=this._submits._length,p.submitLength=9999999,X.save(this,p);var m=this._clipRect,g=m.x,v=m.y,y=f.x+i,x=f.y+n;g<f.x&&(m.x=f.x),v<f.y&&(m.y=f.y),m.width=Math.min(y,g+m.width)-m.x,m.height=Math.min(x,v+m.height)-m.y,this._shader2D.glTexture=null,p.clipRect.copyFrom(m),this._curSubmit=st.RENDERBASE}},o.setIBVB=function(t,e,i,n,r,s,a,o,h,l,c){if(void 0===h&&(h=0),void 0===l&&(l=0),void 0===c&&(c=0),null===i){if(S.isFlash){var u=n;u._selfIB||(u._selfIB=Jt.create(35044)),u._selfIB.clear(),i=u._selfIB}else i=this._ib;mt.expandIBQuadrangle(i,n._byteLength/(4*n.vertexStride*4))}if(!o||!a)throw Error("setIBVB must input:shader shaderValues");var d=ht.create(this,n,i,r,a,o,h,l,c);s||(s=x.EMPTY),s.translate(t,e),x.mul(s,this._curMat,d._mat),s.translate(-t,-e),this._submits[this._submits._length++]=d,this._curSubmit=st.RENDERBASE,this._renderKey=0},o.addRenderObject=function(t){this._submits[this._submits._length++]=t},o.fillTrangles=function(t,e,i,n,r){var s=this._curSubmit,a=this._vb,o=this._shader2D,h=s.shaderValue,l=n.length>>4,c=t.bitmap;this._renderKey=0,o.glTexture==c&&o.ALPHA===h.ALPHA||((s=this._curSubmit=st.createSubmit(this,this._ib,a,a._byteLength/32*3,Tt.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=s),mt.fillTranglesVB(a,e,i,n,r||this._curMat,this._x,this._y),s._numEle+=6*l},o.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},o.finish=function(){xt.mainContext.finish()},o.flush=function(){var t,e=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(e>this._ib.bufferLength/12&&mt.expandIBQuadrangle(this._ib,e),!this._isMain&&U.enabled&&U._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=U._atlasRestore;for(var i=this._submits,n=0,r=i._length;n<r;n++){var s=i[n];10016===s.getRenderType()&&s.checkTexture()}}for(this.submitElement(0,this._submits._length),this._path&&this._path.reset(),et.instance&&et.getInstance().reset(),n=0,t=this.meshlist.length;n<t;n++){var a=this.meshlist[n];a.canReuse?a.releaseMesh():a.destroy()}return this.meshlist.length=0,this._curSubmit=st.RENDERBASE,this._renderKey=0,this._triangleMesh=Lt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},o.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=O.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},o.movePath=function(t,e){var i=t,n=e;t=this._curMat.a*i+this._curMat.c*n+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*n+this._curMat.ty,this.mX+=t,this.mY+=e},o.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},o.closePath=function(){this._path.closePath=!0},o.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},o.stroke=function(){var t=this._getPath();if(0<this.lineWidth){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=O.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else O.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],n=st.createShape(this,t.ib,t.vb,t.count,t.offset,Tt.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA,n.shaderValue.u_pos=i,n.shaderValue.u_mmat2=vt.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=n,this._renderKey=-1}},o.line=function(t,e,i,n,r,s){var a=this._curSubmit,o=this._vb;if(mt.fillLineVb(o,this._clipRect,t,e,i,n,r,s)){this._renderKey=0;var h=this._shader2D,l=a.shaderValue;h.strokeStyle===l.strokeStyle&&h.ALPHA===l.ALPHA||(h.glTexture=null,(a=this._curSubmit=st.createSubmit(this,this._ib,o,(o._byteLength-64)/32*3,Tt.create(2,0))).shaderValue.strokeStyle=h.strokeStyle,a.shaderValue.mainID=2,a.shaderValue.ALPHA=h.ALPHA,this._submits[this._submits._length++]=a),a._numEle+=6}},o.moveTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,s=e;t=this._curMat.a*r+this._curMat.c*s,e=this._curMat.b*r+this._curMat.d*s}n.addPoint(t,e)},o.lineTo=function(t,e,i){void 0===i&&(i=!0);var n=this._getPath();if(i){var r=t,s=e;t=this._curMat.a*r+this._curMat.c*s,e=this._curMat.b*r+this._curMat.d*s}n.addPoint(t,e)},o.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(n[0],n[1]);for(var r=2,s=n.length;r<s;)this.quadraticCurveTo(n[r++],n[r++],n[r++],n[r++]);this.stroke()},o.arcTo=function(t,e,i,n,r){if(-1==this.mId||!this.mHaveKey){var s=0,o=0,h=0,l=this._getPath();this._curMat.copyTo(a._tmpMatrix),a._tmpMatrix.tx=a._tmpMatrix.ty=0,a._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),a._tmpMatrix.invertTransformPoint(a._tempPoint);var c=a._tempPoint.x-t,u=a._tempPoint.y-e,d=Math.sqrt(c*c+u*u);if(!(d<=1e-6)){var _=c/d,f=u/d,p=i-t,m=n-e,g=p*p+m*m,v=Math.sqrt(g);if(!(v<=1e-6)){var y=p/v,x=m/v,w=_+y,b=f+x,S=Math.sqrt(w*w+b*b);if(!(S<=1e-6)){var T=w/S,C=b/S,M=Math.acos(T*_+C*f),I=Math.PI/2-M,E=(d=r/Math.tan(I))*_+t,A=d*f+e,D=Math.sqrt(d*d+r*r),P=t+T*D,R=e+C*D,N=0,L=0;if(0<=_*x-f*y){var B=2*I/a.SEGNUM;N=Math.sin(B),L=Math.cos(B)}else B=2*-I/a.SEGNUM,N=Math.sin(B),L=Math.cos(B);o=this._curMat.a*E+this._curMat.c*A,h=this._curMat.b*E+this._curMat.d*A,o==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(o,h);var O=E-P,F=A-R;for(s=0;s<a.SEGNUM;s++){var k=O*L+F*N,V=-O*N+F*L;o=k+P,h=V+R,t=this._curMat.a*o+this._curMat.c*h,h=e=this._curMat.b*o+this._curMat.d*h,(o=t)==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(o,h),O=k,F=V}}}}}},o.arc=function(t,e,i,n,r,s,a){if(void 0===s&&(s=!1),void 0===a&&(a=!0),-1!=this.mId){var o=O.getInstance().shapeDic[this.mId];if(o&&this.mHaveKey&&!o.needUpdate(this._curMat))return;e=t=0}var h,l,c=0,u=0,d=0,_=0,f=0,p=0;if(u=r-n,s)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;h=u/(l=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,d=Math.abs(4/3*(1-Math.cos(h))/Math.sin(h)),s&&(d=-d);var m=this._getPath(),g=NaN,v=NaN;for(p=0;p<=l;p++)c=n+u*(p/l),_=t+Math.cos(c)*i,f=e+Math.sin(c)*i,a&&(g=_,v=f,_=this._curMat.a*g+this._curMat.c*v,f=this._curMat.b*g+this._curMat.d*v),_==this._path.getEndPointX()&&f==this._path.getEndPointY()||m.addPoint(_,f);_=t+Math.cos(r)*i,f=e+Math.sin(r)*i,a&&(g=_,v=f,_=this._curMat.a*g+this._curMat.c*v,f=this._curMat.b*g+this._curMat.d*v),_==this._path.getEndPointX()&&f==this._path.getEndPointY()||m.addPoint(_,f)},o.quadraticCurveTo=function(t,e,i,n){var r=h.I,s=i,a=n;i=this._curMat.a*s+this._curMat.c*a,n=this._curMat.b*s+this._curMat.d*a,s=t,a=e,t=this._curMat.a*s+this._curMat.c*a,e=this._curMat.b*s+this._curMat.d*a;for(var o=r.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,n],30,2),l=0,c=o.length/2;l<c;l++)this.lineTo(o[2*l],o[2*l+1],!1);this.lineTo(i,n,!1)},o.rect=function(t,e,i,n){this._other=this._other.make(),this._other.path||(this._other.path=new G),this._other.path.rect(t,e,i,n)},o.strokeRect=function(t,e,i,n,r){var s=.5*r;this.line(t-s,e,t+i+s,e,r,this._curMat),this.line(t+i,e,t+i,e+n,r,this._curMat),this.line(t,e,t,e+n,r,this._curMat),this.line(t-s,e+n,t+i+s,e+n,r,this._curMat)},o.clip=function(){},o.drawPoly=function(t,e,i,n,r,s,a){void 0===a&&(a=!1),this._renderKey=0,this._shader2D.glTexture=null;var o=this._getPath();if(-1==this.mId)o.polygon(t,e,i,n,r||1,s);else if(this.mHaveKey){var h=O.getInstance().shapeDic[this.mId];h.setMatrix(this._curMat),h.rebuild(o.tempArray),o.setGeomtry(h)}else{var l=o.polygon(t,e,i,n,r||1,s);O.getInstance().addShape(this.mId,l),l.setMatrix(this._curMat)}o.update();var c,u=[this.mX,this.mY];if((c=st.createShape(this,o.ib,o.vb,o.count,o.offset,Tt.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_pos=u,c.shaderValue.u_mmat2=vt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c,0<r){if(this.mHaveLineKey){var d=O.getInstance().shapeLineDic[this.mId];d.rebuild(o.tempArray),o.setGeomtry(d)}else O.getInstance().addShape(this.mId,o.drawLine(t,e,i,r,s));o.update(),(c=st.createShape(this,o.ib,o.vb,o.count,o.offset,Tt.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_mmat2=vt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c}},o.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},o._getPath=function(){return this._path||(this._path=new G)},s(0,o,"globalCompositeOperation",(function(){return z.NAMES[this._nBlendType]}),(function(t){var e=z.TOINT[t];null==e||this._nBlendType===e||(Y.save(this,65536,this,!0),this._curSubmit=st.RENDERBASE,this._renderKey=0,this._nBlendType=e)})),s(0,o,"strokeStyle",(function(){return this._shader2D.strokeStyle}),(function(t){this._shader2D.strokeStyle.equal(t)||(Y.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=W.create(t))})),s(0,o,"globalAlpha",(function(){return this._shader2D.ALPHA}),(function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(Y.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)})),s(0,o,"asBitmap",null,(function(t){if(t){if(this._targets||(this._targets=new Q),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null})),s(0,o,"fillStyle",(function(){return this._shader2D.fillStyle}),(function(t){this._shader2D.fillStyle.equal(t)||(Y.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=W.create(t))})),s(0,o,"textAlign",(function(){return this._other.textAlign}),(function(t){this._other.textAlign===t||(this._other=this._other.make(),Y.save(this,32768,this._other,!1),this._other.textAlign=t)})),s(0,o,"lineWidth",(function(){return this._other.lineWidth}),(function(t){this._other.lineWidth===t||(this._other=this._other.make(),Y.save(this,256,this._other,!1),this._other.lineWidth=t)})),s(0,o,"textBaseline",(function(){return this._other.textBaseline}),(function(t){this._other.textBaseline===t||(this._other=this._other.make(),Y.save(this,16384,this._other,!1),this._other.textBaseline=t)})),s(0,o,"font",null,(function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),Y.save(this,8,this._other,!1),this._other.font===ft.EMPTY?this._other.font=new ft(t):this._other.font.setFont(t))})),a.__init__=function(){e.DEFAULT=new e},a._tempPoint=new w,a._SUBMITVBSIZE=32e3,a._MAXSIZE=99999999,a._RECTVBSIZE=16,a.MAXCLIPRECT=new b(0,0,99999999,99999999),a._COUNT=0,a._tmpMatrix=new x,a.SEGNUM=32,a._contextcount=0,n(a,["_fontTemp",function(){return this._fontTemp=new ft},"_drawStyleTemp",function(){return this._drawStyleTemp=new W(null)}]),a.__init$=function(){e=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=ft.EMPTY}r(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=ft.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},a}(),Tt=function(e){function i(e,n){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,i.__super.call(this),this.defines=new Et,this.position=i._POSITION,this.mainID=e,this.subID=n,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.colorMul=t.ShieldColor?d.create(t.ShieldColor)._color:null,this.glTexture=null,this.u_mmat2=null,this._cacheID=e|n,this._inClassCache=i._cache[this._cacheID],0<e&&!this._inClassCache&&(this._inClassCache=i._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}r(i,"laya.webgl.shader.d2.value.Value2D",k);var n=i.prototype;return n.setValue=function(t){},n.refresh=function(){var t=this.size;return t[0]=vt.width,t[1]=vt.height,this.alpha=this.ALPHA*vt.worldAlpha,this.mmat=vt.worldMatrix4,this},n._ShaderWithCompile=function(){return Kt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Qt.create)},n._withWorldShaderDefines=function(){var t=vt.worldShaderDefines,e=Kt.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,n={};for(i in this.defines.toNameDic())n[i]="";for(i in t.toNameDic())n[i]="";e=Kt.withCompile2D(0,this.mainID,n,this.mainID|this.defines._value|t.getValue(),Qt.create)}var r=vt.worldFilters;if(!r)return e;for(var s,a=r.length,o=0;o<a;o++)(s=r[o])&&s.action.setValue(this);return e},n.upload=function(){var e=vt;this.alpha=this.ALPHA*e.worldAlpha,vt.worldMatrix4!==vt.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),t.ShieldColor&&!this.colorMul?this.colorMul=t.ShieldColor?d.create(t.ShieldColor)._color:null:!t.ShieldColor&&this.colorMul&&(this.colorMul=null),this.colorMul?this.defines.add(16384):this.defines.remove(16384),xt.shaderHighPrecision&&this.defines.add(1024);var i,n=e.worldShaderDefines?this._withWorldShaderDefines():Kt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=e.width,this.size[1]=e.height,this.mmat=e.worldMatrix4,Bt.activeShader!==n?n._shaderValueWidth!==e.width||n._shaderValueHeight!==e.height?(n._shaderValueWidth=e.width,n._shaderValueHeight=e.height):i=n._params2dQuick2||n._make2dQuick2():n._shaderValueWidth!==e.width||n._shaderValueHeight!==e.height?(n._shaderValueWidth=e.width,n._shaderValueHeight=e.height):i=n._params2dQuick1||n._make2dQuick1(),n.upload(this,i)},n.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,n=0;n<i;n++)(e=t[n])&&(this.defines.add(e.type),e.action.setValue(this))},n.clear=function(){this.defines.setValue(this.subID)},n.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},i._initone=function(t,e){i._typeClass[t]=e,i._cache[t]=[],i._cache[t]._length=0},i.__init__=function(){i._POSITION=[2,5126,!1,4*pt.BYTES_PE,0],i._TEXCOORD=[2,5126,!1,4*pt.BYTES_PE,2*pt.BYTES_PE],i._initone(2,Vt),i._initone(4,zt),i._initone(256,Ut),i._initone(512,kt),i._initone(1,Ht),i._initone(65,Zt),i._initone(9,Ht)},i.create=function(t,e){var n=i._cache[t|e];return n._length?n[--n._length]:new i._typeClass[t|e](e)},i._POSITION=null,i._TEXCOORD=null,i._cache=[],i._typeClass=[],i.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i}(),Ct=function(t){function e(t,i){e.__super.call(this,t,i)}r(e,"laya.webgl.utils.RenderSprite3D",T);var i=e.prototype;return i.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},i._mask=function(t,i,n,r){var s,a,o=this._next,h=t.mask;if(h){i.ctx.save();var l=i.ctx.globalCompositeOperation,c=new b;if(c.copyFrom(h.getBounds()),c.width=Math.round(c.width),c.height=Math.round(c.height),c.x=Math.round(c.x),c.y=Math.round(c.y),0<c.width&&0<c.height){var u=t._style._tf,d=ot.create();d.addValue("bounds",c),s=at.create([d,i],laya.webgl.utils.RenderSprite3D.tmpTarget),i.addRenderObject(s),h.render(i,-c.x,-c.y),s=at.create([d],laya.webgl.utils.RenderSprite3D.endTmpTarget),i.addRenderObject(s),i.ctx.save(),i.clipRect(n-u.translateX+c.x,r-u.translateY+c.y,c.width,c.height),o._fun.call(o,t,i,n,r),i.ctx.restore(),a=ct.create(6),l=i.ctx.globalCompositeOperation,a.blendMode="mask",i.addRenderObject(a),x.TEMP.identity();var _=Tt.create(1,0),f=L.INV_UV,p=c.width,m=c.height;(c.width<32||c.height<32)&&((f=e.tempUV)[0]=0,f[1]=0,f[2]=32<=c.width?1:c.width/32,f[3]=0,f[4]=32<=c.width?1:c.width/32,f[5]=32<=c.height?1:c.height/32,f[6]=0,f[7]=32<=c.height?1:c.height/32,c.width=32<=c.width?c.width:32,c.height=32<=c.height?c.height:32,f[1]*=-1,f[3]*=-1,f[5]*=-1,f[7]*=-1,f[1]+=1,f[3]+=1,f[5]+=1,f[7]+=1),i.ctx.drawTarget(d,n+c.x-u.translateX,r+c.y-u.translateY,p,m,x.TEMP,"tmpTarget",_,f,6),s=at.create([d],laya.webgl.utils.RenderSprite3D.recycleTarget),i.addRenderObject(s),(a=ct.create(6)).blendMode=l,i.addRenderObject(a)}i.ctx.restore()}else o._fun.call(o,t,i,n,r)},i._blend=function(t,e,i,n){var r=t._style,s=this._next;r.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=r.blendMode,s._fun.call(s,t,e,i,n),e.ctx.restore()):s._fun.call(s,t,e,i,n)},i._transform=function(t,e,i,n){var r=t.transform,s=this._next;if(r&&s!=T.NORENDER){var a=e.ctx;t._style,r.tx=i,r.ty=n;var o=a._getTransformMatrix(),h=o.clone();x.mul(r,o,o),o._checkTransform(),r.tx=r.ty=0,s._fun.call(s,t,e,0,0),h.copyTo(o),h.destroy()}else s._fun.call(s,t,e,i,n)},e.tmpTarget=function(t,e){var i=t.getValue("bounds"),n=Ot.create(i.width,i.height);n.start(),n.clear(0,0,0,0),t.addValue("tmpTarget",n)},e.endTmpTarget=function(t){t.getValue("tmpTarget").end()},e.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},n(e,["tempUV",function(){return this.tempUV=new Array(8)}]),e}(),Mt=function(t){function e(){this.data=null,e.__super.call(this)}r(e,"laya.filters.webgl.ColorFilterActionGL",F);var n=e.prototype;return i.imps(n,{"laya.filters.IFilterActionGL":!0}),n.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},n.apply3d=function(t,e,i,n,r){var s=t.getValue("bounds"),a=Tt.create(1,0);a.setFilters([this.data]);var o=x.TEMP;o.identity(),i.ctx.drawTarget(t,0,0,s.width,s.height,o,"src",a)},e}(),It=function(t){function e(t,i,n,r,s){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,e.__super.call(this,t,i,s),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new Wt,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=n,this._atlasCanvas.height=r,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}r(e,"laya.webgl.atlas.Atlaser",V);var i=e.prototype;return i.computeUVinAtlasTexture=function(t,e,i,n){var r=U.atlasTextureWidth,s=U.atlasTextureHeight,a=i/r,o=n/s,h=(i+t.bitmap.width)/r,l=(n+t.bitmap.height)/s,c=t.bitmap.width/r,u=t.bitmap.height/s;t.uv=[a+e[0]*c,o+e[1]*u,h-(1-e[2])*c,o+e[3]*u,h-(1-e[4])*c,l-(1-e[5])*u,a+e[6]*c,l-(1-e[7])*u]},i.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t,i=e.url,n=this._InAtlasWebGLImagesKey[i||e.id];if(n)return n.offsetInfoID}return-1},i.addToAtlasTexture=function(t,e,i){if(t instanceof laya.webgl.resource.WebGLImage){var n=t,r=n.url;this._InAtlasWebGLImagesKey[r||n.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])}this._atlasCanvas.texSubImage2D(e,i,t.atlasSource),t.clearAtlasSource()},i.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var n=t.uv.slice(),r=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(n),this._inAtlasTextureBitmapValue.push(r),this.computeUVinAtlasTexture(t,n,e,i),t.bitmap=this._atlasCanvas},i.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},i.dispose=function(){this.clear(),this._atlasCanvas.destroy()},s(0,i,"InAtlasWebGLImagesOffsetValue",(function(){return this._InAtlasWebGLImagesOffsetValue})),s(0,i,"texture",(function(){return this._atlasCanvas})),s(0,i,"inAtlasWebGLImagesKey",(function(){return this._InAtlasWebGLImagesKey})),e}(),Et=function(t){function e(){e.__super.call(this,e.__name2int,e.__int2name,e.__int2nameMap)}return r(e,"laya.webgl.shader.d2.ShaderDefines2D",$),e.__init__=function(){e.reg("TEXTURE2D",1),e.reg("COLOR2D",2),e.reg("PRIMITIVE",4),e.reg("GLOW_FILTER",8),e.reg("BLUR_FILTER",16),e.reg("COLOR_FILTER",32),e.reg("COLOR_ADD",64),e.reg("WORLDMAT",128),e.reg("FILLTEXTURE",256),e.reg("FSHIGHPRECISION",1024),e.reg("TXTALPHA",2048),e.reg("TXTCOMPRESS",4096),e.reg("COLORMUL",16384)},e.reg=function(t,i){$._reg(t,i,e.__name2int,e.__int2name)},e.toText=function(t,e,i){return $._toText(t,e,i)},e.toInt=function(t){return $._toInt(t,e.__name2int)},e.TEXTURE2D=1,e.COLOR2D=2,e.PRIMITIVE=4,e.FILTERGLOW=8,e.FILTERBLUR=16,e.FILTERCOLOR=32,e.COLORADD=64,e.WORLDMAT=128,e.FILLTEXTURE=256,e.SKINMESH=512,e.SHADERDEFINE_FSHIGHPRECISION=1024,e.TXTALPHA=2048,e.TXTCOMPRESS=4096,e.COLORMUL=16384,e.__name2int={},e.__int2name=[],e.__int2nameMap=[],e}(),At=(r((function t(e,i,n,r,s,a,o){t.__super.call(this,e,i,n,r,40,s,a,o)}),"laya.webgl.shapes.Ellipse",it),function(t){function e(t,i,n,r,s){this._points=[],this.rebuild(n),e.__super.call(this,t,i,0,0,0,s,r,s,0)}r(e,"laya.webgl.shapes.Line",it);var i=e.prototype;return i.rebuild=function(t){var e=t.length;e!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var i=NaN,n=NaN,r=-1,s=-1,a=t.length/2,o=0;o<a;o++)i=t[2*o],n=t[2*o+1],(.01<Math.abs(r-i)||.01<Math.abs(s-n))&&this._points.push(i,n),r=i,s=n},i.getData=function(t,e,i){var n=[],r=[];0<this.borderWidth&&this.createLine2(this._points,n,this.borderWidth,i,r,this._points.length/2),this.mUint16Array.set(n,0),this.mFloat32Array.set(r,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}()),Dt=function(t){function e(t,i,n,r,s){this._points=[];for(var a=NaN,o=NaN,h=-1,l=-1,c=n.length/2-1,u=0;u<c;u++)a=n[2*u],o=n[2*u+1],(.01<Math.abs(h-a)||.01<Math.abs(l-o))&&this._points.push(a,o),h=a,l=o;a=n[2*c],o=n[2*c+1],h=this._points[0],l=this._points[1],(.01<Math.abs(h-a)||.01<Math.abs(l-o))&&this._points.push(a,o),e.__super.call(this,t,i,0,0,this._points.length/2,0,r,s)}r(e,"laya.webgl.shapes.LoopLine",it);var i=e.prototype;return i.getData=function(t,e,i){if(0<this.borderWidth){for(var n=this.color,r=(n>>16&255)/255,s=(n>>8&255)/255,a=(255&n)/255,o=[],h=0,l=0,c=[],u=Math.floor(this._points.length/2),d=0;d<u;d++)h=this._points[2*d],l=this._points[2*d+1],o.push(this.x+h,this.y+l,r,s,a);this.createLoopLine(o,c,this.borderWidth,i+o.length/5),t.append(new Uint16Array(c)),e.append(new Float32Array(o))}},i.createLoopLine=function(t,e,i,n,r,s){t.length;var a=t.concat(),o=r||t,h=this.borderColor,l=(h>>16&255)/255,c=(h>>8&255)/255,u=(255&h)/255,d=[a[0],a[1]],_=[a[a.length-5],a[a.length-4]],f=_[0]+.5*(d[0]-_[0]),p=_[1]+.5*(d[1]-_[1]);a.unshift(f,p,0,0,0),a.push(f,p,0,0,0);var m,g,v,y,x,w,b,S,T,C,M,I,E,A,D,P,R,N,L,B,O=a.length/5,F=n,k=i/2;v=a[0],y=a[1],C=v-(x=a[5]),T=(T=-(y-(w=a[6])))/(B=Math.sqrt(T*T+C*C))*k,C=C/B*k,o.push(v-T,y-C,l,c,u,v+T,y+C,l,c,u);for(var V=1;V<O-1;V++)v=a[5*(V-1)],y=a[5*(V-1)+1],x=a[5*V],w=a[5*V+1],b=a[5*(V+1)],S=a[5*(V+1)+1],C=v-x,I=x-b,D=(-(T=(T=-(y-w))/(B=Math.sqrt(T*T+C*C))*k)+v)*(-(C=C/B*k)+w)-(-T+x)*(-C+y),N=(-(M=(M=-(w-S))/(B=Math.sqrt(M*M+I*I))*k)+b)*(-(I=I/B*k)+w)-(-M+x)*(-I+S),L=(E=-C+y-(-C+w))*(R=-M+x-(-M+b))-(P=-I+S-(-I+w))*(A=-T+x-(-T+v)),Math.abs(L)<.1?(L+=10.1,o.push(x-T,w-C,l,c,u,x+T,w+C,l,c,u)):(m=(A*N-R*D)/L,g=(P*D-E*N)/L,o.push(m,g,l,c,u,x-(m-x),w-(g-w),l,c,u));s&&(e=s);var U=this.edges+1;for(V=1;V<U;V++)e.push(F+2*(V-1),F+2*(V-1)+1,F+2*V+1,F+2*V+1,F+2*V,F+2*(V-1));return e.push(F+2*(V-1),F+2*(V-1)+1,F+1,F+1,F,F+2*(V-1)),o},e}(),Pt=function(t){function e(t,i,n,r,s,a){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=x.create(),this._points=n.slice(0,n.length),e.__super.call(this,t,i,0,0,this._points.length/2,r,s,a)}r(e,"laya.webgl.shapes.Polygon",it);var i=e.prototype;return i.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},i.setMatrix=function(t){t.copyTo(this._mat)},i.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},i.getData=function(t,e,i){var n,r=0,s=this._points,a=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],a=this.earcutTriangles.length,r=0;r<a;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i,n=[];var o=[],h=[],l=this.color,c=(l>>16&255)/255,u=(l>>8&255)/255,d=(255&l)/255;for(a=Math.floor(s.length/2),r=0;r<a;r++)o.push(this.x+s[2*r],this.y+s[2*r+1],c,u,d),h.push(this.x+s[2*r],this.y+s[2*r+1]);for(this.earcutTriangles=nt.earcut(h,null,2),a=this.earcutTriangles.length,r=0;r<a;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(o)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}(),Rt=function(t){function e(){this._matrix=new x,this._matrix4=pt.defaultMatrix4.concat(),e.__super.call(this,1e4),this.shaderValue=new Tt(0,0)}r(e,"laya.webgl.submit.SubmitCanvas",st);var i=e.prototype;return i.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=vt.worldAlpha,e=vt.worldMatrix4,i=vt.worldMatrix,n=vt.worldFilters,r=vt.worldShaderDefines,s=this.shaderValue,a=this._matrix,o=this._matrix4,h=x.TEMP;return x.mul(a,i,h),o[0]=h.a,o[1]=h.b,o[4]=h.c,o[5]=h.d,o[12]=h.tx,o[13]=h.ty,vt.worldMatrix=h.clone(),vt.worldMatrix4=o,vt.worldAlpha=vt.worldAlpha*s.alpha,s.filters&&s.filters.length&&(vt.worldFilters=s.filters,vt.worldShaderDefines=s.defines),this._ctx_src.flush(),vt.worldAlpha=t,vt.worldMatrix4=e,vt.worldMatrix.destroy(),vt.worldMatrix=i,vt.worldFilters=n,vt.worldShaderDefines=r,1},i.releaseRender=function(){var t=e._cache;this._ctx_src=null,t[t._length++]=this},i.getRenderType=function(){return 10003},e.create=function(t,i,n){var r=e._cache._length?e._cache[--e._cache._length]:new e;r._ctx_src=t;var s=r.shaderValue;return s.alpha=i,s.defines.setValue(0),n&&n.length&&s.setFilters(n),r},e._cache=((e._cache=[])._length=0,e._cache),e}(),Nt=function(t){function e(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),e.__super.call(this,t)}r(e,"laya.webgl.submit.SubmitTexture",st);var i=e.prototype;return i.releaseRender=function(){var t=e._cache;(t[t._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},i.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},i.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!==t)for(var e=this._vb.getFloat32Array(),i=0,n=this._texs.length;i<n;i++){var r=this._texs[i];r.active();var s=r.uv;if(this._texsID[i]!==r._uvID){this._texsID[i]=r._uvID;var a=this._vbPos[i];e[a+2]=s[0],e[a+3]=s[1],e[a+6]=s[2],e[a+7]=s[3],e[a+10]=s[4],e[a+11]=s[5],e[a+14]=s[6],e[a+15]=s[7],this._vb.setNeedUpload()}r.bitmap!==t&&(this._isSameTexture=!1)}}},i.renderSubmit=function(){if(0===this._numEle)return e._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var i=t.source;if(!t.bitmap||!i)return e._shaderSet=!1,1;this.shaderValue.texture=i,t.alphaTexture&&t.alphaTexture.source&&(this.shaderValue.texture1=t.alphaTexture.source)}this._vb.bind_upload(this._ib);var n=xt.mainContext;if(z.activeBlendFunction!==this._blendFn&&(n.enable(3042),this._blendFn(n),z.activeBlendFunction=this._blendFn),D.drawCall++,D.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Bt.activeShader&&e._shaderSet?(Bt.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&Bt.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),e._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var r=t.bitmap,s=0,a=Bt.activeShader,o=0,h=this._texs.length;o<h;o++){var l=this._texs[o];l.bitmap===r&&o+1!==h||(a.uploadTexture2D(l.source),n.drawElements(4,6*(o-s+1),5123,this._startIdx+6*s*pt.BYTES_PIDX),r=l.bitmap,s=o)}else n.drawElements(4,this._numEle,5123,this._startIdx);return 1},e.create=function(t,i,n,r,s){var a=e._cache._length?e._cache[--e._cache._length]:new e;null==n&&((n=a._selfVb||(a._selfVb=$t.create(-1))).clear(),r=0),a._ib=i,a._vb=n,a._startIdx=r*pt.BYTES_PIDX,a._numEle=0;var o=t._nBlendType;a._blendFn=t._targets?z.targetFns[o]:z.fns[o],a.shaderValue=s,a.shaderValue.setValue(t._shader2D);var h=t._shader2D.filters;return h&&a.shaderValue.setFilters(h),a},e._cache=((e._cache=[])._length=0,e._cache),e._shaderSet=!0,e}(),Lt=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}r(e,"laya.webgl.utils.MeshTexture",gt);var i=e.prototype;return i.addData=function(t,i,n,r,s,a){for(var o=t.length/2,h=this._vb.needSize(o*e.const_stride)>>2,l=this._vb.getFloat32Array(),c=0,u=0;u<o;u++){var d=t[c],_=t[c+1],f=d*r.a+_*r.c+r.tx,p=d*r.b+_*r.d+r.ty;l[h++]=f,l[h++]=p,l[h++]=i[c],l[h++]=i[c+1],c+=2}this._vb.setNeedUpload();var m=this.vertNum;if(0<m){(o=n.length)>e.tmpIdx.length&&(e.tmpIdx=new Uint16Array(o));for(var g=0;g<o;g++)e.tmpIdx[g]=n[g]+m;this._ib.appendU16Array(e.tmpIdx,n.length)}else this._ib.append(n);this._ib.setNeedUpload(),this.vertNum+=o,this.indexNum+=n.length},i.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy()},e.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new e},e.const_stride=16,e._POOL=[],n(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),e}(),Bt=function(t){function e(){e.__super.call(this),this.lock=!0}return r(e,"laya.webgl.shader.BaseShader",C),e.activeShader=null,e.bindShader=null,e}(),Ot=function(t){function e(t,i,n,r,s,a,o,h,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=i,this._surfaceFormat=n,this._surfaceType=r,this._depthStencilFormat=s,S.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=o,this._minFifter=h,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,e.__super.call(this,this.bitmap,L.INV_UV)}r(e,"laya.webgl.resource.RenderTarget2D",t);var n=e.prototype;return i.imps(n,{"laya.resource.IDispose":!0}),n.getType=function(){return this._type},n.getTexture=function(){return this},n.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},n.release=function(){this.destroy()},n.recycle=function(){e.POOL.push(this)},n.start=function(){var t=xt.mainContext;return this._preRenderTarget=vt.curRenderTarget,vt.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=vt.width,this._svHeight=vt.height,vt.width=this._w,vt.height=this._h,Bt.activeShader=null),this},n.clear=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=xt.mainContext;r.clearColor(t,e,i,n);var s=16384;switch(this._depthStencilFormat){case 33189:s|=256;break;case 36168:s|=1024;break;case 34041:s|=256,s|=1024}r.clear(s)},n.end=function(){var t=xt.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,vt.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),vt.width=this._svWidth,vt.height=this._svHeight,Bt.activeShader=null):t.viewport(0,0,i.stage.width,i.stage.height)},n.getData=function(t,e,i,n){var r=xt.mainContext;if(r.bindFramebuffer(36160,this.bitmap.frameBuffer),36053!==r.checkFramebufferStatus(36160))return r.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._w*this._h*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,s),r.bindFramebuffer(36160,null),s},n.destroy=function(e){void 0===e&&(e=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,t.prototype.destroy.call(this))},n.dispose=function(){},n._createWebGLRenderTarget=function(){this.bitmap=new Xt(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,(function(t){this.event("recovered")}))},s(0,n,"surfaceFormat",(function(){return this._surfaceFormat})),s(0,n,"magFifter",(function(){return this._magFifter})),s(0,n,"surfaceType",(function(){return this._surfaceType})),s(0,n,"mipMap",(function(){return this._mipMap})),s(0,n,"depthStencilFormat",(function(){return this._depthStencilFormat})),s(0,n,"minFifter",(function(){return this._minFifter})),s(0,n,"source",(function(){return this._alreadyResolved?i.superGet(L,this,"source"):null})),e.create=function(t,i,n,r,s,a,o,h,l){void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===h&&(h=-1),void 0===l&&(l=-1);var c=e.POOL.pop();return c||(c=new e(t,i)),c.bitmap&&c._w==t&&c._h==i&&c._surfaceFormat==n&&c._surfaceType==r&&c._depthStencilFormat==s&&c._mipMap==a&&c._repeat==o&&c._minFifter==h&&c._magFifter==l||(c._w=t,c._h=i,c._surfaceFormat=n,c._surfaceType=r,c._depthStencilFormat=s,S.isConchWebGL&&34041===c._depthStencilFormat&&(c._depthStencilFormat=33189),c._mipMap=a,c._repeat=o,c._minFifter=h,c._magFifter=l,c.release(),c._createWebGLRenderTarget()),c},e.TYPE2D=1,e.TYPE3D=2,e.POOL=[],e}(L),Ft=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=xt.mainContext}r(e,"laya.webgl.utils.Buffer",C);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Bt.activeShader=null)},i.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.disposeResource=function(){this._glBuffer&&(xt.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},s(0,i,"bufferUsage",(function(){return this._bufferUsage})),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}(),kt=function(t){function e(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,e.__super.call(this,512,0);var i=8*pt.BYTES_PE;this.position=[2,5126,!1,i,0],this.texcoord=[2,5126,!1,i,2*pt.BYTES_PE],this.color=[4,5126,!1,i,4*pt.BYTES_PE]}return r(e,"laya.webgl.shader.d2.skinAnishader.SkinSV",Tt),e}(),Vt=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return r(e,"laya.webgl.shader.d2.value.Color2dSV",Tt),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),Ut=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=Tt._TEXCOORD,e.__super.call(this,256,0)}r(e,"laya.webgl.shader.d2.value.FillTextureSV",Tt);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},e}(),Ht=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=Tt._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}r(e,"laya.webgl.shader.d2.value.TextureSV",Tt);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},e}(),zt=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*pt.BYTES_PE,0],this.a_color=[3,5126,!1,5*pt.BYTES_PE,2*pt.BYTES_PE]}return r(e,"laya.webgl.shader.d2.value.PrimitiveSV",Tt),e}(),Wt=function(t){function e(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}r(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){var t=xt.mainContext,e=this._source=t.createTexture(),i=wt.curBindTexTarget,n=wt.curBindTexValue;wt.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&n&&wt.bindTexture(t,i,n),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(xt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(S.isFlash){this._flashCacheImage||(this._flashCacheImage=v.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var n=i.bitmapdata;this._flashCacheImage._image.copyPixels(n,0,0,n.width,n.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var r=xt.mainContext,s=wt.curBindTexTarget,a=wt.curBindTexValue;wt.bindTexture(r,3553,this._source),r.pixelStorei(37441,!0),0<=t-1&&r.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2D(3553,0,t+1,e,6408,5121,i),0<=e-1&&r.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2D(3553,0,t,e+1,6408,5121,i),r.texSubImage2D(3553,0,t,e,6408,5121,i),r.pixelStorei(37441,!1),s&&a&&wt.bindTexture(r,s,a)}},i.texSubImage2DPixel=function(t,e,i,n,r){var s=xt.mainContext,a=wt.curBindTexTarget,o=wt.curBindTexValue;wt.bindTexture(s,3553,this._source);var h=new Uint8Array(r.data);s.pixelStorei(37441,!0),s.texSubImage2D(3553,0,t,e,i,n,6408,5121,h),s.pixelStorei(37441,!1),a&&o&&wt.bindTexture(s,a,o)},s(0,i,"width",t.prototype._$get_width,(function(t){this._w=t})),s(0,i,"height",t.prototype._$get_height,(function(t){this._h=t})),e}(l),Gt=function(t){function e(){this.flipY=!0,this.alwaysChange=!1,e.__super.call(this)}r(e,"laya.webgl.resource.WebGLCanvas",l);var i=e.prototype;return i.getCanvas=function(){return this._canvas},i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},i._setContext=function(t){this._ctx=t},i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)},i.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},i.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},i.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&!this.iscpuSource&&(xt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.createWebGlTexture=function(){var t=xt.mainContext;this._canvas;var i=this._source=t.createTexture();this.iscpuSource=!1;var n=wt.curBindTexTarget,r=wt.curBindTexValue;wt.bindTexture(t,3553,i),t.pixelStorei(37440,this.flipY?1:0),e.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),e.premulAlpha&&t.pixelStorei(37441,!1),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,n&&r&&wt.bindTexture(t,n,r)},i.reloadCanvasData=function(){var t=xt.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var i=wt.curBindTexTarget,n=wt.curBindTexValue;wt.bindTexture(t,3553,this._source),e.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),e.premulAlpha&&t.pixelStorei(37441,!1),t.pixelStorei(37440,0),i&&n&&wt.bindTexture(t,i,n)},i.texSubImage2D=function(t,e,i){var n=xt.mainContext,r=wt.curBindTexTarget,s=wt.curBindTexValue;wt.bindTexture(n,3553,this._source),n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,i,6408,5121,t._source),n.pixelStorei(37441,!1),r&&s&&wt.bindTexture(n,r,s)},i.toBase64=function(t,e,i){var n=null;this._canvas&&(n=this._canvas.toDataURL(t,e)),i.call(this,n)},s(0,i,"context",(function(){return this._ctx})),s(0,i,"source",(function(){return this.alwaysChange&&this.reloadCanvasData(),this._source})),s(0,i,"asBitmap",null,(function(t){this._ctx&&(this._ctx.asBitmap=t)})),e._createContext=null,e.premulAlpha=!1,e}(),Yt=function(t){function e(t,i){this.CborderSize=12,e.__super.call(this),this.char=t,this.isSpace=" "===t,this.xs=i.scaleX,this.ys=i.scaleY,this.font=i.font.toString(),this.fontSize=i.font.size,this.fillColor=i.fillColor,this.borderColor=i.borderColor,this.lineWidth=i.lineWidth,this.underLine=i.underLine;var n,r=S.isConchApp;r?((n=ConchTextCanvas)._source=ConchTextCanvas,n._source.canvas=ConchTextCanvas):n=c.canvas.source,this.canvas=n,this._enableMerageInAtlas=!0,this._ctx=r?n:this.canvas.getContext("2d",void 0);var s=B.measureText(this.char,this.font);this.cw=s.width*this.xs,this.ch=(s.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new L(this)}r(e,"laya.webgl.resource.WebGLCharImage",l);var n=e.prototype;return i.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n.active=function(){this.texture.active()},n.recreateResource=function(){var t=S.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var i=this.fontSize;1==this.xs&&1==this.ys||(i=parseInt(i*(this.xs>this.ys?this.xs:this.ys)+""));var n="normal 100 "+this.font;n=n.replace(e._fontSizeReg,i),this.borderColor&&(n+=" 1 "+this.borderColor),this._ctx.font=n,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,N.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var r=this._ctx.measureText(this.char);r||(r={width:16});var s=r.width+1;this._ctx.lineTo(s,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},n.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},n.clearAtlasSource=function(){},s(0,n,"allowMerageInAtlas",(function(){return this._allowMerageInAtlas})),s(0,n,"atlasSource",(function(){return this.canvas})),s(0,n,"enableMerageInAtlas",(function(){return this._enableMerageInAtlas}),(function(t){this._enableMerageInAtlas=t})),e.createOneChar=function(t,i){return new e(t,i)},e._fontSizeReg=new RegExp("\\d+(?=px)","g"),e}(),Xt=function(t){function e(t,i,n,r,s,a,o,h,l){void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===h&&(h=-1),void 0===l&&(l=1),e.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=t,this._h=i,this._surfaceFormat=n,this._surfaceType=r,this._depthStencilFormat=s,this._mipMap=a,this._repeat=o,this._minFifter=h,this._magFifter=l}r(e,"laya.webgl.resource.WebGLRenderTarget",l);var i=e.prototype;return i.recreateResource=function(){var t=xt.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=wt.curBindTexTarget,i=wt.curBindTexValue;wt.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,s=this._repeat?10497:33071,a=o.isPOT(this._w,this._h);if(a?(this._mipMap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this._mipMap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&wt.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),a&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._frameBuffer&&(xt.mainContext.deleteTexture(this._source),xt.mainContext.deleteFramebuffer(this._frameBuffer),xt.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},s(0,i,"depthStencilBuffer",(function(){return this._depthStencilBuffer})),s(0,i,"frameBuffer",(function(){return this._frameBuffer})),e}(),jt=function(t){function e(t,i,n,r,s,a,o){this.offsetX=0,this.offsetY=0,e.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=a,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=r,this._h=s,this.offsetX=i,this.offsetY=n,this.src=o,this._enableMerageInAtlas=!0,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}r(e,"laya.webgl.resource.WebGLSubImage",l);var n=e.prototype;return i.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},n.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},n.createWebGlTexture=function(){var t=xt.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=wt.curBindTexTarget,n=wt.curBindTexValue;wt.bindTexture(t,3553,e),t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1);var r=this.minFifter,s=this.magFifter,a=this.repeat?10497:33071,h=o.isPOT(this.width,this.height);h?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==s||(s=9729),t.texParameteri(3553,10240,s),t.texParameteri(3553,10241,r),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==s||(s=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&n&&wt.bindTexture(t,i,n),this.canvas=null,h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},n.disposeResource=function(){U.enabled&&this._allowMerageInAtlas||!this._source||(xt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n.clearAtlasSource=function(){},s(0,n,"allowMerageInAtlas",(function(){return this._allowMerageInAtlas})),s(0,n,"atlasSource",(function(){return this.canvas})),s(0,n,"enableMerageInAtlas",(function(){return this._allowMerageInAtlas}),(function(t){this._allowMerageInAtlas=t})),e}(),Kt=function(t){function e(t,i,n,r){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,e.__super.call(this),!t||!i)throw"Shader Error";this._id=++e._count,this._vs=t,this._ps=i,this._nameMap=r||{},null!=n&&(e.sharders[n]=this)}r(e,"laya.webgl.shader.Shader",Bt);var i=e.prototype;return i.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},i.disposeResource=function(){xt.mainContext.deleteShader(this._vshader),xt.mainContext.deleteShader(this._pshader),xt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},i._compile=function(){if(!xt.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t=[this._vs,this._ps],i=xt.mainContext;if(this._program=i.createProgram(),this._vshader=e._createShader(i,t[0],35633),this._pshader=e._createShader(i,t[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),!S.isConchApp&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var n,r,s,a=0;for(s=S.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35721):i.getProgramParameter(this._program,35721),a=0;a<s;a++){var o=null;n={vartype:"attribute",glfun:null,ivartype:0,attrib:o=S.isConchApp?i.getActiveAttribEx(this._vs,this._ps,"",a):i.getActiveAttrib(this._program,a),location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(n)}var h;for(h=S.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35718):i.getProgramParameter(this._program,35718),a=0;a<h;a++){var l;l=S.isConchApp?i.getActiveUniformEx(this._vs,this._ps,"",a):i.getActiveUniform(this._program,a),0<(n={vartype:"uniform",glfun:null,ivartype:1,attrib:o,location:i.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._params.push(n)}for(a=0,r=this._params.length;a<r;a++)if((n=this._params[a]).indexOfParams=a,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=this._nameMap[n.codename]?this._nameMap[n.codename]:n.codename,(this._paramsMap[n.name]=n)._this=this,n.uploadedValue=[],"attribute"!==n.vartype)switch(n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.glfun=i.uniformMatrix4fv,n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else n.fun=this._attribute}},i.getUniform=function(t){return this._paramsMap[t]},i._attribute=function(t,e){var i=xt.mainContext,n=Ft._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]+this._offset),n[r]=Ft._bindVertexBuffer,1},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(xt.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return xt.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(xt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return xt.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(xt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return xt.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return xt.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return xt.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return xt.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return xt.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(xt.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return xt.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(xt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return xt.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(xt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return xt.mainContext.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(xt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return xt.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,i){var n=xt.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(e._TEXTURES[this._curActTexIndex]),wt.bindTexture(n,3553,i),this._curActTexIndex++,1):(n.activeTexture(e._TEXTURES[r[0]]),wt.bindTexture(n,3553,i),0)},i._uniform_samplerCube=function(t,i){var n=xt.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,n.uniform1i(t.location,this._curActTexIndex),n.activeTexture(e._TEXTURES[this._curActTexIndex]),wt.bindTexture(n,34067,i),this._curActTexIndex++,1):(n.activeTexture(e._TEXTURES[r[0]]),wt.bindTexture(n,34067,i),0)},i._noSetValue=function(t){console.log("no....:"+t.name)},i.uploadOne=function(t,e){this.activeResource(),wt.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},i.uploadTexture2D=function(t){D.shaderCall++;var e=xt.mainContext;e.activeTexture(33984),wt.bindTexture(e,3553,t)},i.uploadTexture2D1=function(t){D.shaderCall++;var e=xt.mainContext;e.activeTexture(33985),wt.bindTexture(e,3553,t)},i.upload=function(t,e){Bt.activeShader=Bt.bindShader=this,this._lastUseFrameCount===D.loopCount||this.activeResource(),wt.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params,xt.mainContext;for(var i,n,r=e.length,s=0,a=0;a<r;a++)null!==(n=t[(i=e[a]).name])&&(s+=i.fun.call(this,i,n));D.shaderCall+=s},i.uploadArray=function(t,e,i){Bt.activeShader=this,(Bt.bindShader=this).activeResource(),wt.UseProgram(this._program),this._params;for(var n,r,s=0,a=e-2;0<=a;a-=2)(r=this._paramsMap[t[a]])&&null!=(n=t[a+1])&&(i&&i[r.name]&&i[r.name].bind(),s+=r.fun.call(this,r,n));D.shaderCall+=s},i.getParams=function(){return this._params},e.getShader=function(t){return e.sharders[t]},e.create=function(t,i,n,r){return new e(t,i,n,r)},e.withCompile=function(t,i,n,r){if(n&&e.sharders[n])return e.sharders[n];var s=e._preCompileShader[2e-4*t];if(!s)throw new Error("withCompile shader err!"+t);return s.createShader(i,n,r)},e.withCompile2D=function(t,i,n,r,s){if(r&&e.sharders[r])return e.sharders[r];var a=e._preCompileShader[2e-4*t+i];if(!a)throw new Error("withCompile shader err!"+t+" "+i);return a.createShader(n,r,s)},e.addInclude=function(t,e){yt.addInclude(t,e)},e.preCompile=function(t,i,n,r){var s=2e-4*t;e._preCompileShader[s]=new yt(s,i,n,r)},e.preCompile2D=function(t,i,n,r,s){var a=2e-4*t+i;e._preCompileShader[a]=new yt(a,n,r,s)},e._createShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),n},e._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],e._count=0,e._preCompileShader={},e.SHADERNAME2ID=2e-4,e.sharders=((e.sharders=[]).length=32,e.sharders),n(e,["nameKey",function(){return this.nameKey=new P}]),e}(),qt=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}r(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),D.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ft._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Ft._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),D.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ft._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var n=this._buffer.slice(e,i);Ft._gl.bufferSubData(this._bufferType,t,n)}else Ft._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){var e,i;this._upload=!0,e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),n=0;n<e;n++)i[n]=t[n];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){var i;this._upload=!0,i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,n){var r,s;void 0===n&&(n=1),this._upload=!0,r=i*n,this._resizeBuffer(this._byteLength+r,!0),s=new e(this._buffer,this._byteLength);var a=0;for(a=0;a<i;a++)s[a]=t[a];this._byteLength+=r,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Ft._gl.bindBuffer(this._bufferType,null),Ft._bindActive[this._bufferType]=null,Bt.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this._bind_subUpload();return Ft._gl.bindBuffer(this._bufferType,null),Ft._bindActive[this._bufferType]=null,Bt.activeShader=null,n},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},s(0,i,"bufferLength",(function(){return this._buffer.byteLength})),s(0,i,"byteLength",null,(function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)})),e.__int__=function(t){Jt.QuadrangleIB=Jt.create(35044),mt.fillIBQuadrangle(Jt.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Ft),Zt=(function(t){function e(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,e.__super.call(this,9)}r(e,"laya.webgl.shader.d2.value.GlowSV",t);var i=e.prototype;i.setValue=function(e){t.prototype.setValue.call(this,e)},i.clear=function(){t.prototype.clear.call(this)}}(Ht),function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}r(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){(e.pool[e._length++]=this).clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(Ht)),Qt=function(t){function e(t,i,n,r){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,e.__super.call(this,t,i,n,r)}r(e,"laya.webgl.shader.d2.Shader2X",t);var i=e.prototype;return i.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},i._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(S.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},i.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},i._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)t=e[i],(S.isFlash||"size"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},e.create=function(t,i,n,r){return new e(t,i,n,r)},e}(Kt),Jt=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,S.isFlash||(this._buffer=new ArrayBuffer(8))}r(e,"laya.webgl.utils.IndexBuffer2D",qt);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),$t=function(t){function e(t,i){this._floatArray32=null,this._vertexStride=0,e.__super.call(this),this._vertexStride=t,this._bufferUsage=i,this._bufferType=34962,S.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}r(e,"laya.webgl.utils.VertexBuffer2D",t);var i=e.prototype;return i.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},i.bind=function(t){t&&t._bind(),this._bind()},i.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},i.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},i._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},i.disposeResource=function(){t.prototype.disposeResource.call(this)},i.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},s(0,i,"vertexStride",(function(){return this._vertexStride})),e.create=function(t,i){return void 0===i&&(i=35048),new e(t,i)},e}(qt),te=function(t){function e(t,i,n,r,s,a){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===n&&(n=6408),void 0===r&&(r=!0),e.__super.call(this,t,i),t){if(this._format=n,this._mipmap=r,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t)this._url=t,this._src=t,this._image=new c.window.Image,i&&(i.onload&&(this.onload=i.onload),i.onerror&&(this.onerror=i.onerror),i.onCreate&&i.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t);else if(t instanceof ArrayBuffer){this._src=i,this._url=this._src;var o=new u(t);o.readUTFBytes(4),o.readUTFBytes(2),o.getInt16(),o.endian="bigEndian",this._w=o.getInt16(),this._h=o.getInt16(),o.getInt16(),o.getInt16(),this._image=new Uint8Array(t,o.pos),this._format=xt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(t instanceof Uint8Array))return this._src=i,this._url=this._src,this._image=t.source||t,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=i,this._url=this._src,this._w=s,this._h=a,this._image=t,this._format=0===n?t.byteLength/(s*a)==4?6408:6407:n}this._$5__enableMerageInAtlas=!0}}r(e,"laya.webgl.resource.WebGLImage",v);var n=e.prototype;return i.imps(n,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),n._init_=function(t,e){},n._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=xt.mainContext,e=this._source=t.createTexture(),i=wt.curBindTexTarget,n=wt.curBindTexValue;wt.bindTexture(t,3553,e);var r=this.minFifter,s=this.magFifter,a=this.repeat?10497:33071,h=o.isPOT(this._w,this._h),l=!1;switch(h?(this.mipmap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==s||(s=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this.mipmap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==s||(s=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:l=!0,t.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case xt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:l=!0,t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}t.pixelStorei(37441,!1),i&&n&&wt.bindTexture(t,i,n),this.uri||(this.uri=this._url),l?this.memorySize=this._image.length:h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},n.recreateResource=function(){var t=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var e=this;this._image=new c.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._image.onload=null,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),e.completeCreate()},this._image.src=this._src}},n.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&xt.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},n.onresize=function(){this._w=this._image.width,this._h=this._image.height,U.enabled&&this._w<U.atlasLimitWidth&&this._h<U.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},n.clearAtlasSource=function(){this._image=null},s(0,n,"format",(function(){return this._format})),s(0,n,"enableMerageInAtlas",(function(){return this._$5__enableMerageInAtlas}),(function(t){this._$5__enableMerageInAtlas=t})),s(0,n,"mipmap",(function(){return this._mipmap})),s(0,n,"allowMerageInAtlas",(function(){return this._allowMerageInAtlas})),s(0,n,"atlasSource",(function(){return this._image})),s(0,n,"onload",null,(function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)})),s(0,n,"onerror",null,(function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)})),e}();i.__init([_t,V,St,yt])}(window,document,c),void 0!==(r=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),c){var n=c[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))&&(t.exports=r),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,a=(i.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),o=laya.utils.ClassUtils,h=(laya.events.Event,laya.utils.HTMLChar),l=laya.net.Loader,c=(laya.display.Node,laya.maths.Rectangle),u=laya.renders.Render,d=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),_=laya.utils.Stat,f=laya.display.Text,p=laya.resource.Texture,m=laya.net.URL,g=laya.utils.Utils,v=function(){function t(){}return r(t,"laya.html.utils.HTMLParse"),t.parse=function(e,i,n){i=(i="<root>"+(i=i.replace(/<br>/g,"<br/>"))+"</root>").replace(t.spacePattern,t.char255);var r=g.parseXMLFromString(i);t._parseXML(e,r.childNodes[0].childNodes,n)},t._parseXML=function(e,i,n,r){var s=0,a=0;if(i.join||i.item)for(s=0,a=i.length;s<a;++s)t._parseXML(e,i[s],n,r);else{var h,l,c;if(3==i.nodeType)return void(e instanceof laya.html.dom.HTMLDivElement?(null==i.nodeName&&(i.nodeName="#text"),l=i.nodeName.toLowerCase(),0<(c=i.textContent.replace(/^\s+|\s+$/g,"")).length&&(h=o.getInstance(l))&&(e.addChild(h),h.innerTEXT=c.replace(t.char255AndOneSpacePattern," "))):0<(c=i.textContent.replace(/^\s+|\s+$/g,"")).length&&(e.innerTEXT=c.replace(t.char255AndOneSpacePattern," ")));if("#comment"==(l=i.nodeName.toLowerCase()))return;if(h=o.getInstance(l)){(h=e.addChild(h)).URI=n,h.href=r;var u=i.attributes;if(u&&0<u.length)for(s=0,a=u.length;s<a;++s){var d=u[s],_=d.nodeName,f=d.value;h._setAttributes(_,f)}t._parseXML(h,i.childNodes,n,h.href)}else t._parseXML(e,i.childNodes,n,r)}},t.char255=String.fromCharCode(255),t.spacePattern=/&nbsp;|&#160;/g,t.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),t}(),y=function(){function t(){}return r(t,"laya.html.utils.Layout"),t.later=function(e){null==t._will&&(t._will=[],i.stage.frameLoop(1,null,(function(){if(!(t._will.length<1)){for(var e=0;e<t._will.length;e++)laya.html.utils.Layout.layout(t._will[e]);t._will.length=0}}))),t._will.push(e)},t.layout=function(e){if(!e||!e._style)return null;if(0==(512&e._style._type))return null;e.getStyle()._type&=-513;var i=t._multiLineLayout(e);return u.isConchApp&&e.layaoutCallNative&&e.layaoutCallNative(),i},t._multiLineLayout=function(e){if(f.RightToLeft)return t._multiLineLayout2(e);var n=new Array;e._addChildsToLayout(n);var r,s,a,o,h,l=0,c=n.length,u=e._getCSSStyle(),d=u.letterSpacing,_=u.leading,p=u.lineHeight,m=u._widthAuto()||!u.wordWrap,g=m?999999:e.width,v=(e.height,0),y=u.italic?u.fontSize/3:0,w=u._getAlign(),b=u._getValign(),S=0!==b||0!==w||0!=p,T=0,C=0,M=0,I=0,E=new Array,A=E[0]=new x,D=!1,P=!1;A.h=0,u.italic&&(g-=u.fontSize/3);var R=0,N=!0;function L(){A.y=C,C+=A.h+_,0==A.h&&(C+=p),A.mWidth=R,R=0,A=new x,E.push(A),A.h=0,D=!(N=!(T=0))}if(f.WordSplitArr&&f.WordSplitArr.length){var B,O=[],F=[],k=0,V=0,U=0;for(l=0;l<c;l++)if(B=n[l],F.push(B),B?(U+=V=B instanceof laya.html.dom.HTMLBrElement?0:B._isChar()?B.width+d:(a=B._getCSSStyle().padding,B.width*B._style._tf.scaleX+a[1]+a[3]+d),k+=V,(B&&B instanceof laya.html.dom.HTMLBrElement||B&&"\n"===B.char||l==c-1||-1!=i.Text.WordSplitArr.indexOf(B.char))&&(O.push(F),F=[],U=0)):(U+=t.DIV_ELEMENT_PADDING,k+=t.DIV_ELEMENT_PADDING),B&&B instanceof laya.html.dom.HTMLBrElement||B&&"\n"===B.char||l==c-1||g<k){k=U;for(var H=0;H<O.length;H++)for(var z=0;z<O[H].length;z++)null!=(r=O[H][z])?(N=!1,r instanceof laya.html.dom.HTMLBrElement?A.y=C:(r._isChar()?((o=r).isWord?A.wordStartIndex=A.elements.length:(M=o.width+o.style.letterSpacing,R+=o.width),M=o.width+d,I=o.height,A.minTextHeight=Math.min(A.minTextHeight,r.height)):(s=r._getCSSStyle(),h=r,a=s.padding,0===s._getCssFloat()||(S=!0),D=P||s.lineElement,M=h.width*h._style._tf.scaleX+a[1]+a[3]+d,I=h.height*h._style._tf.scaleY+a[0]+a[2]),A.elements.push(r),A.h=Math.max(A.h,I),r.x=T,r.y=C,T+=M,A.w=T-d,A.y=C,v=Math.max(T+y,v))):(N||(T+=t.DIV_ELEMENT_PADDING),A.wordStartIndex=A.elements.length);O=[],l<c-1&&L()}}else for(l=0;l<c;l++)if(null!=(r=n[l]))if(N=!1,r instanceof laya.html.dom.HTMLBrElement)L(),A.y=C;else{if(r._isChar()){if((o=r).isWord)D=P||"\n"===o.char,A.wordStartIndex=A.elements.length;else{if(M=o.width+o.style.letterSpacing,0<E.length&&g<T+M&&0<A.wordStartIndex){var W;W=A.elements.length-A.wordStartIndex+1,A.elements.length=A.wordStartIndex,l-=W,L();continue}D=!1,R+=o.width}M=o.width+d,I=o.height,P=!1,(D=D||g<T+M)&&L(),A.minTextHeight=Math.min(A.minTextHeight,r.height)}else s=r._getCSSStyle(),h=r,a=s.padding,0===s._getCssFloat()||(S=!0),D=P||s.lineElement,M=h.width*h._style._tf.scaleX+a[1]+a[3]+d,I=h.height*h._style._tf.scaleY+a[0]+a[2],P=s.lineElement,(D=D||g<T+M&&s.wordWrap)&&L();A.elements.push(r),A.h=Math.max(A.h,I),r.x=T,r.y=C,T+=M,A.w=T-d,A.y=C,v=Math.max(T+y,v)}else N||(T+=t.DIV_ELEMENT_PADDING),A.wordStartIndex=A.elements.length;if(C=A.y+A.h,S){var G=0,Y=g;for(m&&0<e.width&&(Y=e.width),l=0,c=E.length;l<c;l++)E[l].updatePos(0,Y,l,G,w,b,p),G+=Math.max(p,E[l].h+_);C=G}return m&&(e.width=v),C>e.height&&(e.height=C),[v,C]},t._multiLineLayout2=function(e){var n=new Array;e._addChildsToLayout(n);var r,s,a,o,h,l=0,c=n.length,u=e._getCSSStyle(),d=u.letterSpacing,_=u.leading,p=u.lineHeight,m=u._widthAuto()||!u.wordWrap,g=m?999999:e.width,v=(e.height,0),y=u.italic?u.fontSize/3:0,w=2-u._getAlign(),b=u._getValign(),S=0!==b||0!=w||0!=p,T=0,C=0,M=0,I=0,E=new Array,A=E[0]=new x,D=!1,P=!1;A.h=0,u.italic&&(g-=u.fontSize/3);var R=0,N=!0;function L(){A.y=C,C+=A.h+_,0==A.h&&(C+=p),A.mWidth=R,R=0,A=new x,E.push(A),A.h=0,D=!(N=!(T=0))}if(f.WordSplitArr&&f.WordSplitArr.length){var B,O=[],F=[],k=0,V=0,U=0;for(l=0;l<c;l++)if(B=n[l],F.push(B),B?(U+=V=B instanceof laya.html.dom.HTMLBrElement?0:B._isChar()?B.width+d:(a=B._getCSSStyle().padding,B.width*B._style._tf.scaleX+a[1]+a[3]+d),k+=V,(B&&B instanceof laya.html.dom.HTMLBrElement||B&&"\n"===B.char||l==c-1||-1!=i.Text.WordSplitArr.indexOf(B.char))&&(O.push(F),F=[],U=0)):(U+=t.DIV_ELEMENT_PADDING,k+=t.DIV_ELEMENT_PADDING),B&&B instanceof laya.html.dom.HTMLBrElement||B&&"\n"===B.char||l==c-1||g<k){k=U;for(var H=0;H<O.length;H++)for(var z=0;z<O[H].length;z++)null!=(r=O[H][z])?(N=!1,r instanceof laya.html.dom.HTMLBrElement?A.y=C:(r._isChar()?((o=r).isWord?A.wordStartIndex=A.elements.length:(M=o.width+o.style.letterSpacing,R+=o.width),M=o.width+d,I=o.height,A.minTextHeight=Math.min(A.minTextHeight,r.height)):(s=r._getCSSStyle(),h=r,a=s.padding,0===s._getCssFloat()||(S=!0),D=P||s.lineElement,M=h.width*h._style._tf.scaleX+a[1]+a[3]+d,I=h.height*h._style._tf.scaleY+a[0]+a[2]),A.elements.push(r),A.h=Math.max(A.h,I),r.x=T,r.y=C,T+=M,A.w=T-d,A.y=C,v=Math.max(T+y,v))):(N||(T+=t.DIV_ELEMENT_PADDING),A.wordStartIndex=A.elements.length);O=[],l<c-1&&L()}}else for(l=0;l<c;l++)if(null!=(r=n[l]))if(N=!1,r instanceof laya.html.dom.HTMLBrElement)L(),A.y=C;else{if(r._isChar()){if((o=r).isWord)D=P||"\n"===o.char,A.wordStartIndex=A.elements.length;else{if(0<E.length&&g<T+M&&0<A.wordStartIndex){var W;W=A.elements.length-A.wordStartIndex+1,A.elements.length=A.wordStartIndex,l-=W,L();continue}D=!1,R+=o.width}M=o.width+d,I=o.height,P=!1,(D=D||g<T+M)&&L(),A.minTextHeight=Math.min(A.minTextHeight,r.height)}else s=r._getCSSStyle(),h=r,a=s.padding,0===s._getCssFloat()||(S=!0),D=P||s.lineElement,M=h.width*h._style._tf.scaleX+a[1]+a[3]+d,I=h.height*h._style._tf.scaleY+a[0]+a[2],P=s.lineElement,(D=D||g<T+M&&s.wordWrap)&&L();A.elements.push(r),A.h=Math.max(A.h,I),r.x=T,r.y=C,T+=M,A.w=T-d,A.y=C,v=Math.max(T+y,v)}else N||(T+=t.DIV_ELEMENT_PADDING),A.wordStartIndex=A.elements.length;if(C=A.y+A.h,S){var G=0,Y=g;for(l=0,c=E.length;l<c;l++)E[l].updatePos(0,Y,l,G,w,b,p),G+=Math.max(p,E[l].h+_);C=G}for(m&&(e.width=v),C>e.height&&(e.height=C),l=0,c=E.length;l<c;l++)E[l].revertOrder(g);return[v,C]},t._will=null,t.DIV_ELEMENT_PADDING=0,t}(),x=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}r(t,"laya.html.utils.LayoutLine");var e=t.prototype;return e.updatePos=function(t,e,i,n,r,s,a){var o,h=0;0<this.elements.length&&(h=(o=this.elements[this.elements.length-1]).x+o.width-this.elements[0].x);var l=0,c=NaN;1===r&&(l=(e-h)/2),2===r&&(l=e-h),0===a||0!=s||(s=1);for(var u=0,d=this.elements.length;u<d;u++){var _=(o=this.elements[u])._getCSSStyle();switch(0!==l&&(o.x+=l),_._getValign()){case 0:o.y=n;break;case 1:var f=0;99999!=this.minTextHeight&&(f=this.minTextHeight);var p=(f+a)/2;p=Math.max(p,this.h),laya.html.dom.HTMLImageElement,c=n+p-o.height,o.y=c;break;case 2:o.y=n+(a-o.height)}}},e.revertOrder=function(t){var e;if(0<this.elements.length){var i,n=0;for(i=this.elements.length,n=0;n<i;n++)(e=this.elements[n]).x=t-e.x-e.width}},t}(),w=function(t){function e(){this.URI=null,this._href=null,e.__super.call(this),this._text=e._EMPTYTEXT,this.setStyle(new a(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}r(e,"laya.html.dom.HTMLElement",t);var n=e.prototype;return n.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},n.appendChild=function(t){return this.addChild(t)},n._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,r=0;if(this._text.drawWords)i=this._text.drawWords;else{for(r=(e=t.split(" ")).length-1,i=[],n=0;n<r;n++)i.push(e[n]," ");0<=r&&i.push(e[r]),this._text.drawWords=i}var s,a=this._text.words;if(a&&a.length===i.length)return a;null===a&&(this._text.words=a=[]),a.length=i.length;var o=this.style,l=o.font;for(n=0,r=i.length;n<r;n++){s=g.measureText(i[n],l);var c=a[n]=new h(i[n],s.width,s.height||o.fontSize,o);if(1<c.char.length&&(c.charNum=c.char),this.href){var u=new d;this.addChild(u),c.setSprite(u)}}return a},n._getWords=function(){if(!f.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e,i=this._text.words;if(i&&i.length===t.length)return i;null===i&&(this._text.words=i=[]),i.length=t.length;for(var n=this.style,r=n.font,s=0,a=t.length;s<a;s++)if(e=g.measureText(t.charAt(s),r)){var o=i[s]=new h(t.charAt(s),e.width,e.height||n.fontSize,n);if(this.href){var l=new d;this.addChild(l),o.setSprite(l)}}else console.warn("_getWords size is null"+t.charAt(s),r);return i},n.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],r=0;r<t.length;r++)i=t[r],(e=new d).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},n._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&t.block?(y.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},n._setAttributes=function(e,i){switch(e){case"style":return void this.style.cssText(i);case"class":return void(this.className=i)}t.prototype._setAttributes.call(this,e,i)},n.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)(i=(e=t[n]).getSprite())&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},n.onLinkHandler=function(t){switch(t.type){case"click":for(var e=this;e;)e.event("link",[this.href]),e=e.parent}},n.formatURL=function(t){return this.URI?m.formatURL(t,this.URI?this.URI.path:null):t},s(0,n,"href",(function(){return this._href}),(function(t){null!=(this._href=t)&&(this._getCSSStyle().underLine=1,this.updateHref())})),s(0,n,"color",null,(function(t){this.style.color=t})),s(0,n,"onClick",null,(function(t){i._runScript("fn=function(event){"+t+";}"),this.on("click",this,void 0)})),s(0,n,"id",null,(function(t){S.document.setElementById(t,this)})),s(0,n,"innerTEXT",(function(){return this._text.text}),(function(t){this.text=t})),s(0,n,"style",(function(){return this._style})),s(0,n,"text",(function(){return this._text.text}),(function(t){this._text==e._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),u.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()})),s(0,n,"parent",t.prototype._$get_parent,(function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style.inherit(e.style)}i.superSet(d,this,"parent",t)})),s(0,n,"className",null,(function(t){this.style.attrs(S.document.styleSheets["."+t])})),e.fillWords=function(t,e,i,n,r,s,a){t.graphics.clear();for(var o=0,h=e.length;o<h;o++){var l=e[o];t.graphics.fillText(l.char,l.x+i,l.y+n,r,s,"left",a)}},e._EMPTYTEXT={text:null,words:null},e}(d),b=(r((function t(){t.__super.call(this),this.style.lineElement=!0,this.style.block=!0}),"laya.html.dom.HTMLBrElement",w),function(t){function e(){this.contextHeight=NaN,this.contextWidth=NaN,e.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}r(e,"laya.html.dom.HTMLDivElement",t);var n=e.prototype;return n.appendHTML=function(t){v.parse(this,t,this.URI),this.layout()},n._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach((function(e){t.push(e)}));for(var i=!0,n=0,r=this._childs.length;n<r;n++){var s=this._childs[n];i?i=!1:t.push(null),s._addToLayout(t)}return!0},n._addToLayout=function(t){this.layout()},n.layout=function(){if(this.style){this.style._type|=512;var t=y.layout(this);if(t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new c);var e=this._$P.mHtmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)}}},s(0,n,"height",(function(){return this._height?this._height:this.contextHeight}),t.prototype._$set_height),s(0,n,"innerHTML",null,(function(t){this.destroyChildren(),this.appendHTML(t)})),s(0,n,"width",(function(){return this._width?this._width:this.contextWidth}),(function(t){var e;e=0===t?t!=this._width:t!=this.width,i.superSet(w,this,"width",t),e&&this.layout()})),e}(w)),S=function(t){function e(){this.all=new Array,this.styleSheets=a.styleSheets,e.__super.call(this)}r(e,"laya.html.dom.HTMLDocument",w);var i=e.prototype;return i.getElementById=function(t){return this.all[t]},i.setElementById=function(t,e){this.all[t]=e},n(e,["document",function(){return this.document=new e}]),e}();(function(e){function i(){this._tex=null,this._url=null,this._renderArgs=[],i.__super.call(this),this.style.block=!0}r(i,"laya.html.dom.HTMLImageElement",w);var n=i.prototype;n._addToLayout=function(t){!this._style.absolute&&t.push(this)},n.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(_.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},n.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},s(0,n,"width",(function(){return this.autoSize?this.getSelfBounds().width:this._width}),(function(t){this._width!==t&&(this._width=t,this._style.width=t,this.repaint())})),s(0,n,"height",(function(){return this.autoSize?this.getSelfBounds().height:this._height}),(function(t){this._height!==t&&(this._height=t,this._style.height=t,this.repaint())})),n.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),l.clearCache(this,this._url),this._tex=null),w.prototype.destroy.call(this)},n.onloaded=function(){var t=this._style;t&&!t.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),t&&!t.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),u.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},n._loadImageComplete=function(e,i,n){if(!this._destroyed)if(null!=n)if(n instanceof ArrayBuffer){var r=new DataView(n);new laya.webgl.resource.WebGLImage(new Uint8Array(n,8),e,0,!1,r.getUint32(0),r.getUint32(4)),this.onloaded()}else if(n instanceof p)l.imgMgrSet[e]=i,t.imgMgrLock(e,l.imgMgrSet[e]),this._url=e,this._tex=n,l.keepCache(this,e),l.cacheRes(e,this._tex),this.onloaded();else{var s=-1!=e.indexOf(".png",e.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(n,e,s,!1,n.width,n.height),this.onloaded()}else this.event("error","Load image failed")},s(0,n,"src",null,(function(e){e=this.formatURL(e),this._url!=e&&(null!=this._tex&&(l.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=e,(this._tex=l.getRes(e))?(l.keepCache(this,e),this.onloaded()):t.imgMgrLoad(e,this._loadImageComplete.bind(this),2,!1))}))})(),function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}r(e,"laya.html.dom.HTMLLinkElement",t);var i=e.prototype;i._onload=function(t){switch(this.type){case"text/css":a.parseCSS(t,this.URI)}},s(0,i,"href",t.prototype._$get_href,(function(t){var e=this;t=this.formatURL(t),this.URI=new m(t);var i=new l;i.once("complete",null,(function(t){e._onload(t)})),i.load(t,"text")})),e._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(w),function(t){function e(){e.__super.call(this),this.visible=!1}r(e,"laya.html.dom.HTMLStyleElement",t),s(0,e.prototype,"text",t.prototype._$get_text,(function(t){a.parseCSS(t,null)}))}(w),function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}r(e,"laya.html.dom.HTMLIframeElement",t),s(0,e.prototype,"href",t.prototype._$get_href,(function(t){var e=this;t=this.formatURL(t);var i=new l;i.once("complete",null,(function(i){var n=e.URI;e.URI=new m(t),e.innerHTML=i,!n||(e.URI=n)})),i.load(t,"text")}))}(b)}(window,document,c),void 0!==(r=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),c){var n=c[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))&&(t.exports=r),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,a=(i.__newvec,laya.display.Animation),o=(laya.utils.Browser,laya.utils.ClassUtils),h=laya.filters.ColorFilter,l=laya.utils.Ease,c=laya.events.Event,u=(laya.events.EventDispatcher,laya.display.css.Font),d=laya.display.FrameAnimation,_=laya.display.Graphics,f=laya.utils.Handler,p=laya.display.Input,m=laya.net.Loader,g=(laya.display.Node,laya.maths.Point),v=laya.maths.Rectangle,y=laya.renders.Render,x=laya.display.Sprite,w=laya.display.Text,b=laya.resource.Texture,S=laya.utils.Tween,T=laya.utils.Utils,C=laya.utils.WeakObject;i.interface("laya.ui.IItem"),i.interface("laya.ui.ISelect"),i.interface("laya.ui.IRender"),i.interface("laya.ui.IComponent"),i.interface("laya.ui.IBox","IComponent");var M=function(){function t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return r(t,"laya.ui.LayoutStyle"),n(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),I=function(){function t(){}return r(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,n(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),E=function(){function t(){}return r(t,"laya.ui.UIUtils"),t.fillArray=function(t,e,i){var n=t.concat();if(e)for(var r=e.split(","),s=0,a=Math.min(n.length,r.length);s<a;s++){var o=r[s];n[s]="true"==o||"false"!=o&&o,null!=i&&(n[s]=i(o))}return n},t.toColor=function(t){return T.toHexColor(t)},t.gray=function(e,i){void 0===i&&(i=!0),i?t.addFilter(e,t.grayFilter):t.clearFilter(e,h)},t.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},t.clearFilter=function(t,e){var n=t.filters;if(null!=n&&0<n.length){for(var r=n.length-1;-1<r;r--){var s=n[r];i.__typeof(s,e)&&n.splice(r,1)}t.filters=n}},t._getReplaceStr=function(e){return t.escapeSequence[e]},t.adptString=function(e){return e.replace(/\\(\w)/g,t._getReplaceStr)},t.getBindFun=function(e){var n=t._funMap.get(e);if(null==n){var r='"'+e+'"',s="(function(data){if(data==null)return;with(data){try{\nreturn "+(r=r.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";n=i._runScript(s),t._funMap.set(e,n)}return n},n(t,["grayFilter",function(){return this.grayFilter=new h([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new C}]),t}(),A=function(){function t(){}return r(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t.closeDialogOnSide=!0,t}(),D=function(t){function e(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,e.__super.call(this),this._weakKeys=[]}r(e,"laya.ui.AutoBitmap",t);var n=e.prototype;return n.destroy=function(){if(m.clearObject(this,this._weakKey),this._weakKeys){for(var e=0,i=this._weakKeys.length;e<i;++e)m.clearObject(this,this._weakKeys[e]);this._weakKeys=null}t.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},n._setChanged=function(){this._isChanged||(this._isChanged=!0,i.timer.callLater(this,this.changeSource))},n.changeSource=function(){this._isChanged=!1;var t=this._source;if(t&&t.bitmap){var i=this.width,n=this.height,r=this._sizeGrid,s=t.sourceWidth,a=t.sourceHeight;if(!r||s===i&&a===n)this.cleanByTexture(t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,i,n);else{m.clearObject(this,this._weakKey),t.$_GID||(t.$_GID=T.getGID());var o=t.$_GID+"."+i+"."+n+"."+r.join("."),h=m.findObject(o);if(T.isOKCmdList(h))return this._weakKey=o,m.keepObject(this,this._weakKey),void(this.cmds=h);this.clear();var l,c,u=r[0],d=r[1],_=r[2],f=r[3],p=r[4],g=!1;if(i==s&&(f=d=0),n==a&&(u=_=0),i<f+d){var v=i;g=!0,i=f+d,this.save(),this.clipRect(0,0,v,n)}f&&u&&(l=e.getTexture(t,0,0,f,u),c=this._weakKeys[0],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[0]=l.weakKey),this.drawTexture(l,0,0,f,u)):(m.clearObject(this,c),this._weakKeys[0]="")),d&&u&&(l=e.getTexture(t,s-d,0,d,u),c=this._weakKeys[1],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[1]=l.weakKey),this.drawTexture(l,i-d,0,d,u)):(m.clearObject(this,c),this._weakKeys[1]="")),f&&_&&(l=e.getTexture(t,0,a-_,f,_),c=this._weakKeys[2],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[2]=l.weakKey),this.drawTexture(l,0,n-_,f,_)):(m.clearObject(this,c),this._weakKeys[2]="")),d&&_&&(l=e.getTexture(t,s-d,a-_,d,_),c=this._weakKeys[3],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[3]=l.weakKey),this.drawTexture(l,i-d,n-_,d,_)):(m.clearObject(this,c),this._weakKeys[3]="")),u&&(l=e.getTexture(t,f,0,s-f-d,u),c=this._weakKeys[4],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[4]=l.weakKey),this.drawBitmap(p,l,f,0,i-f-d,u)):(m.clearObject(this,c),this._weakKeys[4]="")),_&&(l=e.getTexture(t,f,a-_,s-f-d,_),c=this._weakKeys[5],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[5]=l.weakKey),this.drawBitmap(p,l,f,n-_,i-f-d,_)):(m.clearObject(this,c),this._weakKeys[5]="")),f&&(l=e.getTexture(t,0,u,f,a-u-_),c=this._weakKeys[6],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[6]=l.weakKey),this.drawBitmap(p,l,0,u,f,n-u-_)):(m.clearObject(this,c),this._weakKeys[6]="")),d&&(l=e.getTexture(t,s-d,u,d,a-u-_),c=this._weakKeys[7],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[7]=l.weakKey),this.drawBitmap(p,l,i-d,u,d,n-u-_)):(m.clearObject(this,c),this._weakKeys[7]="")),l=e.getTexture(t,f,u,s-f-d,a-u-_),c=this._weakKeys[8],l?(c!=l.weakKey&&(m.clearObject(this,c),m.keepObject(this,l.weakKey),this._weakKeys[8]=l.weakKey),this.drawBitmap(p,l,f,u,i-f-d,n-u-_)):(m.clearObject(this,c),this._weakKeys[8]=""),g&&this.restore(),this.autoCacheCmd&&!y.isConchApp&&(m.saveObject(o,this.cmds,null),this._weakKey=o,m.keepObject(this,this._weakKey))}this._repaint()}},n.drawBitmap=function(t,e,i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0),r<.1||s<.1||(!t||e.width==r&&e.height==s?this.drawTexture(e,i,n,r,s):this.fillTexture(e,i,n,r,s))},n.clear=function(e){void 0===e&&(e=!0),t.prototype.clear.call(this,!1)},s(0,n,"sizeGrid",(function(){return this._sizeGrid}),(function(t){this._sizeGrid=t,this._setChanged()})),s(0,n,"width",(function(){return this._width?this._width:this._source?this._source.sourceWidth:0}),(function(t){this._width!=t&&(this._width=t,this._setChanged())})),s(0,n,"height",(function(){return this._height?this._height:this._source?this._source.sourceHeight:0}),(function(t){this._height!=t&&(this._height=t,this._setChanged())})),s(0,n,"source",(function(){return this._source}),(function(t){t?(this._source=t,this._setChanged()):(this._source=null,this.clear())})),e.getTexture=function(t,e,i,n,r){n<=0&&(n=1),r<=0&&(r=1),t.$_GID||(t.$_GID=T.getGID());var s=t.$_GID+"."+e+"."+i+"."+n+"."+r,a=m.findObject(s);if((!a||!a.source)&&(a=b.createFromTexture(t,e,i,n,r))){if(t.alphaTexture){var o=t.width/t.alphaTexture.width;a.alphaTexture=b.createFromTexture(t.alphaTexture,e/o,i/o,n/o,r/o)}m.saveObject(s,a),a.weakKey=s}return a},e}(_),P=(function(t){function e(){e.__super.call(this)}r(e,"laya.ui.UIEvent",c),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip"}(),function(t){function e(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,e.__super.call(this),this._layout=M.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}r(e,"laya.ui.Component",t);var n=e.prototype;return i.imps(n,{"laya.ui.IComponent":!0}),n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},n.preinitialize=function(){},n.createChildren=function(){},n.initialize=function(){},n.callLater=function(t,e){i.timer.callLater(this,t,e)},n.runCallLater=function(t){i.timer.runCallLater(this,t)},n.commitMeasure=function(){},n.changeSize=function(){this.event("resize")},n.getLayout=function(){return this._layout===M.EMPTY&&(this._layout=new M),this._layout},n._setLayoutEnabled=function(t){this._layout&&this._layout.enable!=t&&(this._layout.enable=t,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},n.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},n.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},n.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},n.resetLayoutX=function(){var t=this._layout;if(isNaN(t.anchorX)||(this.pivotX=t.anchorX*this.width),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerX)?isNaN(t.left)?isNaN(t.right)||(this.x=Math.round(e.width-this.displayWidth-t.right+this.pivotX*this.scaleX)):(this.x=Math.round(t.left+this.pivotX*this.scaleX),isNaN(t.right)||(this.width=(e._width-t.left-t.right)/(this.scaleX||.01))):this.x=Math.round(.5*(e.width-this.displayWidth)+t.centerX+this.pivotX*this.scaleX))}},n.resetLayoutY=function(){var t=this._layout;if(isNaN(t.anchorY)||(this.pivotY=t.anchorY*this.height),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerY)?isNaN(t.top)?isNaN(t.bottom)||(this.y=Math.round(e.height-this.displayHeight-t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(t.top+this.pivotY*this.scaleY),isNaN(t.bottom)||(this.height=(e._height-t.top-t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(e.height-this.displayHeight)+t.centerY+this.pivotY*this.scaleY))}},n.onMouseOver=function(t){i.stage.event("showtip",this._toolTip)},n.onMouseOut=function(t){i.stage.event("hidetip",this._toolTip)},s(0,n,"displayWidth",(function(){return this.width*this.scaleX})),s(0,n,"width",(function(){return this._width?this._width:this.measureWidth}),(function(t){this._width!=t&&(this._width=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())})),s(0,n,"measureWidth",(function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.x+i.width*i.scaleX,t))}return t})),s(0,n,"displayHeight",(function(){return this.height*this.scaleY})),s(0,n,"height",(function(){return this._height?this._height:this.measureHeight}),(function(t){this._height!=t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())})),s(0,n,"dataSource",(function(){return this._dataSource}),(function(t){for(var e in this._dataSource=t,this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])})),s(0,n,"scaleY",t.prototype._$get_scaleY,(function(t){i.superGet(x,this,"scaleY")!=t&&(i.superSet(x,this,"scaleY",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())})),s(0,n,"measureHeight",(function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.y+i.height*i.scaleY,t))}return t})),s(0,n,"scaleX",t.prototype._$get_scaleX,(function(t){i.superGet(x,this,"scaleX")!=t&&(i.superSet(x,this,"scaleX",t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())})),s(0,n,"top",(function(){return this._layout.top}),(function(t){t!=this._layout.top&&(this.getLayout().top=t,this._setLayoutEnabled(!0)),this.resetLayoutY()})),s(0,n,"bottom",(function(){return this._layout.bottom}),(function(t){t!=this._layout.bottom&&(this.getLayout().bottom=t,this._setLayoutEnabled(!0)),this.resetLayoutY()})),s(0,n,"left",(function(){return this._layout.left}),(function(t){t!=this._layout.left&&(this.getLayout().left=t,this._setLayoutEnabled(!0)),this.resetLayoutX()})),s(0,n,"right",(function(){return this._layout.right}),(function(t){t!=this._layout.right&&(this.getLayout().right=t,this._setLayoutEnabled(!0)),this.resetLayoutX()})),s(0,n,"centerX",(function(){return this._layout.centerX}),(function(t){t!=this._layout.centerX&&(this.getLayout().centerX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()})),s(0,n,"centerY",(function(){return this._layout.centerY}),(function(t){t!=this._layout.centerY&&(this.getLayout().centerY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()})),s(0,n,"anchorX",(function(){return this._layout.anchorX}),(function(t){t!=this._layout.anchorX&&(this.getLayout().anchorX=t,this._setLayoutEnabled(!0)),this.resetLayoutX()})),s(0,n,"anchorY",(function(){return this._layout.anchorY}),(function(t){t!=this._layout.anchorY&&(this.getLayout().anchorY=t,this._setLayoutEnabled(!0)),this.resetLayoutY()})),s(0,n,"tag",(function(){return this._tag}),(function(t){this._tag=t})),s(0,n,"toolTip",(function(){return this._toolTip}),(function(t){this._toolTip!=t&&(null!=(this._toolTip=t)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))})),s(0,n,"comXml",(function(){return this._comXml}),(function(t){this._comXml=t})),s(0,n,"gray",(function(){return this._gray}),(function(t){t!==this._gray&&(this._gray=t,E.gray(this,t))})),s(0,n,"disabled",(function(){return this._disabled}),(function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)})),e}(x)),R=function(t){function e(){this.lockLayer=null,this.popupEffect=function(t){t.scale(1,1),S.from(t,{x:i.stage.width/2,y:i.stage.height/2,scaleX:0,scaleY:0},300,l.backOut,f.create(this,this.doOpen,[t]))},this.closeEffect=function(t,e){S.to(t,{x:i.stage.width/2,y:i.stage.height/2,scaleX:0,scaleY:0},300,l.strongOut,f.create(this,this.doClose,[t,e]))},e.__super.call(this),this.maskLayer=new x,this.popupEffectHandler=f.create(this,this.popupEffect,null,!1),this.closeEffectHandler=f.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,i.stage.addChild(this),i.stage.on("resize",this,this._onResize),A.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}r(e,"laya.ui.DialogManager",x);var n=e.prototype;return n._closeOnSide=function(){var t=this.getChildAt(this.numChildren-1);t instanceof laya.ui.Dialog&&t.close("side")},n.setLockView=function(t){this.lockLayer||(this.lockLayer=new N,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(i.stage.width,i.stage.height)),this.lockLayer.removeChildren(),t&&(t.centerX=t.centerY=0,this.lockLayer.addChild(t))},n._onResize=function(t){var e=this.maskLayer.width=i.stage.width,n=this.maskLayer.height=i.stage.height;this.lockLayer&&this.lockLayer.size(e,n),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,e,n,A.popupBgColor),this.maskLayer.alpha=A.popupBgAlpha;for(var r=this.numChildren-1;-1<r;r--){var s=this.getChildAt(r);s.popupCenter&&this._centerDialog(s)}},n._centerDialog=function(t){t.x=Math.round((i.stage.width-t.width>>1)+t.pivotX),t.y=Math.round((i.stage.height-t.height>>1)+t.pivotY)},n.open=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e&&this._closeAll(),t.popupCenter&&this._centerDialog(t),this.addChild(t),(t.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),i&&null!=t.popupEffect?t.popupEffect.runWith(t):this.doOpen(t),this.event("open")},n.doOpen=function(t){t.onOpened()},n.lock=function(t){this.lockLayer&&(t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},n.close=function(t,e,i){void 0===i&&(i=!1),i&&null!=t.closeEffect?t.closeEffect.runWith([t,e]):this.doClose(t,e),this.event("close")},n.doClose=function(t,e){t.removeSelf(),t.isModal&&this._checkMask(),t.closeHandler&&t.closeHandler.runWith(e),t.onClosed(e)},n.closeAll=function(){this._closeAll(),this.event("close")},n._closeAll=function(){for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);e&&null!=e.close&&this.doClose(e)}},n.getDialogsByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&e.push(n)}return e},n.closeByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&(n.close(),e.push(n))}return e},n._checkMask=function(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);if(e&&e.isModal)return void this.addChildAt(this.maskLayer,t)}},e}(),N=function(t){function e(){e.__super.call(this)}r(e,"laya.ui.Box",t);var n=e.prototype;return i.imps(n,{"laya.ui.IBox":!0}),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){for(var e in this._dataSource=t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}})),e}(P),L=function(e){function a(t,e){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,a.__super.call(this),this._labelColors=I.buttonLabelColors,this._stateNum=I.buttonStateNum,void 0===e&&(e=""),this.skin=t,this.label=e}r(a,"laya.ui.Button",e);var o=a.prototype;return i.imps(o,{"laya.ui.ISelect":!0}),o.destroy=function(t){this.clearEvent(),m.clearCache(this,this._skin),m.clearObject(this,this._weakKey),void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(t),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},o.clearEvent=function(){this._skin&&t.atalsNotify&&t.atalsNotify.off(this._skin,this,this._setBtnSource)},o.createChildren=function(){this.graphics=this._bitmap=new D},o.createText=function(){this._text||(this._text=new w,this._text.overflow=w.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},o.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},o.onMouse=function(t){if(!1!==this.toggle||!this._selected)return"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=a.stateMap[t.type]))},o.changeClips=function(){var t=m.getRes(this._skin);if(t)if(this._skin&&""!=this._skin){m.clearObject(this,this._weakKey);var e=t.sourceWidth,i=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=T.getGID());var n=t.$_GID+"-"+this._stateNum,r=m.findObject(n);if(T.isOkTextureList(r)||(r=null),r)this._weakKey=n,m.keepObject(this,this._weakKey),this._sources=r;else{if(this._sources=[],1===this._stateNum)this._sources.push(t);else for(var s=0;s<this._stateNum;s++){var a=b.createFromTexture(t,0,i*s,e,i);if(t.alphaTexture){var o=t.width/t.alphaTexture.width;a.alphaTexture=b.createFromTexture(t.alphaTexture,0/o,i*s/o,e/o,i/o)}this._sources.push(a)}m.saveObject(n,this._sources),this._weakKey=n,m.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||e,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=e)}else console.warn("lose skin ",this._skin,this.name,this.__className)},o.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},o._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},s(0,o,"labelStrokeColor",(function(){return this.createText(),this._text.strokeColor}),(function(t){this.createText(),this._text.strokeColor=t})),s(0,o,"measureHeight",(function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height})),s(0,o,"skin",(function(){return this._skin}),(function(e){if(this._skin!=e)if(this.clearEvent(),m.clearCache(this,this._skin),this._skin=e,m.keepCache(this,this._skin),m.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var i=t.resAtalsObj&&t.resAtalsObj[this._skin];i?(t.atalsNotify&&t.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=i.sourceW),0==this.height&&(this.height=i.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}})),o._setBtnSource=function(t,e){t===this._skin&&e&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},s(0,o,"state",(function(){return this._state}),(function(t){this._state!=t&&(this._state=t,this._setStateChanged())})),s(0,o,"text",(function(){return this.createText(),this._text})),s(0,o,"stateNum",(function(){return this._stateNum}),(function(t){"string"==typeof t&&(t=parseInt(t)),this._stateNum!=t&&(this._stateNum=t<1?1:3<t?3:t,this.callLater(this.changeClips))})),s(0,o,"strokeColors",(function(){return this._strokeColors?this._strokeColors.join(","):""}),(function(t){this._strokeColors=E.fillArray(I.buttonLabelColors,t,String),this._setStateChanged()})),s(0,o,"labelColors",(function(){return this._labelColors.join(",")}),(function(t){this._labelColors=E.fillArray(I.buttonLabelColors,t,String),this._setStateChanged()})),s(0,o,"measureWidth",(function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))})),s(0,o,"label",(function(){return this._text?this._text.text:null}),(function(t){(this._text||t)&&(this.createText(),this._text.text!=t&&(t&&!this._text.parent&&this.addChild(this._text),this._text.text=(t+"").replace(/\\n/g,"\n"),this._setStateChanged()))})),s(0,o,"selected",(function(){return this._selected}),(function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))})),s(0,o,"labelPadding",(function(){return this.createText(),this._text.padding.join(",")}),(function(t){this.createText(),this._text.padding=E.fillArray(I.labelPadding,t,Number)})),s(0,o,"labelSize",(function(){return this.createText(),this._text.fontSize}),(function(t){this.createText(),this._text.fontSize=t})),s(0,o,"labelStroke",(function(){return this.createText(),this._text.stroke}),(function(t){this.createText(),this._text.stroke=t})),s(0,o,"labelBold",(function(){return this.createText(),this._text.bold}),(function(t){this.createText(),this._text.bold=t})),s(0,o,"labelFont",(function(){return this.createText(),this._text.font}),(function(t){this.createText(),this._text.font=t})),s(0,o,"labelAlign",(function(){return this.createText(),this._text.align}),(function(t){this.createText(),this._text.align=t})),s(0,o,"clickHandler",(function(){return this._clickHandler}),(function(t){this._clickHandler=t})),s(0,o,"sizeGrid",(function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null}),(function(t){this._bitmap.sizeGrid=E.fillArray(I.defaultSizeGrid,t,Number)})),s(0,o,"width",e.prototype._$get_width,(function(t){i.superSet(P,this,"width",t),this._autoSize&&(this._bitmap.width=t,this._text&&(this._text.width=t))})),s(0,o,"height",e.prototype._$get_height,(function(t){i.superSet(P,this,"height",t),this._autoSize&&(this._bitmap.height=t,this._text&&(this._text.height=t))})),s(0,o,"dataSource",e.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.label=t+"":i.superSet(P,this,"dataSource",t)})),s(0,o,"iconOffset",(function(){return this._bitmap._offset?this._bitmap._offset.join(","):null}),(function(t){this._bitmap._offset=t?E.fillArray([1,1],t,Number):[]})),n(a,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),a}(P),B=function(e){function n(t,e,i){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,n.__super.call(this),void 0===e&&(e=1),void 0===i&&(i=1),this._clipX=e,this._clipY=i,this.skin=t}r(n,"laya.ui.Clip",e);var a=n.prototype;return a.destroy=function(t){this.clearEvent(),this.clearLoad(),m.clearCache(this,this._skin),m.clearObject(this,this._weakKey),void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},a.dispose=function(){this.destroy(!0),i.loader.clearRes(this._skin)},a.createChildren=function(){this.graphics=this._bitmap=new D},a._onDisplay=function(t){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},a.changeClip=function(){if(this._clipChanged=!1,this._skin){var e=m.getRes(this._skin);if(e)this.loadComplete(this._skin,e);else{if(t.resAtalsObj&&t.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=f.create(this,this.loadComplete,[this._skin]),this._progress=null,i.loader.load(this._skin,this._complete,this._progress)}}},a.loadComplete=function(t,e){if(t===this._skin&&e){m.clearObject(this,this._weakKey);var i=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX),n=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY),r=this._skin+i+n,s=m.findObject(r);if(T.isOkTextureList(s)||(s=null),s)this._weakKey=r,m.keepObject(this,this._weakKey),this._sources=s;else{this._sources=[];for(var a=0;a<this._clipY;a++)for(var o=0;o<this._clipX;o++){var h=b.createFromTexture(e,i*o,n*a,i,n);if(e.alphaTexture){var l=e.width/e.alphaTexture.width;h.alphaTexture=b.createFromTexture(e.alphaTexture,i*o/l,n*a/l,i/l,n/l)}this._sources.push(h)}m.saveObject(r,this._sources),this._weakKey=r,m.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},a.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this._isPlaying=!0,this.index=t,this._toIndex=e,this._index++,i.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},a._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},a.stop=function(){this._isPlaying=!1,i.timer.clear(this,this._loop),this.event("complete")},a._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},s(0,a,"interval",(function(){return this._interval}),(function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())})),a.clearEvent=function(){this._skin&&t.atalsNotify&&t.atalsNotify.off(this._skin,this,this._setBtnSource)},a.clearLoad=function(){this._skin&&((this._complete||this._progress)&&i.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},s(0,a,"skin",(function(){return this._skin}),(function(e){if(this._skin!=e)if(this.clearLoad(),this.clearEvent(),m.clearCache(this,this._skin),this._skin=e){m.keepCache(this,this._skin);var i=m.getRes(e),n=t.resAtalsObj&&t.resAtalsObj[this._skin];!i&&n?t.atalsNotify&&t.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null})),a._setBtnSource=function(t,e){t===this._skin&&e&&(this.loadComplete(t,e),this.clearEvent())},s(0,a,"sources",(function(){return this._sources}),(function(t){this._sources=t,this.index=this._index,this.event("loaded")})),s(0,a,"clipX",(function(){return this._clipX}),(function(t){this._clipX=t||1,this._setClipChanged()})),s(0,a,"clipY",(function(){return this._clipY}),(function(t){this._clipY=t||1,this._setClipChanged()})),s(0,a,"total",(function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0})),s(0,a,"clipWidth",(function(){return this._clipWidth}),(function(t){this._clipWidth=t,this._setClipChanged()})),s(0,a,"sizeGrid",(function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null}),(function(t){this._bitmap.sizeGrid=E.fillArray(I.defaultSizeGrid,t,Number)})),s(0,a,"group",(function(){return this._group}),(function(t){t&&this._skin&&m.setGroup(this._skin,t),this._group=t})),s(0,a,"clipHeight",(function(){return this._clipHeight}),(function(t){this._clipHeight=t,this._setClipChanged()})),s(0,a,"width",e.prototype._$get_width,(function(t){i.superSet(P,this,"width",t),this._bitmap.width=t})),s(0,a,"height",e.prototype._$get_height,(function(t){i.superSet(P,this,"height",t),this._bitmap.height=t})),s(0,a,"measureWidth",(function(){return this.runCallLater(this.changeClip),this._bitmap.width})),s(0,a,"measureHeight",(function(){return this.runCallLater(this.changeClip),this._bitmap.height})),s(0,a,"index",(function(){return this._index}),(function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")})),s(0,a,"autoPlay",(function(){return this._autoPlay}),(function(t){this._autoPlay!=t&&((this._autoPlay=t)?this.play():this.stop())})),s(0,a,"isPlaying",(function(){return this._isPlaying}),(function(t){this._isPlaying=t})),s(0,a,"dataSource",e.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.index=parseInt(t):i.superSet(P,this,"dataSource",t)})),s(0,a,"bitmap",(function(){return this._bitmap})),n}(P),O=function(t){function e(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,e.__super.call(this)}r(e,"laya.ui.ColorPicker",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._colorPanel&&this._colorPanel.destroy(e),this._colorButton&&this._colorButton.destroy(e),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},n.createChildren=function(){this.addChild(this._colorButton=new L),this._colorPanel=new N,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new x),this._colorPanel.addChild(this._colorBlock=new x),this._colorPanel.addChild(this._colorInput=new p)},n.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},n.onPanelMouseDown=function(t){t.stopPropagation()},n.changePanel=function(){this._panelChanged=!1;var t=this._colorPanel.graphics;t.clear(),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(t=this._colorTiles.graphics).clear();for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var n=0;n<20;n++){var r;r=0===n?e[i]:1===n?0:51*(((3*i+n/6)%3<<0)+3*(i/6<<0))<<16|n%6*51<<8|(i<<0)%6*51;var s=E.toColor(r);this._colors.push(s);var a=n*this._gridSize,o=i*this._gridSize;t.drawRect(a,o,this._gridSize,this._gridSize,s,"#000000")}},n.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},n.open=function(){var t=this.localToGlobal(new g),e=t.x+this._colorPanel.width<=i.stage.width?t.x:i.stage.width-this._colorPanel.width,n=t.y+this._colorButton.height;n=n+this._colorPanel.height<=i.stage.height?n:t.y-this._colorPanel.height,this._colorPanel.pos(e,n),this._colorPanel.zOrder=1001,i._currentStage.addChild(this._colorPanel),i.stage.on("mousedown",this,this.removeColorBox)},n.close=function(){i.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},n.removeColorBox=function(t){this.close()},n.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},n.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},n.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},n.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},n.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},n.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear();var i=t||"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},n.changeColor=function(){var t=this.graphics;t.clear();var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},n._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},s(0,n,"inputBgColor",(function(){return this._inputBgColor}),(function(t){this._inputBgColor=t,this._setPanelChanged()})),s(0,n,"selectedColor",(function(){return this._selectedColor}),(function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",c.EMPTY.setTo("change",this,this)))})),s(0,n,"skin",(function(){return this._colorButton.skin}),(function(t){this._colorButton.skin=t,this.changeColor()})),s(0,n,"bgColor",(function(){return this._bgColor}),(function(t){this._bgColor=t,this._setPanelChanged()})),s(0,n,"borderColor",(function(){return this._borderColor}),(function(t){this._borderColor=t,this._setPanelChanged()})),s(0,n,"inputColor",(function(){return this._inputColor}),(function(t){this._inputColor=t,this._setPanelChanged()})),e}(P),F=function(t){function e(t,i){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,e.__super.call(this),this._itemColors=I.comboBoxItemColors,this.skin=t,this.labels=i}r(e,"laya.ui.ComboBox",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._button&&this._button.destroy(e),this._list&&this._list.destroy(e),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},n.createChildren=function(){this.addChild(this._button=new L),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},n._createList=function(){this._list=new j,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},n._setListEvent=function(t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=f.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},n.onListDown=function(t){t.stopPropagation()},n.onScrollBarDown=function(t){t.stopPropagation()},n.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},n.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},n.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var n=this._list.getCell(e);if(!n)return;var r=n.getChildByName("label");r&&("mouseover"===i?(r.bgColor=this._itemColors[0],r.color=this._itemColors[1]):(r.bgColor=null,r.color=this._itemColors[2]))}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},n.switchTo=function(t){this.isOpen=t},n.changeOpen=function(){this.isOpen=!this._isOpen},n.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var t=this._list.graphics;t.clear(),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var e=this._list.array||[],i=e.length=0,n=this._labels.length;i<n;i++)e.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=e},n.changeSelected=function(){this._button.label=this.selectedLabel},n._onStageMouseWheel=function(t){this._list&&!this._list.contains(t.target)&&this.removeList(null)},n.removeList=function(t){i.stage.off("mousedown",this,this.removeList),i.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},s(0,n,"selectedIndex",(function(){return this._selectedIndex}),(function(t){this._selectedIndex!=t&&(this._selectedIndex=t,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[c.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))})),s(0,n,"measureHeight",(function(){return this._button.height})),s(0,n,"skin",(function(){return this._button.skin}),(function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)})),s(0,n,"measureWidth",(function(){return this._button.width})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(P,this,"width",t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0})),s(0,n,"selectedLabel",(function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null}),(function(t){this.selectedIndex=this._labels.indexOf(t)})),s(0,n,"labels",(function(){return this._labels.join(",")}),(function(t){0<this._labels.length&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(P,this,"height",t),this._button.height=this._height})),s(0,n,"selectHandler",(function(){return this._selectHandler}),(function(t){this._selectHandler=t})),s(0,n,"visibleNum",(function(){return this._visibleNum}),(function(t){this._visibleNum=t,this._listChanged=!0})),s(0,n,"labelBold",(function(){return this._button.text.bold}),(function(t){this._button.text.bold=t})),s(0,n,"itemColors",(function(){return String(this._itemColors)}),(function(t){this._itemColors=E.fillArray(this._itemColors,t,String),this._listChanged=!0})),s(0,n,"itemSize",(function(){return this._itemSize}),(function(t){this._itemSize=t,this._listChanged=!0})),s(0,n,"scrollBar",(function(){return this.list.scrollBar})),s(0,n,"isOpen",(function(){return this._isOpen}),(function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var e=this.localToGlobal(g.TEMP.setTo(0,0)),n=e.y+this._button.height;n=n+this._listHeight<=i.stage.height?n:e.y-this._listHeight,this._list.pos(e.x,n),this._list.zOrder=1001,i._currentStage.addChild(this._list),i.stage.once("mousedown",this,this.removeList),i.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()})),s(0,n,"scrollBarSkin",(function(){return this._scrollBarSkin}),(function(t){this._scrollBarSkin=t})),s(0,n,"sizeGrid",(function(){return this._button.sizeGrid}),(function(t){this._button.sizeGrid=t})),s(0,n,"button",(function(){return this._button})),s(0,n,"list",(function(){return this._list||this._createList(),this._list}),(function(t){t&&(t.removeSelf(),this._isCustomList=!0,this._list=t,this._setListEvent(t),this._itemHeight=t.getCell(0).height+t.spaceY)})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):i.superSet(P,this,"dataSource",t)})),s(0,n,"labelColors",(function(){return this._button.labelColors}),(function(t){this._button.labelColors!=t&&(this._button.labelColors=t)})),s(0,n,"labelPadding",(function(){return this._button.text.padding.join(",")}),(function(t){this._button.text.padding=E.fillArray(I.labelPadding,t,Number)})),s(0,n,"labelSize",(function(){return this._button.text.fontSize}),(function(t){this._button.text.fontSize=t})),s(0,n,"labelFont",(function(){return this._button.text.font}),(function(t){this._button.text.font=t})),s(0,n,"stateNum",(function(){return this._button.stateNum}),(function(t){this._button.stateNum=t})),e}(P),k=function(t){function e(t){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=200,this.elasticBackTime=100,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,e.__super.call(this),this._showButtons=A.showButtons,this._touchScrollEnable=A.touchScrollEnable,this._mouseWheelEnable=A.mouseWheelEnable,this.skin=t,this.max=1}r(e,"laya.ui.ScrollBar",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),this.stopScroll(),this.target=null,t.prototype.destroy.call(this,e),this.upButton&&this.upButton.destroy(e),this.downButton&&this.downButton.destroy(e),this.slider&&this.slider.destroy(e),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},n.createChildren=function(){this.addChild(this.slider=new V),this.addChild(this.upButton=new L),this.addChild(this.downButton=new L)},n.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},n.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},n.onButtonMouseDown=function(t){var e=t.currentTarget===this.upButton;this.slide(e),i.timer.once(I.scrollBarDelayTime,this,this.startLoop,[e]),i.stage.once("mouseup",this,this.onStageMouseUp)},n.startLoop=function(t){i.timer.frameLoop(1,this,this.slide,[t])},n.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},n.onStageMouseUp=function(t){i.timer.clear(this,this.startLoop),i.timer.clear(this,this.slide)},n.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},n.changeSize=function(){t.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},n.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},n.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},n.setScroll=function(t,e,i){this.runCallLater(this.changeSize),this.slider.setSlider(t,e,i),this.slider.bar.visible=0<e,!this._hide&&this.autoHide&&(this.visible=!1)},n.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},n.onTargetMouseDown=function(t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new g),this._lastPoint.setTo(i.stage.mouseX,i.stage.mouseY),i.timer.clear(this,this.tweenMove),S.clearTween(this),i.stage.once("mouseup",this,this.onStageMouseUp2),i.stage.once("mouseout",this,this.onStageMouseUp2),i.timer.frameLoop(1,this,this.loop)},n.loop=function(){var t=i.stage.mouseY,e=i.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?i.stage._canvasTransform.getScaleY():i.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},n.onStageMouseUp2=function(t){if(i.stage.off("mouseup",this,this.onStageMouseUp2),i.stage.off("mouseout",this,this.onStageMouseUp2),i.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?S.to(this,{value:this.min},this.elasticBackTime,l.sineOut,f.create(this,this.elasticOver)):this._value>this.max&&S.to(this,{value:this.max},this.elasticBackTime,l.sineOut,f.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?i.stage.mouseY-this._lastPoint.y:i.stage.mouseX-this._lastPoint.x);for(var e=0,n=Math.min(this._offsets.length,3),r=0;r<n;r++)e+=this._offsets[this._offsets.length-1-r];if(this._lastOffset=e/n,(e=Math.abs(this._lastOffset))<2)return void this.event("end");60<e&&(this._lastOffset=0<this._lastOffset?60:-60);var s=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));i.timer.frameLoop(1,this,this.tweenMove,[s])}},n.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&S.to(this,{alpha:0},500),this.event("end")},n.tweenMove=function(t){this._lastOffset*=this.rollRatio;var e=NaN;if(100<t&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,e=.5*-(this.min-t-this.value),this._lastOffset>e&&(this._lastOffset=e)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,e=.5*-(this.max+t-this.value),this._lastOffset<e&&(this._lastOffset=e))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(i.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?S.to(this,{value:this.min},this.elasticBackTime,l.sineOut,f.create(this,this.elasticOver)):this._value>this.max?S.to(this,{value:this.max},this.elasticBackTime,l.sineOut,f.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&S.to(this,{alpha:0},500)}},n.stopScroll=function(){this.onStageMouseUp2(null),i.timer.clear(this,this.tweenMove),S.clearTween(this)},s(0,n,"measureHeight",(function(){return this.slider.isVertical?100:this.slider.height})),s(0,n,"skin",(function(){return this._skin}),(function(t){this._skin!=t&&(this._skin=t,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))})),s(0,n,"max",(function(){return this.slider.max}),(function(t){this.slider.max=t})),s(0,n,"showButtons",(function(){return this._showButtons}),(function(t){this._showButtons=t,this.callLater(this.changeScrollBar)})),s(0,n,"measureWidth",(function(){return this.slider.isVertical?this.slider.width:100})),s(0,n,"min",(function(){return this.slider.min}),(function(t){this.slider.min=t})),s(0,n,"value",(function(){return this._value}),(function(t){t!==this._value&&(this._value=t,this._isElastic||(this.slider._value!=t&&(this.slider._value=t,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))})),s(0,n,"isVertical",(function(){return this.slider.isVertical}),(function(t){this.slider.isVertical=t})),s(0,n,"sizeGrid",(function(){return this.slider.sizeGrid}),(function(t){this.slider.sizeGrid=t})),s(0,n,"scrollSize",(function(){return this._scrollSize}),(function(t){this._scrollSize=t})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):i.superSet(P,this,"dataSource",t)})),s(0,n,"thumbPercent",(function(){return this._thumbPercent}),(function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),t=1<=t?.99:t,this._thumbPercent=t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*t,I.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*t,I.scrollBarMinNum))})),s(0,n,"target",(function(){return this._target}),(function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=t)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))})),s(0,n,"hide",(function(){return this._hide}),(function(t){this._hide=t,this.visible=!t})),s(0,n,"touchScrollEnable",(function(){return this._touchScrollEnable}),(function(t){this._touchScrollEnable=t,this.target=this._target})),s(0,n,"mouseWheelEnable",(function(){return this._mouseWheelEnable}),(function(t){this._mouseWheelEnable=t,this.target=this._target})),s(0,n,"tick",(function(){return this.slider.tick}),(function(t){this.slider.tick=t})),e}(P),V=function(t){function e(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,e.__super.call(this),this.skin=t}r(e,"laya.ui.Slider",t);var a=e.prototype;return a.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._progress&&this._progress.destroy(e),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},a.createChildren=function(){this.addChild(this._bg=new U),this.addChild(this._bar=new L)},a.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},a.onBarMouseDown=function(t){this._globalSacle||(this._globalSacle=new g),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=i.stage.mouseX,this._ty=i.stage.mouseY,i.stage.on("mousemove",this,this.mouseMove),i.stage.once("mouseup",this,this.mouseUp),i.stage.once("mouseout",this,this.mouseUp),this.showValueText()},a.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar.x+20,t.y=.5*(this._bar.height-t.height)+this._bar.y):(t.y=this._bar.y-20,t.x=.5*(this._bar.width-t.width)+this._bar.x)}},a.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},a.mouseUp=function(t){i.stage.off("mousemove",this,this.mouseMove),i.stage.off("mouseup",this,this.mouseUp),i.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},a.mouseMove=function(t){var e=this._value;this.isVertical?(this._bar.y+=(i.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(i.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=i.stage.mouseX,this._ty=i.stage.mouseY;var n=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*n)/n,this._value!=e&&this.sendChangeEvent(),this.showValueText()},a.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},a.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},a.changeSize=function(){t.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},a.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=t<e?e:t,this.value=i<t?t:e<i?e:i},a.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},a.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},s(0,a,"measureHeight",(function(){return Math.max(this._bg.height,this._bar.height)})),s(0,a,"skin",(function(){return this._skin}),(function(t){if(this._skin!=t){this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var e=this._skin.replace(".png","$progress.png");m.getRes(e)&&(this._progress||(this.addChild(this._progress=new U),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=e),this.setBarPoint(),this.callLater(this.changeValue)}})),s(0,a,"allowClickBack",(function(){return this._allowClickBack}),(function(t){this._allowClickBack!=t&&((this._allowClickBack=t)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))})),s(0,a,"max",(function(){return this._max}),(function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))})),s(0,a,"measureWidth",(function(){return Math.max(this._bg.width,this._bar.width)})),s(0,a,"tick",(function(){return this._tick}),(function(t){this._tick!=t&&(this._tick=t,this.callLater(this.changeValue))})),s(0,a,"sizeGrid",(function(){return this._bg.sizeGrid}),(function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)})),s(0,a,"min",(function(){return this._min}),(function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))})),s(0,a,"value",(function(){return this._value}),(function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}})),s(0,a,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):i.superSet(P,this,"dataSource",t)})),s(0,a,"bar",(function(){return this._bar})),n(e,["label",function(){return this.label=new H}]),e}(P),U=function(e){function n(t){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,n.__super.call(this),this.skin=t}r(n,"laya.ui.Image",e);var a=n.prototype;return a.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,m.clearCache(this,this._skin)},a.dispose=function(){this.destroy(!0),m.clearCache(this,this._skin),this.clearEvent()},a.createChildren=function(){this.graphics=this._bitmap=new D},a.setSource=function(t,e){this.destroyed||t===this._skin&&e&&(this.source=e,this.onCompResize(),this.clearEvent())},a.clearEvent=function(){this._skin&&t.atalsNotify&&t.atalsNotify.off(this._skin,this,this.setSource)},a.clearLoad=function(){this._skin&&((this._complete||this._progress)&&i.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},s(0,a,"source",(function(){return this._bitmap.source}),(function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())})),s(0,a,"dataSource",e.prototype._$get_dataSource,(function(t){"string"==typeof(this._dataSource=t)?this.skin=t:i.superSet(P,this,"dataSource",t)})),s(0,a,"measureHeight",(function(){return this._bitmap.height})),s(0,a,"skin",(function(){return this._skin}),(function(e){if(this._skin!=e)if(m.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=e){m.keepCache(this,this._skin);var n=m.getRes(e),r=t.resAtalsObj&&t.resAtalsObj[this._skin];n?(this.source=n,this.onCompResize()):r?(t.atalsNotify&&t.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=r.sourceW),0==this.height&&(this.height=r.sourceH)):(this._complete=f.create(this,this.setSource,[this._skin]),this._progress=null,i.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null})),s(0,a,"group",(function(){return this._group}),(function(t){t&&this._skin&&m.setGroup(this._skin,t),this._group=t})),s(0,a,"sizeGrid",(function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null}),(function(t){this._bitmap.sizeGrid=E.fillArray(I.defaultSizeGrid,t,Number)})),s(0,a,"measureWidth",(function(){return this._bitmap.width})),s(0,a,"width",e.prototype._$get_width,(function(t){i.superSet(P,this,"width",t),this._bitmap.width=0==t?1e-7:t})),s(0,a,"height",e.prototype._$get_height,(function(t){i.superSet(P,this,"height",t),this._bitmap.height=0==t?1e-7:t})),n}(P),H=function(t){function e(t){this._tf=null,e.__super.call(this),void 0===t&&(t=""),u.defaultColor=I.labelColor,this.text=t}r(e,"laya.ui.Label",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._tf=null},n.createChildren=function(){this.addChild(this._tf=new w)},n.changeText=function(t){this._tf.changeText(t)},s(0,n,"padding",(function(){return this._tf.padding.join(",")}),(function(t){this._tf.padding=E.fillArray(I.labelPadding,t,Number)})),s(0,n,"bold",(function(){return this._tf.bold}),(function(t){this._tf.bold=t})),s(0,n,"align",(function(){return this._tf.align}),(function(t){this._tf.align=t})),s(0,n,"text",(function(){return this._tf.text}),(function(t){this._tf.text!=t&&(t&&(t=E.adptString(t+"")),this._tf.text=t,this.event("change"),this._width&&this._height||this.onCompResize())})),s(0,n,"italic",(function(){return this._tf.italic}),(function(t){this._tf.italic=t})),s(0,n,"wordWrap",(function(){return this._tf.wordWrap}),(function(t){this._tf.wordWrap=t})),s(0,n,"font",(function(){return this._tf.font}),(function(t){this._tf.font=t})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.text=t+"":i.superSet(P,this,"dataSource",t)})),s(0,n,"color",(function(){return this._tf.color}),(function(t){this._tf.color=t})),s(0,n,"valign",(function(){return this._tf.valign}),(function(t){this._tf.valign=t})),s(0,n,"leading",(function(){return this._tf.leading}),(function(t){this._tf.leading=t})),s(0,n,"fontSize",(function(){return this._tf.fontSize}),(function(t){this._tf.fontSize=t})),s(0,n,"bgColor",(function(){return this._tf.bgColor}),(function(t){this._tf.bgColor=t})),s(0,n,"borderColor",(function(){return this._tf.borderColor}),(function(t){this._tf.borderColor=t})),s(0,n,"stroke",(function(){return this._tf.stroke}),(function(t){this._tf.stroke=t})),s(0,n,"strokeColor",(function(){return this._tf.strokeColor}),(function(t){this._tf.strokeColor=t})),s(0,n,"textField",(function(){return this._tf})),s(0,n,"measureWidth",(function(){return this._tf.width})),s(0,n,"measureHeight",(function(){return this._tf.height})),s(0,n,"width",(function(){return this._width||this._tf.text?i.superGet(P,this,"width"):0}),(function(t){i.superSet(P,this,"width",t),this._tf.width=t})),s(0,n,"height",(function(){return this._height||this._tf.text?i.superGet(P,this,"height"):0}),(function(t){i.superSet(P,this,"height",t),this._tf.height=t})),s(0,n,"overflow",(function(){return this._tf.overflow}),(function(t){this._tf.overflow=t})),s(0,n,"underline",(function(){return this._tf.underline}),(function(t){this._tf.underline=t})),s(0,n,"underlineColor",(function(){return this._tf.underlineColor}),(function(t){this._tf.underlineColor=t})),e}(P),z=function(t){function e(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,e.__super.call(this),this.skin=t}r(e,"laya.ui.ProgressBar",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._bg=this._bar=null,this.changeHandler=null},n.createChildren=function(){this.addChild(this._bg=new U),this.addChild(this._bar=new U)},n.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[3]),i=Number(t[1]),n=(this.width-e-i)*this._value;this._bar.width=e+i+n,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},s(0,n,"measureHeight",(function(){return this._bg.height})),s(0,n,"skin",(function(){return this._skin}),(function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))})),s(0,n,"measureWidth",(function(){return this._bg.width})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(P,this,"height",t),this._bg.height=this._height,this._bar.height=this._height})),s(0,n,"bar",(function(){return this._bar})),s(0,n,"value",(function(){return this._value}),(function(t){this._value!=t&&(t=1<t?1:t<0?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))})),s(0,n,"bg",(function(){return this._bg})),s(0,n,"sizeGrid",(function(){return this._bg.sizeGrid}),(function(t){this._bg.sizeGrid=this._bar.sizeGrid=t})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(P,this,"width",t),this._bg.width=this._width,this.callLater(this.changeValue)})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):i.superSet(P,this,"dataSource",t)})),e}(P),W=(function(t){function e(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,e.__super.call(this),this._tipBox=new P,this._tipBox.addChild(this._tipText=new w),this._tipText.x=this._tipText.y=5,this._tipText.color=e.tipTextColor,this._defaultTipHandler=this._showDefaultTip,i.stage.on("showtip",this,this._onStageShowTip),i.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}r(e,"laya.ui.TipManager",P);var n=e.prototype;n._onStageHideTip=function(t){i.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},n._onStageShowTip=function(t){i.timer.once(e.tipDelay,this,this._showTip,[t],!0)},n._showTip=function(t){if("string"==typeof t){var e=String(t);Boolean(e)&&this._defaultTipHandler(e)}else t instanceof laya.utils.Handler?t.run():"function"==typeof t&&t.apply();i.stage.on("mousemove",this,this._onStageMouseMove),i.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},n._onStageMouseDown=function(t){this.closeAll()},n._onStageMouseMove=function(t){this._showToStage(this,e.offsetX,e.offsetY)},n._showToStage=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var r=t.getBounds();t.x=i.stage.mouseX+e,t.y=i.stage.mouseY+n,t.x+r.width>i.stage.width&&(t.x-=r.width+e),t.y+r.height>i.stage.height&&(t.y-=r.height+n)},n.closeAll=function(){i.timer.clear(this,this._showTip),i.stage.off("mousemove",this,this._onStageMouseMove),i.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},n.showDislayTip=function(t){this.addChild(t),this._showToStage(this),i._currentStage.addChild(this)},n._showDefaultTip=function(t){this._tipText.text=t;var n=this._tipBox.graphics;n.clear(),n.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,e.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),i._currentStage.addChild(this)},s(0,n,"defaultTipHandler",(function(){return this._defaultTipHandler}),(function(t){this._defaultTipHandler=t})),e.offsetX=10,e.offsetY=15,e.tipTextColor="#ffffff",e.tipBackColor="#111111",e.tipDelay=200}(),function(t){var e;function s(){this._idMap=null,this._aniList=null,this._watchMap={},s.__super.call(this)}r(s,"laya.ui.View",N);var h=s.prototype;return h.createView=function(t){if(t.animations&&!this._idMap&&(this._idMap={}),s.createComp(t,this,this),t.animations){var e,i,n=[],r=t.animations,a=0,o=r.length;for(a=0;a<o;a++){switch(e=new d,i=r[a],e._setUp(this._idMap,i),(this[i.name]=e)._setControlNode(this),i.action){case 1:e.play(0,!1);break;case 2:e.play(0,!0)}n.push(e)}this._aniList=n}0<this._width&&null==t.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},h.onEvent=function(t,e){},h.loadUI=function(t){var e=s.uiMap[t];e&&this.createView(e)},h.destroy=function(t){void 0===t&&(t=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,t)},h.changeData=function(t){var e=this._watchMap[t];if(e){console.log("change",t);for(var i=0,n=e.length;i<n;i++)e[i].exe(this)}},s._regs=function(){for(var t in s.uiClassMap)o.regClass(t,s.uiClassMap[t])},s.createComp=function(t,e,n,r){if(!(e=e||s.getCompInstance(t)))return console.warn("can not create:"+t.type),null;var a=t.child;if(a)for(var h=e instanceof laya.ui.List,l=0,c=a.length;l<c;l++){var u=a[l];if(!e.hasOwnProperty("itemRender")||"render"!=u.props.name&&"render"!==u.props.renderType)if("Graphic"==u.type)o.addGraphicsToSprite(u,e);else if(o.isDrawType(u.type))o.addGraphicToSprite(u,e,!0);else{if(h){var d=[],_=s.createComp(u,null,n,d);d.length&&(_._$bindData=d)}else _=s.createComp(u,null,n,r);"Script"==u.type?"owner"in _?_.owner=e:"target"in _&&(_.target=e):"mask"==u.props.renderType||"mask"==u.props.name?e.mask=_:_ instanceof laya.display.Sprite&&e.addChild(_)}else e.itemRender=u}var f=t.props;for(var p in f){var m=f[p];s.eventDic[p]?m&&n&&e.on(p,n,n.onEvent,[m]):s.setCompValue(e,p,m,n,r)}return i.__typeof(e,"laya.ui.IItem")&&e.initItems(),t.compId&&n&&n._idMap&&(n._idMap[t.compId]=e),e},s.setCompValue=function(t,n,r,a,h){if("string"==typeof r&&-1<r.indexOf("${")){if(s._sheet||(s._sheet=o.getClass("laya.data.Table")),!s._sheet)return void console.warn("Can not find class Sheet");if(h)h.push(t,n,r);else if(a){-1==r.indexOf("].")&&(r=r.replace(".","[0]."));var l,c,u=new e(t,n,r);u.exe(a);for(var d=r.replace(/\[.*?\]\./g,".");null!=(l=s._parseWatchData.exec(d));){for(var _=l[1];null!=(c=s._parseKeyWord.exec(_));){var f=c[0],p=a._watchMap[f]||(a._watchMap[f]=[]);p.push(u),s._sheet.I.notifer.on(f,a,a.changeData,[f])}(p=a._watchMap[_]||(a._watchMap[_]=[])).push(u),s._sheet.I.notifer.on(_,a,a.changeData,[_])}}}else if("var"===n&&a)a[r]=t;else if("onClick"==n){var m=i._runScript("(function(){"+r+"})");t.on("click",a,m)}else t[n]="true"===r||"false"!==r&&r},s.getCompInstance=function(t){var e,n=t.props?t.props.runtime:null;return e=n?s.viewClassMap[n]||s.uiClassMap[n]||i.__classmap[n]:s.uiClassMap[t.type],t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?e.instance:e?new e:null},s.regComponent=function(t,e){s.uiClassMap[t]=e,o.regClass(t,e)},s.regViewRuntime=function(t,e){s.viewClassMap[t]=e},s.uiMap={},s.viewClassMap={},s._sheet=null,n(s,["uiClassMap",function(){return this.uiClassMap={ViewStack:tt,LinkButton:L,TextArea:lt,ColorPicker:O,Box:N,Button:L,CheckBox:G,Clip:B,ComboBox:F,Component:P,HScrollBar:K,HSlider:Z,Image:U,Label:H,List:j,Panel:q,ProgressBar:z,Radio:J,RadioGroup:ot,ScrollBar:k,Slider:V,Tab:ht,TextInput:it,View:s,VScrollBar:et,VSlider:nt,Tree:$,HBox:st,VBox:at,Sprite:x,Animation:a,Text:w,FontClip:X}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),s.__init$=function(){s._regs(),e=function(){function t(t,e,i){this.comp=null,this.prop=null,this.value=null,this.comp=t,this.prop=e,this.value=i}return r(t,""),t.prototype.exe=function(t){var e=E.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)},t}()},s}()),G=function(t){function e(t,i){void 0===i&&(i=""),e.__super.call(this,t,i)}r(e,"laya.ui.CheckBox",t);var n=e.prototype;return n.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},n.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"boolean"==typeof(this._dataSource=t)?this.selected=t:"string"==typeof t?this.selected="true"===t:i.superSet(L,this,"dataSource",t)})),e}(L),Y=function(t){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}r(e,"laya.ui.LayoutBox",N);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this._setItemChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this._setItemChanged()},i.changeItems=function(){this._itemChanged=!1},i.sortItem=function(t){t&&t.sort((function(t,e){return t.y-e.y}))},i._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},s(0,i,"space",(function(){return this._space}),(function(t){this._space=t,this._setItemChanged()})),s(0,i,"align",(function(){return this._align}),(function(t){this._align=t,this._setItemChanged()})),e}(),X=function(t){function e(t,i){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,e.__super.call(this),t&&(this.skin=t),i&&(this.sheet=i)}r(e,"laya.ui.FontClip",t);var n=e.prototype;return n.createChildren=function(){this._bitmap=new D,this.on("loaded",this,this._onClipLoaded)},n._onClipLoaded=function(){this.callLater(this.changeValue)},n.changeValue=function(){var t;if(this._sources&&this._valueArr&&(this.graphics.clear(!0),t=this._sources[0])){var e="horizontal"===this._direction;e?(this._wordsW=this._valueArr.length*(t.sourceWidth+this.spaceX),this._wordsH=t.sourceHeight):(this._wordsW=t.sourceWidth,this._wordsH=(t.sourceHeight+this.spaceY)*this._valueArr.length);var i=0;if(this._width)switch(this._align){case"center":i=.5*(this._width-this._wordsW);break;case"right":i=this._width-this._wordsW;break;default:i=0}for(var n=0,r=this._valueArr.length;n<r;n++){var s=this._indexMap[this._valueArr.charAt(n)];this.sources[s]&&(t=this.sources[s],e?this.graphics.drawTexture(t,i+n*(t.sourceWidth+this.spaceX),0,t.sourceWidth,t.sourceHeight):this.graphics.drawTexture(t,0+i,n*(t.sourceHeight+this.spaceY),t.sourceWidth,t.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},n.destroy=function(e){void 0===e&&(e=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),t.prototype.destroy.call(this,e)},s(0,n,"sheet",(function(){return this._sheet}),(function(t){t+="";var e=(this._sheet=t).split(" ");this._clipX=String(e[0]).length,this.clipY=e.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var n=e[i].split(""),r=0,s=n.length;r<s;r++)this._indexMap[n[r]]=i*this._clipX+r})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(B,this,"height",t),this.callLater(this.changeValue)})),s(0,n,"direction",(function(){return this._direction}),(function(t){this._direction=t,this.callLater(this.changeValue)})),s(0,n,"value",(function(){return this._valueArr?this._valueArr:""}),(function(t){t+="",this._valueArr=t,this.callLater(this.changeValue)})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(B,this,"width",t),this.callLater(this.changeValue)})),s(0,n,"spaceX",(function(){return this._spaceX}),(function(t){this._spaceX=t,"horizontal"===this._direction&&this.callLater(this.changeValue)})),s(0,n,"spaceY",(function(){return this._spaceY}),(function(t){this._spaceY=t,"horizontal"!==this._direction&&this.callLater(this.changeValue)})),s(0,n,"align",(function(){return this._align}),(function(t){this._align=t,this.callLater(this.changeValue)})),s(0,n,"measureWidth",(function(){return this._wordsW})),s(0,n,"measureHeight",(function(){return this._wordsH})),e}(B),j=function(t){function e(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new g,e.__super.call(this)}r(e,"laya.ui.List",t);var n=e.prototype;return i.imps(n,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),n.destroy=function(t){void 0===t&&(t=!0),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),laya.ui.Component.prototype.destroy.call(this,t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},n.createChildren=function(){this.addChild(this._content=new N)},n.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=i.superGet(N,this,"cacheAs")),i.superSet(N,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},n.onScrollEnd=function(){i.superSet(N,this,"cacheAs",this._$P.cacheAs)},n._removePreScrollBar=function(){var t=this.removeChildByName("scrollBar");t&&t.destroy(!0)},n.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell(),e=t.width+this._spaceX||1,i=t.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var n=this._width?this._width:e*this.repeatX-this._spaceX,r=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:e,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=r:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=n),this.setContentSize(n,r);var s=this._isVertical?this.repeatX:this.repeatY,a=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,s,a),this._createdLine=a,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},n._getOneCell=function(){if(0===this._cells.length){var t=this.createItem();if(this._offset.setTo(t.x,t.y),this.cacheContent)return t;this._cells.push(t)}return this._cells[0]},n._createItems=function(t,e,i){var n=this._content,r=this._getOneCell(),s=r.width+this._spaceX,a=r.height+this._spaceY;if(this.cacheContent){var o=new N;o.cacheAsBitmap=!0,o.pos((this._isVertical?0:t)*s,(this._isVertical?t:0)*a),this._content.addChild(o),this._content.optimizeScrollRect=!0,n=o}else{for(var h=[],l=this._cells.length-1;-1<l;l--){var c=this._cells[l];c.removeSelf(),h.push(c)}this._cells.length=0}for(var u=t;u<i;u++)for(var d=0;d<e;d++)(r=h&&h.length?h.pop():this.createItem()).x=(this._isVertical?d:u)*s-n.x,r.y=(this._isVertical?u:d)*a-n.y,r.name="item"+(u*e+d),n.addChild(r),this.addCell(r)},n.createItem=function(){var t=[];if("function"==typeof this._itemRender)var e=new this._itemRender;else e=W.createComp(this._itemRender,null,null,t);if(0==t.length&&e._watchMap){var i=e._watchMap;for(var n in i)for(var r=i[n],s=0;s<r.length;s++){var a=r[s];t.push(a.comp,a.prop,a.value)}}return t.length&&(e._$bindData=t),e},n.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},n.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var t=0,e=t=0;e<1e4;e++){var i=this.getChildByName("item"+e);if(!i)break;this.addCell(i),t++}this.repeatY=t}},n.setContentSize=function(t,e){this._content.width=t,this._content.height=e,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new v),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e),this._content.scrollRect=this._content.scrollRect),this.event("resize")},n.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);i<0||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},n.changeCellState=function(t,e,i){var n=t.getChildByName("selectBox");n&&(this.selectEnable=!0,n.visible=e,n.index=i)},n.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},n.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.floor(e/this._cellSize);if(this.cacheContent)a=n+1,this._createdLine-r<a&&(this._createItems(this._createdLine,i,this._createdLine+a),this.renderItems(this._createdLine*i,0),this._createdLine+=a);else{var s=r*i,a=0;if(s>this._startIndex){a=s-this._startIndex;var o=!0,h=this._startIndex+i*(n+1);this._isMoved=!0}else s<this._startIndex&&(a=this._startIndex-s,o=!1,h=this._startIndex-1,this._isMoved=!0);for(var l=0;l<a;l++){if(o){var c=this._cells.shift();this._cells[this._cells.length]=c;var u=h+l}else c=this._cells.pop(),this._cells.unshift(c),u=h-l;var d=Math.floor(u/i)*this._cellSize;this._isVertical?c.y=d:c.x=d,this.renderItem(c,u)}this._startIndex=s,this.changeSelectStatus()}var _=this._content.scrollRect;this._isVertical?(_.y=e-this._offset.y,_.x=-this._offset.x):(_.y=-this._offset.y,_.x=e-this._offset.x),this._content.scrollRect=_},n.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,n=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t.y=n:t.x=n}},n.changeSelectStatus=function(){for(var t=0,e=this._cells.length;t<e;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},n.renderItems=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=t,n=e||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus(),this._twDone=!0},n.renderItem=function(t,e){this._array&&0<=e&&e<this._array.length?(t.visible=!0,t._$bindData?(t._dataSource=this._array[e],this._bindData(t,this._array[e])):t.dataSource=this._array[e],this.cacheContent||this.posCell(t,e),this.hasListener("render")&&this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e]),this.renderTwHandler&&this.renderTwHandler.runWith([t,e])):t?(t.visible=!1,t.dataSource=null):i.recordError("找不到cell","_itemRender为:"+this._itemRender)},n._bindData=function(t,e){for(var i=t._$bindData,n=0,r=i.length;n<r;n++){var s=i[n++],a=i[n++],o=i[n],h=E.getBindFun(o);s[a]=h.call(this,e)}},n.refresh=function(){this.array=this._array},n.getItem=function(t){return-1<t&&t<this._array.length?this._array[t]:null},n.changeItem=function(t,e){-1<t&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},n.setItem=function(t,e){this.changeItem(t,e)},n.addItem=function(t){this._array.push(t),this.array=this._array},n.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},n.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},n.getCell=function(t){return this.runCallLater(this.changeCells),-1<t&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},n.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},n.tweenTo=function(t,e,i){if(void 0===e&&(e=200),this._scrollBar){var n=this._isVertical?this.repeatX:this.repeatY;S.to(this._scrollBar,{value:Math.floor(t/n)*this._cellSize},e,null,i,0,!0)}else this.startIndex=t,i&&i.run()},n._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},n.commitMeasure=function(){this.runCallLater(this.changeCells)},s(0,n,"cacheAs",t.prototype._$get_cacheAs,(function(t){i.superSet(N,this,"cacheAs",t),this._scrollBar&&(this._$P.cacheAs=null,"none"!==t?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))})),s(0,n,"content",(function(){return this._content})),s(0,n,"height",t.prototype._$get_height,(function(t){t!=this._height&&(i.superSet(N,this,"height",t),this._setCellChanged())})),s(0,n,"itemRender",(function(){return this._itemRender}),(function(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;-1<e;e--)this._cells[e].destroy();this._cells.length=0,this._setCellChanged()}})),s(0,n,"vScrollBarSkin",(function(){return this._scrollBar?this._scrollBar.skin:null}),(function(t){this._removePreScrollBar();var e=new et;e.name="scrollBar",e.right=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()})),s(0,n,"page",(function(){return this._page}),(function(t){this._page=t,this._array&&(this._page=0<t?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)})),s(0,n,"hScrollBarSkin",(function(){return this._scrollBar?this._scrollBar.skin:null}),(function(t){this._removePreScrollBar();var e=new K;e.name="scrollBar",e.bottom=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()})),s(0,n,"repeatX",(function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1}),(function(t){this._repeatX=t,this._setCellChanged()})),s(0,n,"scrollBar",(function(){return this._scrollBar}),(function(t){this._scrollBar!=t&&(this._scrollBar=t)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))})),s(0,n,"width",t.prototype._$get_width,(function(t){t!=this._width&&(i.superSet(N,this,"width",t),this._setCellChanged())})),s(0,n,"repeatY",(function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1}),(function(t){this._repeatY=t,this._setCellChanged()})),s(0,n,"spaceX",(function(){return this._spaceX}),(function(t){this._spaceX=t,this._setCellChanged()})),s(0,n,"spaceY",(function(){return this._spaceY}),(function(t){this._spaceY=t,this._setCellChanged()})),s(0,n,"selectedIndex",(function(){return this._selectedIndex}),(function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t),this.startIndex=this._startIndex)})),s(0,n,"selectedItem",(function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null}),(function(t){this.selectedIndex=this._array.indexOf(t)})),s(0,n,"length",(function(){return this._array?this._array.length:0})),s(0,n,"selection",(function(){return this.getCell(this._selectedIndex)}),(function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)})),s(0,n,"startIndex",(function(){return this._startIndex}),(function(t){this._startIndex=0<t?t:0,this.callLater(this.renderItems)})),s(0,n,"twSwitch",(function(){return this._twSwitch}),(function(t){this._twSwitch=t})),s(0,n,"twDone",(function(){return this._twDone}),(function(t){this._twDone=t})),s(0,n,"array",(function(){return this._array}),(function(t){this.runCallLater(this.changeCells),this._array=t||[];var e=this._array.length;if(this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.ceil(e/i);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=n/r,this._scrollBar.setScroll(0,(r-n)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.array=t:i.superSet(N,this,"dataSource",t)})),s(0,n,"cells",(function(){return this.runCallLater(this.changeCells),this._cells})),e}(N),K=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.HScrollBar",t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.slider.isVertical=!1},e}(k),q=function(t){function e(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,e.__super.call(this),this.width=this.height=100}r(e,"laya.ui.Panel",t);var n=e.prototype;return n.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},n.destroyChildren=function(){this._content.destroyChildren()},n.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new N)},n.addChild=function(t){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(t)},n.onResize=function(){this._setScrollChanged()},n.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(t,e)},n.removeChild=function(t){return t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(t)},n.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(t)},n.removeChildren=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=2147483647),this._content.removeChildren(t,e),this._setScrollChanged(),this},n.getChildAt=function(t){return this._content.getChildAt(t)},n.getChildByName=function(t){return this._content.getChildByName(t)},n.getChildIndex=function(t){return this._content.getChildIndex(t)},n.changeScroll=function(){this._scrollChanged=!1;var t=this.contentWidth||1,e=this.contentHeight||1,i=this._vScrollBar,n=this._hScrollBar,r=i&&e>this._height,s=n&&t>this._width,a=r?this._width-i.width:this._width,o=s?this._height-n.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(s?n.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value)),n&&(n.x=0,n.y=this._height-n.height,n.width=this._width-(r?i.width:0),n.scrollSize=Math.max(.033*this._width,1),n.thumbPercent=a/t,n.setScroll(0,t-a,n.value))},n.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},n.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i.scrollRect||(i.scrollRect=new v),i.scrollRect.setTo(0,0,t,e),i.scrollRect=i.scrollRect},n.onScrollBarChange=function(t){var e=this._content.scrollRect;if(e){var i=Math.round(t.value);t.isVertical?e.y=i:e.x=i,this._content.scrollRect=e}},n.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},n.refresh=function(){this.changeScroll()},n.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=i.superGet(N,this,"cacheAs")),i.superSet(N,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},n.onScrollEnd=function(){i.superSet(N,this,"cacheAs",this._$P.cacheAs)},n._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},s(0,n,"numChildren",(function(){return this._content.numChildren})),s(0,n,"hScrollBarSkin",(function(){return this._hScrollBar?this._hScrollBar.skin:null}),(function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new K),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=t})),s(0,n,"contentWidth",(function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.x+i.width*i.scaleX,t)}return t})),s(0,n,"contentHeight",(function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.y+i.height*i.scaleY,t)}return t})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(N,this,"width",t),this._setScrollChanged()})),s(0,n,"hScrollBar",(function(){return this._hScrollBar})),s(0,n,"content",(function(){return this._content})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(N,this,"height",t),this._setScrollChanged()})),s(0,n,"vScrollBarSkin",(function(){return this._vScrollBar?this._vScrollBar.skin:null}),(function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new et),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=t})),s(0,n,"vScrollBar",(function(){return this._vScrollBar})),s(0,n,"cacheAs",t.prototype._$get_cacheAs,(function(t){i.superSet(N,this,"cacheAs",t),this._$P.cacheAs=null,"none"!==t?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))})),e}(N),Z=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return r(e,"laya.ui.HSlider",V),e}(),Q=function(t){function e(t,i){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,e.__super.call(this),this.skin=i,this.labels=t}r(e,"laya.ui.UIGroup",t);var n=e.prototype;return i.imps(n,{"laya.ui.IItem":!0}),n.preinitialize=function(){this.mouseEnabled=!0},n.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},n.addItem=function(t,e){void 0===e&&(e=!0);var i=t,n=this._items.length;if(i.name="item"+n,this.addChild(i),this.initItems(),e&&0<n){var r=this._items[n-1];"horizontal"==this._direction?i.x=r.x+r.width+this._space:i.y=r.y+r.height+this._space}else e&&(i.x=0,i.y=0);return n},n.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var n,r=t;this.removeChild(r);for(var s=i+1,a=this._items.length;s<a;s++){var o=this._items[s];o.name="item"+(s-1),e&&("horizontal"==this._direction?o.x-=r.width+this._space:o.y-=r.height+this._space)}if(this.initItems(),-1<this._selectedIndex)n=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=n}},n.initItems=function(){this._items||(this._items=[]);for(var t=this._items.length=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=f.create(this,this.itemClick,[t],!1)}},n.itemClick=function(t){this.selectedIndex=t},n.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].selected=e)},n.createItem=function(t,e){return null},n.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var t=0,e=0,i=this._items.length;e<i;e++){var n=this._items[e];this._skin&&(n.skin=this._skin),this._labelColors&&(n.labelColors=this._labelColors),this._labelSize&&(n.labelSize=this._labelSize),this._labelStroke&&(n.labelStroke=this._labelStroke),this._labelStrokeColor&&(n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(n.strokeColors=this._strokeColors),this._labelBold&&(n.labelBold=this._labelBold),this._labelPadding&&(n.labelPadding=this._labelPadding),this._labelAlign&&(n.labelAlign=this._labelAlign),this._stateNum&&(n.stateNum=this._stateNum),this._labelFont&&(n.labelFont=this._labelFont),"horizontal"===this._direction?(n.y=0,n.x=t,t+=n.width+this._space):(n.x=0,n.y=t,t+=n.height+this._space)}this.changeSize()},n.commitMeasure=function(){this.runCallLater(this.changeLabels)},n._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},s(0,n,"labelStrokeColor",(function(){return this._labelStrokeColor}),(function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this._setLabelChanged())})),s(0,n,"skin",(function(){return this._skin}),(function(t){this._skin!=t&&(this._skin=t,this._setLabelChanged())})),s(0,n,"selectedIndex",(function(){return this._selectedIndex}),(function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))})),s(0,n,"labels",(function(){return this._labels}),(function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var e=this._labels.split(","),i=0,n=e.length;i<n;i++){var r=this.createItem(this._skin,e[i]);r.name="item"+i,this.addChild(r)}this.initItems()}})),s(0,n,"strokeColors",(function(){return this._strokeColors}),(function(t){this._strokeColors!=t&&(this._strokeColors=t,this._setLabelChanged())})),s(0,n,"labelColors",(function(){return this._labelColors}),(function(t){this._labelColors!=t&&(this._labelColors=t,this._setLabelChanged())})),s(0,n,"labelStroke",(function(){return this._labelStroke}),(function(t){this._labelStroke!=t&&(this._labelStroke=t,this._setLabelChanged())})),s(0,n,"labelSize",(function(){return this._labelSize}),(function(t){this._labelSize!=t&&(this._labelSize=t,this._setLabelChanged())})),s(0,n,"stateNum",(function(){return this._stateNum}),(function(t){this._stateNum!=t&&(this._stateNum=t,this._setLabelChanged())})),s(0,n,"labelBold",(function(){return this._labelBold}),(function(t){this._labelBold!=t&&(this._labelBold=t,this._setLabelChanged())})),s(0,n,"labelFont",(function(){return this._labelFont}),(function(t){this._labelFont!=t&&(this._labelFont=t,this._setLabelChanged())})),s(0,n,"labelPadding",(function(){return this._labelPadding}),(function(t){this._labelPadding!=t&&(this._labelPadding=t,this._setLabelChanged())})),s(0,n,"direction",(function(){return this._direction}),(function(t){this._direction=t,this._setLabelChanged()})),s(0,n,"space",(function(){return this._space}),(function(t){this._space=t,this._setLabelChanged()})),s(0,n,"items",(function(){return this._items})),s(0,n,"selection",(function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null}),(function(t){this.selectedIndex=this._items.indexOf(t)})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):i.superSet(N,this,"dataSource",t)})),e}(N),J=function(t){function e(t,i){this._value=null,void 0===i&&(i=""),e.__super.call(this,t,i)}r(e,"laya.ui.Radio",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._value=null},i.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},i.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},i.onClick=function(t){this.selected=!0},s(0,i,"value",(function(){return null!=this._value?this._value:this.label}),(function(t){this._value=t})),e}(L),$=function(t){function e(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,e.__super.call(this),this.width=this.height=200}r(e,"laya.ui.Tree",t);var n=e.prototype;return i.imps(n,{"laya.ui.IRender":!0}),n.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},n.createChildren=function(){this.addChild(this._list=new j),this._list.renderHandler=f.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},n.onListChange=function(t){this.event("change")},n.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},n.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},n.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))},n.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var n=t.getChildByName("arrow");n&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=e,n.off("click",this,this.onArrowClick),n.on("click",this,this.onArrowClick)):n.visible=!1);var r=t.getChildByName("folder");r&&(2==r.clipY?r.index=i.isDirectory?0:1:r.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},n.onArrowClick=function(t){var e=t.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event("open"),this._list.array=this.getArray()},n.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},n.fresh=function(){this._list.array=this.getArray(),this.repaint()},n.parseXml=function(t,e,i,n){var r,s=t.childNodes,a=s.length;if(!n){r={};var o,h=t.attributes;for(var l in h){var c=(o=h[l]).nodeName,u=o.nodeValue;r[c]="true"==u||"false"!=u&&u}r.nodeParent=i,0<a&&(r.isDirectory=!0),r.hasChild=0<a,e.push(r)}for(var d=0;d<a;d++){var _=s[d];this.parseXml(_,e,r,!1)}},n.parseOpenStatus=function(t,e){for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.isDirectory)for(var s=0,a=t.length;s<a;s++){var o=t[s];if(o.isDirectory&&this.isSameParent(o,r)&&r.label==o.label){r.isOpen=o.isOpen;break}}}},n.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent||null!=t.nodeParent&&null!=e.nodeParent&&t.nodeParent.label==e.nodeParent.label&&this.isSameParent(t.nodeParent,e.nodeParent)},n.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},n.getFilterSource=function(t,e,i){var n;for(var r in i=i.toLocaleLowerCase(),t)!(n=t[r]).isDirectory&&-1<String(n.label).toLowerCase().indexOf(i)&&(n.x=0,e.push(n)),n.child&&0<n.child.length&&this.getFilterSource(n.child,e,i)},s(0,n,"spaceBottom",(function(){return this._list.spaceY}),(function(t){this._list.spaceY=t})),s(0,n,"keepStatus",(function(){return this._keepStatus}),(function(t){this._keepStatus=t})),s(0,n,"itemRender",(function(){return this._list.itemRender}),(function(t){this._list.itemRender=t})),s(0,n,"array",(function(){return this._list.array}),(function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()})),s(0,n,"mouseHandler",(function(){return this._list.mouseHandler}),(function(t){this._list.mouseHandler=t})),s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){this._dataSource=t,i.superSet(N,this,"dataSource",t)})),s(0,n,"source",(function(){return this._source})),s(0,n,"scrollBar",(function(){return this._list.scrollBar})),s(0,n,"list",(function(){return this._list})),s(0,n,"scrollBarSkin",(function(){return this._list.vScrollBarSkin}),(function(t){this._list.vScrollBarSkin=t})),s(0,n,"renderHandler",(function(){return this._renderHandler}),(function(t){this._renderHandler=t})),s(0,n,"selectedIndex",(function(){return this._list.selectedIndex}),(function(t){this._list.selectedIndex=t})),s(0,n,"spaceLeft",(function(){return this._spaceLeft}),(function(t){this._spaceLeft=t})),s(0,n,"selectedItem",(function(){return this._list.selectedItem}),(function(t){this._list.selectedItem=t})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(N,this,"width",t),this._list.width=t})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(N,this,"height",t),this._list.height=t})),s(0,n,"xml",null,(function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e})),s(0,n,"selectedPath",(function(){return this._list.selectedItem?this._list.selectedItem.path:null})),e}(N),tt=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=f.create(this,this.setIndex,null,!1)}r(e,"laya.ui.ViewStack",t);var n=e.prototype;return i.imps(n,{"laya.ui.IItem":!0}),n.setItems=function(t){this.removeChildren();for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r&&(r.name="item"+e,this.addChild(r),e++)}this.initItems()},n.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},n.initItems=function(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},n.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].visible=e)},n.setIndex=function(t){this.selectedIndex=t},s(0,n,"dataSource",t.prototype._$get_dataSource,(function(t){if("number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=parseInt(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])})),s(0,n,"selectedIndex",(function(){return this._selectedIndex}),(function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))})),s(0,n,"selection",(function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null}),(function(t){this.selectedIndex=this._items.indexOf(t)})),s(0,n,"items",(function(){return this._items})),s(0,n,"setIndexHandler",(function(){return this._setIndexHandler}),(function(t){this._setIndexHandler=t})),e}(N),et=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.VScrollBar",k),e}(),it=function(t){function e(t){this._bg=null,this._skin=null,e.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}r(e,"laya.ui.TextInput",t);var n=e.prototype;return n.preinitialize=function(){this.mouseEnabled=!0},n.destroy=function(e){m.clearCache(this,this._skin),void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(),this._bg=null},n.createChildren=function(){this.addChild(this._tf=new p),this._tf.padding=I.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},n._onFocus=function(){this.event("focus",this)},n._onBlur=function(){this.event("blur",this)},n._onInput=function(){this.event("input",this)},n._onEnter=function(){this.event("enter",this)},n.initialize=function(){this.width=128,this.height=22},n.select=function(){this._tf.select()},n.setSelection=function(t,e){this._tf.setSelection(t,e)},s(0,n,"text",t.prototype._$get_text,(function(t){this._tf.text!=t&&(t+="",this._tf.text=t,this.event("change"))})),s(0,n,"bg",(function(){return this._bg}),(function(t){this.graphics=this._bg=t})),s(0,n,"inputElementYAdjuster",(function(){return this._tf.inputElementYAdjuster}),(function(t){this._tf.inputElementYAdjuster=t})),s(0,n,"multiline",(function(){return this._tf.multiline}),(function(t){this._tf.multiline=t})),s(0,n,"skin",(function(){return this._skin}),(function(t){this._skin!=t&&(m.clearCache(this,this._skin),this._skin=t,this._bg||(this.graphics=this._bg=new D),m.keepCache(this,this._skin),this._bg.source=m.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))})),s(0,n,"sizeGrid",(function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null}),(function(t){this._bg||(this.graphics=this._bg=new D),this._bg.sizeGrid=E.fillArray(I.defaultSizeGrid,t,Number)})),s(0,n,"inputElementXAdjuster",(function(){return this._tf.inputElementXAdjuster}),(function(t){this._tf.inputElementXAdjuster=t})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(H,this,"width",t),this._bg&&(this._bg.width=t)})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(H,this,"height",t),this._bg&&(this._bg.height=t)})),s(0,n,"editable",(function(){return this._tf.editable}),(function(t){this._tf.editable=t})),s(0,n,"restrict",(function(){return this._tf.restrict}),(function(t){this._tf.restrict=t})),s(0,n,"prompt",(function(){return this._tf.prompt}),(function(t){this._tf.prompt=t})),s(0,n,"promptColor",(function(){return this._tf.promptColor}),(function(t){this._tf.promptColor=t})),s(0,n,"maxChars",(function(){return this._tf.maxChars}),(function(t){this._tf.maxChars=t})),s(0,n,"focus",(function(){return this._tf.focus}),(function(t){this._tf.focus=t})),s(0,n,"type",(function(){return this._tf.type}),(function(t){this._tf.type=t})),s(0,n,"asPassword",(function(){return this._tf.asPassword}),(function(t){this._tf.asPassword=t})),e}(H),nt=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.VSlider",V),e}(),rt=function(t){function e(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,e.__super.call(this)}r(e,"laya.ui.Dialog",t);var n=e.prototype;return n.initialize=function(){this.popupEffect=e.manager.popupEffectHandler,this.closeEffect=e.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},n._dealDragArea=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t.x+","+t.y+","+t.width+","+t.height,t.removeSelf())},n._onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(e.name)}},n.show=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!1,t,e)},n.popup=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!0,t,e)},n._open=function(t,i,n){e.manager.lock(!1),this.isModal=t,e.manager.open(this,i,n)},n.onOpened=function(){},n.close=function(t,i){void 0===i&&(i=!0),e.manager.close(this,t,i)},n.onClosed=function(t){},n._onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},s(0,n,"dragArea",(function(){return this._dragArea?this._dragArea.toString():null}),(function(t){if(t){var e=E.fillArray([0,0,0,0],t,Number);this._dragArea=new v(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)})),s(0,n,"isPopup",(function(){return null!=this.parent})),s(0,n,"zOrder",t.prototype._$get_zOrder,(function(t){i.superSet(W,this,"zOrder",t),e.manager._checkMask()})),s(1,e,"manager",(function(){return e._manager=e._manager||new R}),(function(t){e._manager=t})),e.setLockView=function(t){e.manager.setLockView(t)},e.lock=function(t){e.manager.lock(t)},e.closeAll=function(){e.manager.closeAll()},e.getDialogsByGroup=function(t){return e.manager.getDialogsByGroup(t)},e.closeByGroup=function(t){return e.manager.closeByGroup(t)},e.CLOSE="close",e.CANCEL="cancel",e.SURE="sure",e.NO="no",e.OK="ok",e.YES="yes",e._manager=null,e}(W),st=function(t){function e(){e.__super.call(this)}r(e,"laya.ui.HBox",t);var n=e.prototype;return n.sortItem=function(t){t&&t.sort((function(t,e){return t.x-e.x}))},n.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._height?this._height:Math.max(e,r.height*r.scaleY))}this.sortItem(t);var s=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).x=s,s+=r.width*r.scaleX+this._space,"top"==this._align?r.y=0:"middle"==this._align?r.y=.5*(e-r.height*r.scaleY):"bottom"==this._align&&(r.y=e-r.height*r.scaleY);this.changeSize()},s(0,n,"height",t.prototype._$get_height,(function(t){this._height!=t&&(i.superSet(Y,this,"height",t),this.callLater(this.changeItems))})),e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(Y),at=function(t){function e(){e.__super.call(this)}r(e,"laya.ui.VBox",t);var n=e.prototype;return n.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&r.layoutEnabled&&(t.push(r),e=this._width?this._width:Math.max(e,r.width*r.scaleX))}this.sortItem(t);var s=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).y=s,s+=r.height*r.scaleY+this._space,"left"==this._align?r.x=0:"center"==this._align?r.x=.5*(e-r.width*r.scaleX):"right"==this._align&&(r.x=e-r.width*r.scaleX);this.changeSize()},s(0,n,"width",t.prototype._$get_width,(function(t){this._width!=t&&(i.superSet(Y,this,"width",t),this.callLater(this.changeItems))})),e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(Y),ot=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.RadioGroup",Q),e.prototype.createItem=function(t,e){return new J(t,e)},e}(),ht=function(t){function e(){e.__super.call(this)}return r(e,"laya.ui.Tab",Q),e.prototype.createItem=function(t,e){return new L(t,e)},e}(),lt=function(t){function e(t){this._vScrollBar=null,this._hScrollBar=null,void 0===t&&(t=""),e.__super.call(this,t)}r(e,"laya.ui.TextArea",t);var n=e.prototype;return n.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},n.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},n.onVBarChanged=function(t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},n.onHBarChanged=function(t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},n.changeScroll=function(){var t=this._vScrollBar&&0<this._tf.maxScrollY,e=this._hScrollBar&&0<this._tf.maxScrollX,i=t?this._width-this._vScrollBar.width:this._width,n=e?this._height-this._hScrollBar.height:this._height,r=this._tf.padding||I.labelPadding;this._tf.width=i,this._tf.height=n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-r[2],this._vScrollBar.y=r[1],this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-r[1]-r[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=n/Math.max(this._tf.textHeight,n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=t),this._hScrollBar&&(this._hScrollBar.x=r[0],this._hScrollBar.y=this._height-this._hScrollBar.height-r[3],this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-r[0]-r[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=e)},n.scrollTo=function(t){this.commitMeasure(),this._tf.scrollY=t},s(0,n,"scrollY",(function(){return this._tf.scrollY})),s(0,n,"width",t.prototype._$get_width,(function(t){i.superSet(it,this,"width",t),this.callLater(this.changeScroll)})),s(0,n,"hScrollBar",(function(){return this._hScrollBar})),s(0,n,"height",t.prototype._$get_height,(function(t){i.superSet(it,this,"height",t),this.callLater(this.changeScroll)})),s(0,n,"maxScrollX",(function(){return this._tf.maxScrollX})),s(0,n,"vScrollBarSkin",(function(){return this._vScrollBar?this._vScrollBar.skin:null}),(function(t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new et),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=t})),s(0,n,"hScrollBarSkin",(function(){return this._hScrollBar?this._hScrollBar.skin:null}),(function(t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new K),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=t})),s(0,n,"vScrollBar",(function(){return this._vScrollBar})),s(0,n,"maxScrollY",(function(){return this._tf.maxScrollY})),s(0,n,"scrollX",(function(){return this._tf.scrollX})),e}(it);!function(t){function e(){this._uiView=null,this.isCloseOther=!1,e.__super.call(this)}r(e,"laya.ui.AsynDialog",rt);var i=e.prototype;i.createView=function(t){this._uiView=t},i._open=function(t,e,i){this.isModal=t,this.isCloseOther=e,rt.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},i.onCreated=function(){this.createUI(),this.onOpen()},i.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},i.onOpen=function(){rt.manager.open(this,this.isCloseOther),rt.manager.lock(!1)},i.close=function(t,e){void 0===e&&(e=!0),rt.manager.close(this),this.onClose()},i.onClose=function(){},i.destroy=function(t){void 0===t&&(t=!0),laya.ui.View.prototype.destroy.call(this,t),this._uiView=null,this.onDestroy()},i.onDestroy=function(){}}(),i.__init([W])}(window,document,c),void 0!==(r=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),c){var n=c[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))&&(t.exports=r),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,a=i.__newvec,o=laya.maths.Arith,h=laya.webgl.atlas.AtlasResourceManager,l=laya.webgl.shader.BaseShader,c=laya.utils.Browser,u=laya.webgl.utils.Buffer,d=laya.utils.Byte,_=laya.utils.ClassUtils,f=i.Config,p=(laya.events.Event,laya.events.EventDispatcher),m=laya.utils.Handler,g=laya.net.Loader,v=laya.net.LoaderManager,y=(laya.maths.MathUtil,laya.display.Node),x=laya.renders.Render,w=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),b=laya.resource.Resource,S=laya.utils.RunDriver,T=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),C=laya.display.Sprite,M=laya.utils.Stat,I=laya.utils.StringKey,E=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),A=laya.utils.Utils,D=laya.webgl.WebGL,P=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D,i.interface("laya.d3.core.IClone"),i.interface("laya.d3.graphics.IVertex"),i.interface("laya.d3.core.render.IUpdate"),i.interface("laya.d3.core.scene.ITreeNode"),i.interface("laya.d3.core.render.IRenderable"),function(){function t(){}r(t,"laya.d3.animation.AnimationClipParser01"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._animationClip=e,(t._reader=i).__getBuffer(),t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;n<r;n++){var s=i.getUint16(),a=t._strings[s],o=t["READ_"+a];if(null==o)throw new Error("model file err,no this function:"+s+" "+a);o.call()}},t.READ_ANIMATIONS=function(){var e,i=0,n=0,r=t._reader,s=r.__getBuffer(),a=[],o=r.getUint8();for(a.length=o,i=0;i<o;i++)a[i]=r.getUint16();var h=[],l=r.getUint16();for(h.length=l,i=0;i<l;i++)h[i]=r.getFloat32();var c=t._animationClip;c.name=t._strings[r.getUint16()];var u=c._duration=r.getFloat32();c.islooping=!!r.getByte(),c._frameRate=r.getInt16();var d=r.getInt16(),_=c._nodes=new Array;_.length=d,(c._publicClipDatas=[]).length=d;var f=c._nodesMap={},p=0,m=0;for(i=0;i<d;i++){e=_[i]=new B;var g=r.getUint16(),v=e.path=[];for(v.length=g,n=0;n<g;n++)v[n]=t._strings[r.getUint16()];var y=v.join("/"),x=f[y];x||(f[y]=x=[]),x.push(e);var w=r.getInt16();-1!==w&&(e.componentType=t._strings[w]);var b=N._propertyIndexDic[t._strings[r.getUint16()]];if(null==b)throw new Error("AnimationClipParser01:unknown property name.");var S=b<4,T=!S||S&&""===v[0];(e._cacheProperty=T)?p++:m++,e.propertyNameID=b;var C=a[r.getUint8()];e.keyFrameWidth=C/4;var M=e.keyFrames=[],I=M.length=r.getUint16(),E=null,A=NaN;for(n=0;n<I;n++){var D=M[n]=new L;A=D.startTime=h[r.getUint16()];var P=r.pos;D.inTangent=new Float32Array(s.slice(P,P+C)),r.pos+=C,P=r.pos,D.outTangent=new Float32Array(s.slice(P,P+C)),r.pos+=C,P=r.pos,D.data=new Float32Array(s.slice(P,P+C)),r.pos+=C,E&&(E.next=D,E.duration=A-E.startTime),E=D}D.next=null,D.duration=u-A}var R=c._nodeToCachePropertyMap=new Int32Array(d),O=c._cachePropertyMap=new Int32Array(p),F=c._unCachePropertyMap=new Int32Array(m);for(p=m=0,i=0;i<d;i++)(e=_[i])._cacheProperty?(R[i]=p,O[p++]=i):F[m++]=i},t._animationClip=null,t._reader=null,t._strings=[],n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}(),function(){function t(){}r(t,"laya.d3.animation.AnimationClipParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._animationClip=e,(t._reader=i).__getBuffer(),t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;n<r;n++){var s=i.getUint16(),a=t._strings[s],o=t["READ_"+a];if(null==o)throw new Error("model file err,no this function:"+s+" "+a);o.call()}},t.READ_ANIMATIONS=function(){var e,i=0,n=0,r=t._reader,s=r.__getBuffer(),a=[],o=r.getUint8();for(a.length=o,i=0;i<o;i++)a[i]=r.getUint16();var h=[],l=r.getUint16();for(h.length=l,i=0;i<l;i++)h[i]=r.getFloat32();var c=t._animationClip;c.name=t._strings[r.getUint16()];var u=c._duration=r.getFloat32();c.islooping=!!r.getByte(),c._frameRate=r.getInt16();var d=r.getInt16(),_=c._nodes=new Array;_.length=d,(c._publicClipDatas=[]).length=d;var f=c._nodesMap={},p=0,m=0;for(i=0;i<d;i++){e=_[i]=new B;var g=r.getUint16(),v=e.path=[];for(v.length=g,n=0;n<g;n++)v[n]=t._strings[r.getUint16()];var y=v.join("/"),x=f[y];x||(f[y]=x=[]),x.push(e);var w=r.getInt16();-1!==w&&(e.componentType=t._strings[w]);var b=N._propertyIndexDic[t._strings[r.getUint16()]];if(null==b)throw new Error("AnimationClipParser02:unknown property name.");var S=b<4,T=!S||S&&""===v[0];(e._cacheProperty=T)?p++:m++,e.propertyNameID=b;var C=a[r.getUint8()];e.keyFrameWidth=C/4;var M=e.keyFrames=[],I=M.length=r.getUint16(),E=null,A=NaN;for(n=0;n<I;n++){var D=M[n]=new L;A=D.startTime=h[r.getUint16()];var P=r.pos;D.inTangent=new Float32Array(s.slice(P,P+C)),r.pos+=C,P=r.pos,D.outTangent=new Float32Array(s.slice(P,P+C)),r.pos+=C,P=r.pos,D.data=new Float32Array(s.slice(P,P+C)),r.pos+=C,E&&(E.next=D,E.duration=A-E.startTime),E=D}D.next=null,D.duration=u-A}var O=r.getUint16();for(i=0;i<O;i++){var F,k=new R;k.time=r.getFloat32(),k.eventName=t._strings[r.getUint16()];var V=r.getUint16();for(0<V&&(k.params=F=[]),n=0;n<V;n++)switch(r.getByte()){case 0:F.push(!!r.getByte());break;case 1:F.push(r.getInt32());break;case 2:F.push(r.getFloat32());break;case 3:F.push(t._strings[r.getUint16()]);break;default:throw new Error("unknown type.")}c.addEvent(k)}var U=c._nodeToCachePropertyMap=new Int32Array(d),H=c._cachePropertyMap=new Int32Array(p),z=c._unCachePropertyMap=new Int32Array(m);for(p=m=0,i=0;i<d;i++)(e=_[i])._cacheProperty?(U[i]=p,H[p++]=i):z[m++]=i},t._animationClip=null,t._reader=null,t._strings=[],n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var R=function(){function t(){this.time=NaN,this.eventName=null,this.params=null}return r(t,"laya.d3.animation.AnimationEvent"),t}(),N=function(){function t(){this._childs=[],this.transform=new ve(this)}r(t,"laya.d3.animation.AnimationNode");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.addChild=function(t){t._parent=this,t.transform.setParent(this.transform),this._childs.push(t)},e.removeChild=function(t){var e=this._childs.indexOf(t);-1!==e&&this._childs.splice(e,1)},e.getChildByName=function(t){for(var e=0,i=this._childs.length;e<i;e++){var n=this._childs[e];if(n.name===t)return n}return null},e.getChildByIndex=function(t){return this._childs[t]},e.getChildCount=function(){return this._childs.length},e.cloneTo=function(t){var e=t;e.name=this.name;for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i],s=r.clone();e.addChild(s);var a=r.transform,o=s.transform;o.setLocalPosition(a.getLocalPosition()),o.setLocalRotation(a.getLocalRotation()),o.setLocalScale(a.getLocalScale()),o._localRotationEuler=a._localRotationEuler,o._setWorldMatrixIgnoreUpdate(a.getWorldMatrix())}},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.__init__=function(){t.registerAnimationNodeProperty("localPosition",t._getLocalPosition,t._setLocalPosition),t.registerAnimationNodeProperty("localRotation",t._getLocalRotation,t._setLocalRotation),t.registerAnimationNodeProperty("localScale",t._getLocalScale,t._setLocalScale),t.registerAnimationNodeProperty("localRotationEuler",t._getLocalRotationEuler,t._setLocalRotationEuler),t.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",t._getParticleRenderSharedMaterialTintColor,t._setParticleRenderSharedMaterialTintColor),t.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",t._getMeshRenderSharedMaterialTilingOffset,t._setMeshRenderSharedMaterialTilingOffset),t.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",t._getMeshRenderSharedMaterialAlbedo,t._setMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",t._getSkinnedMeshRenderSharedMaterialTilingOffset,t._setSkinnedMeshRenderSharedMaterialTilingOffset),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",t._getSkinnedMeshRenderSharedMaterialAlbedo,t._setSkinnedMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",t._getMeshRenderSharedMaterialAlbedo,t._setMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",t._getSkinnedMeshRenderSharedMaterialAlbedo,t._setSkinnedMeshRenderSharedMaterialAlbedo),t.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",t._getMeshRenderSharedMaterialIntensity,t._setMeshRenderSharedMaterialIntensity),t.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",t._getMeshRenderSharedMaterialAlpha,t._setMeshRenderSharedMaterialAlpha),t.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",t._getMeshRenderSharedMaterialAlphaColor,t._setMeshRenderSharedMaterialAlphaColor),t.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",t._getMeshRenderSharedMaterialBaseColor,t._setMeshRenderSharedMaterialBaseColor),t.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",t._getMeshRenderSharedMaterialDissolve,t._setMeshRenderSharedMaterialDissolve),t.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",t._getMeshRenderSharedMaterialDissolveSpeed,t._setMeshRenderSharedMaterialDissolveSpeed),t.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",t._getMeshRenderSharedMaterialMMultiplier,t._setMeshRenderSharedMaterialMMultiplier),t.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",t._getMeshRenderSharedMaterialBaseScrollSpeedX,t._setMeshRenderSharedMaterialBaseScrollSpeedX),t.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",t._getMeshRenderSharedMaterialBaseScrollSpeedY,t._setMeshRenderSharedMaterialBaseScrollSpeedY),t.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",t._getMeshRenderSharedMaterialSecondScrollSpeedX,t._setMeshRenderSharedMaterialSecondScrollSpeedX),t.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",t._getMeshRenderSharedMaterialSecondScrollSpeedY,t._setMeshRenderSharedMaterialSecondScrollSpeedY),t.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",t._getMeshRenderSharedMaterialDetailTilingOffset,t._setMeshRenderSharedMaterialDetailTilingOffset),t.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",t._getMeshRenderSharedMaterialDissolveTilingOffset,t._setMeshRenderSharedMaterialDissolveTilingOffset),t.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",t._getMeshRenderSharedMaterialMaskTilingOffset,t._setMeshRenderSharedMaterialMaskTilingOffset)},t.registerAnimationNodeProperty=function(e,i,n){if(t._propertyIndexDic[e])throw new Error("AnimationNode: this propertyName has registered.");t._propertyIndexDic[e]=t._propertyIDCounter,t._propertyGetFuncs[t._propertyIDCounter]=i,t._propertySetFuncs[t._propertyIDCounter]=n,t._propertyIDCounter++},t._getLocalPosition=function(t,e){return t?t.transform.getLocalPosition():e._transform.localPosition.elements},t._setLocalPosition=function(t,e,i){if(t)t.transform.setLocalPosition(i);else{var n=e._transform,r=n.localPosition;r.elements=i,n.localPosition=r}},t._getLocalRotation=function(t,e){return t?t.transform.getLocalRotation():e._transform.localRotation.elements},t._setLocalRotation=function(t,e,i){if(t)t.transform.setLocalRotation(i);else{var n=e._transform,r=n.localRotation;r.elements=i,n.localRotation=r}},t._getLocalScale=function(t,e){return t?t.transform.getLocalScale():e._transform.localScale.elements},t._setLocalScale=function(t,e,i){if(t)t.transform.setLocalScale(i);else{var n=e._transform,r=n.localScale;r.elements=i,n.localScale=r}},t._getLocalRotationEuler=function(t,e){return t?t.transform.getLocalRotationEuler():e._transform.localRotationEuler.elements},t._setLocalRotationEuler=function(t,e,i){if(t)t.transform.setLocalRotationEuler(i);else{var n=e._transform,r=n.localRotationEuler;r.elements=i,n.localRotationEuler=r}},t._getMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return e.meshRender.sharedMaterial.tilingOffset.elements},t._setMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.meshRender.material).tilingOffset).elements=i,n.tilingOffset=r},t._getMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.albedoColor.elements:null}return e.meshRender.sharedMaterial.albedoColor.elements},t._setMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.meshRender.material).albedoColor).elements=i,n.albedoColor=r},t._getSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return e.skinnedMeshRender.sharedMaterial.tilingOffset.elements},t._setSkinnedMeshRenderSharedMaterialTilingOffset=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r)}else(r=(n=e.skinnedMeshRender.material).tilingOffset).elements=i,n.tilingOffset=r},t._getSkinnedMeshRenderSharedMaterialAlbedo=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return e.skinnedMeshRender.sharedMaterial.albedoColor.elements},t._setSkinnedMeshRenderSharedMaterialAlbedo=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r)}else(r=(n=e.skinnedMeshRender.material).albedoColor).elements=i,n.albedoColor=r},t._getParticleRenderSharedMaterialTintColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.particleRender.sharedMaterial.tintColor.elements:null}return e.particleRender.sharedMaterial.tintColor.elements},t._setParticleRenderSharedMaterialTintColor=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.particleRender.material).tintColor).elements=i,n.tintColor=r)}else(r=(n=e.particleRender.material).tintColor).elements=i,n.tintColor=r},t._getMeshRenderSharedMaterialAlphaColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.alphaColor.elements:null}return e.meshRender.sharedMaterial.alphaColor.elements},t._setMeshRenderSharedMaterialAlphaColor=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).alphaColor).elements=i,n.alphaColor=r)}else(r=(n=e.meshRender.material).alphaColor).elements=i,n.alphaColor=r},t._getMeshRenderSharedMaterialBaseColor=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseColor.elements:null}return e.meshRender.sharedMaterial.baseColor.elements},t._setMeshRenderSharedMaterialBaseColor=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).baseColor).elements=i,n.baseColor=r)}else(r=(n=e.meshRender.material).baseColor).elements=i,n.baseColor=r},t._getMeshRenderSharedMaterialDissolve=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolve:0}return e.meshRender.sharedMaterial.dissolve},t._setMeshRenderSharedMaterialDissolve=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.dissolve=i[0])}else e.meshRender.material.dissolve=i[0]},t._getMeshRenderSharedMaterialDissolveSpeed=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveSpeed:0}return e.meshRender.sharedMaterial.dissolveSpeed},t._setMeshRenderSharedMaterialDissolveSpeed=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.dissolveSpeed=i[0])}else e.meshRender.material.dissolveSpeed=i[0]},t._getMeshRenderSharedMaterialMMultiplier=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.mMultiplier:0}return e.meshRender.sharedMaterial.mMultiplier},t._setMeshRenderSharedMaterialMMultiplier=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.mMultiplier=i[0])}else e.meshRender.material.mMultiplier=i[0]},t._getMeshRenderSharedMaterialBaseScrollSpeedX=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return e.meshRender.sharedMaterial.baseScrollSpeedX},t._setMeshRenderSharedMaterialBaseScrollSpeedX=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedX=i[0])}else e.meshRender.material.baseScrollSpeedX=i[0]},t._getMeshRenderSharedMaterialBaseScrollSpeedY=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return e.meshRender.sharedMaterial.baseScrollSpeedY},t._setMeshRenderSharedMaterialBaseScrollSpeedY=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.baseScrollSpeedY=i[0])}else e.meshRender.material.baseScrollSpeedY=i[0]},t._getMeshRenderSharedMaterialSecondScrollSpeedX=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return e.meshRender.sharedMaterial.secondScrollSpeedX},t._setMeshRenderSharedMaterialSecondScrollSpeedX=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedX=i[0])}else e.meshRender.material.secondScrollSpeedX=i[0]},t._getMeshRenderSharedMaterialSecondScrollSpeedY=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return e.meshRender.sharedMaterial.secondScrollSpeedY},t._setMeshRenderSharedMaterialSecondScrollSpeedY=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.secondScrollSpeedY=i[0])}else e.meshRender.material.secondScrollSpeedY=i[0]},t._getMeshRenderSharedMaterialAlpha=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.alpha:0}return e.meshRender.sharedMaterial.alpha},t._setMeshRenderSharedMaterialAlpha=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.alpha=i[0])}else e.meshRender.material.alpha=i[0]},t._getMeshRenderSharedMaterialIntensity=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.intensity:0}return e.meshRender.sharedMaterial.intensity},t._setMeshRenderSharedMaterialIntensity=function(t,e,i){if(t){var n=t.transform._entity;n&&(n.owner.meshRender.material.intensity=i[0])}else e.meshRender.material.intensity=i[0]},t._getMeshRenderSharedMaterialDetailTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return e.meshRender.sharedMaterial.detailTilingOffset.elements},t._setMeshRenderSharedMaterialDetailTilingOffset=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=r)}else(r=(n=e.meshRender.material).detailTilingOffset).elements=i,n.detailTilingOffset=r},t._getMeshRenderSharedMaterialDissolveTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return e.meshRender.sharedMaterial.dissolveTilingOffset.elements},t._setMeshRenderSharedMaterialDissolveTilingOffset=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=r)}else(r=(n=e.meshRender.material).dissolveTilingOffset).elements=i,n.dissolveTilingOffset=r},t._getMeshRenderSharedMaterialMaskTilingOffset=function(t,e){if(t){var i=t.transform._entity;return i?i.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return e.meshRender.sharedMaterial.maskTilingOffset.elements},t._setMeshRenderSharedMaterialMaskTilingOffset=function(t,e,i){var n,r;if(t){var s=t.transform._entity;s&&((r=(n=s.owner.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=r)}else(r=(n=e.meshRender.material).maskTilingOffset).elements=i,n.maskTilingOffset=r},t._propertyIDCounter=0,t._propertyIndexDic={},t._propertySetFuncs=[],t._propertyGetFuncs=[],t}(),L=function(){function t(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return r(t,"laya.d3.animation.Keyframe"),t}(),B=function(){function t(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return r(t,"laya.d3.animation.KeyframeNode"),t}(),O=(function(){function t(){this._tempVector30=new ae,this._tempVector31=new ae,this._tempVector32=new ae,this._a=new ae,this._b=new ae,this._c=new ae,this._d=new ae}r(t,"laya.d3.core.glitter.SplineCurvePositionVelocity");var e=t.prototype;e.Init=function(t,e,i,n){t.cloneTo(this._d),e.cloneTo(this._c),ae.scale(t,2,this._a),ae.scale(i,2,this._tempVector30),ae.subtract(this._a,this._tempVector30,this._a),ae.add(this._a,e,this._a),ae.add(this._a,n,this._a),ae.scale(i,3,this._b),ae.scale(t,3,this._tempVector30),ae.subtract(this._b,this._tempVector30,this._b),ae.subtract(this._b,n,this._b),ae.scale(e,2,this._tempVector30),ae.subtract(this._b,this._tempVector30,this._b)},e.Slerp=function(t,e){ae.scale(this._a,t*t*t,this._tempVector30),ae.scale(this._b,t*t,this._tempVector31),ae.scale(this._c,t,this._tempVector32),ae.add(this._tempVector30,this._tempVector31,e),ae.add(e,this._tempVector32,e),ae.add(e,this._d,e)}}(),function(){function t(t,e,i,n){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=t,this._h=e,this._minHeight=i,this._maxHeight=n}r(t,"laya.d3.core.HeightMap");var e=t.prototype;e._inBounds=function(t,e){return 0<=t&&t<this._h&&0<=e&&e<this._w},e.getHeight=function(t,e){return this._inBounds(t,e)?this._datas[t][e]:NaN},s(0,e,"width",(function(){return this._w})),s(0,e,"height",(function(){return this._h})),s(0,e,"maxHeight",(function(){return this._maxHeight})),s(0,e,"minHeight",(function(){return this._minHeight})),t.creatFromMesh=function(e,i,n,r){for(var s=[],a=[],o=e.getSubMeshCount(),h=0;h<o;h++){for(var l=e.getSubMesh(h),c=l._getVertexBuffer(),u=c.getData(),d=[],_=0;_<u.length;_+=c.vertexDeclaration.vertexStride/4){var f=new ae(u[_+0],u[_+1],u[_+2]);d.push(f)}s.push(d);var p=l._getIndexBuffer();a.push(p.getData())}var m=e.boundingBox,g=m.min.x,v=m.min.z,y=m.max.x,x=m.max.z,w=m.min.y,b=m.max.y,S=y-g,T=x-v,C=r.elements[0]=S/(i-1),M=r.elements[1]=T/(n-1),I=new t(i,n,w,b),E=t._tempRay,A=E.direction.elements;A[0]=0,A[1]=-1,A[2]=0;var D=b+.1;E.origin.elements[1]=D;for(var P=0;P<n;P++){var R=v+P*M;I._datas[P]=[];for(var N=0;N<i;N++){var L=g+N*C,B=E.origin.elements;B[0]=L,B[2]=R;var O=t._getPosition(E,s,a);I._datas[P][N]=O===Number.MAX_VALUE?NaN:D-O}}return I},t.createFromImage=function(e,i,n){for(var r=e.width,s=e.height,a=new t(r,s,i,n),o=(n-i)/254,h=e.getPixels(),l=0,c=0;c<s;c++)for(var u=a._datas[c]=[],d=0;d<r;d++){var _=h[l++],f=h[l++],p=h[l++],m=h[l++];u[d]=255==_&&255==f&&255==p&&255==m?NaN:(_+f+p)/3*o+i}return a},t._getPosition=function(t,e,i){for(var n=Number.MAX_VALUE,r=0;r<e.length;r++)for(var s=e[r],a=i[r],o=0;o<a.length;o+=3){var h=s[a[o+0]],l=s[a[o+1]],c=s[a[o+2]],u=fe.rayIntersectsTriangle(t,h,l,c);!isNaN(u)&&u<n&&(n=u)}return n},n(t,["_tempRay",function(){return this._tempRay=new re(new ae,new ae)}])}(),function(){function t(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}r(t,"laya.d3.core.Layer");var e=t.prototype;return e._binarySearchIndex=function(){for(var e=0,i=t._collsionTestList.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=t._collsionTestList[n];if(r==this._number)return n;r>this._number?i=n-1:e=n+1}return e},e._addCollider=function(e){0===this._colliders.length&&t._collsionTestList.splice(this._binarySearchIndex(),0,this._number),e._isRigidbody?(this._colliders.unshift(e),this._nonRigidbodyOffset++):this._colliders.push(e)},e._removeCollider=function(e){var i=this._colliders.indexOf(e);i<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(i,1),0===this._colliders.length&&t._collsionTestList.splice(t._collsionTestList.indexOf(this._number),1)},s(0,e,"number",(function(){return this._number})),s(0,e,"visible",(function(){return this._visible}),(function(e){this._visible=e,t._visibleLayers=e?t._visibleLayers|this.mask:t._visibleLayers&~this.mask})),s(0,e,"mask",(function(){return this._mask})),s(1,t,"visibleLayers",(function(){return t._visibleLayers}),(function(e){t._visibleLayers=e;for(var i=0,n=t._layerList.length;i<n;i++){var r=t._layerList[i];r._visible=0!=(r._mask&t._visibleLayers)}})),t.__init__=function(){t._layerList.length=31;for(var e=0;e<31;e++){var i=new t;t._layerList[e]=i,0===e?(i.name="Default Layer",i.visible=!0):(i.name="Layer-"+e,i.visible=!1),i._number=e,i._mask=Math.pow(2,e)}t.currentCreationLayer=t._layerList[0]},t.getLayerByNumber=function(e){if(e<0||30<e)throw new Error("无法返回指定Layer，该number超出范围！");return t._layerList[e]},t.getLayerByName=function(e){for(var i=0;i<31;i++)if(t._layerList[i].name===e)return t._layerList[i];throw new Error("无法返回指定Layer,该name不存在")},t.isVisible=function(e){return 0!=(e&t._currentCameraCullingMask&t._visibleLayers)},t._layerList=[],t._visibleLayers=2147483647,t._collsionTestList=[],t._currentCameraCullingMask=2147483647,t.maxCount=31,t.currentCreationLayer=null,t}()),F=(function(){function t(t,e,i){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=t,this._minCount=e,this._maxCount=i}r(t,"laya.d3.core.particleShuriKen.module.Burst");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"time",(function(){return this._time})),s(0,e,"minCount",(function(){return this._minCount})),s(0,e,"maxCount",(function(){return this._maxCount}))}(),function(){function t(t){this._color=null,this.enbale=!1,this._color=t}r(t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var e=t.prototype;e.cloneTo=function(t){var e=t;this._color.cloneTo(e._color),e.enbale=this.enbale},e.clone=function(){var t;switch(this._color.type){case 0:t=V.createByConstant(this._color.constant.clone());break;case 1:t=V.createByGradient(this._color.gradient.clone());break;case 2:t=V.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=V.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},s(0,e,"color",(function(){return this._color}))}(),function(){function t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}r(t,"laya.d3.core.particleShuriKen.module.Emission");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),e._destroy=function(){this._bursts=null,this._destroyed=!0},e.getBurstsCount=function(){return this._bursts.length},e.getBurstByIndex=function(t){return this._bursts[t]},e.addBurst=function(t){var e=this._bursts.length;if(0<e)for(var i=0;i<e;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)},e.removeBurst=function(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)},e.removeBurstByIndex=function(t){this._bursts.splice(t,1)},e.clearBurst=function(){this._bursts.length=0},e.cloneTo=function(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var n=0,r=this._bursts.length;n<r;n++){var s=i[n];s?this._bursts[n].cloneTo(s):i[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"destroyed",(function(){return this._destroyed})),s(0,e,"emissionRate",(function(){return this._emissionRate}),(function(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}))}(),function(){function t(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}r(t,"laya.d3.core.particleShuriKen.module.FrameOverTime");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax.cloneTo(e._overTimeMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"frameOverTimeData",(function(){return this._overTime})),s(0,e,"constant",(function(){return this._constant})),s(0,e,"type",(function(){return this._type})),s(0,e,"frameOverTimeDataMin",(function(){return this._overTimeMin})),s(0,e,"constantMin",(function(){return this._constantMin})),s(0,e,"frameOverTimeDataMax",(function(){return this._overTimeMax})),s(0,e,"constantMax",(function(){return this._constantMax})),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByOverTime=function(e){var i=new t;return i._type=1,i._overTime=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoOverTime=function(e,i){var n=new t;return n._type=3,n._overTimeMin=e,n._overTimeMax=i,n},t}()),k=function(){function t(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradientZ",(function(){return this._gradientZ})),s(0,e,"constant",(function(){return this._constant})),s(0,e,"gradient",(function(){return this._gradient})),s(0,e,"separateAxes",(function(){return this._separateAxes})),s(0,e,"type",(function(){return this._type})),s(0,e,"constantSeparate",(function(){return this._constantSeparate})),s(0,e,"gradientX",(function(){return this._gradientX})),s(0,e,"gradientY",(function(){return this._gradientY})),s(0,e,"gradientW",(function(){return this._gradientW})),s(0,e,"gradientMin",(function(){return this._gradientMin})),s(0,e,"constantMin",(function(){return this._constantMin})),s(0,e,"gradientMax",(function(){return this._gradientMax})),s(0,e,"constantMax",(function(){return this._constantMax})),s(0,e,"gradientWMin",(function(){return this._gradientWMin})),s(0,e,"constantMinSeparate",(function(){return this._constantMinSeparate})),s(0,e,"constantMaxSeparate",(function(){return this._constantMaxSeparate})),s(0,e,"gradientXMin",(function(){return this._gradientXMin})),s(0,e,"gradientXMax",(function(){return this._gradientXMax})),s(0,e,"gradientWMax",(function(){return this._gradientWMax})),s(0,e,"gradientYMin",(function(){return this._gradientYMin})),s(0,e,"gradientYMax",(function(){return this._gradientYMax})),s(0,e,"gradientZMin",(function(){return this._gradientZMin})),s(0,e,"gradientZMax",(function(){return this._gradientZMax})),t.createByConstant=function(e){var i=new t;return i._type=0,i._separateAxes=!1,i._constant=e,i},t.createByConstantSeparate=function(e){var i=new t;return i._type=0,i._separateAxes=!0,i._constantSeparate=e,i},t.createByGradient=function(e){var i=new t;return i._type=1,i._separateAxes=!1,i._gradient=e,i},t.createByGradientSeparate=function(e,i,n,r){var s=new t;return s._type=1,s._separateAxes=!0,s._gradientX=e,s._gradientY=i,s._gradientZ=n,s._gradientW=r,s},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._separateAxes=!1,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoConstantSeparate=function(e,i){var n=new t;return n._type=2,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=3,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=i,n},t.createByRandomTwoGradientSeparate=function(e,i,n,r,s,a,o,h){var l=new t;return l._type=3,l._separateAxes=!0,l._gradientXMin=e,l._gradientXMax=i,l._gradientYMin=n,l._gradientYMax=r,l._gradientZMin=s,l._gradientZMax=a,l._gradientWMin=o,l._gradientWMax=h,l},t}(),V=function(){function t(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientColor");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradient",(function(){return this._gradient})),s(0,e,"constant",(function(){return this._constant})),s(0,e,"type",(function(){return this._type})),s(0,e,"gradientMin",(function(){return this._gradientMin})),s(0,e,"constantMin",(function(){return this._constantMin})),s(0,e,"gradientMax",(function(){return this._gradientMax})),s(0,e,"constantMax",(function(){return this._constantMax})),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByGradient=function(e){var i=new t;return i._type=1,i._gradient=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=3,n._gradientMin=e,n._gradientMax=i,n},t}(),U=(function(){function t(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataColor");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.addAlpha=function(t,e){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==t&&(t=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=t,this._alphaElements[this._alphaCurrentLength++]=e):DEBUG},e.addRGB=function(t,e){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==t&&(t=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=t,this._rgbElements[this._rgbCurrentLength++]=e.x,this._rgbElements[this._rgbCurrentLength++]=e.y,this._rgbElements[this._rgbCurrentLength++]=e.z):DEBUG},e.cloneTo=function(t){var e=t,i=0,n=0;e._alphaCurrentLength=this._alphaCurrentLength;var r=e._alphaElements;for(r.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)r[i]=this._alphaElements[i];e._rgbCurrentLength=this._rgbCurrentLength;var s=e._rgbElements;for(s.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)s[i]=this._rgbElements[i]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"alphaGradientCount",(function(){return this._alphaCurrentLength/2})),s(0,e,"rgbGradientCount",(function(){return this._rgbCurrentLength/4}))}(),function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradientCount",(function(){return this._currentLength/2}))}(),function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,DEBUG),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):DEBUG},e.getKeyByIndex=function(t){return this._elements[2*t]},e.getValueByIndex=function(t){return this._elements[2*t+1]},e.getAverageValue=function(){for(var t=0,e=this._currentLength-2;t<e;t+=2)this._elements[t+1],this._elements[t+3],this._elements[t+2],this._elements[t];return 0},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradientCount",(function(){return this._currentLength/2}))}(),function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}r(t,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e.x,this._elements[this._currentLength++]=e.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradientCount",(function(){return this._currentLength/3}))}(),function(){function t(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientSize");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.getMaxSizeInGradient=function(){var t=0,e=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(t=0,e=this._gradientX.gradientCount;t<e;t++)i=Math.max(i,this._gradientX.getValueByIndex(t));for(t=0,e=this._gradientY.gradientCount;t<e;t++)i=Math.max(i,this._gradientY.getValueByIndex(t))}else for(t=0,e=this._gradient.gradientCount;t<e;t++)i=Math.max(i,this._gradient.getValueByIndex(t));break;case 1:i=this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),Math.max(i,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(t=0,e=this._gradientXMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMin.getValueByIndex(t));for(t=0,e=this._gradientXMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMax.getValueByIndex(t));for(t=0,e=this._gradientYMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientYMin.getValueByIndex(t));for(t=0,e=this._gradientZMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientZMax.getValueByIndex(t))}else{for(t=0,e=this._gradientMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientMin.getValueByIndex(t));for(t=0,e=this._gradientMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientMax.getValueByIndex(t))}}return i},e.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradientZ",(function(){return this._gradientZ})),s(0,e,"gradient",(function(){return this._gradient})),s(0,e,"separateAxes",(function(){return this._separateAxes})),s(0,e,"type",(function(){return this._type})),s(0,e,"gradientMin",(function(){return this._gradientMin})),s(0,e,"constantMin",(function(){return this._constantMin})),s(0,e,"gradientX",(function(){return this._gradientX})),s(0,e,"gradientY",(function(){return this._gradientY})),s(0,e,"gradientMax",(function(){return this._gradientMax})),s(0,e,"constantMax",(function(){return this._constantMax})),s(0,e,"constantMinSeparate",(function(){return this._constantMinSeparate})),s(0,e,"constantMaxSeparate",(function(){return this._constantMaxSeparate})),s(0,e,"gradientXMin",(function(){return this._gradientXMin})),s(0,e,"gradientXMax",(function(){return this._gradientXMax})),s(0,e,"gradientYMin",(function(){return this._gradientYMin})),s(0,e,"gradientYMax",(function(){return this._gradientYMax})),s(0,e,"gradientZMin",(function(){return this._gradientZMin})),s(0,e,"gradientZMax",(function(){return this._gradientZMax})),t.createByGradient=function(e){var i=new t;return i._type=0,i._separateAxes=!1,i._gradient=e,i},t.createByGradientSeparate=function(e,i,n){var r=new t;return r._type=0,r._separateAxes=!0,r._gradientX=e,r._gradientY=i,r._gradientZ=n,r},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=1,n._separateAxes=!1,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoConstantSeparate=function(e,i){var n=new t;return n._type=1,n._separateAxes=!0,n._constantMinSeparate=e,n._constantMaxSeparate=i,n},t.createByRandomTwoGradient=function(e,i){var n=new t;return n._type=2,n._separateAxes=!1,n._gradientMin=e,n._gradientMax=i,n},t.createByRandomTwoGradientSeparate=function(e,i,n,r,s,a){var o=new t;return o._type=2,o._separateAxes=!0,o._gradientXMin=e,o._gradientXMax=i,o._gradientYMin=n,o._gradientYMax=r,o._gradientZMin=s,o._gradientZMax=a,o},t}()),H=function(){function t(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}r(t,"laya.d3.core.particleShuriKen.module.GradientVelocity");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"gradientZ",(function(){return this._gradientZ})),s(0,e,"constant",(function(){return this._constant})),s(0,e,"type",(function(){return this._type})),s(0,e,"gradientXMax",(function(){return this._gradientXMax})),s(0,e,"constantMin",(function(){return this._constantMin})),s(0,e,"gradientX",(function(){return this._gradientX})),s(0,e,"gradientY",(function(){return this._gradientY})),s(0,e,"gradientXMin",(function(){return this._gradientXMin})),s(0,e,"constantMax",(function(){return this._constantMax})),s(0,e,"gradientYMin",(function(){return this._gradientYMin})),s(0,e,"gradientYMax",(function(){return this._gradientYMax})),s(0,e,"gradientZMin",(function(){return this._gradientZMin})),s(0,e,"gradientZMax",(function(){return this._gradientZMax})),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByGradient=function(e,i,n){var r=new t;return r._type=1,r._gradientX=e,r._gradientY=i,r._gradientZ=n,r},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=2,n._constantMin=e,n._constantMax=i,n},t.createByRandomTwoGradient=function(e,i,n,r,s,a){var o=new t;return o._type=3,o._gradientXMin=e,o._gradientXMax=i,o._gradientYMin=n,o._gradientYMax=r,o._gradientZMin=s,o._gradientZMax=a,o},t}(),z=(function(){function t(t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=t}r(t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale},e.clone=function(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?k.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):k.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?k.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):k.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?k.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):k.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?k.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):k.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},s(0,e,"angularVelocity",(function(){return this._angularVelocity}))}(),function(){function t(){this.enable=!1,this.randomDirection=!1}r(t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e._getShapeBoundBox=function(t){throw new Error("BaseShape: must override it.")},e._getSpeedBoundBox=function(t){throw new Error("BaseShape: must override it.")},e.generatePositionAndDirection=function(t,e,i,n){throw new Error("BaseShape: must override it.")},e._calculateProceduralBounds=function(t,e,i){this._getShapeBoundBox(t);var n=t.min,r=t.max;ae.multiply(n,e,n),ae.multiply(r,e,r);var s=new qt(new ae,new ae);this.randomDirection?(s.min=new ae(-1,-1,-1),s.max=new ae(1,1,1)):this._getSpeedBoundBox(s);var a=new qt(new ae,new ae),o=a.min,h=a.max;ae.scale(s.min,i.y,o),ae.scale(s.max,i.y,h),ae.add(t.min,o,o),ae.add(t.max,h,h),ae.min(t.min,o,t.min),ae.max(t.max,o,t.max);var l=new qt(new ae,new ae),c=l.min,u=l.max;ae.scale(s.min,i.x,c),ae.scale(s.max,i.x,u),ae.min(l.min,u,o),ae.max(l.min,u,h),ae.min(t.min,o,t.min),ae.max(t.max,o,t.max)},e.cloneTo=function(t){t.enable=this.enable},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}()),W=function(){function t(){}return r(t,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),t._randomPointUnitArcCircle=function(t,e,i){var n,r=e.elements;n=i?i.getFloat()*t:Math.random()*t,r[0]=Math.cos(n),r[1]=Math.sin(n)},t._randomPointInsideUnitArcCircle=function(e,i,n){var r=i.elements;t._randomPointUnitArcCircle(e,i,n);var s;s=n?Math.pow(n.getFloat(),.5):Math.pow(Math.random(),.5),r[0]=r[0]*s,r[1]=r[1]*s},t._randomPointUnitCircle=function(t,e){var i,n=t.elements;i=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,n[0]=Math.cos(i),n[1]=Math.sin(i)},t._randomPointInsideUnitCircle=function(e,i){var n=e.elements;t._randomPointUnitCircle(e);var r;r=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),n[0]=n[0]*r,n[1]=n[1]*r},t._randomPointUnitSphere=function(t,e){var i,n=t.elements,r=NaN;i=e?(r=n[2]=2*e.getFloat()-1,e.getFloat()*Math.PI*2):(r=n[2]=2*Math.random()-1,Math.random()*Math.PI*2);var s=Math.sqrt(1-r*r);n[0]=s*Math.cos(i),n[1]=s*Math.sin(i)},t._randomPointInsideUnitSphere=function(e,i){var n=e.elements;t._randomPointUnitSphere(e);var r;r=i?Math.pow(i.getFloat(),1/3):Math.pow(Math.random(),1/3),n[0]=n[0]*r,n[1]=n[1]*r,n[2]=n[2]*r},t._randomPointInsideHalfUnitBox=function(t,e){var i=t.elements;e?(i[0]=e.getFloat()-.5,i[1]=e.getFloat()-.5,i[2]=e.getFloat()-.5):(i[0]=Math.random()-.5,i[1]=Math.random()-.5,i[2]=Math.random()-.5)},t}(),G=(function(){function t(t){this._size=null,this.enbale=!1,this._size=t}r(t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._size.cloneTo(e._size),e.enbale=this.enbale},e.clone=function(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?U.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):U.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?U.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):U.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?U.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):U.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},s(0,e,"size",(function(){return this._size}))}(),function(){function t(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}r(t,"laya.d3.core.particleShuriKen.module.StartFrame");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"constant",(function(){return this._constant})),s(0,e,"type",(function(){return this._type})),s(0,e,"constantMin",(function(){return this._constantMin})),s(0,e,"constantMax",(function(){return this._constantMax})),t.createByConstant=function(e){var i=new t;return i._type=0,i._constant=e,i},t.createByRandomTwoConstant=function(e,i){var n=new t;return n._type=1,n._constantMin=e,n._constantMax=i,n},t}()),Y=(function(){function t(t,e){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new se(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}r(t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame),e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable},e.clone=function(){var t,e;switch(this._frame.type){case 0:t=F.createByConstant(this._frame.constant);break;case 1:t=F.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=F.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=F.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:e=G.createByConstant(this._startFrame.constant);break;case 1:e=G.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(t,e);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},s(0,e,"frame",(function(){return this._frame})),s(0,e,"startFrame",(function(){return this._startFrame}))}(),function(){function t(t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=t}r(t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var e=t.prototype;i.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space},e.clone=function(){var t;switch(this._velocity.type){case 0:t=H.createByConstant(this._velocity.constant.clone());break;case 1:t=H.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=H.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=H.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e.space=this.space,e},s(0,e,"velocity",(function(){return this._velocity}))}(),function(){function t(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new de,this._vb=ke.create(t._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=Fe.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=Be.nameKey.getID("LINE"),this._shaderCompile=Te._preCompileShader[this._sharderNameID]}r(t,"laya.d3.core.PhasorSpriter3D");var e=t.prototype;return e.line=function(t,e,i,n){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t.x,t.y,t.z,e.x,e.y,e.z,e.w),this.addVertex(i.x,i.y,i.z,n.x,n.y,n.z,n.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},e.circle=function(t,e,i,n,r,s){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*e,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/e,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*t,Math.cos(this._tempNumver0)*t,0,i,n,r,s),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},e.plane=function(t,e,i,n,r,s,a,o,h){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i,s,a,o,h),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i,s,a,o,h),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i,s,a,o,h),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i,s,a,o,h),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},e.box=function(t,e,i,n,r,s,a,o,h,l){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=n/2,this._tempNumver1=r/2,this._tempNumver2=s/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,a,o,h,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i+this._tempNumver2,a,o,h,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,a,o,h,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i+this._tempNumver2,a,o,h,l),this.addVertex(t+this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,a,o,h,l),this.addVertex(t-this._tempNumver0,e+this._tempNumver1,i-this._tempNumver2,a,o,h,l),this.addVertex(t+this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,a,o,h,l),this.addVertex(t-this._tempNumver0,e-this._tempNumver1,i-this._tempNumver2,a,o,h,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},e.cone=function(t,e,i,n,r,s,a){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*i+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*i>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/i,this.addVertexIndex(0,e,0,n,r,s,a,this._tempUint0),this.addVertexIndex(0,0,0,n,r,s,a,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<i;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,s,a,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==i-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(t*this._tempNumver2,0,t*this._tempNumver3,n,r,s,a,this._tempUint0+(this._tempInt0+i)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==i-1?this.addIndexes(this._tempUint1+i+2):this.addIndexes(this._tempUint1+this._tempInt0+i+1),this.addIndexes(this._tempUint1+this._tempInt0+i),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},e.boundingBoxLine=function(t,e,i,n,r,s,a,o,h,l){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(t,r,s,a,o,h,l),this.addVertex(n,r,s,a,o,h,l),this.addVertex(t,e,s,a,o,h,l),this.addVertex(n,e,s,a,o,h,l),this.addVertex(n,r,i,a,o,h,l),this.addVertex(t,r,i,a,o,h,l),this.addVertex(n,e,i,a,o,h,l),this.addVertex(t,e,i,a,o,h,l),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},e.addVertex=function(t,e,i,n,r,s,a){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=t,this._vbData[this._posInVBData+1]=e,this._vbData[this._posInVBData+2]=i,this._vbData[this._posInVBData+3]=n,this._vbData[this._posInVBData+4]=r,this._vbData[this._posInVBData+5]=s,this._vbData[this._posInVBData+6]=a,this._posInVBData+=this._floatSizePerVer,this},e.addVertexIndex=function(t,e,i,n,r,s,a,o){return this._hasBegun||this.addVertexIndexException(),this._vbData[o]=t,this._vbData[o+1]=e,this._vbData[o+2]=i,this._vbData[o+3]=n,this._vbData[o+4]=r,this._vbData[o+5]=s,this._vbData[o+6]=a,(o+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=o),this},e.addIndexes=function(t){var e=arguments;this._hasBegun||this.addVertexIndexException();for(var i=0;i<e.length;i++)this._ibData[this._posInIBData]=e[i],this._posInIBData++;return this},e.begin=function(t,e){return this._hasBegun&&this.beginException0(),1!==t&&4!==t&&this.beginException1(),this._primitiveType=t,this._camera=e,this._hasBegun=!0,this},e.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},e.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(t._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),M.drawCall++,D.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},e.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},e.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},e.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},e.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},e.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},e.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(28,[new at(0,"vector3",0),new at(12,"vector4",1)])}]),t}()),X=function(){function t(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++t._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new de}r(t,"laya.d3.core.render.RenderElement");var e=t.prototype;return e.getDynamicBatchBakedVertexs=function(t){for(var e=this._renderObj._getVertexBuffer(t),i=e.getData().slice(),n=e.vertexDeclaration,r=n.getVertexElementByUsage(0).offset/4,s=n.getVertexElementByUsage(3).offset/4,a=this._sprite3D.transform,o=a.worldMatrix,h=a.rotation,l=n.vertexStride/4,c=0,u=i.length;c<u;c+=l){var d=c+r,_=c+s;me.transformVector3ArrayToVector3ArrayCoordinate(i,d,o,i,d),me.transformVector3ArrayByQuat(i,_,h,i,_)}return i},e.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},e._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},s(0,e,"id",(function(){return this._id})),s(0,e,"renderObj",(function(){return this._renderObj}),(function(t){this._renderObj!==t&&(this._renderObj=t)})),t._uniqueIDCounter=0,t}(),j=function(){function t(e){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++t._uniqueIDCounter,this._needSort=!1,this._scene=e,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}r(t,"laya.d3.core.render.RenderQueue");var e=t.prototype;return e._sortOpaqueFunc=function(t,e){if(t._render&&e._render){var i=t._material.renderQueue-e._material.renderQueue;return 0==i?t._material.constructor&&e._material.constructor&&t._material.constructor.name&&e._material.constructor.name&&t._material.constructor.name==t._material.constructor.name&&t._sprite3D&&e._sprite3D&&t._sprite3D.name&&e._sprite3D.name&&t._sprite3D.name===e._sprite3D.name?0:t._render._distanceForSort-e._render._distanceForSort:i}return 0},e._sortAlphaFunc=function(t,e){if(t._render&&e._render){var i=t._material.renderQueue-e._material.renderQueue;return 0==i?t._material.constructor&&e._material.constructor&&t._material.constructor.name&&e._material.constructor.name&&t._material.constructor.name==t._material.constructor.name&&t._sprite3D&&e._sprite3D&&t._sprite3D.name&&e._sprite3D.name&&t._sprite3D.name===e._sprite3D.name?0:e._render._distanceForSort-t._render._distanceForSort:i}return 0},e._begainRenderElement=function(t,e,i){return!!e._beforeRender(t)},e._sortAlpha=function(e){t._cameraPosition=e,this._finalElements.sort(this._sortAlphaFunc)},e._sortOpaque=function(e){t._cameraPosition=e,this._finalElements.sort(this._sortOpaqueFunc)},e._preRender=function(t){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},e._render=function(t,e){for(var n,r,s,a,o,h,l=M.loopCount,c=this._scene,u=t.camera,d=(u.id,!1),_=0,f=this._finalElements.length;_<f;_++){var p,m,g,v=this._finalElements[_];if(null!=v._onPreRenderFunction&&v._onPreRenderFunction.call(v._sprite3D,t),0===v._type){if(t.owner=g=v._sprite3D,t.renderElement=v,g._preRenderUpdateComponents(t),p=v.renderObj,m=v._material,this._begainRenderElement(t,p,m)){if(n=p._getVertexBuffers(),!(s=(r=p._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[r.id]){this._errorRecord[r.id]=1;var y="vertexBuffer:("+r._destroyed+","+r._released+","+r._referenceCount+","+r._buffer+"), material:"+(m?m.__className+"("+m._destroyed+","+m._released+")":"null")+", owner:"+(g?g.__className+"("+g._destroyed+","+g._activeInHierarchy+","+g._displayedInStage+")":"null")+", renderObj:"+(p?p.__className+"("+p._destroyed+","+p._released+","+p._referenceCount+")":"")+", parent:, url:"+(g?g.url:"")+", disposeStack:"+r.disposeStack;i.recordError("报错：unknown vertexDeclaration  "+y)}continue}if(d=(a=t._shader=m._getShader(c._shaderDefineValue,s.shaderDefineValue,g._shaderDefineValue)).bind()||l!==a._uploadLoopCount,n){if(a._uploadVertexBuffer!==n||d){for(var x=0;x<n.length;x++){var w=n[x];a.uploadAttributesX(w.vertexDeclaration.shaderValues.data,w)}a._uploadVertexBuffer=n}}else(a._uploadVertexBuffer!==r||d)&&(a.uploadAttributes(s.shaderValues.data,null),a._uploadVertexBuffer=r);(a._uploadScene!==c||d)&&(a.uploadSceneUniforms(c._shaderValues.data),a._uploadScene=c),(u!==a._uploadCamera||a._uploadSprite3D!==g||d)&&(a.uploadSpriteUniforms(g._shaderValues.data),a._uploadSprite3D=g),(u!==a._uploadCamera||d)&&(a.uploadCameraUniforms(u._shaderValues.data),a._uploadCamera=u),(a._uploadMaterial!==m||d)&&(m._upload(),a._uploadMaterial=m),o!==m?(m._setRenderStateBlendDepth(),m._setRenderStateFrontFace(e,g.transform),o=m,h=g):h!==g&&(m._setRenderStateFrontFace(e,g.transform),h=g),p._render(t),a._uploadLoopCount=l}g._postRenderUpdateComponents(t)}else 2===v._type&&(v.renderObj,t.owner=g=v._sprite3D,t.renderElement=v,t._batchIndexStart=v._tempBatchIndexStart,t._batchIndexEnd=v._tempBatchIndexEnd,p=v.renderObj,m=v._material,this._begainRenderElement(t,p,m)&&(s=(r=p._getVertexBuffer(0)).vertexDeclaration,d=(a=t._shader=m._getShader(c._shaderDefineValue,s.shaderDefineValue,g._shaderDefineValue)).bind()||l!==a._uploadLoopCount,(a._uploadVertexBuffer!==r||d)&&(a.uploadAttributes(s.shaderValues.data,null),a._uploadVertexBuffer=r),(a._uploadScene!==c||d)&&(a.uploadSceneUniforms(c._shaderValues.data),a._uploadScene=c),(u!==a._uploadCamera||a._uploadSprite3D!==g||d)&&(a.uploadSpriteUniforms(g._shaderValues.data),a._uploadSprite3D=g),(u!==a._uploadCamera||d)&&(a.uploadCameraUniforms(u._shaderValues.data),a._uploadCamera=u),(a._uploadMaterial!==m||d)&&(m._upload(),a._uploadMaterial=m),o!==m?(m._setRenderStateBlendDepth(),m._setRenderStateFrontFace(e,g.transform),o=m,h=g):h!==g&&(m._setRenderStateFrontFace(e,g.transform),h=g),p._render(t),a._uploadLoopCount=l))}},e._renderShadow=function(t,e){for(var i,n,r,s,a,o=M.loopCount,h=this._scene,l=t.camera,c=!1,u=0,d=this._finalElements.length;u<d;u++){var _,f,p,m=this._finalElements[u];0===m._type&&(t.owner=p=m._sprite3D,e||p._projectionViewWorldUpdateCamera===l&&p._projectionViewWorldUpdateLoopCount===M.loopCount||(p._render._renderUpdate(t._projectionViewMatrix),p._projectionViewWorldUpdateLoopCount=M.loopCount,p._projectionViewWorldUpdateCamera=l),t.renderElement=m,p._preRenderUpdateComponents(t),_=m.renderObj,f=m._material,this._begainRenderElement(t,_,null)&&(n=(i=_._getVertexBuffer(0)).vertexDeclaration,c=(r=t._shader=f._getShader(h._shaderDefineValue,n.shaderDefineValue,p._shaderDefineValue)).bind()||o!==r._uploadLoopCount,(r._uploadVertexBuffer!==i||c)&&(r.uploadAttributes(n.shaderValues.data,null),r._uploadVertexBuffer=i),(l!==r._uploadCamera||r._uploadSprite3D!==p||c)&&(r.uploadSpriteUniforms(p._shaderValues.data),r._uploadSprite3D=p),(l!==r._uploadCamera||c)&&(r.uploadCameraUniforms(l._shaderValues.data),r._uploadCamera=l),(r._uploadMaterial!==f||c)&&(f._upload(),r._uploadMaterial=f),r._uploadRenderElement,s!==f?(f._setRenderStateFrontFace(!1,p.transform),s=f,a=p):a!==p&&(f._setRenderStateFrontFace(!1,p.transform),a=p),_._render(t),r._uploadLoopCount=o),p._postRenderUpdateComponents(t))}},e._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},e._addRenderElement=function(t){this._renderElements.push(t),this._needSort=!0},e._addDynamicBatchElement=function(t){this._dynamicBatchCombineRenderElements.push(t)},s(0,e,"id",(function(){return this._id})),t._uniqueIDCounter=0,t._cameraPosition=null,t}(),K=function(){function t(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return r(t,"laya.d3.core.render.RenderState"),t.clientWidth=0,t.clientHeight=0,t}(),q=function(){function t(t,e){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new Qt(new ae,0),this._corners=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae],this._boundingBoxCenter=new ae,this._children=a(8),this._objects=[],this._tempBoundBoxCorners=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae],this._scene=t,this._currentDepth=e}r(t,"laya.d3.core.scene.OctreeNode");var e=t.prototype;return i.imps(e,{"laya.d3.core.scene.ITreeNode":!0}),e.init=function(t,e){var i=new ae,n=new ae;ae.scale(e,-.5,i),ae.scale(e,.5,n),ae.add(i,t,i),ae.add(n,t,n),this.exactBox=new qt(i,n),this.relaxBox=new qt(i,n)},e.addTreeNode=function(t){1===Collision.boxContainsBox(this._relaxBox,t.boundingBox)?this.addNodeDown(t,0):this.addObject(t)},e.addChild=function(e){var i=this._children[e];if(null==i){i=new t(this._scene,this._currentDepth+1),(this._children[e]=i)._parent=this,ae.subtract(this._exactBox.max,this._exactBox.min,t.tempSize),ae.multiply(t.tempSize,t._octreeSplit[e],t.tempCenter),ae.add(this._exactBox.min,t.tempCenter,t.tempCenter),ae.scale(t.tempSize,.25,t.tempSize);var n=new ae,r=new ae;ae.subtract(t.tempCenter,t.tempSize,n),ae.add(t.tempCenter,t.tempSize,r),i.exactBox=new qt(n,r),ae.scale(t.tempSize,t.relax,t.tempSize);var s=new ae,a=new ae;ae.subtract(t.tempCenter,t.tempSize,s),ae.add(t.tempCenter,t.tempSize,a),i.relaxBox=new qt(s,a)}return i},e.addObject=function(t){(t._treeNode=this)._objects.push(t)},e.removeObject=function(t){if(t._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var e=this._objects.indexOf(t);return-1!==e&&(this._objects.splice(e,1),!0)},e.clearObject=function(){this._objects.length=0},e.addNodeUp=function(t,e){this._parent&&1!==Collision.boxContainsBox(this._exactBox,t.boundingBox)?this._parent.addNodeUp(t,e-1):this.addNodeDown(t,e)},e.addNodeDown=function(t,e){if(e<this._scene.treeLevel){var i=this.inChildIndex(t.boundingBoxCenter),n=this.addChild(i);1===Collision.boxContainsBox(n._relaxBox,t.boundingBox)?n.addNodeDown(t,++e):this.addObject(t)}else this.addObject(t)},e.inChildIndex=function(t){return 4*(t.z<this._boundingBoxCenter.z?0:1)+2*(t.y<this._boundingBoxCenter.y?0:1)+(t.x<this._boundingBoxCenter.x?0:1)},e.updateObject=function(t){1===Collision.boxContainsBox(this._relaxBox,t.boundingBox)?(this.removeObject(t),t._treeNode=null,this.addNodeDown(t,this._currentDepth)):this._parent&&(this.removeObject(t),t._treeNode=null,this._parent.addNodeUp(t,this._currentDepth-1))},e.cullingObjects=function(t,e,i,n,r){var s,a=0,o=0,h=0,l=this._scene._dynamicBatchManager;for(a=0,s=this._objects.length;a<s;a++){var c=this._objects[a];if(O.isVisible(c._owner.layer.mask)&&c.enable){if(e&&(M.treeSpriteCollision+=1,0===t.containsBoundSphere(c.boundingSphere)))continue;c._renderUpdate(r),c._distanceForSort=ae.distance(c.boundingSphere.center,n)+c.sortingFudge;var u=c._renderElements;for(o=0,h=u.length;o<h;o++){var d=u[o],_=d._staticBatch;if(_&&_._material===d._material)_._addBatchRenderElement(d);else{var f=d.renderObj;f.triangleCount<10&&1===f._vertexBufferCount&&f._getIndexBuffer()&&d._material.renderQueue<2&&d._canDynamicBatch&&!c._owner.isStatic?l._addPrepareRenderElement(d):this._scene.getRenderQueue(d._material.renderQueue)._addRenderElement(d)}}}}for(a=0;a<8;a++){var p=this._children[a];if(null!=p){var m=e;if(e){var g=t.containsBoundBox(p._relaxBox);if(M.treeNodeCollision+=1,0===g)continue;m=2===g}p.cullingObjects(t,m,i,n,r)}}},e.cullingShadowObjects=function(t,e,i,n,r){var s,a=0,o=0,h=0;for(this._scene._dynamicBatchManager,a=0,s=this._objects.length;a<s;a++){var l=this._objects[a];if(l.castShadow&&O.isVisible(l._owner.layer.mask)&&l.enable){if(i&&0===t[0].containsBoundSphere(l.boundingSphere))continue;for(var c=1,u=t.length;c<u;c++){var d=e[c-1];if(0!==t[c].containsBoundSphere(l.boundingSphere)){var _=l._renderElements;for(o=0,h=_.length;o<h;o++)d._addRenderElement(_[o])}}}}for(a=0;a<8;a++){var f=this._children[a];if(null!=f){var p=i;if(i){var m=t[0].containsBoundBox(f._relaxBox);if(0===m)continue;p=2===m}f.cullingShadowObjects(t,e,p,n,r)}}},e.cullingShadowObjectsOnePSSM=function(t,e,i,n,r,s){var a,o=e[0],h=0,l=0,c=0;for(h=0,a=this._objects.length;h<a;h++){var u=this._objects[h];if(u.castShadow&&O.isVisible(u._owner.layer.mask)&&u.enable){if(n&&0===t.containsBoundSphere(u.boundingSphere))continue;u._renderUpdate(i);var d=u._renderElements;for(l=0,c=d.length;l<c;l++)o._addRenderElement(d[l])}}for(h=0;h<8;h++){var _=this._children[h];if(null!=_){var f=n;if(n){var p=t.containsBoundBox(_._relaxBox);if(0===p)continue;f=2===p}_.cullingShadowObjectsOnePSSM(t,e,i,f,r,s)}}},e.renderBoudingBox=function(t){this._renderBoudingBox(t);for(var e=0;e<8;++e){var i=this._children[e];i&&i.renderBoudingBox(t)}},e.buildAllChild=function(t){if(t<this._scene.treeLevel)for(var e=0;e<8;e++)this.addChild(e).buildAllChild(t+1)},e._renderBoudingBox=function(t){},s(0,e,"exactBox",(function(){return this._exactBox}),(function(t){this._exactBox=t,ae.add(t.min,t.max,this._boundingBoxCenter),ae.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)})),s(0,e,"relaxBox",(function(){return this._relaxBox}),(function(t){(this._relaxBox=t).getCorners(this._corners),Qt.createfromPoints(this._corners,this._boundingSphere)})),t.debugMode=!1,t.relax=1.15,t.CHILDNUM=8,n(t,["tempVector0",function(){return this.tempVector0=new ae},"tempSize",function(){return this.tempSize=new ae},"tempCenter",function(){return this.tempCenter=new ae},"_octreeSplit",function(){return this._octreeSplit=[new ae(.25,.25,.25),new ae(.75,.25,.25),new ae(.25,.75,.25),new ae(.75,.75,.25),new ae(.25,.25,.75),new ae(.75,.25,.75),new ae(.25,.75,.75),new ae(.75,.75,.75)]}]),t}(),Z=(r((function(){}),"laya.d3.core.scene.SceneManager"),function(){function t(t,e,i,n){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),this._r=t,this._g=e,this._b=i,this._a=n}return r(t,"laya.d3.core.trail.module.Color",null,"Color$1"),t.prototype.cloneTo=function(t){t._r=this._r,t._g=this._g,t._b=this._b,t._a=this._a},n(t,["RED",function(){return this.RED=new t(1,0,0,1)},"GREEN",function(){return this.GREEN=new t(0,1,0,1)},"BLUE",function(){return this.BLUE=new t(0,0,1,1)},"CYAN",function(){return this.CYAN=new t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new t(1,0,1,1)},"GRAY",function(){return this.GRAY=new t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new t(1,1,1,1)},"BLACK",function(){return this.BLACK=new t(0,0,0,1)}]),t}()),Q=(function(){function t(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}r(t,"laya.d3.core.trail.module.Gradient");var e=t.prototype;e.setKeys=function(t,e){var i,n;this._colorKeys=t;for(var r=this.index=0;r<t.length;r++){var s=(i=t[r]).color;this._colorKeyData[this.index++]=s._r,this._colorKeyData[this.index++]=s._g,this._colorKeyData[this.index++]=s._b,this._colorKeyData[this.index++]=i.time}this._alphaKeys=e;for(var a=this.index=0;a<e.length;a++)n=e[a],this._alphaKeyData[this.index++]=n.alpha,this._alphaKeyData[this.index++]=n.time},e.cloneTo=function(t){var e=0,i=0,n=this.colorKeys,r=[];for(e=0,i=n.length;e<i;e++){var s=new J;n[e].cloneTo(s),r.push(s)}var a=this.alphaKeys,o=[];for(e=0,i=a.length;e<i;e++){var h=new Q;a[e].cloneTo(h),o.push(h)}t.setKeys(r,o)},s(0,e,"mode",(function(){return this._mode}),(function(t){this._mode=t})),s(0,e,"colorKeys",(function(){return this._colorKeys}),(function(t){this._colorKeys=t;for(var e=this.index=0;e<t.length;e++){var i=t[e],n=i.color;this._colorKeyData[this.index++]=n._r,this._colorKeyData[this.index++]=n._g,this._colorKeyData[this.index++]=n._b,this._colorKeyData[this.index++]=i.time}})),s(0,e,"alphaKeys",(function(){return this._alphaKeys}),(function(t){this._alphaKeys=t;for(var e=this.index=0;e<t.length;e++){var i=t[e];this._alphaKeyData[this.index++]=i.alpha,this._alphaKeyData[this.index++]=i.time}}))}(),function(){function t(t,e){this._alpha=NaN,this._time=NaN,void 0===t&&(t=0),void 0===e&&(e=0),this._alpha=t,this._time=e}r(t,"laya.d3.core.trail.module.GradientAlphaKey");var e=t.prototype;return e.cloneTo=function(t){t.alpha=this.alpha,t.time=this.time},s(0,e,"alpha",(function(){return this._alpha}),(function(t){this._alpha=t})),s(0,e,"time",(function(){return this._time}),(function(t){this._time=t})),t}()),J=function(){function t(t,e){this._color=null,this._time=NaN,void 0===e&&(e=0),this._color=t||new Z,this._time=e}r(t,"laya.d3.core.trail.module.GradientColorKey");var e=t.prototype;return e.cloneTo=function(t){this.color.cloneTo(t.color),t.time=this.time},s(0,e,"color",(function(){return this._color}),(function(t){this._color=t})),s(0,e,"time",(function(){return this._time}),(function(t){this._time=t})),t}(),$=(function(){function t(){}r(t,"laya.d3.core.trail.module.GradientMode"),t.Blend=0,t.Fixed=1}(),function(){function t(){}r(t,"laya.d3.core.trail.module.TextureMode"),t.Stretch=0,t.Tile=1}(),function(){function t(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}r(t,"laya.d3.core.trail.module.TrailKeyFrame"),t.prototype.cloneTo=function(t){t.time=this.time,t.inTangent=this.inTangent,t.outTangent=this.outTangent,t.value=this.value}}(),function(){function t(e){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new ae,this._curPosition=new ae,this._delVector3=new ae,this._lastFixedVertexPosition=new ae,this._pointAtoBVector3=new ae,this._pointA=new ae,this._pointB=new ae,this._owner=e,this._id=t.renderElementCount++,0==this._id?e._owner.transform.position.cloneTo(this._lastPosition):e._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new ke($.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new ke($.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}r(t,"laya.d3.core.trail.TrailRenderElement");var e=t.prototype;i.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},e._addTrailByFirstPosition=function(t,e){ae.subtract(e,t,this._delVector3),ae.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),ae.normalize(this._pointAtoBVector3,this._pointAtoBVector3),ae.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},e._addTrailByNextPosition=function(t){ae.subtract(t,this._lastFixedVertexPosition,this._delVector3),ae.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),ae.normalize(this._pointAtoBVector3,this._pointAtoBVector3),ae.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=ae.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=Jt.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(t),t.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(t),this._virtualVerticesCount=2)},e._updateVerticesByPosition=function(t){this._pointe=t.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},e._updateVertexBuffer2=function(){var t,e=0,i=0,n=0;for(n=0,t=(this._verticesCount+this._virtualVerticesCount)/2;n<t;n++)i=0==this._owner.textureMode?(this._VerticesToTailLength[n]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[n],this._vertices2[e++]=1-i,this._vertices2[e++]=1-i;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},e._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},e._updateDisappear=function(){var t,e=0;for(e=this._curDisappearIndex,t=(this._verticesCount+this._virtualVerticesCount)/2;e<t;e++)this._owner._curtime-this._everyGroupVertexBirthTime[e]>=this._owner.time+Jt.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},e._beforeRender=function(t){return this._camera=t.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),ae.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},e._render=function(t){this._isDead||(D.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),M.drawCall++,M.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer1:1===t?this._vertexBuffer2:null},e._getVertexBuffers=function(){return this._vertexBuffers},e._getIndexBuffer=function(){return null},e.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},e._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},s(0,e,"_vertexBufferCount",(function(){return this._vertexBuffers.length})),s(0,e,"triangleCount",(function(){return 0})),t.renderElementCount=0}(),function(){function t(){}r(t,"laya.d3.core.trail.VertexTrail");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration1})),s(1,t,"vertexDeclaration1",(function(){return t._vertexDeclaration1})),s(1,t,"vertexDeclaration2",(function(){return t._vertexDeclaration2})),n(t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new st(32,[new at(0,"vector3",0),new at(12,"vector3",41),new at(24,"single",33),new at(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new st(4,[new at(0,"single",38)])}]),t}()),tt=function(){function t(t){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=t}r(t,"laya.d3.graphics.DynamicBatch");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0}),e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getCombineRenderElementFromPool=function(t,e,i){var n=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return n||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=n=new X,n._sprite3D=new je),n._sprite3D._render._renderUpdate(i),n},e._getRenderElement=function(e,i,n){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*t.maxVertexCount),this._indexDatas=new Uint16Array(t.maxIndexCount),this._vertexBuffer=ke.create(this._vertexDeclaration,t.maxVertexCount,35048),this._indexBuffer=Fe.create("ushort",t.maxIndexCount,35048));for(var r=this._merageElements.length=0,s=0,a=0,o=this._combineRenderElements.length;a<o;a++){var h=this._combineRenderElements[a],l=h.getDynamicBatchBakedVertexs(0),c=h.getBakedIndices(),u=h._sprite3D.transform._isFrontFaceInvert,d=r/(this._vertexDeclaration.vertexStride/4),_=s,f=_+c.length;h._tempBatchIndexStart=_,h._tempBatchIndexEnd=f,this._indexDatas.set(c,s);var p=0;if(u)for(p=_;p<f;p+=3){this._indexDatas[p]=d+this._indexDatas[p];var m=this._indexDatas[p+1],g=this._indexDatas[p+2];this._indexDatas[p+1]=d+g,this._indexDatas[p+2]=d+m}else for(p=_;p<f;p+=3)this._indexDatas[p]=d+this._indexDatas[p],this._indexDatas[p+1]=d+this._indexDatas[p+1],this._indexDatas[p+2]=d+this._indexDatas[p+2];s+=c.length,this._vertexDatas.set(l,r),r+=l.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),a=this._combineRenderElementPoolIndex=0,o=this._materials.length;a<o;a++){var v=this._getCombineRenderElementFromPool(e,i,n);v._type=2,v._staticBatch=null;var y=(v.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[a]]._tempBatchIndexStart,x=a+1===this._materialToRenderElementsOffsets.length?s:this._combineRenderElements[this._materialToRenderElementsOffsets[a+1]]._tempBatchIndexStart;v._tempBatchIndexStart=y,v._tempBatchIndexEnd=x,v._material=this._materials[a],this._merageElements.push(v)}},e._addCombineRenderObjTest=function(e){var i=e.renderObj,n=this._currentCombineIndexCount+i._getIndexBuffer().indexCount,r=this._currentCombineVertexCount+i._getVertexBuffer().vertexCount;return!(t.maxVertexCount<r||t.maxIndexCount<n)},e._addCombineRenderObj=function(t){var e=t.renderObj;this._combineRenderElements.push(t),this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount},e._addCombineMaterial=function(t){this._materials.push(t)},e._addMaterialToRenderElementOffset=function(t){this._materialToRenderElementsOffsets.push(t)},e._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},e._addToRenderQueue=function(t,e,i,n){this._getRenderElement(e,i,n);for(var r=0,s=this._materials.length;r<s;r++)t.getRenderQueue(this._materials[r].renderQueue)._addDynamicBatchElement(this._merageElements[r])},e._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(t){var e=t._batchIndexEnd-t._batchIndexStart;D.mainContext.drawElements(4,e,5123,2*t._batchIndexStart),M.drawCall++,M.trianglesFaces+=e/3},e._getVertexBuffers=function(){return null},s(0,e,"_vertexBufferCount",(function(){return 1})),s(0,e,"triangleCount",(function(){return this._indexBuffer.indexCount/3})),s(0,e,"combineRenderElementsCount",(function(){return this._combineRenderElements.length})),t.maxVertexCount=2e4,t.maxIndexCount=4e4,t.maxCombineTriangleCount=10,t}(),et=function(){function t(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}r(t,"laya.d3.graphics.DynamicBatchManager");var e=t.prototype;return e.getDynamicBatch=function(t,e){var i,n=t.id.toString()+e;return this._dynamicBatches[n]?i=this._dynamicBatches[n]:this._dynamicBatches[n]=i=new tt(t),i},e._garbageCollection=function(){for(var t in this._dynamicBatches)0===this._dynamicBatches[t].combineRenderElementsCount&&delete this._dynamicBatches[t]},e._addPrepareRenderElement=function(t){this._prepareDynamicBatchCombineElements.push(t)},e._finishCombineDynamicBatch=function(e){var i,n,r;this._prepareDynamicBatchCombineElements.sort(t._sortPrepareDynamicBatch);for(var s,a,o,h,l,c=-1,u=!0,d=0,_=-1,f=0,p=this._prepareDynamicBatchCombineElements.length;f<p;f++){var m=(a=this._prepareDynamicBatchCombineElements[f]).renderObj._getVertexBuffer(0).vertexDeclaration,g=n!==m;g&&(d=0,n=m);var v=d!==c;if(v&&(c=d),(g||v)&&(o=this.getDynamicBatch(m,d),i=null),u)if(o._addCombineRenderObjTest(a)){if(i!==(s=a._material))h&&(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=h=null,_=-1),h=s,_=o.combineRenderElementsCount,l=a,i=s;else if(h){var y=l.renderObj,x=a.renderObj;y._getVertexBuffer().vertexCount+x._getVertexBuffer().vertexCount>tt.maxVertexCount||y._getIndexBuffer().indexCount+x._getIndexBuffer().indexCount>tt.maxIndexCount?(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),h=s,_=o.combineRenderElementsCount,l=a):(o._addCombineMaterial(h),o._addMaterialToRenderElementOffset(_),o._addCombineRenderObj(l),l=h=null,_=-1,o._addCombineRenderObj(a))}else o._addCombineRenderObj(a);u=!0}else h&&(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=h=null,_=-1),d++,u=!1;else r=this._prepareDynamicBatchCombineElements[f-1],o._addMaterialToRenderElementOffset(o.combineRenderElementsCount),i=r._material,o._addCombineMaterial(i),o._addCombineRenderObj(r),u=!0,i!==(s=a._material)?(h=s,_=o.combineRenderElementsCount,l=a):o._addCombineRenderObj(a),i=s}h&&(e.getRenderQueue(l._material.renderQueue)._addRenderElement(l),l=h=null,_=-1),this._prepareDynamicBatchCombineElements.length=0},e._clearRenderElements=function(){for(var t in this._dynamicBatches)this._dynamicBatches[t]._clearRenderElements()},e._addToRenderQueue=function(t,e,i,n){for(var r in this._dynamicBatches){var s=this._dynamicBatches[r];0<s.combineRenderElementsCount&&s._addToRenderQueue(t,e,i,n)}},e.dispose=function(){this._dynamicBatches=null},t._sortPrepareDynamicBatch=function(t,e){return t._mainSortID-e._mainSortID},t}(),it=function(){function t(){}return r(t,"laya.d3.graphics.FrustumCulling"),t.renderShadowObjectCulling=function(t,e,i,n,r){var s=0,a=0,o=0,h=0;for(s=0,o=i.length;s<o;s++){var l=i[s];l&&l._clearRenderElements()}var c,u,d,_=t._cullingRenders;if(1<r){for(s=0,o=t._cullingRendersLength;s<o;s++)if((c=_[s]).castShadow&&O.isVisible(c._owner.layer.mask)&&c.enable)for(var f=1,p=e.length;f<p;f++)if(u=i[f-1],0!==e[f].containsBoundSphere(c.boundingSphere))for(a=0,h=(d=c._renderElements).length;a<h;a++)u._addRenderElement(d[a])}else for(s=0,o=t._cullingRendersLength;s<o;s++)if((c=_[s]).castShadow&&O.isVisible(c._owner.layer.mask)&&c.enable&&0!==e[0].containsBoundSphere(c.boundingSphere))for(c._renderUpdate(n),u=i[0],a=0,h=(d=c._renderElements).length;a<h;a++)u._addRenderElement(d[a])},t.renderShadowObjectCullingOctree=function(t,e,i,n,r){for(var s=0,a=i.length;s<a;s++){var o=i[s];o&&o._clearRenderElements()}1<r?t.treeRoot.cullingShadowObjects(e,i,!0,0,t):t.treeRoot.cullingShadowObjectsOnePSSM(e[0],i,n,!0,0,t)},t.renderObjectCulling=function(t,e,i,n,r,s){var a=0,o=0,h=0,l=0,c=e._quenes,u=e._dynamicBatchManager,d=e._cullingRenders;for(a=0,o=c.length;a<o;a++){var _=c[a];_&&_._clearRenderElements()}var f=nt._staticBatchManagers;for(a=0,o=f.length;a<o;a++)f[a]._clearRenderElements();u._clearRenderElements();var p=i.transform.position;for(a=0,o=e._cullingRendersLength;a<o;a++){var m=d[a];if(O.isVisible(m._owner.layer.mask)&&m.enable&&0!==t.containsBoundSphere(m.boundingSphere)&&m._renderUpdate(s)){m._distanceForSort=ae.distance(m.boundingSphere.center,p)+m.sortingFudge;var g=m._renderElements;for(h=0,l=g.length;h<l;h++){var v=g[h],y=v._staticBatch;if(y&&y._material===v._material)y._addBatchRenderElement(v);else{var x=v.renderObj;x.triangleCount<10&&1===x._vertexBufferCount&&x._getIndexBuffer()&&v._material.renderQueue<2&&v._canDynamicBatch&&!m._owner.isStatic?u._addPrepareRenderElement(v):e.getRenderQueue(v._material.renderQueue)._addRenderElement(v)}}}}for(a=0,o=f.length;a<o;a++)f[a]._addToRenderQueue(e,n,r,s);u._finishCombineDynamicBatch(e),u._addToRenderQueue(e,n,r,s)},t.renderObjectCullingOctree=function(t,e,i,n,r,s){var a=0,o=0,h=e._quenes,l=e._dynamicBatchManager;for(a=0,o=h.length;a<o;a++){var c=h[a];c&&c._clearRenderElements()}var u=nt._staticBatchManagers;for(a=0,o=u.length;a<o;a++)u[a]._clearRenderElements();for(l._clearRenderElements(),e._cullingRenders.length=0,e.treeRoot.cullingObjects(t,!0,0,i.transform.position,s),a=0,o=u.length;a<o;a++)u[a]._addToRenderQueue(e,n,r,s);l._finishCombineDynamicBatch(e),l._addToRenderQueue(e,n,r,s)},t.renderObjectCullingNoBoundFrustum=function(t,e,i,n,r){var s=0,a=0,o=0,h=0,l=t._quenes,c=t._dynamicBatchManager,u=t._cullingRenders;for(s=0,a=l.length;s<a;s++){var d=l[s];d&&d._clearRenderElements()}var _=nt._staticBatchManagers;for(s=0,a=_.length;s<a;s++)_[s]._clearRenderElements();c._clearRenderElements();var f=e.transform.position;for(s=0,a=t._cullingRendersLength;s<a;s++){var p=u[s];if(O.isVisible(p._owner.layer.mask)&&p.enable){p._renderUpdate(r),p._distanceForSort=ae.distance(p.boundingSphere.center,f)+p.sortingFudge;var m=p._renderElements;for(o=0,h=m.length;o<h;o++){var g=m[o],v=g._staticBatch;if(v&&v._material===g._material)v._addBatchRenderElement(g);else{var y=g.renderObj;y.triangleCount<10&&1===y._vertexBufferCount&&y._getIndexBuffer()&&g._material.renderQueue<2&&g._canDynamicBatch&&!p._owner.isStatic?c._addPrepareRenderElement(g):t.getRenderQueue(g._material.renderQueue)._addRenderElement(g)}}}}for(s=0,a=_.length;s<a;s++)_[s]._addToRenderQueue(t,i,n,r);c._finishCombineDynamicBatch(t),c._addToRenderQueue(t,i,n,r)},t}(),nt=function(){function t(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}r(t,"laya.d3.graphics.StaticBatchManager");var e=t.prototype;return e._finishInit=function(){for(var t in this._staticBatches)this._staticBatches[t]._finishInit();this._initBatchRenderElements.length=0},e._initStaticBatchs=function(t){throw new Error("StaticBatchManager:must override this function.")},e._addInitBatchSprite=function(t){for(var e=t._render._renderElements,i=0,n=e.length;i<n;i++)this._initBatchRenderElements.push(e[i])},e._clearRenderElements=function(){for(var t in this._staticBatches)this._staticBatches[t]._clearRenderElements()},e._garbageCollection=function(t){var e=t._staticBatch,i=e._initBatchRenderElements,n=i.indexOf(t);i.splice(n,1),0===i.length&&(e.dispose(),delete this._staticBatches[e._key])},e._addToRenderQueue=function(t,e,i,n){for(var r in this._staticBatches){var s=this._staticBatches[r];0<s._batchRenderElements.length&&s._updateToRenderQueue(t,n)}},e.dispose=function(){this._staticBatches=null},t._addToStaticBatchQueue=function(e){e instanceof laya.d3.core.RenderableSprite3D&&e._addToInitStaticBatchManager();for(var i=0,n=e.numChildren;i<n;i++)t._addToStaticBatchQueue(e._childs[i])},t.combine=function(e,i){var n,r=0,s=0;if(i)for(r=0,s=i.length;r<s;r++)i[r]._addToInitStaticBatchManager();else e&&t._addToStaticBatchQueue(e);for(r=0,s=t._staticBatchManagers.length;r<s;r++)(n=t._staticBatchManagers[r])._initStaticBatchs(e),n._finishInit()},t._staticBatchManagers=[],t}(),rt=function(){function t(t,e,i){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=t,this._manager=e,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=i}r(t,"laya.d3.graphics.StaticBatch");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._binarySearch=function(t){for(var e=0,i=this._batchRenderElements.length-1,n=0;e<=i;)n=Math.floor((e+i)/2),this._compareBatchRenderElement(this._batchRenderElements[n],t)?i=n-1:e=n+1;return e},e._compareBatchRenderElement=function(t,e){throw new Error("StaticBatch:must override this function.")},e._getVertexDecLightMap=function(t){return t===Ft.vertexDeclaration?Rt.vertexDeclaration:t===Ot.vertexDeclaration?Pt.vertexDeclaration:t===Ct.vertexDeclaration?xt.vertexDeclaration:t===Ht.vertexDeclaration?null:t===pt.vertexDeclaration?mt.vertexDeclaration:t===Vt.vertexDeclaration?Lt.vertexDeclaration:t===At.vertexDeclaration?Dt.vertexDeclaration:t===kt.vertexDeclaration?Nt.vertexDeclaration:t===Ot.vertexDeclaration?Pt.vertexDeclaration:t===Mt.vertexDeclaration?wt.vertexDeclaration:t===Ht.vertexDeclaration?null:t===pt.vertexDeclaration?mt.vertexDeclaration:t===Ut.vertexDeclaration?Bt.vertexDeclaration:t===At.vertexDeclaration?Dt.vertexDeclaration:t},e._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},e._addBatchRenderElement=function(t){this._batchRenderElements.splice(this._binarySearch(t),0,t)},e._updateToRenderQueue=function(t,e){this._combineRenderElementPoolIndex=0,this._getRenderElement(t.getRenderQueue(this._material.renderQueue)._renderElements,t,e)},e._getRenderElement=function(t,e,i){throw new Error("StaticBatch:must override this function.")},e._finishInit=function(){throw new Error("StaticBatch:must override this function.")},e._clearRenderElements=function(){this._batchRenderElements.length=0},e.dispose=function(){},e._getVertexBuffer=function(t){return void 0===t&&(t=0),null},e._getIndexBuffer=function(){return null},e._beforeRender=function(t){return!0},e._render=function(t){},e._getVertexBuffers=function(){return null},s(0,e,"_vertexBufferCount",(function(){return 1})),s(0,e,"triangleCount",(function(){return 0})),t.combine=function(t){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),nt.combine(t)},t.maxBatchVertexCount=65535,t}(),st=function(){function t(e,i){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++t._uniqueIDCounter,this._id>t.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",t.maxVertexDeclaration);this._shaderValues=new de,this._vertexElementsDic={},this._vertexStride=e,this._vertexElements=i;for(var n=0;n<i.length;n++){var r=i[n],s=r.elementUsage;this._vertexElementsDic[s]=r;var a=[t._getTypeSize(r.elementFormat)/4,5126,!1,this._vertexStride,r.offset];switch(this._shaderValues.setValue(s,a),s){case 1:this._addShaderDefine(Te.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(Te.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(Te.SHADERDEFINE_UV1)}}}r(t,"laya.d3.graphics.VertexDeclaration");var e=t.prototype;return e._addShaderDefine=function(t){this._shaderDefineValue|=t},e._removeShaderDefine=function(t){this._shaderDefineValue&=~t},e.getVertexElements=function(){return this._vertexElements.slice()},e.getVertexElementByUsage=function(t){return this._vertexElementsDic[t]},e.unBinding=function(){},s(0,e,"shaderDefineValue",(function(){return this._shaderDefineValue})),s(0,e,"id",(function(){return this._id})),s(0,e,"vertexStride",(function(){return this._vertexStride})),s(0,e,"shaderValues",(function(){return this._shaderValues})),t._getTypeSize=function(t){switch(t){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},t.getVertexStride=function(e){for(var i=0,n=0;n<e.Length;n++){var r=e[n],s=r.offset+t._getTypeSize(r.elementFormat);i<s&&(i=s)}return i},t._maxVertexDeclarationBit=1e3,t._uniqueIDCounter=1,n(t,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),t}(),at=function(){function t(t,e,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=t,this.elementFormat=e,this.elementUsage=i}return r(t,"laya.d3.graphics.VertexElement"),t}(),ot=(function(){function t(){}r(t,"laya.d3.graphics.VertexElementFormat"),t.Single="single",t.Vector2="vector2",t.Vector3="vector3",t.Vector4="vector4",t.Color="color",t.Byte4="byte4",t.Short2="short2",t.Short4="short4",t.NormalizedShort2="normalizedshort2",t.NormalizedShort4="normalizedshort4",t.HalfVector2="halfvector2",t.HalfVector4="halfvector4"}(),function(){function t(){}r(t,"laya.d3.graphics.VertexElementUsage"),t.POSITION0=0,t.COLOR0=1,t.TEXTURECOORDINATE0=2,t.NORMAL0=3,t.BINORMAL0=4,t.TANGENT0=5,t.BLENDINDICES0=6,t.BLENDWEIGHT0=7,t.DEPTH0=8,t.FOG0=9,t.POINTSIZE0=10,t.SAMPLE0=11,t.TESSELLATEFACTOR0=12,t.COLOR1=13,t.NEXTTEXTURECOORDINATE0=14,t.TEXTURECOORDINATE1=15,t.NEXTTEXTURECOORDINATE1=16,t.CORNERTEXTURECOORDINATE0=17,t.VELOCITY0=18,t.STARTCOLOR0=19,t.STARTSIZE=20,t.AGEADDSCALE0=21,t.STARTROTATION=22,t.ENDCOLOR0=23,t.STARTLIFETIME=24,t.TIME0=33,t.SHAPEPOSITIONSTARTLIFETIME=30,t.DIRECTIONTIME=32,t.SIZEROTATION0=27,t.RADIUS0=28,t.RADIAN0=29,t.STARTSPEED=31,t.RANDOM0=34,t.RANDOM1=35,t.SIMULATIONWORLDPOSTION=36,t.SIMULATIONWORLDROTATION=37,t.TEXTURECOORDINATE0X=38,t.TEXTURECOORDINATE0X1=39,t.TEXTURECOORDINATE0Y=40,t.OFFSETVECTOR=41}(),function(){function t(t,e,i){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=t,this._textureCoordinate0=e,this._time=i}r(t,"laya.d3.graphics.VertexGlitter");var e=t.prototype;i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate0})),s(0,e,"position",(function(){return this._position})),s(0,e,"time",(function(){return this._time})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(24,[new at(0,"vector3",0),new at(12,"vector2",2),new at(20,"single",33)])}])}(),function(){function t(t,e,i,n,r,s,a,o,h,l){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=t,this._position=e,this._velocity=i,this._startColor=n,this._endColor=r,this._sizeRotation=s,this._radius=a,this._radian=o,this._ageAddScale=h,this._time=l}r(t,"laya.d3.graphics.VertexParticle");var e=t.prototype;i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"endColor",(function(){return this._endColor})),s(0,e,"cornerTextureCoordinate",(function(){return this._cornerTextureCoordinate})),s(0,e,"sizeRotation",(function(){return this._sizeRotation})),s(0,e,"velocity",(function(){return this._velocity})),s(0,e,"position",(function(){return this._position})),s(0,e,"startColor",(function(){return this._startColor})),s(0,e,"radius",(function(){return this._radius})),s(0,e,"radian",(function(){return this._radian})),s(0,e,"ageAddScale",(function(){return this._ageAddScale})),s(0,e,"time",(function(){return this._time})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(116,[new at(0,"vector4",17),new at(16,"vector3",0),new at(28,"vector3",18),new at(40,"vector4",19),new at(56,"vector4",23),new at(72,"vector3",27),new at(84,"vector2",28),new at(92,"vector4",29),new at(108,"single",24),new at(112,"single",33)])}])}(),function(){function t(t){this._position=null,this._position=t}r(t,"laya.d3.graphics.VertexPosition");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(12,[new at(0,"vector3",0)])}]),t}()),ht=function(){function t(t,e){this._position=null,this._normal=null,this._position=t,this._normal=e}r(t,"laya.d3.graphics.VertexPositionNormal");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(24,[new at(0,"vector3",0),new at(12,"vector3",3)])}]),t}(),lt=function(){function t(t,e,i){this._position=null,this._normal=null,this._color=null,this._position=t,this._normal=e,this._color=i}r(t,"laya.d3.graphics.VertexPositionNormalColor");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(40,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1)])}]),t}(),ct=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._blendIndex=n,this._blendWeight=r}r(t,"laya.d3.graphics.VertexPositionNormalColorSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(72,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector4",7),new at(56,"vector4",6)])}]),t}(),ut=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(88,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector4",7),new at(56,"vector4",6),new at(72,"vector4",5)])}]),t}(),dt=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n,this._blendIndex=r,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(84,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector4",7),new at(56,"vector4",6),new at(72,"vector3",5)])}]),t}(),_t=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalColorSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(56,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector4",5)])}]),t}(),ft=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalColorTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(52,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector3",5)])}]),t}(),pt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(48,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2)])}]),t}(),mt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(56,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector2",15)])}]),t}(),gt=function(){function t(t,e,i,n,r,s,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._blendIndex=s,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(88,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector2",15),new at(56,"vector4",7),new at(72,"vector4",6)])}]),t}(),vt=function(){function t(t,e,i,n,r,s,a,o){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=s,this._blendIndex=a,this._blendWeight=o}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(104,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector2",15),new at(56,"vector4",7),new at(72,"vector4",6),new at(88,"vector4",5)])}]),t}(),yt=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0SkinTangent=function(t,e,i,n,r,s,a,o){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=s,this._blendIndex=a,this._blendWeight=o},s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(100,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector2",15),new at(56,"vector4",7),new at(72,"vector4",6),new at(88,"vector3",5)])}]),t}(),xt=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(72,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector2",15),new at(56,"vector4",5)])}]),t}(),wt=function(){function t(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalColorTexture0Tangent=function(t,e,i,n,r,s){this._position=t,this._normal=e,this._color=i,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=s},s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(68,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector2",15),new at(56,"vector3",5)])}]),t}(),bt=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._blendIndex=r,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(80,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector4",7),new at(64,"vector4",6)])}]),t}(),St=function(){function t(t,e,i,n,r,s,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=s,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(96,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector4",7),new at(64,"vector4",6),new at(80,"vector4",5)])}]),t}(),Tt=function(){function t(t,e,i,n,r,s,a){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r,this._blendIndex=s,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"color",(function(){return this._color})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(92,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector4",7),new at(64,"vector4",6),new at(80,"vector3",5)])}]),t}(),Ct=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(64,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector4",5)])}]),t}(),Mt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._color=i,this._textureCoordinate=n,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"color",(function(){return this._color})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(60,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",1),new at(40,"vector2",2),new at(48,"vector3",5)])}]),t}(),It=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}r(t,"laya.d3.graphics.VertexPositionNormalSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(40,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector4",5)])}]),t}(),Et=function(){function t(t,e,i){this._position=null,this._normal=null,this._tangent=null,this._position=t,this._normal=e,this._tangent=i}r(t,"laya.d3.graphics.VertexPositionNormalTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(36,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector3",5)])}]),t}(),At=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNormalTexture");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(32,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2)])}]),t}(),Dt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(40,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15)])}]),t}(),Pt=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._blendIndex=r,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(72,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15),new at(40,"vector4",7),new at(56,"vector4",6)])}]),t}(),Rt=function(){function t(t,e,i,n,r,s,a){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=s,this._blendWeight=a}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(88,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15),new at(40,"vector4",7),new at(56,"vector4",6),new at(72,"vector4",5)])}]),t}(),Nt=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0SkinTangent=function(t,e,i,n,r,s,a){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r,this._blendIndex=s,this._blendWeight=a},s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(84,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15),new at(40,"vector4",7),new at(56,"vector4",6),new at(72,"vector3",5)])}]),t}(),Lt=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(56,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15),new at(40,"vector4",5)])}]),t}(),Bt=function(){function t(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}r(t,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),e.VertexPositionNormalTexture0Tangent=function(t,e,i,n,r){this._position=t,this._normal=e,this._textureCoordinate0=i,this._textureCoordinate1=n,this._tangent=r},s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(52,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15),new at(40,"vector3",5)])}]),t}(),Ot=function(){function t(t,e,i,n,r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._blendIndex=n,this._blendWeight=r}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(64,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector4",7),new at(48,"vector4",6)])}]),t}(),Ft=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(80,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector4",7),new at(48,"vector4",6),new at(64,"vector4",5)])}]),t}(),kt=function(){function t(t,e,i,n,r,s){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n,this._blendIndex=r,this._blendWeight=s}r(t,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(76,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector4",7),new at(48,"vector4",6),new at(64,"vector3",5)])}]),t}(),Vt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(48,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector4",5)])}]),t}(),Ut=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=t,this._normal=e,this._textureCoordinate=i,this._tangent=n}r(t,"laya.d3.graphics.VertexPositionNormalTextureTangent");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(44,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector3",5)])}]),t}(),Ht=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNTBTexture");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(56,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector3",5),new at(36,"vector3",4),new at(48,"vector2",2)])}]),t}(),zt=function(){function t(t,e,i,n,r,s,a,o){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=t,this._normal=e,this._textureCoordinate0=n,this._textureCoordinate1=r,this._tangent=s,i=i,this._blendIndex=a,this._blendWeight=o}r(t,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"tangent",(function(){return this._tangent})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(0,e,"textureCoordinate1",(function(){return this._textureCoordinate1})),s(0,e,"blendIndex",(function(){return this._blendIndex})),s(0,e,"blendWeight",(function(){return this._blendWeight})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(96,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector3",5),new at(36,"vector3",4),new at(48,"vector2",2),new at(56,"vector2",15),new at(64,"vector4",7),new at(80,"vector4",6)])}]),t}(),Wt=function(){function t(t,e,i){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=t,this._normal=e,this._textureCoordinate=i}r(t,"laya.d3.graphics.VertexPositionNTBTextureSkin");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"textureCoordinate",(function(){return this._textureCoordinate})),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(88,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector3",5),new at(36,"vector3",4),new at(48,"vector2",2),new at(56,"vector4",7),new at(72,"vector4",6)])}]),t}(),Gt=(function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=n}r(t,"laya.d3.graphics.VertexPositionTerrain");var e=t.prototype;i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"normal",(function(){return this._normal})),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoord0",(function(){return this._textureCoord0})),s(0,e,"textureCoord1",(function(){return this._textureCoord1})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(40,[new at(0,"vector3",0),new at(12,"vector3",3),new at(24,"vector2",2),new at(32,"vector2",15)])}])}(),function(){function t(t,e){this._position=null,this._textureCoordinate0=null,this._position=t,this._textureCoordinate0=e}r(t,"laya.d3.graphics.VertexPositionTexture0");var e=t.prototype;return i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"position",(function(){return this._position})),s(0,e,"textureCoordinate0",(function(){return this._textureCoordinate0})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(20,[new at(0,"vector3",0),new at(12,"vector2",2)])}]),t}()),Yt=(function(){function t(t,e,i,n,r,s,a,o,h,l,c,u,d,_){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=s,this._startRotation1=a,this._startRotation2=o,this._startLifeTime=h,this._time=l,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_}r(t,"laya.d3.graphics.VertexShurikenParticleBillboard");var e=t.prototype;i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"cornerTextureCoordinate",(function(){return this._cornerTextureCoordinate})),s(0,e,"random1",(function(){return this._randoms1})),s(0,e,"startRotation2",(function(){return this._startRotation2})),s(0,e,"positionStartLifeTime",(function(){return this._positionStartLifeTime})),s(0,e,"velocity",(function(){return this._velocity})),s(0,e,"random0",(function(){return this._randoms0})),s(0,e,"startSize",(function(){return this._startSize})),s(0,e,"startColor",(function(){return this._startColor})),s(0,e,"startRotation0",(function(){return this._startRotation0})),s(0,e,"startRotation1",(function(){return this._startRotation1})),s(0,e,"startLifeTime",(function(){return this._startLifeTime})),s(0,e,"time",(function(){return this._time})),s(0,e,"startSpeed",(function(){return this._startSpeed})),s(0,e,"simulationWorldPostion",(function(){return this._simulationWorldPostion})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(152,[new at(0,"vector4",17),new at(16,"vector4",30),new at(32,"vector4",32),new at(48,"vector4",19),new at(64,"vector3",20),new at(76,"vector3",22),new at(88,"single",31),new at(92,"vector4",34),new at(108,"vector4",35),new at(124,"vector3",36),new at(136,"vector4",37)])}])}(),function(){function t(t,e,i,n,r,s,a,o,h,l,c,u,d,_){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=s,this._startRotation1=a,this._startRotation2=o,this._startLifeTime=h,this._time=l,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_}r(t,"laya.d3.graphics.VertexShurikenParticleMesh");var e=t.prototype;i.imps(e,{"laya.d3.graphics.IVertex":!0}),s(0,e,"cornerTextureCoordinate",(function(){return this._cornerTextureCoordinate})),s(0,e,"velocity",(function(){return this._velocity})),s(0,e,"position",(function(){return this._positionStartLifeTime})),s(0,e,"random0",(function(){return this._randoms0})),s(0,e,"startSize",(function(){return this._startSize})),s(0,e,"startColor",(function(){return this._startColor})),s(0,e,"startRotation0",(function(){return this._startRotation0})),s(0,e,"startRotation1",(function(){return this._startRotation1})),s(0,e,"random1",(function(){return this._randoms1})),s(0,e,"startRotation2",(function(){return this._startRotation2})),s(0,e,"startLifeTime",(function(){return this._startLifeTime})),s(0,e,"time",(function(){return this._time})),s(0,e,"startSpeed",(function(){return this._startSpeed})),s(0,e,"simulationWorldPostion",(function(){return this._simulationWorldPostion})),s(0,e,"vertexDeclaration",(function(){return t._vertexDeclaration})),s(1,t,"vertexDeclaration",(function(){return t._vertexDeclaration})),n(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new st(172,[new at(0,"vector3",0),new at(12,"vector4",1),new at(28,"vector2",2),new at(36,"vector4",30),new at(52,"vector4",32),new at(68,"vector4",19),new at(84,"vector3",20),new at(96,"vector3",22),new at(108,"single",31),new at(112,"vector4",34),new at(128,"vector4",35),new at(144,"vector3",36),new at(156,"vector4",37)])}])}(),function(){function t(t,e,i,n,r,s){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=i,this._materials=n,this._subMeshes=r,this._materialMap=s,this._version=e,this._onLoaded(t)}r(t,"laya.d3.loaders.LoadModelV01");var e=t.prototype;return e._onLoaded=function(t){this._readData=t,this.READ_BLOCK();for(var e=0;e<this._BLOCK.count;e++){var i=this._readData.getUint16(),n=this._strings[i],r=this["READ_"+n];if(null==r)throw new Error("model file err,no this function:"+i+" "+n);if(!r.call(this))break}return this._mesh},e.onError=function(){},e._readString=function(){return this._strings[this._readData.getUint16()]},e.READ_BLOCK=function(){return this._readData.getUint16(),this._BLOCK.count=this._readData.getUint16(),!0},e.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},e.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var t=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var e=0;e<this._STRINGS.size;e++)this._strings[e]=this._readData.readUTFString();return this._readData.pos=t,!0},e.READ_MATERIAL=function(){var t=this._readData.getUint16(),e=(this._readString(),this._readString());return this._materials[t]="null"!==e?g.getRes(this._materialMap[e]):new Ee,!0},e.READ_MESH=function(){switch(this._readString(),this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var t,e=this._readData.__getBuffer(),i=0,n=this._readData.getUint32(),r=this._readData.getUint32(),s=(new Float32Array(e.slice(n+this._DATA.offset,n+this._DATA.offset+r)),this._readData.getUint32()),a=this._readData.getUint32(),o=new Float32Array(e.slice(s+this._DATA.offset,s+this._DATA.offset+a));for(this.mesh._inverseBindPoses=[],i=0,t=o.length;i<t;i+=16){var h=new te(o[i+0],o[i+1],o[i+2],o[i+3],o[i+4],o[i+5],o[i+6],o[i+7],o[i+8],o[i+9],o[i+10],o[i+11],o[i+12],o[i+13],o[i+14],o[i+15]);this.mesh._inverseBindPoses.push(h)}break;default:throw new Error("LoadModel:unknown version.")}return!0},e.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var e=this._readString();this._shaderAttributes=e.match(t._attrReg);var i=this._readData.getUint32(),n=this._readData.getUint32(),r=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),s=this._readData.getUint32(),a=this._readData.getUint32(),o=this._readData.getUint32(),h=this._readData.__getBuffer(),l=new le(this._mesh),c=this._getVertexDeclaration(),u=ke.create(c,s/c.vertexStride,35044,!0),d=r+this._DATA.offset,_=h.slice(d,d+s);u.setData(new Float32Array(_));for(var f=(l._vertexBuffer=u).vertexDeclaration.getVertexElements(),p=0;p<f.length;p++)l._bufferUsage[f[p].elementUsage]=u;var m=Fe.create("ushort",n/2,35044,!0),g=i+this._DATA.offset,v=h.slice(g,g+n);m.setData(new Uint16Array(v)),l._indexBuffer=m;var y=h.slice(a+this._DATA.offset,a+this._DATA.offset+o);return l._boneIndicesList[0]=new Uint8Array(y),this._subMeshes.push(l),!0},e.READ_DATAAREA=function(){return!1},e._getVertexDeclaration=function(){for(var t,e=!1,i=!1,n=!1,r=!1,s=!1,a=!1,o=!1,h=!1,l=!1,c=0;c<this._shaderAttributes.length;c+=8)switch(this._shaderAttributes[c]){case"POSITION":e=!0;break;case"NORMAL":i=!0;break;case"COLOR":n=!0;break;case"UV":r=!0;break;case"UV1":s=!0;break;case"BLENDWEIGHT":o=!0;break;case"BLENDINDICES":h=!0;break;case"TANGENT":a=!0;break;case"BINORMAL":l=!0}return e&&i&&n&&r&&s&&o&&h&&a?t=yt.vertexDeclaration:e&&i&&n&&r&&s&&o&&h?t=gt.vertexDeclaration:e&&i&&r&&s&&o&&h&&a?t=Nt.vertexDeclaration:e&&i&&r&&s&&o&&h?t=Pt.vertexDeclaration:e&&i&&n&&r&&o&&h&&a?t=Tt.vertexDeclaration:e&&i&&n&&r&&o&&h?t=bt.vertexDeclaration:e&&i&&a&&l&&r&&o&&h?t=Wt.vertexDeclaration:e&&i&&r&&o&&h&&a?t=kt.vertexDeclaration:e&&i&&r&&o&&h?t=Ot.vertexDeclaration:e&&i&&n&&o&&h&&a?t=dt.vertexDeclaration:e&&i&&n&&o&&h?t=ct.vertexDeclaration:e&&i&&n&&r&&s&&a?t=wt.vertexDeclaration:e&&i&&n&&r&&s?t=mt.vertexDeclaration:e&&i&&r&&s&&a?t=Bt.vertexDeclaration:e&&i&&r&&s?t=Dt.vertexDeclaration:e&&i&&n&&r&&a?t=Mt.vertexDeclaration:e&&i&&r&&a&&l?t=Ht.vertexDeclaration:e&&i&&n&&r?t=pt.vertexDeclaration:e&&i&&r&&a?t=Ut.vertexDeclaration:e&&i&&r?t=At.vertexDeclaration:e&&i&&n&&a?t=ft.vertexDeclaration:e&&i&&n&&(t=lt.vertexDeclaration),t},s(0,e,"mesh",(function(){return this._mesh})),t._attrReg=new RegExp("(\\w+)|([:,;])","g"),t}()),Xt=function(){function t(){}return r(t,"laya.d3.loaders.LoadModelV02"),t.parse=function(e,i,n,r,s,a){t._mesh=n,t._materials=r,t._subMeshes=s,t._materialMap=a,t._version=i,t._readData=e,t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var o=0,h=t._BLOCK.count;o<h;o++){t._readData.pos=t._BLOCK.blockStarts[o];var l=t._readData.getUint16(),c=t._strings[l],u=t["READ_"+c];if(null==u)throw new Error("model file err,no this function:"+l+" "+c);u.call()}t._strings.length=0,t._readData=null,t._version=null,t._mesh=null,t._materials=null,t._subMeshes=null,t._materialMap=null},t._readString=function(){return t._strings[t._readData.getUint16()]},t.READ_DATA=function(){t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._readData.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._readData.getUint32()),n.push(t._readData.getUint32())},t.READ_STRINGS=function(){var e=t._readData.getUint32(),i=t._readData.getUint16(),n=t._readData.pos;t._readData.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._readData.readUTFString();t._readData.pos=n},t.READ_MATERIAL=function(){t._readString(),t._readString();var e=t._readString();return""!==e&&t._materials.push(g.getRes(t._materialMap[e])),!0},t.READ_MESH=function(){t._readString();var e,i=t._readData.__getBuffer(),n=0,r=t._readData.getInt16(),s=t._DATA.offset;for(n=0;n<r;n++){var a=s+t._readData.getUint32(),o=t._readData.getUint32(),h=new Float32Array(i.slice(a,a+o)),l=t._readString().match(t._attrReg),c=t._getVertexDeclaration(l),u=ke.create(c,4*h.length/c.vertexStride,35044,!0);u.setData(h),t._mesh._vertexBuffers.push(u)}var d=s+t._readData.getUint32(),_=t._readData.getUint32(),f=new Uint16Array(i.slice(d,d+_)),p=Fe.create("ushort",_/2,35044,!0);p.setData(f),t._mesh._indexBuffer=p;var m=t._mesh._boneNames=[],g=t._readData.getUint16();for(m.length=g,n=0;n<g;n++)m[n]=t._strings[t._readData.getUint16()];var v=t._readData.getUint32(),y=t._readData.getUint32(),x=(new Float32Array(i.slice(s+v,s+v+y)),t._readData.getUint32()),w=t._readData.getUint32(),b=new Float32Array(i.slice(s+x,s+x+w));for(t._mesh._inverseBindPoses=[],n=0,e=b.length;n<e;n+=16){var S=new te(b[n+0],b[n+1],b[n+2],b[n+3],b[n+4],b[n+5],b[n+6],b[n+7],b[n+8],b[n+9],b[n+10],b[n+11],b[n+12],b[n+13],b[n+14],b[n+15]);t._mesh._inverseBindPoses.push(S)}return t._mesh._skinnedDatas=new Float32Array(16*b.length),!0},t.READ_SUBMESH=function(){var e=t._readData.__getBuffer(),i=new le(t._mesh),n=t._readData.getInt16(),r=t._readData.getUint32(),s=t._readData.getUint32();i._vertexBuffer=t._mesh._vertexBuffers[n],i._vertexStart=r,i._vertexCount=s;var a=t._readData.getUint32(),o=t._readData.getUint32(),h=t._mesh._indexBuffer;i._indexBuffer=h,i._indexStart=a,i._indexCount=o,i._indices=new Uint16Array(h.getData().buffer,2*a,o);var l=t._DATA.offset,c=i._subIndexBufferStart,u=i._subIndexBufferCount,d=i._boneIndicesList,_=t._readData.getUint16();c.length=_,u.length=_,d.length=_;for(var f=0;f<_;f++){c[f]=t._readData.getUint32(),u[f]=t._readData.getUint32();var p=t._readData.getUint32(),m=t._readData.getUint32();i._boneIndicesList[f]=new Uint8Array(e.slice(l+p,l+p+m))}return t._subMeshes.push(i),!0},t._getVertexDeclaration=function(t){for(var e,i=!1,n=!1,r=!1,s=!1,a=!1,o=!1,h=!1,l=!1,c=!1,u=0;u<t.length;u++)switch(t[u]){case"POSITION":i=!0;break;case"NORMAL":n=!0;break;case"COLOR":r=!0;break;case"UV":s=!0;break;case"UV1":a=!0;break;case"BLENDWEIGHT":h=!0;break;case"BLENDINDICES":l=!0;break;case"TANGENT":o=!0;break;case"BINORMAL":c=!0}return i&&n&&r&&s&&a&&h&&l&&o?e=yt.vertexDeclaration:i&&n&&r&&s&&a&&h&&l?e=gt.vertexDeclaration:i&&n&&s&&a&&h&&l&&o?e=Nt.vertexDeclaration:i&&n&&s&&a&&h&&l?e=Pt.vertexDeclaration:i&&n&&r&&s&&h&&l&&o?e=Tt.vertexDeclaration:i&&n&&r&&s&&h&&l?e=bt.vertexDeclaration:i&&n&&s&&h&&l&&o?e=kt.vertexDeclaration:i&&n&&s&&h&&l?e=Ot.vertexDeclaration:i&&n&&r&&h&&l&&o?e=dt.vertexDeclaration:i&&n&&r&&h&&l?e=ct.vertexDeclaration:i&&n&&r&&s&&a&&o?e=wt.vertexDeclaration:i&&n&&r&&s&&a?e=mt.vertexDeclaration:i&&n&&s&&a&&o?e=Bt.vertexDeclaration:i&&n&&s&&a?e=Dt.vertexDeclaration:i&&n&&r&&s&&o?e=Mt.vertexDeclaration:i&&n&&s&&o&&c?e=Ht.vertexDeclaration:i&&n&&r&&s?e=pt.vertexDeclaration:i&&n&&s&&o?e=Ut.vertexDeclaration:i&&n&&s?e=At.vertexDeclaration:i&&n&&r&&o?e=ft.vertexDeclaration:i&&n&&r&&(e=lt.vertexDeclaration),e},t._attrReg=new RegExp("(\\w+)|([:,;])","g"),t._strings=[],t._readData=null,t._version=null,t._mesh=null,t._materials=null,t._subMeshes=null,t._materialMap=null,n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),jt=function(){function t(){}return r(t,"laya.d3.loaders.LoadModelV03"),t.parse=function(e,i,n,r,s){t._mesh=n,t._subMeshes=r,t._materialMap=s,t._version=i,t._readData=e,t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var a=0,o=t._BLOCK.count;a<o;a++){t._readData.pos=t._BLOCK.blockStarts[a];var h=t._readData.getUint16(),l=t._strings[h],c=t["READ_"+l];if(null==c)throw new Error("model file err,no this function:"+h+" "+l);c.call()}t._strings.length=0,t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null},t._readString=function(){return t._strings[t._readData.getUint16()]},t.READ_DATA=function(){t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._readData.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._readData.getUint32()),n.push(t._readData.getUint32())},t.READ_STRINGS=function(){var e=t._readData.getUint32(),i=t._readData.getUint16(),n=t._readData.pos;t._readData.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._readData.readUTFString();t._readData.pos=n},t.READ_MESH=function(){var e,i=t._readString(),n=t._readData.__getBuffer(),r=0,s=t._readData.getInt16(),a=t._DATA.offset;for(r=0;r<s;r++){var o,h=a+t._readData.getUint32(),l=t._readData.getUint32(),c=new Float32Array(n.slice(h,h+l)),u=t._readString();switch(t._version){case"LAYAMODEL:03":o=t._vertexDeclarationMap_Discard[u];break;case"LAYAMODEL:0301":o=t._vertexDeclarationMap[u];break;default:throw new Error("LoadModelV03: unknown version.")}if(!o)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+t._version+"  bufferAttribute="+u+"  name="+i+"  url="+(t._mesh?t._mesh.url:"null"));var d=ke.create(o,4*c.length/o.vertexStride,35044,!0,t._mesh._url+"_"+r);d.setData(c),t._mesh._vertexBuffers.push(d)}var _=a+t._readData.getUint32(),f=t._readData.getUint32(),p=new Uint16Array(n.slice(_,_+f)),m=Fe.create("ushort",f/2,35044,!0,t._mesh._url);m.setData(p),t._mesh._indexBuffer=m;var g=t._mesh._boneNames=[],v=t._readData.getUint16();for(g.length=v,r=0;r<v;r++)g[r]=t._strings[t._readData.getUint16()];t._readData.pos+=8;var y=t._readData.getUint32(),x=t._readData.getUint32(),w=new Float32Array(n.slice(a+y,a+y+x));for(t._mesh._inverseBindPoses=[],r=0,e=w.length;r<e;r+=16){var b=new te(w[r+0],w[r+1],w[r+2],w[r+3],w[r+4],w[r+5],w[r+6],w[r+7],w[r+8],w[r+9],w[r+10],w[r+11],w[r+12],w[r+13],w[r+14],w[r+15]);t._mesh._inverseBindPoses.push(b)}return t._mesh._skinnedDatas=new Float32Array(16*w.length),!0},t.READ_SUBMESH=function(){var e=t._readData.__getBuffer(),i=new le(t._mesh),n=t._readData.getInt16(),r=t._readData.getUint32(),s=t._readData.getUint32();i._vertexBuffer=t._mesh._vertexBuffers[n],i._vertexStart=r,i._vertexCount=s;var a=t._readData.getUint32(),o=t._readData.getUint32(),h=t._mesh._indexBuffer;i._indexBuffer=h,i._indexStart=a,i._indexCount=o,i._indices=new Uint16Array(h.getData().buffer,2*a,o);var l=t._DATA.offset,c=i._subIndexBufferStart,u=i._subIndexBufferCount,d=i._boneIndicesList,_=t._readData.getUint16();c.length=_,u.length=_,d.length=_;for(var f=0;f<_;f++){c[f]=t._readData.getUint32(),u[f]=t._readData.getUint32();var p=t._readData.getUint32(),m=t._readData.getUint32();d[f]=new Uint8Array(e.slice(l+p,l+p+m))}return t._subMeshes.push(i),!0},t._strings=[],t._readData=null,t._version=null,t._mesh=null,t._subMeshes=null,t._materialMap=null,n(t,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":yt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":gt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":zt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Nt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Pt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Tt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":bt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":kt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Ot.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":dt.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":ct.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":wt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":mt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Bt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Dt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Mt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":Ht.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":pt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":Ut.vertexDeclaration,"POSITION,NORMAL,UV":At.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":ft.vertexDeclaration,"POSITION,NORMAL,COLOR":lt.vertexDeclaration,"POSITION,NORMAL,TANGENT":Et.vertexDeclaration,"POSITION,NORMAL":ht.vertexDeclaration,"POSITION,UV":Gt.vertexDeclaration,POSITION:ot.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":vt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":gt.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":zt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":Rt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":Pt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":St.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":bt.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":Ft.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":Ot.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":ut.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":ct.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":xt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":mt.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":Lt.vertexDeclaration,"POSITION,NORMAL,UV,UV1":Dt.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":Ct.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":Ht.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":pt.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":Vt.vertexDeclaration,"POSITION,NORMAL,UV":At.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":_t.vertexDeclaration,"POSITION,NORMAL,COLOR":lt.vertexDeclaration,"POSITION,NORMAL,TANGENT":It.vertexDeclaration,"POSITION,NORMAL":ht.vertexDeclaration,"POSITION,UV":Gt.vertexDeclaration,POSITION:ot.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),Kt=function(){function t(){}return r(t,"laya.d3.loaders.MeshReader"),t.read=function(e,i,n,r,s){var a=new d(e);a.pos=0;var o=a.readUTFString();switch(o){case"LAYAMODEL:01":case"LAYASKINANI:01":t._readVersion01(a,o,i,n,r,s);break;case"LAYAMODEL:02":Xt.parse(a,o,i,n,r,s);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":jt.parse(a,o,i,r,s);break;default:throw new Error("MeshReader: unknown mesh version.")}i._setSubMeshes(r)},t._readVersion01=function(t,e,i,n,r,s){new Yt(t,e,i,n,r,s)},t}(),qt=function(){function t(t,e){this.min=null,this.max=null,this.min=t,this.max=e}r(t,"laya.d3.math.BoundBox");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.getCorners=function(t){t.length=8;var e=this.min.elements,i=this.max.elements,n=e[0],r=e[1],s=e[2],a=i[0],o=i[1],h=i[2];t[0]=new ae(n,o,h),t[1]=new ae(a,o,h),t[2]=new ae(a,r,h),t[3]=new ae(n,r,h),t[4]=new ae(n,o,s),t[5]=new ae(a,o,s),t[6]=new ae(a,r,s),t[7]=new ae(n,r,s)},e.toDefault=function(){this.min.toDefault(),this.max.toDefault()},e.cloneTo=function(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)},e.clone=function(){var t=new this.constructor(new ae,new ae);return this.cloneTo(t),t},t.createfromPoints=function(t,e){if(null==t)throw new Error("points");var i=e.min,n=e.max,r=i.elements;r[0]=Number.MAX_VALUE,r[1]=Number.MAX_VALUE,r[2]=Number.MAX_VALUE;var s=n.elements;s[0]=-Number.MAX_VALUE,s[1]=-Number.MAX_VALUE,s[2]=-Number.MAX_VALUE;for(var a=0,o=t.length;a<o;++a)ae.min(i,t[a],i),ae.max(n,t[a],n)},t.merge=function(t,e,i){ae.min(t.min,e.min,i.min),ae.max(t.max,e.max,i.max)},t}(),Zt=function(){function t(e){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=e,this._near=new ee(new ae),this._far=new ee(new ae),this._left=new ee(new ae),this._right=new ee(new ae),this._top=new ee(new ae),this._bottom=new ee(new ae),t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}r(t,"laya.d3.math.BoundFrustum");var e=t.prototype;return e.equalsBoundFrustum=function(t){return this._matrix.equalsOtherMatrix(t.matrix)},e.equalsObj=function(t){if(t instanceof laya.d3.math.BoundFrustum){var e=t;return this.equalsBoundFrustum(e)}return!1},e.getPlane=function(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},e.getCorners=function(e){t._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(e[0]),t._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(e[1]),t._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(e[2]),t._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(e[3]),t._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(e[4]),t._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(e[5]),t._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(e[6]),t._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(e[7])},e.containsPoint=function(t){for(var e=ee.PlaneIntersectionType_Front,i=ee.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=Collision.intersectsPlaneAndPoint(this._near,t);break;case 1:i=Collision.intersectsPlaneAndPoint(this._far,t);break;case 2:i=Collision.intersectsPlaneAndPoint(this._left,t);break;case 3:i=Collision.intersectsPlaneAndPoint(this._right,t);break;case 4:i=Collision.intersectsPlaneAndPoint(this._top,t);break;case 5:i=Collision.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case ee.PlaneIntersectionType_Back:return 0;case ee.PlaneIntersectionType_Intersecting:e=ee.PlaneIntersectionType_Intersecting}}switch(e){case ee.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e.containsBoundBox=function(e){for(var i,n=t._tempV30,r=t._tempV31,s=1,a=0;a<6;a++){if(i=this.getPlane(a),this._getBoxToPlanePVertexNVertex(e,i.normal,n,r),Collision.intersectsPlaneAndPoint(i,n)===ee.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(i,r)===ee.PlaneIntersectionType_Back&&(s=2)}return s},e.containsBoundSphere=function(t){for(var e=ee.PlaneIntersectionType_Front,i=ee.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=Collision.intersectsPlaneAndSphere(this._near,t);break;case 1:i=Collision.intersectsPlaneAndSphere(this._far,t);break;case 2:i=Collision.intersectsPlaneAndSphere(this._left,t);break;case 3:i=Collision.intersectsPlaneAndSphere(this._right,t);break;case 4:i=Collision.intersectsPlaneAndSphere(this._top,t);break;case 5:i=Collision.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case ee.PlaneIntersectionType_Back:return 0;case ee.PlaneIntersectionType_Intersecting:e=ee.PlaneIntersectionType_Intersecting}}switch(e){case ee.PlaneIntersectionType_Intersecting:return 2;default:return 1}},e._getBoxToPlanePVertexNVertex=function(t,e,i,n){var r=t.min,s=r.elements,a=t.max,o=a.elements,h=e.elements,l=h[0],c=h[1],u=h[2];r.cloneTo(i);var d=i.elements;0<=l&&(d[0]=o[0]),0<=c&&(d[1]=o[1]),0<=u&&(d[2]=o[2]),a.cloneTo(n);var _=n.elements;0<=l&&(_[0]=s[0]),0<=c&&(_[1]=s[1]),0<=u&&(_[2]=s[2])},s(0,e,"top",(function(){return this._top})),s(0,e,"matrix",(function(){return this._matrix}),(function(e){this._matrix=e,t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)})),s(0,e,"near",(function(){return this._near})),s(0,e,"far",(function(){return this._far})),s(0,e,"left",(function(){return this._left})),s(0,e,"right",(function(){return this._right})),s(0,e,"bottom",(function(){return this._bottom})),t._getPlanesFromMatrix=function(t,e,i,n,r,s,a){var o=t.elements,h=o[0],l=o[1],c=o[2],u=o[3],d=o[4],_=o[5],f=o[6],p=o[7],m=o[8],g=o[9],v=o[10],y=o[11],x=o[12],w=o[13],b=o[14],S=o[15],T=e.normal.elements;T[0]=u+c,T[1]=p+f,T[2]=y+v,e.distance=S+b,e.normalize();var C=i.normal.elements;C[0]=u-c,C[1]=p-f,C[2]=y-v,i.distance=S-b,i.normalize();var M=n.normal.elements;M[0]=u+h,M[1]=p+d,M[2]=y+m,n.distance=S+x,n.normalize();var I=r.normal.elements;I[0]=u-h,I[1]=p-d,I[2]=y-m,r.distance=S-x,r.normalize();var E=s.normal.elements;E[0]=u-l,E[1]=p-_,E[2]=y-g,s.distance=S-w,s.normalize();var A=a.normal.elements;A[0]=u+l,A[1]=p+_,A[2]=y+g,a.distance=S+w,a.normalize()},t._get3PlaneInterPoint=function(e,i,n){var r=e.normal,s=i.normal,a=n.normal;ae.cross(s,a,t._tempV30),ae.cross(a,r,t._tempV31),ae.cross(r,s,t._tempV32);var o=ae.dot(r,t._tempV30),h=ae.dot(s,t._tempV31),l=ae.dot(a,t._tempV32);return ae.scale(t._tempV30,-e.distance/o,t._tempV33),ae.scale(t._tempV31,-i.distance/h,t._tempV34),ae.scale(t._tempV32,-n.distance/l,t._tempV35),ae.add(t._tempV33,t._tempV34,t._tempV36),ae.add(t._tempV35,t._tempV36,t._tempV37),t._tempV37},n(t,["_tempV30",function(){return this._tempV30=new ae},"_tempV31",function(){return this._tempV31=new ae},"_tempV32",function(){return this._tempV32=new ae},"_tempV33",function(){return this._tempV33=new ae},"_tempV34",function(){return this._tempV34=new ae},"_tempV35",function(){return this._tempV35=new ae},"_tempV36",function(){return this._tempV36=new ae},"_tempV37",function(){return this._tempV37=new ae}]),t}(),Qt=function(){function t(t,e){this.center=null,this.radius=NaN,this.center=t,this.radius=e}r(t,"laya.d3.math.BoundSphere");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.toDefault=function(){this.center.toDefault(),this.radius=0},e.intersectsRayDistance=function(t){return Collision.intersectsRayAndSphereRD(t,this)},e.intersectsRayPoint=function(t,e){return Collision.intersectsRayAndSphereRP(t,this,e)},e.cloneTo=function(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius},e.clone=function(){var t=new this.constructor(new ae,new ae);return this.cloneTo(t),t},t.createFromSubPoints=function(e,i,n,r){if(null==e)throw new Error("points");if(i<0||i>=e.length)throw new Error("start"+i+"Must be in the range [0, "+(e.length-1)+"]");if(n<0||i+n>e.length)throw new Error("count"+n+"Must be in the range <= "+e.length+"}");var s=i+n,a=t._tempVector3;a.elements[0]=0,a.elements[1]=0,a.elements[2]=0;for(var o=i;o<s;++o)ae.add(e[o],a,a);var h=r.center;ae.scale(a,1/n,h);var l=0;for(o=i;o<s;++o){var c=ae.distanceSquared(h,e[o]);l<c&&(l=c)}r.radius=Math.sqrt(l)},t.createfromPoints=function(e,i){if(null==e)throw new Error("points");t.createFromSubPoints(e,0,e.length,i)},n(t,["_tempVector3",function(){return this._tempVector3=new ae}]),t}(),Jt=(function(){function t(){}r(t,"laya.d3.math.ContainmentType"),t.Disjoint=0,t.Contains=1,t.Intersects=2}(),function(){function t(){}return r(t,"laya.d3.math.MathUtils3D"),t.isZero=function(e){return Math.abs(e)<t.zeroTolerance},t.nearEqual=function(e,i){return!!t.isZero(e-i)},t.fastInvSqrt=function(e){return t.isZero(e)?e:1/Math.sqrt(e)},n(t,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),t}()),$t=function(){function t(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}r(t,"laya.d3.math.Matrix3x3");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.determinant=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7],l=t[8];return e*(l*s-a*h)+i*(-l*r+a*o)+n*(h*r-s*o)},e.translate=function(t,e){var i=e.elements,n=this.elements,r=t.elements,s=n[0],a=n[1],o=n[2],h=n[3],l=n[4],c=n[5],u=n[6],d=n[7],_=n[8],f=r[0],p=r[1];i[0]=s,i[1]=a,i[2]=o,i[3]=h,i[4]=l,i[5]=c,i[6]=f*s+p*h+u,i[7]=f*a+p*l+d,i[8]=f*o+p*c+_},e.rotate=function(t,e){var i=e.elements,n=this.elements,r=n[0],s=n[1],a=n[2],o=n[3],h=n[4],l=n[5],c=n[6],u=n[7],d=n[8],_=Math.sin(t),f=Math.cos(t);i[0]=f*r+_*o,i[1]=f*s+_*h,i[2]=f*a+_*l,i[3]=f*o-_*r,i[4]=f*h-_*s,i[5]=f*l-_*a,i[6]=c,i[7]=u,i[8]=d},e.scale=function(t,e){var i=e.elements,n=this.elements,r=t.elements,s=r[0],a=r[1];i[0]=s*n[0],i[1]=s*n[1],i[2]=s*n[2],i[3]=a*n[3],i[4]=a*n[4],i[5]=a*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},e.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],h=i[5],l=i[6],c=i[7],u=i[8],d=u*o-h*c,_=-u*a+h*l,f=c*a-o*l,p=n*d+r*_+s*f;p||(t=null),p=1/p,e[0]=d*p,e[1]=(-u*r+s*c)*p,e[2]=(h*r-s*o)*p,e[3]=_*p,e[4]=(u*n-s*l)*p,e[5]=(-h*n+s*a)*p,e[6]=f*p,e[7]=(-c*n+r*l)*p,e[8]=(o*n-r*a)*p},e.transpose=function(t){var e=t.elements,i=this.elements;if(t===this){var n=i[1],r=i[2],s=i[5];e[1]=i[3],e[2]=i[6],e[3]=n,e[5]=i[7],e[6]=r,e[7]=s}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]},e.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},e.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<9;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.createFromTranslation=function(t,e){e.elements;var i=t.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=i[0],e[7]=i[1],e[8]=1},t.createFromRotation=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1},t.createFromScaling=function(t,e){var i=e.elements,n=t.elements;i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1},t.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements,a=r[0],o=r[1],h=r[2],l=r[3],c=r[4],u=r[5],d=r[6],_=r[7],f=r[8],p=s[0],m=s[1],g=s[2],v=s[3],y=s[4],x=s[5],w=s[6],b=s[7],S=s[8];n[0]=p*a+m*l+g*d,n[1]=p*o+m*c+g*_,n[2]=p*h+m*u+g*f,n[3]=v*a+y*l+x*d,n[4]=v*o+y*c+x*_,n[5]=v*h+y*u+x*f,n[6]=w*a+b*l+S*d,n[7]=w*o+b*c+S*_,n[8]=w*h+b*u+S*f},t.lookAt=function(e,i,n,r){ae.subtract(e,i,t._tempV30),ae.normalize(t._tempV30,t._tempV30),ae.cross(n,t._tempV30,t._tempV31),ae.normalize(t._tempV31,t._tempV31),ae.cross(t._tempV30,t._tempV31,t._tempV32);var s=t._tempV30.elements,a=t._tempV31.elements,o=t._tempV32.elements,h=r.elements;h[0]=a[0],h[3]=a[1],h[6]=a[2],h[1]=o[0],h[4]=o[1],h[7]=o[2],h[2]=s[0],h[5]=s[1],h[8]=s[2]},t.DEFAULT=new t,n(t,["_tempV30",function(){return this._tempV30=new ae},"_tempV31",function(){return this._tempV31=new ae},"_tempV32",function(){return this._tempV32=new ae}]),t}(),te=function(){function t(t,e,i,n,r,s,a,o,h,l,c,u,d,_,f,p){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===c&&(c=1),void 0===u&&(u=0),void 0===d&&(d=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===p&&(p=1);var m=this.elements=new Float32Array(16);m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=r,m[5]=s,m[6]=a,m[7]=o,m[8]=h,m[9]=l,m[10]=c,m[11]=u,m[12]=d,m[13]=_,m[14]=f,m[15]=p}r(t,"laya.d3.math.Matrix4x4");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.getElementByRowColumn=function(t,e){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]},e.setElementByRowColumn=function(t,e,i){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i},e.equalsOtherMatrix=function(t){var e=this.elements,i=t.elements;return Jt.nearEqual(e[0],i[0])&&Jt.nearEqual(e[1],i[1])&&Jt.nearEqual(e[2],i[2])&&Jt.nearEqual(e[3],i[3])&&Jt.nearEqual(e[4],i[4])&&Jt.nearEqual(e[5],i[5])&&Jt.nearEqual(e[6],i[6])&&Jt.nearEqual(e[7],i[7])&&Jt.nearEqual(e[8],i[8])&&Jt.nearEqual(e[9],i[9])&&Jt.nearEqual(e[10],i[10])&&Jt.nearEqual(e[11],i[11])&&Jt.nearEqual(e[12],i[12])&&Jt.nearEqual(e[13],i[13])&&Jt.nearEqual(e[14],i[14])&&Jt.nearEqual(e[15],i[15])},e.decomposeTransRotScale=function(e,i,n){var r=t._tempMatrix4x4;return this.decomposeTransRotMatScale(e,r,n)?(ie.createFromMatrix4x4(r,i),!0):(i.identity(),!1)},e.decomposeTransRotMatScale=function(e,i,n){var r=this.elements,s=e.elements,a=i.elements,o=n.elements;s[0]=r[12],s[1]=r[13],s[2]=r[14];var h=r[0],l=r[1],c=r[2],u=r[4],d=r[5],_=r[6],f=r[8],p=r[9],m=r[10],g=o[0]=Math.sqrt(h*h+l*l+c*c),v=o[1]=Math.sqrt(u*u+d*d+_*_),y=o[2]=Math.sqrt(f*f+p*p+m*m);if(Jt.isZero(g)||Jt.isZero(v)||Jt.isZero(y))return a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0,a[0]=a[5]=a[10]=a[15]=1,!1;var x=t._tempVector0,w=x.elements;w[0]=f/y,w[1]=p/y,w[2]=m/y;var b=t._tempVector1,S=b.elements;S[0]=h/g,S[1]=l/g,S[2]=c/g;var T=t._tempVector2;ae.cross(x,b,T);var C=t._tempVector1;return ae.cross(T,x,C),a[3]=a[7]=a[11]=a[12]=a[13]=a[14]=0,a[15]=1,a[0]=C.x,a[1]=C.y,a[2]=C.z,a[4]=T.x,a[5]=T.y,a[6]=T.z,a[8]=x.x,a[9]=x.y,a[10]=x.z,a[0]*h+a[1]*l+a[2]*c<0&&(o[0]=-g),a[4]*u+a[5]*d+a[6]*_<0&&(o[1]=-v),a[8]*f+a[9]*p+a[10]*m<0&&(o[2]=-y),!0},e.decomposeYawPitchRoll=function(t){var e=t.elements,i=Math.asin(-this.elements[9]);e[1]=i,Math.cos(i)>Jt.zeroTolerance?(e[2]=Math.atan2(this.elements[1],this.elements[5]),e[0]=Math.atan2(this.elements[8],this.elements[10])):(e[2]=Math.atan2(-this.elements[4],this.elements[0]),e[0]=0)},e.normalize=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=Math.sqrt(e*e+i*i+n*n);if(!r)return t[0]=0,t[1]=0,void(t[2]=0);1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=n*r)},e.transpose=function(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.invert=function(t){var e=this.elements,i=t.elements,n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],h=e[5],l=e[6],c=e[7],u=e[8],d=e[9],_=e[10],f=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=n*h-r*o,x=n*l-s*o,w=n*c-a*o,b=r*l-s*h,S=r*c-a*h,T=s*c-a*l,C=u*m-d*p,M=u*g-_*p,I=u*v-f*p,E=d*g-_*m,A=d*v-f*m,D=_*v-f*g,P=y*D-x*A+w*E+b*I-S*M+T*C;0!==Math.abs(P)&&(P=1/P,i[0]=(h*D-l*A+c*E)*P,i[1]=(s*A-r*D-a*E)*P,i[2]=(m*T-g*S+v*b)*P,i[3]=(_*S-d*T-f*b)*P,i[4]=(l*I-o*D-c*M)*P,i[5]=(n*D-s*I+a*M)*P,i[6]=(g*w-p*T-v*x)*P,i[7]=(u*T-_*w+f*x)*P,i[8]=(o*A-h*I+c*C)*P,i[9]=(r*I-n*A-a*C)*P,i[10]=(p*S-m*w+v*y)*P,i[11]=(d*w-u*S-f*y)*P,i[12]=(h*M-o*E-l*C)*P,i[13]=(n*E-r*M+s*C)*P,i[14]=(m*x-p*b-g*y)*P,i[15]=(u*b-d*x+_*y)*P)},e.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},e.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<16;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.getTranslationVector=function(t){var e=this.elements,i=t.elements;i[0]=e[12],i[1]=e[13],i[2]=e[14]},e.setTranslationVector=function(t){var e=this.elements,i=t.elements;e[12]=i[0],e[13]=i[1],e[14]=i[2]},e.getForward=function(t){var e=this.elements,i=t.elements;i[0]=-e[8],i[1]=-e[9],i[2]=-e[10]},e.setForward=function(t){var e=this.elements,i=t.elements;e[8]=-i[0],e[9]=-i[1],e[10]=-i[2]},t.createRotationX=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=n,i[9]=-n},t.createRotationY=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-n,i[8]=n},t.createRotationZ=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=n,i[4]=-n},t.createRotationYawPitchRoll=function(e,i,n,r){ie.createFromYawPitchRoll(e,i,n,t._tempQuaternion),t.createRotationQuaternion(t._tempQuaternion,r)},t.createRotationAxis=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=Math.cos(e),h=Math.sin(e),l=r*r,c=s*s,u=a*a,d=r*s,_=r*a,f=s*a,p=i.elements;p[3]=p[7]=p[11]=p[12]=p[13]=p[14]=0,p[15]=1,p[0]=l+o*(1-l),p[1]=d-o*d+h*a,p[2]=_-o*_-h*s,p[4]=d-o*d-h*a,p[5]=c+o*(1-c),p[6]=f-o*f+h*r,p[8]=_-o*_+h*s,p[9]=f-o*f-h*r,p[10]=u+o*(1-u)},t.createRotationQuaternion=function(t,e){var i=t.elements,n=e.elements,r=i[0],s=i[1],a=i[2],o=i[3],h=r*r,l=s*s,c=a*a,u=r*s,d=a*o,_=a*r,f=s*o,p=s*a,m=r*o;n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=1-2*(l+c),n[1]=2*(u+d),n[2]=2*(_-f),n[4]=2*(u-d),n[5]=1-2*(c+h),n[6]=2*(p+m),n[8]=2*(_+f),n[9]=2*(p-m),n[10]=1-2*(l+h)},t.createTranslate=function(t,e){var i=t.elements,n=e.elements;n[4]=n[8]=n[1]=n[9]=n[2]=n[6]=n[3]=n[7]=n[11]=0,n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},t.createScaling=function(t,e){var i=t.elements,n=e.elements;n[0]=i[0],n[5]=i[1],n[10]=i[2],n[1]=n[4]=n[8]=n[12]=n[9]=n[13]=n[2]=n[6]=n[14]=n[3]=n[7]=n[11]=0,n[15]=1},t.multiply=function(t,e,i){var n,r,s,a,o,h,l,c;for(r=i.elements,s=t.elements,r===(a=e.elements)&&(a=a.slice()),n=0;n<4;n++)o=s[n],h=s[n+4],l=s[n+8],c=s[n+12],r[n]=o*a[0]+h*a[1]+l*a[2]+c*a[3],r[n+4]=o*a[4]+h*a[5]+l*a[6]+c*a[7],r[n+8]=o*a[8]+h*a[9]+l*a[10]+c*a[11],r[n+12]=o*a[12]+h*a[13]+l*a[14]+c*a[15]},t.createFromQuaternion=function(t,e){var i=e.elements,n=t.elements,r=n[0],s=n[1],a=n[2],o=n[3],h=r+r,l=s+s,c=a+a,u=r*h,d=s*h,_=s*l,f=a*h,p=a*l,m=a*c,g=o*h,v=o*l,y=o*c;i[0]=1-_-m,i[1]=d+y,i[2]=f-v,i[3]=0,i[4]=d-y,i[5]=1-u-m,i[6]=p+g,i[7]=0,i[8]=f+v,i[9]=p-g,i[10]=1-u-_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},t.createAffineTransformation=function(t,e,i,n){var r=t.elements,s=e.elements,a=i.elements,o=n.elements,h=s[0],l=s[1],c=s[2],u=s[3],d=h+h,_=l+l,f=c+c,p=h*d,m=h*_,g=h*f,v=l*_,y=l*f,x=c*f,w=u*d,b=u*_,S=u*f,T=a[0],C=a[1],M=a[2];o[0]=(1-(v+x))*T,o[1]=(m+S)*T,o[2]=(g-b)*T,o[3]=0,o[4]=(m-S)*C,o[5]=(1-(p+x))*C,o[6]=(y+w)*C,o[7]=0,o[8]=(g+b)*M,o[9]=(y-w)*M,o[10]=(1-(p+v))*M,o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1},t.createLookAt=function(e,i,n,r){var s=r.elements,a=t._tempVector0,o=t._tempVector1,h=t._tempVector2;ae.subtract(e,i,h),ae.normalize(h,h),ae.cross(n,h,a),ae.normalize(a,a),ae.cross(h,a,o),r.identity(),s[0]=a.x,s[4]=a.y,s[8]=a.z,s[1]=o.x,s[5]=o.y,s[9]=o.z,s[2]=h.x,s[6]=h.y,s[10]=h.z,s[12]=-ae.dot(a,e),s[13]=-ae.dot(o,e),s[14]=-ae.dot(h,e)},t.createPerspective=function(t,e,i,n,r){var s=r.elements,a=1/Math.tan(t/2),o=1/(i-n);s[0]=a/e,s[5]=a,s[10]=(n+i)*o,s[11]=-1,s[14]=2*n*i*o,s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[12]=s[13]=s[15]=0},t.createOrthoOffCenterRH=function(t,e,i,n,r,s,a){var o=a.elements,h=1/(t-e),l=1/(i-n),c=1/(r-s);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=0,o[15]=1,o[0]=-2*h,o[5]=-2*l,o[10]=2*c,o[12]=(t+e)*h,o[13]=(n+i)*l,o[14]=(s+r)*c},t.translation=function(t,e){var i=t.elements,n=e.elements;n[0]=n[5]=n[10]=n[15]=1,n[12]=i[0],n[13]=i[1],n[14]=i[2]},n(t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new t},"_tempVector0",function(){return this._tempVector0=new ae},"_tempVector1",function(){return this._tempVector1=new ae},"_tempVector2",function(){return this._tempVector2=new ae},"_tempQuaternion",function(){return this._tempQuaternion=new ie},"DEFAULT",function(){return this.DEFAULT=new t},"ZERO",function(){return this.ZERO=new t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),t}(),ee=(function(){function t(t,e){this.extents=null,this.transformation=null,this.extents=t,this.transformation=e}r(t,"laya.d3.math.OrientedBoundBox");var e=t.prototype;e.getCorners=function(e){var i=t._tempV30.elements,n=t._tempV31.elements,r=t._tempV32.elements,s=this.extents.elements;i[0]=s[0],i[1]=i[2]=0,n[1]=s[1],n[0]=n[2]=0,r[2]=s[2],r[0]=r[1]=0,ae.TransformNormal(t._tempV30,this.transformation,t._tempV30),ae.TransformNormal(t._tempV31,this.transformation,t._tempV31),ae.TransformNormal(t._tempV32,this.transformation,t._tempV32);var a=t._tempV33;this.transformation.getTranslationVector(a),e.length=8,ae.add(a,t._tempV30,t._tempV34),ae.add(t._tempV34,t._tempV31,t._tempV34),ae.add(t._tempV34,t._tempV32,e[0]),ae.add(a,t._tempV30,t._tempV34),ae.add(t._tempV34,t._tempV31,t._tempV34),ae.subtract(t._tempV34,t._tempV32,e[1]),ae.subtract(a,t._tempV30,t._tempV34),ae.add(t._tempV34,t._tempV31,t._tempV34),ae.subtract(t._tempV34,t._tempV32,e[2]),ae.subtract(a,t._tempV30,t._tempV34),ae.add(t._tempV34,t._tempV31,t._tempV34),ae.add(t._tempV34,t._tempV32,e[3]),ae.add(a,t._tempV30,t._tempV34),ae.subtract(t._tempV34,t._tempV31,t._tempV34),ae.add(t._tempV34,t._tempV32,e[4]),ae.add(a,t._tempV30,t._tempV34),ae.subtract(t._tempV34,t._tempV31,t._tempV34),ae.subtract(t._tempV34,t._tempV32,e[5]),ae.subtract(a,t._tempV30,t._tempV34),ae.subtract(t._tempV34,t._tempV31,t._tempV34),ae.subtract(t._tempV34,t._tempV32,e[6]),ae.subtract(a,t._tempV30,t._tempV34),ae.subtract(t._tempV34,t._tempV31,t._tempV34),ae.add(t._tempV34,t._tempV32,e[7])},e.transform=function(t){te.multiply(this.transformation,t,this.transformation)},e.scale=function(t){ae.multiply(this.extents,t,this.extents)},e.translate=function(e){this.transformation.getTranslationVector(t._tempV30),ae.add(t._tempV30,e,t._tempV31),this.transformation.setTranslationVector(t._tempV31)},e.Size=function(t){ae.scale(this.extents,2,t)},e.getSize=function(e){var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],ae.TransformNormal(t._tempV30,this.transformation,t._tempV30),ae.TransformNormal(t._tempV31,this.transformation,t._tempV31),ae.TransformNormal(t._tempV31,this.transformation,t._tempV32);var n=e.elements;n[0]=ae.scalarLength(t._tempV30),n[1]=ae.scalarLength(t._tempV31),n[2]=ae.scalarLength(t._tempV32)},e.getSizeSquared=function(e){var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],ae.TransformNormal(t._tempV30,this.transformation,t._tempV30),ae.TransformNormal(t._tempV31,this.transformation,t._tempV31),ae.TransformNormal(t._tempV31,this.transformation,t._tempV32);var n=e.elements;n[0]=ae.scalarLengthSquared(t._tempV30),n[1]=ae.scalarLengthSquared(t._tempV31),n[2]=ae.scalarLengthSquared(t._tempV32)},e.getCenter=function(t){this.transformation.getTranslationVector(t)},e.containsPoint=function(e){var i=this.extents.elements,n=i[0],r=i[1],s=i[2];this.transformation.invert(t._tempM0),ae.transformCoordinate(e,t._tempM0,t._tempV30);var a=t._tempV30.elements,o=Math.abs(a[0]),h=Math.abs(a[1]),l=Math.abs(a[2]);return Jt.nearEqual(o,n)&&Jt.nearEqual(h,r)&&Jt.nearEqual(l,s)?2:o<n&&h<r&&l<s?1:0},e.containsPoints=function(e){var i=this.extents.elements,n=i[0],r=i[1],s=i[2];this.transformation.invert(t._tempM0);for(var a=!0,o=!1,h=0;h<e.length;h++){ae.transformCoordinate(e[h],t._tempM0,t._tempV30);var l=t._tempV30.elements,c=Math.abs(l[0]),u=Math.abs(l[1]),d=Math.abs(l[2]);Jt.nearEqual(c,n)&&Jt.nearEqual(u,r)&&Jt.nearEqual(d,s)&&(o=!0),c<n&&u<r&&d<s?o=!0:a=!1}return a?1:o?2:0},e.containsSphere=function(e,i){void 0===i&&(i=!1);var n=this.extents.elements,r=n[0],s=n[1],a=n[2],o=e.radius;this.transformation.invert(t._tempM0),ae.transformCoordinate(e.center,t._tempM0,t._tempV30);var h;if(h=i?o:(ae.scale(ae.UnitX,o,t._tempV31),ae.TransformNormal(t._tempV31,t._tempM0,t._tempV31),ae.scalarLength(t._tempV31)),ae.scale(this.extents,-1,t._tempV32),ae.Clamp(t._tempV30,t._tempV32,this.extents,t._tempV33),h*h<ae.distanceSquared(t._tempV30,t._tempV33))return 0;var l=t._tempV30.elements,c=l[0],u=l[1],d=l[2],_=t._tempV32.elements,f=_[0],p=_[1],m=_[2];return f+h<=c&&c<=r-h&&h<r-f&&p+h<=u&&u<=s-h&&h<s-p&&m+h<=d&&d<=a-h&&h<a-m?1:2},e.containsOrientedBoundBox=function(e){var i=0,n=0;e.getCorners(t._corners);var r=this.containsPoints(t._corners);if(0!=r)return r;var s=this.extents.elements;e.extents.cloneTo(t._tempV35);var a=t._tempV35.elements;t._getRows(this.transformation,t._rows1),t._getRows(e.transformation,t._rows2);var o=NaN;for(i=0;i<4;i++)for(n=0;n<4;n++)3==i||3==n?(t._tempM0.setElementByRowColumn(i,n,0),t._tempM1.setElementByRowColumn(i,n,0)):(o=ae.dot(t._rows1[i],t._rows2[n]),t._tempM0.setElementByRowColumn(i,n,o),t._tempM1.setElementByRowColumn(i,n,Math.abs(o)));e.getCenter(t._tempV34),this.getCenter(t._tempV36),ae.subtract(t._tempV34,t._tempV36,t._tempV30);var h=t._tempV31.elements;h[0]=ae.dot(t._tempV30,t._rows1[0]),h[1]=ae.dot(t._tempV30,t._rows1[1]),h[2]=ae.dot(t._tempV30,t._rows1[2]);var l=t._tempV32.elements,c=t._tempV33.elements;for(i=0;i<3;i++)if(l[0]=t._tempM1.getElementByRowColumn(i,0),l[1]=t._tempM1.getElementByRowColumn(i,1),l[2]=t._tempM1.getElementByRowColumn(i,2),s[i]+ae.dot(t._tempV35,t._tempV32)<Math.abs(h[i]))return 0;for(n=0;n<3;n++)if(l[0]=t._tempM1.getElementByRowColumn(0,n),l[1]=t._tempM1.getElementByRowColumn(1,n),l[2]=t._tempM1.getElementByRowColumn(2,n),c[0]=t._tempM0.getElementByRowColumn(0,n),c[1]=t._tempM0.getElementByRowColumn(1,n),c[2]=t._tempM0.getElementByRowColumn(2,n),ae.dot(this.extents,t._tempV32)+a[n]<Math.abs(ae.dot(t._tempV31,t._tempV33)))return 0;for(i=0;i<3;i++)for(n=0;n<3;n++){var u=(i+1)%3,d=(i+2)%3,_=(n+1)%3,f=(n+2)%3;if(s[u]*t._tempM1.getElementByRowColumn(d,n)+s[d]*t._tempM1.getElementByRowColumn(u,n)+(a[_]*t._tempM1.getElementByRowColumn(i,f)+a[f]*t._tempM1.getElementByRowColumn(i,_))<Math.abs(h[d]*t._tempM0.getElementByRowColumn(u,n)-h[u]*t._tempM0.getElementByRowColumn(d,n)))return 0}return 2},e.containsLine=function(e,i){t._corners[0]=e,t._corners[1]=i;var n=this.containsPoints(t._corners);if(0!=n)return n;var r=this.extents.elements,s=r[0],a=r[1],o=r[2];this.transformation.invert(t._tempM0),ae.transformCoordinate(e,t._tempM0,t._tempV30),ae.transformCoordinate(i,t._tempM0,t._tempV31),ae.add(t._tempV30,t._tempV31,t._tempV32),ae.scale(t._tempV32,.5,t._tempV32),ae.subtract(t._tempV30,t._tempV32,t._tempV33);var h=t._tempV33.elements,l=h[0],c=h[1],u=h[2],d=t._tempV34.elements,_=d[0]=Math.abs(h[0]),f=d[1]=Math.abs(h[1]),p=d[2]=Math.abs(h[2]),m=t._tempV32.elements,g=m[0],v=m[1],y=m[2];return Math.abs(g)>s+_||Math.abs(v)>a+f||Math.abs(y)>o+p||Math.abs(v*u-y*c)>a*p+o*f||Math.abs(g*u-y*l)>s*p+o*_||Math.abs(g*c-v*l)>s*f+a*_?0:2},e.containsBoundBox=function(e){var i=0,n=0,r=e.min,s=e.max;e.getCorners(t._corners);var a=this.containsPoints(t._corners);if(0!=a)return a;ae.subtract(s,r,t._tempV30),ae.scale(t._tempV30,.5,t._tempV30),ae.add(r,t._tempV30,t._tempV30),ae.subtract(s,t._tempV30,t._tempV31);var o=this.extents.elements,h=t._tempV31.elements;for(t._getRows(this.transformation,t._rows1),this.transformation.invert(t._tempM0),i=0;i<3;i++)for(n=0;n<3;n++)t._tempM1.setElementByRowColumn(i,n,Math.abs(t._tempM0.getElementByRowColumn(i,n)));this.getCenter(t._tempV35),ae.subtract(t._tempV30,t._tempV35,t._tempV32);var l=t._tempV31.elements;l[0]=ae.dot(t._tempV32,t._rows1[0]),l[1]=ae.dot(t._tempV32,t._rows1[1]),l[2]=ae.dot(t._tempV32,t._rows1[2]);var c=t._tempV33.elements,u=t._tempV34.elements;for(i=0;i<3;i++)if(c[0]=t._tempM1.getElementByRowColumn(i,0),c[1]=t._tempM1.getElementByRowColumn(i,1),c[2]=t._tempM1.getElementByRowColumn(i,2),o[i]+ae.dot(t._tempV31,t._tempV33)<Math.abs(l[i]))return 0;for(n=0;n<3;n++)if(c[0]=t._tempM1.getElementByRowColumn(0,n),c[1]=t._tempM1.getElementByRowColumn(1,n),c[2]=t._tempM1.getElementByRowColumn(2,n),u[0]=t._tempM0.getElementByRowColumn(0,n),u[1]=t._tempM0.getElementByRowColumn(1,n),u[2]=t._tempM0.getElementByRowColumn(2,n),ae.dot(this.extents,t._tempV33)+h[n]<Math.abs(ae.dot(t._tempV31,t._tempV34)))return 0;for(i=0;i<3;i++)for(n=0;n<3;n++){var d=(i+1)%3,_=(i+2)%3,f=(n+1)%3,p=(n+2)%3;if(o[d]*t._tempM1.getElementByRowColumn(_,n)+o[_]*t._tempM1.getElementByRowColumn(d,n)+(h[f]*t._tempM1.getElementByRowColumn(i,p)+h[p]*t._tempM1.getElementByRowColumn(i,f))<Math.abs(l[_]*t._tempM0.getElementByRowColumn(d,n)-l[d]*t._tempM0.getElementByRowColumn(_,n)))return 0}return 2},e.intersectsRay=function(e,i){ae.scale(this.extents,-1,t._tempV30),this.transformation.invert(t._tempM0),ae.TransformNormal(e.direction,t._tempM0,t._ray.direction),ae.transformCoordinate(e.origin,t._tempM0,t._ray.origin),t._boxBound1.min=t._tempV30,t._boxBound1.max=this.extents;var n=Collision.intersectsRayAndBoxRP(t._ray,t._boxBound1,i);return-1!==n&&ae.transformCoordinate(i,this.transformation,i),n},e._getLocalCorners=function(e){e.length=8;var i=this.extents.elements;t._tempV30.x=i[0],t._tempV31.y=i[1],t._tempV32.z=i[2],ae.add(t._tempV30,t._tempV31,t._tempV33),ae.add(t._tempV33,t._tempV32,e[0]),ae.add(t._tempV30,t._tempV31,t._tempV33),ae.subtract(t._tempV33,t._tempV32,e[1]),ae.subtract(t._tempV31,t._tempV30,t._tempV33),ae.subtract(t._tempV33,t._tempV30,e[2]),ae.subtract(t._tempV31,t._tempV30,t._tempV33),ae.add(t._tempV33,t._tempV32,e[3]),ae.subtract(t._tempV30,t._tempV31,t._tempV33),ae.add(t._tempV33,t._tempV32,e[4]),ae.subtract(t._tempV30,t._tempV31,t._tempV33),ae.subtract(t._tempV33,t._tempV32,e[5]),ae.scale(e[0],-1,e[6]),ae.subtract(t._tempV32,t._tempV30,t._tempV33),ae.subtract(t._tempV33,t._tempV31,e[7])},e.equals=function(t){return this.extents==t.extents&&this.transformation==t.transformation},e.cloneTo=function(t){var e=t;this.extents.cloneTo(e.extents),this.transformation.cloneTo(e.transformation)},t.createByBoundBox=function(e,i){var n=e.min,r=e.max;ae.subtract(r,n,t._tempV30),ae.scale(t._tempV30,.5,t._tempV30),ae.add(n,t._tempV30,t._tempV31),ae.subtract(r,t._tempV31,t._tempV32),te.translation(t._tempV31,t._tempM0);var s=t._tempV32.clone(),a=t._tempM0.clone();i.extents=s,i.transformation=a},t.createByMinAndMaxVertex=function(e,i){return ae.subtract(i,e,t._tempV30),ae.scale(t._tempV30,.5,t._tempV30),ae.add(e,t._tempV30,t._tempV31),ae.subtract(i,t._tempV31,t._tempV32),te.translation(t._tempV31,t._tempM0),new t(t._tempV32,t._tempM0)},t._getRows=function(t,e){e.length=3;var i=t.elements,n=e[0].elements;n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=e[1].elements;r[0]=i[4],r[1]=i[5],r[2]=i[6];var s=e[2].elements;s[0]=i[8],s[1]=i[9],s[2]=i[10]},t.getObbtoObbMatrix4x4=function(e,i,n,r){var s=e.transformation,a=i.transformation;if(n){t._getRows(s,t._rows1),t._getRows(a,t._rows2);for(var o=0;o<3;o++)for(var h=0;h<3;h++)r.setElementByRowColumn(o,h,ae.dot(t._rows2[o],t._rows1[h]));i.getCenter(t._tempV30),e.getCenter(t._tempV31),ae.subtract(t._tempV30,t._tempV31,t._tempV32);var l=r.elements;l[12]=ae.dot(t._tempV32,t._rows1[0]),l[13]=ae.dot(t._tempV32,t._rows1[1]),l[14]=ae.dot(t._tempV32,t._rows1[2]),l[15]=1}else s.invert(t._tempM0),te.multiply(a,t._tempM0,r)},t.merge=function(e,i,n){var r=e.extents,s=e.transformation;t.getObbtoObbMatrix4x4(e,i,n,t._tempM0),i._getLocalCorners(t._corners),ae.transformCoordinate(t._corners[0],t._tempM0,t._corners[0]),ae.transformCoordinate(t._corners[1],t._tempM0,t._corners[1]),ae.transformCoordinate(t._corners[2],t._tempM0,t._corners[2]),ae.transformCoordinate(t._corners[3],t._tempM0,t._corners[3]),ae.transformCoordinate(t._corners[4],t._tempM0,t._corners[4]),ae.transformCoordinate(t._corners[5],t._tempM0,t._corners[5]),ae.transformCoordinate(t._corners[6],t._tempM0,t._corners[6]),ae.transformCoordinate(t._corners[7],t._tempM0,t._corners[7]),ae.scale(r,-1,t._boxBound1.min),r.cloneTo(t._boxBound1.max),qt.createfromPoints(t._corners,t._boxBound2),qt.merge(t._boxBound2,t._boxBound1,t._boxBound3);var a=t._boxBound3.min,o=t._boxBound3.max;ae.subtract(o,a,t._tempV30),ae.scale(t._tempV30,.5,t._tempV30),ae.add(a,t._tempV30,t._tempV32),ae.subtract(o,t._tempV32,r),ae.transformCoordinate(t._tempV32,s,t._tempV33)},n(t,["_tempV30",function(){return this._tempV30=new ae},"_tempV31",function(){return this._tempV31=new ae},"_tempV32",function(){return this._tempV32=new ae},"_tempV33",function(){return this._tempV33=new ae},"_tempV34",function(){return this._tempV34=new ae},"_tempV35",function(){return this._tempV35=new ae},"_tempV36",function(){return this._tempV36=new ae},"_tempM0",function(){return this._tempM0=new te},"_tempM1",function(){return this._tempM1=new te},"_corners",function(){return this._corners=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae]},"_rows1",function(){return this._rows1=[new ae,new ae,new ae]},"_rows2",function(){return this._rows2=[new ae,new ae,new ae]},"_ray",function(){return this._ray=new re(new ae,new ae)},"_boxBound1",function(){return this._boxBound1=new qt(new ae,new ae)},"_boxBound2",function(){return this._boxBound2=new qt(new ae,new ae)},"_boxBound3",function(){return this._boxBound3=new qt(new ae,new ae)}])}(),function(){function t(t,e){this.normal=null,this.distance=NaN,void 0===e&&(e=0),this.normal=t,this.distance=e}return r(t,"laya.d3.math.Plane"),t.prototype.normalize=function(){var t=this.normal.elements,e=t[0],i=t[1],n=t[2],r=1/Math.sqrt(e*e+i*i+n*n);t[0]=e*r,t[1]=i*r,t[2]=n*r,this.distance*=r},t.createPlaneBy3P=function(e,i,n){var r=e.elements,s=i.elements,a=n.elements,o=s[0]-r[0],h=s[1]-r[1],l=s[2]-r[2],c=a[0]-r[0],u=a[1]-r[1],d=a[2]-r[2],_=h*d-l*u,f=l*c-o*d,p=o*u-h*c,m=1/Math.sqrt(_*_+f*f+p*p),g=_*m,v=f*m,y=p*m,x=t._TEMPVec3.elements;x[0]=g,x[1]=v,x[2]=y;var w=-(g*r[0]+v*r[1]+y*r[2]);return new t(t._TEMPVec3,w)},t.PlaneIntersectionType_Back=0,t.PlaneIntersectionType_Front=1,t.PlaneIntersectionType_Intersecting=2,n(t,["_TEMPVec3",function(){return this._TEMPVec3=new ae}]),t}()),ie=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.elements[0]=t,this.elements[1]=e,this.elements[2]=i,this.elements[3]=n}r(t,"laya.d3.math.Quaternion");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.scaling=function(t,e){var i=e.elements,n=this.elements;i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t},e.normalize=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=n*n+r*r+s*s+a*a;0<o&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=s*o,e[3]=a*o)},e.length=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},e.rotateX=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],s=n[1],a=n[2],o=n[3],h=Math.sin(t),l=Math.cos(t);i[0]=r*l+o*h,i[1]=s*l+a*h,i[2]=a*l-s*h,i[3]=o*l-r*h},e.rotateY=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],s=n[1],a=n[2],o=n[3],h=Math.sin(t),l=Math.cos(t);i[0]=r*l-a*h,i[1]=s*l+o*h,i[2]=a*l+r*h,i[3]=o*l-s*h},e.rotateZ=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],s=n[1],a=n[2],o=n[3],h=Math.sin(t),l=Math.cos(t);i[0]=r*l+s*h,i[1]=s*l-r*h,i[2]=a*l+o*h,i[3]=o*l-a*h},e.getYawPitchRoll=function(e){ae.transformQuat(ae.ForwardRH,this,t.TEMPVector31),ae.transformQuat(ae.Up,this,t.TEMPVector32);var i=t.TEMPVector32.elements;t.angleTo(ae.ZERO,t.TEMPVector31,t.TEMPVector33);var n=t.TEMPVector33.elements;n[0]==Math.PI/2?(n[1]=t.arcTanAngle(i[2],i[0]),n[2]=0):n[0]==-Math.PI/2?(n[1]=t.arcTanAngle(-i[2],-i[0]),n[2]=0):(te.createRotationY(-n[1],t.TEMPMatrix0),te.createRotationX(-n[0],t.TEMPMatrix1),ae.transformCoordinate(t.TEMPVector32,t.TEMPMatrix0,t.TEMPVector32),ae.transformCoordinate(t.TEMPVector32,t.TEMPMatrix1,t.TEMPVector32),n[2]=t.arcTanAngle(i[1],-i[0])),n[1]<=-Math.PI&&(n[1]=Math.PI),n[2]<=-Math.PI&&(n[2]=Math.PI),n[1]>=Math.PI&&n[2]>=Math.PI&&(n[1]=0,n[2]=0,n[0]=Math.PI-n[0]);var r=e.elements;r[0]=n[1],r[1]=n[0],r[2]=n[2]},e.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=n*n+r*r+s*s+a*a,h=o?1/o:0;e[0]=-n*h,e[1]=-r*h,e[2]=-s*h,e[3]=a*h},e.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<4;++e)n[e]=i[e]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.equals=function(t){var e=this.elements,i=t.elements;return Jt.nearEqual(e[0],i[0])&&Jt.nearEqual(e[1],i[1])&&Jt.nearEqual(e[2],i[2])&&Jt.nearEqual(e[3],i[3])},e.lengthSquared=function(){var t=this.elements[0],e=this.elements[1],i=this.elements[2],n=this.elements[3];return t*t+e*e+i*i+n*n},s(0,e,"x",(function(){return this.elements[0]})),s(0,e,"y",(function(){return this.elements[1]})),s(0,e,"z",(function(){return this.elements[2]})),s(0,e,"w",(function(){return this.elements[3]})),t.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,s=.5*e,a=.5*t,o=Math.sin(r),h=Math.cos(r),l=Math.sin(s),c=Math.cos(s),u=Math.sin(a),d=Math.cos(a),_=n.elements;_[0]=d*l*h+u*c*o,_[1]=u*c*h-d*l*o,_[2]=d*c*o-u*l*h,_[3]=d*c*h+u*l*o},t.multiply=function(t,e,i){var n=t.elements,r=e.elements,s=i.elements,a=n[0],o=n[1],h=n[2],l=n[3],c=r[0],u=r[1],d=r[2],_=r[3],f=o*d-h*u,p=h*c-a*d,m=a*u-o*c,g=a*c+o*u+h*d;s[0]=a*_+c*l+f,s[1]=o*_+u*l+p,s[2]=h*_+d*l+m,s[3]=l*_-g},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,i,n){ae.subtract(i,e,t.TEMPVector30),ae.normalize(t.TEMPVector30,t.TEMPVector30),n.elements[0]=Math.asin(t.TEMPVector30.y),n.elements[1]=t.arcTanAngle(-t.TEMPVector30.z,-t.TEMPVector30.x)},t.createFromAxisAngle=function(t,e,i){var n=i.elements,r=t.elements;e*=.5;var s=Math.sin(e);n[0]=s*r[0],n[1]=s*r[1],n[2]=s*r[2],n[3]=Math.cos(e)},t.createFromMatrix3x3=function(t,e){var i,n=e.elements,r=t.elements,s=r[0]+r[4]+r[8];if(0<s)i=Math.sqrt(s+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var a=0;r[4]>r[0]&&(a=1),r[8]>r[3*a+a]&&(a=2);var o=(a+1)%3,h=(a+2)%3;i=Math.sqrt(r[3*a+a]-r[3*o+o]-r[3*h+h]+1),n[a]=.5*i,i=.5/i,n[3]=(r[3*o+h]-r[3*h+o])*i,n[o]=(r[3*o+a]+r[3*a+o])*i,n[h]=(r[3*h+a]+r[3*a+h])*i}},t.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,s=e.elements,a=r[0]+r[5]+r[10];0<a?(i=Math.sqrt(a+1),s[3]=.5*i,i=.5/i,s[0]=(r[6]-r[9])*i,s[1]=(r[8]-r[2])*i,s[2]=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(n=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),s[0]=.5*i,s[1]=(r[1]+r[4])*n,s[2]=(r[2]+r[8])*n,s[3]=(r[6]-r[9])*n):r[5]>r[10]?(n=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),s[0]=(r[4]+r[1])*n,s[1]=.5*i,s[2]=(r[9]+r[6])*n,s[3]=(r[8]-r[2])*n):(n=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),s[0]=(r[8]+r[2])*n,s[1]=(r[9]+r[6])*n,s[2]=.5*i,s[3]=(r[1]-r[4])*n)},t.slerp=function(t,e,i,n){var r,s,a,o,h,l=t.elements,c=e.elements,u=n.elements,d=l[0],_=l[1],f=l[2],p=l[3],m=c[0],g=c[1],v=c[2],y=c[3];return(s=d*m+_*g+f*v+p*y)<0&&(s=-s,m=-m,g=-g,v=-v,y=-y),h=1e-6<1-s?(r=Math.acos(s),a=Math.sin(r),o=Math.sin((1-i)*r)/a,Math.sin(i*r)/a):(o=1-i,i),u[0]=o*d+h*m,u[1]=o*_+h*g,u[2]=o*f+h*v,u[3]=o*p+h*y,u},t.lerp=function(t,e,i,n){var r=n.elements,s=t.elements,a=e.elements,o=s[0],h=s[1],l=s[2],c=s[3];r[0]=o+i*(a[0]-o),r[1]=h+i*(a[1]-h),r[2]=l+i*(a[2]-l),r[3]=c+i*(a[3]-c)},t.add=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2],n[3]=r[3]+s[3]},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.rotationLookAt=function(e,i,n){t.lookAt(ae.ZERO,e,i,n)},t.lookAt=function(e,i,n,r){$t.lookAt(e,i,n,t._tempMatrix3x3),t.rotationMatrix(t._tempMatrix3x3,r)},t.invert=function(t,e){var i=t.elements,n=e.elements,r=t.lengthSquared();Jt.isZero(r)||(r=1/r,n[0]=-i[0]*r,n[1]=-i[1]*r,n[2]=-i[2]*r,n[3]=i[3]*r)},t.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],h=i[5],l=i[6],c=i[7],u=i[8],d=e.elements,_=NaN,f=NaN,p=n+o+u;0<p?(_=Math.sqrt(p+1),d[3]=.5*_,_=.5/_,d[0]=(h-c)*_,d[1]=(l-s)*_,d[2]=(r-a)*_):o<=n&&u<=n?(f=.5/(_=Math.sqrt(1+n-o-u)),d[0]=.5*_,d[1]=(r+a)*f,d[2]=(s+l)*f,d[3]=(h-c)*f):u<o?(f=.5/(_=Math.sqrt(1+o-n-u)),d[0]=(a+r)*f,d[1]=.5*_,d[2]=(c+h)*f,d[3]=(l-s)*f):(f=.5/(_=Math.sqrt(1+u-n-o)),d[0]=(l+s)*f,d[1]=(c+h)*f,d[2]=.5*_,d[3]=(r-a)*f)},t.DEFAULT=new t,n(t,["TEMPVector30",function(){return this.TEMPVector30=new ae},"TEMPVector31",function(){return this.TEMPVector31=new ae},"TEMPVector32",function(){return this.TEMPVector32=new ae},"TEMPVector33",function(){return this.TEMPVector33=new ae},"TEMPMatrix0",function(){return this.TEMPMatrix0=new te},"TEMPMatrix1",function(){return this.TEMPMatrix1=new te},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $t},"NAN",function(){return this.NAN=new t(NaN,NaN,NaN,NaN)}]),t}(),ne=function(){function t(t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}r(t,"laya.d3.math.Rand");var e=t.prototype;return e.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},e.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},e.getSignedFloat=function(){return 2*this.getFloat()-1},s(0,e,"seed",(function(){return this.seeds[0]}),(function(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1})),t.getFloatFromInt=function(t){return 1/8388607*(8388607&t)},t.getByteFromInt=function(t){return(8388607&t)>>>15},t}(),re=(function(){function t(t){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(t instanceof Array)||4!==t.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|t[0],this._state0L=0|t[1],this._state1U=0|t[2],this._state1L=0|t[3]}r(t,"laya.d3.math.RandX");var e=t.prototype;e.randomint=function(){var t=this._state0U,e=this._state0L,i=this._state1U,n=this._state1L,r=(n>>>0)+(e>>>0),s=i+t+(r/2>>>31)>>>0,a=r>>>0,o=0,h=0;return o=(t^=o=t<<23|(-512&e)>>>9)^(this._state0U=i),h=(e^=h=e<<23)^(this._state0L=n),o^=t>>>18,h^=e>>>18|(262143&t)<<14,o^=i>>>5,h^=n>>>5|(31&i)<<27,this._state1U=o,this._state1L=h,[s,a]},e.random=function(){var e=this.randomint(),i=e[0],n=1023<<20|i>>>12,r=e[1]>>>12|(4095&i)<<20|0;return t._CONVERTION_BUFFER.setUint32(0,n,!1),t._CONVERTION_BUFFER.setUint32(4,r,!1),ne._CONVERTION_BUFFER.getFloat64(0,!1)-1},n(t,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new ne([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function t(t,e){this.origin=null,this.direction=null,this.origin=t,this.direction=e}return r(t,"laya.d3.math.Ray"),t}()),se=function(){function t(t,e){this.elements=new Float32Array(2),void 0===t&&(t=0),void 0===e&&(e=0);var i=this.elements;i[0]=t,i[1]=e}r(t,"laya.d3.math.Vector2");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,e,"x",(function(){return this.elements[0]}),(function(t){this.elements[0]=t})),s(0,e,"y",(function(){return this.elements[1]}),(function(t){this.elements[1]=t})),t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e},n(t,["ZERO",function(){return this.ZERO=new t(0,0)},"ONE",function(){return this.ONE=new t(1,1)}]),t}(),ae=function(){function t(t,e,i){this.elements=new Float32Array(3),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this.elements;n[0]=t,n[1]=e,n[2]=i}r(t,"laya.d3.math.Vector3");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},e.reset=function(t,e,i){this.elements[0]=t,this.elements[1]=e,this.elements[2]=i},s(0,e,"x",(function(){return this.elements[0]}),(function(t){this.elements[0]=t})),s(0,e,"y",(function(){return this.elements[1]}),(function(t){this.elements[1]=t})),s(0,e,"z",(function(){return this.elements[2]}),(function(t){this.elements[2]=t})),t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2];return r*r+s*s+a*a},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2];return Math.sqrt(r*r+s*s+a*a)},t.min=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.min(r[0],s[0]),n[1]=Math.min(r[1],s[1]),n[2]=Math.min(r[2],s[2])},t.max=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.max(r[0],s[0]),n[1]=Math.max(r[1],s[1]),n[2]=Math.max(r[2],s[2])},t.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements,a=r[0],o=r[1],h=r[2],l=s[0],c=s[1],u=s[2],d=s[3],_=d*a+c*h-u*o,f=d*o+u*a-l*h,p=d*h+l*o-c*a,m=-l*a-c*o-u*h;n[0]=_*d+m*-l+f*-u-p*-c,n[1]=f*d+m*-c+p*-l-_*-u,n[2]=p*d+m*-u+_*-c-f*-l},t.scalarLength=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return Math.sqrt(i*i+n*n+r*r)},t.scalarLengthSquared=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return i*i+n*n+r*r},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=i[0],s=i[1],a=i[2],o=r*r+s*s+a*a;0<o&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]*s[0],n[1]=r[1]*s[1],n[2]=r[2]*s[2]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e},t.lerp=function(t,e,i,n){var r=n.elements,s=t.elements,a=e.elements,o=s[0],h=s[1],l=s[2];r[0]=o+i*(a[0]-o),r[1]=h+i*(a[1]-h),r[2]=l+i*(a[2]-l)},t.transformV3ToV3=function(e,i,n){var r=t._tempVector4;t.transformV3ToV4(e,i,r);var s=r.elements,a=n.elements;a[0]=s[0],a[1]=s[1],a[2]=s[2]},t.transformV3ToV4=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=e.elements,h=i.elements;h[0]=r*o[0]+s*o[4]+a*o[8]+o[12],h[1]=r*o[1]+s*o[5]+a*o[9]+o[13],h[2]=r*o[2]+s*o[6]+a*o[10]+o[14],h[3]=r*o[3]+s*o[7]+a*o[11]+o[15]},t.TransformNormal=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=e.elements,h=i.elements;h[0]=r*o[0]+s*o[4]+a*o[8],h[1]=r*o[1]+s*o[5]+a*o[9],h[2]=r*o[2]+s*o[6]+a*o[10]},t.transformCoordinate=function(e,i,n){var r=t._tempVector4.elements,s=e.elements,a=s[0],o=s[1],h=s[2],l=i.elements;r[0]=a*l[0]+o*l[4]+h*l[8]+l[12],r[1]=a*l[1]+o*l[5]+h*l[9]+l[13],r[2]=a*l[2]+o*l[6]+h*l[10]+l[14],r[3]=1/(a*l[3]+o*l[7]+h*l[11]+l[15]);var c=n.elements;c[0]=r[0]*r[3],c[1]=r[1]*r[3],c[2]=r[2]*r[3]},t.Clamp=function(t,e,i,n){var r=t.elements,s=r[0],a=r[1],o=r[2],h=e.elements,l=h[0],c=h[1],u=h[2],d=i.elements,_=d[0],f=d[1],p=d[2],m=n.elements;s=(s=_<s?_:s)<l?l:s,a=(a=f<a?f:a)<c?c:a,o=(o=p<o?p:o)<u?u:o,m[0]=s,m[1]=a,m[2]=o},t.add=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]-s[0],n[1]=r[1]-s[1],n[2]=r[2]-s[2]},t.cross=function(t,e,i){var n=t.elements,r=e.elements,s=i.elements,a=n[0],o=n[1],h=n[2],l=r[0],c=r[1],u=r[2];s[0]=o*u-h*c,s[1]=h*l-a*u,s[2]=a*c-o*l},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]},t.equals=function(t,e){var i=t.elements,n=e.elements;return Jt.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&Jt.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&Jt.nearEqual(Math.abs(i[2]),Math.abs(n[2]))},t.ZERO=new t(0,0,0),t.ONE=new t(1,1,1),t.NegativeUnitX=new t(-1,0,0),t.UnitX=new t(1,0,0),t.UnitY=new t(0,1,0),t.UnitZ=new t(0,0,1),t.ForwardRH=new t(0,0,-1),t.ForwardLH=new t(0,0,1),t.Up=new t(0,1,0),t.NAN=new t(NaN,NaN,NaN),n(t,["_tempVector4",function(){return this._tempVector4=new oe}]),t}(),oe=function(){function t(t,e,i,n){this.elements=new Float32Array(4),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.elements;r[0]=t,r[1]=e,r[2]=i,r[3]=n}r(t,"laya.d3.math.Vector4");var e=t.prototype;return i.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},s(0,e,"x",(function(){return this.elements[0]}),(function(t){this.elements[0]=t})),s(0,e,"y",(function(){return this.elements[1]}),(function(t){this.elements[1]=t})),s(0,e,"z",(function(){return this.elements[2]}),(function(t){this.elements[2]=t})),s(0,e,"w",(function(){return this.elements[3]}),(function(t){this.elements[3]=t})),t.lerp=function(t,e,i,n){var r=n.elements,s=t.elements,a=e.elements,o=s[0],h=s[1],l=s[2],c=s[3];r[0]=o+i*(a[0]-o),r[1]=h+i*(a[1]-h),r[2]=l+i*(a[2]-l),r[3]=c+i*(a[3]-c)},t.transformByM4x4=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=n[3],h=e.elements,l=i.elements;l[0]=r*h[0]+s*h[4]+a*h[8]+o*h[12],l[1]=r*h[1]+s*h[5]+a*h[9]+o*h[13],l[2]=r*h[2]+s*h[6]+a*h[10]+o*h[14],l[3]=r*h[3]+s*h[7]+a*h[11]+o*h[15]},t.equals=function(t,e){var i=t.elements,n=e.elements;return Jt.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&Jt.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&Jt.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&Jt.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=t.length();0<r&&(n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=i[3]*r)},t.add=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2],n[3]=r[3]+s[3]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]-s[0],n[1]=r[1]-s[1],n[2]=r[2]-s[2],n[3]=r[3]-s[3]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]*s[0],n[1]=r[1]*s[1],n[2]=r[2]*s[2],n[3]=r[3]*s[3]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e},t.Clamp=function(t,e,i,n){var r=t.elements,s=r[0],a=r[1],o=r[2],h=r[3],l=e.elements,c=l[0],u=l[1],d=l[2],_=l[3],f=i.elements,p=f[0],m=f[1],g=f[2],v=f[3],y=n.elements;s=(s=p<s?p:s)<c?c:s,a=(a=m<a?m:a)<u?u:a,o=(o=g<o?g:o)<d?d:o,h=(h=v<h?v:h)<_?_:h,y[0]=s,y[1]=a,y[2]=o,y[3]=h},t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2],o=i[3]-n[3];return r*r+s*s+a*a+o*o},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(r*r+s*s+a*a+o*o)},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.min=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.min(r[0],s[0]),n[1]=Math.min(r[1],s[1]),n[2]=Math.min(r[2],s[2]),n[3]=Math.min(r[3],s[3])},t.max=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.max(r[0],s[0]),n[1]=Math.max(r[1],s[1]),n[2]=Math.max(r[2],s[2]),n[3]=Math.max(r[3],s[3])},n(t,["ZERO",function(){return this.ZERO=new t},"ONE",function(){return this.ONE=new t(1,1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1,0)},"UnitW",function(){return this.UnitW=new t(0,0,0,1)}]),t}(),he=function(){function t(t,e,i,n){this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=n}r(t,"laya.d3.math.Viewport");var e=t.prototype;return e.project=function(t,e,i){ae.transformV3ToV3(t,e,i);var n=t.elements,r=e.elements,s=i.elements,a=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+r[15];1!==a&&(s[0]=s[0]/a,s[1]=s[1]/a,s[2]=s[2]/a),s[0]=.5*(s[0]+1)*this.width+this.x,s[1]=.5*(1-s[1])*this.height+this.y,s[2]=s[2]*(this.maxDepth-this.minDepth)+this.minDepth},e.unprojectFromMat=function(t,e,i){var n=t.elements,r=e.elements,s=i.elements;s[0]=(n[0]-this.x)/this.width*2-1,s[1]=-((n[1]-this.y)/this.height*2-1);var a=(this.maxDepth-this.minDepth)/2;s[2]=(n[2]-this.minDepth-a)/a;var o=s[0]*r[3]+s[1]*r[7]+s[2]*r[11]+r[15];ae.transformV3ToV3(i,e,i),1!==o&&(s[0]=s[0]/o,s[1]=s[1]/o,s[2]=s[2]/o)},e.unprojectFromWVP=function(e,i,n,r,s){te.multiply(i,n,t._tempMatrix4x4),r&&te.multiply(t._tempMatrix4x4,r,t._tempMatrix4x4),t._tempMatrix4x4.invert(t._tempMatrix4x4),this.unprojectFromMat(e,t._tempMatrix4x4,s)},n(t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new te}]),t}(),le=function(){function t(t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}r(t,"laya.d3.resource.models.SubMesh");var e=t.prototype;return i.imps(e,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),e._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getStaticBatchBakedVertexs=function(e,i){var n,r,s=this._vertexBuffer,a=s.vertexDeclaration,o=a.getVertexElementByUsage(0).offset/4,h=a.getVertexElementByUsage(3).offset/4,l=i.meshRender.lightmapScaleOffset,c=0,u=0,d=0,_=0,f=0,p=0;if(l)if(r=a.getVertexElementByUsage(15))d=a.vertexStride/4,n=0<this._vertexCount?s.getData().slice(this._vertexStart*d,(this._vertexStart+this._vertexCount)*d):s.getData().slice(),_=r.offset/4;else{d=2+(p=a.vertexStride/4),n=this._vertexCount?new Float32Array(this._vertexCount*(s.vertexDeclaration.vertexStride/4+2)):new Float32Array(s.vertexCount*(s.vertexDeclaration.vertexStride/4+2)),_=2+(f=a.getVertexElementByUsage(2).offset/4);var m=s.getData();for(c=0,u=m.length/p;c<u;c++){var g;g=0<this._vertexCount?(this._vertexStart+c)*p:c*p;var v=c*d,y=0;for(y=0;y<_;y++)n[v+y]=m[g+y];for(y=_;y<p;y++)n[v+y+2]=m[g+y]}}else d=a.vertexStride/4,n=this._vertexCount?s.getData().slice(this._vertexStart*d,(this._vertexStart+this._vertexCount)*d):s.getData().slice();if(e){var x=e.worldMatrix,w=t._tempMatrix4x40;x.invert(w);var b=t._tempMatrix4x41,S=i.transform.worldMatrix;te.multiply(w,S,b)}else b=i.transform.worldMatrix;var T=t._tempQuaternion0;for(b.decomposeTransRotScale(t._tempVector30,T,t._tempVector31),c=0,u=n.length/d;c<u;c++){var C=c*d+o,M=c*d+h;if(me.transformVector3ArrayToVector3ArrayCoordinate(n,C,b,n,C),me.transformVector3ArrayByQuat(n,M,T,n,M),l){var I=c*d+_;if(r)me.transformLightingMapTexcoordByUV1Array(n,I,l,n,I);else{var E=c*p+f;me.transformLightingMapTexcoordByUV0Array(m,E,l,n,I)}}}return n},e._getVertexBuffers=function(){return null},e._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},e._render=function(t){var e,i=0,n=t.renderElement;if(1<this._indexCount){var r=this._boneIndicesList.length;if(1<r){for(var s=0;s<r;s++)(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[s]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),D.mainContext.drawElements(4,this._subIndexBufferCount[s],5123,2*this._subIndexBufferStart[s]);M.drawCall+=r}else(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),D.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),M.drawCall++;i=this._indexCount}else i=this._indexBuffer.indexCount,(e=n._skinAnimationDatas||this._skinAnimationDatas)&&(n._shaderValue.setValue(0,e[0]),t._shader.uploadRenderElementUniforms(n._shaderValue.data)),D.mainContext.drawElements(4,i,5123,0),M.drawCall++;M.trianglesFaces+=i/3},e.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},e.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},s(0,e,"_vertexBufferCount",(function(){return 1})),s(0,e,"triangleCount",(function(){return this._indexBuffer.indexCount/3})),n(t,["_tempVector30",function(){return this._tempVector30=new ae},"_tempVector31",function(){return this._tempVector31=new ae},"_tempQuaternion0",function(){return this._tempQuaternion0=new ie},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new te},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new te}]),t}(),ce=function(){function t(t){this.defineCounter=0,this.defines=null,t?(this.defineCounter=t.defineCounter,this.defines=t.defines.slice()):(this.defineCounter=0,this.defines=[])}return r(t,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),t.prototype.registerDefine=function(t){var e=Math.pow(2,this.defineCounter++);return this.defines[e]=t,e},t}(),ue=function(){function t(){}return r(t,"laya.d3.shader.ShaderInit3D"),t.__init__=function(){var t,e;Te._globalRegDefine("HIGHPRECISION",Te.SHADERDEFINE_HIGHPRECISION),Te._globalRegDefine("FOG",Te.SHADERDEFINE_FOG),Te._globalRegDefine("DIRECTIONLIGHT",Te.SHADERDEFINE_DIRECTIONLIGHT),Te._globalRegDefine("POINTLIGHT",Te.SHADERDEFINE_POINTLIGHT),Te._globalRegDefine("SPOTLIGHT",Te.SHADERDEFINE_SPOTLIGHT),Te._globalRegDefine("UV",Te.SHADERDEFINE_UV0),Te._globalRegDefine("COLOR",Te.SHADERDEFINE_COLOR),Te._globalRegDefine("UV1",Te.SHADERDEFINE_UV1),Te._globalRegDefine("CASTSHADOW",_e.SHADERDEFINE_CAST_SHADOW),Te._globalRegDefine("SHADOWMAP_PSSM1",_e.SHADERDEFINE_SHADOW_PSSM1),Te._globalRegDefine("SHADOWMAP_PSSM2",_e.SHADERDEFINE_SHADOW_PSSM2),Te._globalRegDefine("SHADOWMAP_PSSM3",_e.SHADERDEFINE_SHADOW_PSSM3),Te._globalRegDefine("SHADOWMAP_PCF_NO",_e.SHADERDEFINE_SHADOW_PCF_NO),Te._globalRegDefine("SHADOWMAP_PCF1",_e.SHADERDEFINE_SHADOW_PCF1),Te._globalRegDefine("SHADOWMAP_PCF2",_e.SHADERDEFINE_SHADOW_PCF2),Te._globalRegDefine("SHADOWMAP_PCF3",_e.SHADERDEFINE_SHADOW_PCF3),Te._globalRegDefine("DEPTHFOG",Te.SAHDERDEFINE_DEPTHFOG),Be.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),Be.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),t={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},e={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var i=Be.nameKey.add("SIMPLE"),n=Te.add(i,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',t,e);Oe.SHADERDEFINE_DIFFUSEMAP=n.registerMaterialDefine("DIFFUSEMAP"),Oe.SHADERDEFINE_NORMALMAP=n.registerMaterialDefine("NORMALMAP"),Oe.SHADERDEFINE_SPECULARMAP=n.registerMaterialDefine("SPECULARMAP"),Oe.SHADERDEFINE_EMISSIVEMAP=n.registerMaterialDefine("EMISSIVEMAP"),Oe.SHADERDEFINE_AMBIENTMAP=n.registerMaterialDefine("AMBIENTMAP"),Oe.SHADERDEFINE_REFLECTMAP=n.registerMaterialDefine("REFLECTMAP"),Oe.SHADERDEFINE_UVTRANSFORM=n.registerMaterialDefine("UVTRANSFORM"),Oe.SHADERDEFINE_TILINGOFFSET=n.registerMaterialDefine("TILINGOFFSET"),Oe.SHADERDEFINE_ADDTIVEFOG=n.registerMaterialDefine("ADDTIVEFOG")},t}(),de=function(){function t(){this._data=null,this._data=[]}r(t,"laya.d3.shader.ValusArray");var e=t.prototype;return e.setValue=function(t,e){this._data[t]=e},s(0,e,"data",(function(){return this._data})),t}(),_e=function(){function t(){}return t.SHADERDEFINE_RECEIVE_SHADOW=1,t.SHADERDEFINE_CAST_SHADOW=512,t.SHADERDEFINE_SHADOW_PSSM1=1024,t.SHADERDEFINE_SHADOW_PSSM2=2048,t.SHADERDEFINE_SHADOW_PSSM3=4096,t.SHADERDEFINE_SHADOW_PCF_NO=8192,t.SHADERDEFINE_SHADOW_PCF1=16384,t.SHADERDEFINE_SHADOW_PCF2=32768,t.SHADERDEFINE_SHADOW_PCF3=65536,t.MAX_PSSM_COUNT=3,t}(),fe=function(){function t(){}return r(t,"laya.d3.utils.Picker"),t.calculateCursorRay=function(e,i,n,r,s,a){var o=e.elements[0],h=e.elements[1],l=t._tempVector30,c=l.elements;c[0]=o,c[1]=h,c[2]=i.minDepth;var u=t._tempVector31,d=u.elements;d[0]=o,d[1]=h,d[2]=i.maxDepth;var _=a.origin,f=t._tempVector32;i.unprojectFromWVP(l,n,r,s,_),i.unprojectFromWVP(u,n,r,s,f);var p=a.direction.elements;p[0]=f.x-_.x,p[1]=f.y-_.y,p[2]=f.z-_.z,ae.normalize(a.direction,a.direction)},t.rayIntersectsPositionsAndIndices=function(e,i,n,r,s){for(var a=n.vertexStride/4,o=n.getVertexElementByUsage(0).offset/4,h=Number.MAX_VALUE,l=-1,c=-1,u=-1,d=0;d<r.length;d+=3){var _=t._tempVector35,f=_.elements,p=r[d]*a,m=p+o;f[0]=i[m],f[1]=i[1+m],f[2]=i[2+m];var g=t._tempVector36,v=g.elements,y=r[d+1]*a,x=y+o;v[0]=i[x],v[1]=i[1+x],v[2]=i[2+x];var w=t._tempVector37,b=w.elements,S=r[d+2]*a,T=S+o;b[0]=i[T],b[1]=i[1+T],b[2]=i[2+T];var C=laya.d3.utils.Picker.rayIntersectsTriangle(e,_,g,w);!isNaN(C)&&C<h&&(h=C,l=p,c=y,u=S)}if(h===Number.MAX_VALUE)return s.position.toDefault(),s.distance=Number.MAX_VALUE,s.trianglePositions[0].toDefault(),s.trianglePositions[1].toDefault(),s.trianglePositions[2].toDefault(),s.triangleNormals[0].toDefault(),s.triangleNormals[1].toDefault(),s.triangleNormals[2].toDefault(),!1;s.distance=h,ae.scale(e.direction,h,s.position),ae.add(e.origin,s.position,s.position);var M=s.trianglePositions,I=M[0],E=M[1],A=M[2],D=I.elements,P=E.elements,R=A.elements,N=l+o;D[0]=i[N],D[1]=i[N+1],D[2]=i[N+2];var L=c+o;P[0]=i[L],P[1]=i[L+1],P[2]=i[L+2];var B=u+o;R[0]=i[B],R[1]=i[B+1],R[2]=i[B+2];var O=n.getVertexElementByUsage(3);if(O){var F=O.offset/4,k=s.triangleNormals,V=k[0],U=k[1],H=k[2],z=V.elements,W=U.elements,G=H.elements,Y=l+F;z[0]=i[Y],z[1]=i[Y+1],z[2]=i[Y+2];var X=c+F;W[0]=i[X],W[1]=i[X+1],W[2]=i[X+2];var j=u+F;G[0]=i[j],G[1]=i[j+1],G[2]=i[j+2]}return!0},t.rayIntersectsTriangle=function(e,i,n,r){var s=t._tempVector30,a=t._tempVector31;ae.subtract(n,i,s),ae.subtract(r,i,a);var o,h=t._tempVector32;if(ae.cross(e.direction,a,h),(o=ae.dot(s,h))>-Number.MIN_VALUE&&o<Number.MIN_VALUE)return Number.NaN;var l,c=1/o,u=t._tempVector33;if(ae.subtract(e.origin,i,u),l=ae.dot(u,h),(l*=c)<0||1<l)return Number.NaN;var d,_,f=t._tempVector34;return ae.cross(u,s,f),d=ae.dot(e.direction,f),(d*=c)<0||1<l+d?Number.NaN:(_=ae.dot(a,f),(_*=c)<0?Number.NaN:_)},n(t,["_tempVector30",function(){return this._tempVector30=new ae},"_tempVector31",function(){return this._tempVector31=new ae},"_tempVector32",function(){return this._tempVector32=new ae},"_tempVector33",function(){return this._tempVector33=new ae},"_tempVector34",function(){return this._tempVector34=new ae},"_tempVector35",function(){return this._tempVector35=new ae},"_tempVector36",function(){return this._tempVector36=new ae},"_tempVector37",function(){return this._tempVector37=new ae}]),t}(),pe=(function(){function t(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new ae,new ae,new ae],this.trianglePositions.length=3,this.triangleNormals=[new ae,new ae,new ae],this.triangleNormals.length=3,this.position=new ae}r(t,"laya.d3.utils.RaycastHit"),t.prototype.cloneTo=function(t){t.distance=this.distance,this.trianglePositions[0].cloneTo(t.trianglePositions[0]),this.trianglePositions[1].cloneTo(t.trianglePositions[1]),this.trianglePositions[2].cloneTo(t.trianglePositions[2]),this.triangleNormals[0].cloneTo(t.triangleNormals[0]),this.triangleNormals[1].cloneTo(t.triangleNormals[1]),this.triangleNormals[2].cloneTo(t.triangleNormals[2]),this.position.cloneTo(t.position),t.sprite3D=this.sprite3D}}(),function(){function t(t,e){this._width=0,this._height=0,this._width=t,this._height=e}r(t,"laya.d3.utils.Size");var e=t.prototype;return s(0,e,"width",(function(){return-1===this._width?K.clientWidth:this._width})),s(0,e,"height",(function(){return-1===this._height?K.clientHeight:this._height})),s(1,t,"fullScreen",(function(){return new t(-1,-1)})),t}()),me=function(){function t(){}return r(t,"laya.d3.utils.Utils3D"),t._rotationTransformScaleSkinAnimation=function(e,i,n,r,s,a,o,h,l,c,u,d){var _,f,p,m,g,v=t._tempArray16_0,y=t._tempArray16_1,x=t._tempArray16_2,w=r+r,b=s+s,S=a+a,T=r*w,C=s*w,M=s*b,I=a*w,E=a*b,A=a*S,D=o*w,P=o*b,R=o*S;for(v[15]=1,v[0]=1-M-A,v[1]=C+R,v[2]=I-P,v[4]=C-R,v[5]=1-T-A,v[6]=E+D,v[8]=I+P,v[9]=E-D,v[10]=1-T-M,y[15]=1,y[0]=h,y[5]=l,y[10]=c,_=0;_<4;_++)f=v[_],p=v[_+4],m=v[_+8],g=v[_+12],x[_]=f,x[_+4]=p,x[_+8]=m,x[_+12]=f*e+p*i+m*n+g;for(_=0;_<4;_++)f=x[_],p=x[_+4],m=x[_+8],g=x[_+12],u[_+d]=f*y[0]+p*y[1]+m*y[2]+g*y[3],u[_+d+4]=f*y[4]+p*y[5]+m*y[6]+g*y[7],u[_+d+8]=f*y[8]+p*y[9]+m*y[10]+g*y[11],u[_+d+12]=f*y[12]+p*y[13]+m*y[14]+g*y[15]},t._createNodeByJson=function(e,i,n,r){if(!n)switch(i.type){case"Sprite3D":n=new Le;break;case"MeshSprite3D":n=new je;break;case"SkinnedMeshSprite3D":n=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":n=new ShuriKenParticle3D;break;case"TrailSprite3D":n=new TrailSprite3D;break;case"Terrain":n=new Terrain;break;case"Camera":n=new Xe;break;case"DirectionLight":n=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var s=i.props;if(s)for(var a in s)n[a]=s[a];var o=i.customProps;o&&(n instanceof laya.d3.core.Sprite3D?(n._parseBaseCustomProps(o),n._parseCustomProps(e,r,o,i),n._parseCustomComponent(e,r,i.components)):n._parseCustomProps(e,r,o,i));var h=i.child;if(h)for(var l=0,c=h.length;l<c;l++){var u=t._createNodeByJson(e,h[l],null,r);n.addChild(u)}return n},t._computeBoneAndAnimationDatasByBindPoseMatrxix=function(t,e,i,n,r,s){var a,o,h=0,l=0,c=t.length;for(a=0;a<c;h+=t[a].keyframeWidth,l+=16,a++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[h+0],e[h+1],e[h+2],e[h+3],e[h+4],e[h+5],e[h+6],e[h+7],e[h+8],e[h+9],n,l),0!=a&&(o=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,l,n,l));var u=i.length;for(a=0;a<u;a++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*s[a],i[a],r,16*a)},t._computeAnimationDatasByArrayAndMatrixFast=function(t,e,i,n){for(var r=0,s=t.length;r<s;r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,16*n[r],t[r],i,16*r)},t._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(t,e,i,n,r){var s,a,o=0,h=0,l=t.length;for(s=0;s<l;o+=t[s].keyframeWidth,h+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],n,h),0!=s&&(a=16*t[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,a,n,h,n,h));var c=i.length;for(s=0;s<c;s++){var u=16*s;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,u,i[s],r,u)}},t._computeAnimationDatasByArrayAndMatrixFastOld=function(t,e,i){for(var n=t.length,r=0;r<n;r++){var s=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,s,t[r],i,s)}},t._computeRootAnimationData=function(t,e,i){for(var n=0,r=0,s=0,a=t.length;n<a;r+=t[n].keyframeWidth,s+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,s)},t.transformVector3ArrayByQuat=function(t,e,i,n,r){var s=i.elements,a=t[e],o=t[e+1],h=t[e+2],l=s[0],c=s[1],u=s[2],d=s[3],_=d*a+c*h-u*o,f=d*o+u*a-l*h,p=d*h+l*o-c*a,m=-l*a-c*o-u*h;n[r]=_*d+m*-l+f*-u-p*-c,n[r+1]=f*d+m*-c+p*-l-_*-u,n[r+2]=p*d+m*-u+_*-c-f*-l},t.mulMatrixByArray=function(e,i,n,r,s,a){var o,h,l,c,u;if(s===n){for(n=t._tempArray16_3,o=0;o<16;++o)n[o]=s[a+o];r=0}for(o=0;o<4;o++)h=e[i+o],l=e[i+o+4],c=e[i+o+8],u=e[i+o+12],s[a+o]=h*n[r+0]+l*n[r+1]+c*n[r+2]+u*n[r+3],s[a+o+4]=h*n[r+4]+l*n[r+5]+c*n[r+6]+u*n[r+7],s[a+o+8]=h*n[r+8]+l*n[r+9]+c*n[r+10]+u*n[r+11],s[a+o+12]=h*n[r+12]+l*n[r+13]+c*n[r+14]+u*n[r+15]},t.mulMatrixByArrayFast=function(t,e,i,n,r,s){var a,o,h,l,c;for(a=0;a<4;a++)o=t[e+a],h=t[e+a+4],l=t[e+a+8],c=t[e+a+12],r[s+a]=o*i[n+0]+h*i[n+1]+l*i[n+2]+c*i[n+3],r[s+a+4]=o*i[n+4]+h*i[n+5]+l*i[n+6]+c*i[n+7],r[s+a+8]=o*i[n+8]+h*i[n+9]+l*i[n+10]+c*i[n+11],r[s+a+12]=o*i[n+12]+h*i[n+13]+l*i[n+14]+c*i[n+15]},t.mulMatrixByArrayAndMatrixFast=function(t,e,i,n,r){var s,a,o,h,l,c=i.elements,u=c[0],d=c[1],_=c[2],f=c[3],p=c[4],m=c[5],g=c[6],v=c[7],y=c[8],x=c[9],w=c[10],b=c[11],S=c[12],T=c[13],C=c[14],M=c[15],I=e,E=e+4,A=e+8,D=e+12,P=r,R=r+4,N=r+8,L=r+12;for(s=0;s<4;s++)a=t[I+s],o=t[E+s],h=t[A+s],l=t[D+s],n[P+s]=a*u+o*d+h*_+l*f,n[R+s]=a*p+o*m+h*g+l*v,n[N+s]=a*y+o*x+h*w+l*b,n[L+s]=a*S+o*T+h*C+l*M},t.createAffineTransformationArray=function(t,e,i,n,r,s,a,o,h,l,c,u){var d=n+n,_=r+r,f=s+s,p=n*d,m=n*_,g=n*f,v=r*_,y=r*f,x=s*f,w=a*d,b=a*_,S=a*f;c[u+0]=(1-(v+x))*o,c[u+1]=(m+S)*o,c[u+2]=(g-b)*o,c[u+3]=0,c[u+4]=(m-S)*h,c[u+5]=(1-(p+x))*h,c[u+6]=(y+w)*h,c[u+7]=0,c[u+8]=(g+b)*l,c[u+9]=(y-w)*l,c[u+10]=(1-(p+v))*l,c[u+11]=0,c[u+12]=t,c[u+13]=e,c[u+14]=i,c[u+15]=1},t.transformVector3ArrayToVector3ArrayCoordinate=function(e,i,n,r,s){var a=t._tempArray4_0,o=e[i+0],h=e[i+1],l=e[i+2],c=n.elements;a[0]=o*c[0]+h*c[4]+l*c[8]+c[12],a[1]=o*c[1]+h*c[5]+l*c[9]+c[13],a[2]=o*c[2]+h*c[6]+l*c[10]+c[14],a[3]=1/(o*c[3]+h*c[7]+l*c[11]+c[15]),r[s+0]=a[0]*a[3],r[s+1]=a[1]*a[3],r[s+2]=a[2]*a[3]},t.transformLightingMapTexcoordByUV0Array=function(t,e,i,n,r){var s=i.elements;n[r+0]=t[e+0]*s[0]+s[2],n[r+1]=(t[e+1]-1)*s[1]+s[3]},t.transformLightingMapTexcoordByUV1Array=function(t,e,i,n,r){var s=i.elements;n[r+0]=t[e+0]*s[0]+s[2],n[r+1]=1+t[e+1]*s[1]+s[3]},t.getURLVerion=function(t){var e=t.indexOf("?");return 0<=e?t.substr(e):null},t._quaternionCreateFromYawPitchRollArray=function(t,e,i,n){var r=.5*i,s=.5*e,a=.5*t,o=Math.sin(r),h=Math.cos(r),l=Math.sin(s),c=Math.cos(s),u=Math.sin(a),d=Math.cos(a);n[0]=d*l*h+u*c*o,n[1]=u*c*h-d*l*o,n[2]=d*c*o-u*l*h,n[3]=d*c*h+u*l*o},t._createAffineTransformationArray=function(t,e,i,n){var r=e[0],s=e[1],a=e[2],o=e[3],h=r+r,l=s+s,c=a+a,u=r*h,d=r*l,_=r*c,f=s*l,p=s*c,m=a*c,g=o*h,v=o*l,y=o*c,x=i[0],w=i[1],b=i[2];n[0]=(1-(f+m))*x,n[1]=(d+y)*x,n[2]=(_-v)*x,n[3]=0,n[4]=(d-y)*w,n[5]=(1-(u+m))*w,n[6]=(p+g)*w,n[7]=0,n[8]=(_+v)*b,n[9]=(p-g)*b,n[10]=(1-(u+f))*b,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1},t._mulMatrixArray=function(t,e,i,n){var r,s,a,o,h,l=e.elements,c=l[0],u=l[1],d=l[2],_=l[3],f=l[4],p=l[5],m=l[6],g=l[7],v=l[8],y=l[9],x=l[10],w=l[11],b=l[12],S=l[13],T=l[14],C=l[15],M=n,I=n+4,E=n+8,A=n+12;for(r=0;r<4;r++)s=t[r],a=t[r+4],o=t[r+8],h=t[r+12],i[M+r]=s*c+a*u+o*d+h*_,i[I+r]=s*f+a*p+o*m+h*g,i[E+r]=s*v+a*y+o*x+h*w,i[A+r]=s*b+a*S+o*T+h*C},t.getYawPitchRoll=function(e,i){t.transformQuat(ae.ForwardRH,e,ie.TEMPVector31),t.transformQuat(ae.Up,e,ie.TEMPVector32);var n=ie.TEMPVector32.elements;t.angleTo(ae.ZERO,ie.TEMPVector31,ie.TEMPVector33);var r=ie.TEMPVector33.elements;r[0]==Math.PI/2?(r[1]=t.arcTanAngle(n[2],n[0]),r[2]=0):r[0]==-Math.PI/2?(r[1]=t.arcTanAngle(-n[2],-n[0]),r[2]=0):(te.createRotationY(-r[1],ie.TEMPMatrix0),te.createRotationX(-r[0],ie.TEMPMatrix1),ae.transformCoordinate(ie.TEMPVector32,ie.TEMPMatrix0,ie.TEMPVector32),ae.transformCoordinate(ie.TEMPVector32,ie.TEMPMatrix1,ie.TEMPVector32),r[2]=t.arcTanAngle(n[1],-n[0])),r[1]<=-Math.PI&&(r[1]=Math.PI),r[2]<=-Math.PI&&(r[2]=Math.PI),r[1]>=Math.PI&&r[2]>=Math.PI&&(r[1]=0,r[2]=0,r[0]=Math.PI-r[0]),i[0]=r[1],i[1]=r[0],i[2]=r[2]},t.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},t.angleTo=function(e,i,n){ae.subtract(i,e,ie.TEMPVector30),ae.normalize(ie.TEMPVector30,ie.TEMPVector30),n.elements[0]=Math.asin(ie.TEMPVector30.y),n.elements[1]=t.arcTanAngle(-ie.TEMPVector30.z,-ie.TEMPVector30.x)},t.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,s=e,a=r[0],o=r[1],h=r[2],l=s[0],c=s[1],u=s[2],d=s[3],_=d*a+c*h-u*o,f=d*o+u*a-l*h,p=d*h+l*o-c*a,m=-l*a-c*o-u*h;n[0]=_*d+m*-l+f*-u-p*-c,n[1]=f*d+m*-c+p*-l-_*-u,n[2]=p*d+m*-u+_*-c-f*-l},t.quaterionNormalize=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=i*i+n*n+r*r+s*s;0<a&&(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=s*a)},t.matrix4x4MultiplyFFF=function(t,e,i){var n,r,s,a,o;if(i===e)for(e=new Float32Array(16),n=0;n<16;++n)e[n]=i[n];for(n=0;n<4;n++)r=t[n],s=t[n+4],a=t[n+8],o=t[n+12],i[n]=r*e[0]+s*e[1]+a*e[2]+o*e[3],i[n+4]=r*e[4]+s*e[5]+a*e[6]+o*e[7],i[n+8]=r*e[8]+s*e[9]+a*e[10]+o*e[11],i[n+12]=r*e[12]+s*e[13]+a*e[14]+o*e[15]},t.matrix4x4MultiplyMFM=function(e,i,n){t.matrix4x4MultiplyFFF(e.elements,i,n.elements)},n(t,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new ae},"_tempVector3_1",function(){return this._tempVector3_1=new ae},"_tempVector3_2",function(){return this._tempVector3_2=new ae},"_tempVector3_3",function(){return this._tempVector3_3=new ae},"_tempVector3_4",function(){return this._tempVector3_4=new ae},"_tempVector3_5",function(){return this._tempVector3_5=new ae},"_tempVector3_6",function(){return this._tempVector3_6=new ae},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),t}(),ge=function(){function t(){}return r(t,"Laya3D"),t._cancelLoadByUrl=function(e){i.loader.cancelLoadByUrl(e),t._innerFirstLevelLoaderManager.cancelLoadByUrl(e),t._innerSecondLevelLoaderManager.cancelLoadByUrl(e),t._innerThirdLevelLoaderManager.cancelLoadByUrl(e),t._innerFourthLevelLoaderManager.cancelLoadByUrl(e)},t._changeWebGLSize=function(t,e){D.onStageResize(t,e),K.clientWidth=t,K.clientHeight=e},t.__init__=function(){var e=v.createMap;e.lh=[Le,"SPRITE3DHIERARCHY"],e.ls=[Ne,"SPRITE3DHIERARCHY"],e.lm=[He,"MESH"],e.lmat=[Oe,"MATERIAL"],e.jpg=[We,"nativeimage"],e.jpeg=[We,"nativeimage"],e.png=[We,"nativeimage"],e.pkm=[We,"arraybuffer"],e.raw=[Ve,"arraybuffer"],e.mipmaps=[Ve,"arraybuffer"],g.parserMap.SPRITE3DHIERARCHY=t._loadHierarchy,g.parserMap.MESH=t._loadMesh,g.parserMap.MATERIAL=t._loadMaterial,g.parserMap.TEXTURECUBE=t._loadTextureCube,g.parserMap.TERRAIN=t._loadTerrain,t._innerFirstLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerSecondLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerThirdLevelLoaderManager.on("error",null,t._eventLoadManagerError),t._innerFourthLevelLoaderManager.on("error",null,t._eventLoadManagerError)},t.READ_BLOCK=function(){return t._readData.pos+=4,!0},t.READ_DATA=function(){return t._DATA.offset=t._readData.getUint32(),t._DATA.size=t._readData.getUint32(),!0},t.READ_STRINGS=function(){var e=[],i={offset:0,size:0};i.offset=t._readData.getUint16(),i.size=t._readData.getUint16(),t._readData.pos,t._readData.pos=i.offset+t._DATA.offset;for(var n=0;n<i.size;n++){var r=t._readData.readUTFString();-1===r.lastIndexOf(".lmat")&&-1===r.lastIndexOf(".lpbr")||e.push(r)}return e},t.formatRelativePath=function(t,e){var i;if("."===e.charAt(0)){for(var n=(t+e).split("/"),r=0,s=n.length;r<s;r++)if(".."==n[r]){var a=r-1;0<a&&".."!==n[a]&&(n.splice(a,2),r-=2)}i=n.join("/")}else i=t+e;return null!=E.customFormat&&(i=E.customFormat(i,null)),i},t._eventLoadManagerError=function(t){i.loader.event("error",t)},t._addHierarchyInnerUrls=function(e,i,n,r,s,a){var o=t.formatRelativePath(r,s);n&&(o+=n),e.push({url:o,clas:a}),i[s]=o},t._getSprite3DHierarchyInnerUrls=function(e,i,n,r,s,a,o){var h,l=0,u=0;switch(e.type){case"Scene":var d=e.customProps.lightmaps;for(l=0,u=d.length;l<u;l++){var _=d[l].replace(".exr",".png");t._addHierarchyInnerUrls(r,s,a,o,_,We)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var f;if(e.instanceParams)(f=e.instanceParams.loadPath)&&t._addHierarchyInnerUrls(i,s,a,o,f,He);else{(f=(h=e.customProps).meshPath)&&t._addHierarchyInnerUrls(i,s,a,o,f,He);var p=h.materials;if(p)for(l=0,u=p.length;l<u;l++){for(var m=p[l],g=m.type.split("."),v=c.window,y=0,x=g.length;y<x;++y)v=v[this.clasPaths[y]];if("function"!=typeof v)throw"_getSprite3DHierarchyInnerUrls 错误: "+m.type+" 不是类";t._addHierarchyInnerUrls(n,s,a,o,m.path,v)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var w=(h=e.customProps).meshPath;w&&t._addHierarchyInnerUrls(i,s,a,o,w,He);var b=h.material;if(b){for(g=b.type.split("."),v=c.window,y=0,x=g.length;y<x;++y)v=v[this.clasPaths[y]];t._addHierarchyInnerUrls(n,s,a,o,b.path,v)}else{var S=h.materialPath;if(S)t._addHierarchyInnerUrls(n,s,a,o,S,ShurikenParticleMaterial);else{var T=h.texturePath;T&&t._addHierarchyInnerUrls(r,s,a,o,T,We)}}break;case"Terrain":t._addHierarchyInnerUrls(r,s,a,o,e.customProps.dataPath,TerrainRes)}var C=e.components;for(var M in C){var I=C[M];switch(M){case"Animator":var E=I.avatarPath;if(E)t._addHierarchyInnerUrls(r,s,a,o,E,Avatar);else{var A=I.avatar;A&&t._addHierarchyInnerUrls(r,s,a,o,A.path,Avatar)}var D=I.clipPaths;for(l=0,u=D.length;l<u;l++)t._addHierarchyInnerUrls(r,s,a,o,D[l],AnimationClip)}}var P=e.child;for(l=0,u=P.length;l<u;l++)t._getSprite3DHierarchyInnerUrls(P[l],i,n,r,s,a,o)},t._loadHierarchy=function(e){e.on("loaded",null,t._onHierarchylhLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onHierarchylhLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r=e.url,s=me.getURLVerion(r),a=E.getPath(r),o=[],h=[],l=[],c={};t._getSprite3DHierarchyInnerUrls(n,o,h,l,c,s,a);var u=o.length+h.length+l.length,d=u+1,_=1/d;if(t._onProcessChange(e,0,_,1),0<l.length){var f=u/d,p=m.create(null,t._onProcessChange,[e,_,f],!1);t._innerFourthLevelLoaderManager.create(l,m.create(null,t._onHierarchyInnerForthLevResouLoaded,[e,i,p,n,c,o,h,_+f*l.length,f]),p,null,null,1,!0,i)}else t._onHierarchyInnerForthLevResouLoaded(e,i,null,n,c,o,h,_,f)}},t._onHierarchyInnerForthLevResouLoaded=function(e,i,n,r,s,a,o,h,l){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),0<o.length){var c=m.create(null,t._onProcessChange,[e,h,l],!1);t._innerSecondLevelLoaderManager.create(o,m.create(null,t._onHierarchyInnerSecondLevResouLoaded,[e,i,c,r,s,a,h+l*o.length,l]),n,null,null,1,!0,i)}else t._onHierarchyInnerSecondLevResouLoaded(e,i,null,r,s,a,h,l)},t._onHierarchyInnerSecondLevResouLoaded=function(e,i,n,r,s,a,o,h){if(e._class.destroyed)e.endLoad();else if(n&&n.recover(),0<a.length){var l=m.create(null,t._onProcessChange,[e,o,h],!1);t._innerFirstLevelLoaderManager.create(a,m.create(null,t._onHierarchyInnerFirstLevResouLoaded,[e,l,r,s]),n,null,null,1,!0,i)}else t._onHierarchyInnerFirstLevResouLoaded(e,null,r,s)},t._onHierarchyInnerFirstLevResouLoaded=function(t,e,i,n){e&&e.recover(),t.endLoad([i,n])},t._loadTerrain=function(e){e.on("loaded",null,t._onTerrainLtLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onTerrainLtLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,s,a=e.url,o=me.getURLVerion(a),h=E.getPath(a),l=[],c={},u=0,d=0,_=n.heightData;r=_.url,s=t.formatRelativePath(h,r),o&&(s+=o),r=c[r]=s;var f=n.detailTexture;for(u=0,d=f.length;u<d;u++)l.push({url:f[u].diffuse});var p=n.normalMap;for(u=0,d=p.length;u<d;u++)l.push({url:p[u]});var g=n.alphaMap;for(u=0,d=g.length;u<d;u++)l.push({url:g[u],params:[!1,!1,6408,!0]});for(u=0,d=l.length;u<d;u++){var v=l[u].url;s=t.formatRelativePath(h,v),o&&(s+=o),l[u].url=s,c[v]=s}var y=l.length,x=y+2,w=1/x;t._onProcessChange(e,0,w,1);var b={heightMapLoaded:!1,texturesLoaded:!1},S=m.create(null,t._onProcessChange,[e,w,w],!1);t._innerFourthLevelLoaderManager.create(r,m.create(null,t._onTerrainHeightMapLoaded,[e,S,n,c,b]),S,null,[_.numX,_.numZ,_.bitType,_.value],1,!0,i);var T=m.create(null,t._onProcessChange,[e,2*w,y/x],!1);t._innerFourthLevelLoaderManager.create(l,m.create(null,t._onTerrainTexturesLoaded,[e,T,n,c,b]),T,null,null,1,!0,i)}},t._onTerrainHeightMapLoaded=function(t,e,i,n,r){r.heightMapLoaded=!0,r.texturesLoaded&&(t.endLoad([i,n]),e.recover())},t._onTerrainTexturesLoaded=function(t,e,i,n,r){r.texturesLoaded=!0,r.heightMapLoaded&&(t.endLoad([i,n]),e.recover())},t._loadMesh=function(e){e.on("loaded",null,t._onMeshLmLoaded,[e,e._class._getGroup()]),e.load(e.url,"arraybuffer",!1,null,!0)},t._onMeshLmLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,s,a,o=e.url,h=me.getURLVerion(o),l=E.getPath(o),c={},u=0,_=0;switch((t._readData=new d(n)).pos=0,t._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var f=t._readData.getUint32();t._readData.pos=t._readData.pos+4,_=t._readData.getUint16(),t._readData.pos=t._readData.pos+8*_;var p=t._readData.getUint32();for(_=t._readData.getUint16(),t._readData.pos=f+p,r=[],u=0;u<_;u++){var g=t._readData.readUTFString();-1!==g.lastIndexOf(".lmat")&&r.push(g)}break;default:for(t.READ_BLOCK(),u=0;u<2;u++){var v=t._readData.getUint16(),y=t._strings[v],x=t["READ_"+y];if(null==x)throw new Error("model file err,no this function:"+v+" "+y);1===u?r=x.call():x.call()}}for(u=0,a=r.length;u<a;u++){var w=r[u];s=t.formatRelativePath(l,w),h&&(s+=h),r[u]=s,c[w]=s}if(0<r.length){t._onProcessChange(e,0,.5,1);var b=m.create(null,t._onProcessChange,[e,.5,.5],!1);t._innerSecondLevelLoaderManager.create(r,m.create(null,t._onMeshMateialLoaded,[e,b,n,c]),b,null,null,1,!0,i)}else e.endLoad([n,c])}},t._onMeshMateialLoaded=function(t,e,i,n){t.endLoad([i,n]),e.recover()},t._getMaterialTexturePath=function(e,i,n){var r=e.length-4;return e.indexOf(".dds")!=r&&e.indexOf(".tga")!=r&&e.indexOf(".exr")!=r&&e.indexOf(".DDS")!=r&&e.indexOf(".TGA")!=r&&e.indexOf(".EXR")!=r||(e=e.substr(0,r)+".png"),e=t.formatRelativePath(n,e),i&&(e+=i),e},t._loadMaterial=function(e){e.on("loaded",null,t._onMaterilLmatLoaded,[e,e._class._getGroup()]),e.load(e.url,"json",!1,null,!0)},t._onMaterilLmatLoaded=function(e,i,n){if(e._class.destroyed)e.endLoad();else{var r,s=e.url,a=me.getURLVerion(s),o=E.getPath(s),h=[],l={},c=n.customProps,u=n.version;if(u)switch(u){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var d=n.props.textures,_=0,f=d.length;_<f;_++){var p=d[_],g=p.path;if(g){var v=g.length-4;g.indexOf(".exr")!=v&&g.indexOf(".EXR")!=v||(g=g.substr(0,v)+".png"),r=t.formatRelativePath(o,g),a&&(r+=a),h.push({url:r,params:p.params}),l[g]=r}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var y=c.diffuseTexture.texture2D;if(y&&(r=t._getMaterialTexturePath(y,a,o),h.push(r),l[y]=r),c.normalTexture){var x=c.normalTexture.texture2D;x&&(r=t._getMaterialTexturePath(x,a,o),h.push(r),l[x]=r)}if(c.specularTexture){var w=c.specularTexture.texture2D;w&&(r=t._getMaterialTexturePath(w,a,o),h.push(r),l[w]=r)}if(c.emissiveTexture){var b=c.emissiveTexture.texture2D;b&&(r=t._getMaterialTexturePath(b,a,o),h.push(r),l[b]=r)}if(c.ambientTexture){var S=c.ambientTexture.texture2D;S&&(r=t._getMaterialTexturePath(S,a,o),h.push(r),l[S]=r)}if(c.reflectTexture){var T=c.reflectTexture.texture2D;T&&(r=t._getMaterialTexturePath(T,a,o),h.push(r),l[T]=r)}}var C=h.length,M=C+1,I=1/M;if(t._onProcessChange(e,0,I,1),0<C){var A=m.create(null,t._onProcessChange,[e,I,C/M],!1);t._innerFourthLevelLoaderManager.create(h,m.create(null,t._onMateialTexturesLoaded,[e,A,n,l]),A,We,null,1,!0,i)}else t._onMateialTexturesLoaded(e,null,n,null)}},t._onMateialTexturesLoaded=function(t,e,i,n){t.endLoad([i,n]),e&&e.recover()},t._loadTextureCube=function(e){e.on("loaded",null,t._onTextureCubeLtcLoaded,[e]),e.load(e.url,"json",!1,null,!0)},t._onTextureCubeLtcLoaded=function(e,i){if(e._class.destroyed)e.endLoad();else{var n=E.getPath(e.url),r=[t.formatRelativePath(n,i.px),t.formatRelativePath(n,i.nx),t.formatRelativePath(n,i.py),t.formatRelativePath(n,i.ny),t.formatRelativePath(n,i.pz),t.formatRelativePath(n,i.nz)];t._onProcessChange(e,0,1/7,1);var s=m.create(null,t._onProcessChange,[e,1/7,6/7],!1);t._innerFourthLevelLoaderManager.load(r,m.create(null,t._onTextureCubeImagesLoaded,[e,r,s]),s,"nativeimage")}},t._onTextureCubeImagesLoaded=function(t,e,i){var n=[];n.length=6;for(var r=0;r<6;r++){var s=e[r];n[r]=g.getRes(s),g.clearRes(s)}t.endLoad(n),i.recover()},t._onProcessChange=function(t,e,i,n){(n=e+n*i)<1&&t.event("progress",n)},t.init=function(e,n,r,s,a,o){if(void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=!0),void 0===o&&(o=!0),S.update3DLoop=function(){},S.cancelLoadByUrl=function(e){t._cancelLoadByUrl(e)},f.isAntialias=r,f.isAlpha=s,f.premultipliedAlpha=a,f.isStencil=o,!D.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");S.changeWebGLSize=t._changeWebGLSize,x.is3DMode=!0,i.init(e,n),O.__init__(),ue.__init__(),je.__init__(),N.__init__(),t.__init__(),h.maxTextureCount=2,(t.debugMode||q.debugMode)&&(t._debugPhasorSprite=new Y)},t.HIERARCHY="SPRITE3DHIERARCHY",t.MESH="MESH",t.MATERIAL="MATERIAL",t.PBRMATERIAL="PBRMTL",t.TEXTURECUBE="TEXTURECUBE",t.TERRAIN="TERRAIN",t._readData=null,t._debugPhasorSprite=null,t.debugMode=!1,n(t,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new v},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new v},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new v},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new v}]),t}(),ve=function(t){function e(t){e.__super.call(this),this._owner=t,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}r(e,"laya.d3.animation.AnimationTransform3D",p);var i=e.prototype;return i._getlocalMatrix=function(){return this._localUpdate&&(me._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},i._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},i._setWorldMatrixAndUpdate=function(t){if(this._worldMatrix=t,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var e=this._getlocalMatrix(),i=0;i<16;++i)this._worldMatrix[i]=e[i];else me.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},i._setWorldMatrixNoUpdate=function(t){this._worldMatrix=t},i._setWorldMatrixIgnoreUpdate=function(t){this._worldMatrix=t,this._worldUpdate=!1},i.getLocalPosition=function(){return this._localPosition},i.setLocalPosition=function(t){if(this._parent)this._localPosition=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localPosition,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localPosition=i}},i.getLocalRotation=function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;me._quaternionCreateFromYawPitchRollArray(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},i.setLocalRotation=function(t){if(this._parent)this._localRotation=t,me.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localRotation,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],e.localRotation=i}},i.getLocalScale=function(){return this._localScale},i.setLocalScale=function(t){if(this._parent)this._localScale=t,this._localUpdate=!0,this._onWorldTransform();else{var e=this._entity.owner._transform,i=this._entity.localScale,n=i.elements;n[0]=t[0],n[1]=t[1],n[2]=t[2],e.localScale=i}},i.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){me.getYawPitchRoll(this._localRotation,e._tempVector3);var t=e._tempVector3,i=this._localRotationEuler;i[0]=t[1]*e._angleToRandin,i[1]=t[0]*e._angleToRandin,i[2]=t[2]*e._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},i.setLocalRotationEuler=function(t){if(this._parent)me._quaternionCreateFromYawPitchRollArray(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation),this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var i=this._entity.owner._transform,n=this._entity.localRotationEuler,r=n.elements;r[0]=t[0],r[1]=t[1],r[2]=t[2],i.localRotationEuler=n}},i.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)me.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var t=this._getlocalMatrix(),e=0;e<16;++e)this._worldMatrix[e]=t[e];this._worldUpdate=!1}return this._worldMatrix},i.setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}},n(e,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),e}(),ye=function(t){function e(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,e.__super.call(this),this._destroyed=!1,this._id=e._uniqueIDCounter,e._uniqueIDCounter++}r(e,"laya.d3.component.Component3D",p);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),n._initialize=function(t){this._owner=t,this._enable=!0,this.started=!1,this._load(t)},n._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},n._load=function(t){},n._start=function(t){},n._update=function(t){},n._lateUpdate=function(t){},n._preRenderUpdate=function(t){},n._postRenderUpdate=function(t){},n._unload=function(t){this.offAll()},n._cloneTo=function(t){},s(0,n,"id",(function(){return this._id})),s(0,n,"destroyed",(function(){return this._destroyed})),s(0,n,"owner",(function(){return this._owner})),s(0,n,"enable",(function(){return this._enable}),(function(t){this._enable!==t&&(this._enable=t,this.event("enablechanged",this._enable))})),s(0,n,"isSingleton",(function(){return e._isSingleton})),e._isSingleton=!0,e._uniqueIDCounter=1,e}(),xe=function(t){function e(){this._destroyed=!1,e.__super.call(this),this._destroyed=!1}r(e,"laya.d3.core.GeometryFilter",p);var n=e.prototype;return i.imps(n,{"laya.resource.IDestroy":!0}),n._destroy=function(){this.offAll(),this._destroyed=!0},s(0,n,"_isAsyncLoaded",(function(){return!0})),s(0,n,"_originalBoundingBoxCorners",(function(){throw new Error("BaseRender: must override it.")})),s(0,n,"_originalBoundingSphere",(function(){throw new Error("BaseRender: must override it.")})),s(0,n,"_originalBoundingBox",(function(){throw new Error("BaseRender: must override it.")})),s(0,n,"destroyed",(function(){return this._destroyed})),e}(),we=function(t){function e(t){e.__super.call(this),this._id=++e._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new qt(new ae,new ae),this._boundingBoxCenter=new ae,this._boundingSphere=new Qt(new ae,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=t,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}r(e,"laya.d3.core.render.BaseRender",p);var a=e.prototype;return i.imps(a,{"laya.resource.IDestroy":!0}),a._changeMaterialReference=function(t,e){t&&t._removeReference(),e._addReference()},a._getInstanceMaterial=function(t,e){var i=new t.constructor;return t.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._materials[e],i),this._materials[e]=i},a._setShaderValuelightMap=function(t){this._setShaderValueTexture(3,t)},a._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},a._renderRenderableBoundBox=function(){var t=ge._debugPhasorSprite,i=this.boundingBox,n=e._tempBoundBoxCorners;i.getCorners(n),t.line(n[0],e._greenColor,n[1],e._greenColor),t.line(n[2],e._greenColor,n[3],e._greenColor),t.line(n[4],e._greenColor,n[5],e._greenColor),t.line(n[6],e._greenColor,n[7],e._greenColor),t.line(n[0],e._greenColor,n[3],e._greenColor),t.line(n[1],e._greenColor,n[2],e._greenColor),t.line(n[2],e._greenColor,n[6],e._greenColor),t.line(n[3],e._greenColor,n[7],e._greenColor),t.line(n[0],e._greenColor,n[4],e._greenColor),t.line(n[1],e._greenColor,n[5],e._greenColor),t.line(n[4],e._greenColor,n[7],e._greenColor),t.line(n[5],e._greenColor,n[6],e._greenColor)},a._calculateBoundingSphere=function(){throw"BaseRender: must override it."},a._calculateBoundingBox=function(){throw"BaseRender: must override it."},a._setShaderValueTexture=function(t,e){this._owner._shaderValues.setValue(t,e)},a._setShaderValueMatrix4x4=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},a._setShaderValueColor=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},a._setShaderValueBuffer=function(t,e){this._owner._shaderValues.setValue(t,e)},a._setShaderValueInt=function(t,e){this._owner._shaderValues.setValue(t,e)},a._setShaderValueBool=function(t,e){this._owner._shaderValues.setValue(t,e)},a._setShaderValueNumber=function(t,e){this._owner._shaderValues.setValue(t,e)},a._setShaderValueVector2=function(t,e){this._owner._shaderValues.setValue(t,e?e.elements:null)},a._addShaderDefine=function(t){this._owner._shaderDefineValue|=t},a._removeShaderDefine=function(t){this._owner._shaderDefineValue&=~t},a._renderUpdate=function(t){return!0},a._applyLightMapParams=function(){if(0<=this._lightmapIndex){var t=this._owner.scene;if(t){var e=t.getlightmaps()[this._lightmapIndex];e?(this._addShaderDefine(Ye.SAHDERDEFINE_LIGHTMAP),e.loaded?this._setShaderValuelightMap(e):e.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(Ye.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(Ye.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(Ye.SAHDERDEFINE_LIGHTMAP)},a._updateOctreeNode=function(){var t=this._treeNode;t&&this._octreeNodeNeedChange&&(t.updateObject(this),this._octreeNodeNeedChange=!1)},a._destroy=function(){this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t]._destroy();for(t=0,e=this._materials.length;t<e;t++)this._materials[t]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},s(0,a,"boundingSphere",(function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere})),s(0,a,"id",(function(){return this._id})),s(0,a,"material",(function(){var t=this._materials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0);this.event("materialchanged",[this,0,e])}return this._materials[0]}),(function(t){this.sharedMaterial=t})),s(0,a,"sharedMaterial",(function(){return this._materials[0]}),(function(t){var e=this._materials[0];e!==t&&(this._materials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t),this.event("materialchanged",[this,0,t]))})),s(0,a,"lightmapIndex",(function(){return this._lightmapIndex}),(function(t){this._lightmapIndex=t,this._applyLightMapParams()})),s(0,a,"lightmapScaleOffset",(function(){return this._lightmapScaleOffset}),(function(t){this._lightmapScaleOffset=t,this._setShaderValueColor(2,t),this._addShaderDefine(Ye.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)})),s(0,a,"enable",(function(){return this._enable}),(function(t){this._enable=t,this.event("enablechanged",[this,t])})),s(0,a,"materials",(function(){for(var t=0,e=this._materials.length;t<e;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._materials[t],t);this.event("materialchanged",[this,t,i])}return this._materials.slice()}),(function(t){this.sharedMaterials=t})),s(0,a,"sharedMaterials",(function(){return this._materials.slice()}),(function(t){if(!t)throw new Error("MeshRender: shadredMaterials value can't be null.");var e=t.length;this._materialsInstance.length=e;for(var i=0;i<e;i++){var n=this._materials[i];n!==t[i]&&(this._materialsInstance[i]=!1,this._changeMaterialReference(n,t[i]),this.event("materialchanged",[this,i,t[i]]))}this._materials=t})),s(0,a,"boundingBox",(function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox})),s(0,a,"boundingBoxCenter",(function(){if(this._boundingBoxCenterNeedChange){var t=this.boundingBox;ae.add(t.min,t.max,this._boundingBoxCenter),ae.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter})),s(0,a,"receiveShadow",(function(){return this._receiveShadow}),(function(t){this._receiveShadow!==t&&((this._receiveShadow=t)?this._addShaderDefine(_e.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(_e.SHADERDEFINE_RECEIVE_SHADOW))})),s(0,a,"destroyed",(function(){return this._destroyed})),e._uniqueIDCounter=0,n(e,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae]},"_greenColor",function(){return this._greenColor=new oe(0,1,0,1)}]),e}(),be=function(t){function e(t){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,e.__super.call(this),this._localPosition=new ae,this._localRotation=new ie(0,0,0,1),this._localScale=new ae(1,1,1),this._localRotationEuler=new ae,this._localMatrix=new te,this._position=new ae,this._rotation=new ie(0,0,0,1),this._scale=new ae(1,1,1),this._worldMatrix=new te,this._forward=new ae,this._up=new ae,this._right=new ae,this._owner=t,this._childs=[]}r(e,"laya.d3.core.Transform3D",p);var i=e.prototype;return i._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)te.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var t=e._tempVector30;ae.multiply(this.pivot,this._localScale,t);var i=e._tempVector31;ae.subtract(t,this.pivot,i);var n=e._tempVector32,r=this.localRotation;ae.transformQuat(t,r,n),ae.subtract(n,t,n);var s=e._tempVector33;ae.subtract(this._localPosition,i,s),ae.subtract(s,n,s),te.createAffineTransformation(s,r,this._localScale,this._localMatrix)}},i._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},i._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},i._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionTransform()}},i._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionRotationTransform()}},i._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldPositionScaleTransform()}},i._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._onWorldTransform()}},i.translate=function(t,i){void 0===i&&(i=!0),i?(te.createFromQuaternion(this.localRotation,e._tempMatrix0),ae.transformCoordinate(t,e._tempMatrix0,e._tempVector30),ae.add(this.localPosition,e._tempVector30,this._localPosition),this.localPosition=this._localPosition):(ae.add(this.position,t,this._position),this.position=this._position)},i.rotate=function(t,i,n){var r;void 0===i&&(i=!0),void 0===n&&(n=!0),r=n?t:(ae.scale(t,Math.PI/180,e._tempVector30),e._tempVector30),ie.createFromYawPitchRoll(r.y,r.x,r.z,e._tempQuaternion0),i?(ie.multiply(this._localRotation,e._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(ie.multiply(e._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},i.lookAt=function(t,e,i){void 0===i&&(i=!1);var n,r=t.elements;if(i){if(n=this._localPosition.elements,Math.abs(n[0]-r[0])<Jt.zeroTolerance&&Math.abs(n[1]-r[1])<Jt.zeroTolerance&&Math.abs(n[2]-r[2])<Jt.zeroTolerance)return;ie.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var s=this.position;if(n=s.elements,Math.abs(n[0]-r[0])<Jt.zeroTolerance&&Math.abs(n[1]-r[1])<Jt.zeroTolerance&&Math.abs(n[2]-r[2])<Jt.zeroTolerance)return;ie.lookAt(s,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},s(0,i,"_isFrontFaceInvert",(function(){var t=this.scale,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e})),s(0,i,"owner",(function(){return this._owner})),s(0,i,"localRotation",(function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler.elements;ie.createFromYawPitchRoll(t[1]/e._angleToRandin,t[0]/e._angleToRandin,t[2]/e._angleToRandin,this._localRotation)}return this._localRotation}),(function(t){this._localRotation=t,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()})),s(0,i,"worldMatrix",(function(){return this._worldUpdate&&(null!=this._parent?te.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix}),(function(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),te.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=t,this._worldUpdate=!1})),s(0,i,"worldNeedUpdate",(function(){return this._worldUpdate})),s(0,i,"localMatrix",(function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix}),(function(t){this._localMatrix=t,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()})),s(0,i,"dummy",(function(){return this._dummy}),(function(t){this._dummy!==t&&(this._dummy&&(this._dummy._entity=null),t&&(t._entity=this),this._dummy=t)})),s(0,i,"localPosition",(function(){return this._localPosition}),(function(t){this._localPosition=t,this._localUpdate=!0,this._onWorldPositionTransform()})),s(0,i,"position",(function(){if(this._positionUpdate){if(null!=this._parent){var t=this._parent.position;ae.multiply(this._localPosition,this._parent.scale,e._tempVector30),ae.transformQuat(e._tempVector30,this._parent.rotation,e._tempVector30),ae.add(t,e._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position}),(function(t){if(null!=this._parent){ae.subtract(t,this._parent.position,this._localPosition);var i=this._parent.scale.elements,n=i[0],r=i[1],s=i[2];if(1!==n||1!==r||1!==s){var a=e._tempVector30,o=a.elements;o[0]=1/n,o[1]=1/r,o[2]=1/s,ae.multiply(this._localPosition,a,this._localPosition)}this._parent.rotation.invert(e._tempQuaternion0),ae.transformQuat(this._localPosition,e._tempQuaternion0,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=t,this._positionUpdate=!1})),s(0,i,"localScale",(function(){return this._localScale}),(function(t){this._localScale=t,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()})),s(0,i,"localRotationEuler",(function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(e._tempVector30);var t=e._tempVector30.elements,i=this._localRotationEuler.elements;i[0]=t[1]*e._angleToRandin,i[1]=t[0]*e._angleToRandin,i[2]=t[2]*e._angleToRandin}return this._localRotationEuler}),(function(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()})),s(0,i,"rotation",(function(){return this._rotationUpdate&&(null!=this._parent?ie.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation}),(function(t){null!=this._parent?(this._parent.rotation.invert(e._tempQuaternion0),ie.multiply(t,e._tempQuaternion0,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=t,this._rotationUpdate=!1})),s(0,i,"scale",(function(){return this._scaleUpdate&&(null!==this._parent?ae.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale}),(function(t){if(null!==this._parent){var i=this._parent.scale.elements,n=e._tempVector30.elements;n[0]=1/i[0],n[1]=1/i[1],n[2]=1/i[2],ae.multiply(t,e._tempVector30,this._localScale)}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=t,this._scaleUpdate=!1})),s(0,i,"rotationEuler",null,(function(t){ie.createFromYawPitchRoll(t.y,t.x,t.z,this._rotation),this.rotation=this._rotation})),s(0,i,"forward",(function(){var t=this.worldMatrix.elements;return this._forward.elements[0]=-t[8],this._forward.elements[1]=-t[9],this._forward.elements[2]=-t[10],this._forward})),s(0,i,"up",(function(){var t=this.worldMatrix.elements;return this._up.elements[0]=t[4],this._up.elements[1]=t[5],this._up.elements[2]=t[6],this._up})),s(0,i,"right",(function(){var t=this.worldMatrix.elements;return this._right.elements[0]=t[0],this._right.elements[1]=t[1],this._right.elements[2]=t[2],this._right})),s(0,i,"parent",(function(){return this._parent}),(function(t){if(this._parent!==t){if(this._parent){var e=this._parent._childs,i=e.indexOf(this);e.splice(i,1)}t&&(t._childs.push(this),t&&this._onWorldTransform()),this._parent=t}})),n(e,["_tempVector30",function(){return this._tempVector30=new ae},"_tempVector31",function(){return this._tempVector31=new ae},"_tempVector32",function(){return this._tempVector32=new ae},"_tempVector33",function(){return this._tempVector33=new ae},"_tempQuaternion0",function(){return this._tempQuaternion0=new ie},"_tempMatrix0",function(){return this._tempMatrix0=new te},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),e}(),Se=(function(t){function e(){this._rotation=0,this._matNeedUpdte=!1,e.__super.call(this),this._matrix=new te,this._offset=new se,this._tiling=new se(1,1)}r(e,"laya.d3.core.TransformUV",p);var a=e.prototype;i.imps(a,{"laya.d3.core.IClone":!0}),a._updateMatrix=function(){e._tempOffsetV3.elements[0]=this._offset.x,e._tempOffsetV3.elements[1]=this._offset.y,ie.createFromYawPitchRoll(0,0,this._rotation,e._tempRotationQua),e._tempTitlingV3.elements[0]=this._tiling.x,e._tempTitlingV3.elements[1]=this._tiling.y,te.createAffineTransformation(e._tempOffsetV3,e._tempRotationQua,e._tempTitlingV3,this._matrix)},a.cloneTo=function(t){t._matrix=this._matrix.clone(),t._offset=this._offset.clone(),t._rotation=this._rotation,t._tiling=this._tiling.clone()},a.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,a,"matrix",(function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix})),s(0,a,"tiling",(function(){return this._tiling}),(function(t){this._tiling=t,this._matNeedUpdte=!0})),s(0,a,"offset",(function(){return this._offset}),(function(t){this._offset=t,this._matNeedUpdte=!0})),s(0,a,"rotation",(function(){return this._rotation}),(function(t){this._rotation=t,this._matNeedUpdte=!0})),n(e,["_tempOffsetV3",function(){return this._tempOffsetV3=new ae(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new ie},"_tempTitlingV3",function(){return this._tempTitlingV3=new ae(1,1,1)}])}(),function(t){function e(){this.x=NaN,this.y=NaN,this.z=NaN,e.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.BoxShape",t);var i=e.prototype;i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=.5*-this.x,e[1]=.5*-this.y,e[2]=.5*-this.z;var i=t.max.elements;i[0]=.5*this.x,i[1]=.5*this.y,i[2]=.5*this.z},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=0,e[1]=0,e[2]=0;var i=t.max.elements;i[0]=0,i[1]=1,i[2]=0},i.generatePositionAndDirection=function(t,e,i,n){var r=t.elements,s=e.elements;i?(i.seed=n[16],W._randomPointInsideHalfUnitBox(t,i),n[16]=i.seed):W._randomPointInsideHalfUnitBox(t),r[0]=this.x*r[0],r[1]=this.y*r[1],r[2]=this.z*r[2],this.randomDirection?i?(i.seed=n[17],W._randomPointUnitSphere(e,i),n[17]=i.seed):W._randomPointUnitSphere(e):(s[0]=0,s[1]=0,s[2]=1)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.x=this.x,i.y=this.y,i.z=this.z,i.randomDirection=this.randomDirection}}(z),function(t){function e(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,e.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.CircleShape",t);var i=e.prototype;i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[2]=-this.radius,e[1]=0;var i=t.max.elements;i[0]=i[2]=this.radius,i[1]=0},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=1,i[2]=0},i.generatePositionAndDirection=function(t,i,n,r){var s=t.elements,a=e._tempPositionPoint.elements;n?(n.seed=r[16],this.emitFromEdge?W._randomPointUnitArcCircle(this.arc,e._tempPositionPoint,n):W._randomPointInsideUnitArcCircle(this.arc,e._tempPositionPoint,n),r[16]=n.seed):this.emitFromEdge?W._randomPointUnitArcCircle(this.arc,e._tempPositionPoint):W._randomPointInsideUnitArcCircle(this.arc,e._tempPositionPoint),s[0]=-a[0],s[1]=a[1],s[2]=0,ae.scale(t,this.radius,t),this.randomDirection?n?(n.seed=r[17],W._randomPointUnitSphere(i,n),r[17]=n.seed):W._randomPointUnitSphere(i):t.cloneTo(i)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.arc=this.arc,i.emitFromEdge=this.emitFromEdge,i.randomDirection=this.randomDirection},n(e,["_tempPositionPoint",function(){return this._tempPositionPoint=new se}])}(z),function(t){function e(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,e.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.ConeShape",t);var i=e.prototype;i._getShapeBoundBox=function(t){var e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=t.min.elements;n[0]=n[1]=-e,n[2]=0;var r=t.max.elements;r[0]=r[1]=e,r[2]=i},i._getSpeedBoundBox=function(t){var e=Math.sin(this.angle),i=t.min.elements;i[0]=i[1]=-e,i[2]=0;var n=t.max.elements;n[0]=i[1]=e,n[2]=1},i.generatePositionAndDirection=function(t,i,n,r){var s,a=t.elements,o=i.elements,h=e._tempPositionPoint.elements,l=NaN,c=NaN,u=Math.cos(this.angle),d=Math.sin(this.angle);switch(this.emitType){case 0:n?(n.seed=r[16],W._randomPointInsideUnitCircle(e._tempPositionPoint,n),r[16]=n.seed):W._randomPointInsideUnitCircle(e._tempPositionPoint),l=h[0],c=h[1],a[0]=l*this.radius,a[1]=c*this.radius,a[2]=0,this.randomDirection?(n?(n.seed=r[17],W._randomPointInsideUnitCircle(e._tempDirectionPoint,n),r[17]=n.seed):W._randomPointInsideUnitCircle(e._tempDirectionPoint),s=e._tempDirectionPoint.elements,o[0]=s[0]*d,o[1]=s[1]*d):(o[0]=l*d,o[1]=c*d),o[2]=u;break;case 1:n?(n.seed=r[16],W._randomPointUnitCircle(e._tempPositionPoint,n),r[16]=n.seed):W._randomPointUnitCircle(e._tempPositionPoint),l=h[0],c=h[1],a[0]=l*this.radius,a[1]=c*this.radius,a[2]=0,this.randomDirection?(n?(n.seed=r[17],W._randomPointInsideUnitCircle(e._tempDirectionPoint,n),r[17]=n.seed):W._randomPointInsideUnitCircle(e._tempDirectionPoint),s=e._tempDirectionPoint.elements,o[0]=s[0]*d,o[1]=s[1]*d):(o[0]=l*d,o[1]=c*d),o[2]=u;break;case 2:n?(n.seed=r[16],W._randomPointInsideUnitCircle(e._tempPositionPoint,n)):W._randomPointInsideUnitCircle(e._tempPositionPoint),l=h[0],c=h[1],a[0]=l*this.radius,a[1]=c*this.radius,o[a[2]=0]=l*d,o[1]=c*d,o[2]=u,ae.normalize(i,i),n?(ae.scale(i,this.length*n.getFloat(),i),r[16]=n.seed):ae.scale(i,this.length*Math.random(),i),ae.add(t,i,t),this.randomDirection&&(n?(n.seed=r[17],W._randomPointUnitSphere(i,n),r[17]=n.seed):W._randomPointUnitSphere(i));break;case 3:n?(n.seed=r[16],W._randomPointUnitCircle(e._tempPositionPoint,n)):W._randomPointUnitCircle(e._tempPositionPoint),l=h[0],c=h[1],a[0]=l*this.radius,a[1]=c*this.radius,o[a[2]=0]=l*d,o[1]=c*d,o[2]=u,ae.normalize(i,i),n?(ae.scale(i,this.length*n.getFloat(),i),r[16]=n.seed):ae.scale(i,this.length*Math.random(),i),ae.add(t,i,t),this.randomDirection&&(n?(n.seed=r[17],W._randomPointUnitSphere(i,n),r[17]=n.seed):W._randomPointUnitSphere(i));break;default:throw new Error("ConeShape:emitType is invalid.")}},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.angle=this.angle,i.radius=this.radius,i.length=this.length,i.emitType=this.emitType,i.randomDirection=this.randomDirection},n(e,["_tempPositionPoint",function(){return this._tempPositionPoint=new se},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new se}])}(z),function(t){function e(){this.radius=NaN,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",t);var i=e.prototype;i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=this.radius,i[2]=0},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=-1,e[2]=0;var i=t.max.elements;i[0]=i[1]=i[2]=1},i.generatePositionAndDirection=function(t,e,i,n){var r=t.elements;i?(i.seed=n[16],this.emitFromShell?W._randomPointUnitSphere(t,i):W._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?W._randomPointUnitSphere(t):W._randomPointInsideUnitSphere(t),ae.scale(t,this.radius,t);var s=r[2];s<0&&(r[2]=-1*s),this.randomDirection?i?(i.seed=n[17],W._randomPointUnitSphere(e,i),n[17]=i.seed):W._randomPointUnitSphere(e):t.cloneTo(e)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.emitFromShell=this.emitFromShell,i.randomDirection=this.randomDirection}}(z),function(t){function e(){this.radius=NaN,this.emitFromShell=!1,e.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}r(e,"laya.d3.core.particleShuriKen.module.shape.SphereShape",t);var i=e.prototype;i._getShapeBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-this.radius;var i=t.max.elements;i[0]=i[1]=i[2]=this.radius},i._getSpeedBoundBox=function(t){var e=t.min.elements;e[0]=e[1]=e[2]=-1;var i=t.max.elements;i[0]=i[1]=i[2]=1},i.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?W._randomPointUnitSphere(t,i):W._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?W._randomPointUnitSphere(t):W._randomPointInsideUnitSphere(t),ae.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],W._randomPointUnitSphere(e,i),n[17]=i.seed):W._randomPointUnitSphere(e):t.cloneTo(e)},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;i.radius=this.radius,i.emitFromShell=this.emitFromShell,i.randomDirection=this.randomDirection}}(z),function(t){function e(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,e.__super.call(this)}return r(e,"laya.d3.core.render.SubMeshRenderElement",X),e}()),Te=function(t){function e(t,i,n,r,s,a){var o;for(o in this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=t,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[_e.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[Ye.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[Ye.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[Ee.SHADERDEFINE_ALPHATEST]="ALPHATEST",e.__super.call(this,t,i,n,null,{}),this._attributeMap=r,s){var h=s[o];switch(h[1]){case 0:this._renderElementUniformMap[o]=h[0];break;case 1:this._materialUniformMap[o]=h[0];break;case 2:this._spriteUniformMap[o]=h[0];break;case 3:this._cameraUniformMap[o]=h[0];break;case 4:this._sceneUniformMap[o]=h[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}r(e,"laya.d3.shader.ShaderCompile3D",T);var i=e.prototype;return i._definesToNameDic=function(t,e){for(var i={},n=1,r=0;r<32&&!(t<(n=1<<r));r++)if(t&n){var s=e[n];s&&(i[s]="")}return i},i.withCompile=function(t,i,n,r){var s,a,o;if(a=this.sharders[t])if(o=a[i]){if(s=o[n])return s}else o=a[i]=[];else o=(a=this.sharders[t]=[])[i]=[];var h,l=this._definesToNameDic(t,e._globalInt2name),u=this._definesToNameDic(i,this._spriteInt2name),d=this._definesToNameDic(n,this._materialInt2name),_={},f="";if(l)for(h in l)f+="#define "+h+"\n",_[h]=!0;if(u)for(h in u)f+="#define "+h+"\n",_[h]=!0;if(d)for(h in d)f+="#define "+h+"\n",_[h]=!0;var p=Be.nameKey.getName(this._name)+" compile ("+t+","+i+","+n+")",m=this._VS.toscript(_,[]),g=this._PS.toscript(_,[]);return c.now(),s=Be.create(f+m.join("\n"),f+g.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,r,p),o[n]=s,laya.d3.shader.ShaderCompile3D.debugMode&&c.now(),s},i.precompileShaderWithShaderDefine=function(t,e,i){this.withCompile(t,e,i,!0)},i.addMaterialDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._materialInt2name[r]=n,this._materialName2Int[n]=r}},i.addSpriteDefines=function(t){var e=t.defines;for(var i in e){var n=e[i],r=parseInt(i);this._spriteInt2name[r]=n,this._spriteName2Int[n]=r}},i.getMaterialDefineByName=function(t){return this._materialName2Int[t]},i.registerMaterialDefine=function(t){var e=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[e]=t,this._materialName2Int[t]=e},i.registerSpriteDefine=function(t){var e=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[e]=t,this._spriteName2Int[t]=e},e._globalRegDefine=function(t,i){e._globalInt2name[i]=t},e.add=function(t,i,n,r,s){return laya.d3.shader.ShaderCompile3D._preCompileShader[t]=new e(t,i,n,r,s,T.includes)},e.get=function(t){return laya.d3.shader.ShaderCompile3D._preCompileShader[Be.nameKey.getID(t)]},e._preCompileShader={},e._globalInt2name=[],e.debugMode=!1,e.SHADERDEFINE_HIGHPRECISION=1,e.SHADERDEFINE_FOG=4,e.SHADERDEFINE_DIRECTIONLIGHT=8,e.SHADERDEFINE_POINTLIGHT=16,e.SHADERDEFINE_SPOTLIGHT=32,e.SHADERDEFINE_UV0=64,e.SHADERDEFINE_COLOR=128,e.SHADERDEFINE_UV1=256,e.SAHDERDEFINE_DEPTHFOG=131072,e}(),Ce=function(t){function e(){e.__super.call(this)}r(e,"laya.d3.graphics.MeshSprite3DStaticBatchManager",nt);var i=e.prototype;return i._getStaticBatch=function(t,e,i,n){var r,s;return s=t?t.id.toString()+i.id.toString()+e.id.toString()+n.toString():i.id.toString()+e.id.toString()+n.toString(),this._staticBatches[s]?r=this._staticBatches[s]:this._staticBatches[s]=r=new Me(s,this,t,e,i),r},i._initStaticBatchs=function(t){var i,n;this._initBatchRenderElements.sort(e._sortPrepareStaticBatch);for(var r,s=!1,a=0,o=0,h=this._initBatchRenderElements.length;o<h;o++){var l,c=this._initBatchRenderElements[o],u=c.renderObj._getVertexBuffer(0);if(c._sprite3D,n===u.vertexDeclaration&&i===c._material)if(s)r._addCombineBatchRenderObjTest(c)?(l=c._staticBatch)!==r&&(l&&l._deleteCombineBatchRenderObj(c),r._addCombineBatchRenderObj(c)):(s=!1,a++);else{var d=this._initBatchRenderElements[o-1],_=d.renderObj,f=c.renderObj;s=!(65535<_._getVertexBuffer().vertexCount+f._getVertexBuffer().vertexCount||(r=this._getStaticBatch(t,n,i,a),(l=d._staticBatch)!==r&&(l&&l._deleteCombineBatchRenderObj(d),r._addCombineBatchRenderObj(d)),(l=c._staticBatch)!==r&&(l&&l._deleteCombineBatchRenderObj(c),r._addCombineBatchRenderObj(c)),0))}else s=!1,a=0;i=c._material,n=u.vertexDeclaration}},e._sortPrepareStaticBatch=function(t,e){var i=t._render,n=e._render,r=i.lightmapIndex-n.lightmapIndex;if(0!=r)return r;var s=i.receiveShadow-n.receiveShadow;if(0!=s)return s;var a=t._mainSortID-e._mainSortID;return 0==a?t.renderObj.triangleCount-e.renderObj.triangleCount:a},e}(),Me=function(t){function e(t,i,n,r,s){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this,t,i,n),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=r,this._material=s}r(e,"laya.d3.graphics.SubMeshStaticBatch",rt);var i=e.prototype;return i._compareBatchRenderElement=function(t,e){return t._batchIndexStart>e._batchIndexStart},i._addCombineBatchRenderObjTest=function(t){var e=t.renderObj._vertexCount;return!(65535<(0<e?this._currentCombineVertexCount+e:this._currentCombineVertexCount+t.renderObj._getVertexBuffer().vertexCount))},i._addCombineBatchRenderObj=function(t){var e=t.renderObj,i=e._vertexCount;this._initBatchRenderElements.push(t),t._staticBatch=this,0<i?(this._currentCombineIndexCount+=e._indexCount,this._currentCombineVertexCount+=i):(this._currentCombineIndexCount=this._currentCombineIndexCount+e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+e._getVertexBuffer().vertexCount),this._needFinishCombine=!0},i._deleteCombineBatchRenderObj=function(t){var e=t.renderObj,i=this._initBatchRenderElements.indexOf(t);if(-1!==i){this._initBatchRenderElements.splice(i,1),t._staticBatch=null;var n=e._vertexCount;0<n?(this._currentCombineIndexCount=this._currentCombineIndexCount-e._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-n):(this._currentCombineIndexCount=this._currentCombineIndexCount-e._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-e._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},i._finishInit=function(){if(this._needFinishCombine){var t=0,e=0;(0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex||this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture)&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var i=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),n=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=ke.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=Fe.create("ushort",this._currentCombineIndexCount,35044);for(var r=0,s=this._initBatchRenderElements.length;r<s;r++){var a=this._initBatchRenderElements[r],o=a.renderObj,h=o._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,a._sprite3D),l=o.getIndices(),c=a._sprite3D.transform._isFrontFaceInvert,u=t/(this._vertexDeclaration.vertexStride/4)-o._vertexStart,d=e,_=d+l.length;a._batchIndexStart=d,a._batchIndexEnd=_,n.set(l,e);var f=0;if(c)for(f=d;f<_;f+=3){n[f]=u+n[f];var p=n[f+1],m=n[f+2];n[f+1]=u+m,n[f+2]=u+p}else for(f=d;f<_;f+=3)n[f]=u+n[f],n[f+1]=u+n[f+1],n[f+2]=u+n[f+2];e+=l.length,i.set(h,t),t+=h.length}this._vertexBuffer.setData(i),this._indexBuffer.setData(n),this._needFinishCombine=!1}},i._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new Se)},i._getRenderElement=function(t,e,i){for(var n,r,s=this._batchRenderElements.length,a=!0,o=0;o<s;o++){var h,l,c=(r=this._batchRenderElements[o])._sprite3D._render;if(0!==o&&(a=(h=(n=this._batchRenderElements[o-1])._sprite3D._render).lightmapIndex!==c.lightmapIndex||h.receiveShadow!==c.receiveShadow||n._batchIndexEnd!==r._batchIndexStart),a){(l=this._getCombineRenderElementFromPool()).renderObj=this,l._material=this._material,l._batchIndexStart=r._batchIndexStart,l._batchIndexEnd=r._batchIndexEnd;var u=c.lightmapIndex,d=u+1,_=this._batchOwnerIndices[d];_||(_=this._batchOwnerIndices[d]=[]);var f,p=_[r._render.receiveShadow?1:0];void 0===p?(_[c.receiveShadow?1:0]=this._batchOwners.length,(f=new je(null,"StaticBatchMeshSprite3D"))._scene=e,f._transform=this._rootOwner?this._rootOwner._transform:null,f._render.lightmapIndex=u,f._render.receiveShadow=r._render.receiveShadow,this._batchOwners.push(f)):f=this._batchOwners[p],f._render._renderUpdate(i),l._sprite3D=f,t.push(l)}else l._batchIndexEnd=r._batchIndexEnd}},i._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},i._render=function(t){var e=t.renderElement,i=e._batchIndexStart,n=e._batchIndexEnd-i;D.mainContext.drawElements(4,n,5123,2*i),M.drawCall++,M.trianglesFaces+=n/3},i.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},i._getVertexBuffer=function(t){return void 0===t&&(t=0),this._vertexBuffer},e}(),Ie=function(t){function e(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,e.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}r(e,"laya.d3.core.ComponentNode",y);var i=e.prototype;return i.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=_.getInstance(t);return e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},i._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),r instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(r),1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var s=0,a=this._componentsMap.length;s<a;s++)for(var o=(i=this._typeComponentsIndices[s]).length-1;0<=o;o--){var h=i[o];if(!(n<h))break;i[o]=--h}r._destroy()},i.getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},i.getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var s=0;s<r;s++)e[s]=this._components[n[s]]}else e.length=0},i.getComponentByIndex=function(t){return this._components[t]},i.removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},i.removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},i.removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this.removeComponentsByType(this._componentsMap[t])},i._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},i._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},i._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},i._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},e}(),Ee=function(t){function e(){e.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new de,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new oe(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}r(e,"laya.d3.core.material.BaseMaterial",t);var a=e.prototype;return i.imps(a,{"laya.d3.core.IClone":!0}),a._addShaderDefine=function(t){this._shaderDefineValue|=t},a._removeShaderDefine=function(t){this._shaderDefineValue&=~t},a._addDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine|=t},a._removeDisablePublicShaderDefine=function(t){this._disablePublicShaderDefine&=~t},a._setBuffer=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},a._getBuffer=function(t){return this._values[t]},a._setMatrix4x4=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},a._getMatrix4x4=function(t){return this._values[t]},a._setInt=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},a._getInt=function(t){return this._values[t]},a._setNumber=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},a._getNumber=function(t){return this._values[t]},a._setBool=function(t,e){this._shaderValues.setValue(t,e),this._values[t]=e},a._getBool=function(t){return this._values[t]},a._setVector2=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},a._getVector2=function(t){return this._values[t]},a._setColor=function(t,e){this._shaderValues.setValue(t,e?e.elements:null),this._values[t]=e},a._getColor=function(t){return this._values[t]},a._setTexture=function(t,e){var i=this._values[t];this._values[t]=e,this._shaderValues.setValue(t,e),0<this.referenceCount&&(i&&i._removeReference(),e&&e._addReference())},a._getTexture=function(t){return this._values[t]},a._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},a._getShader=function(t,e,i){var n=(t|e)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(n,i,this._shaderDefineValue),this._shader},a._setRenderStateBlendDepth=function(){var t=D.mainContext;switch(P.setDepthMask(t,this.depthWrite),0===this.depthTest?P.setDepthTest(t,!1):(P.setDepthTest(t,!0),P.setDepthFunc(t,this.depthTest)),this.blend){case 0:P.setBlend(t,!1);break;case 1:P.setBlend(t,!0),P.setBlendFunc(t,this.srcBlend,this.dstBlend);break;case 2:P.setBlend(t,!0)}},a._setRenderStateFrontFace=function(t,e){var i=D.mainContext,n=0;switch(this.cull){case 0:P.setCullFace(i,!1);break;case 1:P.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2305:2304:e&&e._isFrontFaceInvert?2304:2305,P.setFrontFace(i,n);break;case 2:P.setCullFace(i,!0),n=t?e&&e._isFrontFaceInvert?2304:2305:e&&e._isFrontFaceInvert?2305:2304,P.setFrontFace(i,n)}},a.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];switch(n.version){case"LAYAMATERIAL:01":var s=0,a=0,o=n.props;for(var h in o)switch(h){case"vectors":var l=o[h];for(s=0,a=l.length;s<a;s++){var c=l[s],u=c.value;switch(u.length){case 2:this[c.name]=new se(u[0],u[1]);break;case 3:this[c.name]=new ae(u[0],u[1],u[2]);break;case 4:this[c.name]=new oe(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var d=o[h];for(s=0,a=d.length;s<a;s++){var _=d[s],f=_.path;f&&(this[_.name]=g.getRes(r[f]))}break;case"defines":var p=o[h];for(s=0,a=p.length;s<a;s++){var m=this._shaderCompile.getMaterialDefineByName(p[s]);this._addShaderDefine(m)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[h]=o[h];break;case"renderQueue":switch(o[h]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[h]=o[h]}break;case"LAYAMATERIAL:02":for(h in o=n.props)switch(h){case"vectors":for(s=0,a=(l=o[h]).length;s<a;s++)switch((u=(c=l[s]).value).length){case 2:this[c.name]=new se(u[0],u[1]);break;case 3:this[c.name]=new ae(u[0],u[1],u[2]);break;case 4:this[c.name]=new oe(u[0],u[1],u[2],u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(s=0,a=(d=o[h]).length;s<a;s++)(f=(_=d[s]).path)&&(this[_.name]=g.getRes(r[f]));break;case"defines":for(s=0,a=(p=o[h]).length;s<a;s++)m=this._shaderCompile.getMaterialDefineByName(p[s]),this._addShaderDefine(m);break;default:this[h]=o[h]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},a._addReference=function(){t.prototype._addReference.call(this);for(var e=0,i=this._values.length;e<i;e++){var n=this._values[e];n&&n instanceof laya.d3.resource.BaseTexture&&n._addReference()}},a._removeReference=function(){t.prototype._removeReference.call(this);for(var e=0,i=this._values.length;e<i;e++){var n=this._values[e];n&&n instanceof laya.d3.resource.BaseTexture&&n._removeReference()}},a.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},a.setShaderName=function(t){var e=Be.nameKey.getID(t);if(-1===e)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=Te._preCompileShader[e]},a.cloneTo=function(t){var e=t;e.name=this.name,e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.renderQueue=this.renderQueue,e._shader=this._shader,e._disablePublicShaderDefine=this._disablePublicShaderDefine,e._shaderDefineValue=this._shaderDefineValue;var i,n=0,r=e._shaderValues;e._shaderValues.data.length=this._shaderValues.data.length;var s=this._values.length,a=e._values;for(n=0,i=a.length=s;n<i;n++){var o=this._values[n];if(o)if("number"==typeof o)a[n]=o,r.data[n]=o;else if("number"==typeof o&&Math.floor(o)==o)a[n]=o,r.data[n]=o;else if("boolean"==typeof o)a[n]=o,r.data[n]=o;else if(o instanceof laya.d3.math.Vector2){var h=a[n]||(a[n]=new se);o.cloneTo(h),r.data[n]=h.elements}else if(o instanceof laya.d3.math.Vector3){var l=a[n]||(a[n]=new ae);o.cloneTo(l),r.data[n]=l.elements}else if(o instanceof laya.d3.math.Vector4){var c=a[n]||(a[n]=new oe);o.cloneTo(c),r.data[n]=c.elements}else if(o instanceof laya.d3.math.Matrix4x4){var u=a[n]||(a[n]=new te);o.cloneTo(u),r.data[n]=u.elements}else o instanceof laya.d3.resource.BaseTexture&&(a[n]=o,r.data[n]=o)}},a.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},s(0,a,"alphaTestValue",(function(){return this._getNumber(0)}),(function(t){this._setNumber(0,t)})),s(0,a,"alphaTest",(function(){return this._alphaTest}),(function(t){(this._alphaTest=t)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)})),e.__init__=function(){e.SHADERDEFINE_ALPHATEST=e.shaderDefines.registerDefine("ALPHATEST")},e.RENDERQUEUE_OPAQUE=2e3,e.RENDERQUEUE_ALPHATEST=2450,e.RENDERQUEUE_TRANSPARENT=3e3,e.CULL_NONE=0,e.CULL_FRONT=1,e.CULL_BACK=2,e.BLEND_DISABLE=0,e.BLEND_ENABLE_ALL=1,e.BLEND_ENABLE_SEPERATE=2,e.BLENDPARAM_ZERO=0,e.BLENDPARAM_ONE=1,e.BLENDPARAM_SRC_COLOR=768,e.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,e.BLENDPARAM_DST_COLOR=774,e.BLENDPARAM_ONE_MINUS_DST_COLOR=775,e.BLENDPARAM_SRC_ALPHA=770,e.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,e.BLENDPARAM_DST_ALPHA=772,e.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,e.BLENDPARAM_SRC_ALPHA_SATURATE=776,e.BLENDEQUATION_ADD=0,e.BLENDEQUATION_SUBTRACT=1,e.BLENDEQUATION_REVERSE_SUBTRACT=2,e.DEPTHTEST_OFF=0,e.DEPTHTEST_NEVER=512,e.DEPTHTEST_LESS=513,e.DEPTHTEST_EQUAL=514,e.DEPTHTEST_LEQUAL=515,e.DEPTHTEST_GREATER=516,e.DEPTHTEST_NOTEQUAL=517,e.DEPTHTEST_GEQUAL=518,e.DEPTHTEST_ALWAYS=519,e.SHADERDEFINE_ALPHATEST=1,e.ALPHATESTVALUE=0,n(e,["shaderDefines",function(){return this.shaderDefines=new ce}]),e}(b),Ae=function(t){function e(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,e.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}r(e,"laya.d3.resource.BaseTexture",b);var i=e.prototype;return s(0,i,"width",(function(){return this._width})),s(0,i,"repeat",(function(){return this._repeat}),(function(t){if(this._repeat!==t&&(this._repeat=t,this._source)){var e=D.mainContext;P.bindTexture(e,this._type,this._source),o.isPOT(this._width,this._height)&&this._repeat?(e.texParameteri(this._type,10242,10497),e.texParameteri(this._type,10243,10497)):(e.texParameteri(this._type,10242,33071),e.texParameteri(this._type,10243,33071))}})),s(0,i,"height",(function(){return this._height})),s(0,i,"magFifter",(function(){return this._magFifter}),(function(t){(this._magFifter=t)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(t)})),s(0,i,"wrapModeV",(function(){return this._wrapModeV})),s(0,i,"size",(function(){return this._size})),s(0,i,"wrapModeU",(function(){return this._wrapModeU})),s(0,i,"mipmap",(function(){return this._mipmap}),(function(t){this._mipmap=t,this._mipmap!=t&&this._conchTexture&&this._conchTexture.setMipMap(t)})),s(0,i,"minFifter",(function(){return this._minFifter}),(function(t){this._minFifter=t,this._minFifter!=t&&this._conchTexture&&this._conchTexture.setMinFifter(t)})),s(0,i,"format",(function(){return this._format})),s(0,i,"source",(function(){return this.activeResource(),this._source})),s(0,i,"defaulteTexture",(function(){return ze.grayTexture})),e.WARPMODE_REPEAT=0,e.WARPMODE_CLAMP=1,e}(),De=function(t){function e(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,e.__super.call(this),this._boundingBoxCorners=a(8,null)}r(e,"laya.d3.resource.models.BaseMesh",b);var i=e.prototype;return i._getPositions=function(){throw new Error("未Override,请重载该属性！")},i._generateBoundingObject=function(){this._boundingSphere=new Qt(new ae,0),Qt.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new qt(new ae,new ae),qt.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},i.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},i.getRenderElement=function(t){throw new Error("未Override,请重载该属性！")},s(0,i,"subMeshCount",(function(){return this._subMeshCount})),s(0,i,"boundingBox",(function(){return this._boundingBox})),s(0,i,"boundingBoxCorners",(function(){return this._boundingBoxCorners})),s(0,i,"boundingSphere",(function(){return this._boundingSphere})),e}(),Pe=(function(t){function e(){e.__super.call(this)}r(e,"laya.d3.component.Script",ye);var i=e.prototype;i.onTriggerEnter=function(t){},i.onTriggerExit=function(t){},i.onTriggerStay=function(t){},s(0,i,"isSingleton",(function(){return e._isSingleton})),e._isSingleton=!1}(),function(t){function e(t){this._owner=null,this._sharedMesh=null,e.__super.call(this),this._owner=t}r(e,"laya.d3.core.MeshFilter",t);var i=e.prototype;return i._sharedMeshLoaded=function(){this.event("loaded")},i._destroy=function(){t.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},s(0,i,"sharedMesh",(function(){return this._sharedMesh}),(function(t){var e=this._sharedMesh;e&&e._removeReference(),(this._sharedMesh=t)._addReference(),this.event("meshchanged",[this,e,t]),t.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)})),s(0,i,"_isAsyncLoaded",(function(){return this._sharedMesh.loaded})),s(0,i,"_originalBoundingBoxCorners",(function(){return this._sharedMesh.boundingBoxCorners})),s(0,i,"_originalBoundingSphere",(function(){return this._sharedMesh.boundingSphere})),s(0,i,"_originalBoundingBox",(function(){return this._sharedMesh.boundingBox})),e}(xe)),Re=function(t){function e(t){e.__super.call(this,t),t.meshFilter.on("meshchanged",this,this._onMeshChanged)}r(e,"laya.d3.core.MeshRender",we);var i=e.prototype;return i._onMeshChanged=function(t,e,i){i.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:i.once("loaded",this,this._onMeshLoaed)},i._onMeshLoaed=function(t,e){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},i._calculateBoundingSphereByInitSphere=function(t){var e,i=this._owner.transform,n=i.scale.elements,r=Math.abs(n[0]),s=Math.abs(n[1]),a=Math.abs(n[2]);e=s<=r&&a<=r?r:a<=s?s:a,ae.transformCoordinate(t.center,i.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=t.radius*e},i._calculateBoundBoxByInitCorners=function(t){for(var e=this._owner.transform.worldMatrix,i=0;i<8;i++)ae.transformCoordinate(t[i],e,we._tempBoundBoxCorners[i]);qt.createfromPoints(we._tempBoundBoxCorners,this._boundingBox)},i._calculateBoundingSphere=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(t.boundingSphere)},i._calculateBoundingBox=function(){var t=this._owner.meshFilter.sharedMesh;null==t||null==t.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(t.boundingBoxCorners)},i._renderUpdate=function(t){var e=this._owner.transform;if(e){this._setShaderValueMatrix4x4(0,e.worldMatrix);var i=this._owner.getProjectionViewWorldMatrix(t);this._setShaderValueMatrix4x4(1,i)}else this._setShaderValueMatrix4x4(0,te.DEFAULT),this._setShaderValueMatrix4x4(1,t);return ge.debugMode&&this._renderRenderableBoundBox(),!0},e}(),Ne=function(t){function e(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,e.__super.call(this),this._renderState=new K,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new de,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new et,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new ae(.7,.7,.7),this.ambientColor=new ae(.212,.227,.259),D.shaderHighPrecision&&this.addShaderDefine(Te.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}r(e,"laya.d3.core.scene.Scene",t);var n=e.prototype;return i.imps(n,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),n._setUrl=function(t){this._url=t},n._getGroup=function(){return this._group},n._setGroup=function(t){this._group=t},n._display=function(){i.stage._scenes.push(this),i.stage._scenes.sort(e._sortScenes);for(var t=0,n=this._childs.length;t<n;t++){var r=this._childs[t];r.active&&r._activeHierarchy()}},n._unDisplay=function(){var t=i.stage._scenes;t.splice(t.indexOf(this),1);for(var e=0,n=this._childs.length;e<n;e++){var r=this._childs[e];r.active&&r._inActiveHierarchy()}},n._addChild3D=function(t){t.transform._onWorldTransform(),t._setBelongScene(this),this.displayedInStage&&t.active&&t._activeHierarchy()},n._removeChild3D=function(t){t.transform.parent=null,this.displayedInStage&&t.active&&t._inActiveHierarchy(),t._setUnBelongScene()},n.initOctree=function(t,e,i,n,r){void 0===r&&(r=6),this.treeSize=new ae(t,e,i),this.treeLevel=r,this.treeRoot=new q(this,0),this.treeRoot.init(n,this.treeSize)},n._prepareUpdateToRenderState=function(t,e){e.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,e.scene=this},n._prepareSceneToRender=function(t){var e=this._lights.length;if(0<e)for(var i=0,n=0;n<e&&!(this._lights[n]._prepareToScene(t)&&++i>=this._enableLightCount);n++);},n._updateChilds=function(t){for(var e=0,i=this._childs.length;e<i;++e)this._childs[e]._update(t)},n._preRenderScene=function(t,e,i){var n,r=e._viewMatrix,s=e._projectionMatrix,a=e._projectionViewMatrix,o=0,h=e.camera;for(h.useOcclusionCulling?this.treeRoot?it.renderObjectCullingOctree(i,this,h,r,s,a):it.renderObjectCulling(i,this,h,r,s,a):it.renderObjectCullingNoBoundFrustum(this,h,r,s,a),o=0,n=this._quenes.length;o<n;o++)this._quenes[o]&&this._quenes[o]._preRender(e)},n._clear=function(t,e){var i=e._viewport,n=e.camera,r=i.x,s=n.renderTargetSize.height-i.y-i.height,a=i.width,o=i.height;t.viewport(r,s,a,o);var h=256,l=n.renderTarget;switch(n.clearFlag){case 0:var c=n.clearColor;if(c){t.enable(3089),t.scissor(r,s,a,o);var u=c.elements;t.clearColor(u[0],u[1],u[2],u[3]),h|=16384}if(l)switch(c||(h=16384),l.depthStencilFormat){case 33189:h|=256;break;case 36168:h|=1024;break;case 34041:h|=256,h|=1024}t.clear(h),c&&t.disable(3089);break;case 1:case 2:if(l)switch(h=16384,l.depthStencilFormat){case 33189:h|=256;break;case 36168:h|=1024;break;case 34041:h|=256,h|=1024}t.clear(h);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},n._renderScene=function(t,e){var i,n,r=e.camera,s=0;for(s=0;s<2;s++)(n=this._quenes[s])&&(r.renderTarget?n._render(e,!0):n._render(e,!1));if(1===r.clearFlag){var a=r.sky;a&&(P.setCullFace(t,!1),P.setDepthFunc(t,515),P.setDepthMask(t,!1),a._render(e),P.setDepthFunc(t,513),P.setDepthMask(t,!0))}for(s=2,i=this._quenes.length;s<i;s++)(n=this._quenes[s])&&(n._sortAlpha(e.camera.transform.position),r.renderTarget?n._render(e,!0):n._render(e,!1))},n._set3DRenderConfig=function(t){t.disable(3042),P._blend=!1,t.blendFunc(770,771),P._sFactor=770,P._dFactor=771,t.disable(2929),P._depthTest=!1,t.enable(2884),P._cullFace=!0,t.depthMask(1),P._depthMask=!0,t.frontFace(2304),P._frontFace=2304},n._set2DRenderConfig=function(t){P.setBlend(t,!0),P.setBlendFunc(t,1,771),P.setDepthTest(t,!1),P.setCullFace(t,!1),P.setDepthMask(t,!0),P.setFrontFace(t,2305),t.viewport(0,0,w.width,w.height)},n._parseCustomProps=function(t,e,i,n){var r=n.customProps.lightmaps,s=r.length,a=this._lightmaps;a.length=s;for(var o=0;o<s;o++)a[o]=g.getRes(e[r[o].replace(".exr",".png")]);this.setlightmaps(a);var h=n.customProps.ambientColor;h&&(this.ambientColor=new ae(h[0],h[1],h[2]));var l=n.customProps.fogColor;l&&(this.fogColor=new ae(l[0],l[1],l[2]))},n._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},n._removeLight=function(t){var e=this._lights.indexOf(t);0<=e&&this._lights.splice(e,1)},n._updateScene=function(){var t=this._renderState;this._prepareUpdateToRenderState(D.mainContext,t),this._updateComponents(t),this._updateChilds(t),this._lateUpdateComponents(t),this._time+=t.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},n._updateSceneConch=function(){var t=this._renderState;this._prepareUpdateToRenderState(D.mainContext,t),this._updateComponents(t),this._lateUpdateComponents(t),this._prepareSceneToRender(t);for(var e=0,i=this._cameraPool.length;e<i;e++){var n=this._cameraPool[e];(t.camera=n)._prepareCameraToRender()}},n._preRenderShadow=function(t,e,i,n,r){this.treeRoot?it.renderShadowObjectCullingOctree(this,e,i,n,r):it.renderShadowObjectCulling(this,e,i,n,r);for(var s=0,a=i.length;s<a;s++)i[s]&&i[s]._preRender(t)},n._renderShadowMap=function(t,e,i){var n=this.parallelSplitShadowMaps[0];n._calcAllLightCameraInfo(i);var r,s,a,o=n.PSSMNum;if(this._preRenderShadow(e,n._lightCulling,n._shadowQuenes,n._lightVPMatrix[0],o),this.addShaderDefine(_e.SHADERDEFINE_CAST_SHADOW),1<o)for(var h=0;h<o;h++)r=n.getRenderTarget(h+1),n.beginRenderTarget(h+1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=a=n.getLightCamera(h),a._prepareCameraToRender(),a._prepareCameraViewProject(a.viewMatrix,a.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[h+1],(s=n._shadowQuenes[h])._preRender(e),s._renderShadow(e,!1),n.endRenderTarget(h+1);else r=n.getRenderTarget(1),n.beginRenderTarget(1),t.clearColor(1,1,1,1),t.clear(16640),t.viewport(0,0,r.width,r.height),e.camera=a=n.getLightCamera(0),a._prepareCameraToRender(),a._prepareCameraViewProject(a.viewMatrix,a.projectionMatrix),e._projectionViewMatrix=n._lightVPMatrix[0],(s=n._shadowQuenes[0])._preRender(e),s._renderShadow(e,!0),n.endRenderTarget(1);this.removeShaderDefine(_e.SHADERDEFINE_CAST_SHADOW)},n.addTreeNode=function(t){this.treeRoot.addTreeNode(t)},n.removeTreeNode=function(t){this.treeSize&&t._treeNode&&t._treeNode.removeObject(t)},n.setlightmaps=function(t){this._lightmaps=t;for(var e=0,i=this._renderableSprite3Ds.length;e<i;e++)this._renderableSprite3Ds[e]._render._applyLightMapParams()},n.getlightmaps=function(){return this._lightmaps},n.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(t&&t.__className));if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===y.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),(t.parent=this)._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},n.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===y.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged(),this._addChild3D(t);return t},n.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},n.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&s<=e){var n=i;this._childs=y.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,s=n.length;r<s;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},n.addFrustumCullingObject=function(t){this.treeRoot?this.addTreeNode(t):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(t):this._cullingRenders[this._cullingRendersLength]=t,t._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},n.removeFrustumCullingObject=function(t){if(this.treeRoot)this.removeTreeNode(t);else{this._cullingRendersLength--;var e=t._indexInSceneFrustumCullingObjects;if(e!==this._cullingRendersLength){var i=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[e]=i)._indexInSceneFrustumCullingObjects=e,t._indexInSceneFrustumCullingObjects=-1}}},n.getRenderQueue=function(t){return t<3e3?this._quenes[1]||(this._quenes[1]=new j(this)):this._quenes[2]||(this._quenes[2]=new j(this))},n.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new j(this)},n.addShaderDefine=function(t){this._shaderDefineValue|=t},n.removeShaderDefine=function(t){this._shaderDefineValue&=~t},n.addScript=function(t){return this._addComponent(t)},n.getScriptByType=function(t,e){return void 0===e&&(e=0),this._getComponentByType(t,e)},n.getScriptsByType=function(t,e){this._getComponentsByType(t,e)},n.getScriptByIndex=function(t){return this._getComponentByIndex(t)},n.removeScriptByType=function(t,e){void 0===e&&(e=0),this._removeComponentByType(t,e)},n.removeScriptsByType=function(t){this._removeComponentByType(t)},n.removeAllScript=function(){this._removeAllComponent()},n.render=function(t,e,i){(x._context.ctx._renderKey=0)<this._childs.length&&t.addRenderObject(this)},n.renderSubmit=function(){var t=D.mainContext,e=this._renderState;this._set3DRenderConfig(t),this._prepareSceneToRender(this._renderState);var i,n=0,r=0;if(ge.debugMode||q.debugMode)for(n=0,r=this._cameraPool.length;n<r;n++)i=this._cameraPool[n],ge._debugPhasorSprite.begin(1,i),i.activeInHierarchy&&i._renderCamera(t,e,this),ge._debugPhasorSprite.end();else for(n=0,r=this._cameraPool.length;n<r;n++)(i=this._cameraPool[n]).activeInHierarchy&&i._renderCamera(t,e,this);return this._set2DRenderConfig(t),1},n.onAsynLoaded=function(t,e,i){var n=e[0];if("Scene"!==n.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var r=e[1];me._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},n.destroy=function(e){void 0===e&&(e=!0),this.destroyed||(t.prototype.destroy.call(this,e),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,g.clearRes(this.url),this.loaded||ge._cancelLoadByUrl(this.url))},n.getRenderType=function(){return 0},n.releaseRender=function(){},n._addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=_.getInstance(t);return e.push(this._components.length),this._components.push(n),n._initialize(this),n},n._removeComponent=function(t,e){var i=this._typeComponentsIndices[t],n=i[e],r=this._components[n];this._components.splice(n,1),i.splice(e,1),0===i.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1));for(var s=0,a=this._componentsMap.length;s<a;s++)for(var o=(i=this._typeComponentsIndices[s]).length-1;0<=o;o--){var h=i[o];if(!(n<h))break;i[o]=--h}r._destroy()},n._getComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);return-1===i?null:this._components[this._typeComponentsIndices[i][e]]},n._getComponentsByType=function(t,e){var i=this._componentsMap.indexOf(t);if(-1!==i){var n=this._typeComponentsIndices[i],r=n.length;e.length=r;for(var s=0;s<r;s++)e[s]=this._components[n[s]]}else e.length=0},n._getComponentByIndex=function(t){return this._components[t]},n._removeComponentByType=function(t,e){void 0===e&&(e=0);var i=this._componentsMap.indexOf(t);-1!==i&&this._removeComponent(i,e)},n._removeComponentsByType=function(t){var e=this._componentsMap.indexOf(t);if(-1!==e)for(var i=this._typeComponentsIndices[e],n=0,r=i.length;n<r;i.length<r?r--:n++)this._removeComponent(e,n)},n._removeAllComponent=function(){for(var t=0,e=this._componentsMap.length;t<e;this._componentsMap.length<e?e--:t++)this._removeComponentsByType(this._componentsMap[t])},n._updateComponents=function(t){for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];!n.started&&(n._start(t),n.started=!0),n.enable&&n._update(t)}},n._lateUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._lateUpdate(t)}},n._preRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._preRenderUpdate(t)}},n._postRenderUpdateComponents=function(t){for(var e=0;e<this._components.length;e++){var i=this._components[e];!i.started&&(i._start(t),i.started=!0),i.enable&&i._postRenderUpdate(t)}},s(0,n,"_loaded",null,(function(t){this.__loaded=t})),s(0,n,"fogColor",(function(){return this._fogColor}),(function(t){this._fogColor=t,this._shaderValues.setValue(0,t.elements)})),s(0,n,"enableFog",(function(){return this._enableFog}),(function(t){this._enableFog!==t&&((this._enableFog=t)?(this.addShaderDefine(Te.SHADERDEFINE_FOG),this.removeShaderDefine(Te.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(Te.SHADERDEFINE_FOG))})),s(0,n,"url",(function(){return this._url})),s(0,n,"loaded",(function(){return this.__loaded})),s(0,n,"enableDepthFog",(function(){return this._enableDepthFog}),(function(t){this._enableDepthFog!=t&&((this._enableDepthFog=t)?(this.addShaderDefine(Te.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(Te.SHADERDEFINE_FOG)):this.removeShaderDefine(Te.SAHDERDEFINE_DEPTHFOG))})),s(0,n,"fogStart",(function(){return this._fogStart}),(function(t){this._fogStart=t,this._shaderValues.setValue(1,t)})),s(0,n,"fogRange",(function(){return this._fogRange}),(function(t){this._fogRange=t,this._shaderValues.setValue(2,t)})),s(0,n,"ambientColor",(function(){return this._ambientColor}),(function(t){this._ambientColor=t,this._shaderValues.setValue(21,t.elements)})),s(0,n,"scene",(function(){return this})),s(0,n,"renderableSprite3Ds",(function(){return this._renderableSprite3Ds.slice()})),e._sortScenes=function(t,n){if(t.parent!==i.stage||n.parent!==i.stage)return t.parent!==i.stage&&n.parent!==i.stage?e._sortScenes(t.parent,n.parent):t.parent===i.stage?-1:1;var r=i.stage._childs;return r.indexOf(t)-r.indexOf(n)},e.load=function(t){return i.loader.create(t,null,null,e)},e.FOGCOLOR=0,e.FOGSTART=1,e.FOGRANGE=2,e.LIGHTDIRECTION=3,e.LIGHTDIRCOLOR=4,e.POINTLIGHTPOS=5,e.POINTLIGHTRANGE=6,e.POINTLIGHTATTENUATION=7,e.POINTLIGHTCOLOR=8,e.SPOTLIGHTPOS=9,e.SPOTLIGHTDIRECTION=10,e.SPOTLIGHTSPOT=11,e.SPOTLIGHTRANGE=12,e.SPOTLIGHTATTENUATION=13,e.SPOTLIGHTCOLOR=14,e.SHADOWDISTANCE=15,e.SHADOWLIGHTVIEWPROJECT=16,e.SHADOWMAPPCFOFFSET=17,e.SHADOWMAPTEXTURE1=18,e.SHADOWMAPTEXTURE2=19,e.SHADOWMAPTEXTURE3=20,e.AMBIENTCOLOR=21,e.TIME=22,e}(C),Le=function(t){function e(t){e.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new te,this._shaderValues=new de,this._colliders=[],this._id=++e._uniqueIDCounter,this._transform=new be(this),this.name=t||"Sprite3D-"+e._nameNumberCounter++,this.layer=O.currentCreationLayer,this.active=!0}r(e,"laya.d3.core.Sprite3D",Ie);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),n._setUrl=function(t){this._url=t},n._getGroup=function(){return this._group},n._setGroup=function(t){this._group=t},n._addChild3D=function(t){t.transform.parent=this.transform,this._hierarchyAnimator&&(!t._hierarchyAnimator&&t._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!0,[t.name])),this._scene&&(t._setBelongScene(this._scene),this._activeInHierarchy&&t._active&&t._activeHierarchy())},n._removeChild3D=function(t){t.transform.parent=null,this._scene&&(this._activeInHierarchy&&t._active&&t._inActiveHierarchy(),t._setUnBelongScene()),this._hierarchyAnimator&&(t._hierarchyAnimator==this._hierarchyAnimator&&t._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(t,!1,[t.name]))},n._parseBaseCustomProps=function(t){var e=this.transform.localPosition;t.translate?(e.fromArray(t.translate),e.x*=100,e.y*=100,e.z*=100):e.elements.fill(0),this.transform.localPosition=e;var i=this.transform.localRotation;t.rotation?i.fromArray(t.rotation):i.fromArray([0,0,0,-1]),this.transform.localRotation=i;var n=this.transform.localScale;t.scale?n.fromArray(t.scale):n.elements.fill(1),this.transform.localScale=n;var r=t.layer;null!=r&&(this.layer=O.getLayerByNumber(r))},n._parseCustomComponent=function(t,e,i){for(var n in i){var r=i[n];switch(n){case"Animator":var s=this.addComponent(Animator);if(r.avatarPath)s.avatar=g.getRes(e[r.avatarPath]);else{var a=r.avatar;if(a){s.avatar=g.getRes(e[a.path]);var o=a.linkSprites;o&&t.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[s,o])}}for(var h=r.clipPaths,l=h.length,c=0;c<l;c++)s.addClip(g.getRes(e[h[c]]));s.clip=g.getRes(e[h[0]]);var u=r.playOnWake;void 0!==u&&(s.playOnWake=u);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var d=this.addComponent(SphereCollider);d.isTrigger=r.isTrigger;var _=d.center;_.fromArray(r.center),d.center=_,d.radius=r.radius;break;case"BoxCollider":var f=this.addComponent(BoxCollider);f.isTrigger=r.isTrigger,f.center.fromArray(r.center);var p=f.size;p.fromArray(r.size),f.size=p;break;case"MeshCollider":this.addComponent(MeshCollider)}}},n._onRootNodeHierarchyLoaded=function(t,e){for(var i in e){for(var n=this,r=e[i],s=0,a=r.length;s<a;s++){var o=r[s];if(""===o)break;if(!(n=n.getChildByName(o)))break}n&&t.linkSprite3DToAvatarNode(i,n)}},n._setHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(t);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}},n._clearHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(e);for(var i=0,n=this._childs.length;i<n;i++){var r=this._childs[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}},n._getAnimatorToLinkSprite3D=function(t,e,i){var n=this.getComponentByType(Animator);if(n&&(n.avatar?n.avatar._version||t._setAnimatorToLinkAvatar(n,e):t._setAnimatorToLinkSprite3DNoAvatar(n,e,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._getAnimatorToLinkSprite3D(t,e,i)}},n._setAnimatorToLinkSprite3DNoAvatar=function(t,e,i){var n=0,r=0;for(n=0,r=t.getClipCount();n<r;n++)t._handleSpriteOwnersBySprite(n,e,i,this);for(n=0,r=this._childs.length;n<r;n++){var s=this._childs[n],a=i.length;i.push(s.name),s._setAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(a,1)}},n._changeHierarchyAnimator=function(t){this._hierarchyAnimator=t},n._isLinkSpriteToAnimationNode=function(t,e,i){var n=t._avatarNodes.indexOf(e),r=t._cacheSpriteToNodesMap;if(i)this._transform.dummy=e.transform,t._cacheNodesToSpriteMap[n]=r.length,r.push(n);else{this._transform.dummy=null;var s=t._cacheNodesToSpriteMap[n];t._cacheNodesToSpriteMap[n]=null,r.splice(s,1)}},n._setBelongScene=function(t){this._scene=t;for(var e=0,i=this._childs.length;e<i;e++)this._childs[e]._setBelongScene(t)},n._setUnBelongScene=function(){this._scene=null;for(var t=0,e=this._childs.length;t<e;t++)this._childs[t]._setUnBelongScene()},n._activeHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++)this._layer._addCollider(this._colliders[t]);for(this.event("activeinhierarchychanged",!0),t=0,e=this._childs.length;t<e;t++){var i=this._childs[t];i._active&&i._activeHierarchy()}},n._inActiveHierarchy=function(){var t=0,e=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),t=0,e=this._colliders.length;t<e;t++){var i=this._colliders[t];i._clearCollsionMap(),this._layer._removeCollider(i)}for(this.event("activeinhierarchychanged",!1),t=0,e=this._childs.length;t<e;t++){var n=this._childs[t];n._active&&n._inActiveHierarchy()}},n.addComponent=function(t){var e,i=this._componentsMap.indexOf(t);if(-1===i)e=[],this._componentsMap.push(t),this._typeComponentsIndices.push(e);else if(e=this._typeComponentsIndices[i],this._components[e[0]].isSingleton)throw new Error("无法单实例创建"+t+"组件，"+t+"组件已存在！");var n=_.getInstance(t);return e.push(this._components.length),this._components.push(n),n instanceof laya.d3.component.Script&&this._scripts.push(n),n._initialize(this),n},n._removeComponent=function(t,e){var i,n=0,r=this._typeComponentsIndices[t],s=r[e],a=this._components[s];for(a instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(a),1),r.splice(e,1),0===r.length&&(this._typeComponentsIndices.splice(t,1),this._componentsMap.splice(t,1)),n=0,i=this._componentsMap.length;n<i;n++)for(var o=(r=this._typeComponentsIndices[n]).length-1;0<=o;o--){var h=r[o];if(!(s<h))break;r[o]=--h}a._destroy()},n._clearSelfRenderObjects=function(){},n._addSelfRenderObjects=function(){},n._parseCustomProps=function(t,e,i,n){},n._updateChilds=function(t){var e=this._childs.length;if(0!==e)for(var i=0;i<e;++i)this._childs[i]._update(t)},n._getSortID=function(t,e){return 1e3*e.id+t._getVertexBuffer().vertexDeclaration.id},n._update=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._lateUpdateComponents(t),M.spriteCount++,this._childs.length&&this._updateChilds(t))},n.getProjectionViewWorldMatrix=function(t){return te.multiply(t,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},n.loadHierarchy=function(t){this.addChild(laya.d3.core.Sprite3D.load(t))},n.addChildAt=function(t,e){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),0<=e&&e<=this._childs.length){if(t._parent===this){var i=this.getChildIndex(t);this._childs.splice(i,1),this._childs.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===y.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,e),(t.parent=this)._addChild3D(t);return t}throw new Error("appendChildAt:The index is out of bounds")},n.addChild=function(t){if(!(t instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var e=this.getChildIndex(t);e!==this._childs.length-1&&(this._childs.splice(e,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===y.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),(t.parent=this)._childChanged(),this._addChild3D(t);return t},n.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._removeChild3D(e),this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},n.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._childs&&0<this._childs.length){var i=this._childs;if(0===t&&s<=e){var n=i;this._childs=y.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,s=n.length;r<s;r++)this._removeChild3D(n[r]),n[r].parent=null,this.conchModel&&this.conchModel.removeChild(n[r].conchModel)}return this},n.onAsynLoaded=function(t,e,i){var n=e[0];if("Sprite3D"!==n.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var r=e[1];me._createNodeByJson(this,n,this,r),this.event("hierarchyloaded",[this]),this.__loaded=!0},n.cloneTo=function(t){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var e=t;e.name=this.name,e._destroyed=this._destroyed,e.timer=this.timer,e._$P=this._$P,e.active=this._active;var i=e.transform.localPosition;this.transform.localPosition.cloneTo(i),e.transform.localPosition=i;var n=e.transform.localRotation;this.transform.localRotation.cloneTo(n),e.transform.localRotation=n;var r=e.transform.localScale;this.transform.localScale.cloneTo(r),e.transform.localScale=r,e.isStatic=this.isStatic;var s=0,a=0;for(s=0,a=this._componentsMap.length;s<a;s++){var o=e.addComponent(this._componentsMap[s]);this._components[s]._cloneTo(o)}for(s=0,a=this._childs.length;s<a;s++)e.addChild(this._childs[s].clone());var h=e.getComponentByType(Animator);if(h){var l=h._linkSpritesData;if(l)for(var c in l){for(var u=l[c],d=e,_=0,f=u.length;_<f&&(d=d.getChildByName(u[_]));_++);if(d){var p=h._avatarNodeMap[c];d._isLinkSpriteToAnimationNode(h,p,!0)}}}},n.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},n.destroy=function(t){if(void 0===t&&(t=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,t);var e,i=0;for(i=0,e=this._components.length;i<e;i++)this._components[i]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,g.clearRes(this.url),this.loaded||ge._cancelLoadByUrl(this.url)}},n._handleSpriteToAvatar=function(t,e){t._avatarNodes;var i=t._avatarNodeMap[this.name];i&&i.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(t,i,e)},n._setAnimatorToLinkAvatar=function(t,e){this._handleSpriteToAvatar(t,e);for(var i=0,n=this._childs.length;i<n;i++)this._childs[i]._setAnimatorToLinkAvatar(t,e)},s(0,n,"activeInHierarchy",(function(){return this._activeInHierarchy})),s(0,n,"_loaded",null,(function(t){this.__loaded=t})),s(0,n,"active",(function(){return this._active}),(function(t){this._active!==t&&(this._active=t,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(t?this._activeHierarchy():this._inActiveHierarchy()))})),s(0,n,"componentsCount",(function(){return this._components.length})),s(0,n,"loaded",(function(){return this.__loaded})),s(0,n,"id",(function(){return this._id})),s(0,n,"url",(function(){return this._url})),s(0,n,"layer",(function(){return this._layer}),(function(t){if(this._layer!==t){if(!t)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var e=0,i=this._colliders.length;if(this._layer)for(e=0;e<i;e++)this._layer._removeCollider(this._colliders[e]);for(e=0;e<i;e++)t._addCollider(this._colliders[e])}this._layer=t,this.event("layerchanged",t)}})),s(0,n,"scene",(function(){return this._scene})),s(0,n,"transform",(function(){return this._transform})),e.instantiate=function(t,e,i,n,r){void 0===i&&(i=!0);var s=t.clone();e&&e.addChild(s);var a=s.transform;if(i){var o=a.worldMatrix;t.transform.worldMatrix.cloneTo(o),a.worldMatrix=o}else n&&(a.position=n),r&&(a.rotation=r);return s},e.load=function(t){return i.loader.create(t,null,null,e)},e.WORLDMATRIX=0,e.MVPMATRIX=1,e._uniqueIDCounter=0,e._nameNumberCounter=0,e}(),Be=function(t){function e(t,i,n,r,s,a,o,h,l,c){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],e.__super.call(this),!t||!i)throw"Shader Error";this._id=++e._count,this._vs=t,this._ps=i,this._attributeMap=n,this._sceneUniformMap=r,this._cameraUniformMap=s,this._spriteUniformMap=a,this._materialUniformMap=o,this._renderElementUniformMap=h,this._precompile=l,this._define=c,this._precompile&&e.extCompileObj&&e.extCompileFunc?e.extCompileFunc.call(e.extCompileObj,t,i,c):this.recreateResource()}r(e,"laya.d3.shader.Shader3D",l);var i=e.prototype;return i.recreateResource=function(){c.now(),this._compile(),this.completeCreate(),this.memorySize=0},i.disposeResource=function(){D.mainContext.deleteShader(this._vshader),D.mainContext.deleteShader(this._pshader),D.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},i._compile=function(){if(!D.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var t=[this._vs,this._ps],i=D.mainContext;if(this._program=i.createProgram(),this._vshader=e._createShader(i,t[0],35633),this._pshader=e._createShader(i,t[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),!x.isConchApp&&Te.debugMode&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var n,r,s=0,a=0;for(r=x.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35721):i.getProgramParameter(this._program,35721),s=0;s<r;s++){var o=null;n={vartype:"attribute",ivartype:0,attrib:o=x.isConchApp?i.getActiveAttribEx(this._vs,this._ps,"",s):i.getActiveAttrib(this._program,s),location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(n)}var h;for(h=x.isConchApp?i.getProgramParameterEx(this._vs,this._ps,"",35718):i.getProgramParameter(this._program,35718),s=0;s<h;s++){var l;l=x.isConchApp?i.getActiveUniformEx(this._vs,this._ps,"",s):i.getActiveUniform(this._program,s),0<(n={vartype:"uniform",ivartype:1,attrib:o,location:i.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=i.getUniformLocation(this._program,n.name)),this._uniformParams.push(n)}for(s=0,a=this._attributeParams.length;s<a;s++)(n=this._attributeParams[s]).indexOfParams=s,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=null!=this._attributeMap[n.codename]?this._attributeMap[n.codename]:n.codename,this._attributeParamsMap.push(n.name),this._attributeParamsMap.push(n),n._this=this,n.uploadedValue=[],n.fun=this._attribute;for(s=0,a=this._uniformParams.length;s<a;s++)switch((n=this._uniformParams[s]).indexOfParams=s,n.index=1,n.value=[n.location,null],n.codename=n.name,null!=this._sceneUniformMap[n.codename]?(n.name=this._sceneUniformMap[n.codename],this._sceneUniformParamsMap.push(n.name),this._sceneUniformParamsMap.push(n)):null!=this._cameraUniformMap[n.codename]?(n.name=this._cameraUniformMap[n.codename],this._cameraUniformParamsMap.push(n.name),this._cameraUniformParamsMap.push(n)):null!=this._spriteUniformMap[n.codename]?(n.name=this._spriteUniformMap[n.codename],this._spriteUniformParamsMap.push(n.name),this._spriteUniformParamsMap.push(n)):null!=this._materialUniformMap[n.codename]?(n.name=this._materialUniformMap[n.codename],this._materialUniformParamsMap.push(n.name),this._materialUniformParamsMap.push(n)):null!=this._renderElementUniformMap[n.codename]?(n.name=this._renderElementUniformMap[n.codename],this._renderElementUniformParamsMap.push(n.name),this._renderElementUniformParamsMap.push(n)):console.log("Shader:can't find uinform name:"+n.codename+" in shader file."),n._this=this,n.uploadedValue=[],n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:n.fun=this._uinformMatrix2fv;break;case 35675:n.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},i._attribute=function(t,e){var i=D.mainContext,n=u._enableAtributes,r=t.location;return n[r]||i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e[0],e[1],e[2],e[3],e[4]),n[r]=u._bindVertexBuffer,1},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(D.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(D.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return D.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(D.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(D.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return D.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(D.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return D.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(D.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return D.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return D.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return D.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return D.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uinformMatrix2fv=function(t,e){return D.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uinformMatrix3fv=function(t,e){return D.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(D.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return D.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(D.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return D.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(D.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return D.mainContext.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(D.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return D.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,i){var n=i.source||i.defaulteTexture.source,r=D.mainContext,s=t.uploadedValue;if(null!=s[0])return r.activeTexture(e._TEXTURES[s[0]]),n&&P.bindTexture(r,3553,n),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return s[0]=this._curActTexIndex,r.uniform1i(t.location,this._curActTexIndex),r.activeTexture(e._TEXTURES[this._curActTexIndex]),n&&P.bindTexture(r,3553,n),this._curActTexIndex++,1},i._uniform_samplerCube=function(t,i){var n=i.source||i.defaulteTexture.source,r=D.mainContext,s=t.uploadedValue;if(null!=s[0])return r.activeTexture(e._TEXTURES[s[0]]),n?P.bindTexture(r,34067,n):P.bindTexture(r,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return s[0]=this._curActTexIndex,r.uniform1i(t.location,this._curActTexIndex),r.activeTexture(e._TEXTURES[this._curActTexIndex]),n?P.bindTexture(r,34067,n):P.bindTexture(r,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},i._noSetValue=function(t){console.log("no....:"+t.name)},i.bind=function(){return l.activeShader=this,(l.bindShader=this).activeResource(),P.UseProgram(this._program)},i.uploadAttributes=function(t,e){for(var i,n,r=0,s=0,a=this._attributeParamsMap.length;s<a;s+=2)n=this._attributeParamsMap[s+1],null!=(i=t[this._attributeParamsMap[s]])&&(e&&e[n.name]&&e[n.name].bind(),r+=n.fun.call(this,n,i));M.shaderCall+=r},i.uploadAttributesX=function(t,e){for(var i,n,r=0,s=0,a=this._attributeParamsMap.length;s<a;s+=2)n=this._attributeParamsMap[s+1],null!=(i=t[this._attributeParamsMap[s]])&&(e._bind(),r+=n.fun.call(this,n,i));M.shaderCall+=r},i.uploadSceneUniforms=function(t){for(var e,i,n=0,r=0,s=this._sceneUniformParamsMap.length;r<s;r+=2)i=this._sceneUniformParamsMap[r+1],null!=(e=t[this._sceneUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},i.uploadCameraUniforms=function(t){for(var e,i,n=0,r=0,s=this._cameraUniformParamsMap.length;r<s;r+=2)i=this._cameraUniformParamsMap[r+1],null!=(e=t[this._cameraUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},i.uploadSpriteUniforms=function(t){for(var e,i,n=0,r=0,s=this._spriteUniformParamsMap.length;r<s;r+=2)i=this._spriteUniformParamsMap[r+1],null!=(e=t[this._spriteUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},i.uploadMaterialUniforms=function(t){for(var e,i,n=0,r=0,s=this._materialUniformParamsMap.length;r<s;r+=2)i=this._materialUniformParamsMap[r+1],null!=(e=t[this._materialUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},i.uploadRenderElementUniforms=function(t){for(var e,i,n=0,r=0,s=this._renderElementUniformParamsMap.length;r<s;r+=2)i=this._renderElementUniformParamsMap[r+1],null!=(e=t[this._renderElementUniformParamsMap[r]])&&(n+=i.fun.call(this,i,e));M.shaderCall+=n},e.create=function(t,i,n,r,s,a,o,h,l,c){return new e(t,i,n,r,s,a,o,h,l,c)},e.addInclude=function(t,e){T.addInclude(t,e)},e._createShader=function(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),Te.debugMode&&!t.getShaderParameter(n,35713))throw t.getShaderInfoLog(n);return n},e.PERIOD_RENDERELEMENT=0,e.PERIOD_MATERIAL=1,e.PERIOD_SPRITE=2,e.PERIOD_CAMERA=3,e.PERIOD_SCENE=4,e._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],e._count=0,e._preCompile=!1,e.extCompileFunc=null,e.extCompileObj=null,n(e,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new I}]),e}(),Oe=function(t){function e(){this._transformUV=null,e.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new ae(.6,.6,.6)),this._setColor(10,new ae(1,1,1)),this._setColor(11,new oe(1,1,1,8)),this._setColor(12,new ae(1,1,1)),this._setColor(7,new oe(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new oe(1,1,0,0)),this.renderMode=1}r(e,"laya.d3.core.material.StandardMaterial",t);var a=e.prototype;return a.disableLight=function(){this._addDisablePublicShaderDefine(Te.SHADERDEFINE_POINTLIGHT|Te.SHADERDEFINE_SPOTLIGHT|Te.SHADERDEFINE_DIRECTIONLIGHT)},a.disableFog=function(){this._addDisablePublicShaderDefine(Te.SHADERDEFINE_FOG)},a.onAsynLoaded=function(i,n,r){var s=n[0];if(s.version)t.prototype.onAsynLoaded.call(this,i,n,r);else{var a=n[1],o=s.props;for(var h in o)this[h]=o[h];e._parseStandardMaterial(a,this,s),this._endLoaded()}},a.cloneTo=function(e){t.prototype.cloneTo.call(this,e);var i=e;this._transformUV&&(i._transformUV=this._transformUV.clone())},s(0,a,"ambientColor",(function(){return this._getColor(9)}),(function(t){this._setColor(9,t)})),s(0,a,"ambientTexture",(function(){return this._getTexture(5)}),(function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,t)})),s(0,a,"renderMode",null,(function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(e.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(t)})),s(0,a,"reflectColor",(function(){return this._getColor(12)}),(function(t){this._setColor(12,t)})),s(0,a,"tilingOffset",(function(){return this._getColor(15)}),(function(t){if(t){var e=t.elements;1!=e[0]||1!=e[1]||0!=e[2]||0!=e[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,t)})),s(0,a,"albedo",(function(){return this._getColor(7)}),(function(t){this._setColor(7,t)})),s(0,a,"diffuseColor",(function(){return this._getColor(10)}),(function(t){this._setColor(10,t)})),s(0,a,"albedoColor",(function(){return this._getColor(7)}),(function(t){this._setColor(7,t)})),s(0,a,"specularColor",(function(){return this._getColor(11)}),(function(t){this._setColor(11,t)})),s(0,a,"diffuseTexture",(function(){return this._getTexture(1)}),(function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,t)})),s(0,a,"normalTexture",(function(){return this._getTexture(2)}),(function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,t)})),s(0,a,"specularTexture",(function(){return this._getTexture(3)}),(function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,t)})),s(0,a,"emissiveTexture",(function(){return this._getTexture(4)}),(function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,t)})),s(0,a,"reflectTexture",(function(){return this._getTexture(6)}),(function(t){t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,t)})),s(0,a,"transformUV",(function(){return this._transformUV}),(function(t){this._transformUV=t,this._setMatrix4x4(13,t.matrix),t?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,t.matrix.elements,0)})),e.__init__=function(){e.SHADERDEFINE_DIFFUSEMAP=e.shaderDefines.registerDefine("DIFFUSEMAP"),e.SHADERDEFINE_NORMALMAP=e.shaderDefines.registerDefine("NORMALMAP"),e.SHADERDEFINE_SPECULARMAP=e.shaderDefines.registerDefine("SPECULARMAP"),e.SHADERDEFINE_EMISSIVEMAP=e.shaderDefines.registerDefine("EMISSIVEMAP"),e.SHADERDEFINE_AMBIENTMAP=e.shaderDefines.registerDefine("AMBIENTMAP"),e.SHADERDEFINE_REFLECTMAP=e.shaderDefines.registerDefine("REFLECTMAP"),e.SHADERDEFINE_UVTRANSFORM=e.shaderDefines.registerDefine("UVTRANSFORM"),e.SHADERDEFINE_TILINGOFFSET=e.shaderDefines.registerDefine("TILINGOFFSET"),e.SHADERDEFINE_ADDTIVEFOG=e.shaderDefines.registerDefine("ADDTIVEFOG")},e.load=function(t){return i.loader.create(t,null,null,e)},e._parseStandardMaterial=function(t,e,i){var n=i.customProps,r=n.ambientColor;e.ambientColor=new ae(r[0],r[1],r[2]);var s=n.diffuseColor;e.diffuseColor=new ae(s[0],s[1],s[2]);var a=n.specularColor;e.specularColor=new oe(a[0],a[1],a[2],a[3]);var o=n.reflectColor;e.reflectColor=new ae(o[0],o[1],o[2]);var h=n.albedoColor;h&&(e.albedo=new oe(h[0],h[1],h[2],h[3]));var l=n.diffuseTexture.texture2D;l&&(e.diffuseTexture=g.getRes(t[l]));var c=n.normalTexture.texture2D;c&&(e.normalTexture=g.getRes(t[c]));var u=n.specularTexture.texture2D;u&&(e.specularTexture=g.getRes(t[u]));var d=n.emissiveTexture.texture2D;d&&(e.emissiveTexture=g.getRes(t[d]));var _=n.ambientTexture.texture2D;_&&(e.ambientTexture=g.getRes(t[_]));var f=n.reflectTexture.texture2D;f&&(e.reflectTexture=g.getRes(t[f]))},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_OPAQUEDOUBLEFACE=2,e.RENDERMODE_CUTOUT=3,e.RENDERMODE_CUTOUTDOUBLEFACE=4,e.RENDERMODE_TRANSPARENT=13,e.RENDERMODE_TRANSPARENTDOUBLEFACE=14,e.RENDERMODE_ADDTIVE=15,e.RENDERMODE_ADDTIVEDOUBLEFACE=16,e.RENDERMODE_DEPTHREAD_TRANSPARENT=5,e.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,e.RENDERMODE_DEPTHREAD_ADDTIVE=7,e.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,e.RENDERMODE_NONDEPTH_TRANSPARENT=9,e.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,e.RENDERMODE_NONDEPTH_ADDTIVE=11,e.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,e.SHADERDEFINE_DIFFUSEMAP=0,e.SHADERDEFINE_NORMALMAP=0,e.SHADERDEFINE_SPECULARMAP=0,e.SHADERDEFINE_EMISSIVEMAP=0,e.SHADERDEFINE_AMBIENTMAP=0,e.SHADERDEFINE_REFLECTMAP=0,e.SHADERDEFINE_UVTRANSFORM=0,e.SHADERDEFINE_TILINGOFFSET=0,e.SHADERDEFINE_ADDTIVEFOG=0,e.DIFFUSETEXTURE=1,e.NORMALTEXTURE=2,e.SPECULARTEXTURE=3,e.EMISSIVETEXTURE=4,e.AMBIENTTEXTURE=5,e.REFLECTTEXTURE=6,e.ALBEDO=7,e.UVANIAGE=8,e.MATERIALAMBIENT=9,e.MATERIALDIFFUSE=10,e.MATERIALSPECULAR=11,e.MATERIALREFLECT=12,e.UVMATRIX=13,e.UVAGE=14,e.TILINGOFFSET=15,n(e,["defaultMaterial",function(){var t=new e;return t.lock=!0,this.defaultMaterial=t},"shaderDefines",function(){return this.shaderDefines=new ce(Ee.shaderDefines)}]),e}(Ee),Fe=function(t){function e(t,i,n,r,s){var a;if(this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===n&&(n=35044),void 0===r&&(r=!1),e.__super.call(this),this._indexType=t,this._indexCount=i,this._bufferUsage=n,this._bufferType=34963,this._canRead=r,"ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}a=this._indexTypeByteCount*i,this._byteLength=a,this._bind(),u._gl.bufferData(this._bufferType,a,this._bufferUsage),this.uri=s,r?("ushort"==t?this._buffer=new Uint16Array(i):"ubyte"==t&&(this._buffer=new Uint8Array(i)),this.memorySize=2*a):this.memorySize=a}r(e,"laya.d3.graphics.IndexBuffer3D",t);var i=e.prototype;return i.setData=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var r=0;if("ushort"==this._indexType?(r=2,0===i&&4294967295===n||(t=new Uint16Array(t.buffer,i*r,n))):"ubyte"==this._indexType&&(r=1,0===i&&4294967295===n||(t=new Uint8Array(t.buffer,i*r,n))),this._bind(),u._gl.bufferSubData(this._bufferType,e*r,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var s=this._buffer.length-e;s<n&&(n=s);for(var a=0;a<n;a++)this._buffer[e+a]=t[a]}else this._buffer=t},i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},s(0,i,"indexType",(function(){return this._indexType})),s(0,i,"indexTypeByteCount",(function(){return this._indexTypeByteCount})),s(0,i,"indexCount",(function(){return this._indexCount})),s(0,i,"canRead",(function(){return this._canRead})),e.INDEXTYPE_UBYTE="ubyte",e.INDEXTYPE_USHORT="ushort",e.create=function(t,i,n,r,s){return void 0===n&&(n=35044),void 0===r&&(r=!1),new e(t,i,n,r,s)},e}(u),ke=function(t){function e(t,i,n,r,s){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===r&&(r=!1),e.__super.call(this),this._vertexDeclaration=t,this._vertexCount=i,this._bufferUsage=n,this._bufferType=34962,this._canRead=r,this.uri=s,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*i,this._bind(),u._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),r&&(this._buffer=new Float32Array(this._byteLength/4))}r(e,"laya.d3.graphics.VertexBuffer3D",t);var i=e.prototype;return i.bindWithIndexBuffer=function(t){t&&t._bind(),this._bind()},i.setData=function(t,e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),0===i&&4294967295===n||(t=new Float32Array(t.buffer,4*i,n)),this._bind(),u._gl.bufferSubData(this._bufferType,4*e,t),this._canRead)if(0!==e||0!==i||4294967295!==n){var r=this._buffer.length-e;r<n&&(n=r);for(var s=0;s<n;s++)this._buffer[e+s]=t[s]}else this._buffer=t},i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},i.disposeResource=function(){for(var e=D.mainContext,i=this._vertexDeclaration.getVertexElements(),n=u._enableAtributes,r=0,s=i.length;r<s;r++)n[r]===this._glBuffer&&(e.disableVertexAttribArray(r),n[r]=null);t.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},s(0,i,"vertexDeclaration",(function(){return this._vertexDeclaration})),s(0,i,"vertexCount",(function(){return this._vertexCount})),s(0,i,"canRead",(function(){return this._canRead})),e.create=function(t,i,n,r,s){return void 0===n&&(n=35044),void 0===r&&(r=!1),new e(t,i,n,r,s)},e}(u),Ve=function(t){function e(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,e.__super.call(this),this._type=3553}r(e,"laya.d3.resource.DataTexture2D",Ae);var a=e.prototype;return a.genDebugMipmaps=function(){var t=[];return t.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),t.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),t.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),t.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),t.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),t.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),t.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),t.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),t.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),t.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),t},a._onTextureLoaded=function(t){},a._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var t=D.mainContext,i=this._source=t.createTexture(),n=this._width,r=this._height,s=P.curBindTexTarget,a=P.curBindTexValue,h=!1;if(P.bindTexture(t,this._type,i),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var l=0;t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var c=0;c<this._mipmaps.length;c++){if(this._mipmaps[c].byteLength!=u*d*4)throw"mipmap size error  level:"+c;t.texSubImage2D(this._type,0,e.simLodRect[l++],e.simLodRect[l++],e.simLodRect[l++],e.simLodRect[l++],6408,5121,new Uint8Array(this._mipmaps[c]))}this.minFifter=9729,this.magFifter=9729}else{var u=this._width,d=this._height;for(l=0,t.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),c=0;c<this._mipmaps.length;c++){if(this._mipmaps[c].byteLength!=u*d*4)throw"mipmap size error  level:"+c;t.texImage2D(this._type,c,6408,u,d,0,6408,5121,new Uint8Array(this._mipmaps[c])),(u/=2)<1&&(u=1),(d/=2)<1&&(d=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var _=0,f=!1,p=!1;this._buffer.byteLength==4*n*r?(_=6408,f=!0):this._buffer.byteLength==3*n*r?(_=6407,p=!0):_=this._format,f||p?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),p&&t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(this._type,0,_,n,r,0,_,5121,this._buffer)):t&&_==t.ALPHA?(t.texImage2D(3553,0,_,n,r,0,_,t.UNSIGNED_BYTE,this._buffer),h=!0):0!=_&&(t.compressedTexImage2D(3553,0,_,n,r,0,this._buffer),h=!0)}var m=this._minFifter,g=this._magFifter,v=0==this._wrapModeU?10497:33071,y=0==this._wrapModeV?10497:33071,x=o.isPOT(n,r);x?(this._mipmap||this._mipmaps?-1!==m||(m=9987):-1!==m||(m=9729),-1!==g||(g=9729),t.texParameteri(this._type,10241,m),t.texParameteri(this._type,10240,g),t.texParameteri(this._type,10242,v),t.texParameteri(this._type,10243,y),this._mipmap&&t.generateMipmap(this._type)):(-1!==m||(m=9729),-1!==g||(g=9729),t.texParameteri(this._type,10241,m),t.texParameteri(this._type,10240,g),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),s&&a&&P.bindTexture(t,s,a),this.memorySize=h?this._buffer.length:x?n*r*4*(1+1/3):n*r*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},a.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else this._recreateLock=!0},a.onAsynLoaded=function(t,e,i){var n;i&&(n=i[0].call(this,e)),n&&(this._width=n.width,this._height=n.height,this._buffer=n.data),this._src=t,this._size=new pe(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},a.getPixels=function(){return new Uint8Array(this._buffer)},a.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(D.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},s(0,a,"src",(function(){return this._src})),e.create=function(t,i,n,r,s,a,o){if(void 0===r&&(r=9729),void 0===s&&(s=9729),void 0===a&&(a=!0),!t||t.byteLength<i*n*4)throw"DataTexture2D create error";var h=new e;return h.uri=o,h._buffer=t,h._width=i,h._height=n,h._mipmap=a,h._magFifter=r,h._minFifter=s,h._size=new pe(h._width,h._height),h._conchTexture?alert("怎么给runtime传递datatexture数据"):h.activeResource(),h},e.load=function(t,n,r,s,a){if(void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=9729),void 0===a&&(a=9729),"mipmaps"===A.getFileExtension(t)){var o=i.loader.create(t,null,null,e,[function(t){this._mipmaps=[];var e=new Uint32Array(t);this._width=e[0];var i=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,i=1024),this._width!=i)throw"现在只支持512x256的环境贴图。当前的是"+e[0];this._height=e[1];for(var n=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,r=this._height,s=8;;){var a=n*r*4;if(s+a>t.byteLength)throw"load mipmaps data size error ";var o=new Uint8Array(t,s,a);if(this._mipmaps.push(o),s+=a,1==n&&1==r)break;(n/=2)<1&&(n=1),(r/=2)<1&&(r=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){o.simLodInfo=new Float32Array(40);for(var h=0;h<o.simLodInfo.length;)o.simLodInfo[h]=(e.simLodRect[h]+.5)/1024,h++,o.simLodInfo[h]=(e.simLodRect[h]+.5)/256,h++,o.simLodInfo[h]=Math.max(e.simLodRect[h]-1,.1)/1024,h++,o.simLodInfo[h]=Math.max(e.simLodRect[h]-1.5,.1)/256,h++}return o}if("number"==typeof n)return i.loader.create(t,null,null,e,[function(t){return this._width=n,this._height=r,this._buffer=t,null}]);if("function"==typeof n)return i.loader.create(t,null,null,e,[n]);throw new Error("unknown params.")},e.lodasatlas=!1,n(e,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),e}(),Ue=function(t){function e(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,e.__super.call(this)}r(e,"laya.d3.resource.models.PrimitiveMesh",De);var n=e.prototype;return i.imps(n,{"laya.d3.core.render.IRenderable":!0}),n._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},n._getVertexBuffers=function(){return null},n._getIndexBuffer=function(){return this._indexBuffer},n._getPositions=function(){var t,e=[],i=this._vertexBuffer.vertexDeclaration.getVertexElements(),n=0;for(n=0;n<i.length;n++){var r=i[n];if("vector3"===r.elementFormat&&0===r.elementUsage){t=r;break}}var s=this._vertexBuffer.getData();for(n=0;n<s.length;n+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var a=n+t.offset/4,o=new ae(s[a+0],s[a+1],s[a+2]);e.push(o)}return e},n.getRenderElement=function(t){return this},n.getRenderElementsCount=function(){return 1},n.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},n._beforeRender=function(t){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},n._render=function(t){D.mainContext.drawElements(4,this._numberIndices,5123,0),M.drawCall++,M.trianglesFaces+=this._numberIndices/3},s(0,n,"_vertexBufferCount",(function(){return 1})),s(0,n,"triangleCount",(function(){return this._indexBuffer.indexCount/3})),e}(),He=function(t){function e(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,e.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}r(e,"laya.d3.resource.models.Mesh",De);var n=e.prototype;return n._getPositions=function(){var t,e,i,n,r,s=[],a=0,o=0,h=0;if(0!==this._vertexBuffers.length){var l=this._vertexBuffers.length;for(a=0;a<l;a++){for(i=(t=this._vertexBuffers[a]).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)h=o+e.offset/4,s.push(new ae(r[h+0],r[h+1],r[h+2]))}}else{var c=this._subMeshes.length;for(a=0;a<c;a++){for(i=(t=this._subMeshes[a]._getVertexBuffer()).vertexDeclaration.getVertexElements(),o=0;o<i.length;o++)if("vector3"===(n=i[o]).elementFormat&&0===n.elementUsage){e=n;break}for(r=t.getData(),o=0;o<r.length;o+=t.vertexDeclaration.vertexStride/4)h=o+e.offset/4,s.push(new ae(r[h+0],r[h+1],r[h+2]))}}return s},n._setSubMeshes=function(t){this._subMeshes=t,this._subMeshCount=t.length;for(var e=0;e<this._subMeshCount;e++)t[e]._indexInMesh=e;this._positions=this._getPositions(),this._generateBoundingObject()},n.onAsynLoaded=function(t,e,i){var n=e[0],r=e[1];Kt.read(n,this,this._materials,this._subMeshes,r),this.completeCreate(),this._endLoaded()},n.getSubMesh=function(t){return this._subMeshes[t]},n.getSubMeshCount=function(){return this._subMeshes.length},n.getRenderElementsCount=function(){return this._subMeshes.length},n.getRenderElement=function(t){return this._subMeshes[t]},n.disposeResource=function(){for(var t=0;t<this._subMeshes.length;t++)this._subMeshes[t].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},s(0,n,"materials",(function(){return this._materials.slice()})),s(0,n,"InverseAbsoluteBindPoses",(function(){return this._inverseBindPoses})),e.load=function(t){return i.loader.create(t,null,null,e)},e}(),ze=(function(t){function e(t,i,n,r,s,a,o,h,l){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===n&&(n=6408),void 0===r&&(r=5121),void 0===s&&(s=33189),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),e.__super.call(this),this._type=3553,this._width=t,this._height=i,this._size=new pe(t,i),this._surfaceFormat=n,this._surfaceType=r,this._depthStencilFormat=s,x.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=a,this._repeat=o,this._minFifter=h,this._magFifter=l,this.activeResource(),this._alreadyResolved=!0}r(e,"laya.d3.resource.RenderTexture",Ae);var n=e.prototype;n.recreateResource=function(){var t=D.mainContext;this._frameBuffer=t.createFramebuffer(),this._source=t.createTexture();var e=P.curBindTexTarget,i=P.curBindTexValue;P.bindTexture(t,this._type,this._source),t.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var n=this._minFifter,r=this._magFifter,s=this._repeat?10497:33071;if(o.isPOT(this._width,this._height)?(this._mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,s),t.texParameteri(this._type,10243,s),this._mipmap&&t.generateMipmap(this._type)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(this._type,10241,n),t.texParameteri(this._type,10240,r),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),e&&i&&P.bindTexture(t,e,i),t.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),t.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.framebufferTexture2D(36160,36064,3553,this._source,0),t.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},n.start=function(){D.mainContext.bindFramebuffer(36160,this.frameBuffer),(e._currentRenderTarget=this)._alreadyResolved=!1},n.end=function(){D.mainContext.bindFramebuffer(36160,null),e._currentRenderTarget=null,this._alreadyResolved=!0},n.getData=function(t,e,i,n){var r=D.mainContext;if(r.bindFramebuffer(36160,this._frameBuffer),36053!==r.checkFramebufferStatus(36160))return r.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._width*this._height*4);return r.readPixels(t,e,i,n,this._surfaceFormat,this._surfaceType,s),r.bindFramebuffer(36160,null),s},n.disposeResource=function(){if(this._frameBuffer){var t=D.mainContext;t.deleteTexture(this._source),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},s(0,n,"surfaceFormat",(function(){return this._surfaceFormat})),s(0,n,"surfaceType",(function(){return this._surfaceType})),s(0,n,"depthStencilFormat",(function(){return this._depthStencilFormat})),s(0,n,"source",(function(){return this._alreadyResolved?i.superGet(Ae,this,"source"):null})),s(0,n,"depthStencilBuffer",(function(){return this._depthStencilBuffer})),s(0,n,"frameBuffer",(function(){return this._frameBuffer})),e._currentRenderTarget=null}(),function(t){function e(t){this._color=null,this._pixels=null,e.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new pe(this.width,this.height),this._color=t,this._pixels=new Uint8Array([255*t.x,255*t.y,255*t.z,255*t.w]),this.uri="SolidColorTexture2D_"+this.id}r(e,"laya.d3.resource.SolidColorTexture2D",Ae);var i=e.prototype;return i._createWebGlTexture=function(){var t=D.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=P.curBindTexTarget,s=P.curBindTexValue;P.bindTexture(t,this._type,e),t.texImage2D(this._type,0,6408,i,n,0,6408,5121,this._pixels);var a=this._minFifter,h=this._magFifter,l=this._repeat?10497:33071,c=o.isPOT(i,n);c?(this._mipmap?-1!==a||(a=9987):-1!==a||(a=9729),-1!==h||(h=9729),t.texParameteri(this._type,10241,a),t.texParameteri(this._type,10240,h),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),this._mipmap&&t.generateMipmap(this._type)):(-1!==a||(a=9729),-1!==h||(h=9729),t.texParameteri(this._type,10241,a),t.texParameteri(this._type,10240,h),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&s&&P.bindTexture(t,r,s),this.memorySize=c?i*n*4*(1+1/3):i*n*4},i.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},i.disposeResource=function(){this._source&&(D.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},n(e,["magentaTexture",function(){var t=new e(new oe(1,0,1,1));return t.lock=!0,this.magentaTexture=t},"grayTexture",function(){var t=new e(new oe(.5,.5,.5,1));return t.lock=!0,this.grayTexture=t}]),e}()),We=function(e){function n(t,e,i,r){this._canRead=!1,this._image=null,this._pixels=null,void 0===t&&(t=!1),void 0===e&&(e=!0),void 0===i&&(i=6408),void 0===r&&(r=!0),n.__super.call(this),this._type=3553,this._repeat=e,this._canRead=t,this._format=i,this._mipmap=r}r(n,"laya.d3.resource.Texture2D",Ae);var a=n.prototype;return a._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=D.mainContext,e=this._source=t.createTexture(),i=this._width,n=this._height,r=P.curBindTexTarget,s=P.curBindTexValue;switch(P.bindTexture(t,this._type,e),this._format){case 6407:case 6408:this._canRead?t.texImage2D(this._type,0,this._format,i,n,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?t.texImage2D(this._type,0,this._image._format,i,n,0,this._image._format,5121,this._image.atlasSource):t.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case D.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var a=this._minFifter,h=this._magFifter,l=this._repeat?10497:33071,c=0==this._wrapModeU?10497:33071,u=0==this._wrapModeV?10497:33071,d=o.isPOT(i,n);d?(this._mipmap?-1!==a||(a=9987):-1!==a||(a=9729),-1!==h||(h=9729),t.texParameteri(this._type,10241,a),t.texParameteri(this._type,10240,h),t.texParameteri(this._type,10242,l),t.texParameteri(this._type,10243,l),t.texParameteri(this._type,10242,c),t.texParameteri(this._type,10243,u),this._mipmap&&t.generateMipmap(this._type)):(-1!==a||(a=9729),-1!==h||(h=9729),t.texParameteri(this._type,10241,a),t.texParameteri(this._type,10240,h),t.texParameteri(this._type,10242,33071),t.texParameteri(this._type,10243,33071)),r&&s&&P.bindTexture(t,r,s),this._image.onload=null,this._image=null,this.memorySize=d?i*n*4*(1+1/3):i*n*4},a.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},a.onAsynLoaded=function(e,i,n){if(n){var r=n[0];void 0!==r&&(this._canRead=r);var s=n[1];void 0!==s&&(this._repeat=s);var a=n[2];void 0!==a&&(this._format=a);var o=n[3];void 0!==o&&(this._mipmap=o);var h=n.wrapModeU;void 0!==h&&(this._wrapModeU=h);var l=n.wrapModeV;void 0!==l&&(this._wrapModeV=l)}switch(this._format){case 6407:case 6408:var u=(this._image=i).width,_=i.height;this._width=u,this._height=_,this._size=new pe(u,_),this._canRead&&(x.isConchApp?i instanceof t.HTMLElement&&(this._pixels=new Uint8Array(i.getImageData(0,0,u,_))):(c.canvas.size(u,_),c.canvas.clear(),c.context.drawImage(i,0,0,u,_),this._pixels=new Uint8Array(c.context.getImageData(0,0,u,_).data.buffer)));break;case D.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var f=new d(i);f.readUTFBytes(4),f.readUTFBytes(2),f.getInt16(),f.endian="bigEndian",this._width=f.getInt16(),this._height=f.getInt16(),this._size=new pe(this._width,this._height),f.getInt16(),f.getInt16(),this._image=new Uint8Array(i,f.pos)}this.recreateResource(),this._endLoaded()},a.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},a.disposeResource=function(){this._source&&(D.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},s(0,a,"_src",(function(){return this.url})),s(0,a,"src",(function(){return this.url})),n.load=function(t){return i.loader.create(t,null,null,n)},n}(),Ge=function(t){function e(t,n){e.__super.call(this),void 0===t&&(t=.3),void 0===n&&(n=1e3),this._tempVector3=new ae,this._position=new ae,this._up=new ae,this._forward=new ae,this._right=new ae,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=pe.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=n,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),i.stage.on("resize",this,this._onScreenSizeChanged)}r(e,"laya.d3.core.BaseCamera",t);var a=e.prototype;return a._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;i<e;i++)if(t[i].renderingOrder>t[e].renderingOrder){var n=t[i];t[i]=t[e],t[e]=n}},a._calculateProjectionMatrix=function(){},a._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},a._prepareCameraToRender=function(){O._currentCameraCullingMask=this.cullingMask;var t=this._shaderValues;t.setValue(0,this.transform.position.elements),t.setValue(5,this.forward.elements),t.setValue(6,this.up.elements)},a._prepareCameraViewProject=function(t,e){var i=this._shaderValues;i.setValue(1,t.elements),i.setValue(2,e.elements)},a._renderCamera=function(t,e,i){},a.addLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask|t.mask)},a.removeLayer=function(t){29!==t.number&&30!=t.number&&(this.cullingMask=this.cullingMask&~t.mask)},a.addAllLayers=function(){this.cullingMask=2147483647},a.removeAllLayers=function(){this.cullingMask=0|O.getLayerByNumber(29).mask|O.getLayerByNumber(30).mask},a.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},a.moveForward=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=t,this.transform.translate(this._tempVector3)},a.moveRight=function(t){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=t,this.transform.translate(this._tempVector3)},a.moveVertical=function(t){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=t,this.transform.translate(this._tempVector3,!1)},a._addSelfRenderObjects=function(){var t=this.scene._cameraPool,e=t.length;if(0<e){for(var i=e-1;0<=i;i--)if(this.renderingOrder<=t[i].renderingOrder){t.splice(i+1,0,this);break}}else t.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},a._clearSelfRenderObjects=function(){var t=this.scene._cameraPool;t.splice(t.indexOf(this),1)},a.destroy=function(e){void 0===e&&(e=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,i.stage.off("resize",this,this._onScreenSizeChanged),t.prototype.destroy.call(this,e)},s(0,a,"sky",(function(){return this._sky}),(function(t){(this._sky=t)._ownerCamera=this})),s(0,a,"forward",(function(){var t=this.transform.worldMatrix.elements,e=this._forward.elements;return e[0]=-t[8],e[1]=-t[9],e[2]=-t[10],this._forward})),s(0,a,"position",(function(){var t=this.transform.worldMatrix.elements,e=this._position.elements;return e[0]=t[12],e[1]=t[13],e[2]=t[14],this._position})),s(0,a,"renderTarget",(function(){return this._renderTarget}),(function(t){null!=(this._renderTarget=t)&&(this._renderTargetSize=t.size)})),s(0,a,"up",(function(){var t=this.transform.worldMatrix.elements,e=this._up.elements;return e[0]=t[4],e[1]=t[5],e[2]=t[6],this._up})),s(0,a,"right",(function(){var t=this.transform.worldMatrix.elements,e=this._right.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],this._right})),s(0,a,"renderTargetSize",(function(){return this._renderTargetSize}),(function(t){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=t,this._calculateProjectionMatrix()})),s(0,a,"fieldOfView",(function(){return this._fieldOfView}),(function(t){this._fieldOfView=t,this._calculateProjectionMatrix()})),s(0,a,"nearPlane",(function(){return this._nearPlane}),(function(t){this._nearPlane=t,this._calculateProjectionMatrix()})),s(0,a,"farPlane",(function(){return this._farPlane}),(function(t){this._farPlane=t,this._calculateProjectionMatrix()})),s(0,a,"orthographic",(function(){return this._orthographic}),(function(t){this._orthographic=t,this._calculateProjectionMatrix()})),s(0,a,"orthographicVerticalSize",(function(){return this._orthographicVerticalSize}),(function(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()})),s(0,a,"renderingOrder",(function(){return this._renderingOrder}),(function(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()})),e.CAMERAPOS=0,e.VIEWMATRIX=1,e.PROJECTMATRIX=2,e.VPMATRIX=3,e.VPMATRIX_NO_TRANSLATE=4,e.CAMERADIRECTION=5,e.CAMERAUP=6,e.ENVIRONMENTDIFFUSE=7,e.ENVIRONMENTSPECULAR=8,e.SIMLODINFO=9,e.DIFFUSEIRRADMATR=10,e.DIFFUSEIRRADMATG=11,e.DIFFUSEIRRADMATB=12,e.HDREXPOSURE=13,e.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",e.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",e.CLEARFLAG_SOLIDCOLOR=0,e.CLEARFLAG_SKY=1,e.CLEARFLAG_DEPTHONLY=2,e.CLEARFLAG_NONE=3,n(e,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new te(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new te},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new te}]),e}(Le),Ye=function(t){function e(t){this._render=null,this._geometryFilter=null,e.__super.call(this,t)}r(e,"laya.d3.core.RenderableSprite3D",t);var i=e.prototype;return i._addToInitStaticBatchManager=function(){},i._setBelongScene=function(e){t.prototype._setBelongScene.call(this,e),e._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},i._setUnBelongScene=function(){var e=this._scene._renderableSprite3Ds,i=e.indexOf(this);e.splice(i,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),t.prototype._setUnBelongScene.call(this)},i._update=function(t){(t.owner=this)._activeInHierarchy&&(this._updateComponents(t),this._render._updateOctreeNode(),this._lateUpdateComponents(t),M.spriteCount++,this._childs.length&&this._updateChilds(t))},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._render._destroy(),this._render=null},e.__init__=function(){e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=e.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),e.SAHDERDEFINE_LIGHTMAP=e.shaderDefines.registerDefine("LIGHTMAP")},e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,e.SAHDERDEFINE_LIGHTMAP=4,e.LIGHTMAPSCALEOFFSET=2,e.LIGHTMAP=3,n(e,["shaderDefines",function(){return this.shaderDefines=new ce}]),e}(Le),Xe=(function(t){function e(t,i,n){this._long=NaN,this._width=NaN,this._height=NaN,void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=1),e.__super.call(this),this._long=t,this._width=i,this._height=n,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.BoxMesh",Ue);var i=e.prototype;i.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var t=At.vertexDeclaration,e=(t.vertexStride,this._long/2),i=this._height/2,n=this._width/2,r=new Float32Array([-e,i,-n,0,1,0,0,0,e,i,-n,0,1,0,1,0,e,i,n,0,1,0,1,1,-e,i,n,0,1,0,0,1,-e,-i,-n,0,-1,0,0,1,e,-i,-n,0,-1,0,1,1,e,-i,n,0,-1,0,1,0,-e,-i,n,0,-1,0,0,0,-e,i,-n,-1,0,0,0,0,-e,i,n,-1,0,0,1,0,-e,-i,n,-1,0,0,1,1,-e,-i,-n,-1,0,0,0,1,e,i,-n,1,0,0,1,0,e,i,n,1,0,0,0,0,e,-i,n,1,0,0,0,1,e,-i,-n,1,0,0,1,1,-e,i,n,0,0,1,0,0,e,i,n,0,0,1,1,0,e,-i,n,0,0,1,1,1,-e,-i,n,0,0,1,0,1,-e,i,-n,0,0,-1,1,0,e,i,-n,0,0,-1,0,0,e,-i,-n,0,0,-1,0,1,-e,-i,-n,0,0,-1,1,1]),s=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new ke(t,this._numberVertices,35044,!0),this._indexBuffer=new Fe("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(r),this._indexBuffer.setData(s),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},s(0,i,"long",(function(){return this._long}),(function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())})),s(0,i,"width",(function(){return this._width}),(function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())})),s(0,i,"height",(function(){return this._height}),(function(t){this._height!==t&&(this._height=t,this.releaseResource(),this.activeResource())}))}(),function(t){function e(t,i,n,r){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===t&&(t=10),void 0===i&&(i=10),void 0===n&&(n=10),void 0===r&&(r=10),e.__super.call(this),this._long=t,this._width=i,this._stacks=n,this._slices=r,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}r(e,"laya.d3.resource.models.PlaneMesh",Ue);var i=e.prototype;i.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var t=new Uint16Array(this._numberIndices),e=At.vertexDeclaration,i=e.vertexStride/4,n=new Float32Array(this._numberVertices*i),r=this._long/2,s=this._width/2,a=this._long/this._stacks,o=this._width/this._slices,h=0,l=0;l<=this._slices;l++)for(var c=0;c<=this._stacks;c++)n[h++]=c*a-r,n[h++]=0,n[h++]=l*o-s,n[h++]=0,n[h++]=1,n[h++]=0,n[h++]=1*c/this._stacks,n[h++]=1*l/this._slices;var u=0;for(l=0;l<this._slices;l++)for(c=0;c<this._stacks;c++)t[u++]=(l+1)*(this._stacks+1)+c,t[u++]=l*(this._stacks+1)+c,t[u++]=(l+1)*(this._stacks+1)+c+1,t[u++]=l*(this._stacks+1)+c,t[u++]=l*(this._stacks+1)+c+1,t[u++]=(l+1)*(this._stacks+1)+c+1;this._vertexBuffer=new ke(e,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new Fe("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData(n),this._indexBuffer.setData(t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},s(0,i,"long",(function(){return this._long}),(function(t){this._long!==t&&(this._long=t,this.releaseResource(),this.activeResource())})),s(0,i,"width",(function(){return this._width}),(function(t){this._width!==t&&(this._width=t,this.releaseResource(),this.activeResource())})),s(0,i,"stacks",(function(){return this._stacks}),(function(t){this._stacks!==t&&(this._stacks=t,this.releaseResource(),this.activeResource())})),s(0,i,"slices",(function(){return this._slices}),(function(t){this._slices!==t&&(this._slices=t,this.releaseResource(),this.activeResource())}))}(),function(t){function e(t,i,n){void 0===t&&(t=0),void 0===i&&(i=.3),void 0===n&&(n=1e3),this._viewMatrix=new te,this._projectionMatrix=new te,this._projectionViewMatrix=new te,this._viewport=new he(0,0,0,0),this._normalizedViewport=new he(0,0,1,1),this._aspectRatio=t,this._boundFrustumUpdate=!0,this._boundFrustum=new Zt(te.DEFAULT),e.__super.call(this,i,n),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}r(e,"laya.d3.core.Camera",Ge);var a=e.prototype;return a._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},a._parseCustomProps=function(t,e,i,n){var r=i.clearColor;this.clearColor=new oe(r[0],r[1],r[2],r[3]);var s=i.viewport;this.normalizedViewport=new he(s[0],s[1],s[2],s[3])},a._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.aspectRatio*.5,e=.5*this.orthographicVerticalSize;te.createOrthoOffCenterRH(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)}else te.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},a._update=function(t){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,t)},a._renderCamera=function(t,e,i){var n,r;i.parallelSplitShadowMaps[0]&&i._renderShadowMap(t,e,this),(e.camera=this)._prepareCameraToRender(),i._preRenderUpdateComponents(e),n=e._viewMatrix=this.viewMatrix;var s=this._renderTarget;s?(s.start(),te.multiply(Ge._invertYScaleMatrix,this._projectionMatrix,Ge._invertYProjectionMatrix),te.multiply(Ge._invertYScaleMatrix,this.projectionViewMatrix,Ge._invertYProjectionViewMatrix),r=e._projectionMatrix=Ge._invertYProjectionMatrix,e._projectionViewMatrix=Ge._invertYProjectionViewMatrix):(r=e._projectionMatrix=this._projectionMatrix,e._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(n,r),e._viewport=this.viewport,i._preRenderScene(t,e,this.boundFrustum),i._clear(t,e),i._renderScene(t,e),i._postRenderUpdateComponents(e),s&&s.end()},a.viewportPointToRay=function(t,e){fe.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},a.normalizedViewportPointToRay=function(t,i){var n=e._tempVector20,r=this.viewport,s=t.elements,a=n.elements;a[0]=s[0]*r.width,a[1]=s[1]*r.height,fe.calculateCursorRay(n,this.viewport,this._projectionMatrix,this.viewMatrix,null,i)},a.worldToViewportPoint=function(t,e){te.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e);var n=e.elements;n[0]=n[0]/i.stage.clientScaleX,n[1]=n[1]/i.stage.clientScaleY},a.worldToNormalizedViewportPoint=function(t,e){te.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e);var n=e.elements;n[0]=n[0]/i.stage.clientScaleX,n[1]=n[1]/i.stage.clientScaleY},a.convertScreenCoordToOrthographicCoord=function(t,e,i){if(void 0===i&&(i=!0),this._orthographic){var n=K.clientWidth,r=K.clientHeight,s=this.orthographicVerticalSize*this.aspectRatio/n,a=this.orthographicVerticalSize/r,o=t.elements,h=e.elements;return h[0]=(-n/2+o[0])*s,h[1]=(r/2-o[1])*a,h[2]=(this.nearPlane-this.farPlane)*(o[2]+1)/2-this.nearPlane,i&&ae.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1},s(0,a,"projectionViewMatrix",(function(){return te.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix})),s(0,a,"aspectRatio",(function(){if(0!==this._aspectRatio)return this._aspectRatio;var t=this.viewport;return t.width/t.height}),(function(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()})),s(0,a,"boundFrustum",(function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum})),s(0,a,"needViewport",(function(){var t=this.normalizedViewport;return 0===t.x&&0===t.y&&1===t.width&&1===t.height})),s(0,a,"viewport",(function(){if(this._viewportExpressedInClipSpace){var t=this._normalizedViewport,e=this.renderTargetSize,i=e.width,n=e.height;this._viewport.x=t.x*i,this._viewport.y=t.y*n,this._viewport.width=t.width*i,this._viewport.height=t.height*n}return this._viewport}),(function(t){if(null!=this.renderTarget&&(t.x<0||t.y<0||0==t.width||0==t.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=t,this._calculateProjectionMatrix()})),s(0,a,"normalizedViewport",(function(){if(!this._viewportExpressedInClipSpace){var t=this._viewport,e=this.renderTargetSize,i=e.width,n=e.height;this._normalizedViewport.x=t.x/i,this._normalizedViewport.y=t.y/n,this._normalizedViewport.width=t.width/i,this._normalizedViewport.height=t.height/n}return this._normalizedViewport}),(function(t){t.x<0&&(t.x=0,console.warn("Camera: viewport.x must large than 0.0.")),t.y<0&&(t.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<t.x+t.width&&(t.width=1-t.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<t.y+t.height&&(t.height=1-t.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=t,this._calculateProjectionMatrix()})),s(0,a,"projectionMatrix",(function(){return this._projectionMatrix}),(function(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0})),s(0,a,"viewMatrix",(function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix})),n(e,["_tempVector20",function(){return this._tempVector20=new se}]),e}()),je=function(t){function e(t,i){e.__super.call(this,i),this._geometryFilter=new Pe(this),this._render=new Re(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),t&&(this._geometryFilter.sharedMesh=t)instanceof laya.d3.resource.models.Mesh&&(t.loaded?this._render.sharedMaterials=t.materials:t.once("loaded",this,this._applyMeshMaterials))}r(e,"laya.d3.core.MeshSprite3D",t);var a=e.prototype;return a._changeRenderObjectByMesh=function(t){var e=this._render._renderElements,i=e[t];i||(i=e[t]=new Se),i._render=this._render;var n=this._render.sharedMaterials[t];n||(n=Oe.defaultMaterial);var r=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(r,n),i._sprite3D=this,i.renderObj=r,i._material=n,i},a._changeRenderObjectByMaterial=function(t,e){var i=this._render._renderElements[t];e||(e=Oe.defaultMaterial);var n=this._geometryFilter.sharedMesh.getRenderElement(t);return i._mainSortID=this._getSortID(n,e),i._sprite3D=this,i.renderObj=n,i._material=e,i},a._changeRenderObjectsByMesh=function(){var t=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=t;for(var e=0;e<t;e++)this._changeRenderObjectByMesh(e)},a._onMeshChanged=function(t){var e=t.sharedMesh;e.loaded?this._changeRenderObjectsByMesh():e.once("loaded",this,this._onMeshLoaded)},a._onMeshLoaded=function(t){t===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},a._onMaterialChanged=function(t,e,i){e<this._render._renderElements.length&&this._changeRenderObjectByMaterial(e,i)},a._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},a._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},a._parseCustomProps=function(t,e,i,n){var r=this.meshRender,s=i.lightmapIndex;null!=s&&(r.lightmapIndex=s);var a,o,h=i.lightmapScaleOffset;if(h&&(r.lightmapScaleOffset=new oe(h[0],h[1],h[2],h[3])),n.instanceParams)(a=n.instanceParams.loadPath)&&(o=g.getRes(e[a]),(this.meshFilter.sharedMesh=o).loaded?r.sharedMaterials=o.materials:o.once("loaded",this,this._applyMeshMaterials));else{(a=i.meshPath)&&(o=g.getRes(e[a]),this.meshFilter.sharedMesh=o);var l=i.materials;if(l){var c=r.sharedMaterials,u=l.length;c.length=u;for(var d=0;d<u;d++)c[d]=g.getRes(e[l[d].path]);r.sharedMaterials=c}}},a._applyMeshMaterials=function(t){for(var e=this._render.sharedMaterials,i=t.materials,n=0,r=i.length;n<r;n++)e[n]||(e[n]=i[n]);this._render.sharedMaterials=e},a._addToInitStaticBatchManager=function(){e._staticBatchManager._addInitBatchSprite(this)},a.cloneTo=function(t){var e=t;e._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var i=this._render,n=e._render;n.enable=i.enable,n.sharedMaterials=i.sharedMaterials,n.castShadow=i.castShadow;var r=i.lightmapScaleOffset;r&&(n.lightmapScaleOffset=r.clone()),n.lightmapIndex=i.lightmapIndex,n.receiveShadow=i.receiveShadow,n.sortingFudge=i.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,t)},a.destroy=function(e){if(void 0===e&&(e=!0),!this.destroyed){var i=this.meshFilter.sharedMesh;null!=i&&(i.loaded||i.off("loaded",this,this._applyMeshMaterials)),t.prototype.destroy.call(this,e),this._geometryFilter._destroy()}},s(0,a,"meshFilter",(function(){return this._geometryFilter})),s(0,a,"meshRender",(function(){return this._render})),e.__init__=function(){nt._staticBatchManagers.push(e._staticBatchManager)},e.load=function(t){return i.loader.create(t,null,null,e)},n(e,["_staticBatchManager",function(){return this._staticBatchManager=new Ce}]),e}(Ye)}(window,document,c),void 0!==(r=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),c){var n=c[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))&&(t.exports=r),function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,a=i.__newvec,o=laya.maths.Bezier,h=laya.utils.Browser,l=laya.utils.Byte,c=(laya.events.Event,laya.events.EventDispatcher),u=laya.display.Graphics,d=(laya.resource.HTMLCanvas,laya.utils.Handler),_=laya.net.Loader,f=laya.maths.MathUtil,p=laya.maths.Matrix,m=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),g=(laya.renders.RenderContext,laya.resource.Resource),v=laya.utils.RunDriver,y=laya.display.Sprite,x=laya.utils.Stat,w=laya.resource.Texture,b=(laya.net.URL,laya.utils.Utils),S=function(){function t(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return r(t,"laya.ani.AnimationContent"),t}(),T=function(){function t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return r(t,"laya.ani.AnimationNodeContent"),t}(),C=function(){function t(){}return r(t,"laya.ani.AnimationParser01"),t.parse=function(t,e){var i=e.__getBuffer(),n=0,r=0,s=0,a=0,o=0,h=0,c=0,u=e.readUTFString();t._aniClassName=u;var d,_=e.readUTFString().split("\n"),f=e.getUint8(),p=e.getUint32(),m=e.getUint32();0<p&&(d=i.slice(p,m));var g=new l(d);for(0<m&&(t._publicExtData=i.slice(m,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=f,n=0;n<f;n++){var v=t._anis[n]=new S;v.nodes=new Array;var y=v.name=_[e.getUint16()];t._aniMap[y]=n,v.bone3DMap={},v.playTime=e.getFloat32(),v.playTime<=0&&console.error("播放时间不能为0  url="+t.url+" name="+v.name);var x=v.nodes.length=e.getUint8();for(r=v.totalKeyframeDatasLength=0;r<x;r++){var w=v.nodes[r]=new T;w.childs=[];var b=e.getInt16();0<=b&&(w.name=_[b],v.bone3DMap[w.name]=r),w.keyFrame=new Array,w.parentIndex=e.getInt16(),-1==w.parentIndex?w.parent=null:w.parent=v.nodes[w.parentIndex],w.lerpType=e.getUint8();var C=e.getUint32();g.pos=C;var M=w.keyframeWidth=g.getUint16();if(v.totalKeyframeDatasLength+=M,0===w.lerpType||1===w.lerpType)for(w.interpolationMethod=[],w.interpolationMethod.length=M,s=0;s<M;s++)w.interpolationMethod[s]=q.interpolation[g.getUint8()];null!=w.parent&&w.parent.childs.push(w);var I=e.getUint16();0<I&&(w.extenData=i.slice(e.pos,e.pos+I),e.pos+=I);var E,A=e.getUint16(),D=0;for(s=0,a=w.keyFrame.length=A;s<a;s++){if((E=w.keyFrame[s]=new Y).duration=e.getFloat32(),E.startTime=D,2===w.lerpType){E.interpolationData=[];var P,R=e.getUint8();switch(P=e.getFloat32()){case 254:for(E.interpolationData.length=M,c=0;c<M;c++)E.interpolationData[c]=0;break;case 255:for(E.interpolationData.length=M,c=0;c<M;c++)E.interpolationData[c]=5;break;default:for(E.interpolationData.push(P),h=1;h<R;h++)E.interpolationData.push(e.getFloat32())}}for(E.data=new Float32Array(M),o=0;o<M;o++)E.data[o]=e.getFloat32(),-1e-8<E.data[o]&&E.data[o]<1e-8&&(E.data[o]=0);D+=E.duration}E.startTime=v.playTime,w.playTime=v.playTime,t._calculateKeyFrame(w,A,M)}}},t}(),M=function(){function t(){}return r(t,"laya.ani.AnimationParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],n=t._BLOCK.blockLengths=[],r=0;r<e;r++)i.push(t._reader.getUint32()),n.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),n=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var r=0;r<i;r++)t._strings[r]=t._reader.readUTFString();t._reader.pos=n},t.parse=function(e,i){t._templet=e,(t._reader=i).__getBuffer(),t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var n=0,r=t._BLOCK.count;n<r;n++){var s=i.getUint16(),a=t._strings[s],o=t["READ_"+a];if(null==o)throw new Error("model file err,no this function:"+s+" "+a);o.call()}},t.READ_ANIMATIONS=function(){var e=t._reader,i=e.__getBuffer(),n=0,r=0,s=0,a=0,o=e.getUint16(),h=[];for(h.length=o,n=0;n<o;n++)h[n]=q.interpolation[e.getByte()];var l=e.getUint8();for(t._templet._anis.length=l,n=0;n<l;n++){var c=t._templet._anis[n]={};c.nodes=new Array;var u=c.name=t._strings[e.getUint16()];t._templet._aniMap[u]=n,c.bone3DMap={},c.playTime=e.getFloat32();var d=c.nodes.length=e.getInt16();for(r=c.totalKeyframeDatasLength=0;r<d;r++){var _=c.nodes[r]={};_.keyframeWidth=o,_.childs=[];var f=e.getUint16();0<=f&&(_.name=t._strings[f],c.bone3DMap[_.name]=r),_.keyFrame=new Array,_.parentIndex=e.getInt16(),-1==_.parentIndex?_.parent=null:_.parent=c.nodes[_.parentIndex],c.totalKeyframeDatasLength+=o,_.interpolationMethod=h,null!=_.parent&&_.parent.childs.push(_);var p=e.getUint16(),m=null,g=null;for(s=0,a=_.keyFrame.length=p;s<a;s++){(m=_.keyFrame[s]={}).startTime=e.getFloat32(),g&&(g.duration=m.startTime-g.startTime);var v=t._DATA.offset,y=e.getUint32(),x=4*o,w=i.slice(v+y,v+y+x);m.data=new Float32Array(w),g=m}m.duration=0,_.playTime=c.playTime,t._templet._calculateKeyFrame(_,p,o)}}},t._templet=null,t._reader=null,t._strings=[],n(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),I=(function(){function t(){}r(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2}(),function(){function t(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new W,this.resultMatrix=new p,this._children=[]}r(t,"laya.ani.bone.Bone");var e=t.prototype;return e.setTempMatrix=function(t){this._tempMatrix=t;var e,i=0;for(i=0,e=this._children.length;i<e;i++)this._children[i].setTempMatrix(this._tempMatrix)},e.update=function(t){var e;if(this.rotation=this.transform.skX,t)e=this.resultTransform.getMatrix(),p.mul(e,t,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)e=this.resultTransform.getMatrix(),p.mul(e,this.parentBone.resultMatrix,this.resultMatrix);else{var i=this.parentBone,n=NaN,r=NaN,s=NaN,a=this.parentBone.resultMatrix;e=this.resultTransform.getMatrix();var o=a.a*e.tx+a.c*e.ty+a.tx,h=a.b*e.tx+a.d*e.ty+a.ty,l=new p;this.inheritRotation?(n=Math.atan2(i.resultMatrix.b,i.resultMatrix.a),r=Math.cos(n),s=Math.sin(n),l.setTo(r,s,-s,r,0,0),p.mul(this._tempMatrix,l,p.TEMP),p.TEMP.copyTo(l),e=this.resultTransform.getMatrix(),p.mul(e,l,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,e=this.resultTransform.getMatrix(),p.TEMP.identity(),p.TEMP.d=this.d,p.mul(e,p.TEMP,this.resultMatrix)),this.resultMatrix.tx=o,this.resultMatrix.ty=h}else(e=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var c,u=0;for(u=0,c=this._children.length;u<c;u++)this._children[u].update()},e.updateChild=function(){var t,e=0;for(e=0,t=this._children.length;e<t;e++)this._children[e].update()},e.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},e.updateDraw=function(e,n){t.ShowBones&&!t.ShowBones[this.name]||(this._sprite||(this._sprite=new y,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),i.stage.addChild(this._sprite)),this._sprite.x=e+this.resultMatrix.tx,this._sprite.y=n+this.resultMatrix.ty);var r,s=0;for(s=0,r=this._children.length;s<r;s++)this._children[s].updateDraw(e,n)},e.addChild=function(t){this._children.push(t),t.parentBone=this},e.findBone=function(t){if(this.name==t)return this;var e,i,n=0;for(n=0,e=this._children.length;n<e;n++)if(i=this._children[n].findBone(t))return i;return null},e.localToWorld=function(t){var e=t[0],i=t[1];t[0]=e*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,t[1]=e*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},t.ShowBones={},t}()),E=function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}r(t,"laya.ani.bone.BoneSlot");var e=t.prototype;return e.showSlotData=function(t,e){void 0===e&&(e=!0),this.currSlotData=t,e&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},e.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},e.replaceDisplayByName=function(t,e){var i,n;this.currSlotData&&(i=this.currSlotData.getDisplayByName(t),n=this.currSlotData.getDisplayByName(e),this.replaceDisplayByIndex(i,n))},e.replaceDisplayByIndex=function(t,e){this.currSlotData&&(this._replaceDic[t]=e,this.displayIndex==t&&this.showDisplayByIndex(t))},e.showDisplayByIndex=function(t){if(null!=this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&-1<t&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var e=this.currDisplayData.name;this.currTexture=this.templet.getTexture(e),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!m.isConchApp||m.isConchApp&&"0.9.15"<y.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},e.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},e.setParentMatrix=function(t){this._parentMatrix=t},e.draw=function(e,i,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var s,a=this.currTexture;switch(this._diyTexture&&(a=this._diyTexture),this.currDisplayData.type){case 0:if(e){var o=this.getDisplayMatrix();if(this._parentMatrix){var h=!1;if(o){var l;if(p.mul(o,this._parentMatrix,p.TEMP),l=n?(null==this._resultMatrix&&(this._resultMatrix=new p),this._resultMatrix):new p,!m.isWebGL&&this.currDisplayData.uvs||m.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var c=t._tempMatrix;c.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(c.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(h=!0,c.rotate(-Math.PI/2)),p.mul(c,p.TEMP,l)}else p.TEMP.copyTo(l);h?e.drawTexture(a,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,l):e.drawTexture(a,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,l)}}}break;case 1:if(null==(s=n?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),this._skinSprite):t.createSkinMesh()))return;var u;if(null==this.currDisplayData.bones){var d,_=this.currDisplayData.weights;this.deformData&&(_=this.deformData),d=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=G.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=G.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=_,this.currDisplayData.triangles.length,u=this.currDisplayData.triangles,s.init2(a,null,u,this._mVerticleArr,d);var f,g=this.getDisplayMatrix();this._parentMatrix&&g&&(p.mul(g,this._parentMatrix,p.TEMP),f=n?(null==this._resultMatrix&&(this._resultMatrix=new p),this._resultMatrix):new p,p.TEMP.copyTo(f),s.transform=f)}else this.skinMesh(i,s,r);e.drawSkin(s);break;case 2:if(null==(s=n?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),this._skinSprite):t.createSkinMesh()))return;this.skinMesh(i,s,r),e.drawSkin(s)}}},e.skinMesh=function(t,e,i){var n,r=this.currTexture,s=this.currDisplayData.bones;n=this._diyTexture?(r=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=G.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=G.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var a,o,h=this.currDisplayData.weights,l=this.currDisplayData.triangles,c=0,u=0,d=0,_=NaN,f=NaN,p=0,m=0,g=[],v=0,y=0;if(this.deformData&&0<this.deformData.length){var x=0;for(v=0,y=s.length;v<y;){for(d=s[v++]+v,u=c=0;v<d;v++)o=t[s[v]],_=h[p]+this.deformData[x++],f=h[p+1]+this.deformData[x++],m=h[p+2],c+=(_*o.a+f*o.c+o.tx)*m,u+=(_*o.b+f*o.d+o.ty)*m,p+=3;g.push(c,u)}}else for(v=0,y=s.length;v<y;){for(d=s[v++]+v,u=c=0;v<d;v++)o=t[s[v]],_=h[p],f=h[p+1],m=h[p+2],c+=(_*o.a+f*o.c+o.tx)*m,u+=(_*o.b+f*o.d+o.ty)*m,p+=3;g.push(c,u)}this._mVerticleArr=g,a=l,e.init2(r,null,a,this._mVerticleArr,n)},e.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},e.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},e.getMatrix=function(){return this._resultMatrix},e.copy=function(){var e=new t;return e.type="copy",e.name=this.name,e.attachmentName=this.attachmentName,e.srcDisplayIndex=this.srcDisplayIndex,e.parent=this.parent,e.displayIndex=this.displayIndex,e.templet=this.templet,e.currSlotData=this.currSlotData,e.currTexture=this.currTexture,e.currDisplayData=this.currDisplayData,e},t.createSkinMesh=function(){return m.isWebGL||m.isConchApp?v.skinAniSprite():(m.isWebGL,null)},n(t,["_tempMatrix",function(){return this._tempMatrix=new p}]),t}(),A=function(){function t(){this.skinName=null,this.deformSlotDataList=[]}return r(t,"laya.ani.bone.DeformAniData"),t}(),D=function(){function t(){this.deformSlotDisplayList=[]}return r(t,"laya.ani.bone.DeformSlotData"),t}(),P=function(){function t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}r(t,"laya.ani.bone.DeformSlotDisplayData");var e=t.prototype;return e.binarySearch1=function(t,e){var i=0,n=t.length-2;if(0==n)return 1;for(var r=n>>>1;;){if(t[Math.floor(r+1)]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}return 0},e.apply=function(t,e,i){if(void 0===i&&(i=1),t+=.05,!(this.timeList.length<=0)){var n=0;if(!(t<this.timeList[0])){var r=this.vectices[0].length,s=[],a=this.binarySearch1(this.timeList,t);if(this.frameIndex=a,t>=this.timeList[this.timeList.length-1]){var o=this.vectices[this.vectices.length-1];if(i<1)for(n=0;n<r;n++)s[n]+=(o[n]-s[n])*i;else for(n=0;n<r;n++)s[n]=o[n];this.deformData=s}else{this.tweenKeyList[this.frameIndex];var h=this.vectices[this.frameIndex-1],l=this.vectices[this.frameIndex],c=this.timeList[this.frameIndex-1],u=this.timeList[this.frameIndex];i=this.tweenKeyList[a-1]?(t-c)/(u-c):0;var d=NaN;for(n=0;n<r;n++)d=h[n],s[n]=d+(l[n]-d)*i;this.deformData=s}}}},t}(),R=function(){function t(){this.time=NaN,this.drawOrder=[]}return r(t,"laya.ani.bone.DrawOrderData"),t}(),N=function(){function t(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return r(t,"laya.ani.bone.EventData"),t}(),L=function(){function t(t,e){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=e[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]);for(var i=this._bones.length=0,n=t.boneIndexs.length;i<n;i++)this._bones.push(e[t.boneIndexs[i]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}r(t,"laya.ani.bone.IkConstraint");var e=t.prototype;return e.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},e._applyIk1=function(e,i,n,r){var s=e.parentBone,a=1/(s.resultMatrix.a*s.resultMatrix.d-s.resultMatrix.b*s.resultMatrix.c),o=i-s.resultMatrix.tx,h=n-s.resultMatrix.ty,l=(o*s.resultMatrix.d-h*s.resultMatrix.c)*a-e.transform.x,c=(h*s.resultMatrix.a-o*s.resultMatrix.b)*a-e.transform.y,u=Math.atan2(c,l)*t.radDeg-0-e.transform.skX;e.transform.scX<0&&(u+=180),180<u?u-=360:u<-180&&(u+=360),e.transform.skX=e.transform.skY=e.transform.skX+u*r,e.update()},e.updatePos=function(t,e){this._sp&&this._sp.pos(t,e)},e._applyIk2=function(e,n,r,s,a,o){if(0!=o){var h,l=e.resultTransform.x,c=e.resultTransform.y,u=e.transform.scX,d=e.transform.scY,_=n.transform.scX,f=0,p=0;p=u<0?(u=-u,f=180,-1):(f=0,1),d<0&&(d=-d,p=-p),h=_<0?(_=-_,180):0;var m,g=n.resultTransform.x,v=NaN,x=NaN,w=e.resultMatrix.a,b=e.resultMatrix.c,S=e.resultMatrix.b,T=e.resultMatrix.d,C=Math.abs(u-d)<=1e-4;m=C?(x=w*g+b*(v=n.resultTransform.y)+e.resultMatrix.tx,S*g+T*v+e.resultMatrix.ty):(v=0,x=w*g+e.resultMatrix.tx,S*g+e.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new y,i.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(r,s,15,"#ffff00"),this._sp.graphics.drawCircle(x,m,15,"#ff00ff")),e.setRotation(Math.atan2(m-e.resultMatrix.ty,x-e.resultMatrix.tx));var M=e.parentBone;w=M.resultMatrix.a,b=M.resultMatrix.c,S=M.resultMatrix.b;var I=1/(w*(T=M.resultMatrix.d)-b*S),E=r-M.resultMatrix.tx,A=s-M.resultMatrix.ty,D=(E*T-A*b)*I-l,P=(A*w-E*S)*I-c,R=((E=x-M.resultMatrix.tx)*T-(A=m-M.resultMatrix.ty)*b)*I-l,N=(A*w-E*S)*I-c,L=Math.sqrt(R*R+N*N),B=n.length*_,O=NaN,F=NaN;if(C){var k=(D*D+P*P-L*L-(B*=u)*B)/(2*L*B);k<-1?k=-1:1<k&&(k=1),F=Math.acos(k)*a,w=L+B*k,b=B*Math.sin(F),O=Math.atan2(P*w-D*b,D*w+P*b)}else{var V=(w=u*B)*w,U=(b=d*B)*b,H=D*D+P*P,z=Math.atan2(P,D),W=-2*U*L,G=U-V;if(0<(T=W*W-4*G*(S=U*L*L+V*H-V*U))){var Y=Math.sqrt(T);W<0&&(Y=-Y);var X=(Y=-(W+Y)/2)/G,j=S/Y,K=Math.abs(X)<Math.abs(j)?X:j;K*K<=H&&(A=Math.sqrt(H-K*K)*a,O=z-Math.atan2(A,K),F=Math.atan2(A/d,(K-L)/u))}var q=0,Z=Number.MAX_VALUE,Q=0,J=0,$=0,tt=0,et=0,it=0;tt<(T=(E=L+w)*E)&&($=0,tt=T,et=E),(T=(E=L-w)*E)<Z&&(q=Math.PI,Z=T,Q=E);var nt=Math.acos(-w*L/(V-U));(T=(E=w*Math.cos(nt)+L)*E+(A=b*Math.sin(nt))*A)<Z&&(q=nt,Z=T,Q=E,J=A),tt<T&&($=nt,tt=T,et=E,it=A),F=H<=(Z+tt)/2?(O=z-Math.atan2(J*a,Q),q*a):(O=z-Math.atan2(it*a,et),$*a)}var rt=Math.atan2(v,g)*p,st=e.resultTransform.skX;180<(O=(O-rt)*t.radDeg+f-st)?O-=360:O<-180&&(O+=360),e.resultTransform.x=l,e.resultTransform.y=c,e.resultTransform.skX=e.resultTransform.skY=st+O*o,st=n.resultTransform.skX,180<(F=((F+rt)*t.radDeg-0)*p+h-(st%=360))?F-=360:F<-180&&(F+=360),n.resultTransform.x=g,n.resultTransform.y=v,n.resultTransform.skX=n.resultTransform.skY=n.resultTransform.skY+F*o,e.update()}},e._applyIk3=function(e,n,r,s,a,o){if(0!=o){var h,l,c,u,d,_,f=n.resultMatrix.a*n.length,p=n.resultMatrix.b*n.length,m=f*f+p*p,g=Math.sqrt(m),v=e.resultMatrix.tx,x=e.resultMatrix.ty,w=n.resultMatrix.tx,b=n.resultMatrix.ty,S=w-v,T=b-x,C=S*S+T*T,M=Math.sqrt(C),I=(S=r-e.resultMatrix.tx)*S+(T=s-e.resultMatrix.ty)*T,E=Math.sqrt(I);if(g+M<=E||E+g<=M||E+M<=g){var A;w=v+(A=g+M<=E?1:-1)*(r-v)*M/E,b=x+A*(s-x)*M/E}else{var D=(C-m+I)/(2*I),P=Math.sqrt(C-D*D*I)/E,R=v+S*D,N=x+T*D,L=-T*P,B=S*P;b=0<a?(w=R-L,N-B):(w=R+L,N+B)}h=w,l=b,this.isDebug&&(this._sp||(this._sp=new y,i.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(v,x,15,"#ff00ff"),this._sp.graphics.drawCircle(r,s,15,"#ffff00"),this._sp.graphics.drawCircle(h,l,15,"#ff00ff")),c=Math.atan2(l-e.resultMatrix.ty,h-e.resultMatrix.tx),e.setRotation(c),(u=t._tempMatrix).identity(),u.rotate(c),u.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),u.translate(e.resultMatrix.tx,e.resultMatrix.ty),u.copyTo(e.resultMatrix),e.updateChild(),d=Math.atan2(s-l,r-h),n.setRotation(d),(_=t._tempMatrix).identity(),_.rotate(d),_.scale(n.resultMatrix.getScaleX(),n.resultMatrix.getScaleY()),_.translate(h,l),u.copyTo(n.resultMatrix),n.updateChild()}},n(t,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new p}]),t}(),B=function(){function t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return r(t,"laya.ani.bone.IkConstraintData"),t}(),O=function(){function t(t,e){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var i=this.data.bones,n=0,r=i.length;n<r;n++)this.bones.push(e[i[n]])}r(t,"laya.ani.bone.PathConstraint");var e=t.prototype;return e.apply=function(t,e){if(this.target){var i=this.translateMix,n=this.translateMix,r=0<n,s=this.data.spacingMode,a="length"==s,o=this.data.rotateMode,h="tangent"==o,l="chainScale"==o,c=[],u=this.bones.length,d=h?u:u+1,_=[];(this._spaces=_)[0]=this.position;var f=this.spacing;if(l||a)for(var p=0,m=d-1;p<m;){var g=this.bones[p],v=g.length,y=v*g.resultMatrix.a,x=v*g.resultMatrix.b;v=Math.sqrt(y*y+x*x),l&&(c[p]=v),_[++p]=a?Math.max(0,v+f):f}else for(p=1;p<d;p++)_[p]=f;var w=this.computeWorldPositions(this.target,t,e,d,h,"percent"==this.data.positionMode,"percent"==s);if(this._debugKey){for(p=0;p<w.length;p++)e.drawCircle(w[p++],w[p++],5,"#00ff00");var b=[];for(p=0;p<w.length;p++)b.push(w[p++],w[p++]);e.drawLines(0,0,b,"#ff0000")}var S=w[0],T=w[1],C=this.data.offsetRotation,M="chain"==o&&0==C,I=NaN;for(p=0,I=3;p<u;p++,I+=3){(g=this.bones[p]).resultMatrix.tx+=(S-g.resultMatrix.tx)*i,g.resultMatrix.ty+=(T-g.resultMatrix.ty)*i;var E=(y=w[I])-S,A=(x=w[I+1])-T;if(l&&0!=(v=c[p])){var D=(Math.sqrt(E*E+A*A)/v-1)*n+1;g.resultMatrix.a*=D,g.resultMatrix.c*=D}if(S=y,T=x,r){var P=g.resultMatrix.a,R=g.resultMatrix.c,N=g.resultMatrix.b,L=g.resultMatrix.d,B=NaN,O=NaN,F=NaN;B=h?w[I-1]:0==_[p+1]?w[I+2]:Math.atan2(A,E),B-=Math.atan2(N,P)-C/180*Math.PI,M&&(O=Math.cos(B),F=Math.sin(B),S+=((v=g.length)*(O*P-F*N)-E)*n,T+=(v*(F*P+O*N)-A)*n),B>Math.PI?B-=2*Math.PI:B<-Math.PI&&(B+=2*Math.PI),B*=n,O=Math.cos(B),F=Math.sin(B),g.resultMatrix.a=O*P-F*N,g.resultMatrix.c=O*R-F*L,g.resultMatrix.b=F*P+O*N,g.resultMatrix.d=F*R+O*L}}}},e.computeWorldVertices2=function(e,i,n,r,s,a){var o,h,l=e.currDisplayData.bones,c=e.currDisplayData.weights,u=e.currDisplayData.triangles,d=0,_=0,f=0,p=0,m=0,g=0,v=0,y=0,x=0,w=0,b=0;if(null!=l){for(d=0;d<n;d+=2)_+=(p=l[_])+1,f+=p;var S=i;for(m=a,g=3*f;m<r;m+=2){for(y=v=0,p=l[_++],p+=_;_<p;_++,g+=3){o=S[l[_]].resultMatrix,x=c[g],w=c[g+1];var T=c[g+2];v+=(x*o.a+w*o.c+o.tx)*T,y+=(x*o.b+w*o.d+o.ty)*T}s[m]=v,s[m+1]=y}}else{var C,M;if(u||(u=c),e.deformData&&(u=e.deformData),C=e.parent,i)for(b=i.length,d=0;d<b;d++)if(i[d].name==C){h=i[d];break}h&&(M=h.resultMatrix),M||(M=t._tempMt);var I=M.tx,E=M.ty,A=M.a,D=M.b,P=M.c,R=M.d;for(h&&(R*=h.d),_=n,m=a;m<r;_+=2,m+=2)x=u[_],w=u[_+1],s[m]=x*A+w*D+I,s[m+1]=-(x*P+w*R+E)}},e.computeWorldPositions=function(t,e,i,n,r,s,a){t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles;var o,h=[],l=0,c=t.currDisplayData.verLen,u=this.position,d=this._spaces,_=[],f=c/6,p=-1,m=NaN,g=0,v=0,y=NaN,x=NaN,w=NaN,b=NaN;if(f--,c-=4,this.computeWorldVertices2(t,e,2,c,h,0),this._debugKey)for(l=0;l<h.length;)i.drawCircle(h[l++],h[l++],10,"#ff0000");o=h,this._curves.length=f;var S=this._curves,T=o[m=0],C=o[1],M=0,I=0,E=0,A=0,D=0,P=0,R=NaN,N=NaN,L=NaN,B=NaN,O=NaN,F=NaN,k=NaN,V=NaN,U=0;for(l=0,U=2;l<f;l++,U+=6)O=2*(R=.1875*(T-2*(M=o[U])+(E=o[U+2])))+(L=.09375*(3*(M-E)-T+(D=o[U+4]))),F=2*(N=.1875*(C-2*(I=o[U+1])+(A=o[U+3])))+(B=.09375*(3*(I-A)-C+(P=o[U+5]))),k=.75*(M-T)+R+.16666667*L,V=.75*(I-C)+N+.16666667*B,m+=Math.sqrt(k*k+V*V),k+=O,V+=F,O+=L,F+=B,m+=Math.sqrt(k*k+V*V),k+=O,V+=F,m+=Math.sqrt(k*k+V*V),k+=O+L,V+=F+B,m+=Math.sqrt(k*k+V*V),S[l]=m,T=D,C=P;if(s&&(u*=m),a)for(l=0;l<n;l++)d[l]*=m;var H=this._segments,z=0,W=0;for(W=v=g=l=0;l<n;l++,g+=3)if((y=u+=x=d[l])<0)this.addBeforePosition(y,o,0,_,g);else if(m<y)this.addAfterPosition(y-m,o,c-4,_,g);else{for(;;v++)if(!((b=S[v])<y)){0==v?y/=b:y=(y-(w=S[v-1]))/(b-w);break}if(v!=p){var G=6*(p=v);for(O=2*(R=.03*((T=o[G])-2*(M=o[G+2])+(E=o[G+4])))+(L=.006*(3*(M-E)-T+(D=o[G+6]))),F=2*(N=.03*((C=o[G+1])-2*(I=o[G+3])+(A=o[G+5])))+(B=.006*(3*(I-A)-C+(P=o[G+7]))),k=.3*(M-T)+R+.16666667*L,V=.3*(I-C)+N+.16666667*B,z=Math.sqrt(k*k+V*V),H[0]=z,G=1;G<8;G++)k+=O,V+=F,O+=L,F+=B,z+=Math.sqrt(k*k+V*V),H[G]=z;k+=O,V+=F,z+=Math.sqrt(k*k+V*V),H[8]=z,k+=O+L,V+=F+B,z+=Math.sqrt(k*k+V*V),H[9]=z,W=0}for(y*=z;;W++)if(!((b=H[W])<y)){0==W?y/=b:y=W+(y-(w=H[W-1]))/(b-w);break}this.addCurvePosition(.1*y,T,C,M,I,E,A,D,P,_,g,r||0<l&&0==x)}return _},e.addBeforePosition=function(t,e,i,n,r){var s=e[i],a=e[i+1],o=e[i+2]-s,h=e[i+3]-a,l=Math.atan2(h,o);n[r]=s+t*Math.cos(l),n[r+1]=a+t*Math.sin(l),n[r+2]=l},e.addAfterPosition=function(t,e,i,n,r){var s=e[i+2],a=e[i+3],o=s-e[i],h=a-e[i+1],l=Math.atan2(h,o);n[r]=s+t*Math.cos(l),n[r+1]=a+t*Math.sin(l),n[r+2]=l},e.addCurvePosition=function(t,e,i,n,r,s,a,o,h,l,c,u){0==t&&(t=1e-4);var d=t*t,_=d*t,f=1-t,p=f*f,m=p*f,g=f*t,v=3*g,y=f*v,x=v*t,w=e*m+n*y+s*x+o*_,b=i*m+r*y+a*x+h*_;l[c]=w,l[c+1]=b,l[c+2]=u?Math.atan2(b-(i*p+r*g*2+a*d),w-(e*p+n*g*2+s*d)):0},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,n(t,["_tempMt",function(){return this._tempMt=new p}]),t}(),F=function(){function t(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return r(t,"laya.ani.bone.PathConstraintData"),t}(),k=function(){function t(){this.name=null,this.slotArr=[]}return r(t,"laya.ani.bone.SkinData"),t}(),V=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}r(t,"laya.ani.bone.SkinSlotDisplayData");var e=t.prototype;return e.createTexture=function(t){return this.texture||(this.texture=new w(t.bitmap,this.uvs),t.bitmap.alphaTexture&&(this.texture.alphaTexture=new w(t.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),m.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},e.destory=function(){this.texture&&this.texture.destroy()},t}(),U=function(){function t(){this.name=null,this.displayArr=[]}return r(t,"laya.ani.bone.SlotData"),t.prototype.getDisplayByName=function(t){for(var e=0,i=this.displayArr.length;e<i;e++)if(this.displayArr[e].attachmentName==t)return e;return-1},t}(),H=function(){function t(t,e){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=a(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=e[t.targetIndex];var i,n=0;for(n=0,i=t.boneIndexs.length;n<i;n++)this._bones.push(e[t.boneIndexs[n]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}return r(t,"laya.ani.bone.TfConstraint"),t.prototype.apply=function(){for(var t,e=this.target.resultMatrix.a,i=this.target.resultMatrix.b,n=this.target.resultMatrix.c,r=this.target.resultMatrix.d,s=0,a=this._bones.length;s<a;s++){if(t=this._bones[s],0<this.rotateMix){var o=t.resultMatrix.a,h=t.resultMatrix.b,l=t.resultMatrix.c,c=t.resultMatrix.d,u=Math.atan2(n,e)-Math.atan2(l,o)+this._data.offsetRotation*Math.PI/180;u>Math.PI?u-=2*Math.PI:u<-Math.PI&&(u+=2*Math.PI),u*=this.rotateMix;var d=Math.cos(u),_=Math.sin(u);t.resultMatrix.a=d*o-_*l,t.resultMatrix.b=d*h-_*c,t.resultMatrix.c=_*o+d*l,t.resultMatrix.d=_*h+d*c}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),t.resultMatrix.tx+=(this._temp[0]-t.resultMatrix.tx)*this.translateMix,t.resultMatrix.ty+=(this._temp[1]-t.resultMatrix.ty)*this.translateMix,t.updateChild()),0<this.scaleMix){var f=Math.sqrt(t.resultMatrix.a*t.resultMatrix.a+t.resultMatrix.c*t.resultMatrix.c),p=Math.sqrt(e*e+n*n),m=1e-5<f?(f+(p-f+this._data.offsetScaleX)*this.scaleMix)/f:0;t.resultMatrix.a*=m,t.resultMatrix.c*=m,f=Math.sqrt(t.resultMatrix.b*t.resultMatrix.b+t.resultMatrix.d*t.resultMatrix.d),p=Math.sqrt(i*i+r*r),m=1e-5<f?(f+(p-f+this._data.offsetScaleY)*this.scaleMix)/f:0,t.resultMatrix.b*=m,t.resultMatrix.d*=m}if(0<this.shearMix){h=t.resultMatrix.b,c=t.resultMatrix.d;var g=Math.atan2(c,h);(u=Math.atan2(r,i)-Math.atan2(n,e)-(g-Math.atan2(t.resultMatrix.c,t.resultMatrix.a)))>Math.PI?u-=2*Math.PI:u<-Math.PI&&(u+=2*Math.PI),u=g+(u+this._data.offsetShearY*Math.PI/180)*this.shearMix,m=Math.sqrt(h*h+c*c),t.resultMatrix.b=Math.cos(u)*m,t.resultMatrix.d=Math.sin(u)*m}}},t}(),z=function(){function t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return r(t,"laya.ani.bone.TfConstraintData"),t}(),W=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}r(t,"laya.ani.bone.Transform");var e=t.prototype;return e.initData=function(t){null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.skX&&(this.skX=t.skX),null!=t.skY&&(this.skY=t.skY),null!=t.scX&&(this.scX=t.scX),null!=t.scY&&(this.scY=t.scY)},e.getMatrix=function(){var t;return(t=this.mMatrix?this.mMatrix:this.mMatrix=new p).identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},e.skew=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=Math.sin(e),a=Math.cos(e);return t.setTo(t.a*a-t.b*n,t.a*s+t.b*r,t.c*a-t.d*n,t.c*s+t.d*r,t.tx*a-t.ty*n,t.tx*s+t.ty*r),t},t}(),G=function(){function t(){}return r(t,"laya.ani.bone.UVTools"),t.getRelativeUV=function(t,e,i){var n=t[0],r=t[2]-t[0],s=t[1],a=t[5]-t[1];i||(i=[]),i.length=e.length;var o,h=0;o=i.length;var l=1/r,c=1/a;for(h=0;h<o;h+=2)i[h]=(e[h]-n)*l,i[h+1]=(e[h+1]-s)*c;return i},t.getAbsoluteUV=function(t,e,i){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return i?(b.copyArray(i,e),i):e;var n=t[0],r=t[2]-t[0],s=t[1],a=t[5]-t[1];i||(i=[]),i.length=e.length;var o,h=0;for(o=i.length,h=0;h<o;h+=2)i[h]=e[h]*r+n,i[h+1]=e[h+1]*a+s;return i},t}(),Y=function(){function t(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return r(t,"laya.ani.KeyFramesContent"),t}(),X=function(){function t(){}return r(t,"laya.ani.math.BezierLerp"),t.getBezierRate=function(e,i,n,r,s){var a=t._getBezierParamKey(i,n,r,s),o=100*a+e;if(t._bezierResultCache[o])return t._bezierResultCache[o];var h,l=t._getBezierPoints(i,n,r,s,a),c=0;for(h=l.length,c=0;c<h;c+=2)if(e<=l[c])return t._bezierResultCache[o]=l[c+1],l[c+1];return t._bezierResultCache[o]=1},t._getBezierParamKey=function(t,e,i,n){return 100*(100*(100*(100*t+e)+i)+n)},t._getBezierPoints=function(e,i,n,r,s){return t._bezierPointsCache[s]?t._bezierPointsCache[s]:(a=[0,0,e,i,n,r,1,1],h=(new o).getBezierPoints(a,100,3),t._bezierPointsCache[s]=h);var a,h},t._bezierResultCache={},t._bezierPointsCache={},t}(),j=function(t){function e(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}r(e,"laya.ani.AnimationPlayer",c);var n=e.prototype;return i.imps(n,{"laya.resource.IDestroy":!0}),n._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},n._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,n=0,r=e.getAnimationCount();n<r;n++){for(var s=[],a=0,o=e.getAnimation(n).nodes.length;a<o;a++){for(var h=e.getAnimation(n).nodes[a],l=Math.floor(h.playTime/i+.01),c=new Uint16Array(l+1),u=-1,d=0,_=h.keyFrame.length;d<_;d++){var f=h.keyFrame[d],p=f.startTime,m=p+f.duration+i;do{for(var g=Math.floor(p/i+.5),v=u+1;v<g;v++)c[v]=d;c[u=g]=d,p+=i}while(p<=m)}s.push(c)}t.push(s)}},n._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},n._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart}},n._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e},n._setPlayParamsWhenStop=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(t/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},n._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==x.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var n=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=n)return this._setPlayParamsWhenStop(n,e),void this.event("stopped");if(i+=this._currentTime,0<n)if(n<=i)do{if(i-=n,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,void this.event("stopped");i<n&&(this._setPlayParams(i,e),this.event("complete"))}while(n<=i);else this._setPlayParams(i,e);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(n,e),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},n._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},n.play=function(t,e,i,n,r){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(i<0||n<0||r<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==r&&r<n)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=n,this._playEnd=r,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=x.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},n.playByFrame=function(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=30);var a=1e3/s;this.play(t,e,i,n*a,r*a)},n.stop=function(t){void 0===t&&(t=!0),t?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},s(0,n,"playEnd",(function(){return this._playEnd})),s(0,n,"templet",(function(){return this._templet}),(function(t){0===!this.state&&this.stop(!0),this._templet!==t&&((this._templet=t).loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))})),s(0,n,"playStart",(function(){return this._playStart})),s(0,n,"playDuration",(function(){return this._playDuration})),s(0,n,"state",(function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2})),s(0,n,"currentKeyframeIndex",(function(){return this._currentKeyframeIndex})),s(0,n,"overallDuration",(function(){return this._overallDuration})),s(0,n,"currentFrameTime",(function(){return this._currentFrameTime})),s(0,n,"currentAnimationClipIndex",(function(){return this._currentAnimationClipIndex})),s(0,n,"currentPlayTime",(function(){return this._currentTime+this._playStart})),s(0,n,"cachePlayRate",(function(){return this._cachePlayRate}),(function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))})),s(0,n,"cacheFrameRate",(function(){return this._cacheFrameRate}),(function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))})),s(0,n,"currentTime",null,(function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=x.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e),0),this._currentFrameTime=this._currentKeyframeIndex*e}})),s(0,n,"paused",(function(){return this._paused}),(function(t){(this._paused=t)&&this.event("paused")})),s(0,n,"cacheFrameRateInterval",(function(){return this._cacheFrameRateInterval})),s(0,n,"destroyed",(function(){return this._destroyed})),e}(),K=function(t){function e(){e.__super.call(this),m.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=p.EMPTY),this._addCmd([t]),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}return r(e,"laya.ani.GraphicsAni",u),e.prototype.drawSkin=function(t){var e=[t];this._saveToCmd(m._context._drawSkin,e)},e.create=function(){return e._caches.pop()||new e},e.recycle=function(t){t.clear(),e._caches.push(t)},e._caches=[],e}(),q=function(t){function e(){this._aniMap={},this.unfixedLastAniIndex=-1,e.__super.call(this),this._anis=new Array}r(e,"laya.ani.AnimationTemplet",g);var n=e.prototype;return n.parse=function(t){var e=new l(t);this._aniVersion=e.readUTFString(),C.parse(this,e)},n._calculateKeyFrame=function(t,e,i){var n=t.keyFrame;n[e]=n[0];for(var r=0;r<e;r++){var s=n[r];s.nextData=0===s.duration?s.data:n[r+1].data}n.length--},n.onAsynLoaded=function(t,e,i){var n=new l(e);switch(this._aniVersion=n.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":M.parse(this,n);break;default:C.parse(this,n)}this._endLoaded()},n.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},n.getAnimationCount=function(){return this._anis.length},n.getAnimation=function(t){return this._anis[t]},n.getAniDuration=function(t){return this._anis[t].playTime},n.getNodes=function(t){return this._anis[t].nodes},n.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},n.getNodeCount=function(t){return this._anis[t].nodes.length},n.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},n.getPublicExtData=function(){return this._publicExtData},n.getAnimationDataWithCache=function(t,e,i,n){var r=e[i];if(r){var s=r[t];return s?s[n]:null}return null},n.setAnimationDataWithCache=function(t,e,i,n,r){var s=e[i]||(e[i]={});(s[t]||(s[t]=[]))[n]=r},n.getOriginalData=function(t,i,n,r,s){for(var a=this._anis[t].nodes,o=0,h=0,l=a.length,c=0;h<l;h++){var u,d=a[h];u=d.keyFrame[n[h][r]],d.dataOffset=c;var _=s-u.startTime,f=d.lerpType;if(f)switch(f){case 0:case 1:for(o=0;o<d.keyframeWidth;)o+=d.interpolationMethod[o](d,o,i,c+o,u.data,_,null,u.duration,u.nextData);break;case 2:var p=u.interpolationData,m=p.length,g=0;for(o=0;o<m;){var v=p[o];switch(v){case 6:case 7:o+=e.interpolation[v](d,g,i,c+g,u.data,_,null,u.duration,u.nextData,p,o+1);break;default:o+=e.interpolation[v](d,g,i,c+g,u.data,_,null,u.duration,u.nextData)}g++}}else for(o=0;o<d.keyframeWidth;)o+=d.interpolationMethod[o](d,o,i,c+o,u.data,_,null,u.duration,u.nextData);c+=d.keyframeWidth}},n.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=t);for(var n=0,r=i.length;n<r;n++){var s=i[n];for(e<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=e;this.unfixedCurrentFrameIndexes[n]<s.keyFrame.length&&!(s.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},n.getOriginalDataUnfixedRate=function(t,i,n){var r=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(r.length),this.unfixedCurrentTimes=new Float32Array(r.length),this.unfixedKeyframes=a(r.length),this.unfixedLastAniIndex=t);for(var s=0,o=0,h=r.length,l=0;o<h;o++){var c=r[o];for(n<this.unfixedCurrentTimes[o]&&(this.unfixedCurrentFrameIndexes[o]=0),this.unfixedCurrentTimes[o]=n;this.unfixedCurrentFrameIndexes[o]<c.keyFrame.length&&!(c.keyFrame[this.unfixedCurrentFrameIndexes[o]].startTime>this.unfixedCurrentTimes[o]);)this.unfixedKeyframes[o]=c.keyFrame[this.unfixedCurrentFrameIndexes[o]],this.unfixedCurrentFrameIndexes[o]++;var u=this.unfixedKeyframes[o];c.dataOffset=l;var d=n-u.startTime;if(c.lerpType)switch(c.lerpType){case 0:case 1:for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,i,l+s,u.data,d,null,u.duration,u.nextData);break;case 2:var _=u.interpolationData,f=_.length,p=0;for(s=0;s<f;){var m=_[s];switch(m){case 6:case 7:s+=e.interpolation[m](c,p,i,l+p,u.data,d,null,u.duration,u.nextData,_,s+1);break;default:s+=e.interpolation[m](c,p,i,l+p,u.data,d,null,u.duration,u.nextData)}p++}}else for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,i,l+s,u.data,d,null,u.duration,u.nextData);l+=c.keyframeWidth}},e._LinearInterpolation_0=function(t,e,i,n,r,s,a,o,h,l){var c=0===o?0:s/o;return i[n]=(1-c)*r[e]+c*h[e],1},e._QuaternionInterpolation_1=function(t,e,i,n,r,s,a,o,h,l){var c=0===o?0:s/o;return f.slerpQuaternionArray(r,e,h,e,c,i,n),4},e._AngleInterpolation_2=function(t,e,i,n,r,s,a,o,h,l){return 0},e._RadiansInterpolation_3=function(t,e,i,n,r,s,a,o,h,l){return 0},e._Matrix4x4Interpolation_4=function(t,e,i,n,r,s,a,o,h,l){for(var c=0;c<16;c++,e++)i[n+c]=r[e]+s*a[e];return 16},e._NoInterpolation_5=function(t,e,i,n,r,s,a,o,h,l){return i[n]=r[e],1},e._BezierInterpolation_6=function(t,e,i,n,r,s,a,o,h,l,c){return void 0===c&&(c=0),i[n]=r[e]+(h[e]-r[e])*X.getBezierRate(s/o,l[c],l[c+1],l[c+2],l[c+3]),5},e._BezierInterpolation_7=function(t,e,i,n,r,s,a,o,h,l,c){return void 0===c&&(c=0),i[n]=l[c+4]+l[c+5]*X.getBezierRate((.001*s+l[c+6])/l[c+7],l[c],l[c+1],l[c+2],l[c+3]),9},e.load=function(t){return i.loader.create(t,null,null,e)},e.interpolation=[e._LinearInterpolation_0,e._QuaternionInterpolation_1,e._AngleInterpolation_2,e._RadiansInterpolation_3,e._Matrix4x4Interpolation_4,e._NoInterpolation_5,e._BezierInterpolation_6,e._BezierInterpolation_7],e}(),Z=function(t){function e(t,i){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,e.__super.call(this),void 0===i&&(i=0),t&&this.init(t,i)}r(e,"laya.ani.bone.Skeleton",t);var i=e.prototype;return i.init=function(t,e){void 0===e&&(e=0);var i,n,r,s=0,a=0;if(1==e)for(this._graphicsCache=[],s=0,a=t.getAnimationCount();s<a;s++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=e,this._templet=t,this._player=new j,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,0<t.ikArr.length)for(this._ikArr=[],s=0,a=t.ikArr.length;s<a;s++)this._ikArr.push(new L(t.ikArr[s],this._boneList));if(0<t.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),s=0,a=t.pathArr.length;s<a;s++)i=t.pathArr[s],n=new O(i,this._boneList),(r=this._boneSlotDic[i.name])&&((n=new O(i,this._boneList)).target=r),this._pathDic[i.name]=n;if(0<t.tfArr.length)for(this._tfArr=[],s=0,a=t.tfArr.length;s<a;s++)this._tfArr.push(new H(t.tfArr[s],this._boneList));if(0<t.skinDataArray.length){var o=this._templet.skinDataArray[this._skinIndex];this._skinName=o.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},i.load=function(t,e,i){},i._onLoaded=function(){},i._parseComplete=function(){var t=Q.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},i._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},i._onPlay=function(){this.event("played")},i._onStop=function(){var t,e=this._templet.eventAniArr[this._aniClipIndex];if(e&&this._eventIndex<e.length)for(;this._eventIndex<e.length;this._eventIndex++)(t=e[this._eventIndex]).time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},i._onPause=function(){this.event("paused")},i._parseSrcBoneMatrix=function(){var t=0,e=0;for(e=this._templet.srcBoneMatrixArr.length,t=0;t<e;t++)this._boneMatrixArray.push(new p);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var i,n,r=this._templet.boneSlotArray;for(t=0,e=r.length;t<e;t++)i=r[t],null==(n=this._bindBoneBoneSlotDic[i.parent])&&(this._bindBoneBoneSlotDic[i.parent]=n=[]),this._boneSlotDic[i.name]=i=i.copy(),n.push(i),this._boneSlotArray.push(i)}},i._emitMissedEvents=function(t,e,i){void 0===i&&(i=0);var n=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(n){var r,s,a=0;for(r=n.length,a=i;a<r;a++)(s=n[a]).time>=this._player.playStart&&s.time<=this._player.playEnd&&this.event("label",s)}},i._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var e=this.timer.currTimer,i=this._player.currentKeyframeIndex,n=e-this._lastTime;if(t?this._player._update(n):i=-1,this._lastTime=e,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<n&&this._clipIndex==i&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var r;this._lastUpdateAniClipIndex=this._aniClipIndex,i>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var s,a=this._templet.eventAniArr[this._aniClipIndex];if(a&&this._eventIndex<a.length&&((r=a[this._eventIndex]).time>=this._player.playStart&&r.time<=this._player.playEnd?this._player.currentPlayTime>=r.time&&(this.event("label",r),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(s=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=s&&(this.graphics=s));var o=0,h=0;for(h=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,h-1)&&0<h;)h--;if(h<this._clipIndex)for(o=h;o<this._clipIndex;o++)this._createGraphics(o)}else if(1==this._aniMode){if(s=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=s&&(this.graphics=s));for(h=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,h-1)&&0<h;)h--;if(h<this._clipIndex)for(o=h;o<this._clipIndex;o++)this._createGraphics(o)}this._createGraphics()}}},i._createGraphics=function(t){void 0===t&&(t=-1),-1==t&&(t=this._clipIndex);var e,i,n=t*this._player.cacheFrameRateInterval,r=this._templet.drawOrderAniArr[this._aniClipIndex];if(r&&0<r.length)for(this._drawOrderIndex=0,e=r[this._drawOrderIndex];n>=e.time&&(this._drawOrder=e.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=r.length));)e=r[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=K.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=K.create(),i=this.graphics;var s=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,n);var a,o,h,c,u=this._aniSectionDic[this._aniClipIndex],d=0,_=0,f=0,m=0,g=0,v=this._templet.srcBoneMatrixArr.length;for(g=u[_=0];_<v;_++)c=this._boneList[_],h=this._templet.srcBoneMatrixArr[_],c.resultTransform.scX=h.scX*this._curOriginalData[d++],c.resultTransform.skX=h.skX+this._curOriginalData[d++],c.resultTransform.skY=h.skY+this._curOriginalData[d++],c.resultTransform.scY=h.scY*this._curOriginalData[d++],c.resultTransform.x=h.x+this._curOriginalData[d++],c.resultTransform.y=h.y+this._curOriginalData[d++],8===this._templet.tMatrixDataLen&&(c.resultTransform.skewX=h.skewX+this._curOriginalData[d++],c.resultTransform.skewY=h.skewY+this._curOriginalData[d++]);var y,x={},w={};for(g+=u[1];_<g;_++)x[(y=s[_]).name]=this._curOriginalData[d++],w[y.name]=this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++];var b,S,T={},C={};for(g+=u[2];_<g;_++)T[(y=s[_]).name]=this._curOriginalData[d++],C[y.name]=this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++],this._curOriginalData[d++];if(this._pathDic)for(g+=u[3];_<g;_++)if(y=s[_],b=this._pathDic[y.name])switch(new l(y.extenData).getByte()){case 1:b.position=this._curOriginalData[d++];break;case 2:b.spacing=this._curOriginalData[d++];break;case 3:b.rotateMix=this._curOriginalData[d++],b.translateMix=this._curOriginalData[d++]}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(p.TEMP.identity()),this._ikArr)for(_=0,g=this._ikArr.length;_<g;_++)S=this._ikArr[_],T.hasOwnProperty(S.name)&&(S.bendDirection=T[S.name]),C.hasOwnProperty(S.name)&&(S.mix=C[S.name]),S.apply();if(this._pathDic)for(var M in this._pathDic)(b=this._pathDic[M]).apply(this._boneList,i);if(this._tfArr)for(_=0,m=this._tfArr.length;_<m;_++)this._tfArr[_].apply();for(_=0,m=this._boneList.length;_<m;_++)if(c=this._boneList[_],o=this._bindBoneBoneSlotDic[c.name],c.resultMatrix.copyTo(this._boneMatrixArray[_]),o)for(f=0,g=o.length;f<g;f++)(a=o[f])&&a.setParentMatrix(c.resultMatrix);var I,E,A,D,P={},R=this._templet.deformAniArr;if(R&&0<R.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,_=0,g=this._boneSlotArray.length;_<g;_++)(a=this._boneSlotArray[_]).deformData=null;var N,L=R[this._aniClipIndex];for(N in I=L.default,this._setDeform(I,P,this._boneSlotArray,n),L)"default"!=N&&N!=this._skinName&&(I=L[N],this._setDeform(I,P,this._boneSlotArray,n));I=L[this._skinName],this._setDeform(I,P,this._boneSlotArray,n)}if(this._drawOrder)for(_=0,g=this._drawOrder.length;_<g;_++)E=x[(a=this._boneSlotArray[this._drawOrder[_]]).name],A=w[a.name],isNaN(A)||(i.save(),i.alpha(A)),isNaN(E)||-2==E||(this._templet.attachmentNames?a.showDisplayByName(this._templet.attachmentNames[E]):a.showDisplayByIndex(E)),P[this._drawOrder[_]]?(D=P[this._drawOrder[_]],a.currDisplayData&&D[a.currDisplayData.attachmentName]?a.deformData=D[a.currDisplayData.attachmentName]:a.deformData=null):a.deformData=null,isNaN(A)?a.draw(i,this._boneMatrixArray,2==this._aniMode):a.draw(i,this._boneMatrixArray,2==this._aniMode,A),isNaN(A)||i.restore();else for(_=0,g=this._boneSlotArray.length;_<g;_++)E=x[(a=this._boneSlotArray[_]).name],A=w[a.name],isNaN(A)||(i.save(),i.alpha(A)),isNaN(E)||-2==E||(this._templet.attachmentNames?a.showDisplayByName(this._templet.attachmentNames[E]):a.showDisplayByIndex(E)),P[_]?(D=P[_],a.currDisplayData&&D[a.currDisplayData.attachmentName]?a.deformData=D[a.currDisplayData.attachmentName]:a.deformData=null):a.deformData=null,isNaN(A)?a.draw(i,this._boneMatrixArray,2==this._aniMode):a.draw(i,this._boneMatrixArray,2==this._aniMode,A),isNaN(A)||i.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,i):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,i)},i._setDeform=function(t,e,i,n){if(t){var r,s,a,o=0,h=0,l=0;if(t)for(o=0,h=t.deformSlotDataList.length;o<h;o++)for(r=t.deformSlotDataList[o],l=0;l<r.deformSlotDisplayList.length;l++)a=i[(s=r.deformSlotDisplayList[l]).slotIndex],s.apply(n,a),e[s.slotIndex]||(e[s.slotIndex]={}),e[s.slotIndex][s.attachment]=s.deformData}},i.getAnimNum=function(){return this._templet.getAnimationCount()},i.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},i.getSlotByName=function(t){return this._boneSlotDic[t]},i.showSkinByName=function(t,e){void 0===e&&(e=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)},i.showSkinByIndex=function(t,e){void 0===e&&(e=!0);for(var i=0;i<this._boneSlotArray.length;i++)this._boneSlotArray[i].showSlotData(null,e);if(this._templet.showSkinByIndex(this._boneSlotDic,t,e)){var n=this._templet.skinDataArray[t];this._skinIndex=t,this._skinName=n.name}this._clearCache()},i.showSlotSkinByIndex=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByIndex(e),this._clearCache()}},i.showSlotSkinByName=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByName(e),this._clearCache()}},i.replaceSlotSkinName=function(t,e,i){if(0!=this._aniMode){var n=this.getSlotByName(t);n&&n.replaceDisplayByName(e,i),this._clearCache()}},i.replaceSlotSkinByIndex=function(t,e,i){if(0!=this._aniMode){var n=this.getSlotByName(t);n&&n.replaceDisplayByIndex(e,i),this._clearCache()}},i.setSlotSkin=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.replaceSkin(e),this._clearCache()}},i._clearCache=function(){if(1==this._aniMode)for(var t=0,e=this._graphicsCache.length;t<e;t++){for(var i=0,n=this._graphicsCache[t].length;i<n;i++){var r=this._graphicsCache[t][i];r!=this.graphics&&K.recycle(r)}this._graphicsCache[t].length=0}},i.play=function(t,e,i,n,r,s){void 0===i&&(i=!0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=!0),this._indexControl=!1;var a,o=-1;if(a=e?2147483647:0,"string"==typeof t)for(var l=0,c=this._templet.getAnimationCount();l<c;l++){var u=this._templet.getAnimation(l);if(u&&t==u.name){o=l;break}}else o=t;-1<o&&o<this.getAnimNum()&&(this._aniClipIndex=o,(i||this._pause||this._currAniIndex!=o)&&(this._currAniIndex=o,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(o)),this._drawOrder=null,this._eventIndex=0,this._player.play(o,this._player.playbackRate,a,n,r),s&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=h.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},i.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},i.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},i.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},i.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=h.now(),this.timer.frameLoop(1,this,this._update,null,!0))},i._getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},i._setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},s(0,i,"url",(function(){return this._aniPath}),(function(t){this.load(t)})),s(0,i,"index",(function(){return this._index}),(function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))})),s(0,i,"total",(function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total})),s(0,i,"templet",(function(){return this._templet})),s(0,i,"player",(function(){return this._player})),e.useSimpleMeshInCanvas=!1,e}(y),Q=function(t){function e(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,e.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}r(e,"laya.ani.bone.Templet",t);var n=e.prototype;return n.getLoadList=function(){return this._loadList},n.loadAni=function(t){this._skBufferUrl=t,i.loader.load(t,d.create(this,this.onComplete),null,"arraybuffer")},n.onComplete=function(t){if(this._isDestroyed)this.destroy();else{var e=_.getRes(this._skBufferUrl);e?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,e)):this.event("error","load failed:"+this._skBufferUrl)}},n.parseData=function(t,e,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=t,this._mainTexture&&m.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(e)},n.buildArmature=function(t){return void 0===t&&(t=0),new Z(this,t)},n.parse=function(i){t.prototype.parse.call(this,i),this._endLoaded(),this._aniVersion!=e.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+e.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},n._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var t=0;this._loadList=[];var e,i=new l(this.getPublicExtData()),n=0,r=i.getInt32(),s=i.readUTFString(),a=s.split("\n");for(t=0;t<r;t++)e=this._path+a[2*t],s=a[2*t+1],i.getFloat32(),i.getFloat32(),i.getFloat32(),i.getFloat32(),n=i.getFloat32(),isNaN(n),n=i.getFloat32(),isNaN(n),n=i.getFloat32(),isNaN(n),n=i.getFloat32(),isNaN(n),-1==this._loadList.indexOf(e)&&this._loadList.push(e);this.event("inited",this)}},n._textureComplete=function(){for(var t,e,i=0,n=this._loadList.length;i<n;i++)e=this._loadList[i],t=this._textureDic[e]=_.getRes(e),m.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},n._parsePublicExtData=function(){var t,e=0,n=0,r=0,s=0,a=0;for(e=0,a=this.getAnimationCount();e<a;e++)this._graphicsCache.push([]);t="Dragon"!=this._aniClassName;var o,h,c=new l(this.getPublicExtData()),u=0,d=0,_=0,f=0,m=0,g=0,v=0,y=0,x=0,b=c.getInt32(),S=c.readUTFString(),T=S.split("\n");for(e=0;e<b;e++){if(o=this._mainTexture,h=this._path+T[2*e],S=T[2*e+1],null==this._mainTexture&&(o=this._textureDic[h]),!o)return this.event("error",this),void(this.isParseFail=!0);u=c.getFloat32(),d=c.getFloat32(),_=c.getFloat32(),f=c.getFloat32(),x=c.getFloat32(),m=isNaN(x)?0:x,x=c.getFloat32(),g=isNaN(x)?0:x,x=c.getFloat32(),v=isNaN(x)?_:x,x=c.getFloat32(),y=isNaN(x)?f:x;var C=w.create(o,u,d,_,f,-m,-g,v,y);if(!C){var M=T[2*e];i.recordError("Texture.create失败","tTextureNameRealName："+M)}this.subTextureDic[S]=C,o.alphaTexture&&(this.subTextureDic[S].alphaTexture=w.create(o.alphaTexture,u,d,_,f,-m,-g,v,y))}this._mainTexture=o;var L,O,H,G,Y,X=c.getUint16();for(e=0;e<X;e++)(L=[]).push(c.getUint16()),L.push(c.getUint16()),L.push(c.getUint16()),L.push(c.getUint16()),this.aniSectionDic[e]=L;var j,K=c.getInt16(),q={};for(e=0;e<K;e++)O=new I,0==e?j=O:O.root=j,O.d=t?-1:1,G=c.readUTFString(),Y=c.readUTFString(),O.length=c.getFloat32(),1==c.getByte()&&(O.inheritRotation=!1),1==c.getByte()&&(O.inheritScale=!1),O.name=G,Y&&((H=q[Y])?H.addChild(O):this.mRootBone=O),q[G]=O,this.mBoneArr.push(O);this.tMatrixDataLen=c.getUint16();var Z,Q,J=c.getUint16(),$=Math.floor(J/this.tMatrixDataLen),tt=this.srcBoneMatrixArr;for(e=0;e<$;e++)(Z=new W).scX=c.getFloat32(),Z.skX=c.getFloat32(),Z.skY=c.getFloat32(),Z.scY=c.getFloat32(),Z.x=c.getFloat32(),Z.y=c.getFloat32(),8===this.tMatrixDataLen&&(Z.skewX=c.getFloat32(),Z.skewY=c.getFloat32()),tt.push(Z),(O=this.mBoneArr[e]).transform=Z;var et,it=c.getUint16(),nt=0;for(e=0;e<it;e++){for(Q=new B,nt=c.getUint16(),n=0;n<nt;n++)Q.boneNames.push(c.readUTFString()),Q.boneIndexs.push(c.getInt16());Q.name=c.readUTFString(),Q.targetBoneName=c.readUTFString(),Q.targetBoneIndex=c.getInt16(),Q.bendDirection=c.getFloat32(),Q.mix=c.getFloat32(),Q.isSpine=t,this.ikArr.push(Q)}var rt,st=c.getUint16(),at=0;for(e=0;e<st;e++){for(et=new z,at=c.getUint16(),n=0;n<at;n++)et.boneIndexs.push(c.getInt16());et.name=c.getUTFString(),et.targetIndex=c.getInt16(),et.rotateMix=c.getFloat32(),et.translateMix=c.getFloat32(),et.scaleMix=c.getFloat32(),et.shearMix=c.getFloat32(),et.offsetRotation=c.getFloat32(),et.offsetX=c.getFloat32(),et.offsetY=c.getFloat32(),et.offsetScaleX=c.getFloat32(),et.offsetScaleY=c.getFloat32(),et.offsetShearY=c.getFloat32(),this.tfArr.push(et)}var ot=c.getUint16(),ht=0;for(e=0;e<ot;e++){for((rt=new F).name=c.readUTFString(),ht=c.getUint16(),n=0;n<ht;n++)rt.bones.push(c.getInt16());rt.target=c.readUTFString(),rt.positionMode=c.readUTFString(),rt.spacingMode=c.readUTFString(),rt.rotateMode=c.readUTFString(),rt.offsetRotation=c.getFloat32(),rt.position=c.getFloat32(),rt.spacing=c.getFloat32(),rt.rotateMix=c.getFloat32(),rt.translateMix=c.getFloat32(),this.pathArr.push(rt)}var lt,ct,ut,dt,_t,ft=0,pt=0,mt=0,gt=NaN,vt=0,yt=c.getInt16();for(e=0;e<yt;e++){var xt=c.getUint8(),wt={};this.deformAniArr.push(wt);for(var bt=0;bt<xt;bt++)for((lt=new A).skinName=c.getUTFString(),wt[lt.skinName]=lt,ft=c.getInt16(),n=0;n<ft;n++)for(ct=new D,lt.deformSlotDataList.push(ct),pt=c.getInt16(),r=0;r<pt;r++)for(ut=new P,ct.deformSlotDisplayList.push(ut),ut.slotIndex=c.getInt16(),ut.attachment=c.getUTFString(),mt=c.getInt16(),s=0;s<mt;s++)for(1==c.getByte()?ut.tweenKeyList.push(!0):ut.tweenKeyList.push(!1),gt=c.getFloat32(),ut.timeList.push(gt),dt=[],ut.vectices.push(dt),vt=c.getInt16(),a=0;a<vt;a++)dt.push(c.getFloat32())}var St,Tt,Ct=c.getInt16(),Mt=0,It=0;for(e=0;e<Ct;e++){for(Mt=c.getInt16(),_t=[],n=0;n<Mt;n++){for((St=new R).time=c.getFloat32(),It=c.getInt16(),r=0;r<It;r++)St.drawOrder.push(c.getInt16());_t.push(St)}this.drawOrderAniArr.push(_t)}var Et,At=c.getInt16(),Dt=0;for(e=0;e<At;e++){for(Dt=c.getInt16(),Tt=[],n=0;n<Dt;n++)(Et=new N).name=c.getUTFString(),Et.intValue=c.getInt32(),Et.floatValue=c.getFloat32(),Et.stringValue=c.getUTFString(),Et.time=c.getFloat32(),Tt.push(Et);this.eventAniArr.push(Tt)}var Pt=c.getInt16();if(0<Pt)for(this.attachmentNames=[],e=0;e<Pt;e++)this.attachmentNames.push(c.getUTFString());var Rt,Nt,Lt=c.getInt16();for(e=0;e<Lt;e++)(Rt=new E).name=c.readUTFString(),Rt.parent=c.readUTFString(),Rt.attachmentName=c.readUTFString(),Rt.srcDisplayIndex=Rt.displayIndex=c.getInt16(),(Rt.templet=this).boneSlotDic[Rt.name]=Rt,null==(Nt=this.bindBoneBoneSlotDic[Rt.parent])&&(this.bindBoneBoneSlotDic[Rt.parent]=Nt=[]),Nt.push(Rt),this.boneSlotArray.push(Rt);var Bt,Ot,Ft,kt=c.readUTFString().split("\n"),Vt=0,Ut=c.getUint8(),Ht=0,zt=0,Wt=0,Gt=0,Yt=0,Xt=0,jt=0;for(e=0;e<Ut;e++){for((Bt=new k).name=kt[Vt++],Ht=c.getUint8(),n=0;n<Ht;n++){for((Ot=new U).name=kt[Vt++],Rt=this.boneSlotDic[Ot.name],zt=c.getUint8(),r=0;r<zt;r++){if(Ft=new V,this.skinSlotDisplayDataArr.push(Ft),Ft.name=kt[Vt++],Ft.attachmentName=kt[Vt++],Ft.transform=new W,Ft.transform.scX=c.getFloat32(),Ft.transform.skX=c.getFloat32(),Ft.transform.skY=c.getFloat32(),Ft.transform.scY=c.getFloat32(),Ft.transform.x=c.getFloat32(),Ft.transform.y=c.getFloat32(),Ot.displayArr.push(Ft),Ft.width=c.getFloat32(),Ft.height=c.getFloat32(),Ft.type=c.getUint8(),Ft.verLen=c.getUint16(),0<(K=c.getUint16()))for(Ft.bones=[],s=0;s<K;s++){var Kt=c.getUint16();Ft.bones.push(Kt)}if(0<(Wt=c.getUint16()))for(Ft.uvs=[],s=0;s<Wt;s++)Ft.uvs.push(c.getFloat32());if(0<(Gt=c.getUint16()))for(Ft.weights=[],s=0;s<Gt;s++)Ft.weights.push(c.getFloat32());if(0<(Yt=c.getUint16()))for(Ft.triangles=[],s=0;s<Yt;s++)Ft.triangles.push(c.getUint16());if(0<(Xt=c.getUint16()))for(Ft.vertices=[],s=0;s<Xt;s++)Ft.vertices.push(c.getFloat32());if(0<(jt=c.getUint16()))for(Ft.lengths=[],s=0;s<jt;s++)Ft.lengths.push(c.getFloat32())}Bt.slotArr.push(Ot)}this.skinDic[Bt.name]=Bt,this.skinDataArray.push(Bt)}1==c.getUint8()?(this.yReverseMatrix=new p(1,0,0,-1,0,0),j&&j.setTempMatrix(this.yReverseMatrix)):j&&j.setTempMatrix(new p),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},n.getTexture=function(t){var e=this.subTextureDic[t];return e||(e=this.subTextureDic[t.substr(0,t.length-1)]),null==e?this._mainTexture:e},n.showSkinByIndex=function(t,e,i){if(void 0===i&&(i=!0),e<0&&e>=this.skinDataArray.length)return!1;var n,r,s=0,a=0,o=this.skinDataArray[e];if(o){for(s=0,a=o.slotArr.length;s<a;s++)(r=o.slotArr[s])&&(n=t[r.name])&&(n.showSlotData(r,i),i&&"undefined"!=n.attachmentName&&"null"!=n.attachmentName?n.showDisplayByName(n.attachmentName):n.showDisplayByIndex(n.displayIndex));return!0}return!1},n.getSkinIndexByName=function(t){for(var e=0,i=this.skinDataArray.length;e<i;e++)if(this.skinDataArray[e].name==t)return e;return-1},n.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},n.setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},n.destroy=function(){var t;for(var i in this._isDestroyed=!0,this.subTextureDic)(t=this.subTextureDic[i])&&t.destroy();for(i in this._textureDic)(t=this._textureDic[i])&&t.destroy();for(var n=0,r=this.skinSlotDisplayDataArr.length;n<r;n++)this.skinSlotDisplayDataArr[n].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete e.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},n.getAniNameByIndex=function(t){var e=this.getAnimation(t);return e?e.name:null},s(0,n,"rate",(function(){return this._rate}),(function(t){this._rate=t})),e.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",e.TEMPLET_DICTIONARY=null,e}(q)}(window,document,c),void 0!==(r=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),c){var n=c[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))&&(t.exports=r),h=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=21)}([function(t,e){var i={};t.exports=i,function(){i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i._warnedOnce={},i._decomp=null,i.extend=function(t,e){var n,r;r="boolean"==typeof e?(n=2,e):(n=1,!0);for(var s=n;s<arguments.length;s++){var a=arguments[s];if(a)for(var o in a)r&&a[o]&&a[o].constructor===Object?t[o]&&t[o].constructor!==Object?t[o]=a[o]:(t[o]=t[o]||{},i.extend(t[o],r,a[o])):t[o]=a[o]}return t},i.clone=function(t,e){return i.extend({},e,t)},i.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var i in t)e.push(i);return e},i.values=function(t){var e=[];if(Object.keys){for(var i=Object.keys(t),n=0;n<i.length;n++)e.push(t[i[n]]);return e}for(var r in t)e.push(t[r]);return e},i.get=function(t,e,i,n){e=e.split(".").slice(i,n);for(var r=0;r<e.length;r+=1)t=t[e[r]];return t},i.set=function(t,e,n,r,s){var a=e.split(".").slice(r,s);return i.get(t,e,0,-1)[a[a.length-1]]=n},i.shuffle=function(t){for(var e=t.length-1;0<e;e--){var n=Math.floor(i.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t},i.choose=function(t){return t[Math.floor(i.random()*t.length)]},i.isElement=function(t){return"undefined"!=typeof HTMLElement?t instanceof HTMLElement:!!(t&&t.nodeType&&t.nodeName)},i.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.isFunction=function(t){return"function"==typeof t},i.isPlainObject=function(t){return"object"==typeof t&&t.constructor===Object},i.isString=function(t){return"[object String]"===toString.call(t)},i.clamp=function(t,e,i){return t<e?e:i<t?i:t},i.sign=function(t){return t<0?-1:1},i.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-i._nowStartTime},i.random=function(e,i){return i=void 0!==i?i:1,(e=void 0!==e?e:0)+t()*(i-e)};var t=function(){return i._seed=(9301*i._seed+49297)%233280,i._seed/233280};i.colorToNumber=function(t){return 3==(t=t.replace("#","")).length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},i.logLevel=1,i.log=function(){console&&0<i.logLevel&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&0<i.logLevel&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&0<i.logLevel&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warnOnce=function(){var t=Array.prototype.slice.call(arguments).join(" ");i._warnedOnce[t]||(i.warn(t),i._warnedOnce[t]=!0)},i.deprecated=function(t,e,n){t[e]=i.chain((function(){i.warnOnce("🔅 deprecated 🔅",n)}),t[e])},i.nextId=function(){return i._nextId++},i.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},i.map=function(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i},i.topologicalSort=function(t){var e=[],n=[],r=[];for(var s in t)n[s]||r[s]||i._topologicalSort(s,n,r,t,e);return e},i._topologicalSort=function(t,e,n,r,s){var a=r[t]||[];n[t]=!0;for(var o=0;o<a.length;o+=1){var h=a[o];n[h]||e[h]||i._topologicalSort(h,e,n,r,s)}n[t]=!1,e[t]=!0,s.push(t)},i.chain=function(){for(var t=[],e=0;e<arguments.length;e+=1){var i=arguments[e];i._chained?t.push.apply(t,i._chained):t.push(i)}function n(){for(var e,i=new Array(arguments.length),n=0,r=arguments.length;n<r;n++)i[n]=arguments[n];for(n=0;n<t.length;n+=1){var s=t[n].apply(e,i);void 0!==s&&(e=s)}return e}return n._chained=t,n},i.chainPathBefore=function(t,e,n){return i.set(t,e,i.chain(n,i.get(t,e)))},i.chainPathAfter=function(t,e,n){return i.set(t,e,i.chain(i.get(t,e),n))},i.setDecomp=function(t){i._decomp=t},i.getDecomp=function(){var t=i._decomp;try{t||"undefined"==typeof window||(t=window.decomp),t||void 0===n||(t=n.decomp)}catch(e){t=null}return t}}()},function(t,e){var i={};(t.exports=i).create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&i.update(e,t),e},i.update=function(t,e,i){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var n=0;n<e.length;n++){var r=e[n];r.x>t.max.x&&(t.max.x=r.x),r.x<t.min.x&&(t.min.x=r.x),r.y>t.max.y&&(t.max.y=r.y),r.y<t.min.y&&(t.min.y=r.y)}i&&(0<i.x?t.max.x+=i.x:t.min.x+=i.x,0<i.y?t.max.y+=i.y:t.min.y+=i.y)},i.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},i.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},i.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},i.shift=function(t,e){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+i,t.min.y=e.y,t.max.y=e.y+n}},function(t,e){var i={};(t.exports=i).create=function(t,e){return{x:t||0,y:e||0}},i.clone=function(t){return{x:t.x,y:t.y}},i.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},i.rotate=function(t,e,i){var n=Math.cos(e),r=Math.sin(e);i||(i={});var s=t.x*n-t.y*r;return i.y=t.x*r+t.y*n,i.x=s,i},i.rotateAbout=function(t,e,i,n){var r=Math.cos(e),s=Math.sin(e);n||(n={});var a=i.x+((t.x-i.x)*r-(t.y-i.y)*s);return n.y=i.y+((t.x-i.x)*s+(t.y-i.y)*r),n.x=a,n},i.normalise=function(t){var e=i.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},i.cross3=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},i.add=function(t,e,i){return i||(i={}),i.x=t.x+e.x,i.y=t.y+e.y,i},i.sub=function(t,e,i){return i||(i={}),i.x=t.x-e.x,i.y=t.y-e.y,i},i.mult=function(t,e){return{x:t.x*e,y:t.y*e}},i.div=function(t,e){return{x:t.x/e,y:t.y/e}},i.perp=function(t,e){return{x:(e=!0===e?-1:1)*-t.y,y:e*t.x}},i.neg=function(t){return{x:-t.x,y:-t.y}},i.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]},function(t,e,i){var n={};t.exports=n;var r=i(2),s=i(0);n.create=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n],s={x:r.x,y:r.y,index:n,body:e,isInternal:!1};i.push(s)}return i},n.fromPath=function(t,e){var i=[];return t.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,(function(t,e,n){i.push({x:parseFloat(e),y:parseFloat(n)})})),n.create(i,e)},n.centre=function(t){for(var e,i,s,a=n.area(t,!0),o={x:0,y:0},h=0;h<t.length;h++)s=(h+1)%t.length,e=r.cross(t[h],t[s]),i=r.mult(r.add(t[h],t[s]),e),o=r.add(o,i);return r.div(o,6*a)},n.mean=function(t){for(var e={x:0,y:0},i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y;return r.div(e,t.length)},n.area=function(t,e){for(var i=0,n=t.length-1,r=0;r<t.length;r++)i+=(t[n].x-t[r].x)*(t[n].y+t[r].y),n=r;return e?i/2:Math.abs(i)/2},n.inertia=function(t,e){for(var i,n,s=0,a=0,o=t,h=0;h<o.length;h++)n=(h+1)%o.length,s+=(i=Math.abs(r.cross(o[n],o[h])))*(r.dot(o[n],o[n])+r.dot(o[n],o[h])+r.dot(o[h],o[h])),a+=i;return e/6*(s/a)},n.translate=function(t,e,i){i=void 0!==i?i:1;var n,r=t.length,s=e.x*i,a=e.y*i;for(n=0;n<r;n++)t[n].x+=s,t[n].y+=a;return t},n.rotate=function(t,e,i){if(0!==e){var n,r,s,a,o=Math.cos(e),h=Math.sin(e),l=i.x,c=i.y,u=t.length;for(a=0;a<u;a++)r=(n=t[a]).x-l,s=n.y-c,n.x=l+(r*o-s*h),n.y=c+(r*h+s*o);return t}},n.contains=function(t,e){for(var i,n=e.x,r=e.y,s=t.length,a=t[s-1],o=0;o<s;o++){if(i=t[o],0<(n-a.x)*(i.y-a.y)+(r-a.y)*(a.x-i.x))return!1;a=i}return!0},n.scale=function(t,e,i,s){if(1===e&&1===i)return t;var a,o;s=s||n.centre(t);for(var h=0;h<t.length;h++)a=t[h],o=r.sub(a,s),t[h].x=s.x+o.x*e,t[h].y=s.y+o.y*i;return t},n.chamfer=function(t,e,i,n,a){e="number"==typeof e?[e]:e||[8],i=void 0!==i?i:-1,n=n||2,a=a||14;for(var o=[],h=0;h<t.length;h++){var l=t[0<=h-1?h-1:t.length-1],c=t[h],u=t[(h+1)%t.length],d=e[h<e.length?h:e.length-1];if(0!==d){var _=r.normalise({x:c.y-l.y,y:l.x-c.x}),f=r.normalise({x:u.y-c.y,y:c.x-u.x}),p=Math.sqrt(2*Math.pow(d,2)),m=r.mult(s.clone(_),d),g=r.normalise(r.mult(r.add(_,f),.5)),v=r.sub(c,r.mult(g,p)),y=i;-1===i&&(y=1.75*Math.pow(d,.32)),(y=s.clamp(y,n,a))%2==1&&(y+=1);for(var x=Math.acos(r.dot(_,f))/y,w=0;w<y;w++)o.push(r.add(r.rotate(m,x*w),v))}else o.push(c)}return o},n.clockwiseSort=function(t){var e=n.mean(t);return t.sort((function(t,i){return r.angle(e,t)-r.angle(e,i)})),t},n.isConvex=function(t){var e,i,n,r,s=0,a=t.length;if(a<3)return null;for(e=0;e<a;e++)if(n=(e+2)%a,r=(t[i=(e+1)%a].x-t[e].x)*(t[n].y-t[i].y),(r-=(t[i].y-t[e].y)*(t[n].x-t[i].x))<0?s|=1:0<r&&(s|=2),3===s)return!1;return 0!==s||null},n.hull=function(t){var e,i,n=[],s=[];for((t=t.slice(0)).sort((function(t,e){var i=t.x-e.x;return 0!=i?i:t.y-e.y})),i=0;i<t.length;i+=1){for(e=t[i];2<=s.length&&r.cross3(s[s.length-2],s[s.length-1],e)<=0;)s.pop();s.push(e)}for(i=t.length-1;0<=i;i-=1){for(e=t[i];2<=n.length&&r.cross3(n[n.length-2],n[n.length-1],e)<=0;)n.pop();n.push(e)}return n.pop(),s.pop(),n.concat(s)}},function(t,e,i){var n={};t.exports=n;var r=i(0);n.on=function(t,e,i){for(var n,r=e.split(" "),s=0;s<r.length;s++)n=r[s],t.events=t.events||{},t.events[n]=t.events[n]||[],t.events[n].push(i);return i},n.off=function(t,e,i){if(e){"function"==typeof e&&(i=e,e=r.keys(t.events).join(" "));for(var n=e.split(" "),s=0;s<n.length;s++){var a=t.events[n[s]],o=[];if(i&&a)for(var h=0;h<a.length;h++)a[h]!==i&&o.push(a[h]);t.events[n[s]]=o}}else t.events={}},n.trigger=function(t,e,i){var n,s,a,o,h=t.events;if(h&&0<r.keys(h).length){i||(i={}),n=e.split(" ");for(var l=0;l<n.length;l++)if(a=h[s=n[l]]){(o=r.clone(i,!1)).name=s,o.source=t;for(var c=0;c<a.length;c++)a[c].apply(t,[o])}}}},function(t,e,i){var n={};t.exports=n;var r=i(4),s=i(0),a=i(1),o=i(6);n.create=function(t){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},t)},n.setModified=function(t,e,i,r){if((t.isModified=e)&&t.cache&&(t.cache.allBodies=null,t.cache.allConstraints=null,t.cache.allComposites=null),i&&t.parent&&n.setModified(t.parent,e,i,r),r)for(var s=0;s<t.composites.length;s++){var a=t.composites[s];n.setModified(a,e,i,r)}},n.add=function(t,e){var i=[].concat(e);r.trigger(t,"beforeAdd",{object:e});for(var a=0;a<i.length;a++){var o=i[a];switch(o.type){case"body":if(o.parent!==o){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(t,o);break;case"constraint":n.addConstraint(t,o);break;case"composite":n.addComposite(t,o);break;case"mouseConstraint":n.addConstraint(t,o.constraint)}}return r.trigger(t,"afterAdd",{object:e}),t},n.remove=function(t,e,i){var s=[].concat(e);r.trigger(t,"beforeRemove",{object:e});for(var a=0;a<s.length;a++){var o=s[a];switch(o.type){case"body":n.removeBody(t,o,i);break;case"constraint":n.removeConstraint(t,o,i);break;case"composite":n.removeComposite(t,o,i);break;case"mouseConstraint":n.removeConstraint(t,o.constraint)}}return r.trigger(t,"afterRemove",{object:e}),t},n.addComposite=function(t,e){return t.composites.push(e),e.parent=t,n.setModified(t,!0,!0,!1),t},n.removeComposite=function(t,e,i){var r=s.indexOf(t.composites,e);if(-1!==r&&n.removeCompositeAt(t,r),i)for(var a=0;a<t.composites.length;a++)n.removeComposite(t.composites[a],e,!0);return t},n.removeCompositeAt=function(t,e){return t.composites.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addBody=function(t,e){return t.bodies.push(e),n.setModified(t,!0,!0,!1),t},n.removeBody=function(t,e,i){var r=s.indexOf(t.bodies,e);if(-1!==r&&n.removeBodyAt(t,r),i)for(var a=0;a<t.composites.length;a++)n.removeBody(t.composites[a],e,!0);return t},n.removeBodyAt=function(t,e){return t.bodies.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addConstraint=function(t,e){return t.constraints.push(e),n.setModified(t,!0,!0,!1),t},n.removeConstraint=function(t,e,i){var r=s.indexOf(t.constraints,e);if(-1!==r&&n.removeConstraintAt(t,r),i)for(var a=0;a<t.composites.length;a++)n.removeConstraint(t.composites[a],e,!0);return t},n.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),n.setModified(t,!0,!0,!1),t},n.clear=function(t,e,i){if(i)for(var r=0;r<t.composites.length;r++)n.clear(t.composites[r],e,!0);return e?t.bodies=t.bodies.filter((function(t){return t.isStatic})):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,n.setModified(t,!0,!0,!1),t},n.allBodies=function(t){if(t.cache&&t.cache.allBodies)return t.cache.allBodies;for(var e=[].concat(t.bodies),i=0;i<t.composites.length;i++)e=e.concat(n.allBodies(t.composites[i]));return t.cache&&(t.cache.allBodies=e),e},n.allConstraints=function(t){if(t.cache&&t.cache.allConstraints)return t.cache.allConstraints;for(var e=[].concat(t.constraints),i=0;i<t.composites.length;i++)e=e.concat(n.allConstraints(t.composites[i]));return t.cache&&(t.cache.allConstraints=e),e},n.allComposites=function(t){if(t.cache&&t.cache.allComposites)return t.cache.allComposites;for(var e=[].concat(t.composites),i=0;i<t.composites.length;i++)e=e.concat(n.allComposites(t.composites[i]));return t.cache&&(t.cache.allComposites=e),e},n.get=function(t,e,i){var r,s;switch(i){case"body":r=n.allBodies(t);break;case"constraint":r=n.allConstraints(t);break;case"composite":r=n.allComposites(t).concat(t)}return r?0===(s=r.filter((function(t){return t.id.toString()===e.toString()}))).length?null:s[0]:null},n.move=function(t,e,i){return n.remove(t,e),n.add(i,e),t},n.rebase=function(t){for(var e=n.allBodies(t).concat(n.allConstraints(t)).concat(n.allComposites(t)),i=0;i<e.length;i++)e[i].id=s.nextId();return t},n.translate=function(t,e,i){for(var r=i?n.allBodies(t):t.bodies,s=0;s<r.length;s++)o.translate(r[s],e);return t},n.rotate=function(t,e,i,r){for(var s=Math.cos(e),a=Math.sin(e),h=r?n.allBodies(t):t.bodies,l=0;l<h.length;l++){var c=h[l],u=c.position.x-i.x,d=c.position.y-i.y;o.setPosition(c,{x:i.x+(u*s-d*a),y:i.y+(u*a+d*s)}),o.rotate(c,e)}return t},n.scale=function(t,e,i,r,s){for(var a=s?n.allBodies(t):t.bodies,h=0;h<a.length;h++){var l=a[h],c=l.position.x-r.x,u=l.position.y-r.y;o.setPosition(l,{x:r.x+c*e,y:r.y+u*i}),o.scale(l,e,i)}return t},n.bounds=function(t){for(var e=n.allBodies(t),i=[],r=0;r<e.length;r+=1){var s=e[r];i.push(s.bounds.min,s.bounds.max)}return a.create(i)}},function(t,e,i){var n={};t.exports=n;var r=i(3),s=i(2),a=i(7),o=(i(16),i(0)),h=i(1),l=i(11);!function(){n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n.create=function(e){var i={id:o.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},n=o.extend(i,e);return t(n,e),n},n.nextGroup=function(t){return t?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var t=function(t,e){e=e||{},n.set(t,{bounds:t.bounds||h.create(t.vertices),worldBounds:e.worldBounds,positionPrev:t.positionPrev||s.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),r.rotate(t.vertices,t.angle,t.position),l.rotate(t.axes,t.angle),h.update(t.bounds,t.vertices,t.velocity),n.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var i=t.isStatic?"#14151f":o.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),a=t.isStatic?"#555":"#ccc",c=t.isStatic&&null===t.render.fillStyle?1:0;t.render.fillStyle=t.render.fillStyle||i,t.render.strokeStyle=t.render.strokeStyle||a,t.render.lineWidth=t.render.lineWidth||c,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};n.set=function(t,e,i){var r;for(r in"string"==typeof e&&(r=e,(e={})[r]=i),e)if(Object.prototype.hasOwnProperty.call(e,r))switch(i=e[r],r){case"isStatic":n.setStatic(t,i);break;case"isSleeping":a.set(t,i);break;case"mass":n.setMass(t,i);break;case"density":n.setDensity(t,i);break;case"inertia":n.setInertia(t,i);break;case"vertices":n.setVertices(t,i);break;case"position":n.setPosition(t,i);break;case"angle":n.setAngle(t,i);break;case"velocity":n.setVelocity(t,i);break;case"angularVelocity":n.setAngularVelocity(t,i);break;case"parts":n.setParts(t,i);break;case"centre":n.setCentre(t,i);break;default:t[r]=i}},n.setStatic=function(t,e){for(var i=0;i<t.parts.length;i++){var n=t.parts[i];(n.isStatic=e)?(n._original={restitution:n.restitution,friction:n.friction,mass:n.mass,inertia:n.inertia,density:n.density,inverseMass:n.inverseMass,inverseInertia:n.inverseInertia},n.restitution=0,n.friction=1,n.mass=n.inertia=n.density=1/0,n.inverseMass=n.inverseInertia=0,n.positionPrev.x=n.position.x,n.positionPrev.y=n.position.y,n.anglePrev=n.angle,n.angularVelocity=0,n.speed=0,n.angularSpeed=0,n.motion=0):n._original&&(n.restitution=n._original.restitution,n.friction=n._original.friction,n.mass=n._original.mass,n.inertia=n._original.inertia,n.density=n._original.density,n.inverseMass=n._original.inverseMass,n.inverseInertia=n._original.inverseInertia,n._original=null)}},n.setMass=function(t,e){var i=t.inertia/(t.mass/6);t.inertia=e/6*i,t.inverseInertia=1/t.inertia,t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},n.setDensity=function(t,e){n.setMass(t,e*t.area),t.density=e},n.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},n.setVertices=function(t,e){e[0].body===t?t.vertices=e:t.vertices=r.create(e,t),t.axes=l.fromVertices(t.vertices),t.area=r.area(t.vertices),n.setMass(t,t.density*t.area);var i=r.centre(t.vertices);r.translate(t.vertices,i,-1),n.setInertia(t,n._inertiaScale*r.inertia(t.vertices,t.mass)),r.translate(t.vertices,t.position),h.update(t.bounds,t.vertices,t.velocity)},n.setParts=function(t,e,i){var s;for(e=e.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,s=0;s<e.length;s++){var a=e[s];a!==t&&(a.parent=t).parts.push(a)}if(1!==t.parts.length){if(i=void 0===i||i){var o=[];for(s=0;s<e.length;s++)o=o.concat(e[s].vertices);r.clockwiseSort(o);var h=r.hull(o),l=r.centre(h);n.setVertices(t,h),r.translate(t.vertices,l)}var c=n._totalProperties(t);t.area=c.area,(t.parent=t).position.x=c.centre.x,t.position.y=c.centre.y,t.positionPrev.x=c.centre.x,t.positionPrev.y=c.centre.y,n.setMass(t,c.mass),n.setInertia(t,c.inertia),n.setPosition(t,c.centre)}},n.setCentre=function(t,e,i){i?(t.positionPrev.x+=e.x,t.positionPrev.y+=e.y,t.position.x+=e.x,t.position.y+=e.y):(t.positionPrev.x=e.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=e.y-(t.position.y-t.positionPrev.y),t.position.x=e.x,t.position.y=e.y)},n.setPosition=function(t,e){var i=s.sub(e,t.position);t.positionPrev.x+=i.x,t.positionPrev.y+=i.y;for(var n=0;n<t.parts.length;n++){var a=t.parts[n];a.position.x+=i.x,a.position.y+=i.y,r.translate(a.vertices,i),h.update(a.bounds,a.vertices,t.velocity)}},n.setAngle=function(t,e){var i=e-t.angle;t.anglePrev+=i;for(var n=0;n<t.parts.length;n++){var a=t.parts[n];a.angle+=i,r.rotate(a.vertices,i,t.position),l.rotate(a.axes,i),h.update(a.bounds,a.vertices,t.velocity),0<n&&s.rotateAbout(a.position,i,t.position,a.position)}},n.setVelocity=function(t,e){t.positionPrev.x=t.position.x-e.x,t.positionPrev.y=t.position.y-e.y,t.velocity.x=e.x,t.velocity.y=e.y,t.speed=s.magnitude(t.velocity)},n.setAngularVelocity=function(t,e){t.anglePrev=t.angle-e,t.angularVelocity=e,t.angularSpeed=Math.abs(t.angularVelocity)},n.translate=function(t,e){n.setPosition(t,s.add(t.position,e))},n.rotate=function(t,e,i){if(i){var r=Math.cos(e),s=Math.sin(e),a=t.position.x-i.x,o=t.position.y-i.y;n.setPosition(t,{x:i.x+(a*r-o*s),y:i.y+(a*s+o*r)}),n.setAngle(t,t.angle+e)}else n.setAngle(t,t.angle+e)},n.scale=function(t,e,i,s){var a=0,o=0;s=s||t.position;for(var c=0;c<t.parts.length;c++){var u=t.parts[c];r.scale(u.vertices,e,i,s),u.axes=l.fromVertices(u.vertices),u.area=r.area(u.vertices),n.setMass(u,t.density*u.area),r.translate(u.vertices,{x:-u.position.x,y:-u.position.y}),n.setInertia(u,n._inertiaScale*r.inertia(u.vertices,u.mass)),r.translate(u.vertices,{x:u.position.x,y:u.position.y}),0<c&&(a+=u.area,o+=u.inertia),u.position.x=s.x+(u.position.x-s.x)*e,u.position.y=s.y+(u.position.y-s.y)*i,h.update(u.bounds,u.vertices,t.velocity)}1<t.parts.length&&(t.area=a,t.isStatic||(n.setMass(t,t.density*a),n.setInertia(t,o))),t.circleRadius&&(e===i?t.circleRadius*=e:t.circleRadius=null)},n.update=function(t,e,i,n){var a=Math.pow(e*i*t.timeScale,2),o=1-t.frictionAir*i*t.timeScale,c=t.position.x-t.positionPrev.x,u=t.position.y-t.positionPrev.y;t.velocity.x=c*o*n+t.force.x/t.mass*a,t.velocity.y=u*o*n+t.force.y/t.mass*a,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.angularVelocity=(t.angle-t.anglePrev)*o*n+t.torque/t.inertia*a,t.anglePrev=t.angle,t.angle+=t.angularVelocity,t.speed=s.magnitude(t.velocity),t.angularSpeed=Math.abs(t.angularVelocity);for(var d=0;d<t.parts.length;d++){var _=t.parts[d];r.translate(_.vertices,t.velocity),0<d&&(_.position.x+=t.velocity.x,_.position.y+=t.velocity.y),0!==t.angularVelocity&&(r.rotate(_.vertices,t.angularVelocity,t.position),l.rotate(_.axes,t.angularVelocity),0<d&&s.rotateAbout(_.position,t.angularVelocity,t.position,_.position)),h.update(_.bounds,_.vertices,t.velocity)}},n.applyForce=function(t,e,i){t.force.x+=i.x,t.force.y+=i.y;var n=e.x-t.position.x,r=e.y-t.position.y;t.torque+=n*i.y-r*i.x},n._totalProperties=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},i=1===t.parts.length?0:1;i<t.parts.length;i++){var n=t.parts[i],r=n.mass!==1/0?n.mass:1;e.mass+=r,e.area+=n.area,e.inertia+=n.inertia,e.centre=s.add(e.centre,s.mult(n.position,r))}return e.centre=s.div(e.centre,e.mass),e}}()},function(t,e,i){var n={};t.exports=n;var r=i(4);n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(t,e){for(var i=e*e*e,r=0;r<t.length;r++){var s=t[r],a=s.speed*s.speed+s.angularSpeed*s.angularSpeed;if(0===s.force.x&&0===s.force.y){var o=Math.min(s.motion,a),h=Math.max(s.motion,a);s.motion=n._minBias*o+(1-n._minBias)*h,0<s.sleepThreshold&&s.motion<n._motionSleepThreshold*i?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold&&n.set(s,!0)):0<s.sleepCounter&&(s.sleepCounter-=1)}else n.set(s,!1)}},n.afterCollisions=function(t,e){for(var i=e*e*e,r=0;r<t.length;r++){var s=t[r];if(s.isActive){var a=s.collision,o=a.bodyA.parent,h=a.bodyB.parent;if(!(o.isSleeping&&h.isSleeping||o.isStatic||h.isStatic)&&(o.isSleeping||h.isSleeping)){var l=o.isSleeping&&!o.isStatic?o:h,c=l===o?h:o;!l.isStatic&&c.motion>n._motionWakeThreshold*i&&n.set(l,!1)}}}},n.set=function(t,e){var i=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,i||r.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,i&&r.trigger(t,"sleepEnd"))}},function(t,e,i){var n={};t.exports=n;var r,s,a,o=i(3),h=i(9);r=[],s={overlap:0,axis:null},a={overlap:0,axis:null},n.create=function(t,e){return{pair:null,collided:!1,bodyA:t,bodyB:e,parentA:t.parent,parentB:e.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},n.collides=function(t,e,i){if(n._overlapAxes(s,t.vertices,e.vertices,t.axes),s.overlap<=0)return null;if(n._overlapAxes(a,e.vertices,t.vertices,e.axes),a.overlap<=0)return null;var r,l,c=i&&i.table[h.id(t,e)];c?r=c.collision:((r=n.create(t,e)).collided=!0,r.bodyA=t.id<e.id?t:e,r.bodyB=t.id<e.id?e:t,r.parentA=r.bodyA.parent,r.parentB=r.bodyB.parent),t=r.bodyA,e=r.bodyB,l=s.overlap<a.overlap?s:a;var u=r.normal,d=r.supports,_=l.axis,f=_.x,p=_.y;f*(e.position.x-t.position.x)+p*(e.position.y-t.position.y)<0?(u.x=f,u.y=p):(u.x=-f,u.y=-p),r.tangent.x=-u.y,r.tangent.y=u.x,r.depth=l.overlap,r.penetration.x=u.x*r.depth,r.penetration.y=u.y*r.depth;var m=n._findSupports(t,e,u,1),g=0;if(o.contains(t.vertices,m[0])&&(d[g++]=m[0]),o.contains(t.vertices,m[1])&&(d[g++]=m[1]),g<2){var v=n._findSupports(e,t,u,-1);o.contains(e.vertices,v[0])&&(d[g++]=v[0]),g<2&&o.contains(e.vertices,v[1])&&(d[g++]=v[1])}return 0===g&&(d[g++]=m[0]),d.length=g,r},n._overlapAxes=function(t,e,i,n){var r,s,a,o,h,l,c=e.length,u=i.length,d=e[0].x,_=e[0].y,f=i[0].x,p=i[0].y,m=n.length,g=Number.MAX_VALUE,v=0;for(h=0;h<m;h++){var y=n[h],x=y.x,w=y.y,b=d*x+_*w,S=f*x+p*w,T=b,C=S;for(l=1;l<c;l+=1)T<(o=e[l].x*x+e[l].y*w)?T=o:o<b&&(b=o);for(l=1;l<u;l+=1)C<(o=i[l].x*x+i[l].y*w)?C=o:o<S&&(S=o);if((r=(s=T-S)<(a=C-b)?s:a)<g&&(v=h,(g=r)<=0))break}t.axis=n[v],t.overlap=g},n._projectToAxis=function(t,e,i){for(var n=e[0].x*i.x+e[0].y*i.y,r=n,s=1;s<e.length;s+=1){var a=e[s].x*i.x+e[s].y*i.y;r<a?r=a:a<n&&(n=a)}t.min=n,t.max=r},n._findSupports=function(t,e,i,n){var s,a,o,h,l,c=e.vertices,u=c.length,d=t.position.x,_=t.position.y,f=i.x*n,p=i.y*n,m=Number.MAX_VALUE;for(l=0;l<u;l+=1)(h=f*(d-(a=c[l]).x)+p*(_-a.y))<m&&(m=h,s=a);return m=f*(d-(o=c[(u+s.index-1)%u]).x)+p*(_-o.y),f*(d-(a=c[(s.index+1)%u]).x)+p*(_-a.y)<m?(r[0]=s,r[1]=a):(r[0]=s,r[1]=o),r}},function(t,e,i){var n={};t.exports=n;var r=i(17);n.create=function(t,e){var i=t.bodyA,r=t.bodyB,s={id:n.id(i,r),bodyA:i,bodyB:r,collision:t,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:i.isSensor||r.isSensor,timeCreated:e,timeUpdated:e,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return n.update(s,t,e),s},n.update=function(t,e,i){var n=t.contacts,s=e.supports,a=t.activeContacts,o=e.parentA,h=e.parentB,l=o.vertices.length;t.isActive=!0,t.timeUpdated=i,t.collision=e,t.separation=e.depth,t.inverseMass=o.inverseMass+h.inverseMass,t.friction=o.friction<h.friction?o.friction:h.friction,t.frictionStatic=o.frictionStatic>h.frictionStatic?o.frictionStatic:h.frictionStatic,t.restitution=o.restitution>h.restitution?o.restitution:h.restitution,t.slop=o.slop>h.slop?o.slop:h.slop,e.pair=t;for(var c=a.length=0;c<s.length;c++){var u=s[c],d=u.body===o?u.index:l+u.index,_=n[d];_?a.push(_):a.push(n[d]=r.create(u))}},n.setActive=function(t,e,i){e?(t.isActive=!0,t.timeUpdated=i):(t.isActive=!1,t.activeContacts.length=0)},n.id=function(t,e){return t.id<e.id?"A"+t.id+"B"+e.id:"A"+e.id+"B"+t.id}},function(t,e,i){var n={};t.exports=n;var r=i(3),s=i(2),a=i(7),o=i(1),h=i(11),l=i(0);n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(t){var e=t;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var i=e.bodyA?s.add(e.bodyA.position,e.pointA):e.pointA,n=e.bodyB?s.add(e.bodyB.position,e.pointB):e.pointB,r=s.magnitude(s.sub(i,n));e.length=void 0!==e.length?e.length:r,e.id=e.id||l.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(0<e.length?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var a={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===e.length&&.1<e.stiffness?(a.type="pin",a.anchors=!1):e.stiffness<.9&&(a.type="spring"),e.render=l.extend(a,e.render),e},n.preSolveAll=function(t){for(var e=0;e<t.length;e+=1){var i=t[e],n=i.constraintImpulse;i.isStatic||0===n.x&&0===n.y&&0===n.angle||(i.position.x+=n.x,i.position.y+=n.y,i.angle+=n.angle)}},n.solveAll=function(t,e){for(var i=0;i<t.length;i+=1){var r=t[i],s=!r.bodyA||r.bodyA&&r.bodyA.isStatic,a=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(s||a)&&n.solve(t[i],e)}for(i=0;i<t.length;i+=1)s=!(r=t[i]).bodyA||r.bodyA&&r.bodyA.isStatic,a=!r.bodyB||r.bodyB&&r.bodyB.isStatic,s||a||n.solve(t[i],e)},n.solve=function(t,e){var i=t.bodyA,r=t.bodyB,a=t.pointA,o=t.pointB;if(i||r){i&&!i.isStatic&&(s.rotate(a,i.angle-t.angleA,a),t.angleA=i.angle),r&&!r.isStatic&&(s.rotate(o,r.angle-t.angleB,o),t.angleB=r.angle);var h=a,l=o;if(i&&(h=s.add(i.position,a)),r&&(l=s.add(r.position,o)),h&&l){var c=s.sub(h,l),u=s.magnitude(c);u<n._minLength&&(u=n._minLength);var d,_,f,p,m,g=(u-t.length)/u,v=t.stiffness<1?t.stiffness*e:t.stiffness,y=s.mult(c,g*v),x=(i?i.inverseMass:0)+(r?r.inverseMass:0),w=x+((i?i.inverseInertia:0)+(r?r.inverseInertia:0));if(t.damping){var b=s.create();f=s.div(c,u),m=s.sub(r&&s.sub(r.position,r.positionPrev)||b,i&&s.sub(i.position,i.positionPrev)||b),p=s.dot(f,m)}i&&!i.isStatic&&(_=i.inverseMass/x,i.constraintImpulse.x-=y.x*_,i.constraintImpulse.y-=y.y*_,i.position.x-=y.x*_,i.position.y-=y.y*_,t.damping&&(i.positionPrev.x-=t.damping*f.x*p*_,i.positionPrev.y-=t.damping*f.y*p*_),d=s.cross(a,y)/w*n._torqueDampen*i.inverseInertia*(1-t.angularStiffness),i.constraintImpulse.angle-=d,i.angle-=d),r&&!r.isStatic&&(_=r.inverseMass/x,r.constraintImpulse.x+=y.x*_,r.constraintImpulse.y+=y.y*_,r.position.x+=y.x*_,r.position.y+=y.y*_,t.damping&&(r.positionPrev.x+=t.damping*f.x*p*_,r.positionPrev.y+=t.damping*f.y*p*_),d=s.cross(o,y)/w*n._torqueDampen*r.inverseInertia*(1-t.angularStiffness),r.constraintImpulse.angle+=d,r.angle+=d)}}},n.postSolveAll=function(t){for(var e=0;e<t.length;e++){var i=t[e],l=i.constraintImpulse;if(!(i.isStatic||0===l.x&&0===l.y&&0===l.angle)){a.set(i,!1);for(var c=0;c<i.parts.length;c++){var u=i.parts[c];r.translate(u.vertices,l),0<c&&(u.position.x+=l.x,u.position.y+=l.y),0!==l.angle&&(r.rotate(u.vertices,l.angle,i.position),h.rotate(u.axes,l.angle),0<c&&s.rotateAbout(u.position,l.angle,i.position,u.position)),o.update(u.bounds,u.vertices,i.velocity)}l.angle*=n._warming,l.x*=n._warming,l.y*=n._warming}}},n.pointAWorld=function(t){return{x:(t.bodyA?t.bodyA.position.x:0)+t.pointA.x,y:(t.bodyA?t.bodyA.position.y:0)+t.pointA.y}},n.pointBWorld=function(t){return{x:(t.bodyB?t.bodyB.position.x:0)+t.pointB.x,y:(t.bodyB?t.bodyB.position.y:0)+t.pointB.y}}},function(t,e,i){var n={};t.exports=n;var r=i(2),s=i(0);n.fromVertices=function(t){for(var e={},i=0;i<t.length;i++){var n=(i+1)%t.length,a=r.normalise({x:t[n].y-t[i].y,y:t[i].x-t[n].x}),o=0===a.y?1/0:a.x/a.y;e[o=o.toFixed(3).toString()]=a}return s.values(e)},n.rotate=function(t,e){if(0!==e)for(var i=Math.cos(e),n=Math.sin(e),r=0;r<t.length;r++){var s,a=t[r];s=a.x*i-a.y*n,a.y=a.x*n+a.y*i,a.x=s}}},function(t,e,i){var n={};t.exports=n;var r=i(3),s=i(0),a=i(6),o=i(1),h=i(2);n.rectangle=function(t,e,i,n,o){o=o||{};var h={label:"Rectangle Body",position:{x:t,y:e},vertices:r.fromPath("L 0 0 L "+i+" 0 L "+i+" "+n+" L 0 "+n)};if(o.chamfer){var l=o.chamfer;h.vertices=r.chamfer(h.vertices,l.radius,l.quality,l.qualityMin,l.qualityMax),delete o.chamfer}return a.create(s.extend({},h,o))},n.trapezoid=function(t,e,i,n,o,h){h=h||{};var l,c=i*(o*=.5),u=c+(1-2*o)*i,d=u+c;l=o<.5?"L 0 0 L "+c+" "+-n+" L "+u+" "+-n+" L "+d+" 0":"L 0 0 L "+u+" "+-n+" L "+d+" 0";var _={label:"Trapezoid Body",position:{x:t,y:e},vertices:r.fromPath(l)};if(h.chamfer){var f=h.chamfer;_.vertices=r.chamfer(_.vertices,f.radius,f.quality,f.qualityMin,f.qualityMax),delete h.chamfer}return a.create(s.extend({},_,h))},n.circle=function(t,e,i,r,a){r=r||{};var o={label:"Circle Body",circleRadius:i};a=a||25;var h=Math.ceil(Math.max(10,Math.min(a,i)));return h%2==1&&(h+=1),n.polygon(t,e,h,i,s.extend({},o,r))},n.polygon=function(t,e,i,o,h){if(h=h||{},i<3)return n.circle(t,e,o,h);for(var l=2*Math.PI/i,c="",u=.5*l,d=0;d<i;d+=1){var _=u+d*l,f=Math.cos(_)*o,p=Math.sin(_)*o;c+="L "+f.toFixed(3)+" "+p.toFixed(3)+" "}var m={label:"Polygon Body",position:{x:t,y:e},vertices:r.fromPath(c)};if(h.chamfer){var g=h.chamfer;m.vertices=r.chamfer(m.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete h.chamfer}return a.create(s.extend({},m,h))},n.fromVertices=function(t,e,i,n,l,c,u,d){var _,f,p,m,g,v,y,x,w,b,S=s.getDecomp();for(_=Boolean(S&&S.quickDecomp),n=n||{},p=[],l=void 0!==l&&l,c=void 0!==c?c:.01,u=void 0!==u?u:10,d=void 0!==d?d:.01,s.isArray(i[0])||(i=[i]),w=0;w<i.length;w+=1)if(g=i[w],!(m=r.isConvex(g))&&!_&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),m||!_)g=m?r.clockwiseSort(g):r.hull(g),p.push({position:{x:t,y:e},vertices:g});else{var T=g.map((function(t){return[t.x,t.y]}));S.makeCCW(T),!1!==c&&S.removeCollinearPoints(T,c),!1!==d&&S.removeDuplicatePoints&&S.removeDuplicatePoints(T,d);var C=S.quickDecomp(T);for(v=0;v<C.length;v++){var M=C[v].map((function(t){return{x:t[0],y:t[1]}}));0<u&&r.area(M)<u||p.push({position:r.centre(M),vertices:M})}}for(v=0;v<p.length;v++)p[v]=a.create(s.extend(p[v],n));if(l)for(v=0;v<p.length;v++){var I=p[v];for(y=v+1;y<p.length;y++){var E=p[y];if(o.overlaps(I.bounds,E.bounds)){var A=I.vertices,D=E.vertices;for(x=0;x<I.vertices.length;x++)for(b=0;b<E.vertices.length;b++){var P=h.magnitudeSquared(h.sub(A[(x+1)%A.length],D[b])),R=h.magnitudeSquared(h.sub(A[x],D[(b+1)%D.length]));P<5&&R<5&&(A[x].isInternal=!0,D[b].isInternal=!0)}}}}return 1<p.length?(f=a.create(s.extend({parts:p.slice(0)},n)),a.setPosition(f,{x:t,y:e}),f):p[0]}},function(t,e,i){var n={};t.exports=n;var r=i(0);n.create=function(t){var e={};return t||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=t||document.body,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.mouseoutPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=parseInt(e.element.getAttribute("data-pixel-ratio"),10)||1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mouseout:null,mousewheel:null},e.mousemove=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&(e.button=0,t.preventDefault()),e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=t},e.mousedown=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches?(e.button=0,t.preventDefault()):e.button=t.button,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=t},e.mouseup=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&t.preventDefault(),e.button=-1,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=t},e.mouseout=function(t){var i=n._getRelativeMousePosition(t,e.element,e.pixelRatio);t.changedTouches&&t.preventDefault(),e.button=-1,e.absolute.x=i.x,e.absolute.y=i.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseoutPosition.x=e.position.x,e.mouseoutPosition.y=e.position.y,e.sourceEvents.mouseout=t},e.mousewheel=function(t){e.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault()},n.setElement(e,e.element),e},n.setElement=function(t,e){(t.element=e).addEventListener("mousemove",t.mousemove),e.addEventListener("mousedown",t.mousedown),e.addEventListener("mouseup",t.mouseup),e.addEventListener("mouseout",t.mouseout),e.addEventListener("mousewheel",t.mousewheel),e.addEventListener("DOMMouseScroll",t.mousewheel),e.addEventListener("touchmove",t.mousemove),e.addEventListener("touchstart",t.mousedown),e.addEventListener("touchend",t.mouseup),e.addEventListener("touchcancel",t.mouseup)},n.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mouseout=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},n.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n._getRelativeMousePosition=function(t,e,i){var n,r,s=e.getBoundingClientRect(),a=document.documentElement||document.body.parentNode||document.body,o=void 0!==window.pageXOffset?window.pageXOffset:a.scrollLeft,h=void 0!==window.pageYOffset?window.pageYOffset:a.scrollTop,l=t.changedTouches;o=o||0,h=h||0,r=l?(n=l[0].pageX-s.left-o,l[0].pageY-s.top-h):(n=t.pageX-s.left-o,t.pageY-s.top-h);var c=e.clientWidth||e.width,u=e.clientHeight||e.height;return{x:n/(c/(e.width||c)*i),y:r/(u/(e.height||u)*i)}}},function(t,e,i){var n={};t.exports=n;var r=i(0),s=i(8),a=i(2);n.create=function(t){return r.extend({bodies:[],pairs:null},t)},n.setBodies=function(t,e){t.bodies=e.slice(0)},n.clear=function(t){t.bodies=[]},n.collisions=function(t){var e,i,r=[],a=t.pairs,o=t.bodies,h=o.length,l=n.canCollide,c=s.collides;for(o.sort(n._compareBoundsX),e=0;e<h;e++){var u=o[e],d=u.bounds,_=u.bounds.max.x,f=u.bounds.max.y,p=u.bounds.min.y,m=u.isStatic||u.isSleeping,g=u.parts.length,v=1===g;for(i=e+1;i<h;i++){var y=o[i];if((I=y.bounds).min.x>_)break;if(!(f<I.min.y||p>I.max.y)&&(!m||!y.isStatic&&!y.isSleeping)&&l(u.collisionFilter,y.collisionFilter)){var x=y.parts.length;if(v&&1===x)(C=c(u,y,a))&&r.push(C);else for(var w=1<x?1:0,b=1<g?1:0;b<g;b++)for(var S=u.parts[b],T=(d=S.bounds,w);T<x;T++){var C,M=y.parts[T],I=M.bounds;d.min.x>I.max.x||d.max.x<I.min.x||d.max.y<I.min.y||d.min.y>I.max.y||(C=c(S,M,a))&&r.push(C)}}}}return r},n.canCollide=function(t,e){return t.group===e.group&&0!==t.group?0<t.group:0!=(t.mask&e.category)&&0!=(e.mask&t.category)},n._compareBoundsX=function(t,e){return t.bounds.min.x-e.bounds.min.x},n.worldBoundsLimit=function(t,e){if(t.worldBounds&&(t.bounds.max.x<t.worldBounds.min.x||t.bounds.min.x>t.worldBounds.max.x||t.bounds.max.y<t.worldBounds.min.y||t.bounds.min.y>t.worldBounds.max.y)){var i=a.dot(t.velocity,e.collision.normal),n=a.sub(t.velocity,a.mult(e.collision.normal,i)),r=i*(t.restitution-1),s=a.add(a.mult(e.collision.normal,r),n),o=t.position.x-t.bounds.min.x,h=t.bounds.max.x-t.position.x,l=t.position.y-t.bounds.min.y,c=t.bounds.max.y-t.position.y;s.x=s.x<t.worldBounds.min.x+o?t.worldBounds.min.x+o+100:s.x>t.worldBounds.max.x-h?t.worldBounds.max.x-h-100:s.x,s.y=s.y<t.worldBounds.min.y+l?t.worldBounds.min.y+l+100:s.y>t.worldBounds.max.y-c?t.worldBounds.max.y-c-100:s.y,Body.translate(t,{x:s.x,y:s.y})}}},function(t,e,i){var n={};t.exports=n;var r=i(0);n._registry={},n.register=function(t){if(n.isPlugin(t)||r.warn("Plugin.register:",n.toString(t),"does not implement all required fields."),t.name in n._registry){var e=n._registry[t.name],i=n.versionParse(t.version).number,s=n.versionParse(e.version).number;s<i?(r.warn("Plugin.register:",n.toString(e),"was upgraded to",n.toString(t)),n._registry[t.name]=t):i<s?r.warn("Plugin.register:",n.toString(e),"can not be downgraded to",n.toString(t)):t!==e&&r.warn("Plugin.register:",n.toString(t),"is already registered to different plugin object")}else n._registry[t.name]=t;return t},n.resolve=function(t){return n._registry[n.dependencyParse(t).name]},n.toString=function(t){return"string"==typeof t?t:(t.name||"anonymous")+"@"+(t.version||t.range||"0.0.0")},n.isPlugin=function(t){return t&&t.name&&t.version&&t.install},n.isUsed=function(t,e){return-1<t.used.indexOf(e)},n.isFor=function(t,e){var i=t.for&&n.dependencyParse(t.for);return!t.for||e.name===i.name&&n.versionSatisfies(e.version,i.range)},n.use=function(t,e){if(t.uses=(t.uses||[]).concat(e||[]),0!==t.uses.length){for(var i=n.dependencies(t),s=r.topologicalSort(i),a=[],o=0;o<s.length;o+=1)if(s[o]!==t.name){var h=n.resolve(s[o]);h?n.isUsed(t,h.name)||(n.isFor(h,t)||(r.warn("Plugin.use:",n.toString(h),"is for",h.for,"but installed on",n.toString(t)+"."),h._warned=!0),h.install?h.install(t):(r.warn("Plugin.use:",n.toString(h),"does not specify an install function."),h._warned=!0),h._warned?(a.push("🔶 "+n.toString(h)),delete h._warned):a.push("✅ "+n.toString(h)),t.used.push(h.name)):a.push("❌ "+s[o])}0<a.length&&r.info(a.join("  "))}else r.warn("Plugin.use:",n.toString(t),"does not specify any dependencies to install.")},n.dependencies=function(t,e){var i=n.dependencyParse(t),s=i.name;if(!(s in(e=e||{}))){t=n.resolve(t)||t,e[s]=r.map(t.uses||[],(function(e){n.isPlugin(e)&&n.register(e);var s=n.dependencyParse(e),a=n.resolve(e);return a&&!n.versionSatisfies(a.version,s.range)?(r.warn("Plugin.dependencies:",n.toString(a),"does not satisfy",n.toString(s),"used by",n.toString(i)+"."),a._warned=!0,t._warned=!0):a||(r.warn("Plugin.dependencies:",n.toString(e),"used by",n.toString(i),"could not be resolved."),t._warned=!0),s.name}));for(var a=0;a<e[s].length;a+=1)n.dependencies(e[s][a],e);return e}},n.dependencyParse=function(t){return r.isString(t)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(t)||r.warn("Plugin.dependencyParse:",t,"is not a valid dependency string."),{name:t.split("@")[0],range:t.split("@")[1]||"*"}):{name:t.name,range:t.range||t.version}},n.versionParse=function(t){var e=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;e.test(t)||r.warn("Plugin.versionParse:",t,"is not a valid version or range.");var i=e.exec(t),n=Number(i[4]),s=Number(i[5]),a=Number(i[6]);return{isRange:Boolean(i[1]||i[2]),version:i[3],range:t,operator:i[1]||i[2]||"",major:n,minor:s,patch:a,parts:[n,s,a],prerelease:i[7],number:1e8*n+1e4*s+a}},n.versionSatisfies=function(t,e){e=e||"*";var i=n.versionParse(e),r=n.versionParse(t);if(i.isRange){if("*"===i.operator||"*"===t)return!0;if(">"===i.operator)return r.number>i.number;if(">="===i.operator)return r.number>=i.number;if("~"===i.operator)return r.major===i.major&&r.minor===i.minor&&r.patch>=i.patch;if("^"===i.operator)return 0<i.major?r.major===i.major&&r.number>=i.number:0<i.minor?r.minor===i.minor&&r.patch>=i.patch:r.patch===i.patch}return t===e||"*"===t}},function(t,e,i){var n={};t.exports=n;var r=i(0),s=i(5),a=i(1),o=i(4),h=i(2),l=i(13);!function(){n._goodFps=30,n._goodDelta=1e3/60,n.create=function(t){var e={controller:n,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},s=r.extend(e,t);return s.canvas&&(s.canvas.width=s.options.width||s.canvas.width,s.canvas.height=s.options.height||s.canvas.height),s.mouse=t.mouse,s.engine=t.engine,s.canvas=s.canvas||i(s.options.width,s.options.height),s.context=s.canvas.getContext("2d"),s.textures={},s.bounds=s.bounds||{min:{x:0,y:0},max:{x:s.canvas.width,y:s.canvas.height}},s.options.showBroadphase=!1,1!==s.options.pixelRatio&&n.setPixelRatio(s,s.options.pixelRatio),r.isElement(s.element)?s.element.appendChild(s.canvas):s.canvas.parentNode||r.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),s},n.run=function(t){c.timer.clear(this,n.loop),c.timer.frameLoop(1,this,n.loop,[t])},n.loop=function(e){var i=r.now();t(e,i),n.world(e,i),(e.options.showStats||e.options.showDebug)&&n.stats(e,e.context,i),(e.options.showPerformance||e.options.showDebug)&&n.performance(e,e.context,i)},n.stop=function(t){c.timer.clear(this,n.loop)},n.setPixelRatio=function(t,e){var i=t.options,n=t.canvas;"auto"===e&&(e=u(n)),i.pixelRatio=e,n.setAttribute("data-pixel-ratio",e),n.width=i.width*e,n.height=i.height*e,n.style.width=i.width+"px",n.style.height=i.height+"px"},n.lookAt=function(t,e,i,n){n=void 0===n||n,e=r.isArray(e)?e:[e],i=i||{x:0,y:0};for(var s={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},a=0;a<e.length;a+=1){var o=e[a],h=o.bounds?o.bounds.min:o.min||o.position||o,c=o.bounds?o.bounds.max:o.max||o.position||o;h&&c&&(h.x<s.min.x&&(s.min.x=h.x),c.x>s.max.x&&(s.max.x=c.x),h.y<s.min.y&&(s.min.y=h.y),c.y>s.max.y&&(s.max.y=c.y))}var u=s.max.x-s.min.x+2*i.x,d=s.max.y-s.min.y+2*i.y,_=t.canvas.height,f=t.canvas.width/_,p=u/d,m=1,g=1;f<p?g=p/f:m=f/p,t.options.hasBounds=!0,t.bounds.min.x=s.min.x,t.bounds.max.x=s.min.x+u*m,t.bounds.min.y=s.min.y,t.bounds.max.y=s.min.y+d*g,n&&(t.bounds.min.x+=.5*u-u*m*.5,t.bounds.max.x+=.5*u-u*m*.5,t.bounds.min.y+=.5*d-d*g*.5,t.bounds.max.y+=.5*d-d*g*.5),t.bounds.min.x-=i.x,t.bounds.max.x-=i.x,t.bounds.min.y-=i.y,t.bounds.max.y-=i.y,t.mouse&&(l.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),l.setOffset(t.mouse,t.bounds.min))},n.startViewTransform=function(t){var e=t.bounds.max.x-t.bounds.min.x,i=t.bounds.max.y-t.bounds.min.y,n=e/t.options.width,r=i/t.options.height;t.context.setTransform(t.options.pixelRatio/n,0,0,t.options.pixelRatio/r,0,0),t.context.translate(-t.bounds.min.x,-t.bounds.min.y)},n.endViewTransform=function(t){t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0)},n.world=function(t,e){var i,c=r.now(),u=t.engine,d=u.world,f=t.canvas,p=t.context,m=t.options,g=t.timing,v=s.allBodies(d),y=s.allConstraints(d),x=m.wireframes?m.wireframeBackground:m.background,w=[],b=[],S={timestamp:u.timing.timestamp};if(o.trigger(t,"beforeRender",S),t.currentBackground!==x&&_(t,x),p.globalCompositeOperation="source-in",p.fillStyle="transparent",p.fillRect(0,0,f.width,f.height),p.globalCompositeOperation="source-over",m.hasBounds){for(i=0;i<v.length;i++){var T=v[i];a.overlaps(T.bounds,t.bounds)&&w.push(T)}for(i=0;i<y.length;i++){var C=y[i],M=C.bodyA,I=C.bodyB,E=C.pointA,A=C.pointB;M&&(E=h.add(M.position,C.pointA)),I&&(A=h.add(I.position,C.pointB)),E&&A&&(a.contains(t.bounds,E)||a.contains(t.bounds,A))&&b.push(C)}n.startViewTransform(t),t.mouse&&(l.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.options.width,y:(t.bounds.max.y-t.bounds.min.y)/t.options.height}),l.setOffset(t.mouse,t.bounds.min))}else b=y,w=v,1!==t.options.pixelRatio&&t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0);!m.wireframes||u.enableSleeping&&m.showSleeping?n.bodies(t,w,p):(m.showConvexHulls&&n.bodyConvexHulls(t,w,p),n.bodyWireframes(t,w,p)),m.showBounds&&n.bodyBounds(t,w,p),(m.showAxes||m.showAngleIndicator)&&n.bodyAxes(t,w,p),m.showPositions&&n.bodyPositions(t,w,p),m.showVelocity&&n.bodyVelocity(t,w,p),m.showIds&&n.bodyIds(t,w,p),m.showSeparations&&n.separations(t,u.pairs.list,p),m.showCollisions&&n.collisions(t,u.pairs.list,p),m.showVertexNumbers&&n.vertexNumbers(t,w,p),m.showMousePosition&&n.mousePosition(t,t.mouse,p),n.constraints(b,p),m.hasBounds&&n.endViewTransform(t),o.trigger(t,"afterRender",S),g.lastElapsed=r.now()-c},n.stats=function(t,e,i){for(var n=t.engine,r=n.world,a=s.allBodies(r),o=0,h=0,l=0;l<a.length;l+=1)o+=a[l].parts.length;var c={Part:o,Body:a.length,Cons:s.allConstraints(r).length,Comp:s.allComposites(r).length,Pair:n.pairs.list.length};for(var u in e.fillStyle="#0e0f19",e.fillRect(h,0,302.5,44),e.font="12px Arial",e.textBaseline="top",e.textAlign="right",c){var d=c[u];e.fillStyle="#aaa",e.fillText(u,h+55,8),e.fillStyle="#eee",e.fillText(d,h+55,26),h+=55}},n.performance=function(t,i){var r=t.engine,s=t.timing,a=s.deltaHistory,o=s.elapsedHistory,h=s.timestampElapsedHistory,l=s.engineDeltaHistory,c=s.engineElapsedHistory,u=r.timing.lastDelta,d=e(a),_=e(o),f=e(l),p=e(c),m=e(h)/d||0,g=1e3/d||0;i.fillStyle="#0e0f19",i.fillRect(0,50,370,34),n.status(i,10,69,60,4,a.length,Math.round(g)+" fps",g/n._goodFps,(function(t){return a[t]/d-1})),n.status(i,82,69,60,4,l.length,u.toFixed(2)+" dt",n._goodDelta/u,(function(t){return l[t]/f-1})),n.status(i,154,69,60,4,c.length,p.toFixed(2)+" ut",1-p/n._goodFps,(function(t){return c[t]/p-1})),n.status(i,226,69,60,4,o.length,_.toFixed(2)+" rt",1-_/n._goodFps,(function(t){return o[t]/_-1})),n.status(i,298,69,60,4,h.length,m.toFixed(2)+" x",m*m*m,(function(t){return(h[t]/a[t]/m||0)-1}))},n.status=function(t,e,i,n,s,a,o,h,l){t.strokeStyle="#888",t.fillStyle="#444",t.lineWidth=1,t.fillRect(e,i+7,n,1),t.beginPath(),t.moveTo(e,i+7-s*r.clamp(.4*l(0),-2,2));for(var c=0;c<n;c+=1)t.lineTo(e+c,i+7-(c<a?s*r.clamp(.4*l(c),-2,2):0));t.stroke(),t.fillStyle="hsl("+r.clamp(25+95*h,0,120)+",100%,60%)",t.fillRect(e,i-7,4,4),t.font="12px Arial",t.textBaseline="middle",t.textAlign="right",t.fillStyle="#eee",t.fillText(o,e+n,i-5)},n.constraints=function(t,e){for(var i=e,n=0;n<t.length;n++){var s=t[n];if(s.render.visible&&s.pointA&&s.pointB){var a,o,l=s.bodyA,c=s.bodyB;if(a=l?h.add(l.position,s.pointA):s.pointA,"pin"===s.render.type)i.beginPath(),i.arc(a.x,a.y,3,0,2*Math.PI),i.closePath();else{if(o=c?h.add(c.position,s.pointB):s.pointB,i.beginPath(),i.moveTo(a.x,a.y),"spring"===s.render.type)for(var u,d=h.sub(o,a),_=h.perp(h.normalise(d)),f=Math.ceil(r.clamp(s.length/5,12,20)),p=1;p<f;p+=1)u=p%2==0?1:-1,i.lineTo(a.x+d.x*(p/f)+_.x*u*4,a.y+d.y*(p/f)+_.y*u*4);i.lineTo(o.x,o.y)}s.render.lineWidth&&(i.lineWidth=s.render.lineWidth,i.strokeStyle=s.render.strokeStyle,i.stroke()),s.render.anchors&&(i.fillStyle=s.render.strokeStyle,i.beginPath(),i.arc(a.x,a.y,3,0,2*Math.PI),i.arc(o.x,o.y,3,0,2*Math.PI),i.closePath(),i.fill())}}},n.bodies=function(t,e,i){var n,r,s,a,o=i,h=(t.engine,t.options),l=h.showInternalEdges||!h.wireframes;for(s=0;s<e.length;s++)if((n=e[s]).render.visible)for(a=1<n.parts.length?1:0;a<n.parts.length;a++)if((r=n.parts[a]).render.visible){if(h.showSleeping&&n.isSleeping?o.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(o.globalAlpha=r.render.opacity),r.render.sprite&&r.render.sprite.texture&&!h.wireframes){var c=r.render.sprite,u=d(t,c.texture);o.translate(r.position.x,r.position.y),o.rotate(r.angle),o.drawImage(u,u.width*-c.xOffset*c.xScale,u.height*-c.yOffset*c.yScale,u.width*c.xScale,u.height*c.yScale),o.rotate(-r.angle),o.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)o.beginPath(),o.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{o.beginPath(),o.moveTo(r.vertices[0].x,r.vertices[0].y);for(var _=1;_<r.vertices.length;_++)!r.vertices[_-1].isInternal||l?o.lineTo(r.vertices[_].x,r.vertices[_].y):o.moveTo(r.vertices[_].x,r.vertices[_].y),r.vertices[_].isInternal&&!l&&o.moveTo(r.vertices[(_+1)%r.vertices.length].x,r.vertices[(_+1)%r.vertices.length].y);o.lineTo(r.vertices[0].x,r.vertices[0].y),o.closePath()}h.wireframes?(o.lineWidth=1,o.strokeStyle="#bbb",o.stroke()):(o.fillStyle=r.render.fillStyle,r.render.lineWidth&&(o.lineWidth=r.render.lineWidth,o.strokeStyle=r.render.strokeStyle,o.stroke()),o.fill())}o.globalAlpha=1}},n.bodyWireframes=function(t,e,i){var n,r,s,a,o,h=i,l=t.options.showInternalEdges;for(h.beginPath(),s=0;s<e.length;s++)if((n=e[s]).render.visible)for(o=1<n.parts.length?1:0;o<n.parts.length;o++){for(r=n.parts[o],h.moveTo(r.vertices[0].x,r.vertices[0].y),a=1;a<r.vertices.length;a++)!r.vertices[a-1].isInternal||l?h.lineTo(r.vertices[a].x,r.vertices[a].y):h.moveTo(r.vertices[a].x,r.vertices[a].y),r.vertices[a].isInternal&&!l&&h.moveTo(r.vertices[(a+1)%r.vertices.length].x,r.vertices[(a+1)%r.vertices.length].y);h.lineTo(r.vertices[0].x,r.vertices[0].y)}h.lineWidth=1,h.strokeStyle="#bbb",h.stroke()},n.bodyConvexHulls=function(t,e,i){var n,r,s,a=i;for(a.beginPath(),r=0;r<e.length;r++)if((n=e[r]).render.visible&&1!==n.parts.length){for(a.moveTo(n.vertices[0].x,n.vertices[0].y),s=1;s<n.vertices.length;s++)a.lineTo(n.vertices[s].x,n.vertices[s].y);a.lineTo(n.vertices[0].x,n.vertices[0].y)}a.lineWidth=1,a.strokeStyle="rgba(255,255,255,0.2)",a.stroke()},n.vertexNumbers=function(t,e,i){var n,r,s,a=i;for(n=0;n<e.length;n++){var o=e[n].parts;for(s=1<o.length?1:0;s<o.length;s++){var h=o[s];for(r=0;r<h.vertices.length;r++)a.fillStyle="rgba(255,255,255,0.2)",a.fillText(n+"_"+r,h.position.x+.8*(h.vertices[r].x-h.position.x),h.position.y+.8*(h.vertices[r].y-h.position.y))}}},n.mousePosition=function(t,e,i){var n=i;n.fillStyle="rgba(255,255,255,0.8)",n.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},n.bodyBounds=function(t,e,i){var n=i,r=(t.engine,t.options);n.beginPath();for(var s=0;s<e.length;s++)if(e[s].render.visible)for(var a=e[s].parts,o=1<a.length?1:0;o<a.length;o++){var h=a[o];n.rect(h.bounds.min.x,h.bounds.min.y,h.bounds.max.x-h.bounds.min.x,h.bounds.max.y-h.bounds.min.y)}r.wireframes?n.strokeStyle="rgba(255,255,255,0.08)":n.strokeStyle="rgba(0,0,0,0.1)",n.lineWidth=1,n.stroke()},n.bodyAxes=function(t,e,i){var n,r,s,a,o=i,h=(t.engine,t.options);for(o.beginPath(),r=0;r<e.length;r++){var l=e[r],c=l.parts;if(l.render.visible)if(h.showAxes)for(s=1<c.length?1:0;s<c.length;s++)for(n=c[s],a=0;a<n.axes.length;a++){var u=n.axes[a];o.moveTo(n.position.x,n.position.y),o.lineTo(n.position.x+20*u.x,n.position.y+20*u.y)}else for(s=1<c.length?1:0;s<c.length;s++)for(n=c[s],a=0;a<n.axes.length;a++)o.moveTo(n.position.x,n.position.y),o.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2)}h.wireframes?(o.strokeStyle="indianred",o.lineWidth=1):(o.strokeStyle="rgba(255, 255, 255, 0.4)",o.globalCompositeOperation="overlay",o.lineWidth=2),o.stroke(),o.globalCompositeOperation="source-over"},n.bodyPositions=function(t,e,i){var n,r,s,a,o=i,h=(t.engine,t.options);for(o.beginPath(),s=0;s<e.length;s++)if((n=e[s]).render.visible)for(a=0;a<n.parts.length;a++)r=n.parts[a],o.arc(r.position.x,r.position.y,3,0,2*Math.PI,!1),o.closePath();for(h.wireframes?o.fillStyle="indianred":o.fillStyle="rgba(0,0,0,0.5)",o.fill(),o.beginPath(),s=0;s<e.length;s++)(n=e[s]).render.visible&&(o.arc(n.positionPrev.x,n.positionPrev.y,2,0,2*Math.PI,!1),o.closePath());o.fillStyle="rgba(255,165,0,0.8)",o.fill()},n.bodyVelocity=function(t,e,i){var n=i;n.beginPath();for(var r=0;r<e.length;r++){var s=e[r];s.render.visible&&(n.moveTo(s.position.x,s.position.y),n.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}n.lineWidth=3,n.strokeStyle="cornflowerblue",n.stroke()},n.bodyIds=function(t,e,i){var n,r,s=i;for(n=0;n<e.length;n++)if(e[n].render.visible){var a=e[n].parts;for(r=1<a.length?1:0;r<a.length;r++){var o=a[r];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(o.id,o.position.x+10,o.position.y-10)}}},n.collisions=function(t,e,i){var n,r,s,a,o=i,h=t.options;for(o.beginPath(),s=0;s<e.length;s++)if((n=e[s]).isActive)for(r=n.collision,a=0;a<n.activeContacts.length;a++){var l=n.activeContacts[a].vertex;o.rect(l.x-1.5,l.y-1.5,3.5,3.5)}for(h.wireframes?o.fillStyle="rgba(255,255,255,0.7)":o.fillStyle="orange",o.fill(),o.beginPath(),s=0;s<e.length;s++)if((n=e[s]).isActive&&(r=n.collision,0<n.activeContacts.length)){var c=n.activeContacts[0].vertex.x,u=n.activeContacts[0].vertex.y;2===n.activeContacts.length&&(c=(n.activeContacts[0].vertex.x+n.activeContacts[1].vertex.x)/2,u=(n.activeContacts[0].vertex.y+n.activeContacts[1].vertex.y)/2),r.bodyB===r.supports[0].body||!0===r.bodyA.isStatic?o.moveTo(c-8*r.normal.x,u-8*r.normal.y):o.moveTo(c+8*r.normal.x,u+8*r.normal.y),o.lineTo(c,u)}h.wireframes?o.strokeStyle="rgba(255,165,0,0.7)":o.strokeStyle="orange",o.lineWidth=1,o.stroke()},n.separations=function(t,e,i){var n,r,s,a,o,h=i,l=t.options;for(h.beginPath(),o=0;o<e.length;o++)if((n=e[o]).isActive){s=(r=n.collision).bodyA;var c=1;(a=r.bodyB).isStatic||s.isStatic||(c=.5),a.isStatic&&(c=0),h.moveTo(a.position.x,a.position.y),h.lineTo(a.position.x-r.penetration.x*c,a.position.y-r.penetration.y*c),c=1,a.isStatic||s.isStatic||(c=.5),s.isStatic&&(c=0),h.moveTo(s.position.x,s.position.y),h.lineTo(s.position.x+r.penetration.x*c,s.position.y+r.penetration.y*c)}l.wireframes?h.strokeStyle="rgba(255,165,0,0.5)":h.strokeStyle="orange",h.stroke()},n.inspector=function(t,e){t.engine;var i,n=t.selected,r=t.render,s=r.options;if(s.hasBounds){var a=r.bounds.max.x-r.bounds.min.x,o=r.bounds.max.y-r.bounds.min.y,h=a/r.options.width,l=o/r.options.height;e.scale(1/h,1/l),e.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var c=0;c<n.length;c++){var u=n[c].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),u.type){case"body":i=u.bounds,e.beginPath(),e.rect(Math.floor(i.min.x-3),Math.floor(i.min.y-3),Math.floor(i.max.x-i.min.x+6),Math.floor(i.max.y-i.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var d=u.pointA;u.bodyA&&(d=u.pointB),e.beginPath(),e.arc(d.x,d.y,10,0,2*Math.PI),e.closePath(),e.stroke()}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",i=t.selectBounds,e.beginPath(),e.rect(Math.floor(i.min.x),Math.floor(i.min.y),Math.floor(i.max.x-i.min.x),Math.floor(i.max.y-i.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),s.hasBounds&&e.setTransform(1,0,0,1,0,0)};var t=function(t,e){var i=t.engine,r=t.timing,s=r.historySize,a=i.timing.timestamp;r.delta=e-r.lastTime||n._goodDelta,r.lastTime=e,r.timestampElapsed=a-r.lastTimestamp||0,r.lastTimestamp=a,r.deltaHistory.unshift(r.delta),r.deltaHistory.length=Math.min(r.deltaHistory.length,s),r.engineDeltaHistory.unshift(i.timing.lastDelta),r.engineDeltaHistory.length=Math.min(r.engineDeltaHistory.length,s),r.timestampElapsedHistory.unshift(r.timestampElapsed),r.timestampElapsedHistory.length=Math.min(r.timestampElapsedHistory.length,s),r.engineElapsedHistory.unshift(i.timing.lastElapsed),r.engineElapsedHistory.length=Math.min(r.engineElapsedHistory.length,s),r.elapsedHistory.unshift(r.lastElapsed),r.elapsedHistory.length=Math.min(r.elapsedHistory.length,s)},e=function(t){for(var e=0,i=0;i<t.length;i+=1)e+=t[i];return e/t.length||0},i=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1},i},u=function(t){var e=t.getContext("2d");return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},d=function(t,e){var i=t.textures[e];return i||((i=t.textures[e]=new Image).src=e,i)},_=function(t,e){var i=e;/(jpg|gif|png)$/.test(e)&&(i="url("+e+")"),t.canvas.style.background=i,t.canvas.style.backgroundSize="contain",t.currentBackground=e}}()},function(t,e){(t.exports={}).create=function(t){return{vertex:t,normalImpulse:0,tangentImpulse:0}}},function(t,e,i){var n={};t.exports=n;var r=i(7),s=i(19),a=i(14),o=i(20),h=i(4),l=i(5),c=i(10),u=i(0),d=i(6);i(2),n.create=function(t){t=t||{};var e=u.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},t);return e.world=t.world||l.create({label:"World"}),e.pairs=t.pairs||o.create(),e.detector=t.detector||a.create(),e.grid={buckets:[]},e.world.gravity=e.gravity,e.broadphase=e.grid,e.metrics={},e},n.update=function(t,e,i){var d=u.now();e=e||1e3/60,i=i||1;var _=t.world,f=t.detector,p=t.pairs,m=t.timing,g=m.timestamp;m.timestamp+=e*m.timeScale,m.lastDelta=e*m.timeScale;var v={timestamp:m.timestamp};h.trigger(t,"beforeUpdate",v);var y=l.allBodies(_),x=l.allConstraints(_);for(_.isModified&&a.setBodies(f,y),_.isModified&&l.setModified(_,!1,!1,!0),t.enableSleeping&&r.update(y,m.timeScale),n._bodiesApplyGravity(y,t.gravity),n._bodiesUpdate(y,e,m.timeScale,i,_.bounds),c.preSolveAll(y),b=0;b<t.constraintIterations;b++)c.solveAll(x,m.timeScale);c.postSolveAll(y),f.pairs=t.pairs;var w=a.collisions(f);for(o.update(p,w,g),t.enableSleeping&&r.afterCollisions(p.list,m.timeScale),0<p.collisionStart.length&&h.trigger(t,"collisionStart",{pairs:p.collisionStart}),s.preSolvePosition(p.list),b=0;b<t.positionIterations;b++)s.solvePosition(p.list,m.timeScale);s.postSolvePosition(y);for(var b=0;b<p.list.length;b++){var S=p.list[b];S.isActive&&0<S.collision.depth&&(a.worldBoundsLimit(S.bodyA,S),a.worldBoundsLimit(S.bodyB,S))}for(c.preSolveAll(y),b=0;b<t.constraintIterations;b++)c.solveAll(x,m.timeScale);for(c.postSolveAll(y),s.preSolveVelocity(p.list),b=0;b<t.velocityIterations;b++)s.solveVelocity(p.list,m.timeScale);return 0<p.collisionActive.length&&h.trigger(t,"collisionActive",{pairs:p.collisionActive}),0<p.collisionEnd.length&&h.trigger(t,"collisionEnd",{pairs:p.collisionEnd}),n._bodiesClearForces(y),h.trigger(t,"afterUpdate",v),t.timing.lastElapsed=u.now()-d,t},n.merge=function(t,e){if(u.extend(t,e),e.world){t.world=e.world,n.clear(t);for(var i=l.allBodies(t.world),s=0;s<i.length;s++){var a=i[s];r.set(a,!1),a.id=u.nextId()}}},n.clear=function(t){o.clear(t.pairs),a.clear(t.detector)},n._bodiesClearForces=function(t){for(var e=0;e<t.length;e++){var i=t[e];i.force.x=0,i.force.y=0,i.torque=0}},n._bodiesApplyGravity=function(t,e){var i=void 0!==e.scale?e.scale:.001;if((0!==e.x||0!==e.y)&&0!==i)for(var n=0;n<t.length;n++){var r=t[n];r.isStatic||r.isSleeping||(r.force.y+=r.mass*e.y*i,r.force.x+=r.mass*e.x*i)}},n._bodiesUpdate=function(t,e,i,n,r){for(var s=0;s<t.length;s++){var a=t[s];a.isStatic||a.isSleeping||d.update(a,e,i,n)}}},function(t,e,i){var n={};t.exports=n;var r=i(3),s=i(1);n._restingThresh=4,n._restingThreshTangent=6,n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n.preSolvePosition=function(t){var e,i,n,r=t.length;for(e=0;e<r;e++)(i=t[e]).isActive&&(n=i.activeContacts.length,i.collision.parentA.totalContacts+=n,i.collision.parentB.totalContacts+=n)},n.solvePosition=function(t,e){var i,r,s,a,o,h,l,c,u=n._positionDampen,d=t.length;for(i=0;i<d;i++)(r=t[i]).isActive&&!r.isSensor&&(a=(s=r.collision).parentA,o=s.parentB,h=s.normal,r.separation=h.x*(o.positionImpulse.x+s.penetration.x-a.positionImpulse.x)+h.y*(o.positionImpulse.y+s.penetration.y-a.positionImpulse.y));for(i=0;i<d;i++)(r=t[i]).isActive&&!r.isSensor&&(a=(s=r.collision).parentA,o=s.parentB,h=s.normal,c=(r.separation-r.slop)*e,(a.isStatic||o.isStatic)&&(c*=2),a.isStatic||a.isSleeping||(l=u/a.totalContacts,a.positionImpulse.x+=h.x*c*l,a.positionImpulse.y+=h.y*c*l),o.isStatic||o.isSleeping||(l=u/o.totalContacts,o.positionImpulse.x-=h.x*c*l,o.positionImpulse.y-=h.y*c*l))},n.postSolvePosition=function(t){for(var e=n._positionWarming,i=t.length,a=r.translate,o=s.update,h=0;h<i;h++){var l=t[h],c=l.positionImpulse,u=c.x,d=c.y,_=l.velocity;if((l.totalContacts=0)!==u||0!==d){for(var f=0;f<l.parts.length;f++){var p=l.parts[f];a(p.vertices,c),o(p.bounds,p.vertices,_),p.position.x+=u,p.position.y+=d}l.positionPrev.x+=u,l.positionPrev.y+=d,u*_.x+d*_.y<0?(c.x=0,c.y=0):(c.x*=e,c.y*=e)}}},n.preSolveVelocity=function(t){var e,i,n=t.length;for(e=0;e<n;e++){var r=t[e];if(r.isActive&&!r.isSensor){var s=r.activeContacts,a=s.length,o=r.collision,h=o.parentA,l=o.parentB,c=o.normal,u=o.tangent;for(i=0;i<a;i++){var d=s[i],_=d.vertex,f=d.normalImpulse,p=d.tangentImpulse;if(0!==f||0!==p){var m=c.x*f+u.x*p,g=c.y*f+u.y*p;h.isStatic||h.isSleeping||(h.positionPrev.x+=m*h.inverseMass,h.positionPrev.y+=g*h.inverseMass,h.anglePrev+=h.inverseInertia*((_.x-h.position.x)*g-(_.y-h.position.y)*m)),l.isStatic||l.isSleeping||(l.positionPrev.x-=m*l.inverseMass,l.positionPrev.y-=g*l.inverseMass,l.anglePrev-=l.inverseInertia*((_.x-l.position.x)*g-(_.y-l.position.y)*m))}}}}},n.solveVelocity=function(t,e){var i,r,s,a,o=e*e,h=n._restingThresh*o,l=n._frictionNormalMultiplier,c=n._restingThreshTangent*o,u=Number.MAX_VALUE,d=t.length;for(s=0;s<d;s++){var _=t[s];if(_.isActive&&!_.isSensor){var f=_.collision,p=f.parentA,m=f.parentB,g=p.velocity,v=m.velocity,y=f.normal.x,x=f.normal.y,w=f.tangent.x,b=f.tangent.y,S=_.activeContacts,T=S.length,C=1/T,M=p.inverseMass+m.inverseMass,I=_.friction*_.frictionStatic*l*o;for(g.x=p.position.x-p.positionPrev.x,g.y=p.position.y-p.positionPrev.y,v.x=m.position.x-m.positionPrev.x,v.y=m.position.y-m.positionPrev.y,p.angularVelocity=p.angle-p.anglePrev,m.angularVelocity=m.angle-m.anglePrev,a=0;a<T;a++){var E=S[a],A=E.vertex,D=A.x-p.position.x,P=A.y-p.position.y,R=A.x-m.position.x,N=A.y-m.position.y,L=g.x-P*p.angularVelocity,B=g.y+D*p.angularVelocity,O=L-(v.x-N*m.angularVelocity),F=B-(v.y+R*m.angularVelocity),k=y*O+x*F,V=w*O+b*F,U=_.separation+k,H=Math.min(U,1),z=(H=U<0?0:H)*I;z<V||z<-V?(r=0<V?V:-V,(i=_.friction*(0<V?1:-1)*o)<-r?i=-r:r<i&&(i=r)):(i=V,r=u);var W=D*x-P*y,G=R*x-N*y,Y=C/(M+p.inverseInertia*W*W+m.inverseInertia*G*G),X=(1+_.restitution)*k*Y;if(i*=Y,h<k*k&&k<0)E.normalImpulse=0;else{var j=E.normalImpulse;E.normalImpulse+=X,E.normalImpulse=Math.min(E.normalImpulse,0),X=E.normalImpulse-j}if(c<V*V)E.tangentImpulse=0;else{var K=E.tangentImpulse;E.tangentImpulse+=i,E.tangentImpulse<-r&&(E.tangentImpulse=-r),E.tangentImpulse>r&&(E.tangentImpulse=r),i=E.tangentImpulse-K}var q=y*X+w*i,Z=x*X+b*i;p.isStatic||p.isSleeping||(p.positionPrev.x+=q*p.inverseMass,p.positionPrev.y+=Z*p.inverseMass,p.anglePrev+=(D*Z-P*q)*p.inverseInertia),m.isStatic||m.isSleeping||(m.positionPrev.x-=q*m.inverseMass,m.positionPrev.y-=Z*m.inverseMass,m.anglePrev-=(R*Z-N*q)*m.inverseInertia)}}}}},function(t,e,i){var n={};t.exports=n;var r=i(9),s=i(0);n.create=function(t){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},n.update=function(t,e,i){var n,s,a,o,h=t.list,l=h.length,c=t.table,u=e.length,d=t.collisionStart,_=t.collisionEnd,f=t.collisionActive;for(d.length=0,_.length=0,o=f.length=0;o<l;o++)h[o].confirmedActive=!1;for(o=0;o<u;o++)(a=(n=e[o]).pair)?(a.isActive?f.push(a):d.push(a),r.update(a,n,i),a.confirmedActive=!0):(c[(a=r.create(n,i)).id]=a,d.push(a),h.push(a));var p=[];for(l=h.length,o=0;o<l;o++)(a=h[o]).confirmedActive||(r.setActive(a,!1,i),_.push(a),a.collision.bodyA.isSleeping||a.collision.bodyB.isSleeping||p.push(o));for(o=0;o<p.length;o++)a=h[s=p[o]-o],h.splice(s,1),delete c[a.id]},n.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}},function(t,e,i){var n=t.exports=i(22);n.Axes=i(11),n.Bodies=i(12),n.Body=i(6),n.Bounds=i(1),n.Collision=i(8),n.Common=i(0),n.Composite=i(5),n.Composites=i(23),n.Constraint=i(10),n.Contact=i(17),n.Detector=i(14),n.Engine=i(18),n.Events=i(4),n.Grid=i(24),n.Mouse=i(13),n.MouseConstraint=i(25),n.Pair=i(9),n.Pairs=i(20),n.Plugin=i(15),n.Query=i(26),n.Render=i(16),n.Resolver=i(19),n.Runner=i(27),n.SAT=i(28),n.Sleeping=i(7),n.Svg=i(29),n.Vector=i(2),n.Vertices=i(3),n.World=i(30),n.Engine.run=n.Runner.run,n.Common.deprecated(n.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(t,e,i){var n={};t.exports=n;var r=i(15),s=i(0);n.name="matter-js",n.version="0.18.0",n.uses=[],n.used=[],n.use=function(){r.use(n,Array.prototype.slice.call(arguments))},n.before=function(t,e){return t=t.replace(/^Matter./,""),s.chainPathBefore(n,t,e)},n.after=function(t,e){return t=t.replace(/^Matter./,""),s.chainPathAfter(n,t,e)}},function(t,e,i){var n={};t.exports=n;var r=i(5),s=i(10),a=i(0),o=i(6),h=i(12),l=a.deprecated;n.stack=function(t,e,i,n,s,a,h){for(var l,c=r.create({label:"Stack"}),u=t,d=e,_=0,f=0;f<n;f++){for(var p=0,m=0;m<i;m++){var g=h(u,d,m,f,l,_);if(g){var v=g.bounds.max.y-g.bounds.min.y,y=g.bounds.max.x-g.bounds.min.x;p<v&&(p=v),o.translate(g,{x:.5*y,y:.5*v}),u=g.bounds.max.x+s,r.addBody(c,g),l=g,_+=1}else u+=s}d+=p+a,u=t}return c},n.chain=function(t,e,i,n,o,h){for(var l=t.bodies,c=1;c<l.length;c++){var u=l[c-1],d=l[c],_=u.bounds.max.y-u.bounds.min.y,f=u.bounds.max.x-u.bounds.min.x,p=d.bounds.max.y-d.bounds.min.y,m={bodyA:u,pointA:{x:f*e,y:_*i},bodyB:d,pointB:{x:(d.bounds.max.x-d.bounds.min.x)*n,y:p*o}},g=a.extend(m,h);r.addConstraint(t,s.create(g))}return t.label+=" Chain",t},n.mesh=function(t,e,i,n,o){var h,l,c,u,d,_=t.bodies;for(h=0;h<i;h++){for(l=1;l<e;l++)c=_[l-1+h*e],u=_[l+h*e],r.addConstraint(t,s.create(a.extend({bodyA:c,bodyB:u},o)));if(0<h)for(l=0;l<e;l++)c=_[l+(h-1)*e],u=_[l+h*e],r.addConstraint(t,s.create(a.extend({bodyA:c,bodyB:u},o))),n&&0<l&&(d=_[l-1+(h-1)*e],r.addConstraint(t,s.create(a.extend({bodyA:d,bodyB:u},o)))),n&&l<e-1&&(d=_[l+1+(h-1)*e],r.addConstraint(t,s.create(a.extend({bodyA:d,bodyB:u},o))))}return t.label+=" Mesh",t},n.pyramid=function(t,e,i,r,s,a,h){return n.stack(t,e,i,r,s,a,(function(e,n,a,l,c,u){var d=Math.min(r,Math.ceil(i/2)),_=c?c.bounds.max.x-c.bounds.min.x:0;if(!(d<l||a<(l=d-l)||i-1-l<a))return 1===u&&o.translate(c,{x:(a+(i%2==1?1:-1))*_,y:0}),h(t+(c?a*_:0)+a*s,n,a,l,c,u)}))},n.newtonsCradle=function(t,e,i,n,a){for(var o=r.create({label:"Newtons Cradle"}),l=0;l<i;l++){var c=h.circle(t+l*(1.9*n),e+a,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),u=s.create({pointA:{x:t+l*(1.9*n),y:e},bodyB:c});r.addBody(o,c),r.addConstraint(o,u)}return o},l(n,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),n.car=function(t,e,i,n,a){var l=o.nextGroup(!0),c=.5*-i+20,u=.5*i-20,d=r.create({label:"Car"}),_=h.rectangle(t,e,i,n,{collisionFilter:{group:l},chamfer:{radius:.5*n},density:2e-4}),f=h.circle(t+c,e+0,a,{collisionFilter:{group:l},friction:.8}),p=h.circle(t+u,e+0,a,{collisionFilter:{group:l},friction:.8}),m=s.create({bodyB:_,pointB:{x:c,y:0},bodyA:f,stiffness:1,length:0}),g=s.create({bodyB:_,pointB:{x:u,y:0},bodyA:p,stiffness:1,length:0});return r.addBody(d,_),r.addBody(d,f),r.addBody(d,p),r.addConstraint(d,m),r.addConstraint(d,g),d},l(n,"car","Composites.car ➤ moved to car example"),n.softBody=function(t,e,i,r,s,o,l,c,u,d){u=a.extend({inertia:1/0},u),d=a.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var _=n.stack(t,e,i,r,s,o,(function(t,e){return h.circle(t,e,c,u)}));return n.mesh(_,i,r,l,d),_.label="Soft Body",_},l(n,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(t,e,i){var n={};t.exports=n;var r=i(9),s=i(0),a=s.deprecated;n.create=function(t){return s.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},t)},n.update=function(t,e,i,r){var s,a,o,h,l,c=i.world,u=t.buckets,d=!1;for(s=0;s<e.length;s++){var _=e[s];if((!_.isSleeping||r)&&(!c.bounds||!(_.bounds.max.x<c.bounds.min.x||_.bounds.min.x>c.bounds.max.x||_.bounds.max.y<c.bounds.min.y||_.bounds.min.y>c.bounds.max.y))){var f=n._getRegion(t,_);if(!_.region||f.id!==_.region.id||r){_.region&&!r||(_.region=f);var p=n._regionUnion(f,_.region);for(a=p.startCol;a<=p.endCol;a++)for(o=p.startRow;o<=p.endRow;o++){h=u[l=n._getBucketId(a,o)];var m=a>=f.startCol&&a<=f.endCol&&o>=f.startRow&&o<=f.endRow,g=a>=_.region.startCol&&a<=_.region.endCol&&o>=_.region.startRow&&o<=_.region.endRow;!m&&g&&g&&h&&n._bucketRemoveBody(t,h,_),(_.region===f||m&&!g||r)&&(h||(h=n._createBucket(u,l)),n._bucketAddBody(t,h,_))}_.region=f,d=!0}}}d&&(t.pairsList=n._createActivePairsList(t))},a(n,"update","Grid.update ➤ replaced by Matter.Detector"),n.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]},a(n,"clear","Grid.clear ➤ replaced by Matter.Detector"),n._regionUnion=function(t,e){var i=Math.min(t.startCol,e.startCol),r=Math.max(t.endCol,e.endCol),s=Math.min(t.startRow,e.startRow),a=Math.max(t.endRow,e.endRow);return n._createRegion(i,r,s,a)},n._getRegion=function(t,e){var i=e.bounds,r=Math.floor(i.min.x/t.bucketWidth),s=Math.floor(i.max.x/t.bucketWidth),a=Math.floor(i.min.y/t.bucketHeight),o=Math.floor(i.max.y/t.bucketHeight);return n._createRegion(r,s,a,o)},n._createRegion=function(t,e,i,n){return{id:t+","+e+","+i+","+n,startCol:t,endCol:e,startRow:i,endRow:n}},n._getBucketId=function(t,e){return"C"+t+"R"+e},n._createBucket=function(t,e){return t[e]=[]},n._bucketAddBody=function(t,e,i){var n,s=t.pairs,a=r.id,o=e.length;for(n=0;n<o;n++){var h=e[n];if(!(i.id===h.id||i.isStatic&&h.isStatic)){var l=a(i,h),c=s[l];c?c[2]+=1:s[l]=[i,h,1]}}e.push(i)},n._bucketRemoveBody=function(t,e,i){var n,a=t.pairs,o=r.id;e.splice(s.indexOf(e,i),1);var h=e.length;for(n=0;n<h;n++){var l=a[o(i,e[n])];l&&(l[2]-=1)}},n._createActivePairsList=function(t){var e,i,n=t.pairs,r=s.keys(n),a=r.length,o=[];for(i=0;i<a;i++)0<(e=n[r[i]])[2]?o.push(e):delete n[r[i]];return o}},function(t,e,i){var n={};t.exports=n;var r=i(3),s=i(7),a=i(13),o=i(4),h=i(14),l=i(10),c=i(5),u=i(0),d=i(1);n.create=function(t,e){var i=(t?t.mouse:null)||(e?e.mouse:null);i||(t&&t.render&&t.render.canvas?i=a.create(t.render.canvas):e&&e.element?i=a.create(e.element):(i=a.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var r={type:"mouseConstraint",mouse:i,element:null,body:null,constraint:l.create({label:"Mouse Constraint",pointA:i.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},s=u.extend(r,e);return o.on(t,"beforeUpdate",(function(){var e=c.allBodies(t.world);n.update(s,e),n._triggerEvents(s)})),s},n.update=function(t,e){var i=t.mouse,n=t.constraint,a=t.body;if(0===i.button){if(n.bodyB)s.set(n.bodyB,!1),n.pointA=i.position;else for(var l=0;l<e.length;l++)if(a=e[l],d.contains(a.bounds,i.position)&&h.canCollide(a.collisionFilter,t.collisionFilter))for(var c=1<a.parts.length?1:0;c<a.parts.length;c++){var u=a.parts[c];if(r.contains(u.vertices,i.position)){n.pointA=i.position,n.bodyB=t.body=a,n.pointB={x:i.position.x-a.position.x,y:i.position.y-a.position.y},n.angleB=a.angle,s.set(a,!1),o.trigger(t,"startdrag",{mouse:i,body:a});break}}}else n.bodyB=t.body=null,n.pointB=null,a&&o.trigger(t,"enddrag",{mouse:i,body:a})},n._triggerEvents=function(t){var e=t.mouse,i=e.sourceEvents;i.mousemove&&o.trigger(t,"mousemove",{mouse:e}),i.mousedown&&o.trigger(t,"mousedown",{mouse:e}),i.mouseup&&o.trigger(t,"mouseup",{mouse:e}),i.mouseout&&o.trigger(t,"mouseout",{mouse:e}),a.clearSourceEvents(e)}},function(t,e,i){var n={};t.exports=n;var r=i(2),s=i(8),a=i(1),o=i(12),h=i(3);n.collides=function(t,e){for(var i=[],n=e.length,r=t.bounds,o=s.collides,h=a.overlaps,l=0;l<n;l++){var c=e[l],u=c.parts.length,d=1===u?0:1;if(h(c.bounds,r))for(var _=d;_<u;_++){var f=c.parts[_];if(h(f.bounds,r)){var p=o(f,t);if(p){i.push(p);break}}}}return i},n.ray=function(t,e,i,s){s=s||1e-100;for(var a=r.angle(e,i),h=r.magnitude(r.sub(e,i)),l=.5*(i.x+e.x),c=.5*(i.y+e.y),u=o.rectangle(l,c,h,s,{angle:a}),d=n.collides(u,t),_=0;_<d.length;_+=1){var f=d[_];f.body=f.bodyB=f.bodyA}return d},n.region=function(t,e,i){for(var n=[],r=0;r<t.length;r++){var s=t[r],o=a.overlaps(s.bounds,e);(o&&!i||!o&&i)&&n.push(s)}return n},n.point=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n];if(a.contains(r.bounds,e))for(var s=1===r.parts.length?0:1;s<r.parts.length;s++){var o=r.parts[s];if(a.contains(o.bounds,e)&&h.contains(o.vertices,e)){i.push(r);break}}}return i}},function(t,e,i){var n={};t.exports=n;var r=i(4),s=i(18),a=i(0);n.create=function(t){var e=a.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},t);return e.delta=e.delta||1e3/e.fps,e.deltaMin=e.deltaMin||1e3/e.fps,e.deltaMax=e.deltaMax||1e3/(.5*e.fps),e.fps=1e3/e.delta,e},n.run=function(t,e){return void 0!==t.positionIterations&&(e=t,t=n.create()),c.timer.clear(this,n.render),c.timer.frameLoop(1,this,n.render,[t,e]),t},n.render=function(t,e){t.enabled&&n.tick(t,e,a.now())},n.tick=function(t,e,i){var n,a=e.timing,o=1,h={timestamp:a.timestamp};r.trigger(t,"beforeTick",h),t.isFixed?n=t.delta:(n=i-t.timePrev||t.delta,t.timePrev=i,t.deltaHistory.push(n),t.deltaHistory=t.deltaHistory.slice(-t.deltaSampleSize),o=(n=(n=(n=Math.min.apply(null,t.deltaHistory))<t.deltaMin?t.deltaMin:n)>t.deltaMax?t.deltaMax:n)/t.delta,t.delta=n),0!==t.timeScalePrev&&(o*=a.timeScale/t.timeScalePrev),0===a.timeScale&&(o=0),t.timeScalePrev=a.timeScale,t.correction=o,t.frameCounter+=1,1e3<=i-t.counterTimestamp&&(t.fps=t.frameCounter*((i-t.counterTimestamp)/1e3),t.counterTimestamp=i,t.frameCounter=0),r.trigger(t,"tick",h),r.trigger(t,"beforeUpdate",h),s.update(e,n,o),r.trigger(t,"afterUpdate",h),r.trigger(t,"afterTick",h)},n.stop=function(t){c.timer.clear(this,n.render)},n.start=function(t,e){n.run(t,e)}},function(t,e,i){var n={};t.exports=n;var r=i(8),s=i(0).deprecated;n.collides=function(t,e){return r.collides(t,e)},s(n,"collides","SAT.collides ➤ replaced by Collision.collides")},function(t,e,i){var n={};t.exports=n,i(1);var r=i(0);n.pathToVertices=function(t,e){"undefined"==typeof window||"SVGPathSeg"in window||r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var i,s,a,o,h,l,c,u,d,_,f,p=[],m=0,g=0,v=0;function y(t,e,i){var n=i%2==1&&1<i;if(!d||t!=d.x||e!=d.y){f=d&&n?(_=d.x,d.y):_=0;var r={x:_+t,y:f+e};!n&&d||(d=r),p.push(r),g=_+t,v=f+e}}function x(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":g=t.x,v=t.y;break;case"H":g=t.x;break;case"V":v=t.y}y(g,v,t.pathSegType)}}for(e=e||15,n._svgPathToAbsolute(t),a=t.getTotalLength(),l=[],i=0;i<t.pathSegList.numberOfItems;i+=1)l.push(t.pathSegList.getItem(i));for(c=l.concat();m<a;){if((h=l[t.getPathSegAtLength(m)])!=u){for(;c.length&&c[0]!=h;)x(c.shift());u=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":y((o=t.getPointAtLength(m)).x,o.y,0)}m+=e}for(i=0,s=c.length;i<s;++i)x(c[i]);return p},n._svgPathToAbsolute=function(t){for(var e,i,n,r,s,a,o=t.pathSegList,h=0,l=0,c=o.numberOfItems,u=0;u<c;++u){var d=o.getItem(u),_=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(_))"x"in d&&(h=d.x),"y"in d&&(l=d.y);else switch("x1"in d&&(n=h+d.x1),"x2"in d&&(s=h+d.x2),"y1"in d&&(r=l+d.y1),"y2"in d&&(a=l+d.y2),"x"in d&&(h+=d.x),"y"in d&&(l+=d.y),_){case"m":o.replaceItem(t.createSVGPathSegMovetoAbs(h,l),u);break;case"l":o.replaceItem(t.createSVGPathSegLinetoAbs(h,l),u);break;case"h":o.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(h),u);break;case"v":o.replaceItem(t.createSVGPathSegLinetoVerticalAbs(l),u);break;case"c":o.replaceItem(t.createSVGPathSegCurvetoCubicAbs(h,l,n,r,s,a),u);break;case"s":o.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(h,l,s,a),u);break;case"q":o.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(h,l,n,r),u);break;case"t":o.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(h,l),u);break;case"a":o.replaceItem(t.createSVGPathSegArcAbs(h,l,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),u);break;case"z":case"Z":h=e,l=i}"M"!=_&&"m"!=_||(e=h,i=l)}}},function(t,e,i){var n={};t.exports=n;var r=i(5);i(0),n.create=r.create,n.add=r.add,n.remove=r.remove,n.clear=r.clear,n.addComposite=r.addComposite,n.addBody=r.addBody,n.addConstraint=r.addConstraint}])},window?window.Matter=h():t.exports=h(),o=function(){return function t(e,i,n){function r(a,o){if(!i[a]){if(!e[a]){if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=i[a]={exports:{}};e[a][0].call(h.exports,(function(t){return r(e[a][1][t]||t)}),h,h.exports,t,e,i,n)}return i[a].exports}for(var s=!1,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,i){function n(t,e,i){i=i||0;var n,r,s,a,o,h,l,c=[0,0];return n=t[1][1]-t[0][1],r=t[0][0]-t[1][0],s=n*t[0][0]+r*t[0][1],a=e[1][1]-e[0][1],o=e[0][0]-e[1][0],h=a*e[0][0]+o*e[0][1],S(l=n*o-a*r,0,i)||(c[0]=(o*s-r*h)/l,c[1]=(n*h-a*s)/l),c}function r(t,e,i,n){var r=e[0]-t[0],s=e[1]-t[1],a=n[0]-i[0],o=n[1]-i[1];if(a*s-o*r==0)return!1;var h=(r*(i[1]-t[1])+s*(t[0]-i[0]))/(a*s-o*r),l=(a*(t[1]-i[1])+o*(i[0]-t[0]))/(o*r-a*s);return 0<=h&&h<=1&&0<=l&&l<=1}function s(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])}function a(t,e,i){return 0<s(t,e,i)}function o(t,e,i){return 0<=s(t,e,i)}function h(t,e,i){return s(t,e,i)<0}function l(t,e,i){return s(t,e,i)<=0}e.exports={decomp:function(t){var e=function t(e){for(var i=[],n=[],r=[],s=[],a=Number.MAX_VALUE,o=0;o<e.length;++o)if(m(e,o))for(var h=0;h<e.length;++h)if(y(e,o,h)){n=t(w(e,o,h,s)),r=t(w(e,h,o,s));for(var l=0;l<r.length;l++)n.push(r[l]);n.length<a&&(a=(i=n).length,i.push([f(e,o),f(e,h)]))}return i}(t);return 0<e.length?function t(e,i){if(0===i.length)return[e];if(i instanceof Array&&i.length&&i[0]instanceof Array&&2===i[0].length&&i[0][0]instanceof Array){for(var n=[e],r=0;r<i.length;r++)for(var s=i[r],a=0;a<n.length;a++){var o=t(n[a],s);if(o){n.splice(a,1),n.push(o[0],o[1]);break}}return n}return s=i,r=e.indexOf(s[0]),a=e.indexOf(s[1]),-1!==r&&-1!==a&&[w(e,r,a),w(e,a,r)]}(t,e):[t]},quickDecomp:function t(e,i,n,r,s,c,u){c=c||100,u=u||0,s=s||25,i=void 0!==i?i:[],n=n||[],r=r||[];var d=[0,0],g=[0,0],v=[0,0],y=0,w=0,S=0,T=0,C=0,M=0,I=0,E=[],A=[],D=e,P=e;if(P.length<3)return i;if(c<++u)return console.warn("quickDecomp: max level ("+c+") reached."),i;for(var R=0;R<e.length;++R)if(m(D,R)){n.push(D[R]),y=w=Number.MAX_VALUE;for(var N=0;N<e.length;++N)a(f(D,R-1),f(D,R),f(D,N))&&l(f(D,R-1),f(D,R),f(D,N-1))&&(v=b(f(D,R-1),f(D,R),f(D,N),f(D,N-1)),h(f(D,R+1),f(D,R),v)&&(S=_(D[R],v))<w&&(w=S,g=v,M=N)),a(f(D,R+1),f(D,R),f(D,N+1))&&l(f(D,R+1),f(D,R),f(D,N))&&(v=b(f(D,R+1),f(D,R),f(D,N),f(D,N+1)),a(f(D,R-1),f(D,R),v)&&(S=_(D[R],v))<y&&(y=S,d=v,C=N));if(M===(C+1)%e.length)v[0]=(g[0]+d[0])/2,v[1]=(g[1]+d[1])/2,r.push(v),R<C?(p(E,D,R,C+1),E.push(v),A.push(v),0!==M&&p(A,D,M,D.length),p(A,D,0,R+1)):(0!==R&&p(E,D,R,D.length),p(E,D,0,C+1),E.push(v),A.push(v),p(A,D,M,R+1));else{if(C<M&&(C+=e.length),T=Number.MAX_VALUE,C<M)return i;for(N=M;N<=C;++N)o(f(D,R-1),f(D,R),f(D,N))&&l(f(D,R+1),f(D,R),f(D,N))&&(S=_(f(D,R),f(D,N)))<T&&x(D,R,N)&&(T=S,I=N%e.length);R<I?(p(E,D,R,I+1),0!==I&&p(A,D,I,P.length),p(A,D,0,R+1)):(0!==R&&p(E,D,R,P.length),p(E,D,0,I+1),p(A,D,I,R+1))}return E.length<A.length?(t(E,i,n,r,s,c,u),t(A,i,n,r,s,c,u)):(t(A,i,n,r,s,c,u),t(E,i,n,r,s,c,u)),i}return i.push(e),i},isSimple:function(t){var e,i=t;for(e=0;e<i.length-1;e++)for(var n=0;n<e-1;n++)if(r(i[e],i[e+1],i[n],i[n+1]))return!1;for(e=1;e<i.length-2;e++)if(r(i[0],i[i.length-1],i[e],i[e+1]))return!1;return!0},removeCollinearPoints:function(t,e){for(var i=0,n=t.length-1;3<t.length&&0<=n;--n)d(f(t,n-1),f(t,n),f(t,n+1),e)&&(t.splice(n%t.length,1),i++);return i},removeDuplicatePoints:function(t,e){for(var i=t.length-1;1<=i;--i)for(var n=t[i],r=i-1;0<=r;--r)s=n,a=t[r],o=e,S(s[0],a[0],o)&&S(s[1],a[1],o)&&t.splice(i,1);var s,a,o},makeCCW:function(t){for(var e=0,i=t,n=1;n<t.length;++n)(i[n][1]<i[e][1]||i[n][1]===i[e][1]&&i[n][0]>i[e][0])&&(e=n);return!a(f(t,e-1),f(t,e),f(t,e+1))&&(function(t){for(var e=[],i=t.length,n=0;n!==i;n++)e.push(t.pop());for(n=0;n!==i;n++)t[n]=e[n]}(t),!0)}};var c=[],u=[];function d(t,e,i,n){if(n){var r=c,a=u;r[0]=e[0]-t[0],r[1]=e[1]-t[1],a[0]=i[0]-e[0],a[1]=i[1]-e[1];var o=r[0]*a[0]+r[1]*a[1],h=Math.sqrt(r[0]*r[0]+r[1]*r[1]),l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return Math.acos(o/(h*l))<n}return 0===s(t,e,i)}function _(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function f(t,e){var i=t.length;return t[e<0?e%i+i:e%i]}function p(t,e,i,n){for(var r=i;r<n;r++)t.push(e[r])}function m(t,e){return h(f(t,e-1),f(t,e),f(t,e+1))}var g=[],v=[];function y(t,e,i){var r,s,a=g,h=v;if(o(f(t,e+1),f(t,e),f(t,i))&&l(f(t,e-1),f(t,e),f(t,i)))return!1;s=_(f(t,e),f(t,i));for(var c=0;c!==t.length;++c)if((c+1)%t.length!==e&&c!==e&&o(f(t,e),f(t,i),f(t,c+1))&&l(f(t,e),f(t,i),f(t,c))&&(a[0]=f(t,e),a[1]=f(t,i),h[0]=f(t,c),h[1]=f(t,c+1),r=n(a,h),_(f(t,e),r)<s))return!1;return!0}function x(t,e,i){for(var n=0;n!==t.length;++n)if(n!==e&&n!==i&&(n+1)%t.length!==e&&(n+1)%t.length!==i&&r(f(t,e),f(t,i),f(t,n),f(t,n+1)))return!1;return!0}function w(t,e,i,n){var r=n||[];if(function(t){t.length=0}(r),e<i)for(var s=e;s<=i;s++)r.push(t[s]);else{for(s=0;s<=i;s++)r.push(t[s]);for(s=e;s<t.length;s++)r.push(t[s])}return r}function b(t,e,i,n,r){r=r||0;var s=e[1]-t[1],a=t[0]-e[0],o=s*t[0]+a*t[1],h=n[1]-i[1],l=i[0]-n[0],c=h*i[0]+l*i[1],u=s*l-h*a;return S(u,0,r)?[0,0]:[(l*o-a*c)/u,(s*c-h*o)/u]}function S(t,e,i){return i=i||0,Math.abs(t-e)<=i}},{}]},{},[1])(1)},window?window.decomp=o():t.exports=o(),function(){var t={},e=Matter.Common,i=Matter.Composite,n=Matter.Bounds,r=Matter.Events,s=(Matter.Grid,Matter.Vector);t.create=function(i){var n={controller:t,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222222",hasBounds:!!i.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},r=e.extend(n,i);return r.mouse=i.mouse,r.engine=i.engine,r.container=r.container||c.stage,r.bounds=r.bounds||{min:{x:0,y:0},max:{x:r.width,y:r.height}},r},t.run=function(e){c.timer.frameLoop(1,this,t.world,[e]),r.on(e.engine.world,"afterRemove",t.onRemoveSprite)},t.stop=function(e){c.timer.clear(this,t.world),r.off(e.engine.world,"afterRemove",t.onRemoveSprite)},t.onRemoveSprite=function(t){var e=t.object.layaSprite;e&&e.parent&&e.parent.removeChild(e)},t.world=function(e){var r,a=e.engine.world,o=(e.renderer,e.container),h=e.options,l=i.allBodies(a),c=i.allConstraints(a),u=[];h.wireframes?t.setBackground(e,h.wireframeBackground):t.setBackground(e,h.background);var d=e.bounds.max.x-e.bounds.min.x,_=e.bounds.max.y-e.bounds.min.y,f=d/e.options.width,p=_/e.options.height;if(h.hasBounds){for(r=0;r<l.length;r++){var m=l[r];m.render.sprite.visible=n.overlaps(m.bounds,e.bounds)}for(r=0;r<c.length;r++){var g=c[r],v=g.bodyA,y=g.bodyB,x=g.pointA,w=g.pointB;v&&(x=s.add(v.position,g.pointA)),y&&(w=s.add(y.position,g.pointB)),x&&w&&(n.contains(e.bounds,x)||n.contains(e.bounds,w))&&u.push(g)}o.scale(1/f,1/p),o.pos(-e.bounds.min.x*(1/f),-e.bounds.min.y*(1/p))}else u=c;for(r=0;r<l.length;r++)t.body(e,l[r]);for(r=0;r<u.length;r++)t.constraint(e,u[r])},t.setBackground=function(t,e){if(t.currentBackground!==e){var i=e.indexOf&&-1!==e.indexOf("#");t.container.graphics.clear(),i?t.container.bgColor=e:(t.container.loadImage(e),t.container.bgColor="#FFFFFF"),t.currentBackground=e}},t.body=function(t,e){t.engine;var i=e.render;if(i.visible){if(i.sprite&&i.sprite.texture){e.id;var n=e.layaSprite,r=t.container;n||(n=e.layaSprite=a(t,e),e.effPendant&&!e.effPendant.parent&&n.addChild(e.effPendant)),r.contains(n)||r.addChild(n),n.x=e.position.x,n.y=e.position.y,n.rotation=180*e.angle/Math.PI,n.scaleX=i.sprite.xScale||1,n.scaleY=i.sprite.yScale||1,n.width=i.sprite.width,n.height=i.sprite.height,i.sprite.sizeGrid&&(n.sizeGrid=i.sprite.sizeGrid)}else e.id,n=e.layaSprite,r=t.container,n||((n=e.layaSprite=o(t,e)).initialAngle=e.angle,e.effPendant&&!e.effPendant.parent&&n.addChild(e.effPendant)),r.contains(n)||r.addChild(n),n.x=e.position.x,n.y=e.position.y,n.rotation=180*(e.angle-n.initialAngle)/Math.PI;var s=e.text;if(s){var h=n.lbl;h||((h=n.lbl=new c.Label).fontSize=30,h.anchorX=.5,h.anchorY=.5,h.color=e.textClr?e.textClr:"#ffffff",h.strokeColor="#000000",h.stroke=2,h.centerX=0,h.centerY=0,n.addChild(h),void 0!==e.shapeType&&(0===e.shapeType&&(h.centerX=-10),2===e.shapeType&&(h.rotation=-n.rotation)),h.text=s+"",e.lbl=h)}if(e.pendant&&!n.pendantSpr){var l=new c.Image;l.skin=e.pendant,n.addChild(l),n.pendantSpr=l}}};var a=function(t,e){var i=e.render.sprite.texture,n=new c.Image;return n.skin=i,n.pivotX=e.render.sprite.xOffset,n.pivotY=e.render.sprite.yOffset,n},o=function(t,e){var i,n,r,s,a=e.render,o=t.options,h=new c.Sprite,l=h.graphics;l.clear();for(var u=1<e.parts.length?1:0;u<e.parts.length;u++){s=e.parts[u];var d=[];r=o.wireframes?(i=null,n="#bbbbbb",1):(i=a.fillStyle,n=a.strokeStyle,a.lineWidth),d.push(s.vertices[0].x-e.position.x,s.vertices[0].y-e.position.y);for(var _=1;_<s.vertices.length;_++)d.push(s.vertices[_].x-e.position.x,s.vertices[_].y-e.position.y);d.push(s.vertices[0].x-e.position.x,s.vertices[0].y-e.position.y),l.drawPoly(0,0,d,i,n,r),(o.showAngleIndicator||o.showAxes)&&(r=1,n=o.wireframes?"#CD5C5C":a.strokeStyle,l.drawLine(s.position.x-e.position.x,s.position.y-e.position.y,(s.vertices[0].x+s.vertices[s.vertices.length-1].x)/2-e.position.x,(s.vertices[0].y+s.vertices[s.vertices.length-1].y)/2-e.position.y))}return h};t.constraint=function(t,e){t.engine;var i=e.bodyA,n=e.bodyB,r=e.pointA,s=e.pointB,a=t.container,o=e.render,h=(e.id,e.layaSprite);h||(h=e.layaSprite=new c.Sprite);var l,u,d,_,f=h.graphics;o.visible&&e.pointA&&e.pointB?(a.contains(h)||a.addChild(h),f.clear(),u=i?(l=i.position.x+r.x,i.position.y+r.y):(l=r.x,r.y),_=n?(d=n.position.x+s.x,n.position.y+s.y):(d=s.x,s.y),f.drawLine(l,u,d,_,o.strokeStyle,o.lineWidth)):f.clear()},window.LayaRender=t}()}).call(this,i(11))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n;!function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,a=(i.__newvec,laya.utils.Browser),o=i.Config,h=(laya.events.Event,laya.events.EventDispatcher),l=laya.resource.HTMLImage,c=(laya.utils.Handler,laya.display.Input),u=laya.net.Loader,d=laya.maths.Matrix,_=laya.renders.Render,f=laya.utils.RunDriver,p=laya.media.SoundChannel,m=laya.media.SoundManager,g=(laya.display.Stage,laya.net.URL),v=laya.utils.Utils,y=function(){function s(){}return r(s,"laya.vv.mini.MiniAdpter"),s.getJson=function(t){return JSON.parse(t)},s.enable=function(){s.init(i.isWXPosMsg,i.isWXOpenDataContext)},s.init=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),s._inited||(s._inited=!0,s.window=t,s.window.hasOwnProperty("qg")&&(s.isZiYu=n,s.isPosMsgYu=e,s.EnvConfig={},s.window.qg.env||(s.window.qg.env={},s.window.qg.env.USER_DATA_PATH="internal://files"),s.systemInfo=s.window.qg.getSystemInfoSync(),s.window.focus=function(){},i._getUrlPath=function(){return""},s.window.logtime=function(t){},s.window.alertTimeLog=function(t){},s.window.resetShareInfo=function(){},s.window.CanvasRenderingContext2D=function(){},s.window.CanvasRenderingContext2D.prototype=s.window.qg.createCanvas().getContext("2d").__proto__,s.window.document.body.appendChild=function(){},s.EnvConfig.pixelRatioInt=0,a.pixelRatio=s.pixelRatio(),s._preCreateElement=a.createElement,a.createElement=s.createElement,f.createShaderCondition=s.createShaderCondition,v.parseXMLFromString=s.parseXMLFromString,c._createInputElement=x._createInputElement,s.EnvConfig.load=u.prototype.load,u.prototype.load=w.prototype.load,s.window.qg.onMessage&&s.window.qg.onMessage(s._onMessage),o.useRetinalCanvas=!0))},s._onMessage=function(t){switch(t.type){case"changeMatrix":i.stage.transform.identity(),i.stage._width=t.w,i.stage._height=t.h,i.stage._canvasTransform=new d(t.a,t.b,t.c,t.d,t.tx,t.ty);break;case"display":i.stage.frameRate="fast";break;case"undisplay":i.stage.frameRate="sleep"}"opendatacontext"==t.isLoad||"openJsondatacontext"==t.isLoad?t.url:t.isLoad},s.pixelRatio=function(){if(!s.EnvConfig.pixelRatioInt)try{return s.systemInfo.pixelRatio=s.window.devicePixelRatio,s.EnvConfig.pixelRatioInt=s.systemInfo.pixelRatio,s.systemInfo.pixelRatio}catch(t){}return s.EnvConfig.pixelRatioInt},s.createElement=function(t){var i;if("canvas"==t)return 1==s.idx?s.isZiYu?(i={}).style={}:i=e.getElementById("canvas"):i=s.window.qg.createCanvas(),s.idx++,i;if("textarea"==t||"input"==t)return s.onCreateInput(t);if("div"==t){var n=s._preCreateElement(t);return n.contains=function(t){return null},n.removeChild=function(t){},n}return s._preCreateElement(t)},s.onCreateInput=function(t){var e=s._preCreateElement(t);return e.focus=x.wxinputFocus,e.blur=x.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(t){},e.setType=function(t){},e.setFontFace=function(t){},e.addEventListener=function(t){},e.contains=function(t){return null},e.removeChild=function(t){},e},s.createShaderCondition=function(t){var e=this;return function(){return e[t.replace("this.","")]}},s.EnvConfig=null,s.window=null,s._preCreateElement=null,s._inited=!1,s.systemInfo=null,s.isZiYu=!1,s.isPosMsgYu=!1,s.parseXMLFromString=function(e){var i;e=e.replace(/>\s+</g,"><");try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){throw"需要引入xml解析库文件"}return i},s.idx=1,n(s,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),s}(),x=(function(){function t(){}r(t,"laya.vv.mini.MiniImage",null,"MiniImage"),t.prototype._loadImage=function(e){-1==e.indexOf("layaNativeDir/")&&(!0,e=g.formatURL(e)),t.onCreateImage(e,this,!0)},t.onDownImgCallBack=function(e,i,n){n?i.onError(null):t.onCreateImage(e,i)},t.onCreateImage=function(t,e,i){var n,r;function s(){r.onload=null,r.onerror=null,delete e.imgCache[t]}void 0===i&&(i=!1),n=t,null==e.imgCache&&(e.imgCache={});var o=function(){s(),e.onLoaded(r)},h=function(){s(),e.event("error","Load image failed")};"nativeimage"==e._type?((r=new a.window.Image).crossOrigin="",r.onload=o,r.onerror=h,r.src=n,e.imgCache[t]=r):new l.create(n,{onload:o,onerror:h,onCreate:function(i){r=i,e.imgCache[t]=i}})}}(),function(){function t(){}return r(t,"laya.vv.mini.MiniInput",null,"MiniInput"),t._createInputElement=function(){console.log("【MiniInput】_createInputElement"),c._initInput(c.area=a.createElement("textarea")),c._initInput(c.input=a.createElement("input")),c.inputContainer=a.createElement("div"),c.inputContainer.style.position="absolute",c.inputContainer.style.zIndex=1e5,a.container.appendChild(c.inputContainer),c.inputContainer.setPos=function(t,e){c.inputContainer.style.left=t+"px",c.inputContainer.style.top=e+"px"},i.stage.on("resize",null,t._onStageResize),y.window.qg.onWindowResize&&y.window.qg.onWindowResize((function(t){y.window.dispatchEvent&&y.window.dispatchEvent("resize")})),m._soundClass=b,m._musicClass=b;var e=y.systemInfo.osType;-1!=e.indexOf("android")?(a.onAndroid=!0,a.onIPhone=!1,a.onIOS=!1,a.onIPad=!1):-1!=e.indexOf("iphone")&&(a.onIPhone=!0,a.onIOS=!0,a.onIPad=!0,a.onAndroid=!1)},t._onStageResize=function(){i.stage._canvasTransform.identity().scale(a.width/_.canvas.width/a.pixelRatio,a.height/_.canvas.height/a.pixelRatio)},t.wxinputFocus=function(t){var e=c.inputElement.target;e&&!e.editable||(y.window.qg.offKeyboardConfirm(),y.window.qg.offKeyboardInput(),y.window.qg.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:e.confirmType||"done",success:function(t){},fail:function(t){}}),y.window.qg.onKeyboardConfirm((function(t){var i=t?t.value:"";e.text=i,e.event("input"),laya.vv.mini.MiniInput.inputEnter(),e.event("confirm")})),y.window.qg.onKeyboardInput((function(t){var i=t?t.value:"";e.multiline||-1==i.indexOf("\n")?(e.text=i,e.event("input")):laya.vv.mini.MiniInput.inputEnter()})))},t.inputEnter=function(){c.inputElement.target.focus=!1},t.wxinputblur=function(){t.hideKeyboard()},t.hideKeyboard=function(){y.window.qg.offKeyboardConfirm(),y.window.qg.offKeyboardInput(),y.window.qg.hideKeyboard()},t}()),w=function(){function t(){}r(t,"laya.vv.mini.MiniLoader",null,"MiniLoader");var e=t.prototype;return e.load=function(e,i,n,r,s){void 0===n&&(n=!0),void 0===s&&(s=!1);this._url=e,0===e.indexOf("data:image")?this._type=i="image":this._type=i||(i=this.getTypeFromUrl(e)),this._cache=n,this._data=null;e.indexOf(".fnt");var a=v.getFileExtension(e);t._fileTypeArr.indexOf(a),y.EnvConfig.load.call(this,e,i,n,r,s)},e.resMgrLoad=function(e,i,n,r,s,a,o){void 0===n&&(n=0),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=0),void 0===o&&(o=3),-1!=e.indexOf("mpack")&&console.log("=============resMgrLoad url:",e),y.EnvConfig.resMgrLoad(e,(e,n,r)=>{t.prototype.resMgrLoadCallBack(e,n,r,i)},n,r,s,a,o)},e.resMgrLoadCallBack=function(t,e,i,n){n(t,e,i)},e.clearRes=function(t,e){void 0===e&&(e=!1);this.clearRes(t,e)},t.onReadNativeCallBack=function(t,e,i,n,r,s,a,o,h){var l;(void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===o&&(o=0),o)?1==o&&y.EnvConfig.load.call(a,e,i,n,r,s):(l="json"==i||"atlas"==i?y.getJson(h.data):"xml"==i?v.parseXMLFromString(h.data):h.data,!y.isZiYu&&y.isPosMsgYu&&"arraybuffer"!=i&&qg.postMessage({url:e,data:l,isLoad:"filedata"}),a.onLoaded(l))},n(t,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),t}(),b=function(t){function e(){this._sound=null,this.url=null,this.loaded=!1,e.__super.call(this)}r(e,"laya.vv.mini.MiniSound",t);var n=e.prototype;return n.load=function(t){t=g.formatURL(t),this.url=t,e._audioCache[this.url]?this.event("complete"):(this.url==m._tMusic?(e._musicAudio||(e._musicAudio=e._createSound()),this._sound=e._musicAudio):this._sound||(e._audioCache[this.url]?this._sound=e._audioCache[this.url]._sound:this._sound=e._createSound()),this._sound.src=this.url,this._sound.onCanplay?(this._sound.onCanplay(e.bindToThis(this.onCanPlay,this)),this._sound.onError(e.bindToThis(this.onError,this))):(i.timer.clear(this,this.onCheckComplete),i.timer.frameLoop(2,this,this.onCheckComplete)))},n.onCheckComplete=function(){this._sound.duration>0&&(i.timer.clear(this,this.onCheckComplete),this.onCanPlay())},n.onError=function(t){this.loaded=!1,delete e._audioCache[this.url],this.event("error"),this._sound&&this._sound.offError&&this._sound.offError(null)},n.onCanPlay=function(){this.loaded=!0,e._audioCache[this.url]=this._miniSound,this.event("complete"),this._sound&&this._sound.offCanplay&&this._sound.offCanplay(null)},n.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),!this._sound)return null;var i=new S(this._sound,this);return i.url=this.url,i.loops=e,i.loop=0===e,i.startTime=t,i.play(),m.addChannel(i),i},n.dispose=function(){var t=e._audioCache[this.url];t&&(t.src="",t._sound&&(t._sound.destroy(),t._sound=null,t=null),delete e._audioCache[this.url])},s(0,n,"duration",(function(){return this._sound.duration})),e._createSound=function(){return e._id++,y.window.qg.createInnerAudioContext()},e.bindToThis=function(t,e){return t.bind(e)},e._musicAudio=null,e._id=0,e._audioCache={},e}(h),S=function(t){function e(t,i){this._audio=null,this._onEnd=null,this._miniSound=null,e.__super.call(this),this._audio=t,this._miniSound=i,this._onEnd=e.bindToThis(this.__onEnd,this)}r(e,"laya.vv.mini.MiniSoundChannel",t);var n=e.prototype;return n.__onEnd=function(){if(this._audio&&this._audio.offEnded(this._onEnd),1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},n.play=function(){this.isStopped=!1,m.addChannel(this),this._audio&&(this._audio.play(),this._audio.onEnded(this._onEnd))},n.stop=function(){this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this._audio.offEnded(null),this._miniSound.dispose(),this._miniSound=null,this._audio=null,this._onEnd=null)},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},s(0,n,"startTime",null,(function(t){this._audio})),s(0,n,"autoplay",(function(){return!1}),(function(t){})),s(0,n,"position",(function(){return this._audio?this._audio.currentTime:0})),s(0,n,"duration",(function(){return this._audio?this._audio.duration:0})),s(0,n,"loop",(function(){return this._audio.loop}),(function(t){this._audio.loop=t})),s(0,n,"volume",(function(){return this._audio?this._audio.volume:1}),(function(t){this._audio&&(this._audio.volume=t)})),e.bindToThis=function(t,e){return t.bind(e)},e}(p)}(window,document,Laya),void 0===(n=function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){"use strict";var n,r,s,a,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=laya.ui.View;laya.ui.Dialog;s=n||(n={}),a=function(t){function e(){return t.call(this)||this}return o(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(s.a.uiView)},e.uiView={type:"View",props:{width:720,name:"P_WXAuthorizationViewUI",height:1280},child:[{type:"Image",props:{width:720,var:"bgImg",skin:"wxlogin_atlas/image_login_loginbg.jpg",name:"bg",height:1280,centerY:0,centerX:0}},{type:"Box",props:{width:720,height:1280,centerY:0,centerX:0},child:[{type:"Image",props:{width:720,var:"topImg",top:-139,skin:"wxlogin_atlas/image_login_loginbg_top.jpg",height:139,centerX:0,anchorY:1}},{type:"Image",props:{width:720,var:"btmImg",top:1280,skin:"wxlogin_atlas/image_login_loginbg_bottom.jpg",height:139,centerX:0}},{type:"Image",props:{x:-220,width:220,var:"leftImg",skin:"wxlogin_atlas/image_login_loginbg_left.jpg",left:-220,height:1280,centerY:0}},{type:"Image",props:{width:220,var:"rightImg",skin:"wxlogin_atlas/image_login_loginbg_right.jpg",left:720,height:1280,centerY:0}}]}]},e}(h),s.a=a,function(t){var e=function(e){function i(){return e.call(this)||this}return o(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.b.uiView)},i.uiView={type:"View",props:{width:720,name:"P_LoadingView",height:1280},child:[{type:"Image",props:{width:720,var:"bgImg",name:"bg",height:1280,centerY:0,centerX:0}},{type:"Box",props:{width:720,height:1280,centerY:0,centerX:0},child:[{type:"Image",props:{var:"topImg",centerX:0,bottom:1280,anchorY:1}},{type:"Image",props:{var:"btmImg",top:1280,centerX:0}},{type:"Image",props:{var:"leftImg",right:720,pivotX:1,centerY:0}},{type:"Image",props:{var:"rightImg",left:720,centerY:0}}]},{type:"Image",props:{var:"copyRightImg",skin:"wxlogin_atlas/image_denglu_txtshenpi.png",centerX:0,bottom:10}},{type:"Box",props:{y:963,x:0,width:720,var:"processBox1",name:"processBox1",height:130},child:[{type:"Image",props:{y:46,x:62,width:596,var:"loadingBarBg",skin:"wxloading_atlas/image_loding_bar0.png",height:27,centerX:0}},{type:"Image",props:{y:49,x:64,width:590,var:"loadingBar",skin:"wxloading_atlas/image_loding_bar1.png",height:21}},{type:"Image",props:{y:55,x:507,width:208,var:"loadingImg1",skin:"wxloading_atlas/image_loding_bar2.png",height:11}},{type:"Image",props:{y:6,x:628,width:39,var:"loadingImg2",skin:"wxloading_atlas/image_loding_bar3.png",height:116}},{type:"Label",props:{y:48,x:293,width:134,var:"percentageTips",valign:"middle",text:"88%",strokeColor:"#565353",stroke:3,height:24,fontSize:24,color:"#fbfbf9",centerX:0,bold:!1,align:"center"}}]},{type:"Box",props:{y:1065,x:0,width:720,var:"processBox2",name:"processBox2",height:17},child:[{type:"Image",props:{y:0,x:307,var:"point1",skin:"wxloading_atlas/image_login_point3.png",centerX:-45}},{type:"Image",props:{y:0,x:337,var:"point2",skin:"wxloading_atlas/image_login_point2.png",centerX:-15}},{type:"Image",props:{y:0,x:367,var:"point3",skin:"wxloading_atlas/image_login_point1.png",centerX:15}},{type:"Image",props:{y:0,x:397,var:"point4",skin:"wxloading_atlas/image_login_point1.png",centerX:45}}]},{type:"Button",props:{y:790,x:55,visible:!1,var:"getTipsBtn",stateNum:1,skin:"wxloading_atlas/btn_loding_abcelq0.png",name:"getTipsBtn",labelSize:30,labelFont:"SimHei",labelColors:"#af4158"},child:[{type:"Label",props:{y:155,x:146,width:323,var:"txtGetTm",text:"立即领取(5s)",name:"txtGetTm",height:30,fontSize:30,color:"#bd4f1e",align:"center"}}]},{type:"Label",props:{y:1107,width:500,var:"loadingTips",valign:"middle",text:"加载描述",height:26,fontSize:26,color:"#f2ffb5",centerX:0,bold:!1,align:"center"}},{type:"Label",props:{y:10,x:10,width:342,var:"versionTxt",valign:"middle",top:20,text:"版本：100",strokeColor:"#20385f",stroke:2,right:20,height:32,fontSize:24,color:"#dfebff",bold:!1,align:"right"}}]},i}(h);t.b=e}(n||(n={})),function(t){var e=function(e){function i(){return e.call(this)||this}return o(i,e),i.prototype.createChildren=function(){h.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),h.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.c.uiView)},i.uiView={type:"View",props:{width:720,name:"P_SelectServerViewUI",height:1280},child:[{type:"Image",props:{width:720,var:"bgImg",skin:"wxlogin_atlas/image_login_loginbg.jpg",name:"bg",height:1280,centerY:0,centerX:0}},{type:"Box",props:{width:720,height:1280,centerY:0,centerX:0},child:[{type:"Image",props:{width:720,var:"topImg",skin:"wxlogin_atlas/image_login_loginbg_top.jpg",bottom:1279}},{type:"Image",props:{width:720,var:"btmImg",top:1279,skin:"wxlogin_atlas/image_login_loginbg_bottom.jpg"}},{type:"Image",props:{var:"leftImg",skin:"wxlogin_atlas/image_login_loginbg_left.jpg",right:719,height:1280}},{type:"Image",props:{var:"rightImg",skin:"wxlogin_atlas/image_login_loginbg_right.jpg",left:719,height:1280}}]},{type:"Image",props:{y:845,var:"selectServer",skin:"wxlogin_atlas/image_login_xuanqubg.png",centerX:0}},{type:"Image",props:{y:1102,var:"imgCheatTip",skin:"wxlogin_atlas/image_loding_txtbhcc.png",name:"imgCheatTip",centerX:0}},{type:"Image",props:{y:927,x:159,var:"hotImage",skin:"wxlogin_atlas/image_login_changtong.png"}},{type:"Image",props:{var:"copyRightImg",skin:"wxlogin_atlas/image_denglu_txtshenpi.png",centerX:0,bottom:30}},{type:"Image",props:{y:1015,var:"enterBtn",stateNum:1,skin:"wxlogin_atlas/btn_login_loginanniu.png",name:"enterBtn",centerX:0}},{type:"Label",props:{y:932,x:521,var:"selServer",valign:"middle",text:"选服>",height:32,fontSize:30,color:"#feffc0",bold:!1,align:"center"}},{type:"Label",props:{y:932,width:342,var:"serverName",valign:"middle",text:"0000000000001服",height:32,fontSize:30,color:"#feffc0",centerX:0,bold:!1,align:"center"}},{type:"Label",props:{width:342,var:"versionTxt",valign:"middle",top:20,text:"版本：100",strokeColor:"#20385f",stroke:2,right:20,height:32,fontSize:24,color:"#dfebff",bold:!1,align:"right"}},{type:"HTMLDivElement",props:{y:1255,x:256,width:80,visible:!1,var:"privacyTip",innerHTML:"隐私协议",height:16}},{type:"Image",props:{y:1249,x:196,visible:!1,var:"privacyToggle",skin:"wxlogin_atlas/image_xuanfu_gx1.png",bottom:4}},{type:"Image",props:{y:55,x:624,var:"noticeBtn",skin:"wxlogin_atlas/btn_login_gonggao.png"}},{type:"Image",props:{visible:!1,var:"ageTipBtn",top:1,scaleY:.5,scaleX:.5,name:"privacyBtn",left:1}},{type:"Image",props:{y:71,x:-2,visible:!1,var:"noticeBg",skin:"wxlogin_atlas/image_login_notice.png",centerY:0,centerX:0},child:[{type:"Image",props:{y:36.5,x:616,var:"noticeClose",skin:"wxlogin_atlas/btn_com_chuangback.png"}},{type:"Label",props:{y:72,x:216,width:234,var:"noticeTitle",valign:"middle",text:"暂无公告",height:35,fontSize:30,color:"#ffffff",bold:!1,align:"center"}},{type:"Text",props:{y:142,x:61,wordWrap:!0,width:545,var:"noticeContent",valign:"top",overflow:"scroll",mouseEnabled:!0,leading:4,height:870,fontSize:26,color:"#212942"}}]},{type:"Image",props:{visible:!1,var:"mNoticeBg",skin:"wxlogin_atlas/image_login_notice.png",centerY:0,centerX:0},child:[{type:"Image",props:{y:36.5,x:616,var:"mNoticeClose",skin:"wxlogin_atlas/btn_com_chuangback.png"}},{type:"Button",props:{y:904,x:190,var:"mNoticeClose2",stateNum:1,skin:"wxlogin_atlas/btn_com_long1.png",labelSize:30,labelColors:"#263d7d,#263d7d,#263d7d,#263d7d",label:"关闭"}},{type:"Box",props:{y:904,x:34,width:596,var:"boxTab",height:59}},{type:"Label",props:{y:72,x:216,width:234,var:"mNoticeTitle",valign:"middle",text:"暂无公告",height:35,fontSize:30,color:"#ffffff",bold:!1,align:"center"}},{type:"Panel",props:{y:142,x:61,width:545,var:"mNoticePanel",height:733},child:[{type:"HTMLDivElement",props:{y:0,x:0,width:545,var:"mNoticeContent",height:733}}]}]},{type:"Image",props:{visible:!1,var:"privacyBg",skin:"wxlogin_atlas/image_login_notice.png",name:"privacyBg",centerY:0,centerX:0},child:[{type:"Image",props:{y:983,x:186,width:274,skin:"wxlogin_atlas/image_com_hdkuangbg2.png",height:40},child:[{type:"Label",props:{y:16,x:61,width:146,text:"点击空白处退出",strokeColor:"#6766a2",stroke:4,height:22,fontSize:21,color:"#ffffff",bold:!1,align:"center"}}]},{type:"Image",props:{y:36.5,x:616,var:"privacyClose",skin:"wxlogin_atlas/btn_com_chuangback.png"}},{type:"Button",props:{y:904,x:190,var:"privacyClose2",stateNum:1,skin:"wxlogin_atlas/btn_com_long1.png",labelSize:30,labelColors:"#263d7d,#263d7d,#263d7d,#263d7d",label:"关闭"}},{type:"Label",props:{y:72,x:216,width:234,var:"privacyTitle",valign:"middle",text:"暂无公告",height:35,fontSize:30,color:"#ffffff",bold:!1,align:"center"}},{type:"Panel",props:{y:142,x:61,width:545,var:"privacyPanel",height:733},child:[{type:"HTMLDivElement",props:{y:0,x:0,width:545,var:"privacyContent",height:733}}]}]},{type:"Image",props:{visible:!1,var:"listBg",skin:"wxlogin_atlas/image_xuanfu_xfbg.png",centerY:0,centerX:0},child:[{type:"Box",props:{y:117,x:61,width:200,var:"leftListBox",height:905}},{type:"Box",props:{y:117,x:293,width:358,var:"rightListBox",height:905}},{type:"Image",props:{y:13,x:642,var:"closeBg",skin:"wxlogin_atlas/image_com_tuichu.png"}}]},{type:"Box",props:{width:720,visible:!1,var:"jumpBg",height:1130,centerY:0,centerX:0},child:[{type:"Image",props:{x:33,width:655,skin:"wxlogin_atlas/image_login_notice.png",height:994,centerY:0,centerX:0}},{type:"Button",props:{width:274,var:"btnJump",stateNum:1,skin:"wxlogin_atlas/btn_com_long1.png",labelSize:30,labelColors:"#263d7d,#263d7d,#263d7d,#263d7d",label:"跳转",height:59,centerY:436,centerX:0}},{type:"Label",props:{width:234,var:"jumpTitle",valign:"middle",text:"暂无公告",fontSize:30,color:"#ffffff",centerY:-408,centerX:0,bold:!1,align:"center"}},{type:"Panel",props:{x:94,width:545,var:"jumpPanel",height:733,centerY:10},child:[{type:"HTMLDivElement",props:{y:0,x:0,width:545,var:"jumpContent",height:733}}]},{type:"Image",props:{x:596,visible:!1,var:"closeBtn",skin:"wxlogin_atlas/image_com_tuichu.png",name:"closeBtn",centerY:-402}}]},{type:"Label",props:{y:640,x:0,width:720,var:"txtTip",valign:"middle",text:"提示内容(不要移要在最上层)",strokeColor:"#ffffff",stroke:2,height:32,fontSize:32,color:"#ff0000",bold:!1,align:"center"}}]},i}(h);t.c=e}(n||(n={})),function(t){var e,i;e=t.d||(t.d={}),i=function(t){function i(){return t.call(this)||this}return o(i,t),i.prototype.initialize=function(){t.prototype.initialize.call(this),this.centerX=0,this.centerY=0,this.addEvt(),this.onOpened()},i.prototype.addEvt=function(){this.on(Laya.Event.CLICK,this,this.e)},i.prototype.rmEvts=function(){this.off(Laya.Event.CLICK,this,this.e)},i.prototype.onOpened=function(){this.f=Date.now(),g.instance.preloadServer(),g.instance.preloadLoading()},i.prototype.destroy=function(e){void 0===e&&(e=!0),this.rmEvts(),t.prototype.destroy.call(this,e)},i.prototype.e=function(){if(1e4<Date.now()-this.f){this.f-=1e3;var t=c.window.PF_INFO.selectedServer;t.server_id&&e.CommonFunc.checkSer(t)&&(g.instance.enterDefaultServer(),g.instance.sendRecord())}},i}(n.a),e.AuthorizationPanel=i}(l||(l={})),function(t){var e,i,n,r,s,a;e=t.g||(t.g={}),i=Laya.Event,n=Laya.Image,r=Laya.Component,s=Laya.Loader,a=function(t){function e(){var e=t.call(this)||this;return e.h=new n,e.addChild(e.h),e.i=null,e.j=[],e.k=!1,e.l=0,e.m=!0,e.n=6,e.o=!1,e.on(i.DISPLAY,e,e.p),e.on(i.UNDISPLAY,e,e.q),e}return o(e,t),e.create=function(t,i,n,r,s,a,o){void 0===r&&(r=0),void 0===s&&(s=6),void 0===a&&(a=!0),void 0===o&&(o=!1);var h=new e;return h.skin(i,n,r),h.durFrm=s,h.loop=a,h.atHide=o,t&&t.addChild(h),h},e.play=function(t){t&&(t.visible=!0,t.play())},e.stop=function(t){t&&(t.visible=!1,t.stop())},e.prototype.destroy=function(e){Laya.timer.clear(this,this.r),this.off(i.DISPLAY,this,this.p),this.off(i.UNDISPLAY,this,this.q),t.prototype.destroy.call(this,e)},e.prototype.p=function(){},e.prototype.q=function(){},e.prototype.skin=function(t,e,i){if(this.i!=t){this.i=t,this.j=[];for(var n=0,r=i;r<=e;r++)this.j[n++]=t+"/"+r+".png";var a=s.getRes(this.j[0]);a&&(this.width=a.sourceWidth,this.height=a.sourceHeight),this.r()}},Object.defineProperty(e.prototype,"atHide",{get:function(){return this.o},set:function(t){this.o=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durFrm",{set:function(t){this.n!=t&&(this.n=t,this.k&&(Laya.timer.clear(this,this.r),Laya.timer.loop(this.n*(1e3/60),this,this.r)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{set:function(t){this.m=t},enumerable:!0,configurable:!0}),e.prototype.play=function(){this.k&&this.stop(),this.k=!0,this.l=0,Laya.timer.loop(this.n*(1e3/60),this,this.r),this.r()},e.prototype.stop=function(){this.k=!1,this.l=0,this.r(),Laya.timer.clear(this,this.r)},e.prototype.pause=function(){this.k&&(this.k=!1,Laya.timer.clear(this,this.r))},e.prototype.resume=function(){this.k||(this.k=!0,Laya.timer.loop(this.n*(1e3/60),this,this.r),this.r())},Object.defineProperty(e.prototype,"isPlay",{get:function(){return this.k},enumerable:!0,configurable:!0}),e.prototype.r=function(){this.j&&0!=this.j.length&&(this.h.skin=this.j[this.l],this.k&&(this.l++,this.l==this.j.length&&(this.m?this.l=0:(Laya.timer.clear(this,this.r),this.k=!1,this.o&&(this.visible=!1),this.event(i.COMPLETE)))))},e}(r),e.PanelEff=a}(l||(l={})),function(t){var e,i;e=t.d||(t.d={}),i=function(t){function e(e,i){void 0===e&&(e=0);var n=t.call(this)||this;return n.s={bgImgSkin:"wxloading_atlas/image_loading_bg.jpg",topImgSkin:"wxloading_atlas/image_loading_bg_top.jpg",btmImgSkin:"wxloading_atlas/image_loading_bg_bottom.jpg",leftImgSkin:"wxloading_atlas/image_loading_bg_left.jpg",rightImgSkin:"wxloading_atlas/image_loading_bg_right.jpg",loadingBarBgSkin:"wxloading_atlas/image_loding_bar0.png",copyRightImgBottom:10,processBox1Y:963,processBox2Y:1065,loadingTipsSize:26,getTipsBtnVisible:!1},n.t={bgImgSkin:"wxloading_atlas/image_loading_bg2.jpg",topImgSkin:"wxloading_atlas/image_loading_bg_top2.jpg",btmImgSkin:"wxloading_atlas/image_loading_bg_bottom2.jpg",leftImgSkin:"wxloading_atlas/image_loading_bg_left2.jpg",rightImgSkin:"wxloading_atlas/image_loading_bg_right2.jpg",loadingBarBgSkin:"wxloading_atlas/image_loding_bar02.png",copyRightImgBottom:10,processBox1Y:963,processBox2Y:1065,loadingTipsSize:26,getTipsBtnVisible:!1},n.u=0,n.v(1==e?n.t:n.s),n.copyRightImg.skin="",n.copyRightImg.skin=i,n}return o(e,t),e.prototype.initialize=function(){if(t.prototype.initialize.call(this),g.instance.preloadLoading(),this.w=c.window.PF_INFO,this.centerX=0,this.centerY=0,this.w){var e=this.w.loadingType;this.loadingTips.color=1==e?"#f2ffb5":2==e||101==e?"#000000":"#f2ffb5"}this.z=[this.point1,this.point2,this.point3,this.point4],c.window.watPanel=this,wxHideLoading(),g.instance.closeAuthor(),g.instance.closeServer(),this.onOpened()},e.prototype.toAllProgress=function(t){var e=this;if(-1===t)return e.u=0,Laya.timer.clear(this,this.toAllProgress),void Laya.timer.frameLoop(1,this,this.toAllProgress);if(-2!==t){e.u<.9?e.u+=(.15*Math.random()+.01)/(100*Math.random()+50):e.u<1&&(e.u+=1e-4),.9999<e.u&&(e.u=.9999,Laya.timer.clear(this,this.toAllProgress),Laya.timer.once(3e3,this,(function(){.9<e.u&&toAllProgress(-1)})));var i=e.u,n=590*i;e.u=e.u>i?e.u:i,e.loadingBar.width=n;var r=e.loadingBar.x+n;e.loadingImg2.x=r-15,364<=r?(e.loadingImg1.visible=!0,e.loadingImg1.x=r-202):e.loadingImg1.visible=!1,e.percentageTips.text=(100*i>>0)+"%",e.u<.9999&&Laya.timer.frameLoop(1,this,this.toAllProgress)}else Laya.timer.clear(this,this.toAllProgress)},e.prototype.toProgress=function(t,e,i){var n=this;1<t&&(t=1);var r=590*t;n.u=n.u>t?n.u:t,n.loadingBar.width=r;var s=n.loadingBar.x+r;n.loadingImg2.x=s-15,364<=s?(n.loadingImg1.visible=!0,n.loadingImg1.x=s-202):n.loadingImg1.visible=!1,n.percentageTips.text=(100*t>>0)+"%",n.loadingTips.text=e;for(var a=i-1,o=0;o<this.z.length;o++)n.z[o].skin=o<a?"wxloading_atlas/image_login_point3.png":a===o?"wxloading_atlas/image_login_point2.png":"wxloading_atlas/image_login_point1.png"},e.prototype.onOpened=function(){this.toProgress(.1,"正在加载资源...",1),this.toAllProgress(-1),c.window.toAllProgress=this.toAllProgress.bind(this),c.window.toProgress=this.toProgress.bind(this),this.versionTxt.text="资源："+this.w.lastVersion+"      版本："+this.w.wxVersion,this.showGetBtn()},e.prototype.close=function(t){this.resetWinFun(),Laya.timer.clear(this,this.toAllProgress),Laya.timer.clear(this,this.A),g.instance.closeLoading(),this.getTipsBtn.off(Laya.Event.CLICK,this,this.B)},e.prototype.resetWinFun=function(){c.window.toAllProgress=function(){},c.window.toProgress=function(){}},e.prototype.destroy=function(e){void 0===e&&(e=!0),this.resetWinFun(),t.prototype.destroy.call(this,e)},e.prototype.showGetBtn=function(){this.w.showGetBtn&&1==this.w.showGetBtn&&(this.getTipsBtn.visible=!0,this.getTipsBtn.tag=!0,this.getTipsBtn.skin="wxloading_atlas/btn_loding_abcelq0.png",this.getTipsBtn.on(Laya.Event.CLICK,this,this.B),this.C(),this.D(!0))},e.prototype.B=function(){this.getTipsBtn.tag&&(this.getTipsBtn.tag=!1,this.getTipsBtn.skin="wxloading_atlas/btn_loding_abcelq1.png",this.F(),this.D(!1))},e.prototype.v=function(t){this.bgImg.skin=t.bgImgSkin,this.topImg.skin=t.topImgSkin,this.btmImg.skin=t.btmImgSkin,this.leftImg.skin=t.leftImgSkin,this.rightImg.skin=t.rightImgSkin,this.copyRightImg.bottom=t.copyRightImgBottom,this.processBox1.y=t.processBox1Y,this.processBox2.y=t.processBox2Y,this.loadingBarBg.skin=t.loadingBarBgSkin,this.loadingTips.fontSize=t.loadingTipsSize,this.getTipsBtn.visible=this.w.showGetBtn&&1==this.w.showGetBtn,this.getTipsBtn.visible?this.C():this.F(),this.D(this.getTipsBtn.visible)},e.prototype.C=function(){},e.prototype.F=function(){},e.prototype.D=function(t){Laya.timer.clear(this,this.A),t?(this.G=9,this.txtGetTm.visible=!0,this.A(),Laya.timer.loop(1e3,this,this.A)):this.txtGetTm.visible=!1},e.prototype.A=function(){0<this.G?(this.txtGetTm.text="立即领取("+this.G+"s)",this.G--):(this.txtGetTm.text="",Laya.timer.clear(this,this.A),this.B())},e}(n.b),e.LoadingPanel=i}(l||(l={})),function(t){!function(t){var e=function(){function t(){}return t.checkSer=function(e){if(!e)return!1;var i=t.isRecommend(e.is_recommend);if(-1!=e.status)return 0==e.status?(alert("服务器尚未开启，敬请期待"),!1):!(3===e.status&&!i&&(alert("当前区服已爆满，请稍后再试"),1));var n="服务器维护中",r=e.maintain_time;return r&&""!=r&&" "!=r&&(n+="\n(预计时间"+r+")"),alert(n),!1},t.isRecommend=function(t){return 1===t||3===t},t.getStatusSrc=function(e){var i=e.status,n=t.isRecommend(e.is_recommend),r="wxlogin_atlas/image_login_fanmang.png";return 0<i&&n?r="wxlogin_atlas/image_login_changtong.png":0<i&&!n?r="wxlogin_atlas/image_login_fanmang.png":i<=0&&(r="wxlogin_atlas/image_login_weihu.png"),r},t.getStatusAddStr=function(e){var i=e.status,n="";return t.isRecommend(e.is_recommend)?n="(推荐)":-1===i?n="(维护中)":0===i&&(n="(待开服)"),n},t.getStatusAddStr2=function(t){var e=t.status,i="";return-1===e?i="维护中":0===e?i="未开服":0<e&&(i="已开服"),i},t.getPreAddStr=function(){var t=c.window.PF_INFO;return t.ser_name_pkg?t.ser_name_pkg:""},t.getStatusTxtColor=function(t,e){var i=e;return-1===t?i="#d50000":0===t&&(i="#49575a"),i},t}();t.CommonFunc=e;var i=Laya.List,r=Laya.Event,s=function(n){function s(t){void 0===t&&(t="wxlogin_atlas/image_denglu_txtshenpi.png");var e=n.call(this)||this;return e.H=0,e.I="multi_notice_key",e.J=0,e.K=0,e.L="privacy_key",e.M=!0,e.N=0,e.copyRightImg.skin=t,e}return o(s,n),s.prototype.initialize=function(){n.prototype.initialize.call(this),this.centerX=0,this.centerY=0,this.copyRightImg.skin="",g.instance.preloadServer(),this.w=c.window.PF_INFO,this.O=new i,this.O.vScrollBarSkin="",this.O.itemRender=t.SelectLeftListItem,this.O.top=5,this.O.repeatX=1,this.O.spaceY=5,this.O.width=this.leftListBox.width,this.O.height=this.leftListBox.height-8,this.leftListBox.addChild(this.O),this.P=new i,this.P.vScrollBarSkin="",this.P.itemRender=t.SelectRightListItem,this.P.top=5,this.P.repeatX=1,this.P.spaceY=5,this.P.width=this.rightListBox.width,this.P.height=this.rightListBox.height-8,this.rightListBox.addChild(this.P),this.Q=new i,this.Q.hScrollBarSkin="",this.Q.itemRender=t.NoticeItem,this.Q.repeatY=1,this.Q.width=this.boxTab.width,this.Q.height=this.boxTab.height,this.boxTab.addChild(this.Q);var e=this.w.loadingType;this.R=1==e||2==e||3==e||101==e?"#feffc0":"#93353b",this.enterBtn.size(506,88),this.S=[],this.noticeBtn.visible=!1,this.mNoticeContent.color="#212942",this.mNoticeContent.style.fontSize=26,this.mNoticeContent.style.lineHeight=28,this.mNoticeContent.mouseEnabled=!1,this.privacyContent.color="#212942",this.privacyContent.style.fontSize=26,this.privacyContent.style.lineHeight=28,this.privacyContent.mouseEnabled=!1,this.privacyTip.color="#ffffff",this.privacyTip.style.fontSize=18,this.privacyTip.style.lineHeight=18,this.privacyTip.style.stroke=2,this.privacyTip.style.strokeColor="#000000",this.privacyTip.style.wordWrap=!1,this.privacyToggle.hitArea=new Laya.Rectangle(-26+this.privacyToggle.pivotX,-26+this.privacyToggle.pivotY,80,100),this.jumpContent.color="#212942",this.jumpContent.style.fontSize=26,this.jumpContent.style.lineHeight=28,this.jumpContent.mouseEnabled=!1,c.window.initPanel=this,wxHideLoading(),this.addEvt(),this.onOpened()},s.prototype.destroy=function(t){void 0===t&&(t=!0),this.rmEvts(),this.T(),this.U(),this.V(),this.W(),this.ageTipsContent=null,this.O&&(this.O.removeSelf(),this.O.destroy(),this.O=null),this.P&&(this.P.removeSelf(),this.P.destroy(),this.P=null),this.Q&&(this.Q.removeSelf(),this.Q.destroy(),this.Q=null),this.X&&this.X.graphics.clear(),this.X&&this.X.removeSelf(),Laya.timer.clear(this,this.Y),n.prototype.destroy.call(this,t)},s.prototype.addEvt=function(){this.bgImg.on(Laya.Event.CLICK,this,this.Z),this.enterBtn.on(Laya.Event.CLICK,this,this.$),this.selectServer.on(Laya.Event.CLICK,this,this._),this.selectServer.on(Laya.Event.CLICK,this,this._),this.closeBg.on(Laya.Event.CLICK,this,this.aa),this.closeBtn.on(Laya.Event.CLICK,this,this.ba),this.noticeBtn.on(Laya.Event.CLICK,this,this.ca),this.noticeClose.on(Laya.Event.CLICK,this,this.da),this.noticeContent.on(Laya.Event.MOUSE_DOWN,this,this.ea),this.mNoticeClose.on(Laya.Event.CLICK,this,this.fa),this.mNoticeClose2.on(Laya.Event.CLICK,this,this.fa),this.mNoticePanel.on(Laya.Event.MOUSE_DOWN,this,this.ga),this.ageTipBtn.on(Laya.Event.CLICK,this,this.ha),this.privacyClose.on(Laya.Event.CLICK,this,this.ia),this.privacyClose2.on(Laya.Event.CLICK,this,this.ia),this.privacyPanel.on(Laya.Event.MOUSE_DOWN,this,this.ja),this.privacyToggle.on(Laya.Event.CLICK,this,this.ka),this.privacyTip.on(Laya.Event.LINK,this,this.la),this.btnJump.on(Laya.Event.CLICK,this,this.ma),this.jumpPanel.on(Laya.Event.MOUSE_DOWN,this,this.na),this.Q.selectEnable=!0,this.Q.selectHandler=Laya.Handler.create(this,this.oa,null,!1)},s.prototype.rmEvts=function(){this.bgImg.off(Laya.Event.CLICK,this,this.Z),this.enterBtn.off(Laya.Event.CLICK,this,this.$),this.selectServer.off(Laya.Event.CLICK,this,this._),this.selectServer.off(Laya.Event.CLICK,this,this._),this.closeBg.off(Laya.Event.CLICK,this,this.aa),this.noticeBtn.off(Laya.Event.CLICK,this,this.ca),this.closeBtn.off(Laya.Event.CLICK,this,this.ba),this.noticeClose.off(Laya.Event.CLICK,this,this.da),this.noticeContent.off(Laya.Event.MOUSE_DOWN,this,this.ea),this.mNoticeClose.off(Laya.Event.CLICK,this,this.fa),this.mNoticeClose2.off(Laya.Event.CLICK,this,this.fa),this.mNoticePanel.off(Laya.Event.MOUSE_DOWN,this,this.ga),this.ageTipBtn.off(Laya.Event.CLICK,this,this.ha),this.privacyClose.off(Laya.Event.CLICK,this,this.ia),this.privacyClose2.off(Laya.Event.CLICK,this,this.ia),this.privacyPanel.off(Laya.Event.MOUSE_DOWN,this,this.ja),this.privacyToggle.off(Laya.Event.CLICK,this,this.ka),this.privacyTip.off(Laya.Event.LINK,this,this.la),this.btnJump.off(Laya.Event.CLICK,this,this.ma),this.jumpPanel.off(Laya.Event.MOUSE_DOWN,this,this.na),this.Q.selectEnable=!1,this.Q.selectHandler=null},s.prototype.onOpened=function(){this.f=Date.now(),this.M=!0,this.pa=this.w.selectedServer.server_id,this.qa(this.w.selectedServer),this.O.dataSource=this.w.groupList,this._(),req_multi_server_notice(4,this.w.pkgName,this.w.selectedServer.server_id,this.ra.bind(this)),this.sa=this.w.privacy_data&&this.w.privacy_data.list?this.w.privacy_data.list:[],this.ta=null!=this.w.privacy_wx_login_pkg?this.w.privacy_wx_login_pkg:0;var t=null==PF_INFO.ad_flag?0:PF_INFO.ad_flag;this.ua=1==this.ta&&1==t||2==this.ta&&1!=t||3==this.ta,this.va=1==t,this.wa(),this.versionTxt.text="资源："+this.w.lastVersion+"      版本："+this.w.wxVersion,this.versionTxt.visible=!this.w.wxShield,this.serverName.color=this.selServer.color=this.R,this.imgCheatTip.visible=1==this.w.anti_cheat_pkg,this.txtTip.visible=!1,console.log(this.versionTxt.text)},s.prototype.preload=function(){},s.prototype.Z=function(){this.listBg.visible?this.aa():this.privacyBg.visible?this.ia():this.mNoticeBg.visible?this.fa():this.noticeBg.visible?this.da():!this.privacyToggle.visible||this.va?1e4<Date.now()-this.f&&e.checkSer(this.w.selectedServer)&&(this.f-=2e3,g.instance.enterDefaultServer()):this.xa("您必须同意用户协议才可进入游戏")},s.prototype.$=function(){!this.privacyToggle.visible||this.va?e.checkSer(this.w.selectedServer)&&(c.window.PF_INFO.selectedServer=this.w.selectedServer,req_server_check_ban(0,this.w.selectedServer.server_id)):this.xa("您必须同意用户协议才可进入游戏")},s.prototype._=function(){this.w.hasGroupReq?this.listBg.visible=!0:(this.w.hasGroupReq=!0,req_server_group(0))},s.prototype.aa=function(){this.listBg.visible=!1},s.prototype.ba=function(){this.jumpBg.visible=!1},s.prototype.ca=function(){this.ya()},s.prototype.fa=function(){this.mNoticeBg.visible=!1},s.prototype.da=function(){this.noticeBg.visible=!1},s.prototype.ia=function(){this.privacyBg.visible=!1},s.prototype.ka=function(){this.va=!this.va,this.va&&localStorage.setItem(this.L,"1"),this.privacyToggle.skin="wxlogin_atlas/"+(this.va?"image_xuanfu_gx1.png":"image_xuanfu_gx0.png")},s.prototype.la=function(t){this.za(Number(t))},s.prototype.ma=function(){c.window.forceJumpMiniGame?c.window.forceJumpMiniGame():this.ba()},s.prototype.ea=function(){this.H=this.noticeContent.mouseY,Laya.stage.on(r.MOUSE_MOVE,this,this.Aa),Laya.stage.on(r.MOUSE_UP,this,this.T),Laya.stage.on(r.MOUSE_OUT,this,this.T)},s.prototype.Aa=function(){if(this.noticeContent){var t=this.H-this.noticeContent.mouseY;this.noticeContent.scrollY+=t,this.H=this.noticeContent.mouseY}},s.prototype.T=function(){Laya.stage.off(r.MOUSE_MOVE,this,this.Aa),Laya.stage.off(r.MOUSE_UP,this,this.T),Laya.stage.off(r.MOUSE_OUT,this,this.T)},s.prototype.ga=function(){this.J=this.mNoticePanel.mouseY,Laya.stage.on(r.MOUSE_MOVE,this,this.Ba),Laya.stage.on(r.MOUSE_UP,this,this.U),Laya.stage.on(r.MOUSE_OUT,this,this.U)},s.prototype.Ba=function(){if(this.mNoticeContent){var t=this.J-this.mNoticePanel.mouseY;this.mNoticeContent.y-=t,this.mNoticePanel.height<this.mNoticeContent.contextHeight?this.mNoticeContent.y<this.mNoticePanel.height-this.mNoticeContent.contextHeight?this.mNoticeContent.y=this.mNoticePanel.height-this.mNoticeContent.contextHeight:0<this.mNoticeContent.y&&(this.mNoticeContent.y=0):this.mNoticeContent.y=0,this.J=this.mNoticePanel.mouseY}},s.prototype.U=function(){Laya.stage.off(r.MOUSE_MOVE,this,this.Ba),Laya.stage.off(r.MOUSE_UP,this,this.U),Laya.stage.off(r.MOUSE_OUT,this,this.U)},s.prototype.ja=function(){this.K=this.privacyPanel.mouseY,Laya.stage.on(r.MOUSE_MOVE,this,this.Ca),Laya.stage.on(r.MOUSE_UP,this,this.V),Laya.stage.on(r.MOUSE_OUT,this,this.V)},s.prototype.Ca=function(){if(this.privacyContent){var t=this.K-this.privacyPanel.mouseY;this.privacyContent.y-=t,this.privacyPanel.height<this.privacyContent.contextHeight?this.privacyContent.y<this.privacyPanel.height-this.privacyContent.contextHeight?this.privacyContent.y=this.privacyPanel.height-this.privacyContent.contextHeight:0<this.privacyContent.y&&(this.privacyContent.y=0):this.privacyContent.y=0,this.K=this.privacyPanel.mouseY}},s.prototype.V=function(){Laya.stage.off(r.MOUSE_MOVE,this,this.Ca),Laya.stage.off(r.MOUSE_UP,this,this.V),Laya.stage.off(r.MOUSE_OUT,this,this.V)},s.prototype.na=function(){this.N=this.jumpPanel.mouseY,Laya.stage.on(r.MOUSE_MOVE,this,this.Da),Laya.stage.on(r.MOUSE_UP,this,this.W),Laya.stage.on(r.MOUSE_OUT,this,this.W)},s.prototype.Da=function(){if(this.jumpContent){var t=this.N-this.jumpPanel.mouseY;this.jumpContent.y-=t,this.jumpPanel.height<this.jumpContent.contextHeight?this.jumpContent.y<this.jumpPanel.height-this.jumpContent.contextHeight?this.jumpContent.y=this.jumpPanel.height-this.jumpContent.contextHeight:0<this.jumpContent.y&&(this.jumpContent.y=0):this.jumpContent.y=0,this.N=this.jumpPanel.mouseY}},s.prototype.W=function(){Laya.stage.off(r.MOUSE_MOVE,this,this.Da),Laya.stage.off(r.MOUSE_UP,this,this.W),Laya.stage.off(r.MOUSE_OUT,this,this.W)},s.prototype.oa=function(){if(this.Q.dataSource){for(var t,e=0;e<this.Q.dataSource.length;e++){var i=this.Q.dataSource[e];i[1]=e==this.Q.selectedIndex,e==this.Q.selectedIndex&&(t=i[0])}this.mNoticeTitle.text=t&&t.title?t.title:"",this.mNoticeContent.innerHTML=t&&t.content?t.content:"",this.mNoticeContent.y=0}},s.prototype.Ea=function(t){var e=this.sa[t];e&&e.content&&(e.content=e.content.replace(/(<)(?!(br)).[a-zA-Z]{0,10}(>)/g,"")),this.privacyTitle.text=e&&e.title?e.title:"标题",this.privacyContent.innerHTML=e&&e.content?e.content:"加载中...",this.privacyContent.y=0},s.prototype.qa=function(t){var i=t.server_name;this.serverName.text=e.getPreAddStr()+i+e.getStatusAddStr(t),this.serverName.color=e.getStatusTxtColor(t.status,this.R),this.hotImage.skin=e.getStatusSrc(t),this.w.cdn=t.cdn||"",this.w.selectedServer=t,this.noticeBtn.visible=!this.w.wxShield},s.prototype.Fa=function(t){this.showGroupList(t)},s.prototype.Ga=function(t){this.qa(t),this.listBg.visible=!1},s.prototype.showGroupList=function(t){if(void 0===t&&(t=0),this.parent){var e=this.w.groupList;if(e&&0!==e.length){for(var i=e.length,n=0;n<i;n++)e[n].callBack=this.Fa.bind(this),e[n].select=n==t,e[n].index=n;var r=(this.O.array=e)[t].id;this.w.serverList[r]?this.showServerList(r):this.w.hasServerReq||(this.w.hasServerReq=!0,-1==r?req_server_owner(0):-2==r?req_recommend_server_list(0):req_server_list(0,r))}}},s.prototype.showServerList=function(t){if(this.parent&&this.w.serverList[t]){for(var e=this.w.serverList[t],i=e.length,n=0;n<i;n++)e[n].callBack=this.Ga.bind(this);this.P.array=e}},s.prototype.ra=function(t){console.log("onMultiNoticeCallback, param = ",t);var e=Date.now()/1e3,i=localStorage.getItem(this.I),n=!(this.S=[]);if("success"==t.state)for(var r in t.data){var s=t.data[r];if(s){var a=e<s.end_time,o=1==s.pop_type,h=2==s.pop_type&&s.key+""!=i;!n&&a&&(o||h)&&(n=!0),a&&this.S.push(s),h&&localStorage.setItem(this.I,s.key+"")}}this.S.sort((function(t,e){return t.login_id-e.login_id})),console.log("onMultiNoticeCallback, datas = ",this.S),n&&this.ya()},s.prototype.ya=function(){if(this.Q){if(this.S){this.Q.x=2<this.S.length?0:(this.boxTab.width-274*this.S.length)/2;for(var t=[],e=0;e<this.S.length;e++){var i=this.S[e];t.push([i,e==this.Q.selectedIndex])}0<(this.Q.dataSource=t).length?(this.Q.selectedIndex=0,this.Q.scrollTo(0)):(this.mNoticeTitle.text="暂无公告",this.mNoticeContent.text=""),this.mNoticeClose2.visible=this.S.length<=1,this.boxTab.visible=1<this.S.length}this.mNoticeBg.visible=!0}},s.prototype.Ha=function(t){if(!this.destroyed){if(console.log("p_onPrivacyCallback, param = ",t),"success"==t.state)for(var e in t.data){var i=Number(e),n=t.data[i];this.sa&&this.sa[i]&&(this.sa[i].content=n.content)}this.Ea(0)}},s.prototype.wa=function(){for(var t="",e=0;e<this.sa.length;e++)t+='<a href="'+e+'" style="color:#ffff00;text-decoration:none"> '+this.sa[e].title+" </a>",e<this.sa.length-1&&(t+="、");this.privacyTip.innerHTML="我已经详细阅读并同意 "+t,this.privacyToggle.skin="wxlogin_atlas/"+(this.va?"image_xuanfu_gx1.png":"image_xuanfu_gx0.png"),this.privacyTip.x=(720-this.privacyTip.width)/2,this.privacyToggle.x=this.privacyTip.x-30,this.privacyToggle.visible=this.privacyTip.visible=this.ua},s.prototype.za=function(t){void 0===t&&(t=0),this.sa&&(0<this.sa.length?(t<0&&(t=0),t>this.sa.length-1&&(t=0),this.Ea(t)):(this.privacyTitle.text="空",this.privacyContent.text=""),this.privacyClose2.visible=!0),this.M&&(this.M=!1,req_privacy(this.w.pkgName,this.Ha.bind(this))),this.privacyBg.visible=!0},s.prototype.showAgeTipsBtn=function(t,e,i,n,r){(this.ageTipBtn.visible=t)&&(this.ageTipBtn.skin=e||"wxlogin_atlas/btn_login_gonggao.png"),this.ageTipsContent=i,this.ageTipBtn.left=n||0,this.ageTipBtn.top=r||0},s.prototype.ha=function(){this.jumpTitle.text="适龄公告",this.jumpContent.innerHTML=this.ageTipsContent?this.ageTipsContent:"",this.btnJump.label="确认",this.jumpContent.y=0,this.jumpBg.visible=!0,this.closeBtn.visible=!0},s.prototype.xa=function(t){this.txtTip.text=t,this.txtTip.y=640,this.txtTip.visible=!0,this.Ia=1,Laya.timer.clear(this,this.Y),this.Y(),Laya.timer.frameLoop(1,this,this.Y)},s.prototype.Y=function(){this.txtTip.y-=this.Ia,this.Ia*=1.1,this.txtTip.y<=590&&(this.txtTip.visible=!1,Laya.timer.clear(this,this.Y))},s}(n.c);t.SelectServerPanel=s}(t.d||(t.d={}))}(l||(l={}));var l,c=Laya.Browser,u=(Laya.Font,Laya.Input),d=Laya.Render,_=Laya.Handler,f=l.d.AuthorizationPanel,p=l.d.LoadingPanel,m=l.d.SelectServerPanel,g=function(){function t(e){this.m_loadingRes=["wxloading_atlas/image_loding_bar0.png","wxloading_atlas/image_loding_bar02.png","wxloading_atlas/image_loding_bar1.png","wxloading_atlas/image_loding_bar2.png","wxloading_atlas/image_loding_bar3.png","wxloading_atlas/image_login_point1.png","wxloading_atlas/image_login_point2.png","wxloading_atlas/image_login_point3.png","wxeff_btn_atlas/0.png","wxeff_btn_atlas/1.png","wxeff_btn_atlas/2.png","wxeff_btn_atlas/3.png","wxeff_btn_atlas/4.png","wxloading_atlas/image_loading_bg.jpg","wxloading_atlas/image_loading_bg2.jpg","wxloading_atlas/btn_loding_abcelq0.png","wxloading_atlas/btn_loding_abcelq1.png","wxloading_atlas/image_loading_bg_bottom.jpg","wxloading_atlas/image_loading_bg_left.jpg","wxloading_atlas/image_loading_bg_right.jpg","wxloading_atlas/image_loading_bg_top.jpg","wxloading_atlas/image_loading_bg_bottom2.jpg","wxloading_atlas/image_loading_bg_left2.jpg","wxloading_atlas/image_loading_bg_right2.jpg","wxloading_atlas/image_loading_bg_top2.jpg"],this.m_serverRes=["wxlogin_atlas/btn_com_chuangback.png","wxlogin_atlas/btn_login_gonggao.png","wxlogin_atlas/btn_login_loginanniu.png","wxlogin_atlas/btn_login_yingsi.png","wxlogin_atlas/btn_xuanqu_anniuhuang.png","wxlogin_atlas/btn_xuanqu_anniulan.png","wxlogin_atlas/btn_xuanqu_quanniu.png","wxlogin_atlas/image_com_tuichu.png","wxlogin_atlas/image_login_changtong.png","wxlogin_atlas/image_login_fanmang.png","wxlogin_atlas/image_login_weihu.png","wxlogin_atlas/image_login_xuanqubg.png","wxlogin_atlas/image_login_loginbg.jpg","wxlogin_atlas/image_login_loginbg_bottom.jpg","wxlogin_atlas/image_login_loginbg_left.jpg","wxlogin_atlas/image_login_loginbg_right.jpg","wxlogin_atlas/image_login_loginbg_top.jpg","wxlogin_atlas/image_denglu_txtshenpi.png","wxlogin_atlas/image_login_notice.png","wxlogin_atlas/image_xuanfu_xfbg.png","wxlogin_atlas/btn_com_long0.png","wxlogin_atlas/btn_com_long1.png","wxlogin_atlas/image_loding_txtbhcc.png","wxlogin_atlas/image_xuanfu_gx1.png","wxlogin_atlas/image_xuanfu_gx0.png","wxlogin_atlas/shenhezizi.png","wxlogin_atlas/image_xuanqu_ztjb0.png"],this.copyRightUrl="wxlogin_atlas/image_denglu_txtshenpi.png",this.Ja=!1,this.m_isPrelodServer=!1,this.m_isPrelodLoading=!1,this.Ka=!1,this.La="",t.instance=this,Laya.MiniAdpter.init(),Laya3D.init(0,0,!1,!1,!1),DecodeTools.init(),Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH,Laya.stage.screenMode=Laya.Stage.SCREEN_NONE,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,Laya.stage.frameRate=Laya.Stage.FRAME_SLOW;var i=Laya.AtlasResourceManager;i.maxTextureCount=6,i.atlasTextureWidth=i.atlasTextureHeight=1024,i._enable(),Laya.URL.rootPath=Laya.URL.basePath="",Laya.Browser.window.addEventListener(Laya.Event.RESIZE,this.Ma.bind(this)),this.Na="https://cdn-tjqy.shzbkj.com/wxLoading",this.Oa(),c.window.resMgrLoad=t.instance.requestWeb,c.window.imgMgrLoad=t.instance.requestWeb,this.m_layer=new Laya.Component,this.m_layer.name="_wxLoadingLayer",Laya.stage.addChild(this.m_layer),this.Pa=new Laya.Component,this.Pa.name="_noiseLy",Laya.stage.addChild(this.Pa),this.Pa.mouseEnabled=this.Pa.mouseThrough=!0,this.Ma(),l.Ra.Qa.init(),Laya.timer.loop(500,this,this.Sa)}return t.prototype.Oa=function(){var t=(window.config||{}).game_pkg;this.Ta=Math.floor(9999999*Math.random()),t||console.error("未读取到：game_pkg:",t)},t.prototype.getURL=function(t){var e=(window.config||{}).game_pkg;return e?(this.Ua||this.Na)+"/"+e+"/"+t+"?v="+this.Ta:(console.error("getURL 未读取到：game_pkg:",e),t)},t.prototype.Sa=function(){if(!this.Ja){var t=window.ShieldNoise;t&&(Laya.timer.clear(this,this.Sa),this.addNoise(t))}},t.prototype.addNoise=function(t){if(t&&!this.Ja){this.Ja=!0,this.Va&&(this.Va.removeSelf(),this.Va.destroyChildren(),this.Va.destroy(),this.Va=null);var e=[.9,.1,.0043,.0033],i=t.split("#");4==i.length&&(e[0]=parseFloat(i[0]),e[1]=parseFloat(i[1]),e[2]=parseFloat(i[2]),e[3]=parseFloat(i[3]));var n=new Laya.Camera(0,0,1e4);n.name="NoiseCamera",n.orthographic=!0,n.useOcclusionCulling=!1,n.renderingOrder=-2,n.transform.translate(new Laya.Vector3(0,0,0)),n.transform.rotate(new Laya.Vector3(0,0,0),!0,!1),this.Va=new Laya.Scene,this.Va.name="NoiseScene",this.Va.addChild(n),this.Pa.addChild(this.Va);var r=new l.Ra.Qa;r.randomSeed=e[0],r.intensity=e[1],r.grainSizeX=e[2],r.grainSizeY=e[3];var s=new Laya.MeshSprite3D(new Laya.PlaneMesh(30,30));s.name="NoiseMesh",s.meshRender.material=r,this.Va.addChild(s),s.transform.rotate(new Laya.Vector3(90,0,0),!0,!1),s.transform.translate(new Laya.Vector3(0,0,0))}},t.prototype.removeNoise=function(){this.Ja=!1,Laya.timer.clear(this,this.Sa),this.Va&&(this.Va.removeSelf(),this.Va.destroyChildren(),this.Va.destroy(),this.Va=null)},t.prototype.addTolayer=function(e){t.instance.m_layer.addChild(e)},t.prototype.changeServerLoading=function(e){t.instance.m_layer.visible=e},t.prototype.openAuthor=function(){t.instance.m_author||(t.instance.m_author=new f),t.instance.m_author.parent||t.instance.m_layer.addChild(t.instance.m_author),t.instance.Wa()},t.prototype.closeAuthor=function(){this.m_author&&this.m_author.parent&&(Laya.stage.removeChild(this.m_author),this.m_author.destroy(!0),this.m_author=null)},t.prototype.preloadServer=function(){this.m_isPrelodServer||(this.m_isPrelodServer=!0,Laya.loader.load(this.m_serverRes,_.create(this,(function(){c.window.loadServerRes=!0,c.window.initMain(),c.window.enterToGame()}))))},t.prototype.getCertificatePng=function(){window.sdkInitRes=window.sdkInitRes||{};var t="wxlogin_atlas/shenhezizi.png",e="1iVBORw0KGgoAAAANSUhEUgAAApcAAABwCAMAAAB8bKuwAAABcVBMVEUAAAAqEkgSHEgHECYNFDFsbownEEN7YJGigbYTEzcXGUYRHEimjLYiE0UaFkTEv+CAbJFFL16em7ymqbwRHEjKo98zOV0ZEjkVEzrKyODPrt9aRHEeE0HR2eJxeI0YF0PTt98oEUURHEhuWYInEESqsrxfZX4aCy0RHEhJTG/Vvt+qlbYoEEQQHUfN0OFNVG+Vdavdw+e+xNISHEgpEkaioryppsbiuPcGAgqchquBiJpqT4LiwvDPzOi7ncyQl6e/qMyzuseKbZ6yrc+GhKba0/fmwvexlcGco7LXtufSq+e4uNDJr9WOeZ4aCy3p7/i2k8zTzPB6eprg3ffqyvfnzvDj7PHs9fjv1/eZfqvt0ffasPDX2ulaW37X1fDHzdmSj7GLjabg5PHLxOjb4+nDo9W7ttjl5/jctvCYmrLc3fGsicHAmtW2oMFbGTbyAADp6P7l3/7i2f7uyf/qvv/z/P/x9v/t8P/43//12f/y0v/XcNd4AAAAcHRSTlMAzMwQH9mh2uQpNp/kXWny2s/m5qvxz0Y98vHTc/PZfPGyhNaK5tZQkdLx5JNS8tLg9e25wObp/C7g3Nb49uvf6+nd7N/8/Ofi9fXs7t1f/Ov53Pz8+Pn8/OD8+PbW+e/i3/n29u7v/Pji+efu59I/v5vCzAAAS3ZJREFUeNrsWTFv8kgQRWO2wBa25FgOSEhIFAgXNEFx58pQpcLUIKJInJLK9v8v7r2xF+Mcdzp90R1X3JOwzXpn5s3M28mXL4MHwxn8CxgN/jNwBv/jn4briTe0rfc9n8+uf7uqi3+OoSeyGliMV+PBYB5F88FgvZKV822n548X67/DpcN6sVk0thMriwnc9lZI+flq7bjjGTj/iMtk5rv6sNjA/m6+/bXeLpJYL2a+N5uMQNbW0fPdKywJPJAkmfw5F/XhMz9r4riEo7ZMswNfjf2FJ5qxe7OvX4Ih+tozawhpDZ2HDwFXgIgP48VGiOFgJYpIper6AkxmXh+oeFsdpJIIC85cFrTjRRZrXPoN9KTB4i+5oPwW7EDrJpIjWLhKaYMFt/E2uTH9bv0TLhMRDdLUYt528tkHNN85n56HPW/zThj+IpIrNk2TfekhgrFuskH+/IjQx7Cx91qTlaXvaIJjDeujLXKL1TC6pjn/VoKhuuuNhBHz4OJCeOQfCl/C2si4ySc5B1tZTCQJE4NV1+X5iQSL9zBpq3OsA96YkCPxxYjEHx8xZJHvYvF91/cUESqDneccr/6KSw/sQL5PZCymTtnN8WAkUsQosSRcUXjgH26v1ok5p+D8Ey4LSUMEWQwl2X+IjGwnAcTFSoNhK1Zdi3zAqkziIk8lSOVYtKcHdQwScwWq5SKpUHw4Tj5yBrmPlaQF2yBBLUITfmk8gT4SvKi+nI00iI05h3lQ7xLxxLT7gA+UQMehYi3b4HiN6SItMEBVEMOV+EjSD0SnBXPO93VdX5hqWhvqkjjixkqkwTekMnfb6uzrgrej+BMpdnSRq2T2O+mBWsAr6GR+j4qjXFh+CzQNNdqhnpFc6pDdlPFYzvUOooGnbd81rbfBTk33ufw6F56vQIP4K2w6y4rDEZ0MFfs61/tW1lasZ3Bt4K5RlTD/IIcCUXcwZ499KCoI6ytErC5xViTALu/uv5eo2h0zNeajNpBcnbMMYZOlbCL5qGPxYCxFEGj2iuASHpmlIhEgRAwgum2828mADBpdrvAlRV0eB8551cIF5Hd1UHDkb2RfI/0zipCgYKpL3L8hEI/J9FecDYZUnUJLe86VfQjAh+IjVC3IlqPl7ogSq8ugBRqPGlEX6KDiIqsRXOwxDJIu8qXTZUjNoHHAD7iQTLFn3jRtJT3n4USRFDXu7J0vWytVhXiYzVrM85GpYJyBw8YZ8osBOyttnYDGyjnh4QOGd+flkcKsb6Aio0SbM7FtnQT7Og3DYKeKvKTiNfMyrxHIAlq8o0sc/31NK/rmKEjkefA4kHeODONgXyTaqcif3SQRWl1aoJMsoML3tToW1OXg2eOWBoEtRECwPVJ/sI4oo3tvRDVcjgxp4TeyQnc5k4O6EH/gkkaKlTwM6kuIy7nTJT/EZjVe/yIXYjjf4GXRaGiX6nCMuqEDv7kQQ466vmIwL9vzvOFVqctkBZPLlZ2+kGb4HY+ktNs15/AOl5EHYX60RlbK9JTXbTZ647RLKdGE51TDrdxIQtZETHsg8m+6nHTiL+rA6jJEDG/wQIhUCoO08BxINHRQ6WprzlU7Lyush7KIhECBqkIU0dxBapURC1h7z0IEQbUPgqzaS4PYsE7VVuAtMSYM72XtiqkUsBYLdyMXhAjyHBywgQX3HXfFccAvFzrNqljDK5uO0eYXuRDDDe3hrAMKxN1ptVetVo1W16yWuSID9YkAWL1ej2ms56tKlF33unVswJDIkKN/T5b0EatRu0si9bTLMMD3VRYoBNBDrAWJ9xh5BLbnOzFNYNytLmcdGc9HlA3cF+SEYNU+fuS45LzEuKnyMNG0cCGSQyA2EavL+XDE37zjDLyBhTsaOg5TywIL6tKTdMvysHZpdeZjTPUcRfLqHASHqoHIn8zLivOS5Sc4oooqxwcIaJ1xLDijlf6KhuIfEDTBjggkD8EJ70Nkoyjk17lwehSshAHOVc4bzLZ3/o1NXYqFPqOmwKmyV4KvGOnK7kQjjK8qCLcGDAlzX5eRWGzDsDqFoWl1qaeLDzfvM56X4JSGF3gOt9RYwb6atlEZdk/6uiR8ZCwmM6pLffHYeTmxiU2ngkvW1qeDmba6dJxWllV6OIP1yGlSy6YW1RQtWR6qUyFa6WRaEYcYi7icDmE1PVRv76aQu1mvrlxscI5IaBE+igyB+GE/fSgsrFKdmafqHd/Epy6VRWiN0x9wGUoCWyMKKxuPQg1vwPfPnkz78xKo/gCRN1x7A7jz/Ze6tD9HzK2t0UpdqlgFmoiCTL5hqvOFzTXXRi27edlt8zgVFHCuSLDtcXCeF/JaUgvlFZK8Am/lG2/JtBQpX2XmuJEkWZmVZXEop4lsnpkabS1KpAfpvh5OYuhnCj9pWb6jdu/ltCjfRNpYJ9mM7nAZXbkIwbCSlNn0gEXTfl713fupzJYSv5RZnCEAe8LwohHUvCg/5QdcVhLr9kUUiQGPKPLmQ3eO59O0RYblxdrxQPcW5KIKLXl9K1+NeTdGPstT1qZFf4S3XvC5W+B9dueMgPuUqdNjmdGpUfZF+SIbeSmnCiET6aGc0ulSyhRZd43SGNq8Vqv8rxVs7OEVR+RhcEYRM0xfllNOm5OmKISKgLC6XHF2QQeofDwtD4WIr6l9GgvqcuRBSksxyJhFSU5UzURQvEMJE7TnEy/f7B8eemi4vKbpjS6xJClserpMEP9VYooT8w+k32O50eUrI6Voxw+4DGn7Fvd0NHOeud+0+MTy3FFdmiuoPTdq6mZt40MGZ4clV+yawuPzS5p2irC67GHFrO7pUtLbiaIxY9MhYUm4D6SXrzYEu0Sv/aHybOelTe7ButyIefoC2aXK8akluuQ40MP03ujyCYvxU8kxU5baUhxBWcxg0YFVGDlrAXg69bBym0Rzib/KLyiZfYXHRMbNXw6H97hktoEIO4cvRjVWl0989/WS8Hj/RloSv+Epxu7fePKZAw2+vjAHx3+Ty8j3VmOnVxhnrOpKtRJfzTxSXd7gyepSLPTZ9Zqn5edbmmCkvUD/nsR8Rz/qj1jK8pOiejHtQgaPM1uX3s80ZnVbayO6stRMMwGyKX8UPN3y+y15epfWavo7r1bP2jgQBY+RXfiE1UhschApYLCwi0ggd2qEOkMKdXZjEBYGk1TX7O7fv3nP6JScr0iVIdKuVvu+5k02CbE079d7/Pv1fdKluEgEPPZV/RPmTCUaefl+PKL2RGxQFEgw92cwS46n4qRXjMIDHHC++usbOPea99UXBizN87wsfDwnzu9nRMEGb3MuG9CeDt6LIsfjDq/+3YCa8KfYvyJhsSsQi/tctqA/hY+Fa++rd+/nfgQAww7E1xO3KNpzDkBC+YKh81e/PfsWm9kXc1lCsPv5SQyzCNvCtMXNkEDIFOdChYJTVVHIdOd/cfK3Y/Dt9eqJFtf3NyaFlxDCZKHuvL/KJM89UW3F0+TxjpfgR/DMIuZQ0JlCVvRpyxJ0XeJiW/lrrLj6Chj/dCOhpDAu4OdFMemSLpb89/FiFshj/vG8lFQmXr4bAUxba4Wqy610c7fBnCt6Tbo0gy+2wE2Xyx3y00l0qba5l/Pq7ep7amGHYUBxFaa8gjtCiKx67PjS+8GA+15g4rM2YDov47n6E0NFLL5p0Mek9jW+Aclm3DICSLgxlph8w2Dt4HkOLr6YC3Mv+hr4+enATKjf8ygXQaS6nDDp8iMgOSveREq99yQKyWOiTBKqyxyC17oW37Gv5dzagXiceBkx6nKKo0banx5n/4bVTZc/o1ACqk5jKW3FBcJsfVxc/6/Ll9lsFlCWd3WwuImXb8dGSnAkME1BdCcI5ly5XTGaGOCAnJuSJeeOpJFlY7B5UtsEjTvVqRtqIFqidi26VI3UAcDNnasHV3PWOpeLbbhC5dwey48H5piLwwga1GZMacQmlHSnywEvt1Au1aeTcxWS4Ku5oO/aim83H5l5pkEK6kUM9e+egK0s50TnKhmaXCxCRoz/YnBAiD6uSy2Crl1nUOYIZR+IyvWu77iYPEOTkqVczq1lguQhuOOFUJ5rPc/cSe6lMNU452rWarDUysNgtniGObm0NL07MebiJ8qmGlzr4iF1N8jGySkeqElFxE5PEDrCiZdvR7DcML1MG1wOWc8ihwyZG68YAmkMsFstFjddzmYL/RTVk9qqnFwXG+yiIBSWaxKrtnpLkA8cM3cC8s4NQN3liMSox+bT71Hqb9JlEm50zJtqzxcbAvXe4F6XT+AG7Q6/wI6V2Hw5l1xM9x3w+aNNJy6vnldiyJEfe1sw1sAnai41yN3JIFJdYoTOo78zGKphkNA5bvsomIoeGsqGbG3UNzqGXpBT+YEaTLx81mXq2pRwndyRCFNxXLPUiocxSg6bIHiIQpF517mewo8elnw/VE3jahe7Kh14G6hLKMbmEZRwhI/QvCZevhvBj2Uy6lJIb0j6X03WcTXp8vnhZbEIgpsugyCYyZPqSL4lRQlpJvWRoQs7UNJ+j1tLRQAVgDbHnlLgeusMHlmy8H+fy6dGmzpOHVVP2Y1klsCdLoFe1l3KBqDpnLuwL1/NJXNGtPyJ/5CB+qlHipAZt/q0v5iB3Wbwn/e6DKIw0ZkkQiU1yqfuyy6uUn+N62oguc25FgYKHl53vGgyFbWa/atLgOV0JV2rn6fnBETJwpxjgQpTAhLB1dRxCkcnwL0u6eNelxMv344X6ZHNYI7Hi81sczim1iDjCq+DPdYwWVbbNZ5nwloAWAuQvoBYABd7OVjL7Xlq7WWfA2vb7G2VGfGKTCxRHipgBe6hw9za6nDALtStiO5zQWrTEeD2Q9Xk9NRnisMR5Xp9OHy47HpdGnsBYNPKZmtrm8pesi/nYo6VyQ/6823EgoGPJdaCyqY6lsiPB5PbCkROb63dYxky3QnKzhMgzBgysxY/696WkH21ta0mwttR7iC15mhzLIPxm3Nzx4smw1AKO8pqLTXVR1tD0HJc0WtTMahyQtr2mYGCbBxBYlJY1aW9A/BPGZLdxMu3Y8Wc7VHqsukelz7jiB0A1abiaIWUSIkbdTkKqbFUY1sbMcl6zoHL0RyO5kKvf5i5et22YTAIkFxIgpoISYMrAQIkeCEC2FsWw1ufIB27+BXy/r0jS1GUAsRdjN5gi+fv574jLScBnPaeMq3Ae3Y0jXh7/MDVLQ59Fm+/Ga53Wj6XyiGEIwVgxYQ7pB0w3NAJ4j4+H78/P5Y40NuzWnhImHSq/jjAgnUPMf9a6Edetr8H0fO8zSs+6A4punq7UPsNCdhbkuIyRGdn+LVcWjFz3hkTeZkbq6MvPJe/0HynhfcO3jiuqRs/H+jRxz2e1HceUBTyyH18Xn5c/p7LB98ZPw4QVty36wc02uLLyxHEwhsBPotbgccW96JWTJ6fgaRp522e4abJnygzBK9+5d9KvDtf+ZnLlEUsA7Jxjfsa9raP31jQCk+MRBjZDqbe0UputQzzz4URNa725JA7JCzia9y5MfPt/Z0T8G1ye1oLoxcsZfXH1EF8ARrzPgMQijTkjDBIZPDaykYMCHiL4Sf2gKKRcRymgZRBNJySotAXr7q1tTn6QtdbBA8btGiBBrwjTLhkHTthL/ECYDkehCJksgJaWhRgPDJw/RXGekmNwRdfXg67zuHPeKRdZwVY0kYrIwifv6PScdWVk0Snz43RWpvJM4VnGlz5kaWXUhqlJDB5P/XOkw3Ki5attmfBx1YdC2XYvuk1cb5mymNPD4i6w5rVnRj+pBbX2ziG3vpvvLiGupENFpXt2jKMtkE9wdZTxDm6I6VP8Sc4Y5AUPTWJ0jp6rXVzbuyqfNO5+FKAHGuPA9srDdI+EUba9C5uOtN3o01zyy6HY+F9Euv3sKMMFcsUZYovL4cM4+S06jGM1r0xbgpKEt0YFK9MMyEgSwM9dnJNdhPzYpzS2jhsuup0cIYvaDdNCJb8WZQpiAE0aLIY2jsld1rYlJUStFZMkrG8Swg6BxRoFnVK8ZteJ1xpIDTmOS2xY+j0Tovq1E6KSjl9MwEjdbAWDXJGR5iuoTschAFaEWztFI0cXZwHzjIT5RAGeWOgpIyjL1SL4n1wQNPQAzQPqKJpOMuwQ9wz11MpQDGoTBJanOmxYBF36spYW5vlhszHIPvyauQNkukxPyU+76DKHBeRr5NVYqLTBMkC7hzziPKyJOjGUUtVQa7tak7tINfS8L4sn9dSRiyD1vly2yM3qVUnN4ovwPpy7lg/q+xfQfblICa/lSoxVd90UZE1WxtcQAV7Ula+vBrlBpKJvHPrM1ElkF+jczwXpciKwpWa635+aX+pUEpXNddVQe5eLzP1vZYydj3oNn8dfUNk1SWF7F59yY5E4eu4owm12t3Ee0GH1IrN9Ca1eJSpyrTdcXg95L9FyOerym8i5JH6PuPbkP/vfxH8YeeMWdwGgigcxlZhidgghJKDgOGKoC2uCrhzZatKZV0tk2BwL/3/Iu+NdrSWs5colQPJ47g4K2lnNPu0Zx8336zI8+9y8Z/C8F9/lRaLf4gRsgov04+G1git7n/O0Vja4QVefNQXKcVY4co4V+JDiB7i3uIhFvNzsRRePm6LbZSPMUOcIL0bS0ctxswN9THhhmguGdK+lx9cviDPueJs1uweZ2tAQJN8DBFUIcHVzWVAeAz8jilfxI4q/+ORetHc0jVwGuK1NCMJlarmcjSs+79glSoPxHg2wMRKoOxtW+oc6wnTo+IVC5Zbr624AHNzsRTuo2qnErQNxorLWAGpuUlVSFB1k3nxE8PEzlxzbK1KdSIdHCpFT5km3p4kTGl/0ktKrWJsDdpSJ8mq90OED0u7GAk6W0u7rcLqEvgi+AXFurJpH2lMrGuLfGVQ0uRsFbXVtJ5UqJjNriDHoU6kYvVdzQ5r+1NoyUAkqFuuUlwVG8Xu5a6taKWIh9DqVrNz4crXB5HdpRW/nuZcY2ZUv7ZlJk1tTTejDZJRTnxgkiAkU63H1uwBW8BOOW9R83img6wU8pyoePN3zKE3mMoibA2YEJ3/O1ExArQcL96FtQS4SZpdMvT9htrnYy6u2V0OKM3j9OyhFbl27EMnw2hQx/6UDJrPrlil0tY1H2zedyMfVlweKiBj4hsDkStAVLSbIARr+rrFgZ0xD2o3Oxfe3pEn1eM5GU3T4oYAPPh9d9UyU6LAgERZic+s7UflEjyzGWN4X64z8yVZGIlhD0h00sHF85BnH5TE0tGEVXXfJKpWImyNFYze9jXGrwh2OrEdcj1ejL7/AKDJ5Np7X6bUUPv6m7Tf8utmwJXQ6A/TC7YdFv50wd30B+XYfGBZ7yQyk12h60QORPiHy6O99dShb80gkf1S8ro/9CezJWb9wmlLVNDpWis8YTZHI8WN9Q55XJNB3KwnIALbC6N6L7RlXR+Jp6Iv6QT68kIAA6EEuWAw8DdUrRjDRMyXkJX0djd7ZjkOsjGd4r7MIqyTGFsDBeSzCsxBnttpWeRi5Q/1J+MkUAU7n49AhOx6GBubg9MfJQ9URf5HI1ZE1XqAqRw2uG9spAd9zGeyK4bHs9Z99lQ36gXvy3xSm0guHyo2wloaEAsrTIa4CK61+nM7m6ORSa7+vSXVcJkvidevfJlWGuXYnjhpQUNzJTUtJuULlthjFLzlGSYO+dCX3MFGwk2ZqC5IoVSDfpNR+Vv7ZUQRtsaSKKcLx93gfIYtENOH7Mf9kmyd63RoWYmUR3HO39+Xiry+xwn5tIcyp9hjT7Ex33coh+7pmewKvrqTZyRgtlx13WiM+MceCxgIHltEKImQcJih6XKMzOZoDO8ormAJeB2H/XKfeLFhexH/DMZn5NpxrywRJGHH2rbwmIwTYRAsWGj+BhpCKC1ap8qZnvlSDxDNcdsE3gZQnl0bM8OnDFGCtAYRtgbXjcnU13C2xvQEpS6nnBTvyf6YCD7kVyg79NAN81lU0yQVC7FRegVLe8b7vPnsCt0vm0a/J1RroAQBiYcOO7s8Wv8KMUoazGB8Ja41JcpQKZnE7Fy4aBuMbUKpZaWYG5N66jlelzIHUsHM1m3oTMO3mMyXBb6fQVYrisF+AzfE8aD9HDdfOo/bOMMhPBxAeW/7kn2YYH548WnYbqNsDceMjl3iNAK/HGMyBMuCb2eEgA7DdPtu3C+l4QEaWJke1OPeYNpH5elGpc/dV3STK6IBvnx6ms+uKARqXveKk9G66Kp9zcHt6Pav+9J1uzhXYinu3L3mZVj4xAAXMmFIzM5FvuLs8mlfYsYn2wLYWMv/GLunKeV9rC671+61e/I6n7sOIIVhJXWyvPMFK+k/MjdE5ZJSCrWYlZTRAklE5LNAGLSKa+c+kn7Tl4t39OXYt/6VvoyyNTiWy/kspUOm+2SPoQKDnz0KRC/+hgS/s2AQ01EV4nCzP4g7n9c0giiOl6ce4pJeHDYb6CoIXdaDXTAkB6EsexM8CCnEi1QsgjSH4kX99/v9vplRN7uF7ckvaDf7482bN1+Hpsn7tFMO2rkdccNSFj5yIAba8a5v/mxjdsUTnngkDCOVcPOdzdEiHkigNz/vk05903yqHA32ArN5X7v3xy4/XTkcEHbx0jAXHvzE0oSvFgdAhaIN3z+fnfbPm/1E0jpfft/PR49nJa9k5OxVDhfgSvOind/IxOtFhp4bQiaH+k4fUJEEIYa+NPcM4C36uOct9fsl+zDLKIxBHVuDMJD9s97pBsMgGAoAkpI6OPWKK0ZjGEWJBI4v4kOpzKcbifWnARzJwC370PtSSTBzUi+G903ZFfKqMAynZE4WwsWXeGf96rkSrVTgZV8YzeHB6IFAI/ryRyJQw1ywhWJapSXlPyqWwC2YM/fLiobYc6QiS3eRa4dcBzubQei+503Zl6zmzz3oG/tE1Jfjxr4MyjAMUMODWrbG99f9M7ZKxPJhDW9MOmcwzRx8lFD3bD8o5Tgp87Dky+CGjPVUKRuii6wiJiQVWlVQV9VGTNRuN+Jo4CjZPb70rjQfCa/2UAMtnZqmnivRiuhMWxijNAii/DU/7l/gVux2CfaZhhwNIyFXh8vX27+4Hdj4JaPgMARM63gbqXz0ghkat5I96H3P946oJpiQfiDmzr+/3xXHwZn60Xq6g9pSawrBmJcvxra3RJW6QEz0Iu7wg1q2hgYcITg28d2O27yFFvXOGT8yi9Rgl6d2+zNKy/JFyr5s3Yq3QUARe+YxoSueQ8AW9+tFgRdaDTkabfrodBHCoTRTPVQ6xA7313IlmEx7AFsnmoTRrvvP3ZbNL/x22uBEQmMGDTka3UBxDVRxSoSJ8TOCFXr3oI4Tfd6uciVa+NXeDwwDkhYdm4DyBzTrRtEFEu4YX/EQUMFjzNSngOzdU3N7MnjgZZzTbN5P9paopi6YSM9pxZJ25MtDHVsjZUBEPs03bpIjwVquZIcyAWzA9/eOpOCTFTjkKb6zenesfWcVXs1Z5Ga8Ddb/H74sLUpHuk05GncB4yEAPWEdxhESvPAFaRCnQn1Zx5XAIBj5ypcIqPmFKxiNJ9SYw2a5BF3DHMw9zyAS3Kn+KNvNdD/X8jbomsv3Gsy45Xw5UoDBie8b/eEYCDnzKUEaBaLdtVEBMkx0JFpQ8/O+VP9+K/nym/rc+7Jal654wZWr3yOhHqpsjeieATcnEDhIpFnpjsIajXa7KUeYE4ryS56UIeUH9T/luOOXyRlrwordkLehvjyS+zDpqYhjYB922JmhxVmRO+yc/zRuytGw8WK+YgZyZ/DCFxPEQEM1m53ruBJDDIKHpuz0VhrELBQ+nf1CDnpCkiMK2zQX5R8EKWcnxjCpK/UWx4IDteu5EpEG9vcyY2BlyNZY9Y5eCrkIJJsB8LGImXowbsPRNteOxVbE7PhOcGbicRyZaF4PdoR4ZatsH4qqdbnslsdF4Y4kqLA1MDADogzH/JKfhMe1ZIAiZMhxjRwTSVvazOMKYrt7+De6HHd6rIleuhVvgxqyHKH0r0stCW2APIneYLlRpcYcjaovse7Ol4vFKpSs0Cb8Gq5EBArSMePDNkxffYeBwwnz4Qkj00Qa52J9yeUD38Mug+8by38dVxp/0K3nSkQIVvYlxi4WMGDu1o0iF5QRM8IXVmwqTaMzN0RzQwouhErY2WusL3mZkazsBKNqXVDFikQ+sjWilk2ZyxaiY3K1ss2jrBMqQNaBGl6e3G9seV8G1OcxP9eZEhicZW/I26Atw8IyXC6iI1F7Lu1xC9KF/BdHQz76EtrGbr9MdBz1ZQ1XgjtdwdFjMerLEDeGMa1QwkM0zoW+pLFxiVpsxWhfZdbDPbkDiURVrkS9L6WPTCZTkWtfmkArtcaqx66Qw67RXO+H3pfGOKf6/xjq2pdJ38r5slqXQJxYTa+gytYY2pSxnrHdkSGWtD+dYCFzZIwN191bmgT1JNwZ6Ut/6Za8jRZ5Aes+eALbr1ZFjEm9HTKU6+t6yYb5NbENTdkVbImOD8rAUBbGAa8sOxR8Xq5hDl+qvI0u+/RDmZFIMBjgKh7Pk+VhkgP8Mcn7FHu38+ZMD8UuxYdtKNN+f3ZYS8C13GK6echoTKRdz5WIiE8oZSyhLmruAAb6R1/hSSQX4CgjIwLd4BAzG98zN/Xl3Vj7vSGDk9CSvtTLRlT+oajC27Dc/zJsQ4I6tsaAAfPDenbAazLJhFouWQ2lRbA6uLcvsdPy4I9I/ngLWcytv3RD3gZ9yfWUZBYfvLaSHNYZDjDbaZbTnM3ZFXUsDBhiCtjJUr46TbjKVa7EZyzIlN7s6/fIU34osimxK+Hs7Tpe01yU+wYayzoUup2B4V/8iWX680fnlQMpUM+VoC9jn3FM76d2A4rLdk2UcYExn57oTKRsB8ukO/a+DNpto/343Tvy2iw1ZGh9OXi4p1LhTBLpVurS+sQmZSGdCL40tq+2nq1BW/FDmBW+Xhk/enkoJGi8WWBBUc+BIb8jKPvyhryNlOs5NFJWnshfZs6gtXEYiMLLji+ykU4B6xAQCHZvolDfcsk/6v8/dt5IqjzJFBxCSd+htiV75s3YqBDQd71+8Sb+X/5djrIrbOGfM/gTA+Zg8Tbm+nsvJ9giuY3TYaEGvg3Zeb3jNQ86zvRIXMbfC5tfGLOEaCdGX8m73D4+rrzycj5HzuRKOLEp4mk4ppLDnO+Ku1zfhAqxxlQDLfwkjy0kIWAhETZ5e9nc63mBlSJKna4b5p2v8I1TNHgbRMQf4rsgkvLEIkomWwMBuV9sA/VCaKeYrEgO/uXyW6HtQlnp4JDTC3kbxO/zjG3s3TA6PAAsuU9sR9kVJgujB2blnCvMweBKrJyjbFhXEPvUcy3RL0g8DB7zUmhudSSHmhA44oCS1xZrpj9kciVIBrNow51t23VSFS7wC8bF7Fhzgnu3tMgIIXK7/fhtcPOYRtim/pDRFyyZvuWbahibrbF0RokMSMAN1cKkRHfOp2y9o6VwT+MkjiDp3+t4G/I+IVcl6IppDmsMwc9NBaCIw+wKm4URw7m4JoE5mLwNitMEaId0fireR7eeV3mGL1LowA13kOlBzofoJaAr9RhDDhFwAHBEzkUM2FwJKolbIMnFMTxB6NVgcCDFirM2VaIgLkLE/QLACN6R2lwfUYdrTBOiPfhk0hwSDSpNOY/bbbZGyXwUy1FaJUiO2vKG5JjaA0oSBd3pNQMcUl7L2+iamvZXX6ePsSu0dpM6nrMZF5Bc3oE0IIwd9SJXOwe3NvE1SV6TK9Gd9uMYN0pTyVu4cW3GbdNqmEzeRvNouCDdU21ZQ0KUJZtXMmqDXsrbkIrxV/dwnKruHWRXdOknFdWhDRleBpbCIGk86IVGFuXuri6TK9Esk54mo1cyqbOTHVjxL0YvVLkscwGxaRp67rY9N7ePrErddp3QTfplG891L/UpPW/14SjjLT7rhaz8P9M9O4mdd//hP9Ew+u4V/q7P65M9OCQAAABAAORj/zcX+AAAAACApw1j5+pZHIeB6D5sZMsQgwuRgBeCwZDGRYqAi3QpXbnPT0hK/39unj7iKPHdpbiDLfzgbrXWjObNmyeVu+LHYfXlihUrVqxYsWLFihU/HUn6/FuRLMf8gzr6Yz4/FknxKtKbXKleTkz+9R/c1+n/MkFcguRDazHb/4oW6B4l0gZoFVSqy65ciiH0Zsay19LDJoJ2Z6jE7crZuxDJYot8onLFx8Oy1T7Hx00Fbk3qRHp8abdpe2ofjDtALSUy5U8ou45nzaIk240uCHsRArVZCwV0tAyhGRLjoW3xlKajEB2G4USfuezKQxpKhK7fWmvR7F8GrkMtHTTdJl/sQ9Zv1dO/jAJVjZYLclHIKgga/vcw5sHGPNLwjG7JlniF1lLnLHWKsjuB2EkvUrFhMequl/jM5RoJn/v1q/dvXeA078YrysRl8KH+vCkFoMpAWJGU5Jbg6sl0GvUZ5eHF4QkqSUn+ZEsAPIsG14oNn+DR7KjSExqXcK6hWzioNA6hk5ITN5qnNIUYyo+q1BR9T8nFky5q3+xdCUseKrT28C7Z7n838C5oerIstHf5X0SOR3HvKzikX8CUuX+5gWLFQtDamK13uUI+o0a6JPIxjwByykKd+mhuaG0vBTIpVjTkvsRHYMtlaEEo7Q3ClyB5/4Y6cHra1X7FN3p/ssttF6nzSVPkKGxBCGdCS5oZgaMw9k/ShsJ5zH4tbOLXMgpCwZiqHysZpPIFLvk5I4AdsnyG6GWda3J7UYgzTshiSI+4TKT8SBOfRSF02R5HA9Uhv8LCdXk7gp5iiY0nL1fNekLumhMbtys8lB94nUUCiqYXCIvcOum1Oi2/iDCK23S3P48oy9iXyVcYXzWNYY707mAcBonktLff7SE62VzNjOsE6xfWyTLTT+Z2qSC9SEX60uoOtcCHhwFTLk2gktbPgE55GFdp8/6Nc/Kc5l2XW0M+K+DiAuvIgktNxeB0YuSQUdXU6hrEaUpF4eZr6R/J3e99+XjojEFt+gs6zo8tX3MzETd8i21yD1mhBLwvA6kLMMUASjtDpvo0BROFyK625Peoe2MlpyfN1N+POF8vtkSZckYgwpXzjPscM4zkT3neGzPKwgpYijhHspjOvJ6v1Wn5d8SjIK4sGvsSLerM4T4Glxd238F7YMt1G/nymXNufUmzDWOWD2cQrQSxBI8gd+Cdj/I0M5bqezG4iNvgOA2DdNwsfgMcp+95F7mseplv04rckxl4yTJX7Oxv7WtTH72XRYM7XTiN/kkKwxsn73B//EFigGT5dcgchoEyX2rgZoyQG/rK5KxYO4cFmJy/B2tZQuOAEwS8JM8YR8snpL2OhQ+lfevh35F+4KCygVGycXO1yMFdNWMtjoUbysjLVLFWmEDKU4Gd/BgqbMWmRNTGsi+DvL8YuZoWR4EgSuGgncUN9CFkUWEJCeSSQw6BLBg8eFD0sOQwlzBnIbC59f+Hfa9aR7OGYQuSybTV9fHqVbXOMJOrMd/nikje81IsvsxCWM5LuJHrw8riiZdj7J509oxN51Lthj+z74sJLzNVmccz8jKU9mpZ7xxOiQN78tXafuDldMeVQD+4w360KHzJHd4ZfPwnLxGwVo2RmjRfRbLeeSsfH63n4ZEAfmBmRPQKP2c56V4SiUanxsKhIWY1ViRyzMAVC36VkPg8lyAlkTEqcoZDOv4MxXN4kBCxnD8Q04yX+UNBVoBRFiORRR9hjVGHXhWCFk5JHthhemgWpgbpbx7Oj/FI1j2Pq5g2ojDXAAEghR2CT89X9PDTOf4VL/mMM5kBKYtlDHo/7Xlpznr9z1280DwbYIokqsMj7nksEwDGjmJAPOkQNus0dr7ycuAHVebxZPrIIIRdLBUsy3Y998G8Wtup+przcrxKb566R1QuPPHbktQJwyzwp/QsqZkE04PoAVcbuLgjVsDUh+wBvBuT3o+wjW7tb193ciWd/rm1X0wbYgRGeVm2V9ZOqfY9+2deZuHkHEfyKz7lvJG9n0T5sRbA/8fczUBpz0uTw9aRb97mnxa0xp3Lw0h+RtCSe8LbcTZHBsGbMURirFmP4WrBkQfOcQoBDGHvOnQIoX86x7/gJWvhJrLyz24uwqtd1eZeVJEcgEDqjkI5ulSI9r9yCDZSdDjgZ+d45DzijsdA15m2NUcgRTl+8pIOVeXHLJ7A8xIa+50cllSA3bZjFF0r4cs1qq+xb9yR7VjII9NYtUI5ZfRI2Sg5DvOkZnBBZ8jJGmd83ZyT0pVc9NaIVgXCFwXRvA/Y46PrJja/w33fyBovxVSCfTmx6MUAxVUtIRl3N4PAaJYJP4BlETznMJAFQYD8nRcigKJEsHiPntljKtuZY5V2tT8g3Wp1X9lIbNtVR1XpLZi874GN5jxtnfXiIGnlRmd7PSBdOii4iASvWssTmCO8Jvb/e46z4oZTzUWQIgEA+56XBfjjEouqvS1CgGKFswFYL35Jap4lFW4TsmjkZWJk21tOPS+hCbOwWyXJvUpqgZKbiMjbLJ6Rl2v+WWgGgEpl2s+fanTxYs2rY+O4Y5/xyadqcK2q0zrpSu0EVLGL5AQnb6+SesJq1CmcMSAZPkUkl7NNwcIllK0csFZVqZQkGSu19hMgdUU1udPZSQee7vr0KAm0rZTYQbFNY0WAoq2MnBaYfV1iBtFhBG/VPUmOkUN5toQqOAmUKZECBu52ML41g4iWpWgwbuqmKsUkImVhkirlnsSRl5TUdX3rUT8L9jBIo72ATzsE6IrIi/KSmiZRk/1s21ZIGKRBGUGPguPh82Fly1C+5GX0OdXixM9CF8d0JXEjoGEQgHT2UpDz8LN8+yZbQHLxdeiLsQj2u3BJEo28jKVOkoZqN4mdDOHSj74oW8YYuziiiOxn8Ux5GQSY791FI+TAoNH52shLFMpfRV21BdSn6y5FnEBbyuYW3S5gbYZj9VVST1gNOqpGPU0suiFWqyHHFBb40iUFSFXdUNWOKSgN44oru3FeplD+3qcXaxemiDvRMQtWVyWqRxS3INBhT7M+M5UwwxuverBiMGuJAFN2aL+m4zPmx0TrABEti23YMo1ThE/w5SIE07jalpeqJmNqVxW0gnfoL3VelrVNkghy4yxk3zT0PsDtLbtt7FRUBwluYIu9GsIZyINAPYI+lK94OREqb1Gz987zkvMz4L9iOiCum9zw4kIoTKuTUcLZX/vTaw/QrRClyw3xuAbF7HkZLrE0NDekriWbxTN2z5o/okQM5TMv52vjvPzcsQuWaIH6/bLFtYbc6ZwdRkOjXl4mtTuNv9AYdKRM3utUBmGGTIVfKHB4QXJNjbGkmWm3LkTQ2cVFPslOFKdtp536rgPhN0fXRaunKJbvjLVwjQLYN43KZeCldMRqLzeflodGCU+7g5KnMk1F+sZrG/nL2NW0qg1E0V6UFMv0MbNSmkAjCQjqJuCigfAYuhEhcRXB5j901U3Mr+85d0z1VftxwIy5M3M/j3feM/Be1pqv5rUysQYHJktcHfYHw6nsSv394Uf16tj9sVE3VQd3O+xGXuIFld8O3EIqkk9wASwm/yVPaJEw/+TloP1pGBfjYijii/ermZ6HS/k2mAEEW0xwm0QSD3AhIJYEwtmK/5b4kZeDsAUYDGzhg8GpPvIyUfEL1qB62ADRgz83L+csZda+ym4n7Z5n9r6V3fSJ7LocGHfMwiMM12rtJcrVZr7M0Qo+wda750Ft3/6YOdMKVcMIuDc/qq+zFYcAV/GDFzto+3ao+euIpsMMMSSwPaZ+Mk9wBIzhBV5+OhxeYRGl115klJc7qb6BDS36pyaQcAK/r1DLMdRPP8vrYBTMJXjp9kNdmW8UVBSzgxusfW2dw4yjzfftMBxeYxkCaLcGCbKDKA5IiZj6dVBS12DukEkCzY6qAoZfvDyQl26IXd06mSdHtlURFOGrRAj3JZzJ0f/w0mKfDTxISQyK+NL7XajLAvJ0KMD/UO4Ec1cUQ0ayTh++v0xNbK01g7WNiQ0N2AJq0wYz1D3y8igWxo7YANGDPzcv5zOSrHCkcF0IgitqXh9lYbl2yzB7zKEtoYlBuG6Z0CZlq6UUV14+BoVjsa3unkmspGzbWnvU6N50pb5O5xgURnzFGRFSsXWhXebwYy9LMW0m+a35hvAW2OtE/F7CDidAWqUpXporXixbfaiNAho1ucRwnVjk4tOA1uOMgFlp2iHbUzAUuO5VV1rj6lOpDB21+8apAmOBwnCPwyqXmT22DVVaXiuSIx8G3RVh5xLcIkK6WXBTtDFV+rRNY9lO5njbxpJHGDI4BF5yeqRa+jdeXu6AxfMEIqsv1dHE8jKHF66++AuMSaTP4eUXzEVkwiyXxsnsDS/LdETJVZBAra2kKkdeqlgsjYny8sGf0UsrsJl1IBlRXjLcXUp5JtMI9Ni/zTqj1666rhPficN27vBq5UlQK6y93OVuhnTQTRNAf7HJci0HS8SybzS4nJYKx4el0624ogJFMVAye/PzJc10zlry3cOcGMOaeSjz5GVmSwbqbplRp6KQMQAOWLu/xDJ/kRFQlrwsJiusoRMSX6paCLKnQ+dmFpoGji6FsBlyNnKtKDFQuzdNpuRLNMokwtB5kSP/ilcE1SOuvIytQ+y0theE+YEpaETBwFfkZZcS1b95adjVNKk+hbLtlZel8SYde6Yz3cmKPXXGaVukW4rQpiYoWcZsfXzDS3lb6PLkqLouL/Efefngz42XEevcUO4Q5qlpikLkmWwx8vJuh72kpS0LzVLalTBgpKHMdKjSilaeBSXmdJ+72U52f+alBMCTUO7vF1MUseygJi66TKIvkcTdKQvnSi71pdZ3W/E1tNbO+c6fhHeaPerBiM+GlxGMLCBfSomb/IWW00tXwuQNGiglpmvAJAdHOmiMoPh7h7kY63dqQCQzdYfbGy8zHYgg+AzShfDi+tJpc5pNpncVHnkZOqHSBToWrG9tgBonEILYTcHLwiow/zdewqAjM3q1mkmyxdhbyfq+KDfQsf4u0vjzeeMQh9uce9+wLfLPykVahfNGPqODijudszffX65P6xtOMOAyVS2+QMI2a/Jy098Dogd/1Evdh0sA3zvf9949lX2eQqq8vJ/N/Lnvayu7zxrFSc8myM7ekYLEY1BLcT0O9Fu6ZkfE5W2AX5OX6ut1OK5Wi61EDE5scW7E8SJSnk8ZajlFLeOCqZzi+Q+C37AuH9Sc6I7MwZ/TRmDlmpE1pghnA/pNGB3Wn70sF0daDrCbEb73uFqBjVJsXJ4KJ9l5TTKsWclInBB01PfFhhN9sQbONL6kWXxI888R3yXLUJGm7tdZVvQey2cTnSJCuvUW67+fvhc9lGIukqLvyYLv9KlvJEGaSvmFNeN/jg8wGb3Qqp4M0VQcahVLs7bgBUoJsm1AUYe5FRa4soDFj6zhF4lhkhHP+fF/+P5yvd7csNbclf0pBoEbyZWXc4ntHQqIFr/5M7nxErcjltswbp/JFtHIy/vZcZx/4TpiNcqiLyMvfwvqI6jyk52raZEiBqI2CdE0tOgpgWkYGgcCsgeFOfTgRTyKLF4EwZ+g/v+r71USazNp1/EDVNyH2Pl4XamqVDLuuFUv1Sgh1PNGVheXqwXDzzAOG/N0x5P8Bu468bgsEXMRAcFQSQxHYpQAfY+zAW/jDUQP3V/2/PQ5P9318ORpiye4Ol7CSTbluDzCa6czzgkH4jTA4TwKC0RAFwp0AXo4uRQ+Y0WsyrszR/xzhGHI0Wit9bk1PEJ8gY9zDSAEYIHJgcjYo8ZrZiJ83r857QbYdEIPDY1CfgYtg5xe+P4dVucubcPYFFfEB5RdfQzGXOHf0/mH+qVuq0h3aV3XxKHH9KbJdy1QfoXXHJaj8yp4pr2KHeIqspG/M0hyF0LCTTzBUKePxqXCRStB+9BG14/R9Gyx19nw0B3xmFeLFdBcroL3HDviDS2o1hjFj1ps69QUJlS7sgk4yDCtPKwhAmbQLSeZP1TsJPilLKUTB3pICg5qGQlQ+YwX1oIXd/wkKeBqSS7ac0BR+Yeez86yNg49RGbZvwW9ItDitcArWKaH5ZC8LiDfx58e4QGIuWGBU7jzpF5lqTbvcNrzbsGxKkwHWwAnnNHJgeG9uz/w7dmY9DBYQH5sw2H5djU6QKwOULa2Xdi7fQzuSLHJQZvgLSd9OCwIgfIyLKWmDJ7u+0vDINlX0PhookM84L66Wi1neX+k669Y8lCrT5YlH8g4jWuM61qr7Zbn2RhvrnoSddZCO19p5LElY2iVVXqjJjavZba1SyAm4DyCPZryUAq6+9Wv85G3Oo9L9VJCzwvNlLHoeKoQmOJzucDt7PYpphneLtE+uxZzXIbl2vIkVWeNPcfJ3chNhMl79kRrQf6ESzZGC5CKTThgqyGJLsj6Cn9c0KcZM7yZGAK+mGllefQL03OxOay0El6JK+CBVcyTcNMthtnmlsKS+lUagHZabQG3kjpr/VgOVuY9UFNit68QSjmB209ArZBy5PBvz5aPhpBpgpyig+pjNBaIQLYBqnmy6tkYA6u4VWcVHG2gWvdGTfjvdWm1domr16KvsfqoInywa5LQ59PQgeql4kAqXMeyL6I4I6ZQXCUIUWg3XcUG+yELLc4iR30pG5dlluU5Gzmy1mV94lIZuqCsNl4Xa8D3nEsMCq5MHuWUKSBiDo/aDWXT1/PCy5gVq2vIUaT5fn1qbW9CJzvqdg7SloSm2bEayY200cnhqqSmUHA35gu5U5jT2jDaKOiN0pai01cfHUVb27V4mxPdyu08v4k6s03pJbarZ3RKc0rHW91af+uUMm9Rrnfj5fV4dcfaP0q8yQRulShHQ2U0Y6YlquBKUTTlwr9riZJ/EGqUdrYZfJTJ5tG7qfXfttQqQb2jQ0pmpyV1aiqhcWu3gFqqOrTMVmSlqkntlL7UbPF2iOni/35RYkP8LvLl+MvKhd/hrwMP4cXUv638/B06/PYsefMD5QnMrzGsv1QtuylnNJ2YP3ERetsPSJ2AO3TQDBOreew5hd2PaTo4J/kLTNbXp7SGg5XyBPY7kQLR4HrN0fdTKJn0CjDSNwRoCr2oRYx9TnyYS8b4QQMuzOFreYZejK4czpLofZoyfPVILGn5G6ubn/aq5wBduHyjnsJ/DT+NOcPE5doCEU2msLubWc+ufN+yCI+Qb0ctyhOgfyv4Krlz+T8lFSwhCvgijS1fZ5WTplwdIDGzniS79GkOgU+PFCzJ3R5hyiyS3OzQkDICNRO/JOgXzFw5tEn0CqFFyslp+eh1qx9+0qtOBjzrBOz1ALaLtxgnr3UZpE+MZczXdTXGsXBlsaN1HFr4246C57C+qYI72MRx1bDletFUZ1uonl63Ypkk1csOgJ2Hj89Kqtz9Zw8+vX6NPfVIG0J6z3hAumtONgUXiUkJCVu7gTfWFsxISMY3s4sdozonEL6q+fclrhCWrz9Ja+ihqSRQq2SNdTnxjmmO05EJg8Qih+HV2xdDTRUd79VMfEcxdFc5A8jpKqhJ60wwFwwum/rxxTBBawnBs9W7yhmXehWtIWcYfgAV8GcZHN2BX+QI2kOpHsC+YNmX3y0s6wrZZlfuKytrUeo4dB9HFRsxm4e/MHLGrm7DQBhHJDR6QwseRELdJSSQpYOHggqGDh5S6sm754DB2er/n/6+k9XYdSm9IU+WTqe702eJB/7uQ5p5sivPFttE/Sn15xoSuiqOs64+j0yM+sXoJrqVD2xFpmyn2gLaNsvgNPXh6auaO5g5Ppba6v6ZDsyrqMYvPrvuxduV6251Nc8yQeTrW+y4RIqsp8y/T/tQYredRrW2VOCDqxJVueJvH5LSpqTAzVjzn3lNupm6XXXt1HfMZmEj654+reGdpWbwJczvpoMI1CMN51KoU4nzz75wxy2VVpBfyv9mlWZtdNnnmI99FTxYln/Y1FIg9rdc00HpzDx1K3FRuJPWTf6k2g4VQ7OWHq65jsNxy1UyAUFbWOoN0cxUDGI2XGzeGlQq+jHxLleOoKuWLpHRkqfL0f0mOkkm+gg2cwYTh/uVwcwf2dkRETt+uthYwZA3EArakKdPJ1Z66wyYryo8SSZmNs8DMBa5n5QHs+17Z/tAu4lW50DQLw8vEYgLoh2hwgqXz0mwK821NZcOznowWnobkGnEsp854WOsjKw7H7seMXhXf3sHpDm2mcBp0DhiteOc1R+SSV5XsqGX/29WMW8dJTGZQKdV3yx+g8tEOz9zIExIKKTTCsB9jTUFfd6ldedzow+RIUiIJtPTXn/0IRWvoVcnjSiC+/YFm4zwH1QBYkw82z5MERSsvcN4DLEVKbG2yhEVszo8nHpxe0a1wnL0uokuIOTqlcFP/8zgnnabieygypDqOT2WJ9abK59k5h+lUmSOPjt5eShipUdsNyF65Q9f18TfvEtd7DmWFXhP3IjZqrx+RqOPogq6STt9ci2X2tDfqlWLi1QBjLYBPT9jegdgM7+uZJuDX6HTo0Fjr+U5Lq86jCuSsbzH67/g8n+zSrxypPZRfyajWf8Vlzf7XzPjEpW25siJjbNndfSEGaKCzLjc6y1SxvpsbyQIwFHzYy5vuEqE12wIyUJRL598TDuETQG8jMLP2kjgAi3U79qelh6beHBYeMrJSq1uObr7E5dOMuM9Ma4TqTVnMIiNTP+c+88z986HV8GQGkZ3lsKpgIKYzss77QTBaXNt0gdh3uz5wR7VPogH6sUqPu3IxMGkTKMfwEU7hjr6su2C79rSMaXxBWbtJ5lvR9jPHLgDNzcpNPAogN8svffgOAy+Wjhk+/HMcWTNJmJ1CEgr8m+imku+uO6nLLslqz3z2l7yv1l1o3UoHbE+RDNExC8hqYmygZzTzqFjP0iBPzRVlyFoFflrARgub8bvf2dsf33D4Woa8gEEF6aykJ1pFEPH57qbW7xtLQgGz+zEYNRAmiOdS809S1mRHZZ11mrkJweEdG2mjvrV6Gn9BoyRHOfaErtVBsVRggQ0fERy+u8kwIns7T8OHmGEIO7GmHw0ORU7WNGPb9wkf8HlA2rhBXLSiyJObIUopzMujev+4+LcJwqGZC1vuETn8aOAiXxpxBT1jvoKmgLp736AZogVOmH0PT7e/aV0l+FxvyzAU2jdtOcuE5o1AznvT+RniYOv0vRDVtDyguU3Z6UJrnCpsH12S9ni8n+z6gZznUCqwX1/OLZsI2+JXX7X+55xWcnyWV/0ZIgOA05BjGQg41K6Tl+lDfi9f9OwI4BvgxANRG8rb+2jHn8v1l9MIcLZBUuJkv9JuBLURbllzaXmkUxeIGhdoJxqUWfsd7w8XrGRcnDT3MXo23opVNL1/Hd6rpHME9x+MXI2vYnDQBhWREVg5UXrUxGpBChIXLhwRLKiFQeiSOGWS3rvL9hT8+v3ecc22+7uoSM1H/6YGY9fj2np606AoSjjMjxwuemsnHMaDowzMRSR40dPy4Qv6WlDnNAadEk32Qz4RFxex+YWFsGsHpJ5rjlf1t4AVdep0Lr7bkMlF2+Fi3YROnWDBN7Rwh41TxWTGsGzfjE1i4+EUtwhf5koeE9qKX0Zl6ZF4dKcv4jAjzZ6lVGq/+Hyq1H1G7lebSrVhIWMlYvPYmmNAwoeWMOYVnej24nxyPlxw2KxWW1uVcbld/yWdz6IDXk0bjUnWFa3xtt0PM78XEZgrsk0DZCY5XJL1Qcbt+EyaNqiAy0xUFY55BNYj095IaTzTq66bFr02UkYGww2wWb/U62MfctO0Cx0cNUhqRl6iIYECrGkBq+ZdElW85G29OcQgkzhHWu72UXN8Gy2mh+Os8+4RGPnCFHhxeNXZ1DDfErfSBRTvnRt7eHSO+d8Ns811oJ3iW+IfpS9uoCot4I4b2JLRcuTlMPNwZePBGhGOZrJUe2PeuxGV93aEqF5XCVUmZQPXF5vj8Quw85LV/Bi5POmVAWbW4Kt/+Dyq1FFmJ2rIxC+/lXJ/iilt02WyE1mU3E+5kuHsa2tvaBI8W7yVlm+JMhv6DemzJIXyPFldxMuT0CW7EkIXOiaG0OZSa/EUGA4VrozWKYoa8dj9SuAFkXH4G84IKyLOyyXCJjJk5xLGw41bHEd+wD6ZjNhe1R4G4/jH2sFlv1jXxCf/Fq6G6hY27betoa2KQZqVAQnRFTgfixqaKrPPDcP4nHkdidITnoKbN///jvwM7WGL3SUbiAY+DWJiz84dFvOUBN7rrse1d3wGZeqFaOzUM8o4GMZuwQa6xLbj8M4tn03ekFpVMq8biY3CHRXT3s1aTDv5C4SnPyBUD5lkS1p1g8qm9ZoSCdbCM4UyDmmN3vILRGm7Wss0BDla1GlmKhMAGzAWJ9J536S0izS+bRPfy1cmRvHrdZTM8F2TW5dO57BZXyfDJes5ivE2mE09jiMeiXDOSFXpDovlyFhIhWYMvD3mkWsyAxSAjvaDz4NwvdiyV8xUA389BND0sfY0ajoR3POFrb874ThqdHH1aNo4xZCTV79V+03YoDI43Xa5KbWvoGJXO2DaV2ZVkqa0lkEL6FoRFZkZUp2wW6XYi5+GxVGoS/6hrApJa84+eAfXO4cmvrhorGd26mMRdzVOeHSO/nLiAGLmUfOGZffoZEEahCjXh8iei5Dv4PevOulzka9a+kQxVZ1OZGI02Q37o6fDJUX6WrBNw7Kt5wvMy5pXaLyHor6bGzlU2R8Y7Fi83xmyqmez7llXDLxSAbml6KKvjAR0EItK5Qonltom7iahMDPIr8FozwYLiHAv5z2isQu45LufSLqnkPG5RKXSmo1zd8K4eFlzc3oEyoTbXWHpCNuQG5PFk2+I9B2aDEZdZ3IykpZYdBrurHf8zTT+qOB1K2sbknw0srn/V48k9Ia8cWPxL2sCfL9Y614yfRn5JGCelCs9JYjuIVGGVmtrtDFiMiUhBaWZ2aYKHRJ5gmXxugMF9sADjGhP0RETErCnUG809MXUi1K/auzflwwgtx3ux9u5z3MWiN5ZmK0ucBG0AcHyd7zDs8UFKinhyf8WrNhv/8wXDopzMxtFBMwtSru7qf0nXuKzOc5pNxalOmTElFmuyZbev0Zzoa40L+33g6KMse23Iz4HHGJcEvE1CM6QVoa+NeieoLuKQ198JD/o29PBx6ThFf72jPnyxjQ5OxpuydKhb2vmB6Mm0G0u9fIeGXv1mKpscT3uBd5qf4sk701lY8m8/TbNO6xDMxMlCWFMR29KxVZWX+2cRy2Rqhe5ySnJzO1UnBNP1qkUTx4OuvMNwQHfjNyBi1uw0AUJtQUXLqLdbLBhjQ4EIj3YvChufnWS3w0hPwH391/3++NNGjb7WEHFsvSaDQaPcn2kjcht+JnmZ8LzBL2xiH8zrh0VncMHk3CCwx7Diq0poSULKh2aY3H78yoZSCGCHI/rw0xvrfVgrEw4uxhrsy+iHbCpfHvI5BC0HPiqWU/+qpnrLwYoqt1JSPCL3G/DD2KUDuvkOd71w9LoEPCGqA1yD1//PpeAV59wprP5wkiNbE61eJooOviuOwrIS7y8DlCzngOr1zSaluU8nA16Dwdl0eib+tk8rmoNqeI7D5E0vyd3DXsARcZ8DRblaWJcFzOKS/DKvNpN/6K+idcHSMuzxY1PIW0HjvWBk/ramT1yBPqUmbtynHp9aUhN0/CFkFZFdY0Mztp6066tZGh1ruQuypeKJtFg6VTDDXynFvNz9KdwIPe7KLfJRKt7oc90n8HuuyBv8McCcUBm31iSY9VFAF+sG7wMG+rDfyCiV2+JpGjQw9hGJ70eJ0P3Ml+ZWRhrvP+pKLlz4Te18AZllmGiamcWFFY2Vc6v/IqLTcFlQXsRXOowv9de3VIo/RpMK+Acpp8rsbnvgVjShWulMaKtyczGa7MfSrERd8GxKjvN5CaeeNt4lteRLnNuPxcVMsLWoPBfTsoPJobvzQymQ5URpxQFB9auGQQubPOw/zcF8yLULtsT7YnA2pVWnTtOc5hMFfLFa0zR+ddk/tG3XOolnHvpZI/CNx0/Q8lgH0Le9EmwSrfquE5qrRflwqirrZN1mWVln2jHrf6J8o3vGJAPESgEq9DdVu1arm1ede/O2z7vFTbzhDfYgT390KgtlFRJFDh+qjGMf8GhmWNcioNl1vkTj+MwwzgH6PeOZK8YKM36FINB7+1uzSIo0GWX/nrN45DQ0ok0zVQJR0rZzH5h3EfUTDan6GHhZ3Yg47Ldb8PrTqYS4lirssEM9RKF5uAsd7nsJCdgXnJ1EdcQsdkI61XZSLQRsfhEaMDMkOPro266mK4VFaYhx67Jp+NakoH0POW0NPU2jrBNpuiO33CCah6gHkHD013iOX3/jBxLxkHgmG4LL56hgSdsmPM3lBqHE0OfIZtpbJPyeOQ/+ISyey1o+GSnmSAYKCz5TSgyMK5Ea72QrusOwkBJujpKUsEXaNcKa5UMevc+va+fwNQkt2j7jsdhlkUQRBCWJYHOGuVJoIAXSDR4uDVCJwX3rEMl7fBhUUuT+9/82WM66uenYudTTfCR/AiCrabrkYZrbvLK8jdYWfjUGE7sBYbMLLdGVDpOygMQvWbCHye26AxRj5z0RYFp6AWtyuJYFhHNIqOZ6VOQZpZ47lVmIeVeZUJiBF7jBX7YGZVLpEwo2Oca5fw4BQz6qoY+YeWbiQiKM6WNcCzHnw2qt8MlwQyaBabg4WXVSW7mN3ei3M6GyuwaxCV8kNfr7JIl/IqNbKT1PS60nHFGsB09SazfBA3/eUDIwmprUPqyQrUUyp25m4mAjWxYapr9/Aj012r5q1vxV9Uo9pVEtn7786VDlrLNQJXfjHTnBm2cSwBwbEsIulTN1kiX3gSLRjxcKKOs61ZaUHOMY/FXZMo3A1tZqEuzEGnNLeWuaajpGuk3LvLdBf5s3yVVmCL0r27/OTii1agNbSmVZi+yPvYMfyaI+zdZKqxNxX2RbJ8cka+dEAPPXi0Gvc96LtL/3goELTpRoB55nN1BvSno/pPwodLXOgCNZv6SwLHK4Et7bFq7PKysxwMXakXAQ9M0ektDVCjUkd8a5JoiRTXGYVbX/ZvFilDRBY3/T9mnTfFDBAXUX2xpuIH1nLzdqKeQ8WzRJR09e/kmkaqCiS1Fv/0d7uxng3xh5sryI0YhIEH0Er0sFc4IFUrReKyD+AV+//nFA8eucQ0yrmuVGE8ntgmSS+dfMykaunsLS+fkX2UY/xO1J/zMxKqZH/W72m1ZgqE7TrPQaQi+YIJvuG08jnqSzwQgQqFp8hke15eVVXgQ9vfE+m/JD3AHnpHj+xheSryMciQJQIqwR/hwP0lE+m9ywE9IqhQF+7WoEh8dOGZu3SQfivyhT+b5LYM9OBLk5rHeneqMWCIuT6+qywa8/X/Ez/aLeeKFcY8NeG6wlINWB2jfrOBinMwIEM3VyNiY2AmG6+/4TCILAYiAlqK1hpHcIm69IE2XlPJC76VCGl9ar3lT0kRanwF9oIup5MK8mDsmpwbjX5uHTVNS4PU/lqkjIrPz49o7YHKWVuyU0/TmVL6PxT5peZAfERP4zr6vofa3kIhN1RE91KRb+LY0DStzhcT7P5Uqf9nzcyNma3DThp2ZNgKSwQNy5U5jHLTzAt1fchSL0g8hL05Ifk232va9xaDRzoaGs/Kt7qCzBagmC8zrgy7IRrzVpGveHftM4j+pmZuXiryl/ruT3VFnXO92vqk6dambJMhYrnkHje9EeHNq/rp7XFEECdmLnGX+TRmOUIutwOyH38RgxNAss1wGIN5tTsr8dQM+kZ4Umu15CHyFDKXJLcU+e6RvT/VsIQs8V8I/X82CkbBcAMA9/sEFv6lky4AAAAASUVORK5CYII=";return 1==sdkInitRes.develop?0==(PF_INFO.develop_certificate_pkg||0)?t:"data:image/png;base64,"+e.substring(1,e.length):0==PF_INFO.release_certificate_pkg?t:"data:image/png;base64,"+e.substring(1,e.length)},t.prototype.openServer=function(e){var i=this;i.copyRightUrl=i.getCertificatePng();for(var n=function(){t.instance.m_server||(t.instance.m_server=new m(i.copyRightUrl)),t.instance.m_server.parent||t.instance.m_layer.addChild(t.instance.m_server),e&&e.skinUrl&&e.content&&t.instance.m_server.showAgeTipsBtn(e.show,e.skinUrl,e.content,e.x,e.y),t.instance.Wa()},r=!0,s=0,a=i.m_serverRes;s<a.length;s++){var o=a[s];if(null==Laya.Loader.getRes(o)){r=!1;break}}r?n():Laya.loader.load(i.m_serverRes,_.create(i,n))},t.prototype.closeServer=function(){this.m_server&&this.m_server.parent&&(Laya.stage.removeChild(this.m_server),this.m_server.destroy(!0),this.m_server=null)},t.prototype.preloadLoading=function(){this.m_isPrelodLoading||(this.m_isPrelodLoading=!0,Laya.loader.load(this.m_loadingRes,_.create(this,(function(){c.window.loadLoadingRes=!0,c.window.initMain(),c.window.enterToGame()}))))},t.prototype.openLoading=function(e,i){void 0===e&&(e=0),i=i||this.getCertificatePng(),Laya.loader.load(this.m_loadingRes,_.create(this,(function(){t.instance.m_loading||(t.instance.m_loading=new p(e,i)),t.instance.m_loading.parent||t.instance.m_layer.addChild(t.instance.m_loading),t.instance.Wa()})))},t.prototype.closeLoading=function(){this.m_loading&&this.m_loading.parent&&(Laya.stage.removeChild(this.m_loading),this.m_loading.destroy(!0),this.m_loading=null);for(var e=0,i=this.m_serverRes;e<i.length;e++){var n=i[e];Laya.Loader.clearCache(t.instance,n),Laya.Loader.clearRes(n,!0)}for(var r=0,s=this.m_loadingRes;r<s.length;r++)n=s[r],Laya.Loader.clearCache(t.instance,n),Laya.Loader.clearRes(n,!0);this.m_layer.parent&&this.m_layer.parent.removeChild(this.m_layer),this.removeNoise()},t.prototype.setShowBtn=function(){this.m_loading&&this.m_loading.parent&&t.instance.m_loading.showGetBtn()},t.prototype.enterDefaultServer=function(){var t=c.window.PF_INFO.selectedServer;this.Ka||(this.Ka=!0,c.window.PF_INFO.selectedServer=t,req_server_check_ban(0,t.server_id))},t.prototype.sendRecord=function(){var e="";e+="newRegister="+c.window.PF_INFO.newRegister,e+=", isPrelodServer="+this.m_isPrelodServer,e+=", SelectServerPanel="+(null!=t.instance.m_server),e+=", isPrelodLoading="+this.m_isPrelodLoading,e+=", LoadingPanel="+(null!=t.instance.m_loading),e+=", resMgrLoad="+(c.window.resMgrLoad==t.instance.requestWeb),e+=", imgMgrLoad="+(c.window.imgMgrLoad==t.instance.requestWeb),e+=", errUrls="+t.instance.La;for(var i=0,n=this.m_serverRes;i<n.length;i++)e+=", "+(a=n[i])+"="+(null!=Laya.Loader.getRes(a));for(var r=0,s=this.m_loadingRes;r<s.length;r++){var a;e+=", "+(a=s[r])+"="+(null!=Laya.Loader.getRes(a))}var o=c.window.PF_INFO.selectedServer;o&&(e+=", server_status="+o.status,e+=", server_id="+o.server_id,e+=", server_name="+o.server_name);var h=JSON.stringify({error:"初始界面超过10秒",stack:e});console.error(h),this.Xa&&this.Xa==e||(this.Xa=e,reqRecordError(h))},t.prototype.Ya=function(){var t=Laya.stage,e=Math.floor(t.width),i=Math.floor(t.height);i/e<1.7777778?(this.viewW=Math.floor(e/(i/1280)),this.viewH=1280,this.viewS=i/1280):(this.viewW=720,this.viewH=Math.floor(i/(e/720)),this.viewS=e/720);var n=Math.floor(t.width),r=Math.floor(t.height);r/n<1.7777778?(this.viewW=Math.floor(n/(r/1280)),this.viewH=1280,this.viewS=r/1280):(this.viewW=720,this.viewH=Math.floor(r/(n/720)),this.viewS=n/720),this.Wa()},t.prototype.Wa=function(){this.m_layer&&(this.m_layer.size(this.viewW,this.viewH),this.m_layer.scale(this.viewS,this.viewS,!0))},t.prototype.Ma=function(){if(u.isInputting&&c.onMobile){var t=parseInt(u.inputContainer.style.top.replace("px","")),e=parseInt(u.inputElement.style.height.replace("px",""))*this.viewS,i=c.clientWidth/d.canvas.width;return 0<(t=c.clientHeight-e*i-t)&&(t=0),void(c.container.style.top=t+"px")}c.container.style.top="0px";var n=Math.floor(c.width),r=Math.floor(c.height);n=n+1&2147483646,r=r+1&2147483646;var s=Laya.stage;3==ENV||r<n?(s.scaleMode=Laya.Stage.SCALE_NOSCALE,s.width=n,s.height=r):(s.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH,s.width=840,s.height=Math.floor(r/(n/840))+1&2147483646),this.Ya()},t.prototype.requestWeb=function(e,i){function n(){r.onload=null,r.onerror=null}var r,s=e;(r=new c.window.Image).onload=function(){n(),i(s,200,r)},r.onerror=function(){console.warn("[warn] WX loadImage onerror:",s),t.instance.La+=s+"|",n(),i(s,404,null)};var a=-1==s.indexOf("http")?t.instance.getURL(s):s;r.src=a,-1==t.instance.m_serverRes.indexOf(s)&&-1==t.instance.m_loadingRes.indexOf(s)||Laya.Loader.keepCache(t.instance,s)},t.prototype.Za=function(t,e){return-1!=t.indexOf(e,t.length-e.length)},t}();!function(t){var e,i;e=t.d||(t.d={}),i=function(t){function e(){var e=t.call(this)||this;return e.$a="#72441d",e._a="#263d7d",e.width=274,e.height=59,e.ab=new Laya.Image,e.addChild(e.ab),e.bb=new Laya.Label,e.bb.fontSize=30,e.bb.color=e._a,e.addChild(e.bb),e.bb.centerX=0,e.bb.centerY=0,e}return o(e,t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.w=c.window.PF_INFO,this.w.loadingType,this.addEvt()},Object.defineProperty(e.prototype,"dataSource",{set:function(t){t&&this.setData(t)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this.cb=t[0],this.db=t[1],this.bb.text=this.cb.title,this.bb.color=this.db?this.$a:this._a,this.ab.skin=this.db?"wxlogin_atlas/btn_com_long1.png":"wxlogin_atlas/btn_com_long0.png"},e.prototype.destroy=function(e){void 0===e&&(e=!0),this.rmEvts(),t.prototype.destroy.call(this,e)},e.prototype.addEvt=function(){},e.prototype.rmEvts=function(){},e}(Laya.View),e.NoticeItem=i}(l||(l={})),function(t){var e,i;e=t.d||(t.d={}),i=function(t){function e(){var e=t.call(this)||this;return e.$a="#72441d",e._a="#263d7d",e.width=274,e.height=59,e.ab=new Laya.Image,e.addChild(e.ab),e.bb=new Laya.Label,e.bb.fontSize=30,e.bb.color=e._a,e.addChild(e.bb),e.bb.centerX=0,e.bb.centerY=0,e}return o(e,t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.w=c.window.PF_INFO,this.w.loadingType,this.addEvt()},Object.defineProperty(e.prototype,"dataSource",{set:function(t){t&&this.setData(t)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this.eb=t[0],this.db=t[1],this.bb.text=this.eb,this.bb.color=this.db?this.$a:this._a,this.ab.skin=this.db?"wxlogin_atlas/btn_com_long1.png":"wxlogin_atlas/btn_com_long0.png"},e.prototype.destroy=function(e){void 0===e&&(e=!0),this.rmEvts(),t.prototype.destroy.call(this,e)},e.prototype.addEvt=function(){},e.prototype.rmEvts=function(){},e}(Laya.View),e.PrivacyItem=i}(l||(l={})),function(t){var e,i;e=t.d||(t.d={}),i=function(t){function e(){var e=t.call(this)||this;return e.width=192,e.height=70,e.ab=new Laya.Image,e.addChild(e.ab),e.fb=new Laya.Label,e.fb.fontSize=28,e.fb.color=e.R,e.addChild(e.fb),e.fb.centerX=0,e.fb.centerY=0,e.gb=new Laya.Label,e.gb.fontSize=22,e.gb.color=e.R,e.addChild(e.gb),e.gb.centerX=0,e.gb.y=11,e.hb=new Laya.Label,e.hb.fontSize=26,e.hb.color=e.R,e.addChild(e.hb),e.hb.centerX=0,e.hb.y=39,e}return o(e,t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.w=c.window.PF_INFO;var e=this.w.loadingType;this.R=1==e||2==e?"#263d7d":3==e?"#763042":"#263d7d",this.addEvt()},Object.defineProperty(e.prototype,"dataSource",{set:function(t){t&&this.setData(t)},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this.cb=t;var e=this.cb.id,i=this.cb.name;if(this.fb.visible=this.gb.visible=this.hb.visible=!1,-1==e||-2==e)this.fb.visible=!0,this.fb.text=i;else{var n=i,r="1-10服",s=i.match("[0-9]{1,}");s&&null!=s.index&&(n=i.slice(0,s.index),r=i.slice(s.index)),this.gb.visible=this.hb.visible=!0,this.gb.text=n,this.hb.text=r}this.ab.skin=t.select?"wxlogin_atlas/btn_xuanqu_anniuhuang.png":"wxlogin_atlas/btn_xuanqu_anniulan.png"},e.prototype.destroy=function(e){void 0===e&&(e=!0),this.rmEvts(),t.prototype.destroy.call(this,e)},e.prototype.addEvt=function(){this.on(Laya.Event.MOUSE_UP,this,this.clkHdler)},e.prototype.rmEvts=function(){this.off(Laya.Event.MOUSE_UP,this,this.clkHdler)},e.prototype.clkHdler=function(){this.cb&&this.cb.callBack&&this.cb.callBack(this.cb.index)},e}(Laya.View),e.SelectLeftListItem=i}(l||(l={})),function(t){var e,i;e=t.d||(t.d={}),i=function(t){function i(){var e=t.call(this)||this;return e.width=358,e.height=70,e.ab=new Laya.Image("wxlogin_atlas/btn_xuanqu_quanniu.png"),e.addChild(e.ab),e.ab.graphics.drawRect(0,0,e.width,e.height,"#00sasd"),e.ib=new Laya.Image,e.ib.centerY=0,e.ib.x=7,e.addChild(e.ib),e.fb=new Laya.Label,e.fb.fontSize=24,e.fb.color=e.R,e.fb.x=56,e.fb.centerY=0,e.addChild(e.fb),e.jb=new Laya.Label,e.jb.fontSize=24,e.jb.color=e.R,e.jb.x=246,e.jb.centerY=0,e.addChild(e.jb),e.kb=new Laya.Image,e.kb.top=0,e.kb.right=0,e.addChild(e.kb),e.lb=new Laya.Label,e.lb.fontSize=20,e.lb.color="#ffffff",e.lb.x=225,e.lb.y=46,e.addChild(e.lb),e}return o(i,t),i.prototype.initialize=function(){t.prototype.initialize.call(this),this.w=c.window.PF_INFO;var e=this.w.loadingType;this.R=1==e||2==e?"#34267d":3==e?"#763042":"#34267d",this.addEvt()},Object.defineProperty(i.prototype,"dataSource",{set:function(t){t&&this.setData(t)},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){this.cb=t;var i=this.cb.status,n=this.cb.server_name;this.ib.skin=e.CommonFunc.getStatusSrc(this.cb),this.fb.color=e.CommonFunc.getStatusTxtColor(i,this.R),this.fb.text=e.CommonFunc.getPreAddStr()+n,this.jb.text=e.CommonFunc.getStatusAddStr2(this.cb);var r=e.CommonFunc.isRecommend(this.cb.is_recommend);(this.kb.visible=r)&&(this.kb.skin="wxlogin_atlas/image_xuanqu_ztjb0.png"),this.lb.text=-1==this.cb.status&&this.cb.maintain_time?this.cb.maintain_time:""},i.prototype.destroy=function(e){void 0===e&&(e=!0),this.rmEvts(),t.prototype.destroy.call(this,e)},i.prototype.addEvt=function(){this.on(Laya.Event.MOUSE_UP,this,this.clkHdler)},i.prototype.rmEvts=function(){this.off(Laya.Event.MOUSE_UP,this,this.clkHdler)},i.prototype.clkHdler=function(){this.cb&&this.cb.callBack&&this.cb.callBack(this.cb)},i}(Laya.View),e.SelectRightListItem=i}(l||(l={})),function(t){var e,i,n;e=t.Ra||(t.Ra={}),i=Laya.BaseMaterial,n=function(t){function e(){var e=t.call(this)||this;return e.setShaderName("noise_shader_1"),e.blend=i.BLEND_ENABLE_ALL,e.blendEquation=i.BLENDEQUATION_ADD,e.srcBlend=i.BLENDPARAM_SRC_ALPHA,e.dstBlend=i.BLENDPARAM_ONE,e.renderQueue=i.RENDERQUEUE_TRANSPARENT,e.depthWrite=!1,e.depthTest=i.DEPTHTEST_ALWAYS,e.completeCreate(),e}return o(e,t),Object.defineProperty(e.prototype,"randomSeed",{get:function(){return this._getNumber(23)},set:function(t){this._setNumber(23,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grainSizeX",{get:function(){return this._getNumber(24)},set:function(t){this._setNumber(24,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grainSizeY",{get:function(){return this._getNumber(25)},set:function(t){this._setNumber(25,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intensity",{get:function(){return this._getNumber(26)},set:function(t){this._setNumber(26,t)},enumerable:!0,configurable:!0}),e.init=function(){Laya.ShaderCompile3D.add(Laya.Shader3D.nameKey.add("noise_shader_1"),"attribute vec4 a_Position;\nattribute vec2 a_Texcoord0; \nuniform mat4 u_MvpMatrix;\nvarying vec2 v_Texcoord;\nvoid main(){\n  gl_Position = u_MvpMatrix * a_Position;\n  v_Texcoord = a_Texcoord0;\n}","#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform float u_randomSeed;\nuniform float u_grainSizeX;\nuniform float u_grainSizeY;\nuniform float u_intensity;\nvarying vec2 v_Texcoord;\nvoid main(){\n  vec2 magicVec2 = vec2(0.0041,0.0111);\n  float magicNum = 2747.0;\n  float uvX = floor(v_Texcoord.x/u_grainSizeX)*u_grainSizeX;\n  float uvY = floor(v_Texcoord.y/u_grainSizeY)*u_grainSizeY;\n  float uvValue = uvX + uvY;\n  float seed1 = fract(uvValue*u_randomSeed*magicNum*magicVec2.x + magicVec2.y);\n  float seed2 = fract(seed1*magicNum*magicVec2.x + magicVec2.y);\n  float seed3 = fract(seed2*magicNum*magicVec2.x + magicVec2.y);\n  float seedr = fract(seed3*magicNum*magicVec2.x + magicVec2.y);\n  float seedg = fract(seedr*magicNum*magicVec2.x + magicVec2.y);\n  float seedb = fract(seedg*magicNum*magicVec2.x + magicVec2.y);\n  gl_FragColor = vec4(seedr,seedg,seedb,u_intensity);\n}",{a_Position:Laya.VertexElementUsage.POSITION0,a_Texcoord0:Laya.VertexElementUsage.TEXTURECOORDINATE0},{u_MvpMatrix:[Laya.Sprite3D.MVPMATRIX,Laya.Shader3D.PERIOD_SPRITE],u_randomSeed:[23,Laya.Shader3D.PERIOD_MATERIAL],u_grainSizeX:[24,Laya.Shader3D.PERIOD_MATERIAL],u_grainSizeY:[25,Laya.Shader3D.PERIOD_MATERIAL],u_intensity:[26,Laya.Shader3D.PERIOD_MATERIAL]})},e}(Laya.BaseMaterial),e.Qa=n}(l||(l={})),window.ServerLoading=g},function(t,e){t.exports=require("protobuf/game.js")},function(t,e){t.exports=require("subPackage/game.js")}]);