var Laya=window.Laya=function($K,$m){var $D={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($m,$p){return 1==arguments.length?$D.__presubstr.call(this,$m):$D.__presubstr.call(this,$m,0<$p?$p:this.length+$p);},__init:function($m){$m.forEach(function($m){$m.__init$&&$m.__init$();});},__isClass:function($m){return $m&&($m.__isclass||$m==Object||$m==String||$m==Array);},__newvec:function($m,$p){var $h=[];$h.length=$m;for(var $P=0;$P<$m;$P++)$h[$P]=$p;return $h;},__extend:function($m,$p){for(var $h in $p)if($p.hasOwnProperty($h)){var $P=Object.getOwnPropertyDescriptor($p,$h),$L=$P.get,$q=$P.set;$L||$q?$L&&$q?Object.defineProperty($m,$h,$P):($L&&Object.defineProperty($m,$h,$L),$q&&Object.defineProperty($m,$h,$q)):$m[$h]=$p[$h];}function $k(){$D.un(this,"constructor",$m);}$k.prototype=$p.prototype,$m.prototype=new $k(),$D.un($m.prototype,"__imps",$D.__copy({},$p.prototype.__imps));},__copy:function($m,$p){if(!$p)return null;for(var $h in $m=$m||{},$p)$m[$h]=$p[$h];return $m;},__package:function($m,$p){if(!$D.__packages[$m]){$D.__packages[$m]=!0;var $h=$K,$P=$m.split(".");if(1<$P.length)for(var $L=0,$q=$P.length-1;$L<$q;$L++){var $k=$h[$P[$L]];$h=$k||($h[$P[$L]]={});}$h[$P[$P.length-1]]||($h[$P[$P.length-1]]=$p||{});}},__hasOwnProperty:function($m,$p){return $p=$p||this,Object.hasOwnProperty.call($p,$m)||function $m($p,$h){if(Object.hasOwnProperty.call($h.prototype,$p))return!0;var $P=$h.prototype.__super;return null==$P?null:$m($p,$P);}($m,$p.__class);},__typeof:function($m,$p){if(!$m||!$p)return!1;if($p===String)return"string"==typeof $m;if($p===Number)return"number"==typeof $m;if($p.__interface__)$p=$p.__interface__;else if("string"!=typeof $p)return $m instanceof $p;return $m.__imps&&$m.__imps[$p]||$m.__class==$p;},__as:function($m,$p){return this.__typeof($m,$p)?$m:null;},__int:function($m){return $m?parseInt($m):0;},interface:function($m,$p){$D.__package($m,{});var $h=$D.__internals,$P=$h[$m]=$h[$m]||{self:$m};if($p){var $L=$p.split(",");$P.extend=[];for(var $q=0;$q<$L.length;$q++){var $k=$L[$q];$h[$k]=$h[$k]||{self:$k},$P.extend.push($h[$k]);}}var $Y=$K,$d=$m.split(".");for($q=0;$q<$d.length-1;$q++)$Y=$Y[$d[$q]];$Y[$d[$d.length-1]]={__interface__:$m};},class:function($m,$p,$h,$P){if($h&&$D.__extend($m,$h),$p)if($D.__package($p,$m),$D.__classmap[$p]=$m,0<$p.indexOf(".")){if(0==$p.indexOf("laya.")){var $L=$p.split(".");$P=$P||$L[$L.length-1],$D[$P]&&console.log("Warning!,this class["+$P+"] already exist:",$D[$P]),$D[$P]=$m;}}else"Main"==$p?$K.Main=$m:"MainWX"==$p?$K.MainWX=$m:($D[$p]&&console.log("Error!,this class["+$p+"] already exist:",$D[$p]),$D[$p]=$m);var $q=$D.un,$k=$m.prototype;$q($k,"hasOwnProperty",$D.__hasOwnProperty),$q($k,"__class",$m),$q($k,"__super",$h),$q($k,"__className",$p),$q($m,"__super",$h),$q($m,"__className",$p),$q($m,"__isclass",!0),$q($m,"super",function($m){this.__super.call($m);});},imps:function($m,$p){if(!$p)return null;var $L=$m.__imps||$D.un($m,"__imps",{});function $q($m){var $p,$h;if(($p=$D.__internals[$m])&&($L[$m]=!0,$h=$p.extend))for(var $P=0;$P<$h.length;$P++)$q($h[$P].self);}for(var $h in $p)$q($h);},superSet:function($m,$p,$h,$P){var $L=$m.prototype["_$set_"+$h];$L&&$L.call($p,$P);},superGet:function($m,$p,$h){var $P=$m.prototype["_$get_"+$h];return $P?$P.call($p):null;},getset:function($m,$p,$h,$P,$L){$m?($P&&($p["_$GET_"+$h]=$P),$L&&($p["_$SET_"+$h]=$L)):($P&&$D.un($p,"_$get_"+$h,$P),$L&&$D.un($p,"_$set_"+$h,$L)),$P&&$L?Object.defineProperty($p,$h,{get:$P,set:$L,enumerable:!1,configurable:!0}):($P&&Object.defineProperty($p,$h,{get:$P,enumerable:!1,configurable:!0}),$L&&Object.defineProperty($p,$h,{set:$L,enumerable:!1,configurable:!0}));},static:function($h,$P){for(var $L=0,$m=$P.length;$L<$m;$L+=2)if("length"==$P[$L])$h.length=$P[$L+1].call($h);else{function $p(){var $p=$P[$L],$m=$P[$L+1];Object.defineProperty($h,$p,{get:function(){return delete this[$p],this[$p]=$m.call(this);},set:function($m){delete this[$p],this[$p]=$m;},enumerable:!0,configurable:!0});}$p();}},un:function($m,$p,$h){return $h||($h=$m[$p]),$D.__propun.value=$h,Object.defineProperty($m,$p,$D.__propun),$h;},uns:function($p,$m){$m.forEach(function($m){$D.un($p,$m);});}};return $K.console=$K.console||{log:function(){}},$K.trace=$K.console.log,Error.prototype.throwError=function(){throw arguments;},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$D;}(window,document);!function($m,$p,$h){$h.un,$h.uns,$h.static,$h.class,$h.getset,$h.__newvec;}(window,document,Laya),function($k,$p,$E){$E.un,$E.uns;var $d=$E.static,$B=$E.class,$D=$E.getset;$E.__newvec;$E.interface("laya.runtime.IMarket"),$E.interface("laya.filters.IFilter"),$E.interface("laya.display.ILayout"),$E.interface("laya.resource.IDispose"),$E.interface("laya.runtime.IPlatform"),$E.interface("laya.resource.IDestroy"),$E.interface("laya.runtime.IConchNode"),$E.interface("laya.filters.IFilterAction"),$E.interface("laya.runtime.ICPlatformClass"),$E.interface("laya.resource.ICreateResource"),$E.interface("laya.runtime.IConchRenderObject"),$E.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $Q=function(){function $q(){}return $B($q,"laya.utils.RunDriver"),$q.FILTER_ACTIONS=[],$q.pixelRatio=-1,$q._charSizeTestDiv=null,$q.now=function(){return Date.now();},$q.getWindow=function(){return $k;},$q.getPixelRatio=function(){if($q.pixelRatio<0){var $m=$w.context,$p=$m.backingStorePixelRatio||$m.webkitBackingStorePixelRatio||$m.mozBackingStorePixelRatio||$m.msBackingStorePixelRatio||$m.oBackingStorePixelRatio||$m.backingStorePixelRatio||1;($q.pixelRatio=($w.window.devicePixelRatio||1)/$p)<1&&($q.pixelRatio=1);}return $q.pixelRatio;},$q.getIncludeStr=function($m){return null;},$q.createShaderCondition=function($m){var $p="(function() {return "+$m+";})";return $E._runScript($p);},$q.fontMap=[],$q.measureText=function($m,$p){var $h=$q.hanzi.test($m);if($h&&$q.fontMap[$p])return $q.fontMap[$p];var $P=$w.context;$P.font=$p;var $L=$P.measureText($m);return $L||($L={width:16,height:16}),$h&&($q.fontMap[$p]=$L),$L;},$q.getWebGLContext=function($m){},$q.beginFlush=function(){},$q.endFinish=function(){},$q.addToAtlas=null,$q.flashFlushImage=function($m){},$q.drawToCanvas=function($m,$p,$h,$P,$L,$q){var $k=$am.create("2D"),$Y=new $_($h,$P,$k);return $l.renders[$p]._fun($m,$Y,$L,$q),$k;},$q.createParticleTemplate2D=null,$q.createGLTextur=null,$q.createWebGLContext2D=null,$q.changeWebGLSize=function($m,$p){},$q.createRenderSprite=function($m,$p){return new $l($m,$p);},$q.createFilterAction=function($m){return new $a();},$q.createGraphics=function(){return new $R();},$q.clear=function($m){$S._context.ctx.clear();},$q.cancelLoadByUrl=function($m){},$q.clearAtlas=function($m){},$q.isAtlas=function($m){return!1;},$q.addTextureToAtlas=function($m){},$q.getTexturePixels=function($m,$p,$h,$P,$L){return null;},$q.skinAniSprite=function(){return null;},$q.update3DLoop=function(){},$d($q,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$");}]),$q;}(),$P=($D(1,$E,"alertGlobalError",null,function($m){var $q=0;$w.window.onerror=$m?function($m,$p,$h,$P,$L){$q++<5&&$L&&alert($L.stack||$L);}:null;}),$E.init=function($m,$p,$h){for(var $P=[],$L=2,$q=arguments.length;$L<$q;$L++)$P.push(arguments[$L]);if(!$E._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$E._arrayBufferSlice),$E._isinit=!0,$w.__init__(),$J.__init__(),$R.__init__(),$E.timer=new $i(),$E.scaleTimer=new $i(),$E.loader=new $dm(),$O.__init__(),$L=0;for(var $k=$P.length;$L<$k;$L++)$P[$L].enable&&$P[$L].enable();return $$.__init__(),$Y.__init__(),$z.__init__(),$s.beginCheck(),$E._currentStage=$E.stage=new $cm(),$E.stage.conchModel&&$E.stage.conchModel.setRootNode(),$E._getUrlPath(),$E.render=new $S(0,0),$E.stage.size($m,$p),$l.__init__(),$F.__init__(),$A.instance.__init__($E.stage,$S.canvas),$Hm.__init__(),$x.autoStopMusic=!0,$T.__init__(),$S.canvas;}},$E._getUrlPath=function(){var $m=$w.window.location,$p=$m.pathname;$p=$p&&":"==$p.charAt(2)?$p.substring(1):$p,$N.rootPath=$N.basePath=$N.getPath("file:"==$m.protocol?$p:$m.protocol+"//"+$m.host+$m.pathname);},$E._arrayBufferSlice=function($m,$p){var $h=new Uint8Array(this,$m,$p-$m),$P=new Uint8Array($h.length);return $P.set($h),$P.buffer;},$E._runScript=function($m){return $w.window[$E._evcode]($m);},$E.stage=null,$E.timer=null,$E.scaleTimer=null,$E.loader=null,$E.version="1.8.6",$E.render=null,$E._currentStage=null,$E._isinit=!1,$E.isDebug=!1,$E.MiniAdpter={init:function(){$k.navigator&&$k.navigator.userAgent&&-1<$k.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0");}},$d($E,["conchMarket",function(){return this.conchMarket=$k.conch?conchMarket:null;},"PlatformClass",function(){return this.PlatformClass=$k.PlatformClass;},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al";}]),function(){function $m(){}return $B($m,"Config"),$m.WebGLTextCacheCount=500,$m.atlasEnable=!1,$m.showCanvasMark=!1,$m.animationInterval=50,$m.isAntialias=!1,$m.isAlpha=!1,$m.premultipliedAlpha=!0,$m.isStencil=!0,$m.preserveDrawingBuffer=!1,$m;}()),$K=function(){function $K(){this._events=null;}$B($K,"laya.events.EventDispatcher");var $m=$K.prototype;return $m.hasListener=function($m){return!!(this._events&&this._events[$m]);},$m.getListener=function($m){return this._events?this._events[$m]:null;},$m.event=function($m,$p){if(!this._events||!this._events[$m])return!1;var $h=this._events[$m];if($h.lock)$h.queue||($h.queue=[]),$h.queue.push($p);else{var $P;for($h.lock=!0,$h.cursor=$h.head;$h.cursor;)($P=$h.cursor).recover?($h.head=$h.tail=$h.cursor=null,console.error("node is recover："+$P.id)):($h.cursor=$P.next,$P.once&&$K.delNode($h,$P),$P.method&&(null!=$p?$P.args?$P.method.apply($P.caller,$P.args.concat($p)):$p instanceof Array?$P.method.apply($P.caller,$p):$P.caller?$P.method.call($P.caller,$p):$E.recordError("事件派发错误","node.caller:"+$P.caller+"node.method:"+$P.method+"data:"+$p+"node.prev"+$P.prev):$P.method.apply($P.caller,$P.args)),$P.once&&$K.recoverHandler($P));$h.lock=!1,!$h.head&&this._events&&this._events[$m]==$h&&delete this._events[$m],$h.queue&&$h.queue.length&&this.event($m,$h.queue.shift());}return!0;},$m.on=function($m,$p,$h,$P){return this._createListener($m,$p,$h,$P,!1);},$m.once=function($m,$p,$h,$P){return this._createListener($m,$p,$h,$P,!0);},$m._createListener=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=!0),$q&&this.off($m,$p,$h,$L);var $k=$K.createHandler($p||this,$h,$P,$L);this._events||(this._events={});var $Y=this._events,$d=$Y[$m];return $d?$d.tail?($k.prev=$d.tail,$d.tail.next=$k,$d.tail=$k):$d.head=$d.tail=$k:$Y[$m]={head:$k,tail:$k,cursor:null,lock:!1},this;},$m.off=function($m,$p,$h,$P){if(void 0===$P&&($P=!1),!this._events||!this._events[$m])return this;for(var $L=this._events[$m],$q=$L.head;$q;){if((!$p||$q.caller===$p)&&$q.method===$h&&(!$P||$q.once)){$K.delNode($L,$q),$L.cursor==$q&&($L.cursor=$q.next),$K.recoverHandler($q);break;}$q=$q.next;}return this;},$m.offAll=function($m){var $p=this._events;if(!$p)return this;if($m)this._recoverHandlers($p[$m]),delete $p[$m];else{for(var $h in $p)this._recoverHandlers($p[$h]);this._events=null;}return this;},$m._recoverHandlers=function($m){if($m){for(var $p=$m.head;$p;){$K.delNode($m,$p);var $h=$p.next;$K.recoverHandler($p),$p=$h;}$m.cursor=null;}},$m.isMouseEvent=function($m){return $K.MOUSE_EVENTS[$m];},$K.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$K.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0});},$K.delNode=function($m,$p){$p.prev?$p.prev.next=$p.next:$m.head=$p.next,$p.next?$p.next.prev=$p.prev:$m.tail=$p.prev;},$K.createHandler=function($m,$p,$h,$P){var $L=500<$K._freeHandler.length?$K._freeHandler.shift():null;if($L){if($L.recover)$L.recover=!1,$L.caller=$m,$L.method=$p,$L.args=$h,$L.once=$P;else{var $q="";try{arguments.propertyIsEnumerable.caller;}catch($m){$q=$m.stack;}var $k=$L.caller?($L.caller.__proto__&&$L.caller.__proto__.constructor&&$L.caller.__proto__.constructor.name)+"|"+$L.caller.__className+"|"+$L.caller.name:"",$Y=$L.method?$L.method.name:"";$E.recordError("EventDispatcher重复创建","caller="+$k+"  method="+$Y+"  stack="+$q),$L={id:++$K._nodeCount,caller:$m,method:$p,args:$h,once:$P,recover:!1};}}else $L={id:++$K._nodeCount,caller:$m,method:$p,args:$h,once:$P,recover:!1};return $L.prev=$L.next=null,$L;},$K.recoverHandler=function($m){if($m.recover){if($K._errorCount<5){$K._errorCount++;var $p="";try{arguments.propertyIsEnumerable.caller;}catch($m){$p=$m.stack;}var $h=$m.caller?($m.caller.__proto__&&$m.caller.__proto__.constructor&&$m.caller.__proto__.constructor.name)+"|"+$m.caller.__className+"|"+$m.caller.name:"",$P=$m.method?$m.method.name:"";$E.recordError("EventDispatcher重复回收","id="+$m.id+"  caller="+$h+"  method="+$P+"  stack="+$p);}$m.caller=$m.method=$m.args=$m.prev=null;}else $m.recover=!0,$m.caller=$m.method=$m.args=$m.prev=$m.next=null,$K._freeHandler&&$K._freeHandler.length<3e3&&$K._freeHandler.push($m);},$K._freeHandler=[],$K._nodeCount=0,$K._errorCount=0,$K;}(),$e=function(){function $L($m,$p,$h,$P){this.once=!1,void(this._id=0)===$P&&($P=!1),this.setTo($m,$p,$h,$P);}$B($L,"laya.utils.Handler");var $m=$L.prototype;return $m.setTo=function($m,$p,$h,$P){return this._id=$L._gid++,this.caller=$m,this.method=$p,this.args=$h,this.once=$P,this;},$m.run=function(){if(null==this.method)return null;var $m=this._id,$p=this.method.apply(this.caller,this.args);return this._id===$m&&this.once&&this.recover(),$p;},$m.runWith=function($m){if(null==this.method)return null;var $p=this._id;if(null==$m)var $h=this.method.apply(this.caller,this.args);else $h=this.args||$m.unshift?this.args?this.method.apply(this.caller,this.args.concat($m)):this.method.apply(this.caller,$m):this.method.call(this.caller,$m);return this._id===$p&&this.once&&this.recover(),$h;},$m.clear=function(){return this.caller=null,this.method=null,this.args=null,this;},$m.recover=function(){0<this._id&&(this._id=0,this.clear());},$L.create=function($m,$p,$h,$P){return void 0===$P&&($P=!0),new $L($m,$p,$h,$P);},$L._gid=1,$L;}(),$j=function(){function $m(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0;}$B($m,"laya.display.BitmapFont");var $p=$m.prototype;return $p.loadFont=function($m,$p){this._path=$m,this._complete=$p,$E.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$e.create(this,this.onLoaded));},$p.onLoaded=function(){this.parseFont($Ym.getRes(this._path),$Ym.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null);},$p.parseFont=function($m,$p){if(null!=$m&&null!=$p){this._texture=$p;var $h=$m.getElementsByTagName("info");if(!$h[0].getAttributeNode)return this.parseFont2($m,$p);this.fontSize=parseInt($h[0].getAttributeNode("size").nodeValue);var $P,$L=$h[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($L[0]),parseInt($L[1]),parseInt($L[2]),parseInt($L[3])],$P=$m.getElementsByTagName("char");var $q=0;for($q=0;$q<$P.length;$q++){var $k=$P[$q],$Y=parseInt($k.getAttributeNode("id").nodeValue),$d=parseInt($k.getAttributeNode("xoffset").nodeValue)/1,$K=parseInt($k.getAttributeNode("yoffset").nodeValue)/1,$D=parseInt($k.getAttributeNode("xadvance").nodeValue)/1,$F=new $b();$F.x=parseInt($k.getAttributeNode("x").nodeValue),$F.y=parseInt($k.getAttributeNode("y").nodeValue),$F.width=parseInt($k.getAttributeNode("width").nodeValue),$F.height=parseInt($k.getAttributeNode("height").nodeValue);var $R=$Dm.create($p,$F.x,$F.y,$F.width,$F.height,$d,$K);this._maxWidth=Math.max(this._maxWidth,$D+this.letterSpacing),this._fontCharDic[$Y]=$R,this._fontWidthMap[$Y]=$D;}}},$p.parseFont2=function($m,$p){if(null!=$m&&null!=$p){this._texture=$p;var $h=$m.getElementsByTagName("info");this.fontSize=parseInt($h[0].attributes.size.nodeValue);var $P=$h[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($P[0]),parseInt($P[1]),parseInt($P[2]),parseInt($P[3])];var $L=$m.getElementsByTagName("char"),$q=0;for($q=0;$q<$L.length;$q++){var $k=$L[$q].attributes,$Y=parseInt($k.id.nodeValue),$d=parseInt($k.xoffset.nodeValue)/1,$K=parseInt($k.yoffset.nodeValue)/1,$D=parseInt($k.xadvance.nodeValue)/1,$F=new $b();$F.x=parseInt($k.x.nodeValue),$F.y=parseInt($k.y.nodeValue),$F.width=parseInt($k.width.nodeValue),$F.height=parseInt($k.height.nodeValue);var $R=$Dm.create($p,$F.x,$F.y,$F.width,$F.height,$d,$K);this._maxWidth=Math.max(this._maxWidth,$D+this.letterSpacing),this._fontCharDic[$Y]=$R,this._fontWidthMap[$Y]=$D;}}},$p.getCharTexture=function($m){return this._fontCharDic[$m.charCodeAt(0)];},$p.destroy=function(){if(this._texture){for(var $m in this._fontCharDic){var $p=this._fontCharDic[$m];$p&&$p.destroy();}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null;}},$p.setSpaceWidth=function($m){this._spaceWidth=$m;},$p.getCharWidth=function($m){var $p=$m.charCodeAt(0);return this._fontWidthMap[$p]?this._fontWidthMap[$p]+this.letterSpacing:" "==$m?this._spaceWidth+this.letterSpacing:0;},$p.getTextWidth=function($m){for(var $p=0,$h=0,$P=$m.length;$h<$P;$h++)$p+=this.getCharWidth($m.charAt($h));return $p;},$p.getMaxWidth=function(){return this._maxWidth;},$p.getMaxHeight=function(){return this.fontSize;},$p.drawText=function($m,$p,$h,$P,$L,$q){var $k,$Y=this.getTextWidth($m),$d=0;"center"===$L&&($d=($q-$Y)/2),"right"===$L&&($d=$q-$Y);for(var $K=0,$D=0,$F=$m.length;$D<$F;$D++)($k=this.getCharTexture($m.charAt($D)))&&($p.graphics.drawTexture($k,$h+$K+$d,$P),$K+=this.getCharWidth($m.charAt($D)));},$m;}(),$Y=function(){function $h(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$h._TF_EMPTY;}$B($h,"laya.display.css.Style");var $m=$h.prototype;return $m.getTransform=function(){return this._tf;},$m.setTransform=function($m){this._tf="none"!==$m&&$m?$m:$h._TF_EMPTY;},$m.setTranslateX=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.translateX=$m;},$m.setTranslateY=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.translateY=$m;},$m.setScaleX=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.scaleX=$m;},$m.setScale=function($m,$p){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.scaleX=$m,this._tf.scaleY=$p;},$m.setScaleY=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.scaleY=$m;},$m.setRotate=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.rotate=$m;},$m.setSkewX=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.skewX=$m;},$m.setSkewY=function($m){this._tf===$h._TF_EMPTY&&(this._tf=new $L()),this._tf.skewY=$m;},$m.destroy=function(){this.scrollRect=null;},$m.render=function($m,$p,$h,$P){},$m.getCSSStyle=function(){return $pm.EMPTY;},$m._enableLayout=function(){return!1;},$D(0,$m,"scaleX",function(){return this._tf.scaleX;},function($m){this.setScaleX($m);}),$D(0,$m,"transform",function(){return this.getTransform();},function($m){this.setTransform($m);}),$D(0,$m,"translateX",function(){return this._tf.translateX;},function($m){this.setTranslateX($m);}),$D(0,$m,"translateY",function(){return this._tf.translateY;},function($m){this.setTranslateY($m);}),$D(0,$m,"scaleY",function(){return this._tf.scaleY;},function($m){this.setScaleY($m);}),$D(0,$m,"block",function(){return 0!=(1&this._type);}),$D(0,$m,"skewY",function(){return this._tf.skewY;},function($m){this.setSkewY($m);}),$D(0,$m,"rotate",function(){return this._tf.rotate;},function($m){this.setRotate($m);}),$D(0,$m,"skewX",function(){return this._tf.skewX;},function($m){this.setSkewX($m);}),$D(0,$m,"paddingLeft",function(){return 0;}),$D(0,$m,"paddingTop",function(){return 0;}),$D(0,$m,"absolute",function(){return!0;}),$h.__init__=function(){$h._TF_EMPTY=new $L(),$h.EMPTY=new $h();},$h.EMPTY=null,$h._TF_EMPTY=null,$h;}(),$$=function(){function $p($m){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$U.create($p.defaultColor),this.family=$p.defaultFamily,this.stroke=$p._STROKE,this.size=$p.defaultSize,$m&&$m!==$p.EMPTY&&$m.copyTo(this);}$B($p,"laya.display.css.Font");var $m=$p.prototype;return $m.set=function($m){this._text=null;for(var $p=$m.split(" "),$h=0,$P=$p.length;$h<$P;$h++){var $L=$p[$h];switch($L){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue;}0<$L.indexOf("px")&&(this.size=parseInt($L),this.family=$p[$h+1],$h++);}},$m.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family;},$m.copyTo=function($m){$m._type=this._type,$m._text=this._text,$m._weight=this._weight,$m._color=this._color,$m.family=this.family,$m.stroke=this.stroke!=$p._STROKE?this.stroke.slice():$p._STROKE,$m.indent=this.indent,$m.size=this.size;},$D(0,$m,"password",function(){return 0!=(1024&this._type);},function($m){$m?this._type|=1024:this._type&=-1025;}),$D(0,$m,"color",function(){return this._color.strColor;},function($m){this._color=$U.create($m);}),$D(0,$m,"italic",function(){return 0!=(512&this._type);},function($m){$m?this._type|=512:this._type&=-513;}),$D(0,$m,"bold",function(){return 0!=(2048&this._type);},function($m){$m?this._type|=2048:this._type&=-2049;}),$D(0,$m,"weight",function(){return""+this._weight;},function($m){var $p=0;switch($m){case"normal":break;case"bold":this.bold=!0,$p=700;break;case"bolder":$p=800;break;case"lighter":$p=100;break;default:$p=parseInt($m);}this._weight=$p,this._text=null;}),$D(0,$m,"decoration",function(){return this._decoration?this._decoration.value:null;},function($m){var $p=$m.split(" ");switch(this._decoration||(this._decoration={}),$p[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$p[0];}$p[1]&&(this._decoration.color=$U.create($p)),this._decoration.value=$m;}),$p.__init__=function(){$p.EMPTY=new $p(null);},$p.EMPTY=null,$p.defaultColor="#000000",$p.defaultSize=12,$p.defaultFamily="Arial",$p.defaultFont="12px Arial",$p._STROKE=[0,"#000000"],$p._ITALIC=512,$p._PASSWORD=1024,$p._BOLD=2048,$p;}(),$L=function(){function $m(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0;}return $B($m,"laya.display.css.TransformInfo"),$m;}(),$R=function(){function $F(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$S.isConchNode){this._nativeObj=new $k._conchGraphics(),this.id=this._nativeObj.conchID;}}$B($F,"laya.display.Graphics");var $m=$F.prototype;return $m.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null;},$m.clear=function($m){void 0===$m&&($m=!1);var $p=0,$h=0;if($m){var $P=this._one;if(this._cmds){for($h=this._cmds.length,$p=0;$p<$h;$p++)!($P=this._cmds[$p])||$P.callee!==$S._context._drawTexture&&$P.callee!==$S._context._drawTextureWithTransform||($P[0]=null,$F._cache.push($P));this._cmds.length=0;}else $P&&(!$P||$P.callee!==$S._context._drawTexture&&$P.callee!==$S._context._drawTextureWithTransform||($P[0]=null,$F._cache.push($P)));}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($p=0,$h=this._vectorgraphArray.length;$p<$h;$p++)$t.getInstance().deleteShape(this._vectorgraphArray[$p]);this._vectorgraphArray.length=0;}},$m._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset();},$m._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $h(),this._graphicBounds._graphics=this);},$m._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint();},$m._isOnlyOne=function(){return!this._cmds||0===this._cmds.length;},$m.getBounds=function($m){return void 0===$m&&($m=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($m);},$m.getBoundPoints=function($m){return void 0===$m&&($m=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($m);},$m._addCmd=function($m){this._cmds=this._cmds||[],$m.callee=$m.shift(),this._cmds.push($m);},$m.setFilters=function($m){this._saveToCmd($S._context._setFilters,$m);},$m.drawTexture=function($m,$p,$h,$P,$L,$q,$k){if(void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$k&&($k=1),!$m||$k<.01)return null;$P||($P=$m.sourceWidth),$L||($L=$m.sourceHeight),$k=$k<0?0:1<$k?1:$k;var $Y,$d=!$S.isWebGL&&($w.onFirefox||$w.onEdge||$w.onIE||$w.onSafari)?.5:0,$K=$P/$m.sourceWidth,$D=$L/$m.sourceHeight;return $P=$m.width*$K,$L=$m.height*$D,$m.loaded&&($P<=0||$L<=0)?null:($p+=$m.offsetX*$K,$h+=$m.offsetY*$D,this._sp&&(this._sp._renderType|=512),$p-=$d,$h-=$d,$P+=2*$d,$L+=2*$d,$F._cache.length?(($Y=$F._cache.pop())[0]=$m,$Y[1]=$p,$Y[2]=$h,$Y[3]=$P,$Y[4]=$L,$Y[5]=$q,$Y[6]=$k):$Y=[$m,$p,$h,$P,$L,$q,$k],$Y.callee=$q||1!=$k?$S._context._drawTextureWithTransform:$S._context._drawTexture,null!=this._one||$q||1!=$k?this._saveToCmd($Y.callee,$Y):(this._one=$Y,this._render=this._renderOneImg),$m.loaded||$m.once("loaded",this,this._textureLoaded,[$m,$Y]),this._repaint(),$Y);},$m.cleanByTexture=function($m,$p,$h,$P,$L){if(void 0===$P&&($P=0),void 0===$L&&($L=0),!$m)return this.clear();if(this._one&&this._render===this._renderOneImg){$P||($P=$m.sourceWidth),$L||($L=$m.sourceHeight);var $q=$P/$m.sourceWidth,$k=$L/$m.sourceHeight;$P=$m.width*$q,$L=$m.height*$k,$p+=$m.offsetX*$q,$h+=$m.offsetY*$k,this._one[0]=$m,this._one[1]=$p,this._one[2]=$h,this._one[3]=$P,this._one[4]=$L,this._repaint();}else this.clear(),$m&&this.drawTexture($m,$p,$h,$P,$L);},$m.drawTextures=function($m,$p){$m&&this._saveToCmd($S._context._drawTextures,[$m,$p]);},$m.fillTexture=function($m,$p,$h,$P,$L,$q,$k){if(void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$q&&($q="repeat"),$m){var $Y=[$m,$p,$h,$P,$L,$q,$k||$I.EMPTY,{}];$m.loaded||$m.once("loaded",this,this._textureLoaded,[$m,$Y]),this._saveToCmd($S._context._fillTexture,$Y);}},$m._textureLoaded=function($m,$p){$p[3]=$p[3]||$m.width,$p[4]=$p[4]||$m.height,this._repaint();},$m.fillCircle=function($m,$p,$h,$P,$L,$q,$k){$h.bitmap.enableMerageInAtlas=!1;var $Y=new Float32Array(2*($k+1)),$d=new Float32Array(2*($k+1)),$K=new Uint16Array(3*$k),$D=2*Math.PI/$k,$F=0;$Y[0]=$P,$Y[1]=$L,$d[0]=$P/$h.width,$d[1]=$L/$h.height;for(var $R=2,$$=0;$$<$k;$$++){var $A=$q*Math.cos($F)+$P,$B=$q*Math.sin($F)+$L;$Y[$R]=$A,$Y[$R+1]=$B,$d[$R]=$A/$h.width,$d[$R+1]=$B/$h.height,$F+=$D,$R+=2;}for($$=$R=0;$$<$k;$$++)$K[$R++]=0,$K[$R++]=$$+1,$K[$R++]=$k+1<=$$+2?1:$$+2;this.drawTriangles($h,$m,$p,$Y,$d,$K);},$m.drawTriangles=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){void 0===$Y&&($Y=1),this._saveToCmd($S._context.drawTriangles,[$m,$p,$h,$P,$L,$q,$k,$Y,$d,$K]);},$m._saveToCmd=function($m,$p){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$p,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($p)),$p.callee=$m,this._repaint(),$p;},$m.clipRect=function($m,$p,$h,$P){this._saveToCmd($S._context._clipRect,[$m,$p,$h,$P]);},$m.fillText=function($m,$p,$h,$P,$L,$q,$k){void 0===$k&&($k=0),this._saveToCmd($S._context._fillText,[$m,$p,$h,$P||$$.defaultFont,$L,$q]);},$m.fillBorderText=function($m,$p,$h,$P,$L,$q,$k,$Y){this._saveToCmd($S._context._fillBorderText,[$m,$p,$h,$P||$$.defaultFont,$L,$q,$k,$Y]);},$m.strokeText=function($m,$p,$h,$P,$L,$q,$k){this._saveToCmd($S._context._strokeText,[$m,$p,$h,$P||$$.defaultFont,$L,$q,$k]);},$m.alpha=function($m){$m=$m<0?0:1<$m?1:$m,this._saveToCmd($S._context._alpha,[$m]);},$m.setAlpha=function($m){$m=$m<0?0:1<$m?1:$m,this._saveToCmd($S._context._setAlpha,[$m]);},$m.transform=function($m,$p,$h){void 0===$p&&($p=0),void 0===$h&&($h=0),this._saveToCmd($S._context._transform,[$m,$p,$h]);},$m.rotate=function($m,$p,$h){void 0===$p&&($p=0),void 0===$h&&($h=0),this._saveToCmd($S._context._rotate,[$m,$p,$h]);},$m.scale=function($m,$p,$h,$P){void 0===$h&&($h=0),void 0===$P&&($P=0),this._saveToCmd($S._context._scale,[$m,$p,$h,$P]);},$m.translate=function($m,$p){this._saveToCmd($S._context._translate,[$m,$p]);},$m.save=function(){this._saveToCmd($S._context._save,[]);},$m.restore=function(){this._saveToCmd($S._context._restore,[]);},$m.replaceText=function($m){this._repaint();var $p=this._cmds;if($p){for(var $h=$p.length-1;-1<$h;$h--)if(this._isTextCmd($p[$h].callee))return $p[$h][0].toUpperCase?$p[$h][0]=$m:$p[$h][0].setText($m),!0;}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$m:this._one[0].setText($m),!0;return!1;},$m._isTextCmd=function($m){return $m===$S._context._fillText||$m===$S._context._fillBorderText||$m===$S._context._strokeText;},$m.replaceTextColor=function($m){this._repaint();var $p=this._cmds;if($p)for(var $h=$p.length-1;-1<$h;$h--)this._isTextCmd($p[$h].callee)&&($p[$h][4]=$m,$p[$h][0].toUpperCase||($p[$h][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$m,this._one[0].toUpperCase||(this._one[0].changed=!0));},$m.loadImage=function($m,$p,$h,$P,$L,$q){var $k=this;void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0),void 0===$L&&($L=0);var $Y=$Ym.getRes($m);function $d($m){$m&&($k.drawTexture($m,$p,$h,$P,$L),null!=$q&&$q.call($k._sp,$m));}$Y?$d($Y):$E.loader.load($m,$e.create(null,$d),null,"image");},$m._renderEmpty=function($m,$p,$h,$P){},$m._renderAll=function($m,$p,$h,$P){for(var $L,$q=this._cmds,$k=0,$Y=$q.length;$k<$Y;$k++)($L=$q[$k]).callee.call($p,$h,$P,$L);},$m._renderOne=function($m,$p,$h,$P){this._one.callee.call($p,$h,$P,this._one);},$m._renderOneImg=function($m,$p,$h,$P){this._one.callee.call($p,$h,$P,this._one),2305!==$m._renderType&&($m._renderType|=1);},$m.drawLine=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=1);var $k=0;$S.isWebGL&&($k=$t.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($k));var $Y=$q%2==0?0:.5,$d=[$m+$Y,$p+$Y,$h+$Y,$P+$Y,$L,$q,$k];this._saveToCmd($S._context._drawLine,$d);},$m.drawLines=function($m,$p,$h,$P,$L){void 0===$L&&($L=1);var $q=0;if($h&&!($h.length<4)){$S.isWebGL&&($q=$t.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($q));var $k=$L%2==0?0:.5,$Y=[$m+$k,$p+$k,$h,$P,$L,$q];this._saveToCmd($S._context._drawLines,$Y);}},$m.drawCurves=function($m,$p,$h,$P,$L){void 0===$L&&($L=1);var $q=[$m,$p,$h,$P,$L];this._saveToCmd($S._context._drawCurves,$q);},$m.drawRect=function($m,$p,$h,$P,$L,$q,$k){void 0===$k&&($k=1);var $Y=$q?$k/2:0,$d=$q?$k:0,$K=[$m+$Y,$p+$Y,$h-$d,$P-$d,$L,$q,$k];this._saveToCmd($S._context._drawRect,$K);},$m.drawCircle=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=1);var $k=$L?$q/2:0,$Y=0;$S.isWebGL&&($Y=$t.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($Y));var $d=[$m,$p,$h-$k,$P,$L,$q,$Y];this._saveToCmd($S._context._drawCircle,$d);},$m.drawPie=function($m,$p,$h,$P,$L,$q,$k,$Y){void 0===$Y&&($Y=1);var $d=$k?$Y/2:0,$K=$k?$Y:0,$D=0;$S.isWebGL&&($D=$t.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($D));var $F=[$m+$d,$p+$d,$h-$K,$P,$L,$q,$k,$Y,$D];$F[3]=$g.toRadian($P),$F[4]=$g.toRadian($L),this._saveToCmd($S._context._drawPie,$F);},$m.drawPoly=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=1);var $k=0,$Y=!1;$S.isWebGL&&($k=$t.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($k),$Y=!(6<$h.length));var $d=$L?$q%2==0?0:.5:0,$K=[$m+$d,$p+$d,$h,$P,$L,$q,$k,$Y];this._saveToCmd($S._context._drawPoly,$K);},$m.drawPath=function($m,$p,$h,$P,$L){var $q=[$m,$p,$h,$P,$L];this._saveToCmd($S._context._drawPath,$q);},$D(0,$m,"cmds",function(){return this._cmds;},function($m){this._sp&&(this._sp._renderType|=512),this._cmds=$m,this._render=this._renderAll,this._repaint();}),$F.__init__=function(){if($S.isConchNode){for(var $m=laya.display.Graphics.prototype,$p=$w.window.ConchGraphics.prototype,$h=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$P=0,$L=$h.length;$P<=$L;$P++){var $q=$h[$P];$m[$q]=$p[$q];}$m._saveToCmd=null,$p.drawImageS&&($m.drawTextures=function($m,$p){if($m&&$m.loaded&&$m.bitmap&&$m.source){var $h=$m.uv,$P=$m.bitmap.width,$L=$m.bitmap.height;this.drawImageS($m.bitmap.source,$h[0]*$P,$h[1]*$L,($h[2]-$h[0])*$P,($h[5]-$h[3])*$L,$m.offsetX,$m.offsetY,$m.width,$m.height,$p);}}),$m.drawTexture=function($m,$p,$h,$P,$L,$q,$k){if(void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$k&&($k=1),$m)if($m.loaded){if($m.loaded&&$m.bitmap&&$m.source&&($P||($P=$m.sourceWidth),$L||($L=$m.sourceHeight),$k=$k<0?0:1<$k?1:$k,$P=$P-$m.sourceWidth+$m.width,$L=$L-$m.sourceHeight+$m.height,!($P<=0||$L<=0))){$p+=$m.offsetX,$h+=$m.offsetY;var $Y=$m.uv,$d=$m.bitmap.width,$K=$m.bitmap.height;$Y[4]<$Y[0]&&$Y[5]<$Y[1]?this.drawImageM($m.bitmap.source,$Y[4]*$d,$Y[5]*$K,($Y[0]-$Y[4])*$d,($Y[1]-$Y[5])*$K,$p,$h,$P,$L,$q,$k):this.drawImageM($m.bitmap.source,$Y[0]*$d,$Y[1]*$K,($Y[2]-$Y[0])*$d,($Y[5]-$Y[3])*$K,$p,$h,$P,$L,$q,$k),this._repaint();}}else $m.once("loaded",this,function(){this.drawTexture($m,$p,$h,$P,$L,$q);});},$m.fillTexture=function($m,$p,$h,$P,$L,$q,$k){if(void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$q&&($q="repeat"),$m&&$m.loaded){var $Y,$d=$S._context.ctx,$K=$m.bitmap.width,$D=$m.bitmap.height,$F=$m.uv;$Y=$m.uv!=$Dm.DEF_UV?$d.createPattern($m.bitmap.source,$q,$F[0]*$K,$F[1]*$D,($F[2]-$F[0])*$K,($F[5]-$F[3])*$D):$d.createPattern($m.bitmap.source,$q);var $R=0,$$=0;$k&&($p+=$k.x%$m.width,$h+=$k.y%$m.height,$R-=$k.x%$m.width,$$-=$k.y%$m.height),this._fillImage($Y,$p,$h,$R,$$,$P,$L);}};}},$F._cache=[],$F;}(),$h=function(){function $a(){this._cacheBoundsType=!1;}$B($a,"laya.display.GraphicsBounds");var $m=$a.prototype;return $m.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null;},$m.reset=function(){this._temp&&(this._temp.length=0);},$m.getBounds=function($m){return void 0===$m&&($m=!1),(!this._bounds||!this._temp||this._temp.length<1||$m!=this._cacheBoundsType)&&(this._bounds=$b._getWrapRec(this.getBoundPoints($m),this._bounds)),this._cacheBoundsType=$m,this._bounds;},$m.getBoundPoints=function($m){return void 0===$m&&($m=!1),(!this._temp||this._temp.length<1||$m!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($m)),this._cacheBoundsType=$m,this._rstBoundPoints=$g.copyArray(this._rstBoundPoints,this._temp);},$m._getCmdPoints=function($m){void 0===$m&&($m=!1);var $p,$h,$P=$S._context,$L=this._graphics.cmds;if(($p=this._temp||(this._temp=[])).length=0,$L||null==this._graphics._one||($a._tempCmds.length=0,$a._tempCmds.push(this._graphics._one),$L=$a._tempCmds),!$L)return $p;($h=$a._tempMatrixArrays).length=0;var $q=$a._initMatrix;$q.identity();for(var $k,$Y,$d=$a._tempMatrix,$K=NaN,$D=NaN,$F=NaN,$R=NaN,$$=NaN,$A=NaN,$B=0,$n=$L.length;$B<$n;$B++)if(($k=$L[$B]).callee)switch($k.callee){case $P._save:case 7:$h.push($q),$q=$q.clone();break;case $P._restore:case 8:$q=$h.pop();break;case $P._scale:case 5:$d.identity(),$d.translate(-$k[2],-$k[3]),$d.scale($k[0],$k[1]),$d.translate($k[2],$k[3]),this._switchMatrix($q,$d);break;case $P._rotate:case 3:$d.identity(),$d.translate(-$k[1],-$k[2]),$d.rotate($k[0]),$d.translate($k[1],$k[2]),this._switchMatrix($q,$d);break;case $P._translate:case 6:$d.identity(),$d.translate($k[0],$k[1]),this._switchMatrix($q,$d);break;case $P._transform:case 4:$d.identity(),$d.translate(-$k[1],-$k[2]),$d.concat($k[0]),$d.translate($k[1],$k[2]),this._switchMatrix($q,$d);break;case 16:case 24:$a._addPointArrToRst($p,$b._getBoundPointS($k[0],$k[1],$k[2],$k[3]),$q);break;case 17:$q.copyTo($d),$d.concat($k[4]),$a._addPointArrToRst($p,$b._getBoundPointS($k[0],$k[1],$k[2],$k[3]),$d);break;case $P._drawTexture:$Y=$k[0],$m?$k[3]&&$k[4]?$a._addPointArrToRst($p,$b._getBoundPointS($k[1],$k[2],$k[3],$k[4]),$q):($Y=$k[0],$a._addPointArrToRst($p,$b._getBoundPointS($k[1],$k[2],$Y.width,$Y.height),$q)):($K=($k[3]||$Y.sourceWidth)/$Y.width,$D=($k[4]||$Y.sourceHeight)/$Y.height,$F=$K*$Y.sourceWidth,$R=$D*$Y.sourceHeight,$$=0<$Y.offsetX?$Y.offsetX:0,$A=0<$Y.offsetY?$Y.offsetY:0,$$*=$K,$A*=$D,$a._addPointArrToRst($p,$b._getBoundPointS($k[1]-$$,$k[2]-$A,$F,$R),$q));break;case $P._fillTexture:$k[3]&&$k[4]?$a._addPointArrToRst($p,$b._getBoundPointS($k[1],$k[2],$k[3],$k[4]),$q):($Y=$k[0],$a._addPointArrToRst($p,$b._getBoundPointS($k[1],$k[2],$Y.width,$Y.height),$q));break;case $P._drawTextureWithTransform:var $c;$c=$k[5]?($q.copyTo($d),$d.concat($k[5]),$d):$q,$m?$k[3]&&$k[4]?$a._addPointArrToRst($p,$b._getBoundPointS($k[1],$k[2],$k[3],$k[4]),$c):($Y=$k[0],$a._addPointArrToRst($p,$b._getBoundPointS($k[1],$k[2],$Y.width,$Y.height),$c)):($Y=$k[0],$K=($k[3]||$Y.sourceWidth)/$Y.width,$D=($k[4]||$Y.sourceHeight)/$Y.height,$F=$K*$Y.sourceWidth,$R=$D*$Y.sourceHeight,$$=0<$Y.offsetX?$Y.offsetX:0,$A=0<$Y.offsetY?$Y.offsetY:0,$$*=$K,$A*=$D,$a._addPointArrToRst($p,$b._getBoundPointS($k[1]-$$,$k[2]-$A,$F,$R),$c));break;case $P._drawRect:case 13:$a._addPointArrToRst($p,$b._getBoundPointS($k[0],$k[1],$k[2],$k[3]),$q);break;case $P._drawCircle:case $P._fillCircle:case 14:$a._addPointArrToRst($p,$b._getBoundPointS($k[0]-$k[2],$k[1]-$k[2],$k[2]+$k[2],$k[2]+$k[2]),$q);break;case $P._drawLine:case 20:$a._tempPoints.length=0;var $e;$e=.5*$k[5],$k[0]==$k[2]?$a._tempPoints.push($k[0]+$e,$k[1],$k[2]+$e,$k[3],$k[0]-$e,$k[1],$k[2]-$e,$k[3]):$k[1]==$k[3]?$a._tempPoints.push($k[0],$k[1]+$e,$k[2],$k[3]+$e,$k[0],$k[1]-$e,$k[2],$k[3]-$e):$a._tempPoints.push($k[0],$k[1],$k[2],$k[3]),$a._addPointArrToRst($p,$a._tempPoints,$q);break;case $P._drawCurves:case 22:$a._addPointArrToRst($p,$Z.I.getBezierPoints($k[2]),$q,$k[0],$k[1]);break;case $P._drawPoly:case $P._drawLines:case 18:$a._addPointArrToRst($p,$k[2],$q,$k[0],$k[1]);break;case $P._drawPath:case 19:$a._addPointArrToRst($p,this._getPathPoints($k[2]),$q,$k[0],$k[1]);break;case $P._drawPie:case 15:$a._addPointArrToRst($p,this._getPiePoints($k[0],$k[1],$k[2],$k[3],$k[4]),$q);}return 200<$p.length?$p=$g.copyArray($p,$b._getWrapRec($p)._getBoundPoints()):8<$p.length&&($p=$H.scanPList($p)),$p;},$m._switchMatrix=function($m,$p){$p.concat($m),$p.copyTo($m);},$m._getPiePoints=function($m,$p,$h,$P,$L){var $q=$a._tempPoints;$a._tempPoints.length=0,$q.push($m,$p);var $k=($L-$P)%(2*Math.PI)/10,$Y=NaN,$d=$P;for($Y=0;$Y<=10;$Y++)$q.push($m+$h*Math.cos($d),$p+$h*Math.sin($d)),$d+=$k;return $q;},$m._getPathPoints=function($m){var $p,$h,$P=0,$L=$a._tempPoints;for($L.length=0,$p=$m.length,$P=0;$P<$p;$P++)1<($h=$m[$P]).length&&($L.push($h[1],$h[2]),3<$h.length&&$L.push($h[3],$h[4]));return $L;},$a._addPointArrToRst=function($m,$p,$h,$P,$L){void 0===$P&&($P=0),void 0===$L&&($L=0);var $q,$k=0;for($q=$p.length,$k=0;$k<$q;$k+=2)$a._addPointToRst($m,$p[$k]+$P,$p[$k+1]+$L,$h);},$a._addPointToRst=function($m,$p,$h,$P){var $L=$I.TEMP;$L.setTo($p||0,$h||0),$P.transformPoint($L),$m.push($L.x,$L.y);},$a._tempPoints=[],$a._tempMatrixArrays=[],$a._tempCmds=[],$d($a,["_tempMatrix",function(){return this._tempMatrix=new $M();},"_initMatrix",function(){return this._initMatrix=new $M();}]),$a;}(),$q=function(){function $m(){}$B($m,"laya.events.Event");var $p=$m.prototype;return $p.setTo=function($m,$p,$h){return this.type=$m,this.currentTarget=$p,this.target=$h,this;},$p.stopPropagation=function(){this._stoped=!0;},$D(0,$p,"stageY",function(){return $E.stage.mouseY;}),$D(0,$p,"charCode",function(){return this.nativeEvent.charCode;}),$D(0,$p,"touches",function(){var $m=this.nativeEvent.touches;if($m)for(var $p=$E.stage,$h=0,$P=$m.length;$h<$P;$h++){var $L=$m[$h],$q=$I.TEMP;$q.setTo($L.clientX,$L.clientY),$p._canvasTransform.invertTransformPoint($q),$p.transform.invertTransformPoint($q),$L.stageX=$q.x,$L.stageY=$q.y;}return $m;}),$D(0,$p,"keyLocation",function(){return this.nativeEvent.keyLocation;}),$D(0,$p,"ctrlKey",function(){return this.nativeEvent.ctrlKey;}),$D(0,$p,"altKey",function(){return this.nativeEvent.altKey;}),$D(0,$p,"shiftKey",function(){return this.nativeEvent.shiftKey;}),$D(0,$p,"stageX",function(){return $E.stage.mouseX;}),$m.EMPTY=new $m(),$m.MOUSE_DOWN="mousedown",$m.MOUSE_UP="mouseup",$m.CLICK="click",$m.RIGHT_MOUSE_DOWN="rightmousedown",$m.RIGHT_MOUSE_UP="rightmouseup",$m.RIGHT_CLICK="rightclick",$m.MOUSE_MOVE="mousemove",$m.MOUSE_OVER="mouseover",$m.MOUSE_OUT="mouseout",$m.MOUSE_WHEEL="mousewheel",$m.ROLL_OVER="mouseover",$m.ROLL_OUT="mouseout",$m.DOUBLE_CLICK="doubleclick",$m.CHANGE="change",$m.CHANGED="changed",$m.RESIZE="resize",$m.ADDED="added",$m.REMOVED="removed",$m.DISPLAY="display",$m.UNDISPLAY="undisplay",$m.ERROR="error",$m.COMPLETE="complete",$m.LOADED="loaded",$m.INITED="inited",$m.PROGRESS="progress",$m.INPUT="input",$m.RENDER="render",$m.OPEN="open",$m.MESSAGE="message",$m.CLOSE="close",$m.KEY_DOWN="keydown",$m.KEY_PRESS="keypress",$m.KEY_UP="keyup",$m.FRAME="enterframe",$m.DRAG_START="dragstart",$m.DRAG_MOVE="dragmove",$m.DRAG_END="dragend",$m.ENTER="enter",$m.SELECT="select",$m.BLUR="blur",$m.FOCUS="focus",$m.VISIBILITY_CHANGE="visibilitychange",$m.FOCUS_CHANGE="focuschange",$m.PLAYED="played",$m.PAUSED="paused",$m.STOPPED="stopped",$m.START="start",$m.END="end",$m.ENABLE_CHANGED="enablechanged",$m.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$m.COMPONENT_ADDED="componentadded",$m.COMPONENT_REMOVED="componentremoved",$m.LAYER_CHANGED="layerchanged",$m.HIERARCHY_LOADED="hierarchyloaded",$m.RECOVERED="recovered",$m.RELEASED="released",$m.LINK="link",$m.LABEL="label",$m.FULL_SCREEN_CHANGE="fullscreenchange",$m.DEVICE_LOST="devicelost",$m.MESH_CHANGED="meshchanged",$m.MATERIAL_CHANGED="materialchanged",$m.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$m.ANIMATION_CHANGED="animationchanged",$m.TRIGGER_ENTER="triggerenter",$m.TRIGGER_STAY="triggerstay",$m.TRIGGER_EXIT="triggerexit",$m.TRAIL_FILTER_CHANGE="trailfilterchange",$m.DOMINO_FILTER_CHANGE="dominofilterchange",$m;}(),$F=(function(){function $m(){}$B($m,"laya.events.Keyboard"),$m.NUMBER_0=48,$m.NUMBER_1=49,$m.NUMBER_2=50,$m.NUMBER_3=51,$m.NUMBER_4=52,$m.NUMBER_5=53,$m.NUMBER_6=54,$m.NUMBER_7=55,$m.NUMBER_8=56,$m.NUMBER_9=57,$m.A=65,$m.B=66,$m.C=67,$m.D=68,$m.E=69,$m.F=70,$m.G=71,$m.H=72,$m.I=73,$m.J=74,$m.K=75,$m.L=76,$m.M=77,$m.N=78,$m.O=79,$m.P=80,$m.Q=81,$m.R=82,$m.S=83,$m.T=84,$m.U=85,$m.V=86,$m.W=87,$m.X=88,$m.Y=89,$m.Z=90,$m.F1=112,$m.F2=113,$m.F3=114,$m.F4=115,$m.F5=116,$m.F6=117,$m.F7=118,$m.F8=119,$m.F9=120,$m.F10=121,$m.F11=122,$m.F12=123,$m.F13=124,$m.F14=125,$m.F15=126,$m.NUMPAD=21,$m.NUMPAD_0=96,$m.NUMPAD_1=97,$m.NUMPAD_2=98,$m.NUMPAD_3=99,$m.NUMPAD_4=100,$m.NUMPAD_5=101,$m.NUMPAD_6=102,$m.NUMPAD_7=103,$m.NUMPAD_8=104,$m.NUMPAD_9=105,$m.NUMPAD_ADD=107,$m.NUMPAD_DECIMAL=110,$m.NUMPAD_DIVIDE=111,$m.NUMPAD_ENTER=108,$m.NUMPAD_MULTIPLY=106,$m.NUMPAD_SUBTRACT=109,$m.SEMICOLON=186,$m.EQUAL=187,$m.COMMA=188,$m.MINUS=189,$m.PERIOD=190,$m.SLASH=191,$m.BACKQUOTE=192,$m.LEFTBRACKET=219,$m.BACKSLASH=220,$m.RIGHTBRACKET=221,$m.QUOTE=222,$m.ALTERNATE=18,$m.BACKSPACE=8,$m.CAPS_LOCK=20,$m.COMMAND=15,$m.CONTROL=17,$m.DELETE=46,$m.ENTER=13,$m.ESCAPE=27,$m.PAGE_UP=33,$m.PAGE_DOWN=34,$m.END=35,$m.HOME=36,$m.LEFT=37,$m.UP=38,$m.RIGHT=39,$m.DOWN=40,$m.SHIFT=16,$m.SPACE=32,$m.TAB=9,$m.INSERT=45;}(),function(){function $L(){}return $B($L,"laya.events.KeyBoardManager"),$L.__init__=function(){$L._addEvent("keydown"),$L._addEvent("keypress"),$L._addEvent("keyup");},$L._addEvent=function($p){$w.document.addEventListener($p,function($m){laya.events.KeyBoardManager._dispatch($m,$p);},!0);},$L._dispatch=function($m,$p){if($L.enabled){$L._event._stoped=!1,$L._event.nativeEvent=$m,$L._event.keyCode=$m.keyCode||$m.which||$m.charCode,"keydown"===$p?$L._pressKeys[$L._event.keyCode]=!0:"keyup"===$p&&($L._pressKeys[$L._event.keyCode]=null);for(var $h=$E.stage.focus&&null!=$E.stage.focus.event&&$E.stage.focus.displayedInStage?$E.stage.focus:$E.stage,$P=$h;$P;)$P.event($p,$L._event.setTo($p,$P,$h)),$P=$P.parent;}},$L.hasKeyDown=function($m){return $L._pressKeys[$m];},$L._pressKeys={},$L.enabled=!0,$d($L,["_event",function(){return this._event=new $q();}]),$L;}()),$A=(function(){function $m(){}$B($m,"laya.events.KeyLocation"),$m.STANDARD=0,$m.LEFT=1,$m.RIGHT=2,$m.NUM_PAD=3;}(),function(){function $D(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$w.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $q(),this._matrix=new $M(),this._point=new $I(),this._rect=new $b(),this._prePoint=new $I(),this._curTouchID=NaN;}$B($D,"laya.events.MouseManager");var $m=$D.prototype;return $m.__init__=function($m,$p){var $h=this;this._stage=$m;var $P=this,$L=this._eventList;$p.oncontextmenu=function($m){if($D.enabled)return!1;},$p.addEventListener("mousedown",function($m){$D.enabled&&($w.onIE||$m.preventDefault(),$L.push($m),$P.mouseDownTime=$w.now());}),$p.addEventListener("mouseup",function($m){$D.enabled&&($m.preventDefault(),$L.push($m),$P.mouseDownTime=-$w.now());},!0),$p.addEventListener("mousemove",function($m){if($D.enabled){$m.preventDefault();var $p=$w.now();if($p-$P._lastMoveTimer<10)return;$P._lastMoveTimer=$p,$L.push($m);}},!0),$p.addEventListener("mouseout",function($m){$D.enabled&&$L.push($m);}),$p.addEventListener("mouseover",function($m){$D.enabled&&$L.push($m);}),$p.addEventListener("touchstart",function($m){$D.enabled&&($L.push($m),$D._isFirstTouch||$Hm.isInputting||$m.preventDefault(),$P.mouseDownTime=$w.now());}),$p.addEventListener("touchend",function($m){$D.enabled?($D._isFirstTouch||$Hm.isInputting||$m.preventDefault(),$D._isFirstTouch=!1,$L.push($m),$P.mouseDownTime=-$w.now()):$h._curTouchID=NaN;},!0),$p.addEventListener("touchmove",function($m){$D.enabled&&($m.preventDefault(),$L.push($m));},!0),$p.addEventListener("touchcancel",function($m){$D.enabled?($m.preventDefault(),$L.push($m)):$h._curTouchID=NaN;},!0),$p.addEventListener("mousewheel",function($m){$D.enabled&&$L.push($m);}),$p.addEventListener("DOMMouseScroll",function($m){$D.enabled&&$L.push($m);});},$m.initEvent=function($m,$p){var $h;this._event._stoped=!1,this._event.nativeEvent=$p||$m,this._target=null,this._point.setTo($m.pageX||$m.clientX,$m.pageY||$m.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$m.identifier||0,this._tTouchID=this._event.touchId,($h=$n.I._event)._stoped=!1,$h.nativeEvent=this._event.nativeEvent,$h.touchId=this._event.touchId;},$m.checkMouseWheel=function($m){this._event.delta=$m.wheelDelta?.025*$m.wheelDelta:-$m.detail;for(var $p=$n.I.getLastOvers(),$h=0,$P=$p.length;$h<$P;$h++){var $L=$p[$h];$L.event("mousewheel",this._event.setTo("mousewheel",$L,this._target));}},$m.onMouseMove=function($m){$n.I.onMouseMove($m,this._tTouchID);},$m.onMouseDown=function($m){if($Hm.isInputting&&$E.stage.focus&&$E.stage.focus.focus&&!$E.stage.focus.contains(this._target)){var $p=$E.stage.focus._tf||$E.stage.focus,$h=$m._tf||$m;$h instanceof laya.display.Input&&$h.multiline==$p.multiline?$p._focusOut():$p.focus=!1;}$n.I.onMouseDown($m,this._tTouchID,this._isLeftMouse);},$m.onMouseUp=function($m){$n.I.onMouseUp($m,this._tTouchID,this._isLeftMouse);},$m.check=function($m,$p,$h,$P){this._point.setTo($p,$h),$m.fromParentPoint(this._point),$p=this._point.x,$h=this._point.y;var $L=$m.scrollRect;if($L&&(this._rect.setTo($L.x,$L.y,$L.width,$L.height),!this._rect.contains($p,$h)))return!1;if(!this.disableMouseEvent){if($m.hitTestPrior&&!$m.mouseThrough&&!this.hitTest($m,$p,$h))return!1;for(var $q=$m._childs.length-1;-1<$q;$q--){var $k=$m._childs[$q];if(!$k.destroyed&&$k.mouseEnabled&&$k.visible&&this.check($k,$p,$h,$P))return!0;}}var $Y=!(!$m.hitTestPrior||$m.mouseThrough||this.disableMouseEvent)||this.hitTest($m,$p,$h);return $Y?(this._target=$m,$P.call(this,$m)):$P===this.onMouseUp&&$m===this._stage&&(this._target=this._stage,$P.call(this,this._target)),$Y;},$m.hitTest=function($m,$p,$h){var $P=!1;if($m.scrollRect&&($p-=$m.scrollRect.x,$h-=$m.scrollRect.y),$m.hitArea instanceof laya.utils.HitArea)return $m.hitArea.isHit($p,$h);if(0<$m.width&&0<$m.height||$m.mouseThrough||$m.hitArea)if($m.mouseThrough)$P=$m.getGraphicBounds().contains($p,$h);else{var $L=this._rect;$m.hitArea?$L=$m.hitArea:$L.setTo(0,0,$m.width,$m.height),$P=$L.contains($p,$h);}return $P;},$m.runEvent=function(){var $m=this._eventList.length;if($m){var $p=this;$p.mouseEventTime=$w.now();var $h,$P=0,$L=0,$q=0;try{for(;$P<$m;){var $k=this._eventList[$P];switch("mousemove"!==$k.type&&(this._prePoint.x=this._prePoint.y=-1e6),$k.type){case"mousedown":this._touchIDs[0]=this._id++,$D._isTouchRespond?$D._isTouchRespond=!1:($p._isLeftMouse=0===$k.button,$p.initEvent($k),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseDown));break;case"mouseup":$p._isLeftMouse=0===$k.button,$p.initEvent($k),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$k.clientX)+Math.abs(this._prePoint.y-$k.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$k.clientX,this._prePoint.y=$k.clientY,$p.initEvent($k),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseMove));break;case"touchstart":$D._isTouchRespond=!0,$p._isLeftMouse=!0;var $Y=$k.changedTouches;for($L=0,$q=$Y.length;$L<$q;$L++)$h=$Y[$L],($D.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$h.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$h.identifier]=this._id++,$p.initEvent($h,$k),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseDown));break;case"touchend":case"touchcancel":$D._isTouchRespond=!0,$p._isLeftMouse=!0;var $d=$k.changedTouches;for($L=0,$q=$d.length;$L<$q;$L++)if($h=$d[$L],$D.multiTouchEnabled||$h.identifier==this._curTouchID){this._curTouchID=NaN,$p.initEvent($h,$k);$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseUp)||$p.onMouseUp(null);}break;case"touchmove":var $K=$k.changedTouches;for($L=0,$q=$K.length;$L<$q;$L++)$h=$K[$L],($D.multiTouchEnabled||$h.identifier==this._curTouchID)&&($p.initEvent($h,$k),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$p.checkMouseWheel($k);break;case"mouseout":$n.I.stageMouseOut();break;case"mouseover":$p._stage.event("mouseover",$p._event.setTo("mouseover",$p._stage,$p._stage));}$P++;}}catch($m){throw this._eventList.length=0,$m;}this._eventList.length=0;}},$D.enabled=!0,$D.multiTouchEnabled=!0,$D._isTouchRespond=!1,$D._isFirstTouch=!0,$d($D,["instance",function(){return this.instance=new $D();}]),$D;}()),$n=function(){function $A(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $q();}$B($A,"laya.events.TouchManager");var $m=$A.prototype;return $m._clearTempArrs=function(){$A._oldArr.length=0,$A._newArr.length=0,$A._tEleArr.length=0;},$m.getTouchFromArr=function($m,$p){var $h,$P,$L=0;for($h=$p.length,$L=0;$L<$h;$L++)if(($P=$p[$L]).id==$m)return $P;return null;},$m.removeTouchFromArr=function($m,$p){var $h=0;for($h=$p.length-1;0<=$h;$h--)$p[$h].id==$m&&$p.splice($h,1);},$m.createTouchO=function($m,$p){var $h;return($h=$o.getItem("TouchData")||{}).id=$p,$h.tar=$m,$h;},$m.onMouseDown=function($m,$p,$h){var $P,$L,$q,$k;(void 0===$h&&($h=!1),this.enable)&&($P=this.getTouchFromArr($p,this.preOvers),$q=this.getEles($m,null,$A._tEleArr),$P?$P.tar=$m:($L=this.createTouchO($m,$p),this.preOvers.push($L)),$w.onMobile&&this.sendEvents($q,"mouseover",$p),$k=$h?this.preDowns:this.preRightDowns,($P=this.getTouchFromArr($p,$k))?$P.tar=$m:($L=this.createTouchO($m,$p),$k.push($L)),this.sendEvents($q,$h?"mousedown":"rightmousedown",$p),this._clearTempArrs());},$m.sendEvents=function($m,$p,$h){void 0===$h&&($h=0);var $P,$L,$q,$k=0;for($P=$m.length,this._event._stoped=!1,$L=$m[0],$k=0;$k<$P;$k++){if(($q=$m[$k]).destroyed)return;if($q.event($p,this._event.setTo($p,$q,$L)),this._event._stoped)break;}},$m.getEles=function($m,$p,$h){for($h?$h.length=0:$h=[];$m&&$m!=$p;)$h.push($m),$m=$m.parent;return $h;},$m.checkMouseOutAndOverOfMove=function($m,$p,$h){if(void 0===$h&&($h=0),$p!=$m){var $P,$L,$q=0,$k=0;if($p.contains($m))$L=this.getEles($m,$p,$A._tEleArr),this.sendEvents($L,"mouseover",$h);else if($m.contains($p))$L=this.getEles($p,$m,$A._tEleArr),this.sendEvents($L,"mouseout",$h);else{var $Y,$d;($L=$A._tEleArr).length=0,$Y=this.getEles($p,null,$A._oldArr),$d=this.getEles($m,null,$A._newArr),$k=$Y.length;var $K=0;for($q=0;$q<$k;$q++){if($P=$Y[$q],0<=($K=$d.indexOf($P))){$d.splice($K,$d.length-$K);break;}$L.push($P);}0<$L.length&&this.sendEvents($L,"mouseout",$h),0<$d.length&&this.sendEvents($d,"mouseover",$h);}}},$m.onMouseMove=function($m,$p){var $h,$P;this.enable&&(($h=this.getTouchFromArr($p,this.preOvers))?(this.checkMouseOutAndOverOfMove($m,$h.tar),$h.tar=$m,$P=this.getEles($m,null,$A._tEleArr)):($P=this.getEles($m,null,$A._tEleArr),this.sendEvents($P,"mouseover",$p),this.preOvers.push(this.createTouchO($m,$p))),this.sendEvents($P,"mousemove",$p),this._clearTempArrs());},$m.getLastOvers=function(){return($A._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$A._tEleArr):($A._tEleArr.push($E.stage),$A._tEleArr);},$m.stageMouseOut=function(){var $m;$m=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($m,"mouseout",0);},$m.onMouseUp=function($m,$p,$h){if(void 0===$h&&($h=!1),this.enable){var $P,$L,$q,$k,$Y,$d,$K=0,$D=0,$F=$w.onMobile;if($L=this.getEles($m,null,$A._tEleArr),this.sendEvents($L,$h?"mouseup":"rightmouseup",$p),$d=$h?this.preDowns:this.preRightDowns,$P=this.getTouchFromArr($p,$d)){var $R,$$=$w.now();if($R=$$-this._lastClickTime<300,this._lastClickTime=$$,$m==$P.tar)$Y=$L;else for($q=this.getEles($P.tar,null,$A._oldArr),($Y=$A._newArr).length=0,$D=$q.length,$K=0;$K<$D;$K++)$k=$q[$K],0<=$L.indexOf($k)&&$Y.push($k);0<$Y.length&&this.sendEvents($Y,$h?"click":"rightclick",$p),$h&&$R&&this.sendEvents($Y,"doubleclick",$p),this.removeTouchFromArr($p,$d),$P.tar=null,$o.recover("TouchData",$P);}else;($P=this.getTouchFromArr($p,this.preOvers))&&$F&&(($Y=this.getEles($P.tar,null,$Y))&&0<$Y.length&&this.sendEvents($Y,"mouseout",$p),this.removeTouchFromArr($p,this.preOvers),$P.tar=null,$o.recover("TouchData",$P)),this._clearTempArrs();}},$A._oldArr=[],$A._newArr=[],$A._tEleArr=[],$d($A,["I",function(){return this.I=new $A();}]),$A;}(),$c=function(){function $m(){this._action=null;}$B($m,"laya.filters.Filter");var $p=$m.prototype;return $E.imps($p,{"laya.filters.IFilter":!0}),$p.callNative=function($m){},$D(0,$p,"type",function(){return-1;}),$D(0,$p,"action",function(){return this._action;}),$m.BLUR=16,$m.COLOR=32,$m.GLOW=8,$m._filterStart=null,$m._filterEnd=null,$m._EndTarget=null,$m._recycleScope=null,$m._filter=null,$m._useSrc=null,$m._endSrc=null,$m._useOut=null,$m._endOut=null,$m;}(),$a=function(){function $m(){this.data=null;}$B($m,"laya.filters.ColorFilterAction");var $p=$m.prototype;return $E.imps($p,{"laya.filters.IFilterAction":!0}),$p.apply=function($m){var $p=$m.ctx.ctx,$h=$m.ctx.ctx.canvas;if(0==$h.width||0==$h.height)return $h;for(var $P,$L=$p.getImageData(0,0,$h.width,$h.height),$q=$L.data,$k=0,$Y=$q.length;$k<$Y;$k+=4)$P=this.getColor($q[$k],$q[$k+1],$q[$k+2],$q[$k+3]),0!=$q[$k+3]&&($q[$k]=$P[0],$q[$k+1]=$P[1],$q[$k+2]=$P[2],$q[$k+3]=$P[3]);return $p.putImageData($L,0,0),$m;},$p.getColor=function($m,$p,$h,$P){var $L=[];if(this.data._mat&&this.data._alpha){var $q=this.data._mat,$k=this.data._alpha;$L[0]=$q[0]*$m+$q[1]*$p+$q[2]*$h+$q[3]*$P+$k[0],$L[1]=$q[4]*$m+$q[5]*$p+$q[6]*$h+$q[7]*$P+$k[1],$L[2]=$q[8]*$m+$q[9]*$p+$q[10]*$h+$q[11]*$P+$k[2],$L[3]=$q[12]*$m+$q[13]*$p+$q[14]*$h+$q[15]*$P+$k[3];}return $L;},$m;}(),$Z=(function(){function $m(){}$B($m,"laya.maths.Arith"),$m.formatR=function($m){return $m>Math.PI&&($m-=2*Math.PI),$m<-Math.PI&&($m+=2*Math.PI),$m;},$m.isPOT=function($m,$p){return 0<$m&&0==($m&$m-1)&&0<$p&&0==($p&$p-1);},$m.setMatToArray=function($m,$p){$m.a,$m.b,$m.c,$m.d,$m.tx,$m.ty,$p[0]=$m.a,$p[1]=$m.b,$p[4]=$m.c,$p[5]=$m.d,$p[12]=$m.tx,$p[13]=$m.ty;};}(),function(){function $m(){this._controlPoints=[new $I(),new $I(),new $I()],this._calFun=this.getPoint2;}$B($m,"laya.maths.Bezier");var $p=$m.prototype;return $p._switchPoint=function($m,$p){var $h=this._controlPoints.shift();$h.setTo($m,$p),this._controlPoints.push($h);},$p.getPoint2=function($m,$p){var $h=this._controlPoints[0],$P=this._controlPoints[1],$L=this._controlPoints[2],$q=Math.pow(1-$m,2)*$h.x+2*$m*(1-$m)*$P.x+Math.pow($m,2)*$L.x,$k=Math.pow(1-$m,2)*$h.y+2*$m*(1-$m)*$P.y+Math.pow($m,2)*$L.y;$p.push($q,$k);},$p.getPoint3=function($m,$p){var $h=this._controlPoints[0],$P=this._controlPoints[1],$L=this._controlPoints[2],$q=this._controlPoints[3],$k=Math.pow(1-$m,3)*$h.x+3*$P.x*$m*(1-$m)*(1-$m)+3*$L.x*$m*$m*(1-$m)+$q.x*Math.pow($m,3),$Y=Math.pow(1-$m,3)*$h.y+3*$P.y*$m*(1-$m)*(1-$m)+3*$L.y*$m*$m*(1-$m)+$q.y*Math.pow($m,3);$p.push($k,$Y);},$p.insertPoints=function($m,$p){var $h,$P=NaN;for($h=1/($m=0<$m?$m:5),$P=0;$P<=1;$P+=$h)this._calFun($P,$p);},$p.getBezierPoints=function($m,$p,$h){void 0===$p&&($p=5),void 0===$h&&($h=2);var $P,$L,$q=0;if(($P=$m.length)<2*($h+1))return[];switch($L=[],$h){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[];}for(;this._controlPoints.length<=$h;)this._controlPoints.push(new $I());for($q=0;$q<2*$h;$q+=2)this._switchPoint($m[$q],$m[$q+1]);for($q=2*$h;$q<$P;$q+=2)this._switchPoint($m[$q],$m[$q+1]),$q/2%$h==0&&this.insertPoints($p,$L);return $L;},$d($m,["I",function(){return this.I=new $m();}]),$m;}()),$H=function(){function $K(){}return $B($K,"laya.maths.GrahamScan"),$K.multiply=function($m,$p,$h){return($m.x-$h.x)*($p.y-$h.y)-($p.x-$h.x)*($m.y-$h.y);},$K.dis=function($m,$p){return($m.x-$p.x)*($m.x-$p.x)+($m.y-$p.y)*($m.y-$p.y);},$K._getPoints=function($m,$p,$h){for(void 0===$p&&($p=!1),$K._mPointList||($K._mPointList=[]);$K._mPointList.length<$m;)$K._mPointList.push(new $I());return $h||($h=[]),$h.length=0,$p?$K.getFrom($h,$K._mPointList,$m):$K.getFromR($h,$K._mPointList,$m),$h;},$K.getFrom=function($m,$p,$h){var $P=0;for($P=0;$P<$h;$P++)$m.push($p[$P]);return $m;},$K.getFromR=function($m,$p,$h){var $P=0;for($P=0;$P<$h;$P++)$m.push($p.pop());return $m;},$K.pListToPointList=function($m,$p){void 0===$p&&($p=!1);var $h=0,$P=$m.length/2,$L=$K._getPoints($P,$p,$K._tempPointList);for($h=0;$h<$P;$h++)$L[$h].setTo($m[$h+$h],$m[$h+$h+1]);return $L;},$K.pointListToPlist=function($m){var $p,$h=0,$P=$m.length,$L=$K._temPList;for($h=$L.length=0;$h<$P;$h++)$p=$m[$h],$L.push($p.x,$p.y);return $L;},$K.scanPList=function($m){return $g.copyArray($m,$K.pointListToPlist($K.scan($K.pListToPointList($m,!0))));},$K.scan=function($m){var $p,$h,$P,$L=0,$q=0,$k=0,$Y=$m.length,$d={};for(($h=$K._temArr).length=0,$L=($Y=$m.length)-1;0<=$L;$L--)$P=($p=$m[$L]).x+"_"+$p.y,$d.hasOwnProperty($P)||($d[$P]=!0,$h.push($p));for($Y=$h.length,$g.copyArray($m,$h),$L=1;$L<$Y;$L++)($m[$L].y<$m[$k].y||$m[$L].y==$m[$k].y&&$m[$L].x<$m[$k].x)&&($k=$L);for($p=$m[0],$m[0]=$m[$k],$m[$k]=$p,$L=1;$L<$Y-1;$L++){for($q=($k=$L)+1;$q<$Y;$q++)(0<$K.multiply($m[$q],$m[$k],$m[0])||0==$K.multiply($m[$q],$m[$k],$m[0])&&$K.dis($m[0],$m[$q])<$K.dis($m[0],$m[$k]))&&($k=$q);$p=$m[$L],$m[$L]=$m[$k],$m[$k]=$p;}if(($h=$K._temArr).length=0,$m.length<3)return $g.copyArray($h,$m);for($h.push($m[0],$m[1],$m[2]),$L=3;$L<$Y;$L++){for(;2<=$h.length&&0<=$K.multiply($m[$L],$h[$h.length-1],$h[$h.length-2]);)$h.pop();$m[$L]&&$h.push($m[$L]);}return $h;},$K._mPointList=null,$K._tempPointList=[],$K._temPList=[],$K._temArr=[],$K;}(),$W=function(){function $L(){}return $B($L,"laya.maths.MathUtil"),$L.subtractVector3=function($m,$p,$h){$h[0]=$m[0]-$p[0],$h[1]=$m[1]-$p[1],$h[2]=$m[2]-$p[2];},$L.lerp=function($m,$p,$h){return $m*(1-$h)+$p*$h;},$L.scaleVector3=function($m,$p,$h){$h[0]=$m[0]*$p,$h[1]=$m[1]*$p,$h[2]=$m[2]*$p;},$L.lerpVector3=function($m,$p,$h,$P){var $L=$m[0],$q=$m[1],$k=$m[2];$P[0]=$L+$h*($p[0]-$L),$P[1]=$q+$h*($p[1]-$q),$P[2]=$k+$h*($p[2]-$k);},$L.lerpVector4=function($m,$p,$h,$P){var $L=$m[0],$q=$m[1],$k=$m[2],$Y=$m[3];$P[0]=$L+$h*($p[0]-$L),$P[1]=$q+$h*($p[1]-$q),$P[2]=$k+$h*($p[2]-$k),$P[3]=$Y+$h*($p[3]-$Y);},$L.slerpQuaternionArray=function($m,$p,$h,$P,$L,$q,$k){var $Y,$d,$K,$D,$F,$R=$m[$p+0],$$=$m[$p+1],$A=$m[$p+2],$B=$m[$p+3],$n=$h[$P+0],$c=$h[$P+1],$e=$h[$P+2],$a=$h[$P+3];return($d=$R*$n+$$*$c+$A*$e+$B*$a)<0&&($d=-$d,$n=-$n,$c=-$c,$e=-$e,$a=-$a),$F=1e-6<1-$d?($Y=Math.acos($d),$K=Math.sin($Y),$D=Math.sin((1-$L)*$Y)/$K,Math.sin($L*$Y)/$K):($D=1-$L,$L),$q[$k+0]=$D*$R+$F*$n,$q[$k+1]=$D*$$+$F*$c,$q[$k+2]=$D*$A+$F*$e,$q[$k+3]=$D*$B+$F*$a,$q;},$L.getRotation=function($m,$p,$h,$P){return Math.atan2($P-$p,$h-$m)/Math.PI*180;},$L.sortBigFirst=function($m,$p){return $m==$p?0:$m<$p?1:-1;},$L.sortSmallFirst=function($m,$p){return $m==$p?0:$m<$p?-1:1;},$L.sortNumBigFirst=function($m,$p){return parseFloat($p)-parseFloat($m);},$L.sortNumSmallFirst=function($m,$p){return parseFloat($m)-parseFloat($p);},$L.sortByKey=function($h,$m,$p){var $P;return void 0===$m&&($m=!1),void 0===$p&&($p=!0),$P=$m?$p?$L.sortNumBigFirst:$L.sortBigFirst:$p?$L.sortNumSmallFirst:$L.sortSmallFirst,function($m,$p){return $P($m[$h],$p[$h]);};},$L;}(),$M=function(){function $h($m,$p,$h,$P,$L,$q){this.inPool=!1,this.bTransform=!1,void 0===$m&&($m=1),void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=1),void 0===$L&&($L=0),void 0===$q&&($q=0),this.a=$m,this.b=$p,this.c=$h,this.d=$P,this.tx=$L,this.ty=$q,this._checkTransform();}$B($h,"laya.maths.Matrix");var $m=$h.prototype;return $m.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this;},$m._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d;},$m.setTranslate=function($m,$p){return this.tx=$m,this.ty=$p,this;},$m.translate=function($m,$p){return this.tx+=$m,this.ty+=$p,this;},$m.scale=function($m,$p){this.a*=$m,this.d*=$p,this.c*=$m,this.b*=$p,this.tx*=$m,this.ty*=$p,this.bTransform=!0;},$m.rotate=function($m){var $p=Math.cos($m),$h=Math.sin($m),$P=this.a,$L=this.c,$q=this.tx;this.a=$P*$p-this.b*$h,this.b=$P*$h+this.b*$p,this.c=$L*$p-this.d*$h,this.d=$L*$h+this.d*$p,this.tx=$q*$p-this.ty*$h,this.ty=$q*$h+this.ty*$p,this.bTransform=!0;},$m.skew=function($m,$p){var $h=Math.tan($m),$P=Math.tan($p),$L=this.a,$q=this.b;return this.a+=$P*this.c,this.b+=$P*this.d,this.c+=$h*$L,this.d+=$h*$q,this;},$m.invertTransformPoint=function($m){var $p=this.a,$h=this.b,$P=this.c,$L=this.d,$q=this.tx,$k=$p*$L-$h*$P,$Y=$L/$k,$d=-$h/$k,$K=-$P/$k,$D=$p/$k,$F=($P*this.ty-$L*$q)/$k,$R=-($p*this.ty-$h*$q)/$k;return $m.setTo($Y*$m.x+$K*$m.y+$F,$d*$m.x+$D*$m.y+$R);},$m.transformPoint=function($m){return $m.setTo(this.a*$m.x+this.c*$m.y+this.tx,this.b*$m.x+this.d*$m.y+this.ty);},$m.transformPointN=function($m){return $m.setTo(this.a*$m.x+this.c*$m.y,this.b*$m.x+this.d*$m.y);},$m.transformPointArray=function($m,$p){for(var $h=$m.length,$P=0;$P<$h;$P+=2){var $L=$m[$P],$q=$m[$P+1];$p[$P]=this.a*$L+this.c*$q+this.tx,$p[$P+1]=this.b*$L+this.d*$q+this.ty;}return $p;},$m.transformPointArrayScale=function($m,$p){for(var $h=$m.length,$P=0;$P<$h;$P+=2){var $L=$m[$P],$q=$m[$P+1];$p[$P]=this.a*$L+this.c*$q,$p[$P+1]=this.b*$L+this.d*$q;}return $p;},$m.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b);},$m.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d);},$m.invert=function(){var $m=this.a,$p=this.b,$h=this.c,$P=this.d,$L=this.tx,$q=$m*$P-$p*$h;return this.a=$P/$q,this.b=-$p/$q,this.c=-$h/$q,this.d=$m/$q,this.tx=($h*this.ty-$P*$L)/$q,this.ty=-($m*this.ty-$p*$L)/$q,this;},$m.setTo=function($m,$p,$h,$P,$L,$q){return this.a=$m,this.b=$p,this.c=$h,this.d=$P,this.tx=$L,this.ty=$q,this;},$m.concat=function($m){var $p=this.a,$h=this.c,$P=this.tx;return this.a=$p*$m.a+this.b*$m.c,this.b=$p*$m.b+this.b*$m.d,this.c=$h*$m.a+this.d*$m.c,this.d=$h*$m.b+this.d*$m.d,this.tx=$P*$m.a+this.ty*$m.c+$m.tx,this.ty=$P*$m.b+this.ty*$m.d+$m.ty,this;},$m.scaleEx=function($m,$p){var $h=this.a,$P=this.b,$L=this.c,$q=this.d;0!==$P||0!==$L?(this.a=$m*$h,this.b=$m*$P,this.c=$p*$L):(this.a=$m*$h,this.b=0*$q,this.c=0*$h),this.d=$p*$q,this.bTransform=!0;},$m.rotateEx=function($m){var $p=Math.cos($m),$h=Math.sin($m),$P=this.a,$L=this.b,$q=this.c,$k=this.d;0!==$L||0!==$q?(this.a=$p*$P+$h*$q,this.b=$p*$L+$h*$k,this.c=-$h*$P+$p*$q,this.d=-$h*$L+$p*$k):(this.a=$p*$P,this.b=$h*$k,this.c=-$h*$P,this.d=$p*$k),this.bTransform=!0;},$m.clone=function(){var $m=$h.create();return $m.a=this.a,$m.b=this.b,$m.c=this.c,$m.d=this.d,$m.tx=this.tx,$m.ty=this.ty,$m.bTransform=this.bTransform,$m;},$m.copyTo=function($m){return $m.a=this.a,$m.b=this.b,$m.c=this.c,$m.d=this.d,$m.tx=this.tx,$m.ty=this.ty,$m.bTransform=this.bTransform,$m;},$m.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty;},$m.destroy=function(){if(!this.inPool){var $m=$h._cache;this.inPool=!0,$m._length||($m._length=0),($m[$m._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1;}},$h.mul=function($m,$p,$h){var $P=$m.a,$L=$m.b,$q=$m.c,$k=$m.d,$Y=$m.tx,$d=$m.ty,$K=$p.a,$D=$p.b,$F=$p.c,$R=$p.d,$$=$p.tx,$A=$p.ty;return 0!==$D||0!==$F?($h.a=$P*$K+$L*$F,$h.b=$P*$D+$L*$R,$h.c=$q*$K+$k*$F,$h.d=$q*$D+$k*$R,$h.tx=$K*$Y+$F*$d+$$,$h.ty=$D*$Y+$R*$d+$A):($h.a=$P*$K,$h.b=$L*$R,$h.c=$q*$K,$h.d=$k*$R,$h.tx=$K*$Y+$$,$h.ty=$R*$d+$A),$h;},$h.mul16=function($m,$p,$h){var $P=$m.a,$L=$m.b,$q=$m.c,$k=$m.d,$Y=$m.tx,$d=$m.ty,$K=$p.a,$D=$p.b,$F=$p.c,$R=$p.d,$$=$p.tx,$A=$p.ty;return 0!==$D||0!==$F?($h[0]=$P*$K+$L*$F,$h[1]=$P*$D+$L*$R,$h[4]=$q*$K+$k*$F,$h[5]=$q*$D+$k*$R,$h[12]=$K*$Y+$F*$d+$$,$h[13]=$D*$Y+$R*$d+$A):($h[0]=$P*$K,$h[1]=$L*$R,$h[4]=$q*$K,$h[5]=$k*$R,$h[12]=$K*$Y+$$,$h[13]=$R*$d+$A),$h;},$h.mulPre=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=$m.a,$K=$m.b,$D=$m.c,$F=$m.d,$R=$m.tx,$$=$m.ty;return 0!==$h||0!==$P?($Y.a=$d*$p+$K*$P,$Y.b=$d*$h+$K*$L,$Y.c=$D*$p+$F*$P,$Y.d=$D*$h+$F*$L,$Y.tx=$p*$R+$P*$$+$q,$Y.ty=$h*$R+$L*$$+$k):($Y.a=$d*$p,$Y.b=$K*$L,$Y.c=$D*$p,$Y.d=$F*$L,$Y.tx=$p*$R+$q,$Y.ty=$L*$$+$k),$Y;},$h.mulPos=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=$m.a,$K=$m.b,$D=$m.c,$F=$m.d,$R=$m.tx,$$=$m.ty;return 0!==$K||0!==$D?($Y.a=$p*$d+$h*$D,$Y.b=$p*$K+$h*$F,$Y.c=$P*$d+$L*$D,$Y.d=$P*$K+$L*$F,$Y.tx=$d*$q+$D*$k+$R,$Y.ty=$K*$q+$F*$k+$$):($Y.a=$p*$d,$Y.b=$h*$F,$Y.c=$P*$d,$Y.d=$L*$F,$Y.tx=$d*$q+$R,$Y.ty=$F*$k+$$),$Y;},$h.preMul=function($m,$p,$h){var $P=$m.a,$L=$m.b,$q=$m.c,$k=$m.d,$Y=$p.a,$d=$p.b,$K=$p.c,$D=$p.d,$F=$p.tx,$R=$p.ty;return $h.a=$Y*$P,$h.b=$h.c=0,$h.d=$D*$k,$h.tx=$F*$P+$m.tx,$h.ty=$R*$k+$m.ty,0===$d&&0===$K&&0===$L&&0===$q||($h.a+=$d*$q,$h.d+=$K*$L,$h.b+=$Y*$L+$d*$k,$h.c+=$K*$P+$D*$q,$h.tx+=$R*$q,$h.ty+=$F*$L),$h;},$h.preMulXY=function($m,$p,$h,$P){var $L=$m.a,$q=$m.b,$k=$m.c,$Y=$m.d;return $P.a=$L,$P.b=$q,$P.c=$k,$P.d=$Y,$P.tx=$p*$L+$m.tx+$h*$k,$P.ty=$h*$Y+$m.ty+$p*$q,$P;},$h.create=function(){var $m=$h._cache,$p=$m._length?$m[--$m._length]:new $h();return $p.inPool=!1,$p;},$h.EMPTY=new $h(),$h.TEMP=new $h(),$h._cache=[],$h;}(),$I=function(){function $m($m,$p){void 0===$m&&($m=0),void 0===$p&&($p=0),this.x=$m,this.y=$p;}$B($m,"laya.maths.Point");var $p=$m.prototype;return $p.setTo=function($m,$p){return this.x=$m,this.y=$p,this;},$p.distance=function($m,$p){return Math.sqrt((this.x-$m)*(this.x-$m)+(this.y-$p)*(this.y-$p));},$p.toString=function(){return this.x+","+this.y;},$p.normalize=function(){var $m=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$m){var $p=1/$m;this.x*=$p,this.y*=$p;}},$m.TEMP=new $m(),$m.EMPTY=new $m(),$m;}(),$b=function(){function $K($m,$p,$h,$P){void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0),this.x=$m,this.y=$p,this.width=$h,this.height=$P;}$B($K,"laya.maths.Rectangle");var $m=$K.prototype;return $m.setTo=function($m,$p,$h,$P){return this.x=$m,this.y=$p,this.width=$h,this.height=$P,this;},$m.copyFrom=function($m){return this.x=$m.x,this.y=$m.y,this.width=$m.width,this.height=$m.height,this;},$m.contains=function($m,$p){return!(this.width<=0||this.height<=0)&&$m>=this.x&&$m<this.right&&$p>=this.y&&$p<this.bottom;},$m.intersects=function($m){return!($m.x>this.x+this.width||$m.x+$m.width<this.x||$m.y>this.y+this.height||$m.y+$m.height<this.y);},$m.intersection=function($m,$p){return this.intersects($m)?($p||($p=new $K()),$p.x=Math.max(this.x,$m.x),$p.y=Math.max(this.y,$m.y),$p.width=Math.min(this.right,$m.right)-$p.x,$p.height=Math.min(this.bottom,$m.bottom)-$p.y,$p):null;},$m.union=function($m,$p){return $p||($p=new $K()),this.clone($p),$m.width<=0||$m.height<=0?$p:($p.addPoint($m.x,$m.y),$p.addPoint($m.right,$m.bottom),this);},$m.clone=function($m){return $m||($m=new $K()),$m.x=this.x,$m.y=this.y,$m.width=this.width,$m.height=this.height,$m;},$m.toString=function(){return this.x+","+this.y+","+this.width+","+this.height;},$m.equals=function($m){return!(!$m||$m.x!==this.x||$m.y!==this.y||$m.width!==this.width||$m.height!==this.height);},$m.addPoint=function($m,$p){return this.x>$m&&(this.width+=this.x-$m,this.x=$m),this.y>$p&&(this.height+=this.y-$p,this.y=$p),this.width<$m-this.x&&(this.width=$m-this.x),this.height<$p-this.y&&(this.height=$p-this.y),this;},$m._getBoundPoints=function(){var $m=$K._temB;return($m.length=0)==this.width||0==this.height||$m.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$m;},$m.isEmpty=function(){return this.width<=0||this.height<=0;},$D(0,$m,"right",function(){return this.x+this.width;}),$D(0,$m,"bottom",function(){return this.y+this.height;}),$K._getBoundPointS=function($m,$p,$h,$P){var $L=$K._temA;return($L.length=0)==$h||0==$P||$L.push($m,$p,$m+$h,$p,$m,$p+$P,$m+$h,$p+$P),$L;},$K._getWrapRec=function($m,$p){if(!$m||$m.length<1)return $p?$p.setTo(0,0,0,0):$K.TEMP.setTo(0,0,0,0);$p=$p||new $K();var $h,$P,$L,$q,$k,$Y=$m.length,$d=$I.TEMP;for($L=$k=-($P=$q=99999),$h=0;$h<$Y;$h+=2)$d.x=$m[$h],$d.y=$m[$h+1],$P=$P<$d.x?$P:$d.x,$q=$q<$d.y?$q:$d.y,$L=$L>$d.x?$L:$d.x,$k=$k>$d.y?$k:$d.y;return $p.setTo($P,$q,$L-$P,$k-$q);},$K.EMPTY=new $K(),$K.TEMP=new $K(),$K._temB=[],$K._temA=[],$K;}(),$x=function(){function $d(){}return $B($d,"laya.media.SoundManager"),$D(1,$d,"useAudioMusic",function(){return $d._useAudioMusic;},function($m){$d._useAudioMusic=$m,$d._musicClass=$m?$hm:null;}),$D(1,$d,"autoStopMusic",function(){return $d._autoStopMusic;},function($m){$E.stage.off("blur",null,$d._stageOnBlur),$E.stage.off("focus",null,$d._stageOnFocus),$E.stage.off("visibilitychange",null,$d._visibilityChange),($d._autoStopMusic=$m)&&($E.stage.on("blur",null,$d._stageOnBlur),$E.stage.on("focus",null,$d._stageOnFocus),$E.stage.on("visibilitychange",null,$d._visibilityChange));}),$D(1,$d,"muted",function(){return $d._muted;},function($m){$m!=$d._muted&&($m&&$d.stopAllSound(),$d.musicMuted=$m,$d._muted=$m);}),$D(1,$d,"musicMuted",function(){return $d._musicMuted;},function($m){$m!=$d._musicMuted&&($m?($d._tMusic&&$d._musicChannel&&!$d._musicChannel.isStopped?$d._musicChannel.pause():$d._musicChannel=null,$d._musicMuted=$m):($d._musicMuted=$m,$d._tMusic&&$d._musicChannel&&$d._musicChannel.resume()));}),$D(1,$d,"soundMuted",function(){return $d._soundMuted;},function($m){$d._soundMuted=$m;}),$d.addChannel=function($m){0<=$d._channels.indexOf($m)||($d._channels.push($m),$d.autoReleaseSound&&0!=$d._notUsedCount&&$d._notUsedUrls[$m.url]&&(delete $d._notUsedUrls[$m.url],0==--$d._notUsedCount&&$E.timer.clear($d,$d.disposeSoundIfNotUsed)));},$d.removeChannel=function($m){var $p=$d._channels,$h=$p.indexOf($m);if(-1!=$h&&($p.splice($h,1),$d.autoReleaseSound)){var $P=$m.url,$L=$d.defaultIntervals[$P]||2e4;if(0<$L){var $q=!0;for($h=$p.length-1;0<=$h;$h--)if($p[$h].url==$P){$q=!1;break;}$q&&($d._notUsedUrls[$P]=Date.now()+$L,0==$d._notUsedCount++&&$E.timer.loop(1e4,$d,$d.disposeSoundIfNotUsed));}}},$d.disposeSoundIfNotUsed=function(){var $m=$d._notUsedUrls;if(0!=$d._notUsedCount){var $p=Date.now();for(var $h in $m)$p>=$m[$h]&&(delete $m[$h],--$d._notUsedCount,$d.destroySound($h));if(0!=$d._notUsedCount)return;}$E.timer.clear($d,$d.disposeSoundIfNotUsed);},$d._visibilityChange=function(){$E.stage.isVisibility?$d._stageOnFocus():$d._stageOnBlur();},$d._stageOnBlur=function(){$d._isActive=!1,$d._musicChannel&&($d._musicChannel.isStopped||($d._blurPaused=!0,$d._musicChannel.pause())),$d.stopAllSound(),$E.stage.once("mousedown",null,$d._stageOnFocus);},$d._recoverWebAudio=function(){$qm.ctx&&"running"!=$qm.ctx.state&&$qm.ctx.resume&&$qm.ctx.resume();},$d._stageOnFocus=function(){if($d._isActive=!0,$d._recoverWebAudio(),$E.stage.off("mousedown",null,$d._stageOnFocus),$d._blurPaused){var $m=$d._musicChannel;$m&&$d._music&&$m.isStopped&&($d._blurPaused=!1,$d._music._disposed?$d.playMusic($m.url,$m.loops,$m.startHandler,$m.completeHandler,$m.startTime):$m.audioBuffer?$m.resume():$d._music.play($m.startTime,$m.loops,$m.startHandler,$m));}},$d.playSound=function($m,$p,$h,$P,$L,$q){if(void 0===$p&&($p=1),void 0===$q&&($q=0),!$m)return null;if($d._muted)return null;if($d._recoverWebAudio(),$m==$d._tMusic){if($d._musicMuted)return null;}else{if(!$d._isActive)return null;if($d._soundMuted)return null;}var $k,$Y=$d._pool[$m];return $L||($L=$d._soundClass),$Y||(($Y=new $L()).load($m),$d._pool[$m]=$Y),($k=$Y.play($q,$p,$h))?($m==$d._tMusic&&($d._music=$Y,$d._isActive||($d._blurPaused=!0,$k.pause())),$k.url=$m,$k.volume=$m==$d._tMusic?$d.musicVolume:$d.soundVolume,$k.completeHandler=$P,$k):null;},$d.destroySound=function($m){var $p=$d._pool[$m];$p&&(delete $d._pool[$m],$p.dispose());},$d.playMusic=function($m,$p,$h,$P,$L){return void 0===$p&&($p=0),void 0===$L&&($L=0),$d._tMusic=$m,$d._musicChannel&&$d._musicChannel.stop(),$d._musicChannel=$d.playSound($m,$p,$h,$P,null,$L);},$d.stopSound=function($m){for(var $p,$h=$d._channels.length-1;0<=$h;$h--)($p=$d._channels[$h]).url==$m&&$p.stop();},$d.stopAll=function(){$d._tMusic=null;var $m=0;for($m=$d._channels.length-1;0<=$m;$m--)$d._channels[$m].stop();},$d.stopAllSound=function(){var $m,$p=0;for($p=$d._channels.length-1;0<=$p;$p--)($m=$d._channels[$p]).url!=$d._tMusic&&$m.stop();},$d.stopMusic=function(){$d._musicChannel&&$d._musicChannel.stop(),$d._tMusic=null;},$d.setSoundVolume=function($m,$p){if($p)$d._setVolume($p,$m);else{$d.soundVolume=$m;var $h,$P=0;for($P=$d._channels.length-1;0<=$P;$P--)($h=$d._channels[$P]).url!=$d._tMusic&&($h.volume=$m);}},$d.setMusicVolume=function($m){$d.musicVolume=$m,$d._setVolume($d._tMusic,$m);},$d._setVolume=function($m,$p){for(var $h,$P=$d._channels.length-1;0<=$P;$P--)($h=$d._channels[$P]).url==$m&&($h.volume=$p);},$d.musicVolume=1,$d.soundVolume=1,$d.playbackRate=1,$d._useAudioMusic=!0,$d._muted=!1,$d._soundMuted=!1,$d._musicMuted=!1,$d._tMusic=null,$d._musicChannel=null,$d._music=null,$d._channels=[],$d._autoStopMusic=!1,$d._blurPaused=!1,$d._isActive=!0,$d._soundClass=null,$d._musicClass=null,$d.autoReleaseSound=!0,$d._pool={},$d.defaultIntervals={},$d._notUsedUrls={},$d._notUsedCount=0,$d;}(),$T=function(){var $m;function $h(){}return $B($h,"laya.net.LocalStorage"),$h.__init__=function(){$h._baseClass||($h._baseClass=$m).init(),$h.items=$h._baseClass.items,$h.support=$h._baseClass.support;},$h.setItem=function($m,$p){$h._baseClass.setItem($m,$p);},$h.getItem=function($m){return $h._baseClass.getItem($m);},$h.setJSON=function($m,$p){$h._baseClass.setJSON($m,$p);},$h.getJSON=function($m){return $h._baseClass.getJSON($m);},$h.removeItem=function($m){$h._baseClass.removeItem($m);},$h.clear=function(){$h._baseClass.clear();},$h._baseClass=null,$h.items=null,$h.support=!1,$h.__init$=function(){$m=function(){function $h(){}return $B($h,""),$h.init=function(){try{$h.support=!0,$h.items=$k.localStorage,$h.setItem("laya","1"),$h.removeItem("laya");}catch($m){$h.support=!1;}$h.support||console.log("LocalStorage is not supprot or browser is private mode.");},$h.setItem=function($m,$p){try{$h.support&&$h.items.setItem($m,$p);}catch($m){console.warn("set localStorage failed",$m);}},$h.getItem=function($m){return $h.support?$h.items.getItem($m):null;},$h.setJSON=function($m,$p){try{$h.support&&$h.items.setItem($m,JSON.stringify($p));}catch($m){console.warn("set localStorage failed",$m);}},$h.getJSON=function($m){return JSON.parse($h.support?$h.items.getItem($m):null);},$h.removeItem=function($m){$h.support&&$h.items.removeItem($m);},$h.clear=function(){$h.support&&$h.items.clear();},$h.items=null,$h.support=!1,$h;}();},$h;}(),$u=(function(){function $P(){}$B($P,"laya.net.ResourceVersion"),$P.enable=function($m,$p,$h){void 0===$h&&($h=2),laya.net.ResourceVersion.type=$h,$E.loader.load($m,$e.create(null,$P.onManifestLoaded,[$p]),null,"json"),$N.customFormat=$P.addVersionPrefix;},$P.onManifestLoaded=function($m,$p){$P.manifest=$p,$m.run(),$p||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。");},$P.addVersionPrefix=function($m){return $P.manifest&&$P.manifest[$m]?2==$P.type?$P.manifest[$m]:$P.manifest[$m]+"/"+$m:$m;},$P.FOLDER_VERSION=1,$P.FILENAME_VERSION=2,$P.manifest=null,$P.type=1;}(),function(){function $m(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null;}$B($m,"laya.net.TTFLoader");var $p=$m.prototype;return $p.load=function($m){var $p=(this._url=$m).split(".ttf")[0].split("/");this.fontName=$p[$p.length-1],$w.window.conch?this._loadConch():$w.window.FontFace?this._loadWithFontFace():this._loadWithCSS();},$p._loadConch=function(){this._http=new $km(),this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer");},$p._onHttpLoaded=function($m){$w.window.conch.setFontFaceFromBuffer(this.fontName,$m),this._clearHttp(),this._complete();},$p._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null);},$p._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null);},$p._complete=function(){$E.timer.clear(this,this._complete),$E.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null);},$p._checkComplete=function(){$Q.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete();},$p._loadWithFontFace=function(){var $m=new $w.window.FontFace(this.fontName,"url('"+this._url+"')");$w.window.document.fonts.add($m);var $p=this;$m.loaded.then(function(){$p._complete();}),$m.load();},$p._createDiv=function(){this._div=$w.createElement("div"),this._div.innerHTML="laya";var $m=this._div.style;$m.fontFamily=this.fontName,$m.position="absolute",$m.left="-100px",$m.top="-100px",$w.document.body.appendChild(this._div);},$p._loadWithCSS=function(){var $m=this,$p=$w.createElement("style");$p.type="text/css",$w.document.body.appendChild($p),$p.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$Q.measureText("LayaTTFFont",this._fontTxt).width;var $h=this;$p.onload=function(){$E.timer.once(1e4,$h,$m._complete);},$E.timer.loop(20,this,this._checkComplete),this._createDiv();},$m._testString="LayaTTFFont",$m;}()),$N=function(){function $P($m){this._url=null,this._path=null,this._url=$P.formatURL($m),this._path=$P.getPath($m);}$B($P,"laya.net.URL");var $m=$P.prototype;return $D(0,$m,"path",function(){return this._path;}),$D(0,$m,"url",function(){return this._url;}),$P.formatURL=function($m,$p){if(!$m)return"null path";if(0<$m.indexOf(":"))return $m;null!=$P.customFormat&&($m=$P.customFormat($m,$p));var $h=$m.charAt(0);if("."===$h)return $P.formatRelativePath(($p||$P.basePath)+$m);if("~"===$h)return $P.rootPath+$m.substring(1);if("d"===$h){if(0===$m.indexOf("data:image"))return $m;}else if("/"===$h)return $m;return($p||$P.basePath)+$m;},$P.formatRelativePath=function($m){for(var $p=$m.split("/"),$h=0,$P=$p.length;$h<$P;$h++)".."==$p[$h]&&($p.splice($h-1,2),$h-=2);return $p.join("/");},$P.isAbsolute=function($m){return 0<$m.indexOf(":")||"/"==$m.charAt(0);},$P.getPath=function($m){var $p=$m.lastIndexOf("/");return 0<$p?$m.substr(0,$p+1):"";},$P.getFileName=function($m){var $p=$m.lastIndexOf("/");return 0<$p?$m.substr($p+1):$m;},$P.version={},$P.basePath="",$P.rootPath="",$P.customFormat=function($m){var $p=$P.version[$m];return!$S.isConchApp&&$p&&($m+="?v="+$p),$m;},$P;}(),$S=function(){function $L($m,$p){this._timeId=0;var $h=$L._mainCanvas.source.style;$h.position="absolute",$h.top=$h.left="0px",$h.background="#000000",$L._mainCanvas.source.id="layaCanvas";var $P=laya.renders.Render.isWebGL;$L._mainCanvas.source.width=$m,$L._mainCanvas.source.height=$p,$P&&$L.WebGL.init($L._mainCanvas,$m,$p),$w.container.appendChild($L._mainCanvas.source),($L._context=new $_($m,$p,$P?null:$L._mainCanvas)).ctx.setIsMainContext(),$w.window.requestAnimationFrame(function $m($p){$w.window.requestAnimationFrame($m);$E.stage._loop();}),$E.stage.on("visibilitychange",this,this._onVisibilitychange);}$B($L,"laya.renders.Render");var $m=$L.prototype;return $m._onVisibilitychange=function(){$E.stage.isVisibility?0!=this._timeId&&$w.window.clearInterval(this._timeId):this._timeId=$w.window.setInterval(this._enterFrame,1e3);},$m._enterFrame=function($m){$E.stage._loop();},$D(1,$L,"context",function(){return $L._context;}),$D(1,$L,"canvas",function(){return $L._mainCanvas.source;}),$L._context=null,$L._mainCanvas=null,$L.WebGL=null,$L.isConchNode=!1,$L.isConchApp=!1,$L.isConchWebGL=!1,$L.isWebGL=!1,$L.is3DMode=!1,$L.optimizeTextureMemory=function($m,$p){return!0;},$L.__init$=function(){$k.ConchRenderType=$k.ConchRenderType||1,$k.ConchRenderType|=$k.conch?4:0,$L.isConchNode=5==(5&$k.ConchRenderType),$L.isConchApp=4==(4&$k.ConchRenderType),$L.isConchWebGL=6==$k.ConchRenderType;},$L;}(),$_=function(){function $k($m,$p,$h){this.x=0,this.y=0,this._drawTexture=function($m,$p,$h){$h[0].loaded&&this.ctx.drawTexture($h[0],$h[1],$h[2],$h[3],$h[4],$m,$p);},this._fillTexture=function($m,$p,$h){$h[0].loaded&&this.ctx.fillTexture($h[0],$h[1]+$m,$h[2]+$p,$h[3],$h[4],$h[5],$h[6],$h[7]);},this._drawTextureWithTransform=function($m,$p,$h){$h[0].loaded&&this.ctx.drawTextureWithTransform($h[0],$h[1],$h[2],$h[3],$h[4],$h[5],$m,$p,$h[6]);},this._fillQuadrangle=function($m,$p,$h){this.ctx.fillQuadrangle($h[0],$h[1],$h[2],$h[3],$h[4]);},this._drawRect=function($m,$p,$h){var $P=this.ctx;null!=$h[4]&&($P.fillStyle=$h[4],$P.fillRect($m+$h[0],$p+$h[1],$h[2],$h[3],null)),null!=$h[5]&&($P.strokeStyle=$h[5],$P.lineWidth=$h[6],$P.strokeRect($m+$h[0],$p+$h[1],$h[2],$h[3],$h[6]));},this._drawPie=function($m,$p,$h){var $P=this.ctx;$S.isWebGL&&$P.setPathId($h[8]),$P.beginPath(),$S.isWebGL?($P.movePath($h[0]+$m,$h[1]+$p),$P.moveTo(0,0)):$P.moveTo($m+$h[0],$p+$h[1]),$P.arc($m+$h[0],$p+$h[1],$h[2],$h[3],$h[4]),$P.closePath(),this._fillAndStroke($h[5],$h[6],$h[7],!0);},this._clipRect=function($m,$p,$h){this.ctx.clipRect($m+$h[0],$p+$h[1],$h[2],$h[3]);},this._fillRect=function($m,$p,$h){this.ctx.fillRect($m+$h[0],$p+$h[1],$h[2],$h[3],$h[4]);},this._drawCircle=function($m,$p,$h){var $P=this.ctx;$S.isWebGL&&$P.setPathId($h[6]),$f.drawCall++,$P.beginPath(),$S.isWebGL&&$P.movePath($h[0]+$m,$h[1]+$p),$P.arc($h[0]+$m,$h[1]+$p,$h[2],0,$k.PI2),$P.closePath(),this._fillAndStroke($h[3],$h[4],$h[5],!0);},this._fillCircle=function($m,$p,$h){$f.drawCall++;var $P=this.ctx;$P.beginPath(),$P.fillStyle=$h[3],$P.arc($h[0]+$m,$h[1]+$p,$h[2],0,$k.PI2),$P.fill();},this._setShader=function($m,$p,$h){this.ctx.setShader($h[0]);},this._drawLine=function($m,$p,$h){var $P=this.ctx;$S.isWebGL&&$P.setPathId($h[6]),$P.beginPath(),$P.strokeStyle=$h[4],$P.lineWidth=$h[5],$S.isWebGL?($P.movePath($m,$p),$P.moveTo($h[0],$h[1]),$P.lineTo($h[2],$h[3])):($P.moveTo($m+$h[0],$p+$h[1]),$P.lineTo($m+$h[2],$p+$h[3])),$P.stroke();},this._drawLines=function($m,$p,$h){var $P=this.ctx;$S.isWebGL&&$P.setPathId($h[5]),$P.beginPath(),$m+=$h[0],$p+=$h[1],$S.isWebGL&&$P.movePath($m,$p),$P.strokeStyle=$h[3],$P.lineWidth=$h[4];var $L=$h[2],$q=2,$k=$L.length;if($S.isWebGL)for($P.moveTo($L[0],$L[1]);$q<$k;)$P.lineTo($L[$q++],$L[$q++]);else for($P.moveTo($m+$L[0],$p+$L[1]);$q<$k;)$P.lineTo($m+$L[$q++],$p+$L[$q++]);$P.stroke();},this._drawLinesWebGL=function($m,$p,$h){this.ctx.drawLines($m+this.x+$h[0],$p+this.y+$h[1],$h[2],$h[3],$h[4]);},this._drawCurves=function($m,$p,$h){this.ctx.drawCurves($m,$p,$h);},this._draw=function($m,$p,$h){$h[0].call(null,this,$m,$p);},this._transformByMatrix=function($m,$p,$h){this.ctx.transformByMatrix($h[0]);},this._setTransform=function($m,$p,$h){this.ctx.setTransform($h[0],$h[1],$h[2],$h[3],$h[4],$h[5]);},this._setTransformByMatrix=function($m,$p,$h){this.ctx.setTransformByMatrix($h[0]);},this._save=function($m,$p,$h){this.ctx.save();},this._restore=function($m,$p,$h){this.ctx.restore();},this._translate=function($m,$p,$h){this.ctx.translate($h[0],$h[1]);},this._transform=function($m,$p,$h){this.ctx.translate($h[1]+$m,$h[2]+$p);var $P=$h[0];this.ctx.transform($P.a,$P.b,$P.c,$P.d,$P.tx,$P.ty),this.ctx.translate(-$m-$h[1],-$p-$h[2]);},this._rotate=function($m,$p,$h){this.ctx.translate($h[1]+$m,$h[2]+$p),this.ctx.rotate($h[0]),this.ctx.translate(-$m-$h[1],-$p-$h[2]);},this._scale=function($m,$p,$h){this.ctx.translate($h[2]+$m,$h[3]+$p),this.ctx.scale($h[0],$h[1]),this.ctx.translate(-$m-$h[2],-$p-$h[3]);},this._alpha=function($m,$p,$h){this.ctx.globalAlpha*=$h[0];},this._setAlpha=function($m,$p,$h){this.ctx.globalAlpha=$h[0];},this._fillText=function($m,$p,$h){this.ctx.fillText($h[0],$h[1]+$m,$h[2]+$p,$h[3],$h[4],$h[5]);},this._strokeText=function($m,$p,$h){this.ctx.strokeText($h[0],$h[1]+$m,$h[2]+$p,$h[3],$h[4],$h[5],$h[6]);},this._fillBorderText=function($m,$p,$h){this.ctx.fillBorderText($h[0],$h[1]+$m,$h[2]+$p,$h[3],$h[4],$h[5],$h[6],$h[7]);},this._blendMode=function($m,$p,$h){this.ctx.globalCompositeOperation=$h[0];},this._beginClip=function($m,$p,$h){this.ctx.beginClip&&this.ctx.beginClip($m+$h[0],$p+$h[1],$h[2],$h[3]);},this._setIBVB=function($m,$p,$h){this.ctx.setIBVB($h[0]+$m,$h[1]+$p,$h[2],$h[3],$h[4],$h[5],$h[6],$h[7]);},this._fillTrangles=function($m,$p,$h){this.ctx.fillTrangles($h[0],$h[1]+$m,$h[2]+$p,$h[3],$h[4]);},this._drawPath=function($m,$p,$h){var $P=this.ctx;$S.isWebGL&&$P.setPathId(-1),$P.beginPath(),$m+=$h[0],$p+=$h[1],$S.isWebGL&&$P.movePath($m,$p);for(var $L=$h[2],$q=0,$k=$L.length;$q<$k;$q++){var $Y=$L[$q];switch($Y[0]){case"moveTo":$S.isWebGL?$P.moveTo($Y[1],$Y[2]):$P.moveTo($m+$Y[1],$p+$Y[2]);break;case"lineTo":$S.isWebGL?$P.lineTo($Y[1],$Y[2]):$P.lineTo($m+$Y[1],$p+$Y[2]);break;case"arcTo":$S.isWebGL?$P.arcTo($Y[1],$Y[2],$Y[3],$Y[4],$Y[5]):$P.arcTo($m+$Y[1],$p+$Y[2],$m+$Y[3],$p+$Y[4],$Y[5]);break;case"closePath":$P.closePath();}}var $d=$h[3];null!=$d&&($P.fillStyle=$d.fillStyle,$P.fill());var $K=$h[4];null!=$K&&($P.strokeStyle=$K.strokeStyle,$P.lineWidth=$K.lineWidth||1,$P.lineJoin=$K.lineJoin,$P.lineCap=$K.lineCap,$P.miterLimit=$K.miterLimit,$P.stroke());},this.drawPoly=function($m,$p,$h){this.ctx.drawPoly($m+this.x+$h[0],$p+this.y+$h[1],$h[2],$h[3],$h[4],$h[5],$h[6]);},this._drawPoly=function($m,$p,$h){var $P=this.ctx,$L=$h[2],$q=2,$k=$L.length;if($S.isWebGL)for($P.setPathId($h[6]),$P.beginPath(),$m+=$h[0],$p+=$h[1],$P.movePath($m,$p),$P.moveTo($L[0],$L[1]);$q<$k;)$P.lineTo($L[$q++],$L[$q++]);else for($P.beginPath(),$m+=$h[0],$p+=$h[1],$P.moveTo($m+$L[0],$p+$L[1]);$q<$k;)$P.lineTo($m+$L[$q++],$p+$L[$q++]);$P.closePath(),this._fillAndStroke($h[3],$h[4],$h[5],$h[7]);},this._drawSkin=function($m,$p,$h){var $P=$h[0];if($P){var $L=this.ctx;$P.render($L,$m,$p);}},this._drawParticle=function($m,$p,$h){this.ctx.drawParticle($m+this.x,$p+this.y,$h[0]);},this._setFilters=function($m,$p,$h){this.ctx.setFilters($h);},$h?this.ctx=$h.getContext("2d"):($h=$am.create("3D"),this.ctx=$Q.createWebGLContext2D($h),$h._setContext(this.ctx)),$h.size($m,$p),this.canvas=$h;}$B($k,"laya.renders.RenderContext");var $m=$k.prototype;return $m.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null);},$m.drawTexture=function($m,$p,$h,$P,$L){$m.loaded&&this.ctx.drawTexture($m,$p,$h,$P,$L,this.x,this.y);},$m._drawTextures=function($m,$p,$h){$h[0].loaded&&this.ctx.drawTextures($h[0],$h[1],$m+this.x,$p+this.y);},$m.drawTextureWithTransform=function($m,$p,$h,$P,$L,$q,$k){$m.loaded&&this.ctx.drawTextureWithTransform($m,$p,$h,$P,$L,$q,this.x,this.y,$k);},$m.fillQuadrangle=function($m,$p,$h,$P,$L){this.ctx.fillQuadrangle($m,$p,$h,$P,$L);},$m.drawCanvas=function($m,$p,$h,$P,$L){this.ctx.drawCanvas($m,$p+this.x,$h+this.y,$P,$L);},$m.drawRect=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=1);var $k=this.ctx;$k.strokeStyle=$L,$k.lineWidth=$q,$k.strokeRect($m+this.x,$p+this.y,$h,$P,$q);},$m._fillAndStroke=function($m,$p,$h,$P){void 0===$P&&($P=!1);var $L=this.ctx;null!=$m&&($L.fillStyle=$m,$S.isWebGL?$L.fill($P):$L.fill()),null!=$p&&0<$h&&($L.strokeStyle=$p,$L.lineWidth=$h,$L.stroke());},$m.clipRect=function($m,$p,$h,$P){this.ctx.clipRect($m+this.x,$p+this.y,$h,$P);},$m.fillRect=function($m,$p,$h,$P,$L){this.ctx.fillRect($m+this.x,$p+this.y,$h,$P,$L);},$m.drawCircle=function($m,$p,$h,$P,$L){void 0===$L&&($L=1),$f.drawCall++;var $q=this.ctx;$q.beginPath(),$q.strokeStyle=$P,$q.lineWidth=$L,$q.arc($m+this.x,$p+this.y,$h,0,$k.PI2),$q.stroke();},$m.drawTriangles=function($m,$p,$h){if($S.isWebGL)this.ctx.drawTriangles($h[0],$m+$h[1],$p+$h[2],$h[3],$h[4],$h[5],$h[6],$h[7],$h[8],$h[9]);else{var $P=$h[5],$L=0,$q=$P.length,$k=this.ctx;for($L=0;$L<$q;$L+=3){var $Y=2*$P[$L],$d=2*$P[$L+1],$K=2*$P[$L+2];$k.drawTriangle($h[0],$h[3],$h[4],$Y,$d,$K,$h[6],!0);}}},$m.fillCircle=function($m,$p,$h,$P){$f.drawCall++;var $L=this.ctx;$L.beginPath(),$L.fillStyle=$P,$L.arc($m+this.x,$p+this.y,$h,0,$k.PI2),$L.fill();},$m.setShader=function($m){this.ctx.setShader($m);},$m.drawLine=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=1);var $k=this.ctx;$k.beginPath(),$k.strokeStyle=$L,$k.lineWidth=$q,$k.moveTo(this.x+$m,this.y+$p),$k.lineTo(this.x+$h,this.y+$P),$k.stroke();},$m.clear=function(){this.ctx.clear();},$m.transformByMatrix=function($m){this.ctx.transformByMatrix($m);},$m.setTransform=function($m,$p,$h,$P,$L,$q){this.ctx.setTransform($m,$p,$h,$P,$L,$q);},$m.setTransformByMatrix=function($m){this.ctx.setTransformByMatrix($m);},$m.save=function(){this.ctx.save();},$m.restore=function(){this.ctx.restore();},$m.translate=function($m,$p){this.ctx.translate($m,$p);},$m.transform=function($m,$p,$h,$P,$L,$q){this.ctx.transform($m,$p,$h,$P,$L,$q);},$m.rotate=function($m){this.ctx.rotate($m);},$m.scale=function($m,$p){this.ctx.scale($m,$p);},$m.alpha=function($m){this.ctx.globalAlpha*=$m;},$m.setAlpha=function($m){this.ctx.globalAlpha=$m;},$m.fillWords=function($m,$p,$h,$P,$L,$q){void 0===$q&&($q=0),this.ctx.fillWords($m,$p,$h,$P,$L,$q);},$m.fillBorderWords=function($m,$p,$h,$P,$L,$q,$k){this.ctx.fillBorderWords($m,$p,$h,$P,$L,$q,$k);},$m.fillText=function($m,$p,$h,$P,$L,$q){this.ctx.fillText($m,$p+this.x,$h+this.y,$P,$L,$q);},$m.strokeText=function($m,$p,$h,$P,$L,$q,$k){this.ctx.strokeText($m,$p+this.x,$h+this.y,$P,$L,$q,$k);},$m.blendMode=function($m){this.ctx.globalCompositeOperation=$m;},$m.flush=function(){this.ctx.flush&&this.ctx.flush();},$m.addRenderObject=function($m){this.ctx.addRenderObject($m);},$m.beginClip=function($m,$p,$h,$P){this.ctx.beginClip&&this.ctx.beginClip($m,$p,$h,$P);},$m.endClip=function(){this.ctx.endClip&&this.ctx.endClip();},$m.fillTrangles=function($m,$p,$h){this.ctx.fillTrangles($h[0],$h[1],$h[2],$h[3],4<$h.length?$h[4]:null);},$k.PI2=2*Math.PI,$k;}(),$l=function(){function $k($m,$p){switch(this._next=$p||$k.NORENDER,$m){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$c._filter);case 69905:return void(this._fun=$k._initRenderFun);}this.onCreate($m);}$B($k,"laya.renders.RenderSprite");var $m=$k.prototype;return $m.onCreate=function($m){},$m._style=function($m,$p,$h,$P){$m._style.render($m,$p,$h,$P);var $L=this._next;$L._fun.call($L,$m,$p,$h,$P);},$m._no=function($m,$p,$h,$P){},$m._custom=function($m,$p,$h,$P){$m.customRender($p,$h,$P);var $L=$m._style._tf;this._next._fun.call(this._next,$m,$p,$h-$L.translateX,$P-$L.translateY);},$m._clip=function($m,$p,$h,$P){var $L=this._next;if($L!=$k.NORENDER){var $q=$m._style.scrollRect;$p.ctx.save(),$p.ctx.clipRect($h,$P,$q.width,$q.height),$L._fun.call($L,$m,$p,$h-$q.x,$P-$q.y),$p.ctx.restore();}},$m._blend=function($m,$p,$h,$P){var $L=$m._style;$L.blendMode&&($p.ctx.globalCompositeOperation=$L.blendMode);var $q=this._next;$q._fun.call($q,$m,$p,$h,$P),$p.ctx.globalCompositeOperation="source-over";},$m._mask=function($m,$p,$h,$P){var $L=this._next;$L._fun.call($L,$m,$p,$h,$P);var $q=$m.mask;$q&&($p.ctx.globalCompositeOperation="destination-in",(0<$q.numChildren||!$q.graphics._isOnlyOne())&&($q.cacheAsBitmap=!0),$q.render($p,$h-$m.pivotX,$P-$m.pivotY)),$p.ctx.globalCompositeOperation="source-over";},$m._graphics=function($m,$p,$h,$P){var $L=$m._style._tf;$m._graphics&&$m._graphics._render($m,$p,$h-$L.translateX,$P-$L.translateY);var $q=this._next;$q._fun.call($q,$m,$p,$h,$P);},$m._image=function($m,$p,$h,$P){var $L=$m._style;$p.ctx.drawTexture2($h,$P,$L._tf.translateX,$L._tf.translateY,$m.transform,$L.alpha,$L.blendMode,$m._graphics._one);},$m._image2=function($m,$p,$h,$P){var $L=$m._style._tf;$p.ctx.drawTexture2($h,$P,$L.translateX,$L.translateY,$m.transform,1,null,$m._graphics._one);},$m._alpha=function($m,$p,$h,$P){var $L;if(.01<($L=$m._style.alpha)||$m._needRepaint()){var $q=$p.ctx.globalAlpha;$p.ctx.globalAlpha*=$L;var $k=this._next;$k._fun.call($k,$m,$p,$h,$P),$p.ctx.globalAlpha=$q;}},$m._transform=function($m,$p,$h,$P){var $L=$m.transform,$q=this._next;$L&&$q!=$k.NORENDER?($p.save(),$p.transform($L.a,$L.b,$L.c,$L.d,$L.tx+$h,$L.ty+$P),$q._fun.call($q,$m,$p,0,0),$p.restore()):$q._fun.call($q,$m,$p,$h,$P);},$m._childs=function($m,$p,$h,$P){var $L=$m._style,$q=$L._tf;if($h=$h-$q.translateX+$L.paddingLeft,$P=$P-$q.translateY+$L.paddingTop,$L._calculation){var $k=$m._getWords();if($k){var $Y=$L;$Y&&($Y.stroke?$p.fillBorderWords($k,$h,$P,$Y.font,$Y.color,$Y.strokeColor,$Y.stroke):$p.fillWords($k,$h,$P,$Y.font,$Y.color,"none"!=$Y.textDecoration&&$Y.underLine?1:0));}}var $d,$K=$m._childs,$D=$K.length;if($m.viewport||$m.optimizeScrollRect&&$m._style.scrollRect){var $F=$m.viewport||$m._style.scrollRect,$R=$F.x,$$=$F.y,$A=$F.right,$B=$F.bottom,$n=NaN,$c=NaN;for($e=0;$e<$D;++$e)($d=$K[$e]).visible&&($n=$d._x)<$A&&$n+$d.width>$R&&($c=$d._y)<$B&&$c+$d.height>$$&&$d.render($p,$h,$P);}else for(var $e=0;$e<$D;++$e)($d=$K[$e])._style.visible&&$d.render($p,$h,$P);},$m._canvas=function($m,$p,$h,$P){var $L=$m._$P.cacheCanvas;if($L){"bitmap"===$L.type?$f.canvasBitmap++:$f.canvasNormal++;var $q=$L.ctx;if($m._needRepaint()||!$q)this._canvas_repaint($m,$p,$h,$P);else{var $k=$L._cacheRec;$p.drawCanvas($q.canvas,$h+$k.x,$P+$k.y,$k.width,$k.height);}}else this._next._fun.call(this._next,$m,$p,$h,$P);},$m._canvas_repaint=function($m,$p,$h,$P){var $L=$m._$P.cacheCanvas,$q=this._next;if($L){var $k,$Y,$d,$K,$D=$L.ctx,$F=$m._needRepaint()||!$D,$R=$L.type;if("bitmap"===$R?$f.canvasBitmap++:$f.canvasNormal++,$F){var $$,$A;$L._cacheRec||($L._cacheRec=new $b()),$S.isWebGL&&"bitmap"!==$R?$L._cacheRec.setTo(-$m.pivotX,-$m.pivotY,1,1):(($K=$m.getSelfBounds()).x=$K.x-$m.pivotX,$K.y=$K.y-$m.pivotY,$K.x=$K.x-16,$K.y=$K.y-16,$K.width=$K.width+32,$K.height=$K.height+32,$K.x=Math.floor($K.x+$h)-$h,$K.y=Math.floor($K.y+$P)-$P,$K.width=Math.floor($K.width),$K.height=Math.floor($K.height),$L._cacheRec.copyFrom($K)),$K=$L._cacheRec;var $B,$n=$S.isWebGL?1:$w.pixelRatio*$E.stage.clientScaleX,$c=$S.isWebGL?1:$w.pixelRatio*$E.stage.clientScaleY;if(!$S.isWebGL){var $e,$a=1,$Z=1;for($e=$m;$e&&$e!=$E.stage;)$a*=$e.scaleX,$Z*=$e.scaleY,$e=$e.parent;$S.isWebGL?($a<1&&($n*=$a),$Z<1&&($c*=$Z)):(1<$a&&($n*=$a),1<$Z&&($c*=$Z));}if($m.scrollRect){var $H=$m.scrollRect;$K.x-=$H.x,$K.y-=$H.y;}if($$=$K.width*$n,$A=$K.height*$c,$Y=$K.x,$d=$K.y,$S.isWebGL&&"bitmap"===$R&&(2048<$$||2048<$A))return console.warn("cache bitmap size larger than 2048,cache ignored"),$L.ctx&&($o.recover("RenderContext",$L.ctx),$L.ctx.canvas.size(0,0),$L.ctx=null),void $q._fun.call($q,$m,$p,$h,$P);if($D||($D=$L.ctx=$o.getItem("RenderContext")||new $_($$,$A,$am.create("AUTO"))),$D.ctx.sprite=$m,($k=$D.canvas).clear(),($k.width!=$$||$k.height!=$A)&&$k.size($$,$A),"bitmap"===$R?$k.context.asBitmap=!0:"normal"===$R&&($k.context.asBitmap=!1),1!=$n||1!=$c){var $W=$D.ctx;$W.save(),$W.scale($n,$c),!$S.isConchWebGL&&$S.isConchApp&&($B=$m._$P.cf)&&$W.setFilterMatrix&&$W.setFilterMatrix($B._mat,$B._alpha),$q._fun.call($q,$m,$D,-$Y,-$d),$W.restore(),$S.isConchApp&&!$S.isConchWebGL||$m._applyFilters();}else $W=$D.ctx,!$S.isConchWebGL&&$S.isConchApp&&($B=$m._$P.cf)&&$W.setFilterMatrix&&$W.setFilterMatrix($B._mat,$B._alpha),$q._fun.call($q,$m,$D,-$Y,-$d),$S.isConchApp&&!$S.isConchWebGL||$m._applyFilters();$m._$P.staticCache&&($L.reCache=!1),$f.canvasReCache++;}else $Y=($K=$L._cacheRec).x,$d=$K.y,$k=$D.canvas;$p.drawCanvas($k,$h+$Y,$P+$d,$K.width,$K.height);}else $q._fun.call($q,$m,$D,$h,$P);},$k.__init__=function(){var $m,$p,$h=0;for($p=$Q.createRenderSprite(69905,null),$m=$k.renders.length=4096,$h=0;$h<$m;$h++)$k.renders[$h]=$p;$k.renders[0]=$Q.createRenderSprite(0,null),function($m,$p){for(var $h=0,$P=0;$P<$m.length;$P++)$h|=$m[$P],$k.renders[$h]=$p;}([1,512,4,2],new $k(1,null)),$k.renders[513]=$Q.createRenderSprite(513,null),$k.renders[517]=new $k(517,null);},$k._initRenderFun=function($m,$p,$h,$P){var $L=$m._renderType;($k.renders[$L]=$k._getTypeRender($L))._fun($m,$p,$h,$P);},$k._getTypeRender=function($m){for(var $p=null,$h=2048;1<$h;)$h&$m&&($p=$Q.createRenderSprite($h,$p)),$h>>=1;return $p;},$k.IMAGE=1,$k.ALPHA=2,$k.TRANSFORM=4,$k.BLEND=8,$k.CANVAS=16,$k.FILTERS=32,$k.MASK=64,$k.CLIP=128,$k.STYLE=256,$k.GRAPHICS=512,$k.CUSTOM=1024,$k.CHILDS=2048,$k.INIT=69905,$k.renders=[],$k.NORENDER=new $k(0,null),$k;}(),$J=function(){function $Y(){this._repaint=!1;}$B($Y,"laya.resource.Context");var $m=$Y.prototype;return $m.replaceReset=function(){var $m,$p,$h=0;for($m=$Y.replaceKeys.length,$h=0;$h<$m;$h++)$p=$Y.replaceKeys[$h],this[$Y.newKeys[$h]]=this[$p];},$m.replaceResotre=function(){this.__restore(),this.__reset();},$m.setIsMainContext=function(){},$m.drawTextures=function($m,$p,$h,$P){$f.drawCall+=$p.length/2;for(var $L=$m.width,$q=$m.height,$k=0,$Y=$p.length;$k<$Y;$k+=2)this.drawTexture($m,$p[$k],$p[$k+1],$L,$q,$h,$P);},$m.drawCanvas=function($m,$p,$h,$P,$L){$f.drawCall++,this.drawImage($m.source,$p,$h,$P,$L);},$m.fillRect=function($m,$p,$h,$P,$L){$f.drawCall++,$L&&(this.fillStyle=$L),this.__fillRect($m,$p,$h,$P);},$m.fillText=function($m,$p,$h,$P,$L,$q){$f.drawCall++,3<arguments.length&&null!=$P&&(this.font=$P,this.fillStyle=$L,this.textAlign=$q,this.textBaseline="top"),this.__fillText($m,$p,$h);},$m.fillBorderText=function($m,$p,$h,$P,$L,$q,$k,$Y){$f.drawCall++,this.font=$P,this.fillStyle=$L,this.textBaseline="top",this.strokeStyle=$q,this.lineWidth=$k,this.textAlign=$Y,this.__strokeText($m,$p,$h),this.__fillText($m,$p,$h);},$m.strokeText=function($m,$p,$h,$P,$L,$q,$k){$f.drawCall++,3<arguments.length&&null!=$P&&(this.font=$P,this.strokeStyle=$L,this.lineWidth=$q,this.textAlign=$k,this.textBaseline="top"),this.__strokeText($m,$p,$h);},$m.transformByMatrix=function($m){this.transform($m.a,$m.b,$m.c,$m.d,$m.tx,$m.ty);},$m.setTransformByMatrix=function($m){this.setTransform($m.a,$m.b,$m.c,$m.d,$m.tx,$m.ty);},$m.clipRect=function($m,$p,$h,$P){$f.drawCall++,this.beginPath(),this.rect($m,$p,$h,$P),this.clip();},$m.drawTexture=function($m,$p,$h,$P,$L,$q,$k){$f.drawCall++;var $Y=$m.uv,$d=$m.bitmap.width,$K=$m.bitmap.height;this.drawImage($m.source,$Y[0]*$d,$Y[1]*$K,($Y[2]-$Y[0])*$d,($Y[5]-$Y[3])*$K,$p+$q,$h+$k,$P,$L);},$m.drawTextureWithTransform=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){$f.drawCall++;var $K=$m.uv,$D=$m.bitmap.width,$F=$m.bitmap.height;this.save(),1!=$d&&(this.globalAlpha*=$d),$q?(this.transform($q.a,$q.b,$q.c,$q.d,$q.tx+$k,$q.ty+$Y),this.drawImage($m.source,$K[0]*$D,$K[1]*$F,($K[2]-$K[0])*$D,($K[5]-$K[3])*$F,$p,$h,$P,$L)):this.drawImage($m.source,$K[0]*$D,$K[1]*$F,($K[2]-$K[0])*$D,($K[5]-$K[3])*$F,$p+$k,$h+$Y,$P,$L),this.restore();},$m.drawTexture2=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=$Y[0];if($d.loaded&&$d.bitmap&&$d.source){$f.drawCall++;var $K=1!==$q;if($K){var $D=this.globalAlpha;this.globalAlpha*=$q;}var $F=$d.uv,$R=$d.bitmap.width,$$=$d.bitmap.height;$L?(this.save(),this.transform($L.a,$L.b,$L.c,$L.d,$L.tx+$m,$L.ty+$p),this.drawImage($d.source,$F[0]*$R,$F[1]*$$,($F[2]-$F[0])*$R,($F[5]-$F[3])*$$,$Y[1]-$h,$Y[2]-$P,$Y[3],$Y[4]),this.restore()):this.drawImage($d.source,$F[0]*$R,$F[1]*$$,($F[2]-$F[0])*$R,($F[5]-$F[3])*$$,$Y[1]-$h+$m,$Y[2]-$P+$p,$Y[3],$Y[4]),$K&&(this.globalAlpha=$D);}},$m.fillTexture=function($m,$p,$h,$P,$L,$q,$k,$Y){if(!$Y.pat){if($m.uv!=$Dm.DEF_UV){var $d=new $am("2D");$d.getContext("2d"),$d.size($m.width,$m.height),$d.context.drawTexture($m,0,0,$m.width,$m.height,0,0),$m=new $Dm($d);}$Y.pat=this.createPattern($m.bitmap.source,$q);}var $K=$p,$D=$h,$F=0,$R=0;$k&&($K+=$k.x%$m.width,$D+=$k.y%$m.height,$F-=$k.x%$m.width,$R-=$k.y%$m.height),this.translate($K,$D),this.fillRect($F,$R,$P,$L,$Y.pat),this.translate(-$K,-$D);},$m.drawTriangle=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=$m.bitmap,$K=$d.source,$D=$m.width,$F=$m.height,$R=$d.width,$$=$d.height,$A=$h[$P]*$R,$B=$h[$L]*$R,$n=$h[$q]*$R,$c=$h[$P+1]*$$,$e=$h[$L+1]*$$,$a=$h[$q+1]*$$,$Z=$p[$P],$H=$p[$L],$W=$p[$q],$E=$p[$P+1],$I=$p[$L+1],$b=$p[$q+1];if($Y){var $T=($Z+$H+$W)/3,$j=($E+$I+$b)/3,$x=$Z-$T,$Q=$E-$j,$M=Math.sqrt($x*$x+$Q*$Q);$Z=$T+$x/$M*($M+1),$E=$j+$Q/$M*($M+1),$Q=$I-$j,$H=$T+($x=$H-$T)/($M=Math.sqrt($x*$x+$Q*$Q))*($M+1),$I=$j+$Q/$M*($M+1),$Q=$b-$j,$W=$T+($x=$W-$T)/($M=Math.sqrt($x*$x+$Q*$Q))*($M+1),$b=$j+$Q/$M*($M+1);}this.save(),$k&&this.transform($k.a,$k.b,$k.c,$k.d,$k.tx,$k.ty),this.beginPath(),this.moveTo($Z,$E),this.lineTo($H,$I),this.lineTo($W,$b),this.closePath(),this.clip();var $u=1/($A*$e+$c*$n+$B*$a-$e*$n-$c*$B-$A*$a),$N=$Z*$e+$c*$W+$H*$a-$e*$W-$c*$H-$Z*$a,$S=$A*$H+$Z*$n+$B*$W-$H*$n-$Z*$B-$A*$W,$_=$A*$e*$W+$c*$H*$n+$Z*$B*$a-$Z*$e*$n-$c*$B*$W-$A*$H*$a,$l=$E*$e+$c*$b+$I*$a-$e*$b-$c*$I-$E*$a,$J=$A*$I+$E*$n+$B*$b-$I*$n-$E*$B-$A*$b,$z=$A*$e*$b+$c*$I*$n+$E*$B*$a-$E*$e*$n-$c*$B*$b-$A*$I*$a;this.transform($N*$u,$l*$u,$S*$u,$J*$u,$_*$u,$z*$u),this.drawImage($K,$m.uv[0]*$R,$m.uv[1]*$$,$D,$F,$m.uv[0]*$R,$m.uv[1]*$$,$D,$F),this.restore();},$m.flush=function(){return 0;},$m.fillWords=function($m,$p,$h,$P,$L,$q){$P&&(this.font=$P),$L&&(this.fillStyle=$L);this.textBaseline="top",this.textAlign="left";for(var $k=0,$Y=$m.length;$k<$Y;$k++){var $d=$m[$k];if(this.__fillText($d.char,$d.x+$p,$d.y+$h),1===$q){var $K=$d.height,$D=.5*$d.style.letterSpacing;$D||($D=0),this.beginPath(),this.strokeStyle=$L,this.lineWidth=1,this.moveTo($p+$d.x-$D+.5,$h+$d.y+$K+.5),this.lineTo($p+$d.x+$d.width+$D+.5,$h+$d.y+$K+.5),this.stroke();}}},$m.fillBorderWords=function($m,$p,$h,$P,$L,$q,$k){$P&&(this.font=$P),$L&&(this.fillStyle=$L),this.textBaseline="top",this.lineWidth=$k,this.textAlign="left",this.strokeStyle=$q;for(var $Y=0,$d=$m.length;$Y<$d;$Y++){var $K=$m[$Y];this.__strokeText($K.char,$K.x+$p,$K.y+$h),this.__fillText($K.char,$K.x+$p,$K.y+$h);}},$m.destroy=function(){this.canvas.width=this.canvas.height=0;},$m.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1;},$m.drawCurves=function($m,$p,$h){this.beginPath(),this.strokeStyle=$h[3],this.lineWidth=$h[4];var $P=$h[2];$m+=$h[0],$p+=$h[1],this.moveTo($m+$P[0],$p+$P[1]);for(var $L=2,$q=$P.length;$L<$q;)this.quadraticCurveTo($m+$P[$L++],$p+$P[$L++],$m+$P[$L++],$p+$P[$L++]);this.stroke();},$Y.__init__=function($p){var $h=laya.resource.Context.prototype;if(!($p=$p||CanvasRenderingContext2D.prototype).inited){$p.inited=!0,$p.__fillText=$p.fillText,$p.__fillRect=$p.fillRect,$p.__strokeText=$p.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($m){$p[$m]=$h[$m];});}},$Y.replaceCanvasGetSet=function($m,$p){var $h=Object.getOwnPropertyDescriptor($m,$p);if(!$h||!$h.configurable)return!1;var $P,$L={};for($P in $h)"set"!=$P&&($L[$P]=$h[$P]);var $q=$h.set;return $L.set=function($m){$q.call(this,$m);var $p=this.getContext("2d");$p&&"__reset"in $p&&$p.__reset();},Object.defineProperty($m,$p,$L),!0;},$Y.replaceGetSet=function($m,$p){var $h=Object.getOwnPropertyDescriptor($m,$p);if(!$h||!$h.configurable)return!1;var $P,$L={};for($P in $h)"set"!=$P&&($L[$P]=$h[$P]);var $q=$h.set,$k="___"+$p+"__";return $Y.newKeys.push($k),$L.set=function($m){$m!=this[$k]&&(this[$k]=$m,$q.call(this,$m));},Object.defineProperty($m,$p,$L),!0;},$Y._default=new $Y(),$Y.newKeys=[],$d($Y,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"];}]),$Y;}(),$z=function(){function $q($m){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$q._uniqueIDCounter,this._name=$m||"Content Manager",$q._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$q._resourceManagers.push(this),this._resources=[],this._records={};}$B($q,"laya.resource.ResourceManager");var $m=$q.prototype;return $E.imps($m,{"laya.resource.IDispose":!0}),$m.getResourceByIndex=function($m){return this._resources[$m];},$m.getResourcesLength=function(){return this._resources.length;},$m.addResource=function($m){return $m.resourceManager&&$m.resourceManager.removeResource($m),-1===this._resources.indexOf($m)&&(($m._resourceManager=this)._resources.push($m),this.addRecord($m.uri,$m.__className,$m.memorySize),this.addSize($m.memorySize),!0);},$m.removeResource=function($m){var $p=this._resources.indexOf($m);return-1!==$p&&(this._resources.splice($p,1),$m._resourceManager=null,this._memorySize-=$m.memorySize,this.addRecord($m.uri,$m.__className,-$m.memorySize),!0);},$m.unload=function(){for(var $m=this._resources.slice(0,this._resources.length),$p=0;$p<$m.length;$p++){$m[$p].destroy();}$m.length=0;},$m.dispose=function(){if(this===$q._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$q._resourceManagers.splice($q._resourceManagers.indexOf(this),1),$q._isResourceManagersSorted=!1;for(var $m=this._resources.slice(0,this._resources.length),$p=0;$p<$m.length;$p++){var $h=$m[$p];$h.resourceManager.removeResource($h),$h.destroy();}$m.length=0;},$m.addSize=function($m){$m&&(this.autoRelease&&0<$m&&this._memorySize+$m>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$m);},$m.addRecord=function($m,$p,$h){DEBUG&&$h&&!$m&&console.error($m,$p,$h);},$m.garbageCollection=function($m){var $p=this._resources;($p=$p.slice()).sort(function($m,$p){if(!$m||!$p)throw new Error("a或b不能为空！");return $m.released&&$p.released?0:$m.released?1:$p.released?-1:$m._lastUseFrameCount-$p._lastUseFrameCount;});for(var $h=$f.loopCount,$P=0,$L=$p.length;$P<$L;$P++){var $q=$p[$P];if(!(1<$h-$q._lastUseFrameCount))return void(this._memorySize>=$m&&(this._isOverflow=!0));if($q.releaseResource(),this._memorySize<$m)return void(this._isOverflow=!1);}},$D(0,$m,"id",function(){return this._id;}),$D(0,$m,"name",function(){return this._name;},function($m){!$m&&""===$m||this._name===$m||(this._name=$m,$q._isResourceManagersSorted=!1);}),$D(0,$m,"memorySize",function(){return this._memorySize;}),$D(0,$m,"records",function(){return this._records;}),$D(1,$q,"systemResourceManager",function(){return $q._systemResourceManager;}),$q.__init__=function(){$q.currentResourceManager=$q.systemResourceManager;},$q.getLoadedResourceManagerByIndex=function($m){return $q._resourceManagers[$m];},$q.getLoadedResourceManagersCount=function(){return $q._resourceManagers.length;},$q.recreateContentManagers=function($m){void 0===$m&&($m=!1);for(var $p=$q.currentResourceManager,$h=0;$h<$q._resourceManagers.length;$h++){$q.currentResourceManager=$q._resourceManagers[$h];for(var $P=0;$P<$q.currentResourceManager._resources.length;$P++)$q.currentResourceManager._resources[$P].releaseResource($m),$q.currentResourceManager._resources[$P].activeResource($m);}$q.currentResourceManager=$p;},$q.releaseContentManagers=function($m){void 0===$m&&($m=!1);for(var $p=$q.currentResourceManager,$h=0;$h<$q._resourceManagers.length;$h++){$q.currentResourceManager=$q._resourceManagers[$h];for(var $P=0;$P<$q.currentResourceManager._resources.length;$P++){var $L=$q.currentResourceManager._resources[$P];!$L.released&&$L.releaseResource($m);}}$q.currentResourceManager=$p;},$q._uniqueIDCounter=0,$q._isResourceManagersSorted=!1,$q._resourceManagers=[],$d($q,["_systemResourceManager",function(){return this._systemResourceManager=new $q("System Resource Manager");},"currentResourceManager",function(){return this.currentResourceManager=$q._systemResourceManager;}]),$q;}(),$w=(function(){function $m(){}$B($m,"laya.system.System"),$m.changeDefinition=function($m,$p){$E[$m]=$p;var $h=$m+"=classObj";$E._runScript($h);},$m.__init__=function(){$S.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice());};}(),function(){function $h(){}return $B($h,"laya.utils.Browser"),$D(1,$h,"pixelRatio",function(){return $h.__init__(),-1<$h.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$Q.getPixelRatio();}),$D(1,$h,"height",function(){return $h.__init__(),($E.stage&&$E.stage.canvasRotation?$h.clientWidth:$h.clientHeight)*$h.pixelRatio;}),$D(1,$h,"clientWidth",function(){return $h.__init__(),$h.window.innerWidth||$h.document.body.clientWidth;}),$D(1,$h,"window",function(){return $h.__init__(),$h._window;}),$D(1,$h,"clientHeight",function(){return $h.__init__(),$h.window.innerHeight||$h.document.body.clientHeight||$h.document.documentElement.clientHeight;}),$D(1,$h,"width",function(){return $h.__init__(),($E.stage&&$E.stage.canvasRotation?$h.clientHeight:$h.clientWidth)*$h.pixelRatio;}),$D(1,$h,"container",function(){return $h.__init__(),$h._container||(($h._container=$h.createElement("div")).id="layaContainer",$h.document.body.appendChild($h._container)),$h._container;},function($m){$h._container=$m;}),$D(1,$h,"document",function(){return $h.__init__(),$h._document;}),$h.__init__=function(){if(!$h._window){$h._window=$Q.getWindow(),$h._document=$h.window.document,$h._window.addEventListener("message",function($m){laya.utils.Browser._onMessage($m);},!1),$h.document.__createElement=$h.document.createElement,$k.requestAnimationFrame=$k.requestAnimationFrame||$k.webkitRequestAnimationFrame||$k.mozRequestAnimationFrame||$k.oRequestAnimationFrame||$k.msRequestAnimationFrame||function($m){return $k.setTimeout($m,1e3/60);};var $m=$k.document.body.style;$m["-webkit-user-select"]="none",$m["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$h.userAgent=$h.window.navigator.userAgent,$h.onIOS=!!($h.u=$h.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$h.onMobile=-1<$h.u.indexOf("Mobile"),$h.onIPhone=-1<$h.u.indexOf("iPhone"),$h.onMac=-1<$h.u.indexOf("Mac OS X"),$h.onIPad=-1<$h.u.indexOf("iPad"),$h.onAndroid=-1<$h.u.indexOf("Android")||-1<$h.u.indexOf("Adr"),$h.onWP=-1<$h.u.indexOf("Windows Phone"),$h.onQQBrowser=-1<$h.u.indexOf("QQBrowser"),$h.onMQQBrowser=-1<$h.u.indexOf("MQQBrowser")||-1<$h.u.indexOf("Mobile")&&-1<$h.u.indexOf("QQ"),$h.onIE=!!$h.window.ActiveXObject||"ActiveXObject"in $h.window,$h.onWeiXin=-1<$h.u.indexOf("MicroMessenger"),$h.onPC=!$h.onMobile,$h.onSafari=-1<$h.u.indexOf("Safari"),$h.onFirefox=-1<$h.u.indexOf("Firefox"),$h.onEdge=-1<$h.u.indexOf("Edge"),$h.onMiniGame=-1<$h.u.indexOf("MiniGame"),$h.onLimixiu=-1<$h.u.indexOf("limixiu"),$h.httpProtocol="http:"==$h.window.location.protocol,$h.onMiniGame&&null==$h.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$h.webAudioEnabled=!!($h.window.AudioContext||$h.window.webkitAudioContext||$h.window.mozAudioContext),$h.soundType=$h.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$Lm=$h.webAudioEnabled?$qm:$hm,$h.webAudioEnabled&&$qm.initWebAudio(),$hm._initMusicAudio(),$h.enableTouch="ontouchstart"in $k||$k.DocumentTouch&&$p instanceof DocumentTouch,$k.focus(),$x._soundClass=$Lm,$x._musicClass=$hm,$S._mainCanvas=$S._mainCanvas||$am.create("2D"),$h.canvas||($h.canvas=$am.create("2D"),$h.context=$h.canvas.getContext("2d"));}},$h._onMessage=function($m){if($m.data&&"size"==$m.data.name){if($h.window.innerWidth=$m.data.width,$h.window.innerHeight=$m.data.height,$h.window.__innerHeight=$m.data.clientHeight,!$h.document.createEvent)return void console.warn("no document.createEvent");var $p=$h.document.createEvent("HTMLEvents");return $p.initEvent("resize",!1,!1),void $h.window.dispatchEvent($p);}},$h.createElement=function($m){return $h.__init__(),$h.document.__createElement($m);},$h.getElementById=function($m){return $h.__init__(),$h.document.getElementById($m);},$h.removeElement=function($m){$m&&$m.parentNode&&$m.parentNode.removeChild($m);},$h.now=function(){return $Q.now();},$h._window=null,$h._document=null,$h._container=null,$h.userAgent=null,$h.u=null,$h.onIOS=!1,$h.onMac=!1,$h.onMobile=!1,$h.onIPhone=!1,$h.onIPad=!1,$h.onAndroid=!1,$h.onWP=!1,$h.onQQBrowser=!1,$h.onMQQBrowser=!1,$h.onSafari=!1,$h.onFirefox=!1,$h.onEdge=!1,$h.onIE=!1,$h.onWeiXin=!1,$h.onMiniGame=!1,$h.onLimixiu=!1,$h.onPC=!1,$h.httpProtocol=!1,$h.webAudioEnabled=!1,$h.soundType=null,$h.enableTouch=!1,$h.canvas=null,$h.context=null,$h.__init$=function(){},$h;}()),$X=function(){function $p($m){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$m?(this._u8d_=new Uint8Array($m),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_);}$B($p,"laya.utils.Byte");var $m=$p.prototype;return $m.___resizeBuffer=function($p){try{var $m=new Uint8Array($p);null!=this._u8d_&&(this._u8d_.length<=$p?$m.set(this._u8d_):$m.set(this._u8d_.subarray(0,$p))),this._u8d_=$m,this._d_=new DataView($m.buffer);}catch($m){throw"___resizeBuffer err:"+$p;}},$m.getString=function(){return this.rUTF(this.getUint16());},$m.getFloat32Array=function($m,$p){var $h=$m+$p;$h=$h>this._length?this._length:$h;var $P=new Float32Array(this._d_.buffer.slice($m,$h));return this._pos_=$h,$P;},$m.getUint8Array=function($m,$p){var $h=$m+$p;$h=$h>this._length?this._length:$h;var $P=new Uint8Array(this._d_.buffer.slice($m,$h));return this._pos_=$h,$P;},$m.getInt16Array=function($m,$p){var $h=$m+$p;$h=$h>this._length?this._length:$h;var $P=new Int16Array(this._d_.buffer.slice($m,$h));return this._pos_=$h,$P;},$m.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $m=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$m;},$m.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $m=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$m;},$m.writeFloat32=function($m){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$m,this._xd_),this._pos_+=4;},$m.writeFloat64=function($m){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$m,this._xd_),this._pos_+=8;},$m.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $m=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$m;},$m.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $m=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$m;},$m.writeInt32=function($m){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$m,this._xd_),this._pos_+=4;},$m.writeUint32=function($m){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$m,this._xd_),this._pos_+=4;},$m.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $m=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$m;},$m.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $m=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$m;},$m.writeUint16=function($m){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$m,this._xd_),this._pos_+=2;},$m.writeInt16=function($m){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$m,this._xd_),this._pos_+=2;},$m.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++);},$m.writeUint8=function($m){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$m),this._pos_++;},$m._getUInt8=function($m){return this._d_.getUint8($m);},$m._getUint16=function($m){return this._d_.getUint16($m,this._xd_);},$m._getMatrix=function(){return new $M(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());},$m.rUTF=function($m){for(var $p=[],$h=this._pos_+$m,$P=0,$L=0,$q=0,$k=String.fromCharCode,$Y=this._u8d_;this._pos_<$h;)($P=$Y[this._pos_++])<128?0!=$P&&$p.push($k($P)):$P<224?$p.push($k((63&$P)<<6|127&$Y[this._pos_++])):$P<240?($L=$Y[this._pos_++],$p.push($k((31&$P)<<12|(127&$L)<<6|127&$Y[this._pos_++]))):($L=$Y[this._pos_++],$q=$Y[this._pos_++],$p.push($k((15&$P)<<18|(127&$L)<<12|$q<<6&127|127&$Y[this._pos_++]))),0;return $p.join("");},$m.getCustomString=function($m){for(var $p=[],$h=0,$P=0,$L=0,$q=String.fromCharCode,$k=this._u8d_;0<$m;)if(($P=$k[this._pos_])<128)$p.push($q($P)),this._pos_++,$m--;else for($h=$P-128,this._pos_++,$m-=$h;0<$h;)$P=$k[this._pos_++],$L=$k[this._pos_++],$p.push($q($L<<8|$P)),$h--;return $p.join("");},$m.clear=function(){this._pos_=0,this.length=0;},$m.__getBuffer=function(){return this._d_.buffer;},$m.writeUTFBytes=function($m){for(var $p=0,$h=($m+="").length;$p<$h;$p++){var $P=$m.charCodeAt($p);$P<=127?this.writeByte($P):$P<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$P>>6,128|63&$P],this._pos_),this._pos_+=2):$P<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$P>>12,128|$P>>6&63,128|63&$P],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$P>>18,128|$P>>12&63,128|$P>>6&63,128|63&$P],this._pos_),this._pos_+=4);}},$m.writeUTFString=function($m){var $p=this.pos;this.writeUint16(1),this.writeUTFBytes($m);var $h=this.pos-$p-2;if(65536<=$h)throw"writeUTFString byte len more than 65536";this._d_.setUint16($p,$h,this._xd_);},$m.readUTFString=function(){return this.readUTFBytes(this.getUint16());},$m.getUTFString=function(){return this.readUTFString();},$m.readUTFBytes=function($m){if(void 0===$m&&($m=-1),0==$m)return"";var $p=this.bytesAvailable;if($p<$m)throw"readUTFBytes error - Out of bounds";return $m=0<$m?$m:$p,this.rUTF($m);},$m.getUTFBytes=function($m){return void 0===$m&&($m=-1),this.readUTFBytes($m);},$m.writeByte=function($m){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$m),this._pos_+=1;},$m.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++);},$m.getByte=function(){return this.readByte();},$m.ensureWrite=function($m){this._length<$m&&(this._length=$m),this._allocated_<$m&&(this.length=$m);},$m.writeArrayBuffer=function($m,$p,$h){if(void 0===$p&&($p=0),void 0===$h&&($h=0),$p<0||$h<0)throw"writeArrayBuffer error - Out of bounds";0==$h&&($h=$m.byteLength-$p),this.ensureWrite(this._pos_+$h);var $P=new Uint8Array($m);this._u8d_.set($P.subarray($p,$p+$h),this._pos_),this._pos_+=$h;},$D(0,$m,"buffer",function(){var $m=this._d_.buffer;return $m.byteLength==this.length?$m:$m.slice(0,this.length);}),$D(0,$m,"endian",function(){return this._xd_?"littleEndian":"bigEndian";},function($m){this._xd_="littleEndian"==$m;}),$D(0,$m,"length",function(){return this._length;},function($m){this._allocated_<$m?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($m,2*this._allocated_))):this._allocated_>$m&&this.___resizeBuffer(this._allocated_=$m),this._length=$m;}),$D(0,$m,"pos",function(){return this._pos_;},function($m){this._pos_=$m;}),$D(0,$m,"bytesAvailable",function(){return this._length-this._pos_;}),$p.getSystemEndian=function(){if(!$p._sysEndian){var $m=new ArrayBuffer(2);new DataView($m).setInt16(0,256,!0),$p._sysEndian=256===new Int16Array($m)[0]?"littleEndian":"bigEndian";}return $p._sysEndian;},$p.BIG_ENDIAN="bigEndian",$p.LITTLE_ENDIAN="littleEndian",$p._sysEndian=null,$p;}(),$s=function(){function $L(){}return $B($L,"laya.utils.CacheManager"),$L.regCacheByFunction=function($m,$p){var $h;$L.unRegCacheByFunction($m,$p),$h={tryDispose:$m,getCacheList:$p},$L._cacheList.push($h);},$L.unRegCacheByFunction=function($m,$p){var $h,$P=0;for($h=$L._cacheList.length,$P=0;$P<$h;$P++)if($L._cacheList[$P].tryDispose==$m&&$L._cacheList[$P].getCacheList==$p)return void $L._cacheList.splice($P,1);},$L.forceDispose=function(){var $m=0,$p=$L._cacheList.length;for($m=0;$m<$p;$m++)$L._cacheList[$m].tryDispose(!0);},$L.beginCheck=function($m){void 0===$m&&($m=15e3),$E.timer.loop($m,null,$L._checkLoop);},$L.stopCheck=function(){$E.timer.clear(null,$L._checkLoop);},$L._checkLoop=function(){var $m=$L._cacheList;if(!($m.length<1)){var $p,$h=$w.now(),$P=0;for($p=$P=$m.length;0<$P&&($m[$L._index=++$L._index%$p].tryDispose(!1),!($w.now()-$h>$L.loopTimeLimit));)$P--;}},$L.loopTimeLimit=2,$L._cacheList=[],$L._index=0,$L;}(),$G=function(){function $$(){}return $B($$,"laya.utils.ClassUtils"),$$.regClass=function($m,$p){$$._classMap[$m]=$p;},$$.getRegClass=function($m){return $$._classMap[$m];},$$.getInstance=function($m){var $p=$$.getClass($m);return $p?new $p():(console.warn("[error] Undefined class:",$m),null);},$$.createByJson=function($m,$p,$h,$P,$L){"string"==typeof $m&&($m=JSON.parse($m));var $q=$m.props;if(!$p&&!($p=$L?$L.runWith($m):$$.getInstance($q.runtime||$m.type)))return null;var $k=$m.child;if($k)for(var $Y=0,$d=$k.length;$Y<$d;$Y++){var $K=$k[$Y];if("render"!==$K.props.name&&"render"!==$K.props.renderType||!$p._$set_itemRender){if("Graphic"==$K.type)$$.addGraphicsToSprite($K,$p);else if($$.isDrawType($K.type))$$.addGraphicToSprite($K,$p,!0);else{var $D=$$.createByJson($K,null,$h,$P,$L);"Script"==$K.type?$D.hasOwnProperty("owner")?$D.owner=$p:$D.hasOwnProperty("target")&&($D.target=$p):"mask"==$K.props.renderType?$p.mask=$D:$p.addChild($D);}}else $p.itemRender=$K;}if($q)for(var $F in $q){var $R=$q[$F];"var"===$F&&$h?$h[$R]=$p:$R instanceof Array&&"function"==typeof $p[$F]?$p[$F].apply($p,$R):$p[$F]=$R;}return $P&&$m.customProps&&$P.runWith([$p,$m]),$p.created&&$p.created(),$p;},$$.addGraphicsToSprite=function($m,$p){var $h;if(($h=$m.child)&&!($h.length<1)){var $P;$P=$$._getGraphicsFromSprite($m,$p);var $L=0,$q=0;$m.props&&($L=$$._getObjVar($m.props,"x",0),$q=$$._getObjVar($m.props,"y",0)),0!=$L&&0!=$q&&$P.translate($L,$q);var $k,$Y=0;for($k=$h.length,$Y=0;$Y<$k;$Y++)$$._addGraphicToGraphics($h[$Y],$P);0!=$L&&0!=$q&&$P.translate(-$L,-$q);}},$$.addGraphicToSprite=function($m,$p,$h){var $P;void 0===$h&&($h=!1),$P=$h?$$._getGraphicsFromSprite($m,$p):$p.graphics,$$._addGraphicToGraphics($m,$P);},$$._getGraphicsFromSprite=function($m,$p){var $h,$P;if(!$m||!$m.props)return $p.graphics;switch($P=$m.props.renderType){case"hit":case"unHit":var $L;$p.hitArea||($p.hitArea=new $V()),($L=$p.hitArea)[$P]||($L[$P]=new $R()),$h=$L[$P];}return $h||($h=$p.graphics),$h;},$$._getTransformData=function($m){var $p;($m.hasOwnProperty("pivotX")||$m.hasOwnProperty("pivotY"))&&($p=$p||new $M()).translate(-$$._getObjVar($m,"pivotX",0),-$$._getObjVar($m,"pivotY",0));var $h=$$._getObjVar($m,"scaleX",1),$P=$$._getObjVar($m,"scaleY",1),$L=$$._getObjVar($m,"rotation",0);$$._getObjVar($m,"skewX",0),$$._getObjVar($m,"skewY",0);return 1==$h&&1==$P&&0==$L||(($p=$p||new $M()).scale($h,$P),$p.rotate(.0174532922222222*$L)),$p;},$$._addGraphicToGraphics=function($m,$p){var $h,$P;if(($h=$m.props)&&($P=$$.DrawTypeDic[$m.type])){var $L,$q;$L=$p;var $k=$$._getParams($h,$P[1],$P[2],$P[3]);(($q=$$._tM)||1!=$$._alpha)&&($L.save(),$q&&$L.transform($q),1!=$$._alpha&&$L.alpha($$._alpha)),$L[$P[0]].apply($L,$k),($q||1!=$$._alpha)&&$L.restore();}},$$._adptLineData=function($m){return $m[2]=parseFloat($m[0])+parseFloat($m[2]),$m[3]=parseFloat($m[1])+parseFloat($m[3]),$m;},$$._adptTextureData=function($m){return $m[0]=$Ym.getRes($m[0]),$m;},$$._adptLinesData=function($m){return $m[2]=$$._getPointListByStr($m[2]),$m;},$$.isDrawType=function($m){return"Image"!=$m&&$$.DrawTypeDic.hasOwnProperty($m);},$$._getParams=function($m,$p,$h,$P){var $L;void 0===$h&&($h=0),($L=$$._temParam).length=$p.length;var $q,$k,$Y=0;for($q=$p.length,$Y=0;$Y<$q;$Y++)$L[$Y]=$$._getObjVar($m,$p[$Y][0],$p[$Y][1]);return $$._alpha=$$._getObjVar($m,"alpha",1),$k=$$._getTransformData($m),$$._tM=$k?($h||($h=0),$k.translate($L[$h],$L[$h+1]),$L[$h]=$L[$h+1]=0,$k):null,$P&&$$[$P]&&($L=$$[$P]($L)),$L;},$$._getPointListByStr=function($m){var $p,$h,$P=0;for($h=($p=$m.split(",")).length,$P=0;$P<$h;$P++)$p[$P]=parseFloat($p[$P]);return $p;},$$._getObjVar=function($m,$p,$h){return $m.hasOwnProperty($p)?$m[$p]:$h;},$$._temParam=[],$$._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$$.getClass=function($m){var $p=$$._classMap[$m]||$m;return"string"==typeof $p?$E.__classmap[$p]:$p;},$$._tM=null,$$._alpha=NaN,$d($$,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]};}]),$$;}(),$U=function(){function $q($m){if(this._color=[],"string"==typeof $m){null===(this.strColor=$m)&&($m="#000000"),"#"==$m.charAt(0)&&($m=$m.substr(1));var $p=$m.length;if(3==$p||4==$p){for(var $h="",$P=0;$P<$p;$P++)$h+=$m[$P]+$m[$P];$m=$h;}var $L=this.numColor=parseInt($m,16);if(8==$m.length)return void(this._color=[parseInt($m.substr(0,2),16)/255,((16711680&$L)>>16)/255,((65280&$L)>>8)/255,(255&$L)/255]);}else $L=this.numColor=$m,this.strColor=$g.toHexColor($L);this._color=[((16711680&$L)>>16)/255,((65280&$L)>>8)/255,(255&$L)/255,1],this._color.__id=++$q._COLODID;}return $B($q,"laya.utils.Color"),$q._initDefault=function(){for(var $m in $q._DEFAULT={},$q._COLOR_MAP)$q._SAVE[$m]=$q._DEFAULT[$m]=new $q($q._COLOR_MAP[$m]);return $q._DEFAULT;},$q._initSaveMap=function(){for(var $m in $q._SAVE_SIZE=0,$q._SAVE={},$q._DEFAULT)$q._SAVE[$m]=$q._DEFAULT[$m];},$q.create=function($m){var $p=$q._SAVE[$m+""];return null!=$p?$p:($q._SAVE_SIZE<1e3||$q._initSaveMap(),$q._SAVE[$m+""]=new $q($m));},$q._SAVE={},$q._SAVE_SIZE=0,$q._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$q._DEFAULT=$q._initDefault(),$q._COLODID=1,$q;}(),$r=(function(){function $m(){this._values=[],this._keys=[];}$B($m,"laya.utils.Dictionary");var $p=$m.prototype;$p.set=function($m,$p){var $h=this.indexOf($m);0<=$h?this._values[$h]=$p:(this._keys.push($m),this._values.push($p));},$p.indexOf=function($m){var $p=this._keys.indexOf($m);return 0<=$p?$p:($m="string"==typeof $m?Number($m):"number"==typeof $m?$m.toString():$m,this._keys.indexOf($m));},$p.get=function($m){var $p=this.indexOf($m);return $p<0?null:this._values[$p];},$p.remove=function($m){var $p=this.indexOf($m);return 0<=$p&&(this._keys.splice($p,1),this._values.splice($p,1),!0);},$p.clear=function(){this._values.length=0,this._keys.length=0;},$D(0,$p,"values",function(){return this._values;}),$D(0,$p,"keys",function(){return this._keys;});}(),function(){function $m(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0;}$B($m,"laya.utils.Dragging");var $p=$m.prototype;return $p.start=function($m,$p,$h,$P,$L,$q,$k,$Y){void 0===$Y&&($Y=.92),this.clearTimer(),this.target=$m,this.area=$p,this.hasInertia=$h,this.elasticDistance=$p?$P:0,this.elasticBackTime=$L,this.data=$q,this._disableMouseEvent=$k,this.ratio=$Y,1!=$m.globalScaleX||1!=$m.globalScaleY?this._parent=$m.parent:this._parent=$E.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$E.stage.on("mouseup",this,this.onStageMouseUp),$E.stage.on("mouseout",this,this.onStageMouseUp),$E.timer.frameLoop(1,this,this.loop);},$p.clearTimer=function(){$E.timer.clear(this,this.loop),$E.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null);},$p.stop=function(){this._dragging&&($A.instance.disableMouseEvent=!1,$E.stage.off("mouseup",this,this.onStageMouseUp),$E.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear());},$p.loop=function(){var $m=this._parent.getMousePoint(),$p=$m.x,$h=$m.y,$P=$p-this._lastX,$L=$h-this._lastY;if(this._clickOnly){if(!(1<Math.abs($P*$E.stage._canvasTransform.getScaleX())||1<Math.abs($L*$E.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$A.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1);}else this._offsets.push($P,$L);0==$P&&0==$L||(this._lastX=$p,this._lastY=$h,this.target.x+=$P*this._elasticRateX,this.target.y+=$L*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data));},$p.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $m=this.area.x-this.target.x;else $m=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$m/this.elasticDistance),this.target.y<this.area.y)var $p=this.area.y-this.target.y;else $p=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$p/this.elasticDistance);}},$p.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height);},$p.onStageMouseUp=function($m){if($A.instance.disableMouseEvent=!1,$E.stage.off("mouseup",this,this.onStageMouseUp),$E.stage.off("mouseout",this,this.onStageMouseUp),$E.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $p=this._offsets.length,$h=Math.min($p,6),$P=this._offsets.length-$h,$L=$p-1;$P<$L;$L--)this._offsetY+=this._offsets[$L--],this._offsetX+=this._offsets[$L];this._offsetX=this._offsetX/$h*2,this._offsetY=this._offsetY/$h*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$E.timer.frameLoop(1,this,this.tweenMove);}else 0<this.elasticDistance?this.checkElastic():this.clear();},$p.checkElastic=function(){var $m=NaN,$p=NaN;if(this.target.x<this.area.x?$m=this.area.x:this.target.x>this.area.x+this.area.width&&($m=this.area.x+this.area.width),this.target.y<this.area.y?$p=this.area.y:this.target.y>this.area.y+this.area.height&&($p=this.area.y+this.area.height),isNaN($m)&&isNaN($p))this.clear();else{var $h={};isNaN($m)||($h.x=$m),isNaN($p)||($h.y=$p),this._tween=$v.to(this.target,$h,this.elasticBackTime,$y.sineOut,$e.create(this,this.clear),0,!1,!1);}},$p.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($E.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear());},$p.clear=function(){if(this.target){this.clearTimer();var $m=this.target;this.target=null,this._parent=null,$m.event("dragend",this.data);}},$m;}()),$y=function(){function $Y(){}return $B($Y,"laya.utils.Ease"),$Y.linearNone=function($m,$p,$h,$P){return $h*$m/$P+$p;},$Y.linearIn=function($m,$p,$h,$P){return $h*$m/$P+$p;},$Y.linearInOut=function($m,$p,$h,$P){return $h*$m/$P+$p;},$Y.linearOut=function($m,$p,$h,$P){return $h*$m/$P+$p;},$Y.bounceIn=function($m,$p,$h,$P){return $h-$Y.bounceOut($P-$m,0,$h,$P)+$p;},$Y.bounceInOut=function($m,$p,$h,$P){return $m<.5*$P?.5*$Y.bounceIn(2*$m,0,$h,$P)+$p:.5*$Y.bounceOut(2*$m-$P,0,$h,$P)+.5*$h+$p;},$Y.bounceOut=function($m,$p,$h,$P){return($m/=$P)<1/2.75?$h*(7.5625*$m*$m)+$p:$m<2/2.75?$h*(7.5625*($m-=1.5/2.75)*$m+.75)+$p:$m<2.5/2.75?$h*(7.5625*($m-=2.25/2.75)*$m+.9375)+$p:$h*(7.5625*($m-=2.625/2.75)*$m+.984375)+$p;},$Y.backIn=function($m,$p,$h,$P,$L){return void 0===$L&&($L=1.70158),$h*($m/=$P)*$m*(($L+1)*$m-$L)+$p;},$Y.backInOut=function($m,$p,$h,$P,$L){return void 0===$L&&($L=1.70158),($m/=.5*$P)<1?.5*$h*($m*$m*((1+($L*=1.525))*$m-$L))+$p:$h/2*(($m-=2)*$m*((1+($L*=1.525))*$m+$L)+2)+$p;},$Y.backOut=function($m,$p,$h,$P,$L){return void 0===$L&&($L=1.70158),$h*(($m=$m/$P-1)*$m*(($L+1)*$m+$L)+1)+$p;},$Y.elasticIn=function($m,$p,$h,$P,$L,$q){var $k;return void 0===$L&&($L=0),void 0===$q&&($q=0),0==$m?$p:1==($m/=$P)?$p+$h:($q||($q=.3*$P),$k=!$L||0<$h&&$L<$h||$h<0&&$L<-$h?($L=$h,$q/4):$q/$Y.PI2*Math.asin($h/$L),-$L*Math.pow(2,10*($m-=1))*Math.sin(($m*$P-$k)*$Y.PI2/$q)+$p);},$Y.elasticInOut=function($m,$p,$h,$P,$L,$q){var $k;return void 0===$L&&($L=0),void 0===$q&&($q=0),0==$m?$p:2==($m/=.5*$P)?$p+$h:($q||($q=$P*(.3*1.5)),$k=!$L||0<$h&&$L<$h||$h<0&&$L<-$h?($L=$h,$q/4):$q/$Y.PI2*Math.asin($h/$L),$m<1?$L*Math.pow(2,10*($m-=1))*Math.sin(($m*$P-$k)*$Y.PI2/$q)*-.5+$p:$L*Math.pow(2,-10*($m-=1))*Math.sin(($m*$P-$k)*$Y.PI2/$q)*.5+$h+$p);},$Y.elasticOut=function($m,$p,$h,$P,$L,$q){var $k;return void 0===$L&&($L=0),void 0===$q&&($q=0),0==$m?$p:1==($m/=$P)?$p+$h:($q||($q=.3*$P),$k=!$L||0<$h&&$L<$h||$h<0&&$L<-$h?($L=$h,$q/4):$q/$Y.PI2*Math.asin($h/$L),$L*Math.pow(2,-10*$m)*Math.sin(($m*$P-$k)*$Y.PI2/$q)+$h+$p);},$Y.strongIn=function($m,$p,$h,$P){return $h*($m/=$P)*$m*$m*$m*$m+$p;},$Y.strongInOut=function($m,$p,$h,$P){return($m/=.5*$P)<1?.5*$h*$m*$m*$m*$m*$m+$p:.5*$h*(($m-=2)*$m*$m*$m*$m+2)+$p;},$Y.strongOut=function($m,$p,$h,$P){return $h*(($m=$m/$P-1)*$m*$m*$m*$m+1)+$p;},$Y.sineInOut=function($m,$p,$h,$P){return .5*-$h*(Math.cos(Math.PI*$m/$P)-1)+$p;},$Y.sineIn=function($m,$p,$h,$P){return-$h*Math.cos($m/$P*$Y.HALF_PI)+$h+$p;},$Y.sineOut=function($m,$p,$h,$P){return $h*Math.sin($m/$P*$Y.HALF_PI)+$p;},$Y.quintIn=function($m,$p,$h,$P){return $h*($m/=$P)*$m*$m*$m*$m+$p;},$Y.quintInOut=function($m,$p,$h,$P){return($m/=.5*$P)<1?.5*$h*$m*$m*$m*$m*$m+$p:.5*$h*(($m-=2)*$m*$m*$m*$m+2)+$p;},$Y.quintOut=function($m,$p,$h,$P){return $h*(($m=$m/$P-1)*$m*$m*$m*$m+1)+$p;},$Y.quartIn=function($m,$p,$h,$P){return $h*($m/=$P)*$m*$m*$m+$p;},$Y.quartInOut=function($m,$p,$h,$P){return($m/=.5*$P)<1?.5*$h*$m*$m*$m*$m+$p:.5*-$h*(($m-=2)*$m*$m*$m-2)+$p;},$Y.quartOut=function($m,$p,$h,$P){return-$h*(($m=$m/$P-1)*$m*$m*$m-1)+$p;},$Y.cubicIn=function($m,$p,$h,$P){return $h*($m/=$P)*$m*$m+$p;},$Y.cubicInOut=function($m,$p,$h,$P){return($m/=.5*$P)<1?.5*$h*$m*$m*$m+$p:.5*$h*(($m-=2)*$m*$m+2)+$p;},$Y.cubicOut=function($m,$p,$h,$P){return $h*(($m=$m/$P-1)*$m*$m+1)+$p;},$Y.quadIn=function($m,$p,$h,$P){return $h*($m/=$P)*$m+$p;},$Y.quadInOut=function($m,$p,$h,$P){return($m/=.5*$P)<1?.5*$h*$m*$m+$p:.5*-$h*(--$m*($m-2)-1)+$p;},$Y.quadOut=function($m,$p,$h,$P){return-$h*($m/=$P)*($m-2)+$p;},$Y.expoIn=function($m,$p,$h,$P){return 0==$m?$p:$h*Math.pow(2,10*($m/$P-1))+$p-.001*$h;},$Y.expoInOut=function($m,$p,$h,$P){return 0==$m?$p:$m==$P?$p+$h:($m/=.5*$P)<1?.5*$h*Math.pow(2,10*($m-1))+$p:.5*$h*(2-Math.pow(2,-10*--$m))+$p;},$Y.expoOut=function($m,$p,$h,$P){return $m==$P?$p+$h:$h*(1-Math.pow(2,-10*$m/$P))+$p;},$Y.circIn=function($m,$p,$h,$P){return-$h*(Math.sqrt(1-($m/=$P)*$m)-1)+$p;},$Y.circInOut=function($m,$p,$h,$P){return($m/=.5*$P)<1?.5*-$h*(Math.sqrt(1-$m*$m)-1)+$p:.5*$h*(Math.sqrt(1-($m-=2)*$m)+1)+$p;},$Y.circOut=function($m,$p,$h,$P){return $h*Math.sqrt(1-($m=$m/$P-1)*$m)+$p;},$Y.HALF_PI=.5*Math.PI,$Y.PI2=2*Math.PI,$Y;}(),$V=function(){function $F(){this._hit=null,this._unHit=null;}$B($F,"laya.utils.HitArea");var $m=$F.prototype;return $m.isHit=function($m,$p){return!!$F.isHitGraphic($m,$p,this.hit)&&!$F.isHitGraphic($m,$p,this.unHit);},$m.contains=function($m,$p){return this.isHit($m,$p);},$D(0,$m,"hit",function(){return this._hit||(this._hit=new $R()),this._hit;},function($m){this._hit=$m;}),$D(0,$m,"unHit",function(){return this._unHit||(this._unHit=new $R()),this._unHit;},function($m){this._unHit=$m;}),$F.isHitGraphic=function($m,$p,$h){if(!$h)return!1;var $P;if(!($P=$h.cmds)&&$h._one&&(($P=$F._cmds).length=1,$P[0]=$h._one),!$P)return!1;var $L,$q,$k=0;for($L=$P.length,$k=0;$k<$L;$k++)if($q=$P[$k]){var $Y=$S._context;switch($q.callee){case $Y._translate:case 6:$m-=$q[0],$p-=$q[1];}if($F.isHitCmd($m,$p,$q))return!0;}return!1;},$F.isHitCmd=function($m,$p,$h){if(!$h)return!1;var $P=$S._context,$L=!1;switch($h.callee){case $P._drawRect:case 13:$F._rec.setTo($h[0],$h[1],$h[2],$h[3]),$L=$F._rec.contains($m,$p);break;case $P._drawCircle:case $P._fillCircle:case 14:$L=($m-=$h[0])*$m+($p-=$h[1])*$p<$h[2]*$h[2];break;case $P._drawPoly:case 18:$m-=$h[0],$p-=$h[1],$L=$F.ptInPolygon($m,$p,$h[2]);}return $L;},$F.ptInPolygon=function($m,$p,$h){var $P;($P=$F._ptPoint).setTo($m,$p);var $L,$q=0,$k=NaN,$Y=NaN,$d=NaN,$K=NaN;$L=$h.length;for(var $D=0;$D<$L;$D+=2){if($k=$h[$D],$Y=$h[$D+1],$d=$h[($D+2)%$L],$Y!=($K=$h[($D+3)%$L]))if(!($P.y<Math.min($Y,$K)))if(!($P.y>=Math.max($Y,$K)))($P.y-$Y)*($d-$k)/($K-$Y)+$k>$P.x&&$q++;}return $q%2==1;},$F._cmds=[],$d($F,["_rec",function(){return this._rec=new $b();},"_ptPoint",function(){return this._ptPoint=new $I();}]),$F;}(),$o=(function(){function $L($m,$p,$h,$P){this.char=$m,this.charNum=$m.charCodeAt(0),this._x=this._y=0,this.width=$p,this.height=$h,this.style=$P,this.isWord=!$L._isWordRegExp.test($m);}$B($L,"laya.utils.HTMLChar");var $m=$L.prototype;$E.imps($m,{"laya.display.ILayout":!0}),$m.setSprite=function($m){this._sprite=$m;},$m.getSprite=function(){return this._sprite;},$m._isChar=function(){return!0;},$m._getCSSStyle=function(){return this.style;},$D(0,$m,"width",function(){return this._w;},function($m){this._w=$m;}),$D(0,$m,"x",function(){return this._x;},function($m){this._sprite&&(this._sprite.x=$m),this._x=$m;}),$D(0,$m,"y",function(){return this._y;},function($m){this._sprite&&(this._sprite.y=$m),this._y=$m;}),$D(0,$m,"height",function(){return this._h;},function($m){this._h=$m;}),$L._isWordRegExp=new RegExp("[\\w.]","");}(),function(){function $p(){}$B($p,"laya.utils.Log"),$p.enable=function(){$p._logdiv||($p._logdiv=$w.window.document.createElement("div"),$w.window.document.body.appendChild($p._logdiv),$p._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;");},$p.toggle=function(){var $m=$p._logdiv.style;"1px"==$m.width?$m.width=$m.height="50%":$m.width=$m.height="1px";},$p.print=function($m){$p._logdiv&&($p.maxCount<=$p._count&&$p.clear(),$p._count++,$p._logdiv.innerText+=$m+"\n",$p._logdiv.scrollTop=$p._logdiv.scrollHeight);},$p.clear=function(){$p._logdiv.innerText="",$p._count=0;},$p._logdiv=null,$p._count=0,$p.maxCount=20;}(),function(){function $p(){}$B($p,"laya.utils.Mouse"),$D(1,$p,"cursor",function(){return $p._style.cursor;},function($m){$p._style.cursor=$m;}),$p.hide=function(){"none"!=$p.cursor&&($p._preCursor=$p.cursor,$p.cursor="none");},$p.show=function(){"none"==$p.cursor&&($p.cursor=$p._preCursor?$p._preCursor:"auto");},$p._preCursor=null,$d($p,["_style",function(){return this._style=$w.document.body.style;}]);}(),function(){function $q(){}return $B($q,"laya.utils.Pool"),$q.getPoolBySign=function($m){return $q._poolDic[$m]||($q._poolDic[$m]=[]);},$q.clearBySign=function($m){$q._poolDic[$m]&&($q._poolDic[$m].length=0);},$q.recover=function($m,$p){$p.__InPool||($p.__InPool=!0,$q.getPoolBySign($m).push($p));},$q.getItemByClass=function($m,$p){var $h=$q.getPoolBySign($m),$P=$h.length?$h.pop():new $p();return $P.__InPool=!1,$P;},$q.getItemByCreateFun=function($m,$p,$h){var $P=$q.getPoolBySign($m),$L=$P.length?$P.pop():$p.call($h);return $L.__InPool=!1,$L;},$q.getItem=function($m){var $p=$q.getPoolBySign($m),$h=$p.length?$p.pop():null;return $h&&($h.__InPool=!1),$h;},$q._poolDic={},$q.InPoolSign="__InPool",$q;}()),$f=function(){function $d(){}return $B($d,"laya.utils.Stat"),$D(1,$d,"onclick",null,function($m){$d._sp&&$d._sp.on("click",$d._sp,$m),$d._canvas&&($d._canvas.source.onclick=$m,$d._canvas.source.style.pointerEvents="");}),$d.show=function($m,$p,$h){if(void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),!$S.isConchApp||$S.isConchWebGL){if($S.isConchWebGL||$w.onMiniGame||$w.onLimixiu||($d._useCanvas=!0),$d._show=!0,$d._fpsData.length=60,$d._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$d._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$d._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$d._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$S.isWebGL){if($d._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$S.is3DMode){if($d._view[0].title="FPS(3D)",$d._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$d._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$d._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$h){var $P=8;$d._view[$P++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$d._view[$P++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$d._view[$P++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1};}else if(2==$h){$P=8;$d._view[$P++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$d._view[$P++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$d._view[$P++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$d._view[$P++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$d._view[$P++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$d._view[$P++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$d._view[$P++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2};}}else $d._view[0].title="FPS(WebGL)",$d._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};}else $d._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$d._useCanvas?$d.createUIPre($m,$p):$d.createUI($m,$p),$d.enable();}else $w.window.conch.showFPS&&$w.window.conch.showFPS($m,$p);},$d.createUIPre=function($m,$p){var $h=$w.pixelRatio;$d._width=170*$h,$d._vx=75*$h,$d._height=$h*(12*$d._view.length+3*$h)+4,$d._fontSize=12*$h;for(var $P=0;$P<$d._view.length;$P++)$d._view[$P].x=4,$d._view[$P].y=$P*$d._fontSize+2*$h;$d._canvas||(($d._canvas=new $am("2D")).size($d._width,$d._height),($d._ctx=$d._canvas.getContext("2d")).textBaseline="top",$d._ctx.font=$d._fontSize+"px Sans-serif",$d._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$m+"px;top:"+$p+"px;width:"+$d._width/$h+"px;height:"+$d._height/$h+"px;"),$d._first=!0,$d.loop(),$d._first=!1,$w.container.appendChild($d._canvas.source);},$d.createUI=function($m,$p){var $h=$d._sp,$P=$w.pixelRatio;$h||($h=new $Fm(),($d._leftText=new $nm()).pos(5,5),$d._leftText.color="#ffffff",$h.addChild($d._leftText),($d._txt=new $nm()).pos(80*$P,5),$d._txt.color="#ffffff",$h.addChild($d._txt),$d._sp=$h),$h.pos($m,$p);for(var $L="",$q=0;$q<$d._view.length;$q++){$L+=$d._view[$q].title+"\n";}$d._leftText.text=$L;var $k=170*$P,$Y=$P*(12*$d._view.length+3*$P)+4;$d._txt.fontSize=$d._fontSize*$P,$d._leftText.fontSize=$d._fontSize*$P,$h.size($k,$Y),$h.graphics.clear(),$h.graphics.setAlpha(.5),$h.graphics.drawRect(0,0,$k,$Y,"#999999"),$h.graphics.setAlpha(1),$d.loop();},$d.enable=function(){$E.timer.frameLoop(1,$d,$d.loop);},$d.hide=function(){$d._show=!1,$E.timer.clear($d,$d.loop),$d._canvas&&$w.removeElement($d._canvas.source);},$d.clear=function(){$d.trianglesFaces=$d.drawCall=$d.shaderCall=$d.spriteCount=$d.spriteRenderUseCacheCount=$d.treeNodeCollision=$d.treeSpriteCollision=$d.canvasNormal=$d.canvasBitmap=$d.canvasReCache=0;},$d.loop=function(){$d._count++;var $m=$w.now();if(!($m-$d._timer<1e3)){var $p=$d._count;if($d.FPS=Math.round(1e3*$p/($m-$d._timer)),$d._show){$d.trianglesFaces=Math.round($d.trianglesFaces/$p),$d.spriteCount=$d._useCanvas?($d.drawCall=Math.round($d.drawCall/$p)-2,$d.shaderCall=Math.round($d.shaderCall/$p),Math.round($d.spriteCount/$p)-1):($d.drawCall=Math.round($d.drawCall/$p)-2,$d.shaderCall=Math.round($d.shaderCall/$p)-4,Math.round($d.spriteCount/$p)-4),$d.spriteRenderUseCacheCount=Math.round($d.spriteRenderUseCacheCount/$p),$d.canvasNormal=Math.round($d.canvasNormal/$p),$d.canvasBitmap=Math.round($d.canvasBitmap/$p),$d.canvasReCache=Math.ceil($d.canvasReCache/$p),$d.treeNodeCollision=Math.round($d.treeNodeCollision/$p),$d.treeSpriteCollision=Math.round($d.treeSpriteCollision/$p);var $h=0<$d.FPS?Math.floor(1e3/$d.FPS).toString():" ";$d._fpsStr=$d.FPS+($d.renderSlow?" slow":"")+" "+$h,$d._spriteStr=$d.spriteCount+($d.spriteRenderUseCacheCount?"/"+$d.spriteRenderUseCacheCount:""),$d._canvasStr=$d.canvasReCache+"/"+$d.canvasNormal+"/"+$d.canvasBitmap,$d.currentMemorySize=$z.systemResourceManager.memorySize,$d._useCanvas?$d.renderInfoPre():$d.renderInfo(),$d.clear();}$d._count=0,$d._timer=$m;}},$d.renderInfoPre=function(){if($d._canvas){var $m=$d._ctx;$m.clearRect($d._first?0:$d._vx,0,$d._width,$d._height);for(var $p=$S.WebGL.mainContext,$h=0;$h<$d._view.length;$h++){var $P=$d._view[$h];$d._first&&($m.fillStyle="white",$m.fillText($P.title,$P.x,$P.y,null,null,null)),$m.fillStyle=$P.color;var $L=-1;if(($P=$d._view[$h]).varying){if($p)switch($P.varying){case 1:$L=$p.getParameter($p[$P.value]);break;case 2:$L=$p.getExtension($P.value);}}else $L=$d[$P.value];"M"==$P.units&&($L=Math.floor($L/1048576*100)/100+" M"),"K"==$P.units&&($L=Math.floor($L/1024*100)/100+" K"),"string"==$P.units&&($L=$L.match(/\d+\.?\d/i)),$m.fillText($L+"",$P.x+$d._vx,$P.y,null,null,null);}}},$d.renderInfo=function(){for(var $m="",$p=$S.WebGL.mainContext,$h=0;$h<$d._view.length;$h++){var $P=$d._view[$h],$L=-1;if($P.varying){if($p)switch($P.varying){case 1:$L=$p.getParameter($p[$P.value]);break;case 2:$L=$p.getExtension($P.value);}}else $L=$d[$P.value];"M"==$P.units&&($L=Math.floor($L/1048576*100)/100+" M"),"K"==$P.units&&($L=Math.floor($L/1024*100)/100+" K"),"string"==$P.units&&($L=$L.match(/\d+\.?\d/i)),$m+=$L+"\n";}$d._txt.text=$m;},$d.FPS=0,$d.loopCount=0,$d.shaderCall=0,$d.drawCall=0,$d.trianglesFaces=0,$d.spriteCount=0,$d.spriteRenderUseCacheCount=0,$d.treeNodeCollision=0,$d.treeSpriteCollision=0,$d.canvasNormal=0,$d.canvasBitmap=0,$d.canvasReCache=0,$d.renderSlow=!1,$d.currentMemorySize=0,$d._fpsStr=null,$d._canvasStr=null,$d._spriteStr=null,$d._fpsData=[],$d._timer=0,$d._count=0,$d._view=[],$d._fontSize=12,$d._txt=null,$d._leftText=null,$d._sp=null,$d._show=!1,$d._useCanvas=!1,$d._canvas=null,$d._ctx=null,$d._first=!1,$d._vx=NaN,$d._width=0,$d._height=100,$d;}(),$i=(function(){function $m(){this._strsToID={},this._idToStrs=[],this._length=0;}$B($m,"laya.utils.StringKey");var $p=$m.prototype;$p.add=function($m){var $p=this._strsToID[$m];return null!=$p?$p:(this._idToStrs[this._length]=$m,this._strsToID[$m]=this._length++);},$p.getID=function($m){var $p=this._strsToID[$m];return null==$p?-1:$p;},$p.getName=function($m){var $p=this._idToStrs[$m];return null==$p?void 0:$p;};}(),function(){var $K;function $m(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init();}$B($m,"laya.utils.Timer");var $p=$m.prototype;return $p._init=function(){$E.timer&&$E.timer.frameLoop(1,this,this._update);},$p._now=function(){return Date.now();},$p._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $m=this.currFrame=this.currFrame+this.scale,$p=this._now();this._delta=($p-this._lastTimer)*this.scale;var $h=this.currTimer=this.currTimer+this._delta;$E.isDebug&&6e4<Math.abs($p-this._lastTimer)&&console.error("系统时间错误！"+($p-this._lastTimer)),this._lastTimer=$p;var $P=this._handlers;for($k=this._count=0,$Y=$P.length;$k<$Y;$k++)if(null!==($d=$P[$k]).method){var $L=$d.userFrame?$m:$h;if($L>=$d.exeTime)if($d.repeat){if($d.jumpFrame)for(;$L>=$d.exeTime;)$d.exeTime+=$d.delay,$d.run(!1);else $d.exeTime+=$d.delay,$d.run(!1),$L>$d.exeTime&&($d.exeTime+=Math.ceil(($L-$d.exeTime)/$d.delay)*$d.delay);}else $d.run(!0);}else this._count++;(30<this._count||$m%200==0)&&this._clearHandlers();for(var $q=this._laters,$k=0,$Y=$q.length-1;$k<=$Y;$k++){var $d=$q[$k];this._isIgnoreRecover($d)||(null!==$d.method&&(delete this._map[$d.key],$d.run(!1)),this._recoverHandler($d)),$k===$Y&&($Y=$q.length-1);}$q.length=0;}},$p._clearHandlers=function(){for(var $m=this._handlers,$p=0,$h=$m.length;$p<$h;$p++){var $P=$m[$p];null!==$P.method?this._temp.push($P):this._isIgnoreRecover($P)?this._temp.push($P):this._recoverHandler($P);}this._handlers=this._temp,this._temp=$m,this._temp.length=0;},$p._recoverHandler=function($m){this._map[$m.key]==$m&&delete this._map[$m.key],$m.recover();},$p._create=function($m,$p,$h,$P,$L,$q,$k,$Y){if(!$h)return $L.apply($P,$q),null;if($k){var $d=this._getHandler($P,$L);if($d)return $d.repeat=$p,$d.userFrame=$m,$d.delay=$h,$d.ignoreRecover=$Y,$d.caller=$P,$d.method=$L,$d.args=$q,$d.exeTime=$h+($m?this.currFrame:this.currTimer+this._now()-this._lastTimer),$d;}return($d=$K.create()).repeat=$p,$d.userFrame=$m,$d.delay=$h,$d.ignoreRecover=$Y,$d.caller=$P,$d.method=$L,$d.args=$q,$d.exeTime=$h+($m?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($d),this._handlers.push($d),$d;},$p._indexHandler=function($m){var $p=$m.caller,$h=$m.method,$P=$p?$p.$_GID||($p.$_GID=$g.getGID()):0,$L=$h.$_TID||($h.$_TID=this._mid++);$m.key=$P+"_"+$L,this._map[$m.key]=$m;},$p.once=function($m,$p,$h,$P,$L){void 0===$L&&($L=!0),this._create(!1,!1,$m,$p,$h,$P,$L,!1);},$p.loop=function($m,$p,$h,$P,$L,$q,$k){void 0===$L&&($L=!0),void 0===$q&&($q=!1),void 0===$k&&($k=!1);var $Y=this._create(!1,!0,$m,$p,$h,$P,$L,$k);$Y&&($Y.jumpFrame=$q);},$p.frameOnce=function($m,$p,$h,$P,$L){void 0===$L&&($L=!0),this._create(!0,!1,$m,$p,$h,$P,$L,!1);},$p.frameLoop=function($m,$p,$h,$P,$L,$q){void 0===$L&&($L=!0),void 0===$q&&($q=!1),this._create(!0,!0,$m,$p,$h,$P,$L,$q);},$p.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$K._freeCount;},$p.clear=function($m,$p){var $h=this._getHandler($m,$p);return!(!$h||this._isIgnoreRecover($h))&&(delete this._map[$h.key],$h.key=null,$h.clear(),!0);},$p.clearAll=function($m){if($m)for(var $p=0,$h=this._handlers.length;$p<$h;$p++){var $P=this._handlers[$p];$P.caller===$m&&(this._isIgnoreRecover($P)||(delete this._map[$P.key],$P.key=null,$P.clear()));}},$p._getHandler=function($m,$p){var $h=$m?$m.$_GID||($m.$_GID=$g.getGID()):0,$P=$p.$_TID||($p.$_TID=this._mid++);return this._map[$h+"_"+$P];},$p._isIgnoreRecover=function($m){if($m.ignoreRecover||$m.caller&&"IgnoreRecover"==$m.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $p="";try{arguments.propertyIsEnumerable.caller;}catch($m){$p=$m.stack;}$E.recordError("报错：核心定时器销毁忽略  "+$p);}return!0;}return!1;},$p.hasHandler=function($m,$p){return this._map[$m.$_GID+"_"+$p.$_TID];},$p.callLater=function($m,$p,$h){if(null==this._getHandler($m,$p)){var $P=$K.create();$P.caller=$m,$P.method=$p,$P.args=$h,this._indexHandler($P),this._laters.push($P);}},$p.runCallLater=function($m,$p){var $h=this._getHandler($m,$p);$h&&null!=$h.method&&(this._isIgnoreRecover($h)||(delete this._map[$h.key],$h.run(!0)));},$p.runTimer=function($m,$p){this.runCallLater($m,$p);},$D(0,$p,"delta",function(){return this._delta;}),$m.__init$=function(){$K=function(){function $p(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1;}$B($p,"");var $m=$p.prototype;return $m.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1;},$m.recover=function(){this.clear(),this.args=$p._freeHandler,$p._freeHandler=this,$p._freeCount++;},$m.run=function($m){var $p=this.caller;if($p&&$p.destroyed)return this.clear();var $h=this.method,$P=this.args;$m&&this.clear(),null!=$h&&($P?$h.apply($p,$P):$h.call($p));},$p._freeHandler=null,$p._freeCount=0,$p.create=function(){var $m=$p._freeHandler;return $m?($p._freeHandler=$m.args,--$p._freeCount,$m.args=null,$m):new $p();},$p;}();},$m;}()),$v=function(){function $F(){this.gid=0;}$B($F,"laya.utils.Tween");var $m=$F.prototype;return $m.to=function($m,$p,$h,$P,$L,$q,$k){return void 0===$q&&($q=0),void 0===$k&&($k=!1),this._create($m,$p,$h,$P,$L,$q,$k,!0,!1,!0);},$m.from=function($m,$p,$h,$P,$L,$q,$k){return void 0===$q&&($q=0),void 0===$k&&($k=!1),this._create($m,$p,$h,$P,$L,$q,$k,!1,!1,!0);},$m._create=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){if(!$m)throw new Error("Tween:target is null");this._target=$m,this._duration=$h,this._ease=$P||$p.ease||$F.easeNone,this._complete=$L||$p.complete,this._delay=$q,this._props=[],this._usedTimer=0,this._startTimer=$w.now(),this._usedPool=$d,this._delayParam=null,this.update=$p.update;var $D=$m.$_GID||($m.$_GID=$g.getGID());return $F.tweenMap[$D]?($k&&$F.clearTween($m),$F.tweenMap[$D].push(this)):$F.tweenMap[$D]=[this],$K?$q<=0?this.firstStart($m,$p,$Y):(this._delayParam=[$m,$p,$Y],$E.scaleTimer.once($q,this,this.firstStart,this._delayParam)):this._initProps($m,$p,$Y),this;},$m.firstStart=function($m,$p,$h){this._delayParam=null,$m.destroyed?this.clear():(this._initProps($m,$p,$h),this._beginLoop());},$m._initProps=function($m,$p,$h){for(var $P in $p)if("number"==typeof $m[$P]){var $L=$h?$m[$P]:$p[$P],$q=$h?$p[$P]:$m[$P];this._props.push([$P,$L,$q-$L]),$h||($m[$P]=$L);}},$m._beginLoop=function(){$E.scaleTimer.frameLoop(1,this,this._doEase);},$m._doEase=function(){this._updateEase($w.now());},$m._updateEase=function($m){var $p=this._target;if($p){if($p.destroyed)return $F.clearTween($p);var $h=this._usedTimer=$m-this._startTimer-this._delay;if(!($h<0)){if($h>=this._duration)return this.complete();for(var $P=0<$h?this._ease($h,0,1,this._duration):0,$L=this._props,$q=0,$k=$L.length;$q<$k;$q++){var $Y=$L[$q];$p[$Y[0]]=$Y[1]+$P*$Y[2];}this.update&&this.update.run();}}},$m.complete=function(){if(this._target){$E.scaleTimer.runTimer(this,this.firstStart);for(var $m=this._target,$p=this._props,$h=this._complete,$P=0,$L=$p.length;$P<$L;$P++){var $q=$p[$P];$m[$q[0]]=$q[1]+$q[2];}this.update&&this.update.run(),this.clear(),$h&&$h.run();}},$m.pause=function(){$E.scaleTimer.clear(this,this._beginLoop),$E.scaleTimer.clear(this,this._doEase),$E.scaleTimer.clear(this,this.firstStart);var $m;($m=$w.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$m);},$m.setStartTime=function($m){this._startTimer=$m;},$m.clear=function(){this._target&&(this._remove(),this._clear());},$m._clear=function(){this.pause(),$E.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$o.recover("tween",this));},$m.recover=function(){this._usedPool=!0,this._clear();},$m._remove=function(){var $m=$F.tweenMap[this._target.$_GID];if($m)for(var $p=0,$h=$m.length;$p<$h;$p++)if($m[$p]===this){$m.splice($p,1);break;}},$m.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$w.now(),this._delayParam)$E.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $m=this._props,$p=0,$h=$m.length;$p<$h;$p++){var $P=$m[$p];this._target[$P[0]]=$P[1];}$E.scaleTimer.once(this._delay,this,this._beginLoop);}},$m.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$w.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$E.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop());},$D(0,$m,"progress",null,function($m){var $p=$m*this._duration;this._startTimer=$w.now()-this._delay-$p;}),$F.to=function($m,$p,$h,$P,$L,$q,$k,$Y){return void 0===$q&&($q=0),void 0===$k&&($k=!1),void 0===$Y&&($Y=!0),$o.getItemByClass("tween",$F)._create($m,$p,$h,$P,$L,$q,$k,!0,$Y,!0);},$F.from=function($m,$p,$h,$P,$L,$q,$k,$Y){return void 0===$q&&($q=0),void 0===$k&&($k=!1),void 0===$Y&&($Y=!0),$o.getItemByClass("tween",$F)._create($m,$p,$h,$P,$L,$q,$k,!1,$Y,!0);},$F.clearAll=function($m){if($m&&$m.$_GID){var $p=$F.tweenMap[$m.$_GID];if($p){for(var $h=0,$P=$p.length;$h<$P;$h++)$p[$h]._clear();$p.length=0;}}},$F.clear=function($m){$m.clear();},$F.clearTween=function($m){$F.clearAll($m);},$F.easeNone=function($m,$p,$h,$P){return $h*$m/$P+$p;},$F.tweenMap={},$F;}(),$g=function(){function $Y(){}return $B($Y,"laya.utils.Utils"),$Y.toRadian=function($m){return $m*$Y._pi2;},$Y.toAngle=function($m){return $m*$Y._pi;},$Y.toHexColor=function($m){if($m<0||isNaN($m))return null;for(var $p=$m.toString(16);$p.length<6;)$p="0"+$p;return"#"+$p;},$Y.getGID=function(){return $Y._gid++;},$Y.concatArray=function($m,$p){if(!$p)return $m;if(!$m)return $p;var $h=0,$P=$p.length;for($h=0;$h<$P;$h++)$m.push($p[$h]);return $m;},$Y.clearArray=function($m){return $m&&($m.length=0),$m;},$Y.copyArray=function($m,$p){if($m||($m=[]),!$p)return $m;$m.length=$p.length;var $h=0,$P=$p.length;for($h=0;$h<$P;$h++)$m[$h]=$p[$h];return $m;},$Y.getGlobalRecByPoints=function($m,$p,$h,$P,$L){var $q,$k;return $q=new $I($p,$h),$q=$m.localToGlobal($q),$k=new $I($P,$L),$k=$m.localToGlobal($k),$b._getWrapRec([$q.x,$q.y,$k.x,$k.y]);},$Y.getGlobalPosAndScale=function($m){return $Y.getGlobalRecByPoints($m,0,0,1,1);},$Y.bind=function($m,$p){return $m.bind($p);},$Y.measureText=function($m,$p){return $Q.measureText($m,$p);},$Y.contextMeasureText=function($m){var $p=$w.context.measureText($m);return $p||($p={width:16,height:16}),$p;},$Y.updateOrder=function($m){if(!$m||$m.length<2)return!1;for(var $p,$h=1,$P=0,$L=$m.length,$q=NaN;$h<$L;){for($p=$m[$P=$h],$q=$m[$P]._zOrder;-1<--$P&&$m[$P]._zOrder>$q;)$m[$P+1]=$m[$P];$m[$P+1]=$p,$h++;}var $k=$p.parent.conchModel;if($k)if(null!=$k.updateZOrder)$k.updateZOrder();else{for($h=0;$h<$L;$h++)$k.removeChild($m[$h].conchModel);for($h=0;$h<$L;$h++)$k.addChildAt($m[$h].conchModel,$h);}return!0;},$Y.transPointList=function($m,$p,$h){var $P=0,$L=$m.length;for($P=0;$P<$L;$P+=2)$m[$P]+=$p,$m[$P+1]+=$h;},$Y.parseInt=function($m,$p){void 0===$p&&($p=0);var $h=$w.window.parseInt($m,$p);return isNaN($h)?0:$h;},$Y.getFileExtension=function($m){$Y._extReg.lastIndex=$m.lastIndexOf(".");var $p=$Y._extReg.exec($m);return $p&&1<$p.length?$p[1].toLowerCase():null;},$Y.getTransformRelativeToWindow=function($m,$p,$h){var $P=$E.stage,$L=laya.utils.Utils.getGlobalPosAndScale($m),$q=$P._canvasTransform.clone(),$k=$q.tx,$Y=$q.ty;$q.rotate(-Math.PI/180*$E.stage.canvasDegree),$q.scale($E.stage.clientScaleX,$E.stage.clientScaleY);var $d=$E.stage.canvasDegree%180!=0,$K=NaN,$D=NaN;$d?($K=$h+$L.y,$D=$p+$L.x,$K*=$q.d,$D*=$q.a,90==$E.stage.canvasDegree?($K=$k-$K,$D+=$Y):($K+=$k,$D=$Y-$D)):($K=$p+$L.x,$D=$h+$L.y,$K*=$q.a,$D*=$q.d,$K+=$k,$D+=$Y);var $F=NaN,$R=NaN;return $R=$d?($F=$q.d*$L.height,$q.a*$L.width):($F=$q.a*$L.width,$q.d*$L.height),{x:$K,y:$D,scaleX:$F,scaleY:$R};},$Y.fitDOMElementInArea=function($m,$p,$h,$P,$L,$q){$m._fitLayaAirInitialized||($m._fitLayaAirInitialized=!0,$m.style.transformOrigin=$m.style.webKittransformOrigin="left top",$m.style.position="absolute");var $k=$Y.getTransformRelativeToWindow($p,$h,$P);$m.style.transform=$m.style.webkitTransform="scale("+$k.scaleX+","+$k.scaleY+") rotate("+$E.stage.canvasDegree+"deg)",$m.style.width=$L+"px",$m.style.height=$q+"px",$m.style.left=$k.x+"px",$m.style.top=$k.y+"px";},$Y.isOkTextureList=function($m){if(!$m)return!1;var $p,$h=0,$P=$m.length;for($h=0;$h<$P;$h++)if(!($p=$m[$h])||!$p.source)return!1;return!0;},$Y.isOKCmdList=function($m){if(!$m)return!1;var $p,$h,$P=0,$L=$m.length,$q=$S._context;for($P=0;$P<$L;$P++)switch(($p=$m[$P]).callee){case $q._drawTexture:case $q._fillTexture:case $q._drawTextureWithTransform:if(!($h=$p[0])||!$h.source)return!1;}return!0;},$Y._gid=1,$Y._pi=180/Math.PI,$Y._pi2=Math.PI/180,$Y._extReg=/\.(\w+)\??/g,$Y.parseXMLFromString=function($m){var $p;if($m=$m.replace(/>\s+</g,"><"),-1<($p=new DOMParser().parseFromString($m,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($p.firstChild.firstChild.textContent);return $p;},$Y;}(),$t=function(){function $m(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$S.isWebGL&&$s.regCacheByFunction($g.bind(this.startDispose,this),$g.bind(this.getCacheList,this));}$B($m,"laya.utils.VectorGraphManager");var $p=$m.prototype;return $p.getId=function(){return this._id++;},$p.addShape=function($m,$p){this.shapeDic[$m]=$p,this.useDic[$m]||(this.useDic[$m]=!0);},$p.addLine=function($m,$p){this.shapeLineDic[$m]=$p,this.shapeLineDic[$m]||(this.shapeLineDic[$m]=!0);},$p.getShape=function($m){this._checkKey&&null!=this.useDic[$m]&&(this.useDic[$m]=!0);},$p.deleteShape=function($m){this.shapeDic[$m]&&(this.shapeDic[$m]=null,delete this.shapeDic[$m]),this.shapeLineDic[$m]&&(this.shapeLineDic[$m]=null,delete this.shapeLineDic[$m]),null!=this.useDic[$m]&&delete this.useDic[$m];},$p.getCacheList=function(){var $m,$p=[];for($m in this.shapeDic)$p.push(this.shapeDic[$m]);for($m in this.shapeLineDic)$p.push(this.shapeLineDic[$m]);return $p;},$p.startDispose=function($m){var $p;for($p in this.useDic)this.useDic[$p]=!1;this._checkKey=!0;},$p.endDispose=function(){if(this._checkKey){var $m;for($m in this.useDic)this.useDic[$m]||this.deleteShape($m);this._checkKey=!1;}},$m.getInstance=function(){return $m.instance=$m.instance||new $m();},$m.instance=null,$m;}(),$O=function(){function $P(){this._obj=null,this._obj=$P.supportWeakMap?new $w.window.WeakMap():{},$P.supportWeakMap||$P._maps.push(this);}$B($P,"laya.utils.WeakObject");var $m=$P.prototype;return $m.set=function($m,$p){if(null!=$m)if($P.supportWeakMap){var $h=$m;"string"!=typeof $m&&"number"!=typeof $m||($h=$P._keys[$m])||($h=$P._keys[$m]={k:$m}),this._obj.set($h,$p);}else"string"==typeof $m||"number"==typeof $m?this._obj[$m]=$p:($m.$_GID||($m.$_GID=$g.getGID()),this._obj[$m.$_GID]=$p);},$m.get=function($m){if(null==$m)return null;if($P.supportWeakMap){var $p="string"==typeof $m||"number"==typeof $m?$P._keys[$m]:$m;return $p?this._obj.get($p):null;}return"string"==typeof $m||"number"==typeof $m?this._obj[$m]:this._obj[$m.$_GID];},$m.del=function($m){if(null!=$m)if($P.supportWeakMap){var $p="string"==typeof $m||"number"==typeof $m?$P._keys[$m]:$m;if(!$p)return;this._obj.delete($p);}else"string"==typeof $m||"number"==typeof $m?delete this._obj[$m]:delete this._obj[this._obj.$_GID];},$m.has=function($m){if(null==$m)return!1;if($P.supportWeakMap){var $p="string"==typeof $m||"number"==typeof $m?$P._keys[$m]:$m;return this._obj.has($p);}return"string"==typeof $m||"number"==typeof $m?null!=this._obj[$m]:null!=this._obj[this._obj.$_GID];},$P.__init__=function(){($P.supportWeakMap=null!=$w.window.WeakMap)||$E.timer.loop($P.delInterval,null,$P.clearCache);},$P.clearCache=function(){for(var $m=0,$p=$P._maps.length;$m<$p;$m++){$P._maps[$m]._obj={};}},$P.supportWeakMap=!1,$P.delInterval=3e5,$P._keys={},$P._maps=[],$d($P,["I",function(){return this.I=new $P();}]),$P;}(),$C=function(){function $m(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null;}$B($m,"laya.utils.WordText");var $p=$m.prototype;return $p.setText=function($m){this.changed=!0,this._text=$m;},$p.toString=function(){return this._text;},$p.charCodeAt=function($m){return this._text?this._text.charCodeAt($m):NaN;},$p.charAt=function($m){return this._text?this._text.charAt($m):null;},$D(0,$p,"length",function(){return this._text?this._text.length:0;}),$m;}(),$mm=function($m){function $k(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$k.__super.call(this),this._childs=$k.ARRAY_EMPTY,this._$P=$k.PROP_EMPTY,this.timer=$E.scaleTimer,this.conchModel=$S.isConchNode?this.createConchModel():null;}$B($k,"laya.display.Node",$K);var $p=$k.prototype;return $p._setBit=function($m,$p){1==$m&&this._getBit($m)!=$p&&this._updateDisplayedInstage();$p?this._bits|=$m:this._bits&=~$m;},$p._getBit=function($m){return 0!=(this._bits&$m);},$p._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1);},$p._setUpNoticeType=function($m){var $p=this;for($p._setBit($m,!0),$p=$p.parent;$p;){if($p._getBit($m))return;$p._setBit($m,!0),$p=$p.parent;}},$p.on=function($m,$p,$h,$P){return"display"!==$m&&"undisplay"!==$m||this._getBit(1)||this._setUpNoticeType(1),this._createListener($m,$p,$h,$P,!1);},$p.once=function($m,$p,$h,$P){return"display"!==$m&&"undisplay"!==$m||this._getBit(1)||this._setUpNoticeType(1),this._createListener($m,$p,$h,$P,!0);},$p.createConchModel=function(){return null;},$p.destroy=function($m){void 0===$m&&($m=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($m?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this);},$p.destroyChildren=function(){if(this._childs)for(var $m=this._childs.length-1;-1<$m;$m--)this._childs[$m].destroy(!0);},$p.addChild=function($m){if(!$m||this.destroyed||$m===this)return $m;if($m.zOrder&&this._set$P("hasZorder",!0),$m._parent===this){var $p=this.getChildIndex($m);$p!==this._childs.length-1&&(this._childs.splice($p,1),this._childs.push($m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,this._childs.length-1)),this._childChanged());}else $m.parent&&$m.parent.removeChild($m),this._childs===$k.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($m),this.conchModel&&this.conchModel.addChildAt($m.conchModel,this._childs.length-1),($m.parent=this)._childChanged();return $m;},$p.addChildren=function($m){for(var $p=arguments,$h=0,$P=$p.length;$h<$P;)this.addChild($p[$h++]);},$p.addChildAt=function($m,$p){if(!$m||this.destroyed||$m===this)return $m;if($m.zOrder&&this._set$P("hasZorder",!0),0<=$p&&$p<=this._childs.length){if($m._parent===this){var $h=this.getChildIndex($m);this._childs.splice($h,1),this._childs.splice($p,0,$m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,$p)),this._childChanged();}else $m.parent&&$m.parent.removeChild($m),this._childs===$k.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($p,0,$m),this.conchModel&&this.conchModel.addChildAt($m.conchModel,$p),$m.parent=this;return $m;}throw new Error("appendChildAt:The index is out of bounds");},$p.getChildIndex=function($m){return this._childs.indexOf($m);},$p.getChildByName=function($m){var $p=this._childs;if($p)for(var $h=0,$P=$p.length;$h<$P;$h++){var $L=$p[$h];if($L.name===$m)return $L;}return null;},$p._get$P=function($m){return this._$P[$m];},$p._set$P=function($m,$p){return this.destroyed||(this._$P===$k.PROP_EMPTY&&(this._$P={}),this._$P[$m]=$p),$p;},$p.getChildAt=function($m){return this._childs[$m];},$p.setChildIndex=function($m,$p){var $h=this._childs;if($p<0||$p>=$h.length)throw new Error("setChildIndex:The index is out of bounds.");var $P=this.getChildIndex($m);if($P<0)throw new Error("setChildIndex:node is must child of this object.");return $h.splice($P,1),$h.splice($p,0,$m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,$p)),this._childChanged(),$m;},$p._childChanged=function($m){},$p.removeChild=function($m){if(!this._childs)return $m;var $p=this._childs.indexOf($m);return this.removeChildAt($p);},$p.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this;},$p.removeChildByName=function($m){var $p=this.getChildByName($m);return $p&&this.removeChild($p),$p;},$p.removeChildAt=function($m){var $p=this.getChildAt($m);if($p){for(var $h=this._childs.length-1,$P=$m;$P<$h;++$P)this._childs[$P]=this._childs[$P+1];this._childs.length=$h,this.conchModel&&this.conchModel.removeChild($p.conchModel),$p.parent=null;}return $p;},$p.removeChildren=function($m,$p){if(void 0===$m&&($m=0),void 0===$p&&($p=2147483647),this._childs&&0<this._childs.length){var $h=this._childs;if(0===$m&&$q<=$p){var $P=$h;this._childs=$k.ARRAY_EMPTY;}else $P=$h.splice($m,$p-$m);for(var $L=0,$q=$P.length;$L<$q;$L++)$P[$L].parent=null,this.conchModel&&this.conchModel.removeChild($P[$L].conchModel);}return this;},$p.replaceChild=function($m,$p){var $h=this._childs.indexOf($p);return-1<$h?(this._childs.splice($h,1,$m),this.conchModel&&(this.conchModel.removeChild($p.conchModel),this.conchModel.addChildAt($m.conchModel,$h)),$p.parent=null,$m.parent=this,$m):null;},$p._updateDisplayedInstage=function(){var $m;$m=this;var $p=$E.stage;for(this._displayedInStage=!1;$m;){if($m._getBit(1)){this._displayedInStage=$m._displayedInStage;break;}if($m==$p||$m._displayedInStage){this._displayedInStage=!0;break;}$m=$m.parent;}},$p._setDisplay=function($m){this._displayedInStage!==$m&&((this._displayedInStage=$m)?this.event("display"):this.event("undisplay"));},$p._displayChild=function($m,$p){var $h=$m._childs;if($h)for(var $P=0;$P<$h.length;$P++){var $L=$h[$P];$L&&$L._getBit(1)&&(0<$L._childs.length?this._displayChild($L,$p):$L._setDisplay($p));}$m._setDisplay($p);},$p.contains=function($m){if($m===this)return!0;for(;$m;){if($m.parent===this)return!0;$m=$m.parent;}return!1;},$p.timerLoop=function($m,$p,$h,$P,$L,$q){void 0===$L&&($L=!0),void 0===$q&&($q=!1),this.timer.loop($m,$p,$h,$P,$L,$q);},$p.timerOnce=function($m,$p,$h,$P,$L){void 0===$L&&($L=!0),this.timer._create(!1,!1,$m,$p,$h,$P,$L);},$p.frameLoop=function($m,$p,$h,$P,$L){void 0===$L&&($L=!0),this.timer._create(!0,!0,$m,$p,$h,$P,$L);},$p.frameOnce=function($m,$p,$h,$P,$L){void 0===$L&&($L=!0),this.timer._create(!0,!1,$m,$p,$h,$P,$L);},$p.clearTimer=function($m,$p){this.timer.clear($m,$p);},$D(0,$p,"numChildren",function(){return this._childs.length;}),$D(0,$p,"destroyed",function(){return this._destroyed;}),$D(0,$p,"parent",function(){return this._parent;},function($m){this._parent!==$m&&($m?(this._parent=$m,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$m.displayedInStage&&this._displayChild(this,!0)),$m._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$m));}),$D(0,$p,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage;}),$k.ARRAY_EMPTY=[],$k.PROP_EMPTY={},$k.NOTICE_DISPLAY=1,$k.MOUSEENABLE=2,$k;}(),$pm=function($m){function $R($m){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$R.__super.call(this),this._padding=$R._PADDING,this._spacing=$R._SPACING,this._aligns=$R._ALIGNS,this._font=$$.EMPTY,this._ower=$m;}$B($R,"laya.display.css.CSSStyle",$m);var $p=$R.prototype;return $p.destroy=function(){this._ower=null,this._font=null,this._rect=null;},$p.inherit=function($m){this._font=$m._font,this._spacing=$m._spacing===$R._SPACING?$R._SPACING:$m._spacing.slice(),this.lineHeight=$m.lineHeight;},$p._widthAuto=function(){return 0!=(262144&this._type);},$p.widthed=function($m){return 0!=(8&this._type);},$p._calculation=function($m,$p){if($p.indexOf("%")<0)return!1;var $P=this._ower,$L=$P.parent,$q=this._rect;function $k($m,$p,$h){return $m*$h[0]+$p*$h[1]+$h[2];}function $h($m){var $p=$L.width,$h=$P.width;$q.width&&($P.width=$k($p,$h,$q.width)),$q.height&&($P.height=$k($p,$h,$q.height)),$q.left&&($P.x=$k($p,$h,$q.left)),$q.top&&($P.y=$k($p,$h,$q.top));}null===$q&&($L._getCSSStyle()._type|=524288,$L.on("resize",this,$h),this._rect=$q={input:{}});var $Y=$p.split(" ");return $Y[0]=parseFloat($Y[0])/100,1==$Y.length?$Y[1]=$Y[2]=0:($Y[1]=parseFloat($Y[1])/100,$Y[2]=parseFloat($Y[2])),$q[$m]=$Y,$q.input[$m]=$p,$h(),!0;},$p.heighted=function($m){return 0!=(8192&this._type);},$p.size=function($m,$p){var $h=this._ower,$P=!1;-1!==$m&&$m!=this._ower.width&&(this._type|=8,this._ower.width=$m,$P=!0),-1!==$p&&$p!=this._ower.height&&(this._type|=8192,this._ower.height=$p,$P=!0),$P&&($h._layoutLater(),524288&this._type&&$h.event("resize",this));},$p._getAlign=function(){return this._aligns[0];},$p._getValign=function(){return this._aligns[1];},$p._getCssFloat=function(){return 0!=(32768&this._type)?32768:0;},$p._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $$(this._font));},$p.render=function($m,$p,$h,$P){var $L=$m.width,$q=$m.height;$h-=$m.pivotX,$P-=$m.pivotY,this._bgground&&null!=this._bgground.color&&$p.ctx.fillRect($h,$P,$L,$q,this._bgground.color),this._border&&this._border.color&&$p.drawRect($h,$P,$L,$q,this._border.color.strColor,this._border.size);},$p.getCSSStyle=function(){return this;},$p.cssText=function($m){this.attrs($R.parseOneCSS($m,";"));},$p.attrs=function($m){if($m)for(var $p=0,$h=$m.length;$p<$h;$p++){var $P=$m[$p];this[$P[0]]=$P[1];}},$p.setTransform=function($m){"none"===$m?this._tf=$Y._TF_EMPTY:this.attrs($R.parseOneCSS($m,","));},$p.translate=function($m,$p){this._tf===$Y._TF_EMPTY&&(this._tf=new $L()),this._tf.translateX=$m,this._tf.translateY=$p;},$p.scale=function($m,$p){this._tf===$Y._TF_EMPTY&&(this._tf=new $L()),this._tf.scaleX=$m,this._tf.scaleY=$p;},$p._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type);},$D(0,$p,"block",$m.prototype._$get_block,function($m){$m?this._type|=1:this._type&=-2;}),$D(0,$p,"valign",function(){return $R._valigndef[this._aligns[1]];},function($m){this._aligns===$R._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$R._valigndef[$m];}),$D(0,$p,"height",null,function($m){if(this._type|=8192,"string"==typeof $m){if(this._calculation("height",$m))return;$m=parseInt($m);}this.size(-1,$m);}),$D(0,$p,"width",null,function($m){if(this._type|=8,"string"==typeof $m){var $p=$m.indexOf("auto");if(0<=$p&&(this._type|=262144,$m=$m.substr(0,$p)),this._calculation("width",$m))return;$m=parseInt($m);}this.size($m,-1);}),$D(0,$p,"fontWeight",function(){return this._font.weight;},function($m){this._createFont().weight=$m;}),$D(0,$p,"left",null,function($m){var $p=this._ower;if("string"==typeof $m){if("center"===$m?$m="50% -50% 0":"right"===$m&&($m="100% -100% 0"),this._calculation("left",$m))return;$m=parseInt($m);}$p.x=$m;}),$D(0,$p,"_translate",null,function($m){this.translate($m[0],$m[1]);}),$D(0,$p,"absolute",function(){return 0!=(4&this._type);}),$D(0,$p,"top",null,function($m){var $p=this._ower;if("string"==typeof $m){if("middle"===$m?$m="50% -50% 0":"bottom"===$m&&($m="100% -100% 0"),this._calculation("top",$m))return;$m=parseInt($m);}$p.y=$m;}),$D(0,$p,"align",function(){return $R._aligndef[this._aligns[0]];},function($m){this._aligns===$R._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$R._aligndef[$m];}),$D(0,$p,"bold",function(){return this._font.bold;},function($m){this._createFont().bold=$m;}),$D(0,$p,"padding",function(){return this._padding;},function($m){this._padding=$m;}),$D(0,$p,"leading",function(){return this._spacing[1];},function($m){"string"==typeof $m&&($m=parseInt($m+"")),this._spacing===$R._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$m;}),$D(0,$p,"lineElement",function(){return 0!=(65536&this._type);},function($m){$m?this._type|=65536:this._type&=-65537;}),$D(0,$p,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left";},function($m){this.lineElement=!1,"right"===$m?this._type|=32768:this._type&=-32769;}),$D(0,$p,"textDecoration",function(){return this._font.decoration;},function($m){this._createFont().decoration=$m;}),$D(0,$p,"whiteSpace",function(){return 131072&this._type?"nowrap":"";},function($m){"nowrap"===$m&&(this._type|=131072),"none"===$m&&(this._type&=-131073);}),$D(0,$p,"background",null,function($m){$m?(this._bgground||(this._bgground={}),this._bgground.color=$m,this._ower.conchModel&&this._ower.conchModel.bgColor($m),this._type|=16384,this._ower._renderType|=256):this._bgground=null;}),$D(0,$p,"wordWrap",function(){return 0==(131072&this._type);},function($m){$m?this._type&=-131073:this._type|=131072;}),$D(0,$p,"color",function(){return this._font.color;},function($m){this._createFont().color=$m;}),$D(0,$p,"password",function(){return this._font.password;},function($m){this._createFont().password=$m;}),$D(0,$p,"backgroundColor",function(){return this._bgground?this._bgground.color:null;},function($m){"none"===$m?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$m),this._ower.conchModel&&this._ower.conchModel.bgColor($m),this._ower._renderType|=256;}),$D(0,$p,"font",function(){return this._font.toString();},function($m){this._createFont().set($m);}),$D(0,$p,"weight",null,function($m){this._createFont().weight=$m;}),$D(0,$p,"letterSpacing",function(){return this._spacing[0];},function($m){"string"==typeof $m&&($m=parseInt($m+"")),this._spacing===$R._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$m;}),$D(0,$p,"fontSize",function(){return this._font.size;},function($m){this._createFont().size=$m;}),$D(0,$p,"italic",function(){return this._font.italic;},function($m){this._createFont().italic=$m;}),$D(0,$p,"fontFamily",function(){return this._font.family;},function($m){this._createFont().family=$m;}),$D(0,$p,"stroke",function(){return this._font.stroke[0];},function($m){this._createFont().stroke===$$._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$m;}),$D(0,$p,"strokeColor",function(){return this._font.stroke[1];},function($m){this._createFont().stroke===$$._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$m;}),$D(0,$p,"border",function(){return this._border?this._border.value:"";},function($m){if("none"!=$m){this._border||(this._border={});var $p=(this._border.value=$m).split(" ");if(this._border.color=$U.create($p[$p.length-1]),1==$p.length)return this._border.size=1,void(this._border.type="solid");var $h=0;0<$p[0].indexOf("px")?(this._border.size=parseInt($p[0]),$h++):this._border.size=1,this._border.type=$p[$h],this._ower._renderType|=256;}else this._border=null;}),$D(0,$p,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null;},function($m){$m?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$m?null:$U.create($m),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null;}),$D(0,$p,"position",function(){return 4&this._type?"absolute":"";},function($m){"absolute"==$m?this._type|=4:this._type&=-5;}),$D(0,$p,"display",null,function($m){switch($m){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater();}}),$D(0,$p,"paddingLeft",function(){return this.padding[3];}),$D(0,$p,"paddingTop",function(){return this.padding[0];}),$D(0,$p,"_scale",null,function($m){this._ower.scale($m[0],$m[1]);}),$D(0,$p,"_rotate",null,function($m){this._ower.rotation=$m;}),$R.parseOneCSS=function($m,$p){for(var $h,$P=[],$L=$m.split($p),$q=0,$k=$L.length;$q<$k;$q++){var $Y=$L[$q],$d=$Y.indexOf(":"),$K=$Y.substr(0,$d).replace(/^\s+|\s+$/g,"");if(0!=$K.length){var $D=$Y.substr($d+1).replace(/^\s+|\s+$/g,""),$F=[$K,$D];switch($K){case"italic":case"bold":$F[1]="true"==$D;break;case"line-height":$F[0]="lineHeight",$F[1]=parseInt($D);break;case"font-size":$F[0]="fontSize",$F[1]=parseInt($D);break;case"padding":1<($h=$D.split(" ")).length||($h[1]=$h[2]=$h[3]=$h[0]),$F[1]=[parseInt($h[0]),parseInt($h[1]),parseInt($h[2]),parseInt($h[3])];break;case"rotate":$F[0]="_rotate",$F[1]=parseFloat($D);break;case"scale":$h=$D.split(" "),$F[0]="_scale",$F[1]=[parseFloat($h[0]),parseFloat($h[1])];break;case"translate":$h=$D.split(" "),$F[0]="_translate",$F[1]=[parseInt($h[0]),parseInt($h[1])];break;default:($F[0]=$R._CSSTOVALUE[$K])||($F[0]=$K);}$P.push($F);}}return $P;},$R.parseCSS=function($m,$p){for(var $h;null!=($h=$R._parseCSSRegExp.exec($m));)$R.styleSheets[$h[1]]=$R.parseOneCSS($h[2],";");},$R.EMPTY=new $R(null),$R._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$R._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$R._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$R._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$R.styleSheets={},$R.ALIGN_CENTER=1,$R.ALIGN_RIGHT=2,$R.VALIGN_MIDDLE=1,$R.VALIGN_BOTTOM=2,$R._CSS_BLOCK=1,$R._DISPLAY_NONE=2,$R._ABSOLUTE=4,$R._WIDTH_SET=8,$R._PADDING=[0,0,0,0],$R._RECT=[-1,-1,-1,-1],$R._SPACING=[0,0],$R._ALIGNS=[0,0,0],$R.ADDLAYOUTED=512,$R._NEWFONT=4096,$R._HEIGHT_SET=8192,$R._BACKGROUND_SET=16384,$R._FLOAT_RIGHT=32768,$R._LINE_ELEMENT=65536,$R._NOWARP=131072,$R._WIDTHAUTO=262144,$R._LISTERRESZIE=524288,$R;}($Y),$hm=function($m){function $k(){this.url=null,this.audio=null,this.loaded=!1,$k.__super.call(this);}$B($k,"laya.media.h5audio.AudioSound",$K);var $p=$k.prototype;return $p.dispose=function(){var $m=$k._audioCache[this.url];$m&&($m.src="",delete $k._audioCache[this.url]);},$p.load=function($m){var $p;if($m=$N.formatURL($m),(this.url=$m)==$x._tMusic?($k._initMusicAudio(),($p=$k._musicAudio).src!=$m&&($k._audioCache[$p.src]=null,$p=null)):$p=$k._audioCache[$m],$p&&2<=$p.readyState)this.event("complete");else{$p||($p=$m==$x._tMusic?($k._initMusicAudio(),$k._musicAudio):$w.createElement("audio"),($k._audioCache[$m]=$p).src=$m),$p.addEventListener("canplaythrough",$P),$p.addEventListener("error",$L);var $h=this;(this.audio=$p).load?$p.load():$L();}function $P(){$q(),$h.loaded=!0,$h.event("complete");}function $L(){$p.load=null,$q(),$h.event("error");}function $q(){$p.removeEventListener("canplaythrough",$P),$p.removeEventListener("error",$L);}},$p.play=function($m,$p,$h){if(void 0===$m&&($m=0),void 0===$p&&($p=0),!this.url)return null;var $P,$L;if(!($P=this.url==$x._tMusic?$k._musicAudio:$k._audioCache[this.url]))return null;$L=$o.getItem("audio:"+this.url),$S.isConchApp?$L||(($L=$w.createElement("audio")).src=this.url):this.url==$x._tMusic?($k._initMusicAudio(),($L=$k._musicAudio).src=this.url):$L=$L||$P.cloneNode(!0);var $q=new $Rm($L);return $q.url=this.url,$q.loops=$p,$q.startTime=$m,$q.startHandler=$h,$q.play(!1),$x.addChannel($q),$q;},$D(0,$p,"duration",function(){var $m;return($m=$k._audioCache[this.url])?$m.duration:0;}),$k._initMusicAudio=function(){$k._musicAudio||($k._musicAudio||($k._musicAudio=$w.createElement("audio")),$S.isConchApp||$w.document.addEventListener("mousedown",$k._makeMusicOK));},$k._makeMusicOK=function(){$w.document.removeEventListener("mousedown",$k._makeMusicOK),$k._musicAudio.src?$k._musicAudio.play():($k._musicAudio.src="",$k._musicAudio.load());},$k._audioCache={},$k._musicAudio=null,$k;}(),$Pm=function($m){function $p(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$p.__super.call(this);}$B($p,"laya.media.SoundChannel",$K);var $h=$p.prototype;return $h.play=function(){},$h.stop=function(){},$h.pause=function(){},$h.resume=function(){},$h.__runComplete=function($m){$m&&$m.run();},$D(0,$h,"volume",function(){return 1;},function($m){}),$D(0,$h,"position",function(){return 0;}),$D(0,$h,"duration",function(){return 0;}),$p;}(),$Lm=function($m){function $p(){$p.__super.call(this);}$B($p,"laya.media.Sound",$K);var $h=$p.prototype;return $h.load=function($m){},$h.play=function($m,$p,$h){return void 0===$m&&($m=0),void 0===$p&&($p=0),null;},$h.dispose=function(){},$D(0,$h,"duration",function(){return 0;}),$p;}(),$qm=function($m){function $L(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$L.__super.call(this);}$B($L,"laya.media.webaudio.WebAudioSound",$K);var $p=$L.prototype;return $p.load=function($m){this.url=$m,this.audioBuffer=$L._dataCache[$m],this.audioBuffer?this._loaded(this.audioBuffer):($L.e.on("loaded:"+$m,this,this._loaded),$L.e.on("err:"+$m,this,this._err),$L.__loadingSound[$m]||($L.__loadingSound[$m]=!0,$E.loader.load($m,$e.create(this,this.onloaded),null,$Ym.BUFFER,4,!1,null,!0)));},$p.onloaded=function($m){$m||this._err(),this._disposed?this._removeLoadEvents():(this.data=$m,$L.buffs.push({buffer:this.data,url:this.url}),$L.decode());},$p._err=function(){if(this._removeLoadEvents(),$L.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $m,$p,$h,$P=0;for($m=($p=this.__toPlays).length,$P=0;$P<$m;$P++)($h=$p[$P])[3]&&!$h[3].isStopped&&$h[3].event("error");this.__toPlays.length=0;}},$p._loaded=function($m){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$m,this.loaded=!0,this.event("complete"));},$p._removeLoadEvents=function(){$L.e.off("loaded:"+this.url,this,this._loaded),$L.e.off("err:"+this.url,this,this._err);},$p.__playAfterLoaded=function(){if(this.__toPlays){var $m,$p,$h,$P=0;for($m=($p=this.__toPlays).length,$P=0;$P<$m;$P++)($h=$p[$P])[3]&&!$h[3].isStopped&&this.play($h[0],$h[1],$h[2],$h[3]);this.__toPlays.length=0;}},$p.play=function($m,$p,$h,$P){return void 0===$m&&($m=0),void 0===$p&&($p=0),$P=$P||new $$m(),this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$m,$p,$h,$P]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$P.url=this.url,$P.loops=$p,$P.audioBuffer=this.audioBuffer,$P.startTime=$m,$P.startHandler=$h,$P.play(!1),$x.addChannel($P),$P;},$p.dispose=function(){this._disposed=!0,delete $L._dataCache[this.url],delete $L.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[];},$D(0,$p,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0;}),$L.decode=function(){if(!($L.buffs.length<=0||$L.isDecoding))if($L.isDecoding=!0,($L.tInfo=$L.buffs.shift())&&$L.tInfo.buffer&&$L.tInfo.buffer.byteLength)try{$L.ctx.decodeAudioData($L.tInfo.buffer,$L._done,$L._fail);}catch($m){console.error("decodeAudioData error  byteLength:"+$L.tInfo.buffer.byteLength+"  url:"+$L.tInfo.url);}else $L._fail();},$L._done=function($m){$L.e.event("loaded:"+$L.tInfo.url,$m),$L._dataCache[$L.tInfo.url]=$m,$L.isDecoding=!1,$L.decode();},$L._fail=function(){$L.e.event("err:"+$L.tInfo.url,null),$L.isDecoding=!1,$L.decode();},$L._playEmptySound=function(){if(null!=$L.ctx){if($L._emptySource&&($L._emptySource.stop(),$L._emptySource.disconnect(0),!$$m._tryCleanFailed))try{$L._emptySource.buffer=null;}catch($m){$$m._tryCleanFailed=!0;}var $m=$L.ctx.createBufferSource();$m.buffer=$L._miniBuffer,$m.connect($L.ctx.destination),$m.start(0,0,0),$L._emptySource=$m;}},$L._unlock=function(){$L._unlocked||($L._playEmptySound(),"running"==$L.ctx.state?($w.document.removeEventListener("mousedown",$L._unlock,!0),$w.document.removeEventListener("touchend",$L._unlock,!0),$w.document.removeEventListener("touchstart",$L._unlock,!0),$L._unlocked=!0):"suspended"==$L.ctx.state&&$x._recoverWebAudio());},$L.initWebAudio=function(){"running"!=$L.ctx.state&&($L._unlock(),$w.document.addEventListener("mousedown",$L._unlock,!0),$w.document.addEventListener("touchend",$L._unlock,!0),$w.document.addEventListener("touchstart",$L._unlock,!0));},$L._emptySource=null,$L._dataCache={},$L.buffs=[],$L.isDecoding=!1,$L._unlocked=!1,$L.tInfo=null,$L.__loadingSound={},$d($L,["window",function(){return this.window=$w.window;},"webAudioEnabled",function(){return this.webAudioEnabled=$L.window.AudioContext||$L.window.webkitAudioContext||$L.window.mozAudioContext;},"ctx",function(){return this.ctx=$L.webAudioEnabled?new($L.window.AudioContext||$L.window.webkitAudioContext||$L.window.mozAudioContext)():void 0;},"_miniBuffer",function(){return this._miniBuffer=$L.ctx.createBuffer(1,1,22050);},"e",function(){return this.e=new $K();}]),$L;}(),$km=function($m){function $p(){this._responseType=null,this._data=null,$p.__super.call(this),this._http=new $w.window.XMLHttpRequest();}$B($p,"laya.net.HttpRequest",$K);var $h=$p.prototype;return $h.send=function($m,$p,$h,$P,$L){void 0===$h&&($h="get"),void 0===$P&&($P="text"),this._responseType=$P,this._data=null;var $q=this,$k=this._http;if($k.open($h,$m,!0),$L)for(var $Y=0;$Y<$L.length;$Y++)$k.setRequestHeader($L[$Y++],$L[$Y]);else $S.isConchApp||($p&&"string"!=typeof $p?$k.setRequestHeader("Content-Type","application/json"):$k.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$k.responseType="arraybuffer"!==$P?"text":"arraybuffer",$k.onerror=function($m){$q._onError($m);},$k.onabort=function($m){$q._onAbort($m);},$k.onprogress=function($m){$q._onProgress($m);},$k.onload=function($m){$q._onLoad($m);},$k.send($p);},$h._onProgress=function($m){$m&&$m.lengthComputable&&this.event("progress",$m.loaded/$m.total);},$h._onAbort=function($m){this.error("Request was aborted by user");},$h._onError=function($m){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText);},$h._onLoad=function($m){var $p=this._http,$h=void 0!==$p.status?$p.status:200;200===$h||204===$h||0===$h?this.complete():this.error("["+$p.status+"]"+$p.statusText+":"+$p.responseURL);},$h.error=function($m){this.clear(),this.event("error",$m);},$h.complete=function(){this.clear();var $p=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$g.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText;}catch($m){$p=!1,this.error($m.message);}$p&&this.event("complete",this._data instanceof Array?[this._data]:this._data);},$h.clear=function(){var $m=this._http;$m.onerror=$m.onabort=$m.onprogress=$m.onload=null;},$D(0,$h,"url",function(){return this._http.responseURL;}),$D(0,$h,"http",function(){return this._http;}),$D(0,$h,"data",function(){return this._data;}),$p;}(),$Ym=function($m){function $T(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$T.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1;}$B($T,"laya.net.Loader",$K);var $p=$T.prototype;return $p.load=function($m,$p,$h,$P,$L){if($m&&""!=$m||console.error("Loader 加载的url不合法 "+$m),void 0===$h&&($h=!0),void 0===$L&&($L=!1),0===(this._url=$m).indexOf("data:image")?this._type=$p="image":this._type=$p||($p=this.getTypeFromUrl($m)),this._cache=$h,this._data=null,!$L&&$T.loadedMap[$m])return this._data=$T.loadedMap[$m],this.event("progress",1),void this.event("complete",this._data);if($P&&$T.setGroup($m,$P),null!=$T.parserMap[$p])return this._customParse=!0,void($T.parserMap[$p]instanceof laya.utils.Handler?$T.parserMap[$p].runWith(this):$T.parserMap[$p].call(null,this));if("image"===$p||"htmlimage"===$p||"nativeimage"===$p)return this._loadImage($m);if("ttf"===$p)return this._loadTTF($m);switch($p){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$p;}$T.preLoadedMap[$m]?this.onLoaded($T.preLoadedMap[$m]):$k.resMgrLoad($m,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime);},$p.getTypeFromUrl=function($m){var $p=$g.getFileExtension($m);return $p?$T.typeMap[$p]:(console.warn("Not recognize the resources suffix",$m),"text");},$p._loadTTF=function($m){$m=$N.formatURL($m);var $p=new $u();$p.complete=$e.create(this,this.onLoaded),$p.load($m);},$p._loadImage=function($m){$k.imgMgrLoad($m,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime);},$p._loadImageComplete=function($m,$p,$h){if(null!=$h){if($h instanceof ArrayBuffer){var $P=new DataView($h),$L=new laya.webgl.resource.WebGLImage(new Uint8Array($h,8),$m,0,!1,$P.getUint32(0),$P.getUint32(4));this.onLoaded($L);}else if($h instanceof $Dm)$T.imgMgrSet[$m]=$p,$k.imgMgrLock($m,$T.imgMgrSet[$m]),this._url=$m,this.complete($h);else{var $q=-1!=$m.indexOf(".png",$m.length-4)?6408:6407;$L=new laya.webgl.resource.WebGLImage($h,$m,$q,!1,$h.width,$h.height);this.onLoaded($L);}}else this.event("error","Load image failed");},$p.imageCancel=function($m,$p,$h){$k.imgMgrCancel&&$k.imgMgrCancel($m,this._onImageCallback);},$p._loadSound=function($m){var $p=new $x._soundClass(),$h=this;function $P(){$p.offAll();}$p.on("complete",this,function(){$P(),$h.onLoaded($p);}),$p.on("error",this,function(){$P(),$p.dispose(),$h.event("error","Load sound failed");}),$p.load($m);},$p.onProgress=function($m){"atlas"===this._type?this.event("progress",.3*$m):this.event("progress",$m);},$p.onError=function($m){this.event("error",$m);},$p._loadedComplete=function($m,$p,$h){if(null!=$h)switch(this._type){case"atlas":case"plf":case"json":var $P=new $X($h);this.onLoaded(JSON.parse($P.readUTFBytes()));break;case"font":$P=new $X($h);this.onLoaded($g.parseXMLFromString($P.readUTFBytes()));break;default:this.onLoaded($h);}else this.event("error",$m);},$p.onLoaded=function($m){var $p=this._type;if("plf"==$p)this.parsePLFData($m),this.complete($m);else if("image"===$p){var $h=new $Dm($m);$h.url=this._url,this.complete($h);}else if("sound"===$p||"htmlimage"===$p||"nativeimage"===$p)this.complete($m);else if("atlas"===$p){if(!$m.src&&!$m._setContext){if(!this._data){if((this._data=$m).meta&&$m.meta.image)for(var $P=$m.meta.image.split(","),$L=0<=this._url.indexOf("/")?"/":"\\",$q=this._url.lastIndexOf($L),$k=0<=$q?this._url.substr(0,$q+1):"",$Y=0,$d=$P.length;$Y<$d;$Y++)$P[$Y]=$k+$P[$Y];else $P=[this._url.replace(".json",".png")];$P.reverse(),$m.toLoads=$P,$m.pics=[];}return this.event("progress",.3+1/$P.length*.6),this._loadImage($P.pop());}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($m),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $K=this._data.frames,$D=this._url.split("?")[0],$F=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$D.substring(0,$D.lastIndexOf("."))+"/",$R=this._data.pics,$$=$N.formatURL(this._url),$A=$T.atlasMap[$$]||($T.atlasMap[$$]=[]);$A.dir=$F;var $B=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $n in $B=parseFloat(this._data.meta.scale),$K){var $c,$e=$K[$n],$a=$R[$e.frame.idx?$e.frame.idx:0],$Z=$N.formatURL($F+$n);$a.scaleRate=$B,$c=$Dm.create($a,$e.frame.x,$e.frame.y,$e.frame.w,$e.frame.h,$e.spriteSourceSize.x,$e.spriteSourceSize.y,$e.sourceSize.w,$e.sourceSize.h),$T.cacheRes($Z,$c),$T.keepCache(this._url,$F+$n),$c.url=$Z,$A.push($Z);}else for($n in $K)$a=$R[($e=$K[$n]).frame.idx?$e.frame.idx:0],$Z=$N.formatURL($F+$n),$T.cacheRes($Z,$Dm.create($a,$e.frame.x,$e.frame.y,$e.frame.w,$e.frame.h,$e.spriteSourceSize.x,$e.spriteSourceSize.y,$e.sourceSize.w,$e.sourceSize.h)),$T.loadedMap[$Z].url=$Z,$T.keepCache(this._url,$F+$n),$A.push($Z);delete this._data.pics,this.complete(this._data);}else if("font"==$p){if(!$m.src)return this._data=$m,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $H=new $j();$H.parseFont(this._data,$m);var $W=this._url.split(".fnt")[0].split("/"),$E=$W[$W.length-1];$nm.registerBitmapFont($E,$H),this._data=$H,this.complete(this._data);}else if("pkm"==$p){var $I=$Wm.create($m,this._url),$b=new $Dm($I);$b.url=this._url,this.complete($b);}else this.complete($m);},$p.parsePLFData=function($m){var $p,$h,$P;for($p in $m)switch($P=$m[$p],$p){case"json":case"text":for($h in $P)$T.preLoadedMap[$N.formatURL($h)]=$P[$h];break;default:for($h in $P)$T.preLoadedMap[$N.formatURL($h)]=$P[$h];}},$p.complete=function($m){this._data=$m,this._customParse?this.event("loaded",$m instanceof Array?[$m]:$m):($T._loaders.push(this),$T._isWorking||$T.checkNext());},$p.endLoad=function($m){$m&&(this._data=$m),this._cache&&$T.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data);},$D(0,$p,"url",function(){return this._url;}),$D(0,$p,"data",function(){return this._data;}),$D(0,$p,"cache",function(){return this._cache;}),$D(0,$p,"type",function(){return this._type;}),$T.checkNext=function(){$T._isWorking=!0;for(var $m=$w.now();$T._startIndex<$T._loaders.length;)if($w.now(),$T._loaders[$T._startIndex].endLoad(),$T._startIndex++,$w.now()-$m>$T.maxTimeOut)return console.warn("loader callback cost a long time:"+($w.now()-$m)+" url="+$T._loaders[$T._startIndex-1].url),void $E.timer.frameOnce(1,null,$T.checkNext);$T._loaders.length=0,$T._startIndex=0,$T._isWorking=!1;},$T.clearRes=function($m,$p){if(null!=$m){void 0===$p&&($p=!1),$m=$N.formatURL($m);var $h=$T.getAtlas($m);if($h){for(var $P=0,$L=$h.length;$P<$L;$P++){var $q=$h[$P],$k=$T.getRes($q);delete $T.loadedMap[$q],$T.clearCache($m.substring($N.basePath.length),$q.substring($N.basePath.length)),$k&&$k.destroy($p);}$h.length=0,delete $T.atlasMap[$m],delete $T.loadedMap[$m];}else{var $Y=$T.loadedMap[$m];$Y&&(delete $T.loadedMap[$m],$Y instanceof laya.resource.Texture&&$Y.bitmap&&$Y.destroy($p));}}},$T.clearTextureRes=function($m){$m=$N.formatURL($m);var $p=laya.net.Loader.getAtlas($m),$h=$p&&0<$p.length?laya.net.Loader.getRes($p[0]):laya.net.Loader.getRes($m);$h&&$h.bitmap&&($S.isConchApp&&!$S.isConchWebGL?$h.bitmap.source.releaseTexture&&$h.bitmap.source.releaseTexture():null==$h.bitmap._atlaser&&$h.bitmap.releaseResource(!0));},$T.getRes=function($m){return $T.loadedMap[$N.formatURL($m)];},$T.getAtlas=function($m){return $T.atlasMap[$N.formatURL($m)];},$T.cacheRes=function($m,$p){$m=$N.formatURL($m),null!=$T.loadedMap[$m]?console.warn("Resources already exist,is repeated loading:",$m):$T.loadedMap[$m]=$p;},$T.setGroup=function($m,$p){$T.groupMap[$p]||($T.groupMap[$p]=[]),$T.groupMap[$p].push($m);},$T.clearResByGroup=function($m){if($T.groupMap[$m]){var $p=$T.groupMap[$m],$h=0,$P=$p.length;for($h=0;$h<$P;$h++)$T.clearRes($p[$h]);$p.length=0;}},$T.keepCache=function($m,$p){if($m&&$p){var $h=$T.cacheSet[$p];$h?-1==$h.indexOf($m)&&$h.push($m):$T.cacheSet[$p]=[$m];}},$T.clearCache=function($m,$p){if($m&&$p){var $h=$T.cacheSet[$p];if($h){var $P=$h.indexOf($m);if(-1!==$P){var $L=$h.length-1;0==$L?(delete $T.cacheSet[$p],0<$T.imgMgrSet[$p]?$k.imgMgrFree($p,$T.imgMgrSet[$p]):$T.clearRes($p,!0)):($h[$P]=$h[$L],$h.length=$L);}}}},$T.saveObject=function($m,$p,$h){if($p&&$m){var $P=$T.objectSet[$m];$P?(console.warn("Loader.saveObject: "+$m),$P[0]=$p,$P[1]=$h):$T.objectSet[$m]=[$p,$h,[]];}},$T.findObject=function($m){if($m){var $p=$T.objectSet[$m];if($p)return $p[0];}return null;},$T.keepObject=function($m,$p){if($m&&$p){var $h=$T.objectSet[$p];$h&&-1===$h[2].indexOf($m)&&$h[2].push($m);}},$T.clearObject=function($m,$p){if($m&&$p){var $h=$T.objectSet[$p];if($h){var $P=$h[2],$L=$P.indexOf($m);if(-1!==$L){var $q=$P.length-1;0==$q?(delete $T.objectSet[$p],$h[1]&&$h[1].call(null,$h[0])):($P[$L]=$P[$q],$P.length=$q);}}}},$T.TEXT="text",$T.JSON="json",$T.XML="xml",$T.BUFFER="arraybuffer",$T.IMAGE="image",$T.SOUND="sound",$T.ATLAS="atlas",$T.FONT="font",$T.TTF="ttf",$T.PLF="plf",$T.PKM="pkm",$T.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$T.parserMap={},$T.groupMap={},$T.maxTimeOut=100,$T.loadedMap={},$T.preLoadedMap={},$T.atlasMap={},$T._loaders=[],$T._isWorking=!1,$T._startIndex=0,$T.imgCache={},$T.cacheSet={},$T.objectSet={},$T.imgMgrSet={},$T;}(),$dm=function($m){var $R;function $$(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$$.__super.call(this);for(var $m=0;$m<this._maxPriority;$m++)this._resInfos[$m]=[];}$B($$,"laya.net.LoaderManager",$K);var $p=$$.prototype;return $p.create=function($m,$h,$p,$P,$L,$q,$k,$Y){if(null==$q&&($q=2),null==$k&&($k=!0),$m instanceof Array){var $d=$m,$K=$d.length,$D=0;if($p)var $F=$e.create($p.caller,$p.method,$p.args,!1);for(var $R=0;$R<$K;$R++){var $$=$d[$R];"string"==typeof $$&&($$=$d[$R]={url:$$}),$$.progress=0;}for($R=0;$R<$K;$R++){$$=$d[$R];var $A=$p?$e.create(null,$c,[$$],!1):null,$B=$p||$h?$e.create(null,$n,[$$]):null;this._create($$.url,$B,$A,$$.clas||$P,$$.params||$L,null!=$$.priority&&0<=$$.priority?$$.priority:$q,$k,$$.group||$Y);}function $n($m,$p){$D++,$m.progress=1,$D===$K&&$h&&$h.run();}function $c($m,$p){$m.progress=$p;for(var $h=0,$P=0;$P<$K;$P++){$h+=$d[$P].progress;}var $L=$h/$K;$F.runWith($L);}return!0;}return this._create($m,$h,$p,$P,$L,$q,$k,$Y);},$p._create=function($p,$h,$m,$P,$L,$q,$k,$Y){$p&&""!=$p||console.error("加载的url不合法 "+$p),null==$q&&($q=2),null==$k&&($k=!0);var $d=$N.formatURL($p),$K=this.getRes($d);if($K)!$K.hasOwnProperty("loaded")||$K.loaded?($m&&$m.runWith(1),$h&&$h.run()):$h&&$E.loader._createListener($p,$h.caller,$h.method,$h.args,!0,!1);else{var $D=$g.getFileExtension($p),$F=$$.createMap[$D];if(!$F)throw new Error("LoaderManager:unknown file("+$p+") extension with: "+$D+".");$P||($P=$F[0]);var $R=$F[1];if("atlas"==$D)this.load($p,$h,$m,$R,$q,$k);else{$P===$Dm&&($R="htmlimage"),($K=$P?new $P():null).hasOwnProperty("_loaded")&&($K._loaded=!1),$K._setUrl($p),$Y&&$K._setGroup($Y),this._createLoad($K,$p,$e.create(null,function($m){$K&&!$K.destroyed&&$m&&$K.onAsynLoaded.call($K,$p,$m,$L),$h&&$h.run();$E.loader.event($p);}),$m,$R,$q,!1,$Y,!0),$k&&this.cacheRes($d,$K);}}return $K;},$p.load=function($m,$p,$h,$P,$L,$q,$k,$Y){$m&&""!=$m||console.error("加载的url不合法 "+$m);var $d=this;if(null==$L&&($L=2),null==$q&&($q=!0),void 0===$Y&&($Y=!1),$m instanceof Array)return this._loadAssets($m,$p,$h,$P,$L,$q,$k);var $K=$Ym.getRes($m);if(null!=$K)$E.timer.frameOnce(1,null,function(){$h&&$h.runWith(1),$p&&$p.runWith($K),$d._loaderCount||$d.event("complete");});else{var $D=$$._resMap[$m];$D?($p&&$D._createListener("complete",$p.caller,$p.method,$p.args,!1,!1),$h&&$D._createListener("progress",$h.caller,$h.method,$h.args,!1,!1)):(($D=this._infoPool.length?this._infoPool.pop():new $R()).url=$m,$D.clas=null,$D.type=$P,$D.cache=$q,$D.group=$k,$D.ignoreCache=$Y,$D.priority=$L,$p&&$D.on("complete",$p.caller,$p.method,$p.args),$h&&$D.on("progress",$h.caller,$h.method,$h.args),$$._resMap[$m]=$D,$L=$L<this._maxPriority?0<=$L?$L:0:this._maxPriority-1,this._resInfos[$L].push($D),this._next());}return this;},$p.cancel=function($m,$p,$h){if($K=$$._resMap[$m]){$p&&$K.off("complete",$p.caller,$p.method,!1),$h&&$K.off("progress",$h.caller,$h.method,!1);var $P=$K.getListener("complete"),$L=$K.getListener("progress");if(!($P&&$P.head||$L&&$L.head)){if($K.loader){var $q=$K.loader;$q.imageCancel($m),$q.offAll(),$q._data=null,$q._customParse=!1,$q._url=null,$q._class=null,$q._type=null,this._loaders.push($q),this._loaderCount--,delete this._loaderMap[$K.url];}for(var $k=0;$k<this._maxPriority;$k++)for(var $Y=this._resInfos[$k],$d=$Y.length-1;-1<$d;$d--){var $K;($K=$Y[$d])&&$K.url===$m&&($Y[$d]=null,$K.destroy(),$K.offAll(),this._infoPool.push($K));}delete $$._resMap[$m],this._next();}}},$p._createLoad=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){var $K=this;if(null==$q&&($q=2),null==$k&&($k=!0),void 0===$d&&($d=!1),$p instanceof Array)return this._loadAssets($p,$h,$P,$L,$q,$k,$Y);var $D=$Ym.getRes($p);if(null!=$D)$E.timer.frameOnce(1,null,function(){$P&&$P.runWith(1),$h&&$h.runWith($D),$K._loaderCount||$K.event("complete");});else{var $F=$$._resMap[$p];$F?($h&&$F._createListener("complete",$h.caller,$h.method,$h.args,!1,!1),$P&&$F._createListener("progress",$P.caller,$P.method,$P.args,!1,!1)):(($F=this._infoPool.length?this._infoPool.pop():new $R()).url=$p,$F.clas=$m,$F.type=$L,$F.cache=$k,$F.group=$Y,$F.ignoreCache=$d,$F.priority=$q,$h&&$F.on("complete",$h.caller,$h.method,$h.args),$P&&$F.on("progress",$P.caller,$P.method,$P.args),$$._resMap[$p]=$F,$q=$q<this._maxPriority?0<=$q?$q:0:this._maxPriority-1,this._resInfos[$q].push($F),this._next());}return this;},$p._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $m=0;$m<this._maxPriority;$m++)for(var $p=this._resInfos[$m];0<$p.length;){var $h=$p.shift();if($h)return this._doLoad($h);}this._loaderCount||this.event("complete");}},$p._doLoad=function($p){var $h=this._loaders.length?this._loaders.pop():new $Ym();this._loaderCount++,(this._loaderMap[$p.url]=$h).on("complete",null,$L),$h.on("progress",null,function($m){$p.event("progress",$m);}),$h.on("error",null,function($m){$L(null);}),$p.loader=$h;var $P=this;function $L($m){$h.offAll(),$h._data=null,$h._customParse=!1,$h._url=null,$h._class=null,$h._type=null,$P._loaders.push($h),$P._loaderCount--,delete $P._loaderMap[$p.url],$P._endLoad($p,$m instanceof Array?[$m]:$m),$P._next();}$h._class=$p.clas,1<=$p.priority?($h.priority=$p.priority,$h.realTime=!1):($h.priority=0,$h.realTime=!0),$h.load($p.url,$p.type,$p.cache,$p.group,$p.ignoreCache);},$p._endLoad=function($m,$p){var $h=$m.url;if(null==$p){var $P=this._failRes[$h]||0;if($P<this.retryNum)return console.warn("[warn]Retry to load:",$h),this._failRes[$h]=$P+1,void $E.timer.once(this.retryDelay,this,this._addReTry,[$m],!1);console.warn("[error]Failed to load:",$h),this.event("error",$h);}this._failRes[$h]&&(this._failRes[$h]=0),delete $$._resMap[$h],$m.event("complete",$p),$m.destroy(),$m.offAll(),this._infoPool.push($m);},$p._addReTry=function($m){this._resInfos[this._maxPriority-1].push($m),this._next();},$p.clearRes=function($m,$p){void 0===$p&&($p=!1),$Ym.clearRes($m,$p);},$p.getRes=function($m){return $Ym.getRes($m);},$p.cacheRes=function($m,$p){$Ym.cacheRes($m,$p);},$p.clearTextureRes=function($m){$Ym.clearTextureRes($m);},$p.setGroup=function($m,$p){$Ym.setGroup($m,$p);},$p.clearResByGroup=function($m){$Ym.clearResByGroup($m);},$p.clearUnLoaded=function(){for(var $m=0;$m<this._maxPriority;$m++){for(var $p=this._resInfos[$m],$h=$p.length-1;-1<$h;$h--){var $P=$p[$h];$P&&($P.destroy(),$P.offAll(),this._infoPool.push($P));}$p.length=0;}this._loaderCount=0,$$._resMap={};},$p.cancelLoadByUrls=function($m){if($m)for(var $p=0,$h=$m.length;$p<$h;$p++)this.cancelLoadByUrl($m[$p]);},$p.cancelLoadByUrl=function($m){for(var $p=0;$p<this._maxPriority;$p++)for(var $h=this._resInfos[$p],$P=$h.length-1;-1<$P;$P--){var $L=$h[$P];$L&&$L.url===$m&&($h[$P]=null,$L.destroy(),$L.offAll(),this._infoPool.push($L));}$$._resMap[$m]&&delete $$._resMap[$m];},$p._loadAssets=function($m,$h,$k,$p,$P,$L,$q){null==$P&&($P=2),null==$L&&($L=!0);for(var $Y=$m.length,$d=0,$K=0,$D=[],$F=!0,$R=0;$R<$Y;$R++){var $$=$m[$R];if(!$$)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$m);"string"==typeof $$&&($$={url:$$,type:$p,size:1,priority:$P}),$$.size||($$.size=1),$$.progress=0,$K+=$$.size,$D.push($$);var $A=$k?$e.create(null,$c,[$$],!1):null,$B=$h||$k?$e.create(null,$n,[$$]):null;this.load($$.url,$B,$A,$$.type,null!=$$.priority&&0<=$$.priority?$$.priority:2,$L,$$.group||$q);}function $n($m,$p){$d++,$m.progress=1,$p||($F=!1),$d===$Y&&$h&&$h.runWith($F);}function $c($m,$p){if(null!=$k){$m.progress=$p;for(var $h=0,$P=0;$P<$D.length;$P++){var $L=$D[$P];$h+=$L.size*$L.progress;}var $q=$h/$K;$k.runWith($q);}}return this;},$$.cacheRes=function($m,$p){$Ym.cacheRes($m,$p);},$$._resMap={},$d($$,["createMap",function(){return this.createMap={atlas:[null,"atlas"]};}]),$$.__init$=function(){$R=function($m){function $p(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$p.__super.call(this);}return $B($p,"",$K),$p.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1;},$p;}();},$$;}(),$Km=(function($m){function $L($m){$L.__super.call(this),$m||($m=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $p=0,$h=0,$P=0;$P<20;$P++)$P%5!=4?this._mat[$p++]=$m[$P]:this._alpha[$h++]=$m[$P];this._action=$Q.createFilterAction(32),this._action.data=this;}$B($L,"laya.filters.ColorFilter",$c);var $p=$L.prototype;$E.imps($p,{"laya.filters.IFilter":!0}),$p.callNative=function($m){$m._$P.cf=this;$m.conchModel&&$m.conchModel.setFilterMatrix&&$m.conchModel.setFilterMatrix(this._mat,this._alpha);},$D(0,$p,"type",function(){return 32;}),$D(0,$p,"action",function(){return this._action;});}(),function($m){function $P($m,$p,$h){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$p&&($p=0),$P.__super.call(this),this._byteClass=$h||$X,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$m&&0<$p&&$p<65535&&this.connect($m,$p);}$B($P,"laya.net.Socket",$K);var $p=$P.prototype;$p.connect=function($m,$p){var $h="ws://"+$m+":"+$p;$h="https:"==$w.window.location.protocol?"wss://"+$m+":"+$p:"ws://"+$m+":"+$p,this.connectByUrl($h);},$p.connectByUrl=function($m){var $p=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $w.window.WebSocket($m,this.protocols):this._socket=new $w.window.WebSocket($m),this._socket.binaryType="arraybuffer",this._output=new this._byteClass(),this._output.endian=this.endian,this._input=new this._byteClass(),this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($m){$p._onOpen($m);},this._socket.onmessage=function($m){$p._onMessage($m);},this._socket.onclose=function($m){$p._onClose($m);},this._socket.onerror=function($m){$p._onError($m);};},$p.cleanSocket=function(){try{this._socket.close();}catch($m){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null;},$p.close=function(){if(null!=this._socket)try{this._socket.close();}catch($m){}},$p._onOpen=function($m){this._connected=!0,this.event("open",$m);},$p._onMessage=function($m){if($m&&$m.data){var $p=$m.data;if(this.disableInput&&$p)this.event("message",$p);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $h=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$p&&("string"==typeof $p?this._input.writeUTFBytes($p):this._input.writeArrayBuffer($p),this._addInputPosition=this._input.pos,this._input.pos=$h),this.event("message",$p);}}},$p._onClose=function($m){this._connected=!1,this.event("close",$m);},$p._onError=function($m){this.event("error",$m);},$p.send=function($m){this._socket.send($m);},$p.flush=function(){if(this._output&&0<this._output.length){var $p;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length));}catch($m){$p=$m;}this._output.endian=this.endian,this._output.clear(),$p&&this.event("error",$p);}},$D(0,$p,"input",function(){return this._input;}),$D(0,$p,"output",function(){return this._output;}),$D(0,$p,"connected",function(){return this._connected;}),$D(0,$p,"endian",function(){return this._endian;},function($m){this._endian=$m,null!=this._input&&(this._input.endian=$m),null!=this._output&&(this._output.endian=$m);}),$P.LITTLE_ENDIAN="littleEndian",$P.BIG_ENDIAN="bigEndian";}(),function($m){function $Y(){$Y.__super.call(this),this._$1__id=++$Y._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($Y._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$z.currentResourceManager&&$z.currentResourceManager.addResource(this);}$B($Y,"laya.resource.Resource",$K);var $p=$Y.prototype;return $E.imps($p,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$p._setUrl=function($m){var $p;this._url!==$m&&(this._url&&(($p=$Y._urlResourcesMap[this._url]).splice($p.indexOf(this),1),0===$p.length&&delete $Y._urlResourcesMap[this._url]),$m&&(($p=$Y._urlResourcesMap[$m])||($Y._urlResourcesMap[$m]=$p=[]),$p.push(this)),this._url=$m);},$p._getGroup=function(){return this._group;},$p._setGroup=function($m){var $p;this._group!==$m&&(this._group&&(($p=$Y._groupResourcesMap[this._group]).splice($p.indexOf(this),1),0===$p.length&&delete $Y._groupResourcesMap[this._group]),$m&&(($p=$Y._groupResourcesMap[$m])||($Y._groupResourcesMap[$m]=$p=[]),$p.push(this)),this._group=$m);},$p._addReference=function(){this._referenceCount++;},$p._removeReference=function(){this._referenceCount--;},$p._clearReference=function(){this._referenceCount=0;},$p._endLoaded=function(){this.__loaded=!0,this.event("loaded",this);},$p.recreateResource=function(){this.completeCreate();},$p.disposeResource=function(){},$p.activeResource=function($m){void 0===$m&&($m=!1),this._lastUseFrameCount=$f.loopCount,!this._destroyed&&this.__loaded&&(this._released||$m)&&this.recreateResource();},$p.releaseResource=function($m){return void 0===$m&&($m=!0),!(!$m&&this.lock)&&!(this._released&&!$m)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0);},$p.onAsynLoaded=function($m,$p,$h){throw new Error("Resource: must override this function!");},$p.destroy=function(){var $m;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $Y._idResourcesMap[this.id],this._url&&(($m=$Y._urlResourcesMap[this._url])&&($m.splice($m.indexOf(this),1),0===$m.length&&delete $Y._urlResourcesMap[this.url]),$Ym.clearRes(this._url),this.__loaded||$Q.cancelLoadByUrl(this._url)),this._group&&(($m=$Y._groupResourcesMap[this._group]).splice($m.indexOf(this),1),0===$m.length&&delete $Y._groupResourcesMap[this.url]));},$p.completeCreate=function(){this._released=!1,this.event("recovered",this);},$p.dispose=function(){this.destroy();},$D(0,$p,"memorySize",function(){return this._memorySize;},function($m){var $p=$m-this._memorySize;this._memorySize=$m,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$p),this.resourceManager&&this.resourceManager.addSize($p);}),$D(0,$p,"_loaded",null,function($m){this.__loaded=$m;}),$D(0,$p,"loaded",function(){return this.__loaded;}),$D(0,$p,"id",function(){return this._$1__id;}),$D(0,$p,"destroyed",function(){return this._destroyed;}),$D(0,$p,"group",function(){return this._getGroup();},function($m){this._setGroup($m);}),$D(0,$p,"resourceManager",function(){return this._resourceManager;}),$D(0,$p,"url",function(){return this._url;}),$D(0,$p,"released",function(){return this._released;}),$D(0,$p,"referenceCount",function(){return this._referenceCount;}),$Y.getResourceByID=function($m){return $Y._idResourcesMap[$m];},$Y.getResourceByURL=function($m,$p){return void 0===$p&&($p=0),null==$Y._urlResourcesMap[$m]?null:$Y._urlResourcesMap[$m][$p];},$Y.getResourceCountByURL=function($m){return $Y._urlResourcesMap[$m].length;},$Y.destroyUnusedResources=function($m){var $p;if($m){var $h=$Y._groupResourcesMap[$m];if($h)for(var $P=$h.slice(),$L=0,$q=$P.length;$L<$q;$L++)($p=$P[$L]).lock||0!==$p._referenceCount||$p.destroy();}else for(var $k in $Y._idResourcesMap)($p=$Y._idResourcesMap[$k]).lock||0!==$p._referenceCount||$p.destroy();},$Y._uniqueIDCounter=0,$Y._idResourcesMap={},$Y._urlResourcesMap={},$Y._groupResourcesMap={},$Y;}()),$Dm=function($m){function $T($m,$p){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$T.__super.call(this),$m&&null!=$m._addReference&&$m._addReference(),this.setTo($m,$p);}$B($T,"laya.resource.Texture",$K);var $p=$T.prototype;return $p._setUrl=function($m){this.url=$m;},$p.setTo=function($m,$p){if($m instanceof $k.HTMLElement){var $h=$am.create("2D",$m);this.bitmap=$h;}else this.bitmap=$m;if(this.uv=$p||$T.DEF_UV,$m){this._w=$m.width,this._h=$m.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $P=this;if(this._loaded)$Q.addToAtlas&&$Q.addToAtlas($P);else{var $L=$m;$L instanceof laya.resource.HTMLImage&&$L.image&&$L.image.addEventListener("load",function($m){$Q.addToAtlas&&$Q.addToAtlas($P);},!1);}}},$p.active=function(){this.bitmap&&this.bitmap.activeResource();},$p.destroy=function($m){if(void 0===$m&&($m=!1),this.alphaTexture&&(this.alphaTexture.destroy($m),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $p=this.bitmap;$m?($S.isConchApp&&$p.source&&$p.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$p.dispose(),$p._clearReference()):($p._removeReference(),0==$p.referenceCount&&($S.isConchApp&&$p.source&&$p.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$p.dispose())),this.url&&this===$E.loader.getRes(this.url)&&$E.loader.clearRes(this.url,$m),this._loaded=!1;}},$p.load=function($m){var $p=this;this._loaded=!1,$m=$N.customFormat($m);var $h=this.bitmap||(this.bitmap=$Wm.create($m));$h.uri=$m,$h&&$h._addReference();var $P=this;$h.onload=function(){$h.onload=null,$P._loaded=!0,$p.sourceWidth=$p._w=$h.width,$p.sourceHeight=$p._h=$h.height,$P.event("loaded",this),$Q.addToAtlas&&$Q.addToAtlas($P);};},$p.addTextureToAtlas=function($m){$Q.addTextureToAtlas(this);},$p.getPixels=function($m,$p,$h,$P){if($S.isConchApp){var $L=this.bitmap;if($L.source&&$L.source.getImageData){var $q=$L.source.getImageData($m,$p,$h,$P),$k=new Uint8Array($q);return Array.from($k);}return null;}return $S.isWebGL?$Q.getTexturePixels(this,$m,$p,$h,$P):($w.canvas.size($h,$P),$w.canvas.clear(),$w.context.drawTexture(this,-$m,-$p,this.width,this.height,0,0),$w.context.getImageData(0,0,$h,$P).data);},$p.onAsynLoaded=function($m,$p){if($p){if("function"!=typeof $p._addReference)throw new Error("bitmap._addReference is not a function. "+$p.className+" "+typeof $p._addReference+" "+$p.constructor);$p._addReference();}this.setTo($p,this.uv),this._loaded&&this.event("loaded",this);},$D(0,$p,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null;}),$D(0,$p,"loaded",function(){return this._loaded;}),$D(0,$p,"released",function(){return!this.bitmap||this.bitmap.released;}),$D(0,$p,"width",function(){return this._w?this._w:this.uv&&this.uv!==$T.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width;},function($m){this._w=$m,this.sourceWidth||(this.sourceWidth=$m);}),$D(0,$p,"repeat",function(){return!$S.isWebGL||!this.bitmap||this.bitmap.repeat;},function($m){$m&&$S.isWebGL&&this.bitmap&&(this.bitmap.repeat=$m)&&(this.bitmap.enableMerageInAtlas=!1);}),$D(0,$p,"height",function(){return this._h?this._h:this.uv&&this.uv!==$T.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height;},function($m){this._h=$m,this.sourceHeight||(this.sourceHeight=$m);}),$D(0,$p,"isLinearSampling",function(){return!$S.isWebGL||9728!=this.bitmap.minFifter;},function($m){!$m&&$S.isWebGL&&($m||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1));}),$T.moveUV=function($m,$p,$h){for(var $P=0;$P<8;$P+=2)$h[$P]+=$m,$h[$P+1]+=$p;return $h;},$T.create=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){void 0===$q&&($q=0),void 0===$k&&($k=0),void 0===$Y&&($Y=0),void 0===$d&&($d=0);var $K=$m instanceof laya.resource.Texture,$D=$K?$m.uv:$T.DEF_UV,$F=$K?$m.bitmap:$m,$R=$Q.isAtlas($F);if($R){var $$=$F._atlaser,$A=$m._atlasID;if(-1==$A)throw new Error("create texture error");$F=$$._inAtlasTextureBitmapValue[$A],$D=$$._inAtlasTextureOriUVValue[$A];}var $B=new $T($F,null);$F.width&&$p+$P>$F.width&&($P=$F.width-$p),$F.height&&$h+$L>$F.height&&($L=$F.height-$h),$B.width=$P,$B.height=$L,$B.offsetX=$q,$B.offsetY=$k,$B.sourceWidth=$Y||$P,$B.sourceHeight=$d||$L;var $n=1/$F.width,$c=1/$F.height;$p*=$n,$h*=$c,$P*=$n,$L*=$c;var $e=$B.uv[0],$a=$B.uv[1],$Z=$B.uv[4],$H=$B.uv[5],$W=$Z-$e,$E=$H-$a,$I=$T.moveUV($D[0],$D[1],[$p,$h,$p+$P,$h,$p+$P,$h+$L,$p,$h+$L]);$B.uv=[$e+$I[0]*$W,$a+$I[1]*$E,$Z-(1-$I[2])*$W,$a+$I[3]*$E,$Z-(1-$I[4])*$W,$H-(1-$I[5])*$E,$e+$I[6]*$W,$H-(1-$I[7])*$E],$R&&$B.addTextureToAtlas();var $b=$F.scaleRate;return $b&&1!=$b?($B.sourceWidth/=$b,$B.sourceHeight/=$b,$B.width/=$b,$B.height/=$b,$B.scaleRate=$b,$B.offsetX/=$b,$B.offsetY/=$b):$B.scaleRate=1,$B;},$T.createFromTexture=function($m,$p,$h,$P,$L){var $q=$m.scaleRate;1!=$q&&($p*=$q,$h*=$q,$P*=$q,$L*=$q);var $k=$b.TEMP.setTo($p-$m.offsetX,$h-$m.offsetY,$P,$L),$Y=$k.intersection($T._rect1.setTo(0,0,$m.width,$m.height),$T._rect2);if(!$Y)return null;var $d=$T.create($m,$Y.x,$Y.y,$Y.width,$Y.height,$Y.x-$k.x,$Y.y-$k.y,$P,$L);if($d.bitmap&&$d.bitmap._removeReference)return $d.bitmap._removeReference(),$d;var $K="bitmap:"+($d.bitmap?$d.bitmap.constructor?$d.bitmap.constructor.name:$d.bitmap.__className:"")+", url:"+($m.url+" | "+($d.bitmap?$d.bitmap.url:$m.url))+", x="+$p+",y="+$h+",width="+$P+",height="+$L+", result="+($Y?$Y.x+","+$Y.y+","+$Y.width+","+$Y.height:"null")+", rect="+$k.x+","+$k.y+","+$k.width+","+$k.height;throw new Error("报错：bitmap._removeReference is not a function  "+$K);},$T.DEF_UV=[0,0,1,0,1,1,0,1],$T.INV_UV=[0,1,1,1,1,0,0,0],$T._rect1=new $b(),$T._rect2=new $b(),$T;}(),$m=function($m){var $Y;function $q(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$q.__super.call(this);}$B($q,"laya.utils.TimeLine",$K);var $p=$q.prototype;return $p.to=function($m,$p,$h,$P,$L){return void 0===$L&&($L=0),this._create($m,$p,$h,$P,$L,!0);},$p.from=function($m,$p,$h,$P,$L){return void 0===$L&&($L=0),this._create($m,$p,$h,$P,$L,!1);},$p._create=function($m,$p,$h,$P,$L,$q){var $k=$o.getItemByClass("tweenData",$Y);return $k.isTo=$q,$k.type=0,$k.target=$m,$k.duration=$h,$k.data=$p,$k.startTime=this._startTime+$L,$k.endTime=$k.startTime+$k.duration,$k.ease=$P,this._startTime=Math.max($k.endTime,this._startTime),this._tweenDataList.push($k),this._startTimeSort=!0,this._endTimeSort=!0,this;},$p.addLabel=function($m,$p){var $h=$o.getItemByClass("tweenData",$Y);return $h.type=1,$h.data=$m,$h.endTime=$h.startTime=this._startTime+$p,this._labelDic||(this._labelDic={}),this._labelDic[$m]=$h,this._tweenDataList.push($h),this;},$p.removeLabel=function($m){if(this._labelDic&&this._labelDic[$m]){var $p=this._labelDic[$m];if($p){var $h=this._tweenDataList.indexOf($p);-1<$h&&this._tweenDataList.splice($h,1);}delete this._labelDic[$m];}},$p.gotoTime=function($m){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $p,$h,$P,$L;for(var $q in this._firstTweenDic)if($h=this._firstTweenDic[$q])for(var $k in $h)$h.diyTarget.hasOwnProperty($k)&&($h.diyTarget[$k]=$h[$k]);for($q in this._tweenDic)($p=this._tweenDic[$q]).clear(),delete this._tweenDic[$q];if(this._index=0,this._gidIndex=0,this._currTime=$m,this._lastTime=$w.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$P=this._tweenDataList.concat(),$P.sort(function($m,$p){return $m.endTime>$p.endTime?1:$m.endTime<$p.endTime?-1:0;});}else $P=this._endTweenDataList;for(var $Y=0,$d=$P.length;$Y<$d;$Y++)if(0==($L=$P[$Y]).type){if(!($m>=$L.endTime))break;this._index=Math.max(this._index,$Y+1);var $K=$L.data;if($L.isTo)for(var $D in $K)$L.target[$D]=$K[$D];}for($Y=0,$d=this._tweenDataList.length;$Y<$d;$Y++)0==($L=this._tweenDataList[$Y]).type&&$m>=$L.startTime&&$m<$L.endTime&&(this._index=Math.max(this._index,$Y+1),this._gidIndex++,($p=$o.getItemByClass("tween",$v))._create($L.target,$L.data,$L.duration,$L.ease,$e.create(this,this._animComplete,[this._gidIndex]),0,!1,$L.isTo,!0,!1),$p.setStartTime(this._currTime-($m-$L.startTime)),$p._updateEase(this._currTime),$p.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$p);}},$p.gotoLabel=function($m){if(null!=this._labelDic){var $p=this._labelDic[$m];$p&&this.gotoTime($p.startTime);}},$p.pause=function(){$E.timer.clear(this,this._update);},$p.resume=function(){this.play(this._currTime,this._loopKey);},$p.play=function($m,$p){if(void 0===$m&&($m=0),void 0===$p&&($p=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($m,$p){return $m.startTime>$p.startTime?1:$m.startTime<$p.startTime?-1:0;});for(var $h=0,$P=this._tweenDataList.length;$h<$P;$h++){var $L=this._tweenDataList[$h];if(null!=$L&&0==$L.type){var $q=$L.target,$k=$q.$_GID||($q.$_GID=$g.getGID()),$Y=null;for(var $d in null==this._firstTweenDic[$k]?(($Y={}).diyTarget=$q,this._firstTweenDic[$k]=$Y):$Y=this._firstTweenDic[$k],$L.data)null==$Y[$d]&&($Y[$d]=$q[$d]);}}}"string"==typeof $m?this.gotoLabel($m):this.gotoTime($m),this._loopKey=$p,this._lastTime=$w.now(),$E.timer.frameLoop(1,this,this._update);}},$p._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $m in this._tweenDic)($p=this._tweenDic[$m]).complete();return this._complete(),void this.pause();}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0);}var $p,$h=$w.now(),$P=$h-this._lastTime,$L=this._currTime+=$P*this.scale;for($m in this._lastTime=$h,this._tweenDic)($p=this._tweenDic[$m])._updateEase($L);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $q=this._tweenDataList[this._index];$L>=$q.startTime&&(this._index++,0==$q.type?(this._gidIndex++,($p=$o.getItemByClass("tween",$v))._create($q.target,$q.data,$q.duration,$q.ease,$e.create(this,this._animComplete,[this._gidIndex]),0,!1,$q.isTo,!0,!1),$p.setStartTime($L),$p.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$p)._updateEase($L)):this.event("label",$q.data));}},$p._animComplete=function($m){this._tweenDic[$m]&&delete this._tweenDic[$m];},$p._complete=function(){this.event("complete");},$p.reset=function(){var $m;if(this._labelDic)for($m in this._labelDic)delete this._labelDic[$m];for($m in this._tweenDic)this._tweenDic[$m].clear(),delete this._tweenDic[$m];for($m in this._firstTweenDic)delete this._firstTweenDic[$m];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $p,$h=0;for($p=this._tweenDataList.length,$h=0;$h<$p;$h++)this._tweenDataList[$h]&&this._tweenDataList[$h].destroy();}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$E.timer.clear(this,this._update);},$p.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null;},$D(0,$p,"index",function(){return this._frameIndex;},function($m){this._frameIndex=$m,this.gotoTime(this._frameIndex/this._frameRate*1e3);}),$D(0,$p,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total;}),$q.to=function($m,$p,$h,$P,$L){return void 0===$L&&($L=0),new $q().to($m,$p,$h,$P,$L);},$q.from=function($m,$p,$h,$P,$L){return void 0===$L&&($L=0),new $q().from($m,$p,$h,$P,$L);},$q.__init$=function(){$Y=function(){function $m(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null;}return $B($m,""),$m.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$o.recover("tweenData",this);},$m;}();},$q;}(),$Fm=function($L){function $h(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$h.__super.call(this),this._style=$Y.EMPTY;}$B($h,"laya.display.Sprite",$L);var $m=$h.prototype;return $E.imps($m,{"laya.display.ILayout":!0}),$m.createConchModel=function(){return new ConchNode();},$m.destroy=function($m){if(void 0===$m&&($m=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $p=this.mask;$p&&(this.mask=null,$p.destroy($m));}$L.prototype.destroy.call(this,$m),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null;},$m.updateZOrder=function(){$g.updateOrder(this._childs)&&this.repaint();},$m.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1;},$m.setBounds=function($m){this._set$P("uBounds",$m);},$m.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $b()),$b._getWrapRec(this._boundPointsToParent(),this._$P.mBounds);},$m.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $b()),$b._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds));},$m._boundPointsToParent=function($m){void 0===$m&&($m=!1);var $p=0,$h=0;this._style&&($p=this._style._tf.translateX,$h=this._style._tf.translateY,$m=$m||0!==this._style._tf.rotate,this._style.scrollRect&&($p+=this._style.scrollRect.x,$h+=this._style.scrollRect.y));var $P=this._getBoundPointsM($m);if(!$P||$P.length<1)return $P;if(8!=$P.length&&($P=$m?$H.scanPList($P):$b._getWrapRec($P,$b.TEMP)._getBoundPoints()),!this.transform)return $g.transPointList($P,this._x-$p,this._y-$h),$P;var $L=$I.TEMP,$q=0,$k=$P.length;for($q=0;$q<$k;$q+=2)$L.x=$P[$q],$L.y=$P[$q+1],this.toParentPoint($L),$P[$q]=$L.x,$P[$q+1]=$L.y;return $P;},$m.getGraphicBounds=function($m){return void 0===$m&&($m=!1),this._graphics?this._graphics.getBounds($m):$b.TEMP.setTo(0,0,0,0);},$m._getBoundPointsM=function($m){if(void 0===$m&&($m=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $p=$g.clearArray(this._$P.temBM),$h=$b.TEMP;return $h.copyFrom(this.scrollRect),$g.concatArray($p,$h._getBoundPoints()),$p;}for(var $P,$L,$q,$k=this._graphics?this._graphics.getBoundPoints():$g.clearArray(this._$P.temBM),$Y=0,$d=($q=this._childs).length;$Y<$d;$Y++)($P=$q[$Y])instanceof laya.display.Sprite&&1==$P.visible&&($L=$P._boundPointsToParent($m))&&($k=$k?$g.concatArray($k,$L):$L);return $k;},$m.getStyle=function(){return this._style===$Y.EMPTY&&(this._style=new $Y()),this._style;},$m.setStyle=function($m){this._style=$m;},$m._adjustTransform=function(){this._tfChanged=!1;var $m,$p=this._style._tf,$h=$p.scaleX,$P=$p.scaleY;if($p.rotate||1!==$h||1!==$P||$p.skewX||$p.skewY){($m=this._transform||(this._transform=$M.create())).bTransform=!0;var $L=.0174532922222222*($p.rotate-$p.skewX),$q=.0174532922222222*($p.rotate+$p.skewY),$k=Math.cos($q),$Y=Math.sin($q),$d=Math.sin($L),$K=Math.cos($L);return $m.a=$h*$k,$m.b=$h*$Y,$m.c=-$P*$d,$m.d=$P*$K,$m.tx=$m.ty=0,$m;}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$m;},$m.pos=function($m,$p,$h){if(void 0===$h&&($h=!1),this._x!==$m||this._y!==$p){if(this.destroyed)return this;if($h){this._x=$m,this._y=$p,this.conchModel&&this.conchModel.pos(this._x,this._y);var $P=this._parent;$P&&0===$P._repaint&&($P._repaint=1,$P.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint());}else this.x=$m,this.y=$p;}return this;},$m.pivot=function($m,$p){return this.pivotX=$m,this.pivotY=$p,this;},$m.size=function($m,$p){return this.width=$m,this.height=$p,this;},$m.scale=function($m,$p,$h){void 0===$h&&($h=!1);var $P=this.getStyle(),$L=$P._tf;if($L.scaleX!=$m||$L.scaleY!=$p){if(this.destroyed)return this;if($h){$P.setScale($m,$p),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($m,$p),this._renderType|=4;var $q=this._parent;$q&&0===$q._repaint&&($q._repaint=1,$q.parentRepaint());}else this.scaleX=$m,this.scaleY=$p;}return this;},$m.skew=function($m,$p){return this.skewX=$m,this.skewY=$p,this;},$m.render=function($m,$p,$h){$f.spriteCount++,$l.renders[this._renderType]._fun(this,$m,$p+this._x,$h+this._y),this._repaint=0;},$m.drawToCanvas=function($m,$p,$h,$P){if($S.isConchNode){var $L=$am.create("2D");return new $_($m,$p,$L).ctx.setCanvasType(1),this.conchModel.drawToCanvas($L.source,$h,$P),$L;}return $Q.drawToCanvas(this,this._renderType,$m,$p,$h,$P);},$m.customRender=function($m,$p,$h){this._renderType|=1024;},$m._applyFilters=function(){var $m;if(!$S.isWebGL&&($m=this._$P.filters)&&!($m.length<1))for(var $p=0,$h=$m.length;$p<$h;$p++)$m[$p].action.apply(this._$P.cacheCanvas);},$m._isHaveGlowFilter=function(){var $m,$p=0;if(this.filters)for($p=0;$p<this.filters.length;$p++)if(8==this.filters[$p].type)return!0;for($p=0,$m=this._childs.length;$p<$m;$p++)if(this._childs[$p]._isHaveGlowFilter())return!0;return!1;},$m.localToGlobal=function($m,$p){void 0===$p&&($p=!1),!0===$p&&($m=new $I($m.x,$m.y));for(var $h=this;$h&&$h!=$E.stage;)$m=$h.toParentPoint($m),$h=$h.parent;return $m;},$m.globalToLocal=function($m,$p){void 0===$p&&($p=!1),$p&&($m=new $I($m.x,$m.y));for(var $h=this,$P=[];$h&&$h!=$E.stage;)$P.push($h),$h=$h.parent;for(var $L=$P.length-1;0<=$L;)$m=($h=$P[$L]).fromParentPoint($m),$L--;return $m;},$m.toParentPoint=function($m){if(!$m)return $m;$m.x-=this.pivotX,$m.y-=this.pivotY,this.transform&&this._transform.transformPoint($m),$m.x+=this._x,$m.y+=this._y;var $p=this._style.scrollRect;return $p&&($m.x-=$p.x,$m.y-=$p.y),$m;},$m.fromParentPoint=function($m){if(!$m)return $m;$m.x-=this._x,$m.y-=this._y;var $p=this._style.scrollRect;return $p&&($m.x+=$p.x,$m.y+=$p.y),this.transform&&this._transform.invertTransformPoint($m),$m.x+=this.pivotX,$m.y+=this.pivotY,$m;},$m.on=function($m,$p,$h,$P){return 1!==this._mouseEnableState&&this.isMouseEvent($m)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($m,$p,$h,$P,!1)):$L.prototype.on.call(this,$m,$p,$h,$P);},$m.once=function($m,$p,$h,$P){return 1!==this._mouseEnableState&&this.isMouseEvent($m)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($m,$p,$h,$P,!0)):$L.prototype.once.call(this,$m,$p,$h,$P);},$m._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $m=this;for($m=$m.parent;$m&&1!==$m._mouseEnableState&&!$m._getBit(2);)$m.mouseEnabled=!0,$m._setBit(2,!0),$m=$m.parent;}},$m.loadImage=function($m,$p,$h,$P,$L,$q){var $k=this;return void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0),void 0===$L&&($L=0),this.graphics.loadImage($m,$p,$h,$P,$L,function($m){$k.destroyed||($k.size($p+($P||$m.width),$h+($L||$m.height)),$k.repaint(),$q&&$q.runWith($m));}),this;},$m.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint();},$m._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache;},$m._childChanged=function($m){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$m&&this._get$P("hasZorder")&&$E.timer.callLater(this,this.updateZOrder),this.repaint();},$m.parentRepaint=function(){var $m=this._parent;$m&&0===$m._repaint&&($m._repaint=1,$m.parentRepaint());},$m.startDrag=function($m,$p,$h,$P,$L,$q,$k){void 0===$p&&($p=!1),void 0===$h&&($h=0),void 0===$P&&($P=300),void 0===$q&&($q=!1),void 0===$k&&($k=.92),this._$P.dragging||this._set$P("dragging",new $r()),this._$P.dragging.start(this,$m,$p,$h,$P,$L,$q,$k);},$m.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop();},$m._releaseMem=function(){if(this._$P){var $m=this._$P.cacheCanvas;$m&&$m.ctx&&($o.recover("RenderContext",$m.ctx),$m.ctx.canvas.size(0,0),$m.ctx=null);var $p=this._$P._filterCache;$p&&($p.destroy(),$p.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null;}},$m._setDisplay=function($m){$m||this._releaseMem(),$L.prototype._setDisplay.call(this,$m);},$m.hitTestPoint=function($m,$p){var $h=this.globalToLocal($I.TEMP.setTo($m,$p));return $m=$h.x,$p=$h.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$b.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($m,$p);},$m.getMousePoint=function(){return this.globalToLocal($I.TEMP.setTo($E.stage.mouseX,$E.stage.mouseY));},$m._getWords=function(){return null;},$m._addChildsToLayout=function($m){var $p=this._getWords();if(null==$p&&0==this._childs.length)return!1;if($p)for(var $h=0,$P=$p.length;$h<$P;$h++)$m.push($p[$h]);$h=0;for(var $L=this._childs.length;$h<$L;++$h){var $q=this._childs[$h];$q._style._enableLayout()&&$q._addToLayout($m);}return!0;},$m._addToLayout=function($m){this._style.absolute||(this._style.block?$m.push(this):this._addChildsToLayout($m)&&(this.x=this.y=0));},$m._isChar=function(){return!1;},$m._getCSSStyle=function(){return this._style.getCSSStyle();},$m._setAttributes=function($m,$p){switch($m){case"x":this.x=parseFloat($p);break;case"y":this.y=parseFloat($p);break;case"width":this.width=parseFloat($p);break;case"height":this.height=parseFloat($p);break;default:this[$m]=$p;}},$m._layoutLater=function(){this.parent&&this.parent._layoutLater();},$D(0,$m,"optimizeScrollRect",function(){return this._optimizeScrollRect;},function($m){this._optimizeScrollRect!=$m&&(this._optimizeScrollRect=$m,this.conchModel&&this.conchModel.optimizeScrollRect($m));}),$D(0,$m,"customRenderEnable",null,function($m){if($m&&(this._renderType|=1024,$S.isConchNode)){$h.CustomList.push(this);var $p=new $am("2d");$p._setContext(new CanvasRenderingContext2D()),this.customContext=new $_(0,0,$p),$p.context.setCanvasType&&$p.context.setCanvasType(2),this.conchModel.custom($p.context);}}),$D(0,$m,"cacheAsBitmap",function(){return"none"!==this.cacheAs;},function($m){this.cacheAs=$m?this._$P.hasFilter?"none":"normal":"none";}),$D(0,$m,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type;},function($m){var $p=this._$P.cacheCanvas;if($m!==($p?$p.type:"none")){if("none"!==$m)this._getBit(1)||this._setUpNoticeType(1),$p||($p=this._set$P("cacheCanvas",$o.getItemByClass("cacheCanvas",Object))),$p.type=$m,$p.reCache=!0,this._renderType|=16,"bitmap"==$m&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($p){var $h=$p;$h&&$h.ctx&&($o.recover("RenderContext",$h.ctx),$h.ctx.canvas.size(0,0),$h.ctx=null),$o.recover("cacheCanvas",$p);}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0);}this.repaint();}}),$D(0,$m,"zOrder",function(){return this._zOrder;},function($m){this._zOrder!=$m&&(this._zOrder=$m,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($m),this._parent&&($m&&this._parent._set$P("hasZorder",!0),$E.timer.callLater(this._parent,this.updateZOrder)));}),$D(0,$m,"rotation",function(){return this._style._tf.rotate;},function($m){var $p=this.getStyle();if($p._tf.rotate!==$m){$p.setRotate($m),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($m),this._renderType|=4;var $h=this._parent;$h&&0===$h._repaint&&($h._repaint=1,$h.parentRepaint());}}),$D(0,$m,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width;},function($m){this._width!==$m&&(this._width=$m,this.conchModel&&this.conchModel.size($m,this._height),this.repaint());}),$D(0,$m,"x",function(){return this._x;},function($m){if(this._x!==$m){if(this.destroyed)return;this._x=$m,this.conchModel&&this.conchModel.pos($m,this._y);var $p=this._parent;$p&&0===$p._repaint&&($p._repaint=1,$p.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint());}}),$D(0,$m,"globalScaleY",function(){for(var $m=1,$p=this;$p&&$p!==$E.stage;)$m*=$p.scaleY,$p=$p.parent;return $m;}),$D(0,$m,"hitArea",function(){return this._$P.hitArea;},function($m){this._set$P("hitArea",$m);}),$D(0,$m,"staticCache",function(){return this._$P.staticCache;},function($m){this._set$P("staticCache",$m),$m||this.reCache();}),$D(0,$m,"texture",function(){return this._texture;},function($m){this._texture!=$m&&(this._texture=$m,this.graphics.cleanByTexture($m,0,0));}),$D(0,$m,"y",function(){return this._y;},function($m){if(this._y!==$m){if(this.destroyed)return;this._y=$m,this.conchModel&&this.conchModel.pos(this._x,$m);var $p=this._parent;$p&&0===$p._repaint&&($p._repaint=1,$p.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint());}}),$D(0,$m,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height;},function($m){this._height!==$m&&(this._height=$m,this.conchModel&&this.conchModel.size(this._width,$m),this.repaint());}),$D(0,$m,"blendMode",function(){return this._style.blendMode;},function($m){this.getStyle().blendMode=$m,this.conchModel&&this.conchModel.blendMode($m),$m&&"source-over"!=$m?this._renderType|=8:this._renderType&=-9,this.parentRepaint();}),$D(0,$m,"scaleX",function(){return this._style._tf.scaleX;},function($m){var $p=this.getStyle();if($p._tf.scaleX!==$m){$p.setScaleX($m),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($m,$p._tf.scaleY),this._renderType|=4;var $h=this._parent;$h&&0===$h._repaint&&($h._repaint=1,$h.parentRepaint());}}),$D(0,$m,"scaleY",function(){return this._style._tf.scaleY;},function($m){var $p=this.getStyle();if($p._tf.scaleY!==$m){$p.setScaleY($m),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($p._tf.scaleX,$m),this._renderType|=4;var $h=this._parent;$h&&0===$h._repaint&&($h._repaint=1,$h.parentRepaint());}}),$D(0,$m,"stage",function(){return $E.stage;}),$D(0,$m,"skewX",function(){return this._style._tf.skewX;},function($m){var $p=this.getStyle();if($p._tf.skewX!==$m){$p.setSkewX($m),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($m,$p._tf.skewY),this._renderType|=4;var $h=this._parent;$h&&0===$h._repaint&&($h._repaint=1,$h.parentRepaint());}}),$D(0,$m,"scrollRect",function(){return this._style.scrollRect;},function($m){this.getStyle().scrollRect=$m,this.repaint(),$m?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($m.x,$m.y,$m.width,$m.height)):(this._renderType&=-129,this.conchModel&&($h.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)));}),$D(0,$m,"skewY",function(){return this._style._tf.skewY;},function($m){var $p=this.getStyle();if($p._tf.skewY!==$m){$p.setSkewY($m),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($p._tf.skewX,$m),this._renderType|=4;var $h=this._parent;$h&&0===$h._repaint&&($h._repaint=1,$h.parentRepaint());}}),$D(0,$m,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform;},function($m){this._tfChanged=!1,(this._transform=$m)&&(this._x=$m.tx,this._y=$m.ty,$m.tx=$m.ty=0,this.conchModel&&this.conchModel.transform($m.a,$m.b,$m.c,$m.d,this._x,this._y)),$m?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint();}),$D(0,$m,"pivotX",function(){return this._style._tf.translateX;},function($m){this.getStyle().setTranslateX($m),this.conchModel&&this.conchModel.pivot($m,this._style._tf.translateY),this.repaint();}),$D(0,$m,"pivotY",function(){return this._style._tf.translateY;},function($m){this.getStyle().setTranslateY($m),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$m),this.repaint();}),$D(0,$m,"alpha",function(){return this._style.alpha;},function($m){this._style&&this._style.alpha!==$m&&($m=$m<0?0:1<$m?1:$m,this.getStyle().alpha=$m,this.conchModel&&this.conchModel.alpha($m),1!==$m?this._renderType|=2:this._renderType&=-3,this.parentRepaint());}),$D(0,$m,"visible",function(){return this._style.visible;},function($m){this._style&&this._style.visible!==$m&&(this.getStyle().visible=$m,this.conchModel&&this.conchModel.visible($m),this.parentRepaint());}),$D(0,$m,"graphics",function(){return this._graphics||(this.graphics=$Q.createGraphics());},function($m){this._graphics&&(this._graphics._sp=null),(this._graphics=$m)?(this._renderType&=-2,this._renderType|=512,($m._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($h.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint();}),$D(0,$m,"filters",function(){return this._$P.filters;},function($m){$m&&0===$m.length&&($m=null),this._$P.filters!=$m&&(this._set$P("filters",$m?$m.slice():null),$S.isConchApp&&(this.conchModel&&($h.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$S.isWebGL&&($m&&$m.length?this._renderType|=32:this._renderType&=-33),$m&&0<$m.length?(this._getBit(1)||this._setUpNoticeType(1),$S.isWebGL&&1==$m.length&&$m[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($S.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint());}),$D(0,$m,"parent",$L.prototype._$get_parent,function($m){$E.superSet($mm,this,"parent",$m),$m&&this._getBit(2)&&this._$2__onDisplay();}),$D(0,$m,"mask",function(){return this._$P._mask;},function($m){$m&&this.mask&&this.mask._$P.maskParent||($m?(this.cacheAs="bitmap",this._set$P("_mask",$m),$m._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$m),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($m?$m.conchModel:null),this._renderType|=64,this.parentRepaint());}),$D(0,$m,"mouseEnabled",function(){return 1<this._mouseEnableState;},function($m){this._mouseEnableState=$m?2:1;}),$D(0,$m,"globalScaleX",function(){for(var $m=1,$p=this;$p&&$p!==$E.stage;)$m*=$p.scaleX,$p=$p.parent;return $m;}),$D(0,$m,"mouseX",function(){return this.getMousePoint().x;}),$D(0,$m,"mouseY",function(){return this.getMousePoint().y;}),$h.fromImage=function($m){return new $h().loadImage($m);},$h._cachePool=[],$h.CustomList=[],$d($h,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$k.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):"";}]),$h;}($mm),$Rm=function($m){function $p($m){this._audio=null,this._onEnd=null,this._resumePlay=null,$p.__super.call(this),this._onEnd=$g.bind(this.__onEnd,this),this._resumePlay=$g.bind(this.__resumePlay,this),$m.addEventListener("ended",this._onEnd),this._audio=$m;}$B($p,"laya.media.h5audio.AudioSoundChannel",$Pm);var $h=$p.prototype;return $h.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($E.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0);},$h.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$w.container.appendChild(this._audio),this._audio.play();}catch($m){this.event("error");}},$h.play=function($m){this.isStopped=!1;try{this._audio.playbackRate=$x.playbackRate,this._audio.currentTime=this.startTime;}catch($m){return void this._audio.addEventListener("canplay",this._resumePlay);}$x.addChannel(this),$w.container.appendChild(this._audio),!$m&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play();},$h.stop=function(){this.isStopped=!0,$x.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$S.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$w.onIE||this._audio!=$hm._musicAudio&&$o.recover("audio:"+this.url,this._audio),$w.removeElement(this._audio),this._audio=null);},$h.pause=function(){this.isStopped=!0,$x.removeChannel(this),"pause"in this._audio&&this._audio.pause();},$h.resume=function(){this._audio&&(this.isStopped=!1,$x.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play());},$D(0,$h,"position",function(){return this._audio?this._audio.currentTime:0;}),$D(0,$h,"duration",function(){return this._audio?this._audio.duration:0;}),$D(0,$h,"volume",function(){return this._audio?this._audio.volume:1;},function($m){this._audio&&(this._audio.volume=$m);}),$p;}(),$$m=function($m){function $p(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$qm.ctx,$p.__super.call(this),this._onPlayEnd=$g.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode();}$B($p,"laya.media.webaudio.WebAudioSoundChannel",$Pm);var $h=$p.prototype;return $h.play=function($m){if($x.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $p=this.context,$h=this.gain,$P=$p.createBufferSource();(this.bufferSource=$P).buffer=this.audioBuffer,$P.connect($h),$h&&$h.disconnect(),$h.connect($p.destination),$P.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$w.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($P.loop=!0),$P.playbackRate.setTargetAtTime?$P.playbackRate.setTargetAtTime($x.playbackRate,this.context.currentTime,.1):$P.playbackRate.value=$x.playbackRate,$P.start(0,this.startTime),!$m&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0;}},$h.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($E.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0);},$h._clearBufferSource=function(){if(this.bufferSource){var $m=this.bufferSource;$m.stop?$m.stop(0):$m.noteOff(0),$m.disconnect(0),$m.onended=null,$p._tryCleanFailed||this._tryClearBuffer($m),this.bufferSource=null;}},$h._tryClearBuffer=function($m){try{$m.buffer=null;}catch($m){$p._tryCleanFailed=!0;}},$h.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$x.removeChannel(this),this.startHandler=null,this.completeHandler=null;},$h.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$x.removeChannel(this);},$h.resume=function(){this.startTime=this._pauseTime,this.play(!1);},$D(0,$h,"position",function(){return this.bufferSource?($w.now()-this._startTime)/1e3+this.startTime:0;}),$D(0,$h,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0;}),$D(0,$h,"volume",function(){return this._volume;},function($m){this.isStopped||(this._volume=$m,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($m,this.context.currentTime,.1):this.gain.gain.value=$m);}),$p._tryCleanFailed=!1,$p;}(),$Am=function($m){function $p(){$p.__super.call(this),this._w=0,this._h=0;}$B($p,"laya.resource.Bitmap",$Km);var $h=$p.prototype;return $D(0,$h,"width",function(){return this._w;}),$D(0,$h,"height",function(){return this._h;}),$D(0,$h,"source",function(){return this._source;}),$p;}(),$Bm=function($p){function $m(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$m.__super.call(this),this._interval=$P.animationInterval,this._setUpNoticeType(1);}$B($m,"laya.display.AnimationPlayerBase",$p);var $h=$m.prototype;return $h.play=function($m,$p,$h,$P){void 0===$m&&($m=0),void 0===$p&&($p=!0),void 0===$h&&($h=""),void 0===$P&&($P=!0),this._isPlaying=!0,this.index="string"==typeof $m?this._getFrameByLabel($m):$m,this.loop=$p,this._actionName=$h,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0);},$h._getFrameByLabel=function($m){var $p=0;for($p=0;$p<this._count;$p++)if(this._labels[$p]&&0<=this._labels[$p].indexOf($m))return $p;return 0;},$h._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete");}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete");}this.index=this._index;},$h._setControlNode=function($m){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$m)&&$m!=this&&($m.on("display",this,this._checkResumePlaying),$m.on("undisplay",this,this._checkResumePlaying));},$h._setDisplay=function($m){$p.prototype._setDisplay.call(this,$m),this._checkResumePlaying();},$h._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop));},$h.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop);},$h.addLabel=function($m,$p){this._labels||(this._labels={}),this._labels[$p]||(this._labels[$p]=[]),this._labels[$p].push($m);},$h.removeLabel=function($m){if($m){if(this._labels)for(var $p in this._labels)this._removeLabelFromLabelList(this._labels[$p],$m);}else this._labels=null;},$h._removeLabelFromLabelList=function($m,$p){if($m)for(var $h=$m.length-1;0<=$h;$h--)$m[$h]==$p&&$m.splice($h,1);},$h.gotoAndStop=function($m){this.index="string"==typeof $m?this._getFrameByLabel($m):$m,this.stop();},$h._displayToIndex=function($m){},$h.clear=function(){this.stop(),this._labels=null;},$D(0,$h,"interval",function(){return this._interval;},function($m){this._interval!=$m&&(this._frameRateChanged=!0,this._interval=$m,this._isPlaying&&0<$m&&this.timerLoop($m,this,this._frameLoop,null,!0,!0));}),$D(0,$h,"isPlaying",function(){return this._isPlaying;}),$D(0,$h,"index",function(){return this._index;},function($m){if(this._index=$m,this._displayToIndex($m),this._labels&&this._labels[$m])for(var $p=this._labels[$m],$h=0,$P=$p.length;$h<$P;$h++)this.event("label",$p[$h]);}),$D(0,$h,"count",function(){return this._count;}),$m.WRAP_POSITIVE=0,$m.WRAP_REVERSE=1,$m.WRAP_PINGPONG=2,$m;}($Fm),$nm=function($p){function $$(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$$.__super.call(this),this.overflow=$$.VISIBLE,this._style=new $pm(this),this._style.wordWrap=!1;}$B($$,"laya.display.Text",$p);var $m=$$.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._lines=null,this._words&&(this._words.length=0,this._words=null);},$m._getBoundPointsM=function($m){void 0===$m&&($m=!1);var $p=$b.TEMP;return $p.setTo(0,0,this.width,this.height),$p._getBoundPoints();},$m.getGraphicBounds=function($m){void 0===$m&&($m=!1);var $p=$b.TEMP;return $p.setTo(0,0,this.width,this.height),$p;},$m._getCSSStyle=function(){return this._style;},$m.lang=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D){if($m=$$.langPacks&&$$.langPacks[$m]?$$.langPacks[$m]:$m,arguments.length<2)this._text=$m;else{for(var $F=0,$R=arguments.length;$F<$R;$F++)$m=$m.replace("{"+$F+"}",arguments[$F+1]);this._text=$m;}},$m._isPassWordMode=function(){var $m=this._style.password;return"prompt"in this&&this.prompt==this._text&&($m=!1),$m;},$m._getPassWordTxt=function($m){var $p;$p="";for(var $h=$m.length;0<$h;$h--)$p+="●";return $p;},$m.renderText=function($m,$p){var $h=this.graphics;$h.clear(!0);var $P=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($w.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$w.context.font=$P;var $L=this.padding,$q=$L[3],$k="left",$Y=this._lines,$d=this.leading+this._charSize.height,$K=this._currBitmapFont;$K&&($d=this.leading+$K.getMaxHeight());var $D=$L[0];if(!$K&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($k="right",$q=this._width-$L[1]):"center"==this.align&&($k="center",$q=.5*this._width+$L[3]-$L[1])),0<this._height){var $F=this._textHeight>this._height?"top":this.valign;"middle"===$F?$D=.5*(this._height-$p*$d)+$L[0]-$L[2]:"bottom"===$F&&($D=this._height-$p*$d-$L[2]);}var $R=this._style;if($K&&$K.autoScaleSize)var $$=$K.fontSize/this.fontSize;if(this._clipPoint)if($h.save(),$K&&$K.autoScaleSize){var $A=0,$B=0;$A=this._width?this._width-$L[3]-$L[1]:this._textWidth,$B=this._height?this._height-$L[0]-$L[2]:this._textHeight,$A*=$$,$B*=$$,$h.clipRect($L[3],$L[0],$A,$B);}else $h.clipRect($L[3],$L[0],this._width?this._width-$L[3]-$L[1]:this._textWidth,this._height?this._height-$L[0]-$L[2]:this._textHeight);var $n=$R.password;"prompt"in this&&this.prompt==this._text&&($n=!1);for(var $c=0,$e=0,$a=Math.min(this._lines.length,$p+$m)||1,$Z=$m;$Z<$a;$Z++){var $H,$W=$Y[$Z];if($n){var $E=$W.length;$W="";for(var $I=$E;0<$I;$I--)$W+="●";}if($c=$q-(this._clipPoint?this._clipPoint.x:0),$e=$D+$d*$Z-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($k,$c,$e,$Z),$K){var $b=this.width;$K.autoScaleSize&&($b=this.width*$$),$K.drawText($W,this,$c,$e,this.align,$b);}else $S.isWebGL?(this._words||(this._words=[]),($H=this._words.length>$Z-$m?this._words[$Z-$m]:new $C()).setText($W)):$H=$W,$R.stroke?$h.fillBorderText($H,$c,$e,$P,this.color,$R.strokeColor,$R.stroke,$k):$h.fillText($H,$c,$e,$P,this.color,$k);}if($K&&$K.autoScaleSize){var $T=1/$$;this.scale($T,$T);}this._clipPoint&&$h.restore(),this._startX=$q,this._startY=$D;},$m.drawUnderline=function($m,$p,$h,$P){var $L=this._lineWidths[$P];switch($m){case"center":$p-=$L/2;break;case"right":$p-=$L;}$h+=this._charSize.height,this._graphics.drawLine($p,$h,$p+$L,$h,this.underlineColor||this.color,1);},$m.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$w.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $I(0,0)):this._clipPoint=null;var $m=this._lines.length;if(this.overflow!=$$.VISIBLE){var $p=this.overflow==$$.HIDDEN?Math.floor:Math.ceil;$m=Math.min($m,$p((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)));}var $h=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($h,$m),this.repaint();},$m.evalTextSize=function(){var $m,$p=NaN;$m=Math.max.apply(this,this._lineWidths),$p=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$m==this._textWidth&&$p==this._textHeight||(this._textWidth=$m,this._textHeight=$p,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight));},$m.checkEnabledViewportOrNot=function(){return this.overflow==$$.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height);},$m.changeText=function($m){this._text!==$m&&(this.lang($m+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset());},$m.parseLines=function($m){var $p=this.wordWrap||this.overflow==$$.HIDDEN;if($p)var $h=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $P=$g.contextMeasureText($$._testWord);$S.isConchApp&&0===$P.width&&0===$P.height&&($P=$g.contextMeasureText("W")),this._charSize.width=$P.width,this._charSize.height=$P.height||this.fontSize;}for(var $L=$m.replace(/\r\n/g,"\n").split("\n"),$q=0,$k=$L.length;$q<$k;$q++){var $Y=$L[$q];$p?this.parseLine($Y,$h):(this._lineWidths.push(this.getTextWidth($Y)),this._lines.push($Y));}},$m.parseLine=function($m,$p){$w.context;var $h,$P=this._lines,$L=0,$q=NaN,$k=NaN,$Y=0;if(($q=this.getTextWidth($m))<=$p)return $P.push($m),void this._lineWidths.push($q);$q=this._charSize.width,0==($L=Math.floor($p/$q))&&($L=1),$k=$q=this.getTextWidth($m.substring(0,$L));for(var $d=$L,$K=$m.length;$d<$K;$d++)if($p<($k+=$q=this.getTextWidth($m.charAt($d))))if(this.wordWrap){var $D=$m.substring($Y,$d);if($D.charCodeAt($D.length-1)<255?($h=/(?:\w|-)+$/.exec($D))&&($d=$h.index+$Y,0==$h.index?$d+=$D.length:$D=$m.substring($Y,$d)):$$.RightToLeft&&($h=/([\u0600-\u06FF])+$/.exec($D))&&($d=$h.index+$Y,0==$h.index?$d+=$D.length:$D=$m.substring($Y,$d)),$P.push($D),this._lineWidths.push($k-$q),!(($Y=$d)+$L<$K)){$P.push($m.substring($Y,$K)),this._lineWidths.push(this.getTextWidth($P[$P.length-1])),$Y=-1;break;}$d+=$L,$k=$q=this.getTextWidth($m.substring($Y,$d)),$d--;}else if(this.overflow==$$.HIDDEN)return $P.push($m.substring(0,$d)),void this._lineWidths.push(this.getTextWidth($P[$P.length-1]));this.wordWrap&&-1!=$Y&&($P.push($m.substring($Y,$K)),this._lineWidths.push(this.getTextWidth($P[$P.length-1])));},$m.getTextWidth=function($m){return this._currBitmapFont?this._currBitmapFont.getTextWidth($m):$g.contextMeasureText($m).width;},$m.getWordWrapWidth=function(){var $m=this.padding,$p=NaN;return($p=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($p=this.wordWrap?100:$w.width),$p<=0&&($p=100),$p-$m[3]-$m[1];},$m.getCharPoint=function($m,$p){this._isChanged&&$E.timer.runCallLater(this,this.typeset);for(var $h=0,$P=this._lines,$L=0,$q=0,$k=$P.length;$q<$k;$q++){if($m<($h+=$P[$q].length)){var $Y=$q;break;}$L=$h;}var $d=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$w.context.font=$d;var $K=this.getTextWidth(this._text.substring($L,$m));return($p||new $I()).setTo(this._startX+$K-(this._clipPoint?this._clipPoint.x:0),this._startY+$Y*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0));},$D(0,$m,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3];},function($m){$m!=this._width&&($E.superSet($Fm,this,"width",$m),this.isChanged=!0);}),$D(0,$m,"textWidth",function(){return this._isChanged&&$E.timer.runCallLater(this,this.typeset),this._textWidth;}),$D(0,$m,"height",function(){return this._height?this._height:this.textHeight;},function($m){$m!=this._height&&($E.superSet($Fm,this,"height",$m),this.isChanged=!0);}),$D(0,$m,"textHeight",function(){return this._isChanged&&$E.timer.runCallLater(this,this.typeset),this._textHeight;}),$D(0,$m,"padding",function(){return this._getCSSStyle().padding;},function($m){this._getCSSStyle().padding=$m,this.isChanged=!0;}),$D(0,$m,"bold",function(){return this._getCSSStyle().bold;},function($m){this._getCSSStyle().bold=$m,this.isChanged=!0;}),$D(0,$m,"text",function(){return this._text||"";},function($m){this._text!==$m&&(this.lang($m+""),this.isChanged=!0,this.event("change"));}),$D(0,$m,"color",function(){return this._getCSSStyle().color;},function($m){this._getCSSStyle().color!=$m&&(this._getCSSStyle().color=$m,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0);}),$D(0,$m,"font",function(){return this._getCSSStyle().fontFamily;},function($m){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$$._bitmapFonts&&$$._bitmapFonts[$m]&&(this._currBitmapFont=$$._bitmapFonts[$m]),this._getCSSStyle().fontFamily=$m,this.isChanged=!0;}),$D(0,$m,"fontSize",function(){return this._getCSSStyle().fontSize;},function($m){this._getCSSStyle().fontSize=$m,this.isChanged=!0;}),$D(0,$m,"italic",function(){return this._getCSSStyle().italic;},function($m){this._getCSSStyle().italic=$m,this.isChanged=!0;}),$D(0,$m,"align",function(){return this._getCSSStyle().align;},function($m){this._getCSSStyle().align=$m,this.isChanged=!0;}),$D(0,$m,"valign",function(){return this._getCSSStyle().valign;},function($m){this._getCSSStyle().valign=$m,this.isChanged=!0;}),$D(0,$m,"wordWrap",function(){return this._getCSSStyle().wordWrap;},function($m){this._getCSSStyle().wordWrap=$m,this.isChanged=!0;}),$D(0,$m,"leading",function(){return this._getCSSStyle().leading;},function($m){this._getCSSStyle().leading=$m,this.isChanged=!0;}),$D(0,$m,"bgColor",function(){return this._getCSSStyle().backgroundColor;},function($m){this._getCSSStyle().backgroundColor=$m,this.isChanged=!0;}),$D(0,$m,"borderColor",function(){return this._getCSSStyle().borderColor;},function($m){this._getCSSStyle().borderColor=$m,this.isChanged=!0;}),$D(0,$m,"stroke",function(){return this._getCSSStyle().stroke;},function($m){this._getCSSStyle().stroke=$m,this.isChanged=!0;}),$D(0,$m,"strokeColor",function(){return this._getCSSStyle().strokeColor;},function($m){this._getCSSStyle().strokeColor=$m,this.isChanged=!0;}),$D(0,$m,"isChanged",null,function($m){this._isChanged!==$m&&(this._isChanged=$m)&&$E.timer.callLater(this,this.typeset);}),$D(0,$m,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0;},function($m){if(!(this.overflow!=$$.SCROLL||this.textWidth<this._width)&&this._clipPoint){$m=$m<this.padding[3]?this.padding[3]:$m;var $p=this._textWidth-this._width;$m=$p<$m?$p:$m;var $h=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$m,this.renderText(this._lastVisibleLineIndex,$h);}}),$D(0,$m,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0;},function($m){if(!(this.overflow!=$$.SCROLL||this.textHeight<this._height)&&this._clipPoint){$m=$m<this.padding[0]?this.padding[0]:$m;var $p=this._textHeight-this._height,$h=($m=$p<$m?$p:$m)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$h;var $P=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$m,this.renderText($h,$P);}}),$D(0,$m,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width;}),$D(0,$m,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height;}),$D(0,$m,"lines",function(){return this._isChanged&&this.typeset(),this._lines;}),$D(0,$m,"underlineColor",function(){return this._underlineColor;},function($m){this._underlineColor=$m,this._isChanged=!0,this.typeset();}),$$.registerBitmapFont=function($m,$p){$$._bitmapFonts||($$._bitmapFonts={}),$$._bitmapFonts[$m]=$p;},$$.unregisterBitmapFont=function($m,$p){if(void 0===$p&&($p=!0),$$._bitmapFonts&&$$._bitmapFonts[$m]){var $h=$$._bitmapFonts[$m];$p&&$h.destroy(),delete $$._bitmapFonts[$m];}},$$.setTextRightToLeft=function(){var $m;($m=$w.canvas.source.style).display="none",$m.position="absolute",$m.direction="rtl",$S._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$w.document.body.appendChild($w.canvas.source);},$$.supportFont=function($m){$w.context.font="10px sans-serif";var $p=$g.contextMeasureText("abcji").width;$w.context.font="10px "+$m;var $h=$g.contextMeasureText("abcji").width;return console.log($p,$h),$p!==$h;},$$._testWord="游",$$.langPacks=null,$$.VISIBLE="visible",$$.SCROLL="scroll",$$.HIDDEN="hidden",$$.CharacterCache=!0,$$.RightToLeft=!1,$$._bitmapFonts=null,$d($$,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"};}]),$$;}($Fm),$cm=function($F){function $k(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$k.__super.call(this),this.offset=new $I(),this._canvasTransform=new $M(),this._previousOrientation=$w.window.orientation;var $p=this;this.transform=$M.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $m=$w.window,$h=this;$m.addEventListener("focus",function(){$p._isFocused=!0,$h.event("focus"),$h.event("focuschange");}),$m.addEventListener("blur",function(){$p._isFocused=!1,$h.event("blur"),$h.event("focuschange"),$h._isInputting()&&($Hm.inputElement.target.focus=!1);});var $P="visibilityState",$L="visibilitychange",$q=$m.document;void 0!==$q.hidden?($L="visibilitychange",$P="visibilityState"):void 0!==$q.mozHidden?($L="mozvisibilitychange",$P="mozVisibilityState"):void 0!==$q.msHidden?($L="msvisibilitychange",$P="msVisibilityState"):void 0!==$q.webkitHidden&&($L="webkitvisibilitychange",$P="webkitVisibilityState"),$m.document.addEventListener($L,function(){"hidden"==$w.document[$P]?$h._setStageVisible(!1):$h._setStageVisible(!0);}),$m.document.addEventListener("qbrowserVisibilityChange",function($m){$h._setStageVisible(!$m.hidden);}),$m.addEventListener("resize",function(){var $m=$w.window.orientation;null!=$m&&$m!=$p._previousOrientation&&$h._isInputting()&&($Hm.inputElement.target.focus=!1),$p._previousOrientation=$m,$h._isInputting()||$h._resetCanvas();}),$m.addEventListener("orientationchange",function($m){$h._resetCanvas();}),this.on("mousemove",this,this._onmouseMove),$w.onMobile&&this.on("mousedown",this,this._onmouseMove);}$B($k,"laya.display.Stage",$F);var $m=$k.prototype;return $m._setStageVisible=function($m){this._isVisibility!=$m&&(this._isVisibility=$m,this._isVisibility||this._isInputting()&&($Hm.inputElement.target.focus=!1),this.event("visibilitychange"));},$m._isInputting=function(){return $w.onMobile&&$Hm.isInputting;},$m._changeCanvasSize=function(){this.setScreenSize($w.clientWidth*$w.pixelRatio,$w.clientHeight*$w.pixelRatio);},$m._resetCanvas=function(){if(this.screenAdaptationEnabled){var $m=$S._mainCanvas;$m.source.style;$m.size(1,1),$E.timer.once(100,this,this._changeCanvasSize);}},$m.setScreenSize=function($m,$p){var $h=!1;if("none"!==this._screenMode&&($h=($m/$p<1?"vertical":"horizontal")!==this._screenMode)){var $P=$p;$p=$m,$m=$P;}this.canvasRotation=$h;var $L=$S._mainCanvas,$q=$L.source.style,$k=this._canvasTransform.identity(),$Y=this._scaleMode,$d=$m/this.designWidth,$K=$p/this.designHeight,$D=this.designWidth,$F=this.designHeight,$R=$m,$$=$p,$A=$w.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$Y){case"noscale":$d=$K=1,$R=this.designWidth,$$=this.designHeight;break;case"showall":$d=$K=Math.min($d,$K),$D=$R=Math.round(this.designWidth*$d),$F=$$=Math.round(this.designHeight*$K);break;case"noborder":$d=$K=Math.max($d,$K),$R=Math.round(this.designWidth*$d),$$=Math.round(this.designHeight*$K);break;case"full":$d=$K=1,this._width=$D=$m,this._height=$F=$p;break;case"fixedwidth":$K=$d,this._height=$F=Math.round($p/$d);break;case"fixedheight":$d=$K,this._width=$D=Math.round($m/$K);break;case"fixedauto":$m/$p<this.designWidth/this.designHeight?($K=$d,this._height=$F=Math.round($p/$d)):($d=$K,this._width=$D=Math.round($m/$K));}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$D=$D+1&2147483646,$F=$F+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$d*=this.scaleX,$K*=this.scaleY,1===$d&&1===$K?this.transform.identity():(this.transform.a=this._formatData($d/($R/$D)),this.transform.d=this._formatData($K/($$/$F)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$L.size($D,$F),$Q.changeWebGLSize($D,$F),$k.scale($R/$D/$A,$$/$F/$A),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($m-$R)/$A:this.offset.x=.5*($m-$R)/$A,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($p-$$)/$A:this.offset.y=.5*($p-$$)/$A,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$k.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$h&&("horizontal"===this._screenMode?($k.rotate(Math.PI/2),$k.translate($p/$A,0),this.canvasDegree=90):($k.rotate(-Math.PI/2),$k.translate(0,$m/$A),this.canvasDegree=-90)),$k.a=this._formatData($k.a),$k.d=this._formatData($k.d),$k.tx=this._formatData($k.tx),$k.ty=this._formatData($k.ty),$q.transformOrigin=$q.webkitTransformOrigin=$q.msTransformOrigin=$q.mozTransformOrigin=$q.oTransformOrigin="0px 0px 0px",$q.transform=$q.webkitTransform=$q.msTransform=$q.mozTransform=$q.oTransform="matrix("+$k.toString()+")",$k.translate(parseInt($q.left)||0,parseInt($q.top)||0),this.visible=!0,this._repaint=1,this.event("resize");},$m._formatData=function($m){return Math.abs($m)<1e-6?0:Math.abs(1-$m)<.001?0<$m?1:-1:$m;},$m.getMousePoint=function(){return $I.TEMP.setTo(this.mouseX,this.mouseY);},$m.repaint=function(){this._repaint=1;},$m.parentRepaint=function(){},$m._loop=function(){return this.render($S.context,0,0),!0;},$m._onmouseMove=function($m){this._mouseMoveTime=$w.now();},$m.getTimeFromFrameStart=function(){return $w.now()-this._frameStartTime;},$m.render=function($m,$p,$h){if("sleep"===this._frameRate&&!$S.isConchApp){var $P=$w.now();if(!(1e3<=$P-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($f.loopCount++,$A.instance.runEvent(),$E.timer._update()));this._frameStartTime=$P;}if(this._renderCount++,$S.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$w.now();var $L="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$q=this._renderCount%2==0;if($f.renderSlow=!$L,$L||$q||$S.isConchApp){var $k;$f.loopCount++,$A.instance.runEvent(),$E.timer._update(),$Q.update3DLoop();var $Y=0,$d=0;if($S.isConchNode)for($Y=0,$d=this._scenes.length;$Y<$d;$Y++)($k=this._scenes[$Y])&&$k._updateSceneConch();else for($Y=0,$d=this._scenes.length;$Y<$d;$Y++)($k=this._scenes[$Y])&&$k._updateScene();if($S.isConchNode){var $K=$Fm.CustomList;for($Y=0,$d=$K.length;$Y<$d;$Y++){var $D=$K[$Y];$D.customRender($D.customContext,0,0);}return;}}$S.isConchNode||this.renderingEnabled&&($L||!$q||$S.isConchWebGL)&&($S.isWebGL?$S.WebGL.mainContext&&!$S.WebGL.mainContext.isContextLost()&&($m.clear(),$F.prototype.render.call(this,$m,$p,$h),$f._show&&$f._sp&&$f._sp.render($m,$p,$h),$Q.clear(this._bgColor),$Q.beginFlush(),$m.flush(),$Q.endFinish(),$t.instance&&$t.getInstance().endDispose()):($Q.clear(this._bgColor),$F.prototype.render.call(this,$m,$p,$h),$f._show&&$f._sp&&$f._sp.render($m,$p,$h)));}else this._renderCount%5==0&&($f.loopCount++,$A.instance.runEvent(),$E.timer._update());},$m._requestFullscreen=function(){var $m=$w.document.documentElement;$m.requestFullscreen?$m.requestFullscreen():$m.mozRequestFullScreen?$m.mozRequestFullScreen():$m.webkitRequestFullscreen?$m.webkitRequestFullscreen():$m.msRequestFullscreen&&$m.msRequestFullscreen();},$m._fullScreenChanged=function(){$E.stage.event("fullscreenchange");},$m.exitFullscreen=function(){var $m=$w.document;$m.exitFullscreen?$m.exitFullscreen():$m.mozCancelFullScreen?$m.mozCancelFullScreen():$m.webkitExitFullscreen&&$m.webkitExitFullscreen();},$D(0,$m,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1;}),$D(0,$m,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight;}),$D(0,$m,"frameRate",function(){return this._frameRate;},function($m){if(this._frameRate=$m,$S.isConchApp)switch(this._frameRate){case"slow":$w.window.conch&&$w.window.conchConfig.setSlowFrame&&$w.window.conchConfig.setSlowFrame(!0);break;case"fast":$w.window.conch&&$w.window.conchConfig.setSlowFrame&&$w.window.conchConfig.setSlowFrame(!1);break;case"mouse":$w.window.conch&&$w.window.conchConfig.setMouseFrame&&$w.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$w.window.conch&&$w.window.conchConfig.setLimitFPS&&$w.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.");}}),$D(0,$m,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1;}),$D(0,$m,"width",$F.prototype._$get_width,function($m){this.designWidth=$m,$E.superSet($Fm,this,"width",$m),$E.timer.callLater(this,this._changeCanvasSize);}),$D(0,$m,"alignH",function(){return this._alignH;},function($m){this._alignH=$m,$E.timer.callLater(this,this._changeCanvasSize);}),$D(0,$m,"isFocused",function(){return this._isFocused;}),$D(0,$m,"height",$F.prototype._$get_height,function($m){this.designHeight=$m,$E.superSet($Fm,this,"height",$m),$E.timer.callLater(this,this._changeCanvasSize);}),$D(0,$m,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$M.create();},$F.prototype._$set_transform),$D(0,$m,"isVisibility",function(){return this._isVisibility;}),$D(0,$m,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth;}),$D(0,$m,"scaleMode",function(){return this._scaleMode;},function($m){this._scaleMode=$m,$E.timer.callLater(this,this._changeCanvasSize);}),$D(0,$m,"alignV",function(){return this._alignV;},function($m){this._alignV=$m,$E.timer.callLater(this,this._changeCanvasSize);}),$D(0,$m,"bgColor",function(){return this._bgColor;},function($m){this._bgColor=$m,this.conchModel&&this.conchModel.bgColor($m),$S.isWebGL&&($m?$k._wgColor=$U.create($m)._color:$w.onMiniGame||($k._wgColor=null)),$w.onLimixiu?$k._wgColor=$U.create($m)._color:$S.canvas.style.background=$m||"none";}),$D(0,$m,"mouseX",function(){return Math.round($A.instance.mouseX/this.clientScaleX);}),$D(0,$m,"mouseY",function(){return Math.round($A.instance.mouseY/this.clientScaleY);}),$D(0,$m,"screenMode",function(){return this._screenMode;},function($m){this._screenMode=$m;}),$D(0,$m,"visible",$F.prototype._$get_visible,function($m){this.visible!==$m&&($E.superSet($Fm,this,"visible",$m),$S._mainCanvas.source.style.visibility=$m?"visible":"hidden");}),$D(0,$m,"fullScreenEnabled",null,function($m){var $p=$w.document,$h=$S.canvas;$m?($h.addEventListener("mousedown",this._requestFullscreen),$h.addEventListener("touchstart",this._requestFullscreen),$p.addEventListener("fullscreenchange",this._fullScreenChanged),$p.addEventListener("mozfullscreenchange",this._fullScreenChanged),$p.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$p.addEventListener("msfullscreenchange",this._fullScreenChanged)):($h.removeEventListener("mousedown",this._requestFullscreen),$h.removeEventListener("touchstart",this._requestFullscreen),$p.removeEventListener("fullscreenchange",this._fullScreenChanged),$p.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$p.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$p.removeEventListener("msfullscreenchange",this._fullScreenChanged));}),$k.SCALE_NOSCALE="noscale",$k.SCALE_EXACTFIT="exactfit",$k.SCALE_SHOWALL="showall",$k.SCALE_NOBORDER="noborder",$k.SCALE_FULL="full",$k.SCALE_FIXED_WIDTH="fixedwidth",$k.SCALE_FIXED_HEIGHT="fixedheight",$k.SCALE_FIXED_AUTO="fixedauto",$k.ALIGN_LEFT="left",$k.ALIGN_RIGHT="right",$k.ALIGN_CENTER="center",$k.ALIGN_TOP="top",$k.ALIGN_MIDDLE="middle",$k.ALIGN_BOTTOM="bottom",$k.SCREEN_NONE="none",$k.SCREEN_HORIZONTAL="horizontal",$k.SCREEN_VERTICAL="vertical",$k.FRAME_FAST="fast",$k.FRAME_SLOW="slow",$k.FRAME_MOUSE="mouse",$k.FRAME_SLEEP="sleep",$k.FRAME_MOUSE_THREDHOLD=2e3,$d($k,["_wgColor",function(){return this._wgColor=[0,0,0,1];}]),$k;}($Fm),$em=(function($m){function $p(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$p.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange);}$B($p,"laya.media.SoundNode",$Fm);var $h=$p.prototype;$h._onParentChange=function(){this.target=this.parent;},$h.play=function($m,$p){void 0===$m&&($m=1),isNaN($m)&&($m=1),this.url&&(this.stop(),this._channel=$x.playSound(this.url,$m,null,$p));},$h.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null;},$h._setPlayAction=function($m,$p,$h,$P){void 0===$P&&($P=!0),this[$h]&&$m&&($P?$m.on($p,this,this[$h]):$m.off($p,this,this[$h]));},$h._setPlayActions=function($m,$p,$h,$P){if(void 0===$P&&($P=!0),$m&&$p){var $L,$q=$p.split(","),$k=0;for($L=$q.length,$k=0;$k<$L;$k++)this._setPlayAction($m,$q[$k],$h,$P);}},$D(0,$h,"playEvent",null,function($m){(this._playEvents=$m)&&this._tar&&this._setPlayActions(this._tar,$m,"play");}),$D(0,$h,"target",null,function($m){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$m,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0));}),$D(0,$h,"stopEvent",null,function($m){(this._stopEvents=$m)&&this._tar&&this._setPlayActions(this._tar,$m,"stop");});}(),function($m){function $p(){this._src=null,this._onload=null,this._onerror=null,$p.__super.call(this);}$B($p,"laya.resource.FileBitmap",$Am);var $h=$p.prototype;return $D(0,$h,"src",function(){return this._src;},function($m){this._src=$m;}),$D(0,$h,"onload",null,function($m){}),$D(0,$h,"onerror",null,function($m){}),$p;}()),$am=function($m){function $h($m,$p){this._is2D=!1,$h.__super.call(this);var $P=this;if(this._source=this,"2D"===$m||"AUTO"===$m&&!$S.isWebGL){this._is2D=!0,this._source=$p||$w.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $L=this;$L.getContext=function($m,$p){if($P._ctx)return $P._ctx;var $h=$P._ctx=$P._source.getContext($m,$p);return $h&&($h._canvas=$L,$S.isFlash||$w.onLimixiu||($h.size=function($m,$p){})),$h;};}this.uri="HTMLCanvas_"+this.id,this.lock=!0;}$B($h,"laya.resource.HTMLCanvas",$Am);var $p=$h.prototype;return $p.clear=function(){this._ctx&&this._ctx.clear();},$p.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this);},$p.release=function(){},$p._setContext=function($m){this._ctx=$m;},$p.getContext=function($m,$p){return this._ctx?this._ctx:this._ctx=$h._createContext(this);},$p.getMemSize=function(){return 0;},$p.size=function($m,$p){(this._w!=$m||this._h!=$p||this._source&&(this._source.width!=$m||this._source.height!=$p))&&(this._w=$m,this._h=$p,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($m,$p),this._source&&(this._source.height=$p,this._source.width=$m));},$p.getCanvas=function(){return this._source;},$p.toBase64=function($m,$p,$h){if(this._source)if($S.isConchApp&&this._source.toBase64)this._source.toBase64($m,$p,$h);else{var $P=this._source.toDataURL($m,$p);$h.call(this,$P);}},$D(0,$p,"context",function(){return this._ctx;}),$D(0,$p,"asBitmap",null,function($m){}),$h.create=function($m,$p){return new $h($m,$p);},$h.TYPE2D="2D",$h.TYPE3D="3D",$h.TYPEAUTO="AUTO",$h._createContext=null,$h;}(),$Zm=(function($m){function $d($m,$p,$h,$P,$L,$q,$k,$Y){throw $d.__super.call(this),new Error("不允许new！");}$B($d,"laya.resource.HTMLSubImage",$Am),$d.create=function($m,$p,$h,$P,$L,$q,$k,$Y){return void 0===$Y&&($Y=!1),new $d($m,$p,$h,$P,$L,$q,$k,$Y);};}(),function($m){function $F(){this._frames=null,this._url=null,$F.__super.call(this),this._setControlNode(this);}$B($F,"laya.display.Animation",$m);var $p=$F.prototype;$p.destroy=function($m){void 0===$m&&($m=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$m),this._frames=null,this._labels=null;},$p.play=function($m,$p,$h,$P){void 0===$m&&($m=0),void 0===$p&&($p=!0),void 0===$h&&($h=""),void 0===$P&&($P=!0),$h&&this._setFramesFromCache($h,$P),this._isPlaying=!0,this.index="string"==typeof $m?this._getFrameByLabel($m):$m,this.loop=$p,this._actionName=$h,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0);},$p._setFramesFromCache=function($m,$p){var $h;return void 0===$p&&($p=!1),this._url&&($m=this._url+"#"+$m),$m&&$F.framesMap[$m]?(($h=$F.framesMap[$m])instanceof Array?(this._frames=$F.framesMap[$m],this._count=this._frames.length):($h.nodeRoot&&($F.framesMap[$m]=this._parseGraphicAnimationByData($h),$h=$F.framesMap[$m]),this._frames=$h.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$h.interval),this._labels=this._copyLabels($h.labels)),!0):($p&&console.log("ani not found:",$m),!1);},$p._copyLabels=function($m){if(!$m)return null;var $p,$h;for($h in $p={},$m)$p[$h]=$g.copyArray([],$m[$h]);return $p;},$p._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$m.prototype._frameLoop.call(this);},$p._displayToIndex=function($m){this._frames&&(this.graphics=this._frames[$m]);},$p.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null;},$p.loadImages=function($m,$p){return void 0===$p&&($p=""),this._url="",this._setFramesFromCache($p)||(this.frames=$F.framesMap[$p]?$F.framesMap[$p]:$F.createFrames($m,$p)),this;},$p.loadAtlas=function($p,$h,$P){void 0===$P&&($P=""),this._url="";var $L=this;function $m($m){$p===$m&&($L.frames=$F.framesMap[$P]?$F.framesMap[$P]:$F.createFrames($p,$P),$h&&$h.run());}return $L._setFramesFromCache($P)||($Ym.getAtlas($p)?$m($p):$E.loader.load($p,$e.create(null,$m,[$p]),null,"atlas")),this;},$p.loadAnimation=function($m,$p,$h){this._url=$m;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$p&&$p.run()):!$h||$Ym.getAtlas($h)?this._loadAnimationData($m,$p,$h):$E.loader.load($h,$e.create(this,this._loadAnimationData,[$m,$p,$h]),null,"atlas"),this;},$p._loadAnimationData=function($Y,$d,$m){var $K=this;if(!$m||$Ym.getAtlas($m)){var $D=this;$Ym.getRes($Y)?$p($Y):$E.loader.load($Y,$e.create(null,$p,[$Y]),null,"json"),$Ym.clearRes($Y);}else console.warn("atlas load fail:"+$m);function $p($m){if($Ym.getRes($m)&&$Y===$m){var $p;if($F.framesMap[$Y+"#"])$D._setFramesFromCache($K._actionName,!0),$K.index=0,$K._checkResumePlaying();else{var $h=$D._parseGraphicAnimation($Ym.getRes($Y));if(!$h)return;var $P,$L=$h.animationList,$q=0,$k=$L.length;for($q=0;$q<$k;$q++)$p=$L[$q],$F.framesMap[$Y+"#"+$p.name]=$p,$P||($P=$p);$P&&($F.framesMap[$Y+"#"]=$P,$D._setFramesFromCache($K._actionName,!0),$K.index=0),$K._checkResumePlaying();}$d&&$d.run();}}},$p._parseGraphicAnimation=function($m){return $Em.parseAnimationData($m);},$p._parseGraphicAnimationByData=function($m){return $Em.parseAnimationByData($m);},$D(0,$p,"frames",function(){return this._frames;},function($m){(this._frames=$m)&&(this._count=$m.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index);}),$D(0,$p,"autoPlay",null,function($m){$m?this.play():this.stop();}),$D(0,$p,"source",null,function($m){-1<$m.indexOf(".ani")?this.loadAnimation($m):-1<$m.indexOf(".json")||-1<$m.indexOf("als")||-1<$m.indexOf("atlas")?this.loadAtlas($m):this.loadImages($m.split(","));}),$D(0,$p,"autoAnimation",null,function($m){this.play(0,!0,$m,!1);}),$F.createFrames=function($m,$p){var $h,$P,$L=0,$q=0;if("string"==typeof $m){var $k=$Ym.getAtlas($m);if($k&&$k.length)for($h=[],$L=0,$q=$k.length;$L<$q;$L++)($P=new $Q.createGraphics()).drawTexture($Ym.getRes($k[$L]),0,0),$h.push($P);}else if($m instanceof Array)for($h=[],$L=0,$q=$m.length;$L<$q;$L++)($P=new $Q.createGraphics()).loadImage($m[$L],0,0),$h.push($P);return $p&&($F.framesMap[$p]=$h),$h;},$F.clearCache=function($m){var $p,$h=$F.framesMap,$P=$m+"#";for($p in $h)$p!==$m&&0!=$p.indexOf($P)||delete $F.framesMap[$p];},$F.framesMap={};}($Bm),function($m){function $q(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$q.__super.call(this),null==$q._sortIndexFun&&($q._sortIndexFun=$W.sortByKey("index",!1,!0));}$B($q,"laya.display.FrameAnimation",$m);var $p=$q.prototype;return $p._setUp=function($m,$p){this._labels=null,this._animationNewFrames=null,this._targetDic=$m,this._animationData=$p,this.interval=1e3/$p.frameRate,$p.parsed?(this._count=$p.count,this._labels=$p.labels,this._animationNewFrames=$p.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$p.parsed=!0,$p.labels=this._labels,$p.count=this._count,$p.animationNewFrames=this._animationNewFrames;},$p.clear=function(){$m.prototype.clear.call(this),this._targetDic=null,this._animationData=null;},$p._displayToIndex=function($m){if(this._animationData){$m<0&&($m=0),$m>this._count&&($m=this._count);var $p=this._animationData.nodes,$h=0,$P=$p.length;for($h=0;$h<$P;$h++)this._displayNodeToFrame($p[$h],$m);}},$p._displayNodeToFrame=function($m,$p,$h){$h||($h=this._targetDic);var $P=$h[$m.target];if($P){var $L,$q,$k,$Y=$m.frames,$d=$m.keys,$K=0,$D=$d.length;for($K=0;$K<$D;$K++)$k=($q=$Y[$L=$d[$K]]).length>$p?$q[$p]:$q[$q.length-1],$P[$L]=$k;}},$p._calculateDatas=function(){if(this._animationData){var $m,$p=this._animationData.nodes,$h=0,$P=$p.length;for($h=this._count=0;$h<$P;$h++)$m=$p[$h],this._calculateNodeKeyFrames($m);this._count+=1;}},$p._calculateNodeKeyFrames=function($m){var $p,$h,$P=$m.keyframes,$L=$m.target;for($p in $m.frames||($m.frames={}),$m.keys?$m.keys.length=0:$m.keys=[],$m.initValues||($m.initValues={}),$P)$h=$P[$p],$m.frames[$p]||($m.frames[$p]=[]),this._targetDic&&this._targetDic[$L]&&($m.initValues[$p]=this._targetDic[$L][$p]),$h.sort($q._sortIndexFun),$m.keys.push($p),this._calculateNodePropFrames($h,$m.frames[$p],$p,$L);},$p.resetToInitState=function(){if(this._targetDic&&this._animationData){var $m,$p,$h=this._animationData.nodes,$P=0,$L=$h.length;for($P=0;$P<$L;$P++)if($p=($m=$h[$P]).initValues){var $q,$k=this._targetDic[$m.target];if($k)for($q in $p)$k[$q]=$p[$q];}}},$p._calculateNodePropFrames=function($m,$p,$h,$P){var $L=0,$q=$m.length-1;if(0<$q){for($p.length=$m[$q].index+1,$L=0;$L<$q;$L++)this._dealKeyFrame($m[$L]),this._calculateFrameValues($m[$L],$m[$L+1],$p);this._dealKeyFrame($m[$L]);}0==$q&&($p[$m[0].index]=$m[0].value,this._animationNewFrames&&(this._animationNewFrames[$m[0].index]=!0));},$p._dealKeyFrame=function($m){$m.label&&""!=$m.label&&this.addLabel($m.label,$m.index);},$p._calculateFrameValues=function($m,$p,$h){var $P,$L=0,$q=$m.index,$k=$p.index,$Y=$m.value,$d=$p.value-$m.value,$K=$k-$q;if($k>this._count&&(this._count=$k),$m.tween)for(null==($P=$y[$m.tweenMethod])&&($P=$y.linearNone),$L=$q;$L<$k;$L++)$h[$L]=$P($L-$q,$Y,$d,$K),this._animationNewFrames&&(this._animationNewFrames[$L]=!0);else for($L=$q;$L<$k;$L++)$h[$L]=$Y;this._animationNewFrames&&(this._animationNewFrames[$m.index]=!0,this._animationNewFrames[$p.index]=!0),$h[$p.index]=$p.value;},$q._sortIndexFun=null,$q;}($Bm)),$Hm=function($p){function $L(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$L.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$nm.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay);}$B($L,"laya.display.Input",$p);var $m=$L.prototype;return $m.setSelection=function($m,$p){this.focus=!0,laya.display.Input.inputElement.selectionStart=$m,laya.display.Input.inputElement.selectionEnd=$p;},$m._onUnDisplay=function($m){this.focus=!1;},$m._onMouseDown=function($m){this.focus=!0;},$m._syncInputTransform=function(){var $m=this.nativeInput,$p=$g.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$h=this._width-this.padding[1]-this.padding[3],$P=this._height-this.padding[0]-this.padding[2];$S.isConchApp?($m.setScale($p.scaleX,$p.scaleY),$m.setSize($h,$P),$m.setPos($p.x,$p.y)):($L.iframeInput&&$L._showIOSInput(),$L.inputContainer.style.transform=$L.inputContainer.style.webkitTransform="scale("+$p.scaleX+","+$p.scaleY+") rotate("+$E.stage.canvasDegree+"deg)",$m.style.width=$h+"px",$m.style.height=$P+"px",$L.inputContainer.style.left=$p.x+"px",$L.inputContainer.style.top=$p.y+"px");},$m.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select();},$m._setInputMethod=function(){$L.input.parentElement&&$L.inputContainer.removeChild($L.input),$L.area.parentElement&&$L.inputContainer.removeChild($L.area),$L.inputElement=this.nativeInput,$L.inputContainer.appendChild($L.inputElement),$nm.RightToLeft&&($L.inputElement.style.direction="rtl");},$m._focusIn=function(){laya.display.Input.isInputting=!0;var $m=this.nativeInput;this._focus=!0;var $p=$m.style;$p.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$m.readOnly=!this._editable,$S.isConchApp&&($m.setType(this._type),$m.setForbidEdit(!this._editable)),$m.maxLength=this._maxChars;this.padding;if($m.type=this._type,$m.value=this._content,$m.placeholder=this._prompt,$E.stage.off("keydown",this,this._onKeyDown),$E.stage.on("keydown",this,this._onKeyDown),($E.stage.focus=this).event("focus"),$w.onPC&&$m.focus(),!$w.onMiniGame){this._text;this._text=null;}this.typeset(),$m.setColor(this._originColor),$m.setFontSize(this.fontSize),$m.setFontFace($w.onIPhone&&$nm._fontFamilyMap[this.font]||this.font),$S.isConchApp&&$m.setMultiAble&&$m.setMultiAble(this._multiline),$p.lineHeight=this.leading+this.fontSize+"px",$p.fontStyle=this.italic?"italic":"normal",$p.fontWeight=this.bold?"bold":"normal",$p.textAlign=this.align,$p.padding="0 0",this._syncInputTransform(),!$S.isConchApp&&$w.onPC&&$E.timer.frameLoop(1,this,this._syncInputTransform);},$m._setPromptColor=function(){($L.promptStyleDOM=$w.getElementById("promptStyle"))||(($L.promptStyleDOM=$w.createElement("style")).setAttribute("id","promptStyle"),$w.document.head.appendChild($L.promptStyleDOM)),$L.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}";},$m._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($E.superSet($nm,this,"text",this._content),$E.superSet($nm,this,"color",this._originColor)):($E.superSet($nm,this,"text",this._prompt),$E.superSet($nm,this,"color",this._promptColor)),$E.stage.off("keydown",this,this._onKeyDown),$E.stage.focus=null,this.event("blur"),$S.isConchApp&&this.nativeInput.blur(),$w.onPC&&$E.timer.clear(this,this._syncInputTransform);},$m._onKeyDown=function($m){13===$m.keyCode&&($w.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"));},$m.changeText=function($m){this._content=$m,this._focus?(this.nativeInput.value=$m||"",this.event("change")):$p.prototype.changeText.call(this,$m);},$D(0,$m,"color",$p.prototype._$get_color,function($m){this._focus&&this.nativeInput.setColor($m),$E.superSet($nm,this,"color",this._content?$m:this._promptColor),this._originColor=$m;}),$D(0,$m,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0;},function($m){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。");}),$D(0,$m,"multiline",function(){return this._multiline;},function($m){this._multiline=$m,this.valign=$m?"top":"middle";}),$D(0,$m,"maxChars",function(){return this._maxChars;},function($m){$m<=0&&($m=1e5),this._maxChars=$m;}),$D(0,$m,"text",function(){return this._focus?this.nativeInput.value:this._content||"";},function($m){$E.superSet($nm,this,"color",this._originColor),$m+="",this._focus?(this.nativeInput.value=$m||"",this.event("change")):(this._multiline||($m=$m.replace(/\r?\n/g,"")),(this._content=$m)?$E.superSet($nm,this,"text",$m):($E.superSet($nm,this,"text",this._prompt),$E.superSet($nm,this,"color",this.promptColor)));}),$D(0,$m,"nativeInput",function(){return $L.iframeInput?$L.iframeInput:this._multiline?$L.area:$L.input;}),$D(0,$m,"prompt",function(){return this._prompt;},function($m){!this._text&&$m&&$E.superSet($nm,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$E.superSet($nm,this,"text",this._text==this._prompt?$m:this._text):$E.superSet($nm,this,"text",$m),this._prompt=$nm.langPacks&&$nm.langPacks[$m]?$nm.langPacks[$m]:$m;}),$D(0,$m,"focus",function(){return this._focus;},function($m){var $p=this.nativeInput;this._focus!==$m&&($m?($p.target?$p.target._focusOut():this._setInputMethod(),($p.target=this)._focusIn()):($p.target=null,this._focusOut(),$w.document.body.scrollTop=0,$p.blur(),$S.isConchApp?$p.setPos(-1e4,-1e4):$L.inputContainer.contains($p)&&$L.inputContainer.removeChild($p)));}),$D(0,$m,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:"";},function($m){$m?(-1<($m="[^"+$m+"]").indexOf("^^")&&($m=$m.replace("^^","")),this._restrictPattern=new RegExp($m,"g")):this._restrictPattern=null;}),$D(0,$m,"editable",function(){return this._editable;},function($m){this._editable=$m,$S.isConchApp&&$L.input.setForbidEdit(!$m);}),$D(0,$m,"promptColor",function(){return this._promptColor;},function($m){this._promptColor=$m,this._content||$E.superSet($nm,this,"color",$m);}),$D(0,$m,"type",function(){return this._type;},function($m){this._getCSSStyle().password="password"==$m,this._type=$m,$S.isConchApp&&this.nativeInput.setType($m);}),$D(0,$m,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0;},function($m){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。");}),$D(0,$m,"asPassword",function(){return this._getCSSStyle().password;},function($m){this._getCSSStyle().password=$m,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0;}),$L.__init__=function(){$L._createInputElement(),$w.onMobile&&$S.canvas.addEventListener($L.IOS_IFRAME?$w.onMiniGame?"touchend":"click":"touchend",$L._popupInputMethod);},$L._popupInputMethod=function($m){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus();},$L._createInputElement=function(){$L._initInput($L.area=$w.createElement("textarea")),$L._initInput($L.input=$w.createElement("input")),$L._createIOSInputElement(),($L.inputContainer=$w.createElement("div")).style.position="absolute",$L.inputContainer.style.zIndex=1e5,$w.container.appendChild($L.inputContainer),$L.inputContainer.setPos=function($m,$p){$L.inputContainer.style.left=$m+"px",$L.inputContainer.style.top=$p+"px";};},$L._createIOSInputElement=function(){if($L.IS_IOS){if($w.getElementById("inputIframe"))return;var $p=$w.createElement("iframe");$p.id="inputIframe",$p.onload=function(){$p.style="position: none; width: 0%; height: 0%;";var $m=$p.contentDocument.getElementsByTagName("input");$m=$m?$m[0]:null,($L.iframeInput=$m)&&$L._initInput($m);},$w.container.appendChild($p),$p.src="./input.html";}},$L._reLoadIOSInputElement=function(){var $m=$w.getElementById("inputIframe");$m&&($L.iframeInput.target&&($L.iframeInput.target.focus=!1),$L.iframeInput.onblur=null,$L.iframeInput.onload=null,$m.src="./input.html");},$L._showIOSInput=function(){$w.getElementById("inputIframe")&&($L.iframeInput.value=$L.iframeInput.target.text,$L.iframeInput.onblur=function(){$L._reLoadIOSInputElement();});},$L._initInput=function($p){var $m=$p.style;$m.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$m.resize="none",$m.backgroundColor="transparent",$m.border="none",$m.outline="none",$m.zIndex=1,$p.addEventListener("input",$L._processInputting),$p.addEventListener("mousemove",$L._stopEvent),$p.addEventListener("mousedown",$L._stopEvent),$p.addEventListener("touchmove",$L._stopEvent),$p.setFontFace=function($m){$p.style.fontFamily=$m;},$S.isConchApp||($p.setColor=function($m){$p.style.color=$m;},$p.setFontSize=function($m){$p.style.fontSize=$m+"px";});},$L._processInputting=function($m){var $p=laya.display.Input.inputElement.target;if($p){var $h=laya.display.Input.inputElement.value;$p._restrictPattern&&($h=$h.replace(/\u2006|\x27/g,""),$p._restrictPattern.test($h)&&($h=$h.replace($p._restrictPattern,""),laya.display.Input.inputElement.value=$h)),$p._text=$h,$p.event("input");}},$L._stopEvent=function($m){"touchmove"==$m.type&&$m.preventDefault(),$m.stopPropagation&&$m.stopPropagation();},$L.TYPE_TEXT="text",$L.TYPE_PASSWORD="password",$L.TYPE_EMAIL="email",$L.TYPE_URL="url",$L.TYPE_NUMBER="number",$L.TYPE_RANGE="range",$L.TYPE_DATE="date",$L.TYPE_MONTH="month",$L.TYPE_WEEK="week",$L.TYPE_TIME="time",$L.TYPE_DATE_TIME="datetime",$L.TYPE_DATE_TIME_LOCAL="datetime-local",$L.TYPE_SEARCH="search",$L.input=null,$L.area=null,$L.inputElement=null,$L.inputContainer=null,$L.confirmButton=null,$L.promptStyleDOM=null,$L.inputHeight=45,$L.isInputting=!1,$L.stageMatrix=null,$d($L,["IOS_IFRAME",function(){return this.IOS_IFRAME=$w.onIOS&&$w.window.top!=$w.window.self;}]),$d($L,["IS_IOS",function(){return this.IS_IOS=!1;}]),$L;}($nm),$Wm=function($m){function $h($m,$p){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$h.__super.call(this),$m&&this._init_($m,$p);}$B($h,"laya.resource.HTMLImage",$em);var $p=$h.prototype;return $p._init_=function($m,$p){this._src=$m,this._source=new $w.window.Image(),$p&&($p.onload&&(this.onload=$p.onload),$p.onerror&&(this.onerror=$p.onerror),$p.onCreate&&$p.onCreate(this)),0!=$m.indexOf("data:image")&&(this._source.crossOrigin=""),$m&&(this._source.src=$m);},$p.recreateResource=function(){var $m=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate();}else{this._recreateLock=!0;var $p=this;this._source=new $w.window.Image(),this._source.crossOrigin="",this._source.onload=function(){if($p._needReleaseAgain)return $p._needReleaseAgain=!1,$p._source.onload=null,void($p._source=null);$p._source.onload=null,$p.memorySize=$m._w*$m._h*4,$p._recreateLock=!1,$p.completeCreate();},this._source.src=this._src;}},$p.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0);},$p.onresize=function(){this._w=this._source.width,this._h=this._source.height;},$D(0,$p,"onload",null,function($m){var $p=this;this._onload=$m,this._source&&(this._source.onload=null!=this._onload?function(){$p.onresize(),$p._onload();}:null);}),$D(0,$p,"onerror",null,function($m){var $p=this;this._onerror=$m,this._source&&(this._source.onerror=null!=this._onerror?function(){$p._onerror();}:null);}),$D(0,$p,"enableMerageInAtlas",function(){return this._enableMerageInAtlas;},function($m){this._enableMerageInAtlas=$m,$S.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$m);}),$h.create=function($m,$p){return new $h($m,$p);},$h;}(),$Em=(function($q){function $m(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$m.__super.call(this);}$B($m,"laya.display.EffectAnimation",$q);var $p=$m.prototype;$p._onOtherBegin=function($m){$m!=this&&this.stop();},$p.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction));},$p._onPlayAction=function(){this.play(0,!1);},$p.play=function($m,$p,$h,$P){void 0===$m&&($m=0),void 0===$p&&($p=!0),void 0===$h&&($h=""),void 0===$P&&($P=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$m,$p,$h,$P));},$p._recordInitData=function(){if(this._aniKeys){var $m,$p,$h=0;for($m=this._aniKeys.length,$h=0;$h<$m;$h++)$p=this._aniKeys[$h],this._initData[$p]=this._target[$p];}},$p._displayToIndex=function($m){if(this._animationData){$m<0&&($m=0),$m>this._count&&($m=this._count);var $p=this._animationData.nodes,$h=0,$P=$p.length;for($P=1<$P?1:$P,$h=0;$h<$P;$h++)this._displayNodeToFrame($p[$h],$m);}},$p._displayNodeToFrame=function($m,$p,$h){if(this._target){var $P;$P=this._target;var $L,$q,$k,$Y,$d=$m.frames,$K=$m.keys,$D=0,$F=$K.length;$Y=$m.secondFrames;var $R,$$,$A,$B,$n=0;for($D=0;$D<$F;$D++)$q=$d[$L=$K[$D]],$k=-1==($n=$Y[$L])?this._initData[$L]:$p<$n?($A=($$=$m.keyframes[$L])[0]).tween?(null==($R=$y[$A.tweenMethod])&&($R=$y.linearNone),$B=$$[1],$R($p,this._initData[$L],$B.value-this._initData[$L],$B.index)):this._initData[$L]:$q.length>$p?$q[$p]:$q[$q.length-1],$P[$L]=$k;}},$p._calculateNodeKeyFrames=function($m){$q.prototype._calculateNodeKeyFrames.call(this,$m);var $p,$h,$P,$L=$m.keyframes;$m.target;for($p in $P={},$m.secondFrames=$P,$L)($h=$L[$p]).length<=1?$P[$p]=-1:$P[$p]=$h[1].index;},$D(0,$p,"target",function(){return this._target;},function($m){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$m,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent();}),$D(0,$p,"playEvent",null,function($m){(this._playEvents=$m)&&this.addEvent();}),$D(0,$p,"effectData",null,function($m){var $p;$m&&($p=$m.animations)&&$p[0]&&(this._setUp({},$p[0]),$p[0].nodes&&$p[0].nodes[0]&&(this._aniKeys=$p[0].nodes[0].keys));}),$D(0,$p,"effectClass",null,function($m){var $p,$h;(this._effectClass=$G.getClass($m),this._effectClass)&&($p=this._effectClass.uiView)&&($h=$p.animations)&&$h[0]&&(this._setUp({},$h[0]),$h[0].nodes&&$h[0].nodes[0]&&(this._aniKeys=$h[0].nodes[0].keys));}),$m.EffectAnimationBegin="effectanimationbegin";}($Zm),function($p){var $j;function $x(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$x.__super.call(this);}$B($x,"laya.utils.GraphicAnimation",$p);var $m=$x.prototype;return $m._parseNodeList=function($m){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$m.compId]=$m.props,$m.compId&&this._nodeList.push($m.compId);var $p=$m.child;if($p){var $h=0,$P=$p.length;for($h=0;$h<$P;$h++)this._parseNodeList($p[$h]);}},$m._calGraphicData=function($m){var $p;if(this._setUp(null,$m),this._createGraphicData(),this._nodeIDAniDic)for($p in this._nodeIDAniDic)this._nodeIDAniDic[$p]=null;},$m._createGraphicData=function(){var $m,$p=[],$h=0,$P=this.count,$L=this._animationNewFrames;for($L||($L=[]),$h=0;$h<$P;$h++)!$L[$h]&&$m||($m=this._createFrameGraphic($h)),$p.push($m);this._gList=$p;},$m._createFrameGraphic=function($m){var $p=$Q.createGraphics();return $x._rootMatrix||($x._rootMatrix=new $M()),this._updateNodeGraphic(this._rootNode,$m,$x._rootMatrix,$p),$p;},$m._updateNodeGraphic=function($m,$p,$h,$P,$L){var $q;void 0===$L&&($L=1);var $k,$Y,$d,$K=($q=this._nodeGDic[$m.compId]=this._getNodeGraphicData($m.compId,$p,this._nodeGDic[$m.compId])).alpha*$L;if(!($K<.01)&&($q.resultTransform||($q.resultTransform=$M.create()),$k=$q.resultTransform,$M.mul($q.transform,$h,$k),$q.skin&&($Y=this._getTextureByUrl($q.skin))&&($k._checkTransform()?($P.drawTexture($Y,0,0,$q.width,$q.height,$k,$K),$q.resultTransform=null):$P.drawTexture($Y,$k.tx,$k.ty,$q.width,$q.height,null,$K)),$d=$m.child)){var $D,$F=0;for($D=$d.length,$F=0;$F<$D;$F++)this._updateNodeGraphic($d[$F],$p,$k,$P,$K);}},$m._updateNoChilds=function($m,$p){if($m.skin){var $h=this._getTextureByUrl($m.skin);if($h){var $P=$m.transform;$P._checkTransform();!$P.bTransform?$p.drawTexture($h,$P.tx,$P.ty,$m.width,$m.height,null,$m.alpha):$p.drawTexture($h,0,0,$m.width,$m.height,$P.clone(),$m.alpha);}}},$m._updateNodeGraphic2=function($m,$p,$h){var $P;if($P=this._nodeGDic[$m.compId]=this._getNodeGraphicData($m.compId,$p,this._nodeGDic[$m.compId]),$m.child){var $L=$P.transform;$L._checkTransform();var $q,$k;$k=($q=!$L.bTransform)&&(0!=$L.tx||0!=$L.ty);var $Y,$d,$K;if(($Y=$L.bTransform||1!=$P.alpha)&&$h.save(),1!=$P.alpha&&$h.alpha($P.alpha),$q?$k&&$h.translate($L.tx,$L.ty):$h.transform($L.clone()),$d=$m.child,$P.skin&&($K=this._getTextureByUrl($P.skin))&&$h.drawTexture($K,0,0,$P.width,$P.height),$d){var $D,$F=0;for($D=$d.length,$F=0;$F<$D;$F++)this._updateNodeGraphic2($d[$F],$p,$h);}$Y?$h.restore():$q?$k&&$h.translate(-$L.tx,-$L.ty):$h.transform($L.clone().invert());}else this._updateNoChilds($P,$h);},$m._calculateNodeKeyFrames=function($m){$p.prototype._calculateNodeKeyFrames.call(this,$m),this._nodeIDAniDic[$m.target]=$m;},$m.getNodeDataByID=function($m){return this._nodeIDAniDic[$m];},$m._getParams=function($m,$p,$h,$P){var $L=$x._temParam;$L.length=$p.length;var $q=0,$k=$p.length;for($q=0;$q<$k;$q++)$L[$q]=this._getObjVar($m,$p[$q][0],$h,$p[$q][1],$P);return $L;},$m._getObjVar=function($m,$p,$h,$P,$L){if($m.hasOwnProperty($p)){var $q=$m[$p];if($h>=$q.length&&($h=$q.length-1),null!=$m[$p][$h])return $m[$p][$h];}return $L.hasOwnProperty($p)?$L[$p]:$P;},$m._getNodeGraphicData=function($m,$p,$h){$h||($h=$j.create()),$h.transform?$h.transform.identity():$h.transform=$M.create();var $P=this.getNodeDataByID($m);if(!$P)return $h;var $L,$q,$k=$P.frames,$Y=this._getParams($k,$x._drawTextureCmd,$p,this._nodeDefaultProps[$m]),$d=$Y[0],$K=NaN,$D=NaN,$F=$Y[5],$R=$Y[6],$$=$Y[13],$A=$Y[14],$B=$Y[7],$n=$Y[8],$c=$Y[9],$e=$Y[11],$a=$Y[12];$K=$Y[3],$D=$Y[4],0!=$K&&0!=$D||($d=null),-1==$K&&($K=0),-1==$D&&($D=0),$h.skin=$d,$h.width=$K,$h.height=$D,$d&&(($L=this._getTextureByUrl($d))?($K||($K=$L.sourceWidth),$D||($D=$L.sourceHeight)):console.warn("lost skin:",$d,",you may load pics first")),$h.alpha=$Y[10],$q=$h.transform,0!=$$&&($F=$$*$K),0!=$A&&($R=$A*$D),0==$F&&0==$R||$q.translate(-$F,-$R);var $Z=null;if($c||1!==$B||1!==$n||$e||$a){($Z=$x._tempMt).identity(),$Z.bTransform=!0;var $H=.0174532922222222*($c-$e),$W=.0174532922222222*($c+$a),$E=Math.cos($W),$I=Math.sin($W),$b=Math.sin($H),$T=Math.cos($H);$Z.a=$B*$E,$Z.b=$B*$I,$Z.c=-$n*$b,$Z.d=$n*$T,$Z.tx=$Z.ty=0;}return $Z&&($q=$M.mul($q,$Z,$q)),$q.translate($Y[1],$Y[2]),$h;},$m._getTextureByUrl=function($m){return $Ym.getRes($m);},$m.setAniData=function($m,$p){if($m.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$m,this._parseNodeList($m);var $h,$P={},$L=[],$q=$m.animations,$k=0,$Y=$q.length;for($k=0;$k<$Y;$k++)if($h=$q[$k],this._labels=null,(!$p||$p==$h.name)&&$h){try{this._calGraphicData($h);}catch($m){console.warn("parse animation fail:"+$h.name+",empty animation created"),this._gList=[];}var $d={};$d.interval=1e3/$h.frameRate,$d.frames=this._gList,$d.labels=this._labels,$d.name=$h.name,$L.push($d),$P[$h.name]=$d;}this.animationList=$L,this.animationDic=$P;}$x._temParam.length=0;},$m.parseByData=function($m){var $p,$h;$p=$m.nodeRoot,$h=$m.aniO,delete $m.nodeRoot,delete $m.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$p,this._parseNodeList($p),this._labels=null;try{this._calGraphicData($h);}catch($m){console.warn("parse animation fail:"+$h.name+",empty animation created"),this._gList=[];}var $P=$m;return $P.interval=1e3/$h.frameRate,$P.frames=this._gList,$P.labels=this._labels,$P.name=$h.name,$P;},$m.setUpAniData=function($m){if($m.animations){var $p,$h={},$P=[],$L=$m.animations,$q=0,$k=$L.length;for($q=0;$q<$k;$q++)if($p=$L[$q]){var $Y={};$Y.name=$p.name,$Y.aniO=$p,$Y.nodeRoot=$m,$P.push($Y),$h[$p.name]=$Y;}this.animationList=$P,this.animationDic=$h;}},$m._clear=function(){var $m,$p;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($m in this._nodeGDic)($p=this._nodeGDic[$m])&&$p.recover();this._nodeGDic=null;},$x.parseAnimationByData=function($m){var $p;return $x._I||($x._I=new $x()),$p=$x._I.parseByData($m),$x._I._clear(),$p;},$x.parseAnimationData=function($m){var $p;return $x._I||($x._I=new $x()),$x._I.setUpAniData($m),($p={}).animationList=$x._I.animationList,$p.animationDic=$x._I.animationDic,$x._I._clear(),$p;},$x._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$x._temParam=[],$x._I=null,$x._rootMatrix=null,$d($x,["_tempMt",function(){return this._tempMt=new $M();}]),$x.__init$=function(){$j=function(){function $m(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1;}return $B($m,""),$m.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$o.recover("GraphicNode",this);},$m.create=function(){return $o.getItemByClass("GraphicNode",$m);},$m;}();},$x;}($Zm));$E.__init([$K,$dm,$S,$w,$i,$T,$m,$Em]);}(window,document,Laya),function($m,$p,$h){$h.un,$h.uns,$h.static;var $P=$h.class;$h.getset,$h.__newvec;new(function(){function $m(){}return $P($m,"LayaMain"),$m;}())();}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($m,$p){"use strict";for(var $h in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $P=Laya[$h];$P&&$P.__isclass&&($p[$h]=$P);}}),function($m,$p,$W){$W.un,$W.uns;var $k=$W.static,$R=$W.class,$P=$W.getset,$q=$W.__newvec,$D=laya.maths.Arith,$F=laya.maths.Bezier,$h=laya.resource.Bitmap,$$=laya.utils.Browser,$d=laya.utils.Byte,$A=laya.utils.Color,$E=(laya.filters.ColorFilter,$W.Config),$L=laya.resource.Context,$I=(laya.events.Event,laya.filters.Filter),$Y=laya.display.Graphics,$K=laya.resource.HTMLCanvas,$B=(laya.utils.HTMLChar,laya.resource.HTMLImage),$n=laya.resource.HTMLSubImage,$b=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$T=laya.maths.Point,$j=laya.maths.Rectangle,$c=laya.renders.Render,$e=(laya.renders.RenderContext,laya.renders.RenderSprite),$a=laya.resource.Resource,$Z=laya.resource.ResourceManager,$H=laya.utils.RunDriver,$x=laya.display.Sprite,$Q=laya.display.Stage,$M=laya.utils.Stat,$u=laya.utils.StringKey,$N=(laya.display.css.Style,laya.system.System),$S=laya.display.Text,$_=laya.resource.Texture,$l=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$J=laya.utils.VectorGraphManager;laya.utils.WordText;$W.interface("laya.webgl.shapes.IShape"),$W.interface("laya.webgl.submit.ISubmit"),$W.interface("laya.webgl.text.ICharSegment"),$W.interface("laya.webgl.canvas.save.ISaveData"),$W.interface("laya.webgl.resource.IMergeAtlasBitmap"),$W.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $z=function(){function $m(){}$R($m,"laya.filters.webgl.FilterActionGL");var $p=$m.prototype;return $W.imps($p,{"laya.filters.IFilterActionGL":!0}),$p.setValue=function($m){},$p.setValueMix=function($m){},$p.apply3d=function($m,$p,$h,$P,$L){return null;},$p.apply=function($m){return null;},$P(0,$p,"typeMix",function(){return 0;}),$m;}(),$w=function(){function $m(){}return $R($m,"laya.webgl.shader.ShaderValue"),$m;}(),$X=function(){var $P,$L;function $m($m,$p,$h){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $L(),void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),this._cells=null,this._rowInfo=null,this._init($m,$p),this._atlasID=$h;}$R($m,"laya.webgl.atlas.AtlasGrid");var $p=$m.prototype;return $p.getAltasID=function(){return this._atlasID;},$p.setAltasID=function($m){0<=$m&&(this._atlasID=$m);},$p.addTex=function($m,$p,$h){var $P=this._get($p,$h);return 0==$P.ret||(this._fill($P.x,$P.y,$p,$h,$m),this._texCount++),$P;},$p._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null);},$p._init=function($m,$p){if(this._width=$m,this._height=$p,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$q(this._height);for(var $h=0;$h<this._height;$h++)this._rowInfo[$h]=new $P();return this._clear(),!0;},$p._get=function($m,$p){var $h=new $G();if($m>=this._failSize.width&&$p>=this._failSize.height)return $h;for(var $P=-1,$L=-1,$q=this._width,$k=this._height,$Y=this._cells,$d=0;$d<$k;$d++)if(!(this._rowInfo[$d].spaceCount<$m))for(var $K=0;$K<$q;){var $D=3*($d*$q+$K);if(0!=$Y[$D]||$Y[1+$D]<$m||$Y[2+$D]<$p)$K+=$Y[1+$D];else{$P=$K,$L=$d;for(var $F=0;$F<$m;$F++)if($Y[3*$F+$D+2]<$p){$P=-1;break;}if(!($P<0))return $h.ret=!0,$h.x=$P,$h.y=$L,$h;$K+=$Y[1+$D];}}return $h;},$p._fill=function($m,$p,$h,$P,$L){var $q=this._width,$k=this._height;this._check($m+$h<=$q&&$p+$P<=$k);for(var $Y=$p;$Y<$P+$p;++$Y){this._check(this._rowInfo[$Y].spaceCount>=$h),this._rowInfo[$Y].spaceCount-=$h;for(var $d=0;$d<$h;$d++){var $K=3*($m+$Y*$q+$d);this._check(0==this._cells[$K]),this._cells[$K]=$L,this._cells[1+$K]=$h,this._cells[2+$K]=$P;}}if(0<$m)for($Y=0;$Y<$P;++$Y){var $D=0;for($d=$m-1;0<=$d&&0==this._cells[3*(($p+$Y)*$q+$d)];--$d,++$D);for($d=$D;0<$d;--$d)this._cells[3*(($p+$Y)*$q+$m-$d)+1]=$d,this._check(0<$d);}if(0<$p)for($d=$m;$d<$m+$h;++$d){for($D=0,$Y=$p-1;0<=$Y&&0==this._cells[3*($d+$Y*$q)];--$Y,$D++);for($Y=$D;0<$Y;--$Y)this._cells[3*($d+($p-$Y)*$q)+2]=$Y,this._check(0<$Y);}},$p._check=function($m){0==$m&&console.log("xtexMerger 错误啦");},$p._clear=function(){for(var $m=this._texCount=0;$m<this._height;$m++)this._rowInfo[$m].spaceCount=this._width;for(var $p=0;$p<this._height;$p++)for(var $h=0;$h<this._width;$h++){var $P=3*($p*this._width+$h);this._cells[$P]=0,this._cells[1+$P]=this._width-$h,this._cells[2+$P]=this._width-$p;}this._failSize.width=this._width+1,this._failSize.height=this._height+1;},$m.__init$=function(){$P=function(){function $m(){this.spaceCount=0;}return $R($m,""),$m;}(),$L=function(){function $m(){this.width=0,this.height=0;}return $R($m,""),$m;}();},$m;}(),$s=function(){function $c($m,$p,$h,$P){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$m,this._height=$p,this._gridSize=$h,this._maxAtlaserCount=$P,this._gridNumX=$m/$h,this._gridNumY=$p/$h,this._curAtlasIndex=0,this._atlaserArray=[];}$R($c,"laya.webgl.atlas.AtlasResourceManager");var $m=$c.prototype;return $m.setAtlasParam=function($m,$p,$h,$P){if(1==this._setAtlasParam)return $c._sid_=0,this._width=$m,this._height=$p,this._gridSize=$h,this._maxAtlaserCount=$P,this._gridNumX=$m/$h,this._gridNumY=$p/$h,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1;},$m.pushData=function($m){var $p,$h=$m.bitmap,$P=-1,$L=null,$q=0,$k=0;for($q=0,$p=this._atlaserArray.length;$q<$p&&($k=(this._curAtlasIndex+$q)%$p,-1==($P=($L=this._atlaserArray[$k]).findBitmapIsExist($h)));$q++);if(-1!=$P){var $Y=$L.InAtlasWebGLImagesOffsetValue[$P];return $A=$Y[0],$B=$Y[1],$L.addToAtlas($m,$A,$B),!0;}this._setAtlasParam=!1;for(var $d=Math.ceil(($m.bitmap.width+2)/this._gridSize),$K=Math.ceil(($m.bitmap.height+2)/this._gridSize),$D=!1,$F=0;$F<2;$F++){var $R=this._maxAtlaserCount;for($q=0;$q<$R;$q++){$k=(this._curAtlasIndex+$q)%$R,this._atlaserArray.length-1>=$k||this._atlaserArray.push(new $jm(this._gridNumX,this._gridNumY,this._width,this._height,$c._sid_++));var $$=this._atlaserArray[$k],$A=0,$B=0,$n=$$.addTex(1,$d,$K);if($n.ret){$A=$n.x*this._gridSize+1,$B=$n.y*this._gridSize+1,$h.lock=!0,$$.addToAtlasTexture($h,$A,$B),$$.addToAtlas($m,$A,$B),$D=!0,this._curAtlasIndex=$k;break;}}if($D)break;this._atlaserArray.push(new $jm(this._gridNumX,this._gridNumY,this._width,this._height,$c._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1;}return $D||console.log(">>>AtlasManager pushData error"),$D;},$m.addToAtlas=function($m){laya.webgl.atlas.AtlasResourceManager.instance.pushData($m);},$m.garbageCollection=function(){if(!0===this._needGC){for(var $m=this._atlaserArray.length-this._maxAtlaserCount,$p=0;$p<$m;$p++)this._atlaserArray[$p].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$m),this._atlaserArray.splice(0,$m),this._needGC=!1;}return!0;},$m.freeAll=function(){for(var $m=0,$p=this._atlaserArray.length;$m<$p;$m++)this._atlaserArray[$m].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0;},$m.getAtlaserCount=function(){return this._atlaserArray.length;},$m.getAtlaserByIndex=function($m){return this._atlaserArray[$m];},$P(1,$c,"instance",function(){return $c._Instance||($c._Instance=new $c(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$c._Instance;}),$P(1,$c,"enabled",function(){return $E.atlasEnable;}),$P(1,$c,"atlasLimitWidth",function(){return $c._atlasLimitWidth;},function($m){$c._atlasLimitWidth=$m;}),$P(1,$c,"atlasLimitHeight",function(){return $c._atlasLimitHeight;},function($m){$c._atlasLimitHeight=$m;}),$c._enable=function(){$E.atlasEnable=!0;},$c._disable=function(){$E.atlasEnable=!1;},$c.__init__=function(){$c.atlasTextureWidth=2048,$c.atlasTextureHeight=2048,$c.maxTextureCount=6,$c.atlasLimitWidth=512,$c.atlasLimitHeight=512;},$c._atlasLimitWidth=0,$c._atlasLimitHeight=0,$c.gridSize=16,$c.atlasTextureWidth=0,$c.atlasTextureHeight=0,$c.maxTextureCount=0,$c._atlasRestore=0,$c.BOARDER_TYPE_NO=0,$c.BOARDER_TYPE_RIGHT=1,$c.BOARDER_TYPE_LEFT=2,$c.BOARDER_TYPE_BOTTOM=4,$c.BOARDER_TYPE_TOP=8,$c.BOARDER_TYPE_ALL=15,$c._sid_=0,$c._Instance=null,$c;}(),$G=function(){function $m(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0;}return $R($m,"laya.webgl.atlas.MergeFillInfo"),$m;}(),$U=function(){function $p(){}return $R($p,"laya.webgl.canvas.BlendMode"),$p._init_=function($m){$p.fns=[$p.BlendNormal,$p.BlendAdd,$p.BlendMultiply,$p.BlendScreen,$p.BlendOverlay,$p.BlendLight,$p.BlendMask,$p.BlendDestinationOut],$p.targetFns=[$p.BlendNormalTarget,$p.BlendAddTarget,$p.BlendMultiplyTarget,$p.BlendScreenTarget,$p.BlendOverlayTarget,$p.BlendLightTarget,$p.BlendMask,$p.BlendDestinationOut];},$p.BlendNormal=function($m){$m.blendFunc(1,771);},$p.BlendAdd=function($m){$m.blendFunc(1,772);},$p.BlendMultiply=function($m){$m.blendFunc(774,771);},$p.BlendScreen=function($m){$m.blendFunc(1,1);},$p.BlendOverlay=function($m){$m.blendFunc(1,769);},$p.BlendLight=function($m){$m.blendFunc(1,1);},$p.BlendNormalTarget=function($m){$m.blendFunc(1,771);},$p.BlendAddTarget=function($m){$m.blendFunc(1,772);},$p.BlendMultiplyTarget=function($m){$m.blendFunc(774,771);},$p.BlendScreenTarget=function($m){$m.blendFunc(1,1);},$p.BlendOverlayTarget=function($m){$m.blendFunc(1,769);},$p.BlendLightTarget=function($m){$m.blendFunc(1,1);},$p.BlendMask=function($m){$m.blendFunc(0,770);},$p.BlendDestinationOut=function($m){$m.blendFunc(0,0);},$p.activeBlendFunction=null,$p.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$p.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$p.NORMAL="normal",$p.ADD="add",$p.MULTIPLY="multiply",$p.SCREEN="screen",$p.LIGHT="light",$p.OVERLAY="overlay",$p.DESTINATIONOUT="destination-out",$p.fns=[],$p.targetFns=[],$p;}(),$r=function(){function $h($m){this._color=$A.create("black"),this.setValue($m);}$R($h,"laya.webgl.canvas.DrawStyle");var $m=$h.prototype;return $m.setValue=function($m){if($m){if("string"==typeof $m)return void(this._color=$A.create($m));if($m instanceof laya.utils.Color)return void(this._color=$m);}},$m.reset=function(){this._color=$A.create("black");},$m.equal=function($m){return"string"==typeof $m?this._color.strColor===$m:$m instanceof laya.utils.Color&&this._color.numColor===$m.numColor;},$m.toColorStr=function(){return this._color.strColor;},$h.create=function($m){var $p;if($m&&("string"==typeof $m?$p=$A.create($m):$m instanceof laya.utils.Color&&($p=$m),$p))return $p._drawStyle||($p._drawStyle=new $h($m));return laya.webgl.canvas.DrawStyle.DEFAULT;},$k($h,["DEFAULT",function(){return this.DEFAULT=new $h("#000000");}]),$h;}(),$y=function(){function $m(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$Zm.mainContext;this.ib=$Om.create(35048),this.vb=$Cm.create(5);}$R($m,"laya.webgl.canvas.Path");var $p=$m.prototype;return $p.addPoint=function($m,$p){this.tempArray.push($m,$p);},$p.getEndPointX=function(){return this.tempArray[this.tempArray.length-2];},$p.getEndPointY=function(){return this.tempArray[this.tempArray.length-1];},$p.polygon=function($m,$p,$h,$P,$L,$q){var $k;return this.geomatrys.push(this._curGeomatry=$k=new $um($m,$p,$h,$P,$L,$q)),$P||($k.fill=!1),null==$q&&($k.borderWidth=0),$k;},$p.setGeomtry=function($m){this.geomatrys.push(this._curGeomatry=$m);},$p.drawLine=function($m,$p,$h,$P,$L){var $q;return this.closePath?this.geomatrys.push(this._curGeomatry=$q=new $Mm($m,$p,$h,$P,$L)):this.geomatrys.push(this._curGeomatry=$q=new $Qm($m,$p,$h,$P,$L)),$q.fill=!1,$q;},$p.update=function(){var $m=this.ib._byteLength,$p=this.geomatrys.length;this.offset=$m;for(var $h=this.geoStart;$h<$p;$h++)this.geomatrys[$h].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$p,this.count=(this.ib._byteLength-$m)/$Bm.BYTES_PIDX;},$p.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0;},$p.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null;},$m;}(),$V=function(){function $Y(){}$R($Y,"laya.webgl.canvas.save.SaveBase");var $m=$Y.prototype;return $W.imps($m,{"laya.webgl.canvas.save.ISaveData":!0}),$m.isSaveMark=function(){return!1;},$m.restore=function($m){this._dataObj[this._valueName]=this._value,($Y._cache[$Y._cache._length++]=this)._newSubmit&&($m._curSubmit=$qm.RENDERBASE,$m._renderKey=0);},$Y._createArray=function(){var $m=[];return $m._length=0,$m;},$Y._init=function(){var $m=$Y._namemap={};return $m[1]="ALPHA",$m[2]="fillStyle",$m[8]="font",$m[256]="lineWidth",$m[512]="strokeStyle",$m[8192]="_mergeID",$m[1024]=$m[2048]=$m[4096]=[],$m[16384]="textBaseline",$m[32768]="textAlign",$m[65536]="_nBlendType",$m[1048576]="shader",$m[2097152]="filters",$m;},$Y.save=function($m,$p,$h,$P){if(($m._saveMark._saveuse&$p)!==$p){$m._saveMark._saveuse|=$p;var $L=$Y._cache,$q=0<$L._length?$L[--$L._length]:new $Y();$q._value=$h[$q._valueName=$Y._namemap[$p]],$q._dataObj=$h,$q._newSubmit=$P;var $k=$m._save;$k[$k._length++]=$q;}},$Y._cache=laya.webgl.canvas.save.SaveBase._createArray(),$Y._namemap=$Y._init(),$Y;}(),$o=function(){function $q(){this._clipRect=new $j();}$R($q,"laya.webgl.canvas.save.SaveClipRect");var $m=$q.prototype;return $W.imps($m,{"laya.webgl.canvas.save.ISaveData":!0}),$m.isSaveMark=function(){return!1;},$m.restore=function($m){$m._clipRect=this._clipSaveRect,($q._cache[$q._cache._length++]=this)._submitScissor.submitLength=$m._submits._length-this._submitScissor.submitIndex,$m._curSubmit=$qm.RENDERBASE,$m._renderKey=0;},$q.save=function($m,$p){if(131072!=(131072&$m._saveMark._saveuse)){$m._saveMark._saveuse|=131072;var $h=$q._cache,$P=0<$h._length?$h[--$h._length]:new $q();$P._clipSaveRect=$m._clipRect,$m._clipRect=$P._clipRect.copyFrom($m._clipRect),$P._submitScissor=$p;var $L=$m._save;$L[$L._length++]=$P;}},$k($q,["_cache",function(){return this._cache=$V._createArray();}]),$q;}(),$f=function(){function $$(){this._contextX=0,this._contextY=0,this._clipRect=new $j(),this._rect=new $j(),this._matrix=new $b();}$R($$,"laya.webgl.canvas.save.SaveClipRectStencil");var $m=$$.prototype;return $W.imps($m,{"laya.webgl.canvas.save.ISaveData":!0}),$m.isSaveMark=function(){return!1;},$m.restore=function($m){$Dm.restore($m,this._rect,this._saveMatrix,this._contextX,this._contextY),$m._clipRect=this._clipSaveRect,$m._curMat=this._saveMatrix,$m._x=this._contextX,$m._y=this._contextY,$$._cache[$$._cache._length++]=this,$m._curSubmit=$qm.RENDERBASE;},$$.save=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){if(262144!=(262144&$m._saveMark._saveuse)){$m._saveMark._saveuse|=262144;var $D=$$._cache,$F=0<$D._length?$D[--$D._length]:new $$();$F._clipSaveRect=$m._clipRect,$F._clipRect.setTo($k,$Y,$d,$K),$m._clipRect=$F._clipRect,$F._rect.x=$h,$F._rect.y=$P,$F._rect.width=$L,$F._rect.height=$q,$F._contextX=$m._x,$F._contextY=$m._y,$F._saveMatrix=$m._curMat,$m._curMat.copyTo($F._matrix),$m._curMat=$F._matrix,$F._submitStencil=$p;var $R=$m._save;$R[$R._length++]=$F;}},$k($$,["_cache",function(){return this._cache=$V._createArray();}]),$$;}(),$i=function(){function $P(){this._saveuse=0;}$R($P,"laya.webgl.canvas.save.SaveMark");var $m=$P.prototype;return $W.imps($m,{"laya.webgl.canvas.save.ISaveData":!0}),$m.isSaveMark=function(){return!0;},$m.restore=function($m){$m._saveMark=this._preSaveMark,$P._no[$P._no._length++]=this;},$P.Create=function($m){var $p=$P._no,$h=0<$p._length?$p[--$p._length]:new $P();return $h._saveuse=0,$h._preSaveMark=$m._saveMark,$m._saveMark=$h;},$k($P,["_no",function(){return this._no=$V._createArray();}]),$P;}(),$v=function(){function $q(){this._matrix=new $b();}$R($q,"laya.webgl.canvas.save.SaveTransform");var $m=$q.prototype;return $W.imps($m,{"laya.webgl.canvas.save.ISaveData":!0}),$m.isSaveMark=function(){return!1;},$m.restore=function($m){$m._curMat=this._savematrix,$q._no[$q._no._length++]=this;},$q.save=function($m){var $p=$m._saveMark;if(2048!=(2048&$p._saveuse)){$p._saveuse|=2048;var $h=$q._no,$P=0<$h._length?$h[--$h._length]:new $q();$P._savematrix=$m._curMat,$m._curMat=$m._curMat.copyTo($P._matrix);var $L=$m._save;$L[$L._length++]=$P;}},$k($q,["_no",function(){return this._no=$V._createArray();}]),$q;}(),$g=function(){function $L(){}$R($L,"laya.webgl.canvas.save.SaveTranslate");var $m=$L.prototype;return $W.imps($m,{"laya.webgl.canvas.save.ISaveData":!0}),$m.isSaveMark=function(){return!1;},$m.restore=function($m){$m._curMat;$m._x=this._x,$m._y=this._y,$L._no[$L._no._length++]=this;},$L.save=function($m){var $p=$L._no,$h=0<$p._length?$p[--$p._length]:new $L();$h._x=$m._x,$h._y=$m._y;var $P=$m._save;$P[$P._length++]=$h;},$k($L,["_no",function(){return this._no=$V._createArray();}]),$L;}(),$t=function(){function $m(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $j();}$R($m,"laya.webgl.resource.RenderTargetMAX");var $p=$m.prototype;return $p.setSP=function($m){this._sp=$m;},$p.size=function($m,$p){var $h=this;this._width!==$m||this._height!==$p?(this.repaint=!0,this._width=$m,this._height=$p,this.target?this.target.size($m,$p):this.target=$Jm.create($m,$p),this.target.hasListener("recovered")||this.target.on("recovered",this,function($m){$W.timer.callLater($h._sp,$h._sp.repaint);})):this.target.size($m,$p);},$p._flushToTarget=function($m,$p){if(!$p._destroy){var $h=$em.worldScissorTest,$P=$em.worldClipRect;$em.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$em.worldScissorTest=!1,$Zm.mainContext.disable(3089);var $L=$em.worldAlpha,$q=$em.worldMatrix4,$k=$em.worldMatrix,$Y=$em.worldFilters,$d=$em.worldShaderDefines;if($em.worldMatrix=$b.EMPTY,$em.restoreTempArray(),$em.worldMatrix4=$em.TEMPMAT4_ARRAY,$em.worldAlpha=1,$em.worldFilters=null,$em.worldShaderDefines=null,$lm.activeShader=null,$p.start(),$E.showCanvasMark?$p.clear(0,1,0,.3):$p.clear(0,0,0,0),$m.flush(),$p.end(),$lm.activeShader=null,$em.worldAlpha=$L,$em.worldMatrix4=$q,$em.worldMatrix=$k,$em.worldFilters=$Y,$em.worldShaderDefines=$d,$em.worldScissorTest=$h){var $K=$em.height-$P.y-$P.height;$Zm.mainContext.scissor($P.x,$K,$P.width,$P.height),$Zm.mainContext.enable(3089);}$em.worldClipRect=$P;}},$p.flush=function($m){this.repaint&&(this._flushToTarget($m,this.target),this.repaint=!1);},$p.drawTo=function($m,$p,$h,$P,$L){$m.drawTexture(this.target.getTexture(),$p,$h,$P,$L,0,0);},$p.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null);},$m;}(),$O=function(){function $m(){this.ALPHA=1,this.shaderType=0,this.defines=new $xm();}return $R($m,"laya.webgl.shader.d2.Shader2D"),$m.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null;},$m.__init__=function(){var $m,$p;$im.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$im.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$im.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$im.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$im.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$im.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$im.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$im.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$m="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$p='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$im.preCompile2D(0,1,$m,$p,null),$m="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$p='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$im.preCompile2D(0,2,$m,$p,null),$m="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$p="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$im.preCompile2D(0,4,$m,$p,null),$m="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$p='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$im.preCompile2D(0,256,$m,$p,null),$m="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$p="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$im.preCompile2D(0,512,$m,$p,null);},$m;}(),$C=function(){function $p($m,$p,$h){this._value=0,this._name2int=$m,this._int2name=$p,this._int2nameMap=$h;}$R($p,"laya.webgl.shader.ShaderDefines");var $m=$p.prototype;return $m.add=function($m){return"string"==typeof $m&&($m=this._name2int[$m]),this._value|=$m,this._value;},$m.addInt=function($m){return this._value|=$m,this._value;},$m.remove=function($m){return"string"==typeof $m&&($m=this._name2int[$m]),this._value&=~$m,this._value;},$m.isDefine=function($m){return(this._value&$m)===$m;},$m.getValue=function(){return this._value;},$m.setValue=function($m){this._value=$m;},$m.toNameDic=function(){var $m=this._int2nameMap[this._value];return $m||$p._toText(this._value,this._int2name,this._int2nameMap);},$p._reg=function($m,$p,$h,$P){$P[$h[$m]=$p]=$m;},$p._toText=function($m,$p,$h){var $P=$h[$m];if($P)return $P;for(var $L={},$q=1,$k=0;$k<32&&!($m<($q=1<<$k));$k++)if($m&$q){var $Y=$p[$q];$Y&&($L[$Y]="");}return $h[$m]=$L;},$p._toInt=function($m,$p){for(var $h=$m.split("."),$P=0,$L=0,$q=$h.length;$L<$q;$L++){var $k=$p[$h[$L]];if(!$k)throw new Error("Defines to int err:"+$m+"/"+$h[$L]);$P|=$k;}return $P;},$p;}(),$mm=function(){function $k(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $b();}$R($k,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $m=$k.prototype;return $m.init=function($m,$p,$h){if($p)this._vs=$p;else{this._vs=[];var $P=$m.width,$L=$m.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($P,0,1,0,1,1,1,1),this._vs.push($P,$L,1,1,1,1,1,1),this._vs.push(0,$L,0,1,1,1,1,1);}$h?this._ps=$h:($k._defaultPS||($k._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$k._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$m;},$m.init2=function($m,$p,$h,$P,$L){this.transform&&(this.transform=null),$h?this._ps=$h:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$P,this._uvs=$L,this.mEleNum=this._ps.length,this.mTexture=$m,($c.isConchNode||$c.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs));},$m._initMyData=function(){var $m=0,$p=0,$h=4*this._verticles.length;this._vs=$k._tempVS;var $P=!1;if($c.isConchNode||$c.isConchApp?(this._vs.length=$h,$P=!0):this._vs.length<$h&&(this._vs.length=$h,$P=!0),$k._tVSLen=$h,$P)for(;$m<$h;)this._vs[$m]=this._verticles[$p],this._vs[$m+1]=this._verticles[$p+1],this._vs[$m+2]=this._uvs[$p],this._vs[$m+3]=this._uvs[$p+1],this._vs[$m+4]=1,this._vs[$m+5]=1,this._vs[$m+6]=1,this._vs[$m+7]=1,$m+=8,$p+=2;else for(;$m<$h;)this._vs[$m]=this._verticles[$p],this._vs[$m+1]=this._verticles[$p+1],this._vs[$m+2]=this._uvs[$p],this._vs[$m+3]=this._uvs[$p+1],$m+=8,$p+=2;},$m.getData2=function($m,$p,$h){var $P;this.mVBBuffer=$m,this.mIBBuffer=$p,this._initMyData(),$m.appendEx2(this._vs,Float32Array,$k._tVSLen,4),this._indexStart=$p._byteLength,($P=$k._tempIB).length<this._ps.length&&($P.length=this._ps.length);for(var $L=0,$q=this._ps.length;$L<$q;$L++)$P[$L]=this._ps[$L]+$h;$p.appendEx2($P,Uint16Array,this._ps.length,2);},$m.getData=function($m,$p,$h){if(this.mVBBuffer=$m,this.mIBBuffer=$p,$m.append(this.mVBData),this._indexStart=$p._byteLength,this.mIBData.start!=$h){for(var $P=0,$L=this._ps.length;$P<$L;$P++)this.mIBData[$P]=this._ps[$P]+$h;this.mIBData.start=$h;}$p.append(this.mIBData);},$m.render=function($m,$p,$h){if($c.isWebGL&&this.mTexture){$m._renderKey=0,$m._shader2D.glTexture=null,$pm.getInstance().addSkinMesh(this);var $P=$qm.createShape($m,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$Im.create(512,0));this.transform||(this.transform=$b.EMPTY),this.transform.translate($p,$h),$b.mul(this.transform,$m._curMat,this._tempMatrix),this.transform.translate(-$p,-$h);var $L=$P.shaderValue,$q=$L.u_mmat2||$em.getMatrArray();$em.mat2MatArray(this._tempMatrix,$q),$L.textureHost=this.mTexture,$L.offsetX=0,$L.offsetY=0,$L.u_mmat2=$q,$L.ALPHA=$m._shader2D.ALPHA,$m._submits[$m._submits._length++]=$P;}else $c.isConchApp&&this.mTexture&&(this.transform||(this.transform=$b.EMPTY),$m.setSkinMesh&&$m.setSkinMesh($p,$h,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform));},$k._tempVS=[],$k._tempIB=[],$k._defaultPS=null,$k._tVSLen=0,$k;}(),$pm=function(){function $m(){this.ib=null,this.vb=null;$Zm.mainContext;this.ib=$Om.create(35048),this.vb=$Cm.create(8);}$R($m,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $p=$m.prototype;return $p.addSkinMesh=function($m){$m.getData2(this.vb,this.ib,this.vb._byteLength/32);},$p.reset=function(){this.vb.clear(),this.ib.clear();},$m.getInstance=function(){return $m.instance=$m.instance||new $m();},$m.instance=null,$m;}(),$hm=function(){function $m($m,$p,$h,$P,$L,$q,$k,$Y,$d){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$d&&($d=0),this.x=$m,this.y=$p,this.width=$h,this.height=$P,this.edges=$L,this.color=$q,this.borderWidth=$k,this.borderColor=$Y;}$R($m,"laya.webgl.shapes.BasePoly");var $p=$m.prototype;return $W.imps($p,{"laya.webgl.shapes.IShape":!0}),$p.getData=function($m,$p,$h){},$p.rebuild=function($m){},$p.setMatrix=function($m){},$p.needUpdate=function($m){return!0;},$p.sector=function($m,$p,$h){var $P=this.x,$L=this.y,$q=this.edges,$k=(this.r1-this.r0)/$q,$Y=this.width,$d=this.height,$K=this.color,$D=($K>>16&255)/255,$F=($K>>8&255)/255,$R=(255&$K)/255;$m.push($P,$L,$D,$F,$R);for(var $$=0;$$<$q+1;$$++)$m.push($P+Math.sin($k*$$+this.r0)*$Y,$L+Math.cos($k*$$+this.r0)*$d),$m.push($D,$F,$R);for($$=0;$$<$q;$$++)$p.push($h,$h+$$+1,$h+$$+2);},$p.createLine2=function($m,$p,$h,$P,$L,$q){var $k,$Y,$d,$K,$D,$F,$R,$$,$A,$B,$n,$c,$e,$a,$Z,$H,$W,$E,$I,$b,$T=$m.concat(),$j=$L,$x=this.borderColor,$Q=($x>>16&255)/255,$M=($x>>8&255)/255,$u=(255&$x)/255,$N=$T.length/2,$S=$P,$_=$h/2;$d=$T[0],$K=$T[1],$B=$d-($D=$T[2]),$A=($A=-($K-($F=$T[3])))/($b=Math.sqrt($A*$A+$B*$B))*$_,$B=$B/$b*$_,$j.push($d-$A+this.x,$K-$B+this.y,$Q,$M,$u,$d+$A+this.x,$K+$B+this.y,$Q,$M,$u);for(var $l=1;$l<$N-1;$l++)$d=$T[2*($l-1)],$K=$T[2*($l-1)+1],$D=$T[2*$l],$F=$T[2*$l+1],$R=$T[2*($l+1)],$$=$T[2*($l+1)+1],$B=$d-$D,$c=$D-$R,$Z=(-($A=($A=-($K-$F))/($b=Math.sqrt($A*$A+$B*$B))*$_)+$d)*(-($B=$B/$b*$_)+$F)-(-$A+$D)*(-$B+$K),$E=(-($n=($n=-($F-$$))/($b=Math.sqrt($n*$n+$c*$c))*$_)+$R)*(-($c=$c/$b*$_)+$F)-(-$n+$D)*(-$c+$$),$I=($e=-$B+$K-(-$B+$F))*($W=-$n+$D-(-$n+$R))-($H=-$c+$$-(-$c+$F))*($a=-$A+$D-(-$A+$d)),Math.abs($I)<.1?($I+=10.1,$j.push($D-$A+this.x,$F-$B+this.y,$Q,$M,$u,$D+$A+this.x,$F+$B+this.y,$Q,$M,$u)):((($k=($a*$E-$W*$Z)/$I)-$D)*($k-$D)+(($Y=($H*$Z-$e*$E)/$I)-$F)+($Y-$F),$j.push($k+this.x,$Y+this.y,$Q,$M,$u,$D-($k-$D)+this.x,$F-($Y-$F)+this.y,$Q,$M,$u));$d=$T[$T.length-4],$K=$T[$T.length-3],$B=$d-($D=$T[$T.length-2]),$A=($A=-($K-($F=$T[$T.length-1])))/($b=Math.sqrt($A*$A+$B*$B))*$_,$B=$B/$b*$_,$j.push($D-$A+this.x,$F-$B+this.y,$Q,$M,$u,$D+$A+this.x,$F+$B+this.y,$Q,$M,$u);var $J=$q;for($l=1;$l<$J;$l++)$p.push($S+2*($l-1),$S+2*($l-1)+1,$S+2*$l+1,$S+2*$l+1,$S+2*$l,$S+2*($l-1));return $j;},$p.createLine=function($m,$p,$h,$P){var $L=$m.concat(),$q=$m,$k=this.borderColor,$Y=($k>>16&255)/255,$d=($k>>8&255)/255,$K=(255&$k)/255;$L.splice(0,5);var $D,$F,$R,$$,$A,$B,$n,$c,$e,$a,$Z,$H,$W,$E,$I,$b,$T,$j,$x,$Q,$M=$L.length/5,$u=$P,$N=$h/2;$R=$L[0],$$=$L[1],$a=$R-($A=$L[5]),$e=($e=-($$-($B=$L[6])))/($Q=Math.sqrt($e*$e+$a*$a))*$N,$a=$a/$Q*$N,$q.push($R-$e,$$-$a,$Y,$d,$K,$R+$e,$$+$a,$Y,$d,$K);for(var $S=1;$S<$M-1;$S++)$R=$L[5*($S-1)],$$=$L[5*($S-1)+1],$A=$L[5*$S],$B=$L[5*$S+1],$n=$L[5*($S+1)],$c=$L[5*($S+1)+1],$a=$R-$A,$H=$A-$n,$I=(-($e=($e=-($$-$B))/($Q=Math.sqrt($e*$e+$a*$a))*$N)+$R)*(-($a=$a/$Q*$N)+$B)-(-$e+$A)*(-$a+$$),$j=(-($Z=($Z=-($B-$c))/($Q=Math.sqrt($Z*$Z+$H*$H))*$N)+$n)*(-($H=$H/$Q*$N)+$B)-(-$Z+$A)*(-$H+$c),$x=($W=-$a+$$-(-$a+$B))*($T=-$Z+$A-(-$Z+$n))-($b=-$H+$c-(-$H+$B))*($E=-$e+$A-(-$e+$R)),Math.abs($x)<.1?($x+=10.1,$q.push($A-$e,$B-$a,$Y,$d,$K,$A+$e,$B+$a,$Y,$d,$K)):((($D=($E*$j-$T*$I)/$x)-$A)*($D-$A)+(($F=($b*$I-$W*$j)/$x)-$B)+($F-$B),$q.push($D,$F,$Y,$d,$K,$A-($D-$A),$B-($F-$B),$Y,$d,$K));$R=$L[$L.length-10],$$=$L[$L.length-9],$a=$R-($A=$L[$L.length-5]),$e=($e=-($$-($B=$L[$L.length-4])))/($Q=Math.sqrt($e*$e+$a*$a))*$N,$a=$a/$Q*$N,$q.push($A-$e,$B-$a,$Y,$d,$K,$A+$e,$B+$a,$Y,$d,$K);var $_=this.edges+1;for($S=1;$S<$_;$S++)$p.push($u+2*($S-1),$u+2*($S-1)+1,$u+2*$S+1,$u+2*$S+1,$u+2*$S,$u+2*($S-1));return $q;},$p.createLoopLine=function($m,$p,$h,$P,$L,$q){var $k=$m.concat(),$Y=$L||$m,$d=this.borderColor,$K=($d>>16&255)/255,$D=($d>>8&255)/255,$F=(255&$d)/255;$k.splice(0,5);var $R=[$k[0],$k[1]],$$=[$k[$k.length-5],$k[$k.length-4]],$A=$$[0]+.5*($R[0]-$$[0]),$B=$$[1]+.5*($R[1]-$$[1]);$k.unshift($A,$B,0,0,0),$k.push($A,$B,0,0,0);var $n,$c,$e,$a,$Z,$H,$W,$E,$I,$b,$T,$j,$x,$Q,$M,$u,$N,$S,$_,$l,$J=$k.length/5,$z=$P,$w=$h/2;$e=$k[0],$a=$k[1],$b=$e-($Z=$k[5]),$I=($I=-($a-($H=$k[6])))/($l=Math.sqrt($I*$I+$b*$b))*$w,$b=$b/$l*$w,$Y.push($e-$I,$a-$b,$K,$D,$F,$e+$I,$a+$b,$K,$D,$F);for(var $X=1;$X<$J-1;$X++)$e=$k[5*($X-1)],$a=$k[5*($X-1)+1],$Z=$k[5*$X],$H=$k[5*$X+1],$W=$k[5*($X+1)],$E=$k[5*($X+1)+1],$b=$e-$Z,$j=$Z-$W,$M=(-($I=($I=-($a-$H))/($l=Math.sqrt($I*$I+$b*$b))*$w)+$e)*(-($b=$b/$l*$w)+$H)-(-$I+$Z)*(-$b+$a),$S=(-($T=($T=-($H-$E))/($l=Math.sqrt($T*$T+$j*$j))*$w)+$W)*(-($j=$j/$l*$w)+$H)-(-$T+$Z)*(-$j+$E),$_=($x=-$b+$a-(-$b+$H))*($N=-$T+$Z-(-$T+$W))-($u=-$j+$E-(-$j+$H))*($Q=-$I+$Z-(-$I+$e)),Math.abs($_)<.1?($_+=10.1,$Y.push($Z-$I,$H-$b,$K,$D,$F,$Z+$I,$H+$b,$K,$D,$F)):((($n=($Q*$S-$N*$M)/$_)-$Z)*($n-$Z)+(($c=($u*$M-$x*$S)/$_)-$H)+($c-$H),$Y.push($n,$c,$K,$D,$F,$Z-($n-$Z),$H-($c-$H),$K,$D,$F));$q&&($p=$q);var $s=this.edges+1;for($X=1;$X<$s;$X++)$p.push($z+2*($X-1),$z+2*($X-1)+1,$z+2*$X+1,$z+2*$X+1,$z+2*$X,$z+2*($X-1));return $p.push($z+2*($X-1),$z+2*($X-1)+1,$z+1,$z+1,$z,$z+2*($X-1)),$Y;},$m;}(),$Pm=function(){function $B(){}return $R($B,"laya.webgl.shapes.Earcut"),$B.earcut=function($m,$p,$h){$h=$h||2;var $P,$L,$q,$k,$Y,$d,$K,$D=$p&&$p.length,$F=$D?$p[0]*$h:$m.length,$R=$B.linkedList($m,0,$F,$h,!0),$$=[];if(!$R)return $$;if($D&&($R=$B.eliminateHoles($m,$p,$R,$h)),$m.length>80*$h){$P=$q=$m[0],$L=$k=$m[1];for(var $A=$h;$A<$F;$A+=$h)($Y=$m[$A])<$P&&($P=$Y),($d=$m[$A+1])<$L&&($L=$d),$q<$Y&&($q=$Y),$k<$d&&($k=$d);$K=0!==($K=Math.max($q-$P,$k-$L))?1/$K:0;}return $B.earcutLinked($R,$$,$h,$P,$L,$K),$$;},$B.linkedList=function($m,$p,$h,$P,$L){var $q,$k;if($L===0<$B.signedArea($m,$p,$h,$P))for($q=$p;$q<$h;$q+=$P)$k=$B.insertNode($q,$m[$q],$m[$q+1],$k);else for($q=$h-$P;$p<=$q;$q-=$P)$k=$B.insertNode($q,$m[$q],$m[$q+1],$k);return $k&&$B.equals($k,$k.next)&&($B.removeNode($k),$k=$k.next),$k;},$B.filterPoints=function($m,$p){if(!$m)return $m;$p||($p=$m);var $h,$P=$m;do{if($h=!1,$P.steiner||!$B.equals($P,$P.next)&&0!==$B.area($P.prev,$P,$P.next))$P=$P.next;else{if($B.removeNode($P),($P=$p=$P.prev)===$P.next)break;$h=!0;}}while($h||$P!==$p);return $p;},$B.earcutLinked=function($m,$p,$h,$P,$L,$q,$k){if($m){!$k&&$q&&$B.indexCurve($m,$P,$L,$q);for(var $Y,$d,$K=$m;$m.prev!==$m.next;)if($Y=$m.prev,$d=$m.next,$q?$B.isEarHashed($m,$P,$L,$q):$B.isEar($m))$p.push($Y.i/$h),$p.push($m.i/$h),$p.push($d.i/$h),$B.removeNode($m),$m=$d.next,$K=$d.next;else if(($m=$d)===$K){$k?1===$k?($m=$B.cureLocalIntersections($m,$p,$h),$B.earcutLinked($m,$p,$h,$P,$L,$q,2)):2===$k&&$B.splitEarcut($m,$p,$h,$P,$L,$q):$B.earcutLinked($B.filterPoints($m,null),$p,$h,$P,$L,$q,1);break;}}},$B.isEar=function($m){var $p=$m.prev,$h=$m,$P=$m.next;if(0<=$B.area($p,$h,$P))return!1;for(var $L=$m.next.next;$L!==$m.prev;){if($B.pointInTriangle($p.x,$p.y,$h.x,$h.y,$P.x,$P.y,$L.x,$L.y)&&0<=$B.area($L.prev,$L,$L.next))return!1;$L=$L.next;}return!0;},$B.isEarHashed=function($m,$p,$h,$P){var $L=$m.prev,$q=$m,$k=$m.next;if(0<=$B.area($L,$q,$k))return!1;for(var $Y=$L.x<$q.x?$L.x<$k.x?$L.x:$k.x:$q.x<$k.x?$q.x:$k.x,$d=$L.y<$q.y?$L.y<$k.y?$L.y:$k.y:$q.y<$k.y?$q.y:$k.y,$K=$L.x>$q.x?$L.x>$k.x?$L.x:$k.x:$q.x>$k.x?$q.x:$k.x,$D=$L.y>$q.y?$L.y>$k.y?$L.y:$k.y:$q.y>$k.y?$q.y:$k.y,$F=$B.zOrder($Y,$d,$p,$h,$P),$R=$B.zOrder($K,$D,$p,$h,$P),$$=$m.nextZ;$$&&$$.z<=$R;){if($$!==$m.prev&&$$!==$m.next&&$B.pointInTriangle($L.x,$L.y,$q.x,$q.y,$k.x,$k.y,$$.x,$$.y)&&0<=$B.area($$.prev,$$,$$.next))return!1;$$=$$.nextZ;}for($$=$m.prevZ;$$&&$$.z>=$F;){if($$!==$m.prev&&$$!==$m.next&&$B.pointInTriangle($L.x,$L.y,$q.x,$q.y,$k.x,$k.y,$$.x,$$.y)&&0<=$B.area($$.prev,$$,$$.next))return!1;$$=$$.prevZ;}return!0;},$B.cureLocalIntersections=function($m,$p,$h){var $P=$m;do{var $L=$P.prev,$q=$P.next.next;!$B.equals($L,$q)&&$B.intersects($L,$P,$P.next,$q)&&$B.locallyInside($L,$q)&&$B.locallyInside($q,$L)&&($p.push($L.i/$h),$p.push($P.i/$h),$p.push($q.i/$h),$B.removeNode($P),$B.removeNode($P.next),$P=$m=$q),$P=$P.next;}while($P!==$m);return $P;},$B.splitEarcut=function($m,$p,$h,$P,$L,$q){var $k=$m;do{for(var $Y=$k.next.next;$Y!==$k.prev;){if($k.i!==$Y.i&&$B.isValidDiagonal($k,$Y)){var $d=$B.splitPolygon($k,$Y);return $k=$B.filterPoints($k,$k.next),$d=$B.filterPoints($d,$d.next),$B.earcutLinked($k,$p,$h,$P,$L,$q),void $B.earcutLinked($d,$p,$h,$P,$L,$q);}$Y=$Y.next;}$k=$k.next;}while($k!==$m);},$B.eliminateHoles=function($m,$p,$h,$P){var $L,$q,$k,$Y,$d,$K=[];for($L=0,$q=$p.length;$L<$q;$L++)$k=$p[$L]*$P,$Y=$L<$q-1?$p[$L+1]*$P:$m.length,($d=$B.linkedList($m,$k,$Y,$P,!1))===$d.next&&($d.steiner=!0),$K.push($B.getLeftmost($d));for($K.sort($B.compareX),$L=0;$L<$K.length;$L++)$B.eliminateHole($K[$L],$h),$h=$B.filterPoints($h,$h.next);return $h;},$B.compareX=function($m,$p){return $m.x-$p.x;},$B.eliminateHole=function($m,$p){if($p=$B.findHoleBridge($m,$p)){var $h=$B.splitPolygon($p,$m);$B.filterPoints($h,$h.next);}},$B.findHoleBridge=function($m,$p){var $h,$P=$p,$L=$m.x,$q=$m.y,$k=-1/0;do{if($q<=$P.y&&$q>=$P.next.y&&$P.next.y!==$P.y){var $Y=$P.x+($q-$P.y)*($P.next.x-$P.x)/($P.next.y-$P.y);if($Y<=$L&&$k<$Y){if(($k=$Y)===$L){if($q===$P.y)return $P;if($q===$P.next.y)return $P.next;}$h=$P.x<$P.next.x?$P:$P.next;}}$P=$P.next;}while($P!==$p);if(!$h)return null;if($L===$k)return $h.prev;var $d,$K=$h,$D=$h.x,$F=$h.y,$R=1/0;for($P=$h.next;$P!==$K;)$L>=$P.x&&$P.x>=$D&&$L!==$P.x&&$B.pointInTriangle($q<$F?$L:$k,$q,$D,$F,$q<$F?$k:$L,$q,$P.x,$P.y)&&(($d=Math.abs($q-$P.y)/($L-$P.x))<$R||$d===$R&&$P.x>$h.x)&&$B.locallyInside($P,$m)&&($h=$P,$R=$d),$P=$P.next;return $h;},$B.indexCurve=function($m,$p,$h,$P){for(var $L=$m;null===$L.z&&($L.z=$B.zOrder($L.x,$L.y,$p,$h,$P)),$L.prevZ=$L.prev,$L.nextZ=$L.next,($L=$L.next)!==$m;);$L.prevZ.nextZ=null,$L.prevZ=null,$B.sortLinked($L);},$B.sortLinked=function($m){var $p,$h,$P,$L,$q,$k,$Y,$d,$K=1;do{for($h=$m,$q=$m=null,$k=0;$h;){for($k++,$P=$h,$p=$Y=0;$p<$K&&($Y++,$P=$P.nextZ);$p++);for($d=$K;0<$Y||0<$d&&$P;)0!==$Y&&(0===$d||!$P||$h.z<=$P.z)?($h=($L=$h).nextZ,$Y--):($P=($L=$P).nextZ,$d--),$q?$q.nextZ=$L:$m=$L,$L.prevZ=$q,$q=$L;$h=$P;}$q.nextZ=null,$K*=2;}while(1<$k);return $m;},$B.zOrder=function($m,$p,$h,$P,$L){return($m=1431655765&(($m=858993459&(($m=252645135&(($m=16711935&(($m=32767*($m-$h)*$L)|$m<<8))|$m<<4))|$m<<2))|$m<<1))|($p=1431655765&(($p=858993459&(($p=252645135&(($p=16711935&(($p=32767*($p-$P)*$L)|$p<<8))|$p<<4))|$p<<2))|$p<<1))<<1;},$B.getLeftmost=function($m){for(var $p=$m,$h=$m;$p.x<$h.x&&($h=$p),($p=$p.next)!==$m;);return $h;},$B.pointInTriangle=function($m,$p,$h,$P,$L,$q,$k,$Y){return 0<=($L-$k)*($p-$Y)-($m-$k)*($q-$Y)&&0<=($m-$k)*($P-$Y)-($h-$k)*($p-$Y)&&0<=($h-$k)*($q-$Y)-($L-$k)*($P-$Y);},$B.isValidDiagonal=function($m,$p){return $m.next.i!==$p.i&&$m.prev.i!==$p.i&&!$B.intersectsPolygon($m,$p)&&$B.locallyInside($m,$p)&&$B.locallyInside($p,$m)&&$B.middleInside($m,$p);},$B.area=function($m,$p,$h){return($p.y-$m.y)*($h.x-$p.x)-($p.x-$m.x)*($h.y-$p.y);},$B.equals=function($m,$p){return $m.x===$p.x&&$m.y===$p.y;},$B.intersects=function($m,$p,$h,$P){return!!($B.equals($m,$p)&&$B.equals($h,$P)||$B.equals($m,$P)&&$B.equals($h,$p))||0<$B.area($m,$p,$h)!=0<$B.area($m,$p,$P)&&0<$B.area($h,$P,$m)!=0<$B.area($h,$P,$p);},$B.intersectsPolygon=function($m,$p){var $h=$m;do{if($h.i!==$m.i&&$h.next.i!==$m.i&&$h.i!==$p.i&&$h.next.i!==$p.i&&$B.intersects($h,$h.next,$m,$p))return!0;$h=$h.next;}while($h!==$m);return!1;},$B.locallyInside=function($m,$p){return $B.area($m.prev,$m,$m.next)<0?0<=$B.area($m,$p,$m.next)&&0<=$B.area($m,$m.prev,$p):$B.area($m,$p,$m.prev)<0||$B.area($m,$m.next,$p)<0;},$B.middleInside=function($m,$p){for(var $h=$m,$P=!1,$L=($m.x+$p.x)/2,$q=($m.y+$p.y)/2;$h.y>$q!=$h.next.y>$q&&$h.next.y!==$h.y&&$L<($h.next.x-$h.x)*($q-$h.y)/($h.next.y-$h.y)+$h.x&&($P=!$P),($h=$h.next)!==$m;);return $P;},$B.splitPolygon=function($m,$p){var $h=new $Lm($m.i,$m.x,$m.y),$P=new $Lm($p.i,$p.x,$p.y),$L=$m.next,$q=$p.prev;return($m.next=$p).prev=$m,($h.next=$L).prev=$h,($P.next=$h).prev=$P,($q.next=$P).prev=$q,$P;},$B.insertNode=function($m,$p,$h,$P){var $L=new $Lm($m,$p,$h);return $P?($L.next=$P.next,($L.prev=$P).next.prev=$L,$P.next=$L):($L.prev=$L).next=$L,$L;},$B.removeNode=function($m){$m.next.prev=$m.prev,$m.prev.next=$m.next,$m.prevZ&&($m.prevZ.nextZ=$m.nextZ),$m.nextZ&&($m.nextZ.prevZ=$m.prevZ);},$B.signedArea=function($m,$p,$h,$P){for(var $L=0,$q=$p,$k=$h-$P;$q<$h;$q+=$P)$L+=($m[$k]-$m[$q])*($m[$q+1]+$m[$k+1]),$k=$q;return $L;},$B;}(),$Lm=function(){function $m($m,$p,$h){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$m,this.x=$p,this.y=$h,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}return $R($m,"laya.webgl.shapes.EarcutNode"),$m;}(),$qm=(function(){function $m($m,$p,$h,$P,$L,$q,$k){this.lineWidth=$m,this.lineColor=$p,this.lineAlpha=$h,this.fillColor=$P,this.fillAlpha=$L,this.shape=$k,this.fill=$q;}$R($m,"laya.webgl.shapes.GeometryData");var $p=$m.prototype;$p.clone=function(){return new $m(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape);},$p.getIndexData=function(){return null;},$p.getVertexData=function(){return null;},$p.destroy=function(){this.shape=null;};}(),function(){function $m($m){if($m instanceof Float32Array)this.points=$m;else if($m instanceof Array){$m.length;this.points=new Float32Array($m);}}$R($m,"laya.webgl.shapes.Vertex");var $p=$m.prototype;$W.imps($p,{"laya.webgl.shapes.IShape":!0}),$p.getData=function($m,$p,$h){},$p.needUpdate=function($m){return!1;},$p.rebuild=function($m){},$p.setMatrix=function($m){};}(),function(){function $d($m){void 0===$m&&($m=1e4),this._renderType=$m;}$R($d,"laya.webgl.submit.Submit");var $m=$d.prototype;return $W.imps($m,{"laya.webgl.submit.ISubmit":!0}),$m.releaseRender=function(){var $m=$d._cache;($m[$m._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null;},$m.getRenderType=function(){return this._renderType;},$m.renderSubmit=function(){if(0===this._numEle)return 1;var $m=this.shaderValue.textureHost;if($m){var $p=$m.source;if(!$m.bitmap||!$p)return 1;this.shaderValue.texture=$p,$m.alphaTexture&&$m.alphaTexture.source&&(this.shaderValue.texture1=$m.alphaTexture.source);}this._vb.bind_upload(this._ib);var $h=$Zm.mainContext;return this.shaderValue.upload(),$U.activeBlendFunction!==this._blendFn&&($h.enable(3042),this._blendFn($h),$U.activeBlendFunction=this._blendFn),$M.drawCall++,$M.trianglesFaces+=this._numEle/3,$h.drawElements(4,this._numEle,5123,this._startIdx),1;},$d.__init__=function(){var $m=$d.RENDERBASE=new $d(-1);$m.shaderValue=new $Im(0,0),$m.shaderValue.ALPHA=-1234;},$d.createSubmit=function($m,$p,$h,$P,$L){var $q=$d._cache._length?$d._cache[--$d._cache._length]:new $d();null==$h&&(($h=$q._selfVb||($q._selfVb=$Cm.create(-1))).clear(),$P=0),$q._ib=$p,$q._vb=$h,$q._startIdx=$P*$Bm.BYTES_PIDX,$q._numEle=0;var $k=$m._nBlendType;$q._blendFn=$m._targets?$U.targetFns[$k]:$U.fns[$k],$q.shaderValue=$L,$q.shaderValue.setValue($m._shader2D);var $Y=$m._shader2D.filters;return $Y&&$q.shaderValue.setFilters($Y),$q;},$d.createShape=function($m,$p,$h,$P,$L,$q){var $k=$d._cache._length?$d._cache[--$d._cache._length]:new $d();$k._ib=$p,$k._vb=$h,$k._numEle=$P,$k._startIdx=$L,$k.shaderValue=$q,$k.shaderValue.setValue($m._shader2D);var $Y=$m._nBlendType;return $k._blendFn=$m._targets?$U.targetFns[$Y]:$U.fns[$Y],$k;},$d.TYPE_2D=1e4,$d.TYPE_CANVAS=10003,$d.TYPE_CMDSETRT=10004,$d.TYPE_CUSTOM=10005,$d.TYPE_BLURRT=10006,$d.TYPE_CMDDESTORYPRERT=10007,$d.TYPE_DISABLESTENCIL=10008,$d.TYPE_OTHERIBVB=10009,$d.TYPE_PRIMITIVE=10010,$d.TYPE_RT=10011,$d.TYPE_BLUR_RT=10012,$d.TYPE_TARGET=10013,$d.TYPE_CHANGE_VALUE=10014,$d.TYPE_SHAPE=10015,$d.TYPE_TEXTURE=10016,$d.TYPE_FILLTEXTURE=10017,$d.RENDERBASE=null,$d._cache=(($d._cache=[])._length=0,$d._cache),$d;}()),$km=function(){function $P(){this.fun=null,this.args=null;}$R($P,"laya.webgl.submit.SubmitCMD");var $m=$P.prototype;return $W.imps($m,{"laya.webgl.submit.ISubmit":!0}),$m.renderSubmit=function(){return this.fun.apply(null,this.args),1;},$m.getRenderType=function(){return 0;},$m.releaseRender=function(){var $m=$P._cache;$m[$m._length++]=this;},$P.create=function($m,$p){var $h=$P._cache._length?$P._cache[--$P._cache._length]:new $P();return $h.fun=$p,$h.args=$m,$h;},$P._cache=(($P._cache=[])._length=0,$P._cache),$P;}(),$Ym=function(){function $p(){this.variables={};}$R($p,"laya.webgl.submit.SubmitCMDScope");var $m=$p.prototype;return $m.getValue=function($m){return this.variables[$m];},$m.addValue=function($m,$p){return this.variables[$m]=$p;},$m.setValue=function($m,$p){return this.variables.hasOwnProperty($m)?this.variables[$m]=$p:null;},$m.clear=function(){for(var $m in this.variables)delete this.variables[$m];},$m.recycle=function(){this.clear(),$p.POOL.push(this);},$p.create=function(){var $m=$p.POOL.pop();return $m||($m=new $p()),$m;},$p.POOL=[],$p;}(),$dm=function(){function $F(){this.offset=0,this.startIndex=0,this._mat=$b.create();}$R($F,"laya.webgl.submit.SubmitOtherIBVB");var $m=$F.prototype;return $W.imps($m,{"laya.webgl.submit.ISubmit":!0}),$m.releaseRender=function(){var $m=$F._cache;($m[$m._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null;},$m.getRenderType=function(){return 10009;},$m.renderSubmit=function(){var $m=this._shaderValue.textureHost;if($m){var $p=$m.source;if(!$m.bitmap||!$p)return 1;this._shaderValue.texture=$p;}this._vb.bind_upload(this._ib);var $h=$em.worldMatrix4,$P=$b.TEMP;$b.mulPre(this._mat,$h[0],$h[1],$h[4],$h[5],$h[12],$h[13],$P);var $L=$em.worldMatrix4=$F.tempMatrix4;$L[0]=$P.a,$L[1]=$P.b,$L[4]=$P.c,$L[5]=$P.d,$L[12]=$P.tx,$L[13]=$P.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $q=$Zm.mainContext;return $U.activeBlendFunction!==this._blendFn&&($q.enable(3042),this._blendFn($q),$U.activeBlendFunction=this._blendFn),$M.drawCall++,$M.trianglesFaces+=this._numEle/3,$q.drawElements(4,this._numEle,5123,this.startIndex),$em.worldMatrix4=$h,$lm.activeShader=null,1;},$F.create=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){void 0===$d&&($d=0);var $K=$F._cache._length?$F._cache[--$F._cache._length]:new $F();$K._ib=$h,$K._vb=$p,$K._numEle=$P,$K._shader=$L,$K._shaderValue=$q;var $D=$m._nBlendType;switch($K._blendFn=$m._targets?$U.targetFns[$D]:$U.fns[$D],$d){case 0:$K.offset=0,$K.startIndex=$Y/($Bm.BYTES_PE*$p.vertexStride)*1.5,$K.startIndex*=$Bm.BYTES_PIDX;break;case 1:$K.startIndex=$k,$K.offset=$Y;}return $K;},$F._cache=(($F._cache=[])._length=0,$F._cache),$F.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$F;}(),$Km=function(){function $h(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $j(),this.screenRect=new $j();}$R($h,"laya.webgl.submit.SubmitScissor");var $m=$h.prototype;return $W.imps($m,{"laya.webgl.submit.ISubmit":!0}),$m._scissor=function($m,$p,$h,$P){var $L=$em.worldMatrix4,$q=$L[0],$k=$L[5],$Y=$L[12],$d=$L[13];if($P*=$k,($h*=$q)<1||$P<1)return!1;var $K=($m=$m*$q+$Y)+$h,$D=($p=$p*$k+$d)+$P;$m<0&&($h=$K-($m=0)),$p<0&&($P=$D-($p=0));var $F=$em.worldClipRect;if($m=Math.max($m,$F.x),$p=Math.max($p,$F.y),$h=Math.min($K,$F.right)-$m,$P=Math.min($D,$F.bottom)-$p,$h<1||$P<1)return!1;var $R=$em.worldScissorTest;return this.screenRect.copyFrom($F),$F.x=$m,$F.y=$p,$F.width=$h,$F.height=$P,$em.worldScissorTest=!0,$p=$em.height-$p-$P,$Zm.mainContext.scissor($m,$p,$h,$P),$Zm.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$R?($p=$em.height-this.screenRect.y-this.screenRect.height,$Zm.mainContext.scissor(this.screenRect.x,$p,this.screenRect.width,this.screenRect.height),$Zm.mainContext.enable(3089)):($Zm.mainContext.disable(3089),$em.worldScissorTest=!1),$F.copyFrom(this.screenRect),!0;},$m._scissorWithTagart=function($m,$p,$h,$P){if($h<1||$P<1)return!1;var $L=$m+$h,$q=$p+$P;$m<0&&($h=$L-($m=0)),$p<0&&($P=$q-($p=0));var $k=$em.worldClipRect;if($m=Math.max($m,$k.x),$p=Math.max($p,$k.y),$h=Math.min($L,$k.right)-$m,$P=Math.min($q,$k.bottom)-$p,$h<1||$P<1)return!1;var $Y=$em.worldScissorTest;return this.screenRect.copyFrom($k),$em.worldScissorTest=!0,$k.x=$m,$k.y=$p,$k.width=$h,$k.height=$P,$p=$em.height-$p-$P,$Zm.mainContext.scissor($m,$p,$h,$P),$Zm.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$Y?($p=$em.height-this.screenRect.y-this.screenRect.height,$Zm.mainContext.scissor(this.screenRect.x,$p,this.screenRect.width,this.screenRect.height),$Zm.mainContext.enable(3089)):($Zm.mainContext.disable(3089),$em.worldScissorTest=!1),$k.copyFrom(this.screenRect),!0;},$m.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1;},$m.getRenderType=function(){return 0;},$m.releaseRender=function(){var $m=$h._cache;($m[$m._length++]=this).context=null;},$h.create=function($m){var $p=$h._cache._length?$h._cache[--$h._cache._length]:new $h();return $p.context=$m,$p;},$h._cache=(($h._cache=[])._length=0,$h._cache),$h;}(),$Dm=function(){function $d(){this.step=0,this.blendMode=null,this.level=0;}$R($d,"laya.webgl.submit.SubmitStencil");var $m=$d.prototype;return $W.imps($m,{"laya.webgl.submit.ISubmit":!0}),$m.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8();}return 1;},$m.getRenderType=function(){return 0;},$m.releaseRender=function(){var $m=$d._cache;$m[$m._length++]=this;},$m.do1=function(){var $m=$Zm.mainContext;$m.enable(2960),$m.clear(1024),$m.colorMask(!1,!1,!1,!1),$m.stencilFunc(514,this.level,255),$m.stencilOp(7680,7680,7682);},$m.do2=function(){var $m=$Zm.mainContext;$m.stencilFunc(514,this.level+1,255),$m.colorMask(!0,!0,!0,!0),$m.stencilOp(7680,7680,7680);},$m.do3=function(){var $m=$Zm.mainContext;$m.colorMask(!0,!0,!0,!0),$m.stencilOp(7680,7680,7680),$m.clear(1024),$m.disable(2960);},$m.do4=function(){var $m=$Zm.mainContext;0==this.level&&($m.enable(2960),$m.clear(1024)),$m.colorMask(!1,!1,!1,!1),$m.stencilFunc(519,0,255),$m.stencilOp(7680,7680,7682);},$m.do5=function(){var $m=$Zm.mainContext;$m.stencilFunc(514,this.level,255),$m.colorMask(!0,!0,!0,!0),$m.stencilOp(7680,7680,7680);},$m.do6=function(){var $m=$Zm.mainContext;$U.targetFns[$U.TOINT[this.blendMode]]($m);},$m.do7=function(){var $m=$Zm.mainContext;$m.colorMask(!1,!1,!1,!1),$m.stencilOp(7680,7680,7683);},$m.do8=function(){var $m=$Zm.mainContext;$m.colorMask(!0,!0,!0,!0),$m.stencilFunc(514,this.level,255),$m.stencilOp(7680,7680,7680);},$d.restore=function($m,$p,$h,$P,$L){var $q;if(($m._renderKey=0)<$d._mask&&$d._mask--,0==$d._mask)$q=laya.webgl.submit.SubmitStencil.create(3),$m.addRenderObject($q),$m._curSubmit=$qm.RENDERBASE;else{$q=laya.webgl.submit.SubmitStencil.create(7),$m.addRenderObject($q);var $k=$m._vb;$k._byteLength;if($nm.fillRectImgVb($k,null,$p.x,$p.y,$p.width,$p.height,$_.DEF_UV,$h,$P,$L,0,0)){$m._shader2D.glTexture=null;var $Y=$m._curSubmit=$qm.createSubmit($m,$m._ib,$k,($k._byteLength-64)/32*3,$Im.create(2,0));$Y.shaderValue.ALPHA=1,$m._submits[$m._submits._length++]=$Y,$m._curSubmit._numEle+=6,$m._curSubmit=$qm.RENDERBASE;}else alert("clipRect calc stencil rect error");$q=laya.webgl.submit.SubmitStencil.create(8),$m.addRenderObject($q);}},$d.restore2=function($m,$p){var $h;($m._renderKey=0)<$d._mask&&$d._mask--,0==$d._mask?($h=laya.webgl.submit.SubmitStencil.create(3),$m.addRenderObject($h),$m._curSubmit=$qm.RENDERBASE):($h=laya.webgl.submit.SubmitStencil.create(7),$m.addRenderObject($h),$m._submits[$m._submits._length++]=$p,$h=laya.webgl.submit.SubmitStencil.create(8),$m.addRenderObject($h));},$d.create=function($m){var $p=$d._cache._length?$d._cache[--$d._cache._length]:new $d();return 5==($p.step=$m)&&++$d._mask,$p.level=$d._mask,$p;},$d._cache=(($d._cache=[])._length=0,$d._cache),$d._mask=0,$d;}(),$Fm=function(){function $Y(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null;}$R($Y,"laya.webgl.submit.SubmitTarget");var $m=$Y.prototype;return $W.imps($m,{"laya.webgl.submit.ISubmit":!0}),$m.renderSubmit=function(){this._vb.bind_upload(this._ib);var $m=this.scope.getValue(this.proName);return $m&&(this.shaderValue.texture=$m.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$m.width,$m.height]),this.shaderValue.upload(),this.blend(),$M.drawCall++,$M.trianglesFaces+=this._numEle/3,$Zm.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1;},$m.blend=function(){if($U.activeBlendFunction!==$U.fns[this.blendType]){var $m=$Zm.mainContext;$m.enable(3042),$U.fns[this.blendType]($m),$U.activeBlendFunction=$U.fns[this.blendType];}},$m.getRenderType=function(){return 0;},$m.releaseRender=function(){var $m=$Y._cache;($m[$m._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null;},$Y.create=function($m,$p,$h,$P,$L,$q){var $k=$Y._cache._length?$Y._cache[--$Y._cache._length]:new $Y();return $k._ib=$p,$k._vb=$h,$k.proName=$q,$k._startIdx=$P*$Bm.BYTES_PIDX,$k._numEle=0,$k.blendType=$m._nBlendType,$k.shaderValue=$L,$k.shaderValue.setValue($m._shader2D),$k;},$Y._cache=(($Y._cache=[])._length=0,$Y._cache),$Y;}(),$Rm=function(){function $m(){this._sourceStr=null;}$R($m,"laya.webgl.text.CharSegment");var $p=$m.prototype;return $W.imps($p,{"laya.webgl.text.ICharSegment":!0}),$p.textToSpit=function($m){this._sourceStr=$m;},$p.getChar=function($m){return this._sourceStr.charAt($m);},$p.getCharCode=function($m){return this._sourceStr.charCodeAt($m);},$p.length=function(){return this._sourceStr.length;},$m;}(),$$m=function(){var $m;function $M(){}return $R($M,"laya.webgl.text.DrawText"),$M.__init__=function(){$M._charsTemp=new Array(),$M._drawValue=new $m(),$M._charSeg=new $Rm();},$M.customCharSeg=function($m){$M._charSeg=$m;},$M.getChar=function($m,$p,$h){var $P=$Vm.createOneChar($m,$h);return-1!=$p&&($M._charsCache[$p]=$P),$P;},$M._drawSlow=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F,$R,$$,$A){var $B,$n,$c=$M._drawValue.value($q,$Y,$d,$K,$R,$$,$A),$e=0,$a=0,$Z=$M._charsTemp,$H=0,$W=NaN;if($P)for($Z.length=$P.length,$e=0,$a=$P.length;$e<$a;$e++)($n=$P[$e])&&($W=$n.charNum+$c.txtID,$Z[$e]=$B=$M._charsCache[$W]||$M.getChar($n.char,$W,$c),$B.active());else{var $E=$h instanceof laya.utils.WordText?$h.toString():$h;if($S.CharacterCache){$M._charSeg.textToSpit($E);var $I=$M._charSeg.length();for($e=0,$a=$Z.length=$I;$e<$a;$e++)$W=$M._charSeg.getCharCode($e)+$c.txtID,$Z[$e]=$B=$M._charsCache[$W]||$M.getChar($M._charSeg.getChar($e),$W,$c),$B.active(),$H+=$B.cw;}else $Z.length=0,($B=$M.getChar($E,-1,$c)).active(),$H+=$B.cw,$Z[0]=$B;}var $b=0;null!==$k&&"left"!==$k&&($b=-("center"==$k?$H/2:$H));var $T,$j,$x=NaN,$Q=0;if($P)for($e=0,$a=$Z.length;$e<$a;$e++)$B=$Z[$e],$n=$P[$e],$B&&$n&&!$B.isSpace&&($x=$B.borderSize,$T=$B.texture,$p._drawText($T,$D+$b+$n.x*$R-$x,$F+$n.y*$$-$x,$T.width,$T.height,$L,0,0,0,0));else{for($e=0,$a=$Z.length;$e<$a;$e++)($B=$Z[$e])&&!$B.isSpace&&($x=$B.borderSize,$T=$B.texture,$p._drawText($T,$D+$b-$x,$F-$x,$T.width,$T.height,$L,0,0,0,0),$m&&(($j=$m[$Q++])||($j=$m[$Q-1]=[]),$j[0]=$T,$j[1]=$b-$x,$j[2]=-$x)),$b+=$B.cw;$m&&($m.length=$Q);}},$M._drawFast=function($m,$p,$h,$P,$L){for(var $q,$k,$Y=0,$d=$m.length;$Y<$d;$Y++)($q=($k=$m[$Y])[0]).active(),$p._drawText($q,$P+$k[1],$L+$k[2],$q.width,$q.height,$h,0,0,0,0);},$M.drawText=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F){if(void 0===$F&&($F=0),!($p&&0===$p.length||$h&&0===$h.length)){var $R=$P.a,$$=$P.d;(0!==$P.b||0!==$P.c)&&($R=$$=1);var $A=1!==$R||1!==$$;if($A&&$W.stage.transform){var $B=$W.stage.transform;$A=$B.a===$R&&$B.d===$$;}else $A=!1;if($A){var $n=($P=$P.copyTo($Em._tmpMatrix)).tx,$c=$P.ty;$P.scale(1/$R,1/$$),$P._checkTransform(),$K*=$R,$D*=$$,$K+=$n-$P.tx,$D+=$c-$P.ty;}else $R=$$=1;if($h)$M._drawSlow(null,$m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$R,$$,$F);else{if(null===$p.toUpperCase){var $e=$R+1e5*$$,$a=$p;return void($a.changed||$a.id!==$e?($a.id=$e,$a.changed=!1,$M._drawSlow($a.save,$m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$R,$$,$F)):$M._drawFast($a.save,$m,$P,$K,$D));}var $Z=$p+$L.toString()+$k+$Y+$d+$R+$$+$q,$H=$M._textsCache[$Z];$S.CharacterCache?$H?$M._drawFast($H,$m,$P,$K,$D):($M._textsCache.__length||($M._textsCache.__length=0),$M._textsCache.__length>$E.WebGLTextCacheCount&&(($M._textsCache={}).__length=0,$M._curPoolIndex=0),$M._textCachesPool[$M._curPoolIndex]?($H=$M._textsCache[$Z]=$M._textCachesPool[$M._curPoolIndex]).length=0:$M._textCachesPool[$M._curPoolIndex]=$H=$M._textsCache[$Z]=[],$M._textsCache.__length++,$M._curPoolIndex++,$M._drawSlow($H,$m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$R,$$,$F)):$M._drawSlow($H,$m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$R,$$,$F);}}},$M._charsTemp=null,$M._textCachesPool=[],$M._curPoolIndex=0,$M._charsCache={},$M._textsCache={},$M._drawValue=null,$M.d=[],$M._charSeg=null,$M.__init$=function(){$m=function(){function $d(){}return $R($d,""),$d.prototype.value=function($m,$p,$h,$P,$L,$q,$k){this.font=$m,this.fillColor=$p,this.borderColor=$h,this.lineWidth=$P,this.scaleX=$L,this.scaleY=$q,this.underLine=$k;var $Y=$m.toString()+$L+$q+$P+($p?$p.toLowerCase():" ")+($h?$h.toLowerCase():" ")+$k;return this.txtID=$d._keymap[$Y],this.txtID||(this.txtID=1e-7*++$d._keymapCount,$d._keymap[$Y]=this.txtID),this;},$d.clear=function(){$d._keymap={},$d._keymapCount=1;},$d._keymap={},$d._keymapCount=1,$d;}();},$M;}(),$Am=function(){function $L($m){this._index=0,this._size=14,this._italic=-2,$L._cache2=$L._cache2||[],this.setFont($m||"14px Arial");}$R($L,"laya.webgl.text.FontInContext");var $m=$L.prototype;return $m.setFont=function($m){var $p=$L._cache2[$m];if($p)this._words=$p[0],this._size=$p[1];else{this._words=$m.split(" ");for(var $h=0,$P=this._words.length;$h<$P;$h++)if(0<this._words[$h].indexOf("px")){this._index=$h;break;}this._size=parseInt(this._words[this._index]),$L._cache2[$m]=[this._words,this._size];}this._text=null,this._italic=-2;},$m.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic;},$m.hasType=function($m){for(var $p=0,$h=this._words.length;$p<$h;$p++)if(this._words[$p]===$m)return $p;return-1;},$m.removeType=function($m){for(var $p=0,$h=this._words.length;$p<$h;$p++)if(this._words[$p]===$m){this._words.splice($p,1),this._index>$p&&this._index--;break;}this._text=null,this._italic=-2;},$m.copyTo=function($m){return $m._text=this._text,$m._size=this._size,$m._index=this._index,$m._words=this._words.slice(),$m._italic=-2,$m;},$m.toString=function(){return this._text?this._text:this._text=this._words.join(" ");},$P(0,$m,"size",function(){return this._size;},function($m){this._size=$m,this._words[this._index]=$m+"px",this._text=null;}),$L.create=function($m){var $p=$L._cache[$m];return $p||($p=$L._cache[$m]=new $L($m));},$L.EMPTY=new $L(),$L._cache={},$L._cache2=null,$L;}(),$Bm=function(){function $m(){}return $R($m,"laya.webgl.utils.CONST3D2D"),$m.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$m.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$m.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$m._TMPARRAY=[],$m._OFFSETX=0,$m._OFFSETY=0,$k($m,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT;},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT;}]),$m;}(),$nm=function(){function $A(){}return $R($A,"laya.webgl.utils.GlUtils"),$A.make2DProjection=function($m,$p,$h){return[2/$m,0,0,0,0,-2/$p,0,0,0,0,2/$h,0,-1,1,0,1];},$A.fillIBQuadrangle=function($m,$p){if(65535/4<$p)throw Error("IBQuadrangle count:"+$p+" must<:"+Math.floor(65535/4));$p=Math.floor($p),$m._resizeBuffer(6*($p+1)*2,!1),$m.byteLength=$m.bufferLength;for(var $h=$m.getUint16Array(),$P=0,$L=0;$L<$p;$L++)$h[$P++]=4*$L,$h[$P++]=4*$L+2,$h[$P++]=4*$L+1,$h[$P++]=4*$L,$h[$P++]=4*$L+3,$h[$P++]=4*$L+2;return $m.setNeedUpload(),!0;},$A.expandIBQuadrangle=function($m,$p){$m.bufferLength>=6*$p*2||$A.fillIBQuadrangle($m,$p);},$A.mathCeilPowerOfTwo=function($m){return $m--,$m|=$m>>1,$m|=$m>>2,$m|=$m>>4,$m|=$m>>8,$m|=$m>>16,++$m;},$A.fillQuadrangleImgVb=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=16+($m._byteLength>>2);$m.byteLength=$d<<2;var $K=$m.getFloat32Array();$K[($d-=16)+2]=$L[0],$K[$d+3]=$L[1],$K[$d+6]=$L[2],$K[$d+7]=$L[3],$K[$d+10]=$L[4],$K[$d+11]=$L[5],$K[$d+14]=$L[6],$K[$d+15]=$L[7];var $D=$q.a,$F=$q.b,$R=$q.c,$$=$q.d;if(1!==$D||0!==$F||0!==$R||1!==$$){$q.bTransform=!0;var $A=$q.tx+$k,$B=$q.ty+$Y;$K[$d]=($P[0]+$p)*$D+($P[1]+$h)*$R+$A,$K[$d+1]=($P[0]+$p)*$F+($P[1]+$h)*$$+$B,$K[$d+4]=($P[2]+$p)*$D+($P[3]+$h)*$R+$A,$K[$d+5]=($P[2]+$p)*$F+($P[3]+$h)*$$+$B,$K[$d+8]=($P[4]+$p)*$D+($P[5]+$h)*$R+$A,$K[$d+9]=($P[4]+$p)*$F+($P[5]+$h)*$$+$B,$K[$d+12]=($P[6]+$p)*$D+($P[7]+$h)*$R+$A,$K[$d+13]=($P[6]+$p)*$F+($P[7]+$h)*$$+$B;}else $q.bTransform=!1,$p+=$q.tx+$k,$h+=$q.ty+$Y,$K[$d]=$p+$P[0],$K[$d+1]=$h+$P[1],$K[$d+4]=$p+$P[2],$K[$d+5]=$h+$P[3],$K[$d+8]=$p+$P[4],$K[$d+9]=$h+$P[5],$K[$d+12]=$p+$P[6],$K[$d+13]=$h+$P[7];return $m._upload=!0;},$A.fillTranglesVB=function($m,$p,$h,$P,$L,$q,$k){var $Y=($m._byteLength>>2)+$P.length;$m.byteLength=$Y<<2;var $d=$m.getFloat32Array();$Y-=$P.length;for(var $K=$P.length,$D=$L.a,$F=$L.b,$R=$L.c,$$=$L.d,$A=0;$A<$K;$A+=4)if($d[$Y+$A+2]=$P[$A+2],$d[$Y+$A+3]=$P[$A+3],1!==$D||0!==$F||0!==$R||1!==$$){$L.bTransform=!0;var $B=$L.tx+$q,$n=$L.ty+$k;$d[$Y+$A]=($P[$A]+$p)*$D+($P[$A+1]+$h)*$R+$B,$d[$Y+$A+1]=($P[$A]+$p)*$F+($P[$A+1]+$h)*$$+$n;}else $L.bTransform=!1,$p+=$L.tx+$q,$h+=$L.ty+$k,$d[$Y+$A]=$p+$P[$A],$d[$Y+$A+1]=$h+$P[$A+1];return $m._upload=!0;},$A.copyPreImgVb=function($m,$p,$h){var $P=$m._byteLength>>2;$m.byteLength=$P+16<<2;for(var $L=$m.getFloat32Array(),$q=0,$k=$P-16;$q<4;$q++)$L[$P]=$L[$k]+$p,++$k,$L[++$P]=$L[$k]+$h,++$k,$L[++$P]=$L[$k],++$k,$L[++$P]=$L[$k],++$P,++$k;$m._upload=!0;},$A.fillRectImgVb=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F,$R){void 0===$R&&($R=!1);var $$,$A,$B,$n,$c,$e,$a,$Z,$H,$W,$E,$I,$b,$T,$j,$x,$Q=1,$M=$Y.a,$u=$Y.b,$N=$Y.c,$S=$Y.d,$_=$p&&$p.width<99999999;if(1!==$M||0!==$u||0!==$N||1!==$S?($Y.bTransform=!0,0===$u&&0===$N&&($Q=23,$H=$L+$h,$W=$q+$P,$$=$M*$h+($E=$Y.tx+$d),$B=$M*$H+$E,$A=$S*$P+($I=$Y.ty+$K),$n=$S*$W+$I)):($Q=23,$Y.bTransform=!1,$B=($$=$h+$Y.tx+$d)+$L,$n=($A=$P+$Y.ty+$K)+$q),$_&&($c=$p.x,$e=$p.y,$a=$p.width+$c,$Z=$p.height+$e),1!==$Q){if(Math.min($$,$B)>=$a)return!1;if(Math.min($A,$n)>=$Z)return!1;if(Math.max($B,$$)<=$c)return!1;if(Math.max($n,$A)<=$e)return!1;}var $l=$m._byteLength>>2;$m.byteLength=16+$l<<2;var $J=$m.getFloat32Array();switch($J[2+$l]=$k[0],$J[3+$l]=$k[1],$J[6+$l]=$k[2],$J[7+$l]=$k[3],$J[10+$l]=$k[4],$J[11+$l]=$k[5],$J[14+$l]=$k[6],$J[15+$l]=$k[7],$Q){case 1:$E=$Y.tx+$d,$I=$Y.ty+$K;var $z=$M*$h,$w=$N*$P,$X=$S*$P,$s=$u*$h,$G=$M*($H=$L+$h),$U=$N*($W=$q+$P),$r=$S*$W,$y=$u*$H;$R?($b=$z+$w+$E,$j=Math.round($b)-$b,$T=$X+$s+$I,$x=Math.round($T)-$T,$J[$l]=$b+$j,$J[1+$l]=$T+$x,$J[4+$l]=$G+$w+$E+$j,$J[5+$l]=$X+$y+$I+$x,$J[8+$l]=$G+$U+$E+$j,$J[9+$l]=$r+$y+$I+$x,$J[12+$l]=$z+$U+$E+$j,$J[13+$l]=$r+$s+$I+$x):($J[$l]=$z+$w+$E,$J[1+$l]=$X+$s+$I,$J[4+$l]=$G+$w+$E,$J[5+$l]=$X+$y+$I,$J[8+$l]=$G+$U+$E,$J[9+$l]=$r+$y+$I,$J[12+$l]=$z+$U+$E,$J[13+$l]=$r+$s+$I);break;case 23:$R?($b=$$+$D,$j=Math.round($b)-$b,$T=$A,$x=Math.round($T)-$T,$J[$l]=$b+$j,$J[1+$l]=$T+$x,$J[4+$l]=$B+$D+$j,$J[5+$l]=$A+$x,$J[8+$l]=$B+$j,$J[9+$l]=$n+$x,$J[12+$l]=$$+$j,$J[13+$l]=$n+$x):($J[$l]=$$+$D,$J[1+$l]=$A,$J[4+$l]=$B+$D,$J[5+$l]=$A,$J[8+$l]=$B,$J[9+$l]=$n,$J[12+$l]=$$,$J[13+$l]=$n);}return $m._upload=!0;},$A.fillLineVb=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=.5*$k,$K=$A._fillLineArray,$D=-($P-$q),$F=$h-$L,$R=Math.sqrt($D*$D+$F*$F);$D/=$R,$F/=$R,$D*=$d,$F*=$d,$K[0]=$h-$D,$K[1]=$P-$F,$K[4]=$h+$D,$K[5]=$P+$F,$K[8]=$L+$D,$K[9]=$q+$F,$K[12]=$L-$D,$K[13]=$q-$F,$Y&&$Y.transformPointArray($K,$K);var $$=16+($m._byteLength>>2);return $m.byteLength=$$<<2,$m.insertData($K,$$-16),!0;},$A._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$A;}(),$cm=(function(){function $d(){}$R($d,"laya.webgl.utils.MatirxArray"),$d.ArrayMul=function($m,$p,$h){if($m){if($p)for(var $P=NaN,$L=NaN,$q=NaN,$k=NaN,$Y=0;$Y<4;$Y++)$P=$m[$Y],$L=$m[$Y+4],$q=$m[$Y+8],$k=$m[$Y+12],$h[$Y]=$P*$p[0]+$L*$p[1]+$q*$p[2]+$k*$p[3],$h[$Y+4]=$P*$p[4]+$L*$p[5]+$q*$p[6]+$k*$p[7],$h[$Y+8]=$P*$p[8]+$L*$p[9]+$q*$p[10]+$k*$p[11],$h[$Y+12]=$P*$p[12]+$L*$p[13]+$q*$p[14]+$k*$p[15];else $d.copyArray($m,$h);}else $d.copyArray($p,$h);},$d.copyArray=function($m,$p){if($m&&$p)for(var $h=0;$h<$m.length;$h++)$p[$h]=$m[$h];};}(),function(){function $p($m,$p,$h){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$m,this._vb=new $Cm($m,35048),$p&&this._vb._resizeBuffer($p,!1),this._ib=new $Om(),$h&&this._ib._resizeBuffer($h,!1);}$R($p,"laya.webgl.utils.Mesh2D");var $m=$p.prototype;return $m.cloneWithNewVB=function(){var $m=new $p(this._stride,0,0);return $m._ib=this._ib,$m._quadNum=this._quadNum,$m._attribInfo=this._attribInfo,$m;},$m.cloneWithNewVBIB=function(){var $m=new $p(this._stride,0,0);return $m._attribInfo=this._attribInfo,$m;},$m.getVBW=function(){return this._vb.setNeedUpload(),this._vb;},$m.getVBR=function(){return this._vb;},$m.getIBR=function(){return this._ib;},$m.getIBW=function(){return this._ib.setNeedUpload(),this._ib;},$m.createQuadIB=function($m){this._quadNum=$m,this._ib._resizeBuffer(6*$m*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $p=this._ib.getUint16Array(),$h=0,$P=0,$L=0;$L<$m;$L++)$p[$h++]=$P,$p[$h++]=$P+2,$p[$h++]=$P+1,$p[$h++]=$P,$p[$h++]=$P+3,$p[$h++]=$P+2,$P+=4;this._ib.setNeedUpload();},$m.setAttributes=function($m){if(this._attribInfo=$m,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!";},$m.getEleNum=function(){return this._ib.getBuffer().byteLength/2;},$m.releaseMesh=function(){},$m.destroy=function(){},$m.clearVB=function(){this._vb.clear();},$p._gvaoid=0,$p;}()),$em=function(){function $L(){}return $R($L,"laya.webgl.utils.RenderState2D"),$L.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];},$L.mat2MatArray=function($m,$p){var $h=$m,$P=$p;return $P[0]=$h.a,$P[1]=$h.b,$P[2]=$L.EMPTYMAT4_ARRAY[2],$P[3]=$L.EMPTYMAT4_ARRAY[3],$P[4]=$h.c,$P[5]=$h.d,$P[6]=$L.EMPTYMAT4_ARRAY[6],$P[7]=$L.EMPTYMAT4_ARRAY[7],$P[8]=$L.EMPTYMAT4_ARRAY[8],$P[9]=$L.EMPTYMAT4_ARRAY[9],$P[10]=$L.EMPTYMAT4_ARRAY[10],$P[11]=$L.EMPTYMAT4_ARRAY[11],$P[12]=$h.tx,$P[13]=$h.ty,$P[14]=$L.EMPTYMAT4_ARRAY[14],$P[15]=$L.EMPTYMAT4_ARRAY[15],$p;},$L.restoreTempArray=function(){$L.TEMPMAT4_ARRAY[0]=1,$L.TEMPMAT4_ARRAY[1]=0,$L.TEMPMAT4_ARRAY[4]=0,$L.TEMPMAT4_ARRAY[5]=1,$L.TEMPMAT4_ARRAY[12]=0,$L.TEMPMAT4_ARRAY[13]=0;},$L.clear=function(){$L.worldScissorTest=!1,$L.worldShaderDefines=null,$L.worldFilters=null,$L.worldAlpha=1,$L.worldClipRect.x=$L.worldClipRect.y=0,$L.worldClipRect.width=$L.width,$L.worldClipRect.height=$L.height,$L.curRenderTarget=null;},$L._MAXSIZE=99999999,$L.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$L.worldMatrix4=$L.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$L.worldAlpha=1,$L.worldScissorTest=!1,$L.worldFilters=null,$L.worldShaderDefines=null,$L.curRenderTarget=null,$L.width=0,$L.height=0,$k($L,["worldMatrix",function(){return this.worldMatrix=new $b();},"worldClipRect",function(){return this.worldClipRect=new $j(0,0,99999999,99999999);}]),$L;}(),$am=function(){var $e,$h;function $a($m,$p,$h,$P,$L){var $q=this;function $k($m){var $p=[],$h=new $e($p);return $q._compileToTree($h,$m.split("\n"),0,$p,$L),$h;}var $Y=$$.now();this._VS=$k($p),this._PS=$k($h),this._nameMap=$P,2<$$.now()-$Y&&console.log("ShaderCompile use time:"+($$.now()-$Y)+"  size:"+$p.length+"/"+$h.length);}$R($a,"laya.webgl.utils.ShaderCompile");var $m=$a.prototype;return $m._compileToTree=function($m,$p,$h,$P,$L){var $q,$k,$Y,$d,$K,$D,$F,$R=0,$$=0,$A=0,$B=0;for($$=$h;$$<$p.length;$$++)if(!(($Y=$p[$$]).length<1)&&0!==($R=$Y.indexOf("//"))){if(0<=$R&&($Y=$Y.substr(0,$R)),$q=$F||new $e($P),$F=null,$q.text=$Y,$q.noCompile=!0,0<=($R=$Y.indexOf("#"))){for($d="#",$B=$R+1,$A=$Y.length;$B<$A;$B++){var $n=$Y.charAt($B);if(" "===$n||"\t"===$n||"\r"===$n||"\n"===$n||"?"===$n)break;$d+=$n;}switch($q.name=$d){case"#ifdef":case"#ifndef":if($q.src=$Y,$q.noCompile=null!=$Y.match(/[!&|()=<>]/),$q.noCompile?console.log("function():Boolean{return "+$Y.substr($R+$q.name.length)+"}"):($D=$Y.replace(/^\s*/,"").split(/\s+/),$q.setCondition($D[1],"#ifdef"===$d?1:2),$q.text="//"+$q.text),$q.setParent($m),$m=$q,$L)for($D=$Y.substr($B).split($a._splitToWordExps3),$B=0;$B<$D.length;$B++)($Y=$D[$B]).length&&($L[$Y]=!0);continue;case"#if":if($q.src=$Y,$q.noCompile=!0,$q.setParent($m),$m=$q,$L)for($D=$Y.substr($B).split($a._splitToWordExps3),$B=0;$B<$D.length;$B++)($Y=$D[$B]).length&&"defined"!=$Y&&($L[$Y]=!0);continue;case"#else":$q.src=$Y,$k=($m=$m.parent).childs[$m.childs.length-1],$q.noCompile=$k.noCompile,$q.noCompile||($q.condition=$k.condition,$q.conditionType=1==$k.conditionType?2:1,$q.text="//"+$q.text+" "+$k.text+" "+$q.conditionType),$q.setParent($m),$m=$q;continue;case"#endif":$k=($m=$m.parent).childs[$m.childs.length-1],$q.noCompile=$k.noCompile,$q.noCompile||($q.text="//"+$q.text),$q.setParent($m);continue;case"#include":$D=$a.splitToWords($Y,null);var $c=$a.includes[$D[1]];if(!$c)throw"ShaderCompile error no this include file:"+$D[1];if(($R=$D[0].indexOf("?"))<0){$q.setParent($m),$Y=$c.getWith("with"==$D[2]?$D[3]:null),this._compileToTree($q,$Y.split("\n"),0,$P,$L),$q.text="";continue;}$q.setCondition($D[0].substr($R+1),1),$q.text=$c.getWith("with"==$D[2]?$D[3]:null);break;case"#import":$K=($D=$a.splitToWords($Y,null))[1],$P.push({node:$q,file:$a.includes[$K],ofs:$q.text.length});continue;}}else{if(($k=$m.childs[$m.childs.length-1])&&!$k.name){0<$P.length&&$a.splitToWords($Y,$k),$F=$q,$k.text+="\n"+$Y;continue;}0<$P.length&&$a.splitToWords($Y,$q);}$q.setParent($m);}},$m.createShader=function($m,$p,$h){var $P={},$L="";if($m)for(var $q in $m)$L+="#define "+$q+"\n",$P[$q]=!0;var $k=this._VS.toscript($P,[]),$Y=this._PS.toscript($P,[]);return($h||$im.create)($L+$k.join("\n"),$L+$Y.join("\n"),$p,this._nameMap);},$a._parseOne=function($m,$p,$h,$P,$L,$q){var $k={type:$a.shaderParamsMap[$h[$P+1]],name:$h[$P+2],size:isNaN(parseInt($h[$P+3]))?1:parseInt($h[$P+3])};return $q&&("attribute"==$L?$m.push($k):$p.push($k)),":"==$h[$P+3]&&($k.type=$h[$P+4],$P+=2),$P+=2;},$a.addInclude=function($m,$p){if(!$p||0===$p.length)throw new Error("add shader include file err:"+$m);if($a.includes[$m])throw new Error("add shader include file err, has add:"+$m);$a.includes[$m]=new $h($p);},$a.preGetParams=function($m,$p){var $h=[$m,$p],$P={},$L=[],$q=[],$k={},$Y=[];$P.attributes=$L,$P.uniforms=$q,$P.defines=$k;for(var $d=0,$K=0,$D=0;$D<2;$D++){$h[$D]=$h[$D].replace($a._removeAnnotation,"");var $F,$R=$h[$D].match($a._reg);for($d=0,$K=$R.length;$d<$K;$d++){var $$=$R[$d];if("attribute"==$$||"uniform"==$$)$d=$a._parseOne($L,$q,$R,$d,$$,!0);else{if("#define"==$$){$Y[$$=$R[++$d]]=1;continue;}if("#ifdef"==$$){$k[$F=$R[++$d]]=$k[$F]||[];for($d++;$d<$K;$d++)if("attribute"==($$=$R[$d])||"uniform"==$$)$d=$a._parseOne($L,$q,$R,$d,$$,$Y[$F]);else if("#else"==$$)for($d++;$d<$K;$d++)if("attribute"==($$=$R[$d])||"uniform"==$$)$d=$a._parseOne($L,$q,$R,$d,$$,!$Y[$F]);else if("#endif"==$$)break;}}}}return $P;},$a.splitToWords=function($m,$p){for(var $h,$P,$L=[],$q=-1,$k=0,$Y=$m.length;$k<$Y;$k++)if($h=$m.charAt($k),0<=" \t=+-*/&%!<>()'\",;".indexOf($h)){if(0<=$q&&1<$k-$q&&($P=$m.substr($q,$k-$q),$L.push($P)),'"'==$h||"'"==$h){var $d=$m.indexOf($h,$k+1);if($d<0)throw"Sharder err:"+$m;$L.push($m.substr($k+1,$d-$k-1)),$k=$d,$q=-1;continue;}"("==$h&&$p&&0<$L.length&&($P=$L[$L.length-1]+";","vec4;main;".indexOf($P)<0&&($p.useFuns+=$P)),$q=-1;}else $q<0&&($q=$k);return $q<$Y&&1<$Y-$q&&($P=$m.substr($q,$Y-$q),$L.push($P)),$L;},$a.IFDEF_NO=0,$a.IFDEF_YES=1,$a.IFDEF_ELSE=2,$a.IFDEF_PARENT=3,$a._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$a._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$a._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$a.includes={},$k($a,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680};},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g");}]),$a.__init$=function(){$e=function(){function $h($m){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$m;}$R($h,"");var $m=$h.prototype;return $m.setParent=function($m){$m.childs.push(this),this.z=$m.z+1,this.parent=$m;},$m.setCondition=function($m,$p){$m&&(this.conditionType=$p,$m=$m.replace(/(\s*$)/g,""),this.condition=function(){return this[$m];},this.condition.__condition=$m);},$m.toscript=function($m,$p){return this._toscript($m,$p,++$h.__id);},$m._toscript=function($P,$L,$q){if(this.childs.length<1&&!this.text)return $L;$L.length;if(this.condition){var $m=!!this.condition.call($P);if(2===this.conditionType&&($m=!$m),!$m)return $L;}if(this.text&&$L.push(this.text),0<this.childs.length&&this.childs.forEach(function($m,$p,$h){$m._toscript($P,$L,$q);}),0<this.includefiles.length&&0<this.useFuns.length)for(var $p,$h=0,$k=this.includefiles.length;$h<$k;$h++)this.includefiles[$h].curUseID!=$q&&0<($p=this.includefiles[$h].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$h].curUseID=$q,$L[0]=$p+$L[0]);return $L;},$h.__id=1,$h;}(),$h=function(){function $m($m){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$m;for(var $p=0,$h=0,$P=0;!(($p=$m.indexOf("#begin",$p))<0);){for($P=$p+5;!(($P=$m.indexOf("#end",$P))<0)&&"i"===$m.charAt($P+4);)$P+=5;if($P<0)throw"add include err,no #end:"+$m;$h=$m.indexOf("\n",$p);var $L=$a.splitToWords($m.substr($p,$h-$p),null);"code"==$L[1]?this.codes[$L[2]]=$m.substr($h+1,$P-$h-1):"function"==$L[1]&&($h=$m.indexOf("function",$p),$h+="function".length,this.funs[$L[3]]=$m.substr($h+1,$P-$h-1),this.funnames+=$L[3]+";"),$p=$P+1;}}$R($m,"");var $p=$m.prototype;return $p.getWith=function($m){var $p=$m?this.codes[$m]:this.script;if(!$p)throw"get with error:"+$m;return $p;},$p.getFunsScript=function($m){var $p="";for(var $h in this.funs)0<=$m.indexOf($h+";")&&($p+=this.funs[$h]);return $p;},$m;}();},$a;}(),$Zm=function(){function $k(){}return $R($k,"laya.webgl.WebGL"),$k._uint8ArraySlice=function(){for(var $m=this.length,$p=new Uint8Array(this.length),$h=0;$h<$m;$h++)$p[$h]=this[$h];return $p;},$k._float32ArraySlice=function(){for(var $m=this.length,$p=new Float32Array(this.length),$h=0;$h<$m;$h++)$p[$h]=this[$h];return $p;},$k._uint16ArraySlice=function($m){var $p,$h=arguments,$P=0,$L=0;if(0===$h.length)for($P=this.length,$p=new Uint16Array($P),$L=0;$L<$P;$L++)$p[$L]=this[$L];else if(2===$h.length){var $q=$h[0],$k=$h[1];if($q<$k)for($P=$k-$q,$p=new Uint16Array($P),$L=$q;$L<$k;$L++)$p[$L-$q]=this[$L];else $p=new Uint16Array(0);}return $p;},$k.expandContext=function(){var $m=$L.prototype,$p=CanvasRenderingContext2D.prototype;$p.fillTrangles=$m.fillTrangles,$vm.__int__(null),$p.setIBVB=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){void 0===$d&&($d=0),void 0===$K&&($K=0),null===$h&&(this._ib=this._ib||$Om.QuadrangleIB,$h=this._ib,$nm.expandIBQuadrangle($h,$P._byteLength/64+8)),this._setIBVB($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K);},$p.fillTrangles=function($m,$p,$h,$P,$L){this._curMat=this._curMat||$b.create(),this._vb=this._vb||$Cm.create(),this._ib||(this._ib=$Om.create(),$nm.fillIBQuadrangle(this._ib,$k/4));var $q=this._vb,$k=$P.length>>4;$nm.fillTranglesVB($q,$p,$h,$P,$L||this._curMat,0,0),$nm.expandIBQuadrangle(this._ib,$q._byteLength/64+8);var $Y=new $Im(1,0);$Y.textureHost=$m;var $d=new $tm("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$q._vertType=3,this._setIBVB($p,$h,this._ib,$q,6*$k,$L,$d,$Y,0,0);};},$k.enable=function(){if($$.__init__(),$c.isConchApp&&!$c.isConchWebGL)return $H.skinAniSprite=function(){return new $mm();},$k.expandContext(),!1;if($H.getWebGLContext=function($m){for(var $p,$h=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$P=0;$P<$h.length;$P++){try{$p=$m.getContext($h[$P],{stencil:$E.isStencil,alpha:$E.isAlpha,antialias:$E.isAntialias,premultipliedAlpha:$E.premultipliedAlpha,preserveDrawingBuffer:$E.preserveDrawingBuffer});}catch($m){}if($p)return $p;}return null;},null==($k.mainContext=$k.mainContext||$H.getWebGLContext($c._mainCanvas)))return!1;if($c.isWebGL)return!0;$B.create=function($m,$p){return new $mp($m,$p);},$n.create=function($m,$p,$h,$P,$L,$q,$k){return new $fm($m,$p,$h,$P,$L,$q,$k);},$c.WebGL=$k,$c.isWebGL=!0,$$m.__init__(),$H.createRenderSprite=function($m,$p){return new $bm($m,$p);},$H.createWebGLContext2D=function($m){return new $Em($m);},$H.changeWebGLSize=function($m,$p){laya.webgl.WebGL.onStageResize($m,$p);},$H.createGraphics=function(){return new $Wm();};var $m=$H.createFilterAction;return $H.createFilterAction=$m||function($m){return new $Tm();},$H.clear=function($m){$em.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $p=$c.context.ctx,$h=0==$p._submits._length||$E.preserveDrawingBuffer?$A.create($m)._color:$Q._wgColor;$h&&$p.clearBG($h[0],$h[1],$h[2],$h[3]),$em.clear();},$H.addToAtlas=function($m,$p){void 0===$p&&($p=!1);var $h=$m.bitmap;$c.optimizeTextureMemory($m.url,$m)?$W.__typeof($h,"laya.webgl.resource.IMergeAtlasBitmap")&&$h.allowMerageInAtlas&&$h.on("recovered",$m,$m.addTextureToAtlas):$h.enableMerageInAtlas=!1;},$H.isAtlas=function($m){return $m instanceof laya.webgl.atlas.AtlasWebGLCanvas;},$s._enable(),$H.beginFlush=function(){for(var $m=$s.instance,$p=$m.getAtlaserCount(),$h=0;$h<$p;$h++){var $P=$m.getAtlaserByIndex($h).texture;$P._flashCacheImageNeedFlush&&$H.flashFlushImage($P);}},$H.drawToCanvas=function($m,$p,$h,$P,$L,$q){($h<=0||$P<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$h|=0,$P|=0,$L|=0,$q|=0;var $k=$Jm.create($h,$P,6408,5121,0,!1);$k.start(),$k.clear(0,0,0,0),$c.context.clear(),$e.renders[$p]._fun($m,$c.context,$L,$em.height-$P+$q),$c.context.flush(),$k.end();var $Y=$k.getData(0,0,$h,$P);if($k.recycle(),$Y.byteLength==$h*$P*4){var $d=new $ym();$d._canvas=$$.createElement("canvas"),$d.size($h,$P);var $K=$d._canvas.getContext("2d");$$.canvas.size($h,$P);var $D=$$.context,$F=$D.createImageData($h,$P);return $F.data.set(new Uint8ClampedArray($Y.buffer)),$d._imgData=$F,$D.putImageData($F,0,0),$K.save(),$K.translate(0,$P),$K.scale(1,-1),$K.drawImage($$.canvas.source,0,0),$K.restore(),$d;}console.log("drawToCanvas error: w:"+$h+",h:"+$P+",datalen:"+$Y.byteLength);},$H.createFilterAction=function($m){var $p;switch($m){case 32:$p=new $Tm();}return $p;},$H.addTextureToAtlas=function($m){$m._uvID++,$s._atlasRestore++,$m.bitmap.enableMerageInAtlas&&$s.instance.addToAtlas($m);},$H.getTexturePixels=function($m,$p,$h,$P,$L){$c.context.ctx.clear();var $q=new $x();$q.graphics.drawTexture($m,-$p,-$h);var $k=$Jm.create($P,$L);$k.start(),$k.clear(0,0,0,0),$q.render($c.context,0,0),$c.context.ctx.flush(),$k.end();for(var $Y=$k.getData(0,0,$P,$L),$d=[],$K=0,$D=$L-1;0<=$D;$D--)for(var $F=0;$F<$P;$F++)$K=4*($D*$P+$F),$d.push($Y[$K]),$d.push($Y[$K+1]),$d.push($Y[$K+2]),$d.push($Y[$K+3]);return $d;},$H.skinAniSprite=function(){return new $mm();},$K.create=function($m,$p){var $h=new $ym();return $h._imgData=$p,$h.flipY=!1,$h;},$I._filterStart=function($m,$p,$h,$P,$L){var $q=$m.getValue("bounds"),$k=$Jm.create($q.width,$q.height);if($k.start(),$k.clear(0,0,0,0),$m.addValue("src",$k),$m.addValue("ScissorTest",$em.worldScissorTest),$em.worldScissorTest){var $Y=new $j();$Y.copyFrom($h.ctx._clipRect),$m.addValue("clipRect",$Y),$em.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089);}},$I._filterEnd=function($m,$p,$h,$P,$L){var $q=$m.getValue("bounds");$m.getValue("src").end();var $k=$Jm.create($q.width,$q.height);$k.start(),$k.clear(0,0,0,0),$m.addValue("out",$k),$p._set$P("_filterCache",$k),$p._set$P("_isHaveGlowFilter",$m.getValue("_isHaveGlowFilter"));},$I._EndTarget=function($m,$p){if($m.getValue("src").recycle(),$m.getValue("out").end(),$m.getValue("ScissorTest")){$em.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$p.ctx.save();var $h=$m.getValue("clipRect");$p.ctx.clipRect($h.x,$h.y,$h.width,$h.height);}},$I._useSrc=function($m){var $p=$m.getValue("out");$p.end(),($p=$m.getValue("src")).start(),$p.clear(0,0,0,0);},$I._endSrc=function($m){$m.getValue("src").end();},$I._useOut=function($m){var $p=$m.getValue("src");$p.end(),($p=$m.getValue("out")).start(),$p.clear(0,0,0,0);},$I._endOut=function($m){$m.getValue("out").end();},$I._recycleScope=function($m){$m.recycle();},$I._filter=function($m,$p,$h,$P){var $L=this._next;if($L){var $q,$k,$Y=$m.filters,$d=$Y.length;if(1==$d&&32==$Y[0].type)return $p.ctx.save(),$p.ctx.setFilters([$Y[0]]),$L._fun.call($L,$m,$p,$h,$P),void $p.ctx.restore();var $K=$Ym.create(),$D=$T.TEMP,$F=$p.ctx._getTransformMatrix(),$R=$b.create();$F.copyTo($R);var $$=0,$A=0,$B=!1,$n=$m._$P._filterCache?$m._$P._filterCache:null;if(!$n||$m._repaint){$B=$m._isHaveGlowFilter(),$K.addValue("_isHaveGlowFilter",$B),$B&&($$=50,$A=25),($k=new $j()).copyFrom($m.getSelfBounds()),$k.x+=$m.x,$k.y+=$m.y,$k.x-=$m.pivotX+4,$k.y-=$m.pivotY+4;var $c=$k.x,$e=$k.y;if($k.width+=$$+8,$k.height+=$$+8,$D.x=$k.x*$R.a+$k.y*$R.c,$D.y=$k.y*$R.d+$k.x*$R.b,$k.x=$D.x,$k.y=$D.y,$D.x=$k.width*$R.a+$k.height*$R.c,$D.y=$k.height*$R.d+$k.width*$R.b,$k.width=$D.x,$k.height=$D.y,$k.width<=0||$k.height<=0)return;$n&&$n.recycle(),$K.addValue("bounds",$k);var $a=$km.create([$K,$m,$p,0,0],$I._filterStart);$p.addRenderObject($a),$p.ctx._renderKey=0,$p.ctx._shader2D.glTexture=null;var $Z=$m.x-$c+$A,$H=$m.y-$e+$A;$L._fun.call($L,$m,$p,$Z,$H),$a=$km.create([$K,$m,$p,0,0],$I._filterEnd),$p.addRenderObject($a);for(var $W=0;$W<$d;$W++){0!=$W&&($a=$km.create([$K],$I._useSrc),$p.addRenderObject($a),$q=$Im.create(1,0),$b.TEMP.identity(),$p.ctx.drawTarget($K,0,0,$k.width,$k.height,$b.TEMP,"out",$q,null,$U.TOINT.overlay),$a=$km.create([$K],$I._useOut),$p.addRenderObject($a)),$Y[$W].action.apply3d($K,$m,$p,0,0);}$a=$km.create([$K,$p],$I._EndTarget),$p.addRenderObject($a);}else{if(($B=!!$m._$P._isHaveGlowFilter&&$m._$P._isHaveGlowFilter)&&($$=50,$A=25),($k=$m.getBounds()).width<=0||$k.height<=0)return;$k.width+=$$,$k.height+=$$,$D.x=$k.x*$R.a+$k.y*$R.c,$D.y=$k.y*$R.d+$k.x*$R.b,$k.x=$D.x,$k.y=$D.y,$D.x=$k.width*$R.a+$k.height*$R.c,$D.y=$k.height*$R.d+$k.width*$R.b,$k.width=$D.x,$k.height=$D.y,$K.addValue("out",$n);}$h=$h-$A-$m.x,$P=$P-$A-$m.y,$D.setTo($h,$P),$R.transformPoint($D),$h=$D.x+$k.x,$P=$D.y+$k.y,$q=$Im.create(1,0),$b.TEMP.identity(),$p.ctx.drawTarget($K,$h,$P,$k.width,$k.height,$b.TEMP,"out",$q,null,$U.TOINT.overlay),$a=$km.create([$K],$I._recycleScope),$p.addRenderObject($a),$R.destroy();}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$k._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$k._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$k._uint8ArraySlice),!0;},$k.onStageResize=function($m,$p){null!=$k.mainContext&&($k.mainContext.viewport(0,0,$m,$p),$em.width=$m,$em.height=$p);},$k.onInvalidGLRes=function(){$s.instance.freeAll(),$Z.releaseContentManagers(!0),$k.doNodeRepaint($W.stage),$k.mainContext.viewport(0,0,$em.width,$em.height),$W.stage.event("devicelost");},$k.doNodeRepaint=function($m){0==$m.numChildren&&$m.repaint();for(var $p=0;$p<$m.numChildren;$p++)$k.doNodeRepaint($m.getChildAt($p));},$k.init=function($m,$p,$h){$k.mainCanvas=$m,$K._createContext=function($m){return new $Em($m);},$ym._createContext=function($m){return new $Em($m);};var $P=laya.webgl.WebGL.mainContext;if(null!=$P.getShaderPrecisionFormat){var $L=$P.getShaderPrecisionFormat(35633,36338),$q=$P.getShaderPrecisionFormat(35632,36338);$k.shaderHighPrecision=!(!$L.precision||!$q.precision);}else $k.shaderHighPrecision=!1;if($k.compressAstc=$P.getExtension("WEBGL_compressed_texture_astc"),$k.compressAtc=$P.getExtension("WEBGL_compressed_texture_atc"),$k.compressEtc=$P.getExtension("WEBGL_compressed_texture_etc"),$k.compressEtc1=$P.getExtension("WEBGL_compressed_texture_etc1"),$k.compressPvrtc=$P.getExtension("WEBGL_compressed_texture_pvrtc"),$k.compressS3tc=$P.getExtension("WEBGL_compressed_texture_s3tc"),$k.compressS3tc_srgb=$P.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$k.compressAstc=$k.compressAstc?$k.compressAstc:{},$k.compressAtc=$k.compressAtc?$k.compressAtc:{},$k.compressEtc=$k.compressEtc?$k.compressEtc:{},$k.compressEtc1=$k.compressEtc1?$k.compressEtc1:{},$k.compressPvrtc=$k.compressPvrtc?$k.compressPvrtc:{},$k.compressS3tc=$k.compressS3tc?$k.compressS3tc:{},$k.compressS3tc_srgb=$k.compressS3tc_srgb?$k.compressS3tc_srgb:{},$P.deleteTexture1=$P.deleteTexture,$P.deleteTexture=function($m){$m==$Hm.curBindTexValue&&($Hm.curBindTexValue=null),$P.deleteTexture1($m);},$k.onStageResize($p,$h),null==$k.mainContext)throw new Error("webGL getContext err!");$N.__init__(),$s.__init__(),$xm.__init__(),$qm.__init__(),$Em.__init__(),$Im.__init__(),$O.__init__(),$vm.__int__($P),$U._init_($P),$c.isConchApp&&conch.setOnInvalidGLRes($k.onInvalidGLRes);},$k.mainCanvas=null,$k.antialias=!0,$k.shaderHighPrecision=!1,$k._bg_null=[0,0,0,0],$k;}(),$Hm=function(){function $P(){}return $R($P,"laya.webgl.WebGLContext"),$P.UseProgram=function($m){return $P._useProgram!==$m&&($Zm.mainContext.useProgram($m),$P._useProgram=$m,!0);},$P.setDepthTest=function($m,$p){$p!==$P._depthTest&&(($P._depthTest=$p)?$m.enable(2929):$m.disable(2929));},$P.setDepthMask=function($m,$p){$p!==$P._depthMask&&($P._depthMask=$p,$m.depthMask($p));},$P.setDepthFunc=function($m,$p){$p!==$P._depthFunc&&($P._depthFunc=$p,$m.depthFunc($p));},$P.setBlend=function($m,$p){$p!==$P._blend&&(($P._blend=$p)?$m.enable(3042):$m.disable(3042));},$P.setBlendFunc=function($m,$p,$h){($p!==$P._sFactor||$h!==$P._dFactor)&&($P._sFactor=$p,$P._dFactor=$h,$m.blendFunc($p,$h));},$P.setCullFace=function($m,$p){$p!==$P._cullFace&&(($P._cullFace=$p)?$m.enable(2884):$m.disable(2884));},$P.setFrontFace=function($m,$p){$p!==$P._frontFace&&($P._frontFace=$p,$m.frontFace($p));},$P.bindTexture=function($m,$p,$h){$m.bindTexture($p,$h),$P.curBindTexTarget=$p,$P.curBindTexValue=$h;},$P.DEPTH_BUFFER_BIT=256,$P.STENCIL_BUFFER_BIT=1024,$P.COLOR_BUFFER_BIT=16384,$P.POINTS=0,$P.LINES=1,$P.LINE_LOOP=2,$P.LINE_STRIP=3,$P.TRIANGLES=4,$P.TRIANGLE_STRIP=5,$P.TRIANGLE_FAN=6,$P.ZERO=0,$P.ONE=1,$P.SRC_COLOR=768,$P.ONE_MINUS_SRC_COLOR=769,$P.SRC_ALPHA=770,$P.ONE_MINUS_SRC_ALPHA=771,$P.DST_ALPHA=772,$P.ONE_MINUS_DST_ALPHA=773,$P.DST_COLOR=774,$P.ONE_MINUS_DST_COLOR=775,$P.SRC_ALPHA_SATURATE=776,$P.FUNC_ADD=32774,$P.BLEND_EQUATION=32777,$P.BLEND_EQUATION_RGB=32777,$P.BLEND_EQUATION_ALPHA=34877,$P.FUNC_SUBTRACT=32778,$P.FUNC_REVERSE_SUBTRACT=32779,$P.BLEND_DST_RGB=32968,$P.BLEND_SRC_RGB=32969,$P.BLEND_DST_ALPHA=32970,$P.BLEND_SRC_ALPHA=32971,$P.CONSTANT_COLOR=32769,$P.ONE_MINUS_CONSTANT_COLOR=32770,$P.CONSTANT_ALPHA=32771,$P.ONE_MINUS_CONSTANT_ALPHA=32772,$P.BLEND_COLOR=32773,$P.ARRAY_BUFFER=34962,$P.ELEMENT_ARRAY_BUFFER=34963,$P.ARRAY_BUFFER_BINDING=34964,$P.ELEMENT_ARRAY_BUFFER_BINDING=34965,$P.STREAM_DRAW=35040,$P.STATIC_DRAW=35044,$P.DYNAMIC_DRAW=35048,$P.BUFFER_SIZE=34660,$P.BUFFER_USAGE=34661,$P.CURRENT_VERTEX_ATTRIB=34342,$P.FRONT=1028,$P.BACK=1029,$P.CULL_FACE=2884,$P.FRONT_AND_BACK=1032,$P.BLEND=3042,$P.DITHER=3024,$P.STENCIL_TEST=2960,$P.DEPTH_TEST=2929,$P.SCISSOR_TEST=3089,$P.POLYGON_OFFSET_FILL=32823,$P.SAMPLE_ALPHA_TO_COVERAGE=32926,$P.SAMPLE_COVERAGE=32928,$P.NO_ERROR=0,$P.INVALID_ENUM=1280,$P.INVALID_VALUE=1281,$P.INVALID_OPERATION=1282,$P.OUT_OF_MEMORY=1285,$P.CW=2304,$P.CCW=2305,$P.LINE_WIDTH=2849,$P.ALIASED_POINT_SIZE_RANGE=33901,$P.ALIASED_LINE_WIDTH_RANGE=33902,$P.CULL_FACE_MODE=2885,$P.FRONT_FACE=2886,$P.DEPTH_RANGE=2928,$P.DEPTH_WRITEMASK=2930,$P.DEPTH_CLEAR_VALUE=2931,$P.DEPTH_FUNC=2932,$P.STENCIL_CLEAR_VALUE=2961,$P.STENCIL_FUNC=2962,$P.STENCIL_FAIL=2964,$P.STENCIL_PASS_DEPTH_FAIL=2965,$P.STENCIL_PASS_DEPTH_PASS=2966,$P.STENCIL_REF=2967,$P.STENCIL_VALUE_MASK=2963,$P.STENCIL_WRITEMASK=2968,$P.STENCIL_BACK_FUNC=34816,$P.STENCIL_BACK_FAIL=34817,$P.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$P.STENCIL_BACK_PASS_DEPTH_PASS=34819,$P.STENCIL_BACK_REF=36003,$P.STENCIL_BACK_VALUE_MASK=36004,$P.STENCIL_BACK_WRITEMASK=36005,$P.VIEWPORT=2978,$P.SCISSOR_BOX=3088,$P.COLOR_CLEAR_VALUE=3106,$P.COLOR_WRITEMASK=3107,$P.UNPACK_ALIGNMENT=3317,$P.PACK_ALIGNMENT=3333,$P.MAX_TEXTURE_SIZE=3379,$P.MAX_VIEWPORT_DIMS=3386,$P.SUBPIXEL_BITS=3408,$P.RED_BITS=3410,$P.GREEN_BITS=3411,$P.BLUE_BITS=3412,$P.ALPHA_BITS=3413,$P.DEPTH_BITS=3414,$P.STENCIL_BITS=3415,$P.POLYGON_OFFSET_UNITS=10752,$P.POLYGON_OFFSET_FACTOR=32824,$P.TEXTURE_BINDING_2D=32873,$P.SAMPLE_BUFFERS=32936,$P.SAMPLES=32937,$P.SAMPLE_COVERAGE_VALUE=32938,$P.SAMPLE_COVERAGE_INVERT=32939,$P.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$P.COMPRESSED_TEXTURE_FORMATS=34467,$P.DONT_CARE=4352,$P.FASTEST=4353,$P.NICEST=4354,$P.GENERATE_MIPMAP_HINT=33170,$P.BYTE=5120,$P.UNSIGNED_BYTE=5121,$P.SHORT=5122,$P.UNSIGNED_SHORT=5123,$P.INT=5124,$P.UNSIGNED_INT=5125,$P.FLOAT=5126,$P.DEPTH_COMPONENT=6402,$P.ALPHA=6406,$P.RGB=6407,$P.RGBA=6408,$P.LUMINANCE=6409,$P.LUMINANCE_ALPHA=6410,$P.UNSIGNED_SHORT_4_4_4_4=32819,$P.UNSIGNED_SHORT_5_5_5_1=32820,$P.UNSIGNED_SHORT_5_6_5=33635,$P.FRAGMENT_SHADER=35632,$P.VERTEX_SHADER=35633,$P.MAX_VERTEX_ATTRIBS=34921,$P.MAX_VERTEX_UNIFORM_VECTORS=36347,$P.MAX_VARYING_VECTORS=36348,$P.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$P.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$P.MAX_TEXTURE_IMAGE_UNITS=34930,$P.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$P.SHADER_TYPE=35663,$P.DELETE_STATUS=35712,$P.LINK_STATUS=35714,$P.VALIDATE_STATUS=35715,$P.ATTACHED_SHADERS=35717,$P.ACTIVE_UNIFORMS=35718,$P.ACTIVE_ATTRIBUTES=35721,$P.SHADING_LANGUAGE_VERSION=35724,$P.CURRENT_PROGRAM=35725,$P.NEVER=512,$P.LESS=513,$P.EQUAL=514,$P.LEQUAL=515,$P.GREATER=516,$P.NOTEQUAL=517,$P.GEQUAL=518,$P.ALWAYS=519,$P.KEEP=7680,$P.REPLACE=7681,$P.INCR=7682,$P.DECR=7683,$P.INVERT=5386,$P.INCR_WRAP=34055,$P.DECR_WRAP=34056,$P.VENDOR=7936,$P.RENDERER=7937,$P.VERSION=7938,$P.NEAREST=9728,$P.LINEAR=9729,$P.NEAREST_MIPMAP_NEAREST=9984,$P.LINEAR_MIPMAP_NEAREST=9985,$P.NEAREST_MIPMAP_LINEAR=9986,$P.LINEAR_MIPMAP_LINEAR=9987,$P.TEXTURE_MAG_FILTER=10240,$P.TEXTURE_MIN_FILTER=10241,$P.TEXTURE_WRAP_S=10242,$P.TEXTURE_WRAP_T=10243,$P.TEXTURE_2D=3553,$P.TEXTURE=5890,$P.TEXTURE_CUBE_MAP=34067,$P.TEXTURE_BINDING_CUBE_MAP=34068,$P.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$P.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$P.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$P.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$P.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$P.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$P.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$P.TEXTURE0=33984,$P.TEXTURE1=33985,$P.TEXTURE2=33986,$P.TEXTURE3=33987,$P.TEXTURE4=33988,$P.TEXTURE5=33989,$P.TEXTURE6=33990,$P.TEXTURE7=33991,$P.TEXTURE8=33992,$P.TEXTURE9=33993,$P.TEXTURE10=33994,$P.TEXTURE11=33995,$P.TEXTURE12=33996,$P.TEXTURE13=33997,$P.TEXTURE14=33998,$P.TEXTURE15=33999,$P.TEXTURE16=34e3,$P.TEXTURE17=34001,$P.TEXTURE18=34002,$P.TEXTURE19=34003,$P.TEXTURE20=34004,$P.TEXTURE21=34005,$P.TEXTURE22=34006,$P.TEXTURE23=34007,$P.TEXTURE24=34008,$P.TEXTURE25=34009,$P.TEXTURE26=34010,$P.TEXTURE27=34011,$P.TEXTURE28=34012,$P.TEXTURE29=34013,$P.TEXTURE30=34014,$P.TEXTURE31=34015,$P.ACTIVE_TEXTURE=34016,$P.REPEAT=10497,$P.CLAMP_TO_EDGE=33071,$P.MIRRORED_REPEAT=33648,$P.FLOAT_VEC2=35664,$P.FLOAT_VEC3=35665,$P.FLOAT_VEC4=35666,$P.INT_VEC2=35667,$P.INT_VEC3=35668,$P.INT_VEC4=35669,$P.BOOL=35670,$P.BOOL_VEC2=35671,$P.BOOL_VEC3=35672,$P.BOOL_VEC4=35673,$P.FLOAT_MAT2=35674,$P.FLOAT_MAT3=35675,$P.FLOAT_MAT4=35676,$P.SAMPLER_2D=35678,$P.SAMPLER_CUBE=35680,$P.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$P.VERTEX_ATTRIB_ARRAY_SIZE=34339,$P.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$P.VERTEX_ATTRIB_ARRAY_TYPE=34341,$P.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$P.VERTEX_ATTRIB_ARRAY_POINTER=34373,$P.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$P.COMPILE_STATUS=35713,$P.LOW_FLOAT=36336,$P.MEDIUM_FLOAT=36337,$P.HIGH_FLOAT=36338,$P.LOW_INT=36339,$P.MEDIUM_INT=36340,$P.HIGH_INT=36341,$P.FRAMEBUFFER=36160,$P.RENDERBUFFER=36161,$P.RGBA4=32854,$P.RGB5_A1=32855,$P.RGB565=36194,$P.DEPTH_COMPONENT16=33189,$P.STENCIL_INDEX=6401,$P.STENCIL_INDEX8=36168,$P.DEPTH_STENCIL=34041,$P.RENDERBUFFER_WIDTH=36162,$P.RENDERBUFFER_HEIGHT=36163,$P.RENDERBUFFER_INTERNAL_FORMAT=36164,$P.RENDERBUFFER_RED_SIZE=36176,$P.RENDERBUFFER_GREEN_SIZE=36177,$P.RENDERBUFFER_BLUE_SIZE=36178,$P.RENDERBUFFER_ALPHA_SIZE=36179,$P.RENDERBUFFER_DEPTH_SIZE=36180,$P.RENDERBUFFER_STENCIL_SIZE=36181,$P.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$P.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$P.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$P.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$P.COLOR_ATTACHMENT0=36064,$P.DEPTH_ATTACHMENT=36096,$P.STENCIL_ATTACHMENT=36128,$P.DEPTH_STENCIL_ATTACHMENT=33306,$P.NONE=0,$P.FRAMEBUFFER_COMPLETE=36053,$P.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$P.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$P.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$P.FRAMEBUFFER_UNSUPPORTED=36061,$P.FRAMEBUFFER_BINDING=36006,$P.RENDERBUFFER_BINDING=36007,$P.MAX_RENDERBUFFER_SIZE=34024,$P.INVALID_FRAMEBUFFER_OPERATION=1286,$P.UNPACK_FLIP_Y_WEBGL=37440,$P.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$P.CONTEXT_LOST_WEBGL=37442,$P.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$P.BROWSER_DEFAULT_WEBGL=37444,$P._useProgram=null,$P._depthTest=!0,$P._depthMask=!0,$P._blend=!1,$P._cullFace=!1,$P.curBindTexTarget=null,$P.curBindTexValue=null,$k($P,["_depthFunc",function(){return this._depthFunc=513;},"_sFactor",function(){return this._sFactor=1;},"_dFactor",function(){return this._dFactor=0;},"_frontFace",function(){return this._frontFace=2305;}]),$P;}(),$Wm=function($m){function $p(){$p.__super.call(this);}$R($p,"laya.webgl.display.GraphicsGL",$Y);var $h=$p.prototype;return $h.setShader=function($m){this._saveToCmd($c.context._setShader,[$m]);},$h.setIBVB=function($m,$p,$h,$P,$L,$q){this._saveToCmd($c.context._setIBVB,[$m,$p,$h,$P,$L,$q]);},$h.drawParticle=function($m,$p,$h){var $P=$H.createParticleTemplate2D($h);$P.x=$m,$P.y=$p,this._saveToCmd($c.context._drawParticle,[$P]);},$p;}(),$Em=function($m){var $h;function $X($m){this._x=0,this._y=0,this._id=++$X._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$X.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$X.MAXCLIPRECT,this.mOutPoint,this._canvas=$m,this._canvas._addReference(),$X._contextcount++,$c.isFlash?(this._ib=$Om.create(35044),$nm.fillIBQuadrangle(this._ib,16)):this._ib=$Om.QuadrangleIB,this.clear();}$R($X,"laya.webgl.canvas.WebGLContext2D",$L);var $p=$X.prototype;return $p.setIsMainContext=function(){this._isMain=!0;},$p.clearBG=function($m,$p,$h,$P){var $L=$Zm.mainContext;$L.clearColor($m,$p,$h,$P),$L.clear(16384);},$p._getSubmits=function(){return this._submits;},$p._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $m=0,$p=this._submits._length;$m<$p;$m++)this._submits[$m].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null);}},$p.destroy=function(){--$X._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$Om.QuadrangleIB&&this._ib.releaseResource();},$p.clear=function(){this._submits||(this._other=$h.DEFAULT,this._curMat=$b.create(),this._vb=$Cm.create(-1),this._submits=[],this._save=[$i.Create(this)],this._save.length=10,this._shader2D=new $O(),this._triangleMesh=$_m.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$h.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$X.MAXCLIPRECT,this._curSubmit=$qm.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$r.DEFAULT;for(var $m=0,$p=this._submits._length;$m<$p;$m++)this._submits[$m].releaseRender(),this._submits[$m]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1;},$p.size=function($m,$p){if(this._width!=$m||this._height!=$p)if(0==$m||0==$p){0!=this._vb._byteLength&&(this._width=$m,this._height=$p,this._vb.clear(),this._vb.upload());for(var $h=0,$P=this._submits._length;$h<$P;$h++)this._submits[$h].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null;}else this._width=$m,this._height=$p,this._targets&&this._targets.size($m,$p),this._canvas.memorySize-=this._canvas.memorySize;0===$m&&0===$p&&this._releaseMem();},$p._getTransformMatrix=function(){return this._curMat;},$p.translate=function($m,$p){0===$m&&0===$p||($g.save(this),this._curMat.bTransform&&($v.save(this),this._curMat.transformPointN($T.TEMP.setTo($m,$p)),$m=$T.TEMP.x,$p=$T.TEMP.y),this._x+=$m,this._y+=$p);},$p.save=function(){this._save[this._save._length++]=$i.Create(this);},$p.restore=function(){var $m=this._save._length;if(!($m<1))for(var $p=$m-1;0<=$p;$p--){var $h=this._save[$p];if($h.restore(this),$h.isSaveMark())return void(this._save._length=$p);}},$p._fillText=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){void 0===$K&&($K=0);var $D=this._shader2D,$F=this._curSubmit.shaderValue,$R=$L?$Am.create($L):this._other.font;if($s.enabled)$D.ALPHA!==$F.ALPHA&&($D.glTexture=null),$$m.drawText(this,$m,$p,this._curMat,$R,$d||this._other.textAlign,$q,$k,$Y,$h,$P,$K);else{this._shader2D.defines.getValue();var $$=$q?$A.create($q)._color:$D.colorAdd;$D.ALPHA===$F.ALPHA&&$$===$D.colorAdd&&$F.colorAdd===$D.colorAdd||($D.glTexture=null,$D.colorAdd=$$),$$m.drawText(this,$m,$p,this._curMat,$R,$d||this._other.textAlign,$q,$k,$Y,$h,$P,$K);}},$p.fillWords=function($m,$p,$h,$P,$L,$q){this._fillText(null,$m,$p,$h,$P,$L,null,-1,null,$q);},$p.fillBorderWords=function($m,$p,$h,$P,$L,$q,$k){this._fillBorderText(null,$m,$p,$h,$P,$L,$q,$k,null);},$p.fillText=function($m,$p,$h,$P,$L,$q){this._fillText($m,null,$p,$h,$P,$L,null,-1,$q);},$p.strokeText=function($m,$p,$h,$P,$L,$q,$k){this._fillText($m,null,$p,$h,$P,null,$L,$q||1,$k);},$p.fillBorderText=function($m,$p,$h,$P,$L,$q,$k,$Y){this._fillBorderText($m,null,$p,$h,$P,$L,$q,$k,$Y);},$p._fillBorderText=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){if(!$s.enabled)return this._fillText($m,$p,$h,$P,$L,null,$k,$Y||1,$d),void this._fillText($m,$p,$h,$P,$L,$q,null,-1,$d);var $K=this._shader2D,$D=this._curSubmit.shaderValue;$K.ALPHA!==$D.ALPHA&&($K.glTexture=null);var $F=$L?($X._fontTemp.setFont($L),$X._fontTemp):this._other.font;$$m.drawText(this,$m,$p,this._curMat,$F,$d||this._other.textAlign,$q,$k,$Y||1,$h,$P,0);},$p.fillRect=function($m,$p,$h,$P,$L){var $q=this._vb;if($nm.fillRectImgVb($q,this._clipRect,$m,$p,$h,$P,$_.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $k=this._shader2D.fillStyle;$L&&(this._shader2D.fillStyle=$r.create($L));var $Y=this._shader2D,$d=this._curSubmit.shaderValue;if($Y.fillStyle!==$d.fillStyle||$Y.ALPHA!==$d.ALPHA){$Y.glTexture=null;var $K=this._curSubmit=$qm.createSubmit(this,this._ib,$q,($q._byteLength-64)/32*3,$Im.create(2,0));$K.shaderValue.color=$Y.fillStyle._color._color,$K.shaderValue.ALPHA=$Y.ALPHA,this._submits[this._submits._length++]=$K;}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$k;}},$p.fillTexture=function($m,$p,$h,$P,$L,$q,$k,$Y){if($m.loaded&&$m.bitmap&&$m.source){var $d=this._vb,$K=$m.bitmap.width,$D=$m.bitmap.height,$F=$m.uv,$R=$k.x%$m.width,$$=$k.y%$m.height;if($K!=$Y.w||$D!=$Y.h){if(!$Y.w&&!$Y.h)switch($Y.oy=$Y.ox=0,$q){case"repeat":$Y.width=$P,$Y.height=$L;break;case"repeat-x":$Y.width=$P,$$<0?$m.height+$$>$L?$Y.height=$L:$Y.height=$m.height+$$:($Y.oy=$$,$m.height+$$>$L?$Y.height=$L-$$:$Y.height=$m.height);break;case"repeat-y":$R<0?$m.width+$R>$P?$Y.width=$P:$Y.width=$m.width+$R:($Y.ox=$R,$m.width+$R>$P?$Y.width=$P-$R:$Y.width=$m.width),$Y.height=$L;break;case"no-repeat":$R<0?$m.width+$R>$P?$Y.width=$P:$Y.width=$m.width+$R:($Y.ox=$R,$m.width+$R>$P?$Y.width=$P-$R:$Y.width=$m.width),$$<0?$m.height+$$>$L?$Y.height=$L:$Y.height=$m.height+$$:($Y.oy=$$,$m.height+$$>$L?$Y.height=$L-$$:$Y.height=$m.height);break;default:$Y.width=$P,$Y.height=$L;}$Y.w=$K,$Y.h=$D,$Y.uv=[0,0,$Y.width/$K,0,$Y.width/$K,$Y.height/$D,0,$Y.height/$D];}if($p+=$Y.ox,$h+=$Y.oy,$R-=$Y.ox,$$-=$Y.oy,$nm.fillRectImgVb($d,this._clipRect,$p,$h,$Y.width,$Y.height,$Y.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $A=$Sm.create(this,this._ib,$d,($d._byteLength-64)/32*3,$Im.create(256,0)),$B=(this._submits[this._submits._length++]=$A).shaderValue;$B.textureHost=$m;var $n=$F[0]*$K,$c=$F[1]*$D,$e=($F[2]-$F[0])*$K,$a=($F[5]-$F[3])*$D,$Z=-$R/$K,$H=-$$/$D;$B.u_TexRange[0]=$n/$K,$B.u_TexRange[1]=$e/$K,$B.u_TexRange[2]=$c/$D,$B.u_TexRange[3]=$a/$D,$B.u_offset[0]=$Z,$B.u_offset[1]=$H,$s.enabled&&!this._isMain&&$A.addTexture($m,($d._byteLength>>2)-16),(this._curSubmit=$A)._renderType=10017,$A._numEle+=6;}}else this.sprite&&$W.timer.callLater(this,this._repaintSprite);},$p.setShader=function($m){$V.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$m;},$p.setFilters=function($m){$V.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$m,this._curSubmit=$qm.RENDERBASE,this._renderKey=0,this._drawCount++;},$p.drawTexture=function($m,$p,$h,$P,$L,$q,$k){this._drawTextureM($m,$p,$h,$P,$L,$q,$k,null,1);},$p.addTextureVb=function($m,$p,$h){var $P=this._curSubmit._vb||this._vb,$L=$P._byteLength>>2;$P.byteLength=$L+16<<2;for(var $q=$P.getFloat32Array(),$k=0;$k<16;$k+=4)$q[$L++]=$m[$k]+$p,$q[$L++]=$m[$k+1]+$h,$q[$L++]=$m[$k+2],$q[$L++]=$m[$k+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$P._upload=!0;},$p.willDrawTexture=function($m,$p){if(!($m.loaded&&$m.bitmap&&$m.source))return this.sprite&&$W.timer.callLater(this,this._repaintSprite),0;var $h=$m.bitmap,$P=$h.id+this._shader2D.ALPHA*$p+10016;if($P==this._renderKey)return $P;var $L=this._shader2D,$q=$L.ALPHA,$k=this._curSubmit.shaderValue;$L.ALPHA*=$p,this._renderKey=$P,this._drawCount++,$L.glTexture=$h;var $Y=this._vb,$d=null,$K=$Y._byteLength/32*3,$D=$k.textureHost&&$k.textureHost==$m&&$k.textureHost.alphaTexture==$m.alphaTexture;return $d=$Sm.create(this,this._ib,$Y,$K,$Im.create(1,0)),(this._submits[this._submits._length++]=$d).shaderValue.textureHost=$m,$d._renderType=10016,$d._preIsSameTextureShader=10016===this._curSubmit._renderType&&$L.ALPHA===$k.ALPHA&&$D,this._curSubmit=$d,$L.ALPHA=$q,$P;},$p.drawTextures=function($m,$p,$h,$P){if($m.loaded&&$m.bitmap&&$m.source){var $L=this._clipRect;if(this._clipRect=$X.MAXCLIPRECT,this._drawTextureM($m,$p[0],$p[1],$m.width,$m.height,$h,$P,null,1)){if(this._clipRect=$L,$M.drawCall++,!($p.length<4)){for(var $q=this._curSubmit._vb||this._vb,$k=this._curMat.a,$Y=this._curMat.d,$d=2,$K=$p.length;$d<$K;$d+=2)$nm.copyPreImgVb($q,($p[$d]-$p[$d-2])*$k,($p[$d+1]-$p[$d-1])*$Y),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);}}else alert("drawTextures err");}else this.sprite&&$W.timer.callLater(this,this._repaintSprite);},$p._drawTextureM=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){if(!$m.loaded||!$m.source)return this.sprite&&$W.timer.callLater(this,this._repaintSprite),!1;var $K=this._curSubmit._vb||this._vb,$D=$m.bitmap;$p+=$q,$h+=$k,this._drawCount++;var $F=$D.id+this._shader2D.ALPHA*$d+10016;if($F!=this._renderKey){this._renderKey=$F;var $R=this._curSubmit.shaderValue,$$=this._shader2D,$A=$$.ALPHA;$$.ALPHA*=$d,$$.glTexture=$D;var $B=this._vb,$n=null,$c=$B._byteLength/32*3,$e=$R.textureHost&&$R.textureHost==$m&&$R.textureHost.alphaTexture==$m.alphaTexture;$n=$Sm.create(this,this._ib,$B,$c,$Im.create(1,0)),(this._submits[this._submits._length++]=$n).shaderValue.textureHost=$m,$n._renderType=10016,$n._preIsSameTextureShader=10016===this._curSubmit._renderType&&$$.ALPHA===$R.ALPHA&&$e,this._curSubmit=$n,$K=this._curSubmit._vb||this._vb,$$.ALPHA=$A;}return!!$nm.fillRectImgVb($K,this._clipRect,$p,$h,$P||$m.width,$L||$m.height,$m.uv,$Y||this._curMat,this._x,this._y,0,0)&&($s.enabled&&!this._isMain&&this._curSubmit.addTexture($m,($K._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0);},$p._repaintSprite=function(){this.sprite&&this.sprite.repaint();},$p._drawText=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){var $D=$m.bitmap;this._drawCount++;var $F=$D.id+this._shader2D.ALPHA+10016;if($F!=this._renderKey){this._renderKey=$F;var $R=this._curSubmit.shaderValue,$$=this._shader2D;$$.glTexture=$D;var $A=this._vb,$B=null,$n=$A._byteLength/32*3,$c=$R.textureHost&&$R.textureHost==$m&&$R.textureHost.alphaTexture==$m.alphaTexture;($B=$s.enabled?$Sm.create(this,this._ib,$A,$n,$Im.create(1,0)):$Sm.create(this,this._ib,$A,$n,$gm.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$$.ALPHA===$R.ALPHA&&$c,(this._submits[this._submits._length++]=$B).shaderValue.textureHost=$m,$B._renderType=10016,this._curSubmit=$B;}$m.active();var $e=this._curSubmit._vb||this._vb;$nm.fillRectImgVb($e,this._clipRect,$p+$k,$h+$Y,$P||$m.width,$L||$m.height,$m.uv,$q||this._curMat,this._x,this._y,$d,$K,!0)&&($s.enabled&&!this._isMain&&this._curSubmit.addTexture($m,($e._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle));},$p.drawTextureWithTransform=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){if($q){var $K=this._curMat,$D=this._x,$F=this._y;(0!==$k||0!==$Y)&&(this._x=$k*$K.a+$Y*$K.c,this._y=$Y*$K.d+$k*$K.b),$q&&$K.bTransform?($b.mul($q,$K,$X._tmpMatrix),($q=$X._tmpMatrix)._checkTransform()):(this._x+=$K.tx,this._y+=$K.ty),this._drawTextureM($m,$p,$h,$P,$L,0,0,$q,$d),this._x=$D,this._y=$F;}else this._drawTextureM($m,$p,$h,$P,$L,$k,$Y,null,$d);},$p.fillQuadrangle=function($m,$p,$h,$P,$L){var $q=this._curSubmit,$k=this._vb,$Y=this._shader2D,$d=$q.shaderValue;if(this._renderKey=0,$m.bitmap){var $K=$m.bitmap;$Y.glTexture==$K&&$Y.ALPHA===$d.ALPHA||($Y.glTexture=$K,($q=this._curSubmit=$qm.createSubmit(this,this._ib,$k,$k._byteLength/32*3,$Im.create(1,0))).shaderValue.glTexture=$K,this._submits[this._submits._length++]=$q),$nm.fillQuadrangleImgVb($k,$p,$h,$P,$m.uv,$L||this._curMat,this._x,this._y);}else $q.shaderValue.fillStyle&&$q.shaderValue.fillStyle.equal($m)&&$Y.ALPHA===$d.ALPHA||($Y.glTexture=null,($q=this._curSubmit=$qm.createSubmit(this,this._ib,$k,$k._byteLength/32*3,$Im.create(2,0))).shaderValue.defines.add(2),$q.shaderValue.fillStyle=$r.create($m),this._submits[this._submits._length++]=$q),$nm.fillQuadrangleImgVb($k,$p,$h,$P,$_.DEF_UV,$L||this._curMat,this._x,this._y);$q._numEle+=6;},$p.drawTexture2=function($m,$p,$h,$P,$L,$q,$k,$Y){if(0!=$q){var $d=this._curMat;if(this._x=$m*$d.a+$p*$d.c,this._y=$p*$d.d+$m*$d.b,$L&&($L=$d.bTransform||$L.bTransform?($b.mul($L,$d,$X._tmpMatrix),$X._tmpMatrix):(this._x+=$L.tx+$d.tx,this._y+=$L.ty+$d.ty,$b.EMPTY)),1!==$q||$k){var $K=this._shader2D.ALPHA,$D=this._nBlendType;this._shader2D.ALPHA=$q,$k&&(this._nBlendType=$U.TOINT($k)),this._drawTextureM($Y[0],$Y[1]-$h,$Y[2]-$P,$Y[3],$Y[4],0,0,$L,1),this._shader2D.ALPHA=$K,this._nBlendType=$D;}else this._drawTextureM($Y[0],$Y[1]-$h,$Y[2]-$P,$Y[3],$Y[4],0,0,$L,1);this._x=this._y=0;}},$p.drawCanvas=function($m,$p,$h,$P,$L){var $q=$m.context;if(this._renderKey=0,$q._targets)this._submits[this._submits._length++]=$Nm.create($q,0,null),this._curSubmit=$qm.RENDERBASE,$q._targets.drawTo(this,$p,$h,$P,$L);else{var $k=this._submits[this._submits._length++]=$Nm.create($q,this._shader2D.ALPHA,this._shader2D.filters),$Y=$P/$m.width,$d=$L/$m.height,$K=$k._matrix;this._curMat.copyTo($K),1!=$Y&&1!=$d&&$K.scale($Y,$d);var $D=$K.tx,$F=$K.ty;$K.tx=$K.ty=0,$K.transformPoint($T.TEMP.setTo($p,$h)),$K.translate($T.TEMP.x+$D,$T.TEMP.y+$F),this._curSubmit=$qm.RENDERBASE;}$E.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$q._targets?"yellow":"green",this.strokeRect($p-1,$h-1,$P+2,$L+2,1),this.strokeRect($p,$h,$P,$L,1),this.restore());},$p.drawTarget=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){void 0===$K&&($K=-1);var $D=this._vb;if($nm.fillRectImgVb($D,this._clipRect,$p,$h,$P,$L,$d||$_.DEF_UV,$q||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $F=this._curSubmit=$Fm.create(this,this._ib,$D,($D._byteLength-64)/32*3,$Y,$k);$F.blendType=-1==$K?this._nBlendType:$K,$F.scope=$m,this._submits[this._submits._length++]=$F,this._curSubmit._numEle+=6;}},$p.mixRGBandAlpha=function($m){return this._mixRGBandAlpha($m,this._shader2D.ALPHA);},$p._mixRGBandAlpha=function($m,$p){var $h=(4278190080&$m)>>>24;return 0!=$h?$h*=$p:$h=255*$p,16777215&$m|$h<<24;},$p.drawTriangles=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){if(!$m.loaded||!$m.source)return this.sprite&&$W.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$m.bitmap;var $D=this._mixRGBandAlpha(4294967295,$Y),$F=($P.length,$q.length);this._renderKey=-1;var $R=this._curSubmit=$Sm.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$Im.create(1,0));return $R.shaderValue.textureHost=$m,$R._renderType=10016,this._submits[this._submits._length++]=$R,$k?($X._tmpMatrix.a=$k.a,$X._tmpMatrix.b=$k.b,$X._tmpMatrix.c=$k.c,$X._tmpMatrix.d=$k.d,$X._tmpMatrix.tx=$k.tx+$p,$X._tmpMatrix.ty=$k.ty+$h,$b.mul($X._tmpMatrix,this._curMat,$X._tmpMatrix)):($X._tmpMatrix.a=this._curMat.a,$X._tmpMatrix.b=this._curMat.b,$X._tmpMatrix.c=this._curMat.c,$X._tmpMatrix.d=this._curMat.d,$X._tmpMatrix.tx=this._curMat.tx+$p,$X._tmpMatrix.ty=this._curMat.ty+$h),this._triangleMesh.addData($P,$L,$q,$X._tmpMatrix,$D,this),this._curSubmit._numEle+=$F,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0;},$p.transform=function($m,$p,$h,$P,$L,$q){$v.save(this),$b.mul($b.TEMP.setTo($m,$p,$h,$P,$L,$q),this._curMat,this._curMat),this._curMat._checkTransform();},$p.setTransformByMatrix=function($m){$m.copyTo(this._curMat);},$p.transformByMatrix=function($m){$v.save(this),$b.mul($m,this._curMat,this._curMat),this._curMat._checkTransform();},$p.rotate=function($m){$v.save(this),this._curMat.rotateEx($m);},$p.scale=function($m,$p){$v.save(this),this._curMat.scaleEx($m,$p);},$p.clipRect=function($m,$p,$h,$P){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $L=$Dm.create(4);this.addRenderObject($L);var $q=this._vb,$k=$q._byteLength>>2;if($nm.fillRectImgVb($q,null,$m,$p,$h,$P,$_.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $Y=this._curSubmit=$qm.createSubmit(this,this._ib,$q,($q._byteLength-64)/32*3,$Im.create(2,0));$Y.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$Y,this._curSubmit._numEle+=6;}else alert("clipRect calc stencil rect error");var $d=$Dm.create(5);this.addRenderObject($d);var $K=$q.getFloat32Array(),$D=Math.min(Math.min(Math.min($K[0+$k],$K[4+$k]),$K[8+$k]),$K[12+$k]),$F=Math.max(Math.max(Math.max($K[0+$k],$K[4+$k]),$K[8+$k]),$K[12+$k]),$R=Math.min(Math.min(Math.min($K[1+$k],$K[5+$k]),$K[9+$k]),$K[13+$k]),$$=Math.max(Math.max(Math.max($K[1+$k],$K[5+$k]),$K[9+$k]),$K[13+$k]);$f.save(this,$d,$m,$p,$h,$P,$D,$R,$F-$D,$$-$R),this._curSubmit=$qm.RENDERBASE;}else{$h*=this._curMat.a,$P*=this._curMat.d;var $A=$T.TEMP;this._curMat.transformPoint($A.setTo($m,$p)),$h<0&&($A.x=$A.x+$h,$h=-$h),$P<0&&($A.y=$A.y+$P,$P=-$P),this._renderKey=0;var $B=this._curSubmit=$Km.create(this);(this._submits[this._submits._length++]=$B).submitIndex=this._submits._length,$B.submitLength=9999999,$o.save(this,$B);var $n=this._clipRect,$c=$n.x,$e=$n.y,$a=$A.x+$h,$Z=$A.y+$P;$c<$A.x&&($n.x=$A.x),$e<$A.y&&($n.y=$A.y),$n.width=Math.min($a,$c+$n.width)-$n.x,$n.height=Math.min($Z,$e+$n.height)-$n.y,this._shader2D.glTexture=null,$B.clipRect.copyFrom($n),this._curSubmit=$qm.RENDERBASE;}},$p.setIBVB=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D){if(void 0===$d&&($d=0),void 0===$K&&($K=0),void 0===$D&&($D=0),null===$h){if($c.isFlash){var $F=$P;$F._selfIB||($F._selfIB=$Om.create(35044)),$F._selfIB.clear(),$h=$F._selfIB;}else $h=this._ib;$nm.expandIBQuadrangle($h,$P._byteLength/(4*$P.vertexStride*4));}if(!$Y||!$k)throw Error("setIBVB must input:shader shaderValues");var $R=$dm.create(this,$P,$h,$L,$k,$Y,$d,$K,$D);$q||($q=$b.EMPTY),$q.translate($m,$p),$b.mul($q,this._curMat,$R._mat),$q.translate(-$m,-$p),this._submits[this._submits._length++]=$R,this._curSubmit=$qm.RENDERBASE,this._renderKey=0;},$p.addRenderObject=function($m){this._submits[this._submits._length++]=$m;},$p.fillTrangles=function($m,$p,$h,$P,$L){var $q=this._curSubmit,$k=this._vb,$Y=this._shader2D,$d=$q.shaderValue,$K=$P.length>>4,$D=$m.bitmap;this._renderKey=0,$Y.glTexture==$D&&$Y.ALPHA===$d.ALPHA||(($q=this._curSubmit=$qm.createSubmit(this,this._ib,$k,$k._byteLength/32*3,$Im.create(1,0))).shaderValue.textureHost=$m,this._submits[this._submits._length++]=$q),$nm.fillTranglesVB($k,$p,$h,$P,$L||this._curMat,this._x,this._y),$q._numEle+=6*$K;},$p.submitElement=function($m,$p){var $h=this._submits;for($p<0&&($p=$h._length);$m<$p;)$m+=$h[$m].renderSubmit();},$p.finish=function(){$Zm.mainContext.finish();},$p.flush=function(){var $m=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($m>this._ib.bufferLength/12&&$nm.expandIBQuadrangle(this._ib,$m),!this._isMain&&$s.enabled&&$s._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$s._atlasRestore;for(var $p=this._submits,$h=0,$P=$p._length;$h<$P;$h++){var $L=$p[$h];10016===$L.getRenderType()&&$L.checkTexture();}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$pm.instance&&$pm.getInstance().reset();var $q;for($h=0,$q=this.meshlist.length;$h<$q;$h++){var $k=this.meshlist[$h];$k.canReuse?$k.releaseMesh():$k.destroy();}return this.meshlist.length=0,this._curSubmit=$qm.RENDERBASE,this._renderKey=0,this._triangleMesh=$_m.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length;},$p.setPathId=function($m){if(this.mId=$m,-1!=this.mId){this.mHaveKey=!1;var $p=$J.getInstance();$p.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$p.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0);}},$p.movePath=function($m,$p){var $h=$m,$P=$p;$m=this._curMat.a*$h+this._curMat.c*$P+this._curMat.tx,$p=this._curMat.b*$h+this._curMat.d*$P+this._curMat.ty,this.mX+=$m,this.mY+=$p;},$p.beginPath=function(){var $m=this._getPath();$m.tempArray.length=0,$m.closePath=!1,this.mX=0,this.mY=0;},$p.closePath=function(){this._path.closePath=!0;},$p.fill=function($m){void 0===$m&&($m=!1);var $p=this._getPath();this.drawPoly(0,0,$p.tempArray,this.fillStyle._color.numColor,0,0,$m);},$p.stroke=function(){var $m=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$m.drawLine(0,0,$m.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $p=$J.getInstance().shapeLineDic[this.mId];$p.rebuild($m.tempArray),$m.setGeomtry($p);}else $J.getInstance().addLine(this.mId,$m.drawLine(0,0,$m.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$m.update();var $h=[this.mX,this.mY],$P=$qm.createShape(this,$m.ib,$m.vb,$m.count,$m.offset,$Im.create(4,0));$P.shaderValue.ALPHA=this._shader2D.ALPHA,$P.shaderValue.u_pos=$h,$P.shaderValue.u_mmat2=$em.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$P,this._renderKey=-1;}},$p.line=function($m,$p,$h,$P,$L,$q){var $k=this._curSubmit,$Y=this._vb;if($nm.fillLineVb($Y,this._clipRect,$m,$p,$h,$P,$L,$q)){this._renderKey=0;var $d=this._shader2D,$K=$k.shaderValue;$d.strokeStyle===$K.strokeStyle&&$d.ALPHA===$K.ALPHA||($d.glTexture=null,($k=this._curSubmit=$qm.createSubmit(this,this._ib,$Y,($Y._byteLength-64)/32*3,$Im.create(2,0))).shaderValue.strokeStyle=$d.strokeStyle,$k.shaderValue.mainID=2,$k.shaderValue.ALPHA=$d.ALPHA,this._submits[this._submits._length++]=$k),$k._numEle+=6;}},$p.moveTo=function($m,$p,$h){void 0===$h&&($h=!0);var $P=this._getPath();if($h){var $L=$m,$q=$p;$m=this._curMat.a*$L+this._curMat.c*$q,$p=this._curMat.b*$L+this._curMat.d*$q;}$P.addPoint($m,$p);},$p.lineTo=function($m,$p,$h){void 0===$h&&($h=!0);var $P=this._getPath();if($h){var $L=$m,$q=$p;$m=this._curMat.a*$L+this._curMat.c*$q,$p=this._curMat.b*$L+this._curMat.d*$q;}$P.addPoint($m,$p);},$p.drawCurves=function($m,$p,$h){this.setPathId(-1),this.beginPath(),this.strokeStyle=$h[3],this.lineWidth=$h[4];var $P=$h[2];$m+=$h[0],$p+=$h[1],this.movePath($m,$p),this.moveTo($P[0],$P[1]);for(var $L=2,$q=$P.length;$L<$q;)this.quadraticCurveTo($P[$L++],$P[$L++],$P[$L++],$P[$L++]);this.stroke();},$p.arcTo=function($m,$p,$h,$P,$L){if(-1==this.mId||!this.mHaveKey){var $q=0,$k=0,$Y=0,$d=this._getPath();this._curMat.copyTo($X._tmpMatrix),$X._tmpMatrix.tx=$X._tmpMatrix.ty=0,$X._tempPoint.setTo($d.getEndPointX(),$d.getEndPointY()),$X._tmpMatrix.invertTransformPoint($X._tempPoint);var $K=$X._tempPoint.x-$m,$D=$X._tempPoint.y-$p,$F=Math.sqrt($K*$K+$D*$D);if(!($F<=1e-6)){var $R=$K/$F,$$=$D/$F,$A=$h-$m,$B=$P-$p,$n=$A*$A+$B*$B,$c=Math.sqrt($n);if(!($c<=1e-6)){var $e=$A/$c,$a=$B/$c,$Z=$R+$e,$H=$$+$a,$W=Math.sqrt($Z*$Z+$H*$H);if(!($W<=1e-6)){var $E=$Z/$W,$I=$H/$W,$b=Math.acos($E*$R+$I*$$),$T=Math.PI/2-$b,$j=($F=$L/Math.tan($T))*$R+$m,$x=$F*$$+$p,$Q=Math.sqrt($F*$F+$L*$L),$M=$m+$E*$Q,$u=$p+$I*$Q,$N=0,$S=0;if(0<=$R*$a-$$*$e){var $_=2*$T/$X.SEGNUM;$N=Math.sin($_),$S=Math.cos($_);}else $_=2*-$T/$X.SEGNUM,$N=Math.sin($_),$S=Math.cos($_);$k=this._curMat.a*$j+this._curMat.c*$x,$Y=this._curMat.b*$j+this._curMat.d*$x,$k==this._path.getEndPointX()&&$Y==this._path.getEndPointY()||$d.addPoint($k,$Y);var $l=$j-$M,$J=$x-$u;for($q=0;$q<$X.SEGNUM;$q++){var $z=$l*$S+$J*$N,$w=-$l*$N+$J*$S;$k=$z+$M,$Y=$w+$u,$m=this._curMat.a*$k+this._curMat.c*$Y,$Y=$p=this._curMat.b*$k+this._curMat.d*$Y,($k=$m)==this._path.getEndPointX()&&$Y==this._path.getEndPointY()||$d.addPoint($k,$Y),$l=$z,$J=$w;}}}}}},$p.arc=function($m,$p,$h,$P,$L,$q,$k){if(void 0===$q&&($q=!1),void 0===$k&&($k=!0),-1!=this.mId){var $Y=$J.getInstance().shapeDic[this.mId];if($Y&&this.mHaveKey&&!$Y.needUpdate(this._curMat))return;$p=$m=0;}var $d,$K=0,$D=0,$F=0,$R=0,$$=0,$A=0,$B=0;if($D=$L-$P,$q){if(Math.abs($D)>=2*Math.PI)$D=2*-Math.PI;else for(;0<$D;)$D-=2*Math.PI;}else if(Math.abs($D)>=2*Math.PI)$D=2*Math.PI;else for(;$D<0;)$D+=2*Math.PI;$d=$D/($B=$h<101?Math.max(10,$D*$h/5):$h<201?Math.max(10,$D*$h/20):Math.max(10,$D*$h/40))/2,$F=Math.abs(4/3*(1-Math.cos($d))/Math.sin($d)),$q&&($F=-$F);var $n=this._getPath(),$c=NaN,$e=NaN;for($A=0;$A<=$B;$A++)$K=$P+$D*($A/$B),$R=$m+Math.cos($K)*$h,$$=$p+Math.sin($K)*$h,$k&&($c=$R,$e=$$,$R=this._curMat.a*$c+this._curMat.c*$e,$$=this._curMat.b*$c+this._curMat.d*$e),$R==this._path.getEndPointX()&&$$==this._path.getEndPointY()||$n.addPoint($R,$$);$R=$m+Math.cos($L)*$h,$$=$p+Math.sin($L)*$h,$k&&($c=$R,$e=$$,$R=this._curMat.a*$c+this._curMat.c*$e,$$=this._curMat.b*$c+this._curMat.d*$e),$R==this._path.getEndPointX()&&$$==this._path.getEndPointY()||$n.addPoint($R,$$);},$p.quadraticCurveTo=function($m,$p,$h,$P){var $L=$F.I,$q=$h,$k=$P;$h=this._curMat.a*$q+this._curMat.c*$k,$P=this._curMat.b*$q+this._curMat.d*$k,$q=$m,$k=$p,$m=this._curMat.a*$q+this._curMat.c*$k,$p=this._curMat.b*$q+this._curMat.d*$k;for(var $Y=$L.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$m,$p,$h,$P],30,2),$d=0,$K=$Y.length/2;$d<$K;$d++)this.lineTo($Y[2*$d],$Y[2*$d+1],!1);this.lineTo($h,$P,!1);},$p.rect=function($m,$p,$h,$P){this._other=this._other.make(),this._other.path||(this._other.path=new $y()),this._other.path.rect($m,$p,$h,$P);},$p.strokeRect=function($m,$p,$h,$P,$L){var $q=.5*$L;this.line($m-$q,$p,$m+$h+$q,$p,$L,this._curMat),this.line($m+$h,$p,$m+$h,$p+$P,$L,this._curMat),this.line($m,$p,$m,$p+$P,$L,this._curMat),this.line($m-$q,$p+$P,$m+$h+$q,$p+$P,$L,this._curMat);},$p.clip=function(){},$p.drawPoly=function($m,$p,$h,$P,$L,$q,$k){void 0===$k&&($k=!1),this._renderKey=0,this._shader2D.glTexture=null;var $Y=this._getPath();if(-1==this.mId)$Y.polygon($m,$p,$h,$P,$L||1,$q);else if(this.mHaveKey){var $d=$J.getInstance().shapeDic[this.mId];$d.setMatrix(this._curMat),$d.rebuild($Y.tempArray),$Y.setGeomtry($d);}else{var $K=$Y.polygon($m,$p,$h,$P,$L||1,$q);$J.getInstance().addShape(this.mId,$K),$K.setMatrix(this._curMat);}$Y.update();var $D,$F=[this.mX,this.mY];if(($D=$qm.createShape(this,$Y.ib,$Y.vb,$Y.count,$Y.offset,$Im.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$D.shaderValue.u_pos=$F,$D.shaderValue.u_mmat2=$em.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$D,0<$L){if(this.mHaveLineKey){var $R=$J.getInstance().shapeLineDic[this.mId];$R.rebuild($Y.tempArray),$Y.setGeomtry($R);}else $J.getInstance().addShape(this.mId,$Y.drawLine($m,$p,$h,$L,$q));$Y.update(),($D=$qm.createShape(this,$Y.ib,$Y.vb,$Y.count,$Y.offset,$Im.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$D.shaderValue.u_mmat2=$em.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$D;}},$p.drawParticle=function($m,$p,$h){$h.x=$m,$h.y=$p,this._submits[this._submits._length++]=$h;},$p._getPath=function(){return this._path||(this._path=new $y());},$P(0,$p,"globalCompositeOperation",function(){return $U.NAMES[this._nBlendType];},function($m){var $p=$U.TOINT[$m];null==$p||this._nBlendType===$p||($V.save(this,65536,this,!0),this._curSubmit=$qm.RENDERBASE,this._renderKey=0,this._nBlendType=$p);}),$P(0,$p,"strokeStyle",function(){return this._shader2D.strokeStyle;},function($m){this._shader2D.strokeStyle.equal($m)||($V.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$r.create($m));}),$P(0,$p,"globalAlpha",function(){return this._shader2D.ALPHA;},function($m){($m=Math.floor(1e3*$m)/1e3)!=this._shader2D.ALPHA&&($V.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$m);}),$P(0,$p,"asBitmap",null,function($m){if($m){if(this._targets||(this._targets=new $t()),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height);}else this._targets=null;}),$P(0,$p,"fillStyle",function(){return this._shader2D.fillStyle;},function($m){this._shader2D.fillStyle.equal($m)||($V.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$r.create($m));}),$P(0,$p,"textAlign",function(){return this._other.textAlign;},function($m){this._other.textAlign===$m||(this._other=this._other.make(),$V.save(this,32768,this._other,!1),this._other.textAlign=$m);}),$P(0,$p,"lineWidth",function(){return this._other.lineWidth;},function($m){this._other.lineWidth===$m||(this._other=this._other.make(),$V.save(this,256,this._other,!1),this._other.lineWidth=$m);}),$P(0,$p,"textBaseline",function(){return this._other.textBaseline;},function($m){this._other.textBaseline===$m||(this._other=this._other.make(),$V.save(this,16384,this._other,!1),this._other.textBaseline=$m);}),$P(0,$p,"font",null,function($m){$m!=this._other.font.toString()&&(this._other=this._other.make(),$V.save(this,8,this._other,!1),this._other.font===$Am.EMPTY?this._other.font=new $Am($m):this._other.font.setFont($m));}),$X.__init__=function(){$h.DEFAULT=new $h();},$X._tempPoint=new $T(),$X._SUBMITVBSIZE=32e3,$X._MAXSIZE=99999999,$X._RECTVBSIZE=16,$X.MAXCLIPRECT=new $j(0,0,99999999,99999999),$X._COUNT=0,$X._tmpMatrix=new $b(),$X.SEGNUM=32,$X._contextcount=0,$k($X,["_fontTemp",function(){return this._fontTemp=new $Am();},"_drawStyleTemp",function(){return this._drawStyleTemp=new $r(null);}]),$X.__init$=function(){$h=function(){function $m(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$Am.EMPTY;}$R($m,"");var $p=$m.prototype;return $p.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$Am.EMPTY;},$p.make=function(){return this===$m.DEFAULT?new $m():this;},$m.DEFAULT=null,$m;}();},$X;}(),$Im=function($m){function $P($m,$p){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$P.__super.call(this),this.defines=new $xm(),this.position=$P._POSITION,this.mainID=$m,this.subID=$p,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$m|$p,this._inClassCache=$P._cache[this._cacheID],0<$m&&!this._inClassCache&&(this._inClassCache=$P._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear();}$R($P,"laya.webgl.shader.d2.value.Value2D",$w);var $p=$P.prototype;return $p.setValue=function($m){},$p.refresh=function(){var $m=this.size;return $m[0]=$em.width,$m[1]=$em.height,this.alpha=this.ALPHA*$em.worldAlpha,this.mmat=$em.worldMatrix4,this;},$p._ShaderWithCompile=function(){return $im.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$tm.create);},$p._withWorldShaderDefines=function(){var $m=$em.worldShaderDefines,$p=$im.sharders[this.mainID|this.defines._value|$m.getValue()];if(!$p){var $h,$P={};for($h in this.defines.toNameDic())$P[$h]="";for($h in $m.toNameDic())$P[$h]="";$p=$im.withCompile2D(0,this.mainID,$P,this.mainID|this.defines._value|$m.getValue(),$tm.create);}var $L=$em.worldFilters;if(!$L)return $p;for(var $q,$k=$L.length,$Y=0;$Y<$k;$Y++)($q=$L[$Y])&&$q.action.setValue(this);return $p;},$p.upload=function(){var $m=$em;this.alpha=this.ALPHA*$m.worldAlpha,$em.worldMatrix4!==$em.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$Zm.shaderHighPrecision&&this.defines.add(1024);var $p,$h=$m.worldShaderDefines?this._withWorldShaderDefines():$im.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$m.width,this.size[1]=$m.height,this.mmat=$m.worldMatrix4,$lm.activeShader!==$h?$h._shaderValueWidth!==$m.width||$h._shaderValueHeight!==$m.height?($h._shaderValueWidth=$m.width,$h._shaderValueHeight=$m.height):$p=$h._params2dQuick2||$h._make2dQuick2():$h._shaderValueWidth!==$m.width||$h._shaderValueHeight!==$m.height?($h._shaderValueWidth=$m.width,$h._shaderValueHeight=$m.height):$p=$h._params2dQuick1||$h._make2dQuick1(),$h.upload(this,$p);},$p.setFilters=function($m){if(this.filters=$m)for(var $p,$h=$m.length,$P=0;$P<$h;$P++)($p=$m[$P])&&(this.defines.add($p.type),$p.action.setValue(this));},$p.clear=function(){this.defines.setValue(this.subID);},$p.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear();},$P._initone=function($m,$p){$P._typeClass[$m]=$p,$P._cache[$m]=[],$P._cache[$m]._length=0;},$P.__init__=function(){$P._POSITION=[2,5126,!1,4*$Bm.BYTES_PE,0],$P._TEXCOORD=[2,5126,!1,4*$Bm.BYTES_PE,2*$Bm.BYTES_PE],$P._initone(2,$Xm),$P._initone(4,$Um),$P._initone(256,$sm),$P._initone(512,$wm),$P._initone(1,$Gm),$P._initone(65,$gm),$P._initone(9,$Gm);},$P.create=function($m,$p){var $h=$P._cache[$m|$p];return $h._length?$h[--$h._length]:new $P._typeClass[$m|$p]($p);},$P._POSITION=null,$P._TEXCOORD=null,$P._cache=[],$P._typeClass=[],$P.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$P;}(),$bm=function($m){function $n($m,$p){$n.__super.call(this,$m,$p);}$R($n,"laya.webgl.utils.RenderSprite3D",$e);var $p=$n.prototype;return $p.onCreate=function($m){switch($m){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform);}},$p._mask=function($m,$p,$h,$P){var $L,$q,$k=this._next,$Y=$m.mask;if($Y){$p.ctx.save();var $d=$p.ctx.globalCompositeOperation,$K=new $j();if($K.copyFrom($Y.getBounds()),$K.width=Math.round($K.width),$K.height=Math.round($K.height),$K.x=Math.round($K.x),$K.y=Math.round($K.y),0<$K.width&&0<$K.height){var $D=$m._style._tf,$F=$Ym.create();$F.addValue("bounds",$K),$L=$km.create([$F,$p],laya.webgl.utils.RenderSprite3D.tmpTarget),$p.addRenderObject($L),$Y.render($p,-$K.x,-$K.y),$L=$km.create([$F],laya.webgl.utils.RenderSprite3D.endTmpTarget),$p.addRenderObject($L),$p.ctx.save(),$p.clipRect($h-$D.translateX+$K.x,$P-$D.translateY+$K.y,$K.width,$K.height),$k._fun.call($k,$m,$p,$h,$P),$p.ctx.restore(),$q=$Dm.create(6),$d=$p.ctx.globalCompositeOperation,$q.blendMode="mask",$p.addRenderObject($q),$b.TEMP.identity();var $R=$Im.create(1,0),$$=$_.INV_UV,$A=$K.width,$B=$K.height;($K.width<32||$K.height<32)&&(($$=$n.tempUV)[0]=0,$$[1]=0,$$[2]=32<=$K.width?1:$K.width/32,$$[3]=0,$$[4]=32<=$K.width?1:$K.width/32,$$[5]=32<=$K.height?1:$K.height/32,$$[6]=0,$$[7]=32<=$K.height?1:$K.height/32,$K.width=32<=$K.width?$K.width:32,$K.height=32<=$K.height?$K.height:32,$$[1]*=-1,$$[3]*=-1,$$[5]*=-1,$$[7]*=-1,$$[1]+=1,$$[3]+=1,$$[5]+=1,$$[7]+=1),$p.ctx.drawTarget($F,$h+$K.x-$D.translateX,$P+$K.y-$D.translateY,$A,$B,$b.TEMP,"tmpTarget",$R,$$,6),$L=$km.create([$F],laya.webgl.utils.RenderSprite3D.recycleTarget),$p.addRenderObject($L),($q=$Dm.create(6)).blendMode=$d,$p.addRenderObject($q);}$p.ctx.restore();}else $k._fun.call($k,$m,$p,$h,$P);},$p._blend=function($m,$p,$h,$P){var $L=$m._style,$q=this._next;$L.blendMode?($p.ctx.save(),$p.ctx.globalCompositeOperation=$L.blendMode,$q._fun.call($q,$m,$p,$h,$P),$p.ctx.restore()):$q._fun.call($q,$m,$p,$h,$P);},$p._transform=function($m,$p,$h,$P){var $L=$m.transform,$q=this._next;if($L&&$q!=$e.NORENDER){var $k=$p.ctx;$m._style;$L.tx=$h,$L.ty=$P;var $Y=$k._getTransformMatrix(),$d=$Y.clone();$b.mul($L,$Y,$Y),$Y._checkTransform(),$L.tx=$L.ty=0,$q._fun.call($q,$m,$p,0,0),$d.copyTo($Y),$d.destroy();}else $q._fun.call($q,$m,$p,$h,$P);},$n.tmpTarget=function($m,$p){var $h=$m.getValue("bounds"),$P=$Jm.create($h.width,$h.height);$P.start(),$P.clear(0,0,0,0),$m.addValue("tmpTarget",$P);},$n.endTmpTarget=function($m){$m.getValue("tmpTarget").end();},$n.recycleTarget=function($m){$m.getValue("tmpTarget").recycle(),$m.recycle();},$k($n,["tempUV",function(){return this.tempUV=new Array(8);}]),$n;}(),$Tm=function($m){function $p(){this.data=null,$p.__super.call(this);}$R($p,"laya.filters.webgl.ColorFilterActionGL",$z);var $h=$p.prototype;return $W.imps($h,{"laya.filters.IFilterActionGL":!0}),$h.setValue=function($m){$m.colorMat=this.data._mat,$m.colorAlpha=this.data._alpha;},$h.apply3d=function($m,$p,$h,$P,$L){var $q=$m.getValue("bounds"),$k=$Im.create(1,0);$k.setFilters([this.data]);var $Y=$b.TEMP;$Y.identity(),$h.ctx.drawTarget($m,0,0,$q.width,$q.height,$Y,"src",$k);},$p;}(),$jm=function($m){function $q($m,$p,$h,$P,$L){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$q.__super.call(this,$m,$p,$L),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $rm(),this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$h,this._atlasCanvas.height=$P,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0;}$R($q,"laya.webgl.atlas.Atlaser",$X);var $p=$q.prototype;return $p.computeUVinAtlasTexture=function($m,$p,$h,$P){var $L=$s.atlasTextureWidth,$q=$s.atlasTextureHeight,$k=$h/$L,$Y=$P/$q,$d=($h+$m.bitmap.width)/$L,$K=($P+$m.bitmap.height)/$q,$D=$m.bitmap.width/$L,$F=$m.bitmap.height/$q;$m.uv=[$k+$p[0]*$D,$Y+$p[1]*$F,$d-(1-$p[2])*$D,$Y+$p[3]*$F,$d-(1-$p[4])*$D,$K-(1-$p[5])*$F,$k+$p[6]*$D,$K-(1-$p[7])*$F];},$p.findBitmapIsExist=function($m){if($m instanceof laya.webgl.resource.WebGLImage){var $p=$m,$h=$p.url,$P=this._InAtlasWebGLImagesKey[$h||$p.id];if($P)return $P.offsetInfoID;}return-1;},$p.addToAtlasTexture=function($m,$p,$h){if($m instanceof laya.webgl.resource.WebGLImage){var $P=$m,$L=$P.url;this._InAtlasWebGLImagesKey[$L||$P.id]={bitmap:$m,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$p,$h]);}this._atlasCanvas.texSubImage2D($p,$h,$m.atlasSource),$m.clearAtlasSource();},$p.addToAtlas=function($m,$p,$h){$m._atlasID=this._inAtlasTextureKey.length;var $P=$m.uv.slice(),$L=$m.bitmap;this._inAtlasTextureKey.push($m),this._inAtlasTextureOriUVValue.push($P),this._inAtlasTextureBitmapValue.push($L),this.computeUVinAtlasTexture($m,$P,$p,$h),$m.bitmap=this._atlasCanvas;},$p.clear=function(){for(var $m=0,$p=this._inAtlasTextureKey.length;$m<$p;$m++)this._inAtlasTextureKey[$m].bitmap=this._inAtlasTextureBitmapValue[$m],this._inAtlasTextureKey[$m].uv=this._inAtlasTextureOriUVValue[$m],this._inAtlasTextureKey[$m]._atlasID=-1,this._inAtlasTextureKey[$m].bitmap.lock=!1,this._inAtlasTextureKey[$m].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0;},$p.dispose=function(){this.clear(),this._atlasCanvas.destroy();},$P(0,$p,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue;}),$P(0,$p,"texture",function(){return this._atlasCanvas;}),$P(0,$p,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey;}),$q;}(),$xm=function($m){function $h(){$h.__super.call(this,$h.__name2int,$h.__int2name,$h.__int2nameMap);}return $R($h,"laya.webgl.shader.d2.ShaderDefines2D",$C),$h.__init__=function(){$h.reg("TEXTURE2D",1),$h.reg("COLOR2D",2),$h.reg("PRIMITIVE",4),$h.reg("GLOW_FILTER",8),$h.reg("BLUR_FILTER",16),$h.reg("COLOR_FILTER",32),$h.reg("COLOR_ADD",64),$h.reg("WORLDMAT",128),$h.reg("FILLTEXTURE",256),$h.reg("FSHIGHPRECISION",1024),$h.reg("TXTALPHA",2048),$h.reg("TXTCOMPRESS",4096);},$h.reg=function($m,$p){$C._reg($m,$p,$h.__name2int,$h.__int2name);},$h.toText=function($m,$p,$h){return $C._toText($m,$p,$h);},$h.toInt=function($m){return $C._toInt($m,$h.__name2int);},$h.TEXTURE2D=1,$h.COLOR2D=2,$h.PRIMITIVE=4,$h.FILTERGLOW=8,$h.FILTERBLUR=16,$h.FILTERCOLOR=32,$h.COLORADD=64,$h.WORLDMAT=128,$h.FILLTEXTURE=256,$h.SKINMESH=512,$h.SHADERDEFINE_FSHIGHPRECISION=1024,$h.TXTALPHA=2048,$h.TXTCOMPRESS=4096,$h.__name2int={},$h.__int2name=[],$h.__int2nameMap=[],$h;}(),$Qm=(function($m){function $Y($m,$p,$h,$P,$L,$q,$k){$Y.__super.call(this,$m,$p,$h,$P,40,$L,$q,$k);}$R($Y,"laya.webgl.shapes.Ellipse",$hm);}(),function($m){function $q($m,$p,$h,$P,$L){this._points=[],this.rebuild($h),$q.__super.call(this,$m,$p,0,0,0,$L,$P,$L,0);}$R($q,"laya.webgl.shapes.Line",$hm);var $p=$q.prototype;return $p.rebuild=function($m){var $p=$m.length;$p!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($p/2-1)),this.mFloat32Array=new Float32Array(5*$p)),this._points.length=0;for(var $h=NaN,$P=NaN,$L=-1,$q=-1,$k=$m.length/2,$Y=0;$Y<$k;$Y++)$h=$m[2*$Y],$P=$m[2*$Y+1],(.01<Math.abs($L-$h)||.01<Math.abs($q-$P))&&this._points.push($h,$P),$L=$h,$q=$P;},$p.getData=function($m,$p,$h){var $P=[],$L=[];0<this.borderWidth&&this.createLine2(this._points,$P,this.borderWidth,$h,$L,this._points.length/2),this.mUint16Array.set($P,0),this.mFloat32Array.set($L,0),$m.append(this.mUint16Array),$p.append(this.mFloat32Array);},$q;}()),$Mm=function($m){function $F($m,$p,$h,$P,$L){this._points=[];for(var $q=NaN,$k=NaN,$Y=-1,$d=-1,$K=$h.length/2-1,$D=0;$D<$K;$D++)$q=$h[2*$D],$k=$h[2*$D+1],(.01<Math.abs($Y-$q)||.01<Math.abs($d-$k))&&this._points.push($q,$k),$Y=$q,$d=$k;$q=$h[2*$K],$k=$h[2*$K+1],$Y=this._points[0],$d=this._points[1],(.01<Math.abs($Y-$q)||.01<Math.abs($d-$k))&&this._points.push($q,$k),$F.__super.call(this,$m,$p,0,0,this._points.length/2,0,$P,$L);}$R($F,"laya.webgl.shapes.LoopLine",$hm);var $p=$F.prototype;return $p.getData=function($m,$p,$h){if(0<this.borderWidth){for(var $P=this.color,$L=($P>>16&255)/255,$q=($P>>8&255)/255,$k=(255&$P)/255,$Y=[],$d=0,$K=0,$D=[],$F=Math.floor(this._points.length/2),$R=0;$R<$F;$R++)$d=this._points[2*$R],$K=this._points[2*$R+1],$Y.push(this.x+$d,this.y+$K,$L,$q,$k);this.createLoopLine($Y,$D,this.borderWidth,$h+$Y.length/5),$m.append(new Uint16Array($D)),$p.append(new Float32Array($Y));}},$p.createLoopLine=function($m,$p,$h,$P,$L,$q){$m.length;var $k=$m.concat(),$Y=$L||$m,$d=this.borderColor,$K=($d>>16&255)/255,$D=($d>>8&255)/255,$F=(255&$d)/255,$R=[$k[0],$k[1]],$$=[$k[$k.length-5],$k[$k.length-4]],$A=$$[0]+.5*($R[0]-$$[0]),$B=$$[1]+.5*($R[1]-$$[1]);$k.unshift($A,$B,0,0,0),$k.push($A,$B,0,0,0);var $n,$c,$e,$a,$Z,$H,$W,$E,$I,$b,$T,$j,$x,$Q,$M,$u,$N,$S,$_,$l,$J=$k.length/5,$z=$P,$w=$h/2;$e=$k[0],$a=$k[1],$b=$e-($Z=$k[5]),$I=($I=-($a-($H=$k[6])))/($l=Math.sqrt($I*$I+$b*$b))*$w,$b=$b/$l*$w,$Y.push($e-$I,$a-$b,$K,$D,$F,$e+$I,$a+$b,$K,$D,$F);for(var $X=1;$X<$J-1;$X++)$e=$k[5*($X-1)],$a=$k[5*($X-1)+1],$Z=$k[5*$X],$H=$k[5*$X+1],$W=$k[5*($X+1)],$E=$k[5*($X+1)+1],$b=$e-$Z,$j=$Z-$W,$M=(-($I=($I=-($a-$H))/($l=Math.sqrt($I*$I+$b*$b))*$w)+$e)*(-($b=$b/$l*$w)+$H)-(-$I+$Z)*(-$b+$a),$S=(-($T=($T=-($H-$E))/($l=Math.sqrt($T*$T+$j*$j))*$w)+$W)*(-($j=$j/$l*$w)+$H)-(-$T+$Z)*(-$j+$E),$_=($x=-$b+$a-(-$b+$H))*($N=-$T+$Z-(-$T+$W))-($u=-$j+$E-(-$j+$H))*($Q=-$I+$Z-(-$I+$e)),Math.abs($_)<.1?($_+=10.1,$Y.push($Z-$I,$H-$b,$K,$D,$F,$Z+$I,$H+$b,$K,$D,$F)):((($n=($Q*$S-$N*$M)/$_)-$Z)*($n-$Z)+(($c=($u*$M-$x*$S)/$_)-$H)+($c-$H),$Y.push($n,$c,$K,$D,$F,$Z-($n-$Z),$H-($c-$H),$K,$D,$F));$q&&($p=$q);var $s=this.edges+1;for($X=1;$X<$s;$X++)$p.push($z+2*($X-1),$z+2*($X-1)+1,$z+2*$X+1,$z+2*$X+1,$z+2*$X,$z+2*($X-1));return $p.push($z+2*($X-1),$z+2*($X-1)+1,$z+1,$z+1,$z,$z+2*($X-1)),$Y;},$F;}(),$um=function($m){function $k($m,$p,$h,$P,$L,$q){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$b.create(),this._points=$h.slice(0,$h.length),$k.__super.call(this,$m,$p,0,0,this._points.length/2,$P,$L,$q);}$R($k,"laya.webgl.shapes.Polygon",$hm);var $p=$k.prototype;return $p.rebuild=function($m){this._repaint||(this._points.length=0,this._points=this._points.concat($m));},$p.setMatrix=function($m){$m.copyTo(this._mat);},$p.needUpdate=function($m){return this._repaint=this._mat.a==$m.a&&this._mat.b==$m.b&&this._mat.c==$m.c&&this._mat.d==$m.d&&this._mat.tx==$m.tx&&this._mat.ty==$m.ty,!this._repaint;},$p.getData=function($m,$p,$h){var $P,$L=0,$q=this._points,$k=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$h){for(this._start=$h,$P=[],$k=this.earcutTriangles.length,$L=0;$L<$k;$L++)$P.push(this.earcutTriangles[$L]+$h);this.mUint16Array=new Uint16Array($P);}}else{this._start=$h,$P=[];var $Y=[],$d=[],$K=this.color,$D=($K>>16&255)/255,$F=($K>>8&255)/255,$R=(255&$K)/255;for($k=Math.floor($q.length/2),$L=0;$L<$k;$L++)$Y.push(this.x+$q[2*$L],this.y+$q[2*$L+1],$D,$F,$R),$d.push(this.x+$q[2*$L],this.y+$q[2*$L+1]);for(this.earcutTriangles=$Pm.earcut($d,null,2),$k=this.earcutTriangles.length,$L=0;$L<$k;$L++)$P.push(this.earcutTriangles[$L]+$h);this.mUint16Array=new Uint16Array($P),this.mFloat32Array=new Float32Array($Y);}$m.append(this.mUint16Array),$p.append(this.mFloat32Array);},$k;}(),$Nm=function($m){function $q(){this._matrix=new $b(),this._matrix4=$Bm.defaultMatrix4.concat(),$q.__super.call(this,1e4),this.shaderValue=new $Im(0,0);}$R($q,"laya.webgl.submit.SubmitCanvas",$qm);var $p=$q.prototype;return $p.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $m=$em.worldAlpha,$p=$em.worldMatrix4,$h=$em.worldMatrix,$P=$em.worldFilters,$L=$em.worldShaderDefines,$q=this.shaderValue,$k=this._matrix,$Y=this._matrix4,$d=$b.TEMP;return $b.mul($k,$h,$d),$Y[0]=$d.a,$Y[1]=$d.b,$Y[4]=$d.c,$Y[5]=$d.d,$Y[12]=$d.tx,$Y[13]=$d.ty,$em.worldMatrix=$d.clone(),$em.worldMatrix4=$Y,$em.worldAlpha=$em.worldAlpha*$q.alpha,$q.filters&&$q.filters.length&&($em.worldFilters=$q.filters,$em.worldShaderDefines=$q.defines),this._ctx_src.flush(),$em.worldAlpha=$m,$em.worldMatrix4=$p,$em.worldMatrix.destroy(),$em.worldMatrix=$h,$em.worldFilters=$P,$em.worldShaderDefines=$L,1;},$p.releaseRender=function(){var $m=$q._cache;this._ctx_src=null,$m[$m._length++]=this;},$p.getRenderType=function(){return 10003;},$q.create=function($m,$p,$h){var $P=$q._cache._length?$q._cache[--$q._cache._length]:new $q();$P._ctx_src=$m;var $L=$P.shaderValue;return $L.alpha=$p,$L.defines.setValue(0),$h&&$h.length&&$L.setFilters($h),$P;},$q._cache=(($q._cache=[])._length=0,$q._cache),$q;}(),$Sm=function($m){function $K($m){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array(),this._texsID=new Array(),this._vbPos=new Array(),void 0===$m&&($m=1e4),$K.__super.call(this,$m);}$R($K,"laya.webgl.submit.SubmitTexture",$qm);var $p=$K.prototype;return $p.releaseRender=function(){var $m=$K._cache;($m[$m._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0;},$p.addTexture=function($m,$p){this._texsID[this._texs.length]=$m._uvID,this._texs.push($m),this._vbPos.push($p);},$p.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $m=this.shaderValue.textureHost.bitmap;if(null!==$m)for(var $p=this._vb.getFloat32Array(),$h=0,$P=this._texs.length;$h<$P;$h++){var $L=this._texs[$h];$L.active();var $q=$L.uv;if(this._texsID[$h]!==$L._uvID){this._texsID[$h]=$L._uvID;var $k=this._vbPos[$h];$p[$k+2]=$q[0],$p[$k+3]=$q[1],$p[$k+6]=$q[2],$p[$k+7]=$q[3],$p[$k+10]=$q[4],$p[$k+11]=$q[5],$p[$k+14]=$q[6],$p[$k+15]=$q[7],this._vb.setNeedUpload();}$L.bitmap!==$m&&(this._isSameTexture=!1);}}},$p.renderSubmit=function(){if(0===this._numEle)return $K._shaderSet=!1,1;var $m=this.shaderValue.textureHost;if($m){var $p=$m.source;if(!$m.bitmap||!$p)return $K._shaderSet=!1,1;this.shaderValue.texture=$p,$m.alphaTexture&&$m.alphaTexture.source&&(this.shaderValue.texture1=$m.alphaTexture.source);}this._vb.bind_upload(this._ib);var $h=$Zm.mainContext;if($U.activeBlendFunction!==this._blendFn&&($h.enable(3042),this._blendFn($h),$U.activeBlendFunction=this._blendFn),$M.drawCall++,$M.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$lm.activeShader&&$K._shaderSet?($lm.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$lm.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$K._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $P=$m.bitmap,$L=0,$q=$lm.activeShader,$k=0,$Y=this._texs.length;$k<$Y;$k++){var $d=this._texs[$k];$d.bitmap===$P&&$k+1!==$Y||($q.uploadTexture2D($d.source),$h.drawElements(4,6*($k-$L+1),5123,this._startIdx+6*$L*$Bm.BYTES_PIDX),$P=$d.bitmap,$L=$k);}else $h.drawElements(4,this._numEle,5123,this._startIdx);return 1;},$K.create=function($m,$p,$h,$P,$L){var $q=$K._cache._length?$K._cache[--$K._cache._length]:new $K();null==$h&&(($h=$q._selfVb||($q._selfVb=$Cm.create(-1))).clear(),$P=0),$q._ib=$p,$q._vb=$h,$q._startIdx=$P*$Bm.BYTES_PIDX,$q._numEle=0;var $k=$m._nBlendType;$q._blendFn=$m._targets?$U.targetFns[$k]:$U.fns[$k],$q.shaderValue=$L,$q.shaderValue.setValue($m._shader2D);var $Y=$m._shader2D.filters;return $Y&&$q.shaderValue.setFilters($Y),$q;},$K._cache=(($K._cache=[])._length=0,$K._cache),$K._shaderSet=!0,$K;}(),$_m=function($m){function $c(){$c.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo);}$R($c,"laya.webgl.utils.MeshTexture",$cm);var $p=$c.prototype;return $p.addData=function($m,$p,$h,$P,$L,$q){for(var $k=$m.length/2,$Y=this._vb.needSize($k*$c.const_stride)>>2,$d=this._vb.getFloat32Array(),$K=0,$D=0;$D<$k;$D++){var $F=$m[$K],$R=$m[$K+1],$$=$F*$P.a+$R*$P.c+$P.tx,$A=$F*$P.b+$R*$P.d+$P.ty;$d[$Y++]=$$,$d[$Y++]=$A,$d[$Y++]=$p[$K],$d[$Y++]=$p[$K+1],$K+=2;}this._vb.setNeedUpload();var $B=this.vertNum;if(0<$B){($k=$h.length)>$c.tmpIdx.length&&($c.tmpIdx=new Uint16Array($k));for(var $n=0;$n<$k;$n++)$c.tmpIdx[$n]=$h[$n]+$B;this._ib.appendU16Array($c.tmpIdx,$h.length);}else this._ib.append($h);this._ib.setNeedUpload(),this.vertNum+=$k,this.indexNum+=$h.length;},$p.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this);},$p.destroy=function(){this._ib.destroy(),this._vb.destroy();},$c.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $c();},$c.const_stride=16,$c._POOL=[],$k($c,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8];},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4);}]),$c;}(),$lm=function($m){function $p(){$p.__super.call(this),this.lock=!0;}return $R($p,"laya.webgl.shader.BaseShader",$a),$p.activeShader=null,$p.bindShader=null,$p;}(),$Jm=function($p){function $D($m,$p,$h,$P,$L,$q,$k,$Y,$d){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$h&&($h=6408),void 0===$P&&($P=5121),void 0===$L&&($L=34041),void 0===$q&&($q=!1),void 0===$k&&($k=!1),void 0===$Y&&($Y=-1),void 0===$d&&($d=-1),this._type=1,this._w=$m,this._h=$p,this._surfaceFormat=$h,this._surfaceType=$P,this._depthStencilFormat=$L,$c.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$q,this._repeat=$k,this._minFifter=$Y,this._magFifter=$d,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$D.__super.call(this,this.bitmap,$_.INV_UV);}$R($D,"laya.webgl.resource.RenderTarget2D",$p);var $m=$D.prototype;return $W.imps($m,{"laya.resource.IDispose":!0}),$m.getType=function(){return this._type;},$m.getTexture=function(){return this;},$m.size=function($m,$p){this._w==$m&&this._h==$p||(this._w=$m,this._h=$p,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget());},$m.release=function(){this.destroy();},$m.recycle=function(){$D.POOL.push(this);},$m.start=function(){var $m=$Zm.mainContext;return this._preRenderTarget=$em.curRenderTarget,$em.curRenderTarget=this,$m.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($m.viewport(0,0,this._w,this._h),this._svWidth=$em.width,this._svHeight=$em.height,$em.width=this._w,$em.height=this._h,$lm.activeShader=null),this;},$m.clear=function($m,$p,$h,$P){void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=1);var $L=$Zm.mainContext;$L.clearColor($m,$p,$h,$P);var $q=16384;switch(this._depthStencilFormat){case 33189:$q|=256;break;case 36168:$q|=1024;break;case 34041:$q|=256,$q|=1024;}$L.clear($q);},$m.end=function(){var $m=$Zm.mainContext;$m.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$em.curRenderTarget=this._preRenderTarget,1==this._type?($m.viewport(0,0,this._svWidth,this._svHeight),$em.width=this._svWidth,$em.height=this._svHeight,$lm.activeShader=null):$m.viewport(0,0,$W.stage.width,$W.stage.height);},$m.getData=function($m,$p,$h,$P){var $L=$Zm.mainContext;if($L.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$L.checkFramebufferStatus(36160)))return $L.bindFramebuffer(36160,null),null;var $q=new Uint8Array(this._w*this._h*4);return $L.readPixels($m,$p,$h,$P,this._surfaceFormat,this._surfaceType,$q),$L.bindFramebuffer(36160,null),$q;},$m.destroy=function($m){void 0===$m&&($m=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$p.prototype.destroy.call(this));},$m.dispose=function(){},$m._createWebGLRenderTarget=function(){this.bitmap=new $om(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($m){this.event("recovered");});},$P(0,$m,"surfaceFormat",function(){return this._surfaceFormat;}),$P(0,$m,"magFifter",function(){return this._magFifter;}),$P(0,$m,"surfaceType",function(){return this._surfaceType;}),$P(0,$m,"mipMap",function(){return this._mipMap;}),$P(0,$m,"depthStencilFormat",function(){return this._depthStencilFormat;}),$P(0,$m,"minFifter",function(){return this._minFifter;}),$P(0,$m,"source",function(){return this._alreadyResolved?$W.superGet($_,this,"source"):null;}),$D.create=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){void 0===$h&&($h=6408),void 0===$P&&($P=5121),void 0===$L&&($L=34041),void 0===$q&&($q=!1),void 0===$k&&($k=!1),void 0===$Y&&($Y=-1),void 0===$d&&($d=-1);var $K=$D.POOL.pop();return $K||($K=new $D($m,$p)),$K.bitmap&&$K._w==$m&&$K._h==$p&&$K._surfaceFormat==$h&&$K._surfaceType==$P&&$K._depthStencilFormat==$L&&$K._mipMap==$q&&$K._repeat==$k&&$K._minFifter==$Y&&$K._magFifter==$d||($K._w=$m,$K._h=$p,$K._surfaceFormat=$h,$K._surfaceType=$P,$K._depthStencilFormat=$L,$c.isConchWebGL&&34041===$K._depthStencilFormat&&($K._depthStencilFormat=33189),$K._mipMap=$q,$K._repeat=$k,$K._minFifter=$Y,$K._magFifter=$d,$K.release(),$K._createWebGLRenderTarget()),$K;},$D.TYPE2D=1,$D.TYPE3D=2,$D.POOL=[],$D;}($_),$zm=function($m){function $p(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$p.__super.call(this),$p._gl=$Zm.mainContext;}$R($p,"laya.webgl.utils.Buffer",$a);var $h=$p.prototype;return $h._bind=function(){this.activeResource(),$p._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($p._bindVertexBuffer=this._glBuffer),$p._gl.bindBuffer(this._bufferType,$p._bindActive[this._bufferType]=this._glBuffer),$lm.activeShader=null);},$h.recreateResource=function(){this._glBuffer||(this._glBuffer=$p._gl.createBuffer()),this.completeCreate();},$h.disposeResource=function(){this._glBuffer&&($Zm.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0;},$P(0,$h,"bufferUsage",function(){return this._bufferUsage;}),$p._gl=null,$p._bindActive={},$p._bindVertexBuffer=null,$p._enableAtributes=[],$p;}(),$wm=function($m){function $h($m){this.texcoord=null,this.offsetX=300,this.offsetY=0,$h.__super.call(this,512,0);var $p=8*$Bm.BYTES_PE;this.position=[2,5126,!1,$p,0],this.texcoord=[2,5126,!1,$p,2*$Bm.BYTES_PE],this.color=[4,5126,!1,$p,4*$Bm.BYTES_PE];}return $R($h,"laya.webgl.shader.d2.skinAnishader.SkinSV",$Im),$h;}(),$Xm=function($m){function $p($m){$p.__super.call(this,2,0),this.color=[];}return $R($p,"laya.webgl.shader.d2.value.Color2dSV",$Im),$p.prototype.setValue=function($m){$m.fillStyle&&(this.color=$m.fillStyle._color._color),$m.strokeStyle&&(this.color=$m.strokeStyle._color._color);},$p;}(),$sm=function($m){function $p($m){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$Im._TEXCOORD,$p.__super.call(this,256,0);}$R($p,"laya.webgl.shader.d2.value.FillTextureSV",$Im);var $h=$p.prototype;return $h.setValue=function($m){this.ALPHA=$m.ALPHA,$m.filters&&this.setFilters($m.filters);},$h.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0);},$p;}(),$Gm=function($m){function $p($m){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$Im._TEXCOORD,void 0===$m&&($m=0),$p.__super.call(this,1,$m);}$R($p,"laya.webgl.shader.d2.value.TextureSV",$Im);var $h=$p.prototype;return $h.setValue=function($m){this.ALPHA=$m.ALPHA,$m.filters&&this.setFilters($m.filters);},$h.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0);},$p;}(),$Um=function($m){function $p($m){this.a_color=null,this.u_pos=[0,0],$p.__super.call(this,4,0),this.position=[2,5126,!1,5*$Bm.BYTES_PE,0],this.a_color=[3,5126,!1,5*$Bm.BYTES_PE,2*$Bm.BYTES_PE];}return $R($p,"laya.webgl.shader.d2.value.PrimitiveSV",$Im),$p;}(),$rm=function($m){function $p(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$p.__super.call(this);}$R($p,"laya.webgl.atlas.AtlasWebGLCanvas",$m);var $h=$p.prototype;return $h.recreateResource=function(){var $m=$Zm.mainContext,$p=this._source=$m.createTexture(),$h=$Hm.curBindTexTarget,$P=$Hm.curBindTexValue;$Hm.bindTexture($m,3553,$p),$m.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$m.texParameteri(3553,10241,9729),$m.texParameteri(3553,10240,9729),$m.texParameteri(3553,10242,33071),$m.texParameteri(3553,10243,33071),$h&&$P&&$Hm.bindTexture($m,$h,$P),this.memorySize=this._w*this._h*4,this.completeCreate();},$h.disposeResource=function(){this._source&&($Zm.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0);},$h.texSubImage2D=function($m,$p,$h){if($c.isFlash){this._flashCacheImage||(this._flashCacheImage=$B.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $P=$h.bitmapdata;this._flashCacheImage._image.copyPixels($P,0,0,$P.width,$P.height,$m,$p),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0);}else{var $L=$Zm.mainContext,$q=$Hm.curBindTexTarget,$k=$Hm.curBindTexValue;$Hm.bindTexture($L,3553,this._source),$L.pixelStorei(37441,!0),0<=$m-1&&$L.texSubImage2D(3553,0,$m-1,$p,6408,5121,$h),$m+1<=this._w&&$L.texSubImage2D(3553,0,$m+1,$p,6408,5121,$h),0<=$p-1&&$L.texSubImage2D(3553,0,$m,$p-1,6408,5121,$h),$p+1<=this._h&&$L.texSubImage2D(3553,0,$m,$p+1,6408,5121,$h),$L.texSubImage2D(3553,0,$m,$p,6408,5121,$h),$L.pixelStorei(37441,!1),$q&&$k&&$Hm.bindTexture($L,$q,$k);}},$h.texSubImage2DPixel=function($m,$p,$h,$P,$L){var $q=$Zm.mainContext,$k=$Hm.curBindTexTarget,$Y=$Hm.curBindTexValue;$Hm.bindTexture($q,3553,this._source);var $d=new Uint8Array($L.data);$q.pixelStorei(37441,!0),$q.texSubImage2D(3553,0,$m,$p,$h,$P,6408,5121,$d),$q.pixelStorei(37441,!1),$k&&$Y&&$Hm.bindTexture($q,$k,$Y);},$P(0,$h,"width",$m.prototype._$get_width,function($m){this._w=$m;}),$P(0,$h,"height",$m.prototype._$get_height,function($m){this._h=$m;}),$p;}($h),$ym=function($m){function $L(){this.flipY=!0,this.alwaysChange=!1,$L.__super.call(this);}$R($L,"laya.webgl.resource.WebGLCanvas",$h);var $p=$L.prototype;return $p.getCanvas=function(){return this._canvas;},$p.clear=function(){this._ctx&&this._ctx.clear();},$p.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this);},$p._setContext=function($m){this._ctx=$m;},$p.getContext=function($m,$p){return this._ctx?this._ctx:this._ctx=$L._createContext(this);},$p.size=function($m,$p){this._w==$m&&this._h==$p||(this._w=$m,this._h=$p,this._ctx&&this._ctx.size($m,$p),this._canvas&&(this._canvas.height=$p,this._canvas.width=$m));},$p.activeResource=function($m){void 0===$m&&($m=!1),this._source||this.recreateResource();},$p.recreateResource=function(){this.createWebGlTexture(),this.completeCreate();},$p.disposeResource=function(){this._source&&!this.iscpuSource&&($Zm.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0);},$p.createWebGlTexture=function(){var $m=$Zm.mainContext;this._canvas;var $p=this._source=$m.createTexture();this.iscpuSource=!1;var $h=$Hm.curBindTexTarget,$P=$Hm.curBindTexValue;$Hm.bindTexture($m,3553,$p),$m.pixelStorei(37440,this.flipY?1:0),$L.premulAlpha&&$m.pixelStorei(37441,!0),$m.texImage2D(3553,0,6408,6408,5121,this._imgData),$L.premulAlpha&&$m.pixelStorei(37441,!1),$m.texParameteri(3553,10240,9729),$m.texParameteri(3553,10241,9729),$m.texParameteri(3553,10242,33071),$m.texParameteri(3553,10243,33071),$m.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$h&&$P&&$Hm.bindTexture($m,$h,$P);},$p.reloadCanvasData=function(){var $m=$Zm.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $p=$Hm.curBindTexTarget,$h=$Hm.curBindTexValue;$Hm.bindTexture($m,3553,this._source),$L.premulAlpha&&$m.pixelStorei(37441,!0),$m.texImage2D(3553,0,6408,6408,5121,this._imgData),$L.premulAlpha&&$m.pixelStorei(37441,!1),$m.pixelStorei(37440,0),$p&&$h&&$Hm.bindTexture($m,$p,$h);},$p.texSubImage2D=function($m,$p,$h){var $P=$Zm.mainContext,$L=$Hm.curBindTexTarget,$q=$Hm.curBindTexValue;$Hm.bindTexture($P,3553,this._source),$P.pixelStorei(37441,!0),$P.texSubImage2D(3553,0,$p,$h,6408,5121,$m._source),$P.pixelStorei(37441,!1),$L&&$q&&$Hm.bindTexture($P,$L,$q);},$p.toBase64=function($m,$p,$h){var $P=null;this._canvas&&($P=this._canvas.toDataURL($m,$p)),$h.call(this,$P);},$P(0,$p,"context",function(){return this._ctx;}),$P(0,$p,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source;}),$P(0,$p,"asBitmap",null,function($m){this._ctx&&(this._ctx.asBitmap=$m);}),$L._createContext=null,$L.premulAlpha=!1,$L;}(),$Vm=function($m){function $q($m,$p){this.CborderSize=12,$q.__super.call(this),this.char=$m,this.isSpace=" "===$m,this.xs=$p.scaleX,this.ys=$p.scaleY,this.font=$p.font.toString(),this.fontSize=$p.font.size,this.fillColor=$p.fillColor,this.borderColor=$p.borderColor,this.lineWidth=$p.lineWidth,this.underLine=$p.underLine;var $h,$P=$c.isConchApp;$P?(($h=ConchTextCanvas)._source=ConchTextCanvas,$h._source.canvas=ConchTextCanvas):$h=$$.canvas.source,this.canvas=$h,this._enableMerageInAtlas=!0,this._ctx=$P?$h:this.canvas.getContext("2d",void 0);var $L=$l.measureText(this.char,this.font);this.cw=$L.width*this.xs,this.ch=($L.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $_(this);}$R($q,"laya.webgl.resource.WebGLCharImage",$h);var $p=$q.prototype;return $W.imps($p,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$p.active=function(){this.texture.active();},$p.recreateResource=function(){var $m=$c.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$m){var $p=this.fontSize;1==this.xs&&1==this.ys||($p=parseInt($p*(this.xs>this.ys?this.xs:this.ys)+""));var $h="normal 100 "+this.font;$h=$h.replace($q._fontSizeReg,$p),this.borderColor&&($h+=" 1 "+this.borderColor),this._ctx.font=$h,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null);}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$S.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $P=this._ctx.measureText(this.char);$P||($P={width:16});var $L=$P.width+1;this._ctx.lineTo($L,this.fontSize+1),this._ctx.stroke();}this._ctx.restore();}this.borderSize=this.CborderSize,this.completeCreate();},$p.onresize=function($m,$p){this._w=$m,this._h=$p,this._allowMerageInAtlas=!0;},$p.clearAtlasSource=function(){},$P(0,$p,"allowMerageInAtlas",function(){return this._allowMerageInAtlas;}),$P(0,$p,"atlasSource",function(){return this.canvas;}),$P(0,$p,"enableMerageInAtlas",function(){return this._enableMerageInAtlas;},function($m){this._enableMerageInAtlas=$m;}),$q.createOneChar=function($m,$p){return new $q($m,$p);},$q._fontSizeReg=new RegExp("\\d+(?=px)","g"),$q;}(),$om=function($m){function $K($m,$p,$h,$P,$L,$q,$k,$Y,$d){void 0===$h&&($h=6408),void 0===$P&&($P=5121),void 0===$L&&($L=34041),void 0===$q&&($q=!1),void 0===$k&&($k=!1),void 0===$Y&&($Y=-1),void 0===$d&&($d=1),$K.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$m,this._h=$p,this._surfaceFormat=$h,this._surfaceType=$P,this._depthStencilFormat=$L,this._mipMap=$q,this._repeat=$k,this._minFifter=$Y,this._magFifter=$d;}$R($K,"laya.webgl.resource.WebGLRenderTarget",$h);var $p=$K.prototype;return $p.recreateResource=function(){var $m=$Zm.mainContext;this._frameBuffer||(this._frameBuffer=$m.createFramebuffer()),this._source||(this._source=$m.createTexture());var $p=$Hm.curBindTexTarget,$h=$Hm.curBindTexValue;$Hm.bindTexture($m,3553,this._source),$m.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $P=this._minFifter,$L=this._magFifter,$q=this._repeat?10497:33071,$k=$D.isPOT(this._w,this._h);if($k?(this._mipMap?-1!==$P||($P=9987):-1!==$P||($P=9729),-1!==$L||($L=9729),$m.texParameteri(3553,10241,$P),$m.texParameteri(3553,10240,$L),$m.texParameteri(3553,10242,$q),$m.texParameteri(3553,10243,$q),this._mipMap&&$m.generateMipmap(3553)):(-1!==$P||($P=9729),-1!==$L||($L=9729),$m.texParameteri(3553,10241,$P),$m.texParameteri(3553,10240,$L),$m.texParameteri(3553,10242,33071),$m.texParameteri(3553,10243,33071)),$m.bindFramebuffer(36160,this._frameBuffer),$m.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$m.createRenderbuffer()),$m.bindRenderbuffer(36161,this._depthStencilBuffer),$m.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$m.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$m.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$m.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);}$m.bindFramebuffer(36160,null),$p&&$h&&$Hm.bindTexture($m,$p,$h),$m.bindRenderbuffer(36161,null),$k&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate();},$p.disposeResource=function(){this._frameBuffer&&($Zm.mainContext.deleteTexture(this._source),$Zm.mainContext.deleteFramebuffer(this._frameBuffer),$Zm.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null);},$P(0,$p,"depthStencilBuffer",function(){return this._depthStencilBuffer;}),$P(0,$p,"frameBuffer",function(){return this._frameBuffer;}),$K;}(),$fm=function($m){function $Y($m,$p,$h,$P,$L,$q,$k){this.offsetX=0,this.offsetY=0,$Y.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$q,this.canvas=$m,this._ctx=$m.getContext("2d",void 0),this._w=$P,this._h=$L,this.offsetX=$p,this.offsetY=$h,this.src=$k,this._enableMerageInAtlas=!0,$s.enabled&&this._w<$s.atlasLimitWidth&&this._h<$s.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1;}$R($Y,"laya.webgl.resource.WebGLSubImage",$h);var $p=$Y.prototype;return $W.imps($p,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$p.size=function($m,$p){this._w=$m,this._h=$p,this._ctx&&this._ctx.size($m,$p),this.canvas&&(this.canvas.height=$p,this.canvas.width=$m);},$p.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate();},$p.createWebGlTexture=function(){var $m=$Zm.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $p=this._source=$m.createTexture(),$h=$Hm.curBindTexTarget,$P=$Hm.curBindTexValue;$Hm.bindTexture($m,3553,$p),$m.pixelStorei(37441,!0),$m.texImage2D(3553,0,6408,6408,5121,this.canvas),$m.pixelStorei(37441,!1);var $L=this.minFifter,$q=this.magFifter,$k=this.repeat?10497:33071,$Y=$D.isPOT(this.width,this.height);$Y?(this.mipmap?-1!==$L||($L=9987):-1!==$L||($L=9729),-1!==$q||($q=9729),$m.texParameteri(3553,10240,$q),$m.texParameteri(3553,10241,$L),$m.texParameteri(3553,10242,$k),$m.texParameteri(3553,10243,$k),this.mipmap&&$m.generateMipmap(3553)):(-1!==$L||($L=9729),-1!==$q||($q=9729),$m.texParameteri(3553,10241,$L),$m.texParameteri(3553,10240,$q),$m.texParameteri(3553,10242,33071),$m.texParameteri(3553,10243,33071)),$h&&$P&&$Hm.bindTexture($m,$h,$P),this.canvas=null,$Y&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4;},$p.disposeResource=function(){$s.enabled&&this._allowMerageInAtlas||!this._source||($Zm.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0);},$p.clearAtlasSource=function(){},$P(0,$p,"allowMerageInAtlas",function(){return this._allowMerageInAtlas;}),$P(0,$p,"atlasSource",function(){return this.canvas;}),$P(0,$p,"enableMerageInAtlas",function(){return this._allowMerageInAtlas;},function($m){this._allowMerageInAtlas=$m;}),$Y;}(),$im=function($m){function $K($m,$p,$h,$P){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$K.__super.call(this),!$m||!$p)throw"Shader Error";this._id=++$K._count,this._vs=$m,this._ps=$p,this._nameMap=$P||{},null!=$h&&($K.sharders[$h]=this);}$R($K,"laya.webgl.shader.Shader",$lm);var $p=$K.prototype;return $p.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0;},$p.disposeResource=function(){$Zm.mainContext.deleteShader(this._vshader),$Zm.mainContext.deleteShader(this._pshader),$Zm.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0;},$p._compile=function(){if(!$Zm.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $m=[this._vs,this._ps],$p=$Zm.mainContext;if(this._program=$p.createProgram(),this._vshader=$K._createShader($p,$m[0],35633),this._pshader=$K._createShader($p,$m[1],35632),$p.attachShader(this._program,this._vshader),$p.attachShader(this._program,this._pshader),$p.linkProgram(this._program),!$c.isConchApp&&!$p.getProgramParameter(this._program,35714))throw $p.getProgramInfoLog(this._program);var $h,$P,$L=0,$q=0;for($q=$c.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35721):$p.getProgramParameter(this._program,35721),$L=0;$L<$q;$L++){var $k=null;$h={vartype:"attribute",glfun:null,ivartype:0,attrib:$k=$c.isConchApp?$p.getActiveAttribEx(this._vs,this._ps,"",$L):$p.getActiveAttrib(this._program,$L),location:$p.getAttribLocation(this._program,$k.name),name:$k.name,type:$k.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($h);}var $Y=0;for($Y=$c.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35718):$p.getProgramParameter(this._program,35718),$L=0;$L<$Y;$L++){var $d=null;$d=$c.isConchApp?$p.getActiveUniformEx(this._vs,this._ps,"",$L):$p.getActiveUniform(this._program,$L),0<($h={vartype:"uniform",glfun:null,ivartype:1,attrib:$k,location:$p.getUniformLocation(this._program,$d.name),name:$d.name,type:$d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($h.name=$h.name.substr(0,$h.name.length-3),$h.isArray=!0,$h.location=$p.getUniformLocation(this._program,$h.name)),this._params.push($h);}for($L=0,$P=this._params.length;$L<$P;$L++)if(($h=this._params[$L]).indexOfParams=$L,$h.index=1,$h.value=[$h.location,null],$h.codename=$h.name,$h.name=this._nameMap[$h.codename]?this._nameMap[$h.codename]:$h.codename,(this._paramsMap[$h.name]=$h)._this=this,$h.uploadedValue=[],"attribute"!==$h.vartype)switch($h.type){case 5124:$h.fun=$h.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$h.fun=$h.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$h.fun=$h.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$h.fun=$h.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$h.fun=$h.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$h.fun=this._uniform_sampler2D;break;case 35680:$h.fun=this._uniform_samplerCube;break;case 35676:$h.glfun=$p.uniformMatrix4fv,$h.fun=this._uniformMatrix4fv;break;case 35670:$h.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!");}else $h.fun=this._attribute;}},$p.getUniform=function($m){return this._paramsMap[$m];},$p._attribute=function($m,$p){var $h=$Zm.mainContext,$P=$zm._enableAtributes,$L=$m.location;return $P[$L]||$h.enableVertexAttribArray($L),$h.vertexAttribPointer($L,$p[0],$p[1],$p[2],$p[3],$p[4]+this._offset),$P[$L]=$zm._bindVertexBuffer,1;},$p._uniform1f=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p?($Zm.mainContext.uniform1f($m.location,$h[0]=$p),1):0;},$p._uniform1fv=function($m,$p){if($p.length<4){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Zm.mainContext.uniform1fv($m.location,$p),$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3],1):0;}return $Zm.mainContext.uniform1fv($m.location,$p),1;},$p._uniform_vec2=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]?($Zm.mainContext.uniform2f($m.location,$h[0]=$p[0],$h[1]=$p[1]),1):0;},$p._uniform_vec2v=function($m,$p){if($p.length<2){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Zm.mainContext.uniform2fv($m.location,$p),$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3],1):0;}return $Zm.mainContext.uniform2fv($m.location,$p),1;},$p._uniform_vec3=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]?($Zm.mainContext.uniform3f($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2]),1):0;},$p._uniform_vec3v=function($m,$p){return $Zm.mainContext.uniform3fv($m.location,$p),1;},$p._uniform_vec4=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Zm.mainContext.uniform4f($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3]),1):0;},$p._uniform_vec4v=function($m,$p){return $Zm.mainContext.uniform4fv($m.location,$p),1;},$p._uniformMatrix2fv=function($m,$p){return $Zm.mainContext.uniformMatrix2fv($m.location,!1,$p),1;},$p._uniformMatrix3fv=function($m,$p){return $Zm.mainContext.uniformMatrix3fv($m.location,!1,$p),1;},$p._uniformMatrix4fv=function($m,$p){return $Zm.mainContext.uniformMatrix4fv($m.location,!1,$p),1;},$p._uniform1i=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p?($Zm.mainContext.uniform1i($m.location,$h[0]=$p),1):0;},$p._uniform1iv=function($m,$p){return $Zm.mainContext.uniform1iv($m.location,$p),1;},$p._uniform_ivec2=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]?($Zm.mainContext.uniform2i($m.location,$h[0]=$p[0],$h[1]=$p[1]),1):0;},$p._uniform_ivec2v=function($m,$p){return $Zm.mainContext.uniform2iv($m.location,$p),1;},$p._uniform_vec3i=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]?($Zm.mainContext.uniform3i($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2]),1):0;},$p._uniform_vec3vi=function($m,$p){return $Zm.mainContext.uniform3iv($m.location,$p),1;},$p._uniform_vec4i=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Zm.mainContext.uniform4i($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3]),1):0;},$p._uniform_vec4vi=function($m,$p){return $Zm.mainContext.uniform4iv($m.location,$p),1;},$p._uniform_sampler2D=function($m,$p){var $h=$Zm.mainContext,$P=$m.uploadedValue;return null==$P[0]?($P[0]=this._curActTexIndex,$h.uniform1i($m.location,this._curActTexIndex),$h.activeTexture($K._TEXTURES[this._curActTexIndex]),$Hm.bindTexture($h,3553,$p),this._curActTexIndex++,1):($h.activeTexture($K._TEXTURES[$P[0]]),$Hm.bindTexture($h,3553,$p),0);},$p._uniform_samplerCube=function($m,$p){var $h=$Zm.mainContext,$P=$m.uploadedValue;return null==$P[0]?($P[0]=this._curActTexIndex,$h.uniform1i($m.location,this._curActTexIndex),$h.activeTexture($K._TEXTURES[this._curActTexIndex]),$Hm.bindTexture($h,34067,$p),this._curActTexIndex++,1):($h.activeTexture($K._TEXTURES[$P[0]]),$Hm.bindTexture($h,34067,$p),0);},$p._noSetValue=function($m){console.log("no....:"+$m.name);},$p.uploadOne=function($m,$p){this.activeResource(),$Hm.UseProgram(this._program);var $h=this._paramsMap[$m];$h.fun.call(this,$h,$p);},$p.uploadTexture2D=function($m){$M.shaderCall++;var $p=$Zm.mainContext;$p.activeTexture(33984),$Hm.bindTexture($p,3553,$m);},$p.uploadTexture2D1=function($m){$M.shaderCall++;var $p=$Zm.mainContext;$p.activeTexture(33985),$Hm.bindTexture($p,3553,$m);},$p.upload=function($m,$p){$lm.activeShader=$lm.bindShader=this,this._lastUseFrameCount===$M.loopCount||this.activeResource(),$Hm.UseProgram(this._program),this._reCompile?($p=this._params,this._reCompile=!1):$p=$p||this._params;$Zm.mainContext;for(var $h,$P,$L=$p.length,$q=0,$k=0;$k<$L;$k++)null!==($P=$m[($h=$p[$k]).name])&&($q+=$h.fun.call(this,$h,$P));$M.shaderCall+=$q;},$p.uploadArray=function($m,$p,$h){$lm.activeShader=this,($lm.bindShader=this).activeResource(),$Hm.UseProgram(this._program);this._params;for(var $P,$L,$q=0,$k=$p-2;0<=$k;$k-=2)($L=this._paramsMap[$m[$k]])&&null!=($P=$m[$k+1])&&($h&&$h[$L.name]&&$h[$L.name].bind(),$q+=$L.fun.call(this,$L,$P));$M.shaderCall+=$q;},$p.getParams=function(){return this._params;},$K.getShader=function($m){return $K.sharders[$m];},$K.create=function($m,$p,$h,$P){return new $K($m,$p,$h,$P);},$K.withCompile=function($m,$p,$h,$P){if($h&&$K.sharders[$h])return $K.sharders[$h];var $L=$K._preCompileShader[2e-4*$m];if(!$L)throw new Error("withCompile shader err!"+$m);return $L.createShader($p,$h,$P);},$K.withCompile2D=function($m,$p,$h,$P,$L){if($P&&$K.sharders[$P])return $K.sharders[$P];var $q=$K._preCompileShader[2e-4*$m+$p];if(!$q)throw new Error("withCompile shader err!"+$m+" "+$p);return $q.createShader($h,$P,$L);},$K.addInclude=function($m,$p){$am.addInclude($m,$p);},$K.preCompile=function($m,$p,$h,$P){var $L=2e-4*$m;$K._preCompileShader[$L]=new $am($L,$p,$h,$P);},$K.preCompile2D=function($m,$p,$h,$P,$L){var $q=2e-4*$m+$p;$K._preCompileShader[$q]=new $am($q,$h,$P,$L);},$K._createShader=function($m,$p,$h){var $P=$m.createShader($h);return $m.shaderSource($P,$p),$m.compileShader($P),$P;},$K._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$K._count=0,$K._preCompileShader={},$K.SHADERNAME2ID=2e-4,$K.sharders=(($K.sharders=[]).length=32,$K.sharders),$k($K,["nameKey",function(){return this.nameKey=new $u();}]),$K;}(),$vm=function($m){function $p(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$p.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id;}$R($p,"laya.webgl.utils.Buffer2D",$m);var $h=$p.prototype;return $h.needSize=function($m){var $p=this._byteLength;if($m){var $h=this._byteLength+$m;$h<=this._buffer.byteLength||this._resizeBuffer($h<<1,!0),this._byteLength=$h;}return $p;},$h._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$M.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$zm._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$zm._gl.bufferSubData(this._bufferType,0,this._buffer);},$h._bufferSubData=function($m,$p,$h){if(void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$M.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$zm._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$p||$h){var $P=this._buffer.slice($p,$h);$zm._gl.bufferSubData(this._bufferType,$m,$P);}else $zm._gl.bufferSubData(this._bufferType,$m,this._buffer);},$h._checkArrayUse=function(){},$h._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0);},$h._bind_subUpload=function($m,$p,$h){return void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($m,$p,$h),!0);},$h._resizeBuffer=function($m,$p){if($m<this._buffer.byteLength)return this;if(this.memorySize=$m,$p&&this._buffer&&0<this._buffer.byteLength){var $h=new ArrayBuffer($m);new Uint8Array($h).set(new Uint8Array(this._buffer),0),this._buffer=$h;}else this._buffer=new ArrayBuffer($m);return this._checkArrayUse(),this._upload=!0,this;},$h.append=function($m){this._upload=!0;var $p,$h;$p=$m.byteLength,$m instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$p,!0),$h=new Uint8Array(this._buffer,this._byteLength)):$m instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$p,!0),$h=new Uint16Array(this._buffer,this._byteLength)):$m instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$p,!0),$h=new Float32Array(this._buffer,this._byteLength)),$h.set($m,0),this._byteLength+=$p,this._checkArrayUse();},$h.appendU16Array=function($m,$p){this._resizeBuffer(this._byteLength+2*$p,!0);for(var $h=new Uint16Array(this._buffer,this._byteLength,$p),$P=0;$P<$p;$P++)$h[$P]=$m[$P];this._byteLength+=2*$p,this._checkArrayUse();},$h.appendEx=function($m,$p){this._upload=!0;var $h;$h=$m.byteLength,this._resizeBuffer(this._byteLength+$h,!0),new $p(this._buffer,this._byteLength).set($m,0),this._byteLength+=$h,this._checkArrayUse();},$h.appendEx2=function($m,$p,$h,$P){void 0===$P&&($P=1),this._upload=!0;var $L,$q;$L=$h*$P,this._resizeBuffer(this._byteLength+$L,!0),$q=new $p(this._buffer,this._byteLength);var $k=0;for($k=0;$k<$h;$k++)$q[$k]=$m[$k];this._byteLength+=$L,this._checkArrayUse();},$h.getBuffer=function(){return this._buffer;},$h.setNeedUpload=function(){this._upload=!0;},$h.getNeedUpload=function(){return this._upload;},$h.upload=function(){var $m=this._bind_upload();return $zm._gl.bindBuffer(this._bufferType,null),$zm._bindActive[this._bufferType]=null,$lm.activeShader=null,$m;},$h.subUpload=function($m,$p,$h){void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0);var $P=this._bind_subUpload();return $zm._gl.bindBuffer(this._bufferType,null),$zm._bindActive[this._bufferType]=null,$lm.activeShader=null,$P;},$h.disposeResource=function(){$m.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0;},$h.clear=function(){this._byteLength=0,this._upload=!0;},$P(0,$h,"bufferLength",function(){return this._buffer.byteLength;}),$P(0,$h,"byteLength",null,function($m){this._byteLength!==$m&&($m<=this._buffer.byteLength||this._resizeBuffer(2*$m+256,!0),this._byteLength=$m);}),$p.__int__=function($m){$Om.QuadrangleIB=$Om.create(35044),$nm.fillIBQuadrangle($Om.QuadrangleIB,16);},$p.FLOAT32=4,$p.SHORT=2,$p;}($zm),$gm=(function($p){function $h($m){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$h.__super.call(this,9);}$R($h,"laya.webgl.shader.d2.value.GlowSV",$p);var $m=$h.prototype;$m.setValue=function($m){$p.prototype.setValue.call(this,$m);},$m.clear=function(){$p.prototype.clear.call(this);};}($Gm),function($m){function $p($m){$p.__super.call(this,64),this.defines.add(64);}$R($p,"laya.webgl.shader.d2.value.TextSV",$m);var $h=$p.prototype;return $h.release=function(){($p.pool[$p._length++]=this).clear();},$h.clear=function(){$m.prototype.clear.call(this);},$p.create=function(){return $p._length?$p.pool[--$p._length]:new $p(null);},$p.pool=[],$p._length=0,$p;}($Gm)),$tm=function($m){function $L($m,$p,$h,$P){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$L.__super.call(this,$m,$p,$h,$P);}$R($L,"laya.webgl.shader.d2.Shader2X",$m);var $p=$L.prototype;return $p.upload2dQuick1=function($m){this.upload($m,this._params2dQuick1||this._make2dQuick1());},$p._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $m,$p=this._params,$h=0,$P=$p.length;$h<$P;$h++)$m=$p[$h],($c.isFlash||"size"!==$m.name&&"position"!==$m.name&&"texcoord"!==$m.name)&&this._params2dQuick1.push($m);}return this._params2dQuick1;},$p.disposeResource=function(){$m.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null;},$p.upload2dQuick2=function($m){this.upload($m,this._params2dQuick2||this._make2dQuick2());},$p._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $m,$p=this._params,$h=0,$P=$p.length;$h<$P;$h++)$m=$p[$h],($c.isFlash||"size"!==$m.name)&&this._params2dQuick2.push($m);}return this._params2dQuick2;},$L.create=function($m,$p,$h,$P){return new $L($m,$p,$h,$P);},$L;}($im),$Om=function($m){function $p($m){this._uint8Array=null,this._uint16Array=null,void 0===$m&&($m=35044),$p.__super.call(this),this._bufferUsage=$m,this._bufferType=34963,$c.isFlash||(this._buffer=new ArrayBuffer(8));}$R($p,"laya.webgl.utils.IndexBuffer2D",$vm);var $h=$p.prototype;return $h._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer));},$h.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer));},$h.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer));},$h.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null;},$p.QuadrangleIB=null,$p.create=function($m){return void 0===$m&&($m=35044),new $p($m);},$p;}(),$Cm=function($m){function $h($m,$p){this._floatArray32=null,this._vertexStride=0,$h.__super.call(this),this._vertexStride=$m,this._bufferUsage=$p,this._bufferType=34962,$c.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array();}$R($h,"laya.webgl.utils.VertexBuffer2D",$m);var $p=$h.prototype;return $p.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer));},$p.bind=function($m){$m&&$m._bind(),this._bind();},$p.insertData=function($m,$p){this.getFloat32Array().set($m,$p),this._upload=!0;},$p.bind_upload=function($m){$m._bind_upload()||$m._bind(),this._bind_upload()||this._bind();},$p._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer));},$p.disposeResource=function(){$m.prototype.disposeResource.call(this);},$p.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null;},$P(0,$p,"vertexStride",function(){return this._vertexStride;}),$h.create=function($m,$p){return void 0===$p&&($p=35048),new $h($m,$p);},$h;}($vm),$mp=function($m){function $Y($m,$p,$h,$P,$L,$q){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$h&&($h=6408),void 0===$P&&($P=!0),$Y.__super.call(this,$m,$p),$m){if(this._format=$h,this._mipmap=$P,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $m)this._url=$m,this._src=$m,this._image=new $$.window.Image(),$p&&($p.onload&&(this.onload=$p.onload),$p.onerror&&(this.onerror=$p.onerror),$p.onCreate&&$p.onCreate(this)),this._image.crossOrigin=$m&&0==$m.indexOf("data:")?null:"",$m&&(this._image.src=$m);else if($m instanceof ArrayBuffer){this._src=$p,this._url=this._src;var $k=new $d($m);$k.readUTFBytes(4),$k.readUTFBytes(2),$k.getInt16();$k.endian="bigEndian",this._w=$k.getInt16(),this._h=$k.getInt16();$k.getInt16(),$k.getInt16();this._image=new Uint8Array($m,$k.pos),this._format=$Zm.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$s.enabled&&this._w<$s.atlasLimitWidth&&this._h<$s.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1;}else{if(!($m instanceof Uint8Array))return this._src=$p,this._url=this._src,this._image=$m.source||$m,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$p,this._url=this._src,this._w=$L,this._h=$q,this._image=$m,this._format=0===$h?$m.byteLength/($L*$q)==4?6408:6407:$h;}this._$5__enableMerageInAtlas=!0;}}$R($Y,"laya.webgl.resource.WebGLImage",$B);var $p=$Y.prototype;return $W.imps($p,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$p._init_=function($m,$p){},$p._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $m=$Zm.mainContext,$p=this._source=$m.createTexture(),$h=$Hm.curBindTexTarget,$P=$Hm.curBindTexValue;$Hm.bindTexture($m,3553,$p);var $L=this.minFifter,$q=this.magFifter,$k=this.repeat?10497:33071,$Y=$D.isPOT(this._w,this._h),$d=!1;switch($Y?(this.mipmap?-1!==$L||($L=9987):-1!==$L||($L=9729),-1!==$q||($q=9729),$m.texParameteri(3553,10241,$L),$m.texParameteri(3553,10240,$q),$m.texParameteri(3553,10242,$k),$m.texParameteri(3553,10243,$k),this.mipmap&&$m.generateMipmap(3553)):(-1!==$L||($L=9729),-1!==$q||($q=9729),$m.texParameteri(3553,10241,$L),$m.texParameteri(3553,10240,$q),$m.texParameteri(3553,10242,33071),$m.texParameteri(3553,10243,33071)),$m.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$m.pixelStorei($m.UNPACK_ALIGNMENT,1),$m.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$m.pixelStorei($m.UNPACK_ALIGNMENT,1),$m.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$d=!0,$m.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $Zm.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$d=!0,$m.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format);}$m.pixelStorei(37441,!1),$h&&$P&&$Hm.bindTexture($m,$h,$P),this.uri||(this.uri=this._url),$d?this.memorySize=this._image.length:$Y&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1;},$p.recreateResource=function(){var $m=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate();}else{this._recreateLock=!0;var $p=this;this._image=new $$.window.Image(),this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($p._needReleaseAgain)return $p._needReleaseAgain=!1,$p._image.onload=null,void($p._image=null);$p._allowMerageInAtlas&&$p._enableMerageInAtlas?($m.memorySize=0,$m._recreateLock=!1):$p._createWebGlTexture(),$p.completeCreate();},this._image.src=this._src;}},$p.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$Zm.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0;},$p.onresize=function(){this._w=this._image.width,this._h=this._image.height,$s.enabled&&this._w<$s.atlasLimitWidth&&this._h<$s.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1;},$p.clearAtlasSource=function(){this._image=null;},$P(0,$p,"format",function(){return this._format;}),$P(0,$p,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas;},function($m){this._$5__enableMerageInAtlas=$m;}),$P(0,$p,"mipmap",function(){return this._mipmap;}),$P(0,$p,"allowMerageInAtlas",function(){return this._allowMerageInAtlas;}),$P(0,$p,"atlasSource",function(){return this._image;}),$P(0,$p,"onload",null,function($m){var $p=this;this._onload=$m,this._image&&(this._image.onload=null!=this._onload?function(){$p.onresize(),$p._onload();}:null);}),$P(0,$p,"onerror",null,function($m){var $p=this;this._onerror=$m,this._image&&(this._image.onerror=null!=this._onerror?function(){$p._onerror();}:null);}),$Y;}();$W.__init([$$m,$X,$Em,$am]);}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($m,$p){"use strict";for(var $h in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $P=Laya[$h];$P&&$P.__isclass&&($p[$h]=$P);}}),function($q,$m,$P){$P.un,$P.uns;var $L=$P.static,$k=$P.class,$Y=$P.getset,$d=($P.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$A=laya.utils.ClassUtils,$F=(laya.events.Event,laya.utils.HTMLChar),$K=laya.net.Loader,$D=(laya.display.Node,laya.maths.Rectangle),$R=laya.renders.Render,$$=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$B=laya.utils.Stat,$l=laya.display.Text,$n=laya.resource.Texture,$c=laya.net.URL,$e=laya.utils.Utils,$a=function(){function $$(){}return $k($$,"laya.html.utils.HTMLParse"),$$.parse=function($m,$p,$h){$p=($p="<root>"+($p=$p.replace(/<br>/g,"<br/>"))+"</root>").replace($$.spacePattern,$$.char255);var $P=$e.parseXMLFromString($p);$$._parseXML($m,$P.childNodes[0].childNodes,$h);},$$._parseXML=function($m,$p,$h,$P){var $L=0,$q=0;if($p.join||$p.item)for($L=0,$q=$p.length;$L<$q;++$L)$$._parseXML($m,$p[$L],$h,$P);else{var $k,$Y,$d;if(3==$p.nodeType)return void($m instanceof laya.html.dom.HTMLDivElement?(null==$p.nodeName&&($p.nodeName="#text"),$Y=$p.nodeName.toLowerCase(),0<($d=$p.textContent.replace(/^\s+|\s+$/g,"")).length&&($k=$A.getInstance($Y))&&($m.addChild($k),$k.innerTEXT=$d.replace($$.char255AndOneSpacePattern," "))):0<($d=$p.textContent.replace(/^\s+|\s+$/g,"")).length&&($m.innerTEXT=$d.replace($$.char255AndOneSpacePattern," ")));if("#comment"==($Y=$p.nodeName.toLowerCase()))return;if($k=$A.getInstance($Y)){($k=$m.addChild($k)).URI=$h,$k.href=$P;var $K=$p.attributes;if($K&&0<$K.length)for($L=0,$q=$K.length;$L<$q;++$L){var $D=$K[$L],$F=$D.nodeName,$R=$D.value;$k._setAttributes($F,$R);}$$._parseXML($k,$p.childNodes,$h,$k.href);}else $$._parseXML($m,$p.childNodes,$h,$P);}},$$.char255=String.fromCharCode(255),$$.spacePattern=/&nbsp;|&#160;/g,$$.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$$;}(),$Z=function(){function $_(){}return $k($_,"laya.html.utils.Layout"),$_.later=function($m){null==$_._will&&($_._will=[],$P.stage.frameLoop(1,null,function(){if(!($_._will.length<1)){for(var $m=0;$m<$_._will.length;$m++)laya.html.utils.Layout.layout($_._will[$m]);$_._will.length=0;}})),$_._will.push($m);},$_.layout=function($m){if(!$m||!$m._style)return null;if(0==(512&$m._style._type))return null;$m.getStyle()._type&=-513;var $p=$_._multiLineLayout($m);return $R.isConchApp&&$m.layaoutCallNative&&$m.layaoutCallNative(),$p;},$_._multiLineLayout=function($m){if($l.RightToLeft)return $_._multiLineLayout2($m);var $p=new Array();$m._addChildsToLayout($p);var $h,$P,$L,$q,$k,$Y=0,$d=$p.length,$K=$m._getCSSStyle(),$D=$K.letterSpacing,$F=$K.leading,$R=$K.lineHeight,$$=$K._widthAuto()||!$K.wordWrap,$A=$$?999999:$m.width,$B=($m.height,0),$n=$K.italic?$K.fontSize/3:0,$c=$K._getAlign(),$e=$K._getValign(),$a=0!==$e||0!==$c||0!=$R,$Z=0,$H=0,$W=0,$E=0,$I=new Array(),$b=$I[0]=new $J(),$T=!1,$j=!1;$b.h=0,$K.italic&&($A-=$K.fontSize/3);var $x=0,$Q=!0;function $M(){$b.y=$H,$H+=$b.h+$F,0==$b.h&&($H+=$R),$b.mWidth=$x,$x=0,$b=new $J(),$I.push($b),$b.h=0,$T=!($Q=!($Z=0));}for($Y=0;$Y<$d;$Y++)if(null!=($h=$p[$Y])){if($Q=!1,$h instanceof laya.html.dom.HTMLBrElement)$M(),$b.y=$H;else{if($h._isChar()){if(($q=$h).isWord)$T=$j||"\n"===$q.char,$b.wordStartIndex=$b.elements.length;else{if($W=$q.width+$q.style.letterSpacin,0<$I.length&&$A<$Z+$W&&0<$b.wordStartIndex){var $u;$u=$b.elements.length-$b.wordStartIndex+1,$b.elements.length=$b.wordStartIndex,$Y-=$u,$M();continue;}$T=!1,$x+=$q.width;}$W=$q.width+$D,$E=$q.height,$j=!1,($T=$T||$A<$Z+$W)&&$M(),$b.minTextHeight=Math.min($b.minTextHeight,$h.height);}else $P=$h._getCSSStyle(),$k=$h,$L=$P.padding,0===$P._getCssFloat()||($a=!0),$T=$j||$P.lineElement,$W=$k.width*$k._style._tf.scaleX+$L[1]+$L[3]+$D,$E=$k.height*$k._style._tf.scaleY+$L[0]+$L[2],$j=$P.lineElement,($T=$T||$A<$Z+$W&&$P.wordWrap)&&$M();$b.elements.push($h),$b.h=Math.max($b.h,$E),$h.x=$Z,$h.y=$H,$Z+=$W,$b.w=$Z-$D,$b.y=$H,$B=Math.max($Z+$n,$B);}}else $Q||($Z+=$_.DIV_ELEMENT_PADDING),$b.wordStartIndex=$b.elements.length;if($H=$b.y+$b.h,$a){var $N=0,$S=$A;for($$&&0<$m.width&&($S=$m.width),$Y=0,$d=$I.length;$Y<$d;$Y++)$I[$Y].updatePos(0,$S,$Y,$N,$c,$e,$R),$N+=Math.max($R,$I[$Y].h+$F);$H=$N;}return $$&&($m.width=$B),$H>$m.height&&($m.height=$H),[$B,$H];},$_._multiLineLayout2=function($m){var $p=new Array();$m._addChildsToLayout($p);var $h,$P,$L,$q,$k,$Y=0,$d=$p.length,$K=$m._getCSSStyle(),$D=$K.letterSpacing,$F=$K.leading,$R=$K.lineHeight,$$=$K._widthAuto()||!$K.wordWrap,$A=$$?999999:$m.width,$B=($m.height,0),$n=$K.italic?$K.fontSize/3:0,$c=2-$K._getAlign(),$e=$K._getValign(),$a=0!==$e||0!=$c||0!=$R,$Z=0,$H=0,$W=0,$E=0,$I=new Array(),$b=$I[0]=new $J(),$T=!1,$j=!1;$b.h=0,$K.italic&&($A-=$K.fontSize/3);var $x=0,$Q=!0;function $M(){$b.y=$H,$H+=$b.h+$F,0==$b.h&&($H+=$R),$b.mWidth=$x,$x=0,$b=new $J(),$I.push($b),$b.h=0,$T=!($Q=!($Z=0));}for($Y=0;$Y<$d;$Y++)if(null!=($h=$p[$Y])){if($Q=!1,$h instanceof laya.html.dom.HTMLBrElement)$M(),$b.y=$H;else{if($h._isChar()){if(($q=$h).isWord)$T=$j||"\n"===$q.char,$b.wordStartIndex=$b.elements.length;else{if(0<$I.length&&$A<$Z+$W&&0<$b.wordStartIndex){var $u;$u=$b.elements.length-$b.wordStartIndex+1,$b.elements.length=$b.wordStartIndex,$Y-=$u,$M();continue;}$T=!1,$x+=$q.width;}$W=$q.width+$D,$E=$q.height,$j=!1,($T=$T||$A<$Z+$W)&&$M(),$b.minTextHeight=Math.min($b.minTextHeight,$h.height);}else $P=$h._getCSSStyle(),$k=$h,$L=$P.padding,0===$P._getCssFloat()||($a=!0),$T=$j||$P.lineElement,$W=$k.width*$k._style._tf.scaleX+$L[1]+$L[3]+$D,$E=$k.height*$k._style._tf.scaleY+$L[0]+$L[2],$j=$P.lineElement,($T=$T||$A<$Z+$W&&$P.wordWrap)&&$M();$b.elements.push($h),$b.h=Math.max($b.h,$E),$h.x=$Z,$h.y=$H,$Z+=$W,$b.w=$Z-$D,$b.y=$H,$B=Math.max($Z+$n,$B);}}else $Q||($Z+=$_.DIV_ELEMENT_PADDING),$b.wordStartIndex=$b.elements.length;if($H=$b.y+$b.h,$a){var $N=0,$S=$A;for($Y=0,$d=$I.length;$Y<$d;$Y++)$I[$Y].updatePos(0,$S,$Y,$N,$c,$e,$R),$N+=Math.max($R,$I[$Y].h+$F);$H=$N;}for($$&&($m.width=$B),$H>$m.height&&($m.height=$H),$Y=0,$d=$I.length;$Y<$d;$Y++)$I[$Y].revertOrder($A);return[$B,$H];},$_._will=null,$_.DIV_ELEMENT_PADDING=0,$_;}(),$J=function(){function $m(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array();}$k($m,"laya.html.utils.LayoutLine");var $p=$m.prototype;return $p.updatePos=function($m,$p,$h,$P,$L,$q,$k){var $Y,$d=0;0<this.elements.length&&($d=($Y=this.elements[this.elements.length-1]).x+$Y.width-this.elements[0].x);var $K=0,$D=NaN;1===$L&&($K=($p-$d)/2),2===$L&&($K=$p-$d),0===$k||0!=$q||($q=1);for(var $F=0,$R=this.elements.length;$F<$R;$F++){var $$=($Y=this.elements[$F])._getCSSStyle();switch(0!==$K&&($Y.x+=$K),$$._getValign()){case 0:$Y.y=$P;break;case 1:var $A=0;99999!=this.minTextHeight&&($A=this.minTextHeight);var $B=($A+$k)/2;$B=Math.max($B,this.h),$D=(laya.html.dom.HTMLImageElement,$P+$B-$Y.height),$Y.y=$D;break;case 2:$Y.y=$P+($k-$Y.height);}}},$p.revertOrder=function($m){var $p;if(0<this.elements.length){var $h,$P=0;for($h=this.elements.length,$P=0;$P<$h;$P++)($p=this.elements[$P]).x=$m-$p.x-$p.width;}},$m;}(),$H=function($h){function $p(){this.URI=null,this._href=null,$p.__super.call(this),this._text=$p._EMPTYTEXT,this.setStyle(new $d(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0;}$k($p,"laya.html.dom.HTMLElement",$h);var $m=$p.prototype;return $m.layaoutCallNative=function(){var $m=0;if(this._childs&&0<($m=this._childs.length))for(var $p=0;$p<$m;$p++)this._childs[$p].layaoutCallNative&&this._childs[$p].layaoutCallNative();var $h=this._getWords();$h?laya.html.dom.HTMLElement.fillWords(this,$h,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear();},$m.appendChild=function($m){return this.addChild($m);},$m._getWords2=function(){var $m=this._text.text;if(!$m||0===$m.length)return null;var $p,$h,$P=0,$L=0;if(this._text.drawWords)$h=this._text.drawWords;else{for($L=($p=$m.split(" ")).length-1,$h=[],$P=0;$P<$L;$P++)$h.push($p[$P]," ");0<=$L&&$h.push($p[$L]),this._text.drawWords=$h;}var $q,$k=this._text.words;if($k&&$k.length===$h.length)return $k;null===$k&&(this._text.words=$k=[]),$k.length=$h.length;var $Y=this.style,$d=$Y.font;for($P=0,$L=$h.length;$P<$L;$P++){$q=$e.measureText($h[$P],$d);var $K=$k[$P]=new $F($h[$P],$q.width,$q.height||$Y.fontSize,$Y);if(1<$K.char.length&&($K.charNum=$K.char),this.href){var $D=new $$();this.addChild($D),$K.setSprite($D);}}return $k;},$m._getWords=function(){if(!$l.CharacterCache)return this._getWords2();var $m=this._text.text;if(!$m||0===$m.length)return null;var $p,$h=this._text.words;if($h&&$h.length===$m.length)return $h;null===$h&&(this._text.words=$h=[]),$h.length=$m.length;for(var $P=this.style,$L=$P.font,$q=0,$k=$m.length;$q<$k;$q++)if($p=$e.measureText($m.charAt($q),$L)){var $Y=$h[$q]=new $F($m.charAt($q),$p.width,$p.height||$P.fontSize,$P);if(this.href){var $d=new $$();this.addChild($d),$Y.setSprite($d);}}else console.warn("_getWords size is null"+$m.charAt($q),$L);return $h;},$m.showLinkSprite=function(){var $m=this._text.words;if($m)for(var $p,$h,$P=[],$L=0;$L<$m.length;$L++)$h=$m[$L],($p=new $$()).graphics.drawRect(0,0,$h.width,$h.height,"#ff0000"),$p.width=$h.width,$p.height=$h.height,this.addChild($p),$P.push($p);},$m._layoutLater=function(){var $m=this.style;512&$m._type||($m.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$m.block?($Z.later(this),$m._type|=512):this.parent&&this.parent._layoutLater());},$m._setAttributes=function($m,$p){switch($m){case"style":return void this.style.cssText($p);case"class":return void(this.className=$p);}$h.prototype._setAttributes.call(this,$m,$p);},$m.updateHref=function(){if(null!=this._href){var $m=this._getWords();if($m)for(var $p,$h,$P=0;$P<$m.length;$P++)($h=($p=$m[$P]).getSprite())&&($h.size($p.width,$p.height),$h.on("click",this,this.onLinkHandler));}},$m.onLinkHandler=function($m){switch($m.type){case"click":for(var $p=this;$p;)$p.event("link",[this.href]),$p=$p.parent;}},$m.formatURL=function($m){return this.URI?$c.formatURL($m,this.URI?this.URI.path:null):$m;},$Y(0,$m,"href",function(){return this._href;},function($m){null!=(this._href=$m)&&(this._getCSSStyle().underLine=1,this.updateHref());}),$Y(0,$m,"color",null,function($m){this.style.color=$m;}),$Y(0,$m,"onClick",null,function($m){$P._runScript("fn=function(event){"+$m+";}"),this.on("click",this,void 0);}),$Y(0,$m,"id",null,function($m){$W.document.setElementById($m,this);}),$Y(0,$m,"innerTEXT",function(){return this._text.text;},function($m){this.text=$m;}),$Y(0,$m,"style",function(){return this._style;}),$Y(0,$m,"text",function(){return this._text.text;},function($m){this._text==$p._EMPTYTEXT?this._text={text:$m,words:null}:(this._text.text=$m,this._text.words&&(this._text.words.length=0)),$R.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref();}),$Y(0,$m,"parent",$h.prototype._$get_parent,function($m){if($m instanceof laya.html.dom.HTMLElement){var $p=$m;this.URI||(this.URI=$p.URI),this.style.inherit($p.style);}$P.superSet($$,this,"parent",$m);}),$Y(0,$m,"className",null,function($m){this.style.attrs($W.document.styleSheets["."+$m]);}),$p.fillWords=function($m,$p,$h,$P,$L,$q,$k){$m.graphics.clear();for(var $Y=0,$d=$p.length;$Y<$d;$Y++){var $K=$p[$Y];$m.graphics.fillText($K.char,$K.x+$h,$K.y+$P,$L,$q,"left",$k);}},$p._EMPTYTEXT={text:null,words:null},$p;}($$),$p=(function($m){function $p(){$p.__super.call(this),this.style.lineElement=!0,this.style.block=!0;}$k($p,"laya.html.dom.HTMLBrElement",$H);}(),function($m){function $p(){this.contextHeight=NaN,this.contextWidth=NaN,$p.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200;}$k($p,"laya.html.dom.HTMLDivElement",$m);var $h=$p.prototype;return $h.appendHTML=function($m){$a.parse(this,$m,this.URI),this.layout();},$h._addChildsToLayout=function($p){var $m=this._getWords();if(null==$m&&0==this._childs.length)return!1;$m&&$m.forEach(function($m){$p.push($m);});for(var $h=!0,$P=0,$L=this._childs.length;$P<$L;$P++){var $q=this._childs[$P];$h?$h=!1:$p.push(null),$q._addToLayout($p);}return!0;},$h._addToLayout=function($m){this.layout();},$h.layout=function(){if(this.style){this.style._type|=512;var $m=$Z.layout(this);if($m){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $D());var $p=this._$P.mHtmlBounds;$p.x=$p.y=0,$p.width=this.contextWidth=$m[0],$p.height=this.contextHeight=$m[1],this.setBounds($p);}}},$Y(0,$h,"height",function(){return this._height?this._height:this.contextHeight;},$m.prototype._$set_height),$Y(0,$h,"innerHTML",null,function($m){this.destroyChildren(),this.appendHTML($m);}),$Y(0,$h,"width",function(){return this._width?this._width:this.contextWidth;},function($m){var $p=!1;$p=0===$m?$m!=this._width:$m!=this.width,$P.superSet($H,this,"width",$m),$p&&this.layout();}),$p;}($H)),$W=function($m){function $p(){this.all=new Array(),this.styleSheets=$d.styleSheets,$p.__super.call(this);}$k($p,"laya.html.dom.HTMLDocument",$H);var $h=$p.prototype;return $h.getElementById=function($m){return this.all[$m];},$h.setElementById=function($m,$p){this.all[$m]=$p;},$L($p,["document",function(){return this.document=new $p();}]),$p;}();(function($m){function $p(){this._tex=null,this._url=null,this._renderArgs=[],$p.__super.call(this),this.style.block=!0;}$k($p,"laya.html.dom.HTMLImageElement",$H);var $h=$p.prototype;$h._addToLayout=function($m){!this._style.absolute&&$m.push(this);},$h.render=function($m,$p,$h){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($B.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$m.ctx.drawTexture2($p,$h,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs));},$h.layaoutCallNative=function(){var $m=0;if(this._childs&&0<($m=this._childs.length))for(var $p=0;$p<$m;$p++)this._childs[$p].layaoutCallNative&&this._childs[$p].layaoutCallNative();},$Y(0,$h,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width;},function($m){this._width!==$m&&(this._width=$m,this._style.width=$m,this.repaint());}),$Y(0,$h,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height;},function($m){this._height!==$m&&(this._height=$m,this._style.height=$m,this.repaint());}),$h.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$K.clearCache(this,this._url),this._tex=null),$H.prototype.destroy.call(this);},$h.onloaded=function(){var $m=this._style;$m&&!$m.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$m&&!$m.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$R.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint();},$h._loadImageComplete=function($m,$p,$h){if(!this._destroyed)if(null!=$h){if($h instanceof ArrayBuffer){var $P=new DataView($h);new laya.webgl.resource.WebGLImage(new Uint8Array($h,8),$m,0,!1,$P.getUint32(0),$P.getUint32(4));this.onloaded();}else if($h instanceof $n)$K.imgMgrSet[$m]=$p,$q.imgMgrLock($m,$K.imgMgrSet[$m]),this._url=$m,this._tex=$h,$K.keepCache(this,$m),$K.cacheRes($m,this._tex),this.onloaded();else{var $L=-1!=$m.indexOf(".png",$m.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($h,$m,$L,!1,$h.width,$h.height);this.onloaded();}}else this.event("error","Load image failed");},$Y(0,$h,"src",null,function($m){($m=this.formatURL($m),this._url!=$m)&&(null!=this._tex&&($K.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$m,(this._tex=$K.getRes($m))?($K.keepCache(this,$m),this.onloaded()):$q.imgMgrLoad($m,this._loadImageComplete.bind(this),2,!1));});})(),function($m){function $p(){this.type=null,$p.__super.call(this),this.visible=!1;}$k($p,"laya.html.dom.HTMLLinkElement",$m);var $h=$p.prototype;$h._onload=function($m){switch(this.type){case"text/css":$d.parseCSS($m,this.URI);}},$Y(0,$h,"href",$m.prototype._$get_href,function($m){var $p=this;$m=this.formatURL($m),this.URI=new $c($m);var $h=new $K();$h.once("complete",null,function($m){$p._onload($m);}),$h.load($m,"text");}),$p._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g");}($H),function($m){function $p(){$p.__super.call(this),this.visible=!1;}$k($p,"laya.html.dom.HTMLStyleElement",$m),$Y(0,$p.prototype,"text",$m.prototype._$get_text,function($m){$d.parseCSS($m,null);});}($H),function($m){function $p(){$p.__super.call(this),this._getCSSStyle().valign="middle";}$k($p,"laya.html.dom.HTMLIframeElement",$m),$Y(0,$p.prototype,"href",$m.prototype._$get_href,function($h){var $P=this;$h=this.formatURL($h);var $m=new $K();$m.once("complete",null,function($m){var $p=$P.URI;$P.URI=new $c($h),$P.innerHTML=$m,!$p||($P.URI=$p);}),$m.load($h,"text");});}($p);}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($m,$p){"use strict";for(var $h in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $P=Laya[$h];$P&&$P.__isclass&&($p[$h]=$P);}}),function($L,$m,$B){$B.un,$B.uns;var $P=$B.static,$q=$B.class,$k=$B.getset,$h=($B.__newvec,laya.display.Animation),$n=(laya.utils.Browser,laya.utils.ClassUtils),$Y=laya.filters.ColorFilter,$d=laya.utils.Ease,$K=laya.events.Event,$D=(laya.events.EventDispatcher,laya.display.css.Font),$F=laya.display.FrameAnimation,$p=laya.display.Graphics,$R=laya.utils.Handler,$$=laya.display.Input,$e=laya.net.Loader,$A=(laya.display.Node,laya.maths.Point),$c=laya.maths.Rectangle,$a=laya.renders.Render,$Z=laya.display.Sprite,$H=laya.display.Text,$W=laya.resource.Texture,$E=laya.utils.Tween,$I=laya.utils.Utils,$b=laya.utils.WeakObject;$B.interface("laya.ui.IItem"),$B.interface("laya.ui.ISelect"),$B.interface("laya.ui.IRender"),$B.interface("laya.ui.IComponent"),$B.interface("laya.ui.IBox","IComponent");var $T=function(){function $m(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN;}return $q($m,"laya.ui.LayoutStyle"),$P($m,["EMPTY",function(){return this.EMPTY=new $m();}]),$m;}(),$j=function(){function $m(){}return $q($m,"laya.ui.Styles"),$m.labelColor="#000000",$m.buttonStateNum=3,$m.scrollBarMinNum=15,$m.scrollBarDelayTime=500,$P($m,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0];},"labelPadding",function(){return this.labelPadding=[2,2,2,2];},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3];},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"];},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"];}]),$m;}(),$x=function(){function $L(){}return $q($L,"laya.ui.UIUtils"),$L.fillArray=function($m,$p,$h){var $P=$m.concat();if($p)for(var $L=$p.split(","),$q=0,$k=Math.min($P.length,$L.length);$q<$k;$q++){var $Y=$L[$q];$P[$q]="true"==$Y||"false"!=$Y&&$Y,null!=$h&&($P[$q]=$h($Y));}return $P;},$L.toColor=function($m){return $I.toHexColor($m);},$L.gray=function($m,$p){void 0===$p&&($p=!0),$p?$L.addFilter($m,$L.grayFilter):$L.clearFilter($m,$Y);},$L.addFilter=function($m,$p){var $h=$m.filters||[];$h.push($p),$m.filters=$h;},$L.clearFilter=function($m,$p){var $h=$m.filters;if(null!=$h&&0<$h.length){for(var $P=$h.length-1;-1<$P;$P--){var $L=$h[$P];$B.__typeof($L,$p)&&$h.splice($P,1);}$m.filters=$h;}},$L._getReplaceStr=function($m){return $L.escapeSequence[$m];},$L.adptString=function($m){return $m.replace(/\\(\w)/g,$L._getReplaceStr);},$L.getBindFun=function($m){var $p=$L._funMap.get($m);if(null==$p){var $h='"'+$m+'"',$P="(function(data){if(data==null)return;with(data){try{\nreturn "+($h=$h.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$p=$B._runScript($P),$L._funMap.set($m,$p);}return $p;},$P($L,["grayFilter",function(){return this.grayFilter=new $Y([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]);},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"};},"_funMap",function(){return this._funMap=new $b();}]),$L;}(),$Q=function(){function $m(){}return $q($m,"UIConfig"),$m.touchScrollEnable=!0,$m.mouseWheelEnable=!0,$m.showButtons=!0,$m.popupBgColor="#000000",$m.popupBgAlpha=.5,$m.closeDialogOnSide=!0,$m;}(),$M=function($h){function $c(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$c.__super.call(this),this._weakKeys=[];}$q($c,"laya.ui.AutoBitmap",$h);var $m=$c.prototype;return $m.destroy=function(){if($e.clearObject(this,this._weakKey),this._weakKeys){for(var $m=0,$p=this._weakKeys.length;$m<$p;++$m)$e.clearObject(this,this._weakKeys[$m]);this._weakKeys=null;}$h.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null;},$m._setChanged=function(){this._isChanged||(this._isChanged=!0,$B.timer.callLater(this,this.changeSource));},$m.changeSource=function(){this._isChanged=!1;var $m=this._source;if($m&&$m.bitmap){var $p=this.width,$h=this.height,$P=this._sizeGrid,$L=$m.sourceWidth,$q=$m.sourceHeight;if(!$P||$L===$p&&$q===$h)this.cleanByTexture($m,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$p,$h);else{$e.clearObject(this,this._weakKey),$m.$_GID||($m.$_GID=$I.getGID());var $k=$m.$_GID+"."+$p+"."+$h+"."+$P.join("."),$Y=$e.findObject($k);if($I.isOKCmdList($Y))return this._weakKey=$k,$e.keepObject(this,this._weakKey),void(this.cmds=$Y);this.clear();var $d,$K,$D=$P[0],$F=$P[1],$R=$P[2],$$=$P[3],$A=$P[4],$B=!1;if($p==$L&&($$=$F=0),$h==$q&&($D=$R=0),$p<$$+$F){var $n=$p;$B=!0,$p=$$+$F,this.save(),this.clipRect(0,0,$n,$h);}$$&&$D&&($d=$c.getTexture($m,0,0,$$,$D),$K=this._weakKeys[0],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[0]=$d.weakKey),this.drawTexture($d,0,0,$$,$D)):($e.clearObject(this,$K),this._weakKeys[0]="")),$F&&$D&&($d=$c.getTexture($m,$L-$F,0,$F,$D),$K=this._weakKeys[1],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[1]=$d.weakKey),this.drawTexture($d,$p-$F,0,$F,$D)):($e.clearObject(this,$K),this._weakKeys[1]="")),$$&&$R&&($d=$c.getTexture($m,0,$q-$R,$$,$R),$K=this._weakKeys[2],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[2]=$d.weakKey),this.drawTexture($d,0,$h-$R,$$,$R)):($e.clearObject(this,$K),this._weakKeys[2]="")),$F&&$R&&($d=$c.getTexture($m,$L-$F,$q-$R,$F,$R),$K=this._weakKeys[3],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[3]=$d.weakKey),this.drawTexture($d,$p-$F,$h-$R,$F,$R)):($e.clearObject(this,$K),this._weakKeys[3]="")),$D&&($d=$c.getTexture($m,$$,0,$L-$$-$F,$D),$K=this._weakKeys[4],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[4]=$d.weakKey),this.drawBitmap($A,$d,$$,0,$p-$$-$F,$D)):($e.clearObject(this,$K),this._weakKeys[4]="")),$R&&($d=$c.getTexture($m,$$,$q-$R,$L-$$-$F,$R),$K=this._weakKeys[5],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[5]=$d.weakKey),this.drawBitmap($A,$d,$$,$h-$R,$p-$$-$F,$R)):($e.clearObject(this,$K),this._weakKeys[5]="")),$$&&($d=$c.getTexture($m,0,$D,$$,$q-$D-$R),$K=this._weakKeys[6],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[6]=$d.weakKey),this.drawBitmap($A,$d,0,$D,$$,$h-$D-$R)):($e.clearObject(this,$K),this._weakKeys[6]="")),$F&&($d=$c.getTexture($m,$L-$F,$D,$F,$q-$D-$R),$K=this._weakKeys[7],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[7]=$d.weakKey),this.drawBitmap($A,$d,$p-$F,$D,$F,$h-$D-$R)):($e.clearObject(this,$K),this._weakKeys[7]="")),$d=$c.getTexture($m,$$,$D,$L-$$-$F,$q-$D-$R),$K=this._weakKeys[8],$d?($K!=$d.weakKey&&($e.clearObject(this,$K),$e.keepObject(this,$d.weakKey),this._weakKeys[8]=$d.weakKey),this.drawBitmap($A,$d,$$,$D,$p-$$-$F,$h-$D-$R)):($e.clearObject(this,$K),this._weakKeys[8]=""),$B&&this.restore(),this.autoCacheCmd&&!$a.isConchApp&&($e.saveObject($k,this.cmds,null),this._weakKey=$k,$e.keepObject(this,this._weakKey));}this._repaint();}},$m.drawBitmap=function($m,$p,$h,$P,$L,$q){void 0===$L&&($L=0),void 0===$q&&($q=0),$L<.1||$q<.1||(!$m||$p.width==$L&&$p.height==$q?this.drawTexture($p,$h,$P,$L,$q):this.fillTexture($p,$h,$P,$L,$q));},$m.clear=function($m){void 0===$m&&($m=!0),$h.prototype.clear.call(this,!1);},$k(0,$m,"sizeGrid",function(){return this._sizeGrid;},function($m){this._sizeGrid=$m,this._setChanged();}),$k(0,$m,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0;},function($m){this._width!=$m&&(this._width=$m,this._setChanged());}),$k(0,$m,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0;},function($m){this._height!=$m&&(this._height=$m,this._setChanged());}),$k(0,$m,"source",function(){return this._source;},function($m){$m?(this._source=$m,this._setChanged()):(this._source=null,this.clear());}),$c.getTexture=function($m,$p,$h,$P,$L){$P<=0&&($P=1),$L<=0&&($L=1),$m.$_GID||($m.$_GID=$I.getGID());var $q=$m.$_GID+"."+$p+"."+$h+"."+$P+"."+$L,$k=$e.findObject($q);if((!$k||!$k.source)&&($k=$W.createFromTexture($m,$p,$h,$P,$L))){if($m.alphaTexture){var $Y=$m.width/$m.alphaTexture.width;$k.alphaTexture=$W.createFromTexture($m.alphaTexture,$p/$Y,$h/$Y,$P/$Y,$L/$Y);}$e.saveObject($q,$k),$k.weakKey=$q;}return $k;},$c;}($p),$u=(function($m){function $p(){$p.__super.call(this);}$q($p,"laya.ui.UIEvent",$K),$p.SHOW_TIP="showtip",$p.HIDE_TIP="hidetip";}(),function($p){function $m(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$m.__super.call(this),this._layout=$T.EMPTY,this.preinitialize(),this.createChildren(),this.initialize();}$q($m,"laya.ui.Component",$p);var $h=$m.prototype;return $B.imps($h,{"laya.ui.IComponent":!0}),$h.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null;},$h.preinitialize=function(){},$h.createChildren=function(){},$h.initialize=function(){},$h.callLater=function($m,$p){$B.timer.callLater(this,$m,$p);},$h.runCallLater=function($m){$B.timer.runCallLater(this,$m);},$h.commitMeasure=function(){},$h.changeSize=function(){this.event("resize");},$h.getLayout=function(){return this._layout===$T.EMPTY&&(this._layout=new $T()),this._layout;},$h._setLayoutEnabled=function($m){this._layout&&this._layout.enable!=$m&&(this._layout.enable=$m,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded());},$h.onRemoved=function(){this.parent.off("resize",this,this.onCompResize);},$h.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY();},$h.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY());},$h.resetLayoutX=function(){var $m=this._layout;if(isNaN($m.anchorX)||(this.pivotX=$m.anchorX*this.width),this.layoutEnabled){var $p=this.parent;$p&&(isNaN($m.centerX)?isNaN($m.left)?isNaN($m.right)||(this.x=Math.round($p.width-this.displayWidth-$m.right+this.pivotX*this.scaleX)):(this.x=Math.round($m.left+this.pivotX*this.scaleX),isNaN($m.right)||(this.width=($p._width-$m.left-$m.right)/(this.scaleX||.01))):this.x=Math.round(.5*($p.width-this.displayWidth)+$m.centerX+this.pivotX*this.scaleX));}},$h.resetLayoutY=function(){var $m=this._layout;if(isNaN($m.anchorY)||(this.pivotY=$m.anchorY*this.height),this.layoutEnabled){var $p=this.parent;$p&&(isNaN($m.centerY)?isNaN($m.top)?isNaN($m.bottom)||(this.y=Math.round($p.height-this.displayHeight-$m.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($m.top+this.pivotY*this.scaleY),isNaN($m.bottom)||(this.height=($p._height-$m.top-$m.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($p.height-this.displayHeight)+$m.centerY+this.pivotY*this.scaleY));}},$h.onMouseOver=function($m){$B.stage.event("showtip",this._toolTip);},$h.onMouseOut=function($m){$B.stage.event("hidetip",this._toolTip);},$k(0,$h,"displayWidth",function(){return this.width*this.scaleX;}),$k(0,$h,"width",function(){return this._width?this._width:this.measureWidth;},function($m){this._width!=$m&&(this._width=$m,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX());}),$k(0,$h,"measureWidth",function(){var $m=0;this.commitMeasure();for(var $p=this.numChildren-1;-1<$p;$p--){var $h=this.getChildAt($p);$h.visible&&($m=Math.max($h.x+$h.width*$h.scaleX,$m));}return $m;}),$k(0,$h,"displayHeight",function(){return this.height*this.scaleY;}),$k(0,$h,"height",function(){return this._height?this._height:this.measureHeight;},function($m){this._height!=$m&&(this._height=$m,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY());}),$k(0,$h,"dataSource",function(){return this._dataSource;},function($m){for(var $p in this._dataSource=$m,this._dataSource)this.hasOwnProperty($p)&&"function"!=typeof this[$p]&&(this[$p]=this._dataSource[$p]);}),$k(0,$h,"scaleY",$p.prototype._$get_scaleY,function($m){$B.superGet($Z,this,"scaleY")!=$m&&($B.superSet($Z,this,"scaleY",$m),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY());}),$k(0,$h,"measureHeight",function(){var $m=0;this.commitMeasure();for(var $p=this.numChildren-1;-1<$p;$p--){var $h=this.getChildAt($p);$h.visible&&($m=Math.max($h.y+$h.height*$h.scaleY,$m));}return $m;}),$k(0,$h,"scaleX",$p.prototype._$get_scaleX,function($m){$B.superGet($Z,this,"scaleX")!=$m&&($B.superSet($Z,this,"scaleX",$m),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX());}),$k(0,$h,"top",function(){return this._layout.top;},function($m){$m!=this._layout.top&&(this.getLayout().top=$m,this._setLayoutEnabled(!0)),this.resetLayoutY();}),$k(0,$h,"bottom",function(){return this._layout.bottom;},function($m){$m!=this._layout.bottom&&(this.getLayout().bottom=$m,this._setLayoutEnabled(!0)),this.resetLayoutY();}),$k(0,$h,"left",function(){return this._layout.left;},function($m){$m!=this._layout.left&&(this.getLayout().left=$m,this._setLayoutEnabled(!0)),this.resetLayoutX();}),$k(0,$h,"right",function(){return this._layout.right;},function($m){$m!=this._layout.right&&(this.getLayout().right=$m,this._setLayoutEnabled(!0)),this.resetLayoutX();}),$k(0,$h,"centerX",function(){return this._layout.centerX;},function($m){$m!=this._layout.centerX&&(this.getLayout().centerX=$m,this._setLayoutEnabled(!0)),this.resetLayoutX();}),$k(0,$h,"centerY",function(){return this._layout.centerY;},function($m){$m!=this._layout.centerY&&(this.getLayout().centerY=$m,this._setLayoutEnabled(!0)),this.resetLayoutY();}),$k(0,$h,"anchorX",function(){return this._layout.anchorX;},function($m){$m!=this._layout.anchorX&&(this.getLayout().anchorX=$m,this._setLayoutEnabled(!0)),this.resetLayoutX();}),$k(0,$h,"anchorY",function(){return this._layout.anchorY;},function($m){$m!=this._layout.anchorY&&(this.getLayout().anchorY=$m,this._setLayoutEnabled(!0)),this.resetLayoutY();}),$k(0,$h,"tag",function(){return this._tag;},function($m){this._tag=$m;}),$k(0,$h,"toolTip",function(){return this._toolTip;},function($m){this._toolTip!=$m&&(null!=(this._toolTip=$m)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)));}),$k(0,$h,"comXml",function(){return this._comXml;},function($m){this._comXml=$m;}),$k(0,$h,"gray",function(){return this._gray;},function($m){$m!==this._gray&&(this._gray=$m,$x.gray(this,$m));}),$k(0,$h,"disabled",function(){return this._disabled;},function($m){$m!==this._disabled&&(this.gray=this._disabled=$m,this.mouseEnabled=!$m);}),$m;}($Z)),$N=function($m){function $p(){this.lockLayer=null,this.popupEffect=function($m){$m.scale(1,1),$E.from($m,{x:$B.stage.width/2,y:$B.stage.height/2,scaleX:0,scaleY:0},300,$d.backOut,$R.create(this,this.doOpen,[$m]));},this.closeEffect=function($m,$p){$E.to($m,{x:$B.stage.width/2,y:$B.stage.height/2,scaleX:0,scaleY:0},300,$d.strongOut,$R.create(this,this.doClose,[$m,$p]));},$p.__super.call(this),this.maskLayer=new $Z(),this.popupEffectHandler=$R.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$R.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$B.stage.addChild(this),$B.stage.on("resize",this,this._onResize),$Q.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null);}$q($p,"laya.ui.DialogManager",$Z);var $h=$p.prototype;return $h._closeOnSide=function(){var $m=this.getChildAt(this.numChildren-1);$m instanceof laya.ui.Dialog&&$m.close("side");},$h.setLockView=function($m){this.lockLayer||(this.lockLayer=new $S(),this.lockLayer.mouseEnabled=!0,this.lockLayer.size($B.stage.width,$B.stage.height)),this.lockLayer.removeChildren(),$m&&($m.centerX=$m.centerY=0,this.lockLayer.addChild($m));},$h._onResize=function($m){var $p=this.maskLayer.width=$B.stage.width,$h=this.maskLayer.height=$B.stage.height;this.lockLayer&&this.lockLayer.size($p,$h),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$p,$h,$Q.popupBgColor),this.maskLayer.alpha=$Q.popupBgAlpha;for(var $P=this.numChildren-1;-1<$P;$P--){var $L=this.getChildAt($P);$L.popupCenter&&this._centerDialog($L);}},$h._centerDialog=function($m){$m.x=Math.round(($B.stage.width-$m.width>>1)+$m.pivotX),$m.y=Math.round(($B.stage.height-$m.height>>1)+$m.pivotY);},$h.open=function($m,$p,$h){void 0===$p&&($p=!1),void 0===$h&&($h=!1),$p&&this._closeAll(),$m.popupCenter&&this._centerDialog($m),this.addChild($m),($m.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$h&&null!=$m.popupEffect?$m.popupEffect.runWith($m):this.doOpen($m),this.event("open");},$h.doOpen=function($m){$m.onOpened();},$h.lock=function($m){this.lockLayer&&($m?this.addChild(this.lockLayer):this.lockLayer.removeSelf());},$h.close=function($m,$p,$h){void 0===$h&&($h=!1),$h&&null!=$m.closeEffect?$m.closeEffect.runWith([$m,$p]):this.doClose($m,$p),this.event("close");},$h.doClose=function($m,$p){$m.removeSelf(),$m.isModal&&this._checkMask(),$m.closeHandler&&$m.closeHandler.runWith($p),$m.onClosed($p);},$h.closeAll=function(){this._closeAll(),this.event("close");},$h._closeAll=function(){for(var $m=this.numChildren-1;-1<$m;$m--){var $p=this.getChildAt($m);$p&&null!=$p.close&&this.doClose($p);}},$h.getDialogsByGroup=function($m){for(var $p=[],$h=this.numChildren-1;-1<$h;$h--){var $P=this.getChildAt($h);$P&&$P.group===$m&&$p.push($P);}return $p;},$h.closeByGroup=function($m){for(var $p=[],$h=this.numChildren-1;-1<$h;$h--){var $P=this.getChildAt($h);$P&&$P.group===$m&&($P.close(),$p.push($P));}return $p;},$h._checkMask=function(){this.maskLayer.removeSelf();for(var $m=this.numChildren-1;-1<$m;$m--){var $p=this.getChildAt($m);if($p&&$p.isModal)return void this.addChildAt(this.maskLayer,$m);}},$p;}(),$S=function($m){function $p(){$p.__super.call(this);}$q($p,"laya.ui.Box",$m);var $h=$p.prototype;return $B.imps($h,{"laya.ui.IBox":!0}),$k(0,$h,"dataSource",$m.prototype._$get_dataSource,function($m){for(var $p in this._dataSource=$m){var $h=this.getChildByName($p);$h?$h.dataSource=$m[$p]:this.hasOwnProperty($p)&&"function"!=typeof this[$p]&&(this[$p]=$m[$p]);}}),$p;}($u),$_=function($p){function $h($m,$p){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$h.__super.call(this),this._labelColors=$j.buttonLabelColors,this._stateNum=$j.buttonStateNum,void 0===$p&&($p=""),this.skin=$m,this.label=$p;}$q($h,"laya.ui.Button",$p);var $m=$h.prototype;return $B.imps($m,{"laya.ui.ISelect":!0}),$m.destroy=function($m){this.clearEvent(),$e.clearCache(this,this._skin),$e.clearObject(this,this._weakKey),void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($m),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null;},$m.clearEvent=function(){this._skin&&$L.atalsNotify&&$L.atalsNotify.off(this._skin,this,this._setBtnSource);},$m.createChildren=function(){this.graphics=this._bitmap=new $M();},$m.createText=function(){this._text||(this._text=new $H(),this._text.overflow=$H.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height);},$m.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1);},$m.onMouse=function($m){if(!1!==this.toggle||!this._selected)return"click"===$m.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$h.stateMap[$m.type]));},$m.changeClips=function(){var $m=$e.getRes(this._skin);if($m)if(this._skin&&""!=this._skin){$e.clearObject(this,this._weakKey);var $p=$m.sourceWidth,$h=$m.sourceHeight/this._stateNum;$m.$_GID||($m.$_GID=$I.getGID());var $P=$m.$_GID+"-"+this._stateNum,$L=$e.findObject($P);if($I.isOkTextureList($L)||($L=null),$L)this._weakKey=$P,$e.keepObject(this,this._weakKey),this._sources=$L;else{if(this._sources=[],1===this._stateNum)this._sources.push($m);else for(var $q=0;$q<this._stateNum;$q++){var $k=$W.createFromTexture($m,0,$h*$q,$p,$h);if($m.alphaTexture){var $Y=$m.width/$m.alphaTexture.width;$k.alphaTexture=$W.createFromTexture($m.alphaTexture,0/$Y,$h*$q/$Y,$p/$Y,$h/$Y);}this._sources.push($k);}$e.saveObject($P,this._sources),this._weakKey=$P,$e.keepObject(this,this._weakKey);}this._autoSize?(this._bitmap.width=this._width||$p,this._bitmap.height=this._height||$h,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$p);}else console.warn("lose skin ",this._skin,this.name,this.__className);},$m.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $m=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$m]),this.label&&(this._text.color=this._labelColors[$m],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$m]));},$m._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState));},$k(0,$m,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor;},function($m){this.createText(),this._text.strokeColor=$m;}),$k(0,$m,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height;}),$k(0,$m,"skin",function(){return this._skin;},function($m){if(this._skin!=$m)if(this.clearEvent(),$e.clearCache(this,this._skin),this._skin=$m,$e.keepCache(this,this._skin),$e.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $p=$L.resAtalsObj&&$L.resAtalsObj[this._skin];$p?($L.atalsNotify&&$L.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$p.sourceW),0==this.height&&(this.height=$p.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className);}}),$m._setBtnSource=function($m,$p){$m===this._skin&&$p&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent());},$k(0,$m,"state",function(){return this._state;},function($m){this._state!=$m&&(this._state=$m,this._setStateChanged());}),$k(0,$m,"text",function(){return this.createText(),this._text;}),$k(0,$m,"stateNum",function(){return this._stateNum;},function($m){"string"==typeof $m&&($m=parseInt($m)),this._stateNum!=$m&&(this._stateNum=$m<1?1:3<$m?3:$m,this.callLater(this.changeClips));}),$k(0,$m,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):"";},function($m){this._strokeColors=$x.fillArray($j.buttonLabelColors,$m,String),this._setStateChanged();}),$k(0,$m,"labelColors",function(){return this._labelColors.join(",");},function($m){this._labelColors=$x.fillArray($j.buttonLabelColors,$m,String),this._setStateChanged();}),$k(0,$m,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0));}),$k(0,$m,"label",function(){return this._text?this._text.text:null;},function($m){(this._text||$m)&&(this.createText(),this._text.text!=$m&&($m&&!this._text.parent&&this.addChild(this._text),this._text.text=($m+"").replace(/\\n/g,"\n"),this._setStateChanged()));}),$k(0,$m,"selected",function(){return this._selected;},function($m){this._selected!=$m&&(this._selected=$m,this.state=this._selected?2:0,this.event("change"));}),$k(0,$m,"labelPadding",function(){return this.createText(),this._text.padding.join(",");},function($m){this.createText(),this._text.padding=$x.fillArray($j.labelPadding,$m,Number);}),$k(0,$m,"labelSize",function(){return this.createText(),this._text.fontSize;},function($m){this.createText(),this._text.fontSize=$m;}),$k(0,$m,"labelStroke",function(){return this.createText(),this._text.stroke;},function($m){this.createText(),this._text.stroke=$m;}),$k(0,$m,"labelBold",function(){return this.createText(),this._text.bold;},function($m){this.createText(),this._text.bold=$m;}),$k(0,$m,"labelFont",function(){return this.createText(),this._text.font;},function($m){this.createText(),this._text.font=$m;}),$k(0,$m,"labelAlign",function(){return this.createText(),this._text.align;},function($m){this.createText(),this._text.align=$m;}),$k(0,$m,"clickHandler",function(){return this._clickHandler;},function($m){this._clickHandler=$m;}),$k(0,$m,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null;},function($m){this._bitmap.sizeGrid=$x.fillArray($j.defaultSizeGrid,$m,Number);}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($u,this,"width",$m),this._autoSize&&(this._bitmap.width=$m,this._text&&(this._text.width=$m));}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($u,this,"height",$m),this._autoSize&&(this._bitmap.height=$m,this._text&&(this._text.height=$m));}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)||"string"==typeof $m?this.label=$m+"":$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null;},function($m){this._bitmap._offset=$m?$x.fillArray([1,1],$m,Number):[];}),$P($h,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0};}]),$h;}($u),$l=function($p){function $P($m,$p,$h){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$P.__super.call(this),void 0===$p&&($p=1),void 0===$h&&($h=1),this._clipX=$p,this._clipY=$h,this.skin=$m;}$q($P,"laya.ui.Clip",$p);var $m=$P.prototype;return $m.destroy=function($m){this.clearEvent(),this.clearLoad(),$e.clearCache(this,this._skin),$e.clearObject(this,this._weakKey),void 0===$m&&($m=!0),$p.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null;},$m.dispose=function(){this.destroy(!0),$B.loader.clearRes(this._skin);},$m.createChildren=function(){this.graphics=this._bitmap=new $M();},$m._onDisplay=function($m){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play();},$m.changeClip=function(){if(this._clipChanged=!1,this._skin){var $m=$e.getRes(this._skin);if($m)this.loadComplete(this._skin,$m);else{if($L.resAtalsObj&&$L.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$R.create(this,this.loadComplete,[this._skin]),this._progress=null,$B.loader.load(this._skin,this._complete,this._progress);}}},$m.loadComplete=function($m,$p){if($m===this._skin&&$p){$e.clearObject(this,this._weakKey);var $h=this._clipWidth||Math.ceil($p.sourceWidth/this._clipX),$P=this._clipHeight||Math.ceil($p.sourceHeight/this._clipY),$L=this._skin+$h+$P,$q=$e.findObject($L);if($I.isOkTextureList($q)||($q=null),$q)this._weakKey=$L,$e.keepObject(this,this._weakKey),this._sources=$q;else{this._sources=[];for(var $k=0;$k<this._clipY;$k++)for(var $Y=0;$Y<this._clipX;$Y++){var $d=$W.createFromTexture($p,$h*$Y,$P*$k,$h,$P);if($p.alphaTexture){var $K=$p.width/$p.alphaTexture.width;$d.alphaTexture=$W.createFromTexture($p.alphaTexture,$h*$Y/$K,$P*$k/$K,$h/$K,$P/$K);}this._sources.push($d);}$e.saveObject($L,this._sources),this._weakKey=$L,$e.keepObject(this,this._weakKey);}this.index=this._index,this.event("loaded"),this.onCompResize();}},$m.play=function($m,$p){void 0===$m&&($m=0),void 0===$p&&($p=-1),this._isPlaying=!0,this.index=$m,this._toIndex=$p,this._index++,$B.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay);},$m._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index);},$m.stop=function(){this._isPlaying=!1,$B.timer.clear(this,this._loop),this.event("complete");},$m._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip));},$k(0,$m,"interval",function(){return this._interval;},function($m){this._interval!=$m&&(this._interval=$m,this._isPlaying&&this.play());}),$m.clearEvent=function(){this._skin&&$L.atalsNotify&&$L.atalsNotify.off(this._skin,this,this._setBtnSource);},$m.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$B.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null);},$k(0,$m,"skin",function(){return this._skin;},function($m){if(this._skin!=$m)if(this.clearLoad(),this.clearEvent(),$e.clearCache(this,this._skin),this._skin=$m){$e.keepCache(this,this._skin);var $p=$e.getRes($m),$h=$L.resAtalsObj&&$L.resAtalsObj[this._skin];!$p&&$h?$L.atalsNotify&&$L.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged();}else this._bitmap.source=null;}),$m._setBtnSource=function($m,$p){$m===this._skin&&$p&&(this.loadComplete($m,$p),this.clearEvent());},$k(0,$m,"sources",function(){return this._sources;},function($m){this._sources=$m,this.index=this._index,this.event("loaded");}),$k(0,$m,"clipX",function(){return this._clipX;},function($m){this._clipX=$m||1,this._setClipChanged();}),$k(0,$m,"clipY",function(){return this._clipY;},function($m){this._clipY=$m||1,this._setClipChanged();}),$k(0,$m,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0;}),$k(0,$m,"clipWidth",function(){return this._clipWidth;},function($m){this._clipWidth=$m,this._setClipChanged();}),$k(0,$m,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null;},function($m){this._bitmap.sizeGrid=$x.fillArray($j.defaultSizeGrid,$m,Number);}),$k(0,$m,"group",function(){return this._group;},function($m){$m&&this._skin&&$e.setGroup(this._skin,$m),this._group=$m;}),$k(0,$m,"clipHeight",function(){return this._clipHeight;},function($m){this._clipHeight=$m,this._setClipChanged();}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($u,this,"width",$m),this._bitmap.width=$m;}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($u,this,"height",$m),this._bitmap.height=$m;}),$k(0,$m,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width;}),$k(0,$m,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height;}),$k(0,$m,"index",function(){return this._index;},function($m){this._index=$m,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$m]),this.event("change");}),$k(0,$m,"autoPlay",function(){return this._autoPlay;},function($m){this._autoPlay!=$m&&((this._autoPlay=$m)?this.play():this.stop());}),$k(0,$m,"isPlaying",function(){return this._isPlaying;},function($m){this._isPlaying=$m;}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)&&Math.floor($m)==$m||"string"==typeof $m?this.index=parseInt($m):$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"bitmap",function(){return this._bitmap;}),$P;}($u),$J=function($p){function $m(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$m.__super.call(this);}$q($m,"laya.ui.ColorPicker",$p);var $h=$m.prototype;return $h.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._colorPanel&&this._colorPanel.destroy($m),this._colorButton&&this._colorButton.destroy($m),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null;},$h.createChildren=function(){this.addChild(this._colorButton=new $_()),this._colorPanel=new $S(),this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $Z()),this._colorPanel.addChild(this._colorBlock=new $Z()),this._colorPanel.addChild(this._colorInput=new $$());},$h.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor;},$h.onPanelMouseDown=function($m){$m.stopPropagation();},$h.changePanel=function(){this._panelChanged=!1;var $m=this._colorPanel.graphics;$m.clear(),$m.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($m=this._colorTiles.graphics).clear();for(var $p=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$h=0;$h<12;$h++)for(var $P=0;$P<20;$P++){var $L=0;$L=0===$P?$p[$h]:1===$P?0:51*(((3*$h+$P/6)%3<<0)+3*($h/6<<0))<<16|$P%6*51<<8|($h<<0)%6*51;var $q=$x.toColor($L);this._colors.push($q);var $k=$P*this._gridSize,$Y=$h*this._gridSize;$m.drawRect($k,$Y,this._gridSize,this._gridSize,$q,"#000000");}},$h.onColorButtonClick=function($m){this._colorPanel.parent?this.close():this.open();},$h.open=function(){var $m=this.localToGlobal(new $A()),$p=$m.x+this._colorPanel.width<=$B.stage.width?$m.x:$B.stage.width-this._colorPanel.width,$h=$m.y+this._colorButton.height;$h=$h+this._colorPanel.height<=$B.stage.height?$h:$m.y-this._colorPanel.height,this._colorPanel.pos($p,$h),this._colorPanel.zOrder=1001,$B._currentStage.addChild(this._colorPanel),$B.stage.on("mousedown",this,this.removeColorBox);},$h.close=function(){$B.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf();},$h.removeColorBox=function($m){this.close();},$h.onColorFieldKeyDown=function($m){13==$m.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$m.stopPropagation());},$h.onColorInputChange=function($m){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF");},$h.onColorTilesClick=function($m){this.selectedColor=this.getColorByMouse(),this.close();},$h.onColorTilesMouseMove=function($m){this._colorInput.focus=!1;var $p=this.getColorByMouse();this._colorInput.text=$p,this.drawBlock($p);},$h.getColorByMouse=function(){var $m=this._colorTiles.getMousePoint(),$p=Math.floor($m.x/this._gridSize),$h=Math.floor($m.y/this._gridSize);return this._colors[20*$h+$p];},$h.drawBlock=function($m){var $p=this._colorBlock.graphics;$p.clear();var $h=$m||"#ffffff";$p.drawRect(0,0,50,20,$h,this._borderColor),$m||$p.drawLine(0,0,50,20,"#ff0000");},$h.changeColor=function(){var $m=this.graphics;$m.clear();var $p=this._selectedColor||"#000000";$m.drawRect(0,0,this._colorButton.width,this._colorButton.height,$p);},$h._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel));},$k(0,$h,"inputBgColor",function(){return this._inputBgColor;},function($m){this._inputBgColor=$m,this._setPanelChanged();}),$k(0,$h,"selectedColor",function(){return this._selectedColor;},function($m){this._selectedColor!=$m&&(this._selectedColor=this._colorInput.text=$m,this.drawBlock($m),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$K.EMPTY.setTo("change",this,this)));}),$k(0,$h,"skin",function(){return this._colorButton.skin;},function($m){this._colorButton.skin=$m,this.changeColor();}),$k(0,$h,"bgColor",function(){return this._bgColor;},function($m){this._bgColor=$m,this._setPanelChanged();}),$k(0,$h,"borderColor",function(){return this._borderColor;},function($m){this._borderColor=$m,this._setPanelChanged();}),$k(0,$h,"inputColor",function(){return this._inputColor;},function($m){this._inputColor=$m,this._setPanelChanged();}),$m;}($u),$z=function($p){function $h($m,$p){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$h.__super.call(this),this._itemColors=$j.comboBoxItemColors,this.skin=$m,this.labels=$p;}$q($h,"laya.ui.ComboBox",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._button&&this._button.destroy($m),this._list&&this._list.destroy($m),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null;},$m.createChildren=function(){this.addChild(this._button=new $_()),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown);},$m._createList=function(){this._list=new $f(),this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list);},$m._setListEvent=function($m){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$R.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown);},$m.onListDown=function($m){$m.stopPropagation();},$m.onScrollBarDown=function($m){$m.stopPropagation();},$m.onButtonMouseDown=function($m){this.callLater(this.switchTo,[!this._isOpen]);},$m.changeList=function(){this._listChanged=!1;var $m=this.width-2,$p=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$m,height:this._itemHeight,fontSize:this._itemSize,color:$p}}]},this._list.repeatY=this._visibleNum,this._list.refresh();},$m.onlistItemMouse=function($m,$p){var $h=$m.type;if("mouseover"===$h||"mouseout"===$h){if(this._isCustomList)return;var $P=this._list.getCell($p);if(!$P)return;var $L=$P.getChildByName("label");$L&&("mouseover"===$h?($L.bgColor=this._itemColors[0],$L.color=this._itemColors[1]):($L.bgColor=null,$L.color=this._itemColors[2]));}else"click"===$h&&(this.selectedIndex=$p,this.isOpen=!1);},$m.switchTo=function($m){this.isOpen=$m;},$m.changeOpen=function(){this.isOpen=!this._isOpen;},$m.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $m=this._list.graphics;$m.clear(),$m.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]);}for(var $p=this._list.array||[],$h=$p.length=0,$P=this._labels.length;$h<$P;$h++)$p.push({label:this._labels[$h]});this._list.height=this._listHeight,this._list.array=$p;},$m.changeSelected=function(){this._button.label=this.selectedLabel;},$m._onStageMouseWheel=function($m){this._list&&!this._list.contains($m.target)&&this.removeList(null);},$m.removeList=function($m){$B.stage.off("mousedown",this,this.removeList),$B.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1;},$k(0,$m,"selectedIndex",function(){return this._selectedIndex;},function($m){this._selectedIndex!=$m&&(this._selectedIndex=$m,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$K.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex));}),$k(0,$m,"measureHeight",function(){return this._button.height;}),$k(0,$m,"skin",function(){return this._button.skin;},function($m){this._button.skin!=$m&&(this._button.skin=$m,this._listChanged=!0);}),$k(0,$m,"measureWidth",function(){return this._button.width;}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($u,this,"width",$m),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0;}),$k(0,$m,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null;},function($m){this.selectedIndex=this._labels.indexOf($m);}),$k(0,$m,"labels",function(){return this._labels.join(",");},function($m){0<this._labels.length&&(this.selectedIndex=-1),$m?this._labels=$m.split(","):this._labels.length=0,this._itemChanged=!0;}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($u,this,"height",$m),this._button.height=this._height;}),$k(0,$m,"selectHandler",function(){return this._selectHandler;},function($m){this._selectHandler=$m;}),$k(0,$m,"visibleNum",function(){return this._visibleNum;},function($m){this._visibleNum=$m,this._listChanged=!0;}),$k(0,$m,"labelBold",function(){return this._button.text.bold;},function($m){this._button.text.bold=$m;}),$k(0,$m,"itemColors",function(){return String(this._itemColors);},function($m){this._itemColors=$x.fillArray(this._itemColors,$m,String),this._listChanged=!0;}),$k(0,$m,"itemSize",function(){return this._itemSize;},function($m){this._itemSize=$m,this._listChanged=!0;}),$k(0,$m,"scrollBar",function(){return this.list.scrollBar;}),$k(0,$m,"isOpen",function(){return this._isOpen;},function($m){if(this._isOpen!=$m)if(this._isOpen=$m,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $p=this.localToGlobal($A.TEMP.setTo(0,0)),$h=$p.y+this._button.height;$h=$h+this._listHeight<=$B.stage.height?$h:$p.y-this._listHeight,this._list.pos($p.x,$h),this._list.zOrder=1001,$B._currentStage.addChild(this._list),$B.stage.once("mousedown",this,this.removeList),$B.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex;}else this._list&&this._list.removeSelf();}),$k(0,$m,"scrollBarSkin",function(){return this._scrollBarSkin;},function($m){this._scrollBarSkin=$m;}),$k(0,$m,"sizeGrid",function(){return this._button.sizeGrid;},function($m){this._button.sizeGrid=$m;}),$k(0,$m,"button",function(){return this._button;}),$k(0,$m,"list",function(){return this._list||this._createList(),this._list;},function($m){$m&&($m.removeSelf(),this._isCustomList=!0,this._list=$m,this._setListEvent($m),this._itemHeight=$m.getCell(0).height+$m.spaceY);}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)&&Math.floor($m)==$m||"string"==typeof $m?this.selectedIndex=parseInt($m):$m instanceof Array?this.labels=$m.join(","):$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"labelColors",function(){return this._button.labelColors;},function($m){this._button.labelColors!=$m&&(this._button.labelColors=$m);}),$k(0,$m,"labelPadding",function(){return this._button.text.padding.join(",");},function($m){this._button.text.padding=$x.fillArray($j.labelPadding,$m,Number);}),$k(0,$m,"labelSize",function(){return this._button.text.fontSize;},function($m){this._button.text.fontSize=$m;}),$k(0,$m,"labelFont",function(){return this._button.text.font;},function($m){this._button.text.font=$m;}),$k(0,$m,"stateNum",function(){return this._button.stateNum;},function($m){this._button.stateNum=$m;}),$h;}($u),$w=function($p){function $h($m){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$h.__super.call(this),this._showButtons=$Q.showButtons,this._touchScrollEnable=$Q.touchScrollEnable,this._mouseWheelEnable=$Q.mouseWheelEnable,this.skin=$m,this.max=1;}$q($h,"laya.ui.ScrollBar",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),this.stopScroll(),this.target=null,$p.prototype.destroy.call(this,$m),this.upButton&&this.upButton.destroy($m),this.downButton&&this.downButton.destroy($m),this.slider&&this.slider.destroy($m),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null;},$m.createChildren=function(){this.addChild(this.slider=new $X()),this.addChild(this.upButton=new $_()),this.addChild(this.downButton=new $_());},$m.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown);},$m.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value);},$m.onButtonMouseDown=function($m){var $p=$m.currentTarget===this.upButton;this.slide($p),$B.timer.once($j.scrollBarDelayTime,this,this.startLoop,[$p]),$B.stage.once("mouseup",this,this.onStageMouseUp);},$m.startLoop=function($m){$B.timer.frameLoop(1,this,this.slide,[$m]);},$m.slide=function($m){$m?this.value-=this._scrollSize:this.value+=this._scrollSize;},$m.onStageMouseUp=function($m){$B.timer.clear(this,this.startLoop),$B.timer.clear(this,this.slide);},$m.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint();},$m.changeSize=function(){$p.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value);},$m.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition();},$m.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width;},$m.setScroll=function($m,$p,$h){this.runCallLater(this.changeSize),this.slider.setSlider($m,$p,$h),this.slider.bar.visible=0<$p,!this._hide&&this.autoHide&&(this.visible=!1);},$m.onTargetMouseWheel=function($m){this.value-=$m.delta*this._scrollSize,this.target=this._target;},$m.onTargetMouseDown=function($m){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $A()),this._lastPoint.setTo($B.stage.mouseX,$B.stage.mouseY),$B.timer.clear(this,this.tweenMove),$E.clearTween(this),$B.stage.once("mouseup",this,this.onStageMouseUp2),$B.stage.once("mouseout",this,this.onStageMouseUp2),$B.timer.frameLoop(1,this,this.loop);},$m.loop=function(){var $m=$B.stage.mouseY,$p=$B.stage.mouseX;if(this._lastOffset=this.isVertical?$m-this._lastPoint.y:$p-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$B.stage._canvasTransform.getScaleY():$B.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start");}this._offsets.push(this._lastOffset),this._lastPoint.x=$p,this._lastPoint.y=$m,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset);},$m.onStageMouseUp2=function($m){if($B.stage.off("mouseup",this,this.onStageMouseUp2),$B.stage.off("mouseout",this,this.onStageMouseUp2),$B.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$E.to(this,{value:this.min},this.elasticBackTime,$d.sineOut,$R.create(this,this.elasticOver)):this._value>this.max&&$E.to(this,{value:this.max},this.elasticBackTime,$d.sineOut,$R.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$B.stage.mouseY-this._lastPoint.y:$B.stage.mouseX-this._lastPoint.x);for(var $p=0,$h=Math.min(this._offsets.length,3),$P=0;$P<$h;$P++)$p+=this._offsets[this._offsets.length-1-$P];if(this._lastOffset=$p/$h,($p=Math.abs(this._lastOffset))<2)return void this.event("end");60<$p&&(this._lastOffset=0<this._lastOffset?60:-60);var $L=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$B.timer.frameLoop(1,this,this.tweenMove,[$L]);}},$m.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$E.to(this,{alpha:0},500),this.event("end");},$m.tweenMove=function($m){this._lastOffset*=this.rollRatio;var $p=NaN;if(0<$m&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$p=.5*-(this.min-$m-this.value),this._lastOffset>$p&&(this._lastOffset=$p)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$p=.5*-(this.max+$m-this.value),this._lastOffset<$p&&(this._lastOffset=$p))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($B.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$E.to(this,{value:this.min},this.elasticBackTime,$d.sineOut,$R.create(this,this.elasticOver)):this._value>this.max?$E.to(this,{value:this.max},this.elasticBackTime,$d.sineOut,$R.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$E.to(this,{alpha:0},500);}},$m.stopScroll=function(){this.onStageMouseUp2(null),$B.timer.clear(this,this.tweenMove),$E.clearTween(this);},$k(0,$m,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height;}),$k(0,$m,"skin",function(){return this._skin;},function($m){this._skin!=$m&&(this._skin=$m,this.slider.skin=this._skin,this.callLater(this.changeScrollBar));}),$k(0,$m,"max",function(){return this.slider.max;},function($m){this.slider.max=$m;}),$k(0,$m,"showButtons",function(){return this._showButtons;},function($m){this._showButtons=$m,this.callLater(this.changeScrollBar);}),$k(0,$m,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100;}),$k(0,$m,"min",function(){return this.slider.min;},function($m){this.slider.min=$m;}),$k(0,$m,"value",function(){return this._value;},function($m){$m!==this._value&&(this._value=$m,this._isElastic||(this.slider._value!=$m&&(this.slider._value=$m,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value));}),$k(0,$m,"isVertical",function(){return this.slider.isVertical;},function($m){this.slider.isVertical=$m;}),$k(0,$m,"sizeGrid",function(){return this.slider.sizeGrid;},function($m){this.slider.sizeGrid=$m;}),$k(0,$m,"scrollSize",function(){return this._scrollSize;},function($m){this._scrollSize=$m;}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)||"string"==typeof $m?this.value=Number($m):$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"thumbPercent",function(){return this._thumbPercent;},function($m){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$m=1<=$m?.99:$m,this._thumbPercent=$m,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$m,$j.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$m,$j.scrollBarMinNum));}),$k(0,$m,"target",function(){return this._target;},function($m){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$m)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown));}),$k(0,$m,"hide",function(){return this._hide;},function($m){this._hide=$m,this.visible=!$m;}),$k(0,$m,"touchScrollEnable",function(){return this._touchScrollEnable;},function($m){this._touchScrollEnable=$m,this.target=this._target;}),$k(0,$m,"mouseWheelEnable",function(){return this._mouseWheelEnable;},function($m){this._mouseWheelEnable=$m,this.target=this._target;}),$k(0,$m,"tick",function(){return this.slider.tick;},function($m){this.slider.tick=$m;}),$h;}($u),$X=function($p){function $h($m){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$h.__super.call(this),this.skin=$m;}$q($h,"laya.ui.Slider",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._bg&&this._bg.destroy($m),this._bar&&this._bar.destroy($m),this._progress&&this._progress.destroy($m),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null;},$m.createChildren=function(){this.addChild(this._bg=new $s()),this.addChild(this._bar=new $_());},$m.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0;},$m.onBarMouseDown=function($m){this._globalSacle||(this._globalSacle=new $A()),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$B.stage.mouseX,this._ty=$B.stage.mouseY,$B.stage.on("mousemove",this,this.mouseMove),$B.stage.once("mouseup",this,this.mouseUp),$B.stage.once("mouseout",this,this.mouseUp),this.showValueText();},$m.showValueText=function(){if(this.showLabel){var $m=laya.ui.Slider.label;this.addChild($m),$m.textField.changeText(this._value+""),this.isVertical?($m.x=this._bar.x+20,$m.y=.5*(this._bar.height-$m.height)+this._bar.y):($m.y=this._bar.y-20,$m.x=.5*(this._bar.width-$m.width)+this._bar.x);}},$m.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf();},$m.mouseUp=function($m){$B.stage.off("mousemove",this,this.mouseMove),$B.stage.off("mouseup",this,this.mouseUp),$B.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText();},$m.mouseMove=function($m){var $p=this._value;this.isVertical?(this._bar.y+=($B.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($B.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$B.stage.mouseX,this._ty=$B.stage.mouseY;var $h=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$h)/$h,this._value!=$p&&this.sendChangeEvent(),this.showValueText();},$m.sendChangeEvent=function($m){void 0===$m&&($m="change"),this.event($m),this.changeHandler&&this.changeHandler.runWith(this._value);},$m.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height));},$m.changeSize=function(){$p.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue();},$m.setSlider=function($m,$p,$h){this._value=-1,this._min=$m,this._max=$m<$p?$p:$m,this.value=$h<$m?$m:$p<$h?$p:$h;},$m.changeValue=function(){var $m=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$m)/$m,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $p=this._max-this._min;0===$p&&($p=1),this.isVertical?(this._bar.y=(this._value-this._min)/$p*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$p*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width));},$m.onBgMouseDown=function($m){var $p=this._bg.getMousePoint();this.isVertical?this.value=$p.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$p.x/(this.width-this._bar.width)*(this._max-this._min)+this._min;},$k(0,$m,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height);}),$k(0,$m,"skin",function(){return this._skin;},function($m){if(this._skin!=$m){this._skin=$m,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $p=this._skin.replace(".png","$progress.png");$e.getRes($p)&&(this._progress||(this.addChild(this._progress=new $s()),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$p),this.setBarPoint(),this.callLater(this.changeValue);}}),$k(0,$m,"allowClickBack",function(){return this._allowClickBack;},function($m){this._allowClickBack!=$m&&((this._allowClickBack=$m)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown));}),$k(0,$m,"max",function(){return this._max;},function($m){this._max!=$m&&(this._max=$m,this.callLater(this.changeValue));}),$k(0,$m,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width);}),$k(0,$m,"tick",function(){return this._tick;},function($m){this._tick!=$m&&(this._tick=$m,this.callLater(this.changeValue));}),$k(0,$m,"sizeGrid",function(){return this._bg.sizeGrid;},function($m){this._bg.sizeGrid=$m,this._bar.sizeGrid=$m,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid);}),$k(0,$m,"min",function(){return this._min;},function($m){this._min!=$m&&(this._min=$m,this.callLater(this.changeValue));}),$k(0,$m,"value",function(){return this._value;},function($m){if(this._value!=$m){var $p=this._value;this._value=$m,this.changeValue(),this._value!=$p&&this.sendChangeEvent();}}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)||"string"==typeof $m?this.value=Number($m):$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"bar",function(){return this._bar;}),$P($h,["label",function(){return this.label=new $G();}]),$h;}($u),$s=function($p){function $h($m){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$h.__super.call(this),this.skin=$m;}$q($h,"laya.ui.Image",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$e.clearCache(this,this._skin);},$m.dispose=function(){this.destroy(!0),$e.clearCache(this,this._skin),this.clearEvent();},$m.createChildren=function(){this.graphics=this._bitmap=new $M();},$m.setSource=function($m,$p){this.destroyed||$m===this._skin&&$p&&(this.source=$p,this.onCompResize(),this.clearEvent());},$m.clearEvent=function(){this._skin&&$L.atalsNotify&&$L.atalsNotify.off(this._skin,this,this.setSource);},$m.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$B.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null);},$k(0,$m,"source",function(){return this._bitmap.source;},function($m){this._bitmap&&(this._bitmap.source=$m,this.event("loaded"),this.repaint());}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"string"==typeof(this._dataSource=$m)?this.skin=$m:$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"measureHeight",function(){return this._bitmap.height;}),$k(0,$m,"skin",function(){return this._skin;},function($m){if(this._skin!=$m)if($e.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$m){$e.keepCache(this,this._skin);var $p=$e.getRes($m),$h=$L.resAtalsObj&&$L.resAtalsObj[this._skin];$p?(this.source=$p,this.onCompResize()):$h?($L.atalsNotify&&$L.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$h.sourceW),0==this.height&&(this.height=$h.sourceH)):(this._complete=$R.create(this,this.setSource,[this._skin]),this._progress=null,$B.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group));}else this.source=null;}),$k(0,$m,"group",function(){return this._group;},function($m){$m&&this._skin&&$e.setGroup(this._skin,$m),this._group=$m;}),$k(0,$m,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null;},function($m){this._bitmap.sizeGrid=$x.fillArray($j.defaultSizeGrid,$m,Number);}),$k(0,$m,"measureWidth",function(){return this._bitmap.width;}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($u,this,"width",$m),this._bitmap.width=0==$m?1e-7:$m;}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($u,this,"height",$m),this._bitmap.height=0==$m?1e-7:$m;}),$h;}($u),$G=function($p){function $h($m){this._tf=null,$h.__super.call(this),void 0===$m&&($m=""),$D.defaultColor=$j.labelColor,this.text=$m;}$q($h,"laya.ui.Label",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._tf=null;},$m.createChildren=function(){this.addChild(this._tf=new $H());},$m.changeText=function($m){this._tf.changeText($m);},$k(0,$m,"padding",function(){return this._tf.padding.join(",");},function($m){this._tf.padding=$x.fillArray($j.labelPadding,$m,Number);}),$k(0,$m,"bold",function(){return this._tf.bold;},function($m){this._tf.bold=$m;}),$k(0,$m,"align",function(){return this._tf.align;},function($m){this._tf.align=$m;}),$k(0,$m,"text",function(){return this._tf.text;},function($m){this._tf.text!=$m&&($m&&($m=$x.adptString($m+"")),this._tf.text=$m,this.event("change"),this._width&&this._height||this.onCompResize());}),$k(0,$m,"italic",function(){return this._tf.italic;},function($m){this._tf.italic=$m;}),$k(0,$m,"wordWrap",function(){return this._tf.wordWrap;},function($m){this._tf.wordWrap=$m;}),$k(0,$m,"font",function(){return this._tf.font;},function($m){this._tf.font=$m;}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)||"string"==typeof $m?this.text=$m+"":$B.superSet($u,this,"dataSource",$m);}),$k(0,$m,"color",function(){return this._tf.color;},function($m){this._tf.color=$m;}),$k(0,$m,"valign",function(){return this._tf.valign;},function($m){this._tf.valign=$m;}),$k(0,$m,"leading",function(){return this._tf.leading;},function($m){this._tf.leading=$m;}),$k(0,$m,"fontSize",function(){return this._tf.fontSize;},function($m){this._tf.fontSize=$m;}),$k(0,$m,"bgColor",function(){return this._tf.bgColor;},function($m){this._tf.bgColor=$m;}),$k(0,$m,"borderColor",function(){return this._tf.borderColor;},function($m){this._tf.borderColor=$m;}),$k(0,$m,"stroke",function(){return this._tf.stroke;},function($m){this._tf.stroke=$m;}),$k(0,$m,"strokeColor",function(){return this._tf.strokeColor;},function($m){this._tf.strokeColor=$m;}),$k(0,$m,"textField",function(){return this._tf;}),$k(0,$m,"measureWidth",function(){return this._tf.width;}),$k(0,$m,"measureHeight",function(){return this._tf.height;}),$k(0,$m,"width",function(){return this._width||this._tf.text?$B.superGet($u,this,"width"):0;},function($m){$B.superSet($u,this,"width",$m),this._tf.width=$m;}),$k(0,$m,"height",function(){return this._height||this._tf.text?$B.superGet($u,this,"height"):0;},function($m){$B.superSet($u,this,"height",$m),this._tf.height=$m;}),$k(0,$m,"overflow",function(){return this._tf.overflow;},function($m){this._tf.overflow=$m;}),$k(0,$m,"underline",function(){return this._tf.underline;},function($m){this._tf.underline=$m;}),$k(0,$m,"underlineColor",function(){return this._tf.underlineColor;},function($m){this._tf.underlineColor=$m;}),$h;}($u),$U=function($p){function $h($m){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$h.__super.call(this),this.skin=$m;}$q($h,"laya.ui.ProgressBar",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._bg&&this._bg.destroy($m),this._bar&&this._bar.destroy($m),this._bg=this._bar=null,this.changeHandler=null;},$m.createChildren=function(){this.addChild(this._bg=new $s()),this.addChild(this._bar=new $s());},$m.changeValue=function(){if(this.sizeGrid){var $m=this.sizeGrid.split(","),$p=Number($m[3]),$h=Number($m[1]),$P=(this.width-$p-$h)*this._value;this._bar.width=$p+$h+$P,this._bar.visible=this._bar.width>$p+$h;}else this._bar.width=this.width*this._value;},$k(0,$m,"measureHeight",function(){return this._bg.height;}),$k(0,$m,"skin",function(){return this._skin;},function($m){this._skin!=$m&&(this._skin=$m,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue));}),$k(0,$m,"measureWidth",function(){return this._bg.width;}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($u,this,"height",$m),this._bg.height=this._height,this._bar.height=this._height;}),$k(0,$m,"bar",function(){return this._bar;}),$k(0,$m,"value",function(){return this._value;},function($m){this._value!=$m&&($m=1<$m?1:$m<0?0:$m,this._value=$m,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($m));}),$k(0,$m,"bg",function(){return this._bg;}),$k(0,$m,"sizeGrid",function(){return this._bg.sizeGrid;},function($m){this._bg.sizeGrid=this._bar.sizeGrid=$m;}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($u,this,"width",$m),this._bg.width=this._width,this.callLater(this.changeValue);}),$k(0,$m,"dataSource",$p.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)||"string"==typeof $m?this.value=Number($m):$B.superSet($u,this,"dataSource",$m);}),$h;}($u),$r=(function($m){function $h(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$h.__super.call(this),this._tipBox=new $u(),this._tipBox.addChild(this._tipText=new $H()),this._tipText.x=this._tipText.y=5,this._tipText.color=$h.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$B.stage.on("showtip",this,this._onStageShowTip),$B.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100;}$q($h,"laya.ui.TipManager",$u);var $p=$h.prototype;$p._onStageHideTip=function($m){$B.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf();},$p._onStageShowTip=function($m){$B.timer.once($h.tipDelay,this,this._showTip,[$m],!0);},$p._showTip=function($m){if("string"==typeof $m){var $p=String($m);Boolean($p)&&this._defaultTipHandler($p);}else $m instanceof laya.utils.Handler?$m.run():"function"==typeof $m&&$m.apply();$B.stage.on("mousemove",this,this._onStageMouseMove),$B.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null);},$p._onStageMouseDown=function($m){this.closeAll();},$p._onStageMouseMove=function($m){this._showToStage(this,$h.offsetX,$h.offsetY);},$p._showToStage=function($m,$p,$h){void 0===$p&&($p=0),void 0===$h&&($h=0);var $P=$m.getBounds();$m.x=$B.stage.mouseX+$p,$m.y=$B.stage.mouseY+$h,$m.x+$P.width>$B.stage.width&&($m.x-=$P.width+$p),$m.y+$P.height>$B.stage.height&&($m.y-=$P.height+$h);},$p.closeAll=function(){$B.timer.clear(this,this._showTip),$B.stage.off("mousemove",this,this._onStageMouseMove),$B.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren();},$p.showDislayTip=function($m){this.addChild($m),this._showToStage(this),$B._currentStage.addChild(this);},$p._showDefaultTip=function($m){this._tipText.text=$m;var $p=this._tipBox.graphics;$p.clear(),$p.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$h.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$B._currentStage.addChild(this);},$k(0,$p,"defaultTipHandler",function(){return this._defaultTipHandler;},function($m){this._defaultTipHandler=$m;}),$h.offsetX=10,$h.offsetY=15,$h.tipTextColor="#ffffff",$h.tipBackColor="#111111",$h.tipDelay=200;}(),function($m){var $$;function $A(){this._idMap=null,this._aniList=null,this._watchMap={},$A.__super.call(this);}$q($A,"laya.ui.View",$S);var $p=$A.prototype;return $p.createView=function($m){if($m.animations&&!this._idMap&&(this._idMap={}),$A.createComp($m,this,this),$m.animations){var $p,$h,$P=[],$L=$m.animations,$q=0,$k=$L.length;for($q=0;$q<$k;$q++){switch($p=new $F(),$h=$L[$q],$p._setUp(this._idMap,$h),(this[$h.name]=$p)._setControlNode(this),$h.action){case 1:$p.play(0,!1);break;case 2:$p.play(0,!0);}$P.push($p);}this._aniList=$P;}0<this._width&&null==$m.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0);},$p.onEvent=function($m,$p){},$p.loadUI=function($m){var $p=$A.uiMap[$m];$p&&this.createView($p);},$p.destroy=function($m){void 0===$m&&($m=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$m);},$p.changeData=function($m){var $p=this._watchMap[$m];if($p){console.log("change",$m);for(var $h=0,$P=$p.length;$h<$P;$h++){$p[$h].exe(this);}}},$A._regs=function(){for(var $m in $A.uiClassMap)$n.regClass($m,$A.uiClassMap[$m]);},$A.createComp=function($m,$p,$h,$P){if(!($p=$p||$A.getCompInstance($m)))return console.warn("can not create:"+$m.type),null;var $L=$m.child;if($L)for(var $q=$p instanceof laya.ui.List,$k=0,$Y=$L.length;$k<$Y;$k++){var $d=$L[$k];if(!$p.hasOwnProperty("itemRender")||"render"!=$d.props.name&&"render"!==$d.props.renderType){if("Graphic"==$d.type)$n.addGraphicsToSprite($d,$p);else if($n.isDrawType($d.type))$n.addGraphicToSprite($d,$p,!0);else{if($q){var $K=[],$D=$A.createComp($d,null,$h,$K);$K.length&&($D._$bindData=$K);}else $D=$A.createComp($d,null,$h,$P);"Script"==$d.type?"owner"in $D?$D.owner=$p:"target"in $D&&($D.target=$p):"mask"==$d.props.renderType||"mask"==$d.props.name?$p.mask=$D:$D instanceof laya.display.Sprite&&$p.addChild($D);}}else $p.itemRender=$d;}var $F=$m.props;for(var $R in $F){var $$=$F[$R];$A.eventDic[$R]?$$&&$h&&$p.on($R,$h,$h.onEvent,[$$]):$A.setCompValue($p,$R,$$,$h,$P);}return $B.__typeof($p,"laya.ui.IItem")&&$p.initItems(),$m.compId&&$h&&$h._idMap&&($h._idMap[$m.compId]=$p),$p;},$A.setCompValue=function($m,$p,$h,$P,$L){if("string"==typeof $h&&-1<$h.indexOf("${")){if($A._sheet||($A._sheet=$n.getClass("laya.data.Table")),!$A._sheet)return void console.warn("Can not find class Sheet");if($L)$L.push($m,$p,$h);else if($P){-1==$h.indexOf("].")&&($h=$h.replace(".","[0]."));var $q,$k,$Y=new $$($m,$p,$h);$Y.exe($P);for(var $d=$h.replace(/\[.*?\]\./g,".");null!=($q=$A._parseWatchData.exec($d));){for(var $K=$q[1];null!=($k=$A._parseKeyWord.exec($K));){var $D=$k[0],$F=$P._watchMap[$D]||($P._watchMap[$D]=[]);$F.push($Y),$A._sheet.I.notifer.on($D,$P,$P.changeData,[$D]);}($F=$P._watchMap[$K]||($P._watchMap[$K]=[])).push($Y),$A._sheet.I.notifer.on($K,$P,$P.changeData,[$K]);}}}else if("var"===$p&&$P)$P[$h]=$m;else if("onClick"==$p){var $R=$B._runScript("(function(){"+$h+"})");$m.on("click",$P,$R);}else $m[$p]="true"===$h||"false"!==$h&&$h;},$A.getCompInstance=function($m){var $p,$h=$m.props?$m.props.runtime:null;return $p=$h?$A.viewClassMap[$h]||$A.uiClassMap[$h]||$B.__classmap[$h]:$A.uiClassMap[$m.type],$m.props&&$m.props.hasOwnProperty("renderType")&&"instance"==$m.props.renderType?$p.instance:$p?new $p():null;},$A.regComponent=function($m,$p){$A.uiClassMap[$m]=$p,$n.regClass($m,$p);},$A.regViewRuntime=function($m,$p){$A.viewClassMap[$m]=$p;},$A.uiMap={},$A.viewClassMap={},$A._sheet=null,$P($A,["uiClassMap",function(){return this.uiClassMap={ViewStack:$mm,LinkButton:$_,TextArea:$Km,ColorPicker:$J,Box:$S,Button:$_,CheckBox:$y,Clip:$l,ComboBox:$z,Component:$u,HScrollBar:$i,HSlider:$g,Image:$s,Label:$G,List:$f,Panel:$v,ProgressBar:$U,Radio:$O,RadioGroup:$Ym,ScrollBar:$w,Slider:$X,Tab:$dm,TextInput:$hm,View:$A,VScrollBar:$pm,VSlider:$Pm,Tree:$C,HBox:$qm,VBox:$km,Sprite:$Z,Animation:$h,Text:$H,FontClip:$o};},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0};},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g;},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g;}]),$A.__init$=function(){$A._regs(),$$=function(){function $m($m,$p,$h){this.comp=null,this.prop=null,this.value=null,this.comp=$m,this.prop=$p,this.value=$h;}return $q($m,""),$m.prototype.exe=function($m){var $p=$x.getBindFun(this.value);this.comp[this.prop]=$p.call(this,$m);},$m;}();},$A;}()),$y=function($m){function $h($m,$p){void 0===$p&&($p=""),$h.__super.call(this,$m,$p);}$q($h,"laya.ui.CheckBox",$m);var $p=$h.prototype;return $p.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1;},$p.initialize=function(){$m.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0;},$k(0,$p,"dataSource",$m.prototype._$get_dataSource,function($m){"boolean"==typeof(this._dataSource=$m)?this.selected=$m:"string"==typeof $m?this.selected="true"===$m:$B.superSet($_,this,"dataSource",$m);}),$h;}($_),$V=function($m){function $p(){this._space=0,this._align="none",this._itemChanged=!1,$p.__super.call(this);}$q($p,"laya.ui.LayoutBox",$S);var $h=$p.prototype;return $h.addChild=function($m){return $m.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$m);},$h.onResize=function($m){this._setItemChanged();},$h.addChildAt=function($m,$p){return $m.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$m,$p);},$h.removeChild=function($m){return $m.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$m);},$h.removeChildAt=function($m){return this.getChildAt($m).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$m);},$h.refresh=function(){this._setItemChanged();},$h.changeItems=function(){this._itemChanged=!1;},$h.sortItem=function($m){$m&&$m.sort(function($m,$p){return $m.y-$p.y;});},$h._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems));},$k(0,$h,"space",function(){return this._space;},function($m){this._space=$m,this._setItemChanged();}),$k(0,$h,"align",function(){return this._align;},function($m){this._align=$m,this._setItemChanged();}),$p;}(),$o=function($p){function $h($m,$p){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$h.__super.call(this),$m&&(this.skin=$m),$p&&(this.sheet=$p);}$q($h,"laya.ui.FontClip",$p);var $m=$h.prototype;return $m.createChildren=function(){this._bitmap=new $M(),this.on("loaded",this,this._onClipLoaded);},$m._onClipLoaded=function(){this.callLater(this.changeValue);},$m.changeValue=function(){var $m;if(this._sources&&this._valueArr&&(this.graphics.clear(!0),$m=this._sources[0])){var $p="horizontal"===this._direction;$p?(this._wordsW=this._valueArr.length*($m.sourceWidth+this.spaceX),this._wordsH=$m.sourceHeight):(this._wordsW=$m.sourceWidth,this._wordsH=($m.sourceHeight+this.spaceY)*this._valueArr.length);var $h=0;if(this._width)switch(this._align){case"center":$h=.5*(this._width-this._wordsW);break;case"right":$h=this._width-this._wordsW;break;default:$h=0;}for(var $P=0,$L=this._valueArr.length;$P<$L;$P++){var $q=this._indexMap[this._valueArr.charAt($P)];this.sources[$q]&&($m=this.sources[$q],$p?this.graphics.drawTexture($m,$h+$P*($m.sourceWidth+this.spaceX),0,$m.sourceWidth,$m.sourceHeight):this.graphics.drawTexture($m,0+$h,$P*($m.sourceHeight+this.spaceY),$m.sourceWidth,$m.sourceHeight));}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize));}},$m.destroy=function($m){void 0===$m&&($m=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$p.prototype.destroy.call(this,$m);},$k(0,$m,"sheet",function(){return this._sheet;},function($m){$m+="";var $p=(this._sheet=$m).split(" ");this._clipX=String($p[0]).length,this.clipY=$p.length,this._indexMap={};for(var $h=0;$h<this._clipY;$h++)for(var $P=$p[$h].split(""),$L=0,$q=$P.length;$L<$q;$L++)this._indexMap[$P[$L]]=$h*this._clipX+$L;}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($l,this,"height",$m),this.callLater(this.changeValue);}),$k(0,$m,"direction",function(){return this._direction;},function($m){this._direction=$m,this.callLater(this.changeValue);}),$k(0,$m,"value",function(){return this._valueArr?this._valueArr:"";},function($m){$m+="",this._valueArr=$m,this.callLater(this.changeValue);}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($l,this,"width",$m),this.callLater(this.changeValue);}),$k(0,$m,"spaceX",function(){return this._spaceX;},function($m){this._spaceX=$m,"horizontal"===this._direction&&this.callLater(this.changeValue);}),$k(0,$m,"spaceY",function(){return this._spaceY;},function($m){this._spaceY=$m,"horizontal"!==this._direction&&this.callLater(this.changeValue);}),$k(0,$m,"align",function(){return this._align;},function($m){this._align=$m,this.callLater(this.changeValue);}),$k(0,$m,"measureWidth",function(){return this._wordsW;}),$k(0,$m,"measureHeight",function(){return this._wordsH;}),$h;}($l),$f=function($m){function $p(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $A(),$p.__super.call(this);}$q($p,"laya.ui.List",$m);var $h=$p.prototype;return $B.imps($h,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$h.destroy=function($m){void 0===$m&&($m=!0),this._content&&this._content.destroy($m),this._scrollBar&&this._scrollBar.destroy($m),laya.ui.Component.prototype.destroy.call(this,$m),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null;},$h.createChildren=function(){this.addChild(this._content=new $S());},$h.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$B.superGet($S,this,"cacheAs")),$B.superSet($S,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd);},$h.onScrollEnd=function(){$B.superSet($S,this,"cacheAs",this._$P.cacheAs);},$h._removePreScrollBar=function(){var $m=this.removeChildByName("scrollBar");$m&&$m.destroy(!0);},$h.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $m=this._getOneCell(),$p=$m.width+this._spaceX||1,$h=$m.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$p):Math.ceil(this._width/$p)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$h):Math.round(this._height/$h));var $P=this._width?this._width:$p*this.repeatX-this._spaceX,$L=this._height?this._height:$h*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$h:$p,this._cellOffset=this._isVertical?$h*Math.max(this._repeatY2,this._repeatY)-$L-this._spaceY:$p*Math.max(this._repeatX2,this._repeatX)-$P-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$L:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$P),this.setContentSize($P,$L);var $q=this._isVertical?this.repeatX:this.repeatY,$k=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$q,$k),this._createdLine=$k,this._array&&(this.array=this._array,this.runCallLater(this.renderItems));}},$h._getOneCell=function(){if(0===this._cells.length){var $m=this.createItem();if(this._offset.setTo($m.x,$m.y),this.cacheContent)return $m;this._cells.push($m);}return this._cells[0];},$h._createItems=function($m,$p,$h){var $P=this._content,$L=this._getOneCell(),$q=$L.width+this._spaceX,$k=$L.height+this._spaceY;if(this.cacheContent){var $Y=new $S();$Y.cacheAsBitmap=!0,$Y.pos((this._isVertical?0:$m)*$q,(this._isVertical?$m:0)*$k),this._content.addChild($Y),this._content.optimizeScrollRect=!0,$P=$Y;}else{for(var $d=[],$K=this._cells.length-1;-1<$K;$K--){var $D=this._cells[$K];$D.removeSelf(),$d.push($D);}this._cells.length=0;}for(var $F=$m;$F<$h;$F++)for(var $R=0;$R<$p;$R++)($L=$d&&$d.length?$d.pop():this.createItem()).x=(this._isVertical?$R:$F)*$q-$P.x,$L.y=(this._isVertical?$F:$R)*$k-$P.y,$L.name="item"+($F*$p+$R),$P.addChild($L),this.addCell($L);},$h.createItem=function(){var $m=[];if("function"==typeof this._itemRender)var $p=new this._itemRender();else $p=$r.createComp(this._itemRender,null,null,$m);if(0==$m.length&&$p._watchMap){var $h=$p._watchMap;for(var $P in $h)for(var $L=$h[$P],$q=0;$q<$L.length;$q++){var $k=$L[$q];$m.push($k.comp,$k.prop,$k.value);}}return $m.length&&($p._$bindData=$m),$p;},$h.addCell=function($m){$m.on("click",this,this.onCellMouse),$m.on("rightclick",this,this.onCellMouse),$m.on("mouseover",this,this.onCellMouse),$m.on("mouseout",this,this.onCellMouse),$m.on("mousedown",this,this.onCellMouse),$m.on("mouseup",this,this.onCellMouse),this._cells.push($m);},$h.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $m=0,$p=$m=0;$p<1e4;$p++){var $h=this.getChildByName("item"+$p);if(!$h)break;this.addCell($h),$m++;}this.repeatY=$m;}},$h.setContentSize=function($m,$p){this._content.width=$m,this._content.height=$p,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $c()),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$m,$p),this._content.scrollRect=this._content.scrollRect),this.event("resize");},$h.onCellMouse=function($m){"mousedown"===$m.type&&(this._isMoved=!1);var $p=$m.currentTarget,$h=this._startIndex+this._cells.indexOf($p);$h<0||("click"===$m.type||"rightclick"===$m.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$h:this.changeCellState($p,!0,0):"mouseover"!==$m.type&&"mouseout"!==$m.type||this._selectedIndex===$h||this.changeCellState($p,"mouseover"===$m.type,0),this.mouseHandler&&this.mouseHandler.runWith([$m,$h]));},$h.changeCellState=function($m,$p,$h){var $P=$m.getChildByName("selectBox");$P&&(this.selectEnable=!0,$P.visible=$p,$P.index=$h);},$h.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange);},$h.onScrollBarChange=function($m){this.runCallLater(this.changeCells);var $p=this._scrollBar.value,$h=this._isVertical?this.repeatX:this.repeatY,$P=this._isVertical?this.repeatY:this.repeatX,$L=Math.floor($p/this._cellSize);if(this.cacheContent)$k=$P+1,this._createdLine-$L<$k&&(this._createItems(this._createdLine,$h,this._createdLine+$k),this.renderItems(this._createdLine*$h,0),this._createdLine+=$k);else{var $q=$L*$h,$k=0;if($q>this._startIndex){$k=$q-this._startIndex;var $Y=!0,$d=this._startIndex+$h*($P+1);this._isMoved=!0;}else $q<this._startIndex&&($k=this._startIndex-$q,$Y=!1,$d=this._startIndex-1,this._isMoved=!0);for(var $K=0;$K<$k;$K++){if($Y){var $D=this._cells.shift();this._cells[this._cells.length]=$D;var $F=$d+$K;}else $D=this._cells.pop(),this._cells.unshift($D),$F=$d-$K;var $R=Math.floor($F/$h)*this._cellSize;this._isVertical?$D.y=$R:$D.x=$R,this.renderItem($D,$F);}this._startIndex=$q,this.changeSelectStatus();}var $$=this._content.scrollRect;this._isVertical?($$.y=$p-this._offset.y,$$.x=-this._offset.x):($$.y=-this._offset.y,$$.x=$p-this._offset.x),this._content.scrollRect=$$;},$h.posCell=function($m,$p){if(this._scrollBar){var $h=this._isVertical?this.repeatX:this.repeatY,$P=(this._isVertical?this.repeatY:this.repeatX,Math.floor($p/$h)*this._cellSize);this._isVertical?$m.y=$P:$m.x=$P;}},$h.changeSelectStatus=function(){for(var $m=0,$p=this._cells.length;$m<$p;$m++)this.changeCellState(this._cells[$m],this._selectedIndex===this._startIndex+$m,1);},$h.renderItems=function($m,$p){void 0===$m&&($m=0),void 0===$p&&($p=0);for(var $h=$m,$P=$p||this._cells.length;$h<$P;$h++)this.renderItem(this._cells[$h],this._startIndex+$h);this.changeSelectStatus(),this._twDone=!0;},$h.renderItem=function($m,$p){this._array&&0<=$p&&$p<this._array.length?($m.visible=!0,$m._$bindData?($m._dataSource=this._array[$p],this._bindData($m,this._array[$p])):$m.dataSource=this._array[$p],this.cacheContent||this.posCell($m,$p),this.hasListener("render")&&this.event("render",[$m,$p]),this.renderHandler&&this.renderHandler.runWith([$m,$p]),this.renderTwHandler&&this.renderTwHandler.runWith([$m,$p])):($m.visible=!1,$m.dataSource=null);},$h._bindData=function($m,$p){for(var $h=$m._$bindData,$P=0,$L=$h.length;$P<$L;$P++){var $q=$h[$P++],$k=$h[$P++],$Y=$h[$P],$d=$x.getBindFun($Y);$q[$k]=$d.call(this,$p);}},$h.refresh=function(){this.array=this._array;},$h.getItem=function($m){return-1<$m&&$m<this._array.length?this._array[$m]:null;},$h.changeItem=function($m,$p){-1<$m&&$m<this._array.length&&(this._array[$m]=$p,$m>=this._startIndex&&$m<this._startIndex+this._cells.length&&this.renderItem(this.getCell($m),$m));},$h.setItem=function($m,$p){this.changeItem($m,$p);},$h.addItem=function($m){this._array.push($m),this.array=this._array;},$h.addItemAt=function($m,$p){this._array.splice($p,0,$m),this.array=this._array;},$h.deleteItem=function($m){this._array.splice($m,1),this.array=this._array;},$h.getCell=function($m){return this.runCallLater(this.changeCells),-1<$m&&this._cells?this._cells[($m-this._startIndex)%this._cells.length]:null;},$h.scrollTo=function($m){if(this._scrollBar){var $p=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($m/$p)*this._cellSize;}else this.startIndex=$m;},$h.tweenTo=function($m,$p,$h){if(void 0===$p&&($p=200),this._scrollBar){var $P=this._isVertical?this.repeatX:this.repeatY;$E.to(this._scrollBar,{value:Math.floor($m/$P)*this._cellSize},$p,null,$h,0,!0);}else this.startIndex=$m,$h&&$h.run();},$h._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells));},$h.commitMeasure=function(){this.runCallLater(this.changeCells);},$k(0,$h,"cacheAs",$m.prototype._$get_cacheAs,function($m){$B.superSet($S,this,"cacheAs",$m),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$m?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart));}),$k(0,$h,"content",function(){return this._content;}),$k(0,$h,"height",$m.prototype._$get_height,function($m){$m!=this._height&&($B.superSet($S,this,"height",$m),this._setCellChanged());}),$k(0,$h,"itemRender",function(){return this._itemRender;},function($m){if(this._itemRender!=$m){this._itemRender=$m;for(var $p=this._cells.length-1;-1<$p;$p--)this._cells[$p].destroy();this._cells.length=0,this._setCellChanged();}}),$k(0,$h,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null;},function($m){this._removePreScrollBar();var $p=new $pm();$p.name="scrollBar",$p.right=0,$m&&" "!=$m&&($p.skin=$m),this.scrollBar=$p,this.addChild($p),this._setCellChanged();}),$k(0,$h,"page",function(){return this._page;},function($m){this._page=$m,this._array&&(this._page=0<$m?$m:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY);}),$k(0,$h,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null;},function($m){this._removePreScrollBar();var $p=new $i();$p.name="scrollBar",$p.bottom=0,$m&&" "!=$m&&($p.skin=$m),this.scrollBar=$p,this.addChild($p),this._setCellChanged();}),$k(0,$h,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1;},function($m){this._repeatX=$m,this._setCellChanged();}),$k(0,$h,"scrollBar",function(){return this._scrollBar;},function($m){this._scrollBar!=$m&&(this._scrollBar=$m)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange));}),$k(0,$h,"width",$m.prototype._$get_width,function($m){$m!=this._width&&($B.superSet($S,this,"width",$m),this._setCellChanged());}),$k(0,$h,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1;},function($m){this._repeatY=$m,this._setCellChanged();}),$k(0,$h,"spaceX",function(){return this._spaceX;},function($m){this._spaceX=$m,this._setCellChanged();}),$k(0,$h,"spaceY",function(){return this._spaceY;},function($m){this._spaceY=$m,this._setCellChanged();}),$k(0,$h,"selectedIndex",function(){return this._selectedIndex;},function($m){this._selectedIndex!=$m&&(this._selectedIndex=$m,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($m),this.startIndex=this._startIndex);}),$k(0,$h,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null;},function($m){this.selectedIndex=this._array.indexOf($m);}),$k(0,$h,"length",function(){return this._array?this._array.length:0;}),$k(0,$h,"selection",function(){return this.getCell(this._selectedIndex);},function($m){this.selectedIndex=this._startIndex+this._cells.indexOf($m);}),$k(0,$h,"startIndex",function(){return this._startIndex;},function($m){this._startIndex=0<$m?$m:0,this.callLater(this.renderItems);}),$k(0,$h,"twSwitch",function(){return this._twSwitch;},function($m){this._twSwitch=$m;}),$k(0,$h,"twDone",function(){return this._twDone;},function($m){this._twDone=$m;}),$k(0,$h,"array",function(){return this._array;},function($m){this.runCallLater(this.changeCells),this._array=$m||[];var $p=this._array.length;if(this.totalPage=Math.ceil($p/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$p?this._selectedIndex:$p-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $h=this._isVertical?this.repeatX:this.repeatY,$P=this._isVertical?this.repeatY:this.repeatX,$L=Math.ceil($p/$h);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$P/$L,this._scrollBar.setScroll(0,($L-$P)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content;}}),$k(0,$h,"dataSource",$m.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)&&Math.floor($m)==$m||"string"==typeof $m?this.selectedIndex=parseInt($m):$m instanceof Array?this.array=$m:$B.superSet($S,this,"dataSource",$m);}),$k(0,$h,"cells",function(){return this.runCallLater(this.changeCells),this._cells;}),$p;}($S),$i=function($m){function $p(){$p.__super.call(this);}return $q($p,"laya.ui.HScrollBar",$m),$p.prototype.initialize=function(){$m.prototype.initialize.call(this),this.slider.isVertical=!1;},$p;}($w),$v=function($m){function $p(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$p.__super.call(this),this.width=this.height=100;}$q($p,"laya.ui.Panel",$m);var $h=$p.prototype;return $h.destroy=function($m){void 0===$m&&($m=!0),laya.ui.Component.prototype.destroy.call(this,$m),this._content&&this._content.destroy($m),this._vScrollBar&&this._vScrollBar.destroy($m),this._hScrollBar&&this._hScrollBar.destroy($m),this._vScrollBar=null,this._hScrollBar=null,this._content=null;},$h.destroyChildren=function(){this._content.destroyChildren();},$h.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $S());},$h.addChild=function($m){return $m.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($m);},$h.onResize=function(){this._setScrollChanged();},$h.addChildAt=function($m,$p){return $m.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($m,$p);},$h.removeChild=function($m){return $m.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($m);},$h.removeChildAt=function($m){return this.getChildAt($m).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($m);},$h.removeChildren=function($m,$p){return void 0===$m&&($m=0),void 0===$p&&($p=2147483647),this._content.removeChildren($m,$p),this._setScrollChanged(),this;},$h.getChildAt=function($m){return this._content.getChildAt($m);},$h.getChildByName=function($m){return this._content.getChildByName($m);},$h.getChildIndex=function($m){return this._content.getChildIndex($m);},$h.changeScroll=function(){this._scrollChanged=!1;var $m=this.contentWidth||1,$p=this.contentHeight||1,$h=this._vScrollBar,$P=this._hScrollBar,$L=$h&&$p>this._height,$q=$P&&$m>this._width,$k=$L?this._width-$h.width:this._width,$Y=$q?this._height-$P.height:this._height;$h&&($h.x=this._width-$h.width,$h.y=0,$h.height=this._height-($q?$P.height:0),$h.scrollSize=Math.max(.033*this._height,1),$h.thumbPercent=$Y/$p,$h.setScroll(0,$p-$Y,$h.value)),$P&&($P.x=0,$P.y=this._height-$P.height,$P.width=this._width-($L?$h.width:0),$P.scrollSize=Math.max(.033*this._width,1),$P.thumbPercent=$k/$m,$P.setScroll(0,$m-$k,$P.value));},$h.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height);},$h.setContentSize=function($m,$p){var $h=this._content;$h.width=$m,$h.height=$p,$h.scrollRect||($h.scrollRect=new $c()),$h.scrollRect.setTo(0,0,$m,$p),$h.scrollRect=$h.scrollRect;},$h.onScrollBarChange=function($m){var $p=this._content.scrollRect;if($p){var $h=Math.round($m.value);$m.isVertical?$p.y=$h:$p.x=$h,this._content.scrollRect=$p;}},$h.scrollTo=function($m,$p){void 0===$m&&($m=0),void 0===$p&&($p=0),this.vScrollBar&&(this.vScrollBar.value=$p),this.hScrollBar&&(this.hScrollBar.value=$m);},$h.refresh=function(){this.changeScroll();},$h.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$B.superGet($S,this,"cacheAs")),$B.superSet($S,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd);},$h.onScrollEnd=function(){$B.superSet($S,this,"cacheAs",this._$P.cacheAs);},$h._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll));},$k(0,$h,"numChildren",function(){return this._content.numChildren;}),$k(0,$h,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null;},function($m){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $i()),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$m;}),$k(0,$h,"contentWidth",function(){for(var $m=0,$p=this._content.numChildren-1;-1<$p;$p--){var $h=this._content.getChildAt($p);$m=Math.max($h.x+$h.width*$h.scaleX,$m);}return $m;}),$k(0,$h,"contentHeight",function(){for(var $m=0,$p=this._content.numChildren-1;-1<$p;$p--){var $h=this._content.getChildAt($p);$m=Math.max($h.y+$h.height*$h.scaleY,$m);}return $m;}),$k(0,$h,"width",$m.prototype._$get_width,function($m){$B.superSet($S,this,"width",$m),this._setScrollChanged();}),$k(0,$h,"hScrollBar",function(){return this._hScrollBar;}),$k(0,$h,"content",function(){return this._content;}),$k(0,$h,"height",$m.prototype._$get_height,function($m){$B.superSet($S,this,"height",$m),this._setScrollChanged();}),$k(0,$h,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null;},function($m){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $pm()),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$m;}),$k(0,$h,"vScrollBar",function(){return this._vScrollBar;}),$k(0,$h,"cacheAs",$m.prototype._$get_cacheAs,function($m){$B.superSet($S,this,"cacheAs",$m),this._$P.cacheAs=null,"none"!==$m?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart));}),$p;}($S),$g=function($m){function $p($m){$p.__super.call(this,$m),this.isVertical=!1;}return $q($p,"laya.ui.HSlider",$X),$p;}(),$t=function($m){function $h($m,$p){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$h.__super.call(this),this.skin=$p,this.labels=$m;}$q($h,"laya.ui.UIGroup",$m);var $p=$h.prototype;return $B.imps($p,{"laya.ui.IItem":!0}),$p.preinitialize=function(){this.mouseEnabled=!0;},$p.destroy=function($m){void 0===$m&&($m=!0),laya.ui.Component.prototype.destroy.call(this,$m),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null;},$p.addItem=function($m,$p){void 0===$p&&($p=!0);var $h=$m,$P=this._items.length;if($h.name="item"+$P,this.addChild($h),this.initItems(),$p&&0<$P){var $L=this._items[$P-1];"horizontal"==this._direction?$h.x=$L.x+$L.width+this._space:$h.y=$L.y+$L.height+this._space;}else $p&&($h.x=0,$h.y=0);return $P;},$p.delItem=function($m,$p){void 0===$p&&($p=!0);var $h=this._items.indexOf($m);if(-1!=$h){var $P=$m;this.removeChild($P);for(var $L=$h+1,$q=this._items.length;$L<$q;$L++){var $k=this._items[$L];$k.name="item"+($L-1),$p&&("horizontal"==this._direction?$k.x-=$P.width+this._space:$k.y-=$P.height+this._space);}if(this.initItems(),-1<this._selectedIndex){var $Y;$Y=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$Y;}}},$p.initItems=function(){this._items||(this._items=[]);for(var $m=this._items.length=0;$m<1e4;$m++){var $p=this.getChildByName("item"+$m);if(null==$p)break;this._items.push($p),$p.selected=$m===this._selectedIndex,$p.clickHandler=$R.create(this,this.itemClick,[$m],!1);}},$p.itemClick=function($m){this.selectedIndex=$m;},$p.setSelect=function($m,$p){this._items&&-1<$m&&$m<this._items.length&&(this._items[$m].selected=$p);},$p.createItem=function($m,$p){return null;},$p.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $m=0,$p=0,$h=this._items.length;$p<$h;$p++){var $P=this._items[$p];this._skin&&($P.skin=this._skin),this._labelColors&&($P.labelColors=this._labelColors),this._labelSize&&($P.labelSize=this._labelSize),this._labelStroke&&($P.labelStroke=this._labelStroke),this._labelStrokeColor&&($P.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($P.strokeColors=this._strokeColors),this._labelBold&&($P.labelBold=this._labelBold),this._labelPadding&&($P.labelPadding=this._labelPadding),this._labelAlign&&($P.labelAlign=this._labelAlign),this._stateNum&&($P.stateNum=this._stateNum),this._labelFont&&($P.labelFont=this._labelFont),"horizontal"===this._direction?($P.y=0,$P.x=$m,$m+=$P.width+this._space):($P.x=0,$P.y=$m,$m+=$P.height+this._space);}this.changeSize();},$p.commitMeasure=function(){this.runCallLater(this.changeLabels);},$p._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels));},$k(0,$p,"labelStrokeColor",function(){return this._labelStrokeColor;},function($m){this._labelStrokeColor!=$m&&(this._labelStrokeColor=$m,this._setLabelChanged());}),$k(0,$p,"skin",function(){return this._skin;},function($m){this._skin!=$m&&(this._skin=$m,this._setLabelChanged());}),$k(0,$p,"selectedIndex",function(){return this._selectedIndex;},function($m){this._selectedIndex!=$m&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$m,this.setSelect($m,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex));}),$k(0,$p,"labels",function(){return this._labels;},function($m){if(this._labels!=$m){if(this._labels=$m,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $p=this._labels.split(","),$h=0,$P=$p.length;$h<$P;$h++){var $L=this.createItem(this._skin,$p[$h]);$L.name="item"+$h,this.addChild($L);}this.initItems();}}),$k(0,$p,"strokeColors",function(){return this._strokeColors;},function($m){this._strokeColors!=$m&&(this._strokeColors=$m,this._setLabelChanged());}),$k(0,$p,"labelColors",function(){return this._labelColors;},function($m){this._labelColors!=$m&&(this._labelColors=$m,this._setLabelChanged());}),$k(0,$p,"labelStroke",function(){return this._labelStroke;},function($m){this._labelStroke!=$m&&(this._labelStroke=$m,this._setLabelChanged());}),$k(0,$p,"labelSize",function(){return this._labelSize;},function($m){this._labelSize!=$m&&(this._labelSize=$m,this._setLabelChanged());}),$k(0,$p,"stateNum",function(){return this._stateNum;},function($m){this._stateNum!=$m&&(this._stateNum=$m,this._setLabelChanged());}),$k(0,$p,"labelBold",function(){return this._labelBold;},function($m){this._labelBold!=$m&&(this._labelBold=$m,this._setLabelChanged());}),$k(0,$p,"labelFont",function(){return this._labelFont;},function($m){this._labelFont!=$m&&(this._labelFont=$m,this._setLabelChanged());}),$k(0,$p,"labelPadding",function(){return this._labelPadding;},function($m){this._labelPadding!=$m&&(this._labelPadding=$m,this._setLabelChanged());}),$k(0,$p,"direction",function(){return this._direction;},function($m){this._direction=$m,this._setLabelChanged();}),$k(0,$p,"space",function(){return this._space;},function($m){this._space=$m,this._setLabelChanged();}),$k(0,$p,"items",function(){return this._items;}),$k(0,$p,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null;},function($m){this.selectedIndex=this._items.indexOf($m);}),$k(0,$p,"dataSource",$m.prototype._$get_dataSource,function($m){"number"==typeof(this._dataSource=$m)&&Math.floor($m)==$m||"string"==typeof $m?this.selectedIndex=parseInt($m):$m instanceof Array?this.labels=$m.join(","):$B.superSet($S,this,"dataSource",$m);}),$h;}($S),$O=function($p){function $h($m,$p){this._value=null,void 0===$p&&($p=""),$h.__super.call(this,$m,$p);}$q($h,"laya.ui.Radio",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._value=null;},$m.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1;},$m.initialize=function(){$p.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick);},$m.onClick=function($m){this.selected=!0;},$k(0,$m,"value",function(){return null!=this._value?this._value:this.label;},function($m){this._value=$m;}),$h;}($_),$C=function($m){function $p(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$p.__super.call(this),this.width=this.height=200;}$q($p,"laya.ui.Tree",$m);var $h=$p.prototype;return $B.imps($h,{"laya.ui.IRender":!0}),$h.destroy=function($m){void 0===$m&&($m=!0),laya.ui.Component.prototype.destroy.call(this,$m),this._list&&this._list.destroy($m),this._list=null,this._source=null,this._renderHandler=null;},$h.createChildren=function(){this.addChild(this._list=new $f()),this._list.renderHandler=$R.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange);},$h.onListChange=function($m){this.event("change");},$h.getArray=function(){var $m,$p=[];for(var $h in this._source)$m=this._source[$h],this.getParentOpenStatus($m)&&($m.x=this._spaceLeft*this.getDepth($m),$p.push($m));return $p;},$h.getDepth=function($m,$p){return void 0===$p&&($p=0),null==$m.nodeParent?$p:this.getDepth($m.nodeParent,$p+1);},$h.getParentOpenStatus=function($m){var $p=$m.nodeParent;return null==$p||!!$p.isOpen&&(null==$p.nodeParent||this.getParentOpenStatus($p));},$h.renderItem=function($m,$p){var $h=$m.dataSource;if($h){$m.left=$h.x;var $P=$m.getChildByName("arrow");$P&&($h.hasChild?($P.visible=!0,$P.index=$h.isOpen?1:0,$P.tag=$p,$P.off("click",this,this.onArrowClick),$P.on("click",this,this.onArrowClick)):$P.visible=!1);var $L=$m.getChildByName("folder");$L&&(2==$L.clipY?$L.index=$h.isDirectory?0:1:$L.index=$h.isDirectory?$h.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$m,$p]);}},$h.onArrowClick=function($m){var $p=$m.currentTarget.tag;this._list.array[$p].isOpen=!this._list.array[$p].isOpen,this.event("open"),this._list.array=this.getArray();},$h.setItemState=function($m,$p){this._list.array[$m]&&(this._list.array[$m].isOpen=$p,this._list.array=this.getArray());},$h.fresh=function(){this._list.array=this.getArray(),this.repaint();},$h.parseXml=function($m,$p,$h,$P){var $L,$q=$m.childNodes,$k=$q.length;if(!$P){$L={};var $Y,$d=$m.attributes;for(var $K in $d){var $D=($Y=$d[$K]).nodeName,$F=$Y.nodeValue;$L[$D]="true"==$F||"false"!=$F&&$F;}$L.nodeParent=$h,0<$k&&($L.isDirectory=!0),$L.hasChild=0<$k,$p.push($L);}for(var $R=0;$R<$k;$R++){var $$=$q[$R];this.parseXml($$,$p,$L,!1);}},$h.parseOpenStatus=function($m,$p){for(var $h=0,$P=$p.length;$h<$P;$h++){var $L=$p[$h];if($L.isDirectory)for(var $q=0,$k=$m.length;$q<$k;$q++){var $Y=$m[$q];if($Y.isDirectory&&this.isSameParent($Y,$L)&&$L.label==$Y.label){$L.isOpen=$Y.isOpen;break;}}}},$h.isSameParent=function($m,$p){return null==$m.nodeParent&&null==$p.nodeParent||null!=$m.nodeParent&&null!=$p.nodeParent&&$m.nodeParent.label==$p.nodeParent.label&&this.isSameParent($m.nodeParent,$p.nodeParent);},$h.filter=function($m){if(Boolean($m)){var $p=[];this.getFilterSource(this._source,$p,$m),this._list.array=$p;}else this._list.array=this.getArray();},$h.getFilterSource=function($m,$p,$h){var $P;for(var $L in $h=$h.toLocaleLowerCase(),$m)!($P=$m[$L]).isDirectory&&-1<String($P.label).toLowerCase().indexOf($h)&&($P.x=0,$p.push($P)),$P.child&&0<$P.child.length&&this.getFilterSource($P.child,$p,$h);},$k(0,$h,"spaceBottom",function(){return this._list.spaceY;},function($m){this._list.spaceY=$m;}),$k(0,$h,"keepStatus",function(){return this._keepStatus;},function($m){this._keepStatus=$m;}),$k(0,$h,"itemRender",function(){return this._list.itemRender;},function($m){this._list.itemRender=$m;}),$k(0,$h,"array",function(){return this._list.array;},function($m){this._keepStatus&&this._list.array&&$m&&this.parseOpenStatus(this._list.array,$m),this._source=$m,this._list.array=this.getArray();}),$k(0,$h,"mouseHandler",function(){return this._list.mouseHandler;},function($m){this._list.mouseHandler=$m;}),$k(0,$h,"dataSource",$m.prototype._$get_dataSource,function($m){this._dataSource=$m,$B.superSet($S,this,"dataSource",$m);}),$k(0,$h,"source",function(){return this._source;}),$k(0,$h,"scrollBar",function(){return this._list.scrollBar;}),$k(0,$h,"list",function(){return this._list;}),$k(0,$h,"scrollBarSkin",function(){return this._list.vScrollBarSkin;},function($m){this._list.vScrollBarSkin=$m;}),$k(0,$h,"renderHandler",function(){return this._renderHandler;},function($m){this._renderHandler=$m;}),$k(0,$h,"selectedIndex",function(){return this._list.selectedIndex;},function($m){this._list.selectedIndex=$m;}),$k(0,$h,"spaceLeft",function(){return this._spaceLeft;},function($m){this._spaceLeft=$m;}),$k(0,$h,"selectedItem",function(){return this._list.selectedItem;},function($m){this._list.selectedItem=$m;}),$k(0,$h,"width",$m.prototype._$get_width,function($m){$B.superSet($S,this,"width",$m),this._list.width=$m;}),$k(0,$h,"height",$m.prototype._$get_height,function($m){$B.superSet($S,this,"height",$m),this._list.height=$m;}),$k(0,$h,"xml",null,function($m){var $p=[];this.parseXml($m.childNodes[0],$p,null,!0),this.array=$p;}),$k(0,$h,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null;}),$p;}($S),$mm=function($m){function $p(){this._items=null,this._selectedIndex=0,$p.__super.call(this),this._setIndexHandler=$R.create(this,this.setIndex,null,!1);}$q($p,"laya.ui.ViewStack",$m);var $h=$p.prototype;return $B.imps($h,{"laya.ui.IItem":!0}),$h.setItems=function($m){this.removeChildren();for(var $p=0,$h=0,$P=$m.length;$h<$P;$h++){var $L=$m[$h];$L&&($L.name="item"+$p,this.addChild($L),$p++);}this.initItems();},$h.addItem=function($m){$m.name="item"+this._items.length,this.addChild($m),this.initItems();},$h.initItems=function(){this._items=[];for(var $m=0;$m<1e4;$m++){var $p=this.getChildByName("item"+$m);if(null==$p)break;this._items.push($p),$p.visible=$m==this._selectedIndex;}},$h.setSelect=function($m,$p){this._items&&-1<$m&&$m<this._items.length&&(this._items[$m].visible=$p);},$h.setIndex=function($m){this.selectedIndex=$m;},$k(0,$h,"dataSource",$m.prototype._$get_dataSource,function($m){if("number"==typeof(this._dataSource=$m)&&Math.floor($m)==$m||"string"==typeof $m)this.selectedIndex=parseInt($m);else for(var $p in this._dataSource)this.hasOwnProperty($p)&&(this[$p]=this._dataSource[$p]);}),$k(0,$h,"selectedIndex",function(){return this._selectedIndex;},function($m){this._selectedIndex!=$m&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$m,this.setSelect(this._selectedIndex,!0));}),$k(0,$h,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null;},function($m){this.selectedIndex=this._items.indexOf($m);}),$k(0,$h,"items",function(){return this._items;}),$k(0,$h,"setIndexHandler",function(){return this._setIndexHandler;},function($m){this._setIndexHandler=$m;}),$p;}($S),$pm=function($m){function $p(){$p.__super.call(this);}return $q($p,"laya.ui.VScrollBar",$w),$p;}(),$hm=function($p){function $h($m){this._bg=null,this._skin=null,$h.__super.call(this),void 0===$m&&($m=""),this.text=$m,this.skin=this.skin;}$q($h,"laya.ui.TextInput",$p);var $m=$h.prototype;return $m.preinitialize=function(){this.mouseEnabled=!0;},$m.destroy=function($m){$e.clearCache(this,this._skin),void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._bg&&this._bg.destroy(),this._bg=null;},$m.createChildren=function(){this.addChild(this._tf=new $$()),this._tf.padding=$j.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus);},$m._onFocus=function(){this.event("focus",this);},$m._onBlur=function(){this.event("blur",this);},$m._onInput=function(){this.event("input",this);},$m._onEnter=function(){this.event("enter",this);},$m.initialize=function(){this.width=128,this.height=22;},$m.select=function(){this._tf.select();},$m.setSelection=function($m,$p){this._tf.setSelection($m,$p);},$k(0,$m,"text",$p.prototype._$get_text,function($m){this._tf.text!=$m&&($m+="",this._tf.text=$m,this.event("change"));}),$k(0,$m,"bg",function(){return this._bg;},function($m){this.graphics=this._bg=$m;}),$k(0,$m,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster;},function($m){this._tf.inputElementYAdjuster=$m;}),$k(0,$m,"multiline",function(){return this._tf.multiline;},function($m){this._tf.multiline=$m;}),$k(0,$m,"skin",function(){return this._skin;},function($m){this._skin!=$m&&($e.clearCache(this,this._skin),this._skin=$m,this._bg||(this.graphics=this._bg=new $M()),$e.keepCache(this,this._skin),this._bg.source=$e.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height));}),$k(0,$m,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null;},function($m){this._bg||(this.graphics=this._bg=new $M()),this._bg.sizeGrid=$x.fillArray($j.defaultSizeGrid,$m,Number);}),$k(0,$m,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster;},function($m){this._tf.inputElementXAdjuster=$m;}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($G,this,"width",$m),this._bg&&(this._bg.width=$m);}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($G,this,"height",$m),this._bg&&(this._bg.height=$m);}),$k(0,$m,"editable",function(){return this._tf.editable;},function($m){this._tf.editable=$m;}),$k(0,$m,"restrict",function(){return this._tf.restrict;},function($m){this._tf.restrict=$m;}),$k(0,$m,"prompt",function(){return this._tf.prompt;},function($m){this._tf.prompt=$m;}),$k(0,$m,"promptColor",function(){return this._tf.promptColor;},function($m){this._tf.promptColor=$m;}),$k(0,$m,"maxChars",function(){return this._tf.maxChars;},function($m){this._tf.maxChars=$m;}),$k(0,$m,"focus",function(){return this._tf.focus;},function($m){this._tf.focus=$m;}),$k(0,$m,"type",function(){return this._tf.type;},function($m){this._tf.type=$m;}),$k(0,$m,"asPassword",function(){return this._tf.asPassword;},function($m){this._tf.asPassword=$m;}),$h;}($G),$Pm=function($m){function $p(){$p.__super.call(this);}return $q($p,"laya.ui.VSlider",$X),$p;}(),$Lm=function($m){function $P(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$P.__super.call(this);}$q($P,"laya.ui.Dialog",$m);var $p=$P.prototype;return $p.initialize=function(){this.popupEffect=$P.manager.popupEffectHandler,this.closeEffect=$P.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick);},$p._dealDragArea=function(){var $m=this.getChildByName("drag");$m&&(this.dragArea=$m.x+","+$m.y+","+$m.width+","+$m.height,$m.removeSelf());},$p._onClick=function($m){var $p=$m.target;if($p)switch($p.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($p.name);}},$p.show=function($m,$p){void 0===$m&&($m=!1),void 0===$p&&($p=!0),this._open(!1,$m,$p);},$p.popup=function($m,$p){void 0===$m&&($m=!1),void 0===$p&&($p=!0),this._open(!0,$m,$p);},$p._open=function($m,$p,$h){$P.manager.lock(!1),this.isModal=$m,$P.manager.open(this,$p,$h);},$p.onOpened=function(){},$p.close=function($m,$p){void 0===$p&&($p=!0),$P.manager.close(this,$m,$p);},$p.onClosed=function($m){},$p._onMouseDown=function($m){var $p=this.getMousePoint();this._dragArea.contains($p.x,$p.y)?this.startDrag():this.stopDrag();},$k(0,$p,"dragArea",function(){return this._dragArea?this._dragArea.toString():null;},function($m){if($m){var $p=$x.fillArray([0,0,0,0],$m,Number);this._dragArea=new $c($p[0],$p[1],$p[2],$p[3]),this.on("mousedown",this,this._onMouseDown);}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown);}),$k(0,$p,"isPopup",function(){return null!=this.parent;}),$k(0,$p,"zOrder",$m.prototype._$get_zOrder,function($m){$B.superSet($r,this,"zOrder",$m),$P.manager._checkMask();}),$k(1,$P,"manager",function(){return $P._manager=$P._manager||new $N();},function($m){$P._manager=$m;}),$P.setLockView=function($m){$P.manager.setLockView($m);},$P.lock=function($m){$P.manager.lock($m);},$P.closeAll=function(){$P.manager.closeAll();},$P.getDialogsByGroup=function($m){return $P.manager.getDialogsByGroup($m);},$P.closeByGroup=function($m){return $P.manager.closeByGroup($m);},$P.CLOSE="close",$P.CANCEL="cancel",$P.SURE="sure",$P.NO="no",$P.OK="ok",$P.YES="yes",$P._manager=null,$P;}($r),$qm=function($m){function $p(){$p.__super.call(this);}$q($p,"laya.ui.HBox",$m);var $h=$p.prototype;return $h.sortItem=function($m){$m&&$m.sort(function($m,$p){return $m.x-$p.x;});},$h.changeItems=function(){this._itemChanged=!1;for(var $m=[],$p=0,$h=0,$P=this.numChildren;$h<$P;$h++){var $L=this.getChildAt($h);$L&&$L.layoutEnabled&&($m.push($L),$p=this._height?this._height:Math.max($p,$L.height*$L.scaleY));}this.sortItem($m);var $q=0;for($h=0,$P=$m.length;$h<$P;$h++)($L=$m[$h]).x=$q,$q+=$L.width*$L.scaleX+this._space,"top"==this._align?$L.y=0:"middle"==this._align?$L.y=.5*($p-$L.height*$L.scaleY):"bottom"==this._align&&($L.y=$p-$L.height*$L.scaleY);this.changeSize();},$k(0,$h,"height",$m.prototype._$get_height,function($m){this._height!=$m&&($B.superSet($V,this,"height",$m),this.callLater(this.changeItems));}),$p.NONE="none",$p.TOP="top",$p.MIDDLE="middle",$p.BOTTOM="bottom",$p;}($V),$km=function($m){function $p(){$p.__super.call(this);}$q($p,"laya.ui.VBox",$m);var $h=$p.prototype;return $h.changeItems=function(){this._itemChanged=!1;for(var $m=[],$p=0,$h=0,$P=this.numChildren;$h<$P;$h++){var $L=this.getChildAt($h);$L&&$L.layoutEnabled&&($m.push($L),$p=this._width?this._width:Math.max($p,$L.width*$L.scaleX));}this.sortItem($m);var $q=0;for($h=0,$P=$m.length;$h<$P;$h++)($L=$m[$h]).y=$q,$q+=$L.height*$L.scaleY+this._space,"left"==this._align?$L.x=0:"center"==this._align?$L.x=.5*($p-$L.width*$L.scaleX):"right"==this._align&&($L.x=$p-$L.width*$L.scaleX);this.changeSize();},$k(0,$h,"width",$m.prototype._$get_width,function($m){this._width!=$m&&($B.superSet($V,this,"width",$m),this.callLater(this.changeItems));}),$p.NONE="none",$p.LEFT="left",$p.CENTER="center",$p.RIGHT="right",$p;}($V),$Ym=function($m){function $p(){$p.__super.call(this);}return $q($p,"laya.ui.RadioGroup",$t),$p.prototype.createItem=function($m,$p){return new $O($m,$p);},$p;}(),$dm=function($m){function $p(){$p.__super.call(this);}return $q($p,"laya.ui.Tab",$t),$p.prototype.createItem=function($m,$p){return new $_($m,$p);},$p;}(),$Km=function($p){function $h($m){this._vScrollBar=null,this._hScrollBar=null,void 0===$m&&($m=""),$h.__super.call(this,$m);}$q($h,"laya.ui.TextArea",$p);var $m=$h.prototype;return $m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null;},$m.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0;},$m.onVBarChanged=function($m){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value);},$m.onHBarChanged=function($m){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value);},$m.changeScroll=function(){var $m=this._vScrollBar&&0<this._tf.maxScrollY,$p=this._hScrollBar&&0<this._tf.maxScrollX,$h=$m?this._width-this._vScrollBar.width:this._width,$P=$p?this._height-this._hScrollBar.height:this._height,$L=this._tf.padding||$j.labelPadding;this._tf.width=$h,this._tf.height=$P,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$L[2],this._vScrollBar.y=$L[1],this._vScrollBar.height=this._height-($p?this._hScrollBar.height:0)-$L[1]-$L[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$P/Math.max(this._tf.textHeight,$P),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$m),this._hScrollBar&&(this._hScrollBar.x=$L[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$L[3],this._hScrollBar.width=this._width-($m?this._vScrollBar.width:0)-$L[0]-$L[2],this._hScrollBar.scrollSize=Math.max(.033*$h,1),this._hScrollBar.thumbPercent=$h/Math.max(this._tf.textWidth,$h),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$p);},$m.scrollTo=function($m){this.commitMeasure(),this._tf.scrollY=$m;},$k(0,$m,"scrollY",function(){return this._tf.scrollY;}),$k(0,$m,"width",$p.prototype._$get_width,function($m){$B.superSet($hm,this,"width",$m),this.callLater(this.changeScroll);}),$k(0,$m,"hScrollBar",function(){return this._hScrollBar;}),$k(0,$m,"height",$p.prototype._$get_height,function($m){$B.superSet($hm,this,"height",$m),this.callLater(this.changeScroll);}),$k(0,$m,"maxScrollX",function(){return this._tf.maxScrollX;}),$k(0,$m,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null;},function($m){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $pm()),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$m;}),$k(0,$m,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null;},function($m){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $i()),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$m;}),$k(0,$m,"vScrollBar",function(){return this._vScrollBar;}),$k(0,$m,"maxScrollY",function(){return this._tf.maxScrollY;}),$k(0,$m,"scrollX",function(){return this._tf.scrollX;}),$h;}($hm);!function($m){function $p(){this._uiView=null,this.isCloseOther=!1,$p.__super.call(this);}$q($p,"laya.ui.AsynDialog",$Lm);var $h=$p.prototype;$h.createView=function($m){this._uiView=$m;},$h._open=function($m,$p,$h){this.isModal=$m,this.isCloseOther=$p,$Lm.manager.lock(!0),this._uiView?this.onCreated():this.onOpen();},$h.onCreated=function(){this.createUI(),this.onOpen();},$h.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea();},$h.onOpen=function(){$Lm.manager.open(this,this.isCloseOther),$Lm.manager.lock(!1);},$h.close=function($m,$p){void 0===$p&&($p=!0),$Lm.manager.close(this),this.onClose();},$h.onClose=function(){},$h.destroy=function($m){void 0===$m&&($m=!0),laya.ui.View.prototype.destroy.call(this,$m),this._uiView=null,this.onDestroy();},$h.onDestroy=function(){};}();$B.__init([$r]);}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($m,$p){"use strict";for(var $h in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $P=Laya[$h];$P&&$P.__isclass&&($p[$h]=$P);}}),function($R,$m,$H){$H.un,$H.uns;var $F=$H.static,$$=$H.class,$A=$H.getset,$P=$H.__newvec,$Z=laya.maths.Arith,$k=laya.webgl.atlas.AtlasResourceManager,$h=laya.webgl.shader.BaseShader,$u=laya.utils.Browser,$Y=laya.webgl.utils.Buffer,$W=laya.utils.Byte,$L=laya.utils.ClassUtils,$d=$H.Config,$q=(laya.events.Event,laya.events.EventDispatcher),$j=laya.utils.Handler,$c=laya.net.Loader,$p=laya.net.LoaderManager,$K=(laya.maths.MathUtil,laya.display.Node),$B=laya.renders.Render,$D=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$n=laya.resource.Resource,$e=laya.utils.RunDriver,$a=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$E=laya.display.Sprite,$I=laya.utils.Stat,$b=laya.utils.StringKey,$x=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$T=laya.utils.Utils,$Q=laya.webgl.WebGL,$M=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$H.interface("laya.d3.core.IClone"),$H.interface("laya.d3.graphics.IVertex"),$H.interface("laya.d3.core.render.IUpdate"),$H.interface("laya.d3.core.scene.ITreeNode"),$H.interface("laya.d3.core.render.IRenderable");(function(){function $_(){}$$($_,"laya.d3.animation.AnimationClipParser01"),$_.READ_DATA=function(){$_._DATA.offset=$_._reader.getUint32(),$_._DATA.size=$_._reader.getUint32();},$_.READ_BLOCK=function(){for(var $m=$_._BLOCK.count=$_._reader.getUint16(),$p=$_._BLOCK.blockStarts=[],$h=$_._BLOCK.blockLengths=[],$P=0;$P<$m;$P++)$p.push($_._reader.getUint32()),$h.push($_._reader.getUint32());},$_.READ_STRINGS=function(){var $m=$_._reader.getUint32(),$p=$_._reader.getUint16(),$h=$_._reader.pos;$_._reader.pos=$m+$_._DATA.offset;for(var $P=0;$P<$p;$P++)$_._strings[$P]=$_._reader.readUTFString();$_._reader.pos=$h;},$_.parse=function($m,$p){$_._animationClip=$m;($_._reader=$p).__getBuffer();$_.READ_DATA(),$_.READ_BLOCK(),$_.READ_STRINGS();for(var $h=0,$P=$_._BLOCK.count;$h<$P;$h++){var $L=$p.getUint16(),$q=$_._strings[$L],$k=$_["READ_"+$q];if(null==$k)throw new Error("model file err,no this function:"+$L+" "+$q);$k.call();}},$_.READ_ANIMATIONS=function(){var $m,$p=0,$h=0,$P=$_._reader,$L=$P.__getBuffer(),$q=[],$k=$P.getUint8();for($q.length=$k,$p=0;$p<$k;$p++)$q[$p]=$P.getUint16();var $Y=[],$d=$P.getUint16();for($Y.length=$d,$p=0;$p<$d;$p++)$Y[$p]=$P.getFloat32();var $K=$_._animationClip;$K.name=$_._strings[$P.getUint16()];var $D=$K._duration=$P.getFloat32();$K.islooping=!!$P.getByte(),$K._frameRate=$P.getInt16();var $F=$P.getInt16(),$R=$K._nodes=new Array();$R.length=$F,($K._publicClipDatas=[]).length=$F;var $$=$K._nodesMap={},$A=0,$B=0;for($p=0;$p<$F;$p++){$m=$R[$p]=new $U();var $n=$P.getUint16(),$c=$m.path=[];for($c.length=$n,$h=0;$h<$n;$h++)$c[$h]=$_._strings[$P.getUint16()];var $e=$c.join("/"),$a=$$[$e];$a||($$[$e]=$a=[]),$a.push($m);var $Z=$P.getInt16();-1!==$Z&&($m.componentType=$_._strings[$Z]);var $H=$s._propertyIndexDic[$_._strings[$P.getUint16()]];if(null==$H)throw new Error("AnimationClipParser01:unknown property name.");var $W=$H<4,$E=!$W||$W&&""===$c[0];($m._cacheProperty=$E)?$A++:$B++,$m.propertyNameID=$H;var $I=$q[$P.getUint8()];$m.keyFrameWidth=$I/4;var $b=$m.keyFrames=[],$T=$b.length=$P.getUint16(),$j=null,$x=NaN;for($h=0;$h<$T;$h++){var $Q=$b[$h]=new $G();$x=$Q.startTime=$Y[$P.getUint16()];var $M=$P.pos;$Q.inTangent=new Float32Array($L.slice($M,$M+$I)),$P.pos+=$I,$M=$P.pos,$Q.outTangent=new Float32Array($L.slice($M,$M+$I)),$P.pos+=$I,$M=$P.pos,$Q.data=new Float32Array($L.slice($M,$M+$I)),$P.pos+=$I,$j&&($j.next=$Q,$j.duration=$x-$j.startTime),$j=$Q;}$Q.next=null,$Q.duration=$D-$x;}var $u=$K._nodeToCachePropertyMap=new Int32Array($F),$N=$K._cachePropertyMap=new Int32Array($A),$S=$K._unCachePropertyMap=new Int32Array($B);for($A=$B=0,$p=0;$p<$F;$p++)($m=$R[$p])._cacheProperty?($u[$p]=$A,$N[$A++]=$p):$S[$B++]=$p;},$_._animationClip=null,$_._reader=null,$_._strings=[],$F($_,["_BLOCK",function(){return this._BLOCK={count:0};},"_DATA",function(){return this._DATA={offset:0,size:0};}]);})(),function(){function $w(){}$$($w,"laya.d3.animation.AnimationClipParser02"),$w.READ_DATA=function(){$w._DATA.offset=$w._reader.getUint32(),$w._DATA.size=$w._reader.getUint32();},$w.READ_BLOCK=function(){for(var $m=$w._BLOCK.count=$w._reader.getUint16(),$p=$w._BLOCK.blockStarts=[],$h=$w._BLOCK.blockLengths=[],$P=0;$P<$m;$P++)$p.push($w._reader.getUint32()),$h.push($w._reader.getUint32());},$w.READ_STRINGS=function(){var $m=$w._reader.getUint32(),$p=$w._reader.getUint16(),$h=$w._reader.pos;$w._reader.pos=$m+$w._DATA.offset;for(var $P=0;$P<$p;$P++)$w._strings[$P]=$w._reader.readUTFString();$w._reader.pos=$h;},$w.parse=function($m,$p){$w._animationClip=$m;($w._reader=$p).__getBuffer();$w.READ_DATA(),$w.READ_BLOCK(),$w.READ_STRINGS();for(var $h=0,$P=$w._BLOCK.count;$h<$P;$h++){var $L=$p.getUint16(),$q=$w._strings[$L],$k=$w["READ_"+$q];if(null==$k)throw new Error("model file err,no this function:"+$L+" "+$q);$k.call();}},$w.READ_ANIMATIONS=function(){var $m,$p=0,$h=0,$P=$w._reader,$L=$P.__getBuffer(),$q=[],$k=$P.getUint8();for($q.length=$k,$p=0;$p<$k;$p++)$q[$p]=$P.getUint16();var $Y=[],$d=$P.getUint16();for($Y.length=$d,$p=0;$p<$d;$p++)$Y[$p]=$P.getFloat32();var $K=$w._animationClip;$K.name=$w._strings[$P.getUint16()];var $D=$K._duration=$P.getFloat32();$K.islooping=!!$P.getByte(),$K._frameRate=$P.getInt16();var $F=$P.getInt16(),$R=$K._nodes=new Array();$R.length=$F,($K._publicClipDatas=[]).length=$F;var $$=$K._nodesMap={},$A=0,$B=0;for($p=0;$p<$F;$p++){$m=$R[$p]=new $U();var $n=$P.getUint16(),$c=$m.path=[];for($c.length=$n,$h=0;$h<$n;$h++)$c[$h]=$w._strings[$P.getUint16()];var $e=$c.join("/"),$a=$$[$e];$a||($$[$e]=$a=[]),$a.push($m);var $Z=$P.getInt16();-1!==$Z&&($m.componentType=$w._strings[$Z]);var $H=$s._propertyIndexDic[$w._strings[$P.getUint16()]];if(null==$H)throw new Error("AnimationClipParser02:unknown property name.");var $W=$H<4,$E=!$W||$W&&""===$c[0];($m._cacheProperty=$E)?$A++:$B++,$m.propertyNameID=$H;var $I=$q[$P.getUint8()];$m.keyFrameWidth=$I/4;var $b=$m.keyFrames=[],$T=$b.length=$P.getUint16(),$j=null,$x=NaN;for($h=0;$h<$T;$h++){var $Q=$b[$h]=new $G();$x=$Q.startTime=$Y[$P.getUint16()];var $M=$P.pos;$Q.inTangent=new Float32Array($L.slice($M,$M+$I)),$P.pos+=$I,$M=$P.pos,$Q.outTangent=new Float32Array($L.slice($M,$M+$I)),$P.pos+=$I,$M=$P.pos,$Q.data=new Float32Array($L.slice($M,$M+$I)),$P.pos+=$I,$j&&($j.next=$Q,$j.duration=$x-$j.startTime),$j=$Q;}$Q.next=null,$Q.duration=$D-$x;}var $u=$P.getUint16();for($p=0;$p<$u;$p++){var $N,$S=new $X();$S.time=$P.getFloat32(),$S.eventName=$w._strings[$P.getUint16()];var $_=$P.getUint16();for(0<$_&&($S.params=$N=[]),$h=0;$h<$_;$h++){switch($P.getByte()){case 0:$N.push(!!$P.getByte());break;case 1:$N.push($P.getInt32());break;case 2:$N.push($P.getFloat32());break;case 3:$N.push($w._strings[$P.getUint16()]);break;default:throw new Error("unknown type.");}}$K.addEvent($S);}var $l=$K._nodeToCachePropertyMap=new Int32Array($F),$J=$K._cachePropertyMap=new Int32Array($A),$z=$K._unCachePropertyMap=new Int32Array($B);for($A=$B=0,$p=0;$p<$F;$p++)($m=$R[$p])._cacheProperty?($l[$p]=$A,$J[$A++]=$p):$z[$B++]=$p;},$w._animationClip=null,$w._reader=null,$w._strings=[],$F($w,["_BLOCK",function(){return this._BLOCK={count:0};},"_DATA",function(){return this._DATA={offset:0,size:0};}]);}();var $X=function(){function $m(){this.time=NaN,this.eventName=null,this.params=null;}return $$($m,"laya.d3.animation.AnimationEvent"),$m;}(),$s=function(){function $P(){this._childs=[],this.transform=new $ep(this);}$$($P,"laya.d3.animation.AnimationNode");var $m=$P.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.addChild=function($m){$m._parent=this,$m.transform.setParent(this.transform),this._childs.push($m);},$m.removeChild=function($m){var $p=this._childs.indexOf($m);-1!==$p&&this._childs.splice($p,1);},$m.getChildByName=function($m){for(var $p=0,$h=this._childs.length;$p<$h;$p++){var $P=this._childs[$p];if($P.name===$m)return $P;}return null;},$m.getChildByIndex=function($m){return this._childs[$m];},$m.getChildCount=function(){return this._childs.length;},$m.cloneTo=function($m){var $p=$m;$p.name=this.name;for(var $h=0,$P=this._childs.length;$h<$P;$h++){var $L=this._childs[$h],$q=$L.clone();$p.addChild($q);var $k=$L.transform,$Y=$q.transform;$Y.setLocalPosition($k.getLocalPosition()),$Y.setLocalRotation($k.getLocalRotation()),$Y.setLocalScale($k.getLocalScale()),$Y._localRotationEuler=$k._localRotationEuler,$Y._setWorldMatrixIgnoreUpdate($k.getWorldMatrix());}},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$P.__init__=function(){$P.registerAnimationNodeProperty("localPosition",$P._getLocalPosition,$P._setLocalPosition),$P.registerAnimationNodeProperty("localRotation",$P._getLocalRotation,$P._setLocalRotation),$P.registerAnimationNodeProperty("localScale",$P._getLocalScale,$P._setLocalScale),$P.registerAnimationNodeProperty("localRotationEuler",$P._getLocalRotationEuler,$P._setLocalRotationEuler),$P.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$P._getParticleRenderSharedMaterialTintColor,$P._setParticleRenderSharedMaterialTintColor),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$P._getMeshRenderSharedMaterialTilingOffset,$P._setMeshRenderSharedMaterialTilingOffset),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$P._getMeshRenderSharedMaterialAlbedo,$P._setMeshRenderSharedMaterialAlbedo),$P.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$P._getSkinnedMeshRenderSharedMaterialTilingOffset,$P._setSkinnedMeshRenderSharedMaterialTilingOffset),$P.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$P._getSkinnedMeshRenderSharedMaterialAlbedo,$P._setSkinnedMeshRenderSharedMaterialAlbedo),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$P._getMeshRenderSharedMaterialAlbedo,$P._setMeshRenderSharedMaterialAlbedo),$P.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$P._getSkinnedMeshRenderSharedMaterialAlbedo,$P._setSkinnedMeshRenderSharedMaterialAlbedo),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$P._getMeshRenderSharedMaterialIntensity,$P._setMeshRenderSharedMaterialIntensity),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$P._getMeshRenderSharedMaterialAlpha,$P._setMeshRenderSharedMaterialAlpha),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$P._getMeshRenderSharedMaterialAlphaColor,$P._setMeshRenderSharedMaterialAlphaColor),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$P._getMeshRenderSharedMaterialBaseColor,$P._setMeshRenderSharedMaterialBaseColor),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$P._getMeshRenderSharedMaterialDissolve,$P._setMeshRenderSharedMaterialDissolve),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$P._getMeshRenderSharedMaterialDissolveSpeed,$P._setMeshRenderSharedMaterialDissolveSpeed),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$P._getMeshRenderSharedMaterialMMultiplier,$P._setMeshRenderSharedMaterialMMultiplier),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$P._getMeshRenderSharedMaterialBaseScrollSpeedX,$P._setMeshRenderSharedMaterialBaseScrollSpeedX),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$P._getMeshRenderSharedMaterialBaseScrollSpeedY,$P._setMeshRenderSharedMaterialBaseScrollSpeedY),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$P._getMeshRenderSharedMaterialSecondScrollSpeedX,$P._setMeshRenderSharedMaterialSecondScrollSpeedX),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$P._getMeshRenderSharedMaterialSecondScrollSpeedY,$P._setMeshRenderSharedMaterialSecondScrollSpeedY),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$P._getMeshRenderSharedMaterialDetailTilingOffset,$P._setMeshRenderSharedMaterialDetailTilingOffset),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$P._getMeshRenderSharedMaterialDissolveTilingOffset,$P._setMeshRenderSharedMaterialDissolveTilingOffset),$P.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$P._getMeshRenderSharedMaterialMaskTilingOffset,$P._setMeshRenderSharedMaterialMaskTilingOffset);},$P.registerAnimationNodeProperty=function($m,$p,$h){if($P._propertyIndexDic[$m])throw new Error("AnimationNode: this propertyName has registered.");$P._propertyIndexDic[$m]=$P._propertyIDCounter,$P._propertyGetFuncs[$P._propertyIDCounter]=$p,$P._propertySetFuncs[$P._propertyIDCounter]=$h,$P._propertyIDCounter++;},$P._getLocalPosition=function($m,$p){return $m?$m.transform.getLocalPosition():$p._transform.localPosition.elements;},$P._setLocalPosition=function($m,$p,$h){if($m)$m.transform.setLocalPosition($h);else{var $P=$p._transform,$L=$P.localPosition;$L.elements=$h,$P.localPosition=$L;}},$P._getLocalRotation=function($m,$p){return $m?$m.transform.getLocalRotation():$p._transform.localRotation.elements;},$P._setLocalRotation=function($m,$p,$h){if($m)$m.transform.setLocalRotation($h);else{var $P=$p._transform,$L=$P.localRotation;$L.elements=$h,$P.localRotation=$L;}},$P._getLocalScale=function($m,$p){return $m?$m.transform.getLocalScale():$p._transform.localScale.elements;},$P._setLocalScale=function($m,$p,$h){if($m)$m.transform.setLocalScale($h);else{var $P=$p._transform,$L=$P.localScale;$L.elements=$h,$P.localScale=$L;}},$P._getLocalRotationEuler=function($m,$p){return $m?$m.transform.getLocalRotationEuler():$p._transform.localRotationEuler.elements;},$P._setLocalRotationEuler=function($m,$p,$h){if($m)$m.transform.setLocalRotationEuler($h);else{var $P=$p._transform,$L=$P.localRotationEuler;$L.elements=$h,$P.localRotationEuler=$L;}},$P._getMeshRenderSharedMaterialTilingOffset=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.tilingOffset.elements:null;}return $p.meshRender.sharedMaterial.tilingOffset.elements;},$P._setMeshRenderSharedMaterialTilingOffset=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).tilingOffset).elements=$h,$P.tilingOffset=$L);}else($L=($P=$p.meshRender.material).tilingOffset).elements=$h,$P.tilingOffset=$L;},$P._getMeshRenderSharedMaterialAlbedo=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.albedoColor.elements:null;}return $p.meshRender.sharedMaterial.albedoColor.elements;},$P._setMeshRenderSharedMaterialAlbedo=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).albedoColor).elements=$h,$P.albedoColor=$L);}else($L=($P=$p.meshRender.material).albedoColor).elements=$h,$P.albedoColor=$L;},$P._getSkinnedMeshRenderSharedMaterialTilingOffset=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null;}return $p.skinnedMeshRender.sharedMaterial.tilingOffset.elements;},$P._setSkinnedMeshRenderSharedMaterialTilingOffset=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.skinnedMeshRender.material).tilingOffset).elements=$h,$P.tilingOffset=$L);}else($L=($P=$p.skinnedMeshRender.material).tilingOffset).elements=$h,$P.tilingOffset=$L;},$P._getSkinnedMeshRenderSharedMaterialAlbedo=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null;}return $p.skinnedMeshRender.sharedMaterial.albedoColor.elements;},$P._setSkinnedMeshRenderSharedMaterialAlbedo=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.skinnedMeshRender.material).albedoColor).elements=$h,$P.albedoColor=$L);}else($L=($P=$p.skinnedMeshRender.material).albedoColor).elements=$h,$P.albedoColor=$L;},$P._getParticleRenderSharedMaterialTintColor=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.particleRender.sharedMaterial.tintColor.elements:null;}return $p.particleRender.sharedMaterial.tintColor.elements;},$P._setParticleRenderSharedMaterialTintColor=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.particleRender.material).tintColor).elements=$h,$P.tintColor=$L);}else($L=($P=$p.particleRender.material).tintColor).elements=$h,$P.tintColor=$L;},$P._getMeshRenderSharedMaterialAlphaColor=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.alphaColor.elements:null;}return $p.meshRender.sharedMaterial.alphaColor.elements;},$P._setMeshRenderSharedMaterialAlphaColor=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).alphaColor).elements=$h,$P.alphaColor=$L);}else($L=($P=$p.meshRender.material).alphaColor).elements=$h,$P.alphaColor=$L;},$P._getMeshRenderSharedMaterialBaseColor=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.baseColor.elements:null;}return $p.meshRender.sharedMaterial.baseColor.elements;},$P._setMeshRenderSharedMaterialBaseColor=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).baseColor).elements=$h,$P.baseColor=$L);}else($L=($P=$p.meshRender.material).baseColor).elements=$h,$P.baseColor=$L;},$P._getMeshRenderSharedMaterialDissolve=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.dissolve:0;}return $p.meshRender.sharedMaterial.dissolve;},$P._setMeshRenderSharedMaterialDissolve=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.dissolve=$h[0]);}else $p.meshRender.material.dissolve=$h[0];},$P._getMeshRenderSharedMaterialDissolveSpeed=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.dissolveSpeed:0;}return $p.meshRender.sharedMaterial.dissolveSpeed;},$P._setMeshRenderSharedMaterialDissolveSpeed=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.dissolveSpeed=$h[0]);}else $p.meshRender.material.dissolveSpeed=$h[0];},$P._getMeshRenderSharedMaterialMMultiplier=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.mMultiplier:0;}return $p.meshRender.sharedMaterial.mMultiplier;},$P._setMeshRenderSharedMaterialMMultiplier=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.mMultiplier=$h[0]);}else $p.meshRender.material.mMultiplier=$h[0];},$P._getMeshRenderSharedMaterialBaseScrollSpeedX=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.baseScrollSpeedX:0;}return $p.meshRender.sharedMaterial.baseScrollSpeedX;},$P._setMeshRenderSharedMaterialBaseScrollSpeedX=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.baseScrollSpeedX=$h[0]);}else $p.meshRender.material.baseScrollSpeedX=$h[0];},$P._getMeshRenderSharedMaterialBaseScrollSpeedY=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.baseScrollSpeedY:0;}return $p.meshRender.sharedMaterial.baseScrollSpeedY;},$P._setMeshRenderSharedMaterialBaseScrollSpeedY=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.baseScrollSpeedY=$h[0]);}else $p.meshRender.material.baseScrollSpeedY=$h[0];},$P._getMeshRenderSharedMaterialSecondScrollSpeedX=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.secondScrollSpeedX:0;}return $p.meshRender.sharedMaterial.secondScrollSpeedX;},$P._setMeshRenderSharedMaterialSecondScrollSpeedX=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.secondScrollSpeedX=$h[0]);}else $p.meshRender.material.secondScrollSpeedX=$h[0];},$P._getMeshRenderSharedMaterialSecondScrollSpeedY=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.secondScrollSpeedY:0;}return $p.meshRender.sharedMaterial.secondScrollSpeedY;},$P._setMeshRenderSharedMaterialSecondScrollSpeedY=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.secondScrollSpeedY=$h[0]);}else $p.meshRender.material.secondScrollSpeedY=$h[0];},$P._getMeshRenderSharedMaterialAlpha=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.alpha:0;}return $p.meshRender.sharedMaterial.alpha;},$P._setMeshRenderSharedMaterialAlpha=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.alpha=$h[0]);}else $p.meshRender.material.alpha=$h[0];},$P._getMeshRenderSharedMaterialIntensity=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.intensity:0;}return $p.meshRender.sharedMaterial.intensity;},$P._setMeshRenderSharedMaterialIntensity=function($m,$p,$h){if($m){var $P=$m.transform._entity;$P&&($P.owner.meshRender.material.intensity=$h[0]);}else $p.meshRender.material.intensity=$h[0];},$P._getMeshRenderSharedMaterialDetailTilingOffset=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null;}return $p.meshRender.sharedMaterial.detailTilingOffset.elements;},$P._setMeshRenderSharedMaterialDetailTilingOffset=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).detailTilingOffset).elements=$h,$P.detailTilingOffset=$L);}else($L=($P=$p.meshRender.material).detailTilingOffset).elements=$h,$P.detailTilingOffset=$L;},$P._getMeshRenderSharedMaterialDissolveTilingOffset=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null;}return $p.meshRender.sharedMaterial.dissolveTilingOffset.elements;},$P._setMeshRenderSharedMaterialDissolveTilingOffset=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).dissolveTilingOffset).elements=$h,$P.dissolveTilingOffset=$L);}else($L=($P=$p.meshRender.material).dissolveTilingOffset).elements=$h,$P.dissolveTilingOffset=$L;},$P._getMeshRenderSharedMaterialMaskTilingOffset=function($m,$p){if($m){var $h=$m.transform._entity;return $h?$h.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null;}return $p.meshRender.sharedMaterial.maskTilingOffset.elements;},$P._setMeshRenderSharedMaterialMaskTilingOffset=function($m,$p,$h){var $P,$L;if($m){var $q=$m.transform._entity;$q&&(($L=($P=$q.owner.meshRender.material).maskTilingOffset).elements=$h,$P.maskTilingOffset=$L);}else($L=($P=$p.meshRender.material).maskTilingOffset).elements=$h,$P.maskTilingOffset=$L;},$P._propertyIDCounter=0,$P._propertyIndexDic={},$P._propertySetFuncs=[],$P._propertyGetFuncs=[],$P;}(),$G=function(){function $m(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null;}return $$($m,"laya.d3.animation.Keyframe"),$m;}(),$U=function(){function $m(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null;}return $$($m,"laya.d3.animation.KeyframeNode"),$m;}(),$N=(function(){function $m(){this._tempVector30=new $kp(),this._tempVector31=new $kp(),this._tempVector32=new $kp(),this._a=new $kp(),this._b=new $kp(),this._c=new $kp(),this._d=new $kp();}$$($m,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $p=$m.prototype;$p.Init=function($m,$p,$h,$P){$m.cloneTo(this._d),$p.cloneTo(this._c),$kp.scale($m,2,this._a),$kp.scale($h,2,this._tempVector30),$kp.subtract(this._a,this._tempVector30,this._a),$kp.add(this._a,$p,this._a),$kp.add(this._a,$P,this._a),$kp.scale($h,3,this._b),$kp.scale($m,3,this._tempVector30),$kp.subtract(this._b,this._tempVector30,this._b),$kp.subtract(this._b,$P,this._b),$kp.scale($p,2,this._tempVector30),$kp.subtract(this._b,this._tempVector30,this._b);},$p.Slerp=function($m,$p){$kp.scale(this._a,$m*$m*$m,this._tempVector30),$kp.scale(this._b,$m*$m,this._tempVector31),$kp.scale(this._c,$m,this._tempVector32),$kp.add(this._tempVector30,this._tempVector31,$p),$kp.add($p,this._tempVector32,$p),$kp.add($p,this._d,$p);};}(),function(){function $J($m,$p,$h,$P){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$m,this._h=$p,this._minHeight=$h,this._maxHeight=$P;}$$($J,"laya.d3.core.HeightMap");var $m=$J.prototype;$m._inBounds=function($m,$p){return 0<=$m&&$m<this._h&&0<=$p&&$p<this._w;},$m.getHeight=function($m,$p){return this._inBounds($m,$p)?this._datas[$m][$p]:NaN;},$A(0,$m,"width",function(){return this._w;}),$A(0,$m,"height",function(){return this._h;}),$A(0,$m,"maxHeight",function(){return this._maxHeight;}),$A(0,$m,"minHeight",function(){return this._minHeight;}),$J.creatFromMesh=function($m,$p,$h,$P){for(var $L=[],$q=[],$k=$m.getSubMeshCount(),$Y=0;$Y<$k;$Y++){for(var $d=$m.getSubMesh($Y),$K=$d._getVertexBuffer(),$D=$K.getData(),$F=[],$R=0;$R<$D.length;$R+=$K.vertexDeclaration.vertexStride/4){var $$=new $kp($D[$R+0],$D[$R+1],$D[$R+2]);$F.push($$);}$L.push($F);var $A=$d._getIndexBuffer();$q.push($A.getData());}var $B=$m.boundingBox,$n=$B.min.x,$c=$B.min.z,$e=$B.max.x,$a=$B.max.z,$Z=$B.min.y,$H=$B.max.y,$W=$e-$n,$E=$a-$c,$I=$P.elements[0]=$W/($p-1),$b=$P.elements[1]=$E/($h-1),$T=new $J($p,$h,$Z,$H),$j=$J._tempRay,$x=$j.direction.elements;$x[0]=0,$x[1]=-1,$x[2]=0;var $Q=$H+.1;$j.origin.elements[1]=$Q;for(var $M=0;$M<$h;$M++){var $u=$c+$M*$b;$T._datas[$M]=[];for(var $N=0;$N<$p;$N++){var $S=$n+$N*$I,$_=$j.origin.elements;$_[0]=$S,$_[2]=$u;var $l=$J._getPosition($j,$L,$q);$T._datas[$M][$N]=$l===Number.MAX_VALUE?NaN:$Q-$l;}}return $T;},$J.createFromImage=function($m,$p,$h){for(var $P=$m.width,$L=$m.height,$q=new $J($P,$L,$p,$h),$k=($h-$p)/254,$Y=$m.getPixels(),$d=0,$K=0;$K<$L;$K++)for(var $D=$q._datas[$K]=[],$F=0;$F<$P;$F++){var $R=$Y[$d++],$$=$Y[$d++],$A=$Y[$d++],$B=$Y[$d++];$D[$F]=255==$R&&255==$$&&255==$A&&255==$B?NaN:($R+$$+$A)/3*$k+$p;}return $q;},$J._getPosition=function($m,$p,$h){for(var $P=Number.MAX_VALUE,$L=0;$L<$p.length;$L++)for(var $q=$p[$L],$k=$h[$L],$Y=0;$Y<$k.length;$Y+=3){var $d=$q[$k[$Y+0]],$K=$q[$k[$Y+1]],$D=$q[$k[$Y+2]],$F=$Ap.rayIntersectsTriangle($m,$d,$K,$D);!isNaN($F)&&$F<$P&&($P=$F);}return $P;},$F($J,["_tempRay",function(){return this._tempRay=new $Lp(new $kp(),new $kp());}]);}(),function(){function $L(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[];}$$($L,"laya.d3.core.Layer");var $m=$L.prototype;return $m._binarySearchIndex=function(){for(var $m=0,$p=$L._collsionTestList.length-1,$h=0;$m<=$p;){$h=Math.floor(($m+$p)/2);var $P=$L._collsionTestList[$h];if($P==this._number)return $h;$P>this._number?$p=$h-1:$m=$h+1;}return $m;},$m._addCollider=function($m){0===this._colliders.length&&$L._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$m._isRigidbody?(this._colliders.unshift($m),this._nonRigidbodyOffset++):this._colliders.push($m);},$m._removeCollider=function($m){var $p=this._colliders.indexOf($m);$p<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($p,1),0===this._colliders.length&&$L._collsionTestList.splice($L._collsionTestList.indexOf(this._number),1);},$A(0,$m,"number",function(){return this._number;}),$A(0,$m,"visible",function(){return this._visible;},function($m){this._visible=$m,$L._visibleLayers=$m?$L._visibleLayers|this.mask:$L._visibleLayers&~this.mask;}),$A(0,$m,"mask",function(){return this._mask;}),$A(1,$L,"visibleLayers",function(){return $L._visibleLayers;},function($m){$L._visibleLayers=$m;for(var $p=0,$h=$L._layerList.length;$p<$h;$p++){var $P=$L._layerList[$p];$P._visible=0!=($P._mask&$L._visibleLayers);}}),$L.__init__=function(){$L._layerList.length=31;for(var $m=0;$m<31;$m++){var $p=new $L();$L._layerList[$m]=$p,0===$m?($p.name="Default Layer",$p.visible=!0):($p.name="Layer-"+$m,$p.visible=!1),$p._number=$m,$p._mask=Math.pow(2,$m);}$L.currentCreationLayer=$L._layerList[0];},$L.getLayerByNumber=function($m){if($m<0||30<$m)throw new Error("无法返回指定Layer，该number超出范围！");return $L._layerList[$m];},$L.getLayerByName=function($m){for(var $p=0;$p<31;$p++)if($L._layerList[$p].name===$m)return $L._layerList[$p];throw new Error("无法返回指定Layer,该name不存在");},$L.isVisible=function($m){return 0!=($m&$L._currentCameraCullingMask&$L._visibleLayers);},$L._layerList=[],$L._visibleLayers=2147483647,$L._collsionTestList=[],$L._currentCameraCullingMask=2147483647,$L.maxCount=31,$L.currentCreationLayer=null,$L;}()),$S=(function(){function $m($m,$p,$h){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$m,this._minCount=$p,this._maxCount=$h;}$$($m,"laya.d3.core.particleShuriKen.module.Burst");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($m){var $p=$m;$p._time=this._time,$p._minCount=this._minCount,$p._maxCount=this._maxCount;},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"time",function(){return this._time;}),$A(0,$p,"minCount",function(){return this._minCount;}),$A(0,$p,"maxCount",function(){return this._maxCount;});}(),function(){function $m($m){this._color=null,this.enbale=!1,this._color=$m;}$$($m,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $p=$m.prototype;$p.cloneTo=function($m){var $p=$m;this._color.cloneTo($p._color),$p.enbale=this.enbale;},$p.clone=function(){var $m;switch(this._color.type){case 0:$m=$l.createByConstant(this._color.constant.clone());break;case 1:$m=$l.createByGradient(this._color.gradient.clone());break;case 2:$m=$l.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$m=$l.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone());}var $p=new this.constructor($m);return $p.enbale=this.enbale,$p;},$A(0,$p,"color",function(){return this._color;});}(),function(){function $m(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[];}$$($m,"laya.d3.core.particleShuriKen.module.Emission");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$p._destroy=function(){this._bursts=null,this._destroyed=!0;},$p.getBurstsCount=function(){return this._bursts.length;},$p.getBurstByIndex=function($m){return this._bursts[$m];},$p.addBurst=function($m){var $p=this._bursts.length;if(0<$p)for(var $h=0;$h<$p;$h++)this._bursts[$h].time>$m.time&&this._bursts.splice($h,0,$m);this._bursts.push($m);},$p.removeBurst=function($m){var $p=this._bursts.indexOf($m);-1!==$p&&this._bursts.splice($p,1);},$p.removeBurstByIndex=function($m){this._bursts.splice($m,1);},$p.clearBurst=function(){this._bursts.length=0;},$p.cloneTo=function($m){var $p=$m,$h=$p._bursts;$h.length=this._bursts.length;for(var $P=0,$L=this._bursts.length;$P<$L;$P++){var $q=$h[$P];$q?this._bursts[$P].cloneTo($q):$h[$P]=this._bursts[$P].clone();}$p._emissionRate=this._emissionRate,$p.enbale=this.enbale;},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"destroyed",function(){return this._destroyed;}),$A(0,$p,"emissionRate",function(){return this._emissionRate;},function($m){if($m<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$m;});}(),function(){function $P(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null;}$$($P,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $m=$P.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.cloneTo=function($m){var $p=$m;$p._type=this._type,$p._constant=this._constant,this._overTime.cloneTo($p._overTime),$p._constantMin=this._constantMin,$p._constantMax=this._constantMax,this._overTimeMin.cloneTo($p._overTimeMin),this._overTimeMax.cloneTo($p._overTimeMax);},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$m,"frameOverTimeData",function(){return this._overTime;}),$A(0,$m,"constant",function(){return this._constant;}),$A(0,$m,"type",function(){return this._type;}),$A(0,$m,"frameOverTimeDataMin",function(){return this._overTimeMin;}),$A(0,$m,"constantMin",function(){return this._constantMin;}),$A(0,$m,"frameOverTimeDataMax",function(){return this._overTimeMax;}),$A(0,$m,"constantMax",function(){return this._constantMax;}),$P.createByConstant=function($m){var $p=new $P();return $p._type=0,$p._constant=$m,$p;},$P.createByOverTime=function($m){var $p=new $P();return $p._type=1,$p._overTime=$m,$p;},$P.createByRandomTwoConstant=function($m,$p){var $h=new $P();return $h._type=2,$h._constantMin=$m,$h._constantMax=$p,$h;},$P.createByRandomTwoOverTime=function($m,$p){var $h=new $P();return $h._type=3,$h._overTimeMin=$m,$h._overTimeMax=$p,$h;},$P;}()),$_=function(){function $K(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null;}$$($K,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $m=$K.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.cloneTo=function($m){var $p=$m;$p._type=this._type,$p._separateAxes=this._separateAxes,$p._constant=this._constant,this._constantSeparate.cloneTo($p._constantSeparate),this._gradient.cloneTo($p._gradient),this._gradientX.cloneTo($p._gradientX),this._gradientY.cloneTo($p._gradientY),this._gradientZ.cloneTo($p._gradientZ),$p._constantMin=this._constantMin,$p._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($p._constantMinSeparate),this._constantMaxSeparate.cloneTo($p._constantMaxSeparate),this._gradientMin.cloneTo($p._gradientMin),this._gradientMax.cloneTo($p._gradientMax),this._gradientXMin.cloneTo($p._gradientXMin),this._gradientXMax.cloneTo($p._gradientXMax),this._gradientYMin.cloneTo($p._gradientYMin),this._gradientYMax.cloneTo($p._gradientYMax),this._gradientZMin.cloneTo($p._gradientZMin),this._gradientZMax.cloneTo($p._gradientZMax);},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$m,"gradientZ",function(){return this._gradientZ;}),$A(0,$m,"constant",function(){return this._constant;}),$A(0,$m,"gradient",function(){return this._gradient;}),$A(0,$m,"separateAxes",function(){return this._separateAxes;}),$A(0,$m,"type",function(){return this._type;}),$A(0,$m,"constantSeparate",function(){return this._constantSeparate;}),$A(0,$m,"gradientX",function(){return this._gradientX;}),$A(0,$m,"gradientY",function(){return this._gradientY;}),$A(0,$m,"gradientW",function(){return this._gradientW;}),$A(0,$m,"gradientMin",function(){return this._gradientMin;}),$A(0,$m,"constantMin",function(){return this._constantMin;}),$A(0,$m,"gradientMax",function(){return this._gradientMax;}),$A(0,$m,"constantMax",function(){return this._constantMax;}),$A(0,$m,"gradientWMin",function(){return this._gradientWMin;}),$A(0,$m,"constantMinSeparate",function(){return this._constantMinSeparate;}),$A(0,$m,"constantMaxSeparate",function(){return this._constantMaxSeparate;}),$A(0,$m,"gradientXMin",function(){return this._gradientXMin;}),$A(0,$m,"gradientXMax",function(){return this._gradientXMax;}),$A(0,$m,"gradientWMax",function(){return this._gradientWMax;}),$A(0,$m,"gradientYMin",function(){return this._gradientYMin;}),$A(0,$m,"gradientYMax",function(){return this._gradientYMax;}),$A(0,$m,"gradientZMin",function(){return this._gradientZMin;}),$A(0,$m,"gradientZMax",function(){return this._gradientZMax;}),$K.createByConstant=function($m){var $p=new $K();return $p._type=0,$p._separateAxes=!1,$p._constant=$m,$p;},$K.createByConstantSeparate=function($m){var $p=new $K();return $p._type=0,$p._separateAxes=!0,$p._constantSeparate=$m,$p;},$K.createByGradient=function($m){var $p=new $K();return $p._type=1,$p._separateAxes=!1,$p._gradient=$m,$p;},$K.createByGradientSeparate=function($m,$p,$h,$P){var $L=new $K();return $L._type=1,$L._separateAxes=!0,$L._gradientX=$m,$L._gradientY=$p,$L._gradientZ=$h,$L._gradientW=$P,$L;},$K.createByRandomTwoConstant=function($m,$p){var $h=new $K();return $h._type=2,$h._separateAxes=!1,$h._constantMin=$m,$h._constantMax=$p,$h;},$K.createByRandomTwoConstantSeparate=function($m,$p){var $h=new $K();return $h._type=2,$h._separateAxes=!0,$h._constantMinSeparate=$m,$h._constantMaxSeparate=$p,$h;},$K.createByRandomTwoGradient=function($m,$p){var $h=new $K();return $h._type=3,$h._separateAxes=!1,$h._gradientMin=$m,$h._gradientMax=$p,$h;},$K.createByRandomTwoGradientSeparate=function($m,$p,$h,$P,$L,$q,$k,$Y){var $d=new $K();return $d._type=3,$d._separateAxes=!0,$d._gradientXMin=$m,$d._gradientXMax=$p,$d._gradientYMin=$h,$d._gradientYMax=$P,$d._gradientZMin=$L,$d._gradientZMax=$q,$d._gradientWMin=$k,$d._gradientWMax=$Y,$d;},$K;}(),$l=function(){function $P(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null;}$$($P,"laya.d3.core.particleShuriKen.module.GradientColor");var $m=$P.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.cloneTo=function($m){var $p=$m;$p._type=this._type,this._constant.cloneTo($p._constant),this._constantMin.cloneTo($p._constantMin),this._constantMax.cloneTo($p._constantMax),this._gradient.cloneTo($p._gradient),this._gradientMin.cloneTo($p._gradientMin),this._gradientMax.cloneTo($p._gradientMax);},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$m,"gradient",function(){return this._gradient;}),$A(0,$m,"constant",function(){return this._constant;}),$A(0,$m,"type",function(){return this._type;}),$A(0,$m,"gradientMin",function(){return this._gradientMin;}),$A(0,$m,"constantMin",function(){return this._constantMin;}),$A(0,$m,"gradientMax",function(){return this._gradientMax;}),$A(0,$m,"constantMax",function(){return this._constantMax;}),$P.createByConstant=function($m){var $p=new $P();return $p._type=0,$p._constant=$m,$p;},$P.createByGradient=function($m){var $p=new $P();return $p._type=1,$p._gradient=$m,$p;},$P.createByRandomTwoConstant=function($m,$p){var $h=new $P();return $h._type=2,$h._constantMin=$m,$h._constantMax=$p,$h;},$P.createByRandomTwoGradient=function($m,$p){var $h=new $P();return $h._type=3,$h._gradientMin=$m,$h._gradientMax=$p,$h;},$P;}(),$J=(function(){function $m(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16);}$$($m,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.addAlpha=function($m,$p){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$m&&($m=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$m,this._alphaElements[this._alphaCurrentLength++]=$p):DEBUG;},$p.addRGB=function($m,$p){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$m&&($m=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$m,this._rgbElements[this._rgbCurrentLength++]=$p.x,this._rgbElements[this._rgbCurrentLength++]=$p.y,this._rgbElements[this._rgbCurrentLength++]=$p.z):DEBUG;},$p.cloneTo=function($m){var $p=$m,$h=0,$P=0;$p._alphaCurrentLength=this._alphaCurrentLength;var $L=$p._alphaElements;for($L.length=this._alphaElements.length,$h=0,$P=this._alphaElements.length;$h<$P;$h++)$L[$h]=this._alphaElements[$h];$p._rgbCurrentLength=this._rgbCurrentLength;var $q=$p._rgbElements;for($q.length=this._rgbElements.length,$h=0,$P=this._rgbElements.length;$h<$P;$h++)$q[$h]=this._rgbElements[$h];},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"alphaGradientCount",function(){return this._alphaCurrentLength/2;}),$A(0,$p,"rgbGradientCount",function(){return this._rgbCurrentLength/4;});}(),function(){function $m(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8);}$$($m,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.add=function($m,$p){this._currentLength<8?(6===this._currentLength&&1!==$m&&($m=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$m,this._elements[this._currentLength++]=$p):console.log("Warning:data count must lessEqual than 4");},$p.cloneTo=function($m){var $p=$m;$p._currentLength=this._currentLength;var $h=$p._elements;$h.length=this._elements.length;for(var $P=0,$L=this._elements.length;$P<$L;$P++)$h[$P]=this._elements[$P];},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"gradientCount",function(){return this._currentLength/2;});}(),function(){function $m(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8);}$$($m,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.add=function($m,$p){this._currentLength<8?(6===this._currentLength&&1!==$m&&($m=1,DEBUG),this._elements[this._currentLength++]=$m,this._elements[this._currentLength++]=$p):DEBUG;},$p.getKeyByIndex=function($m){return this._elements[2*$m];},$p.getValueByIndex=function($m){return this._elements[2*$m+1];},$p.getAverageValue=function(){for(var $m=0,$p=this._currentLength-2;$m<$p;$m+=2){this._elements[$m+1];this._elements[$m+3],this._elements[$m+2]-this._elements[$m];}return 0;},$p.cloneTo=function($m){var $p=$m;$p._currentLength=this._currentLength;var $h=$p._elements;$h.length=this._elements.length;for(var $P=0,$L=this._elements.length;$P<$L;$P++)$h[$P]=this._elements[$P];},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"gradientCount",function(){return this._currentLength/2;});}(),function(){function $m(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12);}$$($m,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.add=function($m,$p){this._currentLength<8?(6===this._currentLength&&1!==$m&&($m=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$m,this._elements[this._currentLength++]=$p.x,this._elements[this._currentLength++]=$p.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4");},$p.cloneTo=function($m){var $p=$m;$p._currentLength=this._currentLength;var $h=$p._elements;$h.length=this._elements.length;for(var $P=0,$L=this._elements.length;$P<$L;$P++)$h[$P]=this._elements[$P];},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"gradientCount",function(){return this._currentLength/3;});}(),function(){function $Y(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null;}$$($Y,"laya.d3.core.particleShuriKen.module.GradientSize");var $m=$Y.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.getMaxSizeInGradient=function(){var $m=0,$p=0,$h=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($m=0,$p=this._gradientX.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientX.getValueByIndex($m));for($m=0,$p=this._gradientY.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientY.getValueByIndex($m));}else for($m=0,$p=this._gradient.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradient.getValueByIndex($m));break;case 1:$h=this._separateAxes?($h=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$h=Math.max($h,this._constantMinSeparate.y),Math.max($h,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($m=0,$p=this._gradientXMin.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientXMin.getValueByIndex($m));for($m=0,$p=this._gradientXMax.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientXMax.getValueByIndex($m));for($m=0,$p=this._gradientYMin.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientYMin.getValueByIndex($m));for($m=0,$p=this._gradientZMax.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientZMax.getValueByIndex($m));}else{for($m=0,$p=this._gradientMin.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientMin.getValueByIndex($m));for($m=0,$p=this._gradientMax.gradientCount;$m<$p;$m++)$h=Math.max($h,this._gradientMax.getValueByIndex($m));}}return $h;},$m.cloneTo=function($m){var $p=$m;$p._type=this._type,$p._separateAxes=this._separateAxes,this._gradient.cloneTo($p._gradient),this._gradientX.cloneTo($p._gradientX),this._gradientY.cloneTo($p._gradientY),this._gradientZ.cloneTo($p._gradientZ),$p._constantMin=this._constantMin,$p._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($p._constantMinSeparate),this._constantMaxSeparate.cloneTo($p._constantMaxSeparate),this._gradientMin.cloneTo($p._gradientMin),this._gradientMax.cloneTo($p._gradientMax),this._gradientXMin.cloneTo($p._gradientXMin),this._gradientXMax.cloneTo($p._gradientXMax),this._gradientYMin.cloneTo($p._gradientYMin),this._gradientYMax.cloneTo($p._gradientYMax),this._gradientZMin.cloneTo($p._gradientZMin),this._gradientZMax.cloneTo($p._gradientZMax);},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$m,"gradientZ",function(){return this._gradientZ;}),$A(0,$m,"gradient",function(){return this._gradient;}),$A(0,$m,"separateAxes",function(){return this._separateAxes;}),$A(0,$m,"type",function(){return this._type;}),$A(0,$m,"gradientMin",function(){return this._gradientMin;}),$A(0,$m,"constantMin",function(){return this._constantMin;}),$A(0,$m,"gradientX",function(){return this._gradientX;}),$A(0,$m,"gradientY",function(){return this._gradientY;}),$A(0,$m,"gradientMax",function(){return this._gradientMax;}),$A(0,$m,"constantMax",function(){return this._constantMax;}),$A(0,$m,"constantMinSeparate",function(){return this._constantMinSeparate;}),$A(0,$m,"constantMaxSeparate",function(){return this._constantMaxSeparate;}),$A(0,$m,"gradientXMin",function(){return this._gradientXMin;}),$A(0,$m,"gradientXMax",function(){return this._gradientXMax;}),$A(0,$m,"gradientYMin",function(){return this._gradientYMin;}),$A(0,$m,"gradientYMax",function(){return this._gradientYMax;}),$A(0,$m,"gradientZMin",function(){return this._gradientZMin;}),$A(0,$m,"gradientZMax",function(){return this._gradientZMax;}),$Y.createByGradient=function($m){var $p=new $Y();return $p._type=0,$p._separateAxes=!1,$p._gradient=$m,$p;},$Y.createByGradientSeparate=function($m,$p,$h){var $P=new $Y();return $P._type=0,$P._separateAxes=!0,$P._gradientX=$m,$P._gradientY=$p,$P._gradientZ=$h,$P;},$Y.createByRandomTwoConstant=function($m,$p){var $h=new $Y();return $h._type=1,$h._separateAxes=!1,$h._constantMin=$m,$h._constantMax=$p,$h;},$Y.createByRandomTwoConstantSeparate=function($m,$p){var $h=new $Y();return $h._type=1,$h._separateAxes=!0,$h._constantMinSeparate=$m,$h._constantMaxSeparate=$p,$h;},$Y.createByRandomTwoGradient=function($m,$p){var $h=new $Y();return $h._type=2,$h._separateAxes=!1,$h._gradientMin=$m,$h._gradientMax=$p,$h;},$Y.createByRandomTwoGradientSeparate=function($m,$p,$h,$P,$L,$q){var $k=new $Y();return $k._type=2,$k._separateAxes=!0,$k._gradientXMin=$m,$k._gradientXMax=$p,$k._gradientYMin=$h,$k._gradientYMax=$P,$k._gradientZMin=$L,$k._gradientZMax=$q,$k;},$Y;}()),$z=function(){function $Y(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null;}$$($Y,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $m=$Y.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.cloneTo=function($m){var $p=$m;$p._type=this._type,this._constant.cloneTo($p._constant),this._gradientX.cloneTo($p._gradientX),this._gradientY.cloneTo($p._gradientY),this._gradientZ.cloneTo($p._gradientZ),this._constantMin.cloneTo($p._constantMin),this._constantMax.cloneTo($p._constantMax),this._gradientXMin.cloneTo($p._gradientXMin),this._gradientXMax.cloneTo($p._gradientXMax),this._gradientYMin.cloneTo($p._gradientYMin),this._gradientYMax.cloneTo($p._gradientYMax),this._gradientZMin.cloneTo($p._gradientZMin),this._gradientZMax.cloneTo($p._gradientZMax);},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$m,"gradientZ",function(){return this._gradientZ;}),$A(0,$m,"constant",function(){return this._constant;}),$A(0,$m,"type",function(){return this._type;}),$A(0,$m,"gradientXMax",function(){return this._gradientXMax;}),$A(0,$m,"constantMin",function(){return this._constantMin;}),$A(0,$m,"gradientX",function(){return this._gradientX;}),$A(0,$m,"gradientY",function(){return this._gradientY;}),$A(0,$m,"gradientXMin",function(){return this._gradientXMin;}),$A(0,$m,"constantMax",function(){return this._constantMax;}),$A(0,$m,"gradientYMin",function(){return this._gradientYMin;}),$A(0,$m,"gradientYMax",function(){return this._gradientYMax;}),$A(0,$m,"gradientZMin",function(){return this._gradientZMin;}),$A(0,$m,"gradientZMax",function(){return this._gradientZMax;}),$Y.createByConstant=function($m){var $p=new $Y();return $p._type=0,$p._constant=$m,$p;},$Y.createByGradient=function($m,$p,$h){var $P=new $Y();return $P._type=1,$P._gradientX=$m,$P._gradientY=$p,$P._gradientZ=$h,$P;},$Y.createByRandomTwoConstant=function($m,$p){var $h=new $Y();return $h._type=2,$h._constantMin=$m,$h._constantMax=$p,$h;},$Y.createByRandomTwoGradient=function($m,$p,$h,$P,$L,$q){var $k=new $Y();return $k._type=3,$k._gradientXMin=$m,$k._gradientXMax=$p,$k._gradientYMin=$h,$k._gradientYMax=$P,$k._gradientZMin=$L,$k._gradientZMax=$q,$k;},$Y;}(),$w=(function(){function $m($m){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$m;}$$($m,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($m){var $p=$m;this._angularVelocity.cloneTo($p._angularVelocity),$p.enbale=this.enbale;},$p.clone=function(){var $m;switch(this._angularVelocity.type){case 0:$m=this._angularVelocity.separateAxes?$_.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$_.createByConstant(this._angularVelocity.constant);break;case 1:$m=this._angularVelocity.separateAxes?$_.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$_.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$m=this._angularVelocity.separateAxes?$_.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$_.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$m=this._angularVelocity.separateAxes?$_.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$_.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone());}var $p=new this.constructor($m);return $p.enbale=this.enbale,$p;},$A(0,$p,"angularVelocity",function(){return this._angularVelocity;});}(),function(){function $m(){this.enable=!1,this.randomDirection=!1;}$$($m,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $p=$m.prototype;return $H.imps($p,{"laya.d3.core.IClone":!0}),$p._getShapeBoundBox=function($m){throw new Error("BaseShape: must override it.");},$p._getSpeedBoundBox=function($m){throw new Error("BaseShape: must override it.");},$p.generatePositionAndDirection=function($m,$p,$h,$P){throw new Error("BaseShape: must override it.");},$p._calculateProceduralBounds=function($m,$p,$h){this._getShapeBoundBox($m);var $P=$m.min,$L=$m.max;$kp.multiply($P,$p,$P),$kp.multiply($L,$p,$L);var $q=new $vm(new $kp(),new $kp());this.randomDirection?($q.min=new $kp(-1,-1,-1),$q.max=new $kp(1,1,1)):this._getSpeedBoundBox($q);var $k=new $vm(new $kp(),new $kp()),$Y=$k.min,$d=$k.max;$kp.scale($q.min,$h.y,$Y),$kp.scale($q.max,$h.y,$d),$kp.add($m.min,$Y,$Y),$kp.add($m.max,$d,$d),$kp.min($m.min,$Y,$m.min),$kp.max($m.max,$Y,$m.max);var $K=new $vm(new $kp(),new $kp()),$D=$K.min,$F=$K.max;$kp.scale($q.min,$h.x,$D),$kp.scale($q.max,$h.x,$F),$kp.min($K.min,$F,$Y),$kp.max($K.min,$F,$d),$kp.min($m.min,$Y,$m.min),$kp.max($m.max,$Y,$m.max);},$p.cloneTo=function($m){$m.enable=this.enable;},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$m;}()),$r=function(){function $q(){}return $$($q,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$q._randomPointUnitArcCircle=function($m,$p,$h){var $P=$p.elements,$L=NaN;$L=$h?$h.getFloat()*$m:Math.random()*$m,$P[0]=Math.cos($L),$P[1]=Math.sin($L);},$q._randomPointInsideUnitArcCircle=function($m,$p,$h){var $P=$p.elements;$q._randomPointUnitArcCircle($m,$p,$h);var $L=NaN;$L=$h?Math.pow($h.getFloat(),.5):Math.pow(Math.random(),.5),$P[0]=$P[0]*$L,$P[1]=$P[1]*$L;},$q._randomPointUnitCircle=function($m,$p){var $h=$m.elements,$P=NaN;$P=$p?$p.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$h[0]=Math.cos($P),$h[1]=Math.sin($P);},$q._randomPointInsideUnitCircle=function($m,$p){var $h=$m.elements;$q._randomPointUnitCircle($m);var $P=NaN;$P=$p?Math.pow($p.getFloat(),.5):Math.pow(Math.random(),.5),$h[0]=$h[0]*$P,$h[1]=$h[1]*$P;},$q._randomPointUnitSphere=function($m,$p){var $h=$m.elements,$P=NaN,$L=NaN;$L=$p?($P=$h[2]=2*$p.getFloat()-1,$p.getFloat()*Math.PI*2):($P=$h[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $q=Math.sqrt(1-$P*$P);$h[0]=$q*Math.cos($L),$h[1]=$q*Math.sin($L);},$q._randomPointInsideUnitSphere=function($m,$p){var $h=$m.elements;$q._randomPointUnitSphere($m);var $P=NaN;$P=$p?Math.pow($p.getFloat(),1/3):Math.pow(Math.random(),1/3),$h[0]=$h[0]*$P,$h[1]=$h[1]*$P,$h[2]=$h[2]*$P;},$q._randomPointInsideHalfUnitBox=function($m,$p){var $h=$m.elements;$p?($h[0]=$p.getFloat()-.5,$h[1]=$p.getFloat()-.5,$h[2]=$p.getFloat()-.5):($h[0]=Math.random()-.5,$h[1]=Math.random()-.5,$h[2]=Math.random()-.5);},$q;}(),$y=(function(){function $m($m){this._size=null,this.enbale=!1,this._size=$m;}$$($m,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($m){var $p=$m;this._size.cloneTo($p._size),$p.enbale=this.enbale;},$p.clone=function(){var $m;switch(this._size.type){case 0:$m=this._size.separateAxes?$J.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$J.createByGradient(this._size.gradient.clone());break;case 1:$m=this._size.separateAxes?$J.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$J.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$m=this._size.separateAxes?$J.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$J.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone());}var $p=new this.constructor($m);return $p.enbale=this.enbale,$p;},$A(0,$p,"size",function(){return this._size;});}(),function(){function $P(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN;}$$($P,"laya.d3.core.particleShuriKen.module.StartFrame");var $m=$P.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.cloneTo=function($m){var $p=$m;$p._type=this._type,$p._constant=this._constant,$p._constantMin=this._constantMin,$p._constantMax=this._constantMax;},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$m,"constant",function(){return this._constant;}),$A(0,$m,"type",function(){return this._type;}),$A(0,$m,"constantMin",function(){return this._constantMin;}),$A(0,$m,"constantMax",function(){return this._constantMax;}),$P.createByConstant=function($m){var $p=new $P();return $p._type=0,$p._constant=$m,$p;},$P.createByRandomTwoConstant=function($m,$p){var $h=new $P();return $h._type=1,$h._constantMin=$m,$h._constantMax=$p,$h;},$P;}()),$V=(function(){function $m($m,$p){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $qp(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$m,this._startFrame=$p;}$$($m,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($m){var $p=$m;this.tiles.cloneTo($p.tiles),$p.type=this.type,$p.randomRow=this.randomRow,this._frame.cloneTo($p._frame),this._startFrame.cloneTo($p._startFrame),$p.cycles=this.cycles,$p.enableUVChannels=this.enableUVChannels,$p.enable=this.enable;},$p.clone=function(){var $m,$p;switch(this._frame.type){case 0:$m=$S.createByConstant(this._frame.constant);break;case 1:$m=$S.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$m=$S.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$m=$S.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone());}switch(this._startFrame.type){case 0:$p=$y.createByConstant(this._startFrame.constant);break;case 1:$p=$y.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax);}var $h=new this.constructor($m,$p);return this.tiles.cloneTo($h.tiles),$h.type=this.type,$h.randomRow=this.randomRow,$h.cycles=this.cycles,$h.enableUVChannels=this.enableUVChannels,$h.enable=this.enable,$h;},$A(0,$p,"frame",function(){return this._frame;}),$A(0,$p,"startFrame",function(){return this._startFrame;});}(),function(){function $m($m){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$m;}$$($m,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $p=$m.prototype;$H.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($m){var $p=$m;this._velocity.cloneTo($p._velocity),$p.enbale=this.enbale,$p.space=this.space;},$p.clone=function(){var $m;switch(this._velocity.type){case 0:$m=$z.createByConstant(this._velocity.constant.clone());break;case 1:$m=$z.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$m=$z.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$m=$z.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone());}var $p=new this.constructor($m);return $p.enbale=this.enbale,$p.space=this.space,$p;},$A(0,$p,"velocity",function(){return this._velocity;});}(),function(){function $m(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $Rp(),this._vb=$wp.create($m._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$zp.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$lp.nameKey.getID("LINE"),this._shaderCompile=$Ip._preCompileShader[this._sharderNameID];}$$($m,"laya.d3.core.PhasorSpriter3D");var $p=$m.prototype;return $p.line=function($m,$p,$h,$P){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($m.x,$m.y,$m.z,$p.x,$p.y,$p.z,$p.w),this.addVertex($h.x,$h.y,$h.z,$P.x,$P.y,$P.z,$P.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this;},$p.circle=function($m,$p,$h,$P,$L,$q){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$p,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$p,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$m,Math.cos(this._tempNumver0)*$m,0,$h,$P,$L,$q),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this;},$p.plane=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$P/2,this._tempNumver1=$L/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($m-this._tempNumver0,$p+this._tempNumver1,$h,$q,$k,$Y,$d),this.addVertex($m+this._tempNumver0,$p+this._tempNumver1,$h,$q,$k,$Y,$d),this.addVertex($m-this._tempNumver0,$p-this._tempNumver1,$h,$q,$k,$Y,$d),this.addVertex($m+this._tempNumver0,$p-this._tempNumver1,$h,$q,$k,$Y,$d),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this;},$p.box=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$P/2,this._tempNumver1=$L/2,this._tempNumver2=$q/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($m-this._tempNumver0,$p+this._tempNumver1,$h+this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m+this._tempNumver0,$p+this._tempNumver1,$h+this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m-this._tempNumver0,$p-this._tempNumver1,$h+this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m+this._tempNumver0,$p-this._tempNumver1,$h+this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m+this._tempNumver0,$p+this._tempNumver1,$h-this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m-this._tempNumver0,$p+this._tempNumver1,$h-this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m+this._tempNumver0,$p-this._tempNumver1,$h-this._tempNumver2,$k,$Y,$d,$K),this.addVertex($m-this._tempNumver0,$p-this._tempNumver1,$h-this._tempNumver2,$k,$Y,$d,$K),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this;},$p.cone=function($m,$p,$h,$P,$L,$q,$k){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$h+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$h>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$h,this.addVertexIndex(0,$p,0,$P,$L,$q,$k,this._tempUint0),this.addVertexIndex(0,0,0,$P,$L,$q,$k,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$h;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($m*this._tempNumver2,0,$m*this._tempNumver3,$P,$L,$q,$k,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$h-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($m*this._tempNumver2,0,$m*this._tempNumver3,$P,$L,$q,$k,this._tempUint0+(this._tempInt0+$h)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$h-1?this.addIndexes(this._tempUint1+$h+2):this.addIndexes(this._tempUint1+this._tempInt0+$h+1),this.addIndexes(this._tempUint1+this._tempInt0+$h),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this;},$p.boundingBoxLine=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($m,$L,$q,$k,$Y,$d,$K),this.addVertex($P,$L,$q,$k,$Y,$d,$K),this.addVertex($m,$p,$q,$k,$Y,$d,$K),this.addVertex($P,$p,$q,$k,$Y,$d,$K),this.addVertex($P,$L,$h,$k,$Y,$d,$K),this.addVertex($m,$L,$h,$k,$Y,$d,$K),this.addVertex($P,$p,$h,$k,$Y,$d,$K),this.addVertex($m,$p,$h,$k,$Y,$d,$K),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this;},$p.addVertex=function($m,$p,$h,$P,$L,$q,$k){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$m,this._vbData[this._posInVBData+1]=$p,this._vbData[this._posInVBData+2]=$h,this._vbData[this._posInVBData+3]=$P,this._vbData[this._posInVBData+4]=$L,this._vbData[this._posInVBData+5]=$q,this._vbData[this._posInVBData+6]=$k,this._posInVBData+=this._floatSizePerVer,this;},$p.addVertexIndex=function($m,$p,$h,$P,$L,$q,$k,$Y){return this._hasBegun||this.addVertexIndexException(),this._vbData[$Y]=$m,this._vbData[$Y+1]=$p,this._vbData[$Y+2]=$h,this._vbData[$Y+3]=$P,this._vbData[$Y+4]=$L,this._vbData[$Y+5]=$q,this._vbData[$Y+6]=$k,($Y+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$Y),this;},$p.addIndexes=function($m){var $p=arguments;this._hasBegun||this.addVertexIndexException();for(var $h=0;$h<$p.length;$h++)this._ibData[this._posInIBData]=$p[$h],this._posInIBData++;return this;},$p.begin=function($m,$p){return this._hasBegun&&this.beginException0(),1!==$m&&4!==$m&&this.beginException1(),this._primitiveType=$m,this._camera=$p,this._hasBegun=!0,this;},$p.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this;},$p.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($m._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$I.drawCall++,$Q.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0);},$p.addVertexIndexException=function(){throw new Error("请先调用begin()函数");},$p.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！");},$p.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！");},$p.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！");},$p.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！");},$p.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！");},$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(28,[new $km(0,"vector3",0),new $km(12,"vector4",1)]);}]),$m;}()),$o=function(){function $m(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$m._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $Rp();}$$($m,"laya.d3.core.render.RenderElement");var $p=$m.prototype;return $p.getDynamicBatchBakedVertexs=function($m){for(var $p=this._renderObj._getVertexBuffer($m),$h=$p.getData().slice(),$P=$p.vertexDeclaration,$L=$P.getVertexElementByUsage(0).offset/4,$q=$P.getVertexElementByUsage(3).offset/4,$k=this._sprite3D.transform,$Y=$k.worldMatrix,$d=$k.rotation,$K=$P.vertexStride/4,$D=0,$F=$h.length;$D<$F;$D+=$K){var $R=$D+$L,$$=$D+$q;$np.transformVector3ArrayToVector3ArrayCoordinate($h,$R,$Y,$h,$R),$np.transformVector3ArrayByQuat($h,$$,$d,$h,$$);}return $h;},$p.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData();},$p._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this);},$A(0,$p,"id",function(){return this._id;}),$A(0,$p,"renderObj",function(){return this._renderObj;},function($m){this._renderObj!==$m&&(this._renderObj=$m);}),$m._uniqueIDCounter=0,$m;}(),$f=function(){function $p($m){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$p._uniqueIDCounter,this._needSort=!1,this._scene=$m,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={};}$$($p,"laya.d3.core.render.RenderQueue");var $m=$p.prototype;return $m._sortOpaqueFunc=function($m,$p){if($m._render&&$p._render){var $h=$m._material.renderQueue-$p._material.renderQueue;return 0==$h?$m._render._distanceForSort-$p._render._distanceForSort:$h;}return 0;},$m._sortAlphaFunc=function($m,$p){if($m._render&&$p._render){var $h=$m._material.renderQueue-$p._material.renderQueue;return 0==$h?$p._render._distanceForSort-$m._render._distanceForSort:$h;}return 0;},$m._begainRenderElement=function($m,$p,$h){return!!$p._beforeRender($m);},$m._sortAlpha=function($m){$p._cameraPosition=$m,this._finalElements.sort(this._sortAlphaFunc);},$m._sortOpaque=function($m){$p._cameraPosition=$m,this._finalElements.sort(this._sortOpaqueFunc);},$m._preRender=function($m){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements);},$m._render=function($m,$p){for(var $h,$P,$L,$q,$k,$Y,$d=$I.loopCount,$K=this._scene,$D=$m.camera,$F=($D.id,!1),$R=0,$$=this._finalElements.length;$R<$$;$R++){var $A,$B,$n,$c=this._finalElements[$R];if(null!=$c._onPreRenderFunction&&$c._onPreRenderFunction.call($c._sprite3D,$m),0===$c._type){if($m.owner=$n=$c._sprite3D,$m.renderElement=$c,$n._preRenderUpdateComponents($m),$A=$c.renderObj,$B=$c._material,this._begainRenderElement($m,$A,$B)){if($h=$A._getVertexBuffers(),!($L=($P=$A._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$P.id]){this._errorRecord[$P.id]=1;var $e="vertexBuffer:"+("("+$P._destroyed+","+$P._released+","+$P._referenceCount+","+$P._buffer+")")+", material:"+($B?$B.__className+"("+$B._destroyed+","+$B._released+")":"null")+", owner:"+($n?$n.__className+"("+$n._destroyed+","+$n._activeInHierarchy+","+$n._displayedInStage+")":"null")+", renderObj:"+($A?$A.__className+"("+$A._destroyed+","+$A._released+","+$A._referenceCount+")":"")+", parent:, url:"+($n?$n.url:"")+", disposeStack:"+$P.disposeStack;$H.recordError("报错：unknown vertexDeclaration  "+$e);}continue;}if($F=($q=$m._shader=$B._getShader($K._shaderDefineValue,$L.shaderDefineValue,$n._shaderDefineValue)).bind()||$d!==$q._uploadLoopCount,$h){if($q._uploadVertexBuffer!==$h||$F){for(var $a=0;$a<$h.length;$a++){var $Z=$h[$a];$q.uploadAttributesX($Z.vertexDeclaration.shaderValues.data,$Z);}$q._uploadVertexBuffer=$h;}}else($q._uploadVertexBuffer!==$P||$F)&&($q.uploadAttributes($L.shaderValues.data,null),$q._uploadVertexBuffer=$P);($q._uploadScene!==$K||$F)&&($q.uploadSceneUniforms($K._shaderValues.data),$q._uploadScene=$K),($D!==$q._uploadCamera||$q._uploadSprite3D!==$n||$F)&&($q.uploadSpriteUniforms($n._shaderValues.data),$q._uploadSprite3D=$n),($D!==$q._uploadCamera||$F)&&($q.uploadCameraUniforms($D._shaderValues.data),$q._uploadCamera=$D),($q._uploadMaterial!==$B||$F)&&($B._upload(),$q._uploadMaterial=$B),$k!==$B?($B._setRenderStateBlendDepth(),$B._setRenderStateFrontFace($p,$n.transform),$k=$B,$Y=$n):$Y!==$n&&($B._setRenderStateFrontFace($p,$n.transform),$Y=$n),$A._render($m),$q._uploadLoopCount=$d;}$n._postRenderUpdateComponents($m);}else if(2===$c._type){$c.renderObj;$m.owner=$n=$c._sprite3D,$m.renderElement=$c,$m._batchIndexStart=$c._tempBatchIndexStart,$m._batchIndexEnd=$c._tempBatchIndexEnd,$A=$c.renderObj,$B=$c._material,this._begainRenderElement($m,$A,$B)&&($L=($P=$A._getVertexBuffer(0)).vertexDeclaration,$F=($q=$m._shader=$B._getShader($K._shaderDefineValue,$L.shaderDefineValue,$n._shaderDefineValue)).bind()||$d!==$q._uploadLoopCount,($q._uploadVertexBuffer!==$P||$F)&&($q.uploadAttributes($L.shaderValues.data,null),$q._uploadVertexBuffer=$P),($q._uploadScene!==$K||$F)&&($q.uploadSceneUniforms($K._shaderValues.data),$q._uploadScene=$K),($D!==$q._uploadCamera||$q._uploadSprite3D!==$n||$F)&&($q.uploadSpriteUniforms($n._shaderValues.data),$q._uploadSprite3D=$n),($D!==$q._uploadCamera||$F)&&($q.uploadCameraUniforms($D._shaderValues.data),$q._uploadCamera=$D),($q._uploadMaterial!==$B||$F)&&($B._upload(),$q._uploadMaterial=$B),$k!==$B?($B._setRenderStateBlendDepth(),$B._setRenderStateFrontFace($p,$n.transform),$k=$B,$Y=$n):$Y!==$n&&($B._setRenderStateFrontFace($p,$n.transform),$Y=$n),$A._render($m),$q._uploadLoopCount=$d);}}},$m._renderShadow=function($m,$p){for(var $h,$P,$L,$q,$k,$Y=$I.loopCount,$d=this._scene,$K=$m.camera,$D=!1,$F=0,$R=this._finalElements.length;$F<$R;$F++){var $$,$A,$B,$n=this._finalElements[$F];0===$n._type&&($m.owner=$B=$n._sprite3D,$p||$B._projectionViewWorldUpdateCamera===$K&&$B._projectionViewWorldUpdateLoopCount===$I.loopCount||($B._render._renderUpdate($m._projectionViewMatrix),$B._projectionViewWorldUpdateLoopCount=$I.loopCount,$B._projectionViewWorldUpdateCamera=$K),$m.renderElement=$n,$B._preRenderUpdateComponents($m),$$=$n.renderObj,$A=$n._material,this._begainRenderElement($m,$$,null)&&($P=($h=$$._getVertexBuffer(0)).vertexDeclaration,$D=($L=$m._shader=$A._getShader($d._shaderDefineValue,$P.shaderDefineValue,$B._shaderDefineValue)).bind()||$Y!==$L._uploadLoopCount,($L._uploadVertexBuffer!==$h||$D)&&($L.uploadAttributes($P.shaderValues.data,null),$L._uploadVertexBuffer=$h),($K!==$L._uploadCamera||$L._uploadSprite3D!==$B||$D)&&($L.uploadSpriteUniforms($B._shaderValues.data),$L._uploadSprite3D=$B),($K!==$L._uploadCamera||$D)&&($L.uploadCameraUniforms($K._shaderValues.data),$L._uploadCamera=$K),($L._uploadMaterial!==$A||$D)&&($A._upload(),$L._uploadMaterial=$A),$L._uploadRenderElement,$q!==$A?($A._setRenderStateFrontFace(!1,$B.transform),$q=$A,$k=$B):$k!==$B&&($A._setRenderStateFrontFace(!1,$B.transform),$k=$B),$$._render($m),$L._uploadLoopCount=$Y),$B._postRenderUpdateComponents($m));}},$m._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0;},$m._addRenderElement=function($m){this._renderElements.push($m),this._needSort=!0;},$m._addDynamicBatchElement=function($m){this._dynamicBatchCombineRenderElements.push($m);},$A(0,$m,"id",function(){return this._id;}),$p._uniqueIDCounter=0,$p._cameraPosition=null,$p;}(),$i=function(){function $m(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null;}return $$($m,"laya.d3.core.render.RenderState"),$m.clientWidth=0,$m.clientHeight=0,$m;}(),$v=function(){function $k($m,$p){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $tm(new $kp(),0),this._corners=[new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp()],this._boundingBoxCenter=new $kp(),this._children=$P(8),this._objects=[],this._tempBoundBoxCorners=[new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp()],this._scene=$m,this._currentDepth=$p;}$$($k,"laya.d3.core.scene.OctreeNode");var $m=$k.prototype;return $H.imps($m,{"laya.d3.core.scene.ITreeNode":!0}),$m.init=function($m,$p){var $h=new $kp(),$P=new $kp();$kp.scale($p,-.5,$h),$kp.scale($p,.5,$P),$kp.add($h,$m,$h),$kp.add($P,$m,$P),this.exactBox=new $vm($h,$P),this.relaxBox=new $vm($h,$P);},$m.addTreeNode=function($m){1===Collision.boxContainsBox(this._relaxBox,$m.boundingBox)?this.addNodeDown($m,0):this.addObject($m);},$m.addChild=function($m){var $p=this._children[$m];if(null==$p){$p=new $k(this._scene,this._currentDepth+1),(this._children[$m]=$p)._parent=this,$kp.subtract(this._exactBox.max,this._exactBox.min,$k.tempSize),$kp.multiply($k.tempSize,$k._octreeSplit[$m],$k.tempCenter),$kp.add(this._exactBox.min,$k.tempCenter,$k.tempCenter),$kp.scale($k.tempSize,.25,$k.tempSize);var $h=new $kp(),$P=new $kp();$kp.subtract($k.tempCenter,$k.tempSize,$h),$kp.add($k.tempCenter,$k.tempSize,$P),$p.exactBox=new $vm($h,$P),$kp.scale($k.tempSize,$k.relax,$k.tempSize);var $L=new $kp(),$q=new $kp();$kp.subtract($k.tempCenter,$k.tempSize,$L),$kp.add($k.tempCenter,$k.tempSize,$q),$p.relaxBox=new $vm($L,$q);}return $p;},$m.addObject=function($m){($m._treeNode=this)._objects.push($m);},$m.removeObject=function($m){if($m._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $p=this._objects.indexOf($m);return-1!==$p&&(this._objects.splice($p,1),!0);},$m.clearObject=function(){this._objects.length=0;},$m.addNodeUp=function($m,$p){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$m.boundingBox)?this._parent.addNodeUp($m,$p-1):this.addNodeDown($m,$p);},$m.addNodeDown=function($m,$p){if($p<this._scene.treeLevel){var $h=this.inChildIndex($m.boundingBoxCenter),$P=this.addChild($h);1===Collision.boxContainsBox($P._relaxBox,$m.boundingBox)?$P.addNodeDown($m,++$p):this.addObject($m);}else this.addObject($m);},$m.inChildIndex=function($m){return 4*($m.z<this._boundingBoxCenter.z?0:1)+2*($m.y<this._boundingBoxCenter.y?0:1)+($m.x<this._boundingBoxCenter.x?0:1);},$m.updateObject=function($m){1===Collision.boxContainsBox(this._relaxBox,$m.boundingBox)?(this.removeObject($m),$m._treeNode=null,this.addNodeDown($m,this._currentDepth)):this._parent&&(this.removeObject($m),$m._treeNode=null,this._parent.addNodeUp($m,this._currentDepth-1));},$m.cullingObjects=function($m,$p,$h,$P,$L){var $q,$k=0,$Y=0,$d=0,$K=this._scene._dynamicBatchManager;for($k=0,$q=this._objects.length;$k<$q;$k++){var $D=this._objects[$k];if($N.isVisible($D._owner.layer.mask)&&$D.enable){if($p&&($I.treeSpriteCollision+=1,0===$m.containsBoundSphere($D.boundingSphere)))continue;$D._renderUpdate($L),$D._distanceForSort=$kp.distance($D.boundingSphere.center,$P)+$D.sortingFudge;var $F=$D._renderElements;for($Y=0,$d=$F.length;$Y<$d;$Y++){var $R=$F[$Y],$$=$R._staticBatch;if($$&&$$._material===$R._material)$$._addBatchRenderElement($R);else{var $A=$R.renderObj;$A.triangleCount<10&&1===$A._vertexBufferCount&&$A._getIndexBuffer()&&$R._material.renderQueue<2&&$R._canDynamicBatch&&!$D._owner.isStatic?$K._addPrepareRenderElement($R):this._scene.getRenderQueue($R._material.renderQueue)._addRenderElement($R);}}}}for($k=0;$k<8;$k++){var $B=this._children[$k];if(null!=$B){var $n=$p;if($p){var $c=$m.containsBoundBox($B._relaxBox);if($I.treeNodeCollision+=1,0===$c)continue;$n=2===$c;}$B.cullingObjects($m,$n,$h,$P,$L);}}},$m.cullingShadowObjects=function($m,$p,$h,$P,$L){var $q,$k=0,$Y=0,$d=0;this._scene._dynamicBatchManager;for($k=0,$q=this._objects.length;$k<$q;$k++){var $K=this._objects[$k];if($K.castShadow&&$N.isVisible($K._owner.layer.mask)&&$K.enable){if($h&&0===$m[0].containsBoundSphere($K.boundingSphere))continue;for(var $D=1,$F=$m.length;$D<$F;$D++){var $R=$p[$D-1];if(0!==$m[$D].containsBoundSphere($K.boundingSphere)){var $$=$K._renderElements;for($Y=0,$d=$$.length;$Y<$d;$Y++)$R._addRenderElement($$[$Y]);}}}}for($k=0;$k<8;$k++){var $A=this._children[$k];if(null!=$A){var $B=$h;if($h){var $n=$m[0].containsBoundBox($A._relaxBox);if(0===$n)continue;$B=2===$n;}$A.cullingShadowObjects($m,$p,$B,$P,$L);}}},$m.cullingShadowObjectsOnePSSM=function($m,$p,$h,$P,$L,$q){var $k,$Y=$p[0],$d=0,$K=0,$D=0;for($d=0,$k=this._objects.length;$d<$k;$d++){var $F=this._objects[$d];if($F.castShadow&&$N.isVisible($F._owner.layer.mask)&&$F.enable){if($P&&0===$m.containsBoundSphere($F.boundingSphere))continue;$F._renderUpdate($h);var $R=$F._renderElements;for($K=0,$D=$R.length;$K<$D;$K++)$Y._addRenderElement($R[$K]);}}for($d=0;$d<8;$d++){var $$=this._children[$d];if(null!=$$){var $A=$P;if($P){var $B=$m.containsBoundBox($$._relaxBox);if(0===$B)continue;$A=2===$B;}$$.cullingShadowObjectsOnePSSM($m,$p,$h,$A,$L,$q);}}},$m.renderBoudingBox=function($m){this._renderBoudingBox($m);for(var $p=0;$p<8;++$p){var $h=this._children[$p];$h&&$h.renderBoudingBox($m);}},$m.buildAllChild=function($m){if($m<this._scene.treeLevel)for(var $p=0;$p<8;$p++){this.addChild($p).buildAllChild($m+1);}},$m._renderBoudingBox=function($m){},$A(0,$m,"exactBox",function(){return this._exactBox;},function($m){this._exactBox=$m,$kp.add($m.min,$m.max,this._boundingBoxCenter),$kp.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter);}),$A(0,$m,"relaxBox",function(){return this._relaxBox;},function($m){(this._relaxBox=$m).getCorners(this._corners),$tm.createfromPoints(this._corners,this._boundingSphere);}),$k.debugMode=!1,$k.relax=1.15,$k.CHILDNUM=8,$F($k,["tempVector0",function(){return this.tempVector0=new $kp();},"tempSize",function(){return this.tempSize=new $kp();},"tempCenter",function(){return this.tempCenter=new $kp();},"_octreeSplit",function(){return this._octreeSplit=[new $kp(.25,.25,.25),new $kp(.75,.25,.25),new $kp(.25,.75,.25),new $kp(.75,.75,.25),new $kp(.25,.25,.75),new $kp(.75,.25,.75),new $kp(.25,.75,.75),new $kp(.75,.75,.75)];}]),$k;}(),$g=(function(){function $m(){}$$($m,"laya.d3.core.scene.SceneManager");}(),function(){function $m($m,$p,$h,$P){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$m&&($m=1),void 0===$p&&($p=1),void 0===$h&&($h=1),void 0===$P&&($P=1),this._r=$m,this._g=$p,this._b=$h,this._a=$P;}return $$($m,"laya.d3.core.trail.module.Color",null,"Color$1"),$m.prototype.cloneTo=function($m){$m._r=this._r,$m._g=this._g,$m._b=this._b,$m._a=this._a;},$F($m,["RED",function(){return this.RED=new $m(1,0,0,1);},"GREEN",function(){return this.GREEN=new $m(0,1,0,1);},"BLUE",function(){return this.BLUE=new $m(0,0,1,1);},"CYAN",function(){return this.CYAN=new $m(0,1,1,1);},"YELLOW",function(){return this.YELLOW=new $m(1,.92,.016,1);},"MAGENTA",function(){return this.MAGENTA=new $m(1,0,1,1);},"GRAY",function(){return this.GRAY=new $m(.5,.5,.5,1);},"WHITE",function(){return this.WHITE=new $m(1,1,1,1);},"BLACK",function(){return this.BLACK=new $m(0,0,0,1);}]),$m;}()),$t=(function(){function $m(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[];}$$($m,"laya.d3.core.trail.module.Gradient");var $p=$m.prototype;$p.setKeys=function($m,$p){var $h,$P;this._colorKeys=$m;for(var $L=this.index=0;$L<$m.length;$L++){var $q=($h=$m[$L]).color;this._colorKeyData[this.index++]=$q._r,this._colorKeyData[this.index++]=$q._g,this._colorKeyData[this.index++]=$q._b,this._colorKeyData[this.index++]=$h.time;}this._alphaKeys=$p;for(var $k=this.index=0;$k<$p.length;$k++)$P=$p[$k],this._alphaKeyData[this.index++]=$P.alpha,this._alphaKeyData[this.index++]=$P.time;},$p.cloneTo=function($m){var $p=0,$h=0,$P=this.colorKeys,$L=[];for($p=0,$h=$P.length;$p<$h;$p++){var $q=new $O();$P[$p].cloneTo($q),$L.push($q);}var $k=this.alphaKeys,$Y=[];for($p=0,$h=$k.length;$p<$h;$p++){var $d=new $t();$k[$p].cloneTo($d),$Y.push($d);}$m.setKeys($L,$Y);},$A(0,$p,"mode",function(){return this._mode;},function($m){this._mode=$m;}),$A(0,$p,"colorKeys",function(){return this._colorKeys;},function($m){this._colorKeys=$m;for(var $p=this.index=0;$p<$m.length;$p++){var $h=$m[$p],$P=$h.color;this._colorKeyData[this.index++]=$P._r,this._colorKeyData[this.index++]=$P._g,this._colorKeyData[this.index++]=$P._b,this._colorKeyData[this.index++]=$h.time;}}),$A(0,$p,"alphaKeys",function(){return this._alphaKeys;},function($m){this._alphaKeys=$m;for(var $p=this.index=0;$p<$m.length;$p++){var $h=$m[$p];this._alphaKeyData[this.index++]=$h.alpha,this._alphaKeyData[this.index++]=$h.time;}});}(),function(){function $m($m,$p){this._alpha=NaN,this._time=NaN,void 0===$m&&($m=0),void 0===$p&&($p=0),this._alpha=$m,this._time=$p;}$$($m,"laya.d3.core.trail.module.GradientAlphaKey");var $p=$m.prototype;return $p.cloneTo=function($m){$m.alpha=this.alpha,$m.time=this.time;},$A(0,$p,"alpha",function(){return this._alpha;},function($m){this._alpha=$m;}),$A(0,$p,"time",function(){return this._time;},function($m){this._time=$m;}),$m;}()),$O=function(){function $m($m,$p){this._color=null,this._time=NaN,void 0===$p&&($p=0),this._color=$m||new $g(),this._time=$p;}$$($m,"laya.d3.core.trail.module.GradientColorKey");var $p=$m.prototype;return $p.cloneTo=function($m){this.color.cloneTo($m.color),$m.time=this.time;},$A(0,$p,"color",function(){return this._color;},function($m){this._color=$m;}),$A(0,$p,"time",function(){return this._time;},function($m){this._time=$m;}),$m;}(),$C=(function(){function $m(){}$$($m,"laya.d3.core.trail.module.GradientMode"),$m.Blend=0,$m.Fixed=1;}(),function(){function $m(){}$$($m,"laya.d3.core.trail.module.TextureMode"),$m.Stretch=0,$m.Tile=1;}(),function(){function $m(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN;}$$($m,"laya.d3.core.trail.module.TrailKeyFrame"),$m.prototype.cloneTo=function($m){$m.time=this.time,$m.inTangent=this.inTangent,$m.outTangent=this.outTangent,$m.value=this.value;};}(),function(){function $p($m){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $kp(),this._curPosition=new $kp(),this._delVector3=new $kp(),this._lastFixedVertexPosition=new $kp(),this._pointAtoBVector3=new $kp(),this._pointA=new $kp(),this._pointB=new $kp(),this._owner=$m,this._id=$p.renderElementCount++,0==this._id?$m._owner.transform.position.cloneTo(this._lastPosition):$m._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $wp($C.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $wp($C.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2);}$$($p,"laya.d3.core.trail.TrailRenderElement");var $m=$p.prototype;$H.imps($m,{"laya.d3.core.render.IRenderable":!0}),$m._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1);},$m._addTrailByFirstPosition=function($m,$p){$kp.subtract($p,$m,this._delVector3),$kp.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$kp.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$kp.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($m),$m.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0;},$m._addTrailByNextPosition=function($m){$kp.subtract($m,this._lastFixedVertexPosition,this._delVector3),$kp.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$kp.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$kp.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$kp.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$Om.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($m),$m.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($m),this._virtualVerticesCount=2);},$m._updateVerticesByPosition=function($m){this._pointe=$m.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0;},$m._updateVertexBuffer2=function(){var $m,$p=0,$h=0,$P=0;for($P=0,$m=(this._verticesCount+this._virtualVerticesCount)/2;$P<$m;$P++)$h=0==this._owner.textureMode?(this._VerticesToTailLength[$P]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$P],this._vertices2[$p++]=1-$h,this._vertices2[$p++]=1-$h;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount);},$m._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0;},$m._updateDisappear=function(){var $m,$p=0;for($p=this._curDisappearIndex,$m=(this._verticesCount+this._virtualVerticesCount)/2;$p<$m;$p++)this._owner._curtime-this._everyGroupVertexBirthTime[$p]>=this._owner.time+$Om.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0));},$m._beforeRender=function($m){return this._camera=$m.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$kp.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0));},$m._render=function($m){this._isDead||($Q.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$I.drawCall++,$I.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2);},$m._getVertexBuffer=function($m){return void 0===$m&&($m=0),0===$m?this._vertexBuffer1:1===$m?this._vertexBuffer2:null;},$m._getVertexBuffers=function(){return this._vertexBuffers;},$m._getIndexBuffer=function(){return null;},$m.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition);},$m._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null;},$A(0,$m,"_vertexBufferCount",function(){return this._vertexBuffers.length;}),$A(0,$m,"triangleCount",function(){return 0;}),$p.renderElementCount=0;}(),function(){function $m(){}$$($m,"laya.d3.core.trail.VertexTrail");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration1;}),$A(1,$m,"vertexDeclaration1",function(){return $m._vertexDeclaration1;}),$A(1,$m,"vertexDeclaration2",function(){return $m._vertexDeclaration2;}),$F($m,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $qm(32,[new $km(0,"vector3",0),new $km(12,"vector3",41),new $km(24,"single",33),new $km(28,"single",40)]);},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $qm(4,[new $km(0,"single",38)]);}]),$m;}()),$mm=function(){function $Z($m){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$m;}$$($Z,"laya.d3.graphics.DynamicBatch");var $m=$Z.prototype;return $H.imps($m,{"laya.d3.core.render.IRenderable":!0}),$m._getVertexBuffer=function($m){return void 0===$m&&($m=0),0===$m?this._vertexBuffer:null;},$m._getIndexBuffer=function(){return this._indexBuffer;},$m._getCombineRenderElementFromPool=function($m,$p,$h){var $P=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $P||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$P=new $o(),$P._sprite3D=new $fp()),$P._sprite3D._render._renderUpdate($h),$P;},$m._getRenderElement=function($m,$p,$h){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$Z.maxVertexCount),this._indexDatas=new Uint16Array($Z.maxIndexCount),this._vertexBuffer=$wp.create(this._vertexDeclaration,$Z.maxVertexCount,35048),this._indexBuffer=$zp.create("ushort",$Z.maxIndexCount,35048));for(var $P=this._merageElements.length=0,$L=0,$q=0,$k=this._combineRenderElements.length;$q<$k;$q++){var $Y=this._combineRenderElements[$q],$d=$Y.getDynamicBatchBakedVertexs(0),$K=$Y.getBakedIndices(),$D=$Y._sprite3D.transform._isFrontFaceInvert,$F=$P/(this._vertexDeclaration.vertexStride/4),$R=$L,$$=$R+$K.length;$Y._tempBatchIndexStart=$R,$Y._tempBatchIndexEnd=$$,this._indexDatas.set($K,$L);var $A=0;if($D)for($A=$R;$A<$$;$A+=3){this._indexDatas[$A]=$F+this._indexDatas[$A];var $B=this._indexDatas[$A+1],$n=this._indexDatas[$A+2];this._indexDatas[$A+1]=$F+$n,this._indexDatas[$A+2]=$F+$B;}else for($A=$R;$A<$$;$A+=3)this._indexDatas[$A]=$F+this._indexDatas[$A],this._indexDatas[$A+1]=$F+this._indexDatas[$A+1],this._indexDatas[$A+2]=$F+this._indexDatas[$A+2];$L+=$K.length,this._vertexDatas.set($d,$P),$P+=$d.length;}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$q=this._combineRenderElementPoolIndex=0,$k=this._materials.length;$q<$k;$q++){var $c=this._getCombineRenderElementFromPool($m,$p,$h);$c._type=2,$c._staticBatch=null;var $e=($c.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$q]]._tempBatchIndexStart,$a=$q+1===this._materialToRenderElementsOffsets.length?$L:this._combineRenderElements[this._materialToRenderElementsOffsets[$q+1]]._tempBatchIndexStart;$c._tempBatchIndexStart=$e,$c._tempBatchIndexEnd=$a,$c._material=this._materials[$q],this._merageElements.push($c);}},$m._addCombineRenderObjTest=function($m){var $p=$m.renderObj,$h=this._currentCombineIndexCount+$p._getIndexBuffer().indexCount,$P=this._currentCombineVertexCount+$p._getVertexBuffer().vertexCount;return!($Z.maxVertexCount<$P||$Z.maxIndexCount<$h);},$m._addCombineRenderObj=function($m){var $p=$m.renderObj;this._combineRenderElements.push($m),this._currentCombineIndexCount=this._currentCombineIndexCount+$p._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$p._getVertexBuffer().vertexCount;},$m._addCombineMaterial=function($m){this._materials.push($m);},$m._addMaterialToRenderElementOffset=function($m){this._materialToRenderElementsOffsets.push($m);},$m._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0;},$m._addToRenderQueue=function($m,$p,$h,$P){this._getRenderElement($p,$h,$P);for(var $L=0,$q=this._materials.length;$L<$q;$L++)$m.getRenderQueue(this._materials[$L].renderQueue)._addDynamicBatchElement(this._merageElements[$L]);},$m._beforeRender=function($m){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0;},$m._render=function($m){var $p=$m._batchIndexEnd-$m._batchIndexStart;$Q.mainContext.drawElements(4,$p,5123,2*$m._batchIndexStart),$I.drawCall++,$I.trianglesFaces+=$p/3;},$m._getVertexBuffers=function(){return null;},$A(0,$m,"_vertexBufferCount",function(){return 1;}),$A(0,$m,"triangleCount",function(){return this._indexBuffer.indexCount/3;}),$A(0,$m,"combineRenderElementsCount",function(){return this._combineRenderElements.length;}),$Z.maxVertexCount=2e4,$Z.maxIndexCount=4e4,$Z.maxCombineTriangleCount=10,$Z;}(),$pm=function(){function $Z(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[];}$$($Z,"laya.d3.graphics.DynamicBatchManager");var $m=$Z.prototype;return $m.getDynamicBatch=function($m,$p){var $h,$P=$m.id.toString()+$p;return this._dynamicBatches[$P]?$h=this._dynamicBatches[$P]:this._dynamicBatches[$P]=$h=new $mm($m),$h;},$m._garbageCollection=function(){for(var $m in this._dynamicBatches)0===this._dynamicBatches[$m].combineRenderElementsCount&&delete this._dynamicBatches[$m];},$m._addPrepareRenderElement=function($m){this._prepareDynamicBatchCombineElements.push($m);},$m._finishCombineDynamicBatch=function($m){var $p,$h,$P;this._prepareDynamicBatchCombineElements.sort($Z._sortPrepareDynamicBatch);for(var $L,$q,$k,$Y,$d,$K=-1,$D=!0,$F=0,$R=-1,$$=0,$A=this._prepareDynamicBatchCombineElements.length;$$<$A;$$++){var $B=($q=this._prepareDynamicBatchCombineElements[$$]).renderObj._getVertexBuffer(0).vertexDeclaration,$n=$h!==$B;$n&&($F=0,$h=$B);var $c=$F!==$K;if($c&&($K=$F),($n||$c)&&($k=this.getDynamicBatch($B,$F),$p=null),$D){if($k._addCombineRenderObjTest($q)){if($p!==($L=$q._material))$Y&&($m.getRenderQueue($d._material.renderQueue)._addRenderElement($d),$d=$Y=null,$R=-1),$Y=$L,$R=$k.combineRenderElementsCount,$d=$q,$p=$L;else if($Y){var $e=$d.renderObj,$a=$q.renderObj;$e._getVertexBuffer().vertexCount+$a._getVertexBuffer().vertexCount>$mm.maxVertexCount||$e._getIndexBuffer().indexCount+$a._getIndexBuffer().indexCount>$mm.maxIndexCount?($m.getRenderQueue($d._material.renderQueue)._addRenderElement($d),$Y=$L,$R=$k.combineRenderElementsCount,$d=$q):($k._addCombineMaterial($Y),$k._addMaterialToRenderElementOffset($R),$k._addCombineRenderObj($d),$d=$Y=null,$R=-1,$k._addCombineRenderObj($q));}else $k._addCombineRenderObj($q);$D=!0;}else $Y&&($m.getRenderQueue($d._material.renderQueue)._addRenderElement($d),$d=$Y=null,$R=-1),$F++,$D=!1;}else $P=this._prepareDynamicBatchCombineElements[$$-1],$k._addMaterialToRenderElementOffset($k.combineRenderElementsCount),$p=$P._material,$k._addCombineMaterial($p),$k._addCombineRenderObj($P),$D=!0,$p!==($L=$q._material)?($Y=$L,$R=$k.combineRenderElementsCount,$d=$q):$k._addCombineRenderObj($q),$p=$L;}$Y&&($m.getRenderQueue($d._material.renderQueue)._addRenderElement($d),$d=$Y=null,$R=-1),this._prepareDynamicBatchCombineElements.length=0;},$m._clearRenderElements=function(){for(var $m in this._dynamicBatches)this._dynamicBatches[$m]._clearRenderElements();},$m._addToRenderQueue=function($m,$p,$h,$P){for(var $L in this._dynamicBatches){var $q=this._dynamicBatches[$L];0<$q.combineRenderElementsCount&&$q._addToRenderQueue($m,$p,$h,$P);}},$m.dispose=function(){this._dynamicBatches=null;},$Z._sortPrepareDynamicBatch=function($m,$p){return $m._mainSortID-$p._mainSortID;},$Z;}(),$hm=function(){function $m(){}return $$($m,"laya.d3.graphics.FrustumCulling"),$m.renderShadowObjectCulling=function($m,$p,$h,$P,$L){var $q=0,$k=0,$Y=0,$d=0;for($q=0,$Y=$h.length;$q<$Y;$q++){var $K=$h[$q];$K&&$K._clearRenderElements();}var $D,$F,$R,$$=$m._cullingRenders;if(1<$L){for($q=0,$Y=$m._cullingRendersLength;$q<$Y;$q++)if(($D=$$[$q]).castShadow&&$N.isVisible($D._owner.layer.mask)&&$D.enable)for(var $A=1,$B=$p.length;$A<$B;$A++)if($F=$h[$A-1],0!==$p[$A].containsBoundSphere($D.boundingSphere))for($k=0,$d=($R=$D._renderElements).length;$k<$d;$k++)$F._addRenderElement($R[$k]);}else for($q=0,$Y=$m._cullingRendersLength;$q<$Y;$q++)if(($D=$$[$q]).castShadow&&$N.isVisible($D._owner.layer.mask)&&$D.enable&&0!==$p[0].containsBoundSphere($D.boundingSphere))for($D._renderUpdate($P),$F=$h[0],$k=0,$d=($R=$D._renderElements).length;$k<$d;$k++)$F._addRenderElement($R[$k]);},$m.renderShadowObjectCullingOctree=function($m,$p,$h,$P,$L){for(var $q=0,$k=$h.length;$q<$k;$q++){var $Y=$h[$q];$Y&&$Y._clearRenderElements();}1<$L?$m.treeRoot.cullingShadowObjects($p,$h,!0,0,$m):$m.treeRoot.cullingShadowObjectsOnePSSM($p[0],$h,$P,!0,0,$m);},$m.renderObjectCulling=function($m,$p,$h,$P,$L,$q){var $k=0,$Y=0,$d=0,$K=0,$D=$p._quenes,$F=$p._dynamicBatchManager,$R=$p._cullingRenders;for($k=0,$Y=$D.length;$k<$Y;$k++){var $$=$D[$k];$$&&$$._clearRenderElements();}var $A=$Pm._staticBatchManagers;for($k=0,$Y=$A.length;$k<$Y;$k++)$A[$k]._clearRenderElements();$F._clearRenderElements();var $B=$h.transform.position;for($k=0,$Y=$p._cullingRendersLength;$k<$Y;$k++){var $n=$R[$k];if($N.isVisible($n._owner.layer.mask)&&$n.enable&&0!==$m.containsBoundSphere($n.boundingSphere)&&$n._renderUpdate($q)){$n._distanceForSort=$kp.distance($n.boundingSphere.center,$B)+$n.sortingFudge;var $c=$n._renderElements;for($d=0,$K=$c.length;$d<$K;$d++){var $e=$c[$d],$a=$e._staticBatch;if($a&&$a._material===$e._material)$a._addBatchRenderElement($e);else{var $Z=$e.renderObj;$Z.triangleCount<10&&1===$Z._vertexBufferCount&&$Z._getIndexBuffer()&&$e._material.renderQueue<2&&$e._canDynamicBatch&&!$n._owner.isStatic?$F._addPrepareRenderElement($e):$p.getRenderQueue($e._material.renderQueue)._addRenderElement($e);}}}}for($k=0,$Y=$A.length;$k<$Y;$k++)$A[$k]._addToRenderQueue($p,$P,$L,$q);$F._finishCombineDynamicBatch($p),$F._addToRenderQueue($p,$P,$L,$q);},$m.renderObjectCullingOctree=function($m,$p,$h,$P,$L,$q){var $k=0,$Y=0,$d=$p._quenes,$K=$p._dynamicBatchManager;for($k=0,$Y=$d.length;$k<$Y;$k++){var $D=$d[$k];$D&&$D._clearRenderElements();}var $F=$Pm._staticBatchManagers;for($k=0,$Y=$F.length;$k<$Y;$k++)$F[$k]._clearRenderElements();for($K._clearRenderElements(),$p._cullingRenders.length=0,$p.treeRoot.cullingObjects($m,!0,0,$h.transform.position,$q),$k=0,$Y=$F.length;$k<$Y;$k++)$F[$k]._addToRenderQueue($p,$P,$L,$q);$K._finishCombineDynamicBatch($p),$K._addToRenderQueue($p,$P,$L,$q);},$m.renderObjectCullingNoBoundFrustum=function($m,$p,$h,$P,$L){var $q=0,$k=0,$Y=0,$d=0,$K=$m._quenes,$D=$m._dynamicBatchManager,$F=$m._cullingRenders;for($q=0,$k=$K.length;$q<$k;$q++){var $R=$K[$q];$R&&$R._clearRenderElements();}var $$=$Pm._staticBatchManagers;for($q=0,$k=$$.length;$q<$k;$q++)$$[$q]._clearRenderElements();$D._clearRenderElements();var $A=$p.transform.position;for($q=0,$k=$m._cullingRendersLength;$q<$k;$q++){var $B=$F[$q];if($N.isVisible($B._owner.layer.mask)&&$B.enable){$B._renderUpdate($L),$B._distanceForSort=$kp.distance($B.boundingSphere.center,$A)+$B.sortingFudge;var $n=$B._renderElements;for($Y=0,$d=$n.length;$Y<$d;$Y++){var $c=$n[$Y],$e=$c._staticBatch;if($e&&$e._material===$c._material)$e._addBatchRenderElement($c);else{var $a=$c.renderObj;$a.triangleCount<10&&1===$a._vertexBufferCount&&$a._getIndexBuffer()&&$c._material.renderQueue<2&&$c._canDynamicBatch&&!$B._owner.isStatic?$D._addPrepareRenderElement($c):$m.getRenderQueue($c._material.renderQueue)._addRenderElement($c);}}}}for($q=0,$k=$$.length;$q<$k;$q++)$$[$q]._addToRenderQueue($m,$h,$P,$L);$D._finishCombineDynamicBatch($m),$D._addToRenderQueue($m,$h,$P,$L);},$m;}(),$Pm=function(){function $q(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={};}$$($q,"laya.d3.graphics.StaticBatchManager");var $m=$q.prototype;return $m._finishInit=function(){for(var $m in this._staticBatches)this._staticBatches[$m]._finishInit();this._initBatchRenderElements.length=0;},$m._initStaticBatchs=function($m){throw new Error("StaticBatchManager:must override this function.");},$m._addInitBatchSprite=function($m){for(var $p=$m._render._renderElements,$h=0,$P=$p.length;$h<$P;$h++)this._initBatchRenderElements.push($p[$h]);},$m._clearRenderElements=function(){for(var $m in this._staticBatches)this._staticBatches[$m]._clearRenderElements();},$m._garbageCollection=function($m){var $p=$m._staticBatch,$h=$p._initBatchRenderElements,$P=$h.indexOf($m);$h.splice($P,1),0===$h.length&&($p.dispose(),delete this._staticBatches[$p._key]);},$m._addToRenderQueue=function($m,$p,$h,$P){for(var $L in this._staticBatches){var $q=this._staticBatches[$L];0<$q._batchRenderElements.length&&$q._updateToRenderQueue($m,$P);}},$m.dispose=function(){this._staticBatches=null;},$q._addToStaticBatchQueue=function($m){$m instanceof laya.d3.core.RenderableSprite3D&&$m._addToInitStaticBatchManager();for(var $p=0,$h=$m.numChildren;$p<$h;$p++)$q._addToStaticBatchQueue($m._childs[$p]);},$q.combine=function($m,$p){var $h,$P=0,$L=0;if($p)for($P=0,$L=$p.length;$P<$L;$P++){$p[$P]._addToInitStaticBatchManager();}else $m&&$q._addToStaticBatchQueue($m);for($P=0,$L=$q._staticBatchManagers.length;$P<$L;$P++)($h=$q._staticBatchManagers[$P])._initStaticBatchs($m),$h._finishInit();},$q._staticBatchManagers=[],$q;}(),$Lm=function(){function $m($m,$p,$h){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$m,this._manager=$p,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$h;}$$($m,"laya.d3.graphics.StaticBatch");var $p=$m.prototype;return $H.imps($p,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$p._binarySearch=function($m){for(var $p=0,$h=this._batchRenderElements.length-1,$P=0;$p<=$h;)$P=Math.floor(($p+$h)/2),this._compareBatchRenderElement(this._batchRenderElements[$P],$m)?$h=$P-1:$p=$P+1;return $p;},$p._compareBatchRenderElement=function($m,$p){throw new Error("StaticBatch:must override this function.");},$p._getVertexDecLightMap=function($m){return $m===$zm.vertexDeclaration?$Nm.vertexDeclaration:$m===$Jm.vertexDeclaration?$um.vertexDeclaration:$m===$bm.vertexDeclaration?$Zm.vertexDeclaration:$m===$Gm.vertexDeclaration?null:$m===$Bm.vertexDeclaration?$nm.vertexDeclaration:$m===$Xm.vertexDeclaration?$_m.vertexDeclaration:$m===$Qm.vertexDeclaration?$Mm.vertexDeclaration:$m===$wm.vertexDeclaration?$Sm.vertexDeclaration:$m===$Jm.vertexDeclaration?$um.vertexDeclaration:$m===$Tm.vertexDeclaration?$Hm.vertexDeclaration:$m===$Gm.vertexDeclaration?null:$m===$Bm.vertexDeclaration?$nm.vertexDeclaration:$m===$sm.vertexDeclaration?$lm.vertexDeclaration:$m===$Qm.vertexDeclaration?$Mm.vertexDeclaration:$m;},$p._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.");},$p._addBatchRenderElement=function($m){this._batchRenderElements.splice(this._binarySearch($m),0,$m);},$p._updateToRenderQueue=function($m,$p){this._combineRenderElementPoolIndex=0,this._getRenderElement($m.getRenderQueue(this._material.renderQueue)._renderElements,$m,$p);},$p._getRenderElement=function($m,$p,$h){throw new Error("StaticBatch:must override this function.");},$p._finishInit=function(){throw new Error("StaticBatch:must override this function.");},$p._clearRenderElements=function(){this._batchRenderElements.length=0;},$p.dispose=function(){},$p._getVertexBuffer=function($m){return void 0===$m&&($m=0),null;},$p._getIndexBuffer=function(){return null;},$p._beforeRender=function($m){return!0;},$p._render=function($m){},$p._getVertexBuffers=function(){return null;},$A(0,$p,"_vertexBufferCount",function(){return 1;}),$A(0,$p,"triangleCount",function(){return 0;}),$m.combine=function($m){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$Pm.combine($m);},$m.maxBatchVertexCount=65535,$m;}(),$qm=function(){function $k($m,$p){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$k._uniqueIDCounter,this._id>$k.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$k.maxVertexDeclaration);this._shaderValues=new $Rp(),this._vertexElementsDic={},this._vertexStride=$m,this._vertexElements=$p;for(var $h=0;$h<$p.length;$h++){var $P=$p[$h],$L=$P.elementUsage;this._vertexElementsDic[$L]=$P;var $q=[$k._getTypeSize($P.elementFormat)/4,5126,!1,this._vertexStride,$P.offset];switch(this._shaderValues.setValue($L,$q),$L){case 1:this._addShaderDefine($Ip.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($Ip.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($Ip.SHADERDEFINE_UV1);}}}$$($k,"laya.d3.graphics.VertexDeclaration");var $m=$k.prototype;return $m._addShaderDefine=function($m){this._shaderDefineValue|=$m;},$m._removeShaderDefine=function($m){this._shaderDefineValue&=~$m;},$m.getVertexElements=function(){return this._vertexElements.slice();},$m.getVertexElementByUsage=function($m){return this._vertexElementsDic[$m];},$m.unBinding=function(){},$A(0,$m,"shaderDefineValue",function(){return this._shaderDefineValue;}),$A(0,$m,"id",function(){return this._id;}),$A(0,$m,"vertexStride",function(){return this._vertexStride;}),$A(0,$m,"shaderValues",function(){return this._shaderValues;}),$k._getTypeSize=function($m){switch($m){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8;}return 0;},$k.getVertexStride=function($m){for(var $p=0,$h=0;$h<$m.Length;$h++){var $P=$m[$h],$L=$P.offset+$k._getTypeSize($P.elementFormat);$p<$L&&($p=$L);}return $p;},$k._maxVertexDeclarationBit=1e3,$k._uniqueIDCounter=1,$F($k,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647);}]),$k;}(),$km=function(){function $m($m,$p,$h){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$m,this.elementFormat=$p,this.elementUsage=$h;}return $$($m,"laya.d3.graphics.VertexElement"),$m;}(),$Ym=(function(){function $m(){}$$($m,"laya.d3.graphics.VertexElementFormat"),$m.Single="single",$m.Vector2="vector2",$m.Vector3="vector3",$m.Vector4="vector4",$m.Color="color",$m.Byte4="byte4",$m.Short2="short2",$m.Short4="short4",$m.NormalizedShort2="normalizedshort2",$m.NormalizedShort4="normalizedshort4",$m.HalfVector2="halfvector2",$m.HalfVector4="halfvector4";}(),function(){function $m(){}$$($m,"laya.d3.graphics.VertexElementUsage"),$m.POSITION0=0,$m.COLOR0=1,$m.TEXTURECOORDINATE0=2,$m.NORMAL0=3,$m.BINORMAL0=4,$m.TANGENT0=5,$m.BLENDINDICES0=6,$m.BLENDWEIGHT0=7,$m.DEPTH0=8,$m.FOG0=9,$m.POINTSIZE0=10,$m.SAMPLE0=11,$m.TESSELLATEFACTOR0=12,$m.COLOR1=13,$m.NEXTTEXTURECOORDINATE0=14,$m.TEXTURECOORDINATE1=15,$m.NEXTTEXTURECOORDINATE1=16,$m.CORNERTEXTURECOORDINATE0=17,$m.VELOCITY0=18,$m.STARTCOLOR0=19,$m.STARTSIZE=20,$m.AGEADDSCALE0=21,$m.STARTROTATION=22,$m.ENDCOLOR0=23,$m.STARTLIFETIME=24,$m.TIME0=33,$m.SHAPEPOSITIONSTARTLIFETIME=30,$m.DIRECTIONTIME=32,$m.SIZEROTATION0=27,$m.RADIUS0=28,$m.RADIAN0=29,$m.STARTSPEED=31,$m.RANDOM0=34,$m.RANDOM1=35,$m.SIMULATIONWORLDPOSTION=36,$m.SIMULATIONWORLDROTATION=37,$m.TEXTURECOORDINATE0X=38,$m.TEXTURECOORDINATE0X1=39,$m.TEXTURECOORDINATE0Y=40,$m.OFFSETVECTOR=41;}(),function(){function $m($m,$p,$h){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$m,this._textureCoordinate0=$p,this._time=$h;}$$($m,"laya.d3.graphics.VertexGlitter");var $p=$m.prototype;$H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate0;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"time",function(){return this._time;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(24,[new $km(0,"vector3",0),new $km(12,"vector2",2),new $km(20,"single",33)]);}]);}(),function(){function $m($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$m,this._position=$p,this._velocity=$h,this._startColor=$P,this._endColor=$L,this._sizeRotation=$q,this._radius=$k,this._radian=$Y,this._ageAddScale=$d,this._time=$K;}$$($m,"laya.d3.graphics.VertexParticle");var $p=$m.prototype;$H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"endColor",function(){return this._endColor;}),$A(0,$p,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate;}),$A(0,$p,"sizeRotation",function(){return this._sizeRotation;}),$A(0,$p,"velocity",function(){return this._velocity;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"startColor",function(){return this._startColor;}),$A(0,$p,"radius",function(){return this._radius;}),$A(0,$p,"radian",function(){return this._radian;}),$A(0,$p,"ageAddScale",function(){return this._ageAddScale;}),$A(0,$p,"time",function(){return this._time;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(116,[new $km(0,"vector4",17),new $km(16,"vector3",0),new $km(28,"vector3",18),new $km(40,"vector4",19),new $km(56,"vector4",23),new $km(72,"vector3",27),new $km(84,"vector2",28),new $km(92,"vector4",29),new $km(108,"single",24),new $km(112,"single",33)]);}]);}(),function(){function $m($m){this._position=null,this._position=$m;}$$($m,"laya.d3.graphics.VertexPosition");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(12,[new $km(0,"vector3",0)]);}]),$m;}()),$dm=function(){function $m($m,$p){this._position=null,this._normal=null,this._position=$m,this._normal=$p;}$$($m,"laya.d3.graphics.VertexPositionNormal");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(24,[new $km(0,"vector3",0),new $km(12,"vector3",3)]);}]),$m;}(),$Km=function(){function $m($m,$p,$h){this._position=null,this._normal=null,this._color=null,this._position=$m,this._normal=$p,this._color=$h;}$$($m,"laya.d3.graphics.VertexPositionNormalColor");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(40,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1)]);}]),$m;}(),$Dm=function(){function $m($m,$p,$h,$P,$L){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$m,this._normal=$p,this._color=$h,this._blendIndex=$P,this._blendWeight=$L;}$$($m,"laya.d3.graphics.VertexPositionNormalColorSkin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(72,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector4",7),new $km(56,"vector4",6)]);}]),$m;}(),$Fm=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._tangent=$P,this._blendIndex=$L,this._blendWeight=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(88,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector4",7),new $km(56,"vector4",6),new $km(72,"vector4",5)]);}]),$m;}(),$Rm=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._tangent=$P,this._blendIndex=$L,this._blendWeight=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(84,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector4",7),new $km(56,"vector4",6),new $km(72,"vector3",5)]);}]),$m;}(),$$m=function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._tangent=$P;}$$($m,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(56,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector4",5)]);}]),$m;}(),$Am=function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._tangent=$P;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(52,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector3",5)]);}]),$m;}(),$Bm=function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate=$P;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(48,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2)]);}]),$m;}(),$nm=function(){function $m($m,$p,$h,$P,$L){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate0=$P,this._textureCoordinate1=$L;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(56,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector2",15)]);}]),$m;}(),$cm=function(){function $m($m,$p,$h,$P,$L,$q,$k){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate0=$P,this._textureCoordinate1=$L,this._blendIndex=$q,this._blendWeight=$k;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(88,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector2",15),new $km(56,"vector4",7),new $km(72,"vector4",6)]);}]),$m;}(),$em=function(){function $m($m,$p,$h,$P,$L,$q,$k,$Y){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate0=$P,this._textureCoordinate1=$L,this._tangent=$q,this._blendIndex=$k,this._blendWeight=$Y;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(104,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector2",15),new $km(56,"vector4",7),new $km(72,"vector4",6),new $km(88,"vector4",5)]);}]),$m;}(),$am=function(){function $m(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalColorTexture0SkinTangent=function($m,$p,$h,$P,$L,$q,$k,$Y){this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate0=$P,this._textureCoordinate1=$L,this._tangent=$q,this._blendIndex=$k,this._blendWeight=$Y;},$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(100,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector2",15),new $km(56,"vector4",7),new $km(72,"vector4",6),new $km(88,"vector3",5)]);}]),$m;}(),$Zm=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate0=$P,this._textureCoordinate1=$L,this._tangent=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(72,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector2",15),new $km(56,"vector4",5)]);}]),$m;}(),$Hm=function(){function $m(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalColorTexture0Tangent=function($m,$p,$h,$P,$L,$q){this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate0=$P,this._textureCoordinate1=$L,this._tangent=$q;},$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(68,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector2",15),new $km(56,"vector3",5)]);}]),$m;}(),$Wm=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate=$P,this._blendIndex=$L,this._blendWeight=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(80,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector4",7),new $km(64,"vector4",6)]);}]),$m;}(),$Em=function(){function $m($m,$p,$h,$P,$L,$q,$k){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate=$P,this._tangent=$L,this._blendIndex=$q,this._blendWeight=$k;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(96,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector4",7),new $km(64,"vector4",6),new $km(80,"vector4",5)]);}]),$m;}(),$Im=function(){function $m($m,$p,$h,$P,$L,$q,$k){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate=$P,this._tangent=$L,this._blendIndex=$q,this._blendWeight=$k;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(92,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector4",7),new $km(64,"vector4",6),new $km(80,"vector3",5)]);}]),$m;}(),$bm=function(){function $m($m,$p,$h,$P,$L){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate=$P,this._tangent=$L;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(64,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector4",5)]);}]),$m;}(),$Tm=function(){function $m($m,$p,$h,$P,$L){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$m,this._normal=$p,this._color=$h,this._textureCoordinate=$P,this._tangent=$L;}$$($m,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"color",function(){return this._color;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(60,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",1),new $km(40,"vector2",2),new $km(48,"vector3",5)]);}]),$m;}(),$jm=function(){function $m($m,$p,$h){this._position=null,this._normal=null,this._tangent=null,this._position=$m,this._normal=$p,this._tangent=$h;}$$($m,"laya.d3.graphics.VertexPositionNormalSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(40,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector4",5)]);}]),$m;}(),$xm=function(){function $m($m,$p,$h){this._position=null,this._normal=null,this._tangent=null,this._position=$m,this._normal=$p,this._tangent=$h;}$$($m,"laya.d3.graphics.VertexPositionNormalTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(36,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector3",5)]);}]),$m;}(),$Qm=function(){function $m($m,$p,$h){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(32,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2)]);}]),$m;}(),$Mm=function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$m,this._normal=$p,this._textureCoordinate0=$h,this._textureCoordinate1=$P;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(40,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15)]);}]),$m;}(),$um=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$m,this._normal=$p,this._textureCoordinate0=$h,this._textureCoordinate1=$P,this._blendIndex=$L,this._blendWeight=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(72,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15),new $km(40,"vector4",7),new $km(56,"vector4",6)]);}]),$m;}(),$Nm=function(){function $m($m,$p,$h,$P,$L,$q,$k){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._textureCoordinate0=$h,this._textureCoordinate1=$P,this._tangent=$L,this._blendIndex=$q,this._blendWeight=$k;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(88,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15),new $km(40,"vector4",7),new $km(56,"vector4",6),new $km(72,"vector4",5)]);}]),$m;}(),$Sm=function(){function $m(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalTexture0SkinTangent=function($m,$p,$h,$P,$L,$q,$k){this._position=$m,this._normal=$p,this._textureCoordinate0=$h,this._textureCoordinate1=$P,this._tangent=$L,this._blendIndex=$q,this._blendWeight=$k;},$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(84,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15),new $km(40,"vector4",7),new $km(56,"vector4",6),new $km(72,"vector3",5)]);}]),$m;}(),$_m=function(){function $m($m,$p,$h,$P,$L){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$m,this._normal=$p,this._textureCoordinate0=$h,this._textureCoordinate1=$P,this._tangent=$L;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(56,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15),new $km(40,"vector4",5)]);}]),$m;}(),$lm=function(){function $m(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null;}$$($m,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalTexture0Tangent=function($m,$p,$h,$P,$L){this._position=$m,this._normal=$p,this._textureCoordinate0=$h,this._textureCoordinate1=$P,this._tangent=$L;},$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(52,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15),new $km(40,"vector3",5)]);}]),$m;}(),$Jm=function(){function $m($m,$p,$h,$P,$L){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h,this._blendIndex=$P,this._blendWeight=$L;}$$($m,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(64,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector4",7),new $km(48,"vector4",6)]);}]),$m;}(),$zm=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h,this._tangent=$P,this._blendIndex=$L,this._blendWeight=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(80,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector4",7),new $km(48,"vector4",6),new $km(64,"vector4",5)]);}]),$m;}(),$wm=function(){function $m($m,$p,$h,$P,$L,$q){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h,this._tangent=$P,this._blendIndex=$L,this._blendWeight=$q;}$$($m,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(76,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector4",7),new $km(48,"vector4",6),new $km(64,"vector3",5)]);}]),$m;}(),$Xm=function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h,this._tangent=$P;}$$($m,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(48,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector4",5)]);}]),$m;}(),$sm=function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h,this._tangent=$P;}$$($m,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(44,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector3",5)]);}]),$m;}(),$Gm=function(){function $m($m,$p,$h){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h;}$$($m,"laya.d3.graphics.VertexPositionNTBTexture");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(56,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector3",5),new $km(36,"vector3",4),new $km(48,"vector2",2)]);}]),$m;}(),$Um=function(){function $m($m,$p,$h,$P,$L,$q,$k,$Y){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$m,this._normal=$p,this._textureCoordinate0=$P,this._textureCoordinate1=$L,this._tangent=$q,$h=$h,this._blendIndex=$k,this._blendWeight=$Y;}$$($m,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"tangent",function(){return this._tangent;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1;}),$A(0,$p,"blendIndex",function(){return this._blendIndex;}),$A(0,$p,"blendWeight",function(){return this._blendWeight;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(96,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector3",5),new $km(36,"vector3",4),new $km(48,"vector2",2),new $km(56,"vector2",15),new $km(64,"vector4",7),new $km(80,"vector4",6)]);}]),$m;}(),$rm=function(){function $m($m,$p,$h){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$m,this._normal=$p,this._textureCoordinate=$h;}$$($m,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"textureCoordinate",function(){return this._textureCoordinate;}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(88,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector3",5),new $km(36,"vector3",4),new $km(48,"vector2",2),new $km(56,"vector4",7),new $km(72,"vector4",6)]);}]),$m;}(),$ym=(function(){function $m($m,$p,$h,$P){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$m,this._normal=$p,this._textureCoord0=$h,this._textureCoord1=$P;}$$($m,"laya.d3.graphics.VertexPositionTerrain");var $p=$m.prototype;$H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"normal",function(){return this._normal;}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoord0",function(){return this._textureCoord0;}),$A(0,$p,"textureCoord1",function(){return this._textureCoord1;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(40,[new $km(0,"vector3",0),new $km(12,"vector3",3),new $km(24,"vector2",2),new $km(32,"vector2",15)]);}]);}(),function(){function $m($m,$p){this._position=null,this._textureCoordinate0=null,this._position=$m,this._textureCoordinate0=$p;}$$($m,"laya.d3.graphics.VertexPositionTexture0");var $p=$m.prototype;return $H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"position",function(){return this._position;}),$A(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(20,[new $km(0,"vector3",0),new $km(12,"vector2",2)]);}]),$m;}()),$Vm=(function(){function $m($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F,$R,$$){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$m,this._positionStartLifeTime=$p,this._velocity=$h,this._startColor=$P,this._startSize=$L,this._startRotation0=$q,this._startRotation1=$k,this._startRotation2=$Y,this._startLifeTime=$d,this._time=$K,this._startSpeed=$D,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$$;}$$($m,"laya.d3.graphics.VertexShurikenParticleBillboard");var $p=$m.prototype;$H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate;}),$A(0,$p,"random1",function(){return this._randoms1;}),$A(0,$p,"startRotation2",function(){return this._startRotation2;}),$A(0,$p,"positionStartLifeTime",function(){return this._positionStartLifeTime;}),$A(0,$p,"velocity",function(){return this._velocity;}),$A(0,$p,"random0",function(){return this._randoms0;}),$A(0,$p,"startSize",function(){return this._startSize;}),$A(0,$p,"startColor",function(){return this._startColor;}),$A(0,$p,"startRotation0",function(){return this._startRotation0;}),$A(0,$p,"startRotation1",function(){return this._startRotation1;}),$A(0,$p,"startLifeTime",function(){return this._startLifeTime;}),$A(0,$p,"time",function(){return this._time;}),$A(0,$p,"startSpeed",function(){return this._startSpeed;}),$A(0,$p,"simulationWorldPostion",function(){return this._simulationWorldPostion;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(152,[new $km(0,"vector4",17),new $km(16,"vector4",30),new $km(32,"vector4",32),new $km(48,"vector4",19),new $km(64,"vector3",20),new $km(76,"vector3",22),new $km(88,"single",31),new $km(92,"vector4",34),new $km(108,"vector4",35),new $km(124,"vector3",36),new $km(136,"vector4",37)]);}]);}(),function(){function $m($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F,$R,$$){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$m,this._positionStartLifeTime=$p,this._velocity=$h,this._startColor=$P,this._startSize=$L,this._startRotation0=$q,this._startRotation1=$k,this._startRotation2=$Y,this._startLifeTime=$d,this._time=$K,this._startSpeed=$D,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$$;}$$($m,"laya.d3.graphics.VertexShurikenParticleMesh");var $p=$m.prototype;$H.imps($p,{"laya.d3.graphics.IVertex":!0}),$A(0,$p,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate;}),$A(0,$p,"velocity",function(){return this._velocity;}),$A(0,$p,"position",function(){return this._positionStartLifeTime;}),$A(0,$p,"random0",function(){return this._randoms0;}),$A(0,$p,"startSize",function(){return this._startSize;}),$A(0,$p,"startColor",function(){return this._startColor;}),$A(0,$p,"startRotation0",function(){return this._startRotation0;}),$A(0,$p,"startRotation1",function(){return this._startRotation1;}),$A(0,$p,"random1",function(){return this._randoms1;}),$A(0,$p,"startRotation2",function(){return this._startRotation2;}),$A(0,$p,"startLifeTime",function(){return this._startLifeTime;}),$A(0,$p,"time",function(){return this._time;}),$A(0,$p,"startSpeed",function(){return this._startSpeed;}),$A(0,$p,"simulationWorldPostion",function(){return this._simulationWorldPostion;}),$A(0,$p,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$A(1,$m,"vertexDeclaration",function(){return $m._vertexDeclaration;}),$F($m,["_vertexDeclaration",function(){return this._vertexDeclaration=new $qm(172,[new $km(0,"vector3",0),new $km(12,"vector4",1),new $km(28,"vector2",2),new $km(36,"vector4",30),new $km(52,"vector4",32),new $km(68,"vector4",19),new $km(84,"vector3",20),new $km(96,"vector3",22),new $km(108,"single",31),new $km(112,"vector4",34),new $km(128,"vector4",35),new $km(144,"vector3",36),new $km(156,"vector4",37)]);}]);}(),function(){function $a($m,$p,$h,$P,$L,$q){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$h,this._materials=$P,this._subMeshes=$L,this._materialMap=$q,this._version=$p,this._onLoaded($m);}$$($a,"laya.d3.loaders.LoadModelV01");var $m=$a.prototype;return $m._onLoaded=function($m){this._readData=$m,this.READ_BLOCK();for(var $p=0;$p<this._BLOCK.count;$p++){var $h=this._readData.getUint16(),$P=this._strings[$h],$L=this["READ_"+$P];if(null==$L)throw new Error("model file err,no this function:"+$h+" "+$P);if(!$L.call(this))break;}return this._mesh;},$m.onError=function(){},$m._readString=function(){return this._strings[this._readData.getUint16()];},$m.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0;},$m.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0;},$m.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $m=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $p=0;$p<this._STRINGS.size;$p++)this._strings[$p]=this._readData.readUTFString();return this._readData.pos=$m,!0;},$m.READ_MATERIAL=function(){var $m=this._readData.getUint16(),$p=(this._readString(),this._readString());return this._materials[$m]="null"!==$p?$c.getRes(this._materialMap[$p]):new $xp(),!0;},$m.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $m,$p=this._readData.__getBuffer(),$h=0,$P=this._readData.getUint32(),$L=this._readData.getUint32(),$q=(new Float32Array($p.slice($P+this._DATA.offset,$P+this._DATA.offset+$L)),this._readData.getUint32()),$k=this._readData.getUint32(),$Y=new Float32Array($p.slice($q+this._DATA.offset,$q+this._DATA.offset+$k));for(this.mesh._inverseBindPoses=[],$h=0,$m=$Y.length;$h<$m;$h+=16){var $d=new $mp($Y[$h+0],$Y[$h+1],$Y[$h+2],$Y[$h+3],$Y[$h+4],$Y[$h+5],$Y[$h+6],$Y[$h+7],$Y[$h+8],$Y[$h+9],$Y[$h+10],$Y[$h+11],$Y[$h+12],$Y[$h+13],$Y[$h+14],$Y[$h+15]);this.mesh._inverseBindPoses.push($d);}break;default:throw new Error("LoadModel:unknown version.");}return!0;},$m.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $m=this._readString();this._shaderAttributes=$m.match($a._attrReg);var $p=this._readData.getUint32(),$h=this._readData.getUint32(),$P=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$L=this._readData.getUint32(),$q=this._readData.getUint32(),$k=this._readData.getUint32(),$Y=this._readData.__getBuffer(),$d=new $Kp(this._mesh),$K=this._getVertexDeclaration(),$D=$wp.create($K,$L/$K.vertexStride,35044,!0),$F=$P+this._DATA.offset,$R=$Y.slice($F,$F+$L);$D.setData(new Float32Array($R));for(var $$=($d._vertexBuffer=$D).vertexDeclaration.getVertexElements(),$A=0;$A<$$.length;$A++)$d._bufferUsage[$$[$A].elementUsage]=$D;var $B=$zp.create("ushort",$h/2,35044,!0),$n=$p+this._DATA.offset,$c=$Y.slice($n,$n+$h);$B.setData(new Uint16Array($c)),$d._indexBuffer=$B;var $e=$Y.slice($q+this._DATA.offset,$q+this._DATA.offset+$k);return $d._boneIndicesList[0]=new Uint8Array($e),this._subMeshes.push($d),!0;},$m.READ_DATAAREA=function(){return!1;},$m._getVertexDeclaration=function(){for(var $m,$p=!1,$h=!1,$P=!1,$L=!1,$q=!1,$k=!1,$Y=!1,$d=!1,$K=!1,$D=0;$D<this._shaderAttributes.length;$D+=8)switch(this._shaderAttributes[$D]){case"POSITION":$p=!0;break;case"NORMAL":$h=!0;break;case"COLOR":$P=!0;break;case"UV":$L=!0;break;case"UV1":$q=!0;break;case"BLENDWEIGHT":$Y=!0;break;case"BLENDINDICES":$d=!0;break;case"TANGENT":$k=!0;break;case"BINORMAL":$K=!0;}return $p&&$h&&$P&&$L&&$q&&$Y&&$d&&$k?$m=$am.vertexDeclaration:$p&&$h&&$P&&$L&&$q&&$Y&&$d?$m=$cm.vertexDeclaration:$p&&$h&&$L&&$q&&$Y&&$d&&$k?$m=$Sm.vertexDeclaration:$p&&$h&&$L&&$q&&$Y&&$d?$m=$um.vertexDeclaration:$p&&$h&&$P&&$L&&$Y&&$d&&$k?$m=$Im.vertexDeclaration:$p&&$h&&$P&&$L&&$Y&&$d?$m=$Wm.vertexDeclaration:$p&&$h&&$k&&$K&&$L&&$Y&&$d?$m=$rm.vertexDeclaration:$p&&$h&&$L&&$Y&&$d&&$k?$m=$wm.vertexDeclaration:$p&&$h&&$L&&$Y&&$d?$m=$Jm.vertexDeclaration:$p&&$h&&$P&&$Y&&$d&&$k?$m=$Rm.vertexDeclaration:$p&&$h&&$P&&$Y&&$d?$m=$Dm.vertexDeclaration:$p&&$h&&$P&&$L&&$q&&$k?$m=$Hm.vertexDeclaration:$p&&$h&&$P&&$L&&$q?$m=$nm.vertexDeclaration:$p&&$h&&$L&&$q&&$k?$m=$lm.vertexDeclaration:$p&&$h&&$L&&$q?$m=$Mm.vertexDeclaration:$p&&$h&&$P&&$L&&$k?$m=$Tm.vertexDeclaration:$p&&$h&&$L&&$k&&$K?$m=$Gm.vertexDeclaration:$p&&$h&&$P&&$L?$m=$Bm.vertexDeclaration:$p&&$h&&$L&&$k?$m=$sm.vertexDeclaration:$p&&$h&&$L?$m=$Qm.vertexDeclaration:$p&&$h&&$P&&$k?$m=$Am.vertexDeclaration:$p&&$h&&$P&&($m=$Km.vertexDeclaration),$m;},$A(0,$m,"mesh",function(){return this._mesh;}),$a._attrReg=new RegExp("(\\w+)|([:,;])","g"),$a;}()),$om=function(){function $E(){}return $$($E,"laya.d3.loaders.LoadModelV02"),$E.parse=function($m,$p,$h,$P,$L,$q){$E._mesh=$h,$E._materials=$P,$E._subMeshes=$L,$E._materialMap=$q,$E._version=$p,$E._readData=$m,$E.READ_DATA(),$E.READ_BLOCK(),$E.READ_STRINGS();for(var $k=0,$Y=$E._BLOCK.count;$k<$Y;$k++){$E._readData.pos=$E._BLOCK.blockStarts[$k];var $d=$E._readData.getUint16(),$K=$E._strings[$d],$D=$E["READ_"+$K];if(null==$D)throw new Error("model file err,no this function:"+$d+" "+$K);$D.call();}$E._strings.length=0,$E._readData=null,$E._version=null,$E._mesh=null,$E._materials=null,$E._subMeshes=null,$E._materialMap=null;},$E._readString=function(){return $E._strings[$E._readData.getUint16()];},$E.READ_DATA=function(){$E._DATA.offset=$E._readData.getUint32(),$E._DATA.size=$E._readData.getUint32();},$E.READ_BLOCK=function(){for(var $m=$E._BLOCK.count=$E._readData.getUint16(),$p=$E._BLOCK.blockStarts=[],$h=$E._BLOCK.blockLengths=[],$P=0;$P<$m;$P++)$p.push($E._readData.getUint32()),$h.push($E._readData.getUint32());},$E.READ_STRINGS=function(){var $m=$E._readData.getUint32(),$p=$E._readData.getUint16(),$h=$E._readData.pos;$E._readData.pos=$m+$E._DATA.offset;for(var $P=0;$P<$p;$P++)$E._strings[$P]=$E._readData.readUTFString();$E._readData.pos=$h;},$E.READ_MATERIAL=function(){$E._readString(),$E._readString();var $m=$E._readString();return""!==$m&&$E._materials.push($c.getRes($E._materialMap[$m])),!0;},$E.READ_MESH=function(){$E._readString();var $m,$p=$E._readData.__getBuffer(),$h=0,$P=$E._readData.getInt16(),$L=$E._DATA.offset;for($h=0;$h<$P;$h++){var $q=$L+$E._readData.getUint32(),$k=$E._readData.getUint32(),$Y=new Float32Array($p.slice($q,$q+$k)),$d=$E._readString().match($E._attrReg),$K=$E._getVertexDeclaration($d),$D=$wp.create($K,4*$Y.length/$K.vertexStride,35044,!0);$D.setData($Y),$E._mesh._vertexBuffers.push($D);}var $F=$L+$E._readData.getUint32(),$R=$E._readData.getUint32(),$$=new Uint16Array($p.slice($F,$F+$R)),$A=$zp.create("ushort",$R/2,35044,!0);$A.setData($$),$E._mesh._indexBuffer=$A;var $B=$E._mesh._boneNames=[],$n=$E._readData.getUint16();for($B.length=$n,$h=0;$h<$n;$h++)$B[$h]=$E._strings[$E._readData.getUint16()];var $c=$E._readData.getUint32(),$e=$E._readData.getUint32(),$a=(new Float32Array($p.slice($L+$c,$L+$c+$e)),$E._readData.getUint32()),$Z=$E._readData.getUint32(),$H=new Float32Array($p.slice($L+$a,$L+$a+$Z));for($E._mesh._inverseBindPoses=[],$h=0,$m=$H.length;$h<$m;$h+=16){var $W=new $mp($H[$h+0],$H[$h+1],$H[$h+2],$H[$h+3],$H[$h+4],$H[$h+5],$H[$h+6],$H[$h+7],$H[$h+8],$H[$h+9],$H[$h+10],$H[$h+11],$H[$h+12],$H[$h+13],$H[$h+14],$H[$h+15]);$E._mesh._inverseBindPoses.push($W);}return $E._mesh._skinnedDatas=new Float32Array(16*$H.length),!0;},$E.READ_SUBMESH=function(){var $m=$E._readData.__getBuffer(),$p=new $Kp($E._mesh),$h=$E._readData.getInt16(),$P=$E._readData.getUint32(),$L=$E._readData.getUint32();$p._vertexBuffer=$E._mesh._vertexBuffers[$h],$p._vertexStart=$P,$p._vertexCount=$L;var $q=$E._readData.getUint32(),$k=$E._readData.getUint32(),$Y=$E._mesh._indexBuffer;$p._indexBuffer=$Y,$p._indexStart=$q,$p._indexCount=$k,$p._indices=new Uint16Array($Y.getData().buffer,2*$q,$k);var $d=$E._DATA.offset,$K=$p._subIndexBufferStart,$D=$p._subIndexBufferCount,$F=$p._boneIndicesList,$R=$E._readData.getUint16();$K.length=$R,$D.length=$R,$F.length=$R;for(var $$=0;$$<$R;$$++){$K[$$]=$E._readData.getUint32(),$D[$$]=$E._readData.getUint32();var $A=$E._readData.getUint32(),$B=$E._readData.getUint32();$p._boneIndicesList[$$]=new Uint8Array($m.slice($d+$A,$d+$A+$B));}return $E._subMeshes.push($p),!0;},$E._getVertexDeclaration=function($m){for(var $p,$h=!1,$P=!1,$L=!1,$q=!1,$k=!1,$Y=!1,$d=!1,$K=!1,$D=!1,$F=0;$F<$m.length;$F++)switch($m[$F]){case"POSITION":$h=!0;break;case"NORMAL":$P=!0;break;case"COLOR":$L=!0;break;case"UV":$q=!0;break;case"UV1":$k=!0;break;case"BLENDWEIGHT":$d=!0;break;case"BLENDINDICES":$K=!0;break;case"TANGENT":$Y=!0;break;case"BINORMAL":$D=!0;}return $h&&$P&&$L&&$q&&$k&&$d&&$K&&$Y?$p=$am.vertexDeclaration:$h&&$P&&$L&&$q&&$k&&$d&&$K?$p=$cm.vertexDeclaration:$h&&$P&&$q&&$k&&$d&&$K&&$Y?$p=$Sm.vertexDeclaration:$h&&$P&&$q&&$k&&$d&&$K?$p=$um.vertexDeclaration:$h&&$P&&$L&&$q&&$d&&$K&&$Y?$p=$Im.vertexDeclaration:$h&&$P&&$L&&$q&&$d&&$K?$p=$Wm.vertexDeclaration:$h&&$P&&$q&&$d&&$K&&$Y?$p=$wm.vertexDeclaration:$h&&$P&&$q&&$d&&$K?$p=$Jm.vertexDeclaration:$h&&$P&&$L&&$d&&$K&&$Y?$p=$Rm.vertexDeclaration:$h&&$P&&$L&&$d&&$K?$p=$Dm.vertexDeclaration:$h&&$P&&$L&&$q&&$k&&$Y?$p=$Hm.vertexDeclaration:$h&&$P&&$L&&$q&&$k?$p=$nm.vertexDeclaration:$h&&$P&&$q&&$k&&$Y?$p=$lm.vertexDeclaration:$h&&$P&&$q&&$k?$p=$Mm.vertexDeclaration:$h&&$P&&$L&&$q&&$Y?$p=$Tm.vertexDeclaration:$h&&$P&&$q&&$Y&&$D?$p=$Gm.vertexDeclaration:$h&&$P&&$L&&$q?$p=$Bm.vertexDeclaration:$h&&$P&&$q&&$Y?$p=$sm.vertexDeclaration:$h&&$P&&$q?$p=$Qm.vertexDeclaration:$h&&$P&&$L&&$Y?$p=$Am.vertexDeclaration:$h&&$P&&$L&&($p=$Km.vertexDeclaration),$p;},$E._attrReg=new RegExp("(\\w+)|([:,;])","g"),$E._strings=[],$E._readData=null,$E._version=null,$E._mesh=null,$E._materials=null,$E._subMeshes=null,$E._materialMap=null,$F($E,["_BLOCK",function(){return this._BLOCK={count:0};},"_DATA",function(){return this._DATA={offset:0,size:0};}]),$E;}(),$fm=function(){function $W(){}return $$($W,"laya.d3.loaders.LoadModelV03"),$W.parse=function($m,$p,$h,$P,$L){$W._mesh=$h,$W._subMeshes=$P,$W._materialMap=$L,$W._version=$p,$W._readData=$m,$W.READ_DATA(),$W.READ_BLOCK(),$W.READ_STRINGS();for(var $q=0,$k=$W._BLOCK.count;$q<$k;$q++){$W._readData.pos=$W._BLOCK.blockStarts[$q];var $Y=$W._readData.getUint16(),$d=$W._strings[$Y],$K=$W["READ_"+$d];if(null==$K)throw new Error("model file err,no this function:"+$Y+" "+$d);$K.call();}$W._strings.length=0,$W._readData=null,$W._version=null,$W._mesh=null,$W._subMeshes=null,$W._materialMap=null;},$W._readString=function(){return $W._strings[$W._readData.getUint16()];},$W.READ_DATA=function(){$W._DATA.offset=$W._readData.getUint32(),$W._DATA.size=$W._readData.getUint32();},$W.READ_BLOCK=function(){for(var $m=$W._BLOCK.count=$W._readData.getUint16(),$p=$W._BLOCK.blockStarts=[],$h=$W._BLOCK.blockLengths=[],$P=0;$P<$m;$P++)$p.push($W._readData.getUint32()),$h.push($W._readData.getUint32());},$W.READ_STRINGS=function(){var $m=$W._readData.getUint32(),$p=$W._readData.getUint16(),$h=$W._readData.pos;$W._readData.pos=$m+$W._DATA.offset;for(var $P=0;$P<$p;$P++)$W._strings[$P]=$W._readData.readUTFString();$W._readData.pos=$h;},$W.READ_MESH=function(){var $m,$p=$W._readString(),$h=$W._readData.__getBuffer(),$P=0,$L=$W._readData.getInt16(),$q=$W._DATA.offset;for($P=0;$P<$L;$P++){var $k,$Y=$q+$W._readData.getUint32(),$d=$W._readData.getUint32(),$K=new Float32Array($h.slice($Y,$Y+$d)),$D=$W._readString();switch($W._version){case"LAYAMODEL:03":$k=$W._vertexDeclarationMap_Discard[$D];break;case"LAYAMODEL:0301":$k=$W._vertexDeclarationMap[$D];break;default:throw new Error("LoadModelV03: unknown version.");}if(!$k)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$W._version+"  bufferAttribute="+$D+"  name="+$p+"  url="+($W._mesh?$W._mesh.url:"null"));var $F=$wp.create($k,4*$K.length/$k.vertexStride,35044,!0,$W._mesh._url+"_"+$P);$F.setData($K),$W._mesh._vertexBuffers.push($F);}var $R=$q+$W._readData.getUint32(),$$=$W._readData.getUint32(),$A=new Uint16Array($h.slice($R,$R+$$)),$B=$zp.create("ushort",$$/2,35044,!0,$W._mesh._url);$B.setData($A),$W._mesh._indexBuffer=$B;var $n=$W._mesh._boneNames=[],$c=$W._readData.getUint16();for($n.length=$c,$P=0;$P<$c;$P++)$n[$P]=$W._strings[$W._readData.getUint16()];$W._readData.pos+=8;var $e=$W._readData.getUint32(),$a=$W._readData.getUint32(),$Z=new Float32Array($h.slice($q+$e,$q+$e+$a));for($W._mesh._inverseBindPoses=[],$P=0,$m=$Z.length;$P<$m;$P+=16){var $H=new $mp($Z[$P+0],$Z[$P+1],$Z[$P+2],$Z[$P+3],$Z[$P+4],$Z[$P+5],$Z[$P+6],$Z[$P+7],$Z[$P+8],$Z[$P+9],$Z[$P+10],$Z[$P+11],$Z[$P+12],$Z[$P+13],$Z[$P+14],$Z[$P+15]);$W._mesh._inverseBindPoses.push($H);}return $W._mesh._skinnedDatas=new Float32Array(16*$Z.length),!0;},$W.READ_SUBMESH=function(){var $m=$W._readData.__getBuffer(),$p=new $Kp($W._mesh),$h=$W._readData.getInt16(),$P=$W._readData.getUint32(),$L=$W._readData.getUint32();$p._vertexBuffer=$W._mesh._vertexBuffers[$h],$p._vertexStart=$P,$p._vertexCount=$L;var $q=$W._readData.getUint32(),$k=$W._readData.getUint32(),$Y=$W._mesh._indexBuffer;$p._indexBuffer=$Y,$p._indexStart=$q,$p._indexCount=$k,$p._indices=new Uint16Array($Y.getData().buffer,2*$q,$k);var $d=$W._DATA.offset,$K=$p._subIndexBufferStart,$D=$p._subIndexBufferCount,$F=$p._boneIndicesList,$R=$W._readData.getUint16();$K.length=$R,$D.length=$R,$F.length=$R;for(var $$=0;$$<$R;$$++){$K[$$]=$W._readData.getUint32(),$D[$$]=$W._readData.getUint32();var $A=$W._readData.getUint32(),$B=$W._readData.getUint32();$F[$$]=new Uint8Array($m.slice($d+$A,$d+$A+$B));}return $W._subMeshes.push($p),!0;},$W._strings=[],$W._readData=null,$W._version=null,$W._mesh=null,$W._subMeshes=null,$W._materialMap=null,$F($W,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$am.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$cm.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Um.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Sm.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$um.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Im.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$Wm.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$wm.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$Jm.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$Rm.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$Dm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Hm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$nm.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$lm.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$Mm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$Tm.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$Gm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$Bm.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$sm.vertexDeclaration,"POSITION,NORMAL,UV":$Qm.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$Am.vertexDeclaration,"POSITION,NORMAL,COLOR":$Km.vertexDeclaration,"POSITION,NORMAL,TANGENT":$xm.vertexDeclaration,"POSITION,NORMAL":$dm.vertexDeclaration,"POSITION,UV":$ym.vertexDeclaration,POSITION:$Ym.vertexDeclaration};},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$em.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$cm.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Um.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Nm.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$um.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Em.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$Wm.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$zm.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$Jm.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$Fm.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$Dm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Zm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$nm.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$_m.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$Mm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$bm.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$Gm.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$Bm.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Xm.vertexDeclaration,"POSITION,NORMAL,UV":$Qm.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$$m.vertexDeclaration,"POSITION,NORMAL,COLOR":$Km.vertexDeclaration,"POSITION,NORMAL,TANGENT":$jm.vertexDeclaration,"POSITION,NORMAL":$dm.vertexDeclaration,"POSITION,UV":$ym.vertexDeclaration,POSITION:$Ym.vertexDeclaration};},"_BLOCK",function(){return this._BLOCK={count:0};},"_DATA",function(){return this._DATA={offset:0,size:0};}]),$W;}(),$im=function(){function $Y(){}return $$($Y,"laya.d3.loaders.MeshReader"),$Y.read=function($m,$p,$h,$P,$L){var $q=new $W($m);$q.pos=0;var $k=$q.readUTFString();switch($k){case"LAYAMODEL:01":case"LAYASKINANI:01":$Y._readVersion01($q,$k,$p,$h,$P,$L);break;case"LAYAMODEL:02":$om.parse($q,$k,$p,$h,$P,$L);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$fm.parse($q,$k,$p,$P,$L);break;default:throw new Error("MeshReader: unknown mesh version.");}$p._setSubMeshes($P);},$Y._readVersion01=function($m,$p,$h,$P,$L,$q){new $Vm($m,$p,$h,$P,$L,$q);},$Y;}(),$vm=function(){function $m($m,$p){this.min=null,this.max=null,this.min=$m,this.max=$p;}$$($m,"laya.d3.math.BoundBox");var $p=$m.prototype;return $H.imps($p,{"laya.d3.core.IClone":!0}),$p.getCorners=function($m){$m.length=8;var $p=this.min.elements,$h=this.max.elements,$P=$p[0],$L=$p[1],$q=$p[2],$k=$h[0],$Y=$h[1],$d=$h[2];$m[0]=new $kp($P,$Y,$d),$m[1]=new $kp($k,$Y,$d),$m[2]=new $kp($k,$L,$d),$m[3]=new $kp($P,$L,$d),$m[4]=new $kp($P,$Y,$q),$m[5]=new $kp($k,$Y,$q),$m[6]=new $kp($k,$L,$q),$m[7]=new $kp($P,$L,$q);},$p.toDefault=function(){this.min.toDefault(),this.max.toDefault();},$p.cloneTo=function($m){var $p=$m;this.min.cloneTo($p.min),this.max.cloneTo($p.max);},$p.clone=function(){var $m=new this.constructor(new $kp(),new $kp());return this.cloneTo($m),$m;},$m.createfromPoints=function($m,$p){if(null==$m)throw new Error("points");var $h=$p.min,$P=$p.max,$L=$h.elements;$L[0]=Number.MAX_VALUE,$L[1]=Number.MAX_VALUE,$L[2]=Number.MAX_VALUE;var $q=$P.elements;$q[0]=-Number.MAX_VALUE,$q[1]=-Number.MAX_VALUE,$q[2]=-Number.MAX_VALUE;for(var $k=0,$Y=$m.length;$k<$Y;++$k)$kp.min($h,$m[$k],$h),$kp.max($P,$m[$k],$P);},$m.merge=function($m,$p,$h){$kp.min($m.min,$p.min,$h.min),$kp.max($m.max,$p.max,$h.max);},$m;}(),$gm=function(){function $K($m){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$m,this._near=new $pp(new $kp()),this._far=new $pp(new $kp()),this._left=new $pp(new $kp()),this._right=new $pp(new $kp()),this._top=new $pp(new $kp()),this._bottom=new $pp(new $kp()),$K._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom);}$$($K,"laya.d3.math.BoundFrustum");var $m=$K.prototype;return $m.equalsBoundFrustum=function($m){return this._matrix.equalsOtherMatrix($m.matrix);},$m.equalsObj=function($m){if($m instanceof laya.d3.math.BoundFrustum){var $p=$m;return this.equalsBoundFrustum($p);}return!1;},$m.getPlane=function($m){switch($m){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null;}},$m.getCorners=function($m){$K._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($m[0]),$K._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($m[1]),$K._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($m[2]),$K._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($m[3]),$K._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($m[4]),$K._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($m[5]),$K._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($m[6]),$K._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($m[7]);},$m.containsPoint=function($m){for(var $p=$pp.PlaneIntersectionType_Front,$h=$pp.PlaneIntersectionType_Front,$P=0;$P<6;$P++){switch($P){case 0:$h=Collision.intersectsPlaneAndPoint(this._near,$m);break;case 1:$h=Collision.intersectsPlaneAndPoint(this._far,$m);break;case 2:$h=Collision.intersectsPlaneAndPoint(this._left,$m);break;case 3:$h=Collision.intersectsPlaneAndPoint(this._right,$m);break;case 4:$h=Collision.intersectsPlaneAndPoint(this._top,$m);break;case 5:$h=Collision.intersectsPlaneAndPoint(this._bottom,$m);}switch($h){case $pp.PlaneIntersectionType_Back:return 0;case $pp.PlaneIntersectionType_Intersecting:$p=$pp.PlaneIntersectionType_Intersecting;}}switch($p){case $pp.PlaneIntersectionType_Intersecting:return 2;default:return 1;}},$m.containsBoundBox=function($m){for(var $p,$h=$K._tempV30,$P=$K._tempV31,$L=1,$q=0;$q<6;$q++){if($p=this.getPlane($q),this._getBoxToPlanePVertexNVertex($m,$p.normal,$h,$P),Collision.intersectsPlaneAndPoint($p,$h)===$pp.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($p,$P)===$pp.PlaneIntersectionType_Back&&($L=2);}return $L;},$m.containsBoundSphere=function($m){for(var $p=$pp.PlaneIntersectionType_Front,$h=$pp.PlaneIntersectionType_Front,$P=0;$P<6;$P++){switch($P){case 0:$h=Collision.intersectsPlaneAndSphere(this._near,$m);break;case 1:$h=Collision.intersectsPlaneAndSphere(this._far,$m);break;case 2:$h=Collision.intersectsPlaneAndSphere(this._left,$m);break;case 3:$h=Collision.intersectsPlaneAndSphere(this._right,$m);break;case 4:$h=Collision.intersectsPlaneAndSphere(this._top,$m);break;case 5:$h=Collision.intersectsPlaneAndSphere(this._bottom,$m);}switch($h){case $pp.PlaneIntersectionType_Back:return 0;case $pp.PlaneIntersectionType_Intersecting:$p=$pp.PlaneIntersectionType_Intersecting;}}switch($p){case $pp.PlaneIntersectionType_Intersecting:return 2;default:return 1;}},$m._getBoxToPlanePVertexNVertex=function($m,$p,$h,$P){var $L=$m.min,$q=$L.elements,$k=$m.max,$Y=$k.elements,$d=$p.elements,$K=$d[0],$D=$d[1],$F=$d[2];$L.cloneTo($h);var $R=$h.elements;0<=$K&&($R[0]=$Y[0]),0<=$D&&($R[1]=$Y[1]),0<=$F&&($R[2]=$Y[2]),$k.cloneTo($P);var $$=$P.elements;0<=$K&&($$[0]=$q[0]),0<=$D&&($$[1]=$q[1]),0<=$F&&($$[2]=$q[2]);},$A(0,$m,"top",function(){return this._top;}),$A(0,$m,"matrix",function(){return this._matrix;},function($m){this._matrix=$m,$K._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom);}),$A(0,$m,"near",function(){return this._near;}),$A(0,$m,"far",function(){return this._far;}),$A(0,$m,"left",function(){return this._left;}),$A(0,$m,"right",function(){return this._right;}),$A(0,$m,"bottom",function(){return this._bottom;}),$K._getPlanesFromMatrix=function($m,$p,$h,$P,$L,$q,$k){var $Y=$m.elements,$d=$Y[0],$K=$Y[1],$D=$Y[2],$F=$Y[3],$R=$Y[4],$$=$Y[5],$A=$Y[6],$B=$Y[7],$n=$Y[8],$c=$Y[9],$e=$Y[10],$a=$Y[11],$Z=$Y[12],$H=$Y[13],$W=$Y[14],$E=$Y[15],$I=$p.normal.elements;$I[0]=$F+$D,$I[1]=$B+$A,$I[2]=$a+$e,$p.distance=$E+$W,$p.normalize();var $b=$h.normal.elements;$b[0]=$F-$D,$b[1]=$B-$A,$b[2]=$a-$e,$h.distance=$E-$W,$h.normalize();var $T=$P.normal.elements;$T[0]=$F+$d,$T[1]=$B+$R,$T[2]=$a+$n,$P.distance=$E+$Z,$P.normalize();var $j=$L.normal.elements;$j[0]=$F-$d,$j[1]=$B-$R,$j[2]=$a-$n,$L.distance=$E-$Z,$L.normalize();var $x=$q.normal.elements;$x[0]=$F-$K,$x[1]=$B-$$,$x[2]=$a-$c,$q.distance=$E-$H,$q.normalize();var $Q=$k.normal.elements;$Q[0]=$F+$K,$Q[1]=$B+$$,$Q[2]=$a+$c,$k.distance=$E+$H,$k.normalize();},$K._get3PlaneInterPoint=function($m,$p,$h){var $P=$m.normal,$L=$p.normal,$q=$h.normal;$kp.cross($L,$q,$K._tempV30),$kp.cross($q,$P,$K._tempV31),$kp.cross($P,$L,$K._tempV32);var $k=$kp.dot($P,$K._tempV30),$Y=$kp.dot($L,$K._tempV31),$d=$kp.dot($q,$K._tempV32);return $kp.scale($K._tempV30,-$m.distance/$k,$K._tempV33),$kp.scale($K._tempV31,-$p.distance/$Y,$K._tempV34),$kp.scale($K._tempV32,-$h.distance/$d,$K._tempV35),$kp.add($K._tempV33,$K._tempV34,$K._tempV36),$kp.add($K._tempV35,$K._tempV36,$K._tempV37),$K._tempV37;},$F($K,["_tempV30",function(){return this._tempV30=new $kp();},"_tempV31",function(){return this._tempV31=new $kp();},"_tempV32",function(){return this._tempV32=new $kp();},"_tempV33",function(){return this._tempV33=new $kp();},"_tempV34",function(){return this._tempV34=new $kp();},"_tempV35",function(){return this._tempV35=new $kp();},"_tempV36",function(){return this._tempV36=new $kp();},"_tempV37",function(){return this._tempV37=new $kp();}]),$K;}(),$tm=function(){function $D($m,$p){this.center=null,this.radius=NaN,this.center=$m,this.radius=$p;}$$($D,"laya.d3.math.BoundSphere");var $m=$D.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.toDefault=function(){this.center.toDefault(),this.radius=0;},$m.intersectsRayDistance=function($m){return Collision.intersectsRayAndSphereRD($m,this);},$m.intersectsRayPoint=function($m,$p){return Collision.intersectsRayAndSphereRP($m,this,$p);},$m.cloneTo=function($m){var $p=$m;this.center.cloneTo($p.center),$p.radius=this.radius;},$m.clone=function(){var $m=new this.constructor(new $kp(),new $kp());return this.cloneTo($m),$m;},$D.createFromSubPoints=function($m,$p,$h,$P){if(null==$m)throw new Error("points");if($p<0||$p>=$m.length)throw new Error("start"+$p+"Must be in the range [0, "+($m.length-1)+"]");if($h<0||$p+$h>$m.length)throw new Error("count"+$h+"Must be in the range <= "+$m.length+"}");var $L=$p+$h,$q=$D._tempVector3;$q.elements[0]=0,$q.elements[1]=0,$q.elements[2]=0;for(var $k=$p;$k<$L;++$k)$kp.add($m[$k],$q,$q);var $Y=$P.center;$kp.scale($q,1/$h,$Y);var $d=0;for($k=$p;$k<$L;++$k){var $K=$kp.distanceSquared($Y,$m[$k]);$d<$K&&($d=$K);}$P.radius=Math.sqrt($d);},$D.createfromPoints=function($m,$p){if(null==$m)throw new Error("points");$D.createFromSubPoints($m,0,$m.length,$p);},$F($D,["_tempVector3",function(){return this._tempVector3=new $kp();}]),$D;}(),$Om=(function(){function $m(){}$$($m,"laya.d3.math.ContainmentType"),$m.Disjoint=0,$m.Contains=1,$m.Intersects=2;}(),function(){function $h(){}return $$($h,"laya.d3.math.MathUtils3D"),$h.isZero=function($m){return Math.abs($m)<$h.zeroTolerance;},$h.nearEqual=function($m,$p){return!!$h.isZero($m-$p);},$h.fastInvSqrt=function($m){return $h.isZero($m)?$m:1/Math.sqrt($m);},$F($h,["zeroTolerance",function(){return this.zeroTolerance=1e-6;},"MaxValue",function(){return this.MaxValue=340282347e30;},"MinValue",function(){return this.MinValue=-340282347e30;}]),$h;}()),$Cm=function(){function $d(){var $m=this.elements=new Float32Array(9);$m[0]=1,$m[1]=0,$m[2]=0,$m[3]=0,$m[4]=1,$m[5]=0,$m[6]=0,$m[7]=0,$m[8]=1;}$$($d,"laya.d3.math.Matrix3x3");var $m=$d.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.determinant=function(){var $m=this.elements,$p=$m[0],$h=$m[1],$P=$m[2],$L=$m[3],$q=$m[4],$k=$m[5],$Y=$m[6],$d=$m[7],$K=$m[8];return $p*($K*$q-$k*$d)+$h*(-$K*$L+$k*$Y)+$P*($d*$L-$q*$Y);},$m.translate=function($m,$p){var $h=$p.elements,$P=this.elements,$L=$m.elements,$q=$P[0],$k=$P[1],$Y=$P[2],$d=$P[3],$K=$P[4],$D=$P[5],$F=$P[6],$R=$P[7],$$=$P[8],$A=$L[0],$B=$L[1];$h[0]=$q,$h[1]=$k,$h[2]=$Y,$h[3]=$d,$h[4]=$K,$h[5]=$D,$h[6]=$A*$q+$B*$d+$F,$h[7]=$A*$k+$B*$K+$R,$h[8]=$A*$Y+$B*$D+$$;},$m.rotate=function($m,$p){var $h=$p.elements,$P=this.elements,$L=$P[0],$q=$P[1],$k=$P[2],$Y=$P[3],$d=$P[4],$K=$P[5],$D=$P[6],$F=$P[7],$R=$P[8],$$=Math.sin($m),$A=Math.cos($m);$h[0]=$A*$L+$$*$Y,$h[1]=$A*$q+$$*$d,$h[2]=$A*$k+$$*$K,$h[3]=$A*$Y-$$*$L,$h[4]=$A*$d-$$*$q,$h[5]=$A*$K-$$*$k,$h[6]=$D,$h[7]=$F,$h[8]=$R;},$m.scale=function($m,$p){var $h=$p.elements,$P=this.elements,$L=$m.elements,$q=$L[0],$k=$L[1];$h[0]=$q*$P[0],$h[1]=$q*$P[1],$h[2]=$q*$P[2],$h[3]=$k*$P[3],$h[4]=$k*$P[4],$h[5]=$k*$P[5],$h[6]=$P[6],$h[7]=$P[7],$h[8]=$P[8];},$m.invert=function($m){var $p=$m.elements,$h=this.elements,$P=$h[0],$L=$h[1],$q=$h[2],$k=$h[3],$Y=$h[4],$d=$h[5],$K=$h[6],$D=$h[7],$F=$h[8],$R=$F*$Y-$d*$D,$$=-$F*$k+$d*$K,$A=$D*$k-$Y*$K,$B=$P*$R+$L*$$+$q*$A;$B||($m=null),$B=1/$B,$p[0]=$R*$B,$p[1]=(-$F*$L+$q*$D)*$B,$p[2]=($d*$L-$q*$Y)*$B,$p[3]=$$*$B,$p[4]=($F*$P-$q*$K)*$B,$p[5]=(-$d*$P+$q*$k)*$B,$p[6]=$A*$B,$p[7]=(-$D*$P+$L*$K)*$B,$p[8]=($Y*$P-$L*$k)*$B;},$m.transpose=function($m){var $p=$m.elements,$h=this.elements;if($m===this){var $P=$h[1],$L=$h[2],$q=$h[5];$p[1]=$h[3],$p[2]=$h[6],$p[3]=$P,$p[5]=$h[7],$p[6]=$L,$p[7]=$q;}else $p[0]=$h[0],$p[1]=$h[3],$p[2]=$h[6],$p[3]=$h[1],$p[4]=$h[4],$p[5]=$h[7],$p[6]=$h[2],$p[7]=$h[5],$p[8]=$h[8];},$m.identity=function(){var $m=this.elements;$m[0]=1,$m[1]=0,$m[2]=0,$m[3]=0,$m[4]=1,$m[5]=0,$m[6]=0,$m[7]=0,$m[8]=1;},$m.cloneTo=function($m){var $p,$h,$P;if(($h=this.elements)!==($P=$m.elements))for($p=0;$p<9;++$p)$P[$p]=$h[$p];},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$d.createFromTranslation=function($m,$p){$p.elements;var $h=$m.elements;$p[0]=1,$p[1]=0,$p[2]=0,$p[3]=0,$p[4]=1,$p[5]=0,$p[6]=$h[0],$p[7]=$h[1],$p[8]=1;},$d.createFromRotation=function($m,$p){var $h=$p.elements,$P=Math.sin($m),$L=Math.cos($m);$h[0]=$L,$h[1]=$P,$h[2]=0,$h[3]=-$P,$h[4]=$L,$h[5]=0,$h[6]=0,$h[7]=0,$h[8]=1;},$d.createFromScaling=function($m,$p){var $h=$p.elements,$P=$m.elements;$h[0]=$P[0],$h[1]=0,$h[2]=0,$h[3]=0,$h[4]=$P[1],$h[5]=0,$h[6]=0,$h[7]=0,$h[8]=1;},$d.createFromMatrix4x4=function($m,$p){$p[0]=$m[0],$p[1]=$m[1],$p[2]=$m[2],$p[3]=$m[4],$p[4]=$m[5],$p[5]=$m[6],$p[6]=$m[8],$p[7]=$m[9],$p[8]=$m[10];},$d.multiply=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements,$k=$L[0],$Y=$L[1],$d=$L[2],$K=$L[3],$D=$L[4],$F=$L[5],$R=$L[6],$$=$L[7],$A=$L[8],$B=$q[0],$n=$q[1],$c=$q[2],$e=$q[3],$a=$q[4],$Z=$q[5],$H=$q[6],$W=$q[7],$E=$q[8];$P[0]=$B*$k+$n*$K+$c*$R,$P[1]=$B*$Y+$n*$D+$c*$$,$P[2]=$B*$d+$n*$F+$c*$A,$P[3]=$e*$k+$a*$K+$Z*$R,$P[4]=$e*$Y+$a*$D+$Z*$$,$P[5]=$e*$d+$a*$F+$Z*$A,$P[6]=$H*$k+$W*$K+$E*$R,$P[7]=$H*$Y+$W*$D+$E*$$,$P[8]=$H*$d+$W*$F+$E*$A;},$d.lookAt=function($m,$p,$h,$P){$kp.subtract($m,$p,$d._tempV30),$kp.normalize($d._tempV30,$d._tempV30),$kp.cross($h,$d._tempV30,$d._tempV31),$kp.normalize($d._tempV31,$d._tempV31),$kp.cross($d._tempV30,$d._tempV31,$d._tempV32);var $L=$d._tempV30.elements,$q=$d._tempV31.elements,$k=$d._tempV32.elements,$Y=$P.elements;$Y[0]=$q[0],$Y[3]=$q[1],$Y[6]=$q[2],$Y[1]=$k[0],$Y[4]=$k[1],$Y[7]=$k[2],$Y[2]=$L[0],$Y[5]=$L[1],$Y[8]=$L[2];},$d.DEFAULT=new $d(),$F($d,["_tempV30",function(){return this._tempV30=new $kp();},"_tempV31",function(){return this._tempV31=new $kp();},"_tempV32",function(){return this._tempV32=new $kp();}]),$d;}(),$mp=function(){function $b($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F,$R,$$,$A,$B){void 0===$m&&($m=1),void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$q&&($q=1),void 0===$k&&($k=0),void 0===$Y&&($Y=0),void 0===$d&&($d=0),void 0===$K&&($K=0),void 0===$D&&($D=1),void 0===$F&&($F=0),void 0===$R&&($R=0),void 0===$$&&($$=0),void 0===$A&&($A=0),void 0===$B&&($B=1);var $n=this.elements=new Float32Array(16);$n[0]=$m,$n[1]=$p,$n[2]=$h,$n[3]=$P,$n[4]=$L,$n[5]=$q,$n[6]=$k,$n[7]=$Y,$n[8]=$d,$n[9]=$K,$n[10]=$D,$n[11]=$F,$n[12]=$R,$n[13]=$$,$n[14]=$A,$n[15]=$B;}$$($b,"laya.d3.math.Matrix4x4");var $m=$b.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.getElementByRowColumn=function($m,$p){if($m<0||3<$m)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($p<0||3<$p)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$m+$p];},$m.setElementByRowColumn=function($m,$p,$h){if($m<0||3<$m)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($p<0||3<$p)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$m+$p]=$h;},$m.equalsOtherMatrix=function($m){var $p=this.elements,$h=$m.elements;return $Om.nearEqual($p[0],$h[0])&&$Om.nearEqual($p[1],$h[1])&&$Om.nearEqual($p[2],$h[2])&&$Om.nearEqual($p[3],$h[3])&&$Om.nearEqual($p[4],$h[4])&&$Om.nearEqual($p[5],$h[5])&&$Om.nearEqual($p[6],$h[6])&&$Om.nearEqual($p[7],$h[7])&&$Om.nearEqual($p[8],$h[8])&&$Om.nearEqual($p[9],$h[9])&&$Om.nearEqual($p[10],$h[10])&&$Om.nearEqual($p[11],$h[11])&&$Om.nearEqual($p[12],$h[12])&&$Om.nearEqual($p[13],$h[13])&&$Om.nearEqual($p[14],$h[14])&&$Om.nearEqual($p[15],$h[15]);},$m.decomposeTransRotScale=function($m,$p,$h){var $P=$b._tempMatrix4x4;return this.decomposeTransRotMatScale($m,$P,$h)?($hp.createFromMatrix4x4($P,$p),!0):($p.identity(),!1);},$m.decomposeTransRotMatScale=function($m,$p,$h){var $P=this.elements,$L=$m.elements,$q=$p.elements,$k=$h.elements;$L[0]=$P[12],$L[1]=$P[13],$L[2]=$P[14];var $Y=$P[0],$d=$P[1],$K=$P[2],$D=$P[4],$F=$P[5],$R=$P[6],$$=$P[8],$A=$P[9],$B=$P[10],$n=$k[0]=Math.sqrt($Y*$Y+$d*$d+$K*$K),$c=$k[1]=Math.sqrt($D*$D+$F*$F+$R*$R),$e=$k[2]=Math.sqrt($$*$$+$A*$A+$B*$B);if($Om.isZero($n)||$Om.isZero($c)||$Om.isZero($e))return $q[1]=$q[2]=$q[3]=$q[4]=$q[6]=$q[7]=$q[8]=$q[9]=$q[11]=$q[12]=$q[13]=$q[14]=0,$q[0]=$q[5]=$q[10]=$q[15]=1,!1;var $a=$b._tempVector0,$Z=$a.elements;$Z[0]=$$/$e,$Z[1]=$A/$e,$Z[2]=$B/$e;var $H=$b._tempVector1,$W=$H.elements;$W[0]=$Y/$n,$W[1]=$d/$n,$W[2]=$K/$n;var $E=$b._tempVector2;$kp.cross($a,$H,$E);var $I=$b._tempVector1;return $kp.cross($E,$a,$I),$q[3]=$q[7]=$q[11]=$q[12]=$q[13]=$q[14]=0,$q[15]=1,$q[0]=$I.x,$q[1]=$I.y,$q[2]=$I.z,$q[4]=$E.x,$q[5]=$E.y,$q[6]=$E.z,$q[8]=$a.x,$q[9]=$a.y,$q[10]=$a.z,$q[0]*$Y+$q[1]*$d+$q[2]*$K<0&&($k[0]=-$n),$q[4]*$D+$q[5]*$F+$q[6]*$R<0&&($k[1]=-$c),$q[8]*$$+$q[9]*$A+$q[10]*$B<0&&($k[2]=-$e),!0;},$m.decomposeYawPitchRoll=function($m){var $p=$m.elements,$h=Math.asin(-this.elements[9]);$p[1]=$h,Math.cos($h)>$Om.zeroTolerance?($p[2]=Math.atan2(this.elements[1],this.elements[5]),$p[0]=Math.atan2(this.elements[8],this.elements[10])):($p[2]=Math.atan2(-this.elements[4],this.elements[0]),$p[0]=0);},$m.normalize=function(){var $m=this.elements,$p=$m[0],$h=$m[1],$P=$m[2],$L=Math.sqrt($p*$p+$h*$h+$P*$P);if(!$L)return $m[0]=0,$m[1]=0,void($m[2]=0);1!=$L&&($L=1/$L,$m[0]=$p*$L,$m[1]=$h*$L,$m[2]=$P*$L);},$m.transpose=function(){var $m,$p;return $p=($m=this.elements)[1],$m[1]=$m[4],$m[4]=$p,$p=$m[2],$m[2]=$m[8],$m[8]=$p,$p=$m[3],$m[3]=$m[12],$m[12]=$p,$p=$m[6],$m[6]=$m[9],$m[9]=$p,$p=$m[7],$m[7]=$m[13],$m[13]=$p,$p=$m[11],$m[11]=$m[14],$m[14]=$p,this;},$m.invert=function($m){var $p=this.elements,$h=$m.elements,$P=$p[0],$L=$p[1],$q=$p[2],$k=$p[3],$Y=$p[4],$d=$p[5],$K=$p[6],$D=$p[7],$F=$p[8],$R=$p[9],$$=$p[10],$A=$p[11],$B=$p[12],$n=$p[13],$c=$p[14],$e=$p[15],$a=$P*$d-$L*$Y,$Z=$P*$K-$q*$Y,$H=$P*$D-$k*$Y,$W=$L*$K-$q*$d,$E=$L*$D-$k*$d,$I=$q*$D-$k*$K,$b=$F*$n-$R*$B,$T=$F*$c-$$*$B,$j=$F*$e-$A*$B,$x=$R*$c-$$*$n,$Q=$R*$e-$A*$n,$M=$$*$e-$A*$c,$u=$a*$M-$Z*$Q+$H*$x+$W*$j-$E*$T+$I*$b;0!==Math.abs($u)&&($u=1/$u,$h[0]=($d*$M-$K*$Q+$D*$x)*$u,$h[1]=($q*$Q-$L*$M-$k*$x)*$u,$h[2]=($n*$I-$c*$E+$e*$W)*$u,$h[3]=($$*$E-$R*$I-$A*$W)*$u,$h[4]=($K*$j-$Y*$M-$D*$T)*$u,$h[5]=($P*$M-$q*$j+$k*$T)*$u,$h[6]=($c*$H-$B*$I-$e*$Z)*$u,$h[7]=($F*$I-$$*$H+$A*$Z)*$u,$h[8]=($Y*$Q-$d*$j+$D*$b)*$u,$h[9]=($L*$j-$P*$Q-$k*$b)*$u,$h[10]=($B*$E-$n*$H+$e*$a)*$u,$h[11]=($R*$H-$F*$E-$A*$a)*$u,$h[12]=($d*$T-$Y*$x-$K*$b)*$u,$h[13]=($P*$x-$L*$T+$q*$b)*$u,$h[14]=($n*$Z-$B*$W-$c*$a)*$u,$h[15]=($F*$W-$R*$Z+$$*$a)*$u);},$m.identity=function(){var $m=this.elements;$m[1]=$m[2]=$m[3]=$m[4]=$m[6]=$m[7]=$m[8]=$m[9]=$m[11]=$m[12]=$m[13]=$m[14]=0,$m[0]=$m[5]=$m[10]=$m[15]=1;},$m.cloneTo=function($m){var $p,$h,$P;if(($h=this.elements)!==($P=$m.elements))for($p=0;$p<16;++$p)$P[$p]=$h[$p];},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$m.getTranslationVector=function($m){var $p=this.elements,$h=$m.elements;$h[0]=$p[12],$h[1]=$p[13],$h[2]=$p[14];},$m.setTranslationVector=function($m){var $p=this.elements,$h=$m.elements;$p[12]=$h[0],$p[13]=$h[1],$p[14]=$h[2];},$m.getForward=function($m){var $p=this.elements,$h=$m.elements;$h[0]=-$p[8],$h[1]=-$p[9],$h[2]=-$p[10];},$m.setForward=function($m){var $p=this.elements,$h=$m.elements;$p[8]=-$h[0],$p[9]=-$h[1],$p[10]=-$h[2];},$b.createRotationX=function($m,$p){var $h=$p.elements,$P=Math.sin($m),$L=Math.cos($m);$h[1]=$h[2]=$h[3]=$h[4]=$h[7]=$h[8]=$h[11]=$h[12]=$h[13]=$h[14]=0,$h[0]=$h[15]=1,$h[5]=$h[10]=$L,$h[6]=$P,$h[9]=-$P;},$b.createRotationY=function($m,$p){var $h=$p.elements,$P=Math.sin($m),$L=Math.cos($m);$h[1]=$h[3]=$h[4]=$h[6]=$h[7]=$h[9]=$h[11]=$h[12]=$h[13]=$h[14]=0,$h[5]=$h[15]=1,$h[0]=$h[10]=$L,$h[2]=-$P,$h[8]=$P;},$b.createRotationZ=function($m,$p){var $h=$p.elements,$P=Math.sin($m),$L=Math.cos($m);$h[2]=$h[3]=$h[6]=$h[7]=$h[8]=$h[9]=$h[11]=$h[12]=$h[13]=$h[14]=0,$h[10]=$h[15]=1,$h[0]=$h[5]=$L,$h[1]=$P,$h[4]=-$P;},$b.createRotationYawPitchRoll=function($m,$p,$h,$P){$hp.createFromYawPitchRoll($m,$p,$h,$b._tempQuaternion),$b.createRotationQuaternion($b._tempQuaternion,$P);},$b.createRotationAxis=function($m,$p,$h){var $P=$m.elements,$L=$P[0],$q=$P[1],$k=$P[2],$Y=Math.cos($p),$d=Math.sin($p),$K=$L*$L,$D=$q*$q,$F=$k*$k,$R=$L*$q,$$=$L*$k,$A=$q*$k,$B=$h.elements;$B[3]=$B[7]=$B[11]=$B[12]=$B[13]=$B[14]=0,$B[15]=1,$B[0]=$K+$Y*(1-$K),$B[1]=$R-$Y*$R+$d*$k,$B[2]=$$-$Y*$$-$d*$q,$B[4]=$R-$Y*$R-$d*$k,$B[5]=$D+$Y*(1-$D),$B[6]=$A-$Y*$A+$d*$L,$B[8]=$$-$Y*$$+$d*$q,$B[9]=$A-$Y*$A-$d*$L,$B[10]=$F+$Y*(1-$F);},$b.createRotationQuaternion=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$h[0],$q=$h[1],$k=$h[2],$Y=$h[3],$d=$L*$L,$K=$q*$q,$D=$k*$k,$F=$L*$q,$R=$k*$Y,$$=$k*$L,$A=$q*$Y,$B=$q*$k,$n=$L*$Y;$P[3]=$P[7]=$P[11]=$P[12]=$P[13]=$P[14]=0,$P[15]=1,$P[0]=1-2*($K+$D),$P[1]=2*($F+$R),$P[2]=2*($$-$A),$P[4]=2*($F-$R),$P[5]=1-2*($D+$d),$P[6]=2*($B+$n),$P[8]=2*($$+$A),$P[9]=2*($B-$n),$P[10]=1-2*($K+$d);},$b.createTranslate=function($m,$p){var $h=$m.elements,$P=$p.elements;$P[4]=$P[8]=$P[1]=$P[9]=$P[2]=$P[6]=$P[3]=$P[7]=$P[11]=0,$P[0]=$P[5]=$P[10]=$P[15]=1,$P[12]=$h[0],$P[13]=$h[1],$P[14]=$h[2];},$b.createScaling=function($m,$p){var $h=$m.elements,$P=$p.elements;$P[0]=$h[0],$P[5]=$h[1],$P[10]=$h[2],$P[1]=$P[4]=$P[8]=$P[12]=$P[9]=$P[13]=$P[2]=$P[6]=$P[14]=$P[3]=$P[7]=$P[11]=0,$P[15]=1;},$b.multiply=function($m,$p,$h){var $P,$L,$q,$k,$Y,$d,$K,$D;for($L=$h.elements,$q=$m.elements,$L===($k=$p.elements)&&($k=$k.slice()),$P=0;$P<4;$P++)$Y=$q[$P],$d=$q[$P+4],$K=$q[$P+8],$D=$q[$P+12],$L[$P]=$Y*$k[0]+$d*$k[1]+$K*$k[2]+$D*$k[3],$L[$P+4]=$Y*$k[4]+$d*$k[5]+$K*$k[6]+$D*$k[7],$L[$P+8]=$Y*$k[8]+$d*$k[9]+$K*$k[10]+$D*$k[11],$L[$P+12]=$Y*$k[12]+$d*$k[13]+$K*$k[14]+$D*$k[15];},$b.createFromQuaternion=function($m,$p){var $h=$p.elements,$P=$m.elements,$L=$P[0],$q=$P[1],$k=$P[2],$Y=$P[3],$d=$L+$L,$K=$q+$q,$D=$k+$k,$F=$L*$d,$R=$q*$d,$$=$q*$K,$A=$k*$d,$B=$k*$K,$n=$k*$D,$c=$Y*$d,$e=$Y*$K,$a=$Y*$D;$h[0]=1-$$-$n,$h[1]=$R+$a,$h[2]=$A-$e,$h[3]=0,$h[4]=$R-$a,$h[5]=1-$F-$n,$h[6]=$B+$c,$h[7]=0,$h[8]=$A+$e,$h[9]=$B-$c,$h[10]=1-$F-$$,$h[11]=0,$h[12]=0,$h[13]=0,$h[14]=0,$h[15]=1;},$b.createAffineTransformation=function($m,$p,$h,$P){var $L=$m.elements,$q=$p.elements,$k=$h.elements,$Y=$P.elements,$d=$q[0],$K=$q[1],$D=$q[2],$F=$q[3],$R=$d+$d,$$=$K+$K,$A=$D+$D,$B=$d*$R,$n=$d*$$,$c=$d*$A,$e=$K*$$,$a=$K*$A,$Z=$D*$A,$H=$F*$R,$W=$F*$$,$E=$F*$A,$I=$k[0],$b=$k[1],$T=$k[2];$Y[0]=(1-($e+$Z))*$I,$Y[1]=($n+$E)*$I,$Y[2]=($c-$W)*$I,$Y[3]=0,$Y[4]=($n-$E)*$b,$Y[5]=(1-($B+$Z))*$b,$Y[6]=($a+$H)*$b,$Y[7]=0,$Y[8]=($c+$W)*$T,$Y[9]=($a-$H)*$T,$Y[10]=(1-($B+$e))*$T,$Y[11]=0,$Y[12]=$L[0],$Y[13]=$L[1],$Y[14]=$L[2],$Y[15]=1;},$b.createLookAt=function($m,$p,$h,$P){var $L=$P.elements,$q=$b._tempVector0,$k=$b._tempVector1,$Y=$b._tempVector2;$kp.subtract($m,$p,$Y),$kp.normalize($Y,$Y),$kp.cross($h,$Y,$q),$kp.normalize($q,$q),$kp.cross($Y,$q,$k),$P.identity(),$L[0]=$q.x,$L[4]=$q.y,$L[8]=$q.z,$L[1]=$k.x,$L[5]=$k.y,$L[9]=$k.z,$L[2]=$Y.x,$L[6]=$Y.y,$L[10]=$Y.z,$L[12]=-$kp.dot($q,$m),$L[13]=-$kp.dot($k,$m),$L[14]=-$kp.dot($Y,$m);},$b.createPerspective=function($m,$p,$h,$P,$L){var $q=$L.elements,$k=1/Math.tan($m/2),$Y=1/($h-$P);$q[0]=$k/$p,$q[5]=$k,$q[10]=($P+$h)*$Y,$q[11]=-1,$q[14]=2*$P*$h*$Y,$q[1]=$q[2]=$q[3]=$q[4]=$q[6]=$q[7]=$q[8]=$q[9]=$q[12]=$q[13]=$q[15]=0;},$b.createOrthoOffCenterRH=function($m,$p,$h,$P,$L,$q,$k){var $Y=$k.elements,$d=1/($m-$p),$K=1/($h-$P),$D=1/($L-$q);$Y[1]=$Y[2]=$Y[3]=$Y[4]=$Y[6]=$Y[7]=$Y[8]=$Y[9]=$Y[11]=0,$Y[15]=1,$Y[0]=-2*$d,$Y[5]=-2*$K,$Y[10]=2*$D,$Y[12]=($m+$p)*$d,$Y[13]=($P+$h)*$K,$Y[14]=($q+$L)*$D;},$b.translation=function($m,$p){var $h=$m.elements,$P=$p.elements;$P[0]=$P[5]=$P[10]=$P[15]=1,$P[12]=$h[0],$P[13]=$h[1],$P[14]=$h[2];},$F($b,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $b();},"_tempVector0",function(){return this._tempVector0=new $kp();},"_tempVector1",function(){return this._tempVector1=new $kp();},"_tempVector2",function(){return this._tempVector2=new $kp();},"_tempQuaternion",function(){return this._tempQuaternion=new $hp();},"DEFAULT",function(){return this.DEFAULT=new $b();},"ZERO",function(){return this.ZERO=new $b(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);}]),$b;}(),$pp=(function(){function $a($m,$p){this.extents=null,this.transformation=null,this.extents=$m,this.transformation=$p;}$$($a,"laya.d3.math.OrientedBoundBox");var $m=$a.prototype;$m.getCorners=function($m){var $p=$a._tempV30.elements,$h=$a._tempV31.elements,$P=$a._tempV32.elements,$L=this.extents.elements;$p[0]=$L[0],$p[1]=$p[2]=0,$h[1]=$L[1],$h[0]=$h[2]=0,$P[2]=$L[2],$P[0]=$P[1]=0,$kp.TransformNormal($a._tempV30,this.transformation,$a._tempV30),$kp.TransformNormal($a._tempV31,this.transformation,$a._tempV31),$kp.TransformNormal($a._tempV32,this.transformation,$a._tempV32);var $q=$a._tempV33;this.transformation.getTranslationVector($q),$m.length=8,$kp.add($q,$a._tempV30,$a._tempV34),$kp.add($a._tempV34,$a._tempV31,$a._tempV34),$kp.add($a._tempV34,$a._tempV32,$m[0]),$kp.add($q,$a._tempV30,$a._tempV34),$kp.add($a._tempV34,$a._tempV31,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV32,$m[1]),$kp.subtract($q,$a._tempV30,$a._tempV34),$kp.add($a._tempV34,$a._tempV31,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV32,$m[2]),$kp.subtract($q,$a._tempV30,$a._tempV34),$kp.add($a._tempV34,$a._tempV31,$a._tempV34),$kp.add($a._tempV34,$a._tempV32,$m[3]),$kp.add($q,$a._tempV30,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV31,$a._tempV34),$kp.add($a._tempV34,$a._tempV32,$m[4]),$kp.add($q,$a._tempV30,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV31,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV32,$m[5]),$kp.subtract($q,$a._tempV30,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV31,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV32,$m[6]),$kp.subtract($q,$a._tempV30,$a._tempV34),$kp.subtract($a._tempV34,$a._tempV31,$a._tempV34),$kp.add($a._tempV34,$a._tempV32,$m[7]);},$m.transform=function($m){$mp.multiply(this.transformation,$m,this.transformation);},$m.scale=function($m){$kp.multiply(this.extents,$m,this.extents);},$m.translate=function($m){this.transformation.getTranslationVector($a._tempV30),$kp.add($a._tempV30,$m,$a._tempV31),this.transformation.setTranslationVector($a._tempV31);},$m.Size=function($m){$kp.scale(this.extents,2,$m);},$m.getSize=function($m){var $p=this.extents.elements;$a._tempV30.x=$p[0],$a._tempV31.y=$p[1],$a._tempV32.z=$p[2],$kp.TransformNormal($a._tempV30,this.transformation,$a._tempV30),$kp.TransformNormal($a._tempV31,this.transformation,$a._tempV31),$kp.TransformNormal($a._tempV31,this.transformation,$a._tempV32);var $h=$m.elements;$h[0]=$kp.scalarLength($a._tempV30),$h[1]=$kp.scalarLength($a._tempV31),$h[2]=$kp.scalarLength($a._tempV32);},$m.getSizeSquared=function($m){var $p=this.extents.elements;$a._tempV30.x=$p[0],$a._tempV31.y=$p[1],$a._tempV32.z=$p[2],$kp.TransformNormal($a._tempV30,this.transformation,$a._tempV30),$kp.TransformNormal($a._tempV31,this.transformation,$a._tempV31),$kp.TransformNormal($a._tempV31,this.transformation,$a._tempV32);var $h=$m.elements;$h[0]=$kp.scalarLengthSquared($a._tempV30),$h[1]=$kp.scalarLengthSquared($a._tempV31),$h[2]=$kp.scalarLengthSquared($a._tempV32);},$m.getCenter=function($m){this.transformation.getTranslationVector($m);},$m.containsPoint=function($m){var $p=this.extents.elements,$h=$p[0],$P=$p[1],$L=$p[2];this.transformation.invert($a._tempM0),$kp.transformCoordinate($m,$a._tempM0,$a._tempV30);var $q=$a._tempV30.elements,$k=Math.abs($q[0]),$Y=Math.abs($q[1]),$d=Math.abs($q[2]);return $Om.nearEqual($k,$h)&&$Om.nearEqual($Y,$P)&&$Om.nearEqual($d,$L)?2:$k<$h&&$Y<$P&&$d<$L?1:0;},$m.containsPoints=function($m){var $p=this.extents.elements,$h=$p[0],$P=$p[1],$L=$p[2];this.transformation.invert($a._tempM0);for(var $q=!0,$k=!1,$Y=0;$Y<$m.length;$Y++){$kp.transformCoordinate($m[$Y],$a._tempM0,$a._tempV30);var $d=$a._tempV30.elements,$K=Math.abs($d[0]),$D=Math.abs($d[1]),$F=Math.abs($d[2]);$Om.nearEqual($K,$h)&&$Om.nearEqual($D,$P)&&$Om.nearEqual($F,$L)&&($k=!0),$K<$h&&$D<$P&&$F<$L?$k=!0:$q=!1;}return $q?1:$k?2:0;},$m.containsSphere=function($m,$p){void 0===$p&&($p=!1);var $h=this.extents.elements,$P=$h[0],$L=$h[1],$q=$h[2],$k=$m.radius;this.transformation.invert($a._tempM0),$kp.transformCoordinate($m.center,$a._tempM0,$a._tempV30);var $Y=NaN;if($Y=$p?$k:($kp.scale($kp.UnitX,$k,$a._tempV31),$kp.TransformNormal($a._tempV31,$a._tempM0,$a._tempV31),$kp.scalarLength($a._tempV31)),$kp.scale(this.extents,-1,$a._tempV32),$kp.Clamp($a._tempV30,$a._tempV32,this.extents,$a._tempV33),$Y*$Y<$kp.distanceSquared($a._tempV30,$a._tempV33))return 0;var $d=$a._tempV30.elements,$K=$d[0],$D=$d[1],$F=$d[2],$R=$a._tempV32.elements,$$=$R[0],$A=$R[1],$B=$R[2];return $$+$Y<=$K&&$K<=$P-$Y&&$Y<$P-$$&&$A+$Y<=$D&&$D<=$L-$Y&&$Y<$L-$A&&$B+$Y<=$F&&$F<=$q-$Y&&$Y<$q-$B?1:2;},$m.containsOrientedBoundBox=function($m){var $p=0,$h=0;$m.getCorners($a._corners);var $P=this.containsPoints($a._corners);if(0!=$P)return $P;var $L=this.extents.elements;$m.extents.cloneTo($a._tempV35);var $q=$a._tempV35.elements;$a._getRows(this.transformation,$a._rows1),$a._getRows($m.transformation,$a._rows2);var $k=NaN;for($p=0;$p<4;$p++)for($h=0;$h<4;$h++)3==$p||3==$h?($a._tempM0.setElementByRowColumn($p,$h,0),$a._tempM1.setElementByRowColumn($p,$h,0)):($k=$kp.dot($a._rows1[$p],$a._rows2[$h]),$a._tempM0.setElementByRowColumn($p,$h,$k),$a._tempM1.setElementByRowColumn($p,$h,Math.abs($k)));$m.getCenter($a._tempV34),this.getCenter($a._tempV36),$kp.subtract($a._tempV34,$a._tempV36,$a._tempV30);var $Y=$a._tempV31.elements;$Y[0]=$kp.dot($a._tempV30,$a._rows1[0]),$Y[1]=$kp.dot($a._tempV30,$a._rows1[1]),$Y[2]=$kp.dot($a._tempV30,$a._rows1[2]);var $d=$a._tempV32.elements,$K=$a._tempV33.elements;for($p=0;$p<3;$p++)if($d[0]=$a._tempM1.getElementByRowColumn($p,0),$d[1]=$a._tempM1.getElementByRowColumn($p,1),$d[2]=$a._tempM1.getElementByRowColumn($p,2),$L[$p]+$kp.dot($a._tempV35,$a._tempV32)<Math.abs($Y[$p]))return 0;for($h=0;$h<3;$h++)if($d[0]=$a._tempM1.getElementByRowColumn(0,$h),$d[1]=$a._tempM1.getElementByRowColumn(1,$h),$d[2]=$a._tempM1.getElementByRowColumn(2,$h),$K[0]=$a._tempM0.getElementByRowColumn(0,$h),$K[1]=$a._tempM0.getElementByRowColumn(1,$h),$K[2]=$a._tempM0.getElementByRowColumn(2,$h),$kp.dot(this.extents,$a._tempV32)+$q[$h]<Math.abs($kp.dot($a._tempV31,$a._tempV33)))return 0;for($p=0;$p<3;$p++)for($h=0;$h<3;$h++){var $D=($p+1)%3,$F=($p+2)%3,$R=($h+1)%3,$$=($h+2)%3;if($L[$D]*$a._tempM1.getElementByRowColumn($F,$h)+$L[$F]*$a._tempM1.getElementByRowColumn($D,$h)+($q[$R]*$a._tempM1.getElementByRowColumn($p,$$)+$q[$$]*$a._tempM1.getElementByRowColumn($p,$R))<Math.abs($Y[$F]*$a._tempM0.getElementByRowColumn($D,$h)-$Y[$D]*$a._tempM0.getElementByRowColumn($F,$h)))return 0;}return 2;},$m.containsLine=function($m,$p){$a._corners[0]=$m,$a._corners[1]=$p;var $h=this.containsPoints($a._corners);if(0!=$h)return $h;var $P=this.extents.elements,$L=$P[0],$q=$P[1],$k=$P[2];this.transformation.invert($a._tempM0),$kp.transformCoordinate($m,$a._tempM0,$a._tempV30),$kp.transformCoordinate($p,$a._tempM0,$a._tempV31),$kp.add($a._tempV30,$a._tempV31,$a._tempV32),$kp.scale($a._tempV32,.5,$a._tempV32),$kp.subtract($a._tempV30,$a._tempV32,$a._tempV33);var $Y=$a._tempV33.elements,$d=$Y[0],$K=$Y[1],$D=$Y[2],$F=$a._tempV34.elements,$R=$F[0]=Math.abs($Y[0]),$$=$F[1]=Math.abs($Y[1]),$A=$F[2]=Math.abs($Y[2]),$B=$a._tempV32.elements,$n=$B[0],$c=$B[1],$e=$B[2];return Math.abs($n)>$L+$R?0:Math.abs($c)>$q+$$?0:Math.abs($e)>$k+$A?0:Math.abs($c*$D-$e*$K)>$q*$A+$k*$$?0:Math.abs($n*$D-$e*$d)>$L*$A+$k*$R?0:Math.abs($n*$K-$c*$d)>$L*$$+$q*$R?0:2;},$m.containsBoundBox=function($m){var $p=0,$h=0,$P=$m.min,$L=$m.max;$m.getCorners($a._corners);var $q=this.containsPoints($a._corners);if(0!=$q)return $q;$kp.subtract($L,$P,$a._tempV30),$kp.scale($a._tempV30,.5,$a._tempV30),$kp.add($P,$a._tempV30,$a._tempV30),$kp.subtract($L,$a._tempV30,$a._tempV31);var $k=this.extents.elements,$Y=$a._tempV31.elements;$a._getRows(this.transformation,$a._rows1),this.transformation.invert($a._tempM0);for($p=0;$p<3;$p++)for($h=0;$h<3;$h++)$a._tempM1.setElementByRowColumn($p,$h,Math.abs($a._tempM0.getElementByRowColumn($p,$h)));this.getCenter($a._tempV35),$kp.subtract($a._tempV30,$a._tempV35,$a._tempV32);var $d=$a._tempV31.elements;$d[0]=$kp.dot($a._tempV32,$a._rows1[0]),$d[1]=$kp.dot($a._tempV32,$a._rows1[1]),$d[2]=$kp.dot($a._tempV32,$a._rows1[2]);var $K=$a._tempV33.elements,$D=$a._tempV34.elements;for($p=0;$p<3;$p++)if($K[0]=$a._tempM1.getElementByRowColumn($p,0),$K[1]=$a._tempM1.getElementByRowColumn($p,1),$K[2]=$a._tempM1.getElementByRowColumn($p,2),$k[$p]+$kp.dot($a._tempV31,$a._tempV33)<Math.abs($d[$p]))return 0;for($h=0;$h<3;$h++)if($K[0]=$a._tempM1.getElementByRowColumn(0,$h),$K[1]=$a._tempM1.getElementByRowColumn(1,$h),$K[2]=$a._tempM1.getElementByRowColumn(2,$h),$D[0]=$a._tempM0.getElementByRowColumn(0,$h),$D[1]=$a._tempM0.getElementByRowColumn(1,$h),$D[2]=$a._tempM0.getElementByRowColumn(2,$h),$kp.dot(this.extents,$a._tempV33)+$Y[$h]<Math.abs($kp.dot($a._tempV31,$a._tempV34)))return 0;for($p=0;$p<3;$p++)for($h=0;$h<3;$h++){var $F=($p+1)%3,$R=($p+2)%3,$$=($h+1)%3,$A=($h+2)%3;if($k[$F]*$a._tempM1.getElementByRowColumn($R,$h)+$k[$R]*$a._tempM1.getElementByRowColumn($F,$h)+($Y[$$]*$a._tempM1.getElementByRowColumn($p,$A)+$Y[$A]*$a._tempM1.getElementByRowColumn($p,$$))<Math.abs($d[$R]*$a._tempM0.getElementByRowColumn($F,$h)-$d[$F]*$a._tempM0.getElementByRowColumn($R,$h)))return 0;}return 2;},$m.intersectsRay=function($m,$p){$kp.scale(this.extents,-1,$a._tempV30),this.transformation.invert($a._tempM0),$kp.TransformNormal($m.direction,$a._tempM0,$a._ray.direction),$kp.transformCoordinate($m.origin,$a._tempM0,$a._ray.origin),$a._boxBound1.min=$a._tempV30,$a._boxBound1.max=this.extents;var $h=Collision.intersectsRayAndBoxRP($a._ray,$a._boxBound1,$p);return-1!==$h&&$kp.transformCoordinate($p,this.transformation,$p),$h;},$m._getLocalCorners=function($m){$m.length=8;var $p=this.extents.elements;$a._tempV30.x=$p[0],$a._tempV31.y=$p[1],$a._tempV32.z=$p[2],$kp.add($a._tempV30,$a._tempV31,$a._tempV33),$kp.add($a._tempV33,$a._tempV32,$m[0]),$kp.add($a._tempV30,$a._tempV31,$a._tempV33),$kp.subtract($a._tempV33,$a._tempV32,$m[1]),$kp.subtract($a._tempV31,$a._tempV30,$a._tempV33),$kp.subtract($a._tempV33,$a._tempV30,$m[2]),$kp.subtract($a._tempV31,$a._tempV30,$a._tempV33),$kp.add($a._tempV33,$a._tempV32,$m[3]),$kp.subtract($a._tempV30,$a._tempV31,$a._tempV33),$kp.add($a._tempV33,$a._tempV32,$m[4]),$kp.subtract($a._tempV30,$a._tempV31,$a._tempV33),$kp.subtract($a._tempV33,$a._tempV32,$m[5]),$kp.scale($m[0],-1,$m[6]),$kp.subtract($a._tempV32,$a._tempV30,$a._tempV33),$kp.subtract($a._tempV33,$a._tempV31,$m[7]);},$m.equals=function($m){return this.extents==$m.extents&&this.transformation==$m.transformation;},$m.cloneTo=function($m){var $p=$m;this.extents.cloneTo($p.extents),this.transformation.cloneTo($p.transformation);},$a.createByBoundBox=function($m,$p){var $h=$m.min,$P=$m.max;$kp.subtract($P,$h,$a._tempV30),$kp.scale($a._tempV30,.5,$a._tempV30),$kp.add($h,$a._tempV30,$a._tempV31),$kp.subtract($P,$a._tempV31,$a._tempV32),$mp.translation($a._tempV31,$a._tempM0);var $L=$a._tempV32.clone(),$q=$a._tempM0.clone();$p.extents=$L,$p.transformation=$q;},$a.createByMinAndMaxVertex=function($m,$p){return $kp.subtract($p,$m,$a._tempV30),$kp.scale($a._tempV30,.5,$a._tempV30),$kp.add($m,$a._tempV30,$a._tempV31),$kp.subtract($p,$a._tempV31,$a._tempV32),$mp.translation($a._tempV31,$a._tempM0),new $a($a._tempV32,$a._tempM0);},$a._getRows=function($m,$p){$p.length=3;var $h=$m.elements,$P=$p[0].elements;$P[0]=$h[0],$P[1]=$h[1],$P[2]=$h[2];var $L=$p[1].elements;$L[0]=$h[4],$L[1]=$h[5],$L[2]=$h[6];var $q=$p[2].elements;$q[0]=$h[8],$q[1]=$h[9],$q[2]=$h[10];},$a.getObbtoObbMatrix4x4=function($m,$p,$h,$P){var $L=$m.transformation,$q=$p.transformation;if($h){$a._getRows($L,$a._rows1),$a._getRows($q,$a._rows2);for(var $k=0;$k<3;$k++)for(var $Y=0;$Y<3;$Y++)$P.setElementByRowColumn($k,$Y,$kp.dot($a._rows2[$k],$a._rows1[$Y]));$p.getCenter($a._tempV30),$m.getCenter($a._tempV31),$kp.subtract($a._tempV30,$a._tempV31,$a._tempV32);var $d=$P.elements;$d[12]=$kp.dot($a._tempV32,$a._rows1[0]),$d[13]=$kp.dot($a._tempV32,$a._rows1[1]),$d[14]=$kp.dot($a._tempV32,$a._rows1[2]),$d[15]=1;}else $L.invert($a._tempM0),$mp.multiply($q,$a._tempM0,$P);},$a.merge=function($m,$p,$h){var $P=$m.extents,$L=$m.transformation;$a.getObbtoObbMatrix4x4($m,$p,$h,$a._tempM0),$p._getLocalCorners($a._corners),$kp.transformCoordinate($a._corners[0],$a._tempM0,$a._corners[0]),$kp.transformCoordinate($a._corners[1],$a._tempM0,$a._corners[1]),$kp.transformCoordinate($a._corners[2],$a._tempM0,$a._corners[2]),$kp.transformCoordinate($a._corners[3],$a._tempM0,$a._corners[3]),$kp.transformCoordinate($a._corners[4],$a._tempM0,$a._corners[4]),$kp.transformCoordinate($a._corners[5],$a._tempM0,$a._corners[5]),$kp.transformCoordinate($a._corners[6],$a._tempM0,$a._corners[6]),$kp.transformCoordinate($a._corners[7],$a._tempM0,$a._corners[7]),$kp.scale($P,-1,$a._boxBound1.min),$P.cloneTo($a._boxBound1.max),$vm.createfromPoints($a._corners,$a._boxBound2),$vm.merge($a._boxBound2,$a._boxBound1,$a._boxBound3);var $q=$a._boxBound3.min,$k=$a._boxBound3.max;$kp.subtract($k,$q,$a._tempV30),$kp.scale($a._tempV30,.5,$a._tempV30),$kp.add($q,$a._tempV30,$a._tempV32),$kp.subtract($k,$a._tempV32,$P),$kp.transformCoordinate($a._tempV32,$L,$a._tempV33);},$F($a,["_tempV30",function(){return this._tempV30=new $kp();},"_tempV31",function(){return this._tempV31=new $kp();},"_tempV32",function(){return this._tempV32=new $kp();},"_tempV33",function(){return this._tempV33=new $kp();},"_tempV34",function(){return this._tempV34=new $kp();},"_tempV35",function(){return this._tempV35=new $kp();},"_tempV36",function(){return this._tempV36=new $kp();},"_tempM0",function(){return this._tempM0=new $mp();},"_tempM1",function(){return this._tempM1=new $mp();},"_corners",function(){return this._corners=[new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp()];},"_rows1",function(){return this._rows1=[new $kp(),new $kp(),new $kp()];},"_rows2",function(){return this._rows2=[new $kp(),new $kp(),new $kp()];},"_ray",function(){return this._ray=new $Lp(new $kp(),new $kp());},"_boxBound1",function(){return this._boxBound1=new $vm(new $kp(),new $kp());},"_boxBound2",function(){return this._boxBound2=new $vm(new $kp(),new $kp());},"_boxBound3",function(){return this._boxBound3=new $vm(new $kp(),new $kp());}]);}(),function(){function $H($m,$p){this.normal=null,this.distance=NaN,void 0===$p&&($p=0),this.normal=$m,this.distance=$p;}return $$($H,"laya.d3.math.Plane"),$H.prototype.normalize=function(){var $m=this.normal.elements,$p=$m[0],$h=$m[1],$P=$m[2],$L=1/Math.sqrt($p*$p+$h*$h+$P*$P);$m[0]=$p*$L,$m[1]=$h*$L,$m[2]=$P*$L,this.distance*=$L;},$H.createPlaneBy3P=function($m,$p,$h){var $P=$m.elements,$L=$p.elements,$q=$h.elements,$k=$L[0]-$P[0],$Y=$L[1]-$P[1],$d=$L[2]-$P[2],$K=$q[0]-$P[0],$D=$q[1]-$P[1],$F=$q[2]-$P[2],$R=$Y*$F-$d*$D,$$=$d*$K-$k*$F,$A=$k*$D-$Y*$K,$B=1/Math.sqrt($R*$R+$$*$$+$A*$A),$n=$R*$B,$c=$$*$B,$e=$A*$B,$a=$H._TEMPVec3.elements;$a[0]=$n,$a[1]=$c,$a[2]=$e;var $Z=-($n*$P[0]+$c*$P[1]+$e*$P[2]);return new $H($H._TEMPVec3,$Z);},$H.PlaneIntersectionType_Back=0,$H.PlaneIntersectionType_Front=1,$H.PlaneIntersectionType_Intersecting=2,$F($H,["_TEMPVec3",function(){return this._TEMPVec3=new $kp();}]),$H;}()),$hp=function(){function $L($m,$p,$h,$P){this.elements=new Float32Array(4),void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=1),this.elements[0]=$m,this.elements[1]=$p,this.elements[2]=$h,this.elements[3]=$P;}$$($L,"laya.d3.math.Quaternion");var $m=$L.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.scaling=function($m,$p){var $h=$p.elements,$P=this.elements;$h[0]=$P[0]*$m,$h[1]=$P[1]*$m,$h[2]=$P[2]*$m,$h[3]=$P[3]*$m;},$m.normalize=function($m){var $p=$m.elements,$h=this.elements,$P=$h[0],$L=$h[1],$q=$h[2],$k=$h[3],$Y=$P*$P+$L*$L+$q*$q+$k*$k;0<$Y&&($Y=1/Math.sqrt($Y),$p[0]=$P*$Y,$p[1]=$L*$Y,$p[2]=$q*$Y,$p[3]=$k*$Y);},$m.length=function(){var $m=this.elements,$p=$m[0],$h=$m[1],$P=$m[2],$L=$m[3];return Math.sqrt($p*$p+$h*$h+$P*$P+$L*$L);},$m.rotateX=function($m,$p){var $h=$p.elements,$P=this.elements;$m*=.5;var $L=$P[0],$q=$P[1],$k=$P[2],$Y=$P[3],$d=Math.sin($m),$K=Math.cos($m);$h[0]=$L*$K+$Y*$d,$h[1]=$q*$K+$k*$d,$h[2]=$k*$K-$q*$d,$h[3]=$Y*$K-$L*$d;},$m.rotateY=function($m,$p){var $h=$p.elements,$P=this.elements;$m*=.5;var $L=$P[0],$q=$P[1],$k=$P[2],$Y=$P[3],$d=Math.sin($m),$K=Math.cos($m);$h[0]=$L*$K-$k*$d,$h[1]=$q*$K+$Y*$d,$h[2]=$k*$K+$L*$d,$h[3]=$Y*$K-$q*$d;},$m.rotateZ=function($m,$p){var $h=$p.elements,$P=this.elements;$m*=.5;var $L=$P[0],$q=$P[1],$k=$P[2],$Y=$P[3],$d=Math.sin($m),$K=Math.cos($m);$h[0]=$L*$K+$q*$d,$h[1]=$q*$K-$L*$d,$h[2]=$k*$K+$Y*$d,$h[3]=$Y*$K-$k*$d;},$m.getYawPitchRoll=function($m){$kp.transformQuat($kp.ForwardRH,this,$L.TEMPVector31),$kp.transformQuat($kp.Up,this,$L.TEMPVector32);var $p=$L.TEMPVector32.elements;$L.angleTo($kp.ZERO,$L.TEMPVector31,$L.TEMPVector33);var $h=$L.TEMPVector33.elements;$h[0]==Math.PI/2?($h[1]=$L.arcTanAngle($p[2],$p[0]),$h[2]=0):$h[0]==-Math.PI/2?($h[1]=$L.arcTanAngle(-$p[2],-$p[0]),$h[2]=0):($mp.createRotationY(-$h[1],$L.TEMPMatrix0),$mp.createRotationX(-$h[0],$L.TEMPMatrix1),$kp.transformCoordinate($L.TEMPVector32,$L.TEMPMatrix0,$L.TEMPVector32),$kp.transformCoordinate($L.TEMPVector32,$L.TEMPMatrix1,$L.TEMPVector32),$h[2]=$L.arcTanAngle($p[1],-$p[0])),$h[1]<=-Math.PI&&($h[1]=Math.PI),$h[2]<=-Math.PI&&($h[2]=Math.PI),$h[1]>=Math.PI&&$h[2]>=Math.PI&&($h[1]=0,$h[2]=0,$h[0]=Math.PI-$h[0]);var $P=$m.elements;$P[0]=$h[1],$P[1]=$h[0],$P[2]=$h[2];},$m.invert=function($m){var $p=$m.elements,$h=this.elements,$P=$h[0],$L=$h[1],$q=$h[2],$k=$h[3],$Y=$P*$P+$L*$L+$q*$q+$k*$k,$d=$Y?1/$Y:0;$p[0]=-$P*$d,$p[1]=-$L*$d,$p[2]=-$q*$d,$p[3]=$k*$d;},$m.identity=function(){var $m=this.elements;$m[0]=0,$m[1]=0,$m[2]=0,$m[3]=1;},$m.fromArray=function($m,$p){void 0===$p&&($p=0),this.elements[0]=$m[$p+0],this.elements[1]=$m[$p+1],this.elements[2]=$m[$p+2],this.elements[3]=$m[$p+3];},$m.cloneTo=function($m){var $p,$h,$P;if(($h=this.elements)!==($P=$m.elements))for($p=0;$p<4;++$p)$P[$p]=$h[$p];},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$m.equals=function($m){var $p=this.elements,$h=$m.elements;return $Om.nearEqual($p[0],$h[0])&&$Om.nearEqual($p[1],$h[1])&&$Om.nearEqual($p[2],$h[2])&&$Om.nearEqual($p[3],$h[3]);},$m.lengthSquared=function(){var $m=this.elements[0],$p=this.elements[1],$h=this.elements[2],$P=this.elements[3];return $m*$m+$p*$p+$h*$h+$P*$P;},$A(0,$m,"x",function(){return this.elements[0];}),$A(0,$m,"y",function(){return this.elements[1];}),$A(0,$m,"z",function(){return this.elements[2];}),$A(0,$m,"w",function(){return this.elements[3];}),$L.createFromYawPitchRoll=function($m,$p,$h,$P){var $L=.5*$h,$q=.5*$p,$k=.5*$m,$Y=Math.sin($L),$d=Math.cos($L),$K=Math.sin($q),$D=Math.cos($q),$F=Math.sin($k),$R=Math.cos($k),$$=$P.elements;$$[0]=$R*$K*$d+$F*$D*$Y,$$[1]=$F*$D*$d-$R*$K*$Y,$$[2]=$R*$D*$Y-$F*$K*$d,$$[3]=$R*$D*$d+$F*$K*$Y;},$L.multiply=function($m,$p,$h){var $P=$m.elements,$L=$p.elements,$q=$h.elements,$k=$P[0],$Y=$P[1],$d=$P[2],$K=$P[3],$D=$L[0],$F=$L[1],$R=$L[2],$$=$L[3],$A=$Y*$R-$d*$F,$B=$d*$D-$k*$R,$n=$k*$F-$Y*$D,$c=$k*$D+$Y*$F+$d*$R;$q[0]=$k*$$+$D*$K+$A,$q[1]=$Y*$$+$F*$K+$B,$q[2]=$d*$$+$R*$K+$n,$q[3]=$K*$$-$c;},$L.arcTanAngle=function($m,$p){return 0==$m?1==$p?Math.PI/2:-Math.PI/2:0<$m?Math.atan($p/$m):$m<0?0<$p?Math.atan($p/$m)+Math.PI:Math.atan($p/$m)-Math.PI:0;},$L.angleTo=function($m,$p,$h){$kp.subtract($p,$m,$L.TEMPVector30),$kp.normalize($L.TEMPVector30,$L.TEMPVector30),$h.elements[0]=Math.asin($L.TEMPVector30.y),$h.elements[1]=$L.arcTanAngle(-$L.TEMPVector30.z,-$L.TEMPVector30.x);},$L.createFromAxisAngle=function($m,$p,$h){var $P=$h.elements,$L=$m.elements;$p*=.5;var $q=Math.sin($p);$P[0]=$q*$L[0],$P[1]=$q*$L[1],$P[2]=$q*$L[2],$P[3]=Math.cos($p);},$L.createFromMatrix3x3=function($m,$p){var $h,$P=$p.elements,$L=$m.elements,$q=$L[0]+$L[4]+$L[8];if(0<$q)$h=Math.sqrt($q+1),$P[3]=.5*$h,$h=.5/$h,$P[0]=($L[5]-$L[7])*$h,$P[1]=($L[6]-$L[2])*$h,$P[2]=($L[1]-$L[3])*$h;else{var $k=0;$L[4]>$L[0]&&($k=1),$L[8]>$L[3*$k+$k]&&($k=2);var $Y=($k+1)%3,$d=($k+2)%3;$h=Math.sqrt($L[3*$k+$k]-$L[3*$Y+$Y]-$L[3*$d+$d]+1),$P[$k]=.5*$h,$h=.5/$h,$P[3]=($L[3*$Y+$d]-$L[3*$d+$Y])*$h,$P[$Y]=($L[3*$Y+$k]+$L[3*$k+$Y])*$h,$P[$d]=($L[3*$d+$k]+$L[3*$k+$d])*$h;}},$L.createFromMatrix4x4=function($m,$p){var $h,$P,$L=$m.elements,$q=$p.elements,$k=$L[0]+$L[5]+$L[10];0<$k?($h=Math.sqrt($k+1),$q[3]=.5*$h,$h=.5/$h,$q[0]=($L[6]-$L[9])*$h,$q[1]=($L[8]-$L[2])*$h,$q[2]=($L[1]-$L[4])*$h):$L[0]>=$L[5]&&$L[0]>=$L[10]?($P=.5/($h=Math.sqrt(1+$L[0]-$L[5]-$L[10])),$q[0]=.5*$h,$q[1]=($L[1]+$L[4])*$P,$q[2]=($L[2]+$L[8])*$P,$q[3]=($L[6]-$L[9])*$P):$L[5]>$L[10]?($P=.5/($h=Math.sqrt(1+$L[5]-$L[0]-$L[10])),$q[0]=($L[4]+$L[1])*$P,$q[1]=.5*$h,$q[2]=($L[9]+$L[6])*$P,$q[3]=($L[8]-$L[2])*$P):($P=.5/($h=Math.sqrt(1+$L[10]-$L[0]-$L[5])),$q[0]=($L[8]+$L[2])*$P,$q[1]=($L[9]+$L[6])*$P,$q[2]=.5*$h,$q[3]=($L[1]-$L[4])*$P);},$L.slerp=function($m,$p,$h,$P){var $L,$q,$k,$Y,$d,$K=$m.elements,$D=$p.elements,$F=$P.elements,$R=$K[0],$$=$K[1],$A=$K[2],$B=$K[3],$n=$D[0],$c=$D[1],$e=$D[2],$a=$D[3];return($q=$R*$n+$$*$c+$A*$e+$B*$a)<0&&($q=-$q,$n=-$n,$c=-$c,$e=-$e,$a=-$a),$d=1e-6<1-$q?($L=Math.acos($q),$k=Math.sin($L),$Y=Math.sin((1-$h)*$L)/$k,Math.sin($h*$L)/$k):($Y=1-$h,$h),$F[0]=$Y*$R+$d*$n,$F[1]=$Y*$$+$d*$c,$F[2]=$Y*$A+$d*$e,$F[3]=$Y*$B+$d*$a,$F;},$L.lerp=function($m,$p,$h,$P){var $L=$P.elements,$q=$m.elements,$k=$p.elements,$Y=$q[0],$d=$q[1],$K=$q[2],$D=$q[3];$L[0]=$Y+$h*($k[0]-$Y),$L[1]=$d+$h*($k[1]-$d),$L[2]=$K+$h*($k[2]-$K),$L[3]=$D+$h*($k[3]-$D);},$L.add=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]+$q[0],$P[1]=$L[1]+$q[1],$P[2]=$L[2]+$q[2],$P[3]=$L[3]+$q[3];},$L.dot=function($m,$p){var $h=$m.elements,$P=$p.elements;return $h[0]*$P[0]+$h[1]*$P[1]+$h[2]*$P[2]+$h[3]*$P[3];},$L.rotationLookAt=function($m,$p,$h){$L.lookAt($kp.ZERO,$m,$p,$h);},$L.lookAt=function($m,$p,$h,$P){$Cm.lookAt($m,$p,$h,$L._tempMatrix3x3),$L.rotationMatrix($L._tempMatrix3x3,$P);},$L.invert=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$m.lengthSquared();$Om.isZero($L)||($L=1/$L,$P[0]=-$h[0]*$L,$P[1]=-$h[1]*$L,$P[2]=-$h[2]*$L,$P[3]=$h[3]*$L);},$L.rotationMatrix=function($m,$p){var $h=$m.elements,$P=$h[0],$L=$h[1],$q=$h[2],$k=$h[3],$Y=$h[4],$d=$h[5],$K=$h[6],$D=$h[7],$F=$h[8],$R=$p.elements,$$=NaN,$A=NaN,$B=$P+$Y+$F;0<$B?($$=Math.sqrt($B+1),$R[3]=.5*$$,$$=.5/$$,$R[0]=($d-$D)*$$,$R[1]=($K-$q)*$$,$R[2]=($L-$k)*$$):$Y<=$P&&$F<=$P?($A=.5/($$=Math.sqrt(1+$P-$Y-$F)),$R[0]=.5*$$,$R[1]=($L+$k)*$A,$R[2]=($q+$K)*$A,$R[3]=($d-$D)*$A):$F<$Y?($A=.5/($$=Math.sqrt(1+$Y-$P-$F)),$R[0]=($k+$L)*$A,$R[1]=.5*$$,$R[2]=($D+$d)*$A,$R[3]=($K-$q)*$A):($A=.5/($$=Math.sqrt(1+$F-$P-$Y)),$R[0]=($K+$q)*$A,$R[1]=($D+$d)*$A,$R[2]=.5*$$,$R[3]=($L-$k)*$A);},$L.DEFAULT=new $L(),$F($L,["TEMPVector30",function(){return this.TEMPVector30=new $kp();},"TEMPVector31",function(){return this.TEMPVector31=new $kp();},"TEMPVector32",function(){return this.TEMPVector32=new $kp();},"TEMPVector33",function(){return this.TEMPVector33=new $kp();},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $mp();},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $mp();},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $Cm();},"NAN",function(){return this.NAN=new $L(NaN,NaN,NaN,NaN);}]),$L;}(),$Pp=function(){function $m($m){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$m,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1;}$$($m,"laya.d3.math.Rand");var $p=$m.prototype;return $p.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3];},$p.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607);},$p.getSignedFloat=function(){return 2*this.getFloat()-1;},$A(0,$p,"seed",function(){return this.seeds[0];},function($m){this.seeds[0]=$m,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1;}),$m.getFloatFromInt=function($m){return 1/8388607*(8388607&$m);},$m.getByteFromInt=function($m){return(8388607&$m)>>>15;},$m;}(),$Lp=(function(){function $L($m){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($m instanceof Array)||4!==$m.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$m[0],this._state0L=0|$m[1],this._state1U=0|$m[2],this._state1L=0|$m[3];}$$($L,"laya.d3.math.RandX");var $m=$L.prototype;$m.randomint=function(){var $m=this._state0U,$p=this._state0L,$h=this._state1U,$P=this._state1L,$L=($P>>>0)+($p>>>0),$q=$h+$m+($L/2>>>31)>>>0,$k=$L>>>0,$Y=0,$d=0;$Y=($m^=$Y=$m<<23|(-512&$p)>>>9)^(this._state0U=$h),$d=($p^=$d=$p<<23)^(this._state0L=$P);$Y^=$m>>>18,$d^=$p>>>18|(262143&$m)<<14;return $Y^=$h>>>5,$d^=$P>>>5|(31&$h)<<27,this._state1U=$Y,this._state1L=$d,[$q,$k];},$m.random=function(){var $m=this.randomint(),$p=$m[0],$h=1023<<20|$p>>>12,$P=0|($m[1]>>>12|(4095&$p)<<20);return $L._CONVERTION_BUFFER.setUint32(0,$h,!1),$L._CONVERTION_BUFFER.setUint32(4,$P,!1),$Pp._CONVERTION_BUFFER.getFloat64(0,!1)-1;},$F($L,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8));},"defaultRand",function(){return this.defaultRand=new $Pp([0,Date.now()/65536,0,Date.now()%65536]);}]);}(),function(){function $m($m,$p){this.origin=null,this.direction=null,this.origin=$m,this.direction=$p;}return $$($m,"laya.d3.math.Ray"),$m;}()),$qp=function(){function $m($m,$p){this.elements=new Float32Array(2),void 0===$m&&($m=0),void 0===$p&&($p=0);var $h=this.elements;$h[0]=$m,$h[1]=$p;}$$($m,"laya.d3.math.Vector2");var $p=$m.prototype;return $H.imps($p,{"laya.d3.core.IClone":!0}),$p.fromArray=function($m,$p){void 0===$p&&($p=0),this.elements[0]=$m[$p+0],this.elements[1]=$m[$p+1];},$p.cloneTo=function($m){var $p=$m.elements,$h=this.elements;$p[0]=$h[0],$p[1]=$h[1];},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"x",function(){return this.elements[0];},function($m){this.elements[0]=$m;}),$A(0,$p,"y",function(){return this.elements[1];},function($m){this.elements[1]=$m;}),$m.scale=function($m,$p,$h){var $P=$h.elements,$L=$m.elements;$P[0]=$L[0]*$p,$P[1]=$L[1]*$p;},$F($m,["ZERO",function(){return this.ZERO=new $m(0,0);},"ONE",function(){return this.ONE=new $m(1,1);}]),$m;}(),$kp=function(){function $D($m,$p,$h){this.elements=new Float32Array(3),void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0);var $P=this.elements;$P[0]=$m,$P[1]=$p,$P[2]=$h;}$$($D,"laya.d3.math.Vector3");var $m=$D.prototype;return $H.imps($m,{"laya.d3.core.IClone":!0}),$m.fromArray=function($m,$p){void 0===$p&&($p=0),this.elements[0]=$m[$p+0],this.elements[1]=$m[$p+1],this.elements[2]=$m[$p+2];},$m.cloneTo=function($m){var $p=$m.elements,$h=this.elements;$p[0]=$h[0],$p[1]=$h[1],$p[2]=$h[2];},$m.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$m.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0;},$m.reset=function($m,$p,$h){this.elements[0]=$m,this.elements[1]=$p,this.elements[2]=$h;},$A(0,$m,"x",function(){return this.elements[0];},function($m){this.elements[0]=$m;}),$A(0,$m,"y",function(){return this.elements[1];},function($m){this.elements[1]=$m;}),$A(0,$m,"z",function(){return this.elements[2];},function($m){this.elements[2]=$m;}),$D.distanceSquared=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$h[0]-$P[0],$q=$h[1]-$P[1],$k=$h[2]-$P[2];return $L*$L+$q*$q+$k*$k;},$D.distance=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$h[0]-$P[0],$q=$h[1]-$P[1],$k=$h[2]-$P[2];return Math.sqrt($L*$L+$q*$q+$k*$k);},$D.min=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=Math.min($L[0],$q[0]),$P[1]=Math.min($L[1],$q[1]),$P[2]=Math.min($L[2],$q[2]);},$D.max=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=Math.max($L[0],$q[0]),$P[1]=Math.max($L[1],$q[1]),$P[2]=Math.max($L[2],$q[2]);},$D.transformQuat=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements,$k=$L[0],$Y=$L[1],$d=$L[2],$K=$q[0],$D=$q[1],$F=$q[2],$R=$q[3],$$=$R*$k+$D*$d-$F*$Y,$A=$R*$Y+$F*$k-$K*$d,$B=$R*$d+$K*$Y-$D*$k,$n=-$K*$k-$D*$Y-$F*$d;$P[0]=$$*$R+$n*-$K+$A*-$F-$B*-$D,$P[1]=$A*$R+$n*-$D+$B*-$K-$$*-$F,$P[2]=$B*$R+$n*-$F+$$*-$D-$A*-$K;},$D.scalarLength=function($m){var $p=$m.elements,$h=$p[0],$P=$p[1],$L=$p[2];return Math.sqrt($h*$h+$P*$P+$L*$L);},$D.scalarLengthSquared=function($m){var $p=$m.elements,$h=$p[0],$P=$p[1],$L=$p[2];return $h*$h+$P*$P+$L*$L;},$D.normalize=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$h[0],$q=$h[1],$k=$h[2],$Y=$L*$L+$q*$q+$k*$k;0<$Y&&($Y=1/Math.sqrt($Y),$P[0]=$h[0]*$Y,$P[1]=$h[1]*$Y,$P[2]=$h[2]*$Y);},$D.multiply=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]*$q[0],$P[1]=$L[1]*$q[1],$P[2]=$L[2]*$q[2];},$D.scale=function($m,$p,$h){var $P=$h.elements,$L=$m.elements;$P[0]=$L[0]*$p,$P[1]=$L[1]*$p,$P[2]=$L[2]*$p;},$D.lerp=function($m,$p,$h,$P){var $L=$P.elements,$q=$m.elements,$k=$p.elements,$Y=$q[0],$d=$q[1],$K=$q[2];$L[0]=$Y+$h*($k[0]-$Y),$L[1]=$d+$h*($k[1]-$d),$L[2]=$K+$h*($k[2]-$K);},$D.transformV3ToV3=function($m,$p,$h){var $P=$D._tempVector4;$D.transformV3ToV4($m,$p,$P);var $L=$P.elements,$q=$h.elements;$q[0]=$L[0],$q[1]=$L[1],$q[2]=$L[2];},$D.transformV3ToV4=function($m,$p,$h){var $P=$m.elements,$L=$P[0],$q=$P[1],$k=$P[2],$Y=$p.elements,$d=$h.elements;$d[0]=$L*$Y[0]+$q*$Y[4]+$k*$Y[8]+$Y[12],$d[1]=$L*$Y[1]+$q*$Y[5]+$k*$Y[9]+$Y[13],$d[2]=$L*$Y[2]+$q*$Y[6]+$k*$Y[10]+$Y[14],$d[3]=$L*$Y[3]+$q*$Y[7]+$k*$Y[11]+$Y[15];},$D.TransformNormal=function($m,$p,$h){var $P=$m.elements,$L=$P[0],$q=$P[1],$k=$P[2],$Y=$p.elements,$d=$h.elements;$d[0]=$L*$Y[0]+$q*$Y[4]+$k*$Y[8],$d[1]=$L*$Y[1]+$q*$Y[5]+$k*$Y[9],$d[2]=$L*$Y[2]+$q*$Y[6]+$k*$Y[10];},$D.transformCoordinate=function($m,$p,$h){var $P=$D._tempVector4.elements,$L=$m.elements,$q=$L[0],$k=$L[1],$Y=$L[2],$d=$p.elements;$P[0]=$q*$d[0]+$k*$d[4]+$Y*$d[8]+$d[12],$P[1]=$q*$d[1]+$k*$d[5]+$Y*$d[9]+$d[13],$P[2]=$q*$d[2]+$k*$d[6]+$Y*$d[10]+$d[14],$P[3]=1/($q*$d[3]+$k*$d[7]+$Y*$d[11]+$d[15]);var $K=$h.elements;$K[0]=$P[0]*$P[3],$K[1]=$P[1]*$P[3],$K[2]=$P[2]*$P[3];},$D.Clamp=function($m,$p,$h,$P){var $L=$m.elements,$q=$L[0],$k=$L[1],$Y=$L[2],$d=$p.elements,$K=$d[0],$D=$d[1],$F=$d[2],$R=$h.elements,$$=$R[0],$A=$R[1],$B=$R[2],$n=$P.elements;$q=($q=$$<$q?$$:$q)<$K?$K:$q,$k=($k=$A<$k?$A:$k)<$D?$D:$k,$Y=($Y=$B<$Y?$B:$Y)<$F?$F:$Y,$n[0]=$q,$n[1]=$k,$n[2]=$Y;},$D.add=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]+$q[0],$P[1]=$L[1]+$q[1],$P[2]=$L[2]+$q[2];},$D.subtract=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]-$q[0],$P[1]=$L[1]-$q[1],$P[2]=$L[2]-$q[2];},$D.cross=function($m,$p,$h){var $P=$m.elements,$L=$p.elements,$q=$h.elements,$k=$P[0],$Y=$P[1],$d=$P[2],$K=$L[0],$D=$L[1],$F=$L[2];$q[0]=$Y*$F-$d*$D,$q[1]=$d*$K-$k*$F,$q[2]=$k*$D-$Y*$K;},$D.dot=function($m,$p){var $h=$m.elements,$P=$p.elements;return $h[0]*$P[0]+$h[1]*$P[1]+$h[2]*$P[2];},$D.equals=function($m,$p){var $h=$m.elements,$P=$p.elements;return $Om.nearEqual(Math.abs($h[0]),Math.abs($P[0]))&&$Om.nearEqual(Math.abs($h[1]),Math.abs($P[1]))&&$Om.nearEqual(Math.abs($h[2]),Math.abs($P[2]));},$D.ZERO=new $D(0,0,0),$D.ONE=new $D(1,1,1),$D.NegativeUnitX=new $D(-1,0,0),$D.UnitX=new $D(1,0,0),$D.UnitY=new $D(0,1,0),$D.UnitZ=new $D(0,0,1),$D.ForwardRH=new $D(0,0,-1),$D.ForwardLH=new $D(0,0,1),$D.Up=new $D(0,1,0),$D.NAN=new $D(NaN,NaN,NaN),$F($D,["_tempVector4",function(){return this._tempVector4=new $Yp();}]),$D;}(),$Yp=function(){function $m($m,$p,$h,$P){this.elements=new Float32Array(4),void 0===$m&&($m=0),void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=0);var $L=this.elements;$L[0]=$m,$L[1]=$p,$L[2]=$h,$L[3]=$P;}$$($m,"laya.d3.math.Vector4");var $p=$m.prototype;return $H.imps($p,{"laya.d3.core.IClone":!0}),$p.fromArray=function($m,$p){void 0===$p&&($p=0),this.elements[0]=$m[$p+0],this.elements[1]=$m[$p+1],this.elements[2]=$m[$p+2],this.elements[3]=$m[$p+3];},$p.cloneTo=function($m){var $p=$m.elements,$h=this.elements;$p[0]=$h[0],$p[1]=$h[1],$p[2]=$h[2],$p[3]=$h[3];},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$p.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);},$p.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;},$A(0,$p,"x",function(){return this.elements[0];},function($m){this.elements[0]=$m;}),$A(0,$p,"y",function(){return this.elements[1];},function($m){this.elements[1]=$m;}),$A(0,$p,"z",function(){return this.elements[2];},function($m){this.elements[2]=$m;}),$A(0,$p,"w",function(){return this.elements[3];},function($m){this.elements[3]=$m;}),$m.lerp=function($m,$p,$h,$P){var $L=$P.elements,$q=$m.elements,$k=$p.elements,$Y=$q[0],$d=$q[1],$K=$q[2],$D=$q[3];$L[0]=$Y+$h*($k[0]-$Y),$L[1]=$d+$h*($k[1]-$d),$L[2]=$K+$h*($k[2]-$K),$L[3]=$D+$h*($k[3]-$D);},$m.transformByM4x4=function($m,$p,$h){var $P=$m.elements,$L=$P[0],$q=$P[1],$k=$P[2],$Y=$P[3],$d=$p.elements,$K=$h.elements;$K[0]=$L*$d[0]+$q*$d[4]+$k*$d[8]+$Y*$d[12],$K[1]=$L*$d[1]+$q*$d[5]+$k*$d[9]+$Y*$d[13],$K[2]=$L*$d[2]+$q*$d[6]+$k*$d[10]+$Y*$d[14],$K[3]=$L*$d[3]+$q*$d[7]+$k*$d[11]+$Y*$d[15];},$m.equals=function($m,$p){var $h=$m.elements,$P=$p.elements;return $Om.nearEqual(Math.abs($h[0]),Math.abs($P[0]))&&$Om.nearEqual(Math.abs($h[1]),Math.abs($P[1]))&&$Om.nearEqual(Math.abs($h[2]),Math.abs($P[2]))&&$Om.nearEqual(Math.abs($h[3]),Math.abs($P[3]));},$m.normalize=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$m.length();0<$L&&($P[0]=$h[0]*$L,$P[1]=$h[1]*$L,$P[2]=$h[2]*$L,$P[3]=$h[3]*$L);},$m.add=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]+$q[0],$P[1]=$L[1]+$q[1],$P[2]=$L[2]+$q[2],$P[3]=$L[3]+$q[3];},$m.subtract=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]-$q[0],$P[1]=$L[1]-$q[1],$P[2]=$L[2]-$q[2],$P[3]=$L[3]-$q[3];},$m.multiply=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=$L[0]*$q[0],$P[1]=$L[1]*$q[1],$P[2]=$L[2]*$q[2],$P[3]=$L[3]*$q[3];},$m.scale=function($m,$p,$h){var $P=$h.elements,$L=$m.elements;$P[0]=$L[0]*$p,$P[1]=$L[1]*$p,$P[2]=$L[2]*$p,$P[3]=$L[3]*$p;},$m.Clamp=function($m,$p,$h,$P){var $L=$m.elements,$q=$L[0],$k=$L[1],$Y=$L[2],$d=$L[3],$K=$p.elements,$D=$K[0],$F=$K[1],$R=$K[2],$$=$K[3],$A=$h.elements,$B=$A[0],$n=$A[1],$c=$A[2],$e=$A[3],$a=$P.elements;$q=($q=$B<$q?$B:$q)<$D?$D:$q,$k=($k=$n<$k?$n:$k)<$F?$F:$k,$Y=($Y=$c<$Y?$c:$Y)<$R?$R:$Y,$d=($d=$e<$d?$e:$d)<$$?$$:$d,$a[0]=$q,$a[1]=$k,$a[2]=$Y,$a[3]=$d;},$m.distanceSquared=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$h[0]-$P[0],$q=$h[1]-$P[1],$k=$h[2]-$P[2],$Y=$h[3]-$P[3];return $L*$L+$q*$q+$k*$k+$Y*$Y;},$m.distance=function($m,$p){var $h=$m.elements,$P=$p.elements,$L=$h[0]-$P[0],$q=$h[1]-$P[1],$k=$h[2]-$P[2],$Y=$h[3]-$P[3];return Math.sqrt($L*$L+$q*$q+$k*$k+$Y*$Y);},$m.dot=function($m,$p){var $h=$m.elements,$P=$p.elements;return $h[0]*$P[0]+$h[1]*$P[1]+$h[2]*$P[2]+$h[3]*$P[3];},$m.min=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=Math.min($L[0],$q[0]),$P[1]=Math.min($L[1],$q[1]),$P[2]=Math.min($L[2],$q[2]),$P[3]=Math.min($L[3],$q[3]);},$m.max=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p.elements;$P[0]=Math.max($L[0],$q[0]),$P[1]=Math.max($L[1],$q[1]),$P[2]=Math.max($L[2],$q[2]),$P[3]=Math.max($L[3],$q[3]);},$F($m,["ZERO",function(){return this.ZERO=new $m();},"ONE",function(){return this.ONE=new $m(1,1,1,1);},"UnitX",function(){return this.UnitX=new $m(1,0,0,0);},"UnitY",function(){return this.UnitY=new $m(0,1,0,0);},"UnitZ",function(){return this.UnitZ=new $m(0,0,1,0);},"UnitW",function(){return this.UnitW=new $m(0,0,0,1);}]),$m;}(),$dp=function(){function $q($m,$p,$h,$P){this.minDepth=0,this.maxDepth=1,this.x=$m,this.y=$p,this.width=$h,this.height=$P;}$$($q,"laya.d3.math.Viewport");var $m=$q.prototype;return $m.project=function($m,$p,$h){$kp.transformV3ToV3($m,$p,$h);var $P=$m.elements,$L=$p.elements,$q=$h.elements,$k=$P[0]*$L[3]+$P[1]*$L[7]+$P[2]*$L[11]+$L[15];1!==$k&&($q[0]=$q[0]/$k,$q[1]=$q[1]/$k,$q[2]=$q[2]/$k),$q[0]=.5*($q[0]+1)*this.width+this.x,$q[1]=.5*(1-$q[1])*this.height+this.y,$q[2]=$q[2]*(this.maxDepth-this.minDepth)+this.minDepth;},$m.unprojectFromMat=function($m,$p,$h){var $P=$m.elements,$L=$p.elements,$q=$h.elements;$q[0]=($P[0]-this.x)/this.width*2-1,$q[1]=-(($P[1]-this.y)/this.height*2-1);var $k=(this.maxDepth-this.minDepth)/2;$q[2]=($P[2]-this.minDepth-$k)/$k;var $Y=$q[0]*$L[3]+$q[1]*$L[7]+$q[2]*$L[11]+$L[15];$kp.transformV3ToV3($h,$p,$h),1!==$Y&&($q[0]=$q[0]/$Y,$q[1]=$q[1]/$Y,$q[2]=$q[2]/$Y);},$m.unprojectFromWVP=function($m,$p,$h,$P,$L){$mp.multiply($p,$h,$q._tempMatrix4x4),$P&&$mp.multiply($q._tempMatrix4x4,$P,$q._tempMatrix4x4),$q._tempMatrix4x4.invert($q._tempMatrix4x4),this.unprojectFromMat($m,$q._tempMatrix4x4,$L);},$F($q,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $mp();}]),$q;}(),$Kp=function(){function $x($m){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$m,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[];}$$($x,"laya.d3.resource.models.SubMesh");var $m=$x.prototype;return $H.imps($m,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$m._getVertexBuffer=function($m){return void 0===$m&&($m=0),0===$m?this._vertexBuffer:null;},$m._getIndexBuffer=function(){return this._indexBuffer;},$m._getStaticBatchBakedVertexs=function($m,$p){var $h,$P,$L=this._vertexBuffer,$q=$L.vertexDeclaration,$k=$q.getVertexElementByUsage(0).offset/4,$Y=$q.getVertexElementByUsage(3).offset/4,$d=$p.meshRender.lightmapScaleOffset,$K=0,$D=0,$F=0,$R=0,$$=0,$A=0;if($d){if($P=$q.getVertexElementByUsage(15))$F=$q.vertexStride/4,$h=0<this._vertexCount?$L.getData().slice(this._vertexStart*$F,(this._vertexStart+this._vertexCount)*$F):$L.getData().slice(),$R=$P.offset/4;else{$F=($A=$q.vertexStride/4)+2,$h=this._vertexCount?new Float32Array(this._vertexCount*($L.vertexDeclaration.vertexStride/4+2)):new Float32Array($L.vertexCount*($L.vertexDeclaration.vertexStride/4+2)),$R=($$=$q.getVertexElementByUsage(2).offset/4)+2;var $B=$L.getData();for($K=0,$D=$B.length/$A;$K<$D;$K++){var $n=0;$n=0<this._vertexCount?(this._vertexStart+$K)*$A:$K*$A;var $c=$K*$F,$e=0;for($e=0;$e<$R;$e++)$h[$c+$e]=$B[$n+$e];for($e=$R;$e<$A;$e++)$h[$c+$e+2]=$B[$n+$e];}}}else $F=$q.vertexStride/4,$h=this._vertexCount?$L.getData().slice(this._vertexStart*$F,(this._vertexStart+this._vertexCount)*$F):$L.getData().slice();if($m){var $a=$m.worldMatrix,$Z=$x._tempMatrix4x40;$a.invert($Z);var $H=$x._tempMatrix4x41,$W=$p.transform.worldMatrix;$mp.multiply($Z,$W,$H);}else $H=$p.transform.worldMatrix;var $E=$x._tempQuaternion0;for($H.decomposeTransRotScale($x._tempVector30,$E,$x._tempVector31),$K=0,$D=$h.length/$F;$K<$D;$K++){var $I=$K*$F+$k,$b=$K*$F+$Y;if($np.transformVector3ArrayToVector3ArrayCoordinate($h,$I,$H,$h,$I),$np.transformVector3ArrayByQuat($h,$b,$E,$h,$b),$d){var $T=$K*$F+$R;if($P)$np.transformLightingMapTexcoordByUV1Array($h,$T,$d,$h,$T);else{var $j=$K*$A+$$;$np.transformLightingMapTexcoordByUV0Array($B,$j,$d,$h,$T);}}}return $h;},$m._getVertexBuffers=function(){return null;},$m._beforeRender=function($m){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0;},$m._render=function($m){var $p,$h=0,$P=$m.renderElement;if(1<this._indexCount){var $L=this._boneIndicesList.length;if(1<$L){for(var $q=0;$q<$L;$q++)($p=$P._skinAnimationDatas||this._skinAnimationDatas)&&($P._shaderValue.setValue(0,$p[$q]),$m._shader.uploadRenderElementUniforms($P._shaderValue.data)),$Q.mainContext.drawElements(4,this._subIndexBufferCount[$q],5123,2*this._subIndexBufferStart[$q]);$I.drawCall+=$L;}else($p=$P._skinAnimationDatas||this._skinAnimationDatas)&&($P._shaderValue.setValue(0,$p[0]),$m._shader.uploadRenderElementUniforms($P._shaderValue.data)),$Q.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$I.drawCall++;$h=this._indexCount;}else $h=this._indexBuffer.indexCount,($p=$P._skinAnimationDatas||this._skinAnimationDatas)&&($P._shaderValue.setValue(0,$p[0]),$m._shader.uploadRenderElementUniforms($P._shaderValue.data)),$Q.mainContext.drawElements(4,$h,5123,0),$I.drawCall++;$I.trianglesFaces+=$h/3;},$m.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData();},$m.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null;},$A(0,$m,"_vertexBufferCount",function(){return 1;}),$A(0,$m,"triangleCount",function(){return this._indexBuffer.indexCount/3;}),$F($x,["_tempVector30",function(){return this._tempVector30=new $kp();},"_tempVector31",function(){return this._tempVector31=new $kp();},"_tempQuaternion0",function(){return this._tempQuaternion0=new $hp();},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $mp();},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $mp();}]),$x;}(),$Dp=function(){function $m($m){this.defineCounter=0,this.defines=null,$m?(this.defineCounter=$m.defineCounter,this.defines=$m.defines.slice()):(this.defineCounter=0,this.defines=[]);}return $$($m,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$m.prototype.registerDefine=function($m){var $p=Math.pow(2,this.defineCounter++);return this.defines[$p]=$m,$p;},$m;}(),$Fp=function(){function $m(){}return $$($m,"laya.d3.shader.ShaderInit3D"),$m.__init__=function(){var $m,$p;$Ip._globalRegDefine("HIGHPRECISION",$Ip.SHADERDEFINE_HIGHPRECISION),$Ip._globalRegDefine("FOG",$Ip.SHADERDEFINE_FOG),$Ip._globalRegDefine("DIRECTIONLIGHT",$Ip.SHADERDEFINE_DIRECTIONLIGHT),$Ip._globalRegDefine("POINTLIGHT",$Ip.SHADERDEFINE_POINTLIGHT),$Ip._globalRegDefine("SPOTLIGHT",$Ip.SHADERDEFINE_SPOTLIGHT),$Ip._globalRegDefine("UV",$Ip.SHADERDEFINE_UV0),$Ip._globalRegDefine("COLOR",$Ip.SHADERDEFINE_COLOR),$Ip._globalRegDefine("UV1",$Ip.SHADERDEFINE_UV1),$Ip._globalRegDefine("CASTSHADOW",$$p.SHADERDEFINE_CAST_SHADOW),$Ip._globalRegDefine("SHADOWMAP_PSSM1",$$p.SHADERDEFINE_SHADOW_PSSM1),$Ip._globalRegDefine("SHADOWMAP_PSSM2",$$p.SHADERDEFINE_SHADOW_PSSM2),$Ip._globalRegDefine("SHADOWMAP_PSSM3",$$p.SHADERDEFINE_SHADOW_PSSM3),$Ip._globalRegDefine("SHADOWMAP_PCF_NO",$$p.SHADERDEFINE_SHADOW_PCF_NO),$Ip._globalRegDefine("SHADOWMAP_PCF1",$$p.SHADERDEFINE_SHADOW_PCF1),$Ip._globalRegDefine("SHADOWMAP_PCF2",$$p.SHADERDEFINE_SHADOW_PCF2),$Ip._globalRegDefine("SHADOWMAP_PCF3",$$p.SHADERDEFINE_SHADOW_PCF3),$Ip._globalRegDefine("DEPTHFOG",$Ip.SAHDERDEFINE_DEPTHFOG),$lp.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$lp.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$m={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$p={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $h=$lp.nameKey.add("SIMPLE");shaderCompile=$Ip.add($h,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$m,$p),$Jp.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$Jp.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$Jp.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$Jp.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$Jp.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$Jp.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$Jp.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$Jp.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$Jp.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG");},$m;}(),$Rp=function(){function $m(){this._data=null,this._data=[];}$$($m,"laya.d3.shader.ValusArray");var $p=$m.prototype;return $p.setValue=function($m,$p){this._data[$m]=$p;},$A(0,$p,"data",function(){return this._data;}),$m;}(),$$p=function(){function $m(){}return $m.SHADERDEFINE_RECEIVE_SHADOW=1,$m.SHADERDEFINE_CAST_SHADOW=512,$m.SHADERDEFINE_SHADOW_PSSM1=1024,$m.SHADERDEFINE_SHADOW_PSSM2=2048,$m.SHADERDEFINE_SHADOW_PSSM3=4096,$m.SHADERDEFINE_SHADOW_PCF_NO=8192,$m.SHADERDEFINE_SHADOW_PCF1=16384,$m.SHADERDEFINE_SHADOW_PCF2=32768,$m.SHADERDEFINE_SHADOW_PCF3=65536,$m.MAX_PSSM_COUNT=3,$m;}(),$Ap=function(){function $f(){}return $$($f,"laya.d3.utils.Picker"),$f.calculateCursorRay=function($m,$p,$h,$P,$L,$q){var $k=$m.elements[0],$Y=$m.elements[1],$d=$f._tempVector30,$K=$d.elements;$K[0]=$k,$K[1]=$Y,$K[2]=$p.minDepth;var $D=$f._tempVector31,$F=$D.elements;$F[0]=$k,$F[1]=$Y,$F[2]=$p.maxDepth;var $R=$q.origin,$$=$f._tempVector32;$p.unprojectFromWVP($d,$h,$P,$L,$R),$p.unprojectFromWVP($D,$h,$P,$L,$$);var $A=$q.direction.elements;$A[0]=$$.x-$R.x,$A[1]=$$.y-$R.y,$A[2]=$$.z-$R.z,$kp.normalize($q.direction,$q.direction);},$f.rayIntersectsPositionsAndIndices=function($m,$p,$h,$P,$L){for(var $q=$h.vertexStride/4,$k=$h.getVertexElementByUsage(0).offset/4,$Y=Number.MAX_VALUE,$d=-1,$K=-1,$D=-1,$F=0;$F<$P.length;$F+=3){var $R=$f._tempVector35,$$=$R.elements,$A=$P[$F]*$q,$B=$A+$k;$$[0]=$p[$B],$$[1]=$p[1+$B],$$[2]=$p[2+$B];var $n=$f._tempVector36,$c=$n.elements,$e=$P[$F+1]*$q,$a=$e+$k;$c[0]=$p[$a],$c[1]=$p[1+$a],$c[2]=$p[2+$a];var $Z=$f._tempVector37,$H=$Z.elements,$W=$P[$F+2]*$q,$E=$W+$k;$H[0]=$p[$E],$H[1]=$p[1+$E],$H[2]=$p[2+$E];var $I=laya.d3.utils.Picker.rayIntersectsTriangle($m,$R,$n,$Z);!isNaN($I)&&$I<$Y&&($Y=$I,$d=$A,$K=$e,$D=$W);}if($Y===Number.MAX_VALUE)return $L.position.toDefault(),$L.distance=Number.MAX_VALUE,$L.trianglePositions[0].toDefault(),$L.trianglePositions[1].toDefault(),$L.trianglePositions[2].toDefault(),$L.triangleNormals[0].toDefault(),$L.triangleNormals[1].toDefault(),$L.triangleNormals[2].toDefault(),!1;$L.distance=$Y,$kp.scale($m.direction,$Y,$L.position),$kp.add($m.origin,$L.position,$L.position);var $b=$L.trianglePositions,$T=$b[0],$j=$b[1],$x=$b[2],$Q=$T.elements,$M=$j.elements,$u=$x.elements,$N=$d+$k;$Q[0]=$p[$N],$Q[1]=$p[$N+1],$Q[2]=$p[$N+2];var $S=$K+$k;$M[0]=$p[$S],$M[1]=$p[$S+1],$M[2]=$p[$S+2];var $_=$D+$k;$u[0]=$p[$_],$u[1]=$p[$_+1],$u[2]=$p[$_+2];var $l=$h.getVertexElementByUsage(3);if($l){var $J=$l.offset/4,$z=$L.triangleNormals,$w=$z[0],$X=$z[1],$s=$z[2],$G=$w.elements,$U=$X.elements,$r=$s.elements,$y=$d+$J;$G[0]=$p[$y],$G[1]=$p[$y+1],$G[2]=$p[$y+2];var $V=$K+$J;$U[0]=$p[$V],$U[1]=$p[$V+1],$U[2]=$p[$V+2];var $o=$D+$J;$r[0]=$p[$o],$r[1]=$p[$o+1],$r[2]=$p[$o+2];}return!0;},$f.rayIntersectsTriangle=function($m,$p,$h,$P){var $L=$f._tempVector30,$q=$f._tempVector31;$kp.subtract($h,$p,$L),$kp.subtract($P,$p,$q);var $k,$Y=$f._tempVector32;if($kp.cross($m.direction,$q,$Y),($k=$kp.dot($L,$Y))>-Number.MIN_VALUE&&$k<Number.MIN_VALUE)return Number.NaN;var $d,$K=1/$k,$D=$f._tempVector33;if($kp.subtract($m.origin,$p,$D),$d=$kp.dot($D,$Y),($d*=$K)<0||1<$d)return Number.NaN;var $F,$R,$$=$f._tempVector34;return $kp.cross($D,$L,$$),$F=$kp.dot($m.direction,$$),($F*=$K)<0||1<$d+$F?Number.NaN:($R=$kp.dot($q,$$),($R*=$K)<0?Number.NaN:$R);},$F($f,["_tempVector30",function(){return this._tempVector30=new $kp();},"_tempVector31",function(){return this._tempVector31=new $kp();},"_tempVector32",function(){return this._tempVector32=new $kp();},"_tempVector33",function(){return this._tempVector33=new $kp();},"_tempVector34",function(){return this._tempVector34=new $kp();},"_tempVector35",function(){return this._tempVector35=new $kp();},"_tempVector36",function(){return this._tempVector36=new $kp();},"_tempVector37",function(){return this._tempVector37=new $kp();}]),$f;}(),$Bp=(function(){function $m(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $kp(),new $kp(),new $kp()],this.trianglePositions.length=3,this.triangleNormals=[new $kp(),new $kp(),new $kp()],this.triangleNormals.length=3,this.position=new $kp();}$$($m,"laya.d3.utils.RaycastHit"),$m.prototype.cloneTo=function($m){$m.distance=this.distance,this.trianglePositions[0].cloneTo($m.trianglePositions[0]),this.trianglePositions[1].cloneTo($m.trianglePositions[1]),this.trianglePositions[2].cloneTo($m.trianglePositions[2]),this.triangleNormals[0].cloneTo($m.triangleNormals[0]),this.triangleNormals[1].cloneTo($m.triangleNormals[1]),this.triangleNormals[2].cloneTo($m.triangleNormals[2]),this.position.cloneTo($m.position),$m.sprite3D=this.sprite3D;};}(),function(){function $m($m,$p){this._width=0,this._height=0,this._width=$m,this._height=$p;}$$($m,"laya.d3.utils.Size");var $p=$m.prototype;return $A(0,$p,"width",function(){return-1===this._width?$i.clientWidth:this._width;}),$A(0,$p,"height",function(){return-1===this._height?$i.clientHeight:this._height;}),$A(1,$m,"fullScreen",function(){return new $m(-1,-1);}),$m;}()),$np=function(){function $N(){}return $$($N,"laya.d3.utils.Utils3D"),$N._rotationTransformScaleSkinAnimation=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F){var $R,$$,$A,$B,$n,$c=$N._tempArray16_0,$e=$N._tempArray16_1,$a=$N._tempArray16_2,$Z=$P+$P,$H=$L+$L,$W=$q+$q,$E=$P*$Z,$I=$L*$Z,$b=$L*$H,$T=$q*$Z,$j=$q*$H,$x=$q*$W,$Q=$k*$Z,$M=$k*$H,$u=$k*$W;for($c[15]=1,$c[0]=1-$b-$x,$c[1]=$I+$u,$c[2]=$T-$M,$c[4]=$I-$u,$c[5]=1-$E-$x,$c[6]=$j+$Q,$c[8]=$T+$M,$c[9]=$j-$Q,$c[10]=1-$E-$b,$e[15]=1,$e[0]=$Y,$e[5]=$d,$e[10]=$K,$R=0;$R<4;$R++)$$=$c[$R],$A=$c[$R+4],$B=$c[$R+8],$n=$c[$R+12],$a[$R]=$$,$a[$R+4]=$A,$a[$R+8]=$B,$a[$R+12]=$$*$m+$A*$p+$B*$h+$n;for($R=0;$R<4;$R++)$$=$a[$R],$A=$a[$R+4],$B=$a[$R+8],$n=$a[$R+12],$D[$R+$F]=$$*$e[0]+$A*$e[1]+$B*$e[2]+$n*$e[3],$D[$R+$F+4]=$$*$e[4]+$A*$e[5]+$B*$e[6]+$n*$e[7],$D[$R+$F+8]=$$*$e[8]+$A*$e[9]+$B*$e[10]+$n*$e[11],$D[$R+$F+12]=$$*$e[12]+$A*$e[13]+$B*$e[14]+$n*$e[15];},$N._createNodeByJson=function($m,$p,$h,$P){if(!$h)switch($p.type){case"Sprite3D":$h=new $_p();break;case"MeshSprite3D":$h=new $fp();break;case"SkinnedMeshSprite3D":$h=new SkinnedMeshSprite3D();break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$h=new ShuriKenParticle3D();break;case"TrailSprite3D":$h=new TrailSprite3D();break;case"Terrain":$h=new Terrain();break;case"Camera":$h=new $op();break;case"DirectionLight":$h=new DirectionLight();break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.");}var $L=$p.props;if($L)for(var $q in $L)$h[$q]=$L[$q];var $k=$p.customProps;$k&&($h instanceof laya.d3.core.Sprite3D?($h._parseBaseCustomProps($k),$h._parseCustomProps($m,$P,$k,$p),$h._parseCustomComponent($m,$P,$p.components)):$h._parseCustomProps($m,$P,$k,$p));var $Y=$p.child;if($Y)for(var $d=0,$K=$Y.length;$d<$K;$d++){var $D=$N._createNodeByJson($m,$Y[$d],null,$P);$h.addChild($D);}return $h;},$N._computeBoneAndAnimationDatasByBindPoseMatrxix=function($m,$p,$h,$P,$L,$q){var $k,$Y,$d=0,$K=0,$D=$m.length;for($k=0;$k<$D;$d+=$m[$k].keyframeWidth,$K+=16,$k++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($p[$d+0],$p[$d+1],$p[$d+2],$p[$d+3],$p[$d+4],$p[$d+5],$p[$d+6],$p[$d+7],$p[$d+8],$p[$d+9],$P,$K),0!=$k&&($Y=16*$m[$k].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($P,$Y,$P,$K,$P,$K));var $F=$h.length;for($k=0;$k<$F;$k++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($P,16*$q[$k],$h[$k],$L,16*$k);},$N._computeAnimationDatasByArrayAndMatrixFast=function($m,$p,$h,$P){for(var $L=0,$q=$m.length;$L<$q;$L++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($p,16*$P[$L],$m[$L],$h,16*$L);},$N._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($m,$p,$h,$P,$L){var $q,$k,$Y=0,$d=0,$K=$m.length;for($q=0;$q<$K;$Y+=$m[$q].keyframeWidth,$d+=16,$q++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($p[$Y+7],$p[$Y+8],$p[$Y+9],$p[$Y+3],$p[$Y+4],$p[$Y+5],$p[$Y+6],$p[$Y+0],$p[$Y+1],$p[$Y+2],$P,$d),0!=$q&&($k=16*$m[$q].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($P,$k,$P,$d,$P,$d));var $D=$h.length;for($q=0;$q<$D;$q++){var $F=16*$q;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($P,$F,$h[$q],$L,$F);}},$N._computeAnimationDatasByArrayAndMatrixFastOld=function($m,$p,$h){for(var $P=$m.length,$L=0;$L<$P;$L++){var $q=16*$L;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($p,$q,$m[$L],$h,$q);}},$N._computeRootAnimationData=function($m,$p,$h){for(var $P=0,$L=0,$q=0,$k=$m.length;$P<$k;$L+=$m[$P].keyframeWidth,$q+=16,$P++)laya.d3.utils.Utils3D.createAffineTransformationArray($p[$L+0],$p[$L+1],$p[$L+2],$p[$L+3],$p[$L+4],$p[$L+5],$p[$L+6],$p[$L+7],$p[$L+8],$p[$L+9],$h,$q);},$N.transformVector3ArrayByQuat=function($m,$p,$h,$P,$L){var $q=$h.elements,$k=$m[$p],$Y=$m[$p+1],$d=$m[$p+2],$K=$q[0],$D=$q[1],$F=$q[2],$R=$q[3],$$=$R*$k+$D*$d-$F*$Y,$A=$R*$Y+$F*$k-$K*$d,$B=$R*$d+$K*$Y-$D*$k,$n=-$K*$k-$D*$Y-$F*$d;$P[$L]=$$*$R+$n*-$K+$A*-$F-$B*-$D,$P[$L+1]=$A*$R+$n*-$D+$B*-$K-$$*-$F,$P[$L+2]=$B*$R+$n*-$F+$$*-$D-$A*-$K;},$N.mulMatrixByArray=function($m,$p,$h,$P,$L,$q){var $k,$Y,$d,$K,$D;if($L===$h){for($h=$N._tempArray16_3,$k=0;$k<16;++$k)$h[$k]=$L[$q+$k];$P=0;}for($k=0;$k<4;$k++)$Y=$m[$p+$k],$d=$m[$p+$k+4],$K=$m[$p+$k+8],$D=$m[$p+$k+12],$L[$q+$k]=$Y*$h[$P+0]+$d*$h[$P+1]+$K*$h[$P+2]+$D*$h[$P+3],$L[$q+$k+4]=$Y*$h[$P+4]+$d*$h[$P+5]+$K*$h[$P+6]+$D*$h[$P+7],$L[$q+$k+8]=$Y*$h[$P+8]+$d*$h[$P+9]+$K*$h[$P+10]+$D*$h[$P+11],$L[$q+$k+12]=$Y*$h[$P+12]+$d*$h[$P+13]+$K*$h[$P+14]+$D*$h[$P+15];},$N.mulMatrixByArrayFast=function($m,$p,$h,$P,$L,$q){var $k,$Y,$d,$K,$D;for($k=0;$k<4;$k++)$Y=$m[$p+$k],$d=$m[$p+$k+4],$K=$m[$p+$k+8],$D=$m[$p+$k+12],$L[$q+$k]=$Y*$h[$P+0]+$d*$h[$P+1]+$K*$h[$P+2]+$D*$h[$P+3],$L[$q+$k+4]=$Y*$h[$P+4]+$d*$h[$P+5]+$K*$h[$P+6]+$D*$h[$P+7],$L[$q+$k+8]=$Y*$h[$P+8]+$d*$h[$P+9]+$K*$h[$P+10]+$D*$h[$P+11],$L[$q+$k+12]=$Y*$h[$P+12]+$d*$h[$P+13]+$K*$h[$P+14]+$D*$h[$P+15];},$N.mulMatrixByArrayAndMatrixFast=function($m,$p,$h,$P,$L){var $q,$k,$Y,$d,$K,$D=$h.elements,$F=$D[0],$R=$D[1],$$=$D[2],$A=$D[3],$B=$D[4],$n=$D[5],$c=$D[6],$e=$D[7],$a=$D[8],$Z=$D[9],$H=$D[10],$W=$D[11],$E=$D[12],$I=$D[13],$b=$D[14],$T=$D[15],$j=$p,$x=$p+4,$Q=$p+8,$M=$p+12,$u=$L,$N=$L+4,$S=$L+8,$_=$L+12;for($q=0;$q<4;$q++)$k=$m[$j+$q],$Y=$m[$x+$q],$d=$m[$Q+$q],$K=$m[$M+$q],$P[$u+$q]=$k*$F+$Y*$R+$d*$$+$K*$A,$P[$N+$q]=$k*$B+$Y*$n+$d*$c+$K*$e,$P[$S+$q]=$k*$a+$Y*$Z+$d*$H+$K*$W,$P[$_+$q]=$k*$E+$Y*$I+$d*$b+$K*$T;},$N.createAffineTransformationArray=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F){var $R=$P+$P,$$=$L+$L,$A=$q+$q,$B=$P*$R,$n=$P*$$,$c=$P*$A,$e=$L*$$,$a=$L*$A,$Z=$q*$A,$H=$k*$R,$W=$k*$$,$E=$k*$A;$D[$F+0]=(1-($e+$Z))*$Y,$D[$F+1]=($n+$E)*$Y,$D[$F+2]=($c-$W)*$Y,$D[$F+3]=0,$D[$F+4]=($n-$E)*$d,$D[$F+5]=(1-($B+$Z))*$d,$D[$F+6]=($a+$H)*$d,$D[$F+7]=0,$D[$F+8]=($c+$W)*$K,$D[$F+9]=($a-$H)*$K,$D[$F+10]=(1-($B+$e))*$K,$D[$F+11]=0,$D[$F+12]=$m,$D[$F+13]=$p,$D[$F+14]=$h,$D[$F+15]=1;},$N.transformVector3ArrayToVector3ArrayCoordinate=function($m,$p,$h,$P,$L){var $q=$N._tempArray4_0,$k=$m[$p+0],$Y=$m[$p+1],$d=$m[$p+2],$K=$h.elements;$q[0]=$k*$K[0]+$Y*$K[4]+$d*$K[8]+$K[12],$q[1]=$k*$K[1]+$Y*$K[5]+$d*$K[9]+$K[13],$q[2]=$k*$K[2]+$Y*$K[6]+$d*$K[10]+$K[14],$q[3]=1/($k*$K[3]+$Y*$K[7]+$d*$K[11]+$K[15]),$P[$L+0]=$q[0]*$q[3],$P[$L+1]=$q[1]*$q[3],$P[$L+2]=$q[2]*$q[3];},$N.transformLightingMapTexcoordByUV0Array=function($m,$p,$h,$P,$L){var $q=$h.elements;$P[$L+0]=$m[$p+0]*$q[0]+$q[2],$P[$L+1]=($m[$p+1]-1)*$q[1]+$q[3];},$N.transformLightingMapTexcoordByUV1Array=function($m,$p,$h,$P,$L){var $q=$h.elements;$P[$L+0]=$m[$p+0]*$q[0]+$q[2],$P[$L+1]=1+$m[$p+1]*$q[1]+$q[3];},$N.getURLVerion=function($m){var $p=$m.indexOf("?");return 0<=$p?$m.substr($p):null;},$N._quaternionCreateFromYawPitchRollArray=function($m,$p,$h,$P){var $L=.5*$h,$q=.5*$p,$k=.5*$m,$Y=Math.sin($L),$d=Math.cos($L),$K=Math.sin($q),$D=Math.cos($q),$F=Math.sin($k),$R=Math.cos($k);$P[0]=$R*$K*$d+$F*$D*$Y,$P[1]=$F*$D*$d-$R*$K*$Y,$P[2]=$R*$D*$Y-$F*$K*$d,$P[3]=$R*$D*$d+$F*$K*$Y;},$N._createAffineTransformationArray=function($m,$p,$h,$P){var $L=$p[0],$q=$p[1],$k=$p[2],$Y=$p[3],$d=$L+$L,$K=$q+$q,$D=$k+$k,$F=$L*$d,$R=$L*$K,$$=$L*$D,$A=$q*$K,$B=$q*$D,$n=$k*$D,$c=$Y*$d,$e=$Y*$K,$a=$Y*$D,$Z=$h[0],$H=$h[1],$W=$h[2];$P[0]=(1-($A+$n))*$Z,$P[1]=($R+$a)*$Z,$P[2]=($$-$e)*$Z,$P[3]=0,$P[4]=($R-$a)*$H,$P[5]=(1-($F+$n))*$H,$P[6]=($B+$c)*$H,$P[7]=0,$P[8]=($$+$e)*$W,$P[9]=($B-$c)*$W,$P[10]=(1-($F+$A))*$W,$P[11]=0,$P[12]=$m[0],$P[13]=$m[1],$P[14]=$m[2],$P[15]=1;},$N._mulMatrixArray=function($m,$p,$h,$P){var $L,$q,$k,$Y,$d,$K=$p.elements,$D=$K[0],$F=$K[1],$R=$K[2],$$=$K[3],$A=$K[4],$B=$K[5],$n=$K[6],$c=$K[7],$e=$K[8],$a=$K[9],$Z=$K[10],$H=$K[11],$W=$K[12],$E=$K[13],$I=$K[14],$b=$K[15],$T=$P,$j=$P+4,$x=$P+8,$Q=$P+12;for($L=0;$L<4;$L++)$q=$m[$L],$k=$m[$L+4],$Y=$m[$L+8],$d=$m[$L+12],$h[$T+$L]=$q*$D+$k*$F+$Y*$R+$d*$$,$h[$j+$L]=$q*$A+$k*$B+$Y*$n+$d*$c,$h[$x+$L]=$q*$e+$k*$a+$Y*$Z+$d*$H,$h[$Q+$L]=$q*$W+$k*$E+$Y*$I+$d*$b;},$N.getYawPitchRoll=function($m,$p){$N.transformQuat($kp.ForwardRH,$m,$hp.TEMPVector31),$N.transformQuat($kp.Up,$m,$hp.TEMPVector32);var $h=$hp.TEMPVector32.elements;$N.angleTo($kp.ZERO,$hp.TEMPVector31,$hp.TEMPVector33);var $P=$hp.TEMPVector33.elements;$P[0]==Math.PI/2?($P[1]=$N.arcTanAngle($h[2],$h[0]),$P[2]=0):$P[0]==-Math.PI/2?($P[1]=$N.arcTanAngle(-$h[2],-$h[0]),$P[2]=0):($mp.createRotationY(-$P[1],$hp.TEMPMatrix0),$mp.createRotationX(-$P[0],$hp.TEMPMatrix1),$kp.transformCoordinate($hp.TEMPVector32,$hp.TEMPMatrix0,$hp.TEMPVector32),$kp.transformCoordinate($hp.TEMPVector32,$hp.TEMPMatrix1,$hp.TEMPVector32),$P[2]=$N.arcTanAngle($h[1],-$h[0])),$P[1]<=-Math.PI&&($P[1]=Math.PI),$P[2]<=-Math.PI&&($P[2]=Math.PI),$P[1]>=Math.PI&&$P[2]>=Math.PI&&($P[1]=0,$P[2]=0,$P[0]=Math.PI-$P[0]),$p[0]=$P[1],$p[1]=$P[0],$p[2]=$P[2];},$N.arcTanAngle=function($m,$p){return 0==$m?1==$p?Math.PI/2:-Math.PI/2:0<$m?Math.atan($p/$m):$m<0?0<$p?Math.atan($p/$m)+Math.PI:Math.atan($p/$m)-Math.PI:0;},$N.angleTo=function($m,$p,$h){$kp.subtract($p,$m,$hp.TEMPVector30),$kp.normalize($hp.TEMPVector30,$hp.TEMPVector30),$h.elements[0]=Math.asin($hp.TEMPVector30.y),$h.elements[1]=$N.arcTanAngle(-$hp.TEMPVector30.z,-$hp.TEMPVector30.x);},$N.transformQuat=function($m,$p,$h){var $P=$h.elements,$L=$m.elements,$q=$p,$k=$L[0],$Y=$L[1],$d=$L[2],$K=$q[0],$D=$q[1],$F=$q[2],$R=$q[3],$$=$R*$k+$D*$d-$F*$Y,$A=$R*$Y+$F*$k-$K*$d,$B=$R*$d+$K*$Y-$D*$k,$n=-$K*$k-$D*$Y-$F*$d;$P[0]=$$*$R+$n*-$K+$A*-$F-$B*-$D,$P[1]=$A*$R+$n*-$D+$B*-$K-$$*-$F,$P[2]=$B*$R+$n*-$F+$$*-$D-$A*-$K;},$N.quaterionNormalize=function($m,$p){var $h=$m[0],$P=$m[1],$L=$m[2],$q=$m[3],$k=$h*$h+$P*$P+$L*$L+$q*$q;0<$k&&($k=1/Math.sqrt($k),$p[0]=$h*$k,$p[1]=$P*$k,$p[2]=$L*$k,$p[3]=$q*$k);},$N.matrix4x4MultiplyFFF=function($m,$p,$h){var $P,$L,$q,$k,$Y;if($h===$p)for($p=new Float32Array(16),$P=0;$P<16;++$P)$p[$P]=$h[$P];for($P=0;$P<4;$P++)$L=$m[$P],$q=$m[$P+4],$k=$m[$P+8],$Y=$m[$P+12],$h[$P]=$L*$p[0]+$q*$p[1]+$k*$p[2]+$Y*$p[3],$h[$P+4]=$L*$p[4]+$q*$p[5]+$k*$p[6]+$Y*$p[7],$h[$P+8]=$L*$p[8]+$q*$p[9]+$k*$p[10]+$Y*$p[11],$h[$P+12]=$L*$p[12]+$q*$p[13]+$k*$p[14]+$Y*$p[15];},$N.matrix4x4MultiplyMFM=function($m,$p,$h){$N.matrix4x4MultiplyFFF($m.elements,$p,$h.elements);},$F($N,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"};},"_tempVector3_0",function(){return this._tempVector3_0=new $kp();},"_tempVector3_1",function(){return this._tempVector3_1=new $kp();},"_tempVector3_2",function(){return this._tempVector3_2=new $kp();},"_tempVector3_3",function(){return this._tempVector3_3=new $kp();},"_tempVector3_4",function(){return this._tempVector3_4=new $kp();},"_tempVector3_5",function(){return this._tempVector3_5=new $kp();},"_tempVector3_6",function(){return this._tempVector3_6=new $kp();},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4);},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16);},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16);},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16);},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16);}]),$N;}(),$cp=function(){function $M(){}return $$($M,"Laya3D"),$M._cancelLoadByUrl=function($m){$H.loader.cancelLoadByUrl($m),$M._innerFirstLevelLoaderManager.cancelLoadByUrl($m),$M._innerSecondLevelLoaderManager.cancelLoadByUrl($m),$M._innerThirdLevelLoaderManager.cancelLoadByUrl($m),$M._innerFourthLevelLoaderManager.cancelLoadByUrl($m);},$M._changeWebGLSize=function($m,$p){$Q.onStageResize($m,$p),$i.clientWidth=$m,$i.clientHeight=$p;},$M.__init__=function(){var $m=$p.createMap;$m.lh=[$_p,"SPRITE3DHIERARCHY"],$m.ls=[$Sp,"SPRITE3DHIERARCHY"],$m.lm=[$Gp,"MESH"],$m.lmat=[$Jp,"MATERIAL"],$m.jpg=[$rp,"nativeimage"],$m.jpeg=[$rp,"nativeimage"],$m.png=[$rp,"nativeimage"],$m.pkm=[$rp,"arraybuffer"],$m.raw=[$Xp,"arraybuffer"],$m.mipmaps=[$Xp,"arraybuffer"],$c.parserMap.SPRITE3DHIERARCHY=$M._loadHierarchy,$c.parserMap.MESH=$M._loadMesh,$c.parserMap.MATERIAL=$M._loadMaterial,$c.parserMap.TEXTURECUBE=$M._loadTextureCube,$c.parserMap.TERRAIN=$M._loadTerrain,$M._innerFirstLevelLoaderManager.on("error",null,$M._eventLoadManagerError),$M._innerSecondLevelLoaderManager.on("error",null,$M._eventLoadManagerError),$M._innerThirdLevelLoaderManager.on("error",null,$M._eventLoadManagerError),$M._innerFourthLevelLoaderManager.on("error",null,$M._eventLoadManagerError);},$M.READ_BLOCK=function(){return $M._readData.pos+=4,!0;},$M.READ_DATA=function(){return $M._DATA.offset=$M._readData.getUint32(),$M._DATA.size=$M._readData.getUint32(),!0;},$M.READ_STRINGS=function(){var $m=[],$p={offset:0,size:0};$p.offset=$M._readData.getUint16(),$p.size=$M._readData.getUint16();$M._readData.pos;$M._readData.pos=$p.offset+$M._DATA.offset;for(var $h=0;$h<$p.size;$h++){var $P=$M._readData.readUTFString();-1===$P.lastIndexOf(".lmat")&&-1===$P.lastIndexOf(".lpbr")||$m.push($P);}return $m;},$M.formatRelativePath=function($m,$p){var $h;if("."===$p.charAt(0)){for(var $P=($m+$p).split("/"),$L=0,$q=$P.length;$L<$q;$L++)if(".."==$P[$L]){var $k=$L-1;0<$k&&".."!==$P[$k]&&($P.splice($k,2),$L-=2);}$h=$P.join("/");}else $h=$m+$p;return null!=$x.customFormat&&($h=$x.customFormat($h,null)),$h;},$M._eventLoadManagerError=function($m){$H.loader.event("error",$m);},$M._addHierarchyInnerUrls=function($m,$p,$h,$P,$L,$q){var $k=$M.formatRelativePath($P,$L);$h&&($k+=$h),$m.push({url:$k,clas:$q}),$p[$L]=$k;},$M._getSprite3DHierarchyInnerUrls=function($m,$p,$h,$P,$L,$q,$k){var $Y,$d=0,$K=0;switch($m.type){case"Scene":var $D=$m.customProps.lightmaps;for($d=0,$K=$D.length;$d<$K;$d++){var $F=$D[$d].replace(".exr",".png");$M._addHierarchyInnerUrls($P,$L,$q,$k,$F,$rp);}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $R;if($m.instanceParams)($R=$m.instanceParams.loadPath)&&$M._addHierarchyInnerUrls($p,$L,$q,$k,$R,$Gp);else{($R=($Y=$m.customProps).meshPath)&&$M._addHierarchyInnerUrls($p,$L,$q,$k,$R,$Gp);var $$=$Y.materials;if($$)for($d=0,$K=$$.length;$d<$K;$d++){for(var $A=$$[$d],$B=$A.type.split("."),$n=$u.window,$c=0,$e=$B.length;$c<$e;++$c){$n=$n[this.clasPaths[$c]];}if("function"!=typeof $n)throw"_getSprite3DHierarchyInnerUrls 错误: "+$A.type+" 不是类";$M._addHierarchyInnerUrls($h,$L,$q,$k,$A.path,$n);}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $a=($Y=$m.customProps).meshPath;$a&&$M._addHierarchyInnerUrls($p,$L,$q,$k,$a,$Gp);var $Z=$Y.material;if($Z){$B=$Z.type.split("."),$n=$u.window;for($c=0,$e=$B.length;$c<$e;++$c){$n=$n[this.clasPaths[$c]];}$M._addHierarchyInnerUrls($h,$L,$q,$k,$Z.path,$n);}else{var $H=$Y.materialPath;if($H)$M._addHierarchyInnerUrls($h,$L,$q,$k,$H,ShurikenParticleMaterial);else{var $W=$Y.texturePath;$W&&$M._addHierarchyInnerUrls($P,$L,$q,$k,$W,$rp);}}break;case"Terrain":$M._addHierarchyInnerUrls($P,$L,$q,$k,$m.customProps.dataPath,TerrainRes);}var $E=$m.components;for(var $I in $E){var $b=$E[$I];switch($I){case"Animator":var $T=$b.avatarPath;if($T)$M._addHierarchyInnerUrls($P,$L,$q,$k,$T,Avatar);else{var $j=$b.avatar;$j&&$M._addHierarchyInnerUrls($P,$L,$q,$k,$j.path,Avatar);}var $x=$b.clipPaths;for($d=0,$K=$x.length;$d<$K;$d++)$M._addHierarchyInnerUrls($P,$L,$q,$k,$x[$d],AnimationClip);}}var $Q=$m.child;for($d=0,$K=$Q.length;$d<$K;$d++)$M._getSprite3DHierarchyInnerUrls($Q[$d],$p,$h,$P,$L,$q,$k);},$M._loadHierarchy=function($m){$m.on("loaded",null,$M._onHierarchylhLoaded,[$m,$m._class._getGroup()]),$m.load($m.url,"json",!1,null,!0);},$M._onHierarchylhLoaded=function($m,$p,$h){if($m._class.destroyed)$m.endLoad();else{var $P=$m.url,$L=$np.getURLVerion($P),$q=$x.getPath($P),$k=[],$Y=[],$d=[],$K={};$M._getSprite3DHierarchyInnerUrls($h,$k,$Y,$d,$K,$L,$q);var $D=$k.length+$Y.length+$d.length,$F=$D+1,$R=1/$F;if($M._onProcessChange($m,0,$R,1),0<$d.length){var $$=$D/$F,$A=$j.create(null,$M._onProcessChange,[$m,$R,$$],!1);$M._innerFourthLevelLoaderManager.create($d,$j.create(null,$M._onHierarchyInnerForthLevResouLoaded,[$m,$p,$A,$h,$K,$k,$Y,$R+$$*$d.length,$$]),$A,null,null,1,!0,$p);}else $M._onHierarchyInnerForthLevResouLoaded($m,$p,null,$h,$K,$k,$Y,$R,$$);}},$M._onHierarchyInnerForthLevResouLoaded=function($m,$p,$h,$P,$L,$q,$k,$Y,$d){if($m._class.destroyed)$m.endLoad();else if($h&&$h.recover(),0<$k.length){var $K=$j.create(null,$M._onProcessChange,[$m,$Y,$d],!1);$M._innerSecondLevelLoaderManager.create($k,$j.create(null,$M._onHierarchyInnerSecondLevResouLoaded,[$m,$p,$K,$P,$L,$q,$Y+$d*$k.length,$d]),$h,null,null,1,!0,$p);}else $M._onHierarchyInnerSecondLevResouLoaded($m,$p,null,$P,$L,$q,$Y,$d);},$M._onHierarchyInnerSecondLevResouLoaded=function($m,$p,$h,$P,$L,$q,$k,$Y){if($m._class.destroyed)$m.endLoad();else if($h&&$h.recover(),0<$q.length){var $d=$j.create(null,$M._onProcessChange,[$m,$k,$Y],!1);$M._innerFirstLevelLoaderManager.create($q,$j.create(null,$M._onHierarchyInnerFirstLevResouLoaded,[$m,$d,$P,$L]),$h,null,null,1,!0,$p);}else $M._onHierarchyInnerFirstLevResouLoaded($m,null,$P,$L);},$M._onHierarchyInnerFirstLevResouLoaded=function($m,$p,$h,$P){$p&&$p.recover(),$m.endLoad([$h,$P]);},$M._loadTerrain=function($m){$m.on("loaded",null,$M._onTerrainLtLoaded,[$m,$m._class._getGroup()]),$m.load($m.url,"json",!1,null,!0);},$M._onTerrainLtLoaded=function($m,$p,$h){if($m._class.destroyed)$m.endLoad();else{var $P,$L,$q=$m.url,$k=$np.getURLVerion($q),$Y=$x.getPath($q),$d=[],$K={},$D=0,$F=0,$R=$h.heightData;$P=$R.url,$L=$M.formatRelativePath($Y,$P),$k&&($L+=$k),$P=$K[$P]=$L;var $$=$h.detailTexture;for($D=0,$F=$$.length;$D<$F;$D++)$d.push({url:$$[$D].diffuse});var $A=$h.normalMap;for($D=0,$F=$A.length;$D<$F;$D++)$d.push({url:$A[$D]});var $B=$h.alphaMap;for($D=0,$F=$B.length;$D<$F;$D++)$d.push({url:$B[$D],params:[!1,!1,6408,!0]});for($D=0,$F=$d.length;$D<$F;$D++){var $n=$d[$D].url;$L=$M.formatRelativePath($Y,$n),$k&&($L+=$k),$d[$D].url=$L,$K[$n]=$L;}var $c=$d.length,$e=$c+2,$a=1/$e;$M._onProcessChange($m,0,$a,1);var $Z={heightMapLoaded:!1,texturesLoaded:!1},$H=$j.create(null,$M._onProcessChange,[$m,$a,$a],!1);$M._innerFourthLevelLoaderManager.create($P,$j.create(null,$M._onTerrainHeightMapLoaded,[$m,$H,$h,$K,$Z]),$H,null,[$R.numX,$R.numZ,$R.bitType,$R.value],1,!0,$p);var $W=$j.create(null,$M._onProcessChange,[$m,2*$a,$c/$e],!1);$M._innerFourthLevelLoaderManager.create($d,$j.create(null,$M._onTerrainTexturesLoaded,[$m,$W,$h,$K,$Z]),$W,null,null,1,!0,$p);}},$M._onTerrainHeightMapLoaded=function($m,$p,$h,$P,$L){$L.heightMapLoaded=!0,$L.texturesLoaded&&($m.endLoad([$h,$P]),$p.recover());},$M._onTerrainTexturesLoaded=function($m,$p,$h,$P,$L){$L.texturesLoaded=!0,$L.heightMapLoaded&&($m.endLoad([$h,$P]),$p.recover());},$M._loadMesh=function($m){$m.on("loaded",null,$M._onMeshLmLoaded,[$m,$m._class._getGroup()]),$m.load($m.url,"arraybuffer",!1,null,!0);},$M._onMeshLmLoaded=function($m,$p,$h){if($m._class.destroyed)$m.endLoad();else{var $P,$L,$q,$k=$m.url,$Y=$np.getURLVerion($k),$d=$x.getPath($k),$K={},$D=0,$F=0;switch(($M._readData=new $W($h)).pos=0,$M._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $R=$M._readData.getUint32();$M._readData.pos=$M._readData.pos+4,$F=$M._readData.getUint16(),$M._readData.pos=$M._readData.pos+8*$F;var $$=$M._readData.getUint32();for($F=$M._readData.getUint16(),$M._readData.pos=$R+$$,$P=[],$D=0;$D<$F;$D++){var $A=$M._readData.readUTFString();-1!==$A.lastIndexOf(".lmat")&&$P.push($A);}break;default:for($M.READ_BLOCK(),$D=0;$D<2;$D++){var $B=$M._readData.getUint16(),$n=$M._strings[$B],$c=$M["READ_"+$n];if(null==$c)throw new Error("model file err,no this function:"+$B+" "+$n);1===$D?$P=$c.call():$c.call();}}for($D=0,$q=$P.length;$D<$q;$D++){var $e=$P[$D];$L=$M.formatRelativePath($d,$e),$Y&&($L+=$Y),$P[$D]=$L,$K[$e]=$L;}if(0<$P.length){$M._onProcessChange($m,0,.5,1);var $a=$j.create(null,$M._onProcessChange,[$m,.5,.5],!1);$M._innerSecondLevelLoaderManager.create($P,$j.create(null,$M._onMeshMateialLoaded,[$m,$a,$h,$K]),$a,null,null,1,!0,$p);}else $m.endLoad([$h,$K]);}},$M._onMeshMateialLoaded=function($m,$p,$h,$P){$m.endLoad([$h,$P]),$p.recover();},$M._getMaterialTexturePath=function($m,$p,$h){var $P=$m.length-4;return $m.indexOf(".dds")!=$P&&$m.indexOf(".tga")!=$P&&$m.indexOf(".exr")!=$P&&$m.indexOf(".DDS")!=$P&&$m.indexOf(".TGA")!=$P&&$m.indexOf(".EXR")!=$P||($m=$m.substr(0,$P)+".png"),$m=$M.formatRelativePath($h,$m),$p&&($m+=$p),$m;},$M._loadMaterial=function($m){$m.on("loaded",null,$M._onMaterilLmatLoaded,[$m,$m._class._getGroup()]),$m.load($m.url,"json",!1,null,!0);},$M._onMaterilLmatLoaded=function($m,$p,$h){if($m._class.destroyed)$m.endLoad();else{var $P,$L=$m.url,$q=$np.getURLVerion($L),$k=$x.getPath($L),$Y=[],$d={},$K=$h.customProps,$D=$h.version;if($D)switch($D){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $F=$h.props.textures,$R=0,$$=$F.length;$R<$$;$R++){var $A=$F[$R],$B=$A.path;if($B){var $n=$B.length-4;$B.indexOf(".exr")!=$n&&$B.indexOf(".EXR")!=$n||($B=$B.substr(0,$n)+".png"),$P=$M.formatRelativePath($k,$B),$q&&($P+=$q),$Y.push({url:$P,params:$A.params}),$d[$B]=$P;}}break;default:throw new Error("Laya3D:unkonwn version.");}else{var $c=$K.diffuseTexture.texture2D;if($c&&($P=$M._getMaterialTexturePath($c,$q,$k),$Y.push($P),$d[$c]=$P),$K.normalTexture){var $e=$K.normalTexture.texture2D;$e&&($P=$M._getMaterialTexturePath($e,$q,$k),$Y.push($P),$d[$e]=$P);}if($K.specularTexture){var $a=$K.specularTexture.texture2D;$a&&($P=$M._getMaterialTexturePath($a,$q,$k),$Y.push($P),$d[$a]=$P);}if($K.emissiveTexture){var $Z=$K.emissiveTexture.texture2D;$Z&&($P=$M._getMaterialTexturePath($Z,$q,$k),$Y.push($P),$d[$Z]=$P);}if($K.ambientTexture){var $H=$K.ambientTexture.texture2D;$H&&($P=$M._getMaterialTexturePath($H,$q,$k),$Y.push($P),$d[$H]=$P);}if($K.reflectTexture){var $W=$K.reflectTexture.texture2D;$W&&($P=$M._getMaterialTexturePath($W,$q,$k),$Y.push($P),$d[$W]=$P);}}var $E=$Y.length,$I=$E+1,$b=1/$I;if($M._onProcessChange($m,0,$b,1),0<$E){var $T=$j.create(null,$M._onProcessChange,[$m,$b,$E/$I],!1);$M._innerFourthLevelLoaderManager.create($Y,$j.create(null,$M._onMateialTexturesLoaded,[$m,$T,$h,$d]),$T,$rp,null,1,!0,$p);}else $M._onMateialTexturesLoaded($m,null,$h,null);}},$M._onMateialTexturesLoaded=function($m,$p,$h,$P){$m.endLoad([$h,$P]),$p&&$p.recover();},$M._loadTextureCube=function($m){$m.on("loaded",null,$M._onTextureCubeLtcLoaded,[$m]),$m.load($m.url,"json",!1,null,!0);},$M._onTextureCubeLtcLoaded=function($m,$p){if($m._class.destroyed)$m.endLoad();else{var $h=$x.getPath($m.url),$P=[$M.formatRelativePath($h,$p.px),$M.formatRelativePath($h,$p.nx),$M.formatRelativePath($h,$p.py),$M.formatRelativePath($h,$p.ny),$M.formatRelativePath($h,$p.pz),$M.formatRelativePath($h,$p.nz)];$M._onProcessChange($m,0,1/7,1);var $L=$j.create(null,$M._onProcessChange,[$m,1/7,6/7],!1);$M._innerFourthLevelLoaderManager.load($P,$j.create(null,$M._onTextureCubeImagesLoaded,[$m,$P,$L]),$L,"nativeimage");}},$M._onTextureCubeImagesLoaded=function($m,$p,$h){var $P=[];$P.length=6;for(var $L=0;$L<6;$L++){var $q=$p[$L];$P[$L]=$c.getRes($q),$c.clearRes($q);}$m.endLoad($P),$h.recover();},$M._onProcessChange=function($m,$p,$h,$P){($P=$p+$P*$h)<1&&$m.event("progress",$P);},$M.init=function($m,$p,$h,$P,$L,$q){if(void 0===$h&&($h=!1),void 0===$P&&($P=!1),void 0===$L&&($L=!0),void 0===$q&&($q=!0),$e.update3DLoop=function(){},$e.cancelLoadByUrl=function($m){$M._cancelLoadByUrl($m);},$d.isAntialias=$h,$d.isAlpha=$P,$d.premultipliedAlpha=$L,$d.isStencil=$q,!$Q.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$e.changeWebGLSize=$M._changeWebGLSize,$B.is3DMode=!0,$H.init($m,$p),$N.__init__(),$Fp.__init__(),$fp.__init__(),$s.__init__(),$M.__init__(),$k.maxTextureCount=2,($M.debugMode||$v.debugMode)&&($M._debugPhasorSprite=new $V());},$M.HIERARCHY="SPRITE3DHIERARCHY",$M.MESH="MESH",$M.MATERIAL="MATERIAL",$M.PBRMATERIAL="PBRMTL",$M.TEXTURECUBE="TEXTURECUBE",$M.TERRAIN="TERRAIN",$M._readData=null,$M._debugPhasorSprite=null,$M.debugMode=!1,$F($M,["_DATA",function(){return this._DATA={offset:0,size:0};},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"];},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $p();},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $p();},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $p();},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $p();}]),$M;}(),$ep=function($m){function $L($m){$L.__super.call(this),this._owner=$m,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0;}$$($L,"laya.d3.animation.AnimationTransform3D",$q);var $p=$L.prototype;return $p._getlocalMatrix=function(){return this._localUpdate&&($np._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix;},$p._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldTransform();}},$p._setWorldMatrixAndUpdate=function($m){if(this._worldMatrix=$m,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $p=this._getlocalMatrix(),$h=0;$h<16;++$h)this._worldMatrix[$h]=$p[$h];else $np.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1;},$p._setWorldMatrixNoUpdate=function($m){this._worldMatrix=$m;},$p._setWorldMatrixIgnoreUpdate=function($m){this._worldMatrix=$m,this._worldUpdate=!1;},$p.getLocalPosition=function(){return this._localPosition;},$p.setLocalPosition=function($m){if(this._parent)this._localPosition=$m,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$h=this._entity.localPosition,$P=$h.elements;$P[0]=$m[0],$P[1]=$m[1],$P[2]=$m[2],$p.localPosition=$h;}},$p.getLocalRotation=function(){if(this._localQuaternionUpdate){var $m=this._localRotationEuler;$np._quaternionCreateFromYawPitchRollArray($m[1]/$L._angleToRandin,$m[0]/$L._angleToRandin,$m[2]/$L._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1;}return this._localRotation;},$p.setLocalRotation=function($m){if(this._parent)this._localRotation=$m,$np.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$h=this._entity.localRotation,$P=$h.elements;$P[0]=$m[0],$P[1]=$m[1],$P[2]=$m[2],$P[3]=$m[3],$p.localRotation=$h;}},$p.getLocalScale=function(){return this._localScale;},$p.setLocalScale=function($m){if(this._parent)this._localScale=$m,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$h=this._entity.localScale,$P=$h.elements;$P[0]=$m[0],$P[1]=$m[1],$P[2]=$m[2],$p.localScale=$h;}},$p.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$np.getYawPitchRoll(this._localRotation,$L._tempVector3);var $m=$L._tempVector3,$p=this._localRotationEuler;$p[0]=$m[1]*$L._angleToRandin,$p[1]=$m[0]*$L._angleToRandin,$p[2]=$m[2]*$L._angleToRandin,this._locaEulerlUpdate=!1;}return this._localRotationEuler;},$p.setLocalRotationEuler=function($m){if(this._parent)$np._quaternionCreateFromYawPitchRollArray($m[1]/$L._angleToRandin,$m[0]/$L._angleToRandin,$m[2]/$L._angleToRandin,this._localRotation),this._localRotationEuler=$m,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$h=this._entity.localRotationEuler,$P=$h.elements;$P[0]=$m[0],$P[1]=$m[1],$P[2]=$m[2],$p.localRotationEuler=$h;}},$p.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$np.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $m=this._getlocalMatrix(),$p=0;$p<16;++$p)this._worldMatrix[$p]=$m[$p];this._worldUpdate=!1;}return this._worldMatrix;},$p.setParent=function($m){if(this._parent!==$m){if(this._parent){var $p=this._parent._childs,$h=$p.indexOf(this);$p.splice($h,1);}$m&&($m._childs.push(this),$m&&this._onWorldTransform()),this._parent=$m;}},$F($L,["_tempVector3",function(){return this._tempVector3=new Float32Array(3);},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI;}]),$L;}(),$ap=function($m){function $p(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$p.__super.call(this),this._destroyed=!1,this._id=$p._uniqueIDCounter,$p._uniqueIDCounter++;}$$($p,"laya.d3.component.Component3D",$q);var $h=$p.prototype;return $H.imps($h,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$h._initialize=function($m){this._owner=$m,this._enable=!0,this.started=!1,this._load($m);},$h._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0;},$h._load=function($m){},$h._start=function($m){},$h._update=function($m){},$h._lateUpdate=function($m){},$h._preRenderUpdate=function($m){},$h._postRenderUpdate=function($m){},$h._unload=function($m){this.offAll();},$h._cloneTo=function($m){},$A(0,$h,"id",function(){return this._id;}),$A(0,$h,"destroyed",function(){return this._destroyed;}),$A(0,$h,"owner",function(){return this._owner;}),$A(0,$h,"enable",function(){return this._enable;},function($m){this._enable!==$m&&(this._enable=$m,this.event("enablechanged",this._enable));}),$A(0,$h,"isSingleton",function(){return $p._isSingleton;}),$p._isSingleton=!0,$p._uniqueIDCounter=1,$p;}(),$Zp=function($m){function $p(){this._destroyed=!1,$p.__super.call(this),this._destroyed=!1;}$$($p,"laya.d3.core.GeometryFilter",$q);var $h=$p.prototype;return $H.imps($h,{"laya.resource.IDestroy":!0}),$h._destroy=function(){this.offAll(),this._destroyed=!0;},$A(0,$h,"_isAsyncLoaded",function(){return!0;}),$A(0,$h,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.");}),$A(0,$h,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.");}),$A(0,$h,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.");}),$A(0,$h,"destroyed",function(){return this._destroyed;}),$p;}(),$Hp=function($m){function $P($m){$P.__super.call(this),this._id=++$P._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $vm(new $kp(),new $kp()),this._boundingBoxCenter=new $kp(),this._boundingSphere=new $tm(new $kp(),0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$m,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange);}$$($P,"laya.d3.core.render.BaseRender",$q);var $p=$P.prototype;return $H.imps($p,{"laya.resource.IDestroy":!0}),$p._changeMaterialReference=function($m,$p){$m&&$m._removeReference(),$p._addReference();},$p._getInstanceMaterial=function($m,$p){var $h=new $m.constructor();return $m.cloneTo($h),$h.name=$h.name+"(Instance)",this._materialsInstance[$p]=!0,this._changeMaterialReference(this._materials[$p],$h),this._materials[$p]=$h;},$p._setShaderValuelightMap=function($m){this._setShaderValueTexture(3,$m);},$p._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0;},$p._renderRenderableBoundBox=function(){var $m=$cp._debugPhasorSprite,$p=this.boundingBox,$h=$P._tempBoundBoxCorners;$p.getCorners($h),$m.line($h[0],$P._greenColor,$h[1],$P._greenColor),$m.line($h[2],$P._greenColor,$h[3],$P._greenColor),$m.line($h[4],$P._greenColor,$h[5],$P._greenColor),$m.line($h[6],$P._greenColor,$h[7],$P._greenColor),$m.line($h[0],$P._greenColor,$h[3],$P._greenColor),$m.line($h[1],$P._greenColor,$h[2],$P._greenColor),$m.line($h[2],$P._greenColor,$h[6],$P._greenColor),$m.line($h[3],$P._greenColor,$h[7],$P._greenColor),$m.line($h[0],$P._greenColor,$h[4],$P._greenColor),$m.line($h[1],$P._greenColor,$h[5],$P._greenColor),$m.line($h[4],$P._greenColor,$h[7],$P._greenColor),$m.line($h[5],$P._greenColor,$h[6],$P._greenColor);},$p._calculateBoundingSphere=function(){throw"BaseRender: must override it.";},$p._calculateBoundingBox=function(){throw"BaseRender: must override it.";},$p._setShaderValueTexture=function($m,$p){this._owner._shaderValues.setValue($m,$p);},$p._setShaderValueMatrix4x4=function($m,$p){this._owner._shaderValues.setValue($m,$p?$p.elements:null);},$p._setShaderValueColor=function($m,$p){this._owner._shaderValues.setValue($m,$p?$p.elements:null);},$p._setShaderValueBuffer=function($m,$p){this._owner._shaderValues.setValue($m,$p);},$p._setShaderValueInt=function($m,$p){this._owner._shaderValues.setValue($m,$p);},$p._setShaderValueBool=function($m,$p){this._owner._shaderValues.setValue($m,$p);},$p._setShaderValueNumber=function($m,$p){this._owner._shaderValues.setValue($m,$p);},$p._setShaderValueVector2=function($m,$p){this._owner._shaderValues.setValue($m,$p?$p.elements:null);},$p._addShaderDefine=function($m){this._owner._shaderDefineValue|=$m;},$p._removeShaderDefine=function($m){this._owner._shaderDefineValue&=~$m;},$p._renderUpdate=function($m){return!0;},$p._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $m=this._owner.scene;if($m){var $p=$m.getlightmaps()[this._lightmapIndex];$p?(this._addShaderDefine($Vp.SAHDERDEFINE_LIGHTMAP),$p.loaded?this._setShaderValuelightMap($p):$p.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($Vp.SAHDERDEFINE_LIGHTMAP);}else this._removeShaderDefine($Vp.SAHDERDEFINE_LIGHTMAP);}else this._removeShaderDefine($Vp.SAHDERDEFINE_LIGHTMAP);},$p._updateOctreeNode=function(){var $m=this._treeNode;$m&&this._octreeNodeNeedChange&&($m.updateObject(this),this._octreeNodeNeedChange=!1);},$p._destroy=function(){this.offAll();var $m=0,$p=0;for($m=0,$p=this._renderElements.length;$m<$p;$m++)this._renderElements[$m]._destroy();for($m=0,$p=this._materials.length;$m<$p;$m++)this._materials[$m]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0;},$A(0,$p,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere;}),$A(0,$p,"id",function(){return this._id;}),$A(0,$p,"material",function(){var $m=this._materials[0];if($m&&!this._materialsInstance[0]){var $p=this._getInstanceMaterial($m,0);this.event("materialchanged",[this,0,$p]);}return this._materials[0];},function($m){this.sharedMaterial=$m;}),$A(0,$p,"sharedMaterial",function(){return this._materials[0];},function($m){var $p=this._materials[0];$p!==$m&&(this._materials[0]=$m,this._materialsInstance[0]=!1,this._changeMaterialReference($p,$m),this.event("materialchanged",[this,0,$m]));}),$A(0,$p,"lightmapIndex",function(){return this._lightmapIndex;},function($m){this._lightmapIndex=$m,this._applyLightMapParams();}),$A(0,$p,"lightmapScaleOffset",function(){return this._lightmapScaleOffset;},function($m){this._lightmapScaleOffset=$m,this._setShaderValueColor(2,$m),this._addShaderDefine($Vp.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV);}),$A(0,$p,"enable",function(){return this._enable;},function($m){this._enable=$m,this.event("enablechanged",[this,$m]);}),$A(0,$p,"materials",function(){for(var $m=0,$p=this._materials.length;$m<$p;$m++)if(!this._materialsInstance[$m]){var $h=this._getInstanceMaterial(this._materials[$m],$m);this.event("materialchanged",[this,$m,$h]);}return this._materials.slice();},function($m){this.sharedMaterials=$m;}),$A(0,$p,"sharedMaterials",function(){return this._materials.slice();},function($m){if(!$m)throw new Error("MeshRender: shadredMaterials value can't be null.");var $p=$m.length;this._materialsInstance.length=$p;for(var $h=0;$h<$p;$h++){var $P=this._materials[$h];$P!==$m[$h]&&(this._materialsInstance[$h]=!1,this._changeMaterialReference($P,$m[$h]),this.event("materialchanged",[this,$h,$m[$h]]));}this._materials=$m;}),$A(0,$p,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox;}),$A(0,$p,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $m=this.boundingBox;$kp.add($m.min,$m.max,this._boundingBoxCenter),$kp.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1;}return this._boundingBoxCenter;}),$A(0,$p,"receiveShadow",function(){return this._receiveShadow;},function($m){this._receiveShadow!==$m&&((this._receiveShadow=$m)?this._addShaderDefine($$p.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($$p.SHADERDEFINE_RECEIVE_SHADOW));}),$A(0,$p,"destroyed",function(){return this._destroyed;}),$P._uniqueIDCounter=0,$F($P,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp(),new $kp()];},"_greenColor",function(){return this._greenColor=new $Yp(0,1,0,1);}]),$P;}(),$Wp=function($m){function $Y($m){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$Y.__super.call(this),this._localPosition=new $kp(),this._localRotation=new $hp(0,0,0,1),this._localScale=new $kp(1,1,1),this._localRotationEuler=new $kp(),this._localMatrix=new $mp(),this._position=new $kp(),this._rotation=new $hp(0,0,0,1),this._scale=new $kp(1,1,1),this._worldMatrix=new $mp(),this._forward=new $kp(),this._up=new $kp(),this._right=new $kp(),this._owner=$m,this._childs=[];}$$($Y,"laya.d3.core.Transform3D",$q);var $p=$Y.prototype;return $p._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$mp.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $m=$Y._tempVector30;$kp.multiply(this.pivot,this._localScale,$m);var $p=$Y._tempVector31;$kp.subtract($m,this.pivot,$p);var $h=$Y._tempVector32,$P=this.localRotation;$kp.transformQuat($m,$P,$h),$kp.subtract($h,$m,$h);var $L=$Y._tempVector33;$kp.subtract(this._localPosition,$p,$L),$kp.subtract($L,$h,$L),$mp.createAffineTransformation($L,$P,this._localScale,this._localMatrix);}},$p._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldPositionRotationTransform();}},$p._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldPositionScaleTransform();}},$p._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldPositionTransform();}},$p._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldPositionRotationTransform();}},$p._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldPositionScaleTransform();}},$p._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._onWorldTransform();}},$p.translate=function($m,$p){void 0===$p&&($p=!0),$p?($mp.createFromQuaternion(this.localRotation,$Y._tempMatrix0),$kp.transformCoordinate($m,$Y._tempMatrix0,$Y._tempVector30),$kp.add(this.localPosition,$Y._tempVector30,this._localPosition),this.localPosition=this._localPosition):($kp.add(this.position,$m,this._position),this.position=this._position);},$p.rotate=function($m,$p,$h){var $P;void 0===$p&&($p=!0),void 0===$h&&($h=!0),$P=$h?$m:($kp.scale($m,Math.PI/180,$Y._tempVector30),$Y._tempVector30),$hp.createFromYawPitchRoll($P.y,$P.x,$P.z,$Y._tempQuaternion0),$p?($hp.multiply(this._localRotation,$Y._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($hp.multiply($Y._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation);},$p.lookAt=function($m,$p,$h){void 0===$h&&($h=!1);var $P,$L=$m.elements;if($h){if($P=this._localPosition.elements,Math.abs($P[0]-$L[0])<$Om.zeroTolerance&&Math.abs($P[1]-$L[1])<$Om.zeroTolerance&&Math.abs($P[2]-$L[2])<$Om.zeroTolerance)return;$hp.lookAt(this._localPosition,$m,$p,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation;}else{var $q=this.position;if($P=$q.elements,Math.abs($P[0]-$L[0])<$Om.zeroTolerance&&Math.abs($P[1]-$L[1])<$Om.zeroTolerance&&Math.abs($P[2]-$L[2])<$Om.zeroTolerance)return;$hp.lookAt($q,$m,$p,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation;}},$A(0,$p,"_isFrontFaceInvert",function(){var $m=this.scale,$p=$m.x<0;return $m.y<0&&($p=!$p),$m.z<0&&($p=!$p),$p;}),$A(0,$p,"owner",function(){return this._owner;}),$A(0,$p,"localRotation",function(){if(this._localQuaternionUpdate){var $m=this._localRotationEuler.elements;$hp.createFromYawPitchRoll($m[1]/$Y._angleToRandin,$m[0]/$Y._angleToRandin,$m[2]/$Y._angleToRandin,this._localRotation);}return this._localRotation;},function($m){this._localRotation=$m,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform();}),$A(0,$p,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$mp.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix;},function($m){null===this._parent?$m.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$mp.multiply(this._localMatrix,$m,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$m,this._worldUpdate=!1;}),$A(0,$p,"worldNeedUpdate",function(){return this._worldUpdate;}),$A(0,$p,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix;},function($m){this._localMatrix=$m,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform();}),$A(0,$p,"dummy",function(){return this._dummy;},function($m){this._dummy!==$m&&(this._dummy&&(this._dummy._entity=null),$m&&($m._entity=this),this._dummy=$m);}),$A(0,$p,"localPosition",function(){return this._localPosition;},function($m){this._localPosition=$m,this._localUpdate=!0,this._onWorldPositionTransform();}),$A(0,$p,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $m=this._parent.position;$kp.multiply(this._localPosition,this._parent.scale,$Y._tempVector30),$kp.transformQuat($Y._tempVector30,this._parent.rotation,$Y._tempVector30),$kp.add($m,$Y._tempVector30,this._position);}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1;}return this._position;},function($m){if(null!=this._parent){$kp.subtract($m,this._parent.position,this._localPosition);var $p=this._parent.scale.elements,$h=$p[0],$P=$p[1],$L=$p[2];if(1!==$h||1!==$P||1!==$L){var $q=$Y._tempVector30,$k=$q.elements;$k[0]=1/$h,$k[1]=1/$P,$k[2]=1/$L,$kp.multiply(this._localPosition,$q,this._localPosition);}this._parent.rotation.invert($Y._tempQuaternion0),$kp.transformQuat(this._localPosition,$Y._tempQuaternion0,this._localPosition);}else $m.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$m,this._positionUpdate=!1;}),$A(0,$p,"localScale",function(){return this._localScale;},function($m){this._localScale=$m,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform();}),$A(0,$p,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($Y._tempVector30);var $m=$Y._tempVector30.elements,$p=this._localRotationEuler.elements;$p[0]=$m[1]*$Y._angleToRandin,$p[1]=$m[0]*$Y._angleToRandin,$p[2]=$m[2]*$Y._angleToRandin;}return this._localRotationEuler;},function($m){this._localRotationEuler=$m,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform();}),$A(0,$p,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$hp.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation;},function($m){null!=this._parent?(this._parent.rotation.invert($Y._tempQuaternion0),$hp.multiply($m,$Y._tempQuaternion0,this._localRotation)):$m.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$m,this._rotationUpdate=!1;}),$A(0,$p,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$kp.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale;},function($m){if(null!==this._parent){var $p=this._parent.scale.elements,$h=$Y._tempVector30.elements;$h[0]=1/$p[0],$h[1]=1/$p[1],$h[2]=1/$p[2],$kp.multiply($m,$Y._tempVector30,this._localScale);}else $m.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$m,this._scaleUpdate=!1;}),$A(0,$p,"rotationEuler",null,function($m){$hp.createFromYawPitchRoll($m.y,$m.x,$m.z,this._rotation),this.rotation=this._rotation;}),$A(0,$p,"forward",function(){var $m=this.worldMatrix.elements;return this._forward.elements[0]=-$m[8],this._forward.elements[1]=-$m[9],this._forward.elements[2]=-$m[10],this._forward;}),$A(0,$p,"up",function(){var $m=this.worldMatrix.elements;return this._up.elements[0]=$m[4],this._up.elements[1]=$m[5],this._up.elements[2]=$m[6],this._up;}),$A(0,$p,"right",function(){var $m=this.worldMatrix.elements;return this._right.elements[0]=$m[0],this._right.elements[1]=$m[1],this._right.elements[2]=$m[2],this._right;}),$A(0,$p,"parent",function(){return this._parent;},function($m){if(this._parent!==$m){if(this._parent){var $p=this._parent._childs,$h=$p.indexOf(this);$p.splice($h,1);}$m&&($m._childs.push(this),$m&&this._onWorldTransform()),this._parent=$m;}}),$F($Y,["_tempVector30",function(){return this._tempVector30=new $kp();},"_tempVector31",function(){return this._tempVector31=new $kp();},"_tempVector32",function(){return this._tempVector32=new $kp();},"_tempVector33",function(){return this._tempVector33=new $kp();},"_tempQuaternion0",function(){return this._tempQuaternion0=new $hp();},"_tempMatrix0",function(){return this._tempMatrix0=new $mp();},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI;}]),$Y;}(),$Ep=(function($m){function $p(){this._rotation=0,this._matNeedUpdte=!1,$p.__super.call(this),this._matrix=new $mp(),this._offset=new $qp(),this._tiling=new $qp(1,1);}$$($p,"laya.d3.core.TransformUV",$q);var $h=$p.prototype;$H.imps($h,{"laya.d3.core.IClone":!0}),$h._updateMatrix=function(){$p._tempOffsetV3.elements[0]=this._offset.x,$p._tempOffsetV3.elements[1]=this._offset.y,$hp.createFromYawPitchRoll(0,0,this._rotation,$p._tempRotationQua),$p._tempTitlingV3.elements[0]=this._tiling.x,$p._tempTitlingV3.elements[1]=this._tiling.y,$mp.createAffineTransformation($p._tempOffsetV3,$p._tempRotationQua,$p._tempTitlingV3,this._matrix);},$h.cloneTo=function($m){$m._matrix=this._matrix.clone(),$m._offset=this._offset.clone(),$m._rotation=this._rotation,$m._tiling=this._tiling.clone();},$h.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$h,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix;}),$A(0,$h,"tiling",function(){return this._tiling;},function($m){this._tiling=$m,this._matNeedUpdte=!0;}),$A(0,$h,"offset",function(){return this._offset;},function($m){this._offset=$m,this._matNeedUpdte=!0;}),$A(0,$h,"rotation",function(){return this._rotation;},function($m){this._rotation=$m,this._matNeedUpdte=!0;}),$F($p,["_tempOffsetV3",function(){return this._tempOffsetV3=new $kp(0,0,0);},"_tempRotationQua",function(){return this._tempRotationQua=new $hp();},"_tempTitlingV3",function(){return this._tempTitlingV3=new $kp(1,1,1);}]);}(),function($h){function $m(){this.x=NaN,this.y=NaN,this.z=NaN,$m.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1;}$$($m,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$h);var $p=$m.prototype;$p._getShapeBoundBox=function($m){var $p=$m.min.elements;$p[0]=.5*-this.x,$p[1]=.5*-this.y,$p[2]=.5*-this.z;var $h=$m.max.elements;$h[0]=.5*this.x,$h[1]=.5*this.y,$h[2]=.5*this.z;},$p._getSpeedBoundBox=function($m){var $p=$m.min.elements;$p[0]=0,$p[1]=0,$p[2]=0;var $h=$m.max.elements;$h[0]=0,$h[1]=1,$h[2]=0;},$p.generatePositionAndDirection=function($m,$p,$h,$P){var $L=$m.elements,$q=$p.elements;$h?($h.seed=$P[16],$r._randomPointInsideHalfUnitBox($m,$h),$P[16]=$h.seed):$r._randomPointInsideHalfUnitBox($m),$L[0]=this.x*$L[0],$L[1]=this.y*$L[1],$L[2]=this.z*$L[2],this.randomDirection?$h?($h.seed=$P[17],$r._randomPointUnitSphere($p,$h),$P[17]=$h.seed):$r._randomPointUnitSphere($p):($q[0]=0,$q[1]=0,$q[2]=1);},$p.cloneTo=function($m){$h.prototype.cloneTo.call(this,$m);var $p=$m;$p.x=this.x,$p.y=this.y,$p.z=this.z,$p.randomDirection=this.randomDirection;};}($w),function($h){function $k(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$k.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1;}$$($k,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$h);var $m=$k.prototype;$m._getShapeBoundBox=function($m){var $p=$m.min.elements;$p[0]=$p[2]=-this.radius,$p[1]=0;var $h=$m.max.elements;$h[0]=$h[2]=this.radius,$h[1]=0;},$m._getSpeedBoundBox=function($m){var $p=$m.min.elements;$p[0]=$p[1]=-1,$p[2]=0;var $h=$m.max.elements;$h[0]=$h[1]=1,$h[2]=0;},$m.generatePositionAndDirection=function($m,$p,$h,$P){var $L=$m.elements,$q=$k._tempPositionPoint.elements;$h?($h.seed=$P[16],this.emitFromEdge?$r._randomPointUnitArcCircle(this.arc,$k._tempPositionPoint,$h):$r._randomPointInsideUnitArcCircle(this.arc,$k._tempPositionPoint,$h),$P[16]=$h.seed):this.emitFromEdge?$r._randomPointUnitArcCircle(this.arc,$k._tempPositionPoint):$r._randomPointInsideUnitArcCircle(this.arc,$k._tempPositionPoint),$L[0]=-$q[0],$L[1]=$q[1],$L[2]=0,$kp.scale($m,this.radius,$m),this.randomDirection?$h?($h.seed=$P[17],$r._randomPointUnitSphere($p,$h),$P[17]=$h.seed):$r._randomPointUnitSphere($p):$m.cloneTo($p);},$m.cloneTo=function($m){$h.prototype.cloneTo.call(this,$m);var $p=$m;$p.radius=this.radius,$p.arc=this.arc,$p.emitFromEdge=this.emitFromEdge,$p.randomDirection=this.randomDirection;},$F($k,["_tempPositionPoint",function(){return this._tempPositionPoint=new $qp();}]);}($w),function($h){function $R(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$R.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1;}$$($R,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$h);var $m=$R.prototype;$m._getShapeBoundBox=function($m){var $p=this.radius+this.length*Math.sin(this.angle),$h=this.length*Math.cos(this.angle),$P=$m.min.elements;$P[0]=$P[1]=-$p,$P[2]=0;var $L=$m.max.elements;$L[0]=$L[1]=$p,$L[2]=$h;},$m._getSpeedBoundBox=function($m){var $p=Math.sin(this.angle),$h=$m.min.elements;$h[0]=$h[1]=-$p,$h[2]=0;var $P=$m.max.elements;$P[0]=$h[1]=$p,$P[2]=1;},$m.generatePositionAndDirection=function($m,$p,$h,$P){var $L,$q=$m.elements,$k=$p.elements,$Y=$R._tempPositionPoint.elements,$d=NaN,$K=NaN,$D=Math.cos(this.angle),$F=Math.sin(this.angle);switch(this.emitType){case 0:$h?($h.seed=$P[16],$r._randomPointInsideUnitCircle($R._tempPositionPoint,$h),$P[16]=$h.seed):$r._randomPointInsideUnitCircle($R._tempPositionPoint),$d=$Y[0],$K=$Y[1],$q[0]=$d*this.radius,$q[1]=$K*this.radius,$q[2]=0,this.randomDirection?($h?($h.seed=$P[17],$r._randomPointInsideUnitCircle($R._tempDirectionPoint,$h),$P[17]=$h.seed):$r._randomPointInsideUnitCircle($R._tempDirectionPoint),$L=$R._tempDirectionPoint.elements,$k[0]=$L[0]*$F,$k[1]=$L[1]*$F):($k[0]=$d*$F,$k[1]=$K*$F),$k[2]=$D;break;case 1:$h?($h.seed=$P[16],$r._randomPointUnitCircle($R._tempPositionPoint,$h),$P[16]=$h.seed):$r._randomPointUnitCircle($R._tempPositionPoint),$d=$Y[0],$K=$Y[1],$q[0]=$d*this.radius,$q[1]=$K*this.radius,$q[2]=0,this.randomDirection?($h?($h.seed=$P[17],$r._randomPointInsideUnitCircle($R._tempDirectionPoint,$h),$P[17]=$h.seed):$r._randomPointInsideUnitCircle($R._tempDirectionPoint),$L=$R._tempDirectionPoint.elements,$k[0]=$L[0]*$F,$k[1]=$L[1]*$F):($k[0]=$d*$F,$k[1]=$K*$F),$k[2]=$D;break;case 2:$h?($h.seed=$P[16],$r._randomPointInsideUnitCircle($R._tempPositionPoint,$h)):$r._randomPointInsideUnitCircle($R._tempPositionPoint),$d=$Y[0],$K=$Y[1],$q[0]=$d*this.radius,$q[1]=$K*this.radius,$k[$q[2]=0]=$d*$F,$k[1]=$K*$F,$k[2]=$D,$kp.normalize($p,$p),$h?($kp.scale($p,this.length*$h.getFloat(),$p),$P[16]=$h.seed):$kp.scale($p,this.length*Math.random(),$p),$kp.add($m,$p,$m),this.randomDirection&&($h?($h.seed=$P[17],$r._randomPointUnitSphere($p,$h),$P[17]=$h.seed):$r._randomPointUnitSphere($p));break;case 3:$h?($h.seed=$P[16],$r._randomPointUnitCircle($R._tempPositionPoint,$h)):$r._randomPointUnitCircle($R._tempPositionPoint),$d=$Y[0],$K=$Y[1],$q[0]=$d*this.radius,$q[1]=$K*this.radius,$k[$q[2]=0]=$d*$F,$k[1]=$K*$F,$k[2]=$D,$kp.normalize($p,$p),$h?($kp.scale($p,this.length*$h.getFloat(),$p),$P[16]=$h.seed):$kp.scale($p,this.length*Math.random(),$p),$kp.add($m,$p,$m),this.randomDirection&&($h?($h.seed=$P[17],$r._randomPointUnitSphere($p,$h),$P[17]=$h.seed):$r._randomPointUnitSphere($p));break;default:throw new Error("ConeShape:emitType is invalid.");}},$m.cloneTo=function($m){$h.prototype.cloneTo.call(this,$m);var $p=$m;$p.angle=this.angle,$p.radius=this.radius,$p.length=this.length,$p.emitType=this.emitType,$p.randomDirection=this.randomDirection;},$F($R,["_tempPositionPoint",function(){return this._tempPositionPoint=new $qp();},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $qp();}]);}($w),function($h){function $m(){this.radius=NaN,this.emitFromShell=!1,$m.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1;}$$($m,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$h);var $p=$m.prototype;$p._getShapeBoundBox=function($m){var $p=$m.min.elements;$p[0]=$p[1]=$p[2]=-this.radius;var $h=$m.max.elements;$h[0]=$h[1]=this.radius,$h[2]=0;},$p._getSpeedBoundBox=function($m){var $p=$m.min.elements;$p[0]=$p[1]=-1,$p[2]=0;var $h=$m.max.elements;$h[0]=$h[1]=$h[2]=1;},$p.generatePositionAndDirection=function($m,$p,$h,$P){var $L=$m.elements;$h?($h.seed=$P[16],this.emitFromShell?$r._randomPointUnitSphere($m,$h):$r._randomPointInsideUnitSphere($m,$h),$P[16]=$h.seed):this.emitFromShell?$r._randomPointUnitSphere($m):$r._randomPointInsideUnitSphere($m),$kp.scale($m,this.radius,$m);var $q=$L[2];$q<0&&($L[2]=-1*$q),this.randomDirection?$h?($h.seed=$P[17],$r._randomPointUnitSphere($p,$h),$P[17]=$h.seed):$r._randomPointUnitSphere($p):$m.cloneTo($p);},$p.cloneTo=function($m){$h.prototype.cloneTo.call(this,$m);var $p=$m;$p.radius=this.radius,$p.emitFromShell=this.emitFromShell,$p.randomDirection=this.randomDirection;};}($w),function($h){function $m(){this.radius=NaN,this.emitFromShell=!1,$m.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1;}$$($m,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$h);var $p=$m.prototype;$p._getShapeBoundBox=function($m){var $p=$m.min.elements;$p[0]=$p[1]=$p[2]=-this.radius;var $h=$m.max.elements;$h[0]=$h[1]=$h[2]=this.radius;},$p._getSpeedBoundBox=function($m){var $p=$m.min.elements;$p[0]=$p[1]=$p[2]=-1;var $h=$m.max.elements;$h[0]=$h[1]=$h[2]=1;},$p.generatePositionAndDirection=function($m,$p,$h,$P){$h?($h.seed=$P[16],this.emitFromShell?$r._randomPointUnitSphere($m,$h):$r._randomPointInsideUnitSphere($m,$h),$P[16]=$h.seed):this.emitFromShell?$r._randomPointUnitSphere($m):$r._randomPointInsideUnitSphere($m),$kp.scale($m,this.radius,$m),this.randomDirection?$h?($h.seed=$P[17],$r._randomPointUnitSphere($p,$h),$P[17]=$h.seed):$r._randomPointUnitSphere($p):$m.cloneTo($p);},$p.cloneTo=function($m){$h.prototype.cloneTo.call(this,$m);var $p=$m;$p.radius=this.radius,$p.emitFromShell=this.emitFromShell,$p.randomDirection=this.randomDirection;};}($w),function($m){function $p(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$p.__super.call(this);}return $$($p,"laya.d3.core.render.SubMeshRenderElement",$o),$p;}()),$Ip=function($m){function $n($m,$p,$h,$P,$L,$q){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$m,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$$p.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$Vp.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$Vp.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$xp.SHADERDEFINE_ALPHATEST]="ALPHATEST";$n.__super.call(this,$m,$p,$h,null,{}),this._attributeMap=$P;var $k;for($k in $L){var $Y=$L[$k];switch($Y[1]){case 0:this._renderElementUniformMap[$k]=$Y[0];break;case 1:this._materialUniformMap[$k]=$Y[0];break;case 2:this._spriteUniformMap[$k]=$Y[0];break;case 3:this._cameraUniformMap[$k]=$Y[0];break;case 4:this._sceneUniformMap[$k]=$Y[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.");}}}$$($n,"laya.d3.shader.ShaderCompile3D",$a);var $p=$n.prototype;return $p._definesToNameDic=function($m,$p){for(var $h={},$P=1,$L=0;$L<32&&!($m<($P=1<<$L));$L++)if($m&$P){var $q=$p[$P];$q&&($h[$q]="");}return $h;},$p.withCompile=function($m,$p,$h,$P){var $L,$q,$k;if($q=this.sharders[$m]){if($k=$q[$p]){if($L=$k[$h])return $L;}else $k=$q[$p]=[];}else $k=($q=this.sharders[$m]=[])[$p]=[];var $Y,$d=this._definesToNameDic($m,$n._globalInt2name),$K=this._definesToNameDic($p,this._spriteInt2name),$D=this._definesToNameDic($h,this._materialInt2name),$F={},$R="";if($d)for($Y in $d)$R+="#define "+$Y+"\n",$F[$Y]=!0;if($K)for($Y in $K)$R+="#define "+$Y+"\n",$F[$Y]=!0;if($D)for($Y in $D)$R+="#define "+$Y+"\n",$F[$Y]=!0;var $$=$lp.nameKey.getName(this._name)+" compile ("+$m+","+$p+","+$h+")",$A=this._VS.toscript($F,[]),$B=this._PS.toscript($F,[]);$u.now();if($L=$lp.create($R+$A.join("\n"),$R+$B.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$P,$$),$k[$h]=$L,laya.d3.shader.ShaderCompile3D.debugMode)$u.now();return $L;},$p.precompileShaderWithShaderDefine=function($m,$p,$h){this.withCompile($m,$p,$h,!0);},$p.addMaterialDefines=function($m){var $p=$m.defines;for(var $h in $p){var $P=$p[$h],$L=parseInt($h);this._materialInt2name[$L]=$P,this._materialName2Int[$P]=$L;}},$p.addSpriteDefines=function($m){var $p=$m.defines;for(var $h in $p){var $P=$p[$h],$L=parseInt($h);this._spriteInt2name[$L]=$P,this._spriteName2Int[$P]=$L;}},$p.getMaterialDefineByName=function($m){return this._materialName2Int[$m];},$p.registerMaterialDefine=function($m){var $p=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$p]=$m,this._materialName2Int[$m]=$p;},$p.registerSpriteDefine=function($m){var $p=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$p]=$m,this._spriteName2Int[$m]=$p;},$n._globalRegDefine=function($m,$p){$n._globalInt2name[$p]=$m;},$n.add=function($m,$p,$h,$P,$L){return laya.d3.shader.ShaderCompile3D._preCompileShader[$m]=new $n($m,$p,$h,$P,$L,$a.includes);},$n.get=function($m){return laya.d3.shader.ShaderCompile3D._preCompileShader[$lp.nameKey.getID($m)];},$n._preCompileShader={},$n._globalInt2name=[],$n.debugMode=!1,$n.SHADERDEFINE_HIGHPRECISION=1,$n.SHADERDEFINE_FOG=4,$n.SHADERDEFINE_DIRECTIONLIGHT=8,$n.SHADERDEFINE_POINTLIGHT=16,$n.SHADERDEFINE_SPOTLIGHT=32,$n.SHADERDEFINE_UV0=64,$n.SHADERDEFINE_COLOR=128,$n.SHADERDEFINE_UV1=256,$n.SAHDERDEFINE_DEPTHFOG=131072,$n;}(),$bp=function($m){function $A(){$A.__super.call(this);}$$($A,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$Pm);var $p=$A.prototype;return $p._getStaticBatch=function($m,$p,$h,$P){var $L,$q;return $q=$m?$m.id.toString()+$h.id.toString()+$p.id.toString()+$P.toString():$h.id.toString()+$p.id.toString()+$P.toString(),this._staticBatches[$q]?$L=this._staticBatches[$q]:this._staticBatches[$q]=$L=new $Tp($q,this,$m,$p,$h),$L;},$p._initStaticBatchs=function($m){var $p,$h;this._initBatchRenderElements.sort($A._sortPrepareStaticBatch);for(var $P,$L=!1,$q=0,$k=0,$Y=this._initBatchRenderElements.length;$k<$Y;$k++){var $d,$K=this._initBatchRenderElements[$k],$D=$K.renderObj._getVertexBuffer(0);$K._sprite3D;if($h===$D.vertexDeclaration&&$p===$K._material){if($L)$P._addCombineBatchRenderObjTest($K)?($d=$K._staticBatch)!==$P&&($d&&$d._deleteCombineBatchRenderObj($K),$P._addCombineBatchRenderObj($K)):($L=!1,$q++);else{var $F=this._initBatchRenderElements[$k-1],$R=$F.renderObj,$$=$K.renderObj;$L=!(65535<$R._getVertexBuffer().vertexCount+$$._getVertexBuffer().vertexCount)&&($P=this._getStaticBatch($m,$h,$p,$q),($d=$F._staticBatch)!==$P&&($d&&$d._deleteCombineBatchRenderObj($F),$P._addCombineBatchRenderObj($F)),($d=$K._staticBatch)!==$P&&($d&&$d._deleteCombineBatchRenderObj($K),$P._addCombineBatchRenderObj($K)),!0);}}else $L=!1,$q=0;$p=$K._material,$h=$D.vertexDeclaration;}},$A._sortPrepareStaticBatch=function($m,$p){var $h=$m._render,$P=$p._render,$L=$h.lightmapIndex-$P.lightmapIndex;if(0!=$L)return $L;var $q=$h.receiveShadow-$P.receiveShadow;if(0!=$q)return $q;var $k=$m._mainSortID-$p._mainSortID;return 0==$k?$m.renderObj.triangleCount-$p.renderObj.triangleCount:$k;},$A;}(),$Tp=function($m){function $q($m,$p,$h,$P,$L){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$q.__super.call(this,$m,$p,$h),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$P,this._material=$L;}$$($q,"laya.d3.graphics.SubMeshStaticBatch",$Lm);var $p=$q.prototype;return $p._compareBatchRenderElement=function($m,$p){return $m._batchIndexStart>$p._batchIndexStart;},$p._addCombineBatchRenderObjTest=function($m){var $p=$m.renderObj._vertexCount;return!(65535<(0<$p?this._currentCombineVertexCount+$p:this._currentCombineVertexCount+$m.renderObj._getVertexBuffer().vertexCount));},$p._addCombineBatchRenderObj=function($m){var $p=$m.renderObj,$h=$p._vertexCount;this._initBatchRenderElements.push($m),$m._staticBatch=this,0<$h?(this._currentCombineIndexCount+=$p._indexCount,this._currentCombineVertexCount+=$h):(this._currentCombineIndexCount=this._currentCombineIndexCount+$p._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$p._getVertexBuffer().vertexCount),this._needFinishCombine=!0;},$p._deleteCombineBatchRenderObj=function($m){var $p=$m.renderObj,$h=this._initBatchRenderElements.indexOf($m);if(-1!==$h){this._initBatchRenderElements.splice($h,1),$m._staticBatch=null;var $P=$p._vertexCount;0<$P?(this._currentCombineIndexCount=this._currentCombineIndexCount-$p._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$P):(this._currentCombineIndexCount=this._currentCombineIndexCount-$p._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$p._getVertexBuffer().vertexCount),this._needFinishCombine=!0;}},$p._finishInit=function(){if(this._needFinishCombine){var $m=0,$p=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $h=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$P=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$wp.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$zp.create("ushort",this._currentCombineIndexCount,35044);for(var $L=0,$q=this._initBatchRenderElements.length;$L<$q;$L++){var $k=this._initBatchRenderElements[$L],$Y=$k.renderObj,$d=$Y._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$k._sprite3D),$K=$Y.getIndices(),$D=$k._sprite3D.transform._isFrontFaceInvert,$F=$m/(this._vertexDeclaration.vertexStride/4)-$Y._vertexStart,$R=$p,$$=$R+$K.length;$k._batchIndexStart=$R,$k._batchIndexEnd=$$,$P.set($K,$p);var $A=0;if($D)for($A=$R;$A<$$;$A+=3){$P[$A]=$F+$P[$A];var $B=$P[$A+1],$n=$P[$A+2];$P[$A+1]=$F+$n,$P[$A+2]=$F+$B;}else for($A=$R;$A<$$;$A+=3)$P[$A]=$F+$P[$A],$P[$A+1]=$F+$P[$A+1],$P[$A+2]=$F+$P[$A+2];$p+=$K.length,$h.set($d,$m),$m+=$d.length;}this._vertexBuffer.setData($h),this._indexBuffer.setData($P),this._needFinishCombine=!1;}},$p._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $Ep());},$p._getRenderElement=function($m,$p,$h){for(var $P,$L,$q=this._batchRenderElements.length,$k=!0,$Y=0;$Y<$q;$Y++){var $d,$K,$D=($L=this._batchRenderElements[$Y])._sprite3D._render;if(0!==$Y&&($k=($d=($P=this._batchRenderElements[$Y-1])._sprite3D._render).lightmapIndex!==$D.lightmapIndex||$d.receiveShadow!==$D.receiveShadow||$P._batchIndexEnd!==$L._batchIndexStart),$k){($K=this._getCombineRenderElementFromPool()).renderObj=this,$K._material=this._material,$K._batchIndexStart=$L._batchIndexStart,$K._batchIndexEnd=$L._batchIndexEnd;var $F=$D.lightmapIndex,$R=$F+1,$$=this._batchOwnerIndices[$R];$$||($$=this._batchOwnerIndices[$R]=[]);var $A,$B=$$[$L._render.receiveShadow?1:0];void 0===$B?($$[$D.receiveShadow?1:0]=this._batchOwners.length,($A=new $fp(null,"StaticBatchMeshSprite3D"))._scene=$p,$A._transform=this._rootOwner?this._rootOwner._transform:null,$A._render.lightmapIndex=$F,$A._render.receiveShadow=$L._render.receiveShadow,this._batchOwners.push($A)):$A=this._batchOwners[$B],$A._render._renderUpdate($h),$K._sprite3D=$A,$m.push($K);}else $K._batchIndexEnd=$L._batchIndexEnd;}},$p._beforeRender=function($m){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0;},$p._render=function($m){var $p=$m.renderElement,$h=$p._batchIndexStart,$P=$p._batchIndexEnd-$h;$Q.mainContext.drawElements(4,$P,5123,2*$h),$I.drawCall++,$I.trianglesFaces+=$P/3;},$p.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy();},$p._getVertexBuffer=function($m){return void 0===$m&&($m=0),this._vertexBuffer;},$q;}(),$jp=function($m){function $p(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$p.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[];}$$($p,"laya.d3.core.ComponentNode",$K);var $h=$p.prototype;return $h.addComponent=function($m){var $p,$h=this._componentsMap.indexOf($m);if(-1===$h)$p=[],this._componentsMap.push($m),this._typeComponentsIndices.push($p);else if($p=this._typeComponentsIndices[$h],this._components[$p[0]].isSingleton)throw new Error("无法单实例创建"+$m+"组件，"+$m+"组件已存在！");var $P=$L.getInstance($m);return $p.push(this._components.length),this._components.push($P),$P instanceof laya.d3.component.Script&&this._scripts.push($P),$P._initialize(this),$P;},$h._removeComponent=function($m,$p){var $h=this._typeComponentsIndices[$m],$P=$h[$p],$L=this._components[$P];this._components.splice($P,1),$L instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($L),1),$h.splice($p,1),0===$h.length&&(this._typeComponentsIndices.splice($m,1),this._componentsMap.splice($m,1));for(var $q=0,$k=this._componentsMap.length;$q<$k;$q++)for(var $Y=($h=this._typeComponentsIndices[$q]).length-1;0<=$Y;$Y--){var $d=$h[$Y];if(!($P<$d))break;$h[$Y]=--$d;}$L._destroy();},$h.getComponentByType=function($m,$p){void 0===$p&&($p=0);var $h=this._componentsMap.indexOf($m);return-1===$h?null:this._components[this._typeComponentsIndices[$h][$p]];},$h.getComponentsByType=function($m,$p){var $h=this._componentsMap.indexOf($m);if(-1!==$h){var $P=this._typeComponentsIndices[$h],$L=$P.length;$p.length=$L;for(var $q=0;$q<$L;$q++)$p[$q]=this._components[$P[$q]];}else $p.length=0;},$h.getComponentByIndex=function($m){return this._components[$m];},$h.removeComponentByType=function($m,$p){void 0===$p&&($p=0);var $h=this._componentsMap.indexOf($m);-1!==$h&&this._removeComponent($h,$p);},$h.removeComponentsByType=function($m){var $p=this._componentsMap.indexOf($m);if(-1!==$p)for(var $h=this._typeComponentsIndices[$p],$P=0,$L=$h.length;$P<$L;$h.length<$L?$L--:$P++)this._removeComponent($p,$P);},$h.removeAllComponent=function(){for(var $m=0,$p=this._componentsMap.length;$m<$p;this._componentsMap.length<$p?$p--:$m++)this.removeComponentsByType(this._componentsMap[$m]);},$h._updateComponents=function($m){for(var $p=0,$h=this._components.length;$p<$h;$p++){var $P=this._components[$p];!$P.started&&($P._start($m),$P.started=!0),$P.enable&&$P._update($m);}},$h._lateUpdateComponents=function($m){for(var $p=0;$p<this._components.length;$p++){var $h=this._components[$p];!$h.started&&($h._start($m),$h.started=!0),$h.enable&&$h._lateUpdate($m);}},$h._preRenderUpdateComponents=function($m){for(var $p=0;$p<this._components.length;$p++){var $h=this._components[$p];!$h.started&&($h._start($m),$h.started=!0),$h.enable&&$h._preRenderUpdate($m);}},$h._postRenderUpdateComponents=function($m){for(var $p=0;$p<this._components.length;$p++){var $h=this._components[$p];!$h.started&&($h._start($m),$h.started=!0),$h.enable&&$h._postRenderUpdate($m);}},$p;}(),$xp=function($P){function $m(){$m.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $Rp(),this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $Yp(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0;}$$($m,"laya.d3.core.material.BaseMaterial",$P);var $p=$m.prototype;return $H.imps($p,{"laya.d3.core.IClone":!0}),$p._addShaderDefine=function($m){this._shaderDefineValue|=$m;},$p._removeShaderDefine=function($m){this._shaderDefineValue&=~$m;},$p._addDisablePublicShaderDefine=function($m){this._disablePublicShaderDefine|=$m;},$p._removeDisablePublicShaderDefine=function($m){this._disablePublicShaderDefine&=~$m;},$p._setBuffer=function($m,$p){this._shaderValues.setValue($m,$p),this._values[$m]=$p;},$p._getBuffer=function($m){return this._values[$m];},$p._setMatrix4x4=function($m,$p){this._shaderValues.setValue($m,$p?$p.elements:null),this._values[$m]=$p;},$p._getMatrix4x4=function($m){return this._values[$m];},$p._setInt=function($m,$p){this._shaderValues.setValue($m,$p),this._values[$m]=$p;},$p._getInt=function($m){return this._values[$m];},$p._setNumber=function($m,$p){this._shaderValues.setValue($m,$p),this._values[$m]=$p;},$p._getNumber=function($m){return this._values[$m];},$p._setBool=function($m,$p){this._shaderValues.setValue($m,$p),this._values[$m]=$p;},$p._getBool=function($m){return this._values[$m];},$p._setVector2=function($m,$p){this._shaderValues.setValue($m,$p?$p.elements:null),this._values[$m]=$p;},$p._getVector2=function($m){return this._values[$m];},$p._setColor=function($m,$p){this._shaderValues.setValue($m,$p?$p.elements:null),this._values[$m]=$p;},$p._getColor=function($m){return this._values[$m];},$p._setTexture=function($m,$p){var $h=this._values[$m];this._values[$m]=$p,this._shaderValues.setValue($m,$p),0<this.referenceCount&&($h&&$h._removeReference(),$p&&$p._addReference());},$p._getTexture=function($m){return this._values[$m];},$p._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data);},$p._getShader=function($m,$p,$h){var $P=($m|$p)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($P,$h,this._shaderDefineValue),this._shader;},$p._setRenderStateBlendDepth=function(){var $m=$Q.mainContext;switch($M.setDepthMask($m,this.depthWrite),0===this.depthTest?$M.setDepthTest($m,!1):($M.setDepthTest($m,!0),$M.setDepthFunc($m,this.depthTest)),this.blend){case 0:$M.setBlend($m,!1);break;case 1:$M.setBlend($m,!0),$M.setBlendFunc($m,this.srcBlend,this.dstBlend);break;case 2:$M.setBlend($m,!0);}},$p._setRenderStateFrontFace=function($m,$p){var $h=$Q.mainContext,$P=0;switch(this.cull){case 0:$M.setCullFace($h,!1);break;case 1:$M.setCullFace($h,!0),$P=$m?$p&&$p._isFrontFaceInvert?2305:2304:$p&&$p._isFrontFaceInvert?2304:2305,$M.setFrontFace($h,$P);break;case 2:$M.setCullFace($h,!0),$P=$m?$p&&$p._isFrontFaceInvert?2304:2305:$p&&$p._isFrontFaceInvert?2305:2304,$M.setFrontFace($h,$P);}},$p.onAsynLoaded=function($m,$p,$h){var $P=$p[0],$L=$p[1];switch($P.version){case"LAYAMATERIAL:01":var $q=0,$k=0,$Y=$P.props;for(var $d in $Y)switch($d){case"vectors":var $K=$Y[$d];for($q=0,$k=$K.length;$q<$k;$q++){var $D=$K[$q],$F=$D.value;switch($F.length){case 2:this[$D.name]=new $qp($F[0],$F[1]);break;case 3:this[$D.name]=new $kp($F[0],$F[1],$F[2]);break;case 4:this[$D.name]=new $Yp($F[0],$F[1],$F[2],$F[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.");}}break;case"textures":var $R=$Y[$d];for($q=0,$k=$R.length;$q<$k;$q++){var $$=$R[$q],$A=$$.path;$A&&(this[$$.name]=$c.getRes($L[$A]));}break;case"defines":var $B=$Y[$d];for($q=0,$k=$B.length;$q<$k;$q++){var $n=this._shaderCompile.getMaterialDefineByName($B[$q]);this._addShaderDefine($n);}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$d]=$Y[$d];break;case"renderQueue":switch($Y[$d]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3;}break;default:this[$d]=$Y[$d];}break;case"LAYAMATERIAL:02":for($d in $Y=$P.props)switch($d){case"vectors":for($q=0,$k=($K=$Y[$d]).length;$q<$k;$q++)switch(($F=($D=$K[$q]).value).length){case 2:this[$D.name]=new $qp($F[0],$F[1]);break;case 3:this[$D.name]=new $kp($F[0],$F[1],$F[2]);break;case 4:this[$D.name]=new $Yp($F[0],$F[1],$F[2],$F[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.");}break;case"textures":for($q=0,$k=($R=$Y[$d]).length;$q<$k;$q++)($A=($$=$R[$q]).path)&&(this[$$.name]=$c.getRes($L[$A]));break;case"defines":for($q=0,$k=($B=$Y[$d]).length;$q<$k;$q++)$n=this._shaderCompile.getMaterialDefineByName($B[$q]),this._addShaderDefine($n);break;default:this[$d]=$Y[$d];}break;default:throw new Error("BaseMaterial:unkonwn version.");}this._endLoaded();},$p._addReference=function(){$P.prototype._addReference.call(this);for(var $m=0,$p=this._values.length;$m<$p;$m++){var $h=this._values[$m];$h&&$h instanceof laya.d3.resource.BaseTexture&&$h._addReference();}},$p._removeReference=function(){$P.prototype._removeReference.call(this);for(var $m=0,$p=this._values.length;$m<$p;$m++){var $h=this._values[$m];$h&&$h instanceof laya.d3.resource.BaseTexture&&$h._removeReference();}},$p.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null;},$p.setShaderName=function($m){var $p=$lp.nameKey.getID($m);if(-1===$p)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$Ip._preCompileShader[$p];},$p.cloneTo=function($m){var $p=$m;$p.name=this.name,$p.cull=this.cull,$p.blend=this.blend,$p.srcBlend=this.srcBlend,$p.dstBlend=this.dstBlend,$p.srcBlendRGB=this.srcBlendRGB,$p.dstBlendRGB=this.dstBlendRGB,$p.srcBlendAlpha=this.srcBlendAlpha,$p.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($p.blendConstColor),$p.blendEquation=this.blendEquation,$p.blendEquationRGB=this.blendEquationRGB,$p.blendEquationAlpha=this.blendEquationAlpha,$p.depthTest=this.depthTest,$p.depthWrite=this.depthWrite,$p.renderQueue=this.renderQueue,$p._shader=this._shader,$p._disablePublicShaderDefine=this._disablePublicShaderDefine,$p._shaderDefineValue=this._shaderDefineValue;var $h,$P=0,$L=$p._shaderValues;$p._shaderValues.data.length=this._shaderValues.data.length;var $q=this._values.length,$k=$p._values;for($P=0,$h=$k.length=$q;$P<$h;$P++){var $Y=this._values[$P];if($Y)if("number"==typeof $Y)$k[$P]=$Y,$L.data[$P]=$Y;else if("number"==typeof $Y&&Math.floor($Y)==$Y)$k[$P]=$Y,$L.data[$P]=$Y;else if("boolean"==typeof $Y)$k[$P]=$Y,$L.data[$P]=$Y;else if($Y instanceof laya.d3.math.Vector2){var $d=$k[$P]||($k[$P]=new $qp());$Y.cloneTo($d),$L.data[$P]=$d.elements;}else if($Y instanceof laya.d3.math.Vector3){var $K=$k[$P]||($k[$P]=new $kp());$Y.cloneTo($K),$L.data[$P]=$K.elements;}else if($Y instanceof laya.d3.math.Vector4){var $D=$k[$P]||($k[$P]=new $Yp());$Y.cloneTo($D),$L.data[$P]=$D.elements;}else if($Y instanceof laya.d3.math.Matrix4x4){var $F=$k[$P]||($k[$P]=new $mp());$Y.cloneTo($F),$L.data[$P]=$F.elements;}else $Y instanceof laya.d3.resource.BaseTexture&&($k[$P]=$Y,$L.data[$P]=$Y);}},$p.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$A(0,$p,"alphaTestValue",function(){return this._getNumber(0);},function($m){this._setNumber(0,$m);}),$A(0,$p,"alphaTest",function(){return this._alphaTest;},function($m){(this._alphaTest=$m)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST);}),$m.__init__=function(){$m.SHADERDEFINE_ALPHATEST=$m.shaderDefines.registerDefine("ALPHATEST");},$m.RENDERQUEUE_OPAQUE=2e3,$m.RENDERQUEUE_ALPHATEST=2450,$m.RENDERQUEUE_TRANSPARENT=3e3,$m.CULL_NONE=0,$m.CULL_FRONT=1,$m.CULL_BACK=2,$m.BLEND_DISABLE=0,$m.BLEND_ENABLE_ALL=1,$m.BLEND_ENABLE_SEPERATE=2,$m.BLENDPARAM_ZERO=0,$m.BLENDPARAM_ONE=1,$m.BLENDPARAM_SRC_COLOR=768,$m.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$m.BLENDPARAM_DST_COLOR=774,$m.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$m.BLENDPARAM_SRC_ALPHA=770,$m.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$m.BLENDPARAM_DST_ALPHA=772,$m.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$m.BLENDPARAM_SRC_ALPHA_SATURATE=776,$m.BLENDEQUATION_ADD=0,$m.BLENDEQUATION_SUBTRACT=1,$m.BLENDEQUATION_REVERSE_SUBTRACT=2,$m.DEPTHTEST_OFF=0,$m.DEPTHTEST_NEVER=512,$m.DEPTHTEST_LESS=513,$m.DEPTHTEST_EQUAL=514,$m.DEPTHTEST_LEQUAL=515,$m.DEPTHTEST_GREATER=516,$m.DEPTHTEST_NOTEQUAL=517,$m.DEPTHTEST_GEQUAL=518,$m.DEPTHTEST_ALWAYS=519,$m.SHADERDEFINE_ALPHATEST=1,$m.ALPHATESTVALUE=0,$F($m,["shaderDefines",function(){return this.shaderDefines=new $Dp();}]),$m;}($n),$Qp=function($m){function $p(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$p.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1;}$$($p,"laya.d3.resource.BaseTexture",$n);var $h=$p.prototype;return $A(0,$h,"width",function(){return this._width;}),$A(0,$h,"repeat",function(){return this._repeat;},function($m){if(this._repeat!==$m&&(this._repeat=$m,this._source)){var $p=$Q.mainContext;$M.bindTexture($p,this._type,this._source),$Z.isPOT(this._width,this._height)&&this._repeat?($p.texParameteri(this._type,10242,10497),$p.texParameteri(this._type,10243,10497)):($p.texParameteri(this._type,10242,33071),$p.texParameteri(this._type,10243,33071));}}),$A(0,$h,"height",function(){return this._height;}),$A(0,$h,"magFifter",function(){return this._magFifter;},function($m){(this._magFifter=$m)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($m);}),$A(0,$h,"wrapModeV",function(){return this._wrapModeV;}),$A(0,$h,"size",function(){return this._size;}),$A(0,$h,"wrapModeU",function(){return this._wrapModeU;}),$A(0,$h,"mipmap",function(){return this._mipmap;},function($m){this._mipmap=$m,this._mipmap!=$m&&this._conchTexture&&this._conchTexture.setMipMap($m);}),$A(0,$h,"minFifter",function(){return this._minFifter;},function($m){this._minFifter=$m,this._minFifter!=$m&&this._conchTexture&&this._conchTexture.setMinFifter($m);}),$A(0,$h,"format",function(){return this._format;}),$A(0,$h,"source",function(){return this.activeResource(),this._source;}),$A(0,$h,"defaulteTexture",function(){return $Up.grayTexture;}),$p.WARPMODE_REPEAT=0,$p.WARPMODE_CLAMP=1,$p;}(),$Mp=function($m){function $p(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$p.__super.call(this),this._boundingBoxCorners=$P(8,null);}$$($p,"laya.d3.resource.models.BaseMesh",$n);var $h=$p.prototype;return $h._getPositions=function(){throw new Error("未Override,请重载该属性！");},$h._generateBoundingObject=function(){this._boundingSphere=new $tm(new $kp(),0),$tm.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $vm(new $kp(),new $kp()),$vm.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners);},$h.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！");},$h.getRenderElement=function($m){throw new Error("未Override,请重载该属性！");},$A(0,$h,"subMeshCount",function(){return this._subMeshCount;}),$A(0,$h,"boundingBox",function(){return this._boundingBox;}),$A(0,$h,"boundingBoxCorners",function(){return this._boundingBoxCorners;}),$A(0,$h,"boundingSphere",function(){return this._boundingSphere;}),$p;}(),$up=(function($m){function $p(){$p.__super.call(this);}$$($p,"laya.d3.component.Script",$ap);var $h=$p.prototype;$h.onTriggerEnter=function($m){},$h.onTriggerExit=function($m){},$h.onTriggerStay=function($m){},$A(0,$h,"isSingleton",function(){return $p._isSingleton;}),$p._isSingleton=!1;}(),function($m){function $p($m){this._owner=null,this._sharedMesh=null,$p.__super.call(this),this._owner=$m;}$$($p,"laya.d3.core.MeshFilter",$m);var $h=$p.prototype;return $h._sharedMeshLoaded=function(){this.event("loaded");},$h._destroy=function(){$m.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null);},$A(0,$h,"sharedMesh",function(){return this._sharedMesh;},function($m){var $p=this._sharedMesh;$p&&$p._removeReference(),(this._sharedMesh=$m)._addReference(),this.event("meshchanged",[this,$p,$m]),$m.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded);}),$A(0,$h,"_isAsyncLoaded",function(){return this._sharedMesh.loaded;}),$A(0,$h,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners;}),$A(0,$h,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere;}),$A(0,$h,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox;}),$p;}($Zp)),$Np=function($m){function $p($m){$p.__super.call(this,$m),$m.meshFilter.on("meshchanged",this,this._onMeshChanged);}$$($p,"laya.d3.core.MeshRender",$Hp);var $h=$p.prototype;return $h._onMeshChanged=function($m,$p,$h){$h.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$h.once("loaded",this,this._onMeshLoaed);},$h._onMeshLoaed=function($m,$p){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0;},$h._calculateBoundingSphereByInitSphere=function($m){var $p=NaN,$h=this._owner.transform,$P=$h.scale.elements,$L=Math.abs($P[0]),$q=Math.abs($P[1]),$k=Math.abs($P[2]);$p=$q<=$L&&$k<=$L?$L:$k<=$q?$q:$k,$kp.transformCoordinate($m.center,$h.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$m.radius*$p;},$h._calculateBoundBoxByInitCorners=function($m){for(var $p=this._owner.transform.worldMatrix,$h=0;$h<8;$h++)$kp.transformCoordinate($m[$h],$p,$Hp._tempBoundBoxCorners[$h]);$vm.createfromPoints($Hp._tempBoundBoxCorners,this._boundingBox);},$h._calculateBoundingSphere=function(){var $m=this._owner.meshFilter.sharedMesh;null==$m||null==$m.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($m.boundingSphere);},$h._calculateBoundingBox=function(){var $m=this._owner.meshFilter.sharedMesh;null==$m||null==$m.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($m.boundingBoxCorners);},$h._renderUpdate=function($m){var $p=this._owner.transform;if($p){this._setShaderValueMatrix4x4(0,$p.worldMatrix);var $h=this._owner.getProjectionViewWorldMatrix($m);this._setShaderValueMatrix4x4(1,$h);}else this._setShaderValueMatrix4x4(0,$mp.DEFAULT),this._setShaderValueMatrix4x4(1,$m);return $cp.debugMode&&this._renderRenderableBoundBox(),!0;},$p;}(),$Sp=function($p){function $P(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$P.__super.call(this),this._renderState=new $i(),this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $Rp(),this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $pm(),this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $kp(.7,.7,.7),this.ambientColor=new $kp(.212,.227,.259),$Q.shaderHighPrecision&&this.addShaderDefine($Ip.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[];}$$($P,"laya.d3.core.scene.Scene",$p);var $m=$P.prototype;return $H.imps($m,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$m._setUrl=function($m){this._url=$m;},$m._getGroup=function(){return this._group;},$m._setGroup=function($m){this._group=$m;},$m._display=function(){$H.stage._scenes.push(this),$H.stage._scenes.sort($P._sortScenes);for(var $m=0,$p=this._childs.length;$m<$p;$m++){var $h=this._childs[$m];$h.active&&$h._activeHierarchy();}},$m._unDisplay=function(){var $m=$H.stage._scenes;$m.splice($m.indexOf(this),1);for(var $p=0,$h=this._childs.length;$p<$h;$p++){var $P=this._childs[$p];$P.active&&$P._inActiveHierarchy();}},$m._addChild3D=function($m){$m.transform._onWorldTransform(),$m._setBelongScene(this),this.displayedInStage&&$m.active&&$m._activeHierarchy();},$m._removeChild3D=function($m){$m.transform.parent=null,this.displayedInStage&&$m.active&&$m._inActiveHierarchy(),$m._setUnBelongScene();},$m.initOctree=function($m,$p,$h,$P,$L){void 0===$L&&($L=6),this.treeSize=new $kp($m,$p,$h),this.treeLevel=$L,this.treeRoot=new $v(this,0),this.treeRoot.init($P,this.treeSize);},$m._prepareUpdateToRenderState=function($m,$p){$p.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$p.scene=this;},$m._prepareSceneToRender=function($m){var $p=this._lights.length;if(0<$p)for(var $h=0,$P=0;$P<$p&&!(this._lights[$P]._prepareToScene($m)&&++$h>=this._enableLightCount);$P++);},$m._updateChilds=function($m){for(var $p=0,$h=this._childs.length;$p<$h;++$p)this._childs[$p]._update($m);},$m._preRenderScene=function($m,$p,$h){var $P,$L=$p._viewMatrix,$q=$p._projectionMatrix,$k=$p._projectionViewMatrix,$Y=0,$d=$p.camera;for($d.useOcclusionCulling?this.treeRoot?$hm.renderObjectCullingOctree($h,this,$d,$L,$q,$k):$hm.renderObjectCulling($h,this,$d,$L,$q,$k):$hm.renderObjectCullingNoBoundFrustum(this,$d,$L,$q,$k),$Y=0,$P=this._quenes.length;$Y<$P;$Y++)this._quenes[$Y]&&this._quenes[$Y]._preRender($p);},$m._clear=function($m,$p){var $h=$p._viewport,$P=$p.camera,$L=$h.x,$q=$P.renderTargetSize.height-$h.y-$h.height,$k=$h.width,$Y=$h.height;$m.viewport($L,$q,$k,$Y);var $d=256,$K=$P.renderTarget;switch($P.clearFlag){case 0:var $D=$P.clearColor;if($D){$m.enable(3089),$m.scissor($L,$q,$k,$Y);var $F=$D.elements;$m.clearColor($F[0],$F[1],$F[2],$F[3]),$d|=16384;}if($K)switch($D||($d=16384),$K.depthStencilFormat){case 33189:$d|=256;break;case 36168:$d|=1024;break;case 34041:$d|=256,$d|=1024;}$m.clear($d),$D&&$m.disable(3089);break;case 1:case 2:if($K)switch($d=16384,$K.depthStencilFormat){case 33189:$d|=256;break;case 36168:$d|=1024;break;case 34041:$d|=256,$d|=1024;}$m.clear($d);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.");}},$m._renderScene=function($m,$p){var $h,$P,$L=$p.camera,$q=0;for($q=0;$q<2;$q++)($P=this._quenes[$q])&&($L.renderTarget?$P._render($p,!0):$P._render($p,!1));if(1===$L.clearFlag){var $k=$L.sky;$k&&($M.setCullFace($m,!1),$M.setDepthFunc($m,515),$M.setDepthMask($m,!1),$k._render($p),$M.setDepthFunc($m,513),$M.setDepthMask($m,!0));}for($q=2,$h=this._quenes.length;$q<$h;$q++)($P=this._quenes[$q])&&($P._sortAlpha($p.camera.transform.position),$L.renderTarget?$P._render($p,!0):$P._render($p,!1));},$m._set3DRenderConfig=function($m){$m.disable(3042),$M._blend=!1,$m.blendFunc(770,771),$M._sFactor=770,$M._dFactor=771,$m.disable(2929),$M._depthTest=!1,$m.enable(2884),$M._cullFace=!0,$m.depthMask(1),$M._depthMask=!0,$m.frontFace(2304),$M._frontFace=2304;},$m._set2DRenderConfig=function($m){$M.setBlend($m,!0),$M.setBlendFunc($m,1,771),$M.setDepthTest($m,!1),$M.setCullFace($m,!1),$M.setDepthMask($m,!0),$M.setFrontFace($m,2305),$m.viewport(0,0,$D.width,$D.height);},$m._parseCustomProps=function($m,$p,$h,$P){var $L=$P.customProps.lightmaps,$q=$L.length,$k=this._lightmaps;$k.length=$q;for(var $Y=0;$Y<$q;$Y++)$k[$Y]=$c.getRes($p[$L[$Y].replace(".exr",".png")]);this.setlightmaps($k);var $d=$P.customProps.ambientColor;$d&&(this.ambientColor=new $kp($d[0],$d[1],$d[2]));var $K=$P.customProps.fogColor;$K&&(this.fogColor=new $kp($K[0],$K[1],$K[2]));},$m._addLight=function($m){this._lights.indexOf($m)<0&&this._lights.push($m);},$m._removeLight=function($m){var $p=this._lights.indexOf($m);0<=$p&&this._lights.splice($p,1);},$m._updateScene=function(){var $m=this._renderState;this._prepareUpdateToRenderState($Q.mainContext,$m),this._updateComponents($m),this._updateChilds($m),this._lateUpdateComponents($m),this._time+=$m.elapsedTime/1e3,this._shaderValues.setValue(22,this._time);},$m._updateSceneConch=function(){var $m=this._renderState;this._prepareUpdateToRenderState($Q.mainContext,$m),this._updateComponents($m),this._lateUpdateComponents($m),this._prepareSceneToRender($m);for(var $p=0,$h=this._cameraPool.length;$p<$h;$p++){var $P=this._cameraPool[$p];($m.camera=$P)._prepareCameraToRender();}},$m._preRenderShadow=function($m,$p,$h,$P,$L){this.treeRoot?$hm.renderShadowObjectCullingOctree(this,$p,$h,$P,$L):$hm.renderShadowObjectCulling(this,$p,$h,$P,$L);for(var $q=0,$k=$h.length;$q<$k;$q++)$h[$q]&&$h[$q]._preRender($m);},$m._renderShadowMap=function($m,$p,$h){var $P=this.parallelSplitShadowMaps[0];$P._calcAllLightCameraInfo($h);var $L,$q,$k,$Y=$P.PSSMNum;if(this._preRenderShadow($p,$P._lightCulling,$P._shadowQuenes,$P._lightVPMatrix[0],$Y),this.addShaderDefine($$p.SHADERDEFINE_CAST_SHADOW),1<$Y)for(var $d=0;$d<$Y;$d++)$L=$P.getRenderTarget($d+1),$P.beginRenderTarget($d+1),$m.clearColor(1,1,1,1),$m.clear(16640),$m.viewport(0,0,$L.width,$L.height),$p.camera=$k=$P.getLightCamera($d),$k._prepareCameraToRender(),$k._prepareCameraViewProject($k.viewMatrix,$k.projectionMatrix),$p._projectionViewMatrix=$P._lightVPMatrix[$d+1],($q=$P._shadowQuenes[$d])._preRender($p),$q._renderShadow($p,!1),$P.endRenderTarget($d+1);else $L=$P.getRenderTarget(1),$P.beginRenderTarget(1),$m.clearColor(1,1,1,1),$m.clear(16640),$m.viewport(0,0,$L.width,$L.height),$p.camera=$k=$P.getLightCamera(0),$k._prepareCameraToRender(),$k._prepareCameraViewProject($k.viewMatrix,$k.projectionMatrix),$p._projectionViewMatrix=$P._lightVPMatrix[0],($q=$P._shadowQuenes[0])._preRender($p),$q._renderShadow($p,!0),$P.endRenderTarget(1);this.removeShaderDefine($$p.SHADERDEFINE_CAST_SHADOW);},$m.addTreeNode=function($m){this.treeRoot.addTreeNode($m);},$m.removeTreeNode=function($m){this.treeSize&&$m._treeNode&&$m._treeNode.removeObject($m);},$m.setlightmaps=function($m){this._lightmaps=$m;for(var $p=0,$h=this._renderableSprite3Ds.length;$p<$h;$p++)this._renderableSprite3Ds[$p]._render._applyLightMapParams();},$m.getlightmaps=function(){return this._lightmaps;},$m.addChildAt=function($m,$p){if(!($m instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($m&&$m.__className));if(!$m||this.destroyed||$m===this)return $m;if($m.zOrder&&this._set$P("hasZorder",!0),0<=$p&&$p<=this._childs.length){if($m._parent===this){var $h=this.getChildIndex($m);this._childs.splice($h,1),this._childs.splice($p,0,$m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,$p)),this._childChanged();}else $m.parent&&$m.parent.removeChild($m),this._childs===$K.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($p,0,$m),this.conchModel&&this.conchModel.addChildAt($m.conchModel,$p),($m.parent=this)._addChild3D($m);return $m;}throw new Error("appendChildAt:The index is out of bounds");},$m.addChild=function($m){if(!($m instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$m||this.destroyed||$m===this)return $m;if($m.zOrder&&this._set$P("hasZorder",!0),$m._parent===this){var $p=this.getChildIndex($m);$p!==this._childs.length-1&&(this._childs.splice($p,1),this._childs.push($m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,this._childs.length-1)),this._childChanged());}else $m.parent&&$m.parent.removeChild($m),this._childs===$K.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($m),this.conchModel&&this.conchModel.addChildAt($m.conchModel,this._childs.length-1),($m.parent=this)._childChanged(),this._addChild3D($m);return $m;},$m.removeChildAt=function($m){var $p=this.getChildAt($m);return $p&&(this._removeChild3D($p),this._childs.splice($m,1),this.conchModel&&this.conchModel.removeChild($p.conchModel),$p.parent=null),$p;},$m.removeChildren=function($m,$p){if(void 0===$m&&($m=0),void 0===$p&&($p=2147483647),this._childs&&0<this._childs.length){var $h=this._childs;if(0===$m&&$q<=$p){var $P=$h;this._childs=$K.ARRAY_EMPTY;}else $P=$h.splice($m,$p-$m);for(var $L=0,$q=$P.length;$L<$q;$L++)this._removeChild3D($P[$L]),$P[$L].parent=null,this.conchModel&&this.conchModel.removeChild($P[$L].conchModel);}return this;},$m.addFrustumCullingObject=function($m){this.treeRoot?this.addTreeNode($m):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($m):this._cullingRenders[this._cullingRendersLength]=$m,$m._indexInSceneFrustumCullingObjects=this._cullingRendersLength++);},$m.removeFrustumCullingObject=function($m){if(this.treeRoot)this.removeTreeNode($m);else{this._cullingRendersLength--;var $p=$m._indexInSceneFrustumCullingObjects;if($p!==this._cullingRendersLength){var $h=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$p]=$h)._indexInSceneFrustumCullingObjects=$p,$m._indexInSceneFrustumCullingObjects=-1;}}},$m.getRenderQueue=function($m){return $m<3e3?this._quenes[1]||(this._quenes[1]=new $f(this)):this._quenes[2]||(this._quenes[2]=new $f(this));},$m.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $f(this);},$m.addShaderDefine=function($m){this._shaderDefineValue|=$m;},$m.removeShaderDefine=function($m){this._shaderDefineValue&=~$m;},$m.addScript=function($m){return this._addComponent($m);},$m.getScriptByType=function($m,$p){return void 0===$p&&($p=0),this._getComponentByType($m,$p);},$m.getScriptsByType=function($m,$p){this._getComponentsByType($m,$p);},$m.getScriptByIndex=function($m){return this._getComponentByIndex($m);},$m.removeScriptByType=function($m,$p){void 0===$p&&($p=0),this._removeComponentByType($m,$p);},$m.removeScriptsByType=function($m){this._removeComponentByType($m);},$m.removeAllScript=function(){this._removeAllComponent();},$m.render=function($m,$p,$h){($B._context.ctx._renderKey=0)<this._childs.length&&$m.addRenderObject(this);},$m.renderSubmit=function(){var $m=$Q.mainContext,$p=this._renderState;this._set3DRenderConfig($m),this._prepareSceneToRender(this._renderState);var $h,$P=0,$L=0;if($cp.debugMode||$v.debugMode)for($P=0,$L=this._cameraPool.length;$P<$L;$P++)$h=this._cameraPool[$P],$cp._debugPhasorSprite.begin(1,$h),$h.activeInHierarchy&&$h._renderCamera($m,$p,this),$cp._debugPhasorSprite.end();else for($P=0,$L=this._cameraPool.length;$P<$L;$P++)($h=this._cameraPool[$P]).activeInHierarchy&&$h._renderCamera($m,$p,this);return this._set2DRenderConfig($m),1;},$m.onAsynLoaded=function($m,$p,$h){var $P=$p[0];if("Scene"!==$P.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $L=$p[1];$np._createNodeByJson(this,$P,this,$L),this.event("hierarchyloaded",[this]),this.__loaded=!0;},$m.destroy=function($m){void 0===$m&&($m=!0),this.destroyed||($p.prototype.destroy.call(this,$m),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$c.clearRes(this.url),this.loaded||$cp._cancelLoadByUrl(this.url));},$m.getRenderType=function(){return 0;},$m.releaseRender=function(){},$m._addComponent=function($m){var $p,$h=this._componentsMap.indexOf($m);if(-1===$h)$p=[],this._componentsMap.push($m),this._typeComponentsIndices.push($p);else if($p=this._typeComponentsIndices[$h],this._components[$p[0]].isSingleton)throw new Error("无法单实例创建"+$m+"组件，"+$m+"组件已存在！");var $P=$L.getInstance($m);$p.push(this._components.length),this._components.push($P);return $P._initialize(this),$P;},$m._removeComponent=function($m,$p){var $h=this._typeComponentsIndices[$m],$P=$h[$p],$L=this._components[$P];this._components.splice($P,1),$h.splice($p,1),0===$h.length&&(this._typeComponentsIndices.splice($m,1),this._componentsMap.splice($m,1));for(var $q=0,$k=this._componentsMap.length;$q<$k;$q++)for(var $Y=($h=this._typeComponentsIndices[$q]).length-1;0<=$Y;$Y--){var $d=$h[$Y];if(!($P<$d))break;$h[$Y]=--$d;}$L._destroy();},$m._getComponentByType=function($m,$p){void 0===$p&&($p=0);var $h=this._componentsMap.indexOf($m);return-1===$h?null:this._components[this._typeComponentsIndices[$h][$p]];},$m._getComponentsByType=function($m,$p){var $h=this._componentsMap.indexOf($m);if(-1!==$h){var $P=this._typeComponentsIndices[$h],$L=$P.length;$p.length=$L;for(var $q=0;$q<$L;$q++)$p[$q]=this._components[$P[$q]];}else $p.length=0;},$m._getComponentByIndex=function($m){return this._components[$m];},$m._removeComponentByType=function($m,$p){void 0===$p&&($p=0);var $h=this._componentsMap.indexOf($m);-1!==$h&&this._removeComponent($h,$p);},$m._removeComponentsByType=function($m){var $p=this._componentsMap.indexOf($m);if(-1!==$p)for(var $h=this._typeComponentsIndices[$p],$P=0,$L=$h.length;$P<$L;$h.length<$L?$L--:$P++)this._removeComponent($p,$P);},$m._removeAllComponent=function(){for(var $m=0,$p=this._componentsMap.length;$m<$p;this._componentsMap.length<$p?$p--:$m++)this._removeComponentsByType(this._componentsMap[$m]);},$m._updateComponents=function($m){for(var $p=0,$h=this._components.length;$p<$h;$p++){var $P=this._components[$p];!$P.started&&($P._start($m),$P.started=!0),$P.enable&&$P._update($m);}},$m._lateUpdateComponents=function($m){for(var $p=0;$p<this._components.length;$p++){var $h=this._components[$p];!$h.started&&($h._start($m),$h.started=!0),$h.enable&&$h._lateUpdate($m);}},$m._preRenderUpdateComponents=function($m){for(var $p=0;$p<this._components.length;$p++){var $h=this._components[$p];!$h.started&&($h._start($m),$h.started=!0),$h.enable&&$h._preRenderUpdate($m);}},$m._postRenderUpdateComponents=function($m){for(var $p=0;$p<this._components.length;$p++){var $h=this._components[$p];!$h.started&&($h._start($m),$h.started=!0),$h.enable&&$h._postRenderUpdate($m);}},$A(0,$m,"_loaded",null,function($m){this.__loaded=$m;}),$A(0,$m,"fogColor",function(){return this._fogColor;},function($m){this._fogColor=$m,this._shaderValues.setValue(0,$m.elements);}),$A(0,$m,"enableFog",function(){return this._enableFog;},function($m){this._enableFog!==$m&&((this._enableFog=$m)?(this.addShaderDefine($Ip.SHADERDEFINE_FOG),this.removeShaderDefine($Ip.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($Ip.SHADERDEFINE_FOG));}),$A(0,$m,"url",function(){return this._url;}),$A(0,$m,"loaded",function(){return this.__loaded;}),$A(0,$m,"enableDepthFog",function(){return this._enableDepthFog;},function($m){this._enableDepthFog!=$m&&((this._enableDepthFog=$m)?(this.addShaderDefine($Ip.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($Ip.SHADERDEFINE_FOG)):this.removeShaderDefine($Ip.SAHDERDEFINE_DEPTHFOG));}),$A(0,$m,"fogStart",function(){return this._fogStart;},function($m){this._fogStart=$m,this._shaderValues.setValue(1,$m);}),$A(0,$m,"fogRange",function(){return this._fogRange;},function($m){this._fogRange=$m,this._shaderValues.setValue(2,$m);}),$A(0,$m,"ambientColor",function(){return this._ambientColor;},function($m){this._ambientColor=$m,this._shaderValues.setValue(21,$m.elements);}),$A(0,$m,"scene",function(){return this;}),$A(0,$m,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice();}),$P._sortScenes=function($m,$p){if($m.parent!==$H.stage||$p.parent!==$H.stage)return $m.parent!==$H.stage&&$p.parent!==$H.stage?$P._sortScenes($m.parent,$p.parent):$m.parent===$H.stage?-1:1;var $h=$H.stage._childs;return $h.indexOf($m)-$h.indexOf($p);},$P.load=function($m){return $H.loader.create($m,null,null,$P);},$P.FOGCOLOR=0,$P.FOGSTART=1,$P.FOGRANGE=2,$P.LIGHTDIRECTION=3,$P.LIGHTDIRCOLOR=4,$P.POINTLIGHTPOS=5,$P.POINTLIGHTRANGE=6,$P.POINTLIGHTATTENUATION=7,$P.POINTLIGHTCOLOR=8,$P.SPOTLIGHTPOS=9,$P.SPOTLIGHTDIRECTION=10,$P.SPOTLIGHTSPOT=11,$P.SPOTLIGHTRANGE=12,$P.SPOTLIGHTATTENUATION=13,$P.SPOTLIGHTCOLOR=14,$P.SHADOWDISTANCE=15,$P.SHADOWLIGHTVIEWPROJECT=16,$P.SHADOWMAPPCFOFFSET=17,$P.SHADOWMAPTEXTURE1=18,$P.SHADOWMAPTEXTURE2=19,$P.SHADOWMAPTEXTURE3=20,$P.AMBIENTCOLOR=21,$P.TIME=22,$P;}($E),$_p=function($m){function $p($m){$p.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $mp(),this._shaderValues=new $Rp(),this._colliders=[],this._id=++$p._uniqueIDCounter,this._transform=new $Wp(this),this.name=$m||"Sprite3D-"+$p._nameNumberCounter++,this.layer=$N.currentCreationLayer,this.active=!0;}$$($p,"laya.d3.core.Sprite3D",$jp);var $h=$p.prototype;return $H.imps($h,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$h._setUrl=function($m){this._url=$m;},$h._getGroup=function(){return this._group;},$h._setGroup=function($m){this._group=$m;},$h._addChild3D=function($m){$m.transform.parent=this.transform,this._hierarchyAnimator&&(!$m._hierarchyAnimator&&$m._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($m,!0,[$m.name])),this._scene&&($m._setBelongScene(this._scene),this._activeInHierarchy&&$m._active&&$m._activeHierarchy());},$h._removeChild3D=function($m){$m.transform.parent=null,this._scene&&(this._activeInHierarchy&&$m._active&&$m._inActiveHierarchy(),$m._setUnBelongScene()),this._hierarchyAnimator&&($m._hierarchyAnimator==this._hierarchyAnimator&&$m._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($m,!1,[$m.name]));},$h._parseBaseCustomProps=function($m){var $p=this.transform.localPosition;$m.translate?($p.fromArray($m.translate),$p.x*=100,$p.y*=100,$p.z*=100):$p.elements.fill(0),this.transform.localPosition=$p;var $h=this.transform.localRotation;$m.rotation?$h.fromArray($m.rotation):$h.fromArray([0,0,0,-1]),this.transform.localRotation=$h;var $P=this.transform.localScale;$m.scale?$P.fromArray($m.scale):$P.elements.fill(1),this.transform.localScale=$P;var $L=$m.layer;null!=$L&&(this.layer=$N.getLayerByNumber($L));},$h._parseCustomComponent=function($m,$p,$h){for(var $P in $h){var $L=$h[$P];switch($P){case"Animator":var $q=this.addComponent(Animator);if($L.avatarPath)$q.avatar=$c.getRes($p[$L.avatarPath]);else{var $k=$L.avatar;if($k){$q.avatar=$c.getRes($p[$k.path]);var $Y=$k.linkSprites;$Y&&$m.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$q,$Y]);}}for(var $d=$L.clipPaths,$K=$d.length,$D=0;$D<$K;$D++)$q.addClip($c.getRes($p[$d[$D]]));$q.clip=$c.getRes($p[$d[0]]);var $F=$L.playOnWake;void 0!==$F&&($q.playOnWake=$F);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $R=this.addComponent(SphereCollider);$R.isTrigger=$L.isTrigger;var $$=$R.center;$$.fromArray($L.center),$R.center=$$,$R.radius=$L.radius;break;case"BoxCollider":var $A=this.addComponent(BoxCollider);$A.isTrigger=$L.isTrigger,$A.center.fromArray($L.center);var $B=$A.size;$B.fromArray($L.size),$A.size=$B;break;case"MeshCollider":this.addComponent(MeshCollider);}}},$h._onRootNodeHierarchyLoaded=function($m,$p){for(var $h in $p){for(var $P=this,$L=$p[$h],$q=0,$k=$L.length;$q<$k;$q++){var $Y=$L[$q];if(""===$Y)break;if(!($P=$P.getChildByName($Y)))break;}$P&&$m.linkSprite3DToAvatarNode($h,$P);}},$h._setHierarchyAnimator=function($m,$p){this._changeHierarchyAnimator($m);for(var $h=0,$P=this._childs.length;$h<$P;$h++){var $L=this._childs[$h];$L._hierarchyAnimator==$p&&$L._setHierarchyAnimator($m,$p);}},$h._clearHierarchyAnimator=function($m,$p){this._changeHierarchyAnimator($p);for(var $h=0,$P=this._childs.length;$h<$P;$h++){var $L=this._childs[$h];$L._hierarchyAnimator==$m&&$L._clearHierarchyAnimator($m,$p);}},$h._getAnimatorToLinkSprite3D=function($m,$p,$h){var $P=this.getComponentByType(Animator);if($P&&($P.avatar?$P.avatar._version||$m._setAnimatorToLinkAvatar($P,$p):$m._setAnimatorToLinkSprite3DNoAvatar($P,$p,$h)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$h.unshift(this._parent.name);var $L=this._parent;$L._hierarchyAnimator&&$L._getAnimatorToLinkSprite3D($m,$p,$h);}},$h._setAnimatorToLinkSprite3DNoAvatar=function($m,$p,$h){var $P=0,$L=0;for($P=0,$L=$m.getClipCount();$P<$L;$P++)$m._handleSpriteOwnersBySprite($P,$p,$h,this);for($P=0,$L=this._childs.length;$P<$L;$P++){var $q=this._childs[$P],$k=$h.length;$h.push($q.name),$q._setAnimatorToLinkSprite3DNoAvatar($m,$p,$h),$h.splice($k,1);}},$h._changeHierarchyAnimator=function($m){this._hierarchyAnimator=$m;},$h._isLinkSpriteToAnimationNode=function($m,$p,$h){var $P=$m._avatarNodes.indexOf($p),$L=$m._cacheSpriteToNodesMap;if($h)this._transform.dummy=$p.transform,$m._cacheNodesToSpriteMap[$P]=$L.length,$L.push($P);else{this._transform.dummy=null;var $q=$m._cacheNodesToSpriteMap[$P];$m._cacheNodesToSpriteMap[$P]=null,$L.splice($q,1);}},$h._setBelongScene=function($m){this._scene=$m;for(var $p=0,$h=this._childs.length;$p<$h;$p++)this._childs[$p]._setBelongScene($m);},$h._setUnBelongScene=function(){this._scene=null;for(var $m=0,$p=this._childs.length;$m<$p;$m++)this._childs[$m]._setUnBelongScene();},$h._activeHierarchy=function(){var $m=0,$p=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$m=0,$p=this._colliders.length;$m<$p;$m++)this._layer._addCollider(this._colliders[$m]);for(this.event("activeinhierarchychanged",!0),$m=0,$p=this._childs.length;$m<$p;$m++){var $h=this._childs[$m];$h._active&&$h._activeHierarchy();}},$h._inActiveHierarchy=function(){var $m=0,$p=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$m=0,$p=this._colliders.length;$m<$p;$m++){var $h=this._colliders[$m];$h._clearCollsionMap(),this._layer._removeCollider($h);}for(this.event("activeinhierarchychanged",!1),$m=0,$p=this._childs.length;$m<$p;$m++){var $P=this._childs[$m];$P._active&&$P._inActiveHierarchy();}},$h.addComponent=function($m){var $p,$h=this._componentsMap.indexOf($m);if(-1===$h)$p=[],this._componentsMap.push($m),this._typeComponentsIndices.push($p);else if($p=this._typeComponentsIndices[$h],this._components[$p[0]].isSingleton)throw new Error("无法单实例创建"+$m+"组件，"+$m+"组件已存在！");var $P=$L.getInstance($m);return $p.push(this._components.length),this._components.push($P),$P instanceof laya.d3.component.Script&&this._scripts.push($P),$P._initialize(this),$P;},$h._removeComponent=function($m,$p){var $h,$P=0,$L=this._typeComponentsIndices[$m],$q=$L[$p],$k=this._components[$q];for($k instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($k),1),$L.splice($p,1),0===$L.length&&(this._typeComponentsIndices.splice($m,1),this._componentsMap.splice($m,1)),$P=0,$h=this._componentsMap.length;$P<$h;$P++)for(var $Y=($L=this._typeComponentsIndices[$P]).length-1;0<=$Y;$Y--){var $d=$L[$Y];if(!($q<$d))break;$L[$Y]=--$d;}$k._destroy();},$h._clearSelfRenderObjects=function(){},$h._addSelfRenderObjects=function(){},$h._parseCustomProps=function($m,$p,$h,$P){},$h._updateChilds=function($m){var $p=this._childs.length;if(0!==$p)for(var $h=0;$h<$p;++$h)this._childs[$h]._update($m);},$h._getSortID=function($m,$p){return 1e3*$p.id+$m._getVertexBuffer().vertexDeclaration.id;},$h._update=function($m){($m.owner=this)._activeInHierarchy&&(this._updateComponents($m),this._lateUpdateComponents($m),$I.spriteCount++,this._childs.length&&this._updateChilds($m));},$h.getProjectionViewWorldMatrix=function($m){return $mp.multiply($m,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix;},$h.loadHierarchy=function($m){this.addChild(laya.d3.core.Sprite3D.load($m));},$h.addChildAt=function($m,$p){if(!($m instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$m||this.destroyed||$m===this)return $m;if($m.zOrder&&this._set$P("hasZorder",!0),0<=$p&&$p<=this._childs.length){if($m._parent===this){var $h=this.getChildIndex($m);this._childs.splice($h,1),this._childs.splice($p,0,$m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,$p)),this._childChanged();}else $m.parent&&$m.parent.removeChild($m),this._childs===$K.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($p,0,$m),this.conchModel&&this.conchModel.addChildAt($m.conchModel,$p),($m.parent=this)._addChild3D($m);return $m;}throw new Error("appendChildAt:The index is out of bounds");},$h.addChild=function($m){if(!($m instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$m||this.destroyed||$m===this)return $m;if($m.zOrder&&this._set$P("hasZorder",!0),$m._parent===this){var $p=this.getChildIndex($m);$p!==this._childs.length-1&&(this._childs.splice($p,1),this._childs.push($m),this.conchModel&&(this.conchModel.removeChild($m.conchModel),this.conchModel.addChildAt($m.conchModel,this._childs.length-1)),this._childChanged());}else $m.parent&&$m.parent.removeChild($m),this._childs===$K.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($m),this.conchModel&&this.conchModel.addChildAt($m.conchModel,this._childs.length-1),($m.parent=this)._childChanged(),this._addChild3D($m);return $m;},$h.removeChildAt=function($m){var $p=this.getChildAt($m);return $p&&(this._removeChild3D($p),this._childs.splice($m,1),this.conchModel&&this.conchModel.removeChild($p.conchModel),$p.parent=null),$p;},$h.removeChildren=function($m,$p){if(void 0===$m&&($m=0),void 0===$p&&($p=2147483647),this._childs&&0<this._childs.length){var $h=this._childs;if(0===$m&&$q<=$p){var $P=$h;this._childs=$K.ARRAY_EMPTY;}else $P=$h.splice($m,$p-$m);for(var $L=0,$q=$P.length;$L<$q;$L++)this._removeChild3D($P[$L]),$P[$L].parent=null,this.conchModel&&this.conchModel.removeChild($P[$L].conchModel);}return this;},$h.onAsynLoaded=function($m,$p,$h){var $P=$p[0];if("Sprite3D"!==$P.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $L=$p[1];$np._createNodeByJson(this,$P,this,$L),this.event("hierarchyloaded",[this]),this.__loaded=!0;},$h.cloneTo=function($m){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $p=$m;$p.name=this.name,$p._destroyed=this._destroyed,$p.timer=this.timer,$p._$P=this._$P,$p.active=this._active;var $h=$p.transform.localPosition;this.transform.localPosition.cloneTo($h),$p.transform.localPosition=$h;var $P=$p.transform.localRotation;this.transform.localRotation.cloneTo($P),$p.transform.localRotation=$P;var $L=$p.transform.localScale;this.transform.localScale.cloneTo($L),$p.transform.localScale=$L,$p.isStatic=this.isStatic;var $q=0,$k=0;for($q=0,$k=this._componentsMap.length;$q<$k;$q++){var $Y=$p.addComponent(this._componentsMap[$q]);this._components[$q]._cloneTo($Y);}for($q=0,$k=this._childs.length;$q<$k;$q++)$p.addChild(this._childs[$q].clone());var $d=$p.getComponentByType(Animator);if($d){var $K=$d._linkSpritesData;if($K)for(var $D in $K){for(var $F=$K[$D],$R=$p,$$=0,$A=$F.length;$$<$A&&($R=$R.getChildByName($F[$$]));$$++);if($R){var $B=$d._avatarNodeMap[$D];$R._isLinkSpriteToAnimationNode($d,$B,!0);}}}},$h.clone=function(){var $m=new this.constructor();return this.cloneTo($m),$m;},$h.destroy=function($m){if(void 0===$m&&($m=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$m);var $p,$h=0;for($h=0,$p=this._components.length;$h<$p;$h++)this._components[$h]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$c.clearRes(this.url),this.loaded||$cp._cancelLoadByUrl(this.url);}},$h._handleSpriteToAvatar=function($m,$p){$m._avatarNodes;var $h=$m._avatarNodeMap[this.name];$h&&$h.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($m,$h,$p);},$h._setAnimatorToLinkAvatar=function($m,$p){this._handleSpriteToAvatar($m,$p);for(var $h=0,$P=this._childs.length;$h<$P;$h++){this._childs[$h]._setAnimatorToLinkAvatar($m,$p);}},$A(0,$h,"activeInHierarchy",function(){return this._activeInHierarchy;}),$A(0,$h,"_loaded",null,function($m){this.__loaded=$m;}),$A(0,$h,"active",function(){return this._active;},function($m){this._active!==$m&&(this._active=$m,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($m?this._activeHierarchy():this._inActiveHierarchy()));}),$A(0,$h,"componentsCount",function(){return this._components.length;}),$A(0,$h,"loaded",function(){return this.__loaded;}),$A(0,$h,"id",function(){return this._id;}),$A(0,$h,"url",function(){return this._url;}),$A(0,$h,"layer",function(){return this._layer;},function($m){if(this._layer!==$m){if(!$m)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $p=0,$h=this._colliders.length;if(this._layer)for($p=0;$p<$h;$p++)this._layer._removeCollider(this._colliders[$p]);for($p=0;$p<$h;$p++)$m._addCollider(this._colliders[$p]);}this._layer=$m,this.event("layerchanged",$m);}}),$A(0,$h,"scene",function(){return this._scene;}),$A(0,$h,"transform",function(){return this._transform;}),$p.instantiate=function($m,$p,$h,$P,$L){void 0===$h&&($h=!0);var $q=$m.clone();$p&&$p.addChild($q);var $k=$q.transform;if($h){var $Y=$k.worldMatrix;$m.transform.worldMatrix.cloneTo($Y),$k.worldMatrix=$Y;}else $P&&($k.position=$P),$L&&($k.rotation=$L);return $q;},$p.load=function($m){return $H.loader.create($m,null,null,$p);},$p.WORLDMATRIX=0,$p.MVPMATRIX=1,$p._uniqueIDCounter=0,$p._nameNumberCounter=0,$p;}(),$lp=function($m){function $D($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$D.__super.call(this),!$m||!$p)throw"Shader Error";this._id=++$D._count,this._vs=$m,this._ps=$p,this._attributeMap=$h,this._sceneUniformMap=$P,this._cameraUniformMap=$L,this._spriteUniformMap=$q,this._materialUniformMap=$k,this._renderElementUniformMap=$Y,this._precompile=$d,this._define=$K,this._precompile&&$D.extCompileObj&&$D.extCompileFunc?$D.extCompileFunc.call($D.extCompileObj,$m,$p,$K):this.recreateResource();}$$($D,"laya.d3.shader.Shader3D",$h);var $p=$D.prototype;return $p.recreateResource=function(){$u.now();this._compile(),this.completeCreate(),this.memorySize=0;},$p.disposeResource=function(){$Q.mainContext.deleteShader(this._vshader),$Q.mainContext.deleteShader(this._pshader),$Q.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0;},$p._compile=function(){if(!$Q.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $m=[this._vs,this._ps],$p=$Q.mainContext;if(this._program=$p.createProgram(),this._vshader=$D._createShader($p,$m[0],35633),this._pshader=$D._createShader($p,$m[1],35632),$p.attachShader(this._program,this._vshader),$p.attachShader(this._program,this._pshader),$p.linkProgram(this._program),!$B.isConchApp&&$Ip.debugMode&&!$p.getProgramParameter(this._program,35714))throw $p.getProgramInfoLog(this._program);var $h,$P=0,$L=0,$q=0;for($q=$B.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35721):$p.getProgramParameter(this._program,35721),$P=0;$P<$q;$P++){var $k=null;$h={vartype:"attribute",ivartype:0,attrib:$k=$B.isConchApp?$p.getActiveAttribEx(this._vs,this._ps,"",$P):$p.getActiveAttrib(this._program,$P),location:$p.getAttribLocation(this._program,$k.name),name:$k.name,type:$k.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($h);}var $Y=0;for($Y=$B.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35718):$p.getProgramParameter(this._program,35718),$P=0;$P<$Y;$P++){var $d=null;$d=$B.isConchApp?$p.getActiveUniformEx(this._vs,this._ps,"",$P):$p.getActiveUniform(this._program,$P),0<($h={vartype:"uniform",ivartype:1,attrib:$k,location:$p.getUniformLocation(this._program,$d.name),name:$d.name,type:$d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($h.name=$h.name.substr(0,$h.name.length-3),$h.isArray=!0,$h.location=$p.getUniformLocation(this._program,$h.name)),this._uniformParams.push($h);}for($P=0,$L=this._attributeParams.length;$P<$L;$P++)($h=this._attributeParams[$P]).indexOfParams=$P,$h.index=1,$h.value=[$h.location,null],$h.codename=$h.name,$h.name=null!=this._attributeMap[$h.codename]?this._attributeMap[$h.codename]:$h.codename,this._attributeParamsMap.push($h.name),this._attributeParamsMap.push($h),$h._this=this,$h.uploadedValue=[],$h.fun=this._attribute;for($P=0,$L=this._uniformParams.length;$P<$L;$P++)switch(($h=this._uniformParams[$P]).indexOfParams=$P,$h.index=1,$h.value=[$h.location,null],$h.codename=$h.name,null!=this._sceneUniformMap[$h.codename]?($h.name=this._sceneUniformMap[$h.codename],this._sceneUniformParamsMap.push($h.name),this._sceneUniformParamsMap.push($h)):null!=this._cameraUniformMap[$h.codename]?($h.name=this._cameraUniformMap[$h.codename],this._cameraUniformParamsMap.push($h.name),this._cameraUniformParamsMap.push($h)):null!=this._spriteUniformMap[$h.codename]?($h.name=this._spriteUniformMap[$h.codename],this._spriteUniformParamsMap.push($h.name),this._spriteUniformParamsMap.push($h)):null!=this._materialUniformMap[$h.codename]?($h.name=this._materialUniformMap[$h.codename],this._materialUniformParamsMap.push($h.name),this._materialUniformParamsMap.push($h)):null!=this._renderElementUniformMap[$h.codename]?($h.name=this._renderElementUniformMap[$h.codename],this._renderElementUniformParamsMap.push($h.name),this._renderElementUniformParamsMap.push($h)):console.log("Shader:can't find uinform name:"+$h.codename+" in shader file."),$h._this=this,$h.uploadedValue=[],$h.type){case 5124:$h.fun=$h.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$h.fun=$h.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$h.fun=$h.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$h.fun=$h.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$h.fun=$h.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$h.fun=this._uniform_sampler2D;break;case 35680:$h.fun=this._uniform_samplerCube;break;case 35676:$h.fun=this._uniformMatrix4fv;break;case 35670:$h.fun=this._uniform1i;break;case 35674:$h.fun=this._uinformMatrix2fv;break;case 35675:$h.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!");}}},$p._attribute=function($m,$p){var $h=$Q.mainContext,$P=$Y._enableAtributes,$L=$m.location;return $P[$L]||$h.enableVertexAttribArray($L),$h.vertexAttribPointer($L,$p[0],$p[1],$p[2],$p[3],$p[4]),$P[$L]=$Y._bindVertexBuffer,1;},$p._uniform1f=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p?($Q.mainContext.uniform1f($m.location,$h[0]=$p),1):0;},$p._uniform1fv=function($m,$p){if($p.length<4){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Q.mainContext.uniform1fv($m.location,$p),$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3],1):0;}return $Q.mainContext.uniform1fv($m.location,$p),1;},$p._uniform_vec2=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]?($Q.mainContext.uniform2f($m.location,$h[0]=$p[0],$h[1]=$p[1]),1):0;},$p._uniform_vec2v=function($m,$p){if($p.length<2){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Q.mainContext.uniform2fv($m.location,$p),$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3],1):0;}return $Q.mainContext.uniform2fv($m.location,$p),1;},$p._uniform_vec3=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]?($Q.mainContext.uniform3f($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2]),1):0;},$p._uniform_vec3v=function($m,$p){return $Q.mainContext.uniform3fv($m.location,$p),1;},$p._uniform_vec4=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Q.mainContext.uniform4f($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3]),1):0;},$p._uniform_vec4v=function($m,$p){return $Q.mainContext.uniform4fv($m.location,$p),1;},$p._uniformMatrix2fv=function($m,$p){return $Q.mainContext.uniformMatrix2fv($m.location,!1,$p),1;},$p._uniformMatrix3fv=function($m,$p){return $Q.mainContext.uniformMatrix3fv($m.location,!1,$p),1;},$p._uniformMatrix4fv=function($m,$p){return $Q.mainContext.uniformMatrix4fv($m.location,!1,$p),1;},$p._uinformMatrix2fv=function($m,$p){return $Q.mainContext.uniformMatrix2fv($m.location,!1,$p),1;},$p._uinformMatrix3fv=function($m,$p){return $Q.mainContext.uniformMatrix3fv($m.location,!1,$p),1;},$p._uniform1i=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p?($Q.mainContext.uniform1i($m.location,$h[0]=$p),1):0;},$p._uniform1iv=function($m,$p){return $Q.mainContext.uniform1iv($m.location,$p),1;},$p._uniform_ivec2=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]?($Q.mainContext.uniform2i($m.location,$h[0]=$p[0],$h[1]=$p[1]),1):0;},$p._uniform_ivec2v=function($m,$p){return $Q.mainContext.uniform2iv($m.location,$p),1;},$p._uniform_vec3i=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]?($Q.mainContext.uniform3i($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2]),1):0;},$p._uniform_vec3vi=function($m,$p){return $Q.mainContext.uniform3iv($m.location,$p),1;},$p._uniform_vec4i=function($m,$p){var $h=$m.uploadedValue;return $h[0]!==$p[0]||$h[1]!==$p[1]||$h[2]!==$p[2]||$h[3]!==$p[3]?($Q.mainContext.uniform4i($m.location,$h[0]=$p[0],$h[1]=$p[1],$h[2]=$p[2],$h[3]=$p[3]),1):0;},$p._uniform_vec4vi=function($m,$p){return $Q.mainContext.uniform4iv($m.location,$p),1;},$p._uniform_sampler2D=function($m,$p){var $h=$p.source||$p.defaulteTexture.source,$P=$Q.mainContext,$L=$m.uploadedValue;if(null!=$L[0])return $P.activeTexture($D._TEXTURES[$L[0]]),$h&&$M.bindTexture($P,3553,$h),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $L[0]=this._curActTexIndex,$P.uniform1i($m.location,this._curActTexIndex),$P.activeTexture($D._TEXTURES[this._curActTexIndex]),$h&&$M.bindTexture($P,3553,$h),this._curActTexIndex++,1;},$p._uniform_samplerCube=function($m,$p){var $h=$p.source||$p.defaulteTexture.source,$P=$Q.mainContext,$L=$m.uploadedValue;if(null!=$L[0])return $P.activeTexture($D._TEXTURES[$L[0]]),$h?$M.bindTexture($P,34067,$h):$M.bindTexture($P,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $L[0]=this._curActTexIndex,$P.uniform1i($m.location,this._curActTexIndex),$P.activeTexture($D._TEXTURES[this._curActTexIndex]),$h?$M.bindTexture($P,34067,$h):$M.bindTexture($P,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1;},$p._noSetValue=function($m){console.log("no....:"+$m.name);},$p.bind=function(){return $h.activeShader=this,($h.bindShader=this).activeResource(),$M.UseProgram(this._program);},$p.uploadAttributes=function($m,$p){for(var $h,$P,$L=0,$q=0,$k=this._attributeParamsMap.length;$q<$k;$q+=2)$P=this._attributeParamsMap[$q+1],null!=($h=$m[this._attributeParamsMap[$q]])&&($p&&$p[$P.name]&&$p[$P.name].bind(),$L+=$P.fun.call(this,$P,$h));$I.shaderCall+=$L;},$p.uploadAttributesX=function($m,$p){for(var $h,$P,$L=0,$q=0,$k=this._attributeParamsMap.length;$q<$k;$q+=2)$P=this._attributeParamsMap[$q+1],null!=($h=$m[this._attributeParamsMap[$q]])&&($p._bind(),$L+=$P.fun.call(this,$P,$h));$I.shaderCall+=$L;},$p.uploadSceneUniforms=function($m){for(var $p,$h,$P=0,$L=0,$q=this._sceneUniformParamsMap.length;$L<$q;$L+=2)$h=this._sceneUniformParamsMap[$L+1],null!=($p=$m[this._sceneUniformParamsMap[$L]])&&($P+=$h.fun.call(this,$h,$p));$I.shaderCall+=$P;},$p.uploadCameraUniforms=function($m){for(var $p,$h,$P=0,$L=0,$q=this._cameraUniformParamsMap.length;$L<$q;$L+=2)$h=this._cameraUniformParamsMap[$L+1],null!=($p=$m[this._cameraUniformParamsMap[$L]])&&($P+=$h.fun.call(this,$h,$p));$I.shaderCall+=$P;},$p.uploadSpriteUniforms=function($m){for(var $p,$h,$P=0,$L=0,$q=this._spriteUniformParamsMap.length;$L<$q;$L+=2)$h=this._spriteUniformParamsMap[$L+1],null!=($p=$m[this._spriteUniformParamsMap[$L]])&&($P+=$h.fun.call(this,$h,$p));$I.shaderCall+=$P;},$p.uploadMaterialUniforms=function($m){for(var $p,$h,$P=0,$L=0,$q=this._materialUniformParamsMap.length;$L<$q;$L+=2)$h=this._materialUniformParamsMap[$L+1],null!=($p=$m[this._materialUniformParamsMap[$L]])&&($P+=$h.fun.call(this,$h,$p));$I.shaderCall+=$P;},$p.uploadRenderElementUniforms=function($m){for(var $p,$h,$P=0,$L=0,$q=this._renderElementUniformParamsMap.length;$L<$q;$L+=2)$h=this._renderElementUniformParamsMap[$L+1],null!=($p=$m[this._renderElementUniformParamsMap[$L]])&&($P+=$h.fun.call(this,$h,$p));$I.shaderCall+=$P;},$D.create=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){return new $D($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K);},$D.addInclude=function($m,$p){$a.addInclude($m,$p);},$D._createShader=function($m,$p,$h){var $P=$m.createShader($h);if($m.shaderSource($P,$p),$m.compileShader($P),$Ip.debugMode&&!$m.getShaderParameter($P,35713))throw $m.getShaderInfoLog($P);return $P;},$D.PERIOD_RENDERELEMENT=0,$D.PERIOD_MATERIAL=1,$D.PERIOD_SPRITE=2,$D.PERIOD_CAMERA=3,$D.PERIOD_SCENE=4,$D._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$D._count=0,$D._preCompile=!1,$D.extCompileFunc=null,$D.extCompileObj=null,$F($D,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680};},"nameKey",function(){return this.nameKey=new $b();}]),$D;}(),$Jp=function($Y){function $d(){this._transformUV=null,$d.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $kp(.6,.6,.6)),this._setColor(10,new $kp(1,1,1)),this._setColor(11,new $Yp(1,1,1,8)),this._setColor(12,new $kp(1,1,1)),this._setColor(7,new $Yp(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $Yp(1,1,0,0)),this.renderMode=1;}$$($d,"laya.d3.core.material.StandardMaterial",$Y);var $m=$d.prototype;return $m.disableLight=function(){this._addDisablePublicShaderDefine($Ip.SHADERDEFINE_POINTLIGHT|$Ip.SHADERDEFINE_SPOTLIGHT|$Ip.SHADERDEFINE_DIRECTIONLIGHT);},$m.disableFog=function(){this._addDisablePublicShaderDefine($Ip.SHADERDEFINE_FOG);},$m.onAsynLoaded=function($m,$p,$h){var $P=$p[0];if($P.version)$Y.prototype.onAsynLoaded.call(this,$m,$p,$h);else{var $L=$p[1],$q=$P.props;for(var $k in $q)this[$k]=$q[$k];$d._parseStandardMaterial($L,this,$P),this._endLoaded();}},$m.cloneTo=function($m){$Y.prototype.cloneTo.call(this,$m);var $p=$m;this._transformUV&&($p._transformUV=this._transformUV.clone());},$A(0,$m,"ambientColor",function(){return this._getColor(9);},function($m){this._setColor(9,$m);}),$A(0,$m,"ambientTexture",function(){return this._getTexture(5);},function($m){$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$m);}),$A(0,$m,"renderMode",null,function($m){switch($m){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($d.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.");}this._conchMaterial&&this._conchMaterial.setRenderMode($m);}),$A(0,$m,"reflectColor",function(){return this._getColor(12);},function($m){this._setColor(12,$m);}),$A(0,$m,"tilingOffset",function(){return this._getColor(15);},function($m){if($m){var $p=$m.elements;1!=$p[0]||1!=$p[1]||0!=$p[2]||0!=$p[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$m);}),$A(0,$m,"albedo",function(){return this._getColor(7);},function($m){this._setColor(7,$m);}),$A(0,$m,"diffuseColor",function(){return this._getColor(10);},function($m){this._setColor(10,$m);}),$A(0,$m,"albedoColor",function(){return this._getColor(7);},function($m){this._setColor(7,$m);}),$A(0,$m,"specularColor",function(){return this._getColor(11);},function($m){this._setColor(11,$m);}),$A(0,$m,"diffuseTexture",function(){return this._getTexture(1);},function($m){$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$m);}),$A(0,$m,"normalTexture",function(){return this._getTexture(2);},function($m){$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$m);}),$A(0,$m,"specularTexture",function(){return this._getTexture(3);},function($m){$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$m);}),$A(0,$m,"emissiveTexture",function(){return this._getTexture(4);},function($m){$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$m);}),$A(0,$m,"reflectTexture",function(){return this._getTexture(6);},function($m){$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$m);}),$A(0,$m,"transformUV",function(){return this._transformUV;},function($m){this._transformUV=$m,this._setMatrix4x4(13,$m.matrix),$m?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$m.matrix.elements,0);}),$d.__init__=function(){$d.SHADERDEFINE_DIFFUSEMAP=$d.shaderDefines.registerDefine("DIFFUSEMAP"),$d.SHADERDEFINE_NORMALMAP=$d.shaderDefines.registerDefine("NORMALMAP"),$d.SHADERDEFINE_SPECULARMAP=$d.shaderDefines.registerDefine("SPECULARMAP"),$d.SHADERDEFINE_EMISSIVEMAP=$d.shaderDefines.registerDefine("EMISSIVEMAP"),$d.SHADERDEFINE_AMBIENTMAP=$d.shaderDefines.registerDefine("AMBIENTMAP"),$d.SHADERDEFINE_REFLECTMAP=$d.shaderDefines.registerDefine("REFLECTMAP"),$d.SHADERDEFINE_UVTRANSFORM=$d.shaderDefines.registerDefine("UVTRANSFORM"),$d.SHADERDEFINE_TILINGOFFSET=$d.shaderDefines.registerDefine("TILINGOFFSET"),$d.SHADERDEFINE_ADDTIVEFOG=$d.shaderDefines.registerDefine("ADDTIVEFOG");},$d.load=function($m){return $H.loader.create($m,null,null,$d);},$d._parseStandardMaterial=function($m,$p,$h){var $P=$h.customProps,$L=$P.ambientColor;$p.ambientColor=new $kp($L[0],$L[1],$L[2]);var $q=$P.diffuseColor;$p.diffuseColor=new $kp($q[0],$q[1],$q[2]);var $k=$P.specularColor;$p.specularColor=new $Yp($k[0],$k[1],$k[2],$k[3]);var $Y=$P.reflectColor;$p.reflectColor=new $kp($Y[0],$Y[1],$Y[2]);var $d=$P.albedoColor;$d&&($p.albedo=new $Yp($d[0],$d[1],$d[2],$d[3]));var $K=$P.diffuseTexture.texture2D;$K&&($p.diffuseTexture=$c.getRes($m[$K]));var $D=$P.normalTexture.texture2D;$D&&($p.normalTexture=$c.getRes($m[$D]));var $F=$P.specularTexture.texture2D;$F&&($p.specularTexture=$c.getRes($m[$F]));var $R=$P.emissiveTexture.texture2D;$R&&($p.emissiveTexture=$c.getRes($m[$R]));var $$=$P.ambientTexture.texture2D;$$&&($p.ambientTexture=$c.getRes($m[$$]));var $A=$P.reflectTexture.texture2D;$A&&($p.reflectTexture=$c.getRes($m[$A]));},$d.RENDERMODE_OPAQUE=1,$d.RENDERMODE_OPAQUEDOUBLEFACE=2,$d.RENDERMODE_CUTOUT=3,$d.RENDERMODE_CUTOUTDOUBLEFACE=4,$d.RENDERMODE_TRANSPARENT=13,$d.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$d.RENDERMODE_ADDTIVE=15,$d.RENDERMODE_ADDTIVEDOUBLEFACE=16,$d.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$d.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$d.RENDERMODE_DEPTHREAD_ADDTIVE=7,$d.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$d.RENDERMODE_NONDEPTH_TRANSPARENT=9,$d.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$d.RENDERMODE_NONDEPTH_ADDTIVE=11,$d.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$d.SHADERDEFINE_DIFFUSEMAP=0,$d.SHADERDEFINE_NORMALMAP=0,$d.SHADERDEFINE_SPECULARMAP=0,$d.SHADERDEFINE_EMISSIVEMAP=0,$d.SHADERDEFINE_AMBIENTMAP=0,$d.SHADERDEFINE_REFLECTMAP=0,$d.SHADERDEFINE_UVTRANSFORM=0,$d.SHADERDEFINE_TILINGOFFSET=0,$d.SHADERDEFINE_ADDTIVEFOG=0,$d.DIFFUSETEXTURE=1,$d.NORMALTEXTURE=2,$d.SPECULARTEXTURE=3,$d.EMISSIVETEXTURE=4,$d.AMBIENTTEXTURE=5,$d.REFLECTTEXTURE=6,$d.ALBEDO=7,$d.UVANIAGE=8,$d.MATERIALAMBIENT=9,$d.MATERIALDIFFUSE=10,$d.MATERIALSPECULAR=11,$d.MATERIALREFLECT=12,$d.UVMATRIX=13,$d.UVAGE=14,$d.TILINGOFFSET=15,$F($d,["defaultMaterial",function(){var $m=new $d();return $m.lock=!0,this.defaultMaterial=$m;},"shaderDefines",function(){return this.shaderDefines=new $Dp($xp.shaderDefines);}]),$d;}($xp),$zp=function($m){function $k($m,$p,$h,$P,$L){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$h&&($h=35044),void 0===$P&&($P=!1),$k.__super.call(this),this._indexType=$m,this._indexCount=$p,this._bufferUsage=$h,this._bufferType=34963,this._canRead=$P;var $q;if("ushort"==$m)this._indexTypeByteCount=2;else{if("ubyte"!=$m)throw new Error("unidentification index type.");this._indexTypeByteCount=1;}$q=this._indexTypeByteCount*$p,this._byteLength=$q,this._bind(),$Y._gl.bufferData(this._bufferType,$q,this._bufferUsage),this.uri=$L,$P?("ushort"==$m?this._buffer=new Uint16Array($p):"ubyte"==$m&&(this._buffer=new Uint8Array($p)),this.memorySize=2*$q):this.memorySize=$q;}$$($k,"laya.d3.graphics.IndexBuffer3D",$m);var $p=$k.prototype;return $p.setData=function($m,$p,$h,$P){void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=4294967295);var $L=0;if("ushort"==this._indexType?($L=2,0===$h&&4294967295===$P||($m=new Uint16Array($m.buffer,$h*$L,$P))):"ubyte"==this._indexType&&($L=1,0===$h&&4294967295===$P||($m=new Uint8Array($m.buffer,$h*$L,$P))),this._bind(),$Y._gl.bufferSubData(this._bufferType,$p*$L,$m),this._canRead)if(0!==$p||0!==$h||4294967295!==$P){var $q=this._buffer.length-$p;$q<$P&&($P=$q);for(var $k=0;$k<$P;$k++)this._buffer[$p+$k]=$m[$k];}else this._buffer=$m;},$p.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!");},$p.disposeResource=function(){$m.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0;},$A(0,$p,"indexType",function(){return this._indexType;}),$A(0,$p,"indexTypeByteCount",function(){return this._indexTypeByteCount;}),$A(0,$p,"indexCount",function(){return this._indexCount;}),$A(0,$p,"canRead",function(){return this._canRead;}),$k.INDEXTYPE_UBYTE="ubyte",$k.INDEXTYPE_USHORT="ushort",$k.create=function($m,$p,$h,$P,$L){return void 0===$h&&($h=35044),void 0===$P&&($P=!1),new $k($m,$p,$h,$P,$L);},$k;}($Y),$wp=function($q){function $k($m,$p,$h,$P,$L){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$P&&($P=!1),$k.__super.call(this),this._vertexDeclaration=$m,this._vertexCount=$p,this._bufferUsage=$h,this._bufferType=34962,this._canRead=$P,this.uri=$L,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$p,this._bind(),$Y._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$P&&(this._buffer=new Float32Array(this._byteLength/4));}$$($k,"laya.d3.graphics.VertexBuffer3D",$q);var $m=$k.prototype;return $m.bindWithIndexBuffer=function($m){$m&&$m._bind(),this._bind();},$m.setData=function($m,$p,$h,$P){if(void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=4294967295),0===$h&&4294967295===$P||($m=new Float32Array($m.buffer,4*$h,$P)),this._bind(),$Y._gl.bufferSubData(this._bufferType,4*$p,$m),this._canRead)if(0!==$p||0!==$h||4294967295!==$P){var $L=this._buffer.length-$p;$L<$P&&($P=$L);for(var $q=0;$q<$P;$q++)this._buffer[$p+$q]=$m[$q];}else this._buffer=$m;},$m.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!");},$m.disposeResource=function(){for(var $m=$Q.mainContext,$p=this._vertexDeclaration.getVertexElements(),$h=$Y._enableAtributes,$P=0,$L=$p.length;$P<$L;$P++)$h[$P]===this._glBuffer&&($m.disableVertexAttribArray($P),$h[$P]=null);$q.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0;},$A(0,$m,"vertexDeclaration",function(){return this._vertexDeclaration;}),$A(0,$m,"vertexCount",function(){return this._vertexCount;}),$A(0,$m,"canRead",function(){return this._canRead;}),$k.create=function($m,$p,$h,$P,$L){return void 0===$h&&($h=35044),void 0===$P&&($P=!1),new $k($m,$p,$h,$P,$L);},$k;}($Y),$Xp=function($m){function $a(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$a.__super.call(this),this._type=3553;}$$($a,"laya.d3.resource.DataTexture2D",$Qp);var $p=$a.prototype;return $p.genDebugMipmaps=function(){var $m=[];return $m.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$m.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$m.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$m.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$m.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$m.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$m.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$m.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$m.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$m.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$m;},$p._onTextureLoaded=function($m){},$p._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $m=$Q.mainContext,$p=this._source=$m.createTexture(),$h=this._width,$P=this._height,$L=$M.curBindTexTarget,$q=$M.curBindTexValue,$k=!1;if($M.bindTexture($m,this._type,$p),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $Y=0;$m.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $d=0;$d<this._mipmaps.length;$d++){if(this._mipmaps[$d].byteLength!=$K*$D*4)throw"mipmap size error  level:"+$d;$m.texSubImage2D(this._type,0,$a.simLodRect[$Y++],$a.simLodRect[$Y++],$a.simLodRect[$Y++],$a.simLodRect[$Y++],6408,5121,new Uint8Array(this._mipmaps[$d]));}this.minFifter=9729,this.magFifter=9729;}else{var $K=this._width,$D=this._height;for($Y=0,$m.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$d=0;$d<this._mipmaps.length;$d++){if(this._mipmaps[$d].byteLength!=$K*$D*4)throw"mipmap size error  level:"+$d;$m.texImage2D(this._type,$d,6408,$K,$D,0,6408,5121,new Uint8Array(this._mipmaps[$d])),($K/=2)<1&&($K=1),($D/=2)<1&&($D=1),this.minFifter=9987,this.magFifter=9729;}}this.mipmap=!1;}else if(this._image)6407==this._format&&$m.pixelStorei($m.UNPACK_ALIGNMENT,1),$m.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $F=0,$R=!1,$$=!1;this._buffer.byteLength==4*$h*$P?($F=6408,$R=!0):this._buffer.byteLength==3*$h*$P?($F=6407,$$=!0):$F=this._format,$R||$$?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$$&&$m.pixelStorei($m.UNPACK_ALIGNMENT,1),$m.texImage2D(this._type,0,$F,$h,$P,0,$F,5121,this._buffer)):$m&&$F==$m.ALPHA?($m.texImage2D(3553,0,$F,$h,$P,0,$F,$m.UNSIGNED_BYTE,this._buffer),$k=!0):0!=$F&&($m.compressedTexImage2D(3553,0,$F,$h,$P,0,this._buffer),$k=!0);}var $A=this._minFifter,$B=this._magFifter,$n=0==this._wrapModeU?10497:33071,$c=0==this._wrapModeV?10497:33071,$e=$Z.isPOT($h,$P);$e?(this._mipmap||this._mipmaps?-1!==$A||($A=9987):-1!==$A||($A=9729),-1!==$B||($B=9729),$m.texParameteri(this._type,10241,$A),$m.texParameteri(this._type,10240,$B),$m.texParameteri(this._type,10242,$n),$m.texParameteri(this._type,10243,$c),this._mipmap&&$m.generateMipmap(this._type)):(-1!==$A||($A=9729),-1!==$B||($B=9729),$m.texParameteri(this._type,10241,$A),$m.texParameteri(this._type,10240,$B),$m.texParameteri(this._type,10242,33071),$m.texParameteri(this._type,10243,33071)),$L&&$q&&$M.bindTexture($m,$L,$q),this.memorySize=$k?this._buffer.length:$e?$h*$P*4*(1+1/3):$h*$P*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1;},$p.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate();}else{this._recreateLock=!0;}},$p.onAsynLoaded=function($m,$p,$h){var $P;$h&&($P=$h[0].call(this,$p)),$P&&(this._width=$P.width,this._height=$P.height,this._buffer=$P.data),this._src=$m,this._size=new $Bp(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded();},$p.getPixels=function(){return new Uint8Array(this._buffer);},$p.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($Q.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0);},$A(0,$p,"src",function(){return this._src;}),$a.create=function($m,$p,$h,$P,$L,$q,$k){if(void 0===$P&&($P=9729),void 0===$L&&($L=9729),void 0===$q&&($q=!0),!$m||$m.byteLength<$p*$h*4)throw"DataTexture2D create error";var $Y=new $a();return $Y.uri=$k,$Y._buffer=$m,$Y._width=$p,$Y._height=$h,$Y._mipmap=$q,$Y._magFifter=$P,$Y._minFifter=$L,$Y._size=new $Bp($Y._width,$Y._height),$Y._conchTexture?alert("怎么给runtime传递datatexture数据"):$Y.activeResource(),$Y;},$a.load=function($m,$p,$h,$P,$L){if(void 0===$p&&($p=0),void 0===$h&&($h=0),void 0===$P&&($P=9729),void 0===$L&&($L=9729),"mipmaps"===$T.getFileExtension($m)){var $q=$H.loader.create($m,null,null,$a,[function($m){this._mipmaps=[];var $p=new Uint32Array($m);this._width=$p[0];var $h=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$h=1024),this._width!=$h)throw"现在只支持512x256的环境贴图。当前的是"+$p[0];this._height=$p[1];for(var $P=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$L=this._height,$q=8;;){var $k=$P*$L*4;if($q+$k>$m.byteLength)throw"load mipmaps data size error ";var $Y=new Uint8Array($m,$q,$k);if(this._mipmaps.push($Y),$q+=$k,1==$P&&1==$L)break;($P/=2)<1&&($P=1),($L/=2)<1&&($L=1);}return null;}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$q.simLodInfo=new Float32Array(40);for(var $k=0;$k<$q.simLodInfo.length;)$q.simLodInfo[$k]=($a.simLodRect[$k]+.5)/1024,$k++,$q.simLodInfo[$k]=($a.simLodRect[$k]+.5)/256,$k++,$q.simLodInfo[$k]=Math.max($a.simLodRect[$k]-1,.1)/1024,$k++,$q.simLodInfo[$k]=Math.max($a.simLodRect[$k]-1.5,.1)/256,$k++;}return $q;}if("number"==typeof $p)return $H.loader.create($m,null,null,$a,[function($m){return this._width=$p,this._height=$h,this._buffer=$m,null;}]);if("function"==typeof $p)return $H.loader.create($m,null,null,$a,[$p]);throw new Error("unknown params.");},$a.lodasatlas=!1,$F($a,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1]);}]),$a;}(),$sp=function($m){function $p(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$p.__super.call(this);}$$($p,"laya.d3.resource.models.PrimitiveMesh",$Mp);var $h=$p.prototype;return $H.imps($h,{"laya.d3.core.render.IRenderable":!0}),$h._getVertexBuffer=function($m){return void 0===$m&&($m=0),0===$m?this._vertexBuffer:null;},$h._getVertexBuffers=function(){return null;},$h._getIndexBuffer=function(){return this._indexBuffer;},$h._getPositions=function(){var $m,$p=[],$h=this._vertexBuffer.vertexDeclaration.getVertexElements(),$P=0;for($P=0;$P<$h.length;$P++){var $L=$h[$P];if("vector3"===$L.elementFormat&&0===$L.elementUsage){$m=$L;break;}}var $q=this._vertexBuffer.getData();for($P=0;$P<$q.length;$P+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $k=$P+$m.offset/4,$Y=new $kp($q[$k+0],$q[$k+1],$q[$k+2]);$p.push($Y);}return $p;},$h.getRenderElement=function($m){return this;},$h.getRenderElementsCount=function(){return 1;},$h.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0;},$h._beforeRender=function($m){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0;},$h._render=function($m){$Q.mainContext.drawElements(4,this._numberIndices,5123,0),$I.drawCall++,$I.trianglesFaces+=this._numberIndices/3;},$A(0,$h,"_vertexBufferCount",function(){return 1;}),$A(0,$h,"triangleCount",function(){return this._indexBuffer.indexCount/3;}),$p;}(),$Gp=function($m){function $p(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$p.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[];}$$($p,"laya.d3.resource.models.Mesh",$Mp);var $h=$p.prototype;return $h._getPositions=function(){var $m,$p,$h,$P,$L,$q=[],$k=0,$Y=0,$d=0;if(0!==this._vertexBuffers.length){var $K=this._vertexBuffers.length;for($k=0;$k<$K;$k++){for($h=($m=this._vertexBuffers[$k]).vertexDeclaration.getVertexElements(),$Y=0;$Y<$h.length;$Y++)if("vector3"===($P=$h[$Y]).elementFormat&&0===$P.elementUsage){$p=$P;break;}for($L=$m.getData(),$Y=0;$Y<$L.length;$Y+=$m.vertexDeclaration.vertexStride/4)$d=$Y+$p.offset/4,$q.push(new $kp($L[$d+0],$L[$d+1],$L[$d+2]));}}else{var $D=this._subMeshes.length;for($k=0;$k<$D;$k++){for($h=($m=this._subMeshes[$k]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$Y=0;$Y<$h.length;$Y++)if("vector3"===($P=$h[$Y]).elementFormat&&0===$P.elementUsage){$p=$P;break;}for($L=$m.getData(),$Y=0;$Y<$L.length;$Y+=$m.vertexDeclaration.vertexStride/4)$d=$Y+$p.offset/4,$q.push(new $kp($L[$d+0],$L[$d+1],$L[$d+2]));}}return $q;},$h._setSubMeshes=function($m){this._subMeshes=$m,this._subMeshCount=$m.length;for(var $p=0;$p<this._subMeshCount;$p++)$m[$p]._indexInMesh=$p;this._positions=this._getPositions(),this._generateBoundingObject();},$h.onAsynLoaded=function($m,$p,$h){var $P=$p[0],$L=$p[1];$im.read($P,this,this._materials,this._subMeshes,$L),this.completeCreate(),this._endLoaded();},$h.getSubMesh=function($m){return this._subMeshes[$m];},$h.getSubMeshCount=function(){return this._subMeshes.length;},$h.getRenderElementsCount=function(){return this._subMeshes.length;},$h.getRenderElement=function($m){return this._subMeshes[$m];},$h.disposeResource=function(){for(var $m=0;$m<this._subMeshes.length;$m++)this._subMeshes[$m].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null;},$A(0,$h,"materials",function(){return this._materials.slice();}),$A(0,$h,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses;}),$p.load=function($m){return $H.loader.create($m,null,null,$p);},$p;}(),$Up=(function($m){function $K($m,$p,$h,$P,$L,$q,$k,$Y,$d){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$h&&($h=6408),void 0===$P&&($P=5121),void 0===$L&&($L=33189),void 0===$q&&($q=!1),void 0===$k&&($k=!1),void 0===$Y&&($Y=-1),void 0===$d&&($d=-1),$K.__super.call(this),this._type=3553,this._width=$m,this._height=$p,this._size=new $Bp($m,$p),this._surfaceFormat=$h,this._surfaceType=$P,this._depthStencilFormat=$L,$B.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$q,this._repeat=$k,this._minFifter=$Y,this._magFifter=$d,this.activeResource(),this._alreadyResolved=!0;}$$($K,"laya.d3.resource.RenderTexture",$Qp);var $p=$K.prototype;$p.recreateResource=function(){var $m=$Q.mainContext;this._frameBuffer=$m.createFramebuffer(),this._source=$m.createTexture();var $p=$M.curBindTexTarget,$h=$M.curBindTexValue;$M.bindTexture($m,this._type,this._source),$m.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $P=this._minFifter,$L=this._magFifter,$q=this._repeat?10497:33071;if($Z.isPOT(this._width,this._height)?(this._mipmap?-1!==$P||($P=9987):-1!==$P||($P=9729),-1!==$L||($L=9729),$m.texParameteri(this._type,10241,$P),$m.texParameteri(this._type,10240,$L),$m.texParameteri(this._type,10242,$q),$m.texParameteri(this._type,10243,$q),this._mipmap&&$m.generateMipmap(this._type)):(-1!==$P||($P=9729),-1!==$L||($L=9729),$m.texParameteri(this._type,10241,$P),$m.texParameteri(this._type,10240,$L),$m.texParameteri(this._type,10242,33071),$m.texParameteri(this._type,10243,33071)),$p&&$h&&$M.bindTexture($m,$p,$h),$m.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$m.createRenderbuffer(),$m.bindRenderbuffer(36161,this._depthStencilBuffer),$m.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$m.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$m.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$m.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$m.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);}$m.framebufferTexture2D(36160,36064,3553,this._source,0),$m.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate();},$p.start=function(){$Q.mainContext.bindFramebuffer(36160,this.frameBuffer),($K._currentRenderTarget=this)._alreadyResolved=!1;},$p.end=function(){$Q.mainContext.bindFramebuffer(36160,null),$K._currentRenderTarget=null,this._alreadyResolved=!0;},$p.getData=function($m,$p,$h,$P){var $L=$Q.mainContext;if($L.bindFramebuffer(36160,this._frameBuffer),!(36053===$L.checkFramebufferStatus(36160)))return $L.bindFramebuffer(36160,null),null;var $q=new Uint8Array(this._width*this._height*4);return $L.readPixels($m,$p,$h,$P,this._surfaceFormat,this._surfaceType,$q),$L.bindFramebuffer(36160,null),$q;},$p.disposeResource=function(){if(this._frameBuffer){var $m=$Q.mainContext;$m.deleteTexture(this._source),$m.deleteFramebuffer(this._frameBuffer),$m.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0;}},$A(0,$p,"surfaceFormat",function(){return this._surfaceFormat;}),$A(0,$p,"surfaceType",function(){return this._surfaceType;}),$A(0,$p,"depthStencilFormat",function(){return this._depthStencilFormat;}),$A(0,$p,"source",function(){return this._alreadyResolved?$H.superGet($Qp,this,"source"):null;}),$A(0,$p,"depthStencilBuffer",function(){return this._depthStencilBuffer;}),$A(0,$p,"frameBuffer",function(){return this._frameBuffer;}),$K._currentRenderTarget=null;}(),function($m){function $p($m){this._color=null,this._pixels=null,$p.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $Bp(this.width,this.height),this._color=$m,this._pixels=new Uint8Array([255*$m.x,255*$m.y,255*$m.z,255*$m.w]),this.uri="SolidColorTexture2D_"+this.id;}$$($p,"laya.d3.resource.SolidColorTexture2D",$Qp);var $h=$p.prototype;return $h._createWebGlTexture=function(){var $m=$Q.mainContext,$p=this._source=$m.createTexture(),$h=this._width,$P=this._height,$L=$M.curBindTexTarget,$q=$M.curBindTexValue;$M.bindTexture($m,this._type,$p),$m.texImage2D(this._type,0,6408,$h,$P,0,6408,5121,this._pixels);var $k=this._minFifter,$Y=this._magFifter,$d=this._repeat?10497:33071,$K=$Z.isPOT($h,$P);$K?(this._mipmap?-1!==$k||($k=9987):-1!==$k||($k=9729),-1!==$Y||($Y=9729),$m.texParameteri(this._type,10241,$k),$m.texParameteri(this._type,10240,$Y),$m.texParameteri(this._type,10242,$d),$m.texParameteri(this._type,10243,$d),this._mipmap&&$m.generateMipmap(this._type)):(-1!==$k||($k=9729),-1!==$Y||($Y=9729),$m.texParameteri(this._type,10241,$k),$m.texParameteri(this._type,10240,$Y),$m.texParameteri(this._type,10242,33071),$m.texParameteri(this._type,10243,33071)),$L&&$q&&$M.bindTexture($m,$L,$q),this.memorySize=$K?$h*$P*4*(1+1/3):$h*$P*4;},$h.recreateResource=function(){this._createWebGlTexture(),this.completeCreate();},$h.disposeResource=function(){this._source&&($Q.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0);},$F($p,["magentaTexture",function(){var $m=new $p(new $Yp(1,0,1,1));return $m.lock=!0,this.magentaTexture=$m;},"grayTexture",function(){var $m=new $p(new $Yp(.5,.5,.5,1));return $m.lock=!0,this.grayTexture=$m;}]),$p;}()),$rp=function($m){function $L($m,$p,$h,$P){this._canRead=!1,this._image=null,this._pixels=null,void 0===$m&&($m=!1),void 0===$p&&($p=!0),void 0===$h&&($h=6408),void 0===$P&&($P=!0),$L.__super.call(this),this._type=3553,this._repeat=$p,this._canRead=$m,this._format=$h,this._mipmap=$P;}$$($L,"laya.d3.resource.Texture2D",$Qp);var $p=$L.prototype;return $p._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $m=$Q.mainContext,$p=this._source=$m.createTexture(),$h=this._width,$P=this._height,$L=$M.curBindTexTarget,$q=$M.curBindTexValue;switch($M.bindTexture($m,this._type,$p),this._format){case 6407:case 6408:this._canRead?$m.texImage2D(this._type,0,this._format,$h,$P,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$m.texImage2D(this._type,0,this._image._format,$h,$P,0,this._image._format,5121,this._image.atlasSource):$m.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $Q.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$m.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format);}var $k=this._minFifter,$Y=this._magFifter,$d=this._repeat?10497:33071,$K=0==this._wrapModeU?10497:33071,$D=0==this._wrapModeV?10497:33071,$F=$Z.isPOT($h,$P);$F?(this._mipmap?-1!==$k||($k=9987):-1!==$k||($k=9729),-1!==$Y||($Y=9729),$m.texParameteri(this._type,10241,$k),$m.texParameteri(this._type,10240,$Y),$m.texParameteri(this._type,10242,$d),$m.texParameteri(this._type,10243,$d),$m.texParameteri(this._type,10242,$K),$m.texParameteri(this._type,10243,$D),this._mipmap&&$m.generateMipmap(this._type)):(-1!==$k||($k=9729),-1!==$Y||($Y=9729),$m.texParameteri(this._type,10241,$k),$m.texParameteri(this._type,10240,$Y),$m.texParameteri(this._type,10242,33071),$m.texParameteri(this._type,10243,33071)),$L&&$q&&$M.bindTexture($m,$L,$q),this._image.onload=null,this._image=null,this.memorySize=$F?$h*$P*4*(1+1/3):$h*$P*4;},$p.recreateResource=function(){this._createWebGlTexture(),this.completeCreate();},$p.onAsynLoaded=function($m,$p,$h){if($h){var $P=$h[0];void 0!==$P&&(this._canRead=$P);var $L=$h[1];void 0!==$L&&(this._repeat=$L);var $q=$h[2];void 0!==$q&&(this._format=$q);var $k=$h[3];void 0!==$k&&(this._mipmap=$k);var $Y=$h.wrapModeU;void 0!==$Y&&(this._wrapModeU=$Y);var $d=$h.wrapModeV;void 0!==$d&&(this._wrapModeV=$d);}switch(this._format){case 6407:case 6408:var $K=(this._image=$p).width,$D=$p.height;this._width=$K,this._height=$D,this._size=new $Bp($K,$D),this._canRead&&($B.isConchApp?$p instanceof $R.HTMLElement&&(this._pixels=new Uint8Array($p.getImageData(0,0,$K,$D))):($u.canvas.size($K,$D),$u.canvas.clear(),$u.context.drawImage($p,0,0,$K,$D),this._pixels=new Uint8Array($u.context.getImageData(0,0,$K,$D).data.buffer)));break;case $Q.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $F=new $W($p);$F.readUTFBytes(4),$F.readUTFBytes(2),$F.getInt16();$F.endian="bigEndian",this._width=$F.getInt16(),this._height=$F.getInt16(),this._size=new $Bp(this._width,this._height);$F.getInt16(),$F.getInt16();this._image=new Uint8Array($p,$F.pos);}this.recreateResource(),this._endLoaded();},$p.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.");},$p.disposeResource=function(){this._source&&($Q.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0);},$A(0,$p,"_src",function(){return this.url;}),$A(0,$p,"src",function(){return this.url;}),$L.load=function($m){return $H.loader.create($m,null,null,$L);},$L;}(),$yp=function($p){function $h($m,$p){$h.__super.call(this),void 0===$m&&($m=.3),void 0===$p&&($p=1e3),this._tempVector3=new $kp(),this._position=new $kp(),this._up=new $kp(),this._forward=new $kp(),this._right=new $kp(),this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$Bp.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$m,this._farPlane=$p,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$H.stage.on("resize",this,this._onScreenSizeChanged);}$$($h,"laya.d3.core.BaseCamera",$p);var $m=$h.prototype;return $m._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $m=this.scene._cameraPool,$p=$m.length-1,$h=0;$h<$p;$h++)if($m[$h].renderingOrder>$m[$p].renderingOrder){var $P=$m[$h];$m[$h]=$m[$p],$m[$p]=$P;}},$m._calculateProjectionMatrix=function(){},$m._onScreenSizeChanged=function(){this._calculateProjectionMatrix();},$m._prepareCameraToRender=function(){$N._currentCameraCullingMask=this.cullingMask;var $m=this._shaderValues;$m.setValue(0,this.transform.position.elements),$m.setValue(5,this.forward.elements),$m.setValue(6,this.up.elements);},$m._prepareCameraViewProject=function($m,$p){var $h=this._shaderValues;$h.setValue(1,$m.elements),$h.setValue(2,$p.elements);},$m._renderCamera=function($m,$p,$h){},$m.addLayer=function($m){29!==$m.number&&30!=$m.number&&(this.cullingMask=this.cullingMask|$m.mask);},$m.removeLayer=function($m){29!==$m.number&&30!=$m.number&&(this.cullingMask=this.cullingMask&~$m.mask);},$m.addAllLayers=function(){this.cullingMask=2147483647;},$m.removeAllLayers=function(){this.cullingMask=0|$N.getLayerByNumber(29).mask|$N.getLayerByNumber(30).mask;},$m.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix();},$m.moveForward=function($m){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$m,this.transform.translate(this._tempVector3);},$m.moveRight=function($m){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$m,this.transform.translate(this._tempVector3);},$m.moveVertical=function($m){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$m,this.transform.translate(this._tempVector3,!1);},$m._addSelfRenderObjects=function(){var $m=this.scene._cameraPool,$p=$m.length;if(0<$p){for(var $h=$p-1;0<=$h;$h--)if(this.renderingOrder<=$m[$h].renderingOrder){$m.splice($h+1,0,this);break;}}else $m.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel);},$m._clearSelfRenderObjects=function(){var $m=this.scene._cameraPool;$m.splice($m.indexOf(this),1);},$m.destroy=function($m){void 0===$m&&($m=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$H.stage.off("resize",this,this._onScreenSizeChanged),$p.prototype.destroy.call(this,$m);},$A(0,$m,"sky",function(){return this._sky;},function($m){(this._sky=$m)._ownerCamera=this;}),$A(0,$m,"forward",function(){var $m=this.transform.worldMatrix.elements,$p=this._forward.elements;return $p[0]=-$m[8],$p[1]=-$m[9],$p[2]=-$m[10],this._forward;}),$A(0,$m,"position",function(){var $m=this.transform.worldMatrix.elements,$p=this._position.elements;return $p[0]=$m[12],$p[1]=$m[13],$p[2]=$m[14],this._position;}),$A(0,$m,"renderTarget",function(){return this._renderTarget;},function($m){null!=(this._renderTarget=$m)&&(this._renderTargetSize=$m.size);}),$A(0,$m,"up",function(){var $m=this.transform.worldMatrix.elements,$p=this._up.elements;return $p[0]=$m[4],$p[1]=$m[5],$p[2]=$m[6],this._up;}),$A(0,$m,"right",function(){var $m=this.transform.worldMatrix.elements,$p=this._right.elements;return $p[0]=$m[0],$p[1]=$m[1],$p[2]=$m[2],this._right;}),$A(0,$m,"renderTargetSize",function(){return this._renderTargetSize;},function($m){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$m,this._calculateProjectionMatrix();}),$A(0,$m,"fieldOfView",function(){return this._fieldOfView;},function($m){this._fieldOfView=$m,this._calculateProjectionMatrix();}),$A(0,$m,"nearPlane",function(){return this._nearPlane;},function($m){this._nearPlane=$m,this._calculateProjectionMatrix();}),$A(0,$m,"farPlane",function(){return this._farPlane;},function($m){this._farPlane=$m,this._calculateProjectionMatrix();}),$A(0,$m,"orthographic",function(){return this._orthographic;},function($m){this._orthographic=$m,this._calculateProjectionMatrix();}),$A(0,$m,"orthographicVerticalSize",function(){return this._orthographicVerticalSize;},function($m){this._orthographicVerticalSize=$m,this._calculateProjectionMatrix();}),$A(0,$m,"renderingOrder",function(){return this._renderingOrder;},function($m){this._renderingOrder=$m,this._sortCamerasByRenderingOrder();}),$h.CAMERAPOS=0,$h.VIEWMATRIX=1,$h.PROJECTMATRIX=2,$h.VPMATRIX=3,$h.VPMATRIX_NO_TRANSLATE=4,$h.CAMERADIRECTION=5,$h.CAMERAUP=6,$h.ENVIRONMENTDIFFUSE=7,$h.ENVIRONMENTSPECULAR=8,$h.SIMLODINFO=9,$h.DIFFUSEIRRADMATR=10,$h.DIFFUSEIRRADMATG=11,$h.DIFFUSEIRRADMATB=12,$h.HDREXPOSURE=13,$h.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$h.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$h.CLEARFLAG_SOLIDCOLOR=0,$h.CLEARFLAG_SKY=1,$h.CLEARFLAG_DEPTHONLY=2,$h.CLEARFLAG_NONE=3,$F($h,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $mp(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1);},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $mp();},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $mp();}]),$h;}($_p),$Vp=function($h){function $p($m){this._render=null,this._geometryFilter=null,$p.__super.call(this,$m);}$$($p,"laya.d3.core.RenderableSprite3D",$h);var $m=$p.prototype;return $m._addToInitStaticBatchManager=function(){},$m._setBelongScene=function($m){$h.prototype._setBelongScene.call(this,$m),$m._renderableSprite3Ds.push(this),this._render._applyLightMapParams();},$m._setUnBelongScene=function(){var $m=this._scene._renderableSprite3Ds,$p=$m.indexOf(this);$m.splice($p,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$h.prototype._setUnBelongScene.call(this);},$m._update=function($m){($m.owner=this)._activeInHierarchy&&(this._updateComponents($m),this._render._updateOctreeNode(),this._lateUpdateComponents($m),$I.spriteCount++,this._childs.length&&this._updateChilds($m));},$m.destroy=function($m){void 0===$m&&($m=!0),$h.prototype.destroy.call(this,$m),this._render._destroy(),this._render=null;},$p.__init__=function(){$p.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$p.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$p.SAHDERDEFINE_LIGHTMAP=$p.shaderDefines.registerDefine("LIGHTMAP");},$p.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$p.SAHDERDEFINE_LIGHTMAP=4,$p.LIGHTMAPSCALEOFFSET=2,$p.LIGHTMAP=3,$F($p,["shaderDefines",function(){return this.shaderDefines=new $Dp();}]),$p;}($_p),$op=(function($m){function $P($m,$p,$h){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$m&&($m=1),void 0===$p&&($p=1),void 0===$h&&($h=1),$P.__super.call(this),this._long=$m,this._width=$p,this._height=$h,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject();}$$($P,"laya.d3.resource.models.BoxMesh",$sp);var $p=$P.prototype;$p.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $m=$Qm.vertexDeclaration,$p=($m.vertexStride,this._long/2),$h=this._height/2,$P=this._width/2,$L=new Float32Array([-$p,$h,-$P,0,1,0,0,0,$p,$h,-$P,0,1,0,1,0,$p,$h,$P,0,1,0,1,1,-$p,$h,$P,0,1,0,0,1,-$p,-$h,-$P,0,-1,0,0,1,$p,-$h,-$P,0,-1,0,1,1,$p,-$h,$P,0,-1,0,1,0,-$p,-$h,$P,0,-1,0,0,0,-$p,$h,-$P,-1,0,0,0,0,-$p,$h,$P,-1,0,0,1,0,-$p,-$h,$P,-1,0,0,1,1,-$p,-$h,-$P,-1,0,0,0,1,$p,$h,-$P,1,0,0,1,0,$p,$h,$P,1,0,0,0,0,$p,-$h,$P,1,0,0,0,1,$p,-$h,-$P,1,0,0,1,1,-$p,$h,$P,0,0,1,0,0,$p,$h,$P,0,0,1,1,0,$p,-$h,$P,0,0,1,1,1,-$p,-$h,$P,0,0,1,0,1,-$p,$h,-$P,0,0,-1,1,0,$p,$h,-$P,0,0,-1,0,0,$p,-$h,-$P,0,0,-1,0,1,-$p,-$h,-$P,0,0,-1,1,1]),$q=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $wp($m,this._numberVertices,35044,!0),this._indexBuffer=new $zp("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($L),this._indexBuffer.setData($q),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate();},$A(0,$p,"long",function(){return this._long;},function($m){this._long!==$m&&(this._long=$m,this.releaseResource(),this.activeResource());}),$A(0,$p,"width",function(){return this._width;},function($m){this._width!==$m&&(this._width=$m,this.releaseResource(),this.activeResource());}),$A(0,$p,"height",function(){return this._height;},function($m){this._height!==$m&&(this._height=$m,this.releaseResource(),this.activeResource());});}(),function($m){function $L($m,$p,$h,$P){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$m&&($m=10),void 0===$p&&($p=10),void 0===$h&&($h=10),void 0===$P&&($P=10),$L.__super.call(this),this._long=$m,this._width=$p,this._stacks=$h,this._slices=$P,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject();}$$($L,"laya.d3.resource.models.PlaneMesh",$sp);var $p=$L.prototype;$p.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $m=new Uint16Array(this._numberIndices),$p=$Qm.vertexDeclaration,$h=$p.vertexStride/4,$P=new Float32Array(this._numberVertices*$h),$L=this._long/2,$q=this._width/2,$k=this._long/this._stacks,$Y=this._width/this._slices,$d=0,$K=0;$K<=this._slices;$K++)for(var $D=0;$D<=this._stacks;$D++)$P[$d++]=$D*$k-$L,$P[$d++]=0,$P[$d++]=$K*$Y-$q,$P[$d++]=0,$P[$d++]=1,$P[$d++]=0,$P[$d++]=1*$D/this._stacks,$P[$d++]=1*$K/this._slices;var $F=0;for($K=0;$K<this._slices;$K++)for($D=0;$D<this._stacks;$D++)$m[$F++]=($K+1)*(this._stacks+1)+$D,$m[$F++]=$K*(this._stacks+1)+$D,$m[$F++]=($K+1)*(this._stacks+1)+$D+1,$m[$F++]=$K*(this._stacks+1)+$D,$m[$F++]=$K*(this._stacks+1)+$D+1,$m[$F++]=($K+1)*(this._stacks+1)+$D+1;this._vertexBuffer=new $wp($p,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $zp("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($P),this._indexBuffer.setData($m),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate();},$A(0,$p,"long",function(){return this._long;},function($m){this._long!==$m&&(this._long=$m,this.releaseResource(),this.activeResource());}),$A(0,$p,"width",function(){return this._width;},function($m){this._width!==$m&&(this._width=$m,this.releaseResource(),this.activeResource());}),$A(0,$p,"stacks",function(){return this._stacks;},function($m){this._stacks!==$m&&(this._stacks=$m,this.releaseResource(),this.activeResource());}),$A(0,$p,"slices",function(){return this._slices;},function($m){this._slices!==$m&&(this._slices=$m,this.releaseResource(),this.activeResource());});}(),function($m){function $k($m,$p,$h){void 0===$m&&($m=0),void 0===$p&&($p=.3),void 0===$h&&($h=1e3),this._viewMatrix=new $mp(),this._projectionMatrix=new $mp(),this._projectionViewMatrix=new $mp(),this._viewport=new $dp(0,0,0,0),this._normalizedViewport=new $dp(0,0,1,1),this._aspectRatio=$m,this._boundFrustumUpdate=!0,this._boundFrustum=new $gm($mp.DEFAULT),$k.__super.call(this,$p,$h),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged);}$$($k,"laya.d3.core.Camera",$yp);var $p=$k.prototype;return $p._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0;},$p._parseCustomProps=function($m,$p,$h,$P){var $L=$h.clearColor;this.clearColor=new $Yp($L[0],$L[1],$L[2],$L[3]);var $q=$h.viewport;this.normalizedViewport=new $dp($q[0],$q[1],$q[2],$q[3]);},$p._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $m=this.orthographicVerticalSize*this.aspectRatio*.5,$p=.5*this.orthographicVerticalSize;$mp.createOrthoOffCenterRH(-$m,$m,-$p,$p,this.nearPlane,this.farPlane,this._projectionMatrix);}else $mp.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0;},$p._update=function($m){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$m);},$p._renderCamera=function($m,$p,$h){var $P,$L;$h.parallelSplitShadowMaps[0]&&$h._renderShadowMap($m,$p,this),($p.camera=this)._prepareCameraToRender(),$h._preRenderUpdateComponents($p),$P=$p._viewMatrix=this.viewMatrix;var $q=this._renderTarget;$q?($q.start(),$mp.multiply($yp._invertYScaleMatrix,this._projectionMatrix,$yp._invertYProjectionMatrix),$mp.multiply($yp._invertYScaleMatrix,this.projectionViewMatrix,$yp._invertYProjectionViewMatrix),$L=$p._projectionMatrix=$yp._invertYProjectionMatrix,$p._projectionViewMatrix=$yp._invertYProjectionViewMatrix):($L=$p._projectionMatrix=this._projectionMatrix,$p._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($P,$L),$p._viewport=this.viewport,$h._preRenderScene($m,$p,this.boundFrustum),$h._clear($m,$p),$h._renderScene($m,$p),$h._postRenderUpdateComponents($p),$q&&$q.end();},$p.viewportPointToRay=function($m,$p){$Ap.calculateCursorRay($m,this.viewport,this._projectionMatrix,this.viewMatrix,null,$p);},$p.normalizedViewportPointToRay=function($m,$p){var $h=$k._tempVector20,$P=this.viewport,$L=$m.elements,$q=$h.elements;$q[0]=$L[0]*$P.width,$q[1]=$L[1]*$P.height,$Ap.calculateCursorRay($h,this.viewport,this._projectionMatrix,this.viewMatrix,null,$p);},$p.worldToViewportPoint=function($m,$p){$mp.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($m,this._projectionViewMatrix,$p);var $h=$p.elements;$h[0]=$h[0]/$H.stage.clientScaleX,$h[1]=$h[1]/$H.stage.clientScaleY;},$p.worldToNormalizedViewportPoint=function($m,$p){$mp.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($m,this._projectionViewMatrix,$p);var $h=$p.elements;$h[0]=$h[0]/$H.stage.clientScaleX,$h[1]=$h[1]/$H.stage.clientScaleY;},$p.convertScreenCoordToOrthographicCoord=function($m,$p){if(this._orthographic){var $h=$i.clientWidth,$P=$i.clientHeight,$L=this.orthographicVerticalSize*this.aspectRatio/$h,$q=this.orthographicVerticalSize/$P,$k=$m.elements,$Y=$p.elements;return $Y[0]=(-$h/2+$k[0])*$L,$Y[1]=($P/2-$k[1])*$q,$Y[2]=(this.nearPlane-this.farPlane)*($k[2]+1)/2-this.nearPlane,$kp.transformCoordinate($p,this.transform.worldMatrix,$p),!0;}return!1;},$A(0,$p,"projectionViewMatrix",function(){return $mp.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix;}),$A(0,$p,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $m=this.viewport;return $m.width/$m.height;},function($m){if($m<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$m,this._calculateProjectionMatrix();}),$A(0,$p,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum;}),$A(0,$p,"needViewport",function(){var $m=this.normalizedViewport;return 0===$m.x&&0===$m.y&&1===$m.width&&1===$m.height;}),$A(0,$p,"viewport",function(){if(this._viewportExpressedInClipSpace){var $m=this._normalizedViewport,$p=this.renderTargetSize,$h=$p.width,$P=$p.height;this._viewport.x=$m.x*$h,this._viewport.y=$m.y*$P,this._viewport.width=$m.width*$h,this._viewport.height=$m.height*$P;}return this._viewport;},function($m){if(null!=this.renderTarget&&($m.x<0||$m.y<0||0==$m.width||0==$m.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$m,this._calculateProjectionMatrix();}),$A(0,$p,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $m=this._viewport,$p=this.renderTargetSize,$h=$p.width,$P=$p.height;this._normalizedViewport.x=$m.x/$h,this._normalizedViewport.y=$m.y/$P,this._normalizedViewport.width=$m.width/$h,this._normalizedViewport.height=$m.height/$P;}return this._normalizedViewport;},function($m){$m.x<0&&($m.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$m.y<0&&($m.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$m.x+$m.width&&($m.width=1-$m.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$m.y+$m.height&&($m.height=1-$m.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$m,this._calculateProjectionMatrix();}),$A(0,$p,"projectionMatrix",function(){return this._projectionMatrix;},function($m){this._projectionMatrix=$m,this._useUserProjectionMatrix=!0;}),$A(0,$p,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix;}),$F($k,["_tempVector20",function(){return this._tempVector20=new $qp();}]),$k;}()),$fp=function($h){function $P($m,$p){$P.__super.call(this,$p),this._geometryFilter=new $up(this),this._render=new $Np(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$m&&(this._geometryFilter.sharedMesh=$m)instanceof laya.d3.resource.models.Mesh&&($m.loaded?this._render.sharedMaterials=$m.materials:$m.once("loaded",this,this._applyMeshMaterials));}$$($P,"laya.d3.core.MeshSprite3D",$h);var $m=$P.prototype;return $m._changeRenderObjectByMesh=function($m){var $p=this._render._renderElements,$h=$p[$m];$h||($h=$p[$m]=new $Ep()),$h._render=this._render;var $P=this._render.sharedMaterials[$m];$P||($P=$Jp.defaultMaterial);var $L=this._geometryFilter.sharedMesh.getRenderElement($m);return $h._mainSortID=this._getSortID($L,$P),$h._sprite3D=this,$h.renderObj=$L,$h._material=$P,$h;},$m._changeRenderObjectByMaterial=function($m,$p){var $h=this._render._renderElements[$m];$p||($p=$Jp.defaultMaterial);var $P=this._geometryFilter.sharedMesh.getRenderElement($m);return $h._mainSortID=this._getSortID($P,$p),$h._sprite3D=this,$h.renderObj=$P,$h._material=$p,$h;},$m._changeRenderObjectsByMesh=function(){var $m=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$m;for(var $p=0;$p<$m;$p++)this._changeRenderObjectByMesh($p);},$m._onMeshChanged=function($m){var $p=$m.sharedMesh;$p.loaded?this._changeRenderObjectsByMesh():$p.once("loaded",this,this._onMeshLoaded);},$m._onMeshLoaded=function($m){$m===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh();},$m._onMaterialChanged=function($m,$p,$h){$p<this._render._renderElements.length&&this._changeRenderObjectByMaterial($p,$h);},$m._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render);},$m._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render);},$m._parseCustomProps=function($m,$p,$h,$P){var $L=this.meshRender,$q=$h.lightmapIndex;null!=$q&&($L.lightmapIndex=$q);var $k,$Y,$d=$h.lightmapScaleOffset;if($d&&($L.lightmapScaleOffset=new $Yp($d[0],$d[1],$d[2],$d[3])),$P.instanceParams)($k=$P.instanceParams.loadPath)&&($Y=$c.getRes($p[$k]),(this.meshFilter.sharedMesh=$Y).loaded?$L.sharedMaterials=$Y.materials:$Y.once("loaded",this,this._applyMeshMaterials));else{($k=$h.meshPath)&&($Y=$c.getRes($p[$k]),this.meshFilter.sharedMesh=$Y);var $K=$h.materials;if($K){var $D=$L.sharedMaterials,$F=$K.length;$D.length=$F;for(var $R=0;$R<$F;$R++)$D[$R]=$c.getRes($p[$K[$R].path]);$L.sharedMaterials=$D;}}},$m._applyMeshMaterials=function($m){for(var $p=this._render.sharedMaterials,$h=$m.materials,$P=0,$L=$h.length;$P<$L;$P++)$p[$P]||($p[$P]=$h[$P]);this._render.sharedMaterials=$p;},$m._addToInitStaticBatchManager=function(){$P._staticBatchManager._addInitBatchSprite(this);},$m.cloneTo=function($m){var $p=$m;$p._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $h=this._render,$P=$p._render;$P.enable=$h.enable,$P.sharedMaterials=$h.sharedMaterials,$P.castShadow=$h.castShadow;var $L=$h.lightmapScaleOffset;$L&&($P.lightmapScaleOffset=$L.clone()),$P.lightmapIndex=$h.lightmapIndex,$P.receiveShadow=$h.receiveShadow,$P.sortingFudge=$h.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$m);},$m.destroy=function($m){if(void 0===$m&&($m=!0),!this.destroyed){var $p=this.meshFilter.sharedMesh;null!=$p&&($p.loaded||$p.off("loaded",this,this._applyMeshMaterials)),$h.prototype.destroy.call(this,$m),this._geometryFilter._destroy();}},$A(0,$m,"meshFilter",function(){return this._geometryFilter;}),$A(0,$m,"meshRender",function(){return this._render;}),$P.__init__=function(){$Pm._staticBatchManagers.push($P._staticBatchManager);},$P.load=function($m){return $H.loader.create($m,null,null,$P);},$F($P,["_staticBatchManager",function(){return this._staticBatchManager=new $bp();}]),$P;}($Vp);}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($m,$p){"use strict";for(var $h in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $P=Laya[$h];$P&&$P.__isclass&&($p[$h]=$P);}}),function($m,$p,$Lm){$Lm.un,$Lm.uns;var $h=$Lm.static,$P=$Lm.class,$q=$Lm.getset,$B=$Lm.__newvec,$Y=laya.maths.Bezier,$F=laya.utils.Browser,$Qm=laya.utils.Byte,$L=(laya.events.Event,laya.events.EventDispatcher),$k=laya.display.Graphics,$d=(laya.resource.HTMLCanvas,laya.utils.Handler),$K=laya.net.Loader,$R=laya.maths.MathUtil,$Mm=laya.maths.Matrix,$n=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$D=(laya.renders.RenderContext,laya.resource.Resource),$$=laya.utils.RunDriver,$qm=laya.display.Sprite,$A=laya.utils.Stat,$um=laya.resource.Texture,$c=(laya.net.URL,laya.utils.Utils),$M=function(){function $m(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0;}return $P($m,"laya.ani.AnimationContent"),$m;}(),$u=function(){function $m(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0;}return $P($m,"laya.ani.AnimationNodeContent"),$m;}(),$a=function(){function $m(){}return $P($m,"laya.ani.AnimationParser01"),$m.parse=function($m,$p){var $h=$p.__getBuffer(),$P=0,$L=0,$q=0,$k=0,$Y=0,$d=0,$K=0,$D=$p.readUTFString();$m._aniClassName=$D;var $F,$R=$p.readUTFString().split("\n"),$$=$p.getUint8(),$A=$p.getUint32(),$B=$p.getUint32();0<$A&&($F=$h.slice($A,$B));var $n=new $Qm($F);for(0<$B&&($m._publicExtData=$h.slice($B,$h.byteLength)),$m._useParent=!!$p.getUint8(),$m._anis.length=$$,$P=0;$P<$$;$P++){var $c=$m._anis[$P]=new $M();$c.nodes=new Array();var $e=$c.name=$R[$p.getUint16()];$m._aniMap[$e]=$P,$c.bone3DMap={},$c.playTime=$p.getFloat32(),$c.playTime<=0&&console.error("播放时间不能为0  url="+$m.url+" name="+$c.name);var $a=$c.nodes.length=$p.getUint8();for($L=$c.totalKeyframeDatasLength=0;$L<$a;$L++){var $Z=$c.nodes[$L]=new $u();$Z.childs=[];var $H=$p.getInt16();0<=$H&&($Z.name=$R[$H],$c.bone3DMap[$Z.name]=$L),$Z.keyFrame=new Array(),$Z.parentIndex=$p.getInt16(),-1==$Z.parentIndex?$Z.parent=null:$Z.parent=$c.nodes[$Z.parentIndex],$Z.lerpType=$p.getUint8();var $W=$p.getUint32();$n.pos=$W;var $E=$Z.keyframeWidth=$n.getUint16();if($c.totalKeyframeDatasLength+=$E,0===$Z.lerpType||1===$Z.lerpType)for($Z.interpolationMethod=[],$Z.interpolationMethod.length=$E,$q=0;$q<$E;$q++)$Z.interpolationMethod[$q]=$_.interpolation[$n.getUint8()];null!=$Z.parent&&$Z.parent.childs.push($Z);var $I=$p.getUint16();0<$I&&($Z.extenData=$h.slice($p.pos,$p.pos+$I),$p.pos+=$I);var $b,$T=$p.getUint16(),$j=0;for($q=0,$k=$Z.keyFrame.length=$T;$q<$k;$q++){if(($b=$Z.keyFrame[$q]=new $N()).duration=$p.getFloat32(),$b.startTime=$j,2===$Z.lerpType){$b.interpolationData=[];var $x,$Q=$p.getUint8();switch($x=$p.getFloat32()){case 254:for($b.interpolationData.length=$E,$K=0;$K<$E;$K++)$b.interpolationData[$K]=0;break;case 255:for($b.interpolationData.length=$E,$K=0;$K<$E;$K++)$b.interpolationData[$K]=5;break;default:for($b.interpolationData.push($x),$d=1;$d<$Q;$d++)$b.interpolationData.push($p.getFloat32());}}for($b.data=new Float32Array($E),$Y=0;$Y<$E;$Y++)$b.data[$Y]=$p.getFloat32(),-1e-8<$b.data[$Y]&&$b.data[$Y]<1e-8&&($b.data[$Y]=0);$j+=$b.duration;}$b.startTime=$c.playTime,$Z.playTime=$c.playTime,$m._calculateKeyFrame($Z,$T,$E);}}},$m;}(),$Z=function(){function $H(){}return $P($H,"laya.ani.AnimationParser02"),$H.READ_DATA=function(){$H._DATA.offset=$H._reader.getUint32(),$H._DATA.size=$H._reader.getUint32();},$H.READ_BLOCK=function(){for(var $m=$H._BLOCK.count=$H._reader.getUint16(),$p=$H._BLOCK.blockStarts=[],$h=$H._BLOCK.blockLengths=[],$P=0;$P<$m;$P++)$p.push($H._reader.getUint32()),$h.push($H._reader.getUint32());},$H.READ_STRINGS=function(){var $m=$H._reader.getUint32(),$p=$H._reader.getUint16(),$h=$H._reader.pos;$H._reader.pos=$m+$H._DATA.offset;for(var $P=0;$P<$p;$P++)$H._strings[$P]=$H._reader.readUTFString();$H._reader.pos=$h;},$H.parse=function($m,$p){$H._templet=$m;($H._reader=$p).__getBuffer();$H.READ_DATA(),$H.READ_BLOCK(),$H.READ_STRINGS();for(var $h=0,$P=$H._BLOCK.count;$h<$P;$h++){var $L=$p.getUint16(),$q=$H._strings[$L],$k=$H["READ_"+$q];if(null==$k)throw new Error("model file err,no this function:"+$L+" "+$q);$k.call();}},$H.READ_ANIMATIONS=function(){var $m=$H._reader,$p=$m.__getBuffer(),$h=0,$P=0,$L=0,$q=0,$k=$m.getUint16(),$Y=[];for($Y.length=$k,$h=0;$h<$k;$h++)$Y[$h]=$_.interpolation[$m.getByte()];var $d=$m.getUint8();for($H._templet._anis.length=$d,$h=0;$h<$d;$h++){var $K=$H._templet._anis[$h]={};$K.nodes=new Array();var $D=$K.name=$H._strings[$m.getUint16()];$H._templet._aniMap[$D]=$h,$K.bone3DMap={},$K.playTime=$m.getFloat32();var $F=$K.nodes.length=$m.getInt16();for($P=$K.totalKeyframeDatasLength=0;$P<$F;$P++){var $R=$K.nodes[$P]={};$R.keyframeWidth=$k,$R.childs=[];var $$=$m.getUint16();0<=$$&&($R.name=$H._strings[$$],$K.bone3DMap[$R.name]=$P),$R.keyFrame=new Array(),$R.parentIndex=$m.getInt16(),-1==$R.parentIndex?$R.parent=null:$R.parent=$K.nodes[$R.parentIndex],$K.totalKeyframeDatasLength+=$k,$R.interpolationMethod=$Y,null!=$R.parent&&$R.parent.childs.push($R);var $A=$m.getUint16(),$B=null,$n=null;for($L=0,$q=$R.keyFrame.length=$A;$L<$q;$L++){($B=$R.keyFrame[$L]={}).startTime=$m.getFloat32(),$n&&($n.duration=$B.startTime-$n.startTime);var $c=$H._DATA.offset,$e=$m.getUint32(),$a=4*$k,$Z=$p.slice($c+$e,$c+$e+$a);$B.data=new Float32Array($Z),$n=$B;}$B.duration=0,$R.playTime=$K.playTime,$H._templet._calculateKeyFrame($R,$A,$k);}}},$H._templet=null,$H._reader=null,$H._strings=[],$h($H,["_BLOCK",function(){return this._BLOCK={count:0};},"_DATA",function(){return this._DATA={offset:0,size:0};}]),$H;}(),$Nm=(function(){function $m(){}$P($m,"laya.ani.AnimationState"),$m.stopped=0,$m.paused=1,$m.playing=2;}(),function(){function $L(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $Vm(),this.resultMatrix=new $Mm(),this._children=[];}$P($L,"laya.ani.bone.Bone");var $m=$L.prototype;return $m.setTempMatrix=function($m){this._tempMatrix=$m;var $p,$h=0;for($h=0,$p=this._children.length;$h<$p;$h++)this._children[$h].setTempMatrix(this._tempMatrix);},$m.update=function($m){var $p;if(this.rotation=this.transform.skX,$m)$p=this.resultTransform.getMatrix(),$Mm.mul($p,$m,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone){if(this.inheritRotation&&this.inheritScale)$p=this.resultTransform.getMatrix(),$Mm.mul($p,this.parentBone.resultMatrix,this.resultMatrix);else{var $h=this.parentBone,$P=NaN,$L=NaN,$q=NaN,$k=this.parentBone.resultMatrix;$p=this.resultTransform.getMatrix();var $Y=$k.a*$p.tx+$k.c*$p.ty+$k.tx,$d=$k.b*$p.tx+$k.d*$p.ty+$k.ty,$K=new $Mm();this.inheritRotation?($P=Math.atan2($h.resultMatrix.b,$h.resultMatrix.a),$L=Math.cos($P),$q=Math.sin($P),$K.setTo($L,$q,-$q,$L,0,0),$Mm.mul(this._tempMatrix,$K,$Mm.TEMP),$Mm.TEMP.copyTo($K),$p=this.resultTransform.getMatrix(),$Mm.mul($p,$K,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$p=this.resultTransform.getMatrix(),$Mm.TEMP.identity(),$Mm.TEMP.d=this.d,$Mm.mul($p,$Mm.TEMP,this.resultMatrix)),this.resultMatrix.tx=$Y,this.resultMatrix.ty=$d;}}else($p=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $D,$F=0;for($F=0,$D=this._children.length;$F<$D;$F++)this._children[$F].update();},$m.updateChild=function(){var $m,$p=0;for($p=0,$m=this._children.length;$p<$m;$p++)this._children[$p].update();},$m.setRotation=function($m){this._sprite&&(this._sprite.rotation=180*$m/Math.PI);},$m.updateDraw=function($m,$p){$L.ShowBones&&!$L.ShowBones[this.name]||(this._sprite||(this._sprite=new $qm(),this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$Lm.stage.addChild(this._sprite)),this._sprite.x=$m+this.resultMatrix.tx,this._sprite.y=$p+this.resultMatrix.ty);var $h,$P=0;for($P=0,$h=this._children.length;$P<$h;$P++)this._children[$P].updateDraw($m,$p);},$m.addChild=function($m){this._children.push($m),$m.parentBone=this;},$m.findBone=function($m){if(this.name==$m)return this;var $p,$h,$P=0;for($P=0,$p=this._children.length;$P<$p;$P++)if($h=this._children[$P].findBone($m))return $h;return null;},$m.localToWorld=function($m){var $p=$m[0],$h=$m[1];$m[0]=$p*this.resultMatrix.a+$h*this.resultMatrix.c+this.resultMatrix.tx,$m[1]=$p*this.resultMatrix.b+$h*this.resultMatrix.d+this.resultMatrix.ty;},$L.ShowBones={},$L;}()),$Sm=function(){function $B(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null;}$P($B,"laya.ani.bone.BoneSlot");var $m=$B.prototype;return $m.showSlotData=function($m,$p){void 0===$p&&($p=!0),this.currSlotData=$m,$p&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null;},$m.showDisplayByName=function($m){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($m));},$m.replaceDisplayByName=function($m,$p){if(this.currSlotData){var $h;$h=this.currSlotData.getDisplayByName($m);var $P;$P=this.currSlotData.getDisplayByName($p),this.replaceDisplayByIndex($h,$P);}},$m.replaceDisplayByIndex=function($m,$p){this.currSlotData&&(this._replaceDic[$m]=$p,this.displayIndex==$m&&this.showDisplayByIndex($m));},$m.showDisplayByIndex=function($m){if(null!=this._replaceDic[$m]&&($m=this._replaceDic[$m]),this.currSlotData&&-1<$m&&$m<this.currSlotData.displayArr.length){if(this.displayIndex=$m,this.currDisplayData=this.currSlotData.displayArr[$m],this.currDisplayData){var $p=this.currDisplayData.name;this.currTexture=this.templet.getTexture($p),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$n.isConchApp||$n.isConchApp&&"0.9.15"<$qm.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture));}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null;},$m.replaceSkin=function($m){this._diyTexture=$m,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null);},$m.setParentMatrix=function($m){this._parentMatrix=$m;},$m.draw=function($m,$p,$h,$P){if(void 0===$h&&($h=!1),void 0===$P&&($P=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $L,$q=this.currTexture;switch(this._diyTexture&&($q=this._diyTexture),this.currDisplayData.type){case 0:if($m){var $k=this.getDisplayMatrix();if(this._parentMatrix){var $Y=!1;if($k){var $d;if($Mm.mul($k,this._parentMatrix,$Mm.TEMP),$d=$h?(null==this._resultMatrix&&(this._resultMatrix=new $Mm()),this._resultMatrix):new $Mm(),!$n.isWebGL&&this.currDisplayData.uvs||$n.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $K=$B._tempMatrix;$K.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($K.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($Y=!0,$K.rotate(-Math.PI/2)),$Mm.mul($K,$Mm.TEMP,$d);}else $Mm.TEMP.copyTo($d);$Y?$m.drawTexture($q,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$d):$m.drawTexture($q,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$d);}}}break;case 1:if(null==($L=$h?(null==this._skinSprite&&(this._skinSprite=$B.createSkinMesh()),this._skinSprite):$B.createSkinMesh()))return;var $D;if(null==this.currDisplayData.bones){var $F,$R=this.currDisplayData.weights;this.deformData&&($R=this.deformData),$F=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$E.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$E.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$R;this.currDisplayData.triangles.length;$D=this.currDisplayData.triangles,$L.init2($q,null,$D,this._mVerticleArr,$F);var $$,$A=this.getDisplayMatrix();if(this._parentMatrix)if($A)$Mm.mul($A,this._parentMatrix,$Mm.TEMP),$$=$h?(null==this._resultMatrix&&(this._resultMatrix=new $Mm()),this._resultMatrix):new $Mm(),$Mm.TEMP.copyTo($$),$L.transform=$$;}else this.skinMesh($p,$L,$P);$m.drawSkin($L);break;case 2:if(null==($L=$h?(null==this._skinSprite&&(this._skinSprite=$B.createSkinMesh()),this._skinSprite):$B.createSkinMesh()))return;this.skinMesh($p,$L,$P),$m.drawSkin($L);}}},$m.skinMesh=function($m,$p,$h){var $P,$L=this.currTexture,$q=this.currDisplayData.bones;$P=this._diyTexture?($L=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$E.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$E.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $k,$Y,$d=this.currDisplayData.weights,$K=this.currDisplayData.triangles,$D=0,$F=0,$R=0,$$=NaN,$A=NaN,$B=0,$n=0,$c=[],$e=0,$a=0;if(this.deformData&&0<this.deformData.length){var $Z=0;for($e=0,$a=$q.length;$e<$a;){for($R=$q[$e++]+$e,$F=$D=0;$e<$R;$e++)$Y=$m[$q[$e]],$$=$d[$B]+this.deformData[$Z++],$A=$d[$B+1]+this.deformData[$Z++],$n=$d[$B+2],$D+=($$*$Y.a+$A*$Y.c+$Y.tx)*$n,$F+=($$*$Y.b+$A*$Y.d+$Y.ty)*$n,$B+=3;$c.push($D,$F);}}else for($e=0,$a=$q.length;$e<$a;){for($R=$q[$e++]+$e,$F=$D=0;$e<$R;$e++)$Y=$m[$q[$e]],$$=$d[$B],$A=$d[$B+1],$n=$d[$B+2],$D+=($$*$Y.a+$A*$Y.c+$Y.tx)*$n,$F+=($$*$Y.b+$A*$Y.d+$Y.ty)*$n,$B+=3;$c.push($D,$F);}this._mVerticleArr=$c,$k=$K,$p.init2($L,null,$k,this._mVerticleArr,$P);},$m.drawBonePoint=function($m){$m&&this._parentMatrix&&$m.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000");},$m.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null;},$m.getMatrix=function(){return this._resultMatrix;},$m.copy=function(){var $m=new $B();return $m.type="copy",$m.name=this.name,$m.attachmentName=this.attachmentName,$m.srcDisplayIndex=this.srcDisplayIndex,$m.parent=this.parent,$m.displayIndex=this.displayIndex,$m.templet=this.templet,$m.currSlotData=this.currSlotData,$m.currTexture=this.currTexture,$m.currDisplayData=this.currDisplayData,$m;},$B.createSkinMesh=function(){return $n.isWebGL||$n.isConchApp?$$.skinAniSprite():($n.isWebGL,null);},$h($B,["_tempMatrix",function(){return this._tempMatrix=new $Mm();}]),$B;}(),$_m=function(){function $m(){this.skinName=null,this.deformSlotDataList=[];}return $P($m,"laya.ani.bone.DeformAniData"),$m;}(),$lm=function(){function $m(){this.deformSlotDisplayList=[];}return $P($m,"laya.ani.bone.DeformSlotData"),$m;}(),$Jm=function(){function $m(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[];}$P($m,"laya.ani.bone.DeformSlotDisplayData");var $p=$m.prototype;return $p.binarySearch1=function($m,$p){var $h=0,$P=$m.length-2;if(0==$P)return 1;for(var $L=$P>>>1;;){if($m[Math.floor($L+1)]<=$p?$h=$L+1:$P=$L,$h==$P)return $h+1;$L=$h+$P>>>1;}return 0;},$p.apply=function($m,$p,$h){if(void 0===$h&&($h=1),$m+=.05,!(this.timeList.length<=0)){var $P=0;if(!($m<this.timeList[0])){var $L=this.vectices[0].length,$q=[],$k=this.binarySearch1(this.timeList,$m);if(this.frameIndex=$k,$m>=this.timeList[this.timeList.length-1]){var $Y=this.vectices[this.vectices.length-1];if($h<1)for($P=0;$P<$L;$P++)$q[$P]+=($Y[$P]-$q[$P])*$h;else for($P=0;$P<$L;$P++)$q[$P]=$Y[$P];this.deformData=$q;}else{this.tweenKeyList[this.frameIndex];var $d=this.vectices[this.frameIndex-1],$K=this.vectices[this.frameIndex],$D=this.timeList[this.frameIndex-1],$F=this.timeList[this.frameIndex];$h=this.tweenKeyList[$k-1]?($m-$D)/($F-$D):0;var $R=NaN;for($P=0;$P<$L;$P++)$R=$d[$P],$q[$P]=$R+($K[$P]-$R)*$h;this.deformData=$q;}}}},$m;}(),$zm=function(){function $m(){this.time=NaN,this.drawOrder=[];}return $P($m,"laya.ani.bone.DrawOrderData"),$m;}(),$wm=function(){function $m(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN;}return $P($m,"laya.ani.bone.EventData"),$m;}(),$e=function(){function $Pm($m,$p){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$m,this._targetBone=$p[$m.targetBoneIndex],this.isSpine=$m.isSpine,null==this._bones&&(this._bones=[]);for(var $h=this._bones.length=0,$P=$m.boneIndexs.length;$h<$P;$h++)this._bones.push($p[$m.boneIndexs[$h]]);this.name=$m.name,this.mix=$m.mix,this.bendDirection=$m.bendDirection;}$P($Pm,"laya.ani.bone.IkConstraint");var $m=$Pm.prototype;return $m.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix);}},$m._applyIk1=function($m,$p,$h,$P){var $L=$m.parentBone,$q=1/($L.resultMatrix.a*$L.resultMatrix.d-$L.resultMatrix.b*$L.resultMatrix.c),$k=$p-$L.resultMatrix.tx,$Y=$h-$L.resultMatrix.ty,$d=($k*$L.resultMatrix.d-$Y*$L.resultMatrix.c)*$q-$m.transform.x,$K=($Y*$L.resultMatrix.a-$k*$L.resultMatrix.b)*$q-$m.transform.y,$D=Math.atan2($K,$d)*$Pm.radDeg-0-$m.transform.skX;$m.transform.scX<0&&($D+=180),180<$D?$D-=360:$D<-180&&($D+=360),$m.transform.skX=$m.transform.skY=$m.transform.skX+$D*$P,$m.update();},$m.updatePos=function($m,$p){this._sp&&this._sp.pos($m,$p);},$m._applyIk2=function($m,$p,$h,$P,$L,$q){if(0!=$q){var $k=$m.resultTransform.x,$Y=$m.resultTransform.y,$d=$m.transform.scX,$K=$m.transform.scY,$D=$p.transform.scX,$F=0,$R=0,$$=0;$$=$d<0?($d=-$d,$F=180,-1):($F=0,1),$K<0&&($K=-$K,$$=-$$),$R=$D<0?($D=-$D,180):0;var $A=$p.resultTransform.x,$B=NaN,$n=NaN,$c=NaN,$e=$m.resultMatrix.a,$a=$m.resultMatrix.c,$Z=$m.resultMatrix.b,$H=$m.resultMatrix.d,$W=Math.abs($d-$K)<=1e-4;$c=$W?($n=$e*$A+$a*($B=$p.resultTransform.y)+$m.resultMatrix.tx,$Z*$A+$H*$B+$m.resultMatrix.ty):($B=0,$n=$e*$A+$m.resultMatrix.tx,$Z*$A+$m.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $qm(),$Lm.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($h,$P,15,"#ffff00"),this._sp.graphics.drawCircle($n,$c,15,"#ff00ff")),$m.setRotation(Math.atan2($c-$m.resultMatrix.ty,$n-$m.resultMatrix.tx));var $E=$m.parentBone;$e=$E.resultMatrix.a,$a=$E.resultMatrix.c,$Z=$E.resultMatrix.b;var $I=1/($e*($H=$E.resultMatrix.d)-$a*$Z),$b=$h-$E.resultMatrix.tx,$T=$P-$E.resultMatrix.ty,$j=($b*$H-$T*$a)*$I-$k,$x=($T*$e-$b*$Z)*$I-$Y,$Q=(($b=$n-$E.resultMatrix.tx)*$H-($T=$c-$E.resultMatrix.ty)*$a)*$I-$k,$M=($T*$e-$b*$Z)*$I-$Y,$u=Math.sqrt($Q*$Q+$M*$M),$N=$p.length*$D,$S=NaN,$_=NaN;if($W){var $l=($j*$j+$x*$x-$u*$u-($N*=$d)*$N)/(2*$u*$N);$l<-1?$l=-1:1<$l&&($l=1),$_=Math.acos($l)*$L,$e=$u+$N*$l,$a=$N*Math.sin($_),$S=Math.atan2($x*$e-$j*$a,$j*$e+$x*$a);}else{var $J=($e=$d*$N)*$e,$z=($a=$K*$N)*$a,$w=$j*$j+$x*$x,$X=Math.atan2($x,$j),$s=-2*$z*$u,$G=$z-$J;if(0<($H=$s*$s-4*$G*($Z=$z*$u*$u+$J*$w-$J*$z))){var $U=Math.sqrt($H);$s<0&&($U=-$U);var $r=($U=-($s+$U)/2)/$G,$y=$Z/$U,$V=Math.abs($r)<Math.abs($y)?$r:$y;$V*$V<=$w&&($T=Math.sqrt($w-$V*$V)*$L,$S=$X-Math.atan2($T,$V),$_=Math.atan2($T/$K,($V-$u)/$d));}var $o=0,$f=Number.MAX_VALUE,$i=0,$v=0,$g=0,$t=0,$O=0,$C=0;$t<($H=($b=$u+$e)*$b)&&($g=0,$t=$H,$O=$b),($H=($b=$u-$e)*$b)<$f&&($o=Math.PI,$f=$H,$i=$b);var $mm=Math.acos(-$e*$u/($J-$z));($H=($b=$e*Math.cos($mm)+$u)*$b+($T=$a*Math.sin($mm))*$T)<$f&&($o=$mm,$f=$H,$i=$b,$v=$T),$t<$H&&($g=$mm,$t=$H,$O=$b,$C=$T),$_=$w<=($f+$t)/2?($S=$X-Math.atan2($v*$L,$i),$o*$L):($S=$X-Math.atan2($C*$L,$O),$g*$L);}var $pm=Math.atan2($B,$A)*$$,$hm=$m.resultTransform.skX;180<($S=($S-$pm)*$Pm.radDeg+$F-$hm)?$S-=360:$S<-180&&($S+=360),$m.resultTransform.x=$k,$m.resultTransform.y=$Y,$m.resultTransform.skX=$m.resultTransform.skY=$hm+$S*$q,$hm=$p.resultTransform.skX,180<($_=(($_+$pm)*$Pm.radDeg-0)*$$+$R-($hm%=360))?$_-=360:$_<-180&&($_+=360),$p.resultTransform.x=$A,$p.resultTransform.y=$B,$p.resultTransform.skX=$p.resultTransform.skY=$p.resultTransform.skY+$_*$q,$m.update();}},$m._applyIk3=function($m,$p,$h,$P,$L,$q){if(0!=$q){var $k,$Y,$d=$p.resultMatrix.a*$p.length,$K=$p.resultMatrix.b*$p.length,$D=$d*$d+$K*$K,$F=Math.sqrt($D),$R=$m.resultMatrix.tx,$$=$m.resultMatrix.ty,$A=$p.resultMatrix.tx,$B=$p.resultMatrix.ty,$n=$A-$R,$c=$B-$$,$e=$n*$n+$c*$c,$a=Math.sqrt($e),$Z=($n=$h-$m.resultMatrix.tx)*$n+($c=$P-$m.resultMatrix.ty)*$c,$H=Math.sqrt($Z);if($F+$a<=$H||$H+$F<=$a||$H+$a<=$F){var $W=NaN;$A=$R+($W=$F+$a<=$H?1:-1)*($h-$R)*$a/$H,$B=$$+$W*($P-$$)*$a/$H;}else{var $E=($e-$D+$Z)/(2*$Z),$I=Math.sqrt($e-$E*$E*$Z)/$H,$b=$R+$n*$E,$T=$$+$c*$E,$j=-$c*$I,$x=$n*$I;$B=0<$L?($A=$b-$j,$T-$x):($A=$b+$j,$T+$x);}$k=$A,$Y=$B,this.isDebug&&(this._sp||(this._sp=new $qm(),$Lm.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($R,$$,15,"#ff00ff"),this._sp.graphics.drawCircle($h,$P,15,"#ffff00"),this._sp.graphics.drawCircle($k,$Y,15,"#ff00ff"));var $Q,$M;$Q=Math.atan2($Y-$m.resultMatrix.ty,$k-$m.resultMatrix.tx),$m.setRotation($Q),($M=$Pm._tempMatrix).identity(),$M.rotate($Q),$M.scale($m.resultMatrix.getScaleX(),$m.resultMatrix.getScaleY()),$M.translate($m.resultMatrix.tx,$m.resultMatrix.ty),$M.copyTo($m.resultMatrix),$m.updateChild();var $u,$N;$u=Math.atan2($P-$Y,$h-$k),$p.setRotation($u),($N=$Pm._tempMatrix).identity(),$N.rotate($u),$N.scale($p.resultMatrix.getScaleX(),$p.resultMatrix.getScaleY()),$N.translate($k,$Y),$M.copyTo($p.resultMatrix),$p.updateChild();}},$h($Pm,["radDeg",function(){return this.radDeg=180/Math.PI;},"degRad",function(){return this.degRad=Math.PI/180;},"_tempMatrix",function(){return this._tempMatrix=new $Mm();}]),$Pm;}(),$Xm=function(){function $m(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[];}return $P($m,"laya.ani.bone.IkConstraintData"),$m;}(),$H=function(){function $N($m,$p){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$m,this.position=$m.position,this.spacing=$m.spacing,this.rotateMix=$m.rotateMix,this.translateMix=$m.translateMix,this.bones=[];for(var $h=this.data.bones,$P=0,$L=$h.length;$P<$L;$P++)this.bones.push($p[$h[$P]]);}$P($N,"laya.ani.bone.PathConstraint");var $m=$N.prototype;return $m.apply=function($m,$p){if(this.target){var $h=this.translateMix,$P=this.translateMix,$L=0<$P,$q=this.data.spacingMode,$k="length"==$q,$Y=this.data.rotateMode,$d="tangent"==$Y,$K="chainScale"==$Y,$D=[],$F=this.bones.length,$R=$d?$F:$F+1,$$=[];(this._spaces=$$)[0]=this.position;var $A=this.spacing;if($K||$k)for(var $B=0,$n=$R-1;$B<$n;){var $c=this.bones[$B],$e=$c.length,$a=$e*$c.resultMatrix.a,$Z=$e*$c.resultMatrix.b;$e=Math.sqrt($a*$a+$Z*$Z),$K&&($D[$B]=$e),$$[++$B]=$k?Math.max(0,$e+$A):$A;}else for($B=1;$B<$R;$B++)$$[$B]=$A;var $H=this.computeWorldPositions(this.target,$m,$p,$R,$d,"percent"==this.data.positionMode,"percent"==$q);if(this._debugKey){for($B=0;$B<$H.length;$B++)$p.drawCircle($H[$B++],$H[$B++],5,"#00ff00");var $W=[];for($B=0;$B<$H.length;$B++)$W.push($H[$B++],$H[$B++]);$p.drawLines(0,0,$W,"#ff0000");}var $E=$H[0],$I=$H[1],$b=this.data.offsetRotation,$T="chain"==$Y&&0==$b,$j=NaN;for($B=0,$j=3;$B<$F;$B++,$j+=3){($c=this.bones[$B]).resultMatrix.tx+=($E-$c.resultMatrix.tx)*$h,$c.resultMatrix.ty+=($I-$c.resultMatrix.ty)*$h;var $x=($a=$H[$j])-$E,$Q=($Z=$H[$j+1])-$I;if($K&&0!=($e=$D[$B])){var $M=(Math.sqrt($x*$x+$Q*$Q)/$e-1)*$P+1;$c.resultMatrix.a*=$M,$c.resultMatrix.c*=$M;}if($E=$a,$I=$Z,$L){var $u=$c.resultMatrix.a,$N=$c.resultMatrix.c,$S=$c.resultMatrix.b,$_=$c.resultMatrix.d,$l=NaN,$J=NaN,$z=NaN;$l=$d?$H[$j-1]:0==$$[$B+1]?$H[$j+2]:Math.atan2($Q,$x),$l-=Math.atan2($S,$u)-$b/180*Math.PI,$T&&($J=Math.cos($l),$z=Math.sin($l),$E+=(($e=$c.length)*($J*$u-$z*$S)-$x)*$P,$I+=($e*($z*$u+$J*$S)-$Q)*$P),$l>Math.PI?$l-=2*Math.PI:$l<-Math.PI&&($l+=2*Math.PI),$l*=$P,$J=Math.cos($l),$z=Math.sin($l),$c.resultMatrix.a=$J*$u-$z*$S,$c.resultMatrix.c=$J*$N-$z*$_,$c.resultMatrix.b=$z*$u+$J*$S,$c.resultMatrix.d=$z*$N+$J*$_;}}}},$m.computeWorldVertices2=function($m,$p,$h,$P,$L,$q){var $k,$Y,$d=$m.currDisplayData.bones,$K=$m.currDisplayData.weights,$D=$m.currDisplayData.triangles,$F=0,$R=0,$$=0,$A=0,$B=0,$n=0,$c=0,$e=0,$a=0,$Z=0,$H=0;if(null!=$d){for($F=0;$F<$h;$F+=2)$R+=($A=$d[$R])+1,$$+=$A;var $W=$p;for($B=$q,$n=3*$$;$B<$P;$B+=2){for($e=$c=0,$A=$d[$R++],$A+=$R;$R<$A;$R++,$n+=3){$k=$W[$d[$R]].resultMatrix,$a=$K[$n],$Z=$K[$n+1];var $E=$K[$n+2];$c+=($a*$k.a+$Z*$k.c+$k.tx)*$E,$e+=($a*$k.b+$Z*$k.d+$k.ty)*$E;}$L[$B]=$c,$L[$B+1]=$e;}}else{var $I,$b;if($D||($D=$K),$m.deformData&&($D=$m.deformData),$I=$m.parent,$p)for($H=$p.length,$F=0;$F<$H;$F++)if($p[$F].name==$I){$Y=$p[$F];break;}$Y&&($b=$Y.resultMatrix),$b||($b=$N._tempMt);var $T=$b.tx,$j=$b.ty,$x=$b.a,$Q=$b.b,$M=$b.c,$u=$b.d;for($Y&&($u*=$Y.d),$R=$h,$B=$q;$B<$P;$R+=2,$B+=2)$a=$D[$R],$Z=$D[$R+1],$L[$B]=$a*$x+$Z*$Q+$T,$L[$B+1]=-($a*$M+$Z*$u+$j);}},$m.computeWorldPositions=function($m,$p,$h,$P,$L,$q,$k){$m.currDisplayData.bones,$m.currDisplayData.weights,$m.currDisplayData.triangles;var $Y=[],$d=0,$K=$m.currDisplayData.verLen,$D=this.position,$F=this._spaces,$R=[],$$=[],$A=$K/6,$B=-1,$n=NaN,$c=0,$e=0,$a=NaN,$Z=NaN,$H=NaN,$W=NaN;if($A--,$K-=4,this.computeWorldVertices2($m,$p,2,$K,$Y,0),this._debugKey)for($d=0;$d<$Y.length;)$h.drawCircle($Y[$d++],$Y[$d++],10,"#ff0000");$R=$Y,this._curves.length=$A;var $E=this._curves,$I=$R[$n=0],$b=$R[1],$T=0,$j=0,$x=0,$Q=0,$M=0,$u=0,$N=NaN,$S=NaN,$_=NaN,$l=NaN,$J=NaN,$z=NaN,$w=NaN,$X=NaN,$s=0;for($d=0,$s=2;$d<$A;$d++,$s+=6)$T=$R[$s],$j=$R[$s+1],$x=$R[$s+2],$Q=$R[$s+3],$J=2*($N=.1875*($I-2*$T+$x))+($_=.09375*(3*($T-$x)-$I+($M=$R[$s+4]))),$z=2*($S=.1875*($b-2*$j+$Q))+($l=.09375*(3*($j-$Q)-$b+($u=$R[$s+5]))),$w=.75*($T-$I)+$N+.16666667*$_,$X=.75*($j-$b)+$S+.16666667*$l,$n+=Math.sqrt($w*$w+$X*$X),$w+=$J,$X+=$z,$J+=$_,$z+=$l,$n+=Math.sqrt($w*$w+$X*$X),$w+=$J,$X+=$z,$n+=Math.sqrt($w*$w+$X*$X),$w+=$J+$_,$X+=$z+$l,$n+=Math.sqrt($w*$w+$X*$X),$E[$d]=$n,$I=$M,$b=$u;if($q&&($D*=$n),$k)for($d=0;$d<$P;$d++)$F[$d]*=$n;var $G=this._segments,$U=0,$r=0;for($r=$e=$c=$d=0;$d<$P;$d++,$c+=3)if(($a=$D+=$Z=$F[$d])<0)this.addBeforePosition($a,$R,0,$$,$c);else if($n<$a)this.addAfterPosition($a-$n,$R,$K-4,$$,$c);else{for(;;$e++)if(!(($W=$E[$e])<$a)){0==$e?$a/=$W:$a=($a-($H=$E[$e-1]))/($W-$H);break;}if($e!=$B){var $y=6*($B=$e);for($I=$R[$y],$b=$R[$y+1],$T=$R[$y+2],$j=$R[$y+3],$x=$R[$y+4],$Q=$R[$y+5],$J=2*($N=.03*($I-2*$T+$x))+($_=.006*(3*($T-$x)-$I+($M=$R[$y+6]))),$z=2*($S=.03*($b-2*$j+$Q))+($l=.006*(3*($j-$Q)-$b+($u=$R[$y+7]))),$w=.3*($T-$I)+$N+.16666667*$_,$X=.3*($j-$b)+$S+.16666667*$l,$U=Math.sqrt($w*$w+$X*$X),$G[0]=$U,$y=1;$y<8;$y++)$w+=$J,$X+=$z,$J+=$_,$z+=$l,$U+=Math.sqrt($w*$w+$X*$X),$G[$y]=$U;$w+=$J,$X+=$z,$U+=Math.sqrt($w*$w+$X*$X),$G[8]=$U,$w+=$J+$_,$X+=$z+$l,$U+=Math.sqrt($w*$w+$X*$X),$G[9]=$U,$r=0;}for($a*=$U;;$r++)if(!(($W=$G[$r])<$a)){0==$r?$a/=$W:$a=$r+($a-($H=$G[$r-1]))/($W-$H);break;}this.addCurvePosition(.1*$a,$I,$b,$T,$j,$x,$Q,$M,$u,$$,$c,$L||0<$d&&0==$Z);}return $$;},$m.addBeforePosition=function($m,$p,$h,$P,$L){var $q=$p[$h],$k=$p[$h+1],$Y=$p[$h+2]-$q,$d=$p[$h+3]-$k,$K=Math.atan2($d,$Y);$P[$L]=$q+$m*Math.cos($K),$P[$L+1]=$k+$m*Math.sin($K),$P[$L+2]=$K;},$m.addAfterPosition=function($m,$p,$h,$P,$L){var $q=$p[$h+2],$k=$p[$h+3],$Y=$q-$p[$h],$d=$k-$p[$h+1],$K=Math.atan2($d,$Y);$P[$L]=$q+$m*Math.cos($K),$P[$L+1]=$k+$m*Math.sin($K),$P[$L+2]=$K;},$m.addCurvePosition=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D,$F){0==$m&&($m=1e-4);var $R=$m*$m,$$=$R*$m,$A=1-$m,$B=$A*$A,$n=$B*$A,$c=$A*$m,$e=3*$c,$a=$A*$e,$Z=$e*$m,$H=$p*$n+$P*$a+$q*$Z+$Y*$$,$W=$h*$n+$L*$a+$k*$Z+$d*$$;$K[$D]=$H,$K[$D+1]=$W,$K[$D+2]=$F?Math.atan2($W-($h*$B+$L*$c*2+$k*$R),$H-($p*$B+$P*$c*2+$q*$R)):0;},$N.NONE=-1,$N.BEFORE=-2,$N.AFTER=-3,$h($N,["_tempMt",function(){return this._tempMt=new $Mm();}]),$N;}(),$sm=function(){function $m(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[];}return $P($m,"laya.ani.bone.PathConstraintData"),$m;}(),$Gm=function(){function $m(){this.name=null,this.slotArr=[];}return $P($m,"laya.ani.bone.SkinData"),$m;}(),$Um=function(){function $m(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0;}$P($m,"laya.ani.bone.SkinSlotDisplayData");var $p=$m.prototype;return $p.createTexture=function($m){return this.texture||(this.texture=new $um($m.bitmap,this.uvs),$m.bitmap.alphaTexture&&(this.texture.alphaTexture=new $um($m.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$m.height,this.texture.height=$m.width,this.texture.offsetX=-$m.offsetX,this.texture.offsetY=-$m.offsetY,this.texture.sourceWidth=$m.sourceHeight,this.texture.sourceHeight=$m.sourceWidth):(this.texture.width=$m.width,this.texture.height=$m.height,this.texture.offsetX=-$m.offsetX,this.texture.offsetY=-$m.offsetY,this.texture.sourceWidth=$m.sourceWidth,this.texture.sourceHeight=$m.sourceHeight),$n.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture;},$p.destory=function(){this.texture&&this.texture.destroy();},$m;}(),$rm=function(){function $m(){this.name=null,this.displayArr=[];}return $P($m,"laya.ani.bone.SlotData"),$m.prototype.getDisplayByName=function($m){for(var $p=0,$h=this.displayArr.length;$p<$h;$p++)if(this.displayArr[$p].attachmentName==$m)return $p;return-1;},$m;}(),$W=function(){function $m($m,$p){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$B(2,0),this._data=$m,null==this._bones&&(this._bones=[]),this.target=$p[$m.targetIndex];var $h,$P=0;for($P=0,$h=$m.boneIndexs.length;$P<$h;$P++)this._bones.push($p[$m.boneIndexs[$P]]);this.rotateMix=$m.rotateMix,this.translateMix=$m.translateMix,this.scaleMix=$m.scaleMix,this.shearMix=$m.shearMix;}return $P($m,"laya.ani.bone.TfConstraint"),$m.prototype.apply=function(){for(var $m,$p=this.target.resultMatrix.a,$h=this.target.resultMatrix.b,$P=this.target.resultMatrix.c,$L=this.target.resultMatrix.d,$q=0,$k=this._bones.length;$q<$k;$q++){if($m=this._bones[$q],0<this.rotateMix){var $Y=$m.resultMatrix.a,$d=$m.resultMatrix.b,$K=$m.resultMatrix.c,$D=$m.resultMatrix.d,$F=Math.atan2($P,$p)-Math.atan2($K,$Y)+this._data.offsetRotation*Math.PI/180;$F>Math.PI?$F-=2*Math.PI:$F<-Math.PI&&($F+=2*Math.PI),$F*=this.rotateMix;var $R=Math.cos($F),$$=Math.sin($F);$m.resultMatrix.a=$R*$Y-$$*$K,$m.resultMatrix.b=$R*$d-$$*$D,$m.resultMatrix.c=$$*$Y+$R*$K,$m.resultMatrix.d=$$*$d+$R*$D;}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$m.resultMatrix.tx+=(this._temp[0]-$m.resultMatrix.tx)*this.translateMix,$m.resultMatrix.ty+=(this._temp[1]-$m.resultMatrix.ty)*this.translateMix,$m.updateChild()),0<this.scaleMix){var $A=Math.sqrt($m.resultMatrix.a*$m.resultMatrix.a+$m.resultMatrix.c*$m.resultMatrix.c),$B=Math.sqrt($p*$p+$P*$P),$n=1e-5<$A?($A+($B-$A+this._data.offsetScaleX)*this.scaleMix)/$A:0;$m.resultMatrix.a*=$n,$m.resultMatrix.c*=$n,$A=Math.sqrt($m.resultMatrix.b*$m.resultMatrix.b+$m.resultMatrix.d*$m.resultMatrix.d),$B=Math.sqrt($h*$h+$L*$L),$n=1e-5<$A?($A+($B-$A+this._data.offsetScaleY)*this.scaleMix)/$A:0,$m.resultMatrix.b*=$n,$m.resultMatrix.d*=$n;}if(0<this.shearMix){$d=$m.resultMatrix.b,$D=$m.resultMatrix.d;var $c=Math.atan2($D,$d);($F=Math.atan2($L,$h)-Math.atan2($P,$p)-($c-Math.atan2($m.resultMatrix.c,$m.resultMatrix.a)))>Math.PI?$F-=2*Math.PI:$F<-Math.PI&&($F+=2*Math.PI),$F=$c+($F+this._data.offsetShearY*Math.PI/180)*this.shearMix,$n=Math.sqrt($d*$d+$D*$D),$m.resultMatrix.b=Math.cos($F)*$n,$m.resultMatrix.d=Math.sin($F)*$n;}}},$m;}(),$ym=function(){function $m(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[];}return $P($m,"laya.ani.bone.TfConstraintData"),$m;}(),$Vm=function(){function $m(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null;}$P($m,"laya.ani.bone.Transform");var $p=$m.prototype;return $p.initData=function($m){null!=$m.x&&(this.x=$m.x),null!=$m.y&&(this.y=$m.y),null!=$m.skX&&(this.skX=$m.skX),null!=$m.skY&&(this.skY=$m.skY),null!=$m.scX&&(this.scX=$m.scX),null!=$m.scY&&(this.scY=$m.scY);},$p.getMatrix=function(){var $m;return($m=this.mMatrix?this.mMatrix:this.mMatrix=new $Mm()).identity(),$m.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($m,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$m.rotate(this.skX*Math.PI/180),$m.translate(this.x,this.y),$m;},$p.skew=function($m,$p,$h){var $P=Math.sin($h),$L=Math.cos($h),$q=Math.sin($p),$k=Math.cos($p);return $m.setTo($m.a*$k-$m.b*$P,$m.a*$q+$m.b*$L,$m.c*$k-$m.d*$P,$m.c*$q+$m.d*$L,$m.tx*$k-$m.ty*$P,$m.tx*$q+$m.ty*$L),$m;},$m;}(),$E=function(){function $m(){}return $P($m,"laya.ani.bone.UVTools"),$m.getRelativeUV=function($m,$p,$h){var $P=$m[0],$L=$m[2]-$m[0],$q=$m[1],$k=$m[5]-$m[1];$h||($h=[]),$h.length=$p.length;var $Y,$d=0;$Y=$h.length;var $K=1/$L,$D=1/$k;for($d=0;$d<$Y;$d+=2)$h[$d]=($p[$d]-$P)*$K,$h[$d+1]=($p[$d+1]-$q)*$D;return $h;},$m.getAbsoluteUV=function($m,$p,$h){if(0==$m[0]&&0==$m[1]&&1==$m[4]&&1==$m[5])return $h?($c.copyArray($h,$p),$h):$p;var $P=$m[0],$L=$m[2]-$m[0],$q=$m[1],$k=$m[5]-$m[1];$h||($h=[]),$h.length=$p.length;var $Y,$d=0;for($Y=$h.length,$d=0;$d<$Y;$d+=2)$h[$d]=$p[$d]*$L+$P,$h[$d+1]=$p[$d+1]*$k+$q;return $h;},$m;}(),$N=function(){function $m(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null;}return $P($m,"laya.ani.KeyFramesContent"),$m;}(),$I=function(){function $D(){}return $P($D,"laya.ani.math.BezierLerp"),$D.getBezierRate=function($m,$p,$h,$P,$L){var $q=$D._getBezierParamKey($p,$h,$P,$L),$k=100*$q+$m;if($D._bezierResultCache[$k])return $D._bezierResultCache[$k];var $Y,$d=$D._getBezierPoints($p,$h,$P,$L,$q),$K=0;for($Y=$d.length,$K=0;$K<$Y;$K+=2)if($m<=$d[$K])return $D._bezierResultCache[$k]=$d[$K+1],$d[$K+1];return $D._bezierResultCache[$k]=1;},$D._getBezierParamKey=function($m,$p,$h,$P){return 100*(100*(100*(100*$m+$p)+$h)+$P);},$D._getBezierPoints=function($m,$p,$h,$P,$L){return $D._bezierPointsCache[$L]?$D._bezierPointsCache[$L]:($q=[0,0,$m,$p,$h,$P,1,1],$k=new $Y().getBezierPoints($q,100,3),$D._bezierPointsCache[$L]=$k);var $q,$k;},$D._bezierResultCache={},$D._bezierPointsCache={},$D;}(),$b=function($m){function $p(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$p.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1;}$P($p,"laya.ani.AnimationPlayer",$L);var $h=$p.prototype;return $Lm.imps($h,{"laya.resource.IDestroy":!0}),$h._onTempletLoadedComputeFullKeyframeIndices=function($m,$p,$h){this._templet===$h&&this._cachePlayRate===$m&&this._cacheFrameRate===$p&&this._computeFullKeyframeIndices();},$h._computeFullKeyframeIndices=function(){for(var $m=this._fullFrames=[],$p=this._templet,$h=this._cacheFrameRateInterval*this._cachePlayRate,$P=0,$L=$p.getAnimationCount();$P<$L;$P++){for(var $q=[],$k=0,$Y=$p.getAnimation($P).nodes.length;$k<$Y;$k++){for(var $d=$p.getAnimation($P).nodes[$k],$K=Math.floor($d.playTime/$h+.01),$D=new Uint16Array($K+1),$F=-1,$R=0,$$=$d.keyFrame.length;$R<$$;$R++){var $A=$d.keyFrame[$R],$B=$A.startTime,$n=$B+$A.duration+$h;do{for(var $c=Math.floor($B/$h+.5),$e=$F+1;$e<$c;$e++)$D[$e]=$R;$D[$F=$c]=$R,$B+=$h;}while($B<=$n);}$q.push($D);}$m.push($q);}},$h._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration();},$h._calculatePlayDuration=function(){if(0!==this.state){var $m=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$m),this._playEnd>$m&&(this._playEnd=$m),this._playDuration=this._playEnd-this._playStart;}},$h._setPlayParams=function($m,$p){this._currentTime=$m,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$p+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$p;},$h._setPlayParamsWhenStop=function($m,$p){this._currentTime=$m,this._currentKeyframeIndex=Math.max(Math.floor($m/$p+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$p,this._currentAnimationClipIndex=-1;},$h._update=function($m){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $p=this._cacheFrameRateInterval*this._cachePlayRate,$h=0;this._startUpdateLoopCount!==$A.loopCount&&($h=$m*this.playbackRate,this._elapsedPlaybackTime+=$h);var $P=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$P)return this._setPlayParamsWhenStop($P,$p),void this.event("stopped");if($h+=this._currentTime,0<$P){if($P<=$h)do{if($h-=$P,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($P,$p),this._stopWhenCircleFinish=!1,void this.event("stopped");$h<$P&&(this._setPlayParams($h,$p),this.event("complete"));}while($P<=$h);else this._setPlayParams($h,$p);}else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($P,$p),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete");}}},$h._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0;},$h.play=function($m,$p,$h,$P,$L){if(void 0===$m&&($m=0),void 0===$p&&($p=1),void 0===$h&&($h=2147483647),void 0===$P&&($P=0),void 0===$L&&($L=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($h<0||$P<0||$L<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$L&&$L<$P)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$p,this._overallDuration=$h,this._playStart=$P,this._playEnd=$L,this._paused=!1,this._currentAnimationClipIndex=$m,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$A.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0);},$h.playByFrame=function($m,$p,$h,$P,$L,$q){void 0===$m&&($m=0),void 0===$p&&($p=1),void 0===$h&&($h=2147483647),void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$q&&($q=30);var $k=1e3/$q;this.play($m,$p,$h,$P*$k,$L*$k);},$h.stop=function($m){void 0===$m&&($m=!0),$m?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0;},$q(0,$h,"playEnd",function(){return this._playEnd;}),$q(0,$h,"templet",function(){return this._templet;},function($m){0===!this.state&&this.stop(!0),this._templet!==$m&&((this._templet=$m).loaded?this._computeFullKeyframeIndices():$m.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]));}),$q(0,$h,"playStart",function(){return this._playStart;}),$q(0,$h,"playDuration",function(){return this._playDuration;}),$q(0,$h,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2;}),$q(0,$h,"currentKeyframeIndex",function(){return this._currentKeyframeIndex;}),$q(0,$h,"overallDuration",function(){return this._overallDuration;}),$q(0,$h,"currentFrameTime",function(){return this._currentFrameTime;}),$q(0,$h,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex;}),$q(0,$h,"currentPlayTime",function(){return this._currentTime+this._playStart;}),$q(0,$h,"cachePlayRate",function(){return this._cachePlayRate;},function($m){this._cachePlayRate!==$m&&(this._cachePlayRate=$m,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$m,this._cacheFrameRate])));}),$q(0,$h,"cacheFrameRate",function(){return this._cacheFrameRate;},function($m){this._cacheFrameRate!==$m&&(this._cacheFrameRate=$m,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$m])));}),$q(0,$h,"currentTime",null,function($m){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($m<this._playStart||$m>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$A.loopCount;var $p=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$m,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$p),0),this._currentFrameTime=this._currentKeyframeIndex*$p;}}),$q(0,$h,"paused",function(){return this._paused;},function($m){(this._paused=$m)&&this.event("paused");}),$q(0,$h,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval;}),$q(0,$h,"destroyed",function(){return this._destroyed;}),$p;}(),$S=function($m){function $p(){$p.__super.call(this),$n.isConchNode&&(this.drawSkin=function($m){$m.transform||($m.transform=$Mm.EMPTY),this._addCmd([$m]),this.setSkinMesh&&this.setSkinMesh($m._ps,$m.mVBData,$m.mEleNum,0,$m.mTexture,$m.transform);});}return $P($p,"laya.ani.GraphicsAni",$k),$p.prototype.drawSkin=function($m){var $p=[$m];this._saveToCmd($n._context._drawSkin,$p);},$p.create=function(){return $p._caches.pop()||new $p();},$p.recycle=function($m){$m.clear(),$p._caches.push($m);},$p._caches=[],$p;}(),$_=function($m){function $e(){this._aniMap={},this.unfixedLastAniIndex=-1,$e.__super.call(this),this._anis=new Array();}$P($e,"laya.ani.AnimationTemplet",$D);var $p=$e.prototype;return $p.parse=function($m){var $p=new $Qm($m);this._aniVersion=$p.readUTFString(),$a.parse(this,$p);},$p._calculateKeyFrame=function($m,$p,$h){var $P=$m.keyFrame;$P[$p]=$P[0];for(var $L=0;$L<$p;$L++){var $q=$P[$L];$q.nextData=0===$q.duration?$q.data:$P[$L+1].data;}$P.length--;},$p.onAsynLoaded=function($m,$p,$h){var $P=new $Qm($p);switch(this._aniVersion=$P.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$Z.parse(this,$P);break;default:$a.parse(this,$P);}this._endLoaded();},$p.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null;},$p.getAnimationCount=function(){return this._anis.length;},$p.getAnimation=function($m){return this._anis[$m];},$p.getAniDuration=function($m){return this._anis[$m].playTime;},$p.getNodes=function($m){return this._anis[$m].nodes;},$p.getNodeIndexWithName=function($m,$p){return this._anis[$m].bone3DMap[$p];},$p.getNodeCount=function($m){return this._anis[$m].nodes.length;},$p.getTotalkeyframesLength=function($m){return this._anis[$m].totalKeyframeDatasLength;},$p.getPublicExtData=function(){return this._publicExtData;},$p.getAnimationDataWithCache=function($m,$p,$h,$P){var $L=$p[$h];if($L){var $q=$L[$m];return $q?$q[$P]:null;}return null;},$p.setAnimationDataWithCache=function($m,$p,$h,$P,$L){var $q=$p[$h]||($p[$h]={});($q[$m]||($q[$m]=[]))[$P]=$L;},$p.getOriginalData=function($m,$p,$h,$P,$L){for(var $q=this._anis[$m].nodes,$k=0,$Y=0,$d=$q.length,$K=0;$Y<$d;$Y++){var $D,$F=$q[$Y];$D=$F.keyFrame[$h[$Y][$P]],$F.dataOffset=$K;var $R=$L-$D.startTime,$$=$F.lerpType;if($$)switch($$){case 0:case 1:for($k=0;$k<$F.keyframeWidth;)$k+=$F.interpolationMethod[$k]($F,$k,$p,$K+$k,$D.data,$R,null,$D.duration,$D.nextData);break;case 2:var $A=$D.interpolationData,$B=$A.length,$n=0;for($k=0;$k<$B;){var $c=$A[$k];switch($c){case 6:case 7:$k+=$e.interpolation[$c]($F,$n,$p,$K+$n,$D.data,$R,null,$D.duration,$D.nextData,$A,$k+1);break;default:$k+=$e.interpolation[$c]($F,$n,$p,$K+$n,$D.data,$R,null,$D.duration,$D.nextData);}$n++;}}else for($k=0;$k<$F.keyframeWidth;)$k+=$F.interpolationMethod[$k]($F,$k,$p,$K+$k,$D.data,$R,null,$D.duration,$D.nextData);$K+=$F.keyframeWidth;}},$p.getNodesCurrentFrameIndex=function($m,$p){var $h=this._anis[$m].nodes;$m!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($h.length),this.unfixedCurrentTimes=new Float32Array($h.length),this.unfixedLastAniIndex=$m);for(var $P=0,$L=$h.length;$P<$L;$P++){var $q=$h[$P];for($p<this.unfixedCurrentTimes[$P]&&(this.unfixedCurrentFrameIndexes[$P]=0),this.unfixedCurrentTimes[$P]=$p;this.unfixedCurrentFrameIndexes[$P]<$q.keyFrame.length&&!($q.keyFrame[this.unfixedCurrentFrameIndexes[$P]].startTime>this.unfixedCurrentTimes[$P]);)this.unfixedCurrentFrameIndexes[$P]++;this.unfixedCurrentFrameIndexes[$P]--;}return this.unfixedCurrentFrameIndexes;},$p.getOriginalDataUnfixedRate=function($m,$p,$h){var $P=this._anis[$m].nodes;$m!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($P.length),this.unfixedCurrentTimes=new Float32Array($P.length),this.unfixedKeyframes=$B($P.length),this.unfixedLastAniIndex=$m);for(var $L=0,$q=0,$k=$P.length,$Y=0;$q<$k;$q++){var $d=$P[$q];for($h<this.unfixedCurrentTimes[$q]&&(this.unfixedCurrentFrameIndexes[$q]=0),this.unfixedCurrentTimes[$q]=$h;this.unfixedCurrentFrameIndexes[$q]<$d.keyFrame.length&&!($d.keyFrame[this.unfixedCurrentFrameIndexes[$q]].startTime>this.unfixedCurrentTimes[$q]);)this.unfixedKeyframes[$q]=$d.keyFrame[this.unfixedCurrentFrameIndexes[$q]],this.unfixedCurrentFrameIndexes[$q]++;var $K=this.unfixedKeyframes[$q];$d.dataOffset=$Y;var $D=$h-$K.startTime;if($d.lerpType)switch($d.lerpType){case 0:case 1:for($L=0;$L<$d.keyframeWidth;)$L+=$d.interpolationMethod[$L]($d,$L,$p,$Y+$L,$K.data,$D,null,$K.duration,$K.nextData);break;case 2:var $F=$K.interpolationData,$R=$F.length,$$=0;for($L=0;$L<$R;){var $A=$F[$L];switch($A){case 6:case 7:$L+=$e.interpolation[$A]($d,$$,$p,$Y+$$,$K.data,$D,null,$K.duration,$K.nextData,$F,$L+1);break;default:$L+=$e.interpolation[$A]($d,$$,$p,$Y+$$,$K.data,$D,null,$K.duration,$K.nextData);}$$++;}}else for($L=0;$L<$d.keyframeWidth;)$L+=$d.interpolationMethod[$L]($d,$L,$p,$Y+$L,$K.data,$D,null,$K.duration,$K.nextData);$Y+=$d.keyframeWidth;}},$e._LinearInterpolation_0=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){var $D=0===$Y?0:$q/$Y;return $h[$P]=(1-$D)*$L[$p]+$D*$d[$p],1;},$e._QuaternionInterpolation_1=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){var $D=0===$Y?0:$q/$Y;return $R.slerpQuaternionArray($L,$p,$d,$p,$D,$h,$P),4;},$e._AngleInterpolation_2=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){return 0;},$e._RadiansInterpolation_3=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){return 0;},$e._Matrix4x4Interpolation_4=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){for(var $D=0;$D<16;$D++,$p++)$h[$P+$D]=$L[$p]+$q*$k[$p];return 16;},$e._NoInterpolation_5=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K){return $h[$P]=$L[$p],1;},$e._BezierInterpolation_6=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D){return void 0===$D&&($D=0),$h[$P]=$L[$p]+($d[$p]-$L[$p])*$I.getBezierRate($q/$Y,$K[$D],$K[$D+1],$K[$D+2],$K[$D+3]),5;},$e._BezierInterpolation_7=function($m,$p,$h,$P,$L,$q,$k,$Y,$d,$K,$D){return void 0===$D&&($D=0),$h[$P]=$K[$D+4]+$K[$D+5]*$I.getBezierRate((.001*$q+$K[$D+6])/$K[$D+7],$K[$D],$K[$D+1],$K[$D+2],$K[$D+3]),9;},$e.load=function($m){return $Lm.loader.create($m,null,null,$e);},$e.interpolation=[$e._LinearInterpolation_0,$e._QuaternionInterpolation_1,$e._AngleInterpolation_2,$e._RadiansInterpolation_3,$e._Matrix4x4Interpolation_4,$e._NoInterpolation_5,$e._BezierInterpolation_6,$e._BezierInterpolation_7],$e;}(),$T=function($p){function $h($m,$p){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$h.__super.call(this),void 0===$p&&($p=0),$m&&this.init($m,$p);}$P($h,"laya.ani.bone.Skeleton",$p);var $m=$h.prototype;return $m.init=function($m,$p){void 0===$p&&($p=0);var $h,$P,$L,$q=0,$k=0;if(1==$p)for(this._graphicsCache=[],$q=0,$k=$m.getAnimationCount();$q<$k;$q++)this._graphicsCache.push([]);if(this._yReverseMatrix=$m.yReverseMatrix,this._aniMode=$p,this._templet=$m,this._player=new $b(),this._player.cacheFrameRate=$m.rate,this._player.templet=$m,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$m.mBoneArr,this._rootBone=$m.mRootBone,this._aniSectionDic=$m.aniSectionDic,0<$m.ikArr.length)for(this._ikArr=[],$q=0,$k=$m.ikArr.length;$q<$k;$q++)this._ikArr.push(new $e($m.ikArr[$q],this._boneList));if(0<$m.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$q=0,$k=$m.pathArr.length;$q<$k;$q++)$h=$m.pathArr[$q],$P=new $H($h,this._boneList),($L=this._boneSlotDic[$h.name])&&(($P=new $H($h,this._boneList)).target=$L),this._pathDic[$h.name]=$P;if(0<$m.tfArr.length)for(this._tfArr=[],$q=0,$k=$m.tfArr.length;$q<$k;$q++)this._tfArr.push(new $W($m.tfArr[$q],this._boneList));if(0<$m.skinDataArray.length){var $Y=this._templet.skinDataArray[this._skinIndex];this._skinName=$Y.name;}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause);},$m.load=function($m,$p,$h){},$m._onLoaded=function(){},$m._parseComplete=function(){var $m=$j.TEMPLET_DICTIONARY[this._aniPath];$m&&(this.init($m,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this);},$m._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败");},$m._onPlay=function(){this.event("played");},$m._onStop=function(){var $m,$p=this._templet.eventAniArr[this._aniClipIndex];if($p&&this._eventIndex<$p.length)for(;this._eventIndex<$p.length;this._eventIndex++)($m=$p[this._eventIndex]).time>=this._player.playStart&&$m.time<=this._player.playEnd&&this.event("label",$m);this._eventIndex=0,this._drawOrder=null,this.event("stopped");},$m._onPause=function(){this.event("paused");},$m._parseSrcBoneMatrix=function(){var $m=0,$p=0;for($p=this._templet.srcBoneMatrixArr.length,$m=0;$m<$p;$m++)this._boneMatrixArray.push(new $Mm());if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $h,$P,$L=this._templet.boneSlotArray;for($m=0,$p=$L.length;$m<$p;$m++)$h=$L[$m],null==($P=this._bindBoneBoneSlotDic[$h.parent])&&(this._bindBoneBoneSlotDic[$h.parent]=$P=[]),this._boneSlotDic[$h.name]=$h=$h.copy(),$P.push($h),this._boneSlotArray.push($h);}},$m._emitMissedEvents=function($m,$p,$h){void 0===$h&&($h=0);var $P=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($P){var $L,$q,$k=0;for($L=$P.length,$k=$h;$k<$L;$k++)($q=$P[$k]).time>=this._player.playStart&&$q.time<=this._player.playEnd&&this.event("label",$q);}},$m._update=function($m){if(void 0===$m&&($m=!0),!(this._pause||$m&&this._indexControl)){var $p=this.timer.currTimer,$h=this._player.currentKeyframeIndex,$P=$p-this._lastTime;if($m?this._player._update($P):$h=-1,this._lastTime=$p,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$P&&this._clipIndex==$h&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $L;this._lastUpdateAniClipIndex=this._aniClipIndex,$h>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $q,$k=this._templet.eventAniArr[this._aniClipIndex];if($k&&this._eventIndex<$k.length&&(($L=$k[this._eventIndex]).time>=this._player.playStart&&$L.time<=this._player.playEnd?this._player.currentPlayTime>=$L.time&&(this.event("label",$L),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($q=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$q&&(this.graphics=$q));var $Y=0,$d=0;for($d=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$d-1)&&0<$d;)$d--;if($d<this._clipIndex)for($Y=$d;$Y<this._clipIndex;$Y++)this._createGraphics($Y);}else if(1==this._aniMode){if($q=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$q&&(this.graphics=$q));for($d=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$d-1)&&0<$d;)$d--;if($d<this._clipIndex)for($Y=$d;$Y<this._clipIndex;$Y++)this._createGraphics($Y);}this._createGraphics();}}},$m._createGraphics=function($m){void 0===$m&&($m=-1),-1==$m&&($m=this._clipIndex);var $p,$h,$P=$m*this._player.cacheFrameRateInterval,$L=this._templet.drawOrderAniArr[this._aniClipIndex];if($L&&0<$L.length)for(this._drawOrderIndex=0,$p=$L[this._drawOrderIndex];$P>=$p.time&&(this._drawOrder=$p.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$L.length));)$p=$L[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$S.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$S.create(),$h=this.graphics;var $q=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$m,$P);var $k,$Y,$d,$K,$D=this._aniSectionDic[this._aniClipIndex],$F=0,$R=0,$$=0,$A=0,$B=0,$n=this._templet.srcBoneMatrixArr.length;for($B=$D[$R=0];$R<$n;$R++)$K=this._boneList[$R],$d=this._templet.srcBoneMatrixArr[$R],$K.resultTransform.scX=$d.scX*this._curOriginalData[$F++],$K.resultTransform.skX=$d.skX+this._curOriginalData[$F++],$K.resultTransform.skY=$d.skY+this._curOriginalData[$F++],$K.resultTransform.scY=$d.scY*this._curOriginalData[$F++],$K.resultTransform.x=$d.x+this._curOriginalData[$F++],$K.resultTransform.y=$d.y+this._curOriginalData[$F++],8===this._templet.tMatrixDataLen&&($K.resultTransform.skewX=$d.skewX+this._curOriginalData[$F++],$K.resultTransform.skewY=$d.skewY+this._curOriginalData[$F++]);var $c,$e={},$a={};for($B+=$D[1];$R<$B;$R++)$e[($c=$q[$R]).name]=this._curOriginalData[$F++],$a[$c.name]=this._curOriginalData[$F++],this._curOriginalData[$F++],this._curOriginalData[$F++],this._curOriginalData[$F++],this._curOriginalData[$F++];var $Z,$H,$W={},$E={};for($B+=$D[2];$R<$B;$R++)$W[($c=$q[$R]).name]=this._curOriginalData[$F++],$E[$c.name]=this._curOriginalData[$F++],this._curOriginalData[$F++],this._curOriginalData[$F++],this._curOriginalData[$F++],this._curOriginalData[$F++];if(this._pathDic)for($B+=$D[3];$R<$B;$R++){if($c=$q[$R],$Z=this._pathDic[$c.name])switch(new $Qm($c.extenData).getByte()){case 1:$Z.position=this._curOriginalData[$F++];break;case 2:$Z.spacing=this._curOriginalData[$F++];break;case 3:$Z.rotateMix=this._curOriginalData[$F++],$Z.translateMix=this._curOriginalData[$F++];}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($Mm.TEMP.identity()),this._ikArr)for($R=0,$B=this._ikArr.length;$R<$B;$R++)$H=this._ikArr[$R],$W.hasOwnProperty($H.name)&&($H.bendDirection=$W[$H.name]),$E.hasOwnProperty($H.name)&&($H.mix=$E[$H.name]),$H.apply();if(this._pathDic)for(var $I in this._pathDic)($Z=this._pathDic[$I]).apply(this._boneList,$h);if(this._tfArr)for($R=0,$A=this._tfArr.length;$R<$A;$R++)this._tfArr[$R].apply();for($R=0,$A=this._boneList.length;$R<$A;$R++)if($K=this._boneList[$R],$Y=this._bindBoneBoneSlotDic[$K.name],$K.resultMatrix.copyTo(this._boneMatrixArray[$R]),$Y)for($$=0,$B=$Y.length;$$<$B;$$++)($k=$Y[$$])&&$k.setParentMatrix($K.resultMatrix);var $b,$T,$j,$x,$Q={},$M=this._templet.deformAniArr;if($M&&0<$M.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$R=0,$B=this._boneSlotArray.length;$R<$B;$R++)($k=this._boneSlotArray[$R]).deformData=null;var $u,$N=$M[this._aniClipIndex];for($u in $b=$N.default,this._setDeform($b,$Q,this._boneSlotArray,$P),$N)"default"!=$u&&$u!=this._skinName&&($b=$N[$u],this._setDeform($b,$Q,this._boneSlotArray,$P));$b=$N[this._skinName],this._setDeform($b,$Q,this._boneSlotArray,$P);}if(this._drawOrder)for($R=0,$B=this._drawOrder.length;$R<$B;$R++)$T=$e[($k=this._boneSlotArray[this._drawOrder[$R]]).name],$j=$a[$k.name],isNaN($j)||($h.save(),$h.alpha($j)),isNaN($T)||-2==$T||(this._templet.attachmentNames?$k.showDisplayByName(this._templet.attachmentNames[$T]):$k.showDisplayByIndex($T)),$Q[this._drawOrder[$R]]?($x=$Q[this._drawOrder[$R]],$k.currDisplayData&&$x[$k.currDisplayData.attachmentName]?$k.deformData=$x[$k.currDisplayData.attachmentName]:$k.deformData=null):$k.deformData=null,isNaN($j)?$k.draw($h,this._boneMatrixArray,2==this._aniMode):$k.draw($h,this._boneMatrixArray,2==this._aniMode,$j),isNaN($j)||$h.restore();else for($R=0,$B=this._boneSlotArray.length;$R<$B;$R++)$T=$e[($k=this._boneSlotArray[$R]).name],$j=$a[$k.name],isNaN($j)||($h.save(),$h.alpha($j)),isNaN($T)||-2==$T||(this._templet.attachmentNames?$k.showDisplayByName(this._templet.attachmentNames[$T]):$k.showDisplayByIndex($T)),$Q[$R]?($x=$Q[$R],$k.currDisplayData&&$x[$k.currDisplayData.attachmentName]?$k.deformData=$x[$k.currDisplayData.attachmentName]:$k.deformData=null):$k.deformData=null,isNaN($j)?$k.draw($h,this._boneMatrixArray,2==this._aniMode):$k.draw($h,this._boneMatrixArray,2==this._aniMode,$j),isNaN($j)||$h.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$m,$h):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$m,$h);},$m._setDeform=function($m,$p,$h,$P){if($m){var $L,$q,$k,$Y=0,$d=0,$K=0;if($m)for($Y=0,$d=$m.deformSlotDataList.length;$Y<$d;$Y++)for($L=$m.deformSlotDataList[$Y],$K=0;$K<$L.deformSlotDisplayList.length;$K++)$k=$h[($q=$L.deformSlotDisplayList[$K]).slotIndex],$q.apply($P,$k),$p[$q.slotIndex]||($p[$q.slotIndex]={}),$p[$q.slotIndex][$q.attachment]=$q.deformData;}},$m.getAnimNum=function(){return this._templet.getAnimationCount();},$m.getAniNameByIndex=function($m){return this._templet.getAniNameByIndex($m);},$m.getSlotByName=function($m){return this._boneSlotDic[$m];},$m.showSkinByName=function($m,$p){void 0===$p&&($p=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($m),$p);},$m.showSkinByIndex=function($m,$p){void 0===$p&&($p=!0);for(var $h=0;$h<this._boneSlotArray.length;$h++)this._boneSlotArray[$h].showSlotData(null,$p);if(this._templet.showSkinByIndex(this._boneSlotDic,$m,$p)){var $P=this._templet.skinDataArray[$m];this._skinIndex=$m,this._skinName=$P.name;}this._clearCache();},$m.showSlotSkinByIndex=function($m,$p){if(0!=this._aniMode){var $h=this.getSlotByName($m);$h&&$h.showDisplayByIndex($p),this._clearCache();}},$m.showSlotSkinByName=function($m,$p){if(0!=this._aniMode){var $h=this.getSlotByName($m);$h&&$h.showDisplayByName($p),this._clearCache();}},$m.replaceSlotSkinName=function($m,$p,$h){if(0!=this._aniMode){var $P=this.getSlotByName($m);$P&&$P.replaceDisplayByName($p,$h),this._clearCache();}},$m.replaceSlotSkinByIndex=function($m,$p,$h){if(0!=this._aniMode){var $P=this.getSlotByName($m);$P&&$P.replaceDisplayByIndex($p,$h),this._clearCache();}},$m.setSlotSkin=function($m,$p){if(0!=this._aniMode){var $h=this.getSlotByName($m);$h&&$h.replaceSkin($p),this._clearCache();}},$m._clearCache=function(){if(1==this._aniMode)for(var $m=0,$p=this._graphicsCache.length;$m<$p;$m++){for(var $h=0,$P=this._graphicsCache[$m].length;$h<$P;$h++){var $L=this._graphicsCache[$m][$h];$L!=this.graphics&&$S.recycle($L);}this._graphicsCache[$m].length=0;}},$m.play=function($m,$p,$h,$P,$L,$q){void 0===$h&&($h=!0),void 0===$P&&($P=0),void 0===$L&&($L=0),void 0===$q&&($q=!0),this._indexControl=!1;var $k=-1,$Y=NaN;if($Y=$p?2147483647:0,"string"==typeof $m)for(var $d=0,$K=this._templet.getAnimationCount();$d<$K;$d++){var $D=this._templet.getAnimation($d);if($D&&$m==$D.name){$k=$d;break;}}else $k=$m;-1<$k&&$k<this.getAnimNum()&&(this._aniClipIndex=$k,($h||this._pause||this._currAniIndex!=$k)&&(this._currAniIndex=$k,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($k)),this._drawOrder=null,this._eventIndex=0,this._player.play($k,this._player.playbackRate,$Y,$P,$L),$q&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$F.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()));},$m.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update));},$m.playbackRate=function($m){this._player&&(this._player.playbackRate=$m);},$m.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update));},$m.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$F.now(),this.timer.frameLoop(1,this,this._update,null,!0));},$m._getGrahicsDataWithCache=function($m,$p){return this._graphicsCache[$m][$p];},$m._setGrahicsDataWithCache=function($m,$p,$h){this._graphicsCache[$m][$p]=$h;},$m.destroy=function($m){void 0===$m&&($m=!0),$p.prototype.destroy.call(this,$m),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update);},$q(0,$m,"url",function(){return this._aniPath;},function($m){this.load($m);}),$q(0,$m,"index",function(){return this._index;},function($m){this.player&&(this._index=$m,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1));}),$q(0,$m,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total;}),$q(0,$m,"templet",function(){return this._templet;}),$q(0,$m,"player",function(){return this._player;}),$h.useSimpleMeshInCanvas=!1,$h;}($qm),$j=function($p){function $L(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$L.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[];}$P($L,"laya.ani.bone.Templet",$p);var $m=$L.prototype;return $m.getLoadList=function(){return this._loadList;},$m.loadAni=function($m){this._skBufferUrl=$m,$Lm.loader.load($m,$d.create(this,this.onComplete),null,"arraybuffer");},$m.onComplete=function($m){if(this._isDestroyed)this.destroy();else{var $p=$K.getRes(this._skBufferUrl);$p?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$p)):this.event("error","load failed:"+this._skBufferUrl);}},$m.parseData=function($m,$p,$h){void 0===$h&&($h=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$m,this._mainTexture&&$n.isWebGL&&$m.bitmap&&($m.bitmap.enableMerageInAtlas=!1),this._rate=$h,this.parse($p);},$m.buildArmature=function($m){return void 0===$m&&($m=0),new $T(this,$m);},$m.parse=function($m){$p.prototype.parse.call(this,$m),this._endLoaded(),this._aniVersion!=$L.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$L.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0);},$m._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $m=0;this._loadList=[];var $p,$h=new $Qm(this.getPublicExtData()),$P=0,$L=0,$q=0,$k=$h.getInt32(),$Y=$h.readUTFString(),$d=$Y.split("\n");for($m=0;$m<$k;$m++)$p=this._path+$d[2*$m],$Y=$d[2*$m+1],$h.getFloat32(),$h.getFloat32(),$P=$h.getFloat32(),$L=$h.getFloat32(),$q=$h.getFloat32(),isNaN($q)?0:$q,$q=$h.getFloat32(),isNaN($q)?0:$q,$q=$h.getFloat32(),isNaN($q)?$P:$q,$q=$h.getFloat32(),isNaN($q)?$L:$q,-1==this._loadList.indexOf($p)&&this._loadList.push($p);this.event("inited",this);}},$m._textureComplete=function(){for(var $m,$p,$h=0,$P=this._loadList.length;$h<$P;$h++)$p=this._loadList[$h],$m=this._textureDic[$p]=$K.getRes($p),$n.isWebGL&&$m&&$m.bitmap&&($m.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData();},$m._parsePublicExtData=function(){var $m=0,$p=0,$h=0,$P=0,$L=0;for($m=0,$L=this.getAnimationCount();$m<$L;$m++)this._graphicsCache.push([]);var $q;$q="Dragon"!=this._aniClassName;var $k,$Y,$d=new $Qm(this.getPublicExtData()),$K=0,$D=0,$F=0,$R=0,$$=0,$A=0,$B=0,$n=0,$c=0,$e=$d.getInt32(),$a=$d.readUTFString(),$Z=$a.split("\n");for($m=0;$m<$e;$m++){if($k=this._mainTexture,$Y=this._path+$Z[2*$m],$a=$Z[2*$m+1],null==this._mainTexture&&($k=this._textureDic[$Y]),!$k)return this.event("error",this),void(this.isParseFail=!0);$K=$d.getFloat32(),$D=$d.getFloat32(),$F=$d.getFloat32(),$R=$d.getFloat32(),$c=$d.getFloat32(),$$=isNaN($c)?0:$c,$c=$d.getFloat32(),$A=isNaN($c)?0:$c,$c=$d.getFloat32(),$B=isNaN($c)?$F:$c,$c=$d.getFloat32(),$n=isNaN($c)?$R:$c,this.subTextureDic[$a]=$um.create($k,$K,$D,$F,$R,-$$,-$A,$B,$n),$k.alphaTexture&&(this.subTextureDic[$a].alphaTexture=$um.create($k.alphaTexture,$K,$D,$F,$R,-$$,-$A,$B,$n));}this._mainTexture=$k;var $H,$W,$E,$I,$b,$T=$d.getUint16();for($m=0;$m<$T;$m++)($H=[]).push($d.getUint16()),$H.push($d.getUint16()),$H.push($d.getUint16()),$H.push($d.getUint16()),this.aniSectionDic[$m]=$H;var $j,$x=$d.getInt16(),$Q={};for($m=0;$m<$x;$m++)$W=new $Nm(),0==$m?$j=$W:$W.root=$j,$W.d=$q?-1:1,$I=$d.readUTFString(),$b=$d.readUTFString(),$W.length=$d.getFloat32(),1==$d.getByte()&&($W.inheritRotation=!1),1==$d.getByte()&&($W.inheritScale=!1),$W.name=$I,$b&&(($E=$Q[$b])?$E.addChild($W):this.mRootBone=$W),$Q[$I]=$W,this.mBoneArr.push($W);this.tMatrixDataLen=$d.getUint16();var $M,$u,$N=$d.getUint16(),$S=Math.floor($N/this.tMatrixDataLen),$_=this.srcBoneMatrixArr;for($m=0;$m<$S;$m++)($M=new $Vm()).scX=$d.getFloat32(),$M.skX=$d.getFloat32(),$M.skY=$d.getFloat32(),$M.scY=$d.getFloat32(),$M.x=$d.getFloat32(),$M.y=$d.getFloat32(),8===this.tMatrixDataLen&&($M.skewX=$d.getFloat32(),$M.skewY=$d.getFloat32()),$_.push($M),($W=this.mBoneArr[$m]).transform=$M;var $l,$J=$d.getUint16(),$z=0;for($m=0;$m<$J;$m++){for($u=new $Xm(),$z=$d.getUint16(),$p=0;$p<$z;$p++)$u.boneNames.push($d.readUTFString()),$u.boneIndexs.push($d.getInt16());$u.name=$d.readUTFString(),$u.targetBoneName=$d.readUTFString(),$u.targetBoneIndex=$d.getInt16(),$u.bendDirection=$d.getFloat32(),$u.mix=$d.getFloat32(),$u.isSpine=$q,this.ikArr.push($u);}var $w,$X=$d.getUint16(),$s=0;for($m=0;$m<$X;$m++){for($l=new $ym(),$s=$d.getUint16(),$p=0;$p<$s;$p++)$l.boneIndexs.push($d.getInt16());$l.name=$d.getUTFString(),$l.targetIndex=$d.getInt16(),$l.rotateMix=$d.getFloat32(),$l.translateMix=$d.getFloat32(),$l.scaleMix=$d.getFloat32(),$l.shearMix=$d.getFloat32(),$l.offsetRotation=$d.getFloat32(),$l.offsetX=$d.getFloat32(),$l.offsetY=$d.getFloat32(),$l.offsetScaleX=$d.getFloat32(),$l.offsetScaleY=$d.getFloat32(),$l.offsetShearY=$d.getFloat32(),this.tfArr.push($l);}var $G=$d.getUint16(),$U=0;for($m=0;$m<$G;$m++){for(($w=new $sm()).name=$d.readUTFString(),$U=$d.getUint16(),$p=0;$p<$U;$p++)$w.bones.push($d.getInt16());$w.target=$d.readUTFString(),$w.positionMode=$d.readUTFString(),$w.spacingMode=$d.readUTFString(),$w.rotateMode=$d.readUTFString(),$w.offsetRotation=$d.getFloat32(),$w.position=$d.getFloat32(),$w.spacing=$d.getFloat32(),$w.rotateMix=$d.getFloat32(),$w.translateMix=$d.getFloat32(),this.pathArr.push($w);}var $r,$y,$V,$o,$f,$i=0,$v=0,$g=0,$t=NaN,$O=0,$C=$d.getInt16();for($m=0;$m<$C;$m++){var $mm=$d.getUint8(),$pm={};this.deformAniArr.push($pm);for(var $hm=0;$hm<$mm;$hm++)for(($r=new $_m()).skinName=$d.getUTFString(),$pm[$r.skinName]=$r,$i=$d.getInt16(),$p=0;$p<$i;$p++)for($y=new $lm(),$r.deformSlotDataList.push($y),$v=$d.getInt16(),$h=0;$h<$v;$h++)for($V=new $Jm(),$y.deformSlotDisplayList.push($V),$V.slotIndex=$d.getInt16(),$V.attachment=$d.getUTFString(),$g=$d.getInt16(),$P=0;$P<$g;$P++)for(1==$d.getByte()?$V.tweenKeyList.push(!0):$V.tweenKeyList.push(!1),$t=$d.getFloat32(),$V.timeList.push($t),$o=[],$V.vectices.push($o),$O=$d.getInt16(),$L=0;$L<$O;$L++)$o.push($d.getFloat32());}var $Pm,$Lm,$qm=$d.getInt16(),$km=0,$Ym=0;for($m=0;$m<$qm;$m++){for($km=$d.getInt16(),$f=[],$p=0;$p<$km;$p++){for(($Pm=new $zm()).time=$d.getFloat32(),$Ym=$d.getInt16(),$h=0;$h<$Ym;$h++)$Pm.drawOrder.push($d.getInt16());$f.push($Pm);}this.drawOrderAniArr.push($f);}var $dm,$Km=$d.getInt16(),$Dm=0;for($m=0;$m<$Km;$m++){for($Dm=$d.getInt16(),$Lm=[],$p=0;$p<$Dm;$p++)($dm=new $wm()).name=$d.getUTFString(),$dm.intValue=$d.getInt32(),$dm.floatValue=$d.getFloat32(),$dm.stringValue=$d.getUTFString(),$dm.time=$d.getFloat32(),$Lm.push($dm);this.eventAniArr.push($Lm);}var $Fm=$d.getInt16();if(0<$Fm)for(this.attachmentNames=[],$m=0;$m<$Fm;$m++)this.attachmentNames.push($d.getUTFString());var $Rm,$$m,$Am=$d.getInt16();for($m=0;$m<$Am;$m++)($Rm=new $Sm()).name=$d.readUTFString(),$Rm.parent=$d.readUTFString(),$Rm.attachmentName=$d.readUTFString(),$Rm.srcDisplayIndex=$Rm.displayIndex=$d.getInt16(),($Rm.templet=this).boneSlotDic[$Rm.name]=$Rm,null==($$m=this.bindBoneBoneSlotDic[$Rm.parent])&&(this.bindBoneBoneSlotDic[$Rm.parent]=$$m=[]),$$m.push($Rm),this.boneSlotArray.push($Rm);var $Bm,$nm,$cm,$em=$d.readUTFString().split("\n"),$am=0,$Zm=$d.getUint8(),$Hm=0,$Wm=0,$Em=0,$Im=0,$bm=0,$Tm=0,$jm=0;for($m=0;$m<$Zm;$m++){for(($Bm=new $Gm()).name=$em[$am++],$Hm=$d.getUint8(),$p=0;$p<$Hm;$p++){for(($nm=new $rm()).name=$em[$am++],$Rm=this.boneSlotDic[$nm.name],$Wm=$d.getUint8(),$h=0;$h<$Wm;$h++){if($cm=new $Um(),this.skinSlotDisplayDataArr.push($cm),$cm.name=$em[$am++],$cm.attachmentName=$em[$am++],$cm.transform=new $Vm(),$cm.transform.scX=$d.getFloat32(),$cm.transform.skX=$d.getFloat32(),$cm.transform.skY=$d.getFloat32(),$cm.transform.scY=$d.getFloat32(),$cm.transform.x=$d.getFloat32(),$cm.transform.y=$d.getFloat32(),$nm.displayArr.push($cm),$cm.width=$d.getFloat32(),$cm.height=$d.getFloat32(),$cm.type=$d.getUint8(),$cm.verLen=$d.getUint16(),0<($x=$d.getUint16()))for($cm.bones=[],$P=0;$P<$x;$P++){var $xm=$d.getUint16();$cm.bones.push($xm);}if(0<($Em=$d.getUint16()))for($cm.uvs=[],$P=0;$P<$Em;$P++)$cm.uvs.push($d.getFloat32());if(0<($Im=$d.getUint16()))for($cm.weights=[],$P=0;$P<$Im;$P++)$cm.weights.push($d.getFloat32());if(0<($bm=$d.getUint16()))for($cm.triangles=[],$P=0;$P<$bm;$P++)$cm.triangles.push($d.getUint16());if(0<($Tm=$d.getUint16()))for($cm.vertices=[],$P=0;$P<$Tm;$P++)$cm.vertices.push($d.getFloat32());if(0<($jm=$d.getUint16()))for($cm.lengths=[],$P=0;$P<$jm;$P++)$cm.lengths.push($d.getFloat32());}$Bm.slotArr.push($nm);}this.skinDic[$Bm.name]=$Bm,this.skinDataArray.push($Bm);}1==$d.getUint8()?(this.yReverseMatrix=new $Mm(1,0,0,-1,0,0),$j&&$j.setTempMatrix(this.yReverseMatrix)):$j&&$j.setTempMatrix(new $Mm()),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this);},$m.getTexture=function($m){var $p=this.subTextureDic[$m];return $p||($p=this.subTextureDic[$m.substr(0,$m.length-1)]),null==$p?this._mainTexture:$p;},$m.showSkinByIndex=function($m,$p,$h){if(void 0===$h&&($h=!0),$p<0&&$p>=this.skinDataArray.length)return!1;var $P,$L,$q=0,$k=0,$Y=this.skinDataArray[$p];if($Y){for($q=0,$k=$Y.slotArr.length;$q<$k;$q++)($L=$Y.slotArr[$q])&&($P=$m[$L.name])&&($P.showSlotData($L,$h),$h&&"undefined"!=$P.attachmentName&&"null"!=$P.attachmentName?$P.showDisplayByName($P.attachmentName):$P.showDisplayByIndex($P.displayIndex));return!0;}return!1;},$m.getSkinIndexByName=function($m){for(var $p=0,$h=this.skinDataArray.length;$p<$h;$p++)if(this.skinDataArray[$p].name==$m)return $p;return-1;},$m.getGrahicsDataWithCache=function($m,$p){return this._graphicsCache[$m][$p];},$m.setGrahicsDataWithCache=function($m,$p,$h){this._graphicsCache[$m][$p]=$h;},$m.destroy=function(){var $m;for(var $p in this._isDestroyed=!0,this.subTextureDic)($m=this.subTextureDic[$p])&&$m.destroy();for($p in this._textureDic)($m=this._textureDic[$p])&&$m.destroy();for(var $h=0,$P=this.skinSlotDisplayDataArr.length;$h<$P;$h++)this.skinSlotDisplayDataArr[$h].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $L.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this);},$m.getAniNameByIndex=function($m){var $p=this.getAnimation($m);return $p?$p.name:null;},$q(0,$m,"rate",function(){return this._rate;},function($m){this._rate=$m;}),$L.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$L.TEMPLET_DICTIONARY=null,$L;}($_);}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($m,$p){"use strict";for(var $h in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $P=Laya[$h];$P&&$P.__isclass&&($p[$h]=$P);}});