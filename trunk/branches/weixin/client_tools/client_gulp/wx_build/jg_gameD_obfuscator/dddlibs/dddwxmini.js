var v=wx.$d;!function(e,o){o.un,o.uns;var i=o.static,n=o.class,a=o.getset,u=(o.__newvec,laya.utils.Browser),l=(laya.events.Event,laya.events.EventDispatcher),s=laya.resource.HTMLImage,c=laya.utils.Handler,t=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),g=laya.utils.RunDriver,m=(laya.media.Sound,laya.media.SoundChannel),p=laya.media.SoundManager,v=(laya.display.Stage,laya.net.URL),_=laya.utils.Utils,d=(n(dhim,"laya.wx.mini.MiniAdpter"),dhim.getJson=function(i){return JSON.parse(i)},dhim.init=function(i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),dhim._inited||(dhim.window=e).navigator.userAgent.indexOf("MiniGame")<0||(dhim._inited=!0,dhim.isZiYu=n,dhim.isPosMsgYu=i,dhim.EnvConfig={},dhim.isZiYu||(r.setNativeFileDir("/layaairGame"),r.existDir(r.fileNativeDir,c.create(dhim,dhim.onMkdirCallBack))),dhim.window.focus=function(){},o.getUrlPath=function(){},dhim.window.logtime=function(i){},dhim.window.alertTimeLog=function(i){},dhim.window.resetShareInfo=function(){},dhim.window.CanvasRenderingContext2D=function(){},dhim.window.CanvasRenderingContext2D.prototype=dhim.window.wx.createCanvas().getContext("2d").__proto__,dhim.window.document.body.appendChild=function(){},dhim.EnvConfig.pixelRatioInt=0,g.getPixelRatio=dhim.pixelRatio,dhim._preCreateElement=u.createElement,u.createElement=dhim.createElement,g.createShaderCondition=dhim.createShaderCondition,_.parseXMLFromString=dhim.parseXMLFromString,t._createInputElement=x._createInputElement,dhim.EnvConfig.load=f.prototype.load,f.prototype.load=y.prototype.load,dhim.isZiYu&&i&&wx.onMessage(function(i){i.isLoad&&(r.ziyuFileData[i.url]=i.data)}))},dhim.onMkdirCallBack=function(i,n){i||(r.filesListObj=JSON.parse(n.data))},dhim.pixelRatio=function(){if(!dhim.EnvConfig.pixelRatioInt)try{var i=wx.getSystemInfoSync();return dhim.EnvConfig.pixelRatioInt=i.pixelRatio,i.pixelRatio}catch(i){}return dhim.EnvConfig.pixelRatioInt},dhim.createElement=function(i){return"canvas"!=i?"textarea"==i||"input"==i?dhim.onCreateInput(i):"div"==i?((t=dhim._preCreateElement(i)).contains=function(i){return null},t.removeChild=function(i){},t):dhim._preCreateElement(i):(1==dhim.idx?dhim.isZiYu?(n=sharedCanvas).style={}:n=e.canvas:n=e.wx.createCanvas(),dhim.idx++,n);var n;var t},dhim.onCreateInput=function(i){i=dhim._preCreateElement(i);return i.focus=x.wxinputFocus,i.blur=x.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(i){},i.setType=function(i){},i.setFontFace=function(i){},i.addEventListener=function(i){},i.contains=function(i){return null},i.removeChild=function(i){},i},dhim.createShaderCondition=function(i){var n=this;return function(){return n[i.replace("this.","")]}},dhim.EnvConfig=null,dhim.window=null,dhim._preCreateElement=null,dhim._inited=!1,dhim.wxRequest=null,dhim.systemInfo=null,dhim.version="0.0.1",dhim.isZiYu=!1,dhim.isPosMsgYu=!1,dhim.parseXMLFromString=function(i){var n;i=i.replace(/>\s+</g,"><");try{n=(new e.Parser.DOMParser).parseFromString(i,"text/xml")}catch(i){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},dhim.idx=1,dhim),x=(n(mdh6e,"laya.wx.mini.MiniImage"),mdh6e.prototype._loadImage=function(i){var n=!1;-1==i.indexOf("layaNativeDir/")&&(n=!0,i=v.formatURL(i)),r.getFileInfo(i)?mdh6e.onCreateImage(i,this,!n):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?r.downImg(i,new c(mdh6e,mdh6e.onDownImgCallBack,[i,this]),i):mdh6e.onCreateImage(i,this,!0)},mdh6e.onDownImgCallBack=function(i,n,t){t?n.onError(null):mdh6e.onCreateImage(i,n)},mdh6e.onCreateImage=function(n,t,i){var e;function _394n(){e.onload=null,e.onerror=null,delete t.imgCache[n]}i=(i=void 0===i?!1:i)?n:(i=r.getFileInfo(n).md5,r.getFileNativePath(i)),null==t.imgCache&&(t.imgCache={});function ya(){_394n(),t.onLoaded(e)}function za(){_394n(),t.event("error","Load image failed")}"nativeimage"==t._type?((e=new u.window.Image).crossOrigin="",e.onload=ya,e.onerror=za,e.src=i,t.imgCache[n]=e):new s.create(i,{onload:ya,onerror:za,onCreate:function(i){e=i,t.imgCache[n]=i}})},n(_hn46,"laya.wx.mini.MiniInput"),_hn46._createInputElement=function(){t._initInput(t.area=u.createElement("textarea")),t._initInput(t.input=u.createElement("input")),t.inputContainer=u.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,u.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(i,n){t.inputContainer.style.left=i+"px",t.inputContainer.style.top=n+"px"},o.stage.on("resize",null,_hn46._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){e.dispatchEvent&&e.dispatchEvent("resize")}),p._soundClass=w,p._musicClass=w},_hn46._onStageResize=function(){o.stage._canvasTransform.identity().scale(u.width/h.canvas.width/g.getPixelRatio(),u.height/h.canvas.height/g.getPixelRatio())},_hn46.wxinputFocus=function(i){var n=t.inputElement.target;n&&!n.editable||(d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(i){},fail:function(i){}}),d.window.wx.onKeyboardConfirm(function(i){i=i?i.value:"";n.text=i,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),d.window.wx.onKeyboardInput(function(i){i=i?i.value:"";n.multiline||-1==i.indexOf("\n")?(n.text=i,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},_hn46.inputEnter=function(){t.inputElement.target.focus=!1},_hn46.wxinputblur=function(){_hn46.hideKeyboard()},_hn46.hideKeyboard=function(){d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.hideKeyboard({success:function(i){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(i){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(i?i.errMsg:""))}})},_hn46),y=(n(gifuk,"laya.wx.mini.MiniLoader"),(C=gifuk.prototype).load=function(i,n,t,e,a){void 0===t&&(t=!0),void 0===a&&(a=!1);var o=this;0===(o._url=i).indexOf("data:image")?o._type=n="image":o._type=n=n||o.getTypeFromUrl(i),o._cache=t,o._data=null;var u="ascii";-1!=i.indexOf(".fnt")?u="utf8":"arraybuffer"==n&&(u="");var l=_.getFileExtension(i);if(-1!=gifuk._fileTypeArr.indexOf(l))d.EnvConfig.load.call(this,i,n,t,e,a);else if(r.getFileInfo(i))d.EnvConfig.load.call(this,i,n,t,e,a);else{if(-1!=i.indexOf("layaNativeDir/"))return d.isZiYu?(l=r.ziyuFileData[i],void o.onLoaded(l)):(cosnole.log("read read"),void r.read(i,u,new c(gifuk,gifuk.onReadNativeCallBack,[u,i,n,t,e,a,o])));l=""==v.rootPath?i:i.split(v.rootPath)[0],-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?d.EnvConfig.load.call(o,i,n,t,e,a):r.readFile(l,u,new c(gifuk,gifuk.onReadNativeCallBack,[u,i,n,t,e,a,o]),i)}},C.resMgrLoad=function(i,e,n,t,a,o,u){void 0===n&&(n=0),void 0===t&&(t=!1),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===u&&(u=3),-1!=i.indexOf("mpack")&&console.log("=============resMgrLoad url:",i),d.EnvConfig.resMgrLoad(i,(i,n,t)=>{gifuk.prototype.resMgrLoadCallBack(i,n,t,e)},n,t,a,o,u)},C.resMgrLoadCallBack=function(i,n,t,e){console.log("buff:::",i,t,r.fileNativeDir+"///"+r.fileListName),e(i,n,t)},C.clearRes=function(i,n){this.clearRes(i,n=void 0===n?!1:n);n=r.getFileInfo(i);!n||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(i=n.md5,n=r.getFileNativePath(i),r.remove(n))},gifuk.onReadNativeCallBack=function(i,n,t,e,a,o,u,l,r){void 0===e&&(e=!0),void 0===o&&(o=!1),(l=void 0===l?0:l)?1==l&&d.EnvConfig.load.call(u,n,t,e,a,o):(l="json"==t||"atlas"==t?d.getJson(r.data):"xml"==t?_.parseXMLFromString(r.data):r.data,u.onLoaded(l),!d.isZiYu&&d.isPosMsgYu&&"arraybuffer"!=t&&wx.postMessage({url:n,data:l,isLoad:!0}))},i(gifuk,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),gifuk),r=(n(ukgtq,"laya.wx.mini.MiniFileMgr",l),ukgtq.isLoadFile=function(i){return-1!=ukgtq._fileTypeArr.indexOf(i)},ukgtq.getFileInfo=function(i){i=i.split("?")[0],i=ukgtq.filesListObj[i];return null==i?null:i},ukgtq.onFileUpdate=function(i,n){var i=i.split("/"),i=i[i.length-1],t=ukgtq.getFileInfo(n);null==t?ukgtq.onSaveFile(n,i):t.readyUrl!=n&&ukgtq.remove(i,n)},ukgtq.exits=function(i,n){i=ukgtq.getFileNativePath(i);ukgtq.fs.getFileInfo({filePath:i,success:function(i){null!=n&&n.runWith([0,i])},fail:function(i){null!=n&&n.runWith([1,i])}})},ukgtq.read=function(i,n,t,e){void 0===n&&(n="ascill"),i=""!=(e=void 0===e?"":e)?ukgtq.getFileNativePath(i):i,ukgtq.fs.readFile({filePath:i,encoding:n,success:function(i){null!=t&&t.runWith([0,i])},fail:function(i){i&&""!=e?ukgtq.down(e,n,t,e):null!=t&&t.runWith([1])}})},ukgtq.readNativeFile=function(i,n){ukgtq.fs.readFile({filePath:i,encoding:"",success:function(i){null!=n&&n.runWith([0])},fail:function(i){null!=n&&n.runWith([1])}})},ukgtq.down=function(i,n,t,e){void 0===n&&(n="ascill"),void 0===e&&(e="");var a=ukgtq.getFileNativePath(e);ukgtq.wxdown({url:i,filePath:a,success:function(i){200===i.statusCode&&ukgtq.readFile(i.filePath,n,t,e)},fail:function(i){null!=t&&t.runWith([1,i])}}).onProgressUpdate(function(i){null!=t&&t.runWith([2,i.progress])})},ukgtq.readFile=function(n,i,t,e){void 0===e&&(e=""),ukgtq.fs.readFile({filePath:n,encoding:i=void 0===i?"ascill":i,success:function(i){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||ukgtq.onFileUpdate(n,e),null!=t&&t.runWith([0,i])},fail:function(i){i&&null!=t&&t.runWith([1,i])}})},ukgtq.downImg=function(i,n,t){void 0===t&&(t="");ukgtq.wxdown({url:i,success:function(i){200===i.statusCode&&ukgtq.copyFile(i.tempFilePath,t,n)},fail:function(i){null!=n&&n.runWith([1,i])}})},ukgtq.copyFile=function(i,n,t){var e=i.split("/"),a=e[e.length-1],o=(n.split("?")[0],ukgtq.getFileInfo(n)),e=ukgtq.getFileNativePath(a);ukgtq.fs.copyFile({srcPath:i,destPath:e,success:function(i){o?o.readyUrl!=n&&ukgtq.remove(a,n,t):(ukgtq.onSaveFile(n,a),null!=t&&t.runWith([0]))},fail:function(i){null!=t&&t.runWith([1,i])}})},ukgtq.getFileNativePath=function(i){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+i},ukgtq.remove=function(n,t,e){void 0===t&&(t="");var i=ukgtq.getFileInfo(t),a=ukgtq.getFileNativePath(i.md5);o.loader.clearRes(i.readyUrl),ukgtq.fs.unlink({filePath:a,success:function(i){""!=t&&ukgtq.onSaveFile(t,n),null!=e&&e.runWith([0])},fail:function(i){}})},ukgtq.onSaveFile=function(i,n){var t=i.split("?")[0];ukgtq.filesListObj[t]={md5:n,readyUrl:i},ukgtq.fs.writeFile({filePath:ukgtq.fileNativeDir+"/"+ukgtq.fileListName,encoding:"utf8",data:JSON.stringify(ukgtq.filesListObj),success:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",i)},fail:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",i)}})},ukgtq.existDir=function(i,n){ukgtq.fs.mkdir({dirPath:i,success:function(i){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(i){-1!=i.errMsg.indexOf("file already exists")?ukgtq.readSync(ukgtq.fileListName,"utf8",n):null!=n&&n.runWith([1,i])}})},ukgtq.readSync=function(i,n,t,e){void 0===n&&(n="ascill"),void 0===e&&(e="");var a,n=ukgtq.getFileNativePath(i);try{a=ukgtq.fs.readFileSync(n),null!=t&&t.runWith([0,{data:a}])}catch(i){null!=t&&t.runWith([1])}},ukgtq.readCache=function(){},ukgtq.writeCache=function(i){var n=readyUrl.split("?")[0];ukgtq.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},ukgtq.fs.writeFile({filePath:ukgtq.fileNativeDir+"/"+ukgtq.fileListName,encoding:"utf8",data:JSON.stringify(ukgtq.filesListObj),success:function(i){},fail:function(i){}})},ukgtq.setNativeFileDir=function(i){ukgtq.fileNativeDir=wx.env.USER_DATA_PATH+i},ukgtq.filesListObj={},ukgtq.fileNativeDir=null,ukgtq.fileListName="layaairfiles.txt",ukgtq.ziyuFileData={},i(ukgtq,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),ukgtq),w=(n(zbax0,"laya.wx.mini.MiniSound",l),(C=zbax0.prototype).load=function(i){var n=this;var t;function _93o5c(){if(null!=zbax0._null)n._sound.onCanplay(zbax0._null),n._sound.onError(zbax0._null);else try{n._sound.onCanplay(null),n._sound.onError(null),zbax0._null=null}catch(i){console.warn("[wxmini] _clearSound:"+i),n._sound.onCanplay(cn93_),n._sound.onError(cn93_),zbax0._null=cn93_}}function cn93_(){}i=v.formatURL(i),this.url=i,zbax0._audioCache[i]?this.event("complete"):(this._sound.onCanplay(function(){_93o5c(),t.loaded=!0,t.event("complete"),zbax0._audioCache[t.url]=t}),this._sound.onError(function(i){console.error("errCode="+i.errCode+"  errMsg="+i.errMsg),_93o5c(),t.event("error")}),this._sound.src=i,t=this)},C.play=function(i,n){void 0===i&&(i=0),void 0===n&&(n=0),(t=this.url==p._tMusic?(zbax0._musicAudio||(zbax0._musicAudio=zbax0._createSound()),zbax0._musicAudio):zbax0._createSound()).src=this.url;var t=new k(t);return t.url=this.url,t.loops=n,t.startTime=i,t.play(),p.addChannel(t),t},C.dispose=function(){var i=zbax0._audioCache[this.url];i&&(i.src="",delete zbax0._audioCache[this.url])},a(0,C,"duration",function(){return this._sound.duration}),zbax0._createSound=function(){return zbax0._id++,d.window.wx.createInnerAudioContext()},zbax0._musicAudio=null,zbax0._id=0,zbax0._audioCache={},zbax0._null=void 0,zbax0),k=(n(duietm,"laya.wx.mini.MiniSoundChannel",m),(i=duietm.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(o.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__onNull=function(){},i.play=function(){this.isStopped=!1,p.addChannel(this),this._audio&&this._audio.play()},i.stop=function(){if(this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=duietm._null)this._audio.onEnded(duietm._null);else try{this._audio.onEnded(null),duietm._null=null}catch(i){console.warn("[wxmini] stop:"+i),this._audio.onEnded(_.bind(this.__onNull,this)),duietm._null=_.bind(this.__onNull,this)}this._audio=null}},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},a(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,i,"duration",function(){return this._audio?this._audio.duration:0}),a(0,i,"volume",function(){return 1},function(i){}),duietm._null=void 0,duietm);function duietm(i){this._audio=null,this._onEnd=null,duietm.__super.call(this),this._audio=i,this._onEnd=_.bind(this.__onEnd,this),i.onEnded(this._onEnd)}function zbax0(){this._sound=null,this.url=null,this.loaded=!1,zbax0.__super.call(this),this._sound=zbax0._createSound()}function ukgtq(){ukgtq.__super.call(this)}function gifuk(){}var C;function _hn46(){}function mdh6e(){}function dhim(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(i,n){"use strict";for(var t in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var e=Laya[t];e&&e.__isclass&&(n[t]=e)}});