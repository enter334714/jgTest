var m=wx.$g;!function(t,a){a.un,a.uns;var n=a.static,i=a.class,o=a.getset,r=(a.__newvec,laya.utils.Browser),l=(laya.events.Event,laya.events.EventDispatcher),c=laya.resource.HTMLImage,d=laya.utils.Handler,e=laya.display.Input,f=laya.net.Loader,g=(laya.maths.Matrix,laya.renders.Render),p=laya.utils.RunDriver,h=(laya.media.Sound,laya.media.SoundChannel),v=laya.media.SoundManager,_=(laya.display.Stage,laya.net.URL),m=laya.utils.Utils,u=(i(jr$62u,"laya.wx.mini.MiniAdpter"),jr$62u.getJson=function(n){return JSON.parse(n)},jr$62u.init=function(n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),jr$62u._inited||(jr$62u.window=t).navigator.userAgent.indexOf("MiniGame")<0||(jr$62u._inited=!0,jr$62u.isZiYu=i,jr$62u.isPosMsgYu=n,jr$62u.EnvConfig={},jr$62u.isZiYu||(s.setNativeFileDir("/layaairGame"),s.existDir(s.fileNativeDir,d.create(jr$62u,jr$62u.onMkdirCallBack))),jr$62u.window.focus=function(){},a.getUrlPath=function(){},jr$62u.window.logtime=function(n){},jr$62u.window.alertTimeLog=function(n){},jr$62u.window.resetShareInfo=function(){},jr$62u.window.CanvasRenderingContext2D=function(){},jr$62u.window.CanvasRenderingContext2D.prototype=jr$62u.window.wx.createCanvas().getContext("2d").__proto__,jr$62u.window.document.body.appendChild=function(){},jr$62u.EnvConfig.pixelRatioInt=0,p.getPixelRatio=jr$62u.pixelRatio,jr$62u._preCreateElement=r.createElement,r.createElement=jr$62u.createElement,p.createShaderCondition=jr$62u.createShaderCondition,m.parseXMLFromString=jr$62u.parseXMLFromString,e._createInputElement=y._createInputElement,jr$62u.EnvConfig.load=f.prototype.load,f.prototype.load=w.prototype.load,jr$62u.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(s.ziyuFileData[n.url]=n.data)}))},jr$62u.onMkdirCallBack=function(n,i){n||(s.filesListObj=JSON.parse(i.data))},jr$62u.pixelRatio=function(){if(!jr$62u.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return jr$62u.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return jr$62u.EnvConfig.pixelRatioInt},jr$62u.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?jr$62u.onCreateInput(n):"div"==n?((e=jr$62u._preCreateElement(n)).contains=function(n){return null},e.removeChild=function(n){},e):jr$62u._preCreateElement(n):(1==jr$62u.idx?jr$62u.isZiYu?(i=sharedCanvas).style={}:i=t.canvas:i=t.wx.createCanvas(),jr$62u.idx++,i);var i;var e},jr$62u.onCreateInput=function(n){return(n=jr$62u._preCreateElement(n)).focus=y.wxinputFocus,n.blur=y.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},jr$62u.createShaderCondition=function(n){var i=this;return function(){return i[n.replace("this.","")]}},jr$62u.EnvConfig=null,jr$62u.window=null,jr$62u._preCreateElement=null,jr$62u._inited=!1,jr$62u.wxRequest=null,jr$62u.systemInfo=null,jr$62u.version="0.0.1",jr$62u.isZiYu=!1,jr$62u.isPosMsgYu=!1,jr$62u.parseXMLFromString=function(n){var i;n=n.replace(/>\s+</g,"><");try{i=(new t.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return i},jr$62u.idx=1,jr$62u),y=(i(l9sgc8,"laya.wx.mini.MiniImage"),l9sgc8.prototype._loadImage=function(n){var i=!1;-1==n.indexOf("layaNativeDir/")&&(i=!0,n=_.formatURL(n)),s.getFileInfo(n)?l9sgc8.onCreateImage(n,this,!i):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?s.downImg(n,new d(l9sgc8,l9sgc8.onDownImgCallBack,[n,this]),n):l9sgc8.onCreateImage(n,this,!0)},l9sgc8.onDownImgCallBack=function(n,i,e){e?i.onError(null):l9sgc8.onCreateImage(n,i)},l9sgc8.onCreateImage=function(i,e,n){var t;function yh1w(){t.onload=null,t.onerror=null,delete e.imgCache[i]}function ya(){yh1w(),e.onLoaded(t)}function za(){yh1w(),e.event("error","Load image failed")}n=(n=void 0!==n&&n)?i:(n=s.getFileInfo(i).md5,s.getFileNativePath(n)),null==e.imgCache&&(e.imgCache={}),"nativeimage"==e._type?((t=new r.window.Image).crossOrigin="",t.onload=ya,t.onerror=za,t.src=n,e.imgCache[i]=t):new c.create(n,{onload:ya,onerror:za,onCreate:function(n){t=n,e.imgCache[i]=n}})},i(gqv7c,"laya.wx.mini.MiniInput"),gqv7c._createInputElement=function(){e._initInput(e.area=r.createElement("textarea")),e._initInput(e.input=r.createElement("input")),e.inputContainer=r.createElement("div"),e.inputContainer.style.position="absolute",e.inputContainer.style.zIndex=1e5,r.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(n,i){e.inputContainer.style.left=n+"px",e.inputContainer.style.top=i+"px"},a.stage.on("resize",null,gqv7c._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){t.dispatchEvent&&t.dispatchEvent("resize")}),v._soundClass=x,v._musicClass=x},gqv7c._onStageResize=function(){a.stage._canvasTransform.identity().scale(r.width/g.canvas.width/p.getPixelRatio(),r.height/g.canvas.height/p.getPixelRatio())},gqv7c.wxinputFocus=function(n){var i=e.inputElement.target;i&&!i.editable||(u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),u.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"",i.text=n,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),u.window.wx.onKeyboardInput(function(n){n=n?n.value:"",i.multiline||-1==n.indexOf("\n")?(i.text=n,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},gqv7c.inputEnter=function(){e.inputElement.target.focus=!1},gqv7c.wxinputblur=function(){gqv7c.hideKeyboard()},gqv7c.hideKeyboard=function(){u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},gqv7c),w=(i(bp_t0,"laya.wx.mini.MiniLoader"),(C=bp_t0.prototype).load=function(n,i,e,t,o){void 0===e&&(e=!0),void 0===o&&(o=!1);var a=this;0===(a._url=n).indexOf("data:image")?a._type=i="image":a._type=i=i||a.getTypeFromUrl(n),a._cache=e,a._data=null;var r="ascii";-1!=n.indexOf(".fnt")?r="utf8":"arraybuffer"==i&&(r="");var l=m.getFileExtension(n);if(-1!=bp_t0._fileTypeArr.indexOf(l))u.EnvConfig.load.call(this,n,i,e,t,o);else if(s.getFileInfo(n))u.EnvConfig.load.call(this,n,i,e,t,o);else{if(-1!=n.indexOf("layaNativeDir/"))return u.isZiYu?(l=s.ziyuFileData[n],void a.onLoaded(l)):(cosnole.log("read read"),void s.read(n,r,new d(bp_t0,bp_t0.onReadNativeCallBack,[r,n,i,e,t,o,a])));l=""==_.rootPath?n:n.split(_.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?u.EnvConfig.load.call(a,n,i,e,t,o):s.readFile(l,r,new d(bp_t0,bp_t0.onReadNativeCallBack,[r,n,i,e,t,o,a]),n)}},C.resMgrLoad=function(n,t,i,e,o,a,r){void 0===i&&(i=0),void 0===e&&(e=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===r&&(r=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),u.EnvConfig.resMgrLoad(n,(n,i,e)=>{bp_t0.prototype.resMgrLoadCallBack(n,i,e,t)},i,e,o,a,r)},C.resMgrLoadCallBack=function(n,i,e,t){console.log("buff:::",n,e,s.fileNativeDir+"///"+s.fileListName),t(n,i,e)},C.clearRes=function(n,i){this.clearRes(n,i=void 0!==i&&i),!(i=s.getFileInfo(n))||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=i.md5,i=s.getFileNativePath(n),s.remove(i))},bp_t0.onReadNativeCallBack=function(n,i,e,t,o,a,r,l,s){void 0===t&&(t=!0),void 0===a&&(a=!1),(l=void 0===l?0:l)?1==l&&u.EnvConfig.load.call(r,i,e,t,o,a):(l="json"==e||"atlas"==e?u.getJson(s.data):"xml"==e?m.parseXMLFromString(s.data):s.data,r.onLoaded(l),!u.isZiYu&&u.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:i,data:l,isLoad:!0}))},n(bp_t0,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),bp_t0),s=(i(sgc98,"laya.wx.mini.MiniFileMgr",l),sgc98.isLoadFile=function(n){return-1!=sgc98._fileTypeArr.indexOf(n)},sgc98.getFileInfo=function(n){return n=n.split("?")[0],null==(n=sgc98.filesListObj[n])?null:n},sgc98.onFileUpdate=function(n,i){var n=(n=n.split("/"))[n.length-1],e=sgc98.getFileInfo(i);null==e?sgc98.onSaveFile(i,n):e.readyUrl!=i&&sgc98.remove(n,i)},sgc98.exits=function(n,i){n=sgc98.getFileNativePath(n),sgc98.fs.getFileInfo({filePath:n,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){null!=i&&i.runWith([1,n])}})},sgc98.read=function(n,i,e,t){void 0===i&&(i="ascill"),n=""!=(t=void 0===t?"":t)?sgc98.getFileNativePath(n):n,sgc98.fs.readFile({filePath:n,encoding:i,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){n&&""!=t?sgc98.down(t,i,e,t):null!=e&&e.runWith([1])}})},sgc98.readNativeFile=function(n,i){sgc98.fs.readFile({filePath:n,encoding:"",success:function(n){null!=i&&i.runWith([0])},fail:function(n){null!=i&&i.runWith([1])}})},sgc98.down=function(n,i,e,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var o=sgc98.getFileNativePath(t);sgc98.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&sgc98.readFile(n.filePath,i,e,t)},fail:function(n){null!=e&&e.runWith([1,n])}}).onProgressUpdate(function(n){null!=e&&e.runWith([2,n.progress])})},sgc98.readFile=function(i,n,e,t){void 0===t&&(t=""),sgc98.fs.readFile({filePath:i,encoding:n=void 0===n?"ascill":n,success:function(n){-1==i.indexOf("http://")&&-1==i.indexOf("https://")||sgc98.onFileUpdate(i,t),null!=e&&e.runWith([0,n])},fail:function(n){n&&null!=e&&e.runWith([1,n])}})},sgc98.downImg=function(n,i,e){void 0===e&&(e=""),sgc98.wxdown({url:n,success:function(n){200===n.statusCode&&sgc98.copyFile(n.tempFilePath,e,i)},fail:function(n){null!=i&&i.runWith([1,n])}})},sgc98.copyFile=function(n,i,e){var t=(a=n.split("/"))[a.length-1],o=(i.split("?")[0],sgc98.getFileInfo(i)),a=sgc98.getFileNativePath(t);sgc98.fs.copyFile({srcPath:n,destPath:a,success:function(n){o?o.readyUrl!=i&&sgc98.remove(t,i,e):(sgc98.onSaveFile(i,t),null!=e&&e.runWith([0]))},fail:function(n){null!=e&&e.runWith([1,n])}})},sgc98.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},sgc98.remove=function(i,e,t){void 0===e&&(e="");var n=sgc98.getFileInfo(e),o=sgc98.getFileNativePath(n.md5);a.loader.clearRes(n.readyUrl),sgc98.fs.unlink({filePath:o,success:function(n){""!=e&&sgc98.onSaveFile(e,i),null!=t&&t.runWith([0])},fail:function(n){}})},sgc98.onSaveFile=function(n,i){var e=n.split("?")[0];sgc98.filesListObj[e]={md5:i,readyUrl:n},sgc98.fs.writeFile({filePath:sgc98.fileNativeDir+"/"+sgc98.fileListName,encoding:"utf8",data:JSON.stringify(sgc98.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},sgc98.existDir=function(n,i){sgc98.fs.mkdir({dirPath:n,success:function(n){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?sgc98.readSync(sgc98.fileListName,"utf8",i):null!=i&&i.runWith([1,n])}})},sgc98.readSync=function(n,i,e,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var o,i=sgc98.getFileNativePath(n);try{o=sgc98.fs.readFileSync(i),null!=e&&e.runWith([0,{data:o}])}catch(n){null!=e&&e.runWith([1])}},sgc98.readCache=function(){},sgc98.writeCache=function(n){var i=readyUrl.split("?")[0];sgc98.filesListObj[i]={md5:md5Name,readyUrl:readyUrl},sgc98.fs.writeFile({filePath:sgc98.fileNativeDir+"/"+sgc98.fileListName,encoding:"utf8",data:JSON.stringify(sgc98.filesListObj),success:function(n){},fail:function(n){}})},sgc98.setNativeFileDir=function(n){sgc98.fileNativeDir=wx.env.USER_DATA_PATH+n},sgc98.filesListObj={},sgc98.fileNativeDir=null,sgc98.fileListName="layaairfiles.txt",sgc98.ziyuFileData={},n(sgc98,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),sgc98),x=(i(rdj6z2,"laya.wx.mini.MiniSound",l),(C=rdj6z2.prototype).load=function(n){var i=this;var e;function _4pt0f(){if(null!=rdj6z2._null)i._sound.onCanplay(rdj6z2._null),i._sound.onError(rdj6z2._null);else try{i._sound.onCanplay(null),i._sound.onError(null),rdj6z2._null=null}catch(n){console.warn("[wxmini] _clearSound:"+n),i._sound.onCanplay(w7yeqv),i._sound.onError(w7yeqv),rdj6z2._null=w7yeqv}}function w7yeqv(){}n=_.formatURL(n),this.url=n,rdj6z2._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){_4pt0f(),e.loaded=!0,e.event("complete"),rdj6z2._audioCache[e.url]=e}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),_4pt0f(),e.event("error")}),this._sound.src=n,e=this)},C.play=function(n,i){void 0===n&&(n=0),void 0===i&&(i=0),(e=this.url==v._tMusic?(rdj6z2._musicAudio||(rdj6z2._musicAudio=rdj6z2._createSound()),rdj6z2._musicAudio):rdj6z2._createSound()).src=this.url;var e=new j(e);return e.url=this.url,e.loops=i,e.startTime=n,e.play(),v.addChannel(e),e},C.dispose=function(){var n=rdj6z2._audioCache[this.url];n&&(n.src="",delete rdj6z2._audioCache[this.url])},o(0,C,"duration",function(){return this._sound.duration}),rdj6z2._createSound=function(){return rdj6z2._id++,u.window.wx.createInnerAudioContext()},rdj6z2._musicAudio=null,rdj6z2._id=0,rdj6z2._audioCache={},rdj6z2._null=void 0,rdj6z2),j=(i(cq8gls,"laya.wx.mini.MiniSoundChannel",h),(n=cq8gls.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,v.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){if(this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=cq8gls._null)this._audio.onEnded(cq8gls._null);else try{this._audio.onEnded(null),cq8gls._null=null}catch(n){console.warn("[wxmini] stop:"+n),this._audio.onEnded(m.bind(this.__onNull,this)),cq8gls._null=m.bind(this.__onNull,this)}this._audio=null}},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},o(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),o(0,n,"duration",function(){return this._audio?this._audio.duration:0}),o(0,n,"volume",function(){return 1},function(n){}),cq8gls._null=void 0,cq8gls);function cq8gls(n){this._audio=null,this._onEnd=null,cq8gls.__super.call(this),this._audio=n,this._onEnd=m.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function rdj6z2(){this._sound=null,this.url=null,this.loaded=!1,rdj6z2.__super.call(this),this._sound=rdj6z2._createSound()}function sgc98(){sgc98.__super.call(this)}function bp_t0(){}var C;function gqv7c(){}function l9sgc8(){}function jr$62u(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,i){"use strict";for(var e in Object.defineProperty(i,"__esModule",{value:!0}),Laya){var t=Laya[e];t&&t.__isclass&&(i[e]=t)}});