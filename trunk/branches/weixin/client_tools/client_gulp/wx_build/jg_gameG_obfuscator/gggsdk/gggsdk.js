var m=wx.$g;let hortor=require(m[28800]);let hortorSdk=hortor.sdk;let wallSDK=hortorSdk.wallSDK;let partner_config=hortor.config;let wxapm=hortor.wxapm;var config={game_id:m[28801],game_pkg:m[28802],partner_label:m[28803],partner_id:m[28804],game_ver:m[28805],partner_game_id:m[28806],is_auth:!1};window.config=config;var partner_user_data={};var G$V3J20=G$VJ023();var HOST=m[28807];var G$V3J02=null;var G$VJ203=null;var system=wx.getSystemInfoSync();var device=system.platform==m[28257]?m[28257]:m[28256];var userInfoBtn="";var checkHandler=null;var loginHandler=null;var requestCallback=!1;function G$VJ023(){var s={};return{order_data:{},init:function(e,r){var o=e&&e.game_ver?e.game_ver:0;console.log(m[28808]);var t=this;var n;n=wx.getStorageSync(m[28809])?0:(n=t.uuid(16,32),wx.setStorageSync(m[28809],n),1),wx.getStorageSync(m[28810])||(a=t.uuid(16,32),wx.setStorageSync(m[28810],a));var a=wx.getLaunchOptionsSync();var i=a.scene||"";n&&a.query&&a.query.ad_code&&wx.setStorageSync(m[28811],a.query.ad_code),t.log(m[278],{install:n,scene:i}),partner_config[m[28812]]&&(partner_config[m[28812]]=e.game_ver),hortor.init(partner_config),t=a.query&&a.query.invite?a.query.invite:"",e=a.query&&a.query.invite_type?a.query.invite_type:"",t&&(G$VJ203={invite:t,invite_type:e,is_new:n,scene:i}),o&&this.checkGameVersion(o,function(o){hortorSdk.checkSwitches({switches:[m[28451],m[28813],m[28814],m[28815]]}).then(e=>{console.log(m[28816],e),o.is_share=e.share?1:0,o.show_pay=e.iospay?1:0,o.is_vipds=e.vipds?1:0,o.is_gzgzh=e.gzgzh?1:0,o.is_skip_create_role=o.skip_create_role?1:0,r&&r(o)}).catch(e=>{console.log(`获取失败，errCode=${e.errCode} errMsg=`+e.errMsg),r&&r(o)})})},login:function(e,o){console.log(m[28817]),console.log(m[28818]+Date.now());var r=this;s[m[28363]]=typeof o==m[28097]?o:null;var t=(o=wx.getSystemInfoSync()).screenWidth;o=o.screenHeight;var n=2*t/4;var a=n/4;var i=(t-n)/2;var l=o/2;config.is_auth?wx.getSetting({success:function(e){if(e.authSetting[m[28819]])hortorSdk.login().then(e=>{console.log(m[28820]+JSON.stringify(e)),r.do_login(e)}).catch(e=>{console.log(m[28821],e)});else{const o=hortorSdk.createGetUserInfoBtn({type:m[4110],text:m[28822],style:{left:i,top:l,width:n,height:a,lineHeight:a,backgroundColor:m[28823],color:m[4134],textAlign:m[1505],fontSize:16,borderRadius:4}});o&&(o.show(),o.onTap(e=>{e&&e.userInfo?(console.log(m[28824]),hortorSdk.login().then(e=>{console.log(m[28820]+JSON.stringify(e)),r.do_login(e)}).catch(e=>{console.log(m[28821],e)}),o.hide()):r.weak_login()}))}},fail:function(){r.weak_login()}}):r.weak_login()},weak_login:function(){hortorSdk.weakLogin().then(e=>{console.log(m[28825],e),this.do_login(e)}).catch(e=>{console.log(m[28826],e),s[m[28363]]&&s[m[28363]](1,{errMsg:m[28827]})})},do_login:function(e){var t=this;var o=t.getPublicData();if(o[m[28828]]=e.encryptUserInfo||e.userInfo,o[m[28829]]=e.timestamp,o[m[10863]]=e.sign,o[m[28830]]=1,G$VJ203&&typeof G$VJ203==m[273])for(var r in G$VJ203)o[r]=G$VJ203[r];var n=Date.now();wx.request({url:m[24803]+HOST+m[28831],method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:o,success:function(e){if(console.log(m[28832]+JSON.stringify(e)),requestCallback=!0,loginHandler&&clearTimeout(loginHandler),loginHandler=null,200==e.statusCode){var o=e.data;if(o.state){partner_user_data.uid=o.data.openid,partner_user_data.uniqueIdNew=o.data.ext.uniqueId;try{wx.setStorageSync(m[28833],o.data.sdk_token),wx.setStorageSync(m[28834],o.data.user_id),wx.setStorageSync(m[28835],o.data.username),o.data.ext&&wx.setStorageSync(m[28836],o.data.ext)}catch(e){}var r={userid:o.data.user_id,account:o.data.nick_name,token:o.data.token,openid:o.data.ext.uniqueId,invite_uid:o.data.invite_uid||"",invite_nickname:o.data.invite_nickname||"",invite_head_img:o.data.invite_head_img||"",head_img:o.data.head_img||"",is_client:o.data.is_client||"0",ios_pay:o.data.ios_pay||"0"};s[m[28363]]&&s[m[28363]](0,r)}else s[m[28363]]&&s[m[28363]](1,{type:m[28837],errMsg:o.msg,time:Date.now()-n,res:e});hortorSdk.setGameUserInfo(),t.getShareInfo(m[28838],function(e){console.log(m[28839]);var o=m[322];var r=hortorSdk.getShareData({shareType:o});console.log(m[28840],JSON.stringify(r)),wx.onShareAppMessage(function(){return t.logStartShare(m[28838]),hortorSdk.sharePointShow(o),{title:r.title,imageUrl:r.imageUrl,query:r.query+"&"+e.query}})})}else s[m[28363]]&&s[m[28363]](1,{type:m[28837],errMsg:m[28841],time:Date.now()-n,res:e})},fail:function(e){console.log(m[28842]),console.log(e),requestCallback=!0,loginHandler&&clearTimeout(loginHandler),loginHandler=null,s[m[28363]]&&s[m[28363]](1,{type:m[28843],errMsg:e.errMsg,time:Date.now()-n,res:e})}}),requestCallback||(loginHandler=setTimeout(function(){console.log(m[28844]),s[m[28363]]&&s[m[28363]](1,{type:m[28845],errMsg:m[28846],time:Date.now()-n}),s[m[28363]]=null},2e4))},share:function(e){s[m[28451]]=typeof callback==m[28097]?callback:null;var t=e.type||m[28451];console.log(m[28847]+t);var n=this;this.getShareInfo(t,function(e){var o=m[28848];var r=hortorSdk.getShareData({shareType:o});console.log(m[28849],r),n.logStartShare(t),hortorSdk.sharePointShow(o),wx.shareAppMessage({title:r.title,imageUrl:r.imageUrl,query:r.query+"&"+e.query})})},logStartShare:function(e){var o=wx.getStorageSync(m[28833]);wx.request({url:m[24803]+HOST+m[28850],method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:o,server_id:G$V3J02?G$V3J02.server_id:"",role_id:G$V3J02?G$V3J02.role_id:"",type:e},success:function(e){}})},is_authorize:function(o){console.log(m[28851]),wx.getSetting({success:function(e){e.authSetting[m[28819]]?o(1):o(0)}})},go_authorize:function(e,o){console.log(m[28852]),(userInfoBtn=hortorSdk.createGetUserInfoBtn({type:m[4383],image:m[28853],style:{left:e.left,top:e.top,width:e.width,height:e.height,lineHeight:e.height,textAlign:m[1505],fontSize:16,borderRadius:4}}))&&(userInfoBtn.show(),userInfoBtn.onTap(e=>{e&&e.userInfo?(console.log(m[28824]),hortorSdk.updateUserInfo().then(e=>{console.log(m[28854],e),o(1)}).catch(e=>{console.log(m[28855],e),o(0)})):(console.log(m[28856]),o(0)),userInfoBtn.hide()}))},hideUserInfoBtn:function(){userInfoBtn&&userInfoBtn.hide()},openService:function(){hortorSdk.customerService({showMessageCard:!0,success:e=>{console.log(m[28857],e)},fail:e=>{console.log(m[28858],e)}})},goCustomer:function(e){hortorSdk.goCustomer({playerId:e.roleid,playerName:e.rolename}).then(e=>{console.log(m[28859])}).catch(e=>{console.log(m[28860],e)})},checkGameVersion:function(e,o){console.log(m[28861]),s[m[6746]]=typeof o==m[28097]?o:null,wx.getStorageSync(m[28833]),wx.request({url:m[24803]+HOST+"/game/min/?ac=checkGameVersion",method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:e},success:function(e){var o;console.log(m[28862]),console.log(e),requestCallback=!0,checkHandler&&clearTimeout(checkHandler),checkHandler=null,200==e.statusCode&&(o=e.data).state?s[m[6746]]&&s[m[6746]](o.data):s[m[6746]]&&s[m[6746]]({develop:0})},fail:function(e){console.log(m[28863]),console.log(e),requestCallback=!0,checkHandler&&clearTimeout(checkHandler),checkHandler=null,s[m[6746]]&&s[m[6746]]({develop:0})}}),requestCallback||(checkHandler=setTimeout(function(){console.log(m[28864]),s[m[6746]]&&s[m[6746]]({develop:0}),s[m[6746]]=null},1e4))},getShareInfo:function(e,o){console.log(m[28865]);var r=wx.getStorageSync(m[28833]);wx.request({url:m[24803]+HOST+m[28866],method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:r,type:e,server_id:G$V3J02?G$V3J02.server_id:"",role_id:G$V3J02?G$V3J02.role_id:"",no_log:1},success:function(e){console.log(m[28867]),console.log(e),200==e.statusCode?(e=e.data).state?o&&o(e.data):s[m[28451]]&&s[m[28451]](1,{errMsg:m[28868]+e.msg}):s[m[28451]]&&s[m[28451]](1,{errMsg:m[28869]})}})},updateShare:function(e,o,r,t,n,a){console.log(m[28870]);var i=wx.getStorageSync(m[28833]);wx.request({url:m[24803]+HOST+m[28871],method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:i,invite:e,invite_type:o,is_new:r,role_id:t,sever_id:n,scene:a},success:function(e){console.log(m[28872]),console.log(e)}})},msgCheck:function(e,o){console.log(m[28873]);var r=wx.getStorageSync(m[28833]);wx.request({url:m[24803]+HOST+m[28874]+config.partner_id+"/"+config.game_pkg,method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:r,content:e,uId:partner_user_data.uid},success:function(e){console.log(m[28875]),console.log(e),o&&o(e)}})},isSubscribe:function(o){console.log(m[28876]);var e=wx.getStorageSync(m[28836]);wx.request({url:m[24803]+HOST+m[28877]+config.partner_id+"/"+config.game_pkg,method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{openid:e.uniqueId},success:function(e){console.log(m[28878],e),1==e.data.state?o({status:1}):o({status:0})}})},pay:function(e,o){this.startPay(e,o)},startPay:function(e,o){console.log(m[28879]),console.log(e),s[m[28435]]=typeof o==m[28097]?o:null,o=wx.getStorageSync(m[28833]);var r=wx.getStorageSync(m[28836]);var t;o||r?(t=wx.getSystemInfoSync(),e={cpbill:e.cpbill,productid:e.productid,productname:e.productname,productdesc:e.productdesc,serverid:e.serverid,servername:e.servername,roleid:e.roleid,rolename:e.rolename,rolelevel:e.rolelevel,price:e.price,extension:e.extension,sdk_token:o,session_key:r,platform:t.platform},this.order_data=e,(o=this.getPublicData())[m[28881]]=JSON.stringify(e),o[m[28830]]=1,wx.request({url:m[24803]+HOST+m[28882],method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:o,success:function(e){console.log(m[28883]),console.log(e),200===e.statusCode?(e=e.data).state&&e.data.pay_data?(console.log(m[28884]+JSON.stringify(e.data.pay_data)),device===m[28256]?(console.log(m[28885]),hortorSdk.jumpPay(e.data.pay_data).then(e=>{console.log(m[28859])}).catch(e=>{console.log(m[28860],e),s[m[28435]]&&s[m[28435]](1,{errMsg:e.errMsg})})):(console.log(m[28886]),hortorSdk.midasPay(e.data.pay_data).then(e=>{console.log(m[28887])}).catch(e=>{console.log(m[28888],e),s[m[28435]]&&s[m[28435]](1,{errMsg:e.errMsg})}))):s[m[28435]]&&s[m[28435]](1,{errMsg:e.msg}):s[m[28363]]&&s[m[28363]](1,{errMsg:m[28841]})}})):s[m[28435]]&&s[m[28435]](1,{errMsg:m[28880]})},logCreateRole:function(e){var o=wx.getStorageSync(m[28834]);var r=wx.getStorageSync(m[28835]);var t=wx.getStorageSync(m[28836]);var n={};n[m[28889]]=o,n[m[28890]]=r,n[m[10256]]=e.roleid,n[m[28891]]=e.rolelevel,n[m[28892]]=e.rolename,n[m[10878]]=e.serverid,e.roleid&&e.serverid&&(G$V3J02={role_id:e.roleid,server_id:e.serverid}),this.log(m[6],n),o={roleId:e.roleid,roleName:e.rolename,serverId:e.serverid,level:e.rolelevel,roleCtime:Date.parse(new Date),id:t.uniqueId},hortorSdk.setGameUserInfo(o),this.roleCreateReport(0)},roleCreateReport:function(e=1){wx.request({url:m[24803]+HOST+m[28893]+config.partner_id+"/"+config.game_pkg,method:m[28335],dataType:m[5501],header:{"content-type":m[28483]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,uniqueId:partner_user_data.uid,is_valid:1===e?1:0},success:function(e){console.log(m[28894],e)}})},logEnterGame:function(e,r){var o=wx.getStorageSync(m[28834]);var t=wx.getStorageSync(m[28835]);var n=wx.getStorageSync(m[28836]);var a={};a[m[28889]]=o,a[m[28890]]=t,a[m[10256]]=e.roleid,a[m[28891]]=e.rolelevel,a[m[28892]]=e.rolename,a[m[10878]]=e.serverid,e.roleid&&e.serverid&&(G$V3J02={role_id:e.roleid,server_id:e.serverid}),hortorSdk.checkSwitches({switches:[m[28895]]}).then(e=>{console.log(m[28896],e),e.antiaddicted&&hortorSdk.checkRest(()=>{console.log(m[28897])})}).catch(e=>{console.log(`[SDK]检查防沉迷开关返回失败，errCode=${e.errCode} errMsg=`+e.errMsg)}),this.log(m[5383],a),o={roleId:e.roleid,roleName:e.rolename,serverId:e.serverid,level:e.rolelevel,roleCtime:e.rolecreatetime?1e3*e.rolecreatetime:0,id:n.uniqueId},hortorSdk.setGameUserInfo(o),G$VJ203&&this.updateShare(G$VJ203.invite,G$VJ203.invite_type,G$VJ203.is_new,e.roleid,e.serverid,G$VJ203.scene),hortorSdk.checkSwitches({switches:[m[28813]]}).then(e=>{console.log(m[28898],e);var o=0;e.iospay&&(o=1),r&&r({show_pay:o})}).catch(e=>{console.log(`[SDK]获取支付开关返回失败，errCode=${e.errCode} errMsg=`+e.errMsg),r&&r({show_pay:0})})},logRoleUpLevel:function(e,r){var o=wx.getStorageSync(m[28834]);var t=wx.getStorageSync(m[28835]);var n=wx.getStorageSync(m[28836]);var a={};a[m[28889]]=o,a[m[28890]]=t,a[m[10256]]=e.roleid,a[m[28891]]=e.rolelevel,a[m[28892]]=e.rolename,a[m[10878]]=e.serverid,e.roleid&&e.serverid&&(G$V3J02={role_id:e.roleid,server_id:e.serverid}),this.log(m[28899],a),o={roleId:e.roleid,roleName:e.rolename,serverId:e.serverid,level:e.rolelevel,roleCtime:e.rolecreatetime?1e3*e.rolecreatetime:0,id:n.uniqueId},hortorSdk.setGameUserInfo(o),80<=e.rolelevel&&this.roleCreateReport(1),hortorSdk.checkSwitches({switches:[m[28813]]}).then(e=>{console.log(m[28898],e);var o=0;e.iospay&&(o=1),r&&r({show_pay:o})}).catch(e=>{console.log(`[SDK]获取支付开关返回失败，errCode=${e.errCode} errMsg=`+e.errMsg),r&&r({show_pay:0})})},uuid:function(e,o){var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t,n=[];var a;if(e=e||r.length,o)for(t=0;t<o;t++)n[t]=r[0|Math.random()*e];else for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(a=0|16*Math.random(),n[t]=r[19==t?3&a|8:a]);return n.join("")},getPublicData:function(){var e=wx.getSystemInfoSync();var o=wx.getStorageSync(m[28809]);var r=wx.getStorageSync(m[28810]);var t=wx.getStorageSync(m[28811]);return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,partner_label:config.partner_label,ad_code:t,uuid:o,idfv:r,dname:e.model,mac:m[28900],net_type:0==e.wifiSignal?"4G":m[28901],os_ver:e.system,sdk_ver:e.version,game_ver:config.game_ver,device:e.platform==m[28257]?1:2}},log:function(e,o){var r=this.getPublicData();for(var t in o)r[t]=o[t];console.log(m[28902]+e),console.log(r),wx.request({url:m[24803]+HOST+m[28903]+e+m[28904]+encodeURIComponent(JSON.stringify(r))})},getDate:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},downloadClient:function(){wx.openCustomerServiceConversation()}}}function run(e,o,r){e in G$V3J20&&G$V3J20[e](o,r)}exports.init=function(e,o){run(m[359],e,o)},exports.login=function(e){run(m[28363],"",e)},exports.pay=function(e,o){run(m[28435],e,o)},exports.openService=function(){run(m[24275])},exports.goCustomer=function(e,o,r,t,n,a){run(m[28452],{serverid:e,servername:o,roleid:r,rolename:t,rolelevel:n})},exports.logCreateRole=function(e,o,r,t,n){run(m[28447],{serverid:e,servername:o,roleid:r,rolename:t,rolelevel:n})},exports.logEnterGame=function(e,o,r,t,n,a,i){run("logEnterGame",{serverid:e,servername:o,roleid:r,rolename:t,rolelevel:n,rolecreatetime:a,rolepower:i.rolepower},i.callback)},exports.logRoleUpLevel=function(e,o,r,t,n,a,i){e={serverid:e,servername:o,roleid:r,rolename:t,rolelevel:n,rolecreatetime:a,rolepower:i?i.rolepower:""},run(m[28450],e,i?i.callback:null)},exports.share=function(e){run(m[28451],{type:e})},exports.msgCheck=function(e,o){run(m[11492],e,o)},exports.downloadClient=function(){run(m[28905])},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run(m[28906])},exports.roleCreateReport=function(e){run(m[28907],e)},exports.isSubscribe=function(e){run(m[28908],e)},exports.is_authorize=function(e){run(m[28909],e)},exports.go_authorize=function(e,o){run(m[28910],e,o)},exports.hideUserInfoBtn=function(e){run(m[28911],e)};