var Laya=window.Laya=function($u,$J){var $B={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($J,$o){return 1==arguments.length?$B.__presubstr.call(this,$J):$B.__presubstr.call(this,$J,0<$o?$o:this.length+$o)},__init:function($J){$J.forEach(function($J){$J.__init$&&$J.__init$()})},__isClass:function($J){return $J&&($J.__isclass||$J==Object||$J==String||$J==Array)},__newvec:function($J,$o){var $r=[];$r.length=$J;for(var $S=0;$S<$J;$S++)$r[$S]=$o;return $r},__extend:function($J,$o){for(var $r in $o)if($o.hasOwnProperty($r)){var $S=Object.getOwnPropertyDescriptor($o,$r),$G=$S.get,$z=$S.set;$G||$z?$G&&$z?Object.defineProperty($J,$r,$S):($G&&Object.defineProperty($J,$r,$G),$z&&Object.defineProperty($J,$r,$z)):$J[$r]=$o[$r]}function $A(){$B.un(this,"constructor",$J)}$A.prototype=$o.prototype,$J.prototype=new $A,$B.un($J.prototype,"__imps",$B.__copy({},$o.prototype.__imps))},__copy:function($J,$o){if(!$o)return null;for(var $r in $J=$J||{},$o)$J[$r]=$o[$r];return $J},__package:function($J,$o){if(!$B.__packages[$J]){$B.__packages[$J]=!0;var $r=$u,$S=$J.split(".");if(1<$S.length)for(var $G=0,$z=$S.length-1;$G<$z;$G++){var $A=$r[$S[$G]];$r=$A||($r[$S[$G]]={})}$r[$S[$S.length-1]]||($r[$S[$S.length-1]]=$o||{})}},__hasOwnProperty:function($J,$o){return $o=$o||this,Object.hasOwnProperty.call($o,$J)||function $J($o,$r){if(Object.hasOwnProperty.call($r.prototype,$o))return!0;var $S=$r.prototype.__super;return null==$S?null:$J($o,$S)}($J,$o.__class)},__typeof:function($J,$o){if(!$J||!$o)return!1;if($o===String)return"string"==typeof $J;if($o===Number)return"number"==typeof $J;if($o.__interface__)$o=$o.__interface__;else if("string"!=typeof $o)return $J instanceof $o;return $J.__imps&&$J.__imps[$o]||$J.__class==$o},__as:function($J,$o){return this.__typeof($J,$o)?$J:null},__int:function($J){return $J?parseInt($J):0},interface:function($J,$o){$B.__package($J,{});var $r=$B.__internals,$S=$r[$J]=$r[$J]||{self:$J};if($o){var $G=$o.split(",");$S.extend=[];for(var $z=0;$z<$G.length;$z++){var $A=$G[$z];$r[$A]=$r[$A]||{self:$A},$S.extend.push($r[$A])}}var $h=$u,$Z=$J.split(".");for($z=0;$z<$Z.length-1;$z++)$h=$h[$Z[$z]];$h[$Z[$Z.length-1]]={__interface__:$J}},class:function($J,$o,$r,$S){if($r&&$B.__extend($J,$r),$o)if($B.__package($o,$J),$B.__classmap[$o]=$J,0<$o.indexOf(".")){if(0==$o.indexOf("laya.")){var $G=$o.split(".");$S=$S||$G[$G.length-1],$B[$S]&&console.log("Warning!,this class["+$S+"] already exist:",$B[$S]),$B[$S]=$J}}else"Main"==$o?$u.Main=$J:"MainWX"==$o?$u.MainWX=$J:($B[$o]&&console.log("Error!,this class["+$o+"] already exist:",$B[$o]),$B[$o]=$J);var $z=$B.un,$A=$J.prototype;$z($A,"hasOwnProperty",$B.__hasOwnProperty),$z($A,"__class",$J),$z($A,"__super",$r),$z($A,"__className",$o),$z($J,"__super",$r),$z($J,"__className",$o),$z($J,"__isclass",!0),$z($J,"super",function($J){this.__super.call($J)})},imps:function($J,$o){if(!$o)return null;var $G=$J.__imps||$B.un($J,"__imps",{});function $z($J){var $o,$r;if(($o=$B.__internals[$J])&&($G[$J]=!0,$r=$o.extend))for(var $S=0;$S<$r.length;$S++)$z($r[$S].self)}for(var $r in $o)$z($r)},superSet:function($J,$o,$r,$S){var $G=$J.prototype["_$set_"+$r];$G&&$G.call($o,$S)},superGet:function($J,$o,$r){var $S=$J.prototype["_$get_"+$r];return $S?$S.call($o):null},getset:function($J,$o,$r,$S,$G){$J?($S&&($o["_$GET_"+$r]=$S),$G&&($o["_$SET_"+$r]=$G)):($S&&$B.un($o,"_$get_"+$r,$S),$G&&$B.un($o,"_$set_"+$r,$G)),$S&&$G?Object.defineProperty($o,$r,{get:$S,set:$G,enumerable:!1,configurable:!0}):($S&&Object.defineProperty($o,$r,{get:$S,enumerable:!1,configurable:!0}),$G&&Object.defineProperty($o,$r,{set:$G,enumerable:!1,configurable:!0}))},static:function($r,$S){for(var $G=0,$J=$S.length;$G<$J;$G+=2)if("length"==$S[$G])$r.length=$S[$G+1].call($r);else{function $o(){var $o=$S[$G],$J=$S[$G+1];Object.defineProperty($r,$o,{get:function(){return delete this[$o],this[$o]=$J.call(this)},set:function($J){delete this[$o],this[$o]=$J},enumerable:!0,configurable:!0})}$o()}},un:function($J,$o,$r){return $r||($r=$J[$o]),$B.__propun.value=$r,Object.defineProperty($J,$o,$B.__propun),$r},uns:function($o,$J){$J.forEach(function($J){$B.un($o,$J)})}};return $u.console=$u.console||{log:function(){}},$u.trace=$u.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$B}(window,document);!function($J,$o,$r){$r.un,$r.uns,$r.static,$r.class,$r.getset,$r.__newvec}(window,document,Laya),function($A,$o,$y){$y.un,$y.uns;var $Z=$y.static,$D=$y.class,$B=$y.getset;$y.__newvec;$y.interface("laya.runtime.IMarket"),$y.interface("laya.filters.IFilter"),$y.interface("laya.display.ILayout"),$y.interface("laya.resource.IDispose"),$y.interface("laya.runtime.IPlatform"),$y.interface("laya.resource.IDestroy"),$y.interface("laya.runtime.IConchNode"),$y.interface("laya.filters.IFilterAction"),$y.interface("laya.runtime.ICPlatformClass"),$y.interface("laya.resource.ICreateResource"),$y.interface("laya.runtime.IConchRenderObject"),$y.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $R=function(){function $z(){}return $D($z,"laya.utils.RunDriver"),$z.FILTER_ACTIONS=[],$z.pixelRatio=-1,$z._charSizeTestDiv=null,$z.now=function(){return Date.now()},$z.getWindow=function(){return $A},$z.getPixelRatio=function(){if($z.pixelRatio<0){var $J=$d.context,$o=$J.backingStorePixelRatio||$J.webkitBackingStorePixelRatio||$J.mozBackingStorePixelRatio||$J.msBackingStorePixelRatio||$J.oBackingStorePixelRatio||$J.backingStorePixelRatio||1;($z.pixelRatio=($d.window.devicePixelRatio||1)/$o)<1&&($z.pixelRatio=1)}return $z.pixelRatio},$z.getIncludeStr=function($J){return null},$z.createShaderCondition=function($J){var $o="(function() {return "+$J+";})";return $y._runScript($o)},$z.fontMap=[],$z.measureText=function($J,$o){var $r=$z.hanzi.test($J);if($r&&$z.fontMap[$o])return $z.fontMap[$o];var $S=$d.context;$S.font=$o;var $G=$S.measureText($J);return $G||($G={width:16,height:16}),$r&&($z.fontMap[$o]=$G),$G},$z.getWebGLContext=function($J){},$z.beginFlush=function(){},$z.endFinish=function(){},$z.addToAtlas=null,$z.flashFlushImage=function($J){},$z.drawToCanvas=function($J,$o,$r,$S,$G,$z){var $A=$IJ.create("2D"),$h=new $Q($r,$S,$A);return $p.renders[$o]._fun($J,$h,$G,$z),$A},$z.createParticleTemplate2D=null,$z.createGLTextur=null,$z.createWebGLContext2D=null,$z.changeWebGLSize=function($J,$o){},$z.createRenderSprite=function($J,$o){return new $p($J,$o)},$z.createFilterAction=function($J){return new $I},$z.createGraphics=function(){return new $j},$z.clear=function($J){$L._context.ctx.clear()},$z.cancelLoadByUrl=function($J){},$z.clearAtlas=function($J){},$z.isAtlas=function($J){return!1},$z.addTextureToAtlas=function($J){},$z.getTexturePixels=function($J,$o,$r,$S,$G){return null},$z.skinAniSprite=function(){return null},$z.update3DLoop=function(){},$Z($z,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$z}(),$S=($B(1,$y,"alertGlobalError",null,function($J){var $z=0;$d.window.onerror=$J?function($J,$o,$r,$S,$G){$z++<5&&$G&&alert($G.stack||$G)}:null}),$y.init=function($J,$o,$r){for(var $S=[],$G=2,$z=arguments.length;$G<$z;$G++)$S.push(arguments[$G]);if(!$y._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$y._arrayBufferSlice),$y._isinit=!0,$d.__init__(),$f.__init__(),$j.__init__(),$y.timer=new $M,$y.scaleTimer=new $M,$y.loader=new $ZJ,$E.__init__(),$G=0;for(var $A=$S.length;$G<$A;$G++)$S[$G].enable&&$S[$G].enable();return $Y.__init__(),$h.__init__(),$F.__init__(),$c.beginCheck(),$y._currentStage=$y.stage=new $wJ,$y.stage.conchModel&&$y.stage.conchModel.setRootNode(),$y._getUrlPath(),$y.render=new $L(0,0),$y.stage.size($J,$o),$p.__init__(),$v.__init__(),$_.instance.__init__($y.stage,$L.canvas),$KJ.__init__(),$C.autoStopMusic=!0,$V.__init__(),$L.canvas}},$y._getUrlPath=function(){var $J=$d.window.location,$o=$J.pathname;$o=$o&&":"==$o.charAt(2)?$o.substring(1):$o,$U.rootPath=$U.basePath=$U.getPath("file:"==$J.protocol?$o:$J.protocol+"//"+$J.host+$J.pathname)},$y._arrayBufferSlice=function($J,$o){var $r=new Uint8Array(this,$J,$o-$J),$S=new Uint8Array($r.length);return $S.set($r),$S.buffer},$y._runScript=function($J){return $d.window[$y._evcode]($J)},$y.stage=null,$y.timer=null,$y.scaleTimer=null,$y.loader=null,$y.version="1.8.6",$y.render=null,$y._currentStage=null,$y._isinit=!1,$y.isDebug=!1,$y.MiniAdpter={init:function(){$A.navigator&&$A.navigator.userAgent&&-1<$A.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$Z($y,["conchMarket",function(){return this.conchMarket=$A.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$A.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $J(){}return $D($J,"Config"),$J.WebGLTextCacheCount=500,$J.atlasEnable=!1,$J.showCanvasMark=!1,$J.animationInterval=50,$J.isAntialias=!1,$J.isAlpha=!1,$J.premultipliedAlpha=!0,$J.isStencil=!0,$J.preserveDrawingBuffer=!1,$J}()),$u=function(){function $u(){this._events=null}$D($u,"laya.events.EventDispatcher");var $J=$u.prototype;return $J.hasListener=function($J){return!!(this._events&&this._events[$J])},$J.getListener=function($J){return this._events?this._events[$J]:null},$J.event=function($J,$o){if(!this._events||!this._events[$J])return!1;var $r=this._events[$J];if($r.lock)$r.queue||($r.queue=[]),$r.queue.push($o);else{var $S;for($r.lock=!0,$r.cursor=$r.head;$r.cursor;)($S=$r.cursor).recover?($r.head=$r.tail=$r.cursor=null,console.error("node is recover："+$S.id)):($r.cursor=$S.next,$S.once&&$u.delNode($r,$S),$S.method&&(null!=$o?$S.args?$S.method.apply($S.caller,$S.args.concat($o)):$o instanceof Array?$S.method.apply($S.caller,$o):$S.caller?$S.method.call($S.caller,$o):$y.recordError("事件派发错误","node.caller:"+$S.caller+"node.method:"+$S.method+"data:"+$o+"node.prev"+$S.prev):$S.method.apply($S.caller,$S.args)),$S.once&&$u.recoverHandler($S));$r.lock=!1,!$r.head&&this._events&&this._events[$J]==$r&&delete this._events[$J],$r.queue&&$r.queue.length&&this.event($J,$r.queue.shift())}return!0},$J.on=function($J,$o,$r,$S){return this._createListener($J,$o,$r,$S,!1)},$J.once=function($J,$o,$r,$S){return this._createListener($J,$o,$r,$S,!0)},$J._createListener=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=!0),$z&&this.off($J,$o,$r,$G);var $A=$u.createHandler($o||this,$r,$S,$G);this._events||(this._events={});var $h=this._events,$Z=$h[$J];return $Z?$Z.tail?($A.prev=$Z.tail,$Z.tail.next=$A,$Z.tail=$A):$Z.head=$Z.tail=$A:$h[$J]={head:$A,tail:$A,cursor:null,lock:!1},this},$J.off=function($J,$o,$r,$S){if(void 0===$S&&($S=!1),!this._events||!this._events[$J])return this;for(var $G=this._events[$J],$z=$G.head;$z;){if((!$o||$z.caller===$o)&&$z.method===$r&&(!$S||$z.once)){$u.delNode($G,$z),$G.cursor==$z&&($G.cursor=$z.next),$u.recoverHandler($z);break}$z=$z.next}return this},$J.offAll=function($J){var $o=this._events;if(!$o)return this;if($J)this._recoverHandlers($o[$J]),delete $o[$J];else{for(var $r in $o)this._recoverHandlers($o[$r]);this._events=null}return this},$J._recoverHandlers=function($J){if($J){for(var $o=$J.head;$o;){$u.delNode($J,$o);var $r=$o.next;$u.recoverHandler($o),$o=$r}$J.cursor=null}},$J.isMouseEvent=function($J){return $u.MOUSE_EVENTS[$J]},$u.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$u.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$u.delNode=function($J,$o){$o.prev?$o.prev.next=$o.next:$J.head=$o.next,$o.next?$o.next.prev=$o.prev:$J.tail=$o.prev},$u.createHandler=function($J,$o,$r,$S){var $G=500<$u._freeHandler.length?$u._freeHandler.shift():null;if($G)if($G.recover)$G.recover=!1,$G.caller=$J,$G.method=$o,$G.args=$r,$G.once=$S;else{var $z="";try{arguments.propertyIsEnumerable.caller}catch($J){$z=$J.stack}var $A=$G.caller?($G.caller.__proto__&&$G.caller.__proto__.constructor&&$G.caller.__proto__.constructor.name)+"|"+$G.caller.__className+"|"+$G.caller.name:"",$h=$G.method?$G.method.name:"";$y.recordError("EventDispatcher重复创建","caller="+$A+"  method="+$h+"  stack="+$z),$G={id:++$u._nodeCount,caller:$J,method:$o,args:$r,once:$S,recover:!1}}else $G={id:++$u._nodeCount,caller:$J,method:$o,args:$r,once:$S,recover:!1};return $G.prev=$G.next=null,$G},$u.recoverHandler=function($J){if($J.recover){if($u._errorCount<5){$u._errorCount++;var $o="";try{arguments.propertyIsEnumerable.caller}catch($J){$o=$J.stack}var $r=$J.caller?($J.caller.__proto__&&$J.caller.__proto__.constructor&&$J.caller.__proto__.constructor.name)+"|"+$J.caller.__className+"|"+$J.caller.name:"",$S=$J.method?$J.method.name:"";$y.recordError("EventDispatcher重复回收","id="+$J.id+"  caller="+$r+"  method="+$S+"  stack="+$o)}$J.caller=$J.method=$J.args=$J.prev=null}else $J.recover=!0,$J.caller=$J.method=$J.args=$J.prev=$J.next=null,$u._freeHandler&&$u._freeHandler.length<3e3&&$u._freeHandler.push($J)},$u._freeHandler=[],$u._nodeCount=0,$u._errorCount=0,$u}(),$i=function(){function $G($J,$o,$r,$S){this.once=!1,void(this._id=0)===$S&&($S=!1),this.setTo($J,$o,$r,$S)}$D($G,"laya.utils.Handler");var $J=$G.prototype;return $J.setTo=function($J,$o,$r,$S){return this._id=$G._gid++,this.caller=$J,this.method=$o,this.args=$r,this.once=$S,this},$J.run=function(){if(null==this.method)return null;var $J=this._id,$o=this.method.apply(this.caller,this.args);return this._id===$J&&this.once&&this.recover(),$o},$J.runWith=function($J){if(null==this.method)return null;var $o=this._id;if(null==$J)var $r=this.method.apply(this.caller,this.args);else $r=this.args||$J.unshift?this.args?this.method.apply(this.caller,this.args.concat($J)):this.method.apply(this.caller,$J):this.method.call(this.caller,$J);return this._id===$o&&this.once&&this.recover(),$r},$J.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$J.recover=function(){0<this._id&&(this._id=0,this.clear())},$G.create=function($J,$o,$r,$S){return void 0===$S&&($S=!0),new $G($J,$o,$r,$S)},$G._gid=1,$G}(),$m=function(){function $J(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$D($J,"laya.display.BitmapFont");var $o=$J.prototype;return $o.loadFont=function($J,$o){this._path=$J,this._complete=$o,$y.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$i.create(this,this.onLoaded))},$o.onLoaded=function(){this.parseFont($hJ.getRes(this._path),$hJ.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$o.parseFont=function($J,$o){if(null!=$J&&null!=$o){this._texture=$o;var $r=$J.getElementsByTagName("info");if(!$r[0].getAttributeNode)return this.parseFont2($J,$o);this.fontSize=parseInt($r[0].getAttributeNode("size").nodeValue);var $S,$G=$r[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($G[0]),parseInt($G[1]),parseInt($G[2]),parseInt($G[3])],$S=$J.getElementsByTagName("char");var $z=0;for($z=0;$z<$S.length;$z++){var $A=$S[$z],$h=parseInt($A.getAttributeNode("id").nodeValue),$Z=parseInt($A.getAttributeNode("xoffset").nodeValue)/1,$u=parseInt($A.getAttributeNode("yoffset").nodeValue)/1,$B=parseInt($A.getAttributeNode("xadvance").nodeValue)/1,$v=new $s;$v.x=parseInt($A.getAttributeNode("x").nodeValue),$v.y=parseInt($A.getAttributeNode("y").nodeValue),$v.width=parseInt($A.getAttributeNode("width").nodeValue),$v.height=parseInt($A.getAttributeNode("height").nodeValue);var $j=$BJ.create($o,$v.x,$v.y,$v.width,$v.height,$Z,$u);this._maxWidth=Math.max(this._maxWidth,$B+this.letterSpacing),this._fontCharDic[$h]=$j,this._fontWidthMap[$h]=$B}}},$o.parseFont2=function($J,$o){if(null!=$J&&null!=$o){this._texture=$o;var $r=$J.getElementsByTagName("info");this.fontSize=parseInt($r[0].attributes.size.nodeValue);var $S=$r[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($S[0]),parseInt($S[1]),parseInt($S[2]),parseInt($S[3])];var $G=$J.getElementsByTagName("char"),$z=0;for($z=0;$z<$G.length;$z++){var $A=$G[$z].attributes,$h=parseInt($A.id.nodeValue),$Z=parseInt($A.xoffset.nodeValue)/1,$u=parseInt($A.yoffset.nodeValue)/1,$B=parseInt($A.xadvance.nodeValue)/1,$v=new $s;$v.x=parseInt($A.x.nodeValue),$v.y=parseInt($A.y.nodeValue),$v.width=parseInt($A.width.nodeValue),$v.height=parseInt($A.height.nodeValue);var $j=$BJ.create($o,$v.x,$v.y,$v.width,$v.height,$Z,$u);this._maxWidth=Math.max(this._maxWidth,$B+this.letterSpacing),this._fontCharDic[$h]=$j,this._fontWidthMap[$h]=$B}}},$o.getCharTexture=function($J){return this._fontCharDic[$J.charCodeAt(0)]},$o.destroy=function(){if(this._texture){for(var $J in this._fontCharDic){var $o=this._fontCharDic[$J];$o&&$o.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$o.setSpaceWidth=function($J){this._spaceWidth=$J},$o.getCharWidth=function($J){var $o=$J.charCodeAt(0);return this._fontWidthMap[$o]?this._fontWidthMap[$o]+this.letterSpacing:" "==$J?this._spaceWidth+this.letterSpacing:0},$o.getTextWidth=function($J){for(var $o=0,$r=0,$S=$J.length;$r<$S;$r++)$o+=this.getCharWidth($J.charAt($r));return $o},$o.getMaxWidth=function(){return this._maxWidth},$o.getMaxHeight=function(){return this.fontSize},$o.drawText=function($J,$o,$r,$S,$G,$z){var $A,$h=this.getTextWidth($J),$Z=0;"center"===$G&&($Z=($z-$h)/2),"right"===$G&&($Z=$z-$h);for(var $u=0,$B=0,$v=$J.length;$B<$v;$B++)($A=this.getCharTexture($J.charAt($B)))&&($o.graphics.drawTexture($A,$r+$u+$Z,$S),$u+=this.getCharWidth($J.charAt($B)))},$J}(),$h=function(){function $r(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$r._TF_EMPTY}$D($r,"laya.display.css.Style");var $J=$r.prototype;return $J.getTransform=function(){return this._tf},$J.setTransform=function($J){this._tf="none"!==$J&&$J?$J:$r._TF_EMPTY},$J.setTranslateX=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.translateX=$J},$J.setTranslateY=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.translateY=$J},$J.setScaleX=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.scaleX=$J},$J.setScale=function($J,$o){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.scaleX=$J,this._tf.scaleY=$o},$J.setScaleY=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.scaleY=$J},$J.setRotate=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.rotate=$J},$J.setSkewX=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.skewX=$J},$J.setSkewY=function($J){this._tf===$r._TF_EMPTY&&(this._tf=new $G),this._tf.skewY=$J},$J.destroy=function(){this.scrollRect=null},$J.render=function($J,$o,$r,$S){},$J.getCSSStyle=function(){return $oJ.EMPTY},$J._enableLayout=function(){return!1},$B(0,$J,"scaleX",function(){return this._tf.scaleX},function($J){this.setScaleX($J)}),$B(0,$J,"transform",function(){return this.getTransform()},function($J){this.setTransform($J)}),$B(0,$J,"translateX",function(){return this._tf.translateX},function($J){this.setTranslateX($J)}),$B(0,$J,"translateY",function(){return this._tf.translateY},function($J){this.setTranslateY($J)}),$B(0,$J,"scaleY",function(){return this._tf.scaleY},function($J){this.setScaleY($J)}),$B(0,$J,"block",function(){return 0!=(1&this._type)}),$B(0,$J,"skewY",function(){return this._tf.skewY},function($J){this.setSkewY($J)}),$B(0,$J,"rotate",function(){return this._tf.rotate},function($J){this.setRotate($J)}),$B(0,$J,"skewX",function(){return this._tf.skewX},function($J){this.setSkewX($J)}),$B(0,$J,"paddingLeft",function(){return 0}),$B(0,$J,"paddingTop",function(){return 0}),$B(0,$J,"absolute",function(){return!0}),$r.__init__=function(){$r._TF_EMPTY=new $G,$r.EMPTY=new $r},$r.EMPTY=null,$r._TF_EMPTY=null,$r}(),$Y=function(){function $o($J){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$b.create($o.defaultColor),this.family=$o.defaultFamily,this.stroke=$o._STROKE,this.size=$o.defaultSize,$J&&$J!==$o.EMPTY&&$J.copyTo(this)}$D($o,"laya.display.css.Font");var $J=$o.prototype;return $J.set=function($J){this._text=null;for(var $o=$J.split(" "),$r=0,$S=$o.length;$r<$S;$r++){var $G=$o[$r];switch($G){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$G.indexOf("px")&&(this.size=parseInt($G),this.family=$o[$r+1],$r++)}},$J.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$J.copyTo=function($J){$J._type=this._type,$J._text=this._text,$J._weight=this._weight,$J._color=this._color,$J.family=this.family,$J.stroke=this.stroke!=$o._STROKE?this.stroke.slice():$o._STROKE,$J.indent=this.indent,$J.size=this.size},$B(0,$J,"password",function(){return 0!=(1024&this._type)},function($J){$J?this._type|=1024:this._type&=-1025}),$B(0,$J,"color",function(){return this._color.strColor},function($J){this._color=$b.create($J)}),$B(0,$J,"italic",function(){return 0!=(512&this._type)},function($J){$J?this._type|=512:this._type&=-513}),$B(0,$J,"bold",function(){return 0!=(2048&this._type)},function($J){$J?this._type|=2048:this._type&=-2049}),$B(0,$J,"weight",function(){return""+this._weight},function($J){var $o=0;switch($J){case"normal":break;case"bold":this.bold=!0,$o=700;break;case"bolder":$o=800;break;case"lighter":$o=100;break;default:$o=parseInt($J)}this._weight=$o,this._text=null}),$B(0,$J,"decoration",function(){return this._decoration?this._decoration.value:null},function($J){var $o=$J.split(" ");switch(this._decoration||(this._decoration={}),$o[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$o[0]}$o[1]&&(this._decoration.color=$b.create($o)),this._decoration.value=$J}),$o.__init__=function(){$o.EMPTY=new $o(null)},$o.EMPTY=null,$o.defaultColor="#000000",$o.defaultSize=12,$o.defaultFamily="Arial",$o.defaultFont="12px Arial",$o._STROKE=[0,"#000000"],$o._ITALIC=512,$o._PASSWORD=1024,$o._BOLD=2048,$o}(),$G=function(){function $J(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $D($J,"laya.display.css.TransformInfo"),$J}(),$j=function(){function $v(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$L.isConchNode){this._nativeObj=new $A._conchGraphics,this.id=this._nativeObj.conchID}}$D($v,"laya.display.Graphics");var $J=$v.prototype;return $J.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$J.clear=function($J){void 0===$J&&($J=!1);var $o=0,$r=0;if($J){var $S=this._one;if(this._cmds){for($r=this._cmds.length,$o=0;$o<$r;$o++)!($S=this._cmds[$o])||$S.callee!==$L._context._drawTexture&&$S.callee!==$L._context._drawTextureWithTransform||($S[0]=null,$v._cache.push($S));this._cmds.length=0}else $S&&(!$S||$S.callee!==$L._context._drawTexture&&$S.callee!==$L._context._drawTextureWithTransform||($S[0]=null,$v._cache.push($S)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($o=0,$r=this._vectorgraphArray.length;$o<$r;$o++)$W.getInstance().deleteShape(this._vectorgraphArray[$o]);this._vectorgraphArray.length=0}},$J._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$J._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $r,this._graphicBounds._graphics=this)},$J._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$J._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$J.getBounds=function($J){return void 0===$J&&($J=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($J)},$J.getBoundPoints=function($J){return void 0===$J&&($J=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($J)},$J._addCmd=function($J){this._cmds=this._cmds||[],$J.callee=$J.shift(),this._cmds.push($J)},$J.setFilters=function($J){this._saveToCmd($L._context._setFilters,$J)},$J.drawTexture=function($J,$o,$r,$S,$G,$z,$A){if(void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$A&&($A=1),!$J||$A<.01)return null;$S||($S=$J.sourceWidth),$G||($G=$J.sourceHeight),$A=$A<0?0:1<$A?1:$A;var $h,$Z=!$L.isWebGL&&($d.onFirefox||$d.onEdge||$d.onIE||$d.onSafari)?.5:0,$u=$S/$J.sourceWidth,$B=$G/$J.sourceHeight;return $S=$J.width*$u,$G=$J.height*$B,$J.loaded&&($S<=0||$G<=0)?null:($o+=$J.offsetX*$u,$r+=$J.offsetY*$B,this._sp&&(this._sp._renderType|=512),$o-=$Z,$r-=$Z,$S+=2*$Z,$G+=2*$Z,$v._cache.length?(($h=$v._cache.pop())[0]=$J,$h[1]=$o,$h[2]=$r,$h[3]=$S,$h[4]=$G,$h[5]=$z,$h[6]=$A):$h=[$J,$o,$r,$S,$G,$z,$A],$h.callee=$z||1!=$A?$L._context._drawTextureWithTransform:$L._context._drawTexture,null!=this._one||$z||1!=$A?this._saveToCmd($h.callee,$h):(this._one=$h,this._render=this._renderOneImg),$J.loaded||$J.once("loaded",this,this._textureLoaded,[$J,$h]),this._repaint(),$h)},$J.cleanByTexture=function($J,$o,$r,$S,$G){if(void 0===$S&&($S=0),void 0===$G&&($G=0),!$J)return this.clear();if(this._one&&this._render===this._renderOneImg){$S||($S=$J.sourceWidth),$G||($G=$J.sourceHeight);var $z=$S/$J.sourceWidth,$A=$G/$J.sourceHeight;$S=$J.width*$z,$G=$J.height*$A,$o+=$J.offsetX*$z,$r+=$J.offsetY*$A,this._one[0]=$J,this._one[1]=$o,this._one[2]=$r,this._one[3]=$S,this._one[4]=$G,this._repaint()}else this.clear(),$J&&this.drawTexture($J,$o,$r,$S,$G)},$J.drawTextures=function($J,$o){$J&&this._saveToCmd($L._context._drawTextures,[$J,$o])},$J.fillTexture=function($J,$o,$r,$S,$G,$z,$A){if(void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$z&&($z="repeat"),$J){var $h=[$J,$o,$r,$S,$G,$z,$A||$g.EMPTY,{}];$J.loaded||$J.once("loaded",this,this._textureLoaded,[$J,$h]),this._saveToCmd($L._context._fillTexture,$h)}},$J._textureLoaded=function($J,$o){$o[3]=$o[3]||$J.width,$o[4]=$o[4]||$J.height,this._repaint()},$J.fillCircle=function($J,$o,$r,$S,$G,$z,$A){$r.bitmap.enableMerageInAtlas=!1;var $h=new Float32Array(2*($A+1)),$Z=new Float32Array(2*($A+1)),$u=new Uint16Array(3*$A),$B=2*Math.PI/$A,$v=0;$h[0]=$S,$h[1]=$G,$Z[0]=$S/$r.width,$Z[1]=$G/$r.height;for(var $j=2,$Y=0;$Y<$A;$Y++){var $_=$z*Math.cos($v)+$S,$D=$z*Math.sin($v)+$G;$h[$j]=$_,$h[$j+1]=$D,$Z[$j]=$_/$r.width,$Z[$j+1]=$D/$r.height,$v+=$B,$j+=2}for($Y=$j=0;$Y<$A;$Y++)$u[$j++]=0,$u[$j++]=$Y+1,$u[$j++]=$A+1<=$Y+2?1:$Y+2;this.drawTriangles($r,$J,$o,$h,$Z,$u)},$J.drawTriangles=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){void 0===$h&&($h=1),this._saveToCmd($L._context.drawTriangles,[$J,$o,$r,$S,$G,$z,$A,$h,$Z,$u])},$J._saveToCmd=function($J,$o){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$o,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($o)),$o.callee=$J,this._repaint(),$o},$J.clipRect=function($J,$o,$r,$S){this._saveToCmd($L._context._clipRect,[$J,$o,$r,$S])},$J.fillText=function($J,$o,$r,$S,$G,$z,$A){void 0===$A&&($A=0),this._saveToCmd($L._context._fillText,[$J,$o,$r,$S||$Y.defaultFont,$G,$z])},$J.fillBorderText=function($J,$o,$r,$S,$G,$z,$A,$h){this._saveToCmd($L._context._fillBorderText,[$J,$o,$r,$S||$Y.defaultFont,$G,$z,$A,$h])},$J.strokeText=function($J,$o,$r,$S,$G,$z,$A){this._saveToCmd($L._context._strokeText,[$J,$o,$r,$S||$Y.defaultFont,$G,$z,$A])},$J.alpha=function($J){$J=$J<0?0:1<$J?1:$J,this._saveToCmd($L._context._alpha,[$J])},$J.setAlpha=function($J){$J=$J<0?0:1<$J?1:$J,this._saveToCmd($L._context._setAlpha,[$J])},$J.transform=function($J,$o,$r){void 0===$o&&($o=0),void 0===$r&&($r=0),this._saveToCmd($L._context._transform,[$J,$o,$r])},$J.rotate=function($J,$o,$r){void 0===$o&&($o=0),void 0===$r&&($r=0),this._saveToCmd($L._context._rotate,[$J,$o,$r])},$J.scale=function($J,$o,$r,$S){void 0===$r&&($r=0),void 0===$S&&($S=0),this._saveToCmd($L._context._scale,[$J,$o,$r,$S])},$J.translate=function($J,$o){this._saveToCmd($L._context._translate,[$J,$o])},$J.save=function(){this._saveToCmd($L._context._save,[])},$J.restore=function(){this._saveToCmd($L._context._restore,[])},$J.replaceText=function($J){this._repaint();var $o=this._cmds;if($o){for(var $r=$o.length-1;-1<$r;$r--)if(this._isTextCmd($o[$r].callee))return $o[$r][0].toUpperCase?$o[$r][0]=$J:$o[$r][0].setText($J),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$J:this._one[0].setText($J),!0;return!1},$J._isTextCmd=function($J){return $J===$L._context._fillText||$J===$L._context._fillBorderText||$J===$L._context._strokeText},$J.replaceTextColor=function($J){this._repaint();var $o=this._cmds;if($o)for(var $r=$o.length-1;-1<$r;$r--)this._isTextCmd($o[$r].callee)&&($o[$r][4]=$J,$o[$r][0].toUpperCase||($o[$r][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$J,this._one[0].toUpperCase||(this._one[0].changed=!0))},$J.loadImage=function($J,$o,$r,$S,$G,$z){var $A=this;void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0),void 0===$G&&($G=0);var $h=$hJ.getRes($J);function $Z($J){$J&&($A.drawTexture($J,$o,$r,$S,$G),null!=$z&&$z.call($A._sp,$J))}$h?$Z($h):$y.loader.load($J,$i.create(null,$Z),null,"image")},$J._renderEmpty=function($J,$o,$r,$S){},$J._renderAll=function($J,$o,$r,$S){for(var $G,$z=this._cmds,$A=0,$h=$z.length;$A<$h;$A++)($G=$z[$A]).callee.call($o,$r,$S,$G)},$J._renderOne=function($J,$o,$r,$S){this._one.callee.call($o,$r,$S,this._one)},$J._renderOneImg=function($J,$o,$r,$S){this._one.callee.call($o,$r,$S,this._one),2305!==$J._renderType&&($J._renderType|=1)},$J.drawLine=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=1);var $A=0;$L.isWebGL&&($A=$W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($A));var $h=$z%2==0?0:.5,$Z=[$J+$h,$o+$h,$r+$h,$S+$h,$G,$z,$A];this._saveToCmd($L._context._drawLine,$Z)},$J.drawLines=function($J,$o,$r,$S,$G){void 0===$G&&($G=1);var $z=0;if($r&&!($r.length<4)){$L.isWebGL&&($z=$W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($z));var $A=$G%2==0?0:.5,$h=[$J+$A,$o+$A,$r,$S,$G,$z];this._saveToCmd($L._context._drawLines,$h)}},$J.drawCurves=function($J,$o,$r,$S,$G){void 0===$G&&($G=1);var $z=[$J,$o,$r,$S,$G];this._saveToCmd($L._context._drawCurves,$z)},$J.drawRect=function($J,$o,$r,$S,$G,$z,$A){void 0===$A&&($A=1);var $h=$z?$A/2:0,$Z=$z?$A:0,$u=[$J+$h,$o+$h,$r-$Z,$S-$Z,$G,$z,$A];this._saveToCmd($L._context._drawRect,$u)},$J.drawCircle=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=1);var $A=$G?$z/2:0,$h=0;$L.isWebGL&&($h=$W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($h));var $Z=[$J,$o,$r-$A,$S,$G,$z,$h];this._saveToCmd($L._context._drawCircle,$Z)},$J.drawPie=function($J,$o,$r,$S,$G,$z,$A,$h){void 0===$h&&($h=1);var $Z=$A?$h/2:0,$u=$A?$h:0,$B=0;$L.isWebGL&&($B=$W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($B));var $v=[$J+$Z,$o+$Z,$r-$u,$S,$G,$z,$A,$h,$B];$v[3]=$P.toRadian($S),$v[4]=$P.toRadian($G),this._saveToCmd($L._context._drawPie,$v)},$J.drawPoly=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=1);var $A=0,$h=!1;$L.isWebGL&&($A=$W.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($A),$h=!(6<$r.length));var $Z=$G?$z%2==0?0:.5:0,$u=[$J+$Z,$o+$Z,$r,$S,$G,$z,$A,$h];this._saveToCmd($L._context._drawPoly,$u)},$J.drawPath=function($J,$o,$r,$S,$G){var $z=[$J,$o,$r,$S,$G];this._saveToCmd($L._context._drawPath,$z)},$B(0,$J,"cmds",function(){return this._cmds},function($J){this._sp&&(this._sp._renderType|=512),this._cmds=$J,this._render=this._renderAll,this._repaint()}),$v.__init__=function(){if($L.isConchNode){for(var $J=laya.display.Graphics.prototype,$o=$d.window.ConchGraphics.prototype,$r=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$S=0,$G=$r.length;$S<=$G;$S++){var $z=$r[$S];$J[$z]=$o[$z]}$J._saveToCmd=null,$o.drawImageS&&($J.drawTextures=function($J,$o){if($J&&$J.loaded&&$J.bitmap&&$J.source){var $r=$J.uv,$S=$J.bitmap.width,$G=$J.bitmap.height;this.drawImageS($J.bitmap.source,$r[0]*$S,$r[1]*$G,($r[2]-$r[0])*$S,($r[5]-$r[3])*$G,$J.offsetX,$J.offsetY,$J.width,$J.height,$o)}}),$J.drawTexture=function($J,$o,$r,$S,$G,$z,$A){if(void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$A&&($A=1),$J)if($J.loaded){if($J.loaded&&$J.bitmap&&$J.source&&($S||($S=$J.sourceWidth),$G||($G=$J.sourceHeight),$A=$A<0?0:1<$A?1:$A,$S=$S-$J.sourceWidth+$J.width,$G=$G-$J.sourceHeight+$J.height,!($S<=0||$G<=0))){$o+=$J.offsetX,$r+=$J.offsetY;var $h=$J.uv,$Z=$J.bitmap.width,$u=$J.bitmap.height;$h[4]<$h[0]&&$h[5]<$h[1]?this.drawImageM($J.bitmap.source,$h[4]*$Z,$h[5]*$u,($h[0]-$h[4])*$Z,($h[1]-$h[5])*$u,$o,$r,$S,$G,$z,$A):this.drawImageM($J.bitmap.source,$h[0]*$Z,$h[1]*$u,($h[2]-$h[0])*$Z,($h[5]-$h[3])*$u,$o,$r,$S,$G,$z,$A),this._repaint()}}else $J.once("loaded",this,function(){this.drawTexture($J,$o,$r,$S,$G,$z)})},$J.fillTexture=function($J,$o,$r,$S,$G,$z,$A){if(void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$z&&($z="repeat"),$J&&$J.loaded){var $h,$Z=$L._context.ctx,$u=$J.bitmap.width,$B=$J.bitmap.height,$v=$J.uv;$h=$J.uv!=$BJ.DEF_UV?$Z.createPattern($J.bitmap.source,$z,$v[0]*$u,$v[1]*$B,($v[2]-$v[0])*$u,($v[5]-$v[3])*$B):$Z.createPattern($J.bitmap.source,$z);var $j=0,$Y=0;$A&&($o+=$A.x%$J.width,$r+=$A.y%$J.height,$j-=$A.x%$J.width,$Y-=$A.y%$J.height),this._fillImage($h,$o,$r,$j,$Y,$S,$G)}}}},$v._cache=[],$v}(),$r=function(){function $I(){this._cacheBoundsType=!1}$D($I,"laya.display.GraphicsBounds");var $J=$I.prototype;return $J.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$J.reset=function(){this._temp&&(this._temp.length=0)},$J.getBounds=function($J){return void 0===$J&&($J=!1),(!this._bounds||!this._temp||this._temp.length<1||$J!=this._cacheBoundsType)&&(this._bounds=$s._getWrapRec(this.getBoundPoints($J),this._bounds)),this._cacheBoundsType=$J,this._bounds},$J.getBoundPoints=function($J){return void 0===$J&&($J=!1),(!this._temp||this._temp.length<1||$J!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($J)),this._cacheBoundsType=$J,this._rstBoundPoints=$P.copyArray(this._rstBoundPoints,this._temp)},$J._getCmdPoints=function($J){void 0===$J&&($J=!1);var $o,$r,$S=$L._context,$G=this._graphics.cmds;if(($o=this._temp||(this._temp=[])).length=0,$G||null==this._graphics._one||($I._tempCmds.length=0,$I._tempCmds.push(this._graphics._one),$G=$I._tempCmds),!$G)return $o;($r=$I._tempMatrixArrays).length=0;var $z=$I._initMatrix;$z.identity();for(var $A,$h,$Z=$I._tempMatrix,$u=NaN,$B=NaN,$v=NaN,$j=NaN,$Y=NaN,$_=NaN,$D=0,$N=$G.length;$D<$N;$D++)if(($A=$G[$D]).callee)switch($A.callee){case $S._save:case 7:$r.push($z),$z=$z.clone();break;case $S._restore:case 8:$z=$r.pop();break;case $S._scale:case 5:$Z.identity(),$Z.translate(-$A[2],-$A[3]),$Z.scale($A[0],$A[1]),$Z.translate($A[2],$A[3]),this._switchMatrix($z,$Z);break;case $S._rotate:case 3:$Z.identity(),$Z.translate(-$A[1],-$A[2]),$Z.rotate($A[0]),$Z.translate($A[1],$A[2]),this._switchMatrix($z,$Z);break;case $S._translate:case 6:$Z.identity(),$Z.translate($A[0],$A[1]),this._switchMatrix($z,$Z);break;case $S._transform:case 4:$Z.identity(),$Z.translate(-$A[1],-$A[2]),$Z.concat($A[0]),$Z.translate($A[1],$A[2]),this._switchMatrix($z,$Z);break;case 16:case 24:$I._addPointArrToRst($o,$s._getBoundPointS($A[0],$A[1],$A[2],$A[3]),$z);break;case 17:$z.copyTo($Z),$Z.concat($A[4]),$I._addPointArrToRst($o,$s._getBoundPointS($A[0],$A[1],$A[2],$A[3]),$Z);break;case $S._drawTexture:$h=$A[0],$J?$A[3]&&$A[4]?$I._addPointArrToRst($o,$s._getBoundPointS($A[1],$A[2],$A[3],$A[4]),$z):($h=$A[0],$I._addPointArrToRst($o,$s._getBoundPointS($A[1],$A[2],$h.width,$h.height),$z)):($u=($A[3]||$h.sourceWidth)/$h.width,$B=($A[4]||$h.sourceHeight)/$h.height,$v=$u*$h.sourceWidth,$j=$B*$h.sourceHeight,$Y=0<$h.offsetX?$h.offsetX:0,$_=0<$h.offsetY?$h.offsetY:0,$Y*=$u,$_*=$B,$I._addPointArrToRst($o,$s._getBoundPointS($A[1]-$Y,$A[2]-$_,$v,$j),$z));break;case $S._fillTexture:$A[3]&&$A[4]?$I._addPointArrToRst($o,$s._getBoundPointS($A[1],$A[2],$A[3],$A[4]),$z):($h=$A[0],$I._addPointArrToRst($o,$s._getBoundPointS($A[1],$A[2],$h.width,$h.height),$z));break;case $S._drawTextureWithTransform:var $w;$w=$A[5]?($z.copyTo($Z),$Z.concat($A[5]),$Z):$z,$J?$A[3]&&$A[4]?$I._addPointArrToRst($o,$s._getBoundPointS($A[1],$A[2],$A[3],$A[4]),$w):($h=$A[0],$I._addPointArrToRst($o,$s._getBoundPointS($A[1],$A[2],$h.width,$h.height),$w)):($h=$A[0],$u=($A[3]||$h.sourceWidth)/$h.width,$B=($A[4]||$h.sourceHeight)/$h.height,$v=$u*$h.sourceWidth,$j=$B*$h.sourceHeight,$Y=0<$h.offsetX?$h.offsetX:0,$_=0<$h.offsetY?$h.offsetY:0,$Y*=$u,$_*=$B,$I._addPointArrToRst($o,$s._getBoundPointS($A[1]-$Y,$A[2]-$_,$v,$j),$w));break;case $S._drawRect:case 13:$I._addPointArrToRst($o,$s._getBoundPointS($A[0],$A[1],$A[2],$A[3]),$z);break;case $S._drawCircle:case $S._fillCircle:case 14:$I._addPointArrToRst($o,$s._getBoundPointS($A[0]-$A[2],$A[1]-$A[2],$A[2]+$A[2],$A[2]+$A[2]),$z);break;case $S._drawLine:case 20:$I._tempPoints.length=0;var $i;$i=.5*$A[5],$A[0]==$A[2]?$I._tempPoints.push($A[0]+$i,$A[1],$A[2]+$i,$A[3],$A[0]-$i,$A[1],$A[2]-$i,$A[3]):$A[1]==$A[3]?$I._tempPoints.push($A[0],$A[1]+$i,$A[2],$A[3]+$i,$A[0],$A[1]-$i,$A[2],$A[3]-$i):$I._tempPoints.push($A[0],$A[1],$A[2],$A[3]),$I._addPointArrToRst($o,$I._tempPoints,$z);break;case $S._drawCurves:case 22:$I._addPointArrToRst($o,$t.I.getBezierPoints($A[2]),$z,$A[0],$A[1]);break;case $S._drawPoly:case $S._drawLines:case 18:$I._addPointArrToRst($o,$A[2],$z,$A[0],$A[1]);break;case $S._drawPath:case 19:$I._addPointArrToRst($o,this._getPathPoints($A[2]),$z,$A[0],$A[1]);break;case $S._drawPie:case 15:$I._addPointArrToRst($o,this._getPiePoints($A[0],$A[1],$A[2],$A[3],$A[4]),$z)}return 200<$o.length?$o=$P.copyArray($o,$s._getWrapRec($o)._getBoundPoints()):8<$o.length&&($o=$K.scanPList($o)),$o},$J._switchMatrix=function($J,$o){$o.concat($J),$o.copyTo($J)},$J._getPiePoints=function($J,$o,$r,$S,$G){var $z=$I._tempPoints;$I._tempPoints.length=0,$z.push($J,$o);var $A=($G-$S)%(2*Math.PI)/10,$h=NaN,$Z=$S;for($h=0;$h<=10;$h++)$z.push($J+$r*Math.cos($Z),$o+$r*Math.sin($Z)),$Z+=$A;return $z},$J._getPathPoints=function($J){var $o,$r,$S=0,$G=$I._tempPoints;for($G.length=0,$o=$J.length,$S=0;$S<$o;$S++)1<($r=$J[$S]).length&&($G.push($r[1],$r[2]),3<$r.length&&$G.push($r[3],$r[4]));return $G},$I._addPointArrToRst=function($J,$o,$r,$S,$G){void 0===$S&&($S=0),void 0===$G&&($G=0);var $z,$A=0;for($z=$o.length,$A=0;$A<$z;$A+=2)$I._addPointToRst($J,$o[$A]+$S,$o[$A+1]+$G,$r)},$I._addPointToRst=function($J,$o,$r,$S){var $G=$g.TEMP;$G.setTo($o||0,$r||0),$S.transformPoint($G),$J.push($G.x,$G.y)},$I._tempPoints=[],$I._tempMatrixArrays=[],$I._tempCmds=[],$Z($I,["_tempMatrix",function(){return this._tempMatrix=new $n},"_initMatrix",function(){return this._initMatrix=new $n}]),$I}(),$z=function(){function $J(){}$D($J,"laya.events.Event");var $o=$J.prototype;return $o.setTo=function($J,$o,$r){return this.type=$J,this.currentTarget=$o,this.target=$r,this},$o.stopPropagation=function(){this._stoped=!0},$B(0,$o,"stageY",function(){return $y.stage.mouseY}),$B(0,$o,"charCode",function(){return this.nativeEvent.charCode}),$B(0,$o,"touches",function(){var $J=this.nativeEvent.touches;if($J)for(var $o=$y.stage,$r=0,$S=$J.length;$r<$S;$r++){var $G=$J[$r],$z=$g.TEMP;$z.setTo($G.clientX,$G.clientY),$o._canvasTransform.invertTransformPoint($z),$o.transform.invertTransformPoint($z),$G.stageX=$z.x,$G.stageY=$z.y}return $J}),$B(0,$o,"keyLocation",function(){return this.nativeEvent.keyLocation}),$B(0,$o,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$B(0,$o,"altKey",function(){return this.nativeEvent.altKey}),$B(0,$o,"shiftKey",function(){return this.nativeEvent.shiftKey}),$B(0,$o,"stageX",function(){return $y.stage.mouseX}),$J.EMPTY=new $J,$J.MOUSE_DOWN="mousedown",$J.MOUSE_UP="mouseup",$J.CLICK="click",$J.RIGHT_MOUSE_DOWN="rightmousedown",$J.RIGHT_MOUSE_UP="rightmouseup",$J.RIGHT_CLICK="rightclick",$J.MOUSE_MOVE="mousemove",$J.MOUSE_OVER="mouseover",$J.MOUSE_OUT="mouseout",$J.MOUSE_WHEEL="mousewheel",$J.ROLL_OVER="mouseover",$J.ROLL_OUT="mouseout",$J.DOUBLE_CLICK="doubleclick",$J.CHANGE="change",$J.CHANGED="changed",$J.RESIZE="resize",$J.ADDED="added",$J.REMOVED="removed",$J.DISPLAY="display",$J.UNDISPLAY="undisplay",$J.ERROR="error",$J.COMPLETE="complete",$J.LOADED="loaded",$J.INITED="inited",$J.PROGRESS="progress",$J.INPUT="input",$J.RENDER="render",$J.OPEN="open",$J.MESSAGE="message",$J.CLOSE="close",$J.KEY_DOWN="keydown",$J.KEY_PRESS="keypress",$J.KEY_UP="keyup",$J.FRAME="enterframe",$J.DRAG_START="dragstart",$J.DRAG_MOVE="dragmove",$J.DRAG_END="dragend",$J.ENTER="enter",$J.SELECT="select",$J.BLUR="blur",$J.FOCUS="focus",$J.VISIBILITY_CHANGE="visibilitychange",$J.FOCUS_CHANGE="focuschange",$J.PLAYED="played",$J.PAUSED="paused",$J.STOPPED="stopped",$J.START="start",$J.END="end",$J.ENABLE_CHANGED="enablechanged",$J.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$J.COMPONENT_ADDED="componentadded",$J.COMPONENT_REMOVED="componentremoved",$J.LAYER_CHANGED="layerchanged",$J.HIERARCHY_LOADED="hierarchyloaded",$J.RECOVERED="recovered",$J.RELEASED="released",$J.LINK="link",$J.LABEL="label",$J.FULL_SCREEN_CHANGE="fullscreenchange",$J.DEVICE_LOST="devicelost",$J.MESH_CHANGED="meshchanged",$J.MATERIAL_CHANGED="materialchanged",$J.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$J.ANIMATION_CHANGED="animationchanged",$J.TRIGGER_ENTER="triggerenter",$J.TRIGGER_STAY="triggerstay",$J.TRIGGER_EXIT="triggerexit",$J.TRAIL_FILTER_CHANGE="trailfilterchange",$J.DOMINO_FILTER_CHANGE="dominofilterchange",$J}(),$v=(function(){function $J(){}$D($J,"laya.events.Keyboard"),$J.NUMBER_0=48,$J.NUMBER_1=49,$J.NUMBER_2=50,$J.NUMBER_3=51,$J.NUMBER_4=52,$J.NUMBER_5=53,$J.NUMBER_6=54,$J.NUMBER_7=55,$J.NUMBER_8=56,$J.NUMBER_9=57,$J.A=65,$J.B=66,$J.C=67,$J.D=68,$J.E=69,$J.F=70,$J.G=71,$J.H=72,$J.I=73,$J.J=74,$J.K=75,$J.L=76,$J.M=77,$J.N=78,$J.O=79,$J.P=80,$J.Q=81,$J.R=82,$J.S=83,$J.T=84,$J.U=85,$J.V=86,$J.W=87,$J.X=88,$J.Y=89,$J.Z=90,$J.F1=112,$J.F2=113,$J.F3=114,$J.F4=115,$J.F5=116,$J.F6=117,$J.F7=118,$J.F8=119,$J.F9=120,$J.F10=121,$J.F11=122,$J.F12=123,$J.F13=124,$J.F14=125,$J.F15=126,$J.NUMPAD=21,$J.NUMPAD_0=96,$J.NUMPAD_1=97,$J.NUMPAD_2=98,$J.NUMPAD_3=99,$J.NUMPAD_4=100,$J.NUMPAD_5=101,$J.NUMPAD_6=102,$J.NUMPAD_7=103,$J.NUMPAD_8=104,$J.NUMPAD_9=105,$J.NUMPAD_ADD=107,$J.NUMPAD_DECIMAL=110,$J.NUMPAD_DIVIDE=111,$J.NUMPAD_ENTER=108,$J.NUMPAD_MULTIPLY=106,$J.NUMPAD_SUBTRACT=109,$J.SEMICOLON=186,$J.EQUAL=187,$J.COMMA=188,$J.MINUS=189,$J.PERIOD=190,$J.SLASH=191,$J.BACKQUOTE=192,$J.LEFTBRACKET=219,$J.BACKSLASH=220,$J.RIGHTBRACKET=221,$J.QUOTE=222,$J.ALTERNATE=18,$J.BACKSPACE=8,$J.CAPS_LOCK=20,$J.COMMAND=15,$J.CONTROL=17,$J.DELETE=46,$J.ENTER=13,$J.ESCAPE=27,$J.PAGE_UP=33,$J.PAGE_DOWN=34,$J.END=35,$J.HOME=36,$J.LEFT=37,$J.UP=38,$J.RIGHT=39,$J.DOWN=40,$J.SHIFT=16,$J.SPACE=32,$J.TAB=9,$J.INSERT=45}(),function(){function $G(){}return $D($G,"laya.events.KeyBoardManager"),$G.__init__=function(){$G._addEvent("keydown"),$G._addEvent("keypress"),$G._addEvent("keyup")},$G._addEvent=function($o){$d.document.addEventListener($o,function($J){laya.events.KeyBoardManager._dispatch($J,$o)},!0)},$G._dispatch=function($J,$o){if($G.enabled){$G._event._stoped=!1,$G._event.nativeEvent=$J,$G._event.keyCode=$J.keyCode||$J.which||$J.charCode,"keydown"===$o?$G._pressKeys[$G._event.keyCode]=!0:"keyup"===$o&&($G._pressKeys[$G._event.keyCode]=null);for(var $r=$y.stage.focus&&null!=$y.stage.focus.event&&$y.stage.focus.displayedInStage?$y.stage.focus:$y.stage,$S=$r;$S;)$S.event($o,$G._event.setTo($o,$S,$r)),$S=$S.parent}},$G.hasKeyDown=function($J){return $G._pressKeys[$J]},$G._pressKeys={},$G.enabled=!0,$Z($G,["_event",function(){return this._event=new $z}]),$G}()),$_=(function(){function $J(){}$D($J,"laya.events.KeyLocation"),$J.STANDARD=0,$J.LEFT=1,$J.RIGHT=2,$J.NUM_PAD=3}(),function(){function $B(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$d.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $z,this._matrix=new $n,this._point=new $g,this._rect=new $s,this._prePoint=new $g,this._curTouchID=NaN}$D($B,"laya.events.MouseManager");var $J=$B.prototype;return $J.__init__=function($J,$o){var $r=this;this._stage=$J;var $S=this,$G=this._eventList;$o.oncontextmenu=function($J){if($B.enabled)return!1},$o.addEventListener("mousedown",function($J){$B.enabled&&($d.onIE||$J.preventDefault(),$G.push($J),$S.mouseDownTime=$d.now())}),$o.addEventListener("mouseup",function($J){$B.enabled&&($J.preventDefault(),$G.push($J),$S.mouseDownTime=-$d.now())},!0),$o.addEventListener("mousemove",function($J){if($B.enabled){$J.preventDefault();var $o=$d.now();if($o-$S._lastMoveTimer<10)return;$S._lastMoveTimer=$o,$G.push($J)}},!0),$o.addEventListener("mouseout",function($J){$B.enabled&&$G.push($J)}),$o.addEventListener("mouseover",function($J){$B.enabled&&$G.push($J)}),$o.addEventListener("touchstart",function($J){$B.enabled&&($G.push($J),$B._isFirstTouch||$KJ.isInputting||$J.preventDefault(),$S.mouseDownTime=$d.now())}),$o.addEventListener("touchend",function($J){$B.enabled?($B._isFirstTouch||$KJ.isInputting||$J.preventDefault(),$B._isFirstTouch=!1,$G.push($J),$S.mouseDownTime=-$d.now()):$r._curTouchID=NaN},!0),$o.addEventListener("touchmove",function($J){$B.enabled&&($J.preventDefault(),$G.push($J))},!0),$o.addEventListener("touchcancel",function($J){$B.enabled?($J.preventDefault(),$G.push($J)):$r._curTouchID=NaN},!0),$o.addEventListener("mousewheel",function($J){$B.enabled&&$G.push($J)}),$o.addEventListener("DOMMouseScroll",function($J){$B.enabled&&$G.push($J)})},$J.initEvent=function($J,$o){var $r;this._event._stoped=!1,this._event.nativeEvent=$o||$J,this._target=null,this._point.setTo($J.pageX||$J.clientX,$J.pageY||$J.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$J.identifier||0,this._tTouchID=this._event.touchId,($r=$N.I._event)._stoped=!1,$r.nativeEvent=this._event.nativeEvent,$r.touchId=this._event.touchId},$J.checkMouseWheel=function($J){this._event.delta=$J.wheelDelta?.025*$J.wheelDelta:-$J.detail;for(var $o=$N.I.getLastOvers(),$r=0,$S=$o.length;$r<$S;$r++){var $G=$o[$r];$G.event("mousewheel",this._event.setTo("mousewheel",$G,this._target))}},$J.onMouseMove=function($J){$N.I.onMouseMove($J,this._tTouchID)},$J.onMouseDown=function($J){if($KJ.isInputting&&$y.stage.focus&&$y.stage.focus.focus&&!$y.stage.focus.contains(this._target)){var $o=$y.stage.focus._tf||$y.stage.focus,$r=$J._tf||$J;$r instanceof laya.display.Input&&$r.multiline==$o.multiline?$o._focusOut():$o.focus=!1}$N.I.onMouseDown($J,this._tTouchID,this._isLeftMouse)},$J.onMouseUp=function($J){$N.I.onMouseUp($J,this._tTouchID,this._isLeftMouse)},$J.check=function($J,$o,$r,$S){this._point.setTo($o,$r),$J.fromParentPoint(this._point),$o=this._point.x,$r=this._point.y;var $G=$J.scrollRect;if($G&&(this._rect.setTo($G.x,$G.y,$G.width,$G.height),!this._rect.contains($o,$r)))return!1;if(!this.disableMouseEvent){if($J.hitTestPrior&&!$J.mouseThrough&&!this.hitTest($J,$o,$r))return!1;for(var $z=$J._childs.length-1;-1<$z;$z--){var $A=$J._childs[$z];if(!$A.destroyed&&$A.mouseEnabled&&$A.visible&&this.check($A,$o,$r,$S))return!0}}var $h=!(!$J.hitTestPrior||$J.mouseThrough||this.disableMouseEvent)||this.hitTest($J,$o,$r);return $h?(this._target=$J,$S.call(this,$J)):$S===this.onMouseUp&&$J===this._stage&&(this._target=this._stage,$S.call(this,this._target)),$h},$J.hitTest=function($J,$o,$r){var $S=!1;if($J.scrollRect&&($o-=$J.scrollRect.x,$r-=$J.scrollRect.y),$J.hitArea instanceof laya.utils.HitArea)return $J.hitArea.isHit($o,$r);if(0<$J.width&&0<$J.height||$J.mouseThrough||$J.hitArea)if($J.mouseThrough)$S=$J.getGraphicBounds().contains($o,$r);else{var $G=this._rect;$J.hitArea?$G=$J.hitArea:$G.setTo(0,0,$J.width,$J.height),$S=$G.contains($o,$r)}return $S},$J.runEvent=function(){var $J=this._eventList.length;if($J){var $o=this;$o.mouseEventTime=$d.now();var $r,$S=0,$G=0,$z=0;try{for(;$S<$J;){var $A=this._eventList[$S];switch("mousemove"!==$A.type&&(this._prePoint.x=this._prePoint.y=-1e6),$A.type){case"mousedown":this._touchIDs[0]=this._id++,$B._isTouchRespond?$B._isTouchRespond=!1:($o._isLeftMouse=0===$A.button,$o.initEvent($A),$o.check($o._stage,$o.mouseX,$o.mouseY,$o.onMouseDown));break;case"mouseup":$o._isLeftMouse=0===$A.button,$o.initEvent($A),$o.check($o._stage,$o.mouseX,$o.mouseY,$o.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$A.clientX)+Math.abs(this._prePoint.y-$A.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$A.clientX,this._prePoint.y=$A.clientY,$o.initEvent($A),$o.check($o._stage,$o.mouseX,$o.mouseY,$o.onMouseMove));break;case"touchstart":$B._isTouchRespond=!0,$o._isLeftMouse=!0;var $h=$A.changedTouches;for($G=0,$z=$h.length;$G<$z;$G++)$r=$h[$G],($B.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$r.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$r.identifier]=this._id++,$o.initEvent($r,$A),$o.check($o._stage,$o.mouseX,$o.mouseY,$o.onMouseDown));break;case"touchend":case"touchcancel":$B._isTouchRespond=!0,$o._isLeftMouse=!0;var $Z=$A.changedTouches;for($G=0,$z=$Z.length;$G<$z;$G++)if($r=$Z[$G],$B.multiTouchEnabled||$r.identifier==this._curTouchID){this._curTouchID=NaN,$o.initEvent($r,$A);$o.check($o._stage,$o.mouseX,$o.mouseY,$o.onMouseUp)||$o.onMouseUp(null)}break;case"touchmove":var $u=$A.changedTouches;for($G=0,$z=$u.length;$G<$z;$G++)$r=$u[$G],($B.multiTouchEnabled||$r.identifier==this._curTouchID)&&($o.initEvent($r,$A),$o.check($o._stage,$o.mouseX,$o.mouseY,$o.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$o.checkMouseWheel($A);break;case"mouseout":$N.I.stageMouseOut();break;case"mouseover":$o._stage.event("mouseover",$o._event.setTo("mouseover",$o._stage,$o._stage))}$S++}}catch($J){throw this._eventList.length=0,$J}this._eventList.length=0}},$B.enabled=!0,$B.multiTouchEnabled=!0,$B._isTouchRespond=!1,$B._isFirstTouch=!0,$Z($B,["instance",function(){return this.instance=new $B}]),$B}()),$N=function(){function $_(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $z}$D($_,"laya.events.TouchManager");var $J=$_.prototype;return $J._clearTempArrs=function(){$_._oldArr.length=0,$_._newArr.length=0,$_._tEleArr.length=0},$J.getTouchFromArr=function($J,$o){var $r,$S,$G=0;for($r=$o.length,$G=0;$G<$r;$G++)if(($S=$o[$G]).id==$J)return $S;return null},$J.removeTouchFromArr=function($J,$o){var $r=0;for($r=$o.length-1;0<=$r;$r--)$o[$r].id==$J&&$o.splice($r,1)},$J.createTouchO=function($J,$o){var $r;return($r=$a.getItem("TouchData")||{}).id=$o,$r.tar=$J,$r},$J.onMouseDown=function($J,$o,$r){var $S,$G,$z,$A;(void 0===$r&&($r=!1),this.enable)&&($S=this.getTouchFromArr($o,this.preOvers),$z=this.getEles($J,null,$_._tEleArr),$S?$S.tar=$J:($G=this.createTouchO($J,$o),this.preOvers.push($G)),$d.onMobile&&this.sendEvents($z,"mouseover",$o),$A=$r?this.preDowns:this.preRightDowns,($S=this.getTouchFromArr($o,$A))?$S.tar=$J:($G=this.createTouchO($J,$o),$A.push($G)),this.sendEvents($z,$r?"mousedown":"rightmousedown",$o),this._clearTempArrs())},$J.sendEvents=function($J,$o,$r){void 0===$r&&($r=0);var $S,$G,$z,$A=0;for($S=$J.length,this._event._stoped=!1,$G=$J[0],$A=0;$A<$S;$A++){if(($z=$J[$A]).destroyed)return;if($z.event($o,this._event.setTo($o,$z,$G)),this._event._stoped)break}},$J.getEles=function($J,$o,$r){for($r?$r.length=0:$r=[];$J&&$J!=$o;)$r.push($J),$J=$J.parent;return $r},$J.checkMouseOutAndOverOfMove=function($J,$o,$r){if(void 0===$r&&($r=0),$o!=$J){var $S,$G,$z=0,$A=0;if($o.contains($J))$G=this.getEles($J,$o,$_._tEleArr),this.sendEvents($G,"mouseover",$r);else if($J.contains($o))$G=this.getEles($o,$J,$_._tEleArr),this.sendEvents($G,"mouseout",$r);else{var $h,$Z;($G=$_._tEleArr).length=0,$h=this.getEles($o,null,$_._oldArr),$Z=this.getEles($J,null,$_._newArr),$A=$h.length;var $u=0;for($z=0;$z<$A;$z++){if($S=$h[$z],0<=($u=$Z.indexOf($S))){$Z.splice($u,$Z.length-$u);break}$G.push($S)}0<$G.length&&this.sendEvents($G,"mouseout",$r),0<$Z.length&&this.sendEvents($Z,"mouseover",$r)}}},$J.onMouseMove=function($J,$o){var $r,$S;this.enable&&(($r=this.getTouchFromArr($o,this.preOvers))?(this.checkMouseOutAndOverOfMove($J,$r.tar),$r.tar=$J,$S=this.getEles($J,null,$_._tEleArr)):($S=this.getEles($J,null,$_._tEleArr),this.sendEvents($S,"mouseover",$o),this.preOvers.push(this.createTouchO($J,$o))),this.sendEvents($S,"mousemove",$o),this._clearTempArrs())},$J.getLastOvers=function(){return($_._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$_._tEleArr):($_._tEleArr.push($y.stage),$_._tEleArr)},$J.stageMouseOut=function(){var $J;$J=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($J,"mouseout",0)},$J.onMouseUp=function($J,$o,$r){if(void 0===$r&&($r=!1),this.enable){var $S,$G,$z,$A,$h,$Z,$u=0,$B=0,$v=$d.onMobile;if($G=this.getEles($J,null,$_._tEleArr),this.sendEvents($G,$r?"mouseup":"rightmouseup",$o),$Z=$r?this.preDowns:this.preRightDowns,$S=this.getTouchFromArr($o,$Z)){var $j,$Y=$d.now();if($j=$Y-this._lastClickTime<300,this._lastClickTime=$Y,$J==$S.tar)$h=$G;else for($z=this.getEles($S.tar,null,$_._oldArr),($h=$_._newArr).length=0,$B=$z.length,$u=0;$u<$B;$u++)$A=$z[$u],0<=$G.indexOf($A)&&$h.push($A);0<$h.length&&this.sendEvents($h,$r?"click":"rightclick",$o),$r&&$j&&this.sendEvents($h,"doubleclick",$o),this.removeTouchFromArr($o,$Z),$S.tar=null,$a.recover("TouchData",$S)}else;($S=this.getTouchFromArr($o,this.preOvers))&&$v&&(($h=this.getEles($S.tar,null,$h))&&0<$h.length&&this.sendEvents($h,"mouseout",$o),this.removeTouchFromArr($o,this.preOvers),$S.tar=null,$a.recover("TouchData",$S)),this._clearTempArrs()}},$_._oldArr=[],$_._newArr=[],$_._tEleArr=[],$Z($_,["I",function(){return this.I=new $_}]),$_}(),$w=function(){function $J(){this._action=null}$D($J,"laya.filters.Filter");var $o=$J.prototype;return $y.imps($o,{"laya.filters.IFilter":!0}),$o.callNative=function($J){},$B(0,$o,"type",function(){return-1}),$B(0,$o,"action",function(){return this._action}),$J.BLUR=16,$J.COLOR=32,$J.GLOW=8,$J._filterStart=null,$J._filterEnd=null,$J._EndTarget=null,$J._recycleScope=null,$J._filter=null,$J._useSrc=null,$J._endSrc=null,$J._useOut=null,$J._endOut=null,$J}(),$I=function(){function $J(){this.data=null}$D($J,"laya.filters.ColorFilterAction");var $o=$J.prototype;return $y.imps($o,{"laya.filters.IFilterAction":!0}),$o.apply=function($J){var $o=$J.ctx.ctx,$r=$J.ctx.ctx.canvas;if(0==$r.width||0==$r.height)return $r;for(var $S,$G=$o.getImageData(0,0,$r.width,$r.height),$z=$G.data,$A=0,$h=$z.length;$A<$h;$A+=4)$S=this.getColor($z[$A],$z[$A+1],$z[$A+2],$z[$A+3]),0!=$z[$A+3]&&($z[$A]=$S[0],$z[$A+1]=$S[1],$z[$A+2]=$S[2],$z[$A+3]=$S[3]);return $o.putImageData($G,0,0),$J},$o.getColor=function($J,$o,$r,$S){var $G=[];if(this.data._mat&&this.data._alpha){var $z=this.data._mat,$A=this.data._alpha;$G[0]=$z[0]*$J+$z[1]*$o+$z[2]*$r+$z[3]*$S+$A[0],$G[1]=$z[4]*$J+$z[5]*$o+$z[6]*$r+$z[7]*$S+$A[1],$G[2]=$z[8]*$J+$z[9]*$o+$z[10]*$r+$z[11]*$S+$A[2],$G[3]=$z[12]*$J+$z[13]*$o+$z[14]*$r+$z[15]*$S+$A[3]}return $G},$J}(),$t=(function(){function $J(){}$D($J,"laya.maths.Arith"),$J.formatR=function($J){return $J>Math.PI&&($J-=2*Math.PI),$J<-Math.PI&&($J+=2*Math.PI),$J},$J.isPOT=function($J,$o){return 0<$J&&0==($J&$J-1)&&0<$o&&0==($o&$o-1)},$J.setMatToArray=function($J,$o){$J.a,$J.b,$J.c,$J.d,$J.tx,$J.ty,$o[0]=$J.a,$o[1]=$J.b,$o[4]=$J.c,$o[5]=$J.d,$o[12]=$J.tx,$o[13]=$J.ty}}(),function(){function $J(){this._controlPoints=[new $g,new $g,new $g],this._calFun=this.getPoint2}$D($J,"laya.maths.Bezier");var $o=$J.prototype;return $o._switchPoint=function($J,$o){var $r=this._controlPoints.shift();$r.setTo($J,$o),this._controlPoints.push($r)},$o.getPoint2=function($J,$o){var $r=this._controlPoints[0],$S=this._controlPoints[1],$G=this._controlPoints[2],$z=Math.pow(1-$J,2)*$r.x+2*$J*(1-$J)*$S.x+Math.pow($J,2)*$G.x,$A=Math.pow(1-$J,2)*$r.y+2*$J*(1-$J)*$S.y+Math.pow($J,2)*$G.y;$o.push($z,$A)},$o.getPoint3=function($J,$o){var $r=this._controlPoints[0],$S=this._controlPoints[1],$G=this._controlPoints[2],$z=this._controlPoints[3],$A=Math.pow(1-$J,3)*$r.x+3*$S.x*$J*(1-$J)*(1-$J)+3*$G.x*$J*$J*(1-$J)+$z.x*Math.pow($J,3),$h=Math.pow(1-$J,3)*$r.y+3*$S.y*$J*(1-$J)*(1-$J)+3*$G.y*$J*$J*(1-$J)+$z.y*Math.pow($J,3);$o.push($A,$h)},$o.insertPoints=function($J,$o){var $r,$S=NaN;for($r=1/($J=0<$J?$J:5),$S=0;$S<=1;$S+=$r)this._calFun($S,$o)},$o.getBezierPoints=function($J,$o,$r){void 0===$o&&($o=5),void 0===$r&&($r=2);var $S,$G,$z=0;if(($S=$J.length)<2*($r+1))return[];switch($G=[],$r){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$r;)this._controlPoints.push(new $g);for($z=0;$z<2*$r;$z+=2)this._switchPoint($J[$z],$J[$z+1]);for($z=2*$r;$z<$S;$z+=2)this._switchPoint($J[$z],$J[$z+1]),$z/2%$r==0&&this.insertPoints($o,$G);return $G},$Z($J,["I",function(){return this.I=new $J}]),$J}()),$K=function(){function $u(){}return $D($u,"laya.maths.GrahamScan"),$u.multiply=function($J,$o,$r){return($J.x-$r.x)*($o.y-$r.y)-($o.x-$r.x)*($J.y-$r.y)},$u.dis=function($J,$o){return($J.x-$o.x)*($J.x-$o.x)+($J.y-$o.y)*($J.y-$o.y)},$u._getPoints=function($J,$o,$r){for(void 0===$o&&($o=!1),$u._mPointList||($u._mPointList=[]);$u._mPointList.length<$J;)$u._mPointList.push(new $g);return $r||($r=[]),$r.length=0,$o?$u.getFrom($r,$u._mPointList,$J):$u.getFromR($r,$u._mPointList,$J),$r},$u.getFrom=function($J,$o,$r){var $S=0;for($S=0;$S<$r;$S++)$J.push($o[$S]);return $J},$u.getFromR=function($J,$o,$r){var $S=0;for($S=0;$S<$r;$S++)$J.push($o.pop());return $J},$u.pListToPointList=function($J,$o){void 0===$o&&($o=!1);var $r=0,$S=$J.length/2,$G=$u._getPoints($S,$o,$u._tempPointList);for($r=0;$r<$S;$r++)$G[$r].setTo($J[$r+$r],$J[$r+$r+1]);return $G},$u.pointListToPlist=function($J){var $o,$r=0,$S=$J.length,$G=$u._temPList;for($r=$G.length=0;$r<$S;$r++)$o=$J[$r],$G.push($o.x,$o.y);return $G},$u.scanPList=function($J){return $P.copyArray($J,$u.pointListToPlist($u.scan($u.pListToPointList($J,!0))))},$u.scan=function($J){var $o,$r,$S,$G=0,$z=0,$A=0,$h=$J.length,$Z={};for(($r=$u._temArr).length=0,$G=($h=$J.length)-1;0<=$G;$G--)$S=($o=$J[$G]).x+"_"+$o.y,$Z.hasOwnProperty($S)||($Z[$S]=!0,$r.push($o));for($h=$r.length,$P.copyArray($J,$r),$G=1;$G<$h;$G++)($J[$G].y<$J[$A].y||$J[$G].y==$J[$A].y&&$J[$G].x<$J[$A].x)&&($A=$G);for($o=$J[0],$J[0]=$J[$A],$J[$A]=$o,$G=1;$G<$h-1;$G++){for($z=($A=$G)+1;$z<$h;$z++)(0<$u.multiply($J[$z],$J[$A],$J[0])||0==$u.multiply($J[$z],$J[$A],$J[0])&&$u.dis($J[0],$J[$z])<$u.dis($J[0],$J[$A]))&&($A=$z);$o=$J[$G],$J[$G]=$J[$A],$J[$A]=$o}if(($r=$u._temArr).length=0,$J.length<3)return $P.copyArray($r,$J);for($r.push($J[0],$J[1],$J[2]),$G=3;$G<$h;$G++){for(;2<=$r.length&&0<=$u.multiply($J[$G],$r[$r.length-1],$r[$r.length-2]);)$r.pop();$J[$G]&&$r.push($J[$G])}return $r},$u._mPointList=null,$u._tempPointList=[],$u._temPList=[],$u._temArr=[],$u}(),$e=function(){function $G(){}return $D($G,"laya.maths.MathUtil"),$G.subtractVector3=function($J,$o,$r){$r[0]=$J[0]-$o[0],$r[1]=$J[1]-$o[1],$r[2]=$J[2]-$o[2]},$G.lerp=function($J,$o,$r){return $J*(1-$r)+$o*$r},$G.scaleVector3=function($J,$o,$r){$r[0]=$J[0]*$o,$r[1]=$J[1]*$o,$r[2]=$J[2]*$o},$G.lerpVector3=function($J,$o,$r,$S){var $G=$J[0],$z=$J[1],$A=$J[2];$S[0]=$G+$r*($o[0]-$G),$S[1]=$z+$r*($o[1]-$z),$S[2]=$A+$r*($o[2]-$A)},$G.lerpVector4=function($J,$o,$r,$S){var $G=$J[0],$z=$J[1],$A=$J[2],$h=$J[3];$S[0]=$G+$r*($o[0]-$G),$S[1]=$z+$r*($o[1]-$z),$S[2]=$A+$r*($o[2]-$A),$S[3]=$h+$r*($o[3]-$h)},$G.slerpQuaternionArray=function($J,$o,$r,$S,$G,$z,$A){var $h,$Z,$u,$B,$v,$j=$J[$o+0],$Y=$J[$o+1],$_=$J[$o+2],$D=$J[$o+3],$N=$r[$S+0],$w=$r[$S+1],$i=$r[$S+2],$I=$r[$S+3];return($Z=$j*$N+$Y*$w+$_*$i+$D*$I)<0&&($Z=-$Z,$N=-$N,$w=-$w,$i=-$i,$I=-$I),$v=1e-6<1-$Z?($h=Math.acos($Z),$u=Math.sin($h),$B=Math.sin((1-$G)*$h)/$u,Math.sin($G*$h)/$u):($B=1-$G,$G),$z[$A+0]=$B*$j+$v*$N,$z[$A+1]=$B*$Y+$v*$w,$z[$A+2]=$B*$_+$v*$i,$z[$A+3]=$B*$D+$v*$I,$z},$G.getRotation=function($J,$o,$r,$S){return Math.atan2($S-$o,$r-$J)/Math.PI*180},$G.sortBigFirst=function($J,$o){return $J==$o?0:$J<$o?1:-1},$G.sortSmallFirst=function($J,$o){return $J==$o?0:$J<$o?-1:1},$G.sortNumBigFirst=function($J,$o){return parseFloat($o)-parseFloat($J)},$G.sortNumSmallFirst=function($J,$o){return parseFloat($J)-parseFloat($o)},$G.sortByKey=function($r,$J,$o){var $S;return void 0===$J&&($J=!1),void 0===$o&&($o=!0),$S=$J?$o?$G.sortNumBigFirst:$G.sortBigFirst:$o?$G.sortNumSmallFirst:$G.sortSmallFirst,function($J,$o){return $S($J[$r],$o[$r])}},$G}(),$n=function(){function $r($J,$o,$r,$S,$G,$z){this.inPool=!1,this.bTransform=!1,void 0===$J&&($J=1),void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=1),void 0===$G&&($G=0),void 0===$z&&($z=0),this.a=$J,this.b=$o,this.c=$r,this.d=$S,this.tx=$G,this.ty=$z,this._checkTransform()}$D($r,"laya.maths.Matrix");var $J=$r.prototype;return $J.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$J._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$J.setTranslate=function($J,$o){return this.tx=$J,this.ty=$o,this},$J.translate=function($J,$o){return this.tx+=$J,this.ty+=$o,this},$J.scale=function($J,$o){this.a*=$J,this.d*=$o,this.c*=$J,this.b*=$o,this.tx*=$J,this.ty*=$o,this.bTransform=!0},$J.rotate=function($J){var $o=Math.cos($J),$r=Math.sin($J),$S=this.a,$G=this.c,$z=this.tx;this.a=$S*$o-this.b*$r,this.b=$S*$r+this.b*$o,this.c=$G*$o-this.d*$r,this.d=$G*$r+this.d*$o,this.tx=$z*$o-this.ty*$r,this.ty=$z*$r+this.ty*$o,this.bTransform=!0},$J.skew=function($J,$o){var $r=Math.tan($J),$S=Math.tan($o),$G=this.a,$z=this.b;return this.a+=$S*this.c,this.b+=$S*this.d,this.c+=$r*$G,this.d+=$r*$z,this},$J.invertTransformPoint=function($J){var $o=this.a,$r=this.b,$S=this.c,$G=this.d,$z=this.tx,$A=$o*$G-$r*$S,$h=$G/$A,$Z=-$r/$A,$u=-$S/$A,$B=$o/$A,$v=($S*this.ty-$G*$z)/$A,$j=-($o*this.ty-$r*$z)/$A;return $J.setTo($h*$J.x+$u*$J.y+$v,$Z*$J.x+$B*$J.y+$j)},$J.transformPoint=function($J){return $J.setTo(this.a*$J.x+this.c*$J.y+this.tx,this.b*$J.x+this.d*$J.y+this.ty)},$J.transformPointN=function($J){return $J.setTo(this.a*$J.x+this.c*$J.y,this.b*$J.x+this.d*$J.y)},$J.transformPointArray=function($J,$o){for(var $r=$J.length,$S=0;$S<$r;$S+=2){var $G=$J[$S],$z=$J[$S+1];$o[$S]=this.a*$G+this.c*$z+this.tx,$o[$S+1]=this.b*$G+this.d*$z+this.ty}return $o},$J.transformPointArrayScale=function($J,$o){for(var $r=$J.length,$S=0;$S<$r;$S+=2){var $G=$J[$S],$z=$J[$S+1];$o[$S]=this.a*$G+this.c*$z,$o[$S+1]=this.b*$G+this.d*$z}return $o},$J.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$J.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$J.invert=function(){var $J=this.a,$o=this.b,$r=this.c,$S=this.d,$G=this.tx,$z=$J*$S-$o*$r;return this.a=$S/$z,this.b=-$o/$z,this.c=-$r/$z,this.d=$J/$z,this.tx=($r*this.ty-$S*$G)/$z,this.ty=-($J*this.ty-$o*$G)/$z,this},$J.setTo=function($J,$o,$r,$S,$G,$z){return this.a=$J,this.b=$o,this.c=$r,this.d=$S,this.tx=$G,this.ty=$z,this},$J.concat=function($J){var $o=this.a,$r=this.c,$S=this.tx;return this.a=$o*$J.a+this.b*$J.c,this.b=$o*$J.b+this.b*$J.d,this.c=$r*$J.a+this.d*$J.c,this.d=$r*$J.b+this.d*$J.d,this.tx=$S*$J.a+this.ty*$J.c+$J.tx,this.ty=$S*$J.b+this.ty*$J.d+$J.ty,this},$J.scaleEx=function($J,$o){var $r=this.a,$S=this.b,$G=this.c,$z=this.d;0!==$S||0!==$G?(this.a=$J*$r,this.b=$J*$S,this.c=$o*$G):(this.a=$J*$r,this.b=0*$z,this.c=0*$r),this.d=$o*$z,this.bTransform=!0},$J.rotateEx=function($J){var $o=Math.cos($J),$r=Math.sin($J),$S=this.a,$G=this.b,$z=this.c,$A=this.d;0!==$G||0!==$z?(this.a=$o*$S+$r*$z,this.b=$o*$G+$r*$A,this.c=-$r*$S+$o*$z,this.d=-$r*$G+$o*$A):(this.a=$o*$S,this.b=$r*$A,this.c=-$r*$S,this.d=$o*$A),this.bTransform=!0},$J.clone=function(){var $J=$r.create();return $J.a=this.a,$J.b=this.b,$J.c=this.c,$J.d=this.d,$J.tx=this.tx,$J.ty=this.ty,$J.bTransform=this.bTransform,$J},$J.copyTo=function($J){return $J.a=this.a,$J.b=this.b,$J.c=this.c,$J.d=this.d,$J.tx=this.tx,$J.ty=this.ty,$J.bTransform=this.bTransform,$J},$J.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$J.destroy=function(){if(!this.inPool){var $J=$r._cache;this.inPool=!0,$J._length||($J._length=0),($J[$J._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$r.mul=function($J,$o,$r){var $S=$J.a,$G=$J.b,$z=$J.c,$A=$J.d,$h=$J.tx,$Z=$J.ty,$u=$o.a,$B=$o.b,$v=$o.c,$j=$o.d,$Y=$o.tx,$_=$o.ty;return 0!==$B||0!==$v?($r.a=$S*$u+$G*$v,$r.b=$S*$B+$G*$j,$r.c=$z*$u+$A*$v,$r.d=$z*$B+$A*$j,$r.tx=$u*$h+$v*$Z+$Y,$r.ty=$B*$h+$j*$Z+$_):($r.a=$S*$u,$r.b=$G*$j,$r.c=$z*$u,$r.d=$A*$j,$r.tx=$u*$h+$Y,$r.ty=$j*$Z+$_),$r},$r.mul16=function($J,$o,$r){var $S=$J.a,$G=$J.b,$z=$J.c,$A=$J.d,$h=$J.tx,$Z=$J.ty,$u=$o.a,$B=$o.b,$v=$o.c,$j=$o.d,$Y=$o.tx,$_=$o.ty;return 0!==$B||0!==$v?($r[0]=$S*$u+$G*$v,$r[1]=$S*$B+$G*$j,$r[4]=$z*$u+$A*$v,$r[5]=$z*$B+$A*$j,$r[12]=$u*$h+$v*$Z+$Y,$r[13]=$B*$h+$j*$Z+$_):($r[0]=$S*$u,$r[1]=$G*$j,$r[4]=$z*$u,$r[5]=$A*$j,$r[12]=$u*$h+$Y,$r[13]=$j*$Z+$_),$r},$r.mulPre=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=$J.a,$u=$J.b,$B=$J.c,$v=$J.d,$j=$J.tx,$Y=$J.ty;return 0!==$r||0!==$S?($h.a=$Z*$o+$u*$S,$h.b=$Z*$r+$u*$G,$h.c=$B*$o+$v*$S,$h.d=$B*$r+$v*$G,$h.tx=$o*$j+$S*$Y+$z,$h.ty=$r*$j+$G*$Y+$A):($h.a=$Z*$o,$h.b=$u*$G,$h.c=$B*$o,$h.d=$v*$G,$h.tx=$o*$j+$z,$h.ty=$G*$Y+$A),$h},$r.mulPos=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=$J.a,$u=$J.b,$B=$J.c,$v=$J.d,$j=$J.tx,$Y=$J.ty;return 0!==$u||0!==$B?($h.a=$o*$Z+$r*$B,$h.b=$o*$u+$r*$v,$h.c=$S*$Z+$G*$B,$h.d=$S*$u+$G*$v,$h.tx=$Z*$z+$B*$A+$j,$h.ty=$u*$z+$v*$A+$Y):($h.a=$o*$Z,$h.b=$r*$v,$h.c=$S*$Z,$h.d=$G*$v,$h.tx=$Z*$z+$j,$h.ty=$v*$A+$Y),$h},$r.preMul=function($J,$o,$r){var $S=$J.a,$G=$J.b,$z=$J.c,$A=$J.d,$h=$o.a,$Z=$o.b,$u=$o.c,$B=$o.d,$v=$o.tx,$j=$o.ty;return $r.a=$h*$S,$r.b=$r.c=0,$r.d=$B*$A,$r.tx=$v*$S+$J.tx,$r.ty=$j*$A+$J.ty,0===$Z&&0===$u&&0===$G&&0===$z||($r.a+=$Z*$z,$r.d+=$u*$G,$r.b+=$h*$G+$Z*$A,$r.c+=$u*$S+$B*$z,$r.tx+=$j*$z,$r.ty+=$v*$G),$r},$r.preMulXY=function($J,$o,$r,$S){var $G=$J.a,$z=$J.b,$A=$J.c,$h=$J.d;return $S.a=$G,$S.b=$z,$S.c=$A,$S.d=$h,$S.tx=$o*$G+$J.tx+$r*$A,$S.ty=$r*$h+$J.ty+$o*$z,$S},$r.create=function(){var $J=$r._cache,$o=$J._length?$J[--$J._length]:new $r;return $o.inPool=!1,$o},$r.EMPTY=new $r,$r.TEMP=new $r,$r._cache=[],$r}(),$g=function(){function $J($J,$o){void 0===$J&&($J=0),void 0===$o&&($o=0),this.x=$J,this.y=$o}$D($J,"laya.maths.Point");var $o=$J.prototype;return $o.setTo=function($J,$o){return this.x=$J,this.y=$o,this},$o.distance=function($J,$o){return Math.sqrt((this.x-$J)*(this.x-$J)+(this.y-$o)*(this.y-$o))},$o.toString=function(){return this.x+","+this.y},$o.normalize=function(){var $J=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$J){var $o=1/$J;this.x*=$o,this.y*=$o}},$J.TEMP=new $J,$J.EMPTY=new $J,$J}(),$s=function(){function $u($J,$o,$r,$S){void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0),this.x=$J,this.y=$o,this.width=$r,this.height=$S}$D($u,"laya.maths.Rectangle");var $J=$u.prototype;return $J.setTo=function($J,$o,$r,$S){return this.x=$J,this.y=$o,this.width=$r,this.height=$S,this},$J.copyFrom=function($J){return this.x=$J.x,this.y=$J.y,this.width=$J.width,this.height=$J.height,this},$J.contains=function($J,$o){return!(this.width<=0||this.height<=0)&&($J>=this.x&&$J<this.right&&$o>=this.y&&$o<this.bottom)},$J.intersects=function($J){return!($J.x>this.x+this.width||$J.x+$J.width<this.x||$J.y>this.y+this.height||$J.y+$J.height<this.y)},$J.intersection=function($J,$o){return this.intersects($J)?($o||($o=new $u),$o.x=Math.max(this.x,$J.x),$o.y=Math.max(this.y,$J.y),$o.width=Math.min(this.right,$J.right)-$o.x,$o.height=Math.min(this.bottom,$J.bottom)-$o.y,$o):null},$J.union=function($J,$o){return $o||($o=new $u),this.clone($o),$J.width<=0||$J.height<=0?$o:($o.addPoint($J.x,$J.y),$o.addPoint($J.right,$J.bottom),this)},$J.clone=function($J){return $J||($J=new $u),$J.x=this.x,$J.y=this.y,$J.width=this.width,$J.height=this.height,$J},$J.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$J.equals=function($J){return!(!$J||$J.x!==this.x||$J.y!==this.y||$J.width!==this.width||$J.height!==this.height)},$J.addPoint=function($J,$o){return this.x>$J&&(this.width+=this.x-$J,this.x=$J),this.y>$o&&(this.height+=this.y-$o,this.y=$o),this.width<$J-this.x&&(this.width=$J-this.x),this.height<$o-this.y&&(this.height=$o-this.y),this},$J._getBoundPoints=function(){var $J=$u._temB;return($J.length=0)==this.width||0==this.height||$J.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$J},$J.isEmpty=function(){return this.width<=0||this.height<=0},$B(0,$J,"right",function(){return this.x+this.width}),$B(0,$J,"bottom",function(){return this.y+this.height}),$u._getBoundPointS=function($J,$o,$r,$S){var $G=$u._temA;return($G.length=0)==$r||0==$S||$G.push($J,$o,$J+$r,$o,$J,$o+$S,$J+$r,$o+$S),$G},$u._getWrapRec=function($J,$o){if(!$J||$J.length<1)return $o?$o.setTo(0,0,0,0):$u.TEMP.setTo(0,0,0,0);$o=$o||new $u;var $r,$S,$G,$z,$A,$h=$J.length,$Z=$g.TEMP;for($G=$A=-($S=$z=99999),$r=0;$r<$h;$r+=2)$Z.x=$J[$r],$Z.y=$J[$r+1],$S=$S<$Z.x?$S:$Z.x,$z=$z<$Z.y?$z:$Z.y,$G=$G>$Z.x?$G:$Z.x,$A=$A>$Z.y?$A:$Z.y;return $o.setTo($S,$z,$G-$S,$A-$z)},$u.EMPTY=new $u,$u.TEMP=new $u,$u._temB=[],$u._temA=[],$u}(),$C=function(){function $Z(){}return $D($Z,"laya.media.SoundManager"),$B(1,$Z,"useAudioMusic",function(){return $Z._useAudioMusic},function($J){$Z._useAudioMusic=$J,$Z._musicClass=$J?$rJ:null}),$B(1,$Z,"autoStopMusic",function(){return $Z._autoStopMusic},function($J){$y.stage.off("blur",null,$Z._stageOnBlur),$y.stage.off("focus",null,$Z._stageOnFocus),$y.stage.off("visibilitychange",null,$Z._visibilityChange),($Z._autoStopMusic=$J)&&($y.stage.on("blur",null,$Z._stageOnBlur),$y.stage.on("focus",null,$Z._stageOnFocus),$y.stage.on("visibilitychange",null,$Z._visibilityChange))}),$B(1,$Z,"muted",function(){return $Z._muted},function($J){$J!=$Z._muted&&($J&&$Z.stopAllSound(),$Z.musicMuted=$J,$Z._muted=$J)}),$B(1,$Z,"musicMuted",function(){return $Z._musicMuted},function($J){$J!=$Z._musicMuted&&($J?($Z._tMusic&&$Z._musicChannel&&!$Z._musicChannel.isStopped?$Z._musicChannel.pause():$Z._musicChannel=null,$Z._musicMuted=$J):($Z._musicMuted=$J,$Z._tMusic&&$Z._musicChannel&&$Z._musicChannel.resume()))}),$B(1,$Z,"soundMuted",function(){return $Z._soundMuted},function($J){$Z._soundMuted=$J}),$Z.addChannel=function($J){0<=$Z._channels.indexOf($J)||($Z._channels.push($J),$Z.autoReleaseSound&&0!=$Z._notUsedCount&&$Z._notUsedUrls[$J.url]&&(delete $Z._notUsedUrls[$J.url],0==--$Z._notUsedCount&&$y.timer.clear($Z,$Z.disposeSoundIfNotUsed)))},$Z.removeChannel=function($J){var $o=$Z._channels,$r=$o.indexOf($J);if(-1!=$r&&($o.splice($r,1),$Z.autoReleaseSound)){var $S=$J.url,$G=$Z.defaultIntervals[$S]||2e4;if(0<$G){var $z=!0;for($r=$o.length-1;0<=$r;$r--)if($o[$r].url==$S){$z=!1;break}$z&&($Z._notUsedUrls[$S]=Date.now()+$G,0==$Z._notUsedCount++&&$y.timer.loop(1e4,$Z,$Z.disposeSoundIfNotUsed))}}},$Z.disposeSoundIfNotUsed=function(){var $J=$Z._notUsedUrls;if(0!=$Z._notUsedCount){var $o=Date.now();for(var $r in $J)$o>=$J[$r]&&(delete $J[$r],--$Z._notUsedCount,$Z.destroySound($r));if(0!=$Z._notUsedCount)return}$y.timer.clear($Z,$Z.disposeSoundIfNotUsed)},$Z._visibilityChange=function(){$y.stage.isVisibility?$Z._stageOnFocus():$Z._stageOnBlur()},$Z._stageOnBlur=function(){$Z._isActive=!1,$Z._musicChannel&&($Z._musicChannel.isStopped||($Z._blurPaused=!0,$Z._musicChannel.pause())),$Z.stopAllSound(),$y.stage.once("mousedown",null,$Z._stageOnFocus)},$Z._recoverWebAudio=function(){$zJ.ctx&&"running"!=$zJ.ctx.state&&$zJ.ctx.resume&&$zJ.ctx.resume()},$Z._stageOnFocus=function(){if($Z._isActive=!0,$Z._recoverWebAudio(),$y.stage.off("mousedown",null,$Z._stageOnFocus),$Z._blurPaused){var $J=$Z._musicChannel;$J&&$Z._music&&$J.isStopped&&($Z._blurPaused=!1,$Z._music._disposed?$Z.playMusic($J.url,$J.loops,$J.startHandler,$J.completeHandler,$J.startTime):$J.audioBuffer?$J.resume():$Z._music.play($J.startTime,$J.loops,$J.startHandler,$J))}},$Z.playSound=function($J,$o,$r,$S,$G,$z){if(void 0===$o&&($o=1),void 0===$z&&($z=0),!$J)return null;if($Z._muted)return null;if($Z._recoverWebAudio(),$J==$Z._tMusic){if($Z._musicMuted)return null}else{if(!$Z._isActive)return null;if($Z._soundMuted)return null}var $A,$h=$Z._pool[$J];return $G||($G=$Z._soundClass),$h||(($h=new $G).load($J),$Z._pool[$J]=$h),($A=$h.play($z,$o,$r))?($J==$Z._tMusic&&($Z._music=$h,$Z._isActive||($Z._blurPaused=!0,$A.pause())),$A.url=$J,$A.volume=$J==$Z._tMusic?$Z.musicVolume:$Z.soundVolume,$A.completeHandler=$S,$A):null},$Z.destroySound=function($J){var $o=$Z._pool[$J];$o&&(delete $Z._pool[$J],$o.dispose())},$Z.playMusic=function($J,$o,$r,$S,$G){return void 0===$o&&($o=0),void 0===$G&&($G=0),$Z._tMusic=$J,$Z._musicChannel&&$Z._musicChannel.stop(),$Z._musicChannel=$Z.playSound($J,$o,$r,$S,null,$G)},$Z.stopSound=function($J){for(var $o,$r=$Z._channels.length-1;0<=$r;$r--)($o=$Z._channels[$r]).url==$J&&$o.stop()},$Z.stopAll=function(){$Z._tMusic=null;var $J=0;for($J=$Z._channels.length-1;0<=$J;$J--)$Z._channels[$J].stop()},$Z.stopAllSound=function(){var $J,$o=0;for($o=$Z._channels.length-1;0<=$o;$o--)($J=$Z._channels[$o]).url!=$Z._tMusic&&$J.stop()},$Z.stopMusic=function(){$Z._musicChannel&&$Z._musicChannel.stop(),$Z._tMusic=null},$Z.setSoundVolume=function($J,$o){if($o)$Z._setVolume($o,$J);else{$Z.soundVolume=$J;var $r,$S=0;for($S=$Z._channels.length-1;0<=$S;$S--)($r=$Z._channels[$S]).url!=$Z._tMusic&&($r.volume=$J)}},$Z.setMusicVolume=function($J){$Z.musicVolume=$J,$Z._setVolume($Z._tMusic,$J)},$Z._setVolume=function($J,$o){for(var $r,$S=$Z._channels.length-1;0<=$S;$S--)($r=$Z._channels[$S]).url==$J&&($r.volume=$o)},$Z.musicVolume=1,$Z.soundVolume=1,$Z.playbackRate=1,$Z._useAudioMusic=!0,$Z._muted=!1,$Z._soundMuted=!1,$Z._musicMuted=!1,$Z._tMusic=null,$Z._musicChannel=null,$Z._music=null,$Z._channels=[],$Z._autoStopMusic=!1,$Z._blurPaused=!1,$Z._isActive=!0,$Z._soundClass=null,$Z._musicClass=null,$Z.autoReleaseSound=!0,$Z._pool={},$Z.defaultIntervals={},$Z._notUsedUrls={},$Z._notUsedCount=0,$Z}(),$V=function(){var $J;function $r(){}return $D($r,"laya.net.LocalStorage"),$r.__init__=function(){$r._baseClass||($r._baseClass=$J).init(),$r.items=$r._baseClass.items,$r.support=$r._baseClass.support},$r.setItem=function($J,$o){$r._baseClass.setItem($J,$o)},$r.getItem=function($J){return $r._baseClass.getItem($J)},$r.setJSON=function($J,$o){$r._baseClass.setJSON($J,$o)},$r.getJSON=function($J){return $r._baseClass.getJSON($J)},$r.removeItem=function($J){$r._baseClass.removeItem($J)},$r.clear=function(){$r._baseClass.clear()},$r._baseClass=null,$r.items=null,$r.support=!1,$r.__init$=function(){$J=function(){function $r(){}return $D($r,""),$r.init=function(){try{$r.support=!0,$r.items=$A.localStorage,$r.setItem("laya","1"),$r.removeItem("laya")}catch($J){$r.support=!1}$r.support||console.log("LocalStorage is not supprot or browser is private mode.")},$r.setItem=function($J,$o){try{$r.support&&$r.items.setItem($J,$o)}catch($J){console.warn("set localStorage failed",$J)}},$r.getItem=function($J){return $r.support?$r.items.getItem($J):null},$r.setJSON=function($J,$o){try{$r.support&&$r.items.setItem($J,JSON.stringify($o))}catch($J){console.warn("set localStorage failed",$J)}},$r.getJSON=function($J){return JSON.parse($r.support?$r.items.getItem($J):null)},$r.removeItem=function($J){$r.support&&$r.items.removeItem($J)},$r.clear=function(){$r.support&&$r.items.clear()},$r.items=null,$r.support=!1,$r}()},$r}(),$k=(function(){function $S(){}$D($S,"laya.net.ResourceVersion"),$S.enable=function($J,$o,$r){void 0===$r&&($r=2),laya.net.ResourceVersion.type=$r,$y.loader.load($J,$i.create(null,$S.onManifestLoaded,[$o]),null,"json"),$U.customFormat=$S.addVersionPrefix},$S.onManifestLoaded=function($J,$o){$S.manifest=$o,$J.run(),$o||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$S.addVersionPrefix=function($J){return $S.manifest&&$S.manifest[$J]?2==$S.type?$S.manifest[$J]:$S.manifest[$J]+"/"+$J:$J},$S.FOLDER_VERSION=1,$S.FILENAME_VERSION=2,$S.manifest=null,$S.type=1}(),function(){function $J(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$D($J,"laya.net.TTFLoader");var $o=$J.prototype;return $o.load=function($J){var $o=(this._url=$J).split(".ttf")[0].split("/");this.fontName=$o[$o.length-1],$d.window.conch?this._loadConch():$d.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$o._loadConch=function(){this._http=new $AJ,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$o._onHttpLoaded=function($J){$d.window.conch.setFontFaceFromBuffer(this.fontName,$J),this._clearHttp(),this._complete()},$o._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$o._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$o._complete=function(){$y.timer.clear(this,this._complete),$y.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$o._checkComplete=function(){$R.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$o._loadWithFontFace=function(){var $J=new $d.window.FontFace(this.fontName,"url('"+this._url+"')");$d.window.document.fonts.add($J);var $o=this;$J.loaded.then(function(){$o._complete()}),$J.load()},$o._createDiv=function(){this._div=$d.createElement("div"),this._div.innerHTML="laya";var $J=this._div.style;$J.fontFamily=this.fontName,$J.position="absolute",$J.left="-100px",$J.top="-100px",$d.document.body.appendChild(this._div)},$o._loadWithCSS=function(){var $J=this,$o=$d.createElement("style");$o.type="text/css",$d.document.body.appendChild($o),$o.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$R.measureText("LayaTTFFont",this._fontTxt).width;var $r=this;$o.onload=function(){$y.timer.once(1e4,$r,$J._complete)},$y.timer.loop(20,this,this._checkComplete),this._createDiv()},$J._testString="LayaTTFFont",$J}()),$U=function(){function $S($J){this._url=null,this._path=null,this._url=$S.formatURL($J),this._path=$S.getPath($J)}$D($S,"laya.net.URL");var $J=$S.prototype;return $B(0,$J,"path",function(){return this._path}),$B(0,$J,"url",function(){return this._url}),$S.formatURL=function($J,$o){if(!$J)return"null path";if(0<$J.indexOf(":"))return $J;null!=$S.customFormat&&($J=$S.customFormat($J,$o));var $r=$J.charAt(0);if("."===$r)return $S.formatRelativePath(($o||$S.basePath)+$J);if("~"===$r)return $S.rootPath+$J.substring(1);if("d"===$r){if(0===$J.indexOf("data:image"))return $J}else if("/"===$r)return $J;return($o||$S.basePath)+$J},$S.formatRelativePath=function($J){for(var $o=$J.split("/"),$r=0,$S=$o.length;$r<$S;$r++)".."==$o[$r]&&($o.splice($r-1,2),$r-=2);return $o.join("/")},$S.isAbsolute=function($J){return 0<$J.indexOf(":")||"/"==$J.charAt(0)},$S.getPath=function($J){var $o=$J.lastIndexOf("/");return 0<$o?$J.substr(0,$o+1):""},$S.getFileName=function($J){var $o=$J.lastIndexOf("/");return 0<$o?$J.substr($o+1):$J},$S.version={},$S.basePath="",$S.rootPath="",$S.customFormat=function($J){var $o=$S.version[$J];return!$L.isConchApp&&$o&&($J+="?v="+$o),$J},$S}(),$L=function(){function $G($J,$o){this._timeId=0;var $r=$G._mainCanvas.source.style;$r.position="absolute",$r.top=$r.left="0px",$r.background="#000000",$G._mainCanvas.source.id="layaCanvas";var $S=laya.renders.Render.isWebGL;$G._mainCanvas.source.width=$J,$G._mainCanvas.source.height=$o,$S&&$G.WebGL.init($G._mainCanvas,$J,$o),$d.container.appendChild($G._mainCanvas.source),($G._context=new $Q($J,$o,$S?null:$G._mainCanvas)).ctx.setIsMainContext(),$d.window.requestAnimationFrame(function $J($o){$d.window.requestAnimationFrame($J);$y.stage._loop()}),$y.stage.on("visibilitychange",this,this._onVisibilitychange)}$D($G,"laya.renders.Render");var $J=$G.prototype;return $J._onVisibilitychange=function(){$y.stage.isVisibility?0!=this._timeId&&$d.window.clearInterval(this._timeId):this._timeId=$d.window.setInterval(this._enterFrame,1e3)},$J._enterFrame=function($J){$y.stage._loop()},$B(1,$G,"context",function(){return $G._context}),$B(1,$G,"canvas",function(){return $G._mainCanvas.source}),$G._context=null,$G._mainCanvas=null,$G.WebGL=null,$G.isConchNode=!1,$G.isConchApp=!1,$G.isConchWebGL=!1,$G.isWebGL=!1,$G.is3DMode=!1,$G.optimizeTextureMemory=function($J,$o){return!0},$G.__init$=function(){$A.ConchRenderType=$A.ConchRenderType||1,$A.ConchRenderType|=$A.conch?4:0,$G.isConchNode=5==(5&$A.ConchRenderType),$G.isConchApp=4==(4&$A.ConchRenderType),$G.isConchWebGL=6==$A.ConchRenderType},$G}(),$Q=function(){function $A($J,$o,$r){this.x=0,this.y=0,this._drawTexture=function($J,$o,$r){$r[0].loaded&&this.ctx.drawTexture($r[0],$r[1],$r[2],$r[3],$r[4],$J,$o)},this._fillTexture=function($J,$o,$r){$r[0].loaded&&this.ctx.fillTexture($r[0],$r[1]+$J,$r[2]+$o,$r[3],$r[4],$r[5],$r[6],$r[7])},this._drawTextureWithTransform=function($J,$o,$r){$r[0].loaded&&this.ctx.drawTextureWithTransform($r[0],$r[1],$r[2],$r[3],$r[4],$r[5],$J,$o,$r[6])},this._fillQuadrangle=function($J,$o,$r){this.ctx.fillQuadrangle($r[0],$r[1],$r[2],$r[3],$r[4])},this._drawRect=function($J,$o,$r){var $S=this.ctx;null!=$r[4]&&($S.fillStyle=$r[4],$S.fillRect($J+$r[0],$o+$r[1],$r[2],$r[3],null)),null!=$r[5]&&($S.strokeStyle=$r[5],$S.lineWidth=$r[6],$S.strokeRect($J+$r[0],$o+$r[1],$r[2],$r[3],$r[6]))},this._drawPie=function($J,$o,$r){var $S=this.ctx;$L.isWebGL&&$S.setPathId($r[8]),$S.beginPath(),$L.isWebGL?($S.movePath($r[0]+$J,$r[1]+$o),$S.moveTo(0,0)):$S.moveTo($J+$r[0],$o+$r[1]),$S.arc($J+$r[0],$o+$r[1],$r[2],$r[3],$r[4]),$S.closePath(),this._fillAndStroke($r[5],$r[6],$r[7],!0)},this._clipRect=function($J,$o,$r){this.ctx.clipRect($J+$r[0],$o+$r[1],$r[2],$r[3])},this._fillRect=function($J,$o,$r){this.ctx.fillRect($J+$r[0],$o+$r[1],$r[2],$r[3],$r[4])},this._drawCircle=function($J,$o,$r){var $S=this.ctx;$L.isWebGL&&$S.setPathId($r[6]),$x.drawCall++,$S.beginPath(),$L.isWebGL&&$S.movePath($r[0]+$J,$r[1]+$o),$S.arc($r[0]+$J,$r[1]+$o,$r[2],0,$A.PI2),$S.closePath(),this._fillAndStroke($r[3],$r[4],$r[5],!0)},this._fillCircle=function($J,$o,$r){$x.drawCall++;var $S=this.ctx;$S.beginPath(),$S.fillStyle=$r[3],$S.arc($r[0]+$J,$r[1]+$o,$r[2],0,$A.PI2),$S.fill()},this._setShader=function($J,$o,$r){this.ctx.setShader($r[0])},this._drawLine=function($J,$o,$r){var $S=this.ctx;$L.isWebGL&&$S.setPathId($r[6]),$S.beginPath(),$S.strokeStyle=$r[4],$S.lineWidth=$r[5],$L.isWebGL?($S.movePath($J,$o),$S.moveTo($r[0],$r[1]),$S.lineTo($r[2],$r[3])):($S.moveTo($J+$r[0],$o+$r[1]),$S.lineTo($J+$r[2],$o+$r[3])),$S.stroke()},this._drawLines=function($J,$o,$r){var $S=this.ctx;$L.isWebGL&&$S.setPathId($r[5]),$S.beginPath(),$J+=$r[0],$o+=$r[1],$L.isWebGL&&$S.movePath($J,$o),$S.strokeStyle=$r[3],$S.lineWidth=$r[4];var $G=$r[2],$z=2,$A=$G.length;if($L.isWebGL)for($S.moveTo($G[0],$G[1]);$z<$A;)$S.lineTo($G[$z++],$G[$z++]);else for($S.moveTo($J+$G[0],$o+$G[1]);$z<$A;)$S.lineTo($J+$G[$z++],$o+$G[$z++]);$S.stroke()},this._drawLinesWebGL=function($J,$o,$r){this.ctx.drawLines($J+this.x+$r[0],$o+this.y+$r[1],$r[2],$r[3],$r[4])},this._drawCurves=function($J,$o,$r){this.ctx.drawCurves($J,$o,$r)},this._draw=function($J,$o,$r){$r[0].call(null,this,$J,$o)},this._transformByMatrix=function($J,$o,$r){this.ctx.transformByMatrix($r[0])},this._setTransform=function($J,$o,$r){this.ctx.setTransform($r[0],$r[1],$r[2],$r[3],$r[4],$r[5])},this._setTransformByMatrix=function($J,$o,$r){this.ctx.setTransformByMatrix($r[0])},this._save=function($J,$o,$r){this.ctx.save()},this._restore=function($J,$o,$r){this.ctx.restore()},this._translate=function($J,$o,$r){this.ctx.translate($r[0],$r[1])},this._transform=function($J,$o,$r){this.ctx.translate($r[1]+$J,$r[2]+$o);var $S=$r[0];this.ctx.transform($S.a,$S.b,$S.c,$S.d,$S.tx,$S.ty),this.ctx.translate(-$J-$r[1],-$o-$r[2])},this._rotate=function($J,$o,$r){this.ctx.translate($r[1]+$J,$r[2]+$o),this.ctx.rotate($r[0]),this.ctx.translate(-$J-$r[1],-$o-$r[2])},this._scale=function($J,$o,$r){this.ctx.translate($r[2]+$J,$r[3]+$o),this.ctx.scale($r[0],$r[1]),this.ctx.translate(-$J-$r[2],-$o-$r[3])},this._alpha=function($J,$o,$r){this.ctx.globalAlpha*=$r[0]},this._setAlpha=function($J,$o,$r){this.ctx.globalAlpha=$r[0]},this._fillText=function($J,$o,$r){this.ctx.fillText($r[0],$r[1]+$J,$r[2]+$o,$r[3],$r[4],$r[5])},this._strokeText=function($J,$o,$r){this.ctx.strokeText($r[0],$r[1]+$J,$r[2]+$o,$r[3],$r[4],$r[5],$r[6])},this._fillBorderText=function($J,$o,$r){this.ctx.fillBorderText($r[0],$r[1]+$J,$r[2]+$o,$r[3],$r[4],$r[5],$r[6],$r[7])},this._blendMode=function($J,$o,$r){this.ctx.globalCompositeOperation=$r[0]},this._beginClip=function($J,$o,$r){this.ctx.beginClip&&this.ctx.beginClip($J+$r[0],$o+$r[1],$r[2],$r[3])},this._setIBVB=function($J,$o,$r){this.ctx.setIBVB($r[0]+$J,$r[1]+$o,$r[2],$r[3],$r[4],$r[5],$r[6],$r[7])},this._fillTrangles=function($J,$o,$r){this.ctx.fillTrangles($r[0],$r[1]+$J,$r[2]+$o,$r[3],$r[4])},this._drawPath=function($J,$o,$r){var $S=this.ctx;$L.isWebGL&&$S.setPathId(-1),$S.beginPath(),$J+=$r[0],$o+=$r[1],$L.isWebGL&&$S.movePath($J,$o);for(var $G=$r[2],$z=0,$A=$G.length;$z<$A;$z++){var $h=$G[$z];switch($h[0]){case"moveTo":$L.isWebGL?$S.moveTo($h[1],$h[2]):$S.moveTo($J+$h[1],$o+$h[2]);break;case"lineTo":$L.isWebGL?$S.lineTo($h[1],$h[2]):$S.lineTo($J+$h[1],$o+$h[2]);break;case"arcTo":$L.isWebGL?$S.arcTo($h[1],$h[2],$h[3],$h[4],$h[5]):$S.arcTo($J+$h[1],$o+$h[2],$J+$h[3],$o+$h[4],$h[5]);break;case"closePath":$S.closePath()}}var $Z=$r[3];null!=$Z&&($S.fillStyle=$Z.fillStyle,$S.fill());var $u=$r[4];null!=$u&&($S.strokeStyle=$u.strokeStyle,$S.lineWidth=$u.lineWidth||1,$S.lineJoin=$u.lineJoin,$S.lineCap=$u.lineCap,$S.miterLimit=$u.miterLimit,$S.stroke())},this.drawPoly=function($J,$o,$r){this.ctx.drawPoly($J+this.x+$r[0],$o+this.y+$r[1],$r[2],$r[3],$r[4],$r[5],$r[6])},this._drawPoly=function($J,$o,$r){var $S=this.ctx,$G=$r[2],$z=2,$A=$G.length;if($L.isWebGL)for($S.setPathId($r[6]),$S.beginPath(),$J+=$r[0],$o+=$r[1],$S.movePath($J,$o),$S.moveTo($G[0],$G[1]);$z<$A;)$S.lineTo($G[$z++],$G[$z++]);else for($S.beginPath(),$J+=$r[0],$o+=$r[1],$S.moveTo($J+$G[0],$o+$G[1]);$z<$A;)$S.lineTo($J+$G[$z++],$o+$G[$z++]);$S.closePath(),this._fillAndStroke($r[3],$r[4],$r[5],$r[7])},this._drawSkin=function($J,$o,$r){var $S=$r[0];if($S){var $G=this.ctx;$S.render($G,$J,$o)}},this._drawParticle=function($J,$o,$r){this.ctx.drawParticle($J+this.x,$o+this.y,$r[0])},this._setFilters=function($J,$o,$r){this.ctx.setFilters($r)},$r?this.ctx=$r.getContext("2d"):($r=$IJ.create("3D"),this.ctx=$R.createWebGLContext2D($r),$r._setContext(this.ctx)),$r.size($J,$o),this.canvas=$r}$D($A,"laya.renders.RenderContext");var $J=$A.prototype;return $J.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$J.drawTexture=function($J,$o,$r,$S,$G){$J.loaded&&this.ctx.drawTexture($J,$o,$r,$S,$G,this.x,this.y)},$J._drawTextures=function($J,$o,$r){$r[0].loaded&&this.ctx.drawTextures($r[0],$r[1],$J+this.x,$o+this.y)},$J.drawTextureWithTransform=function($J,$o,$r,$S,$G,$z,$A){$J.loaded&&this.ctx.drawTextureWithTransform($J,$o,$r,$S,$G,$z,this.x,this.y,$A)},$J.fillQuadrangle=function($J,$o,$r,$S,$G){this.ctx.fillQuadrangle($J,$o,$r,$S,$G)},$J.drawCanvas=function($J,$o,$r,$S,$G){this.ctx.drawCanvas($J,$o+this.x,$r+this.y,$S,$G)},$J.drawRect=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=1);var $A=this.ctx;$A.strokeStyle=$G,$A.lineWidth=$z,$A.strokeRect($J+this.x,$o+this.y,$r,$S,$z)},$J._fillAndStroke=function($J,$o,$r,$S){void 0===$S&&($S=!1);var $G=this.ctx;null!=$J&&($G.fillStyle=$J,$L.isWebGL?$G.fill($S):$G.fill()),null!=$o&&0<$r&&($G.strokeStyle=$o,$G.lineWidth=$r,$G.stroke())},$J.clipRect=function($J,$o,$r,$S){this.ctx.clipRect($J+this.x,$o+this.y,$r,$S)},$J.fillRect=function($J,$o,$r,$S,$G){this.ctx.fillRect($J+this.x,$o+this.y,$r,$S,$G)},$J.drawCircle=function($J,$o,$r,$S,$G){void 0===$G&&($G=1),$x.drawCall++;var $z=this.ctx;$z.beginPath(),$z.strokeStyle=$S,$z.lineWidth=$G,$z.arc($J+this.x,$o+this.y,$r,0,$A.PI2),$z.stroke()},$J.drawTriangles=function($J,$o,$r){if($L.isWebGL)this.ctx.drawTriangles($r[0],$J+$r[1],$o+$r[2],$r[3],$r[4],$r[5],$r[6],$r[7],$r[8],$r[9]);else{var $S=$r[5],$G=0,$z=$S.length,$A=this.ctx;for($G=0;$G<$z;$G+=3){var $h=2*$S[$G],$Z=2*$S[$G+1],$u=2*$S[$G+2];$A.drawTriangle($r[0],$r[3],$r[4],$h,$Z,$u,$r[6],!0)}}},$J.fillCircle=function($J,$o,$r,$S){$x.drawCall++;var $G=this.ctx;$G.beginPath(),$G.fillStyle=$S,$G.arc($J+this.x,$o+this.y,$r,0,$A.PI2),$G.fill()},$J.setShader=function($J){this.ctx.setShader($J)},$J.drawLine=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=1);var $A=this.ctx;$A.beginPath(),$A.strokeStyle=$G,$A.lineWidth=$z,$A.moveTo(this.x+$J,this.y+$o),$A.lineTo(this.x+$r,this.y+$S),$A.stroke()},$J.clear=function(){this.ctx.clear()},$J.transformByMatrix=function($J){this.ctx.transformByMatrix($J)},$J.setTransform=function($J,$o,$r,$S,$G,$z){this.ctx.setTransform($J,$o,$r,$S,$G,$z)},$J.setTransformByMatrix=function($J){this.ctx.setTransformByMatrix($J)},$J.save=function(){this.ctx.save()},$J.restore=function(){this.ctx.restore()},$J.translate=function($J,$o){this.ctx.translate($J,$o)},$J.transform=function($J,$o,$r,$S,$G,$z){this.ctx.transform($J,$o,$r,$S,$G,$z)},$J.rotate=function($J){this.ctx.rotate($J)},$J.scale=function($J,$o){this.ctx.scale($J,$o)},$J.alpha=function($J){this.ctx.globalAlpha*=$J},$J.setAlpha=function($J){this.ctx.globalAlpha=$J},$J.fillWords=function($J,$o,$r,$S,$G,$z){void 0===$z&&($z=0),this.ctx.fillWords($J,$o,$r,$S,$G,$z)},$J.fillBorderWords=function($J,$o,$r,$S,$G,$z,$A){this.ctx.fillBorderWords($J,$o,$r,$S,$G,$z,$A)},$J.fillText=function($J,$o,$r,$S,$G,$z){this.ctx.fillText($J,$o+this.x,$r+this.y,$S,$G,$z)},$J.strokeText=function($J,$o,$r,$S,$G,$z,$A){this.ctx.strokeText($J,$o+this.x,$r+this.y,$S,$G,$z,$A)},$J.blendMode=function($J){this.ctx.globalCompositeOperation=$J},$J.flush=function(){this.ctx.flush&&this.ctx.flush()},$J.addRenderObject=function($J){this.ctx.addRenderObject($J)},$J.beginClip=function($J,$o,$r,$S){this.ctx.beginClip&&this.ctx.beginClip($J,$o,$r,$S)},$J.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$J.fillTrangles=function($J,$o,$r){this.ctx.fillTrangles($r[0],$r[1],$r[2],$r[3],4<$r.length?$r[4]:null)},$A.PI2=2*Math.PI,$A}(),$p=function(){function $A($J,$o){switch(this._next=$o||$A.NORENDER,$J){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$w._filter);case 69905:return void(this._fun=$A._initRenderFun)}this.onCreate($J)}$D($A,"laya.renders.RenderSprite");var $J=$A.prototype;return $J.onCreate=function($J){},$J._style=function($J,$o,$r,$S){$J._style.render($J,$o,$r,$S);var $G=this._next;$G._fun.call($G,$J,$o,$r,$S)},$J._no=function($J,$o,$r,$S){},$J._custom=function($J,$o,$r,$S){$J.customRender($o,$r,$S);var $G=$J._style._tf;this._next._fun.call(this._next,$J,$o,$r-$G.translateX,$S-$G.translateY)},$J._clip=function($J,$o,$r,$S){var $G=this._next;if($G!=$A.NORENDER){var $z=$J._style.scrollRect;$o.ctx.save(),$o.ctx.clipRect($r,$S,$z.width,$z.height),$G._fun.call($G,$J,$o,$r-$z.x,$S-$z.y),$o.ctx.restore()}},$J._blend=function($J,$o,$r,$S){var $G=$J._style;$G.blendMode&&($o.ctx.globalCompositeOperation=$G.blendMode);var $z=this._next;$z._fun.call($z,$J,$o,$r,$S),$o.ctx.globalCompositeOperation="source-over"},$J._mask=function($J,$o,$r,$S){var $G=this._next;$G._fun.call($G,$J,$o,$r,$S);var $z=$J.mask;$z&&($o.ctx.globalCompositeOperation="destination-in",(0<$z.numChildren||!$z.graphics._isOnlyOne())&&($z.cacheAsBitmap=!0),$z.render($o,$r-$J.pivotX,$S-$J.pivotY)),$o.ctx.globalCompositeOperation="source-over"},$J._graphics=function($J,$o,$r,$S){var $G=$J._style._tf;$J._graphics&&$J._graphics._render($J,$o,$r-$G.translateX,$S-$G.translateY);var $z=this._next;$z._fun.call($z,$J,$o,$r,$S)},$J._image=function($J,$o,$r,$S){var $G=$J._style;$o.ctx.drawTexture2($r,$S,$G._tf.translateX,$G._tf.translateY,$J.transform,$G.alpha,$G.blendMode,$J._graphics._one)},$J._image2=function($J,$o,$r,$S){var $G=$J._style._tf;$o.ctx.drawTexture2($r,$S,$G.translateX,$G.translateY,$J.transform,1,null,$J._graphics._one)},$J._alpha=function($J,$o,$r,$S){var $G;if(.01<($G=$J._style.alpha)||$J._needRepaint()){var $z=$o.ctx.globalAlpha;$o.ctx.globalAlpha*=$G;var $A=this._next;$A._fun.call($A,$J,$o,$r,$S),$o.ctx.globalAlpha=$z}},$J._transform=function($J,$o,$r,$S){var $G=$J.transform,$z=this._next;$G&&$z!=$A.NORENDER?($o.save(),$o.transform($G.a,$G.b,$G.c,$G.d,$G.tx+$r,$G.ty+$S),$z._fun.call($z,$J,$o,0,0),$o.restore()):$z._fun.call($z,$J,$o,$r,$S)},$J._childs=function($J,$o,$r,$S){var $G=$J._style,$z=$G._tf;if($r=$r-$z.translateX+$G.paddingLeft,$S=$S-$z.translateY+$G.paddingTop,$G._calculation){var $A=$J._getWords();if($A){var $h=$G;$h&&($h.stroke?$o.fillBorderWords($A,$r,$S,$h.font,$h.color,$h.strokeColor,$h.stroke):$o.fillWords($A,$r,$S,$h.font,$h.color,"none"!=$h.textDecoration&&$h.underLine?1:0))}}var $Z,$u=$J._childs,$B=$u.length;if($J.viewport||$J.optimizeScrollRect&&$J._style.scrollRect){var $v=$J.viewport||$J._style.scrollRect,$j=$v.x,$Y=$v.y,$_=$v.right,$D=$v.bottom,$N=NaN,$w=NaN;for($i=0;$i<$B;++$i)($Z=$u[$i]).visible&&($N=$Z._x)<$_&&$N+$Z.width>$j&&($w=$Z._y)<$D&&$w+$Z.height>$Y&&$Z.render($o,$r,$S)}else for(var $i=0;$i<$B;++$i)($Z=$u[$i])._style.visible&&$Z.render($o,$r,$S)},$J._canvas=function($J,$o,$r,$S){var $G=$J._$P.cacheCanvas;if($G){"bitmap"===$G.type?$x.canvasBitmap++:$x.canvasNormal++;var $z=$G.ctx;if($J._needRepaint()||!$z)this._canvas_repaint($J,$o,$r,$S);else{var $A=$G._cacheRec;$o.drawCanvas($z.canvas,$r+$A.x,$S+$A.y,$A.width,$A.height)}}else this._next._fun.call(this._next,$J,$o,$r,$S)},$J._canvas_repaint=function($J,$o,$r,$S){var $G=$J._$P.cacheCanvas,$z=this._next;if($G){var $A,$h,$Z,$u,$B=$G.ctx,$v=$J._needRepaint()||!$B,$j=$G.type;if("bitmap"===$j?$x.canvasBitmap++:$x.canvasNormal++,$v){var $Y,$_;$G._cacheRec||($G._cacheRec=new $s),$L.isWebGL&&"bitmap"!==$j?$G._cacheRec.setTo(-$J.pivotX,-$J.pivotY,1,1):(($u=$J.getSelfBounds()).x=$u.x-$J.pivotX,$u.y=$u.y-$J.pivotY,$u.x=$u.x-16,$u.y=$u.y-16,$u.width=$u.width+32,$u.height=$u.height+32,$u.x=Math.floor($u.x+$r)-$r,$u.y=Math.floor($u.y+$S)-$S,$u.width=Math.floor($u.width),$u.height=Math.floor($u.height),$G._cacheRec.copyFrom($u)),$u=$G._cacheRec;var $D,$N=$L.isWebGL?1:$d.pixelRatio*$y.stage.clientScaleX,$w=$L.isWebGL?1:$d.pixelRatio*$y.stage.clientScaleY;if(!$L.isWebGL){var $i,$I=1,$t=1;for($i=$J;$i&&$i!=$y.stage;)$I*=$i.scaleX,$t*=$i.scaleY,$i=$i.parent;$L.isWebGL?($I<1&&($N*=$I),$t<1&&($w*=$t)):(1<$I&&($N*=$I),1<$t&&($w*=$t))}if($J.scrollRect){var $K=$J.scrollRect;$u.x-=$K.x,$u.y-=$K.y}if($Y=$u.width*$N,$_=$u.height*$w,$h=$u.x,$Z=$u.y,$L.isWebGL&&"bitmap"===$j&&(2048<$Y||2048<$_))return console.warn("cache bitmap size larger than 2048,cache ignored"),$G.ctx&&($a.recover("RenderContext",$G.ctx),$G.ctx.canvas.size(0,0),$G.ctx=null),void $z._fun.call($z,$J,$o,$r,$S);if($B||($B=$G.ctx=$a.getItem("RenderContext")||new $Q($Y,$_,$IJ.create("AUTO"))),$B.ctx.sprite=$J,($A=$B.canvas).clear(),($A.width!=$Y||$A.height!=$_)&&$A.size($Y,$_),"bitmap"===$j?$A.context.asBitmap=!0:"normal"===$j&&($A.context.asBitmap=!1),1!=$N||1!=$w){var $e=$B.ctx;$e.save(),$e.scale($N,$w),!$L.isConchWebGL&&$L.isConchApp&&($D=$J._$P.cf)&&$e.setFilterMatrix&&$e.setFilterMatrix($D._mat,$D._alpha),$z._fun.call($z,$J,$B,-$h,-$Z),$e.restore(),$L.isConchApp&&!$L.isConchWebGL||$J._applyFilters()}else $e=$B.ctx,!$L.isConchWebGL&&$L.isConchApp&&($D=$J._$P.cf)&&$e.setFilterMatrix&&$e.setFilterMatrix($D._mat,$D._alpha),$z._fun.call($z,$J,$B,-$h,-$Z),$L.isConchApp&&!$L.isConchWebGL||$J._applyFilters();$J._$P.staticCache&&($G.reCache=!1),$x.canvasReCache++}else $h=($u=$G._cacheRec).x,$Z=$u.y,$A=$B.canvas;$o.drawCanvas($A,$r+$h,$S+$Z,$u.width,$u.height)}else $z._fun.call($z,$J,$B,$r,$S)},$A.__init__=function(){var $J,$o,$r=0;for($o=$R.createRenderSprite(69905,null),$J=$A.renders.length=4096,$r=0;$r<$J;$r++)$A.renders[$r]=$o;$A.renders[0]=$R.createRenderSprite(0,null),function($J,$o){for(var $r=0,$S=0;$S<$J.length;$S++)$r|=$J[$S],$A.renders[$r]=$o}([1,512,4,2],new $A(1,null)),$A.renders[513]=$R.createRenderSprite(513,null),$A.renders[517]=new $A(517,null)},$A._initRenderFun=function($J,$o,$r,$S){var $G=$J._renderType;($A.renders[$G]=$A._getTypeRender($G))._fun($J,$o,$r,$S)},$A._getTypeRender=function($J){for(var $o=null,$r=2048;1<$r;)$r&$J&&($o=$R.createRenderSprite($r,$o)),$r>>=1;return $o},$A.IMAGE=1,$A.ALPHA=2,$A.TRANSFORM=4,$A.BLEND=8,$A.CANVAS=16,$A.FILTERS=32,$A.MASK=64,$A.CLIP=128,$A.STYLE=256,$A.GRAPHICS=512,$A.CUSTOM=1024,$A.CHILDS=2048,$A.INIT=69905,$A.renders=[],$A.NORENDER=new $A(0,null),$A}(),$f=function(){function $h(){this._repaint=!1}$D($h,"laya.resource.Context");var $J=$h.prototype;return $J.replaceReset=function(){var $J,$o,$r=0;for($J=$h.replaceKeys.length,$r=0;$r<$J;$r++)$o=$h.replaceKeys[$r],this[$h.newKeys[$r]]=this[$o]},$J.replaceResotre=function(){this.__restore(),this.__reset()},$J.setIsMainContext=function(){},$J.drawTextures=function($J,$o,$r,$S){$x.drawCall+=$o.length/2;for(var $G=$J.width,$z=$J.height,$A=0,$h=$o.length;$A<$h;$A+=2)this.drawTexture($J,$o[$A],$o[$A+1],$G,$z,$r,$S)},$J.drawCanvas=function($J,$o,$r,$S,$G){$x.drawCall++,this.drawImage($J.source,$o,$r,$S,$G)},$J.fillRect=function($J,$o,$r,$S,$G){$x.drawCall++,$G&&(this.fillStyle=$G),this.__fillRect($J,$o,$r,$S)},$J.fillText=function($J,$o,$r,$S,$G,$z){$x.drawCall++,3<arguments.length&&null!=$S&&(this.font=$S,this.fillStyle=$G,this.textAlign=$z,this.textBaseline="top"),this.__fillText($J,$o,$r)},$J.fillBorderText=function($J,$o,$r,$S,$G,$z,$A,$h){$x.drawCall++,this.font=$S,this.fillStyle=$G,this.textBaseline="top",this.strokeStyle=$z,this.lineWidth=$A,this.textAlign=$h,this.__strokeText($J,$o,$r),this.__fillText($J,$o,$r)},$J.strokeText=function($J,$o,$r,$S,$G,$z,$A){$x.drawCall++,3<arguments.length&&null!=$S&&(this.font=$S,this.strokeStyle=$G,this.lineWidth=$z,this.textAlign=$A,this.textBaseline="top"),this.__strokeText($J,$o,$r)},$J.transformByMatrix=function($J){this.transform($J.a,$J.b,$J.c,$J.d,$J.tx,$J.ty)},$J.setTransformByMatrix=function($J){this.setTransform($J.a,$J.b,$J.c,$J.d,$J.tx,$J.ty)},$J.clipRect=function($J,$o,$r,$S){$x.drawCall++,this.beginPath(),this.rect($J,$o,$r,$S),this.clip()},$J.drawTexture=function($J,$o,$r,$S,$G,$z,$A){$x.drawCall++;var $h=$J.uv,$Z=$J.bitmap.width,$u=$J.bitmap.height;this.drawImage($J.source,$h[0]*$Z,$h[1]*$u,($h[2]-$h[0])*$Z,($h[5]-$h[3])*$u,$o+$z,$r+$A,$S,$G)},$J.drawTextureWithTransform=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){$x.drawCall++;var $u=$J.uv,$B=$J.bitmap.width,$v=$J.bitmap.height;this.save(),1!=$Z&&(this.globalAlpha*=$Z),$z?(this.transform($z.a,$z.b,$z.c,$z.d,$z.tx+$A,$z.ty+$h),this.drawImage($J.source,$u[0]*$B,$u[1]*$v,($u[2]-$u[0])*$B,($u[5]-$u[3])*$v,$o,$r,$S,$G)):this.drawImage($J.source,$u[0]*$B,$u[1]*$v,($u[2]-$u[0])*$B,($u[5]-$u[3])*$v,$o+$A,$r+$h,$S,$G),this.restore()},$J.drawTexture2=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=$h[0];if($Z.loaded&&$Z.bitmap&&$Z.source){$x.drawCall++;var $u=1!==$z;if($u){var $B=this.globalAlpha;this.globalAlpha*=$z}var $v=$Z.uv,$j=$Z.bitmap.width,$Y=$Z.bitmap.height;$G?(this.save(),this.transform($G.a,$G.b,$G.c,$G.d,$G.tx+$J,$G.ty+$o),this.drawImage($Z.source,$v[0]*$j,$v[1]*$Y,($v[2]-$v[0])*$j,($v[5]-$v[3])*$Y,$h[1]-$r,$h[2]-$S,$h[3],$h[4]),this.restore()):this.drawImage($Z.source,$v[0]*$j,$v[1]*$Y,($v[2]-$v[0])*$j,($v[5]-$v[3])*$Y,$h[1]-$r+$J,$h[2]-$S+$o,$h[3],$h[4]),$u&&(this.globalAlpha=$B)}},$J.fillTexture=function($J,$o,$r,$S,$G,$z,$A,$h){if(!$h.pat){if($J.uv!=$BJ.DEF_UV){var $Z=new $IJ("2D");$Z.getContext("2d"),$Z.size($J.width,$J.height),$Z.context.drawTexture($J,0,0,$J.width,$J.height,0,0),$J=new $BJ($Z)}$h.pat=this.createPattern($J.bitmap.source,$z)}var $u=$o,$B=$r,$v=0,$j=0;$A&&($u+=$A.x%$J.width,$B+=$A.y%$J.height,$v-=$A.x%$J.width,$j-=$A.y%$J.height),this.translate($u,$B),this.fillRect($v,$j,$S,$G,$h.pat),this.translate(-$u,-$B)},$J.drawTriangle=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=$J.bitmap,$u=$Z.source,$B=$J.width,$v=$J.height,$j=$Z.width,$Y=$Z.height,$_=$r[$S]*$j,$D=$r[$G]*$j,$N=$r[$z]*$j,$w=$r[$S+1]*$Y,$i=$r[$G+1]*$Y,$I=$r[$z+1]*$Y,$t=$o[$S],$K=$o[$G],$e=$o[$z],$y=$o[$S+1],$g=$o[$G+1],$s=$o[$z+1];if($h){var $V=($t+$K+$e)/3,$m=($y+$g+$s)/3,$C=$t-$V,$R=$y-$m,$n=Math.sqrt($C*$C+$R*$R);$t=$V+$C/$n*($n+1),$y=$m+$R/$n*($n+1),$R=$g-$m,$K=$V+($C=$K-$V)/($n=Math.sqrt($C*$C+$R*$R))*($n+1),$g=$m+$R/$n*($n+1),$R=$s-$m,$e=$V+($C=$e-$V)/($n=Math.sqrt($C*$C+$R*$R))*($n+1),$s=$m+$R/$n*($n+1)}this.save(),$A&&this.transform($A.a,$A.b,$A.c,$A.d,$A.tx,$A.ty),this.beginPath(),this.moveTo($t,$y),this.lineTo($K,$g),this.lineTo($e,$s),this.closePath(),this.clip();var $k=1/($_*$i+$w*$N+$D*$I-$i*$N-$w*$D-$_*$I),$U=$t*$i+$w*$e+$K*$I-$i*$e-$w*$K-$t*$I,$L=$_*$K+$t*$N+$D*$e-$K*$N-$t*$D-$_*$e,$Q=$_*$i*$e+$w*$K*$N+$t*$D*$I-$t*$i*$N-$w*$D*$e-$_*$K*$I,$p=$y*$i+$w*$s+$g*$I-$i*$s-$w*$g-$y*$I,$f=$_*$g+$y*$N+$D*$s-$g*$N-$y*$D-$_*$s,$F=$_*$i*$s+$w*$g*$N+$y*$D*$I-$y*$i*$N-$w*$D*$s-$_*$g*$I;this.transform($U*$k,$p*$k,$L*$k,$f*$k,$Q*$k,$F*$k),this.drawImage($u,$J.uv[0]*$j,$J.uv[1]*$Y,$B,$v,$J.uv[0]*$j,$J.uv[1]*$Y,$B,$v),this.restore()},$J.flush=function(){return 0},$J.fillWords=function($J,$o,$r,$S,$G,$z){$S&&(this.font=$S),$G&&(this.fillStyle=$G);this.textBaseline="top",this.textAlign="left";for(var $A=0,$h=$J.length;$A<$h;$A++){var $Z=$J[$A];if(this.__fillText($Z.char,$Z.x+$o,$Z.y+$r),1===$z){var $u=$Z.height,$B=.5*$Z.style.letterSpacing;$B||($B=0),this.beginPath(),this.strokeStyle=$G,this.lineWidth=1,this.moveTo($o+$Z.x-$B+.5,$r+$Z.y+$u+.5),this.lineTo($o+$Z.x+$Z.width+$B+.5,$r+$Z.y+$u+.5),this.stroke()}}},$J.fillBorderWords=function($J,$o,$r,$S,$G,$z,$A){$S&&(this.font=$S),$G&&(this.fillStyle=$G),this.textBaseline="top",this.lineWidth=$A,this.textAlign="left",this.strokeStyle=$z;for(var $h=0,$Z=$J.length;$h<$Z;$h++){var $u=$J[$h];this.__strokeText($u.char,$u.x+$o,$u.y+$r),this.__fillText($u.char,$u.x+$o,$u.y+$r)}},$J.destroy=function(){this.canvas.width=this.canvas.height=0},$J.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$J.drawCurves=function($J,$o,$r){this.beginPath(),this.strokeStyle=$r[3],this.lineWidth=$r[4];var $S=$r[2];$J+=$r[0],$o+=$r[1],this.moveTo($J+$S[0],$o+$S[1]);for(var $G=2,$z=$S.length;$G<$z;)this.quadraticCurveTo($J+$S[$G++],$o+$S[$G++],$J+$S[$G++],$o+$S[$G++]);this.stroke()},$h.__init__=function($o){var $r=laya.resource.Context.prototype;if(!($o=$o||CanvasRenderingContext2D.prototype).inited){$o.inited=!0,$o.__fillText=$o.fillText,$o.__fillRect=$o.fillRect,$o.__strokeText=$o.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($J){$o[$J]=$r[$J]})}},$h.replaceCanvasGetSet=function($J,$o){var $r=Object.getOwnPropertyDescriptor($J,$o);if(!$r||!$r.configurable)return!1;var $S,$G={};for($S in $r)"set"!=$S&&($G[$S]=$r[$S]);var $z=$r.set;return $G.set=function($J){$z.call(this,$J);var $o=this.getContext("2d");$o&&"__reset"in $o&&$o.__reset()},Object.defineProperty($J,$o,$G),!0},$h.replaceGetSet=function($J,$o){var $r=Object.getOwnPropertyDescriptor($J,$o);if(!$r||!$r.configurable)return!1;var $S,$G={};for($S in $r)"set"!=$S&&($G[$S]=$r[$S]);var $z=$r.set,$A="___"+$o+"__";return $h.newKeys.push($A),$G.set=function($J){$J!=this[$A]&&(this[$A]=$J,$z.call(this,$J))},Object.defineProperty($J,$o,$G),!0},$h._default=new $h,$h.newKeys=[],$Z($h,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$h}(),$F=function(){function $z($J){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$z._uniqueIDCounter,this._name=$J||"Content Manager",$z._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$z._resourceManagers.push(this),this._resources=[],this._records={}}$D($z,"laya.resource.ResourceManager");var $J=$z.prototype;return $y.imps($J,{"laya.resource.IDispose":!0}),$J.getResourceByIndex=function($J){return this._resources[$J]},$J.getResourcesLength=function(){return this._resources.length},$J.addResource=function($J){return $J.resourceManager&&$J.resourceManager.removeResource($J),-1===this._resources.indexOf($J)&&(($J._resourceManager=this)._resources.push($J),this.addRecord($J.uri,$J.__className,$J.memorySize),this.addSize($J.memorySize),!0)},$J.removeResource=function($J){var $o=this._resources.indexOf($J);return-1!==$o&&(this._resources.splice($o,1),$J._resourceManager=null,this._memorySize-=$J.memorySize,this.addRecord($J.uri,$J.__className,-$J.memorySize),!0)},$J.unload=function(){for(var $J=this._resources.slice(0,this._resources.length),$o=0;$o<$J.length;$o++){$J[$o].destroy()}$J.length=0},$J.dispose=function(){if(this===$z._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$z._resourceManagers.splice($z._resourceManagers.indexOf(this),1),$z._isResourceManagersSorted=!1;for(var $J=this._resources.slice(0,this._resources.length),$o=0;$o<$J.length;$o++){var $r=$J[$o];$r.resourceManager.removeResource($r),$r.destroy()}$J.length=0},$J.addSize=function($J){$J&&(this.autoRelease&&0<$J&&this._memorySize+$J>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$J)},$J.addRecord=function($J,$o,$r){DEBUG&&$r&&!$J&&console.error($J,$o,$r)},$J.garbageCollection=function($J){var $o=this._resources;($o=$o.slice()).sort(function($J,$o){if(!$J||!$o)throw new Error("a或b不能为空！");return $J.released&&$o.released?0:$J.released?1:$o.released?-1:$J._lastUseFrameCount-$o._lastUseFrameCount});for(var $r=$x.loopCount,$S=0,$G=$o.length;$S<$G;$S++){var $z=$o[$S];if(!(1<$r-$z._lastUseFrameCount))return void(this._memorySize>=$J&&(this._isOverflow=!0));if($z.releaseResource(),this._memorySize<$J)return void(this._isOverflow=!1)}},$B(0,$J,"id",function(){return this._id}),$B(0,$J,"name",function(){return this._name},function($J){!$J&&""===$J||this._name===$J||(this._name=$J,$z._isResourceManagersSorted=!1)}),$B(0,$J,"memorySize",function(){return this._memorySize}),$B(0,$J,"records",function(){return this._records}),$B(1,$z,"systemResourceManager",function(){return $z._systemResourceManager}),$z.__init__=function(){$z.currentResourceManager=$z.systemResourceManager},$z.getLoadedResourceManagerByIndex=function($J){return $z._resourceManagers[$J]},$z.getLoadedResourceManagersCount=function(){return $z._resourceManagers.length},$z.recreateContentManagers=function($J){void 0===$J&&($J=!1);for(var $o=$z.currentResourceManager,$r=0;$r<$z._resourceManagers.length;$r++){$z.currentResourceManager=$z._resourceManagers[$r];for(var $S=0;$S<$z.currentResourceManager._resources.length;$S++)$z.currentResourceManager._resources[$S].releaseResource($J),$z.currentResourceManager._resources[$S].activeResource($J)}$z.currentResourceManager=$o},$z.releaseContentManagers=function($J){void 0===$J&&($J=!1);for(var $o=$z.currentResourceManager,$r=0;$r<$z._resourceManagers.length;$r++){$z.currentResourceManager=$z._resourceManagers[$r];for(var $S=0;$S<$z.currentResourceManager._resources.length;$S++){var $G=$z.currentResourceManager._resources[$S];!$G.released&&$G.releaseResource($J)}}$z.currentResourceManager=$o},$z._uniqueIDCounter=0,$z._isResourceManagersSorted=!1,$z._resourceManagers=[],$Z($z,["_systemResourceManager",function(){return this._systemResourceManager=new $z("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$z._systemResourceManager}]),$z}(),$d=(function(){function $J(){}$D($J,"laya.system.System"),$J.changeDefinition=function($J,$o){$y[$J]=$o;var $r=$J+"=classObj";$y._runScript($r)},$J.__init__=function(){$L.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $r(){}return $D($r,"laya.utils.Browser"),$B(1,$r,"pixelRatio",function(){return $r.__init__(),-1<$r.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$R.getPixelRatio()}),$B(1,$r,"height",function(){return $r.__init__(),($y.stage&&$y.stage.canvasRotation?$r.clientWidth:$r.clientHeight)*$r.pixelRatio}),$B(1,$r,"clientWidth",function(){return $r.__init__(),$r.window.innerWidth||$r.document.body.clientWidth}),$B(1,$r,"window",function(){return $r.__init__(),$r._window}),$B(1,$r,"clientHeight",function(){return $r.__init__(),$r.window.innerHeight||$r.document.body.clientHeight||$r.document.documentElement.clientHeight}),$B(1,$r,"width",function(){return $r.__init__(),($y.stage&&$y.stage.canvasRotation?$r.clientHeight:$r.clientWidth)*$r.pixelRatio}),$B(1,$r,"container",function(){return $r.__init__(),$r._container||(($r._container=$r.createElement("div")).id="layaContainer",$r.document.body.appendChild($r._container)),$r._container},function($J){$r._container=$J}),$B(1,$r,"document",function(){return $r.__init__(),$r._document}),$r.__init__=function(){if(!$r._window){$r._window=$R.getWindow(),$r._document=$r.window.document,$r._window.addEventListener("message",function($J){laya.utils.Browser._onMessage($J)},!1),$r.document.__createElement=$r.document.createElement,$A.requestAnimationFrame=$A.requestAnimationFrame||$A.webkitRequestAnimationFrame||$A.mozRequestAnimationFrame||$A.oRequestAnimationFrame||$A.msRequestAnimationFrame||function($J){return $A.setTimeout($J,1e3/60)};var $J=$A.document.body.style;$J["-webkit-user-select"]="none",$J["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$r.userAgent=$r.window.navigator.userAgent,$r.onIOS=!!($r.u=$r.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$r.onMobile=-1<$r.u.indexOf("Mobile"),$r.onIPhone=-1<$r.u.indexOf("iPhone"),$r.onMac=-1<$r.u.indexOf("Mac OS X"),$r.onIPad=-1<$r.u.indexOf("iPad"),$r.onAndroid=-1<$r.u.indexOf("Android")||-1<$r.u.indexOf("Adr"),$r.onWP=-1<$r.u.indexOf("Windows Phone"),$r.onQQBrowser=-1<$r.u.indexOf("QQBrowser"),$r.onMQQBrowser=-1<$r.u.indexOf("MQQBrowser")||-1<$r.u.indexOf("Mobile")&&-1<$r.u.indexOf("QQ"),$r.onIE=!!$r.window.ActiveXObject||"ActiveXObject"in $r.window,$r.onWeiXin=-1<$r.u.indexOf("MicroMessenger"),$r.onPC=!$r.onMobile,$r.onSafari=-1<$r.u.indexOf("Safari"),$r.onFirefox=-1<$r.u.indexOf("Firefox"),$r.onEdge=-1<$r.u.indexOf("Edge"),$r.onMiniGame=-1<$r.u.indexOf("MiniGame"),$r.onLimixiu=-1<$r.u.indexOf("limixiu"),$r.httpProtocol="http:"==$r.window.location.protocol,$r.onMiniGame&&null==$r.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$r.webAudioEnabled=!!($r.window.AudioContext||$r.window.webkitAudioContext||$r.window.mozAudioContext),$r.soundType=$r.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$GJ=$r.webAudioEnabled?$zJ:$rJ,$r.webAudioEnabled&&$zJ.initWebAudio(),$rJ._initMusicAudio(),$r.enableTouch="ontouchstart"in $A||$A.DocumentTouch&&$o instanceof DocumentTouch,$A.focus(),$C._soundClass=$GJ,$C._musicClass=$rJ,$L._mainCanvas=$L._mainCanvas||$IJ.create("2D"),$r.canvas||($r.canvas=$IJ.create("2D"),$r.context=$r.canvas.getContext("2d"))}},$r._onMessage=function($J){if($J.data&&"size"==$J.data.name){if($r.window.innerWidth=$J.data.width,$r.window.innerHeight=$J.data.height,$r.window.__innerHeight=$J.data.clientHeight,!$r.document.createEvent)return void console.warn("no document.createEvent");var $o=$r.document.createEvent("HTMLEvents");return $o.initEvent("resize",!1,!1),void $r.window.dispatchEvent($o)}},$r.createElement=function($J){return $r.__init__(),$r.document.__createElement($J)},$r.getElementById=function($J){return $r.__init__(),$r.document.getElementById($J)},$r.removeElement=function($J){$J&&$J.parentNode&&$J.parentNode.removeChild($J)},$r.now=function(){return $R.now()},$r._window=null,$r._document=null,$r._container=null,$r.userAgent=null,$r.u=null,$r.onIOS=!1,$r.onMac=!1,$r.onMobile=!1,$r.onIPhone=!1,$r.onIPad=!1,$r.onAndroid=!1,$r.onWP=!1,$r.onQQBrowser=!1,$r.onMQQBrowser=!1,$r.onSafari=!1,$r.onFirefox=!1,$r.onEdge=!1,$r.onIE=!1,$r.onWeiXin=!1,$r.onMiniGame=!1,$r.onLimixiu=!1,$r.onPC=!1,$r.httpProtocol=!1,$r.webAudioEnabled=!1,$r.soundType=null,$r.enableTouch=!1,$r.canvas=null,$r.context=null,$r.__init$=function(){},$r}()),$l=function(){function $o($J){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$J?(this._u8d_=new Uint8Array($J),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$D($o,"laya.utils.Byte");var $J=$o.prototype;return $J.___resizeBuffer=function($o){try{var $J=new Uint8Array($o);null!=this._u8d_&&(this._u8d_.length<=$o?$J.set(this._u8d_):$J.set(this._u8d_.subarray(0,$o))),this._u8d_=$J,this._d_=new DataView($J.buffer)}catch($J){throw"___resizeBuffer err:"+$o}},$J.getString=function(){return this.rUTF(this.getUint16())},$J.getFloat32Array=function($J,$o){var $r=$J+$o;$r=$r>this._length?this._length:$r;var $S=new Float32Array(this._d_.buffer.slice($J,$r));return this._pos_=$r,$S},$J.getUint8Array=function($J,$o){var $r=$J+$o;$r=$r>this._length?this._length:$r;var $S=new Uint8Array(this._d_.buffer.slice($J,$r));return this._pos_=$r,$S},$J.getInt16Array=function($J,$o){var $r=$J+$o;$r=$r>this._length?this._length:$r;var $S=new Int16Array(this._d_.buffer.slice($J,$r));return this._pos_=$r,$S},$J.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $J=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$J},$J.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $J=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$J},$J.writeFloat32=function($J){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$J,this._xd_),this._pos_+=4},$J.writeFloat64=function($J){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$J,this._xd_),this._pos_+=8},$J.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $J=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$J},$J.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $J=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$J},$J.writeInt32=function($J){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$J,this._xd_),this._pos_+=4},$J.writeUint32=function($J){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$J,this._xd_),this._pos_+=4},$J.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $J=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$J},$J.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $J=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$J},$J.writeUint16=function($J){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$J,this._xd_),this._pos_+=2},$J.writeInt16=function($J){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$J,this._xd_),this._pos_+=2},$J.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$J.writeUint8=function($J){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$J),this._pos_++},$J._getUInt8=function($J){return this._d_.getUint8($J)},$J._getUint16=function($J){return this._d_.getUint16($J,this._xd_)},$J._getMatrix=function(){return new $n(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$J.rUTF=function($J){for(var $o=[],$r=this._pos_+$J,$S=0,$G=0,$z=0,$A=String.fromCharCode,$h=this._u8d_;this._pos_<$r;)($S=$h[this._pos_++])<128?0!=$S&&$o.push($A($S)):$S<224?$o.push($A((63&$S)<<6|127&$h[this._pos_++])):$S<240?($G=$h[this._pos_++],$o.push($A((31&$S)<<12|(127&$G)<<6|127&$h[this._pos_++]))):($G=$h[this._pos_++],$z=$h[this._pos_++],$o.push($A((15&$S)<<18|(127&$G)<<12|$z<<6&127|127&$h[this._pos_++]))),0;return $o.join("")},$J.getCustomString=function($J){for(var $o=[],$r=0,$S=0,$G=0,$z=String.fromCharCode,$A=this._u8d_;0<$J;)if(($S=$A[this._pos_])<128)$o.push($z($S)),this._pos_++,$J--;else for($r=$S-128,this._pos_++,$J-=$r;0<$r;)$S=$A[this._pos_++],$G=$A[this._pos_++],$o.push($z($G<<8|$S)),$r--;return $o.join("")},$J.clear=function(){this._pos_=0,this.length=0},$J.__getBuffer=function(){return this._d_.buffer},$J.writeUTFBytes=function($J){for(var $o=0,$r=($J+="").length;$o<$r;$o++){var $S=$J.charCodeAt($o);$S<=127?this.writeByte($S):$S<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$S>>6,128|63&$S],this._pos_),this._pos_+=2):$S<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$S>>12,128|$S>>6&63,128|63&$S],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$S>>18,128|$S>>12&63,128|$S>>6&63,128|63&$S],this._pos_),this._pos_+=4)}},$J.writeUTFString=function($J){var $o=this.pos;this.writeUint16(1),this.writeUTFBytes($J);var $r=this.pos-$o-2;if(65536<=$r)throw"writeUTFString byte len more than 65536";this._d_.setUint16($o,$r,this._xd_)},$J.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$J.getUTFString=function(){return this.readUTFString()},$J.readUTFBytes=function($J){if(void 0===$J&&($J=-1),0==$J)return"";var $o=this.bytesAvailable;if($o<$J)throw"readUTFBytes error - Out of bounds";return $J=0<$J?$J:$o,this.rUTF($J)},$J.getUTFBytes=function($J){return void 0===$J&&($J=-1),this.readUTFBytes($J)},$J.writeByte=function($J){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$J),this._pos_+=1},$J.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$J.getByte=function(){return this.readByte()},$J.ensureWrite=function($J){this._length<$J&&(this._length=$J),this._allocated_<$J&&(this.length=$J)},$J.writeArrayBuffer=function($J,$o,$r){if(void 0===$o&&($o=0),void 0===$r&&($r=0),$o<0||$r<0)throw"writeArrayBuffer error - Out of bounds";0==$r&&($r=$J.byteLength-$o),this.ensureWrite(this._pos_+$r);var $S=new Uint8Array($J);this._u8d_.set($S.subarray($o,$o+$r),this._pos_),this._pos_+=$r},$B(0,$J,"buffer",function(){var $J=this._d_.buffer;return $J.byteLength==this.length?$J:$J.slice(0,this.length)}),$B(0,$J,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($J){this._xd_="littleEndian"==$J}),$B(0,$J,"length",function(){return this._length},function($J){this._allocated_<$J?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($J,2*this._allocated_))):this._allocated_>$J&&this.___resizeBuffer(this._allocated_=$J),this._length=$J}),$B(0,$J,"pos",function(){return this._pos_},function($J){this._pos_=$J}),$B(0,$J,"bytesAvailable",function(){return this._length-this._pos_}),$o.getSystemEndian=function(){if(!$o._sysEndian){var $J=new ArrayBuffer(2);new DataView($J).setInt16(0,256,!0),$o._sysEndian=256===new Int16Array($J)[0]?"littleEndian":"bigEndian"}return $o._sysEndian},$o.BIG_ENDIAN="bigEndian",$o.LITTLE_ENDIAN="littleEndian",$o._sysEndian=null,$o}(),$c=function(){function $G(){}return $D($G,"laya.utils.CacheManager"),$G.regCacheByFunction=function($J,$o){var $r;$G.unRegCacheByFunction($J,$o),$r={tryDispose:$J,getCacheList:$o},$G._cacheList.push($r)},$G.unRegCacheByFunction=function($J,$o){var $r,$S=0;for($r=$G._cacheList.length,$S=0;$S<$r;$S++)if($G._cacheList[$S].tryDispose==$J&&$G._cacheList[$S].getCacheList==$o)return void $G._cacheList.splice($S,1)},$G.forceDispose=function(){var $J=0,$o=$G._cacheList.length;for($J=0;$J<$o;$J++)$G._cacheList[$J].tryDispose(!0)},$G.beginCheck=function($J){void 0===$J&&($J=15e3),$y.timer.loop($J,null,$G._checkLoop)},$G.stopCheck=function(){$y.timer.clear(null,$G._checkLoop)},$G._checkLoop=function(){var $J=$G._cacheList;if(!($J.length<1)){var $o,$r=$d.now(),$S=0;for($o=$S=$J.length;0<$S&&($J[$G._index=++$G._index%$o].tryDispose(!1),!($d.now()-$r>$G.loopTimeLimit));)$S--}},$G.loopTimeLimit=2,$G._cacheList=[],$G._index=0,$G}(),$T=function(){function $Y(){}return $D($Y,"laya.utils.ClassUtils"),$Y.regClass=function($J,$o){$Y._classMap[$J]=$o},$Y.getRegClass=function($J){return $Y._classMap[$J]},$Y.getInstance=function($J){var $o=$Y.getClass($J);return $o?new $o:(console.warn("[error] Undefined class:",$J),null)},$Y.createByJson=function($J,$o,$r,$S,$G){"string"==typeof $J&&($J=JSON.parse($J));var $z=$J.props;if(!$o&&!($o=$G?$G.runWith($J):$Y.getInstance($z.runtime||$J.type)))return null;var $A=$J.child;if($A)for(var $h=0,$Z=$A.length;$h<$Z;$h++){var $u=$A[$h];if("render"!==$u.props.name&&"render"!==$u.props.renderType||!$o._$set_itemRender)if("Graphic"==$u.type)$Y.addGraphicsToSprite($u,$o);else if($Y.isDrawType($u.type))$Y.addGraphicToSprite($u,$o,!0);else{var $B=$Y.createByJson($u,null,$r,$S,$G);"Script"==$u.type?$B.hasOwnProperty("owner")?$B.owner=$o:$B.hasOwnProperty("target")&&($B.target=$o):"mask"==$u.props.renderType?$o.mask=$B:$o.addChild($B)}else $o.itemRender=$u}if($z)for(var $v in $z){var $j=$z[$v];"var"===$v&&$r?$r[$j]=$o:$j instanceof Array&&"function"==typeof $o[$v]?$o[$v].apply($o,$j):$o[$v]=$j}return $S&&$J.customProps&&$S.runWith([$o,$J]),$o.created&&$o.created(),$o},$Y.addGraphicsToSprite=function($J,$o){var $r;if(($r=$J.child)&&!($r.length<1)){var $S;$S=$Y._getGraphicsFromSprite($J,$o);var $G=0,$z=0;$J.props&&($G=$Y._getObjVar($J.props,"x",0),$z=$Y._getObjVar($J.props,"y",0)),0!=$G&&0!=$z&&$S.translate($G,$z);var $A,$h=0;for($A=$r.length,$h=0;$h<$A;$h++)$Y._addGraphicToGraphics($r[$h],$S);0!=$G&&0!=$z&&$S.translate(-$G,-$z)}},$Y.addGraphicToSprite=function($J,$o,$r){var $S;void 0===$r&&($r=!1),$S=$r?$Y._getGraphicsFromSprite($J,$o):$o.graphics,$Y._addGraphicToGraphics($J,$S)},$Y._getGraphicsFromSprite=function($J,$o){var $r,$S;if(!$J||!$J.props)return $o.graphics;switch($S=$J.props.renderType){case"hit":case"unHit":var $G;$o.hitArea||($o.hitArea=new $H),($G=$o.hitArea)[$S]||($G[$S]=new $j),$r=$G[$S]}return $r||($r=$o.graphics),$r},$Y._getTransformData=function($J){var $o;($J.hasOwnProperty("pivotX")||$J.hasOwnProperty("pivotY"))&&($o=$o||new $n).translate(-$Y._getObjVar($J,"pivotX",0),-$Y._getObjVar($J,"pivotY",0));var $r=$Y._getObjVar($J,"scaleX",1),$S=$Y._getObjVar($J,"scaleY",1),$G=$Y._getObjVar($J,"rotation",0);$Y._getObjVar($J,"skewX",0),$Y._getObjVar($J,"skewY",0);return 1==$r&&1==$S&&0==$G||(($o=$o||new $n).scale($r,$S),$o.rotate(.0174532922222222*$G)),$o},$Y._addGraphicToGraphics=function($J,$o){var $r,$S;if(($r=$J.props)&&($S=$Y.DrawTypeDic[$J.type])){var $G,$z;$G=$o;var $A=$Y._getParams($r,$S[1],$S[2],$S[3]);(($z=$Y._tM)||1!=$Y._alpha)&&($G.save(),$z&&$G.transform($z),1!=$Y._alpha&&$G.alpha($Y._alpha)),$G[$S[0]].apply($G,$A),($z||1!=$Y._alpha)&&$G.restore()}},$Y._adptLineData=function($J){return $J[2]=parseFloat($J[0])+parseFloat($J[2]),$J[3]=parseFloat($J[1])+parseFloat($J[3]),$J},$Y._adptTextureData=function($J){return $J[0]=$hJ.getRes($J[0]),$J},$Y._adptLinesData=function($J){return $J[2]=$Y._getPointListByStr($J[2]),$J},$Y.isDrawType=function($J){return"Image"!=$J&&$Y.DrawTypeDic.hasOwnProperty($J)},$Y._getParams=function($J,$o,$r,$S){var $G;void 0===$r&&($r=0),($G=$Y._temParam).length=$o.length;var $z,$A,$h=0;for($z=$o.length,$h=0;$h<$z;$h++)$G[$h]=$Y._getObjVar($J,$o[$h][0],$o[$h][1]);return $Y._alpha=$Y._getObjVar($J,"alpha",1),$A=$Y._getTransformData($J),$Y._tM=$A?($r||($r=0),$A.translate($G[$r],$G[$r+1]),$G[$r]=$G[$r+1]=0,$A):null,$S&&$Y[$S]&&($G=$Y[$S]($G)),$G},$Y._getPointListByStr=function($J){var $o,$r,$S=0;for($r=($o=$J.split(",")).length,$S=0;$S<$r;$S++)$o[$S]=parseFloat($o[$S]);return $o},$Y._getObjVar=function($J,$o,$r){return $J.hasOwnProperty($o)?$J[$o]:$r},$Y._temParam=[],$Y._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$Y.getClass=function($J){var $o=$Y._classMap[$J]||$J;return"string"==typeof $o?$y.__classmap[$o]:$o},$Y._tM=null,$Y._alpha=NaN,$Z($Y,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$Y}(),$b=function(){function $z($J){if(this._color=[],"string"==typeof $J){null===(this.strColor=$J)&&($J="#000000"),"#"==$J.charAt(0)&&($J=$J.substr(1));var $o=$J.length;if(3==$o||4==$o){for(var $r="",$S=0;$S<$o;$S++)$r+=$J[$S]+$J[$S];$J=$r}var $G=this.numColor=parseInt($J,16);if(8==$J.length)return void(this._color=[parseInt($J.substr(0,2),16)/255,((16711680&$G)>>16)/255,((65280&$G)>>8)/255,(255&$G)/255])}else $G=this.numColor=$J,this.strColor=$P.toHexColor($G);this._color=[((16711680&$G)>>16)/255,((65280&$G)>>8)/255,(255&$G)/255,1],this._color.__id=++$z._COLODID}return $D($z,"laya.utils.Color"),$z._initDefault=function(){for(var $J in $z._DEFAULT={},$z._COLOR_MAP)$z._SAVE[$J]=$z._DEFAULT[$J]=new $z($z._COLOR_MAP[$J]);return $z._DEFAULT},$z._initSaveMap=function(){for(var $J in $z._SAVE_SIZE=0,$z._SAVE={},$z._DEFAULT)$z._SAVE[$J]=$z._DEFAULT[$J]},$z.create=function($J){var $o=$z._SAVE[$J+""];return null!=$o?$o:($z._SAVE_SIZE<1e3||$z._initSaveMap(),$z._SAVE[$J+""]=new $z($J))},$z._SAVE={},$z._SAVE_SIZE=0,$z._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$z._DEFAULT=$z._initDefault(),$z._COLODID=1,$z}(),$$=(function(){function $J(){this._values=[],this._keys=[]}$D($J,"laya.utils.Dictionary");var $o=$J.prototype;$o.set=function($J,$o){var $r=this.indexOf($J);0<=$r?this._values[$r]=$o:(this._keys.push($J),this._values.push($o))},$o.indexOf=function($J){var $o=this._keys.indexOf($J);return 0<=$o?$o:($J="string"==typeof $J?Number($J):"number"==typeof $J?$J.toString():$J,this._keys.indexOf($J))},$o.get=function($J){var $o=this.indexOf($J);return $o<0?null:this._values[$o]},$o.remove=function($J){var $o=this.indexOf($J);return 0<=$o&&(this._keys.splice($o,1),this._values.splice($o,1),!0)},$o.clear=function(){this._values.length=0,this._keys.length=0},$B(0,$o,"values",function(){return this._values}),$B(0,$o,"keys",function(){return this._keys})}(),function(){function $J(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$D($J,"laya.utils.Dragging");var $o=$J.prototype;return $o.start=function($J,$o,$r,$S,$G,$z,$A,$h){void 0===$h&&($h=.92),this.clearTimer(),this.target=$J,this.area=$o,this.hasInertia=$r,this.elasticDistance=$o?$S:0,this.elasticBackTime=$G,this.data=$z,this._disableMouseEvent=$A,this.ratio=$h,1!=$J.globalScaleX||1!=$J.globalScaleY?this._parent=$J.parent:this._parent=$y.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$y.stage.on("mouseup",this,this.onStageMouseUp),$y.stage.on("mouseout",this,this.onStageMouseUp),$y.timer.frameLoop(1,this,this.loop)},$o.clearTimer=function(){$y.timer.clear(this,this.loop),$y.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$o.stop=function(){this._dragging&&($_.instance.disableMouseEvent=!1,$y.stage.off("mouseup",this,this.onStageMouseUp),$y.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$o.loop=function(){var $J=this._parent.getMousePoint(),$o=$J.x,$r=$J.y,$S=$o-this._lastX,$G=$r-this._lastY;if(this._clickOnly){if(!(1<Math.abs($S*$y.stage._canvasTransform.getScaleX())||1<Math.abs($G*$y.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$_.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($S,$G);0==$S&&0==$G||(this._lastX=$o,this._lastY=$r,this.target.x+=$S*this._elasticRateX,this.target.y+=$G*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$o.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $J=this.area.x-this.target.x;else $J=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$J/this.elasticDistance),this.target.y<this.area.y)var $o=this.area.y-this.target.y;else $o=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$o/this.elasticDistance)}},$o.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$o.onStageMouseUp=function($J){if($_.instance.disableMouseEvent=!1,$y.stage.off("mouseup",this,this.onStageMouseUp),$y.stage.off("mouseout",this,this.onStageMouseUp),$y.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $o=this._offsets.length,$r=Math.min($o,6),$S=this._offsets.length-$r,$G=$o-1;$S<$G;$G--)this._offsetY+=this._offsets[$G--],this._offsetX+=this._offsets[$G];this._offsetX=this._offsetX/$r*2,this._offsetY=this._offsetY/$r*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$y.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$o.checkElastic=function(){var $J=NaN,$o=NaN;if(this.target.x<this.area.x?$J=this.area.x:this.target.x>this.area.x+this.area.width&&($J=this.area.x+this.area.width),this.target.y<this.area.y?$o=this.area.y:this.target.y>this.area.y+this.area.height&&($o=this.area.y+this.area.height),isNaN($J)&&isNaN($o))this.clear();else{var $r={};isNaN($J)||($r.x=$J),isNaN($o)||($r.y=$o),this._tween=$O.to(this.target,$r,this.elasticBackTime,$q.sineOut,$i.create(this,this.clear),0,!1,!1)}},$o.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($y.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$o.clear=function(){if(this.target){this.clearTimer();var $J=this.target;this.target=null,this._parent=null,$J.event("dragend",this.data)}},$J}()),$q=function(){function $h(){}return $D($h,"laya.utils.Ease"),$h.linearNone=function($J,$o,$r,$S){return $r*$J/$S+$o},$h.linearIn=function($J,$o,$r,$S){return $r*$J/$S+$o},$h.linearInOut=function($J,$o,$r,$S){return $r*$J/$S+$o},$h.linearOut=function($J,$o,$r,$S){return $r*$J/$S+$o},$h.bounceIn=function($J,$o,$r,$S){return $r-$h.bounceOut($S-$J,0,$r,$S)+$o},$h.bounceInOut=function($J,$o,$r,$S){return $J<.5*$S?.5*$h.bounceIn(2*$J,0,$r,$S)+$o:.5*$h.bounceOut(2*$J-$S,0,$r,$S)+.5*$r+$o},$h.bounceOut=function($J,$o,$r,$S){return($J/=$S)<1/2.75?$r*(7.5625*$J*$J)+$o:$J<2/2.75?$r*(7.5625*($J-=1.5/2.75)*$J+.75)+$o:$J<2.5/2.75?$r*(7.5625*($J-=2.25/2.75)*$J+.9375)+$o:$r*(7.5625*($J-=2.625/2.75)*$J+.984375)+$o},$h.backIn=function($J,$o,$r,$S,$G){return void 0===$G&&($G=1.70158),$r*($J/=$S)*$J*(($G+1)*$J-$G)+$o},$h.backInOut=function($J,$o,$r,$S,$G){return void 0===$G&&($G=1.70158),($J/=.5*$S)<1?.5*$r*($J*$J*((1+($G*=1.525))*$J-$G))+$o:$r/2*(($J-=2)*$J*((1+($G*=1.525))*$J+$G)+2)+$o},$h.backOut=function($J,$o,$r,$S,$G){return void 0===$G&&($G=1.70158),$r*(($J=$J/$S-1)*$J*(($G+1)*$J+$G)+1)+$o},$h.elasticIn=function($J,$o,$r,$S,$G,$z){var $A;return void 0===$G&&($G=0),void 0===$z&&($z=0),0==$J?$o:1==($J/=$S)?$o+$r:($z||($z=.3*$S),$A=!$G||0<$r&&$G<$r||$r<0&&$G<-$r?($G=$r,$z/4):$z/$h.PI2*Math.asin($r/$G),-$G*Math.pow(2,10*($J-=1))*Math.sin(($J*$S-$A)*$h.PI2/$z)+$o)},$h.elasticInOut=function($J,$o,$r,$S,$G,$z){var $A;return void 0===$G&&($G=0),void 0===$z&&($z=0),0==$J?$o:2==($J/=.5*$S)?$o+$r:($z||($z=$S*(.3*1.5)),$A=!$G||0<$r&&$G<$r||$r<0&&$G<-$r?($G=$r,$z/4):$z/$h.PI2*Math.asin($r/$G),$J<1?$G*Math.pow(2,10*($J-=1))*Math.sin(($J*$S-$A)*$h.PI2/$z)*-.5+$o:$G*Math.pow(2,-10*($J-=1))*Math.sin(($J*$S-$A)*$h.PI2/$z)*.5+$r+$o)},$h.elasticOut=function($J,$o,$r,$S,$G,$z){var $A;return void 0===$G&&($G=0),void 0===$z&&($z=0),0==$J?$o:1==($J/=$S)?$o+$r:($z||($z=.3*$S),$A=!$G||0<$r&&$G<$r||$r<0&&$G<-$r?($G=$r,$z/4):$z/$h.PI2*Math.asin($r/$G),$G*Math.pow(2,-10*$J)*Math.sin(($J*$S-$A)*$h.PI2/$z)+$r+$o)},$h.strongIn=function($J,$o,$r,$S){return $r*($J/=$S)*$J*$J*$J*$J+$o},$h.strongInOut=function($J,$o,$r,$S){return($J/=.5*$S)<1?.5*$r*$J*$J*$J*$J*$J+$o:.5*$r*(($J-=2)*$J*$J*$J*$J+2)+$o},$h.strongOut=function($J,$o,$r,$S){return $r*(($J=$J/$S-1)*$J*$J*$J*$J+1)+$o},$h.sineInOut=function($J,$o,$r,$S){return.5*-$r*(Math.cos(Math.PI*$J/$S)-1)+$o},$h.sineIn=function($J,$o,$r,$S){return-$r*Math.cos($J/$S*$h.HALF_PI)+$r+$o},$h.sineOut=function($J,$o,$r,$S){return $r*Math.sin($J/$S*$h.HALF_PI)+$o},$h.quintIn=function($J,$o,$r,$S){return $r*($J/=$S)*$J*$J*$J*$J+$o},$h.quintInOut=function($J,$o,$r,$S){return($J/=.5*$S)<1?.5*$r*$J*$J*$J*$J*$J+$o:.5*$r*(($J-=2)*$J*$J*$J*$J+2)+$o},$h.quintOut=function($J,$o,$r,$S){return $r*(($J=$J/$S-1)*$J*$J*$J*$J+1)+$o},$h.quartIn=function($J,$o,$r,$S){return $r*($J/=$S)*$J*$J*$J+$o},$h.quartInOut=function($J,$o,$r,$S){return($J/=.5*$S)<1?.5*$r*$J*$J*$J*$J+$o:.5*-$r*(($J-=2)*$J*$J*$J-2)+$o},$h.quartOut=function($J,$o,$r,$S){return-$r*(($J=$J/$S-1)*$J*$J*$J-1)+$o},$h.cubicIn=function($J,$o,$r,$S){return $r*($J/=$S)*$J*$J+$o},$h.cubicInOut=function($J,$o,$r,$S){return($J/=.5*$S)<1?.5*$r*$J*$J*$J+$o:.5*$r*(($J-=2)*$J*$J+2)+$o},$h.cubicOut=function($J,$o,$r,$S){return $r*(($J=$J/$S-1)*$J*$J+1)+$o},$h.quadIn=function($J,$o,$r,$S){return $r*($J/=$S)*$J+$o},$h.quadInOut=function($J,$o,$r,$S){return($J/=.5*$S)<1?.5*$r*$J*$J+$o:.5*-$r*(--$J*($J-2)-1)+$o},$h.quadOut=function($J,$o,$r,$S){return-$r*($J/=$S)*($J-2)+$o},$h.expoIn=function($J,$o,$r,$S){return 0==$J?$o:$r*Math.pow(2,10*($J/$S-1))+$o-.001*$r},$h.expoInOut=function($J,$o,$r,$S){return 0==$J?$o:$J==$S?$o+$r:($J/=.5*$S)<1?.5*$r*Math.pow(2,10*($J-1))+$o:.5*$r*(2-Math.pow(2,-10*--$J))+$o},$h.expoOut=function($J,$o,$r,$S){return $J==$S?$o+$r:$r*(1-Math.pow(2,-10*$J/$S))+$o},$h.circIn=function($J,$o,$r,$S){return-$r*(Math.sqrt(1-($J/=$S)*$J)-1)+$o},$h.circInOut=function($J,$o,$r,$S){return($J/=.5*$S)<1?.5*-$r*(Math.sqrt(1-$J*$J)-1)+$o:.5*$r*(Math.sqrt(1-($J-=2)*$J)+1)+$o},$h.circOut=function($J,$o,$r,$S){return $r*Math.sqrt(1-($J=$J/$S-1)*$J)+$o},$h.HALF_PI=.5*Math.PI,$h.PI2=2*Math.PI,$h}(),$H=function(){function $v(){this._hit=null,this._unHit=null}$D($v,"laya.utils.HitArea");var $J=$v.prototype;return $J.isHit=function($J,$o){return!!$v.isHitGraphic($J,$o,this.hit)&&!$v.isHitGraphic($J,$o,this.unHit)},$J.contains=function($J,$o){return this.isHit($J,$o)},$B(0,$J,"hit",function(){return this._hit||(this._hit=new $j),this._hit},function($J){this._hit=$J}),$B(0,$J,"unHit",function(){return this._unHit||(this._unHit=new $j),this._unHit},function($J){this._unHit=$J}),$v.isHitGraphic=function($J,$o,$r){if(!$r)return!1;var $S;if(!($S=$r.cmds)&&$r._one&&(($S=$v._cmds).length=1,$S[0]=$r._one),!$S)return!1;var $G,$z,$A=0;for($G=$S.length,$A=0;$A<$G;$A++)if($z=$S[$A]){var $h=$L._context;switch($z.callee){case $h._translate:case 6:$J-=$z[0],$o-=$z[1]}if($v.isHitCmd($J,$o,$z))return!0}return!1},$v.isHitCmd=function($J,$o,$r){if(!$r)return!1;var $S=$L._context,$G=!1;switch($r.callee){case $S._drawRect:case 13:$v._rec.setTo($r[0],$r[1],$r[2],$r[3]),$G=$v._rec.contains($J,$o);break;case $S._drawCircle:case $S._fillCircle:case 14:$G=($J-=$r[0])*$J+($o-=$r[1])*$o<$r[2]*$r[2];break;case $S._drawPoly:case 18:$J-=$r[0],$o-=$r[1],$G=$v.ptInPolygon($J,$o,$r[2])}return $G},$v.ptInPolygon=function($J,$o,$r){var $S;($S=$v._ptPoint).setTo($J,$o);var $G,$z=0,$A=NaN,$h=NaN,$Z=NaN,$u=NaN;$G=$r.length;for(var $B=0;$B<$G;$B+=2){if($A=$r[$B],$h=$r[$B+1],$Z=$r[($B+2)%$G],$h!=($u=$r[($B+3)%$G]))if(!($S.y<Math.min($h,$u)))if(!($S.y>=Math.max($h,$u)))($S.y-$h)*($Z-$A)/($u-$h)+$A>$S.x&&$z++}return $z%2==1},$v._cmds=[],$Z($v,["_rec",function(){return this._rec=new $s},"_ptPoint",function(){return this._ptPoint=new $g}]),$v}(),$a=(function(){function $G($J,$o,$r,$S){this.char=$J,this.charNum=$J.charCodeAt(0),this._x=this._y=0,this.width=$o,this.height=$r,this.style=$S,this.isWord=!$G._isWordRegExp.test($J)}$D($G,"laya.utils.HTMLChar");var $J=$G.prototype;$y.imps($J,{"laya.display.ILayout":!0}),$J.setSprite=function($J){this._sprite=$J},$J.getSprite=function(){return this._sprite},$J._isChar=function(){return!0},$J._getCSSStyle=function(){return this.style},$B(0,$J,"width",function(){return this._w},function($J){this._w=$J}),$B(0,$J,"x",function(){return this._x},function($J){this._sprite&&(this._sprite.x=$J),this._x=$J}),$B(0,$J,"y",function(){return this._y},function($J){this._sprite&&(this._sprite.y=$J),this._y=$J}),$B(0,$J,"height",function(){return this._h},function($J){this._h=$J}),$G._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $o(){}$D($o,"laya.utils.Log"),$o.enable=function(){$o._logdiv||($o._logdiv=$d.window.document.createElement("div"),$d.window.document.body.appendChild($o._logdiv),$o._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$o.toggle=function(){var $J=$o._logdiv.style;"1px"==$J.width?$J.width=$J.height="50%":$J.width=$J.height="1px"},$o.print=function($J){$o._logdiv&&($o.maxCount<=$o._count&&$o.clear(),$o._count++,$o._logdiv.innerText+=$J+"\n",$o._logdiv.scrollTop=$o._logdiv.scrollHeight)},$o.clear=function(){$o._logdiv.innerText="",$o._count=0},$o._logdiv=null,$o._count=0,$o.maxCount=20}(),function(){function $o(){}$D($o,"laya.utils.Mouse"),$B(1,$o,"cursor",function(){return $o._style.cursor},function($J){$o._style.cursor=$J}),$o.hide=function(){"none"!=$o.cursor&&($o._preCursor=$o.cursor,$o.cursor="none")},$o.show=function(){"none"==$o.cursor&&($o.cursor=$o._preCursor?$o._preCursor:"auto")},$o._preCursor=null,$Z($o,["_style",function(){return this._style=$d.document.body.style}])}(),function(){function $z(){}return $D($z,"laya.utils.Pool"),$z.getPoolBySign=function($J){return $z._poolDic[$J]||($z._poolDic[$J]=[])},$z.clearBySign=function($J){$z._poolDic[$J]&&($z._poolDic[$J].length=0)},$z.recover=function($J,$o){$o.__InPool||($o.__InPool=!0,$z.getPoolBySign($J).push($o))},$z.getItemByClass=function($J,$o){var $r=$z.getPoolBySign($J),$S=$r.length?$r.pop():new $o;return $S.__InPool=!1,$S},$z.getItemByCreateFun=function($J,$o,$r){var $S=$z.getPoolBySign($J),$G=$S.length?$S.pop():$o.call($r);return $G.__InPool=!1,$G},$z.getItem=function($J){var $o=$z.getPoolBySign($J),$r=$o.length?$o.pop():null;return $r&&($r.__InPool=!1),$r},$z._poolDic={},$z.InPoolSign="__InPool",$z}()),$x=function(){function $Z(){}return $D($Z,"laya.utils.Stat"),$B(1,$Z,"onclick",null,function($J){$Z._sp&&$Z._sp.on("click",$Z._sp,$J),$Z._canvas&&($Z._canvas.source.onclick=$J,$Z._canvas.source.style.pointerEvents="")}),$Z.show=function($J,$o,$r){if(void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),!$L.isConchApp||$L.isConchWebGL){if($L.isConchWebGL||$d.onMiniGame||$d.onLimixiu||($Z._useCanvas=!0),$Z._show=!0,$Z._fpsData.length=60,$Z._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$Z._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$Z._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$Z._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$L.isWebGL)if($Z._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$L.is3DMode){if($Z._view[0].title="FPS(3D)",$Z._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$Z._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$Z._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$r){var $S=8;$Z._view[$S++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$Z._view[$S++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$Z._view[$S++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$r){$S=8;$Z._view[$S++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$Z._view[$S++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$Z._view[$S++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$Z._view[$S++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$Z._view[$S++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$Z._view[$S++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$Z._view[$S++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $Z._view[0].title="FPS(WebGL)",$Z._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $Z._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$Z._useCanvas?$Z.createUIPre($J,$o):$Z.createUI($J,$o),$Z.enable()}else $d.window.conch.showFPS&&$d.window.conch.showFPS($J,$o)},$Z.createUIPre=function($J,$o){var $r=$d.pixelRatio;$Z._width=170*$r,$Z._vx=75*$r,$Z._height=$r*(12*$Z._view.length+3*$r)+4,$Z._fontSize=12*$r;for(var $S=0;$S<$Z._view.length;$S++)$Z._view[$S].x=4,$Z._view[$S].y=$S*$Z._fontSize+2*$r;$Z._canvas||(($Z._canvas=new $IJ("2D")).size($Z._width,$Z._height),($Z._ctx=$Z._canvas.getContext("2d")).textBaseline="top",$Z._ctx.font=$Z._fontSize+"px Sans-serif",$Z._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$J+"px;top:"+$o+"px;width:"+$Z._width/$r+"px;height:"+$Z._height/$r+"px;"),$Z._first=!0,$Z.loop(),$Z._first=!1,$d.container.appendChild($Z._canvas.source)},$Z.createUI=function($J,$o){var $r=$Z._sp,$S=$d.pixelRatio;$r||($r=new $vJ,($Z._leftText=new $NJ).pos(5,5),$Z._leftText.color="#ffffff",$r.addChild($Z._leftText),($Z._txt=new $NJ).pos(80*$S,5),$Z._txt.color="#ffffff",$r.addChild($Z._txt),$Z._sp=$r),$r.pos($J,$o);for(var $G="",$z=0;$z<$Z._view.length;$z++){$G+=$Z._view[$z].title+"\n"}$Z._leftText.text=$G;var $A=170*$S,$h=$S*(12*$Z._view.length+3*$S)+4;$Z._txt.fontSize=$Z._fontSize*$S,$Z._leftText.fontSize=$Z._fontSize*$S,$r.size($A,$h),$r.graphics.clear(),$r.graphics.setAlpha(.5),$r.graphics.drawRect(0,0,$A,$h,"#999999"),$r.graphics.setAlpha(1),$Z.loop()},$Z.enable=function(){$y.timer.frameLoop(1,$Z,$Z.loop)},$Z.hide=function(){$Z._show=!1,$y.timer.clear($Z,$Z.loop),$Z._canvas&&$d.removeElement($Z._canvas.source)},$Z.clear=function(){$Z.trianglesFaces=$Z.drawCall=$Z.shaderCall=$Z.spriteCount=$Z.spriteRenderUseCacheCount=$Z.treeNodeCollision=$Z.treeSpriteCollision=$Z.canvasNormal=$Z.canvasBitmap=$Z.canvasReCache=0},$Z.loop=function(){$Z._count++;var $J=$d.now();if(!($J-$Z._timer<1e3)){var $o=$Z._count;if($Z.FPS=Math.round(1e3*$o/($J-$Z._timer)),$Z._show){$Z.trianglesFaces=Math.round($Z.trianglesFaces/$o),$Z.spriteCount=$Z._useCanvas?($Z.drawCall=Math.round($Z.drawCall/$o)-2,$Z.shaderCall=Math.round($Z.shaderCall/$o),Math.round($Z.spriteCount/$o)-1):($Z.drawCall=Math.round($Z.drawCall/$o)-2,$Z.shaderCall=Math.round($Z.shaderCall/$o)-4,Math.round($Z.spriteCount/$o)-4),$Z.spriteRenderUseCacheCount=Math.round($Z.spriteRenderUseCacheCount/$o),$Z.canvasNormal=Math.round($Z.canvasNormal/$o),$Z.canvasBitmap=Math.round($Z.canvasBitmap/$o),$Z.canvasReCache=Math.ceil($Z.canvasReCache/$o),$Z.treeNodeCollision=Math.round($Z.treeNodeCollision/$o),$Z.treeSpriteCollision=Math.round($Z.treeSpriteCollision/$o);var $r=0<$Z.FPS?Math.floor(1e3/$Z.FPS).toString():" ";$Z._fpsStr=$Z.FPS+($Z.renderSlow?" slow":"")+" "+$r,$Z._spriteStr=$Z.spriteCount+($Z.spriteRenderUseCacheCount?"/"+$Z.spriteRenderUseCacheCount:""),$Z._canvasStr=$Z.canvasReCache+"/"+$Z.canvasNormal+"/"+$Z.canvasBitmap,$Z.currentMemorySize=$F.systemResourceManager.memorySize,$Z._useCanvas?$Z.renderInfoPre():$Z.renderInfo(),$Z.clear()}$Z._count=0,$Z._timer=$J}},$Z.renderInfoPre=function(){if($Z._canvas){var $J=$Z._ctx;$J.clearRect($Z._first?0:$Z._vx,0,$Z._width,$Z._height);for(var $o=$L.WebGL.mainContext,$r=0;$r<$Z._view.length;$r++){var $S=$Z._view[$r];$Z._first&&($J.fillStyle="white",$J.fillText($S.title,$S.x,$S.y,null,null,null)),$J.fillStyle=$S.color;var $G=-1;if(($S=$Z._view[$r]).varying){if($o)switch($S.varying){case 1:$G=$o.getParameter($o[$S.value]);break;case 2:$G=$o.getExtension($S.value)}}else $G=$Z[$S.value];"M"==$S.units&&($G=Math.floor($G/1048576*100)/100+" M"),"K"==$S.units&&($G=Math.floor($G/1024*100)/100+" K"),"string"==$S.units&&($G=$G.match(/\d+\.?\d/i)),$J.fillText($G+"",$S.x+$Z._vx,$S.y,null,null,null)}}},$Z.renderInfo=function(){for(var $J="",$o=$L.WebGL.mainContext,$r=0;$r<$Z._view.length;$r++){var $S=$Z._view[$r],$G=-1;if($S.varying){if($o)switch($S.varying){case 1:$G=$o.getParameter($o[$S.value]);break;case 2:$G=$o.getExtension($S.value)}}else $G=$Z[$S.value];"M"==$S.units&&($G=Math.floor($G/1048576*100)/100+" M"),"K"==$S.units&&($G=Math.floor($G/1024*100)/100+" K"),"string"==$S.units&&($G=$G.match(/\d+\.?\d/i)),$J+=$G+"\n"}$Z._txt.text=$J},$Z.FPS=0,$Z.loopCount=0,$Z.shaderCall=0,$Z.drawCall=0,$Z.trianglesFaces=0,$Z.spriteCount=0,$Z.spriteRenderUseCacheCount=0,$Z.treeNodeCollision=0,$Z.treeSpriteCollision=0,$Z.canvasNormal=0,$Z.canvasBitmap=0,$Z.canvasReCache=0,$Z.renderSlow=!1,$Z.currentMemorySize=0,$Z._fpsStr=null,$Z._canvasStr=null,$Z._spriteStr=null,$Z._fpsData=[],$Z._timer=0,$Z._count=0,$Z._view=[],$Z._fontSize=12,$Z._txt=null,$Z._leftText=null,$Z._sp=null,$Z._show=!1,$Z._useCanvas=!1,$Z._canvas=null,$Z._ctx=null,$Z._first=!1,$Z._vx=NaN,$Z._width=0,$Z._height=100,$Z}(),$M=(function(){function $J(){this._strsToID={},this._idToStrs=[],this._length=0}$D($J,"laya.utils.StringKey");var $o=$J.prototype;$o.add=function($J){var $o=this._strsToID[$J];return null!=$o?$o:(this._idToStrs[this._length]=$J,this._strsToID[$J]=this._length++)},$o.getID=function($J){var $o=this._strsToID[$J];return null==$o?-1:$o},$o.getName=function($J){var $o=this._idToStrs[$J];return null==$o?void 0:$o}}(),function(){var $u;function $J(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$D($J,"laya.utils.Timer");var $o=$J.prototype;return $o._init=function(){$y.timer&&$y.timer.frameLoop(1,this,this._update)},$o._now=function(){return Date.now()},$o._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $J=this.currFrame=this.currFrame+this.scale,$o=this._now();this._delta=($o-this._lastTimer)*this.scale;var $r=this.currTimer=this.currTimer+this._delta;$y.isDebug&&6e4<Math.abs($o-this._lastTimer)&&console.error("系统时间错误！"+($o-this._lastTimer)),this._lastTimer=$o;var $S=this._handlers;for($A=this._count=0,$h=$S.length;$A<$h;$A++)if(null!==($Z=$S[$A]).method){var $G=$Z.userFrame?$J:$r;if($G>=$Z.exeTime)if($Z.repeat)if($Z.jumpFrame)for(;$G>=$Z.exeTime;)$Z.exeTime+=$Z.delay,$Z.run(!1);else $Z.exeTime+=$Z.delay,$Z.run(!1),$G>$Z.exeTime&&($Z.exeTime+=Math.ceil(($G-$Z.exeTime)/$Z.delay)*$Z.delay);else $Z.run(!0)}else this._count++;(30<this._count||$J%200==0)&&this._clearHandlers();for(var $z=this._laters,$A=0,$h=$z.length-1;$A<=$h;$A++){var $Z=$z[$A];this._isIgnoreRecover($Z)||(null!==$Z.method&&(delete this._map[$Z.key],$Z.run(!1)),this._recoverHandler($Z)),$A===$h&&($h=$z.length-1)}$z.length=0}},$o._clearHandlers=function(){for(var $J=this._handlers,$o=0,$r=$J.length;$o<$r;$o++){var $S=$J[$o];null!==$S.method?this._temp.push($S):this._isIgnoreRecover($S)?this._temp.push($S):this._recoverHandler($S)}this._handlers=this._temp,this._temp=$J,this._temp.length=0},$o._recoverHandler=function($J){this._map[$J.key]==$J&&delete this._map[$J.key],$J.recover()},$o._create=function($J,$o,$r,$S,$G,$z,$A,$h){if(!$r)return $G.apply($S,$z),null;if($A){var $Z=this._getHandler($S,$G);if($Z)return $Z.repeat=$o,$Z.userFrame=$J,$Z.delay=$r,$Z.ignoreRecover=$h,$Z.caller=$S,$Z.method=$G,$Z.args=$z,$Z.exeTime=$r+($J?this.currFrame:this.currTimer+this._now()-this._lastTimer),$Z}return($Z=$u.create()).repeat=$o,$Z.userFrame=$J,$Z.delay=$r,$Z.ignoreRecover=$h,$Z.caller=$S,$Z.method=$G,$Z.args=$z,$Z.exeTime=$r+($J?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($Z),this._handlers.push($Z),$Z},$o._indexHandler=function($J){var $o=$J.caller,$r=$J.method,$S=$o?$o.$_GID||($o.$_GID=$P.getGID()):0,$G=$r.$_TID||($r.$_TID=this._mid++);$J.key=$S+"_"+$G,this._map[$J.key]=$J},$o.once=function($J,$o,$r,$S,$G){void 0===$G&&($G=!0),this._create(!1,!1,$J,$o,$r,$S,$G,!1)},$o.loop=function($J,$o,$r,$S,$G,$z,$A){void 0===$G&&($G=!0),void 0===$z&&($z=!1),void 0===$A&&($A=!1);var $h=this._create(!1,!0,$J,$o,$r,$S,$G,$A);$h&&($h.jumpFrame=$z)},$o.frameOnce=function($J,$o,$r,$S,$G){void 0===$G&&($G=!0),this._create(!0,!1,$J,$o,$r,$S,$G,!1)},$o.frameLoop=function($J,$o,$r,$S,$G,$z){void 0===$G&&($G=!0),void 0===$z&&($z=!1),this._create(!0,!0,$J,$o,$r,$S,$G,$z)},$o.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$u._freeCount},$o.clear=function($J,$o){var $r=this._getHandler($J,$o);return!(!$r||this._isIgnoreRecover($r))&&(delete this._map[$r.key],$r.key=null,$r.clear(),!0)},$o.clearAll=function($J){if($J)for(var $o=0,$r=this._handlers.length;$o<$r;$o++){var $S=this._handlers[$o];$S.caller===$J&&(this._isIgnoreRecover($S)||(delete this._map[$S.key],$S.key=null,$S.clear()))}},$o._getHandler=function($J,$o){var $r=$J?$J.$_GID||($J.$_GID=$P.getGID()):0,$S=$o.$_TID||($o.$_TID=this._mid++);return this._map[$r+"_"+$S]},$o._isIgnoreRecover=function($J){if($J.ignoreRecover||$J.caller&&"IgnoreRecover"==$J.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $o="";try{arguments.propertyIsEnumerable.caller}catch($J){$o=$J.stack}$y.recordError("报错：核心定时器销毁忽略  "+$o)}return!0}return!1},$o.hasHandler=function($J,$o){return this._map[$J.$_GID+"_"+$o.$_TID]},$o.callLater=function($J,$o,$r){if(null==this._getHandler($J,$o)){var $S=$u.create();$S.caller=$J,$S.method=$o,$S.args=$r,this._indexHandler($S),this._laters.push($S)}},$o.runCallLater=function($J,$o){var $r=this._getHandler($J,$o);$r&&null!=$r.method&&(this._isIgnoreRecover($r)||(delete this._map[$r.key],$r.run(!0)))},$o.runTimer=function($J,$o){this.runCallLater($J,$o)},$B(0,$o,"delta",function(){return this._delta}),$J.__init$=function(){$u=function(){function $o(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$D($o,"");var $J=$o.prototype;return $J.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$J.recover=function(){this.clear(),this.args=$o._freeHandler,$o._freeHandler=this,$o._freeCount++},$J.run=function($J){var $o=this.caller;if($o&&$o.destroyed)return this.clear();var $r=this.method,$S=this.args;$J&&this.clear(),null!=$r&&($S?$r.apply($o,$S):$r.call($o))},$o._freeHandler=null,$o._freeCount=0,$o.create=function(){var $J=$o._freeHandler;return $J?($o._freeHandler=$J.args,--$o._freeCount,$J.args=null,$J):new $o},$o}()},$J}()),$O=function(){function $v(){this.gid=0}$D($v,"laya.utils.Tween");var $J=$v.prototype;return $J.to=function($J,$o,$r,$S,$G,$z,$A){return void 0===$z&&($z=0),void 0===$A&&($A=!1),this._create($J,$o,$r,$S,$G,$z,$A,!0,!1,!0)},$J.from=function($J,$o,$r,$S,$G,$z,$A){return void 0===$z&&($z=0),void 0===$A&&($A=!1),this._create($J,$o,$r,$S,$G,$z,$A,!1,!1,!0)},$J._create=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){if(!$J)throw new Error("Tween:target is null");this._target=$J,this._duration=$r,this._ease=$S||$o.ease||$v.easeNone,this._complete=$G||$o.complete,this._delay=$z,this._props=[],this._usedTimer=0,this._startTimer=$d.now(),this._usedPool=$Z,this._delayParam=null,this.update=$o.update;var $B=$J.$_GID||($J.$_GID=$P.getGID());return $v.tweenMap[$B]?($A&&$v.clearTween($J),$v.tweenMap[$B].push(this)):$v.tweenMap[$B]=[this],$u?$z<=0?this.firstStart($J,$o,$h):(this._delayParam=[$J,$o,$h],$y.scaleTimer.once($z,this,this.firstStart,this._delayParam)):this._initProps($J,$o,$h),this},$J.firstStart=function($J,$o,$r){this._delayParam=null,$J.destroyed?this.clear():(this._initProps($J,$o,$r),this._beginLoop())},$J._initProps=function($J,$o,$r){for(var $S in $o)if("number"==typeof $J[$S]){var $G=$r?$J[$S]:$o[$S],$z=$r?$o[$S]:$J[$S];this._props.push([$S,$G,$z-$G]),$r||($J[$S]=$G)}},$J._beginLoop=function(){$y.scaleTimer.frameLoop(1,this,this._doEase)},$J._doEase=function(){this._updateEase($d.now())},$J._updateEase=function($J){var $o=this._target;if($o){if($o.destroyed)return $v.clearTween($o);var $r=this._usedTimer=$J-this._startTimer-this._delay;if(!($r<0)){if($r>=this._duration)return this.complete();for(var $S=0<$r?this._ease($r,0,1,this._duration):0,$G=this._props,$z=0,$A=$G.length;$z<$A;$z++){var $h=$G[$z];$o[$h[0]]=$h[1]+$S*$h[2]}this.update&&this.update.run()}}},$J.complete=function(){if(this._target){$y.scaleTimer.runTimer(this,this.firstStart);for(var $J=this._target,$o=this._props,$r=this._complete,$S=0,$G=$o.length;$S<$G;$S++){var $z=$o[$S];$J[$z[0]]=$z[1]+$z[2]}this.update&&this.update.run(),this.clear(),$r&&$r.run()}},$J.pause=function(){$y.scaleTimer.clear(this,this._beginLoop),$y.scaleTimer.clear(this,this._doEase),$y.scaleTimer.clear(this,this.firstStart);var $J;($J=$d.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$J)},$J.setStartTime=function($J){this._startTimer=$J},$J.clear=function(){this._target&&(this._remove(),this._clear())},$J._clear=function(){this.pause(),$y.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$a.recover("tween",this))},$J.recover=function(){this._usedPool=!0,this._clear()},$J._remove=function(){var $J=$v.tweenMap[this._target.$_GID];if($J)for(var $o=0,$r=$J.length;$o<$r;$o++)if($J[$o]===this){$J.splice($o,1);break}},$J.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$d.now(),this._delayParam)$y.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $J=this._props,$o=0,$r=$J.length;$o<$r;$o++){var $S=$J[$o];this._target[$S[0]]=$S[1]}$y.scaleTimer.once(this._delay,this,this._beginLoop)}},$J.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$d.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$y.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$B(0,$J,"progress",null,function($J){var $o=$J*this._duration;this._startTimer=$d.now()-this._delay-$o}),$v.to=function($J,$o,$r,$S,$G,$z,$A,$h){return void 0===$z&&($z=0),void 0===$A&&($A=!1),void 0===$h&&($h=!0),$a.getItemByClass("tween",$v)._create($J,$o,$r,$S,$G,$z,$A,!0,$h,!0)},$v.from=function($J,$o,$r,$S,$G,$z,$A,$h){return void 0===$z&&($z=0),void 0===$A&&($A=!1),void 0===$h&&($h=!0),$a.getItemByClass("tween",$v)._create($J,$o,$r,$S,$G,$z,$A,!1,$h,!0)},$v.clearAll=function($J){if($J&&$J.$_GID){var $o=$v.tweenMap[$J.$_GID];if($o){for(var $r=0,$S=$o.length;$r<$S;$r++)$o[$r]._clear();$o.length=0}}},$v.clear=function($J){$J.clear()},$v.clearTween=function($J){$v.clearAll($J)},$v.easeNone=function($J,$o,$r,$S){return $r*$J/$S+$o},$v.tweenMap={},$v}(),$P=function(){function $h(){}return $D($h,"laya.utils.Utils"),$h.toRadian=function($J){return $J*$h._pi2},$h.toAngle=function($J){return $J*$h._pi},$h.toHexColor=function($J){if($J<0||isNaN($J))return null;for(var $o=$J.toString(16);$o.length<6;)$o="0"+$o;return"#"+$o},$h.getGID=function(){return $h._gid++},$h.concatArray=function($J,$o){if(!$o)return $J;if(!$J)return $o;var $r=0,$S=$o.length;for($r=0;$r<$S;$r++)$J.push($o[$r]);return $J},$h.clearArray=function($J){return $J&&($J.length=0),$J},$h.copyArray=function($J,$o){if($J||($J=[]),!$o)return $J;$J.length=$o.length;var $r=0,$S=$o.length;for($r=0;$r<$S;$r++)$J[$r]=$o[$r];return $J},$h.getGlobalRecByPoints=function($J,$o,$r,$S,$G){var $z,$A;return $z=new $g($o,$r),$z=$J.localToGlobal($z),$A=new $g($S,$G),$A=$J.localToGlobal($A),$s._getWrapRec([$z.x,$z.y,$A.x,$A.y])},$h.getGlobalPosAndScale=function($J){return $h.getGlobalRecByPoints($J,0,0,1,1)},$h.bind=function($J,$o){return $J.bind($o)},$h.measureText=function($J,$o){return $R.measureText($J,$o)},$h.contextMeasureText=function($J){var $o=$d.context.measureText($J);return $o||($o={width:16,height:16}),$o},$h.updateOrder=function($J){if(!$J||$J.length<2)return!1;for(var $o,$r=1,$S=0,$G=$J.length,$z=NaN;$r<$G;){for($o=$J[$S=$r],$z=$J[$S]._zOrder;-1<--$S&&$J[$S]._zOrder>$z;)$J[$S+1]=$J[$S];$J[$S+1]=$o,$r++}var $A=$o.parent.conchModel;if($A)if(null!=$A.updateZOrder)$A.updateZOrder();else{for($r=0;$r<$G;$r++)$A.removeChild($J[$r].conchModel);for($r=0;$r<$G;$r++)$A.addChildAt($J[$r].conchModel,$r)}return!0},$h.transPointList=function($J,$o,$r){var $S=0,$G=$J.length;for($S=0;$S<$G;$S+=2)$J[$S]+=$o,$J[$S+1]+=$r},$h.parseInt=function($J,$o){void 0===$o&&($o=0);var $r=$d.window.parseInt($J,$o);return isNaN($r)?0:$r},$h.getFileExtension=function($J){$h._extReg.lastIndex=$J.lastIndexOf(".");var $o=$h._extReg.exec($J);return $o&&1<$o.length?$o[1].toLowerCase():null},$h.getTransformRelativeToWindow=function($J,$o,$r){var $S=$y.stage,$G=laya.utils.Utils.getGlobalPosAndScale($J),$z=$S._canvasTransform.clone(),$A=$z.tx,$h=$z.ty;$z.rotate(-Math.PI/180*$y.stage.canvasDegree),$z.scale($y.stage.clientScaleX,$y.stage.clientScaleY);var $Z=$y.stage.canvasDegree%180!=0,$u=NaN,$B=NaN;$Z?($u=$r+$G.y,$B=$o+$G.x,$u*=$z.d,$B*=$z.a,90==$y.stage.canvasDegree?($u=$A-$u,$B+=$h):($u+=$A,$B=$h-$B)):($u=$o+$G.x,$B=$r+$G.y,$u*=$z.a,$B*=$z.d,$u+=$A,$B+=$h);var $v=NaN,$j=NaN;return $j=$Z?($v=$z.d*$G.height,$z.a*$G.width):($v=$z.a*$G.width,$z.d*$G.height),{x:$u,y:$B,scaleX:$v,scaleY:$j}},$h.fitDOMElementInArea=function($J,$o,$r,$S,$G,$z){$J._fitLayaAirInitialized||($J._fitLayaAirInitialized=!0,$J.style.transformOrigin=$J.style.webKittransformOrigin="left top",$J.style.position="absolute");var $A=$h.getTransformRelativeToWindow($o,$r,$S);$J.style.transform=$J.style.webkitTransform="scale("+$A.scaleX+","+$A.scaleY+") rotate("+$y.stage.canvasDegree+"deg)",$J.style.width=$G+"px",$J.style.height=$z+"px",$J.style.left=$A.x+"px",$J.style.top=$A.y+"px"},$h.isOkTextureList=function($J){if(!$J)return!1;var $o,$r=0,$S=$J.length;for($r=0;$r<$S;$r++)if(!($o=$J[$r])||!$o.source)return!1;return!0},$h.isOKCmdList=function($J){if(!$J)return!1;var $o,$r,$S=0,$G=$J.length,$z=$L._context;for($S=0;$S<$G;$S++)switch(($o=$J[$S]).callee){case $z._drawTexture:case $z._fillTexture:case $z._drawTextureWithTransform:if(!($r=$o[0])||!$r.source)return!1}return!0},$h._gid=1,$h._pi=180/Math.PI,$h._pi2=Math.PI/180,$h._extReg=/\.(\w+)\??/g,$h.parseXMLFromString=function($J){var $o;if($J=$J.replace(/>\s+</g,"><"),-1<($o=(new DOMParser).parseFromString($J,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($o.firstChild.firstChild.textContent);return $o},$h}(),$W=function(){function $J(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$L.isWebGL&&$c.regCacheByFunction($P.bind(this.startDispose,this),$P.bind(this.getCacheList,this))}$D($J,"laya.utils.VectorGraphManager");var $o=$J.prototype;return $o.getId=function(){return this._id++},$o.addShape=function($J,$o){this.shapeDic[$J]=$o,this.useDic[$J]||(this.useDic[$J]=!0)},$o.addLine=function($J,$o){this.shapeLineDic[$J]=$o,this.shapeLineDic[$J]||(this.shapeLineDic[$J]=!0)},$o.getShape=function($J){this._checkKey&&null!=this.useDic[$J]&&(this.useDic[$J]=!0)},$o.deleteShape=function($J){this.shapeDic[$J]&&(this.shapeDic[$J]=null,delete this.shapeDic[$J]),this.shapeLineDic[$J]&&(this.shapeLineDic[$J]=null,delete this.shapeLineDic[$J]),null!=this.useDic[$J]&&delete this.useDic[$J]},$o.getCacheList=function(){var $J,$o=[];for($J in this.shapeDic)$o.push(this.shapeDic[$J]);for($J in this.shapeLineDic)$o.push(this.shapeLineDic[$J]);return $o},$o.startDispose=function($J){var $o;for($o in this.useDic)this.useDic[$o]=!1;this._checkKey=!0},$o.endDispose=function(){if(this._checkKey){var $J;for($J in this.useDic)this.useDic[$J]||this.deleteShape($J);this._checkKey=!1}},$J.getInstance=function(){return $J.instance=$J.instance||new $J},$J.instance=null,$J}(),$E=function(){function $S(){this._obj=null,this._obj=$S.supportWeakMap?new $d.window.WeakMap:{},$S.supportWeakMap||$S._maps.push(this)}$D($S,"laya.utils.WeakObject");var $J=$S.prototype;return $J.set=function($J,$o){if(null!=$J)if($S.supportWeakMap){var $r=$J;"string"!=typeof $J&&"number"!=typeof $J||($r=$S._keys[$J])||($r=$S._keys[$J]={k:$J}),this._obj.set($r,$o)}else"string"==typeof $J||"number"==typeof $J?this._obj[$J]=$o:($J.$_GID||($J.$_GID=$P.getGID()),this._obj[$J.$_GID]=$o)},$J.get=function($J){if(null==$J)return null;if($S.supportWeakMap){var $o="string"==typeof $J||"number"==typeof $J?$S._keys[$J]:$J;return $o?this._obj.get($o):null}return"string"==typeof $J||"number"==typeof $J?this._obj[$J]:this._obj[$J.$_GID]},$J.del=function($J){if(null!=$J)if($S.supportWeakMap){var $o="string"==typeof $J||"number"==typeof $J?$S._keys[$J]:$J;if(!$o)return;this._obj.delete($o)}else"string"==typeof $J||"number"==typeof $J?delete this._obj[$J]:delete this._obj[this._obj.$_GID]},$J.has=function($J){if(null==$J)return!1;if($S.supportWeakMap){var $o="string"==typeof $J||"number"==typeof $J?$S._keys[$J]:$J;return this._obj.has($o)}return"string"==typeof $J||"number"==typeof $J?null!=this._obj[$J]:null!=this._obj[this._obj.$_GID]},$S.__init__=function(){($S.supportWeakMap=null!=$d.window.WeakMap)||$y.timer.loop($S.delInterval,null,$S.clearCache)},$S.clearCache=function(){for(var $J=0,$o=$S._maps.length;$J<$o;$J++){$S._maps[$J]._obj={}}},$S.supportWeakMap=!1,$S.delInterval=3e5,$S._keys={},$S._maps=[],$Z($S,["I",function(){return this.I=new $S}]),$S}(),$X=function(){function $J(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$D($J,"laya.utils.WordText");var $o=$J.prototype;return $o.setText=function($J){this.changed=!0,this._text=$J},$o.toString=function(){return this._text},$o.charCodeAt=function($J){return this._text?this._text.charCodeAt($J):NaN},$o.charAt=function($J){return this._text?this._text.charAt($J):null},$B(0,$o,"length",function(){return this._text?this._text.length:0}),$J}(),$JJ=function($J){function $A(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$A.__super.call(this),this._childs=$A.ARRAY_EMPTY,this._$P=$A.PROP_EMPTY,this.timer=$y.scaleTimer,this.conchModel=$L.isConchNode?this.createConchModel():null}$D($A,"laya.display.Node",$u);var $o=$A.prototype;return $o._setBit=function($J,$o){1==$J&&(this._getBit($J)!=$o&&this._updateDisplayedInstage());$o?this._bits|=$J:this._bits&=~$J},$o._getBit=function($J){return 0!=(this._bits&$J)},$o._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$o._setUpNoticeType=function($J){var $o=this;for($o._setBit($J,!0),$o=$o.parent;$o;){if($o._getBit($J))return;$o._setBit($J,!0),$o=$o.parent}},$o.on=function($J,$o,$r,$S){return"display"!==$J&&"undisplay"!==$J||this._getBit(1)||this._setUpNoticeType(1),this._createListener($J,$o,$r,$S,!1)},$o.once=function($J,$o,$r,$S){return"display"!==$J&&"undisplay"!==$J||this._getBit(1)||this._setUpNoticeType(1),this._createListener($J,$o,$r,$S,!0)},$o.createConchModel=function(){return null},$o.destroy=function($J){void 0===$J&&($J=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($J?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$o.destroyChildren=function(){if(this._childs)for(var $J=this._childs.length-1;-1<$J;$J--)this._childs[$J].destroy(!0)},$o.addChild=function($J){if(!$J||this.destroyed||$J===this)return $J;if($J.zOrder&&this._set$P("hasZorder",!0),$J._parent===this){var $o=this.getChildIndex($J);$o!==this._childs.length-1&&(this._childs.splice($o,1),this._childs.push($J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,this._childs.length-1)),this._childChanged())}else $J.parent&&$J.parent.removeChild($J),this._childs===$A.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($J),this.conchModel&&this.conchModel.addChildAt($J.conchModel,this._childs.length-1),($J.parent=this)._childChanged();return $J},$o.addChildren=function($J){for(var $o=arguments,$r=0,$S=$o.length;$r<$S;)this.addChild($o[$r++])},$o.addChildAt=function($J,$o){if(!$J||this.destroyed||$J===this)return $J;if($J.zOrder&&this._set$P("hasZorder",!0),0<=$o&&$o<=this._childs.length){if($J._parent===this){var $r=this.getChildIndex($J);this._childs.splice($r,1),this._childs.splice($o,0,$J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,$o)),this._childChanged()}else $J.parent&&$J.parent.removeChild($J),this._childs===$A.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($o,0,$J),this.conchModel&&this.conchModel.addChildAt($J.conchModel,$o),$J.parent=this;return $J}throw new Error("appendChildAt:The index is out of bounds")},$o.getChildIndex=function($J){return this._childs.indexOf($J)},$o.getChildByName=function($J){var $o=this._childs;if($o)for(var $r=0,$S=$o.length;$r<$S;$r++){var $G=$o[$r];if($G.name===$J)return $G}return null},$o._get$P=function($J){return this._$P[$J]},$o._set$P=function($J,$o){return this.destroyed||(this._$P===$A.PROP_EMPTY&&(this._$P={}),this._$P[$J]=$o),$o},$o.getChildAt=function($J){return this._childs[$J]},$o.setChildIndex=function($J,$o){var $r=this._childs;if($o<0||$o>=$r.length)throw new Error("setChildIndex:The index is out of bounds.");var $S=this.getChildIndex($J);if($S<0)throw new Error("setChildIndex:node is must child of this object.");return $r.splice($S,1),$r.splice($o,0,$J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,$o)),this._childChanged(),$J},$o._childChanged=function($J){},$o.removeChild=function($J){if(!this._childs)return $J;var $o=this._childs.indexOf($J);return this.removeChildAt($o)},$o.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$o.removeChildByName=function($J){var $o=this.getChildByName($J);return $o&&this.removeChild($o),$o},$o.removeChildAt=function($J){var $o=this.getChildAt($J);if($o){for(var $r=this._childs.length-1,$S=$J;$S<$r;++$S)this._childs[$S]=this._childs[$S+1];this._childs.length=$r,this.conchModel&&this.conchModel.removeChild($o.conchModel),$o.parent=null}return $o},$o.removeChildren=function($J,$o){if(void 0===$J&&($J=0),void 0===$o&&($o=2147483647),this._childs&&0<this._childs.length){var $r=this._childs;if(0===$J&&$z<=$o){var $S=$r;this._childs=$A.ARRAY_EMPTY}else $S=$r.splice($J,$o-$J);for(var $G=0,$z=$S.length;$G<$z;$G++)$S[$G].parent=null,this.conchModel&&this.conchModel.removeChild($S[$G].conchModel)}return this},$o.replaceChild=function($J,$o){var $r=this._childs.indexOf($o);return-1<$r?(this._childs.splice($r,1,$J),this.conchModel&&(this.conchModel.removeChild($o.conchModel),this.conchModel.addChildAt($J.conchModel,$r)),$o.parent=null,$J.parent=this,$J):null},$o._updateDisplayedInstage=function(){var $J;$J=this;var $o=$y.stage;for(this._displayedInStage=!1;$J;){if($J._getBit(1)){this._displayedInStage=$J._displayedInStage;break}if($J==$o||$J._displayedInStage){this._displayedInStage=!0;break}$J=$J.parent}},$o._setDisplay=function($J){this._displayedInStage!==$J&&((this._displayedInStage=$J)?this.event("display"):this.event("undisplay"))},$o._displayChild=function($J,$o){var $r=$J._childs;if($r)for(var $S=0;$S<$r.length;$S++){var $G=$r[$S];$G&&$G._getBit(1)&&(0<$G._childs.length?this._displayChild($G,$o):$G._setDisplay($o))}$J._setDisplay($o)},$o.contains=function($J){if($J===this)return!0;for(;$J;){if($J.parent===this)return!0;$J=$J.parent}return!1},$o.timerLoop=function($J,$o,$r,$S,$G,$z){void 0===$G&&($G=!0),void 0===$z&&($z=!1),this.timer.loop($J,$o,$r,$S,$G,$z)},$o.timerOnce=function($J,$o,$r,$S,$G){void 0===$G&&($G=!0),this.timer._create(!1,!1,$J,$o,$r,$S,$G)},$o.frameLoop=function($J,$o,$r,$S,$G){void 0===$G&&($G=!0),this.timer._create(!0,!0,$J,$o,$r,$S,$G)},$o.frameOnce=function($J,$o,$r,$S,$G){void 0===$G&&($G=!0),this.timer._create(!0,!1,$J,$o,$r,$S,$G)},$o.clearTimer=function($J,$o){this.timer.clear($J,$o)},$B(0,$o,"numChildren",function(){return this._childs.length}),$B(0,$o,"destroyed",function(){return this._destroyed}),$B(0,$o,"parent",function(){return this._parent},function($J){this._parent!==$J&&($J?(this._parent=$J,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$J.displayedInStage&&this._displayChild(this,!0)),$J._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$J))}),$B(0,$o,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$A.ARRAY_EMPTY=[],$A.PROP_EMPTY={},$A.NOTICE_DISPLAY=1,$A.MOUSEENABLE=2,$A}(),$oJ=function($J){function $j($J){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$j.__super.call(this),this._padding=$j._PADDING,this._spacing=$j._SPACING,this._aligns=$j._ALIGNS,this._font=$Y.EMPTY,this._ower=$J}$D($j,"laya.display.css.CSSStyle",$J);var $o=$j.prototype;return $o.destroy=function(){this._ower=null,this._font=null,this._rect=null},$o.inherit=function($J){this._font=$J._font,this._spacing=$J._spacing===$j._SPACING?$j._SPACING:$J._spacing.slice(),this.lineHeight=$J.lineHeight},$o._widthAuto=function(){return 0!=(262144&this._type)},$o.widthed=function($J){return 0!=(8&this._type)},$o._calculation=function($J,$o){if($o.indexOf("%")<0)return!1;var $S=this._ower,$G=$S.parent,$z=this._rect;function $A($J,$o,$r){return $J*$r[0]+$o*$r[1]+$r[2]}function $r($J){var $o=$G.width,$r=$S.width;$z.width&&($S.width=$A($o,$r,$z.width)),$z.height&&($S.height=$A($o,$r,$z.height)),$z.left&&($S.x=$A($o,$r,$z.left)),$z.top&&($S.y=$A($o,$r,$z.top))}null===$z&&($G._getCSSStyle()._type|=524288,$G.on("resize",this,$r),this._rect=$z={input:{}});var $h=$o.split(" ");return $h[0]=parseFloat($h[0])/100,1==$h.length?$h[1]=$h[2]=0:($h[1]=parseFloat($h[1])/100,$h[2]=parseFloat($h[2])),$z[$J]=$h,$z.input[$J]=$o,$r(),!0},$o.heighted=function($J){return 0!=(8192&this._type)},$o.size=function($J,$o){var $r=this._ower,$S=!1;-1!==$J&&$J!=this._ower.width&&(this._type|=8,this._ower.width=$J,$S=!0),-1!==$o&&$o!=this._ower.height&&(this._type|=8192,this._ower.height=$o,$S=!0),$S&&($r._layoutLater(),524288&this._type&&$r.event("resize",this))},$o._getAlign=function(){return this._aligns[0]},$o._getValign=function(){return this._aligns[1]},$o._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$o._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $Y(this._font))},$o.render=function($J,$o,$r,$S){var $G=$J.width,$z=$J.height;$r-=$J.pivotX,$S-=$J.pivotY,this._bgground&&null!=this._bgground.color&&$o.ctx.fillRect($r,$S,$G,$z,this._bgground.color),this._border&&this._border.color&&$o.drawRect($r,$S,$G,$z,this._border.color.strColor,this._border.size)},$o.getCSSStyle=function(){return this},$o.cssText=function($J){this.attrs($j.parseOneCSS($J,";"))},$o.attrs=function($J){if($J)for(var $o=0,$r=$J.length;$o<$r;$o++){var $S=$J[$o];this[$S[0]]=$S[1]}},$o.setTransform=function($J){"none"===$J?this._tf=$h._TF_EMPTY:this.attrs($j.parseOneCSS($J,","))},$o.translate=function($J,$o){this._tf===$h._TF_EMPTY&&(this._tf=new $G),this._tf.translateX=$J,this._tf.translateY=$o},$o.scale=function($J,$o){this._tf===$h._TF_EMPTY&&(this._tf=new $G),this._tf.scaleX=$J,this._tf.scaleY=$o},$o._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$B(0,$o,"block",$J.prototype._$get_block,function($J){$J?this._type|=1:this._type&=-2}),$B(0,$o,"valign",function(){return $j._valigndef[this._aligns[1]]},function($J){this._aligns===$j._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$j._valigndef[$J]}),$B(0,$o,"height",null,function($J){if(this._type|=8192,"string"==typeof $J){if(this._calculation("height",$J))return;$J=parseInt($J)}this.size(-1,$J)}),$B(0,$o,"width",null,function($J){if(this._type|=8,"string"==typeof $J){var $o=$J.indexOf("auto");if(0<=$o&&(this._type|=262144,$J=$J.substr(0,$o)),this._calculation("width",$J))return;$J=parseInt($J)}this.size($J,-1)}),$B(0,$o,"fontWeight",function(){return this._font.weight},function($J){this._createFont().weight=$J}),$B(0,$o,"left",null,function($J){var $o=this._ower;if("string"==typeof $J){if("center"===$J?$J="50% -50% 0":"right"===$J&&($J="100% -100% 0"),this._calculation("left",$J))return;$J=parseInt($J)}$o.x=$J}),$B(0,$o,"_translate",null,function($J){this.translate($J[0],$J[1])}),$B(0,$o,"absolute",function(){return 0!=(4&this._type)}),$B(0,$o,"top",null,function($J){var $o=this._ower;if("string"==typeof $J){if("middle"===$J?$J="50% -50% 0":"bottom"===$J&&($J="100% -100% 0"),this._calculation("top",$J))return;$J=parseInt($J)}$o.y=$J}),$B(0,$o,"align",function(){return $j._aligndef[this._aligns[0]]},function($J){this._aligns===$j._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$j._aligndef[$J]}),$B(0,$o,"bold",function(){return this._font.bold},function($J){this._createFont().bold=$J}),$B(0,$o,"padding",function(){return this._padding},function($J){this._padding=$J}),$B(0,$o,"leading",function(){return this._spacing[1]},function($J){"string"==typeof $J&&($J=parseInt($J+"")),this._spacing===$j._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$J}),$B(0,$o,"lineElement",function(){return 0!=(65536&this._type)},function($J){$J?this._type|=65536:this._type&=-65537}),$B(0,$o,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($J){this.lineElement=!1,"right"===$J?this._type|=32768:this._type&=-32769}),$B(0,$o,"textDecoration",function(){return this._font.decoration},function($J){this._createFont().decoration=$J}),$B(0,$o,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($J){"nowrap"===$J&&(this._type|=131072),"none"===$J&&(this._type&=-131073)}),$B(0,$o,"background",null,function($J){$J?(this._bgground||(this._bgground={}),this._bgground.color=$J,this._ower.conchModel&&this._ower.conchModel.bgColor($J),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$B(0,$o,"wordWrap",function(){return 0==(131072&this._type)},function($J){$J?this._type&=-131073:this._type|=131072}),$B(0,$o,"color",function(){return this._font.color},function($J){this._createFont().color=$J}),$B(0,$o,"password",function(){return this._font.password},function($J){this._createFont().password=$J}),$B(0,$o,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($J){"none"===$J?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$J),this._ower.conchModel&&this._ower.conchModel.bgColor($J),this._ower._renderType|=256}),$B(0,$o,"font",function(){return this._font.toString()},function($J){this._createFont().set($J)}),$B(0,$o,"weight",null,function($J){this._createFont().weight=$J}),$B(0,$o,"letterSpacing",function(){return this._spacing[0]},function($J){"string"==typeof $J&&($J=parseInt($J+"")),this._spacing===$j._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$J}),$B(0,$o,"fontSize",function(){return this._font.size},function($J){this._createFont().size=$J}),$B(0,$o,"italic",function(){return this._font.italic},function($J){this._createFont().italic=$J}),$B(0,$o,"fontFamily",function(){return this._font.family},function($J){this._createFont().family=$J}),$B(0,$o,"stroke",function(){return this._font.stroke[0]},function($J){this._createFont().stroke===$Y._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$J}),$B(0,$o,"strokeColor",function(){return this._font.stroke[1]},function($J){this._createFont().stroke===$Y._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$J}),$B(0,$o,"border",function(){return this._border?this._border.value:""},function($J){if("none"!=$J){this._border||(this._border={});var $o=(this._border.value=$J).split(" ");if(this._border.color=$b.create($o[$o.length-1]),1==$o.length)return this._border.size=1,void(this._border.type="solid");var $r=0;0<$o[0].indexOf("px")?(this._border.size=parseInt($o[0]),$r++):this._border.size=1,this._border.type=$o[$r],this._ower._renderType|=256}else this._border=null}),$B(0,$o,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($J){$J?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$J?null:$b.create($J),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$B(0,$o,"position",function(){return 4&this._type?"absolute":""},function($J){"absolute"==$J?this._type|=4:this._type&=-5}),$B(0,$o,"display",null,function($J){switch($J){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$B(0,$o,"paddingLeft",function(){return this.padding[3]}),$B(0,$o,"paddingTop",function(){return this.padding[0]}),$B(0,$o,"_scale",null,function($J){this._ower.scale($J[0],$J[1])}),$B(0,$o,"_rotate",null,function($J){this._ower.rotation=$J}),$j.parseOneCSS=function($J,$o){for(var $r,$S=[],$G=$J.split($o),$z=0,$A=$G.length;$z<$A;$z++){var $h=$G[$z],$Z=$h.indexOf(":"),$u=$h.substr(0,$Z).replace(/^\s+|\s+$/g,"");if(0!=$u.length){var $B=$h.substr($Z+1).replace(/^\s+|\s+$/g,""),$v=[$u,$B];switch($u){case"italic":case"bold":$v[1]="true"==$B;break;case"line-height":$v[0]="lineHeight",$v[1]=parseInt($B);break;case"font-size":$v[0]="fontSize",$v[1]=parseInt($B);break;case"padding":1<($r=$B.split(" ")).length||($r[1]=$r[2]=$r[3]=$r[0]),$v[1]=[parseInt($r[0]),parseInt($r[1]),parseInt($r[2]),parseInt($r[3])];break;case"rotate":$v[0]="_rotate",$v[1]=parseFloat($B);break;case"scale":$r=$B.split(" "),$v[0]="_scale",$v[1]=[parseFloat($r[0]),parseFloat($r[1])];break;case"translate":$r=$B.split(" "),$v[0]="_translate",$v[1]=[parseInt($r[0]),parseInt($r[1])];break;default:($v[0]=$j._CSSTOVALUE[$u])||($v[0]=$u)}$S.push($v)}}return $S},$j.parseCSS=function($J,$o){for(var $r;null!=($r=$j._parseCSSRegExp.exec($J));)$j.styleSheets[$r[1]]=$j.parseOneCSS($r[2],";")},$j.EMPTY=new $j(null),$j._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$j._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$j._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$j._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$j.styleSheets={},$j.ALIGN_CENTER=1,$j.ALIGN_RIGHT=2,$j.VALIGN_MIDDLE=1,$j.VALIGN_BOTTOM=2,$j._CSS_BLOCK=1,$j._DISPLAY_NONE=2,$j._ABSOLUTE=4,$j._WIDTH_SET=8,$j._PADDING=[0,0,0,0],$j._RECT=[-1,-1,-1,-1],$j._SPACING=[0,0],$j._ALIGNS=[0,0,0],$j.ADDLAYOUTED=512,$j._NEWFONT=4096,$j._HEIGHT_SET=8192,$j._BACKGROUND_SET=16384,$j._FLOAT_RIGHT=32768,$j._LINE_ELEMENT=65536,$j._NOWARP=131072,$j._WIDTHAUTO=262144,$j._LISTERRESZIE=524288,$j}($h),$rJ=function($J){function $A(){this.url=null,this.audio=null,this.loaded=!1,$A.__super.call(this)}$D($A,"laya.media.h5audio.AudioSound",$u);var $o=$A.prototype;return $o.dispose=function(){var $J=$A._audioCache[this.url];$J&&($J.src="",delete $A._audioCache[this.url])},$o.load=function($J){var $o;if($J=$U.formatURL($J),(this.url=$J)==$C._tMusic?($A._initMusicAudio(),($o=$A._musicAudio).src!=$J&&($A._audioCache[$o.src]=null,$o=null)):$o=$A._audioCache[$J],$o&&2<=$o.readyState)this.event("complete");else{$o||($o=$J==$C._tMusic?($A._initMusicAudio(),$A._musicAudio):$d.createElement("audio"),($A._audioCache[$J]=$o).src=$J),$o.addEventListener("canplaythrough",$S),$o.addEventListener("error",$G);var $r=this;(this.audio=$o).load?$o.load():$G()}function $S(){$z(),$r.loaded=!0,$r.event("complete")}function $G(){$o.load=null,$z(),$r.event("error")}function $z(){$o.removeEventListener("canplaythrough",$S),$o.removeEventListener("error",$G)}},$o.play=function($J,$o,$r){if(void 0===$J&&($J=0),void 0===$o&&($o=0),!this.url)return null;var $S,$G;if(!($S=this.url==$C._tMusic?$A._musicAudio:$A._audioCache[this.url]))return null;$G=$a.getItem("audio:"+this.url),$L.isConchApp?$G||(($G=$d.createElement("audio")).src=this.url):this.url==$C._tMusic?($A._initMusicAudio(),($G=$A._musicAudio).src=this.url):$G=$G||$S.cloneNode(!0);var $z=new $jJ($G);return $z.url=this.url,$z.loops=$o,$z.startTime=$J,$z.startHandler=$r,$z.play(!1),$C.addChannel($z),$z},$B(0,$o,"duration",function(){var $J;return($J=$A._audioCache[this.url])?$J.duration:0}),$A._initMusicAudio=function(){$A._musicAudio||($A._musicAudio||($A._musicAudio=$d.createElement("audio")),$L.isConchApp||$d.document.addEventListener("mousedown",$A._makeMusicOK))},$A._makeMusicOK=function(){$d.document.removeEventListener("mousedown",$A._makeMusicOK),$A._musicAudio.src?$A._musicAudio.play():($A._musicAudio.src="",$A._musicAudio.load())},$A._audioCache={},$A._musicAudio=null,$A}(),$SJ=function($J){function $o(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$o.__super.call(this)}$D($o,"laya.media.SoundChannel",$u);var $r=$o.prototype;return $r.play=function(){},$r.stop=function(){},$r.pause=function(){},$r.resume=function(){},$r.__runComplete=function($J){$J&&$J.run()},$B(0,$r,"volume",function(){return 1},function($J){}),$B(0,$r,"position",function(){return 0}),$B(0,$r,"duration",function(){return 0}),$o}(),$GJ=function($J){function $o(){$o.__super.call(this)}$D($o,"laya.media.Sound",$u);var $r=$o.prototype;return $r.load=function($J){},$r.play=function($J,$o,$r){return void 0===$J&&($J=0),void 0===$o&&($o=0),null},$r.dispose=function(){},$B(0,$r,"duration",function(){return 0}),$o}(),$zJ=function($J){function $G(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$G.__super.call(this)}$D($G,"laya.media.webaudio.WebAudioSound",$u);var $o=$G.prototype;return $o.load=function($J){this.url=$J,this.audioBuffer=$G._dataCache[$J],this.audioBuffer?this._loaded(this.audioBuffer):($G.e.on("loaded:"+$J,this,this._loaded),$G.e.on("err:"+$J,this,this._err),$G.__loadingSound[$J]||($G.__loadingSound[$J]=!0,$y.loader.load($J,$i.create(this,this.onloaded),null,$hJ.BUFFER,4,!1,null,!0)))},$o.onloaded=function($J){$J||this._err(),this._disposed?this._removeLoadEvents():(this.data=$J,$G.buffs.push({buffer:this.data,url:this.url}),$G.decode())},$o._err=function(){if(this._removeLoadEvents(),$G.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $J,$o,$r,$S=0;for($J=($o=this.__toPlays).length,$S=0;$S<$J;$S++)($r=$o[$S])[3]&&!$r[3].isStopped&&$r[3].event("error");this.__toPlays.length=0}},$o._loaded=function($J){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$J,this.loaded=!0,this.event("complete"))},$o._removeLoadEvents=function(){$G.e.off("loaded:"+this.url,this,this._loaded),$G.e.off("err:"+this.url,this,this._err)},$o.__playAfterLoaded=function(){if(this.__toPlays){var $J,$o,$r,$S=0;for($J=($o=this.__toPlays).length,$S=0;$S<$J;$S++)($r=$o[$S])[3]&&!$r[3].isStopped&&this.play($r[0],$r[1],$r[2],$r[3]);this.__toPlays.length=0}},$o.play=function($J,$o,$r,$S){return void 0===$J&&($J=0),void 0===$o&&($o=0),$S=$S||new $YJ,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$J,$o,$r,$S]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$S.url=this.url,$S.loops=$o,$S.audioBuffer=this.audioBuffer,$S.startTime=$J,$S.startHandler=$r,$S.play(!1),$C.addChannel($S),$S},$o.dispose=function(){this._disposed=!0,delete $G._dataCache[this.url],delete $G.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$B(0,$o,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$G.decode=function(){if(!($G.buffs.length<=0||$G.isDecoding))if($G.isDecoding=!0,($G.tInfo=$G.buffs.shift())&&$G.tInfo.buffer&&$G.tInfo.buffer.byteLength)try{$G.ctx.decodeAudioData($G.tInfo.buffer,$G._done,$G._fail)}catch($J){console.error("decodeAudioData error  byteLength:"+$G.tInfo.buffer.byteLength+"  url:"+$G.tInfo.url)}else $G._fail()},$G._done=function($J){$G.e.event("loaded:"+$G.tInfo.url,$J),$G._dataCache[$G.tInfo.url]=$J,$G.isDecoding=!1,$G.decode()},$G._fail=function(){$G.e.event("err:"+$G.tInfo.url,null),$G.isDecoding=!1,$G.decode()},$G._playEmptySound=function(){if(null!=$G.ctx){if($G._emptySource&&($G._emptySource.stop(),$G._emptySource.disconnect(0),!$YJ._tryCleanFailed))try{$G._emptySource.buffer=null}catch($J){$YJ._tryCleanFailed=!0}var $J=$G.ctx.createBufferSource();$J.buffer=$G._miniBuffer,$J.connect($G.ctx.destination),$J.start(0,0,0),$G._emptySource=$J}},$G._unlock=function(){$G._unlocked||($G._playEmptySound(),"running"==$G.ctx.state?($d.document.removeEventListener("mousedown",$G._unlock,!0),$d.document.removeEventListener("touchend",$G._unlock,!0),$d.document.removeEventListener("touchstart",$G._unlock,!0),$G._unlocked=!0):"suspended"==$G.ctx.state&&$C._recoverWebAudio())},$G.initWebAudio=function(){"running"!=$G.ctx.state&&($G._unlock(),$d.document.addEventListener("mousedown",$G._unlock,!0),$d.document.addEventListener("touchend",$G._unlock,!0),$d.document.addEventListener("touchstart",$G._unlock,!0))},$G._emptySource=null,$G._dataCache={},$G.buffs=[],$G.isDecoding=!1,$G._unlocked=!1,$G.tInfo=null,$G.__loadingSound={},$Z($G,["window",function(){return this.window=$d.window},"webAudioEnabled",function(){return this.webAudioEnabled=$G.window.AudioContext||$G.window.webkitAudioContext||$G.window.mozAudioContext},"ctx",function(){return this.ctx=$G.webAudioEnabled?new($G.window.AudioContext||$G.window.webkitAudioContext||$G.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$G.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $u}]),$G}(),$AJ=function($J){function $o(){this._responseType=null,this._data=null,$o.__super.call(this),this._http=new $d.window.XMLHttpRequest}$D($o,"laya.net.HttpRequest",$u);var $r=$o.prototype;return $r.send=function($J,$o,$r,$S,$G){void 0===$r&&($r="get"),void 0===$S&&($S="text"),this._responseType=$S,this._data=null;var $z=this,$A=this._http;if($A.open($r,$J,!0),$G)for(var $h=0;$h<$G.length;$h++)$A.setRequestHeader($G[$h++],$G[$h]);else $L.isConchApp||($o&&"string"!=typeof $o?$A.setRequestHeader("Content-Type","application/json"):$A.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$A.responseType="arraybuffer"!==$S?"text":"arraybuffer",$A.onerror=function($J){$z._onError($J)},$A.onabort=function($J){$z._onAbort($J)},$A.onprogress=function($J){$z._onProgress($J)},$A.onload=function($J){$z._onLoad($J)},$A.send($o)},$r._onProgress=function($J){$J&&$J.lengthComputable&&this.event("progress",$J.loaded/$J.total)},$r._onAbort=function($J){this.error("Request was aborted by user")},$r._onError=function($J){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$r._onLoad=function($J){var $o=this._http,$r=void 0!==$o.status?$o.status:200;200===$r||204===$r||0===$r?this.complete():this.error("["+$o.status+"]"+$o.statusText+":"+$o.responseURL)},$r.error=function($J){this.clear(),this.event("error",$J)},$r.complete=function(){this.clear();var $o=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$P.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($J){$o=!1,this.error($J.message)}$o&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$r.clear=function(){var $J=this._http;$J.onerror=$J.onabort=$J.onprogress=$J.onload=null},$B(0,$r,"url",function(){return this._http.responseURL}),$B(0,$r,"http",function(){return this._http}),$B(0,$r,"data",function(){return this._data}),$o}(),$hJ=function($J){function $V(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$V.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}$D($V,"laya.net.Loader",$u);var $o=$V.prototype;return $o.load=function($J,$o,$r,$S,$G){if($J&&""!=$J||console.error("Loader 加载的url不合法 "+$J),void 0===$r&&($r=!0),void 0===$G&&($G=!1),this._url=$J,this._base64=!1,0===$J.indexOf("data:image")?(this._base64=!0,this._type=$o="image"):this._type=$o||($o=this.getTypeFromUrl($J)),this._cache=$r,this._data=null,!$G&&$V.loadedMap[$J])return this._data=$V.loadedMap[$J],this.event("progress",1),void this.event("complete",this._data);if($S&&$V.setGroup($J,$S),null!=$V.parserMap[$o])return this._customParse=!0,void($V.parserMap[$o]instanceof laya.utils.Handler?$V.parserMap[$o].runWith(this):$V.parserMap[$o].call(null,this));if("image"===$o||"htmlimage"===$o||"nativeimage"===$o)return this._loadImage($J);if("ttf"===$o)return this._loadTTF($J);switch($o){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$o}$V.preLoadedMap[$J]?this.onLoaded($V.preLoadedMap[$J]):$A.resMgrLoad($J,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$o.getTypeFromUrl=function($J){var $o=$P.getFileExtension($J);return $o?$V.typeMap[$o]:(console.warn("Not recognize the resources suffix",$J),"text")},$o._loadTTF=function($J){$J=$U.formatURL($J);var $o=new $k;$o.complete=$i.create(this,this.onLoaded),$o.load($J)},$o._loadBase64Image=function($o){$o=$U.formatURL($o);var $r,$J=this;function $S(){$r.onload=null,$r.onerror=null,delete $V.imgCache[$o]}function $G(){$S(),$J.onLoaded($r)}function $z(){$S(),$J.event("error","Load image failed")}"nativeimage"===this._type?(($r=new $d.window.Image).crossOrigin="",$r.onload=$G,$r.onerror=$z,$r.src=$o,$V.imgCache[$o]=$r):new $eJ.create($o,{onload:$G,onerror:$z,onCreate:function($J){$r=$J,$V.imgCache[$o]=$J}})},$o._loadImage=function($J){this._base64?this._loadBase64Image($J):$A.imgMgrLoad($J,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$o._loadImageComplete=function($J,$o,$r){if(null!=$r)if($r instanceof ArrayBuffer){var $S=new DataView($r),$G=new laya.webgl.resource.WebGLImage(new Uint8Array($r,8),$J,0,!1,$S.getUint32(0),$S.getUint32(4));this.onLoaded($G)}else if($r instanceof $BJ)$V.imgMgrSet[$J]=$o,$A.imgMgrLock($J,$V.imgMgrSet[$J]),this._url=$J,this.complete($r);else{var $z=-1!=$J.indexOf(".png",$J.length-4)?6408:6407;$G=new laya.webgl.resource.WebGLImage($r,$J,$z,!1,$r.width,$r.height);this.onLoaded($G)}else this.event("error","Load image failed")},$o.imageCancel=function($J,$o,$r){$A.imgMgrCancel&&$A.imgMgrCancel($J,this._onImageCallback)},$o._loadSound=function($J){var $o=new $C._soundClass,$r=this;function $S(){$o.offAll()}$o.on("complete",this,function(){$S(),$r.onLoaded($o)}),$o.on("error",this,function(){$S(),$o.dispose(),$r.event("error","Load sound failed")}),$o.load($J)},$o.onProgress=function($J){"atlas"===this._type?this.event("progress",.3*$J):this.event("progress",$J)},$o.onError=function($J){this.event("error",$J)},$o._loadedComplete=function($J,$o,$r){if(null!=$r)switch(this._type){case"atlas":case"plf":case"json":var $S=new $l($r);this.onLoaded(JSON.parse($S.readUTFBytes()));break;case"font":$S=new $l($r);this.onLoaded($P.parseXMLFromString($S.readUTFBytes()));break;default:this.onLoaded($r)}else this.event("error",$J)},$o.onLoaded=function($J){var $o=this._type;if("plf"==$o)this.parsePLFData($J),this.complete($J);else if("image"===$o){var $r=new $BJ($J);$r.url=this._url,this.complete($r)}else if("sound"===$o||"htmlimage"===$o||"nativeimage"===$o)this.complete($J);else if("atlas"===$o){if(!$J.src&&!$J._setContext){if(!this._data){if((this._data=$J).meta&&$J.meta.image)for(var $S=$J.meta.image.split(","),$G=0<=this._url.indexOf("/")?"/":"\\",$z=this._url.lastIndexOf($G),$A=0<=$z?this._url.substr(0,$z+1):"",$h=0,$Z=$S.length;$h<$Z;$h++)$S[$h]=$A+$S[$h];else $S=[this._url.replace(".json",".png")];$S.reverse(),$J.toLoads=$S,$J.pics=[]}return this.event("progress",.3+1/$S.length*.6),this._loadImage($S.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($J),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $u=this._data.frames,$B=this._url.split("?")[0],$v=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$B.substring(0,$B.lastIndexOf("."))+"/",$j=this._data.pics,$Y=$U.formatURL(this._url),$_=$V.atlasMap[$Y]||($V.atlasMap[$Y]=[]);$_.dir=$v;var $D=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $N in $D=parseFloat(this._data.meta.scale),$u){var $w,$i=$u[$N],$I=$j[$i.frame.idx?$i.frame.idx:0],$t=$U.formatURL($v+$N);$I.scaleRate=$D,$w=$BJ.create($I,$i.frame.x,$i.frame.y,$i.frame.w,$i.frame.h,$i.spriteSourceSize.x,$i.spriteSourceSize.y,$i.sourceSize.w,$i.sourceSize.h),$V.cacheRes($t,$w),$V.keepCache(this._url,$v+$N),$w.url=$t,$_.push($t)}else for($N in $u)$I=$j[($i=$u[$N]).frame.idx?$i.frame.idx:0],$t=$U.formatURL($v+$N),$V.cacheRes($t,$BJ.create($I,$i.frame.x,$i.frame.y,$i.frame.w,$i.frame.h,$i.spriteSourceSize.x,$i.spriteSourceSize.y,$i.sourceSize.w,$i.sourceSize.h)),$V.loadedMap[$t].url=$t,$V.keepCache(this._url,$v+$N),$_.push($t);delete this._data.pics,this.complete(this._data)}else if("font"==$o){if(!$J.src)return this._data=$J,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $K=new $m;$K.parseFont(this._data,$J);var $e=this._url.split(".fnt")[0].split("/"),$y=$e[$e.length-1];$NJ.registerBitmapFont($y,$K),this._data=$K,this.complete(this._data)}else if("pkm"==$o){var $g=$eJ.create($J,this._url),$s=new $BJ($g);$s.url=this._url,this.complete($s)}else this.complete($J)},$o.parsePLFData=function($J){var $o,$r,$S;for($o in $J)switch($S=$J[$o],$o){case"json":case"text":for($r in $S)$V.preLoadedMap[$U.formatURL($r)]=$S[$r];break;default:for($r in $S)$V.preLoadedMap[$U.formatURL($r)]=$S[$r]}},$o.complete=function($J){this._data=$J,this._customParse?this.event("loaded",$J instanceof Array?[$J]:$J):($V._loaders.push(this),$V._isWorking||$V.checkNext())},$o.endLoad=function($J){$J&&(this._data=$J),this._cache&&$V.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$B(0,$o,"url",function(){return this._url}),$B(0,$o,"data",function(){return this._data}),$B(0,$o,"cache",function(){return this._cache}),$B(0,$o,"type",function(){return this._type}),$V.checkNext=function(){$V._isWorking=!0;for(var $J=$d.now();$V._startIndex<$V._loaders.length;)if($d.now(),$V._loaders[$V._startIndex].endLoad(),$V._startIndex++,$d.now()-$J>$V.maxTimeOut)return console.warn("loader callback cost a long time:"+($d.now()-$J)+" url="+$V._loaders[$V._startIndex-1].url),void $y.timer.frameOnce(1,null,$V.checkNext);$V._loaders.length=0,$V._startIndex=0,$V._isWorking=!1},$V.clearRes=function($J,$o){if(null!=$J){void 0===$o&&($o=!1),$J=$U.formatURL($J);var $r=$V.getAtlas($J);if($r){for(var $S=0,$G=$r.length;$S<$G;$S++){var $z=$r[$S],$A=$V.getRes($z);delete $V.loadedMap[$z],$V.clearCache($J.substring($U.basePath.length),$z.substring($U.basePath.length)),$A&&$A.destroy($o)}$r.length=0,delete $V.atlasMap[$J],delete $V.loadedMap[$J]}else{var $h=$V.loadedMap[$J];$h&&(delete $V.loadedMap[$J],$h instanceof laya.resource.Texture&&$h.bitmap&&$h.destroy($o))}}},$V.clearTextureRes=function($J){$J=$U.formatURL($J);var $o=laya.net.Loader.getAtlas($J),$r=$o&&0<$o.length?laya.net.Loader.getRes($o[0]):laya.net.Loader.getRes($J);$r&&$r.bitmap&&($L.isConchApp&&!$L.isConchWebGL?$r.bitmap.source.releaseTexture&&$r.bitmap.source.releaseTexture():null==$r.bitmap._atlaser&&$r.bitmap.releaseResource(!0))},$V.getRes=function($J){return $V.loadedMap[$U.formatURL($J)]},$V.getAtlas=function($J){return $V.atlasMap[$U.formatURL($J)]},$V.cacheRes=function($J,$o){$J=$U.formatURL($J),null!=$V.loadedMap[$J]?console.warn("Resources already exist,is repeated loading:",$J):$V.loadedMap[$J]=$o},$V.setGroup=function($J,$o){$V.groupMap[$o]||($V.groupMap[$o]=[]),$V.groupMap[$o].push($J)},$V.clearResByGroup=function($J){if($V.groupMap[$J]){var $o=$V.groupMap[$J],$r=0,$S=$o.length;for($r=0;$r<$S;$r++)$V.clearRes($o[$r]);$o.length=0}},$V.keepCache=function($J,$o){if($J&&$o){var $r=$V.cacheSet[$o];$r?-1==$r.indexOf($J)&&$r.push($J):$V.cacheSet[$o]=[$J]}},$V.clearCache=function($J,$o){if($J&&$o){var $r=$V.cacheSet[$o];if($r){var $S=$r.indexOf($J);if(-1!==$S){var $G=$r.length-1;0==$G?(delete $V.cacheSet[$o],0<$V.imgMgrSet[$o]?$A.imgMgrFree($o,$V.imgMgrSet[$o]):$V.clearRes($o,!0)):($r[$S]=$r[$G],$r.length=$G)}}}},$V.saveObject=function($J,$o,$r){if($o&&$J){var $S=$V.objectSet[$J];$S?(console.warn("Loader.saveObject: "+$J),$S[0]=$o,$S[1]=$r):$V.objectSet[$J]=[$o,$r,[]]}},$V.findObject=function($J){if($J){var $o=$V.objectSet[$J];if($o)return $o[0]}return null},$V.keepObject=function($J,$o){if($J&&$o){var $r=$V.objectSet[$o];$r&&-1===$r[2].indexOf($J)&&$r[2].push($J)}},$V.clearObject=function($J,$o){if($J&&$o){var $r=$V.objectSet[$o];if($r){var $S=$r[2],$G=$S.indexOf($J);if(-1!==$G){var $z=$S.length-1;0==$z?(delete $V.objectSet[$o],$r[1]&&$r[1].call(null,$r[0])):($S[$G]=$S[$z],$S.length=$z)}}}},$V.TEXT="text",$V.JSON="json",$V.XML="xml",$V.BUFFER="arraybuffer",$V.IMAGE="image",$V.SOUND="sound",$V.ATLAS="atlas",$V.FONT="font",$V.TTF="ttf",$V.PLF="plf",$V.PKM="pkm",$V.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$V.parserMap={},$V.groupMap={},$V.maxTimeOut=100,$V.loadedMap={},$V.preLoadedMap={},$V.atlasMap={},$V._loaders=[],$V._isWorking=!1,$V._startIndex=0,$V.imgCache={},$V.cacheSet={},$V.objectSet={},$V.imgMgrSet={},$V}(),$ZJ=function($J){var $j;function $Y(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$Y.__super.call(this);for(var $J=0;$J<this._maxPriority;$J++)this._resInfos[$J]=[]}$D($Y,"laya.net.LoaderManager",$u);var $o=$Y.prototype;return $o.create=function($J,$r,$o,$S,$G,$z,$A,$h){if(null==$z&&($z=2),null==$A&&($A=!0),$J instanceof Array){var $Z=$J,$u=$Z.length,$B=0;if($o)var $v=$i.create($o.caller,$o.method,$o.args,!1);for(var $j=0;$j<$u;$j++){var $Y=$Z[$j];"string"==typeof $Y&&($Y=$Z[$j]={url:$Y}),$Y.progress=0}for($j=0;$j<$u;$j++){$Y=$Z[$j];var $_=$o?$i.create(null,$w,[$Y],!1):null,$D=$o||$r?$i.create(null,$N,[$Y]):null;this._create($Y.url,$D,$_,$Y.clas||$S,$Y.params||$G,null!=$Y.priority&&0<=$Y.priority?$Y.priority:$z,$A,$Y.group||$h)}function $N($J,$o){$B++,$J.progress=1,$B===$u&&$r&&$r.run()}function $w($J,$o){$J.progress=$o;for(var $r=0,$S=0;$S<$u;$S++){$r+=$Z[$S].progress}var $G=$r/$u;$v.runWith($G)}return!0}return this._create($J,$r,$o,$S,$G,$z,$A,$h)},$o._create=function($o,$r,$J,$S,$G,$z,$A,$h){$o&&""!=$o||console.error("加载的url不合法 "+$o),null==$z&&($z=2),null==$A&&($A=!0);var $Z=$U.formatURL($o),$u=this.getRes($Z);if($u)!$u.hasOwnProperty("loaded")||$u.loaded?($J&&$J.runWith(1),$r&&$r.run()):$r&&$y.loader._createListener($o,$r.caller,$r.method,$r.args,!0,!1);else{var $B=$P.getFileExtension($o),$v=$Y.createMap[$B];if(!$v)throw new Error("LoaderManager:unknown file("+$o+") extension with: "+$B+".");$S||($S=$v[0]);var $j=$v[1];if("atlas"==$B)this.load($o,$r,$J,$j,$z,$A);else{$S===$BJ&&($j="htmlimage"),($u=$S?new $S:null).hasOwnProperty("_loaded")&&($u._loaded=!1),$u._setUrl($o),$h&&$u._setGroup($h),this._createLoad($u,$o,$i.create(null,function($J){$u&&!$u.destroyed&&$J&&$u.onAsynLoaded.call($u,$o,$J,$G),$r&&$r.run();$y.loader.event($o)}),$J,$j,$z,!1,$h,!0),$A&&this.cacheRes($Z,$u)}}return $u},$o.load=function($J,$o,$r,$S,$G,$z,$A,$h){$J&&""!=$J||console.error("加载的url不合法 "+$J);var $Z=this;if(null==$G&&($G=2),null==$z&&($z=!0),void 0===$h&&($h=!1),$J instanceof Array)return this._loadAssets($J,$o,$r,$S,$G,$z,$A);var $u=$hJ.getRes($J);if(null!=$u)$y.timer.frameOnce(1,null,function(){$r&&$r.runWith(1),$o&&$o.runWith($u),$Z._loaderCount||$Z.event("complete")});else{var $B=$Y._resMap[$J];$B?($o&&$B._createListener("complete",$o.caller,$o.method,$o.args,!1,!1),$r&&$B._createListener("progress",$r.caller,$r.method,$r.args,!1,!1)):(($B=this._infoPool.length?this._infoPool.pop():new $j).url=$J,$B.clas=null,$B.type=$S,$B.cache=$z,$B.group=$A,$B.ignoreCache=$h,$B.priority=$G,$o&&$B.on("complete",$o.caller,$o.method,$o.args),$r&&$B.on("progress",$r.caller,$r.method,$r.args),$Y._resMap[$J]=$B,$G=$G<this._maxPriority?0<=$G?$G:0:this._maxPriority-1,this._resInfos[$G].push($B),this._next())}return this},$o.cancel=function($J,$o,$r){if($u=$Y._resMap[$J]){$o&&$u.off("complete",$o.caller,$o.method,!1),$r&&$u.off("progress",$r.caller,$r.method,!1);var $S=$u.getListener("complete"),$G=$u.getListener("progress");if(!($S&&$S.head||$G&&$G.head)){if($u.loader){var $z=$u.loader;$z.imageCancel($J),$z.offAll(),$z._data=null,$z._customParse=!1,$z._url=null,$z._class=null,$z._type=null,this._loaders.push($z),this._loaderCount--,delete this._loaderMap[$u.url]}for(var $A=0;$A<this._maxPriority;$A++)for(var $h=this._resInfos[$A],$Z=$h.length-1;-1<$Z;$Z--){var $u;($u=$h[$Z])&&$u.url===$J&&($h[$Z]=null,$u.destroy(),$u.offAll(),this._infoPool.push($u))}delete $Y._resMap[$J],this._next()}}},$o._createLoad=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){var $u=this;if(null==$z&&($z=2),null==$A&&($A=!0),void 0===$Z&&($Z=!1),$o instanceof Array)return this._loadAssets($o,$r,$S,$G,$z,$A,$h);var $B=$hJ.getRes($o);if(null!=$B)$y.timer.frameOnce(1,null,function(){$S&&$S.runWith(1),$r&&$r.runWith($B),$u._loaderCount||$u.event("complete")});else{var $v=$Y._resMap[$o];$v?($r&&$v._createListener("complete",$r.caller,$r.method,$r.args,!1,!1),$S&&$v._createListener("progress",$S.caller,$S.method,$S.args,!1,!1)):(($v=this._infoPool.length?this._infoPool.pop():new $j).url=$o,$v.clas=$J,$v.type=$G,$v.cache=$A,$v.group=$h,$v.ignoreCache=$Z,$v.priority=$z,$r&&$v.on("complete",$r.caller,$r.method,$r.args),$S&&$v.on("progress",$S.caller,$S.method,$S.args),$Y._resMap[$o]=$v,$z=$z<this._maxPriority?0<=$z?$z:0:this._maxPriority-1,this._resInfos[$z].push($v),this._next())}return this},$o._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $J=0;$J<this._maxPriority;$J++)for(var $o=this._resInfos[$J];0<$o.length;){var $r=$o.shift();if($r)return this._doLoad($r)}this._loaderCount||this.event("complete")}},$o._doLoad=function($o){var $r=this._loaders.length?this._loaders.pop():new $hJ;this._loaderCount++,(this._loaderMap[$o.url]=$r).on("complete",null,$G),$r.on("progress",null,function($J){$o.event("progress",$J)}),$r.on("error",null,function($J){$G(null)}),$o.loader=$r;var $S=this;function $G($J){$r.offAll(),$r._data=null,$r._customParse=!1,$r._url=null,$r._class=null,$r._type=null,$S._loaders.push($r),$S._loaderCount--,delete $S._loaderMap[$o.url],$S._endLoad($o,$J instanceof Array?[$J]:$J),$S._next()}$r._class=$o.clas,1<=$o.priority?($r.priority=$o.priority,$r.realTime=!1):($r.priority=0,$r.realTime=!0),$r.load($o.url,$o.type,$o.cache,$o.group,$o.ignoreCache)},$o._endLoad=function($J,$o){var $r=$J.url;if(null==$o){var $S=this._failRes[$r]||0;if($S<this.retryNum)return console.warn("[warn]Retry to load:",$r),this._failRes[$r]=$S+1,void $y.timer.once(this.retryDelay,this,this._addReTry,[$J],!1);console.warn("[error]Failed to load:",$r),this.event("error",$r)}this._failRes[$r]&&(this._failRes[$r]=0),delete $Y._resMap[$r],$J.event("complete",$o),$J.destroy(),$J.offAll(),this._infoPool.push($J)},$o._addReTry=function($J){this._resInfos[this._maxPriority-1].push($J),this._next()},$o.clearRes=function($J,$o){void 0===$o&&($o=!1),$hJ.clearRes($J,$o)},$o.getRes=function($J){return $hJ.getRes($J)},$o.cacheRes=function($J,$o){$hJ.cacheRes($J,$o)},$o.clearTextureRes=function($J){$hJ.clearTextureRes($J)},$o.setGroup=function($J,$o){$hJ.setGroup($J,$o)},$o.clearResByGroup=function($J){$hJ.clearResByGroup($J)},$o.clearUnLoaded=function(){for(var $J=0;$J<this._maxPriority;$J++){for(var $o=this._resInfos[$J],$r=$o.length-1;-1<$r;$r--){var $S=$o[$r];$S&&($S.destroy(),$S.offAll(),this._infoPool.push($S))}$o.length=0}this._loaderCount=0,$Y._resMap={}},$o.cancelLoadByUrls=function($J){if($J)for(var $o=0,$r=$J.length;$o<$r;$o++)this.cancelLoadByUrl($J[$o])},$o.cancelLoadByUrl=function($J){for(var $o=0;$o<this._maxPriority;$o++)for(var $r=this._resInfos[$o],$S=$r.length-1;-1<$S;$S--){var $G=$r[$S];$G&&$G.url===$J&&($r[$S]=null,$G.destroy(),$G.offAll(),this._infoPool.push($G))}$Y._resMap[$J]&&delete $Y._resMap[$J]},$o._loadAssets=function($J,$r,$A,$o,$S,$G,$z){null==$S&&($S=2),null==$G&&($G=!0);for(var $h=$J.length,$Z=0,$u=0,$B=[],$v=!0,$j=0;$j<$h;$j++){var $Y=$J[$j];if(!$Y)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$J);"string"==typeof $Y&&($Y={url:$Y,type:$o,size:1,priority:$S}),$Y.size||($Y.size=1),$Y.progress=0,$u+=$Y.size,$B.push($Y);var $_=$A?$i.create(null,$w,[$Y],!1):null,$D=$r||$A?$i.create(null,$N,[$Y]):null;this.load($Y.url,$D,$_,$Y.type,null!=$Y.priority&&0<=$Y.priority?$Y.priority:2,$G,$Y.group||$z)}function $N($J,$o){$Z++,$J.progress=1,$o||($v=!1),$Z===$h&&$r&&$r.runWith($v)}function $w($J,$o){if(null!=$A){$J.progress=$o;for(var $r=0,$S=0;$S<$B.length;$S++){var $G=$B[$S];$r+=$G.size*$G.progress}var $z=$r/$u;$A.runWith($z)}}return this},$Y.cacheRes=function($J,$o){$hJ.cacheRes($J,$o)},$Y._resMap={},$Z($Y,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$Y.__init$=function(){$j=function($J){function $o(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$o.__super.call(this)}return $D($o,"",$u),$o.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$o}()},$Y}(),$uJ=(function($J){function $G($J){$G.__super.call(this),$J||($J=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $o=0,$r=0,$S=0;$S<20;$S++)$S%5!=4?this._mat[$o++]=$J[$S]:this._alpha[$r++]=$J[$S];this._action=$R.createFilterAction(32),this._action.data=this}$D($G,"laya.filters.ColorFilter",$w);var $o=$G.prototype;$y.imps($o,{"laya.filters.IFilter":!0}),$o.callNative=function($J){$J._$P.cf=this;$J.conchModel&&$J.conchModel.setFilterMatrix&&$J.conchModel.setFilterMatrix(this._mat,this._alpha)},$B(0,$o,"type",function(){return 32}),$B(0,$o,"action",function(){return this._action})}(),function($J){function $S($J,$o,$r){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$o&&($o=0),$S.__super.call(this),this._byteClass=$r||$l,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$J&&0<$o&&$o<65535&&this.connect($J,$o)}$D($S,"laya.net.Socket",$u);var $o=$S.prototype;$o.connect=function($J,$o){var $r="ws://"+$J+":"+$o;$r="https:"==$d.window.location.protocol?"wss://"+$J+":"+$o:"ws://"+$J+":"+$o,this.connectByUrl($r)},$o.connectByUrl=function($J){var $o=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $d.window.WebSocket($J,this.protocols):this._socket=new $d.window.WebSocket($J),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($J){$o._onOpen($J)},this._socket.onmessage=function($J){$o._onMessage($J)},this._socket.onclose=function($J){$o._onClose($J)},this._socket.onerror=function($J){$o._onError($J)}},$o.cleanSocket=function(){try{this._socket.close()}catch($J){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$o.close=function(){if(null!=this._socket)try{this._socket.close()}catch($J){}},$o._onOpen=function($J){this._connected=!0,this.event("open",$J)},$o._onMessage=function($J){if($J&&$J.data){var $o=$J.data;if(this.disableInput&&$o)this.event("message",$o);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $r=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$o&&("string"==typeof $o?this._input.writeUTFBytes($o):this._input.writeArrayBuffer($o),this._addInputPosition=this._input.pos,this._input.pos=$r),this.event("message",$o)}}},$o._onClose=function($J){this._connected=!1,this.event("close",$J)},$o._onError=function($J){this.event("error",$J)},$o.send=function($J){this._socket.send($J)},$o.flush=function(){if(this._output&&0<this._output.length){var $o;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($J){$o=$J}this._output.endian=this.endian,this._output.clear(),$o&&this.event("error",$o)}},$B(0,$o,"input",function(){return this._input}),$B(0,$o,"output",function(){return this._output}),$B(0,$o,"connected",function(){return this._connected}),$B(0,$o,"endian",function(){return this._endian},function($J){this._endian=$J,null!=this._input&&(this._input.endian=$J),null!=this._output&&(this._output.endian=$J)}),$S.LITTLE_ENDIAN="littleEndian",$S.BIG_ENDIAN="bigEndian"}(),function($J){function $h(){$h.__super.call(this),this._$1__id=++$h._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($h._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$F.currentResourceManager&&$F.currentResourceManager.addResource(this)}$D($h,"laya.resource.Resource",$u);var $o=$h.prototype;return $y.imps($o,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$o._setUrl=function($J){var $o;this._url!==$J&&(this._url&&(($o=$h._urlResourcesMap[this._url]).splice($o.indexOf(this),1),0===$o.length&&delete $h._urlResourcesMap[this._url]),$J&&(($o=$h._urlResourcesMap[$J])||($h._urlResourcesMap[$J]=$o=[]),$o.push(this)),this._url=$J)},$o._getGroup=function(){return this._group},$o._setGroup=function($J){var $o;this._group!==$J&&(this._group&&(($o=$h._groupResourcesMap[this._group]).splice($o.indexOf(this),1),0===$o.length&&delete $h._groupResourcesMap[this._group]),$J&&(($o=$h._groupResourcesMap[$J])||($h._groupResourcesMap[$J]=$o=[]),$o.push(this)),this._group=$J)},$o._addReference=function(){this._referenceCount++},$o._removeReference=function(){this._referenceCount--},$o._clearReference=function(){this._referenceCount=0},$o._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$o.recreateResource=function(){this.completeCreate()},$o.disposeResource=function(){},$o.activeResource=function($J){void 0===$J&&($J=!1),this._lastUseFrameCount=$x.loopCount,!this._destroyed&&this.__loaded&&(this._released||$J)&&this.recreateResource()},$o.releaseResource=function($J){return void 0===$J&&($J=!0),!(!$J&&this.lock)&&(!(this._released&&!$J)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$o.onAsynLoaded=function($J,$o,$r){throw new Error("Resource: must override this function!")},$o.destroy=function(){var $J;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $h._idResourcesMap[this.id],this._url&&(($J=$h._urlResourcesMap[this._url])&&($J.splice($J.indexOf(this),1),0===$J.length&&delete $h._urlResourcesMap[this.url]),$hJ.clearRes(this._url),this.__loaded||$R.cancelLoadByUrl(this._url)),this._group&&(($J=$h._groupResourcesMap[this._group]).splice($J.indexOf(this),1),0===$J.length&&delete $h._groupResourcesMap[this.url]))},$o.completeCreate=function(){this._released=!1,this.event("recovered",this)},$o.dispose=function(){this.destroy()},$B(0,$o,"memorySize",function(){return this._memorySize},function($J){var $o=$J-this._memorySize;this._memorySize=$J,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$o),this.resourceManager&&this.resourceManager.addSize($o)}),$B(0,$o,"_loaded",null,function($J){this.__loaded=$J}),$B(0,$o,"loaded",function(){return this.__loaded}),$B(0,$o,"id",function(){return this._$1__id}),$B(0,$o,"destroyed",function(){return this._destroyed}),$B(0,$o,"group",function(){return this._getGroup()},function($J){this._setGroup($J)}),$B(0,$o,"resourceManager",function(){return this._resourceManager}),$B(0,$o,"url",function(){return this._url}),$B(0,$o,"released",function(){return this._released}),$B(0,$o,"referenceCount",function(){return this._referenceCount}),$h.getResourceByID=function($J){return $h._idResourcesMap[$J]},$h.getResourceByURL=function($J,$o){return void 0===$o&&($o=0),null==$h._urlResourcesMap[$J]?null:$h._urlResourcesMap[$J][$o]},$h.getResourceCountByURL=function($J){return $h._urlResourcesMap[$J].length},$h.destroyUnusedResources=function($J){var $o;if($J){var $r=$h._groupResourcesMap[$J];if($r)for(var $S=$r.slice(),$G=0,$z=$S.length;$G<$z;$G++)($o=$S[$G]).lock||0!==$o._referenceCount||$o.destroy()}else for(var $A in $h._idResourcesMap)($o=$h._idResourcesMap[$A]).lock||0!==$o._referenceCount||$o.destroy()},$h._uniqueIDCounter=0,$h._idResourcesMap={},$h._urlResourcesMap={},$h._groupResourcesMap={},$h}()),$BJ=function($J){function $V($J,$o){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$V.__super.call(this),$J&&null!=$J._addReference&&$J._addReference(),this.setTo($J,$o)}$D($V,"laya.resource.Texture",$u);var $o=$V.prototype;return $o._setUrl=function($J){this.url=$J},$o.setTo=function($J,$o){if($J instanceof $A.HTMLElement){var $r=$IJ.create("2D",$J);this.bitmap=$r}else this.bitmap=$J;if(this.uv=$o||$V.DEF_UV,$J){this._w=$J.width,this._h=$J.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $S=this;if(this._loaded)$R.addToAtlas&&$R.addToAtlas($S);else{var $G=$J;$G instanceof laya.resource.HTMLImage&&$G.image&&$G.image.addEventListener("load",function($J){$R.addToAtlas&&$R.addToAtlas($S)},!1)}}},$o.active=function(){this.bitmap&&this.bitmap.activeResource()},$o.destroy=function($J){if(void 0===$J&&($J=!1),this.alphaTexture&&(this.alphaTexture.destroy($J),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $o=this.bitmap;$J?($L.isConchApp&&$o.source&&$o.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$o.dispose(),$o._clearReference()):($o._removeReference(),0==$o.referenceCount&&($L.isConchApp&&$o.source&&$o.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$o.dispose())),this.url&&this===$y.loader.getRes(this.url)&&$y.loader.clearRes(this.url,$J),this._loaded=!1}},$o.load=function($J){var $o=this;this._loaded=!1,$J=$U.customFormat($J);var $r=this.bitmap||(this.bitmap=$eJ.create($J));$r.uri=$J,$r&&$r._addReference();var $S=this;$r.onload=function(){$r.onload=null,$S._loaded=!0,$o.sourceWidth=$o._w=$r.width,$o.sourceHeight=$o._h=$r.height,$S.event("loaded",this),$R.addToAtlas&&$R.addToAtlas($S)}},$o.addTextureToAtlas=function($J){$R.addTextureToAtlas(this)},$o.getPixels=function($J,$o,$r,$S){if($L.isConchApp){var $G=this.bitmap;if($G.source&&$G.source.getImageData){var $z=$G.source.getImageData($J,$o,$r,$S),$A=new Uint8Array($z);return Array.from($A)}return null}return $L.isWebGL?$R.getTexturePixels(this,$J,$o,$r,$S):($d.canvas.size($r,$S),$d.canvas.clear(),$d.context.drawTexture(this,-$J,-$o,this.width,this.height,0,0),$d.context.getImageData(0,0,$r,$S).data)},$o.onAsynLoaded=function($J,$o){if($o){if("function"!=typeof $o._addReference)throw new Error("bitmap._addReference is not a function. "+$o.className+" "+typeof $o._addReference+" "+$o.constructor);$o._addReference()}this.setTo($o,this.uv),this._loaded&&this.event("loaded",this)},$B(0,$o,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$B(0,$o,"loaded",function(){return this._loaded}),$B(0,$o,"released",function(){return!this.bitmap||this.bitmap.released}),$B(0,$o,"width",function(){return this._w?this._w:this.uv&&this.uv!==$V.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($J){this._w=$J,this.sourceWidth||(this.sourceWidth=$J)}),$B(0,$o,"repeat",function(){return!$L.isWebGL||!this.bitmap||this.bitmap.repeat},function($J){$J&&$L.isWebGL&&this.bitmap&&(this.bitmap.repeat=$J)&&(this.bitmap.enableMerageInAtlas=!1)}),$B(0,$o,"height",function(){return this._h?this._h:this.uv&&this.uv!==$V.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($J){this._h=$J,this.sourceHeight||(this.sourceHeight=$J)}),$B(0,$o,"isLinearSampling",function(){return!$L.isWebGL||9728!=this.bitmap.minFifter},function($J){!$J&&$L.isWebGL&&($J||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$V.moveUV=function($J,$o,$r){for(var $S=0;$S<8;$S+=2)$r[$S]+=$J,$r[$S+1]+=$o;return $r},$V.create=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){void 0===$z&&($z=0),void 0===$A&&($A=0),void 0===$h&&($h=0),void 0===$Z&&($Z=0);var $u=$J instanceof laya.resource.Texture,$B=$u?$J.uv:$V.DEF_UV,$v=$u?$J.bitmap:$J,$j=$R.isAtlas($v);if($j){var $Y=$v._atlaser,$_=$J._atlasID;if(-1==$_)throw new Error("create texture error");$v=$Y._inAtlasTextureBitmapValue[$_],$B=$Y._inAtlasTextureOriUVValue[$_]}var $D=new $V($v,null);$v.width&&$o+$S>$v.width&&($S=$v.width-$o),$v.height&&$r+$G>$v.height&&($G=$v.height-$r),$D.width=$S,$D.height=$G,$D.offsetX=$z,$D.offsetY=$A,$D.sourceWidth=$h||$S,$D.sourceHeight=$Z||$G;var $N=1/$v.width,$w=1/$v.height;$o*=$N,$r*=$w,$S*=$N,$G*=$w;var $i=$D.uv[0],$I=$D.uv[1],$t=$D.uv[4],$K=$D.uv[5],$e=$t-$i,$y=$K-$I,$g=$V.moveUV($B[0],$B[1],[$o,$r,$o+$S,$r,$o+$S,$r+$G,$o,$r+$G]);$D.uv=[$i+$g[0]*$e,$I+$g[1]*$y,$t-(1-$g[2])*$e,$I+$g[3]*$y,$t-(1-$g[4])*$e,$K-(1-$g[5])*$y,$i+$g[6]*$e,$K-(1-$g[7])*$y],$j&&$D.addTextureToAtlas();var $s=$v.scaleRate;return $s&&1!=$s?($D.sourceWidth/=$s,$D.sourceHeight/=$s,$D.width/=$s,$D.height/=$s,$D.scaleRate=$s,$D.offsetX/=$s,$D.offsetY/=$s):$D.scaleRate=1,$D},$V.createFromTexture=function($J,$o,$r,$S,$G){var $z=$J.scaleRate;1!=$z&&($o*=$z,$r*=$z,$S*=$z,$G*=$z);var $A=$s.TEMP.setTo($o-$J.offsetX,$r-$J.offsetY,$S,$G),$h=$A.intersection($V._rect1.setTo(0,0,$J.width,$J.height),$V._rect2);if(!$h)return null;var $Z=$V.create($J,$h.x,$h.y,$h.width,$h.height,$h.x-$A.x,$h.y-$A.y,$S,$G);if($Z.bitmap&&$Z.bitmap._removeReference)return $Z.bitmap._removeReference(),$Z;var $u="bitmap:"+($Z.bitmap?$Z.bitmap.constructor?$Z.bitmap.constructor.name:$Z.bitmap.__className:"")+", url:"+($J.url+" | "+($Z.bitmap?$Z.bitmap.url:$J.url))+", x="+$o+",y="+$r+",width="+$S+",height="+$G+", result="+($h?$h.x+","+$h.y+","+$h.width+","+$h.height:"null")+", rect="+$A.x+","+$A.y+","+$A.width+","+$A.height;throw new Error("报错：bitmap._removeReference is not a function  "+$u)},$V.DEF_UV=[0,0,1,0,1,1,0,1],$V.INV_UV=[0,1,1,1,1,0,0,0],$V._rect1=new $s,$V._rect2=new $s,$V}(),$J=function($J){var $h;function $z(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$z.__super.call(this)}$D($z,"laya.utils.TimeLine",$u);var $o=$z.prototype;return $o.to=function($J,$o,$r,$S,$G){return void 0===$G&&($G=0),this._create($J,$o,$r,$S,$G,!0)},$o.from=function($J,$o,$r,$S,$G){return void 0===$G&&($G=0),this._create($J,$o,$r,$S,$G,!1)},$o._create=function($J,$o,$r,$S,$G,$z){var $A=$a.getItemByClass("tweenData",$h);return $A.isTo=$z,$A.type=0,$A.target=$J,$A.duration=$r,$A.data=$o,$A.startTime=this._startTime+$G,$A.endTime=$A.startTime+$A.duration,$A.ease=$S,this._startTime=Math.max($A.endTime,this._startTime),this._tweenDataList.push($A),this._startTimeSort=!0,this._endTimeSort=!0,this},$o.addLabel=function($J,$o){var $r=$a.getItemByClass("tweenData",$h);return $r.type=1,$r.data=$J,$r.endTime=$r.startTime=this._startTime+$o,this._labelDic||(this._labelDic={}),this._labelDic[$J]=$r,this._tweenDataList.push($r),this},$o.removeLabel=function($J){if(this._labelDic&&this._labelDic[$J]){var $o=this._labelDic[$J];if($o){var $r=this._tweenDataList.indexOf($o);-1<$r&&this._tweenDataList.splice($r,1)}delete this._labelDic[$J]}},$o.gotoTime=function($J){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $o,$r,$S,$G;for(var $z in this._firstTweenDic)if($r=this._firstTweenDic[$z])for(var $A in $r)$r.diyTarget.hasOwnProperty($A)&&($r.diyTarget[$A]=$r[$A]);for($z in this._tweenDic)($o=this._tweenDic[$z]).clear(),delete this._tweenDic[$z];if(this._index=0,this._gidIndex=0,this._currTime=$J,this._lastTime=$d.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$S=this._tweenDataList.concat(),$S.sort(function($J,$o){return $J.endTime>$o.endTime?1:$J.endTime<$o.endTime?-1:0})}else $S=this._endTweenDataList;for(var $h=0,$Z=$S.length;$h<$Z;$h++)if(0==($G=$S[$h]).type){if(!($J>=$G.endTime))break;this._index=Math.max(this._index,$h+1);var $u=$G.data;if($G.isTo)for(var $B in $u)$G.target[$B]=$u[$B]}for($h=0,$Z=this._tweenDataList.length;$h<$Z;$h++)0==($G=this._tweenDataList[$h]).type&&$J>=$G.startTime&&$J<$G.endTime&&(this._index=Math.max(this._index,$h+1),this._gidIndex++,($o=$a.getItemByClass("tween",$O))._create($G.target,$G.data,$G.duration,$G.ease,$i.create(this,this._animComplete,[this._gidIndex]),0,!1,$G.isTo,!0,!1),$o.setStartTime(this._currTime-($J-$G.startTime)),$o._updateEase(this._currTime),$o.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$o)}},$o.gotoLabel=function($J){if(null!=this._labelDic){var $o=this._labelDic[$J];$o&&this.gotoTime($o.startTime)}},$o.pause=function(){$y.timer.clear(this,this._update)},$o.resume=function(){this.play(this._currTime,this._loopKey)},$o.play=function($J,$o){if(void 0===$J&&($J=0),void 0===$o&&($o=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($J,$o){return $J.startTime>$o.startTime?1:$J.startTime<$o.startTime?-1:0});for(var $r=0,$S=this._tweenDataList.length;$r<$S;$r++){var $G=this._tweenDataList[$r];if(null!=$G&&0==$G.type){var $z=$G.target,$A=$z.$_GID||($z.$_GID=$P.getGID()),$h=null;for(var $Z in null==this._firstTweenDic[$A]?(($h={}).diyTarget=$z,this._firstTweenDic[$A]=$h):$h=this._firstTweenDic[$A],$G.data)null==$h[$Z]&&($h[$Z]=$z[$Z])}}}"string"==typeof $J?this.gotoLabel($J):this.gotoTime($J),this._loopKey=$o,this._lastTime=$d.now(),$y.timer.frameLoop(1,this,this._update)}},$o._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $J in this._tweenDic)($o=this._tweenDic[$J]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $o,$r=$d.now(),$S=$r-this._lastTime,$G=this._currTime+=$S*this.scale;for($J in this._lastTime=$r,this._tweenDic)($o=this._tweenDic[$J])._updateEase($G);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $z=this._tweenDataList[this._index];$G>=$z.startTime&&(this._index++,0==$z.type?(this._gidIndex++,($o=$a.getItemByClass("tween",$O))._create($z.target,$z.data,$z.duration,$z.ease,$i.create(this,this._animComplete,[this._gidIndex]),0,!1,$z.isTo,!0,!1),$o.setStartTime($G),$o.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$o)._updateEase($G)):this.event("label",$z.data))}},$o._animComplete=function($J){this._tweenDic[$J]&&delete this._tweenDic[$J]},$o._complete=function(){this.event("complete")},$o.reset=function(){var $J;if(this._labelDic)for($J in this._labelDic)delete this._labelDic[$J];for($J in this._tweenDic)this._tweenDic[$J].clear(),delete this._tweenDic[$J];for($J in this._firstTweenDic)delete this._firstTweenDic[$J];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $o,$r=0;for($o=this._tweenDataList.length,$r=0;$r<$o;$r++)this._tweenDataList[$r]&&this._tweenDataList[$r].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$y.timer.clear(this,this._update)},$o.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$B(0,$o,"index",function(){return this._frameIndex},function($J){this._frameIndex=$J,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$B(0,$o,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$z.to=function($J,$o,$r,$S,$G){return void 0===$G&&($G=0),(new $z).to($J,$o,$r,$S,$G)},$z.from=function($J,$o,$r,$S,$G){return void 0===$G&&($G=0),(new $z).from($J,$o,$r,$S,$G)},$z.__init$=function(){$h=function(){function $J(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $D($J,""),$J.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$a.recover("tweenData",this)},$J}()},$z}(),$vJ=function($G){function $r(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$r.__super.call(this),this._style=$h.EMPTY}$D($r,"laya.display.Sprite",$G);var $J=$r.prototype;return $y.imps($J,{"laya.display.ILayout":!0}),$J.createConchModel=function(){return new ConchNode},$J.destroy=function($J){if(void 0===$J&&($J=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $o=this.mask;$o&&(this.mask=null,$o.destroy($J))}$G.prototype.destroy.call(this,$J),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$J.updateZOrder=function(){$P.updateOrder(this._childs)&&this.repaint()},$J.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$J.setBounds=function($J){this._set$P("uBounds",$J)},$J.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $s),$s._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$J.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $s),$s._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$J._boundPointsToParent=function($J){void 0===$J&&($J=!1);var $o=0,$r=0;this._style&&($o=this._style._tf.translateX,$r=this._style._tf.translateY,$J=$J||0!==this._style._tf.rotate,this._style.scrollRect&&($o+=this._style.scrollRect.x,$r+=this._style.scrollRect.y));var $S=this._getBoundPointsM($J);if(!$S||$S.length<1)return $S;if(8!=$S.length&&($S=$J?$K.scanPList($S):$s._getWrapRec($S,$s.TEMP)._getBoundPoints()),!this.transform)return $P.transPointList($S,this._x-$o,this._y-$r),$S;var $G=$g.TEMP,$z=0,$A=$S.length;for($z=0;$z<$A;$z+=2)$G.x=$S[$z],$G.y=$S[$z+1],this.toParentPoint($G),$S[$z]=$G.x,$S[$z+1]=$G.y;return $S},$J.getGraphicBounds=function($J){return void 0===$J&&($J=!1),this._graphics?this._graphics.getBounds($J):$s.TEMP.setTo(0,0,0,0)},$J._getBoundPointsM=function($J){if(void 0===$J&&($J=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $o=$P.clearArray(this._$P.temBM),$r=$s.TEMP;return $r.copyFrom(this.scrollRect),$P.concatArray($o,$r._getBoundPoints()),$o}for(var $S,$G,$z,$A=this._graphics?this._graphics.getBoundPoints():$P.clearArray(this._$P.temBM),$h=0,$Z=($z=this._childs).length;$h<$Z;$h++)($S=$z[$h])instanceof laya.display.Sprite&&1==$S.visible&&($G=$S._boundPointsToParent($J))&&($A=$A?$P.concatArray($A,$G):$G);return $A},$J.getStyle=function(){return this._style===$h.EMPTY&&(this._style=new $h),this._style},$J.setStyle=function($J){this._style=$J},$J._adjustTransform=function(){this._tfChanged=!1;var $J,$o=this._style._tf,$r=$o.scaleX,$S=$o.scaleY;if($o.rotate||1!==$r||1!==$S||$o.skewX||$o.skewY){($J=this._transform||(this._transform=$n.create())).bTransform=!0;var $G=.0174532922222222*($o.rotate-$o.skewX),$z=.0174532922222222*($o.rotate+$o.skewY),$A=Math.cos($z),$h=Math.sin($z),$Z=Math.sin($G),$u=Math.cos($G);return $J.a=$r*$A,$J.b=$r*$h,$J.c=-$S*$Z,$J.d=$S*$u,$J.tx=$J.ty=0,$J}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$J},$J.pos=function($J,$o,$r){if(void 0===$r&&($r=!1),this._x!==$J||this._y!==$o){if(this.destroyed)return this;if($r){this._x=$J,this._y=$o,this.conchModel&&this.conchModel.pos(this._x,this._y);var $S=this._parent;$S&&0===$S._repaint&&($S._repaint=1,$S.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$J,this.y=$o}return this},$J.pivot=function($J,$o){return this.pivotX=$J,this.pivotY=$o,this},$J.size=function($J,$o){return this.width=$J,this.height=$o,this},$J.scale=function($J,$o,$r){void 0===$r&&($r=!1);var $S=this.getStyle(),$G=$S._tf;if($G.scaleX!=$J||$G.scaleY!=$o){if(this.destroyed)return this;if($r){$S.setScale($J,$o),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($J,$o),this._renderType|=4;var $z=this._parent;$z&&0===$z._repaint&&($z._repaint=1,$z.parentRepaint())}else this.scaleX=$J,this.scaleY=$o}return this},$J.skew=function($J,$o){return this.skewX=$J,this.skewY=$o,this},$J.render=function($J,$o,$r){$x.spriteCount++,$p.renders[this._renderType]._fun(this,$J,$o+this._x,$r+this._y),this._repaint=0},$J.drawToCanvas=function($J,$o,$r,$S){if($L.isConchNode){var $G=$IJ.create("2D");return new $Q($J,$o,$G).ctx.setCanvasType(1),this.conchModel.drawToCanvas($G.source,$r,$S),$G}return $R.drawToCanvas(this,this._renderType,$J,$o,$r,$S)},$J.customRender=function($J,$o,$r){this._renderType|=1024},$J._applyFilters=function(){var $J;if(!$L.isWebGL&&(($J=this._$P.filters)&&!($J.length<1)))for(var $o=0,$r=$J.length;$o<$r;$o++)$J[$o].action.apply(this._$P.cacheCanvas)},$J._isHaveGlowFilter=function(){var $J,$o=0;if(this.filters)for($o=0;$o<this.filters.length;$o++)if(8==this.filters[$o].type)return!0;for($o=0,$J=this._childs.length;$o<$J;$o++)if(this._childs[$o]._isHaveGlowFilter())return!0;return!1},$J.localToGlobal=function($J,$o){void 0===$o&&($o=!1),!0===$o&&($J=new $g($J.x,$J.y));for(var $r=this;$r&&$r!=$y.stage;)$J=$r.toParentPoint($J),$r=$r.parent;return $J},$J.globalToLocal=function($J,$o){void 0===$o&&($o=!1),$o&&($J=new $g($J.x,$J.y));for(var $r=this,$S=[];$r&&$r!=$y.stage;)$S.push($r),$r=$r.parent;for(var $G=$S.length-1;0<=$G;)$J=($r=$S[$G]).fromParentPoint($J),$G--;return $J},$J.toParentPoint=function($J){if(!$J)return $J;$J.x-=this.pivotX,$J.y-=this.pivotY,this.transform&&this._transform.transformPoint($J),$J.x+=this._x,$J.y+=this._y;var $o=this._style.scrollRect;return $o&&($J.x-=$o.x,$J.y-=$o.y),$J},$J.fromParentPoint=function($J){if(!$J)return $J;$J.x-=this._x,$J.y-=this._y;var $o=this._style.scrollRect;return $o&&($J.x+=$o.x,$J.y+=$o.y),this.transform&&this._transform.invertTransformPoint($J),$J.x+=this.pivotX,$J.y+=this.pivotY,$J},$J.on=function($J,$o,$r,$S){return 1!==this._mouseEnableState&&this.isMouseEvent($J)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($J,$o,$r,$S,!1)):$G.prototype.on.call(this,$J,$o,$r,$S)},$J.once=function($J,$o,$r,$S){return 1!==this._mouseEnableState&&this.isMouseEvent($J)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($J,$o,$r,$S,!0)):$G.prototype.once.call(this,$J,$o,$r,$S)},$J._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $J=this;for($J=$J.parent;$J&&1!==$J._mouseEnableState&&!$J._getBit(2);)$J.mouseEnabled=!0,$J._setBit(2,!0),$J=$J.parent}},$J.loadImage=function($J,$o,$r,$S,$G,$z){var $A=this;return void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0),void 0===$G&&($G=0),this.graphics.loadImage($J,$o,$r,$S,$G,function($J){$A.destroyed||($A.size($o+($S||$J.width),$r+($G||$J.height)),$A.repaint(),$z&&$z.runWith($J))}),this},$J.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$J._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$J._childChanged=function($J){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$J&&this._get$P("hasZorder")&&$y.timer.callLater(this,this.updateZOrder),this.repaint()},$J.parentRepaint=function(){var $J=this._parent;$J&&0===$J._repaint&&($J._repaint=1,$J.parentRepaint())},$J.startDrag=function($J,$o,$r,$S,$G,$z,$A){void 0===$o&&($o=!1),void 0===$r&&($r=0),void 0===$S&&($S=300),void 0===$z&&($z=!1),void 0===$A&&($A=.92),this._$P.dragging||this._set$P("dragging",new $$),this._$P.dragging.start(this,$J,$o,$r,$S,$G,$z,$A)},$J.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$J._releaseMem=function(){if(this._$P){var $J=this._$P.cacheCanvas;$J&&$J.ctx&&($a.recover("RenderContext",$J.ctx),$J.ctx.canvas.size(0,0),$J.ctx=null);var $o=this._$P._filterCache;$o&&($o.destroy(),$o.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$J._setDisplay=function($J){$J||this._releaseMem(),$G.prototype._setDisplay.call(this,$J)},$J.hitTestPoint=function($J,$o){var $r=this.globalToLocal($g.TEMP.setTo($J,$o));return $J=$r.x,$o=$r.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$s.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($J,$o)},$J.getMousePoint=function(){return this.globalToLocal($g.TEMP.setTo($y.stage.mouseX,$y.stage.mouseY))},$J._getWords=function(){return null},$J._addChildsToLayout=function($J){var $o=this._getWords();if(null==$o&&0==this._childs.length)return!1;if($o)for(var $r=0,$S=$o.length;$r<$S;$r++)$J.push($o[$r]);$r=0;for(var $G=this._childs.length;$r<$G;++$r){var $z=this._childs[$r];$z._style._enableLayout()&&$z._addToLayout($J)}return!0},$J._addToLayout=function($J){this._style.absolute||(this._style.block?$J.push(this):this._addChildsToLayout($J)&&(this.x=this.y=0))},$J._isChar=function(){return!1},$J._getCSSStyle=function(){return this._style.getCSSStyle()},$J._setAttributes=function($J,$o){switch($J){case"x":this.x=parseFloat($o);break;case"y":this.y=parseFloat($o);break;case"width":this.width=parseFloat($o);break;case"height":this.height=parseFloat($o);break;default:this[$J]=$o}},$J._layoutLater=function(){this.parent&&this.parent._layoutLater()},$B(0,$J,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($J){this._optimizeScrollRect!=$J&&(this._optimizeScrollRect=$J,this.conchModel&&this.conchModel.optimizeScrollRect($J))}),$B(0,$J,"customRenderEnable",null,function($J){if($J&&(this._renderType|=1024,$L.isConchNode)){$r.CustomList.push(this);var $o=new $IJ("2d");$o._setContext(new CanvasRenderingContext2D),this.customContext=new $Q(0,0,$o),$o.context.setCanvasType&&$o.context.setCanvasType(2),this.conchModel.custom($o.context)}}),$B(0,$J,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($J){this.cacheAs=$J?this._$P.hasFilter?"none":"normal":"none"}),$B(0,$J,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($J){var $o=this._$P.cacheCanvas;if($J!==($o?$o.type:"none")){if("none"!==$J)this._getBit(1)||this._setUpNoticeType(1),$o||($o=this._set$P("cacheCanvas",$a.getItemByClass("cacheCanvas",Object))),$o.type=$J,$o.reCache=!0,this._renderType|=16,"bitmap"==$J&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($o){var $r=$o;$r&&$r.ctx&&($a.recover("RenderContext",$r.ctx),$r.ctx.canvas.size(0,0),$r.ctx=null),$a.recover("cacheCanvas",$o)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$B(0,$J,"zOrder",function(){return this._zOrder},function($J){this._zOrder!=$J&&(this._zOrder=$J,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($J),this._parent&&($J&&this._parent._set$P("hasZorder",!0),$y.timer.callLater(this._parent,this.updateZOrder)))}),$B(0,$J,"rotation",function(){return this._style._tf.rotate},function($J){var $o=this.getStyle();if($o._tf.rotate!==$J){$o.setRotate($J),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($J),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$B(0,$J,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($J){this._width!==$J&&(this._width=$J,this.conchModel&&this.conchModel.size($J,this._height),this.repaint())}),$B(0,$J,"x",function(){return this._x},function($J){if(this._x!==$J){if(this.destroyed)return;this._x=$J,this.conchModel&&this.conchModel.pos($J,this._y);var $o=this._parent;$o&&0===$o._repaint&&($o._repaint=1,$o.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$B(0,$J,"globalScaleY",function(){for(var $J=1,$o=this;$o&&$o!==$y.stage;)$J*=$o.scaleY,$o=$o.parent;return $J}),$B(0,$J,"hitArea",function(){return this._$P.hitArea},function($J){this._set$P("hitArea",$J)}),$B(0,$J,"staticCache",function(){return this._$P.staticCache},function($J){this._set$P("staticCache",$J),$J||this.reCache()}),$B(0,$J,"texture",function(){return this._texture},function($J){this._texture!=$J&&(this._texture=$J,this.graphics.cleanByTexture($J,0,0))}),$B(0,$J,"y",function(){return this._y},function($J){if(this._y!==$J){if(this.destroyed)return;this._y=$J,this.conchModel&&this.conchModel.pos(this._x,$J);var $o=this._parent;$o&&0===$o._repaint&&($o._repaint=1,$o.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$B(0,$J,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($J){this._height!==$J&&(this._height=$J,this.conchModel&&this.conchModel.size(this._width,$J),this.repaint())}),$B(0,$J,"blendMode",function(){return this._style.blendMode},function($J){this.getStyle().blendMode=$J,this.conchModel&&this.conchModel.blendMode($J),$J&&"source-over"!=$J?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$B(0,$J,"scaleX",function(){return this._style._tf.scaleX},function($J){var $o=this.getStyle();if($o._tf.scaleX!==$J){$o.setScaleX($J),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($J,$o._tf.scaleY),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$B(0,$J,"scaleY",function(){return this._style._tf.scaleY},function($J){var $o=this.getStyle();if($o._tf.scaleY!==$J){$o.setScaleY($J),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($o._tf.scaleX,$J),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$B(0,$J,"stage",function(){return $y.stage}),$B(0,$J,"skewX",function(){return this._style._tf.skewX},function($J){var $o=this.getStyle();if($o._tf.skewX!==$J){$o.setSkewX($J),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($J,$o._tf.skewY),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$B(0,$J,"scrollRect",function(){return this._style.scrollRect},function($J){this.getStyle().scrollRect=$J,this.repaint(),$J?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($J.x,$J.y,$J.width,$J.height)):(this._renderType&=-129,this.conchModel&&($r.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$B(0,$J,"skewY",function(){return this._style._tf.skewY},function($J){var $o=this.getStyle();if($o._tf.skewY!==$J){$o.setSkewY($J),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($o._tf.skewX,$J),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$B(0,$J,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($J){this._tfChanged=!1,(this._transform=$J)&&(this._x=$J.tx,this._y=$J.ty,$J.tx=$J.ty=0,this.conchModel&&this.conchModel.transform($J.a,$J.b,$J.c,$J.d,this._x,this._y)),$J?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$B(0,$J,"pivotX",function(){return this._style._tf.translateX},function($J){this.getStyle().setTranslateX($J),this.conchModel&&this.conchModel.pivot($J,this._style._tf.translateY),this.repaint()}),$B(0,$J,"pivotY",function(){return this._style._tf.translateY},function($J){this.getStyle().setTranslateY($J),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$J),this.repaint()}),$B(0,$J,"alpha",function(){return this._style.alpha},function($J){this._style&&this._style.alpha!==$J&&($J=$J<0?0:1<$J?1:$J,this.getStyle().alpha=$J,this.conchModel&&this.conchModel.alpha($J),1!==$J?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$B(0,$J,"visible",function(){return this._style.visible},function($J){this._style&&this._style.visible!==$J&&(this.getStyle().visible=$J,this.conchModel&&this.conchModel.visible($J),this.parentRepaint())}),$B(0,$J,"graphics",function(){return this._graphics||(this.graphics=$R.createGraphics())},function($J){this._graphics&&(this._graphics._sp=null),(this._graphics=$J)?(this._renderType&=-2,this._renderType|=512,($J._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($r.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$B(0,$J,"filters",function(){return this._$P.filters},function($J){$J&&0===$J.length&&($J=null),this._$P.filters!=$J&&(this._set$P("filters",$J?$J.slice():null),$L.isConchApp&&(this.conchModel&&($r.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$L.isWebGL&&($J&&$J.length?this._renderType|=32:this._renderType&=-33),$J&&0<$J.length?(this._getBit(1)||this._setUpNoticeType(1),$L.isWebGL&&1==$J.length&&$J[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($L.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$B(0,$J,"parent",$G.prototype._$get_parent,function($J){$y.superSet($JJ,this,"parent",$J),$J&&this._getBit(2)&&this._$2__onDisplay()}),$B(0,$J,"mask",function(){return this._$P._mask},function($J){$J&&this.mask&&this.mask._$P.maskParent||($J?(this.cacheAs="bitmap",this._set$P("_mask",$J),$J._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$J),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($J?$J.conchModel:null),this._renderType|=64,this.parentRepaint())}),$B(0,$J,"mouseEnabled",function(){return 1<this._mouseEnableState},function($J){this._mouseEnableState=$J?2:1}),$B(0,$J,"globalScaleX",function(){for(var $J=1,$o=this;$o&&$o!==$y.stage;)$J*=$o.scaleX,$o=$o.parent;return $J}),$B(0,$J,"mouseX",function(){return this.getMousePoint().x}),$B(0,$J,"mouseY",function(){return this.getMousePoint().y}),$r.fromImage=function($J){return(new $r).loadImage($J)},$r._cachePool=[],$r.CustomList=[],$Z($r,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$A.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$r}($JJ),$jJ=function($J){function $o($J){this._audio=null,this._onEnd=null,this._resumePlay=null,$o.__super.call(this),this._onEnd=$P.bind(this.__onEnd,this),this._resumePlay=$P.bind(this.__resumePlay,this),$J.addEventListener("ended",this._onEnd),this._audio=$J}$D($o,"laya.media.h5audio.AudioSoundChannel",$SJ);var $r=$o.prototype;return $r.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($y.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$r.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$d.container.appendChild(this._audio),this._audio.play()}catch($J){this.event("error")}},$r.play=function($J){this.isStopped=!1;try{this._audio.playbackRate=$C.playbackRate,this._audio.currentTime=this.startTime}catch($J){return void this._audio.addEventListener("canplay",this._resumePlay)}$C.addChannel(this),$d.container.appendChild(this._audio),!$J&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$r.stop=function(){this.isStopped=!0,$C.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$L.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$d.onIE||this._audio!=$rJ._musicAudio&&$a.recover("audio:"+this.url,this._audio),$d.removeElement(this._audio),this._audio=null)},$r.pause=function(){this.isStopped=!0,$C.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$r.resume=function(){this._audio&&(this.isStopped=!1,$C.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$B(0,$r,"position",function(){return this._audio?this._audio.currentTime:0}),$B(0,$r,"duration",function(){return this._audio?this._audio.duration:0}),$B(0,$r,"volume",function(){return this._audio?this._audio.volume:1},function($J){this._audio&&(this._audio.volume=$J)}),$o}(),$YJ=function($J){function $o(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$zJ.ctx,$o.__super.call(this),this._onPlayEnd=$P.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$D($o,"laya.media.webaudio.WebAudioSoundChannel",$SJ);var $r=$o.prototype;return $r.play=function($J){if($C.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $o=this.context,$r=this.gain,$S=$o.createBufferSource();(this.bufferSource=$S).buffer=this.audioBuffer,$S.connect($r),$r&&$r.disconnect(),$r.connect($o.destination),$S.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$d.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($S.loop=!0),$S.playbackRate.setTargetAtTime?$S.playbackRate.setTargetAtTime($C.playbackRate,this.context.currentTime,.1):$S.playbackRate.value=$C.playbackRate,$S.start(0,this.startTime),!$J&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$r.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($y.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$r._clearBufferSource=function(){if(this.bufferSource){var $J=this.bufferSource;$J.stop?$J.stop(0):$J.noteOff(0),$J.disconnect(0),$J.onended=null,$o._tryCleanFailed||this._tryClearBuffer($J),this.bufferSource=null}},$r._tryClearBuffer=function($J){try{$J.buffer=null}catch($J){$o._tryCleanFailed=!0}},$r.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$C.removeChannel(this),this.startHandler=null,this.completeHandler=null},$r.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$C.removeChannel(this)},$r.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$B(0,$r,"position",function(){return this.bufferSource?($d.now()-this._startTime)/1e3+this.startTime:0}),$B(0,$r,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$B(0,$r,"volume",function(){return this._volume},function($J){this.isStopped||(this._volume=$J,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($J,this.context.currentTime,.1):this.gain.gain.value=$J)}),$o._tryCleanFailed=!1,$o}(),$_J=function($J){function $o(){$o.__super.call(this),this._w=0,this._h=0}$D($o,"laya.resource.Bitmap",$uJ);var $r=$o.prototype;return $B(0,$r,"width",function(){return this._w}),$B(0,$r,"height",function(){return this._h}),$B(0,$r,"source",function(){return this._source}),$o}(),$DJ=function($o){function $J(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$J.__super.call(this),this._interval=$S.animationInterval,this._setUpNoticeType(1)}$D($J,"laya.display.AnimationPlayerBase",$o);var $r=$J.prototype;return $r.play=function($J,$o,$r,$S){void 0===$J&&($J=0),void 0===$o&&($o=!0),void 0===$r&&($r=""),void 0===$S&&($S=!0),this._isPlaying=!0,this.index="string"==typeof $J?this._getFrameByLabel($J):$J,this.loop=$o,this._actionName=$r,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$r._getFrameByLabel=function($J){var $o=0;for($o=0;$o<this._count;$o++)if(this._labels[$o]&&0<=this._labels[$o].indexOf($J))return $o;return 0},$r._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$r._setControlNode=function($J){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$J)&&$J!=this&&($J.on("display",this,this._checkResumePlaying),$J.on("undisplay",this,this._checkResumePlaying))},$r._setDisplay=function($J){$o.prototype._setDisplay.call(this,$J),this._checkResumePlaying()},$r._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$r.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$r.addLabel=function($J,$o){this._labels||(this._labels={}),this._labels[$o]||(this._labels[$o]=[]),this._labels[$o].push($J)},$r.removeLabel=function($J){if($J){if(this._labels)for(var $o in this._labels)this._removeLabelFromLabelList(this._labels[$o],$J)}else this._labels=null},$r._removeLabelFromLabelList=function($J,$o){if($J)for(var $r=$J.length-1;0<=$r;$r--)$J[$r]==$o&&$J.splice($r,1)},$r.gotoAndStop=function($J){this.index="string"==typeof $J?this._getFrameByLabel($J):$J,this.stop()},$r._displayToIndex=function($J){},$r.clear=function(){this.stop(),this._labels=null},$B(0,$r,"interval",function(){return this._interval},function($J){this._interval!=$J&&(this._frameRateChanged=!0,this._interval=$J,this._isPlaying&&0<$J&&this.timerLoop($J,this,this._frameLoop,null,!0,!0))}),$B(0,$r,"isPlaying",function(){return this._isPlaying}),$B(0,$r,"index",function(){return this._index},function($J){if(this._index=$J,this._displayToIndex($J),this._labels&&this._labels[$J])for(var $o=this._labels[$J],$r=0,$S=$o.length;$r<$S;$r++)this.event("label",$o[$r])}),$B(0,$r,"count",function(){return this._count}),$J.WRAP_POSITIVE=0,$J.WRAP_REVERSE=1,$J.WRAP_PINGPONG=2,$J}($vJ),$NJ=function($o){function $Y(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$Y.__super.call(this),this.overflow=$Y.VISIBLE,this._style=new $oJ(this),this._style.wordWrap=!1}$D($Y,"laya.display.Text",$o);var $J=$Y.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$J._getBoundPointsM=function($J){void 0===$J&&($J=!1);var $o=$s.TEMP;return $o.setTo(0,0,this.width,this.height),$o._getBoundPoints()},$J.getGraphicBounds=function($J){void 0===$J&&($J=!1);var $o=$s.TEMP;return $o.setTo(0,0,this.width,this.height),$o},$J._getCSSStyle=function(){return this._style},$J.lang=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B){if($J=$Y.langPacks&&$Y.langPacks[$J]?$Y.langPacks[$J]:$J,arguments.length<2)this._text=$J;else{for(var $v=0,$j=arguments.length;$v<$j;$v++)$J=$J.replace("{"+$v+"}",arguments[$v+1]);this._text=$J}},$J._isPassWordMode=function(){var $J=this._style.password;return"prompt"in this&&this.prompt==this._text&&($J=!1),$J},$J._getPassWordTxt=function($J){var $o;$o="";for(var $r=$J.length;0<$r;$r--)$o+="●";return $o},$J.renderText=function($J,$o){var $r=this.graphics;$r.clear(!0);var $S=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($d.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$d.context.font=$S;var $G=this.padding,$z=$G[3],$A="left",$h=this._lines,$Z=this.leading+this._charSize.height,$u=this._currBitmapFont;$u&&($Z=this.leading+$u.getMaxHeight());var $B=$G[0];if(!$u&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($A="right",$z=this._width-$G[1]):"center"==this.align&&($A="center",$z=.5*this._width+$G[3]-$G[1])),0<this._height){var $v=this._textHeight>this._height?"top":this.valign;"middle"===$v?$B=.5*(this._height-$o*$Z)+$G[0]-$G[2]:"bottom"===$v&&($B=this._height-$o*$Z-$G[2])}var $j=this._style;if($u&&$u.autoScaleSize)var $Y=$u.fontSize/this.fontSize;if(this._clipPoint)if($r.save(),$u&&$u.autoScaleSize){var $_=0,$D=0;$_=this._width?this._width-$G[3]-$G[1]:this._textWidth,$D=this._height?this._height-$G[0]-$G[2]:this._textHeight,$_*=$Y,$D*=$Y,$r.clipRect($G[3],$G[0],$_,$D)}else $r.clipRect($G[3],$G[0],this._width?this._width-$G[3]-$G[1]:this._textWidth,this._height?this._height-$G[0]-$G[2]:this._textHeight);var $N=$j.password;"prompt"in this&&this.prompt==this._text&&($N=!1);for(var $w=0,$i=0,$I=Math.min(this._lines.length,$o+$J)||1,$t=$J;$t<$I;$t++){var $K,$e=$h[$t];if($N){var $y=$e.length;$e="";for(var $g=$y;0<$g;$g--)$e+="●"}if($w=$z-(this._clipPoint?this._clipPoint.x:0),$i=$B+$Z*$t-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($A,$w,$i,$t),$u){var $s=this.width;$u.autoScaleSize&&($s=this.width*$Y),$u.drawText($e,this,$w,$i,this.align,$s)}else $L.isWebGL?(this._words||(this._words=[]),($K=this._words.length>$t-$J?this._words[$t-$J]:new $X).setText($e)):$K=$e,$j.stroke?$r.fillBorderText($K,$w,$i,$S,this.color,$j.strokeColor,$j.stroke,$A):$r.fillText($K,$w,$i,$S,this.color,$A)}if($u&&$u.autoScaleSize){var $V=1/$Y;this.scale($V,$V)}this._clipPoint&&$r.restore(),this._startX=$z,this._startY=$B},$J.drawUnderline=function($J,$o,$r,$S){var $G=this._lineWidths[$S];switch($J){case"center":$o-=$G/2;break;case"right":$o-=$G}$r+=this._charSize.height,this._graphics.drawLine($o,$r,$o+$G,$r,this.underlineColor||this.color,1)},$J.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$d.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $g(0,0)):this._clipPoint=null;var $J=this._lines.length;if(this.overflow!=$Y.VISIBLE){var $o=this.overflow==$Y.HIDDEN?Math.floor:Math.ceil;$J=Math.min($J,$o((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $r=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($r,$J),this.repaint()},$J.evalTextSize=function(){var $J,$o=NaN;$J=Math.max.apply(this,this._lineWidths),$o=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$J==this._textWidth&&$o==this._textHeight||(this._textWidth=$J,this._textHeight=$o,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$J.checkEnabledViewportOrNot=function(){return this.overflow==$Y.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$J.changeText=function($J){this._text!==$J&&(this.lang($J+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$J.parseLines=function($J){var $o=this.wordWrap||this.overflow==$Y.HIDDEN;if($o)var $r=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $S=$P.contextMeasureText($Y._testWord);$L.isConchApp&&0===$S.width&&0===$S.height&&($S=$P.contextMeasureText("W")),this._charSize.width=$S.width,this._charSize.height=$S.height||this.fontSize}for(var $G=$J.replace(/\r\n/g,"\n").split("\n"),$z=0,$A=$G.length;$z<$A;$z++){var $h=$G[$z];$o?this.parseLine($h,$r):(this._lineWidths.push(this.getTextWidth($h)),this._lines.push($h))}},$J.parseLine=function($J,$o){$d.context;var $r,$S=this._lines,$G=0,$z=NaN,$A=NaN,$h=0;if(($z=this.getTextWidth($J))<=$o)return $S.push($J),void this._lineWidths.push($z);$z=this._charSize.width,0==($G=Math.floor($o/$z))&&($G=1),$A=$z=this.getTextWidth($J.substring(0,$G));for(var $Z=$G,$u=$J.length;$Z<$u;$Z++)if($o<($A+=$z=this.getTextWidth($J.charAt($Z))))if(this.wordWrap){var $B=$J.substring($h,$Z);if($B.charCodeAt($B.length-1)<255?($r=/(?:\w|-)+$/.exec($B))&&($Z=$r.index+$h,0==$r.index?$Z+=$B.length:$B=$J.substring($h,$Z)):$Y.RightToLeft&&($r=/([\u0600-\u06FF])+$/.exec($B))&&($Z=$r.index+$h,0==$r.index?$Z+=$B.length:$B=$J.substring($h,$Z)),$S.push($B),this._lineWidths.push($A-$z),!(($h=$Z)+$G<$u)){$S.push($J.substring($h,$u)),this._lineWidths.push(this.getTextWidth($S[$S.length-1])),$h=-1;break}$Z+=$G,$A=$z=this.getTextWidth($J.substring($h,$Z)),$Z--}else if(this.overflow==$Y.HIDDEN)return $S.push($J.substring(0,$Z)),void this._lineWidths.push(this.getTextWidth($S[$S.length-1]));this.wordWrap&&-1!=$h&&($S.push($J.substring($h,$u)),this._lineWidths.push(this.getTextWidth($S[$S.length-1])))},$J.getTextWidth=function($J){return this._currBitmapFont?this._currBitmapFont.getTextWidth($J):$P.contextMeasureText($J).width},$J.getWordWrapWidth=function(){var $J=this.padding,$o=NaN;return($o=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($o=this.wordWrap?100:$d.width),$o<=0&&($o=100),$o-$J[3]-$J[1]},$J.getCharPoint=function($J,$o){this._isChanged&&$y.timer.runCallLater(this,this.typeset);for(var $r=0,$S=this._lines,$G=0,$z=0,$A=$S.length;$z<$A;$z++){if($J<($r+=$S[$z].length)){var $h=$z;break}$G=$r}var $Z=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$d.context.font=$Z;var $u=this.getTextWidth(this._text.substring($G,$J));return($o||new $g).setTo(this._startX+$u-(this._clipPoint?this._clipPoint.x:0),this._startY+$h*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$B(0,$J,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($J){$J!=this._width&&($y.superSet($vJ,this,"width",$J),this.isChanged=!0)}),$B(0,$J,"textWidth",function(){return this._isChanged&&$y.timer.runCallLater(this,this.typeset),this._textWidth}),$B(0,$J,"height",function(){return this._height?this._height:this.textHeight},function($J){$J!=this._height&&($y.superSet($vJ,this,"height",$J),this.isChanged=!0)}),$B(0,$J,"textHeight",function(){return this._isChanged&&$y.timer.runCallLater(this,this.typeset),this._textHeight}),$B(0,$J,"padding",function(){return this._getCSSStyle().padding},function($J){this._getCSSStyle().padding=$J,this.isChanged=!0}),$B(0,$J,"bold",function(){return this._getCSSStyle().bold},function($J){this._getCSSStyle().bold=$J,this.isChanged=!0}),$B(0,$J,"text",function(){return this._text||""},function($J){this._text!==$J&&(this.lang($J+""),this.isChanged=!0,this.event("change"))}),$B(0,$J,"color",function(){return this._getCSSStyle().color},function($J){this._getCSSStyle().color!=$J&&(this._getCSSStyle().color=$J,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$B(0,$J,"font",function(){return this._getCSSStyle().fontFamily},function($J){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$Y._bitmapFonts&&$Y._bitmapFonts[$J]&&(this._currBitmapFont=$Y._bitmapFonts[$J]),this._getCSSStyle().fontFamily=$J,this.isChanged=!0}),$B(0,$J,"fontSize",function(){return this._getCSSStyle().fontSize},function($J){this._getCSSStyle().fontSize=$J,this.isChanged=!0}),$B(0,$J,"italic",function(){return this._getCSSStyle().italic},function($J){this._getCSSStyle().italic=$J,this.isChanged=!0}),$B(0,$J,"align",function(){return this._getCSSStyle().align},function($J){this._getCSSStyle().align=$J,this.isChanged=!0}),$B(0,$J,"valign",function(){return this._getCSSStyle().valign},function($J){this._getCSSStyle().valign=$J,this.isChanged=!0}),$B(0,$J,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($J){this._getCSSStyle().wordWrap=$J,this.isChanged=!0}),$B(0,$J,"leading",function(){return this._getCSSStyle().leading},function($J){this._getCSSStyle().leading=$J,this.isChanged=!0}),$B(0,$J,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($J){this._getCSSStyle().backgroundColor=$J,this.isChanged=!0}),$B(0,$J,"borderColor",function(){return this._getCSSStyle().borderColor},function($J){this._getCSSStyle().borderColor=$J,this.isChanged=!0}),$B(0,$J,"stroke",function(){return this._getCSSStyle().stroke},function($J){this._getCSSStyle().stroke=$J,this.isChanged=!0}),$B(0,$J,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($J){this._getCSSStyle().strokeColor=$J,this.isChanged=!0}),$B(0,$J,"isChanged",null,function($J){this._isChanged!==$J&&(this._isChanged=$J)&&$y.timer.callLater(this,this.typeset)}),$B(0,$J,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($J){if(!(this.overflow!=$Y.SCROLL||this.textWidth<this._width)&&this._clipPoint){$J=$J<this.padding[3]?this.padding[3]:$J;var $o=this._textWidth-this._width;$J=$o<$J?$o:$J;var $r=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$J,this.renderText(this._lastVisibleLineIndex,$r)}}),$B(0,$J,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($J){if(!(this.overflow!=$Y.SCROLL||this.textHeight<this._height)&&this._clipPoint){$J=$J<this.padding[0]?this.padding[0]:$J;var $o=this._textHeight-this._height,$r=($J=$o<$J?$o:$J)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$r;var $S=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$J,this.renderText($r,$S)}}),$B(0,$J,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$B(0,$J,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$B(0,$J,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$B(0,$J,"underlineColor",function(){return this._underlineColor},function($J){this._underlineColor=$J,this._isChanged=!0,this.typeset()}),$Y.registerBitmapFont=function($J,$o){$Y._bitmapFonts||($Y._bitmapFonts={}),$Y._bitmapFonts[$J]=$o},$Y.unregisterBitmapFont=function($J,$o){if(void 0===$o&&($o=!0),$Y._bitmapFonts&&$Y._bitmapFonts[$J]){var $r=$Y._bitmapFonts[$J];$o&&$r.destroy(),delete $Y._bitmapFonts[$J]}},$Y.setTextRightToLeft=function(){var $J;($J=$d.canvas.source.style).display="none",$J.position="absolute",$J.direction="rtl",$L._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$d.document.body.appendChild($d.canvas.source)},$Y.supportFont=function($J){$d.context.font="10px sans-serif";var $o=$P.contextMeasureText("abcji").width;$d.context.font="10px "+$J;var $r=$P.contextMeasureText("abcji").width;return console.log($o,$r),$o!==$r},$Y._testWord="游",$Y.langPacks=null,$Y.VISIBLE="visible",$Y.SCROLL="scroll",$Y.HIDDEN="hidden",$Y.CharacterCache=!0,$Y.RightToLeft=!1,$Y._bitmapFonts=null,$Z($Y,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$Y}($vJ),$wJ=function($v){function $A(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$A.__super.call(this),this.offset=new $g,this._canvasTransform=new $n,this._previousOrientation=$d.window.orientation;var $o=this;this.transform=$n.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $J=$d.window,$r=this;$J.addEventListener("focus",function(){$o._isFocused=!0,$r.event("focus"),$r.event("focuschange")}),$J.addEventListener("blur",function(){$o._isFocused=!1,$r.event("blur"),$r.event("focuschange"),$r._isInputting()&&($KJ.inputElement.target.focus=!1)});var $S="visibilityState",$G="visibilitychange",$z=$J.document;void 0!==$z.hidden?($G="visibilitychange",$S="visibilityState"):void 0!==$z.mozHidden?($G="mozvisibilitychange",$S="mozVisibilityState"):void 0!==$z.msHidden?($G="msvisibilitychange",$S="msVisibilityState"):void 0!==$z.webkitHidden&&($G="webkitvisibilitychange",$S="webkitVisibilityState"),$J.document.addEventListener($G,function(){"hidden"==$d.document[$S]?$r._setStageVisible(!1):$r._setStageVisible(!0)}),$J.document.addEventListener("qbrowserVisibilityChange",function($J){$r._setStageVisible(!$J.hidden)}),$J.addEventListener("resize",function(){var $J=$d.window.orientation;null!=$J&&$J!=$o._previousOrientation&&$r._isInputting()&&($KJ.inputElement.target.focus=!1),$o._previousOrientation=$J,$r._isInputting()||$r._resetCanvas()}),$J.addEventListener("orientationchange",function($J){$r._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$d.onMobile&&this.on("mousedown",this,this._onmouseMove)}$D($A,"laya.display.Stage",$v);var $J=$A.prototype;return $J._setStageVisible=function($J){this._isVisibility!=$J&&(this._isVisibility=$J,this._isVisibility||this._isInputting()&&($KJ.inputElement.target.focus=!1),this.event("visibilitychange"))},$J._isInputting=function(){return $d.onMobile&&$KJ.isInputting},$J._changeCanvasSize=function(){this.setScreenSize($d.clientWidth*$d.pixelRatio,$d.clientHeight*$d.pixelRatio)},$J._resetCanvas=function(){if(this.screenAdaptationEnabled){var $J=$L._mainCanvas;$J.source.style;$J.size(1,1),$y.timer.once(100,this,this._changeCanvasSize)}},$J.setScreenSize=function($J,$o){var $r=!1;if("none"!==this._screenMode&&($r=($J/$o<1?"vertical":"horizontal")!==this._screenMode)){var $S=$o;$o=$J,$J=$S}this.canvasRotation=$r;var $G=$L._mainCanvas,$z=$G.source.style,$A=this._canvasTransform.identity(),$h=this._scaleMode,$Z=$J/this.designWidth,$u=$o/this.designHeight,$B=this.designWidth,$v=this.designHeight,$j=$J,$Y=$o,$_=$d.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$h){case"noscale":$Z=$u=1,$j=this.designWidth,$Y=this.designHeight;break;case"showall":$Z=$u=Math.min($Z,$u),$B=$j=Math.round(this.designWidth*$Z),$v=$Y=Math.round(this.designHeight*$u);break;case"noborder":$Z=$u=Math.max($Z,$u),$j=Math.round(this.designWidth*$Z),$Y=Math.round(this.designHeight*$u);break;case"full":$Z=$u=1,this._width=$B=$J,this._height=$v=$o;break;case"fixedwidth":$u=$Z,this._height=$v=Math.round($o/$Z);break;case"fixedheight":$Z=$u,this._width=$B=Math.round($J/$u);break;case"fixedauto":$J/$o<this.designWidth/this.designHeight?($u=$Z,this._height=$v=Math.round($o/$Z)):($Z=$u,this._width=$B=Math.round($J/$u))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$B=$B+1&2147483646,$v=$v+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$Z*=this.scaleX,$u*=this.scaleY,1===$Z&&1===$u?this.transform.identity():(this.transform.a=this._formatData($Z/($j/$B)),this.transform.d=this._formatData($u/($Y/$v)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$G.size($B,$v),$R.changeWebGLSize($B,$v),$A.scale($j/$B/$_,$Y/$v/$_),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($J-$j)/$_:this.offset.x=.5*($J-$j)/$_,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($o-$Y)/$_:this.offset.y=.5*($o-$Y)/$_,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$A.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$r&&("horizontal"===this._screenMode?($A.rotate(Math.PI/2),$A.translate($o/$_,0),this.canvasDegree=90):($A.rotate(-Math.PI/2),$A.translate(0,$J/$_),this.canvasDegree=-90)),$A.a=this._formatData($A.a),$A.d=this._formatData($A.d),$A.tx=this._formatData($A.tx),$A.ty=this._formatData($A.ty),$z.transformOrigin=$z.webkitTransformOrigin=$z.msTransformOrigin=$z.mozTransformOrigin=$z.oTransformOrigin="0px 0px 0px",$z.transform=$z.webkitTransform=$z.msTransform=$z.mozTransform=$z.oTransform="matrix("+$A.toString()+")",$A.translate(parseInt($z.left)||0,parseInt($z.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$J._formatData=function($J){return Math.abs($J)<1e-6?0:Math.abs(1-$J)<.001?0<$J?1:-1:$J},$J.getMousePoint=function(){return $g.TEMP.setTo(this.mouseX,this.mouseY)},$J.repaint=function(){this._repaint=1},$J.parentRepaint=function(){},$J._loop=function(){return this.render($L.context,0,0),!0},$J._onmouseMove=function($J){this._mouseMoveTime=$d.now()},$J.getTimeFromFrameStart=function(){return $d.now()-this._frameStartTime},$J.render=function($J,$o,$r){if("sleep"===this._frameRate&&!$L.isConchApp){var $S=$d.now();if(!(1e3<=$S-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($x.loopCount++,$_.instance.runEvent(),$y.timer._update()));this._frameStartTime=$S}if(this._renderCount++,$L.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$d.now();var $G="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$z=this._renderCount%2==0;if($x.renderSlow=!$G,$G||$z||$L.isConchApp){var $A;$x.loopCount++,$_.instance.runEvent(),$y.timer._update(),$R.update3DLoop();var $h=0,$Z=0;if($L.isConchNode)for($h=0,$Z=this._scenes.length;$h<$Z;$h++)($A=this._scenes[$h])&&$A._updateSceneConch();else for($h=0,$Z=this._scenes.length;$h<$Z;$h++)($A=this._scenes[$h])&&$A._updateScene();if($L.isConchNode){var $u=$vJ.CustomList;for($h=0,$Z=$u.length;$h<$Z;$h++){var $B=$u[$h];$B.customRender($B.customContext,0,0)}return}}$L.isConchNode||this.renderingEnabled&&($G||!$z||$L.isConchWebGL)&&($L.isWebGL?$L.WebGL.mainContext&&!$L.WebGL.mainContext.isContextLost()&&($J.clear(),$v.prototype.render.call(this,$J,$o,$r),$x._show&&$x._sp&&$x._sp.render($J,$o,$r),$R.clear(this._bgColor),$R.beginFlush(),$J.flush(),$R.endFinish(),$W.instance&&$W.getInstance().endDispose()):($R.clear(this._bgColor),$v.prototype.render.call(this,$J,$o,$r),$x._show&&$x._sp&&$x._sp.render($J,$o,$r)))}else this._renderCount%5==0&&($x.loopCount++,$_.instance.runEvent(),$y.timer._update())},$J._requestFullscreen=function(){var $J=$d.document.documentElement;$J.requestFullscreen?$J.requestFullscreen():$J.mozRequestFullScreen?$J.mozRequestFullScreen():$J.webkitRequestFullscreen?$J.webkitRequestFullscreen():$J.msRequestFullscreen&&$J.msRequestFullscreen()},$J._fullScreenChanged=function(){$y.stage.event("fullscreenchange")},$J.exitFullscreen=function(){var $J=$d.document;$J.exitFullscreen?$J.exitFullscreen():$J.mozCancelFullScreen?$J.mozCancelFullScreen():$J.webkitExitFullscreen&&$J.webkitExitFullscreen()},$B(0,$J,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$B(0,$J,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$B(0,$J,"frameRate",function(){return this._frameRate},function($J){if(this._frameRate=$J,$L.isConchApp)switch(this._frameRate){case"slow":$d.window.conch&&$d.window.conchConfig.setSlowFrame&&$d.window.conchConfig.setSlowFrame(!0);break;case"fast":$d.window.conch&&$d.window.conchConfig.setSlowFrame&&$d.window.conchConfig.setSlowFrame(!1);break;case"mouse":$d.window.conch&&$d.window.conchConfig.setMouseFrame&&$d.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$d.window.conch&&$d.window.conchConfig.setLimitFPS&&$d.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$B(0,$J,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$B(0,$J,"width",$v.prototype._$get_width,function($J){this.designWidth=$J,$y.superSet($vJ,this,"width",$J),$y.timer.callLater(this,this._changeCanvasSize)}),$B(0,$J,"alignH",function(){return this._alignH},function($J){this._alignH=$J,$y.timer.callLater(this,this._changeCanvasSize)}),$B(0,$J,"isFocused",function(){return this._isFocused}),$B(0,$J,"height",$v.prototype._$get_height,function($J){this.designHeight=$J,$y.superSet($vJ,this,"height",$J),$y.timer.callLater(this,this._changeCanvasSize)}),$B(0,$J,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$n.create()},$v.prototype._$set_transform),$B(0,$J,"isVisibility",function(){return this._isVisibility}),$B(0,$J,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$B(0,$J,"scaleMode",function(){return this._scaleMode},function($J){this._scaleMode=$J,$y.timer.callLater(this,this._changeCanvasSize)}),$B(0,$J,"alignV",function(){return this._alignV},function($J){this._alignV=$J,$y.timer.callLater(this,this._changeCanvasSize)}),$B(0,$J,"bgColor",function(){return this._bgColor},function($J){this._bgColor=$J,this.conchModel&&this.conchModel.bgColor($J),$L.isWebGL&&($J?$A._wgColor=$b.create($J)._color:$d.onMiniGame||($A._wgColor=null)),$d.onLimixiu?$A._wgColor=$b.create($J)._color:$L.canvas.style.background=$J||"none"}),$B(0,$J,"mouseX",function(){return Math.round($_.instance.mouseX/this.clientScaleX)}),$B(0,$J,"mouseY",function(){return Math.round($_.instance.mouseY/this.clientScaleY)}),$B(0,$J,"screenMode",function(){return this._screenMode},function($J){this._screenMode=$J}),$B(0,$J,"visible",$v.prototype._$get_visible,function($J){this.visible!==$J&&($y.superSet($vJ,this,"visible",$J),$L._mainCanvas.source.style.visibility=$J?"visible":"hidden")}),$B(0,$J,"fullScreenEnabled",null,function($J){var $o=$d.document,$r=$L.canvas;$J?($r.addEventListener("mousedown",this._requestFullscreen),$r.addEventListener("touchstart",this._requestFullscreen),$o.addEventListener("fullscreenchange",this._fullScreenChanged),$o.addEventListener("mozfullscreenchange",this._fullScreenChanged),$o.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$o.addEventListener("msfullscreenchange",this._fullScreenChanged)):($r.removeEventListener("mousedown",this._requestFullscreen),$r.removeEventListener("touchstart",this._requestFullscreen),$o.removeEventListener("fullscreenchange",this._fullScreenChanged),$o.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$o.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$o.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$A.SCALE_NOSCALE="noscale",$A.SCALE_EXACTFIT="exactfit",$A.SCALE_SHOWALL="showall",$A.SCALE_NOBORDER="noborder",$A.SCALE_FULL="full",$A.SCALE_FIXED_WIDTH="fixedwidth",$A.SCALE_FIXED_HEIGHT="fixedheight",$A.SCALE_FIXED_AUTO="fixedauto",$A.ALIGN_LEFT="left",$A.ALIGN_RIGHT="right",$A.ALIGN_CENTER="center",$A.ALIGN_TOP="top",$A.ALIGN_MIDDLE="middle",$A.ALIGN_BOTTOM="bottom",$A.SCREEN_NONE="none",$A.SCREEN_HORIZONTAL="horizontal",$A.SCREEN_VERTICAL="vertical",$A.FRAME_FAST="fast",$A.FRAME_SLOW="slow",$A.FRAME_MOUSE="mouse",$A.FRAME_SLEEP="sleep",$A.FRAME_MOUSE_THREDHOLD=2e3,$Z($A,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$A}($vJ),$iJ=(function($J){function $o(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$o.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$D($o,"laya.media.SoundNode",$vJ);var $r=$o.prototype;$r._onParentChange=function(){this.target=this.parent},$r.play=function($J,$o){void 0===$J&&($J=1),isNaN($J)&&($J=1),this.url&&(this.stop(),this._channel=$C.playSound(this.url,$J,null,$o))},$r.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$r._setPlayAction=function($J,$o,$r,$S){void 0===$S&&($S=!0),this[$r]&&$J&&($S?$J.on($o,this,this[$r]):$J.off($o,this,this[$r]))},$r._setPlayActions=function($J,$o,$r,$S){if(void 0===$S&&($S=!0),$J&&$o){var $G,$z=$o.split(","),$A=0;for($G=$z.length,$A=0;$A<$G;$A++)this._setPlayAction($J,$z[$A],$r,$S)}},$B(0,$r,"playEvent",null,function($J){(this._playEvents=$J)&&this._tar&&this._setPlayActions(this._tar,$J,"play")}),$B(0,$r,"target",null,function($J){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$J,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$B(0,$r,"stopEvent",null,function($J){(this._stopEvents=$J)&&this._tar&&this._setPlayActions(this._tar,$J,"stop")})}(),function($J){function $o(){this._src=null,this._onload=null,this._onerror=null,$o.__super.call(this)}$D($o,"laya.resource.FileBitmap",$_J);var $r=$o.prototype;return $B(0,$r,"src",function(){return this._src},function($J){this._src=$J}),$B(0,$r,"onload",null,function($J){}),$B(0,$r,"onerror",null,function($J){}),$o}()),$IJ=function($J){function $r($J,$o){this._is2D=!1,$r.__super.call(this);var $S=this;if(this._source=this,"2D"===$J||"AUTO"===$J&&!$L.isWebGL){this._is2D=!0,this._source=$o||$d.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $G=this;$G.getContext=function($J,$o){if($S._ctx)return $S._ctx;var $r=$S._ctx=$S._source.getContext($J,$o);return $r&&($r._canvas=$G,$L.isFlash||$d.onLimixiu||($r.size=function($J,$o){})),$r}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$D($r,"laya.resource.HTMLCanvas",$_J);var $o=$r.prototype;return $o.clear=function(){this._ctx&&this._ctx.clear()},$o.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$o.release=function(){},$o._setContext=function($J){this._ctx=$J},$o.getContext=function($J,$o){return this._ctx?this._ctx:this._ctx=$r._createContext(this)},$o.getMemSize=function(){return 0},$o.size=function($J,$o){(this._w!=$J||this._h!=$o||this._source&&(this._source.width!=$J||this._source.height!=$o))&&(this._w=$J,this._h=$o,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($J,$o),this._source&&(this._source.height=$o,this._source.width=$J))},$o.getCanvas=function(){return this._source},$o.toBase64=function($J,$o,$r){if(this._source)if($L.isConchApp&&this._source.toBase64)this._source.toBase64($J,$o,$r);else{var $S=this._source.toDataURL($J,$o);$r.call(this,$S)}},$B(0,$o,"context",function(){return this._ctx}),$B(0,$o,"asBitmap",null,function($J){}),$r.create=function($J,$o){return new $r($J,$o)},$r.TYPE2D="2D",$r.TYPE3D="3D",$r.TYPEAUTO="AUTO",$r._createContext=null,$r}(),$tJ=(function($J){function $Z($J,$o,$r,$S,$G,$z,$A,$h){throw $Z.__super.call(this),new Error("不允许new！")}$D($Z,"laya.resource.HTMLSubImage",$_J),$Z.create=function($J,$o,$r,$S,$G,$z,$A,$h){return void 0===$h&&($h=!1),new $Z($J,$o,$r,$S,$G,$z,$A,$h)}}(),function($J){function $v(){this._frames=null,this._url=null,$v.__super.call(this),this._setControlNode(this)}$D($v,"laya.display.Animation",$J);var $o=$v.prototype;$o.destroy=function($J){void 0===$J&&($J=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$J),this._frames=null,this._labels=null},$o.play=function($J,$o,$r,$S){void 0===$J&&($J=0),void 0===$o&&($o=!0),void 0===$r&&($r=""),void 0===$S&&($S=!0),$r&&this._setFramesFromCache($r,$S),this._isPlaying=!0,this.index="string"==typeof $J?this._getFrameByLabel($J):$J,this.loop=$o,this._actionName=$r,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$o._setFramesFromCache=function($J,$o){var $r;return void 0===$o&&($o=!1),this._url&&($J=this._url+"#"+$J),$J&&$v.framesMap[$J]?(($r=$v.framesMap[$J])instanceof Array?(this._frames=$v.framesMap[$J],this._count=this._frames.length):($r.nodeRoot&&($v.framesMap[$J]=this._parseGraphicAnimationByData($r),$r=$v.framesMap[$J]),this._frames=$r.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$r.interval),this._labels=this._copyLabels($r.labels)),!0):($o&&console.log("ani not found:",$J),!1)},$o._copyLabels=function($J){if(!$J)return null;var $o,$r;for($r in $o={},$J)$o[$r]=$P.copyArray([],$J[$r]);return $o},$o._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$J.prototype._frameLoop.call(this)},$o._displayToIndex=function($J){this._frames&&(this.graphics=this._frames[$J])},$o.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$o.loadImages=function($J,$o){return void 0===$o&&($o=""),this._url="",this._setFramesFromCache($o)||(this.frames=$v.framesMap[$o]?$v.framesMap[$o]:$v.createFrames($J,$o)),this},$o.loadAtlas=function($o,$r,$S){void 0===$S&&($S=""),this._url="";var $G=this;function $J($J){$o===$J&&($G.frames=$v.framesMap[$S]?$v.framesMap[$S]:$v.createFrames($o,$S),$r&&$r.run())}return $G._setFramesFromCache($S)||($hJ.getAtlas($o)?$J($o):$y.loader.load($o,$i.create(null,$J,[$o]),null,"atlas")),this},$o.loadAnimation=function($J,$o,$r){this._url=$J;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$o&&$o.run()):!$r||$hJ.getAtlas($r)?this._loadAnimationData($J,$o,$r):$y.loader.load($r,$i.create(this,this._loadAnimationData,[$J,$o,$r]),null,"atlas"),this},$o._loadAnimationData=function($h,$Z,$J){var $u=this;if(!$J||$hJ.getAtlas($J)){var $B=this;$hJ.getRes($h)?$o($h):$y.loader.load($h,$i.create(null,$o,[$h]),null,"json"),$hJ.clearRes($h)}else console.warn("atlas load fail:"+$J);function $o($J){if($hJ.getRes($J)&&$h===$J){var $o;if($v.framesMap[$h+"#"])$B._setFramesFromCache($u._actionName,!0),$u.index=0,$u._checkResumePlaying();else{var $r=$B._parseGraphicAnimation($hJ.getRes($h));if(!$r)return;var $S,$G=$r.animationList,$z=0,$A=$G.length;for($z=0;$z<$A;$z++)$o=$G[$z],$v.framesMap[$h+"#"+$o.name]=$o,$S||($S=$o);$S&&($v.framesMap[$h+"#"]=$S,$B._setFramesFromCache($u._actionName,!0),$u.index=0),$u._checkResumePlaying()}$Z&&$Z.run()}}},$o._parseGraphicAnimation=function($J){return $yJ.parseAnimationData($J)},$o._parseGraphicAnimationByData=function($J){return $yJ.parseAnimationByData($J)},$B(0,$o,"frames",function(){return this._frames},function($J){(this._frames=$J)&&(this._count=$J.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$B(0,$o,"autoPlay",null,function($J){$J?this.play():this.stop()}),$B(0,$o,"source",null,function($J){-1<$J.indexOf(".ani")?this.loadAnimation($J):-1<$J.indexOf(".json")||-1<$J.indexOf("als")||-1<$J.indexOf("atlas")?this.loadAtlas($J):this.loadImages($J.split(","))}),$B(0,$o,"autoAnimation",null,function($J){this.play(0,!0,$J,!1)}),$v.createFrames=function($J,$o){var $r,$S,$G=0,$z=0;if("string"==typeof $J){var $A=$hJ.getAtlas($J);if($A&&$A.length)for($r=[],$G=0,$z=$A.length;$G<$z;$G++)($S=new $R.createGraphics).drawTexture($hJ.getRes($A[$G]),0,0),$r.push($S)}else if($J instanceof Array)for($r=[],$G=0,$z=$J.length;$G<$z;$G++)($S=new $R.createGraphics).loadImage($J[$G],0,0),$r.push($S);return $o&&($v.framesMap[$o]=$r),$r},$v.clearCache=function($J){var $o,$r=$v.framesMap,$S=$J+"#";for($o in $r)$o!==$J&&0!=$o.indexOf($S)||delete $v.framesMap[$o]},$v.framesMap={}}($DJ),function($J){function $z(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$z.__super.call(this),null==$z._sortIndexFun&&($z._sortIndexFun=$e.sortByKey("index",!1,!0))}$D($z,"laya.display.FrameAnimation",$J);var $o=$z.prototype;return $o._setUp=function($J,$o){this._labels=null,this._animationNewFrames=null,this._targetDic=$J,this._animationData=$o,this.interval=1e3/$o.frameRate,$o.parsed?(this._count=$o.count,this._labels=$o.labels,this._animationNewFrames=$o.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$o.parsed=!0,$o.labels=this._labels,$o.count=this._count,$o.animationNewFrames=this._animationNewFrames},$o.clear=function(){$J.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$o._displayToIndex=function($J){if(this._animationData){$J<0&&($J=0),$J>this._count&&($J=this._count);var $o=this._animationData.nodes,$r=0,$S=$o.length;for($r=0;$r<$S;$r++)this._displayNodeToFrame($o[$r],$J)}},$o._displayNodeToFrame=function($J,$o,$r){$r||($r=this._targetDic);var $S=$r[$J.target];if($S){var $G,$z,$A,$h=$J.frames,$Z=$J.keys,$u=0,$B=$Z.length;for($u=0;$u<$B;$u++)$A=($z=$h[$G=$Z[$u]]).length>$o?$z[$o]:$z[$z.length-1],$S[$G]=$A}},$o._calculateDatas=function(){if(this._animationData){var $J,$o=this._animationData.nodes,$r=0,$S=$o.length;for($r=this._count=0;$r<$S;$r++)$J=$o[$r],this._calculateNodeKeyFrames($J);this._count+=1}},$o._calculateNodeKeyFrames=function($J){var $o,$r,$S=$J.keyframes,$G=$J.target;for($o in $J.frames||($J.frames={}),$J.keys?$J.keys.length=0:$J.keys=[],$J.initValues||($J.initValues={}),$S)$r=$S[$o],$J.frames[$o]||($J.frames[$o]=[]),this._targetDic&&this._targetDic[$G]&&($J.initValues[$o]=this._targetDic[$G][$o]),$r.sort($z._sortIndexFun),$J.keys.push($o),this._calculateNodePropFrames($r,$J.frames[$o],$o,$G)},$o.resetToInitState=function(){if(this._targetDic&&this._animationData){var $J,$o,$r=this._animationData.nodes,$S=0,$G=$r.length;for($S=0;$S<$G;$S++)if($o=($J=$r[$S]).initValues){var $z,$A=this._targetDic[$J.target];if($A)for($z in $o)$A[$z]=$o[$z]}}},$o._calculateNodePropFrames=function($J,$o,$r,$S){var $G=0,$z=$J.length-1;if(0<$z){for($o.length=$J[$z].index+1,$G=0;$G<$z;$G++)this._dealKeyFrame($J[$G]),this._calculateFrameValues($J[$G],$J[$G+1],$o);this._dealKeyFrame($J[$G])}0==$z&&($o[$J[0].index]=$J[0].value,this._animationNewFrames&&(this._animationNewFrames[$J[0].index]=!0))},$o._dealKeyFrame=function($J){$J.label&&""!=$J.label&&this.addLabel($J.label,$J.index)},$o._calculateFrameValues=function($J,$o,$r){var $S,$G=0,$z=$J.index,$A=$o.index,$h=$J.value,$Z=$o.value-$J.value,$u=$A-$z;if($A>this._count&&(this._count=$A),$J.tween)for(null==($S=$q[$J.tweenMethod])&&($S=$q.linearNone),$G=$z;$G<$A;$G++)$r[$G]=$S($G-$z,$h,$Z,$u),this._animationNewFrames&&(this._animationNewFrames[$G]=!0);else for($G=$z;$G<$A;$G++)$r[$G]=$h;this._animationNewFrames&&(this._animationNewFrames[$J.index]=!0,this._animationNewFrames[$o.index]=!0),$r[$o.index]=$o.value},$z._sortIndexFun=null,$z}($DJ)),$KJ=function($o){function $G(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$G.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$NJ.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$D($G,"laya.display.Input",$o);var $J=$G.prototype;return $J.setSelection=function($J,$o){this.focus=!0,laya.display.Input.inputElement.selectionStart=$J,laya.display.Input.inputElement.selectionEnd=$o},$J._onUnDisplay=function($J){this.focus=!1},$J._onMouseDown=function($J){this.focus=!0},$J._syncInputTransform=function(){var $J=this.nativeInput,$o=$P.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$r=this._width-this.padding[1]-this.padding[3],$S=this._height-this.padding[0]-this.padding[2];$L.isConchApp?($J.setScale($o.scaleX,$o.scaleY),$J.setSize($r,$S),$J.setPos($o.x,$o.y)):($G.inputContainer.style.transform=$G.inputContainer.style.webkitTransform="scale("+$o.scaleX+","+$o.scaleY+") rotate("+$y.stage.canvasDegree+"deg)",$J.style.width=$r+"px",$J.style.height=$S+"px",$G.inputContainer.style.left=$o.x+"px",$G.inputContainer.style.top=$o.y+"px")},$J.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$J._setInputMethod=function(){$G.input.parentElement&&$G.inputContainer.removeChild($G.input),$G.area.parentElement&&$G.inputContainer.removeChild($G.area),$G.inputElement=this._multiline?$G.area:$G.input,$G.inputContainer.appendChild($G.inputElement),$NJ.RightToLeft&&($G.inputElement.style.direction="rtl")},$J._focusIn=function(){laya.display.Input.isInputting=!0;var $J=this.nativeInput;this._focus=!0;var $o=$J.style;$o.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$J.readOnly=!this._editable,$L.isConchApp&&($J.setType(this._type),$J.setForbidEdit(!this._editable)),$J.maxLength=this._maxChars;this.padding;if($J.type=this._type,$J.value=this._content,$J.placeholder=this._prompt,$y.stage.off("keydown",this,this._onKeyDown),$y.stage.on("keydown",this,this._onKeyDown),($y.stage.focus=this).event("focus"),$d.onPC&&$J.focus(),!$d.onMiniGame){this._text;this._text=null}this.typeset(),$J.setColor(this._originColor),$J.setFontSize(this.fontSize),$J.setFontFace($d.onIPhone&&$NJ._fontFamilyMap[this.font]||this.font),$L.isConchApp&&$J.setMultiAble&&$J.setMultiAble(this._multiline),$o.lineHeight=this.leading+this.fontSize+"px",$o.fontStyle=this.italic?"italic":"normal",$o.fontWeight=this.bold?"bold":"normal",$o.textAlign=this.align,$o.padding="0 0",this._syncInputTransform(),!$L.isConchApp&&$d.onPC&&$y.timer.frameLoop(1,this,this._syncInputTransform)},$J._setPromptColor=function(){($G.promptStyleDOM=$d.getElementById("promptStyle"))||(($G.promptStyleDOM=$d.createElement("style")).setAttribute("id","promptStyle"),$d.document.head.appendChild($G.promptStyleDOM)),$G.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$J._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($y.superSet($NJ,this,"text",this._content),$y.superSet($NJ,this,"color",this._originColor)):($y.superSet($NJ,this,"text",this._prompt),$y.superSet($NJ,this,"color",this._promptColor)),$y.stage.off("keydown",this,this._onKeyDown),$y.stage.focus=null,this.event("blur"),$L.isConchApp&&this.nativeInput.blur(),$d.onPC&&$y.timer.clear(this,this._syncInputTransform)},$J._onKeyDown=function($J){13===$J.keyCode&&($d.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$J.changeText=function($J){this._content=$J,this._focus?(this.nativeInput.value=$J||"",this.event("change")):$o.prototype.changeText.call(this,$J)},$B(0,$J,"color",$o.prototype._$get_color,function($J){this._focus&&this.nativeInput.setColor($J),$y.superSet($NJ,this,"color",this._content?$J:this._promptColor),this._originColor=$J}),$B(0,$J,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($J){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$B(0,$J,"multiline",function(){return this._multiline},function($J){this._multiline=$J,this.valign=$J?"top":"middle"}),$B(0,$J,"maxChars",function(){return this._maxChars},function($J){$J<=0&&($J=1e5),this._maxChars=$J}),$B(0,$J,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($J){$y.superSet($NJ,this,"color",this._originColor),$J+="",this._focus?(this.nativeInput.value=$J||"",this.event("change")):(this._multiline||($J=$J.replace(/\r?\n/g,"")),(this._content=$J)?$y.superSet($NJ,this,"text",$J):($y.superSet($NJ,this,"text",this._prompt),$y.superSet($NJ,this,"color",this.promptColor)))}),$B(0,$J,"nativeInput",function(){return this._multiline?$G.area:$G.input}),$B(0,$J,"prompt",function(){return this._prompt},function($J){!this._text&&$J&&$y.superSet($NJ,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$y.superSet($NJ,this,"text",this._text==this._prompt?$J:this._text):$y.superSet($NJ,this,"text",$J),this._prompt=$NJ.langPacks&&$NJ.langPacks[$J]?$NJ.langPacks[$J]:$J}),$B(0,$J,"focus",function(){return this._focus},function($J){var $o=this.nativeInput;this._focus!==$J&&($J?($o.target?$o.target._focusOut():this._setInputMethod(),($o.target=this)._focusIn()):($o.target=null,this._focusOut(),$d.document.body.scrollTop=0,$o.blur(),$L.isConchApp?$o.setPos(-1e4,-1e4):$G.inputContainer.contains($o)&&$G.inputContainer.removeChild($o)))}),$B(0,$J,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($J){$J?(-1<($J="[^"+$J+"]").indexOf("^^")&&($J=$J.replace("^^","")),this._restrictPattern=new RegExp($J,"g")):this._restrictPattern=null}),$B(0,$J,"editable",function(){return this._editable},function($J){this._editable=$J,$L.isConchApp&&$G.input.setForbidEdit(!$J)}),$B(0,$J,"promptColor",function(){return this._promptColor},function($J){this._promptColor=$J,this._content||$y.superSet($NJ,this,"color",$J)}),$B(0,$J,"type",function(){return this._type},function($J){this._getCSSStyle().password="password"==$J,this._type=$J,$L.isConchApp&&this.nativeInput.setType($J)}),$B(0,$J,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($J){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$B(0,$J,"asPassword",function(){return this._getCSSStyle().password},function($J){this._getCSSStyle().password=$J,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$G.__init__=function(){$G._createInputElement(),$d.onMobile&&$L.canvas.addEventListener($G.IOS_IFRAME?$d.onMiniGame?"touchend":"click":"touchend",$G._popupInputMethod)},$G._popupInputMethod=function($J){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$G._createInputElement=function(){$G._initInput($G.area=$d.createElement("textarea")),$G._initInput($G.input=$d.createElement("input")),($G.inputContainer=$d.createElement("div")).style.position="absolute",$G.inputContainer.style.zIndex=1e5,$d.container.appendChild($G.inputContainer),$G.inputContainer.setPos=function($J,$o){$G.inputContainer.style.left=$J+"px",$G.inputContainer.style.top=$o+"px"}},$G._initInput=function($o){var $J=$o.style;$J.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$J.resize="none",$J.backgroundColor="transparent",$J.border="none",$J.outline="none",$J.zIndex=1,$o.addEventListener("input",$G._processInputting),$o.addEventListener("mousemove",$G._stopEvent),$o.addEventListener("mousedown",$G._stopEvent),$o.addEventListener("touchmove",$G._stopEvent),$o.setFontFace=function($J){$o.style.fontFamily=$J},$L.isConchApp||($o.setColor=function($J){$o.style.color=$J},$o.setFontSize=function($J){$o.style.fontSize=$J+"px"})},$G._processInputting=function($J){var $o=laya.display.Input.inputElement.target;if($o){var $r=laya.display.Input.inputElement.value;$o._restrictPattern&&($r=$r.replace(/\u2006|\x27/g,""),$o._restrictPattern.test($r)&&($r=$r.replace($o._restrictPattern,""),laya.display.Input.inputElement.value=$r)),$o._text=$r,$o.event("input")}},$G._stopEvent=function($J){"touchmove"==$J.type&&$J.preventDefault(),$J.stopPropagation&&$J.stopPropagation()},$G.TYPE_TEXT="text",$G.TYPE_PASSWORD="password",$G.TYPE_EMAIL="email",$G.TYPE_URL="url",$G.TYPE_NUMBER="number",$G.TYPE_RANGE="range",$G.TYPE_DATE="date",$G.TYPE_MONTH="month",$G.TYPE_WEEK="week",$G.TYPE_TIME="time",$G.TYPE_DATE_TIME="datetime",$G.TYPE_DATE_TIME_LOCAL="datetime-local",$G.TYPE_SEARCH="search",$G.input=null,$G.area=null,$G.inputElement=null,$G.inputContainer=null,$G.confirmButton=null,$G.promptStyleDOM=null,$G.inputHeight=45,$G.isInputting=!1,$G.stageMatrix=null,$Z($G,["IOS_IFRAME",function(){return this.IOS_IFRAME=$d.onIOS&&$d.window.top!=$d.window.self}]),$G}($NJ),$eJ=function($J){function $r($J,$o){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$r.__super.call(this),$J&&this._init_($J,$o)}$D($r,"laya.resource.HTMLImage",$iJ);var $o=$r.prototype;return $o._init_=function($J,$o){this._src=$J,this._source=new $d.window.Image,$o&&($o.onload&&(this.onload=$o.onload),$o.onerror&&(this.onerror=$o.onerror),$o.onCreate&&$o.onCreate(this)),0!=$J.indexOf("data:image")&&(this._source.crossOrigin=""),$J&&(this._source.src=$J)},$o.recreateResource=function(){var $J=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $o=this;this._source=new $d.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($o._needReleaseAgain)return $o._needReleaseAgain=!1,$o._source.onload=null,void($o._source=null);$o._source.onload=null,$o.memorySize=$J._w*$J._h*4,$o._recreateLock=!1,$o.completeCreate()},this._source.src=this._src}},$o.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$o.onresize=function(){this._w=this._source.width,this._h=this._source.height},$B(0,$o,"onload",null,function($J){var $o=this;this._onload=$J,this._source&&(this._source.onload=null!=this._onload?function(){$o.onresize(),$o._onload()}:null)}),$B(0,$o,"onerror",null,function($J){var $o=this;this._onerror=$J,this._source&&(this._source.onerror=null!=this._onerror?function(){$o._onerror()}:null)}),$B(0,$o,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($J){this._enableMerageInAtlas=$J,$L.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$J)}),$r.create=function($J,$o){return new $r($J,$o)},$r}(),$yJ=(function($z){function $J(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$J.__super.call(this)}$D($J,"laya.display.EffectAnimation",$z);var $o=$J.prototype;$o._onOtherBegin=function($J){$J!=this&&this.stop()},$o.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$o._onPlayAction=function(){this.play(0,!1)},$o.play=function($J,$o,$r,$S){void 0===$J&&($J=0),void 0===$o&&($o=!0),void 0===$r&&($r=""),void 0===$S&&($S=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$J,$o,$r,$S))},$o._recordInitData=function(){if(this._aniKeys){var $J,$o,$r=0;for($J=this._aniKeys.length,$r=0;$r<$J;$r++)$o=this._aniKeys[$r],this._initData[$o]=this._target[$o]}},$o._displayToIndex=function($J){if(this._animationData){$J<0&&($J=0),$J>this._count&&($J=this._count);var $o=this._animationData.nodes,$r=0,$S=$o.length;for($S=1<$S?1:$S,$r=0;$r<$S;$r++)this._displayNodeToFrame($o[$r],$J)}},$o._displayNodeToFrame=function($J,$o,$r){if(this._target){var $S;$S=this._target;var $G,$z,$A,$h,$Z=$J.frames,$u=$J.keys,$B=0,$v=$u.length;$h=$J.secondFrames;var $j,$Y,$_,$D,$N=0;for($B=0;$B<$v;$B++)$z=$Z[$G=$u[$B]],$A=-1==($N=$h[$G])?this._initData[$G]:$o<$N?($_=($Y=$J.keyframes[$G])[0]).tween?(null==($j=$q[$_.tweenMethod])&&($j=$q.linearNone),$D=$Y[1],$j($o,this._initData[$G],$D.value-this._initData[$G],$D.index)):this._initData[$G]:$z.length>$o?$z[$o]:$z[$z.length-1],$S[$G]=$A}},$o._calculateNodeKeyFrames=function($J){$z.prototype._calculateNodeKeyFrames.call(this,$J);var $o,$r,$S,$G=$J.keyframes;$J.target;for($o in $S={},$J.secondFrames=$S,$G)($r=$G[$o]).length<=1?$S[$o]=-1:$S[$o]=$r[1].index},$B(0,$o,"target",function(){return this._target},function($J){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$J,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$B(0,$o,"playEvent",null,function($J){(this._playEvents=$J)&&this.addEvent()}),$B(0,$o,"effectData",null,function($J){var $o;$J&&(($o=$J.animations)&&$o[0]&&(this._setUp({},$o[0]),$o[0].nodes&&$o[0].nodes[0]&&(this._aniKeys=$o[0].nodes[0].keys)))}),$B(0,$o,"effectClass",null,function($J){var $o,$r;(this._effectClass=$T.getClass($J),this._effectClass)&&(($o=this._effectClass.uiView)&&($r=$o.animations)&&$r[0]&&(this._setUp({},$r[0]),$r[0].nodes&&$r[0].nodes[0]&&(this._aniKeys=$r[0].nodes[0].keys)))}),$J.EffectAnimationBegin="effectanimationbegin"}($tJ),function($o){var $m;function $C(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$C.__super.call(this)}$D($C,"laya.utils.GraphicAnimation",$o);var $J=$C.prototype;return $J._parseNodeList=function($J){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$J.compId]=$J.props,$J.compId&&this._nodeList.push($J.compId);var $o=$J.child;if($o){var $r=0,$S=$o.length;for($r=0;$r<$S;$r++)this._parseNodeList($o[$r])}},$J._calGraphicData=function($J){var $o;if(this._setUp(null,$J),this._createGraphicData(),this._nodeIDAniDic)for($o in this._nodeIDAniDic)this._nodeIDAniDic[$o]=null},$J._createGraphicData=function(){var $J,$o=[],$r=0,$S=this.count,$G=this._animationNewFrames;for($G||($G=[]),$r=0;$r<$S;$r++)!$G[$r]&&$J||($J=this._createFrameGraphic($r)),$o.push($J);this._gList=$o},$J._createFrameGraphic=function($J){var $o=$R.createGraphics();return $C._rootMatrix||($C._rootMatrix=new $n),this._updateNodeGraphic(this._rootNode,$J,$C._rootMatrix,$o),$o},$J._updateNodeGraphic=function($J,$o,$r,$S,$G){var $z;void 0===$G&&($G=1);var $A,$h,$Z,$u=($z=this._nodeGDic[$J.compId]=this._getNodeGraphicData($J.compId,$o,this._nodeGDic[$J.compId])).alpha*$G;if(!($u<.01)&&($z.resultTransform||($z.resultTransform=$n.create()),$A=$z.resultTransform,$n.mul($z.transform,$r,$A),$z.skin&&($h=this._getTextureByUrl($z.skin))&&($A._checkTransform()?($S.drawTexture($h,0,0,$z.width,$z.height,$A,$u),$z.resultTransform=null):$S.drawTexture($h,$A.tx,$A.ty,$z.width,$z.height,null,$u)),$Z=$J.child)){var $B,$v=0;for($B=$Z.length,$v=0;$v<$B;$v++)this._updateNodeGraphic($Z[$v],$o,$A,$S,$u)}},$J._updateNoChilds=function($J,$o){if($J.skin){var $r=this._getTextureByUrl($J.skin);if($r){var $S=$J.transform;$S._checkTransform();!$S.bTransform?$o.drawTexture($r,$S.tx,$S.ty,$J.width,$J.height,null,$J.alpha):$o.drawTexture($r,0,0,$J.width,$J.height,$S.clone(),$J.alpha)}}},$J._updateNodeGraphic2=function($J,$o,$r){var $S;if($S=this._nodeGDic[$J.compId]=this._getNodeGraphicData($J.compId,$o,this._nodeGDic[$J.compId]),$J.child){var $G=$S.transform;$G._checkTransform();var $z,$A;$A=($z=!$G.bTransform)&&(0!=$G.tx||0!=$G.ty);var $h,$Z,$u;if(($h=$G.bTransform||1!=$S.alpha)&&$r.save(),1!=$S.alpha&&$r.alpha($S.alpha),$z?$A&&$r.translate($G.tx,$G.ty):$r.transform($G.clone()),$Z=$J.child,$S.skin&&($u=this._getTextureByUrl($S.skin))&&$r.drawTexture($u,0,0,$S.width,$S.height),$Z){var $B,$v=0;for($B=$Z.length,$v=0;$v<$B;$v++)this._updateNodeGraphic2($Z[$v],$o,$r)}$h?$r.restore():$z?$A&&$r.translate(-$G.tx,-$G.ty):$r.transform($G.clone().invert())}else this._updateNoChilds($S,$r)},$J._calculateNodeKeyFrames=function($J){$o.prototype._calculateNodeKeyFrames.call(this,$J),this._nodeIDAniDic[$J.target]=$J},$J.getNodeDataByID=function($J){return this._nodeIDAniDic[$J]},$J._getParams=function($J,$o,$r,$S){var $G=$C._temParam;$G.length=$o.length;var $z=0,$A=$o.length;for($z=0;$z<$A;$z++)$G[$z]=this._getObjVar($J,$o[$z][0],$r,$o[$z][1],$S);return $G},$J._getObjVar=function($J,$o,$r,$S,$G){if($J.hasOwnProperty($o)){var $z=$J[$o];if($r>=$z.length&&($r=$z.length-1),null!=$J[$o][$r])return $J[$o][$r]}return $G.hasOwnProperty($o)?$G[$o]:$S},$J._getNodeGraphicData=function($J,$o,$r){$r||($r=$m.create()),$r.transform?$r.transform.identity():$r.transform=$n.create();var $S=this.getNodeDataByID($J);if(!$S)return $r;var $G,$z,$A=$S.frames,$h=this._getParams($A,$C._drawTextureCmd,$o,this._nodeDefaultProps[$J]),$Z=$h[0],$u=NaN,$B=NaN,$v=$h[5],$j=$h[6],$Y=$h[13],$_=$h[14],$D=$h[7],$N=$h[8],$w=$h[9],$i=$h[11],$I=$h[12];$u=$h[3],$B=$h[4],0!=$u&&0!=$B||($Z=null),-1==$u&&($u=0),-1==$B&&($B=0),$r.skin=$Z,$r.width=$u,$r.height=$B,$Z&&(($G=this._getTextureByUrl($Z))?($u||($u=$G.sourceWidth),$B||($B=$G.sourceHeight)):console.warn("lost skin:",$Z,",you may load pics first")),$r.alpha=$h[10],$z=$r.transform,0!=$Y&&($v=$Y*$u),0!=$_&&($j=$_*$B),0==$v&&0==$j||$z.translate(-$v,-$j);var $t=null;if($w||1!==$D||1!==$N||$i||$I){($t=$C._tempMt).identity(),$t.bTransform=!0;var $K=.0174532922222222*($w-$i),$e=.0174532922222222*($w+$I),$y=Math.cos($e),$g=Math.sin($e),$s=Math.sin($K),$V=Math.cos($K);$t.a=$D*$y,$t.b=$D*$g,$t.c=-$N*$s,$t.d=$N*$V,$t.tx=$t.ty=0}return $t&&($z=$n.mul($z,$t,$z)),$z.translate($h[1],$h[2]),$r},$J._getTextureByUrl=function($J){return $hJ.getRes($J)},$J.setAniData=function($J,$o){if($J.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$J,this._parseNodeList($J);var $r,$S={},$G=[],$z=$J.animations,$A=0,$h=$z.length;for($A=0;$A<$h;$A++)if($r=$z[$A],this._labels=null,(!$o||$o==$r.name)&&$r){try{this._calGraphicData($r)}catch($J){console.warn("parse animation fail:"+$r.name+",empty animation created"),this._gList=[]}var $Z={};$Z.interval=1e3/$r.frameRate,$Z.frames=this._gList,$Z.labels=this._labels,$Z.name=$r.name,$G.push($Z),$S[$r.name]=$Z}this.animationList=$G,this.animationDic=$S}$C._temParam.length=0},$J.parseByData=function($J){var $o,$r;$o=$J.nodeRoot,$r=$J.aniO,delete $J.nodeRoot,delete $J.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$o,this._parseNodeList($o),this._labels=null;try{this._calGraphicData($r)}catch($J){console.warn("parse animation fail:"+$r.name+",empty animation created"),this._gList=[]}var $S=$J;return $S.interval=1e3/$r.frameRate,$S.frames=this._gList,$S.labels=this._labels,$S.name=$r.name,$S},$J.setUpAniData=function($J){if($J.animations){var $o,$r={},$S=[],$G=$J.animations,$z=0,$A=$G.length;for($z=0;$z<$A;$z++)if($o=$G[$z]){var $h={};$h.name=$o.name,$h.aniO=$o,$h.nodeRoot=$J,$S.push($h),$r[$o.name]=$h}this.animationList=$S,this.animationDic=$r}},$J._clear=function(){var $J,$o;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($J in this._nodeGDic)($o=this._nodeGDic[$J])&&$o.recover();this._nodeGDic=null},$C.parseAnimationByData=function($J){var $o;return $C._I||($C._I=new $C),$o=$C._I.parseByData($J),$C._I._clear(),$o},$C.parseAnimationData=function($J){var $o;return $C._I||($C._I=new $C),$C._I.setUpAniData($J),($o={}).animationList=$C._I.animationList,$o.animationDic=$C._I.animationDic,$C._I._clear(),$o},$C._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$C._temParam=[],$C._I=null,$C._rootMatrix=null,$Z($C,["_tempMt",function(){return this._tempMt=new $n}]),$C.__init$=function(){$m=function(){function $J(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $D($J,""),$J.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$a.recover("GraphicNode",this)},$J.create=function(){return $a.getItemByClass("GraphicNode",$J)},$J}()},$C}($tJ));$y.__init([$u,$ZJ,$L,$d,$M,$V,$J,$yJ])}(window,document,Laya),function($J,$o,$r){$r.un,$r.uns,$r.static;var $S=$r.class;$r.getset,$r.__newvec;new(function(){function $J(){}return $S($J,"LayaMain"),$J}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($J,$o){"use strict";for(var $r in Object.defineProperty($o,"__esModule",{value:!0}),Laya){var $S=Laya[$r];$S&&$S.__isclass&&($o[$r]=$S)}}),function($J,$o,$e){$e.un,$e.uns;var $A=$e.static,$j=$e.class,$S=$e.getset,$z=$e.__newvec,$B=laya.maths.Arith,$v=laya.maths.Bezier,$r=laya.resource.Bitmap,$Y=laya.utils.Browser,$Z=laya.utils.Byte,$_=laya.utils.Color,$y=(laya.filters.ColorFilter,$e.Config),$G=laya.resource.Context,$g=(laya.events.Event,laya.filters.Filter),$h=laya.display.Graphics,$u=laya.resource.HTMLCanvas,$D=(laya.utils.HTMLChar,laya.resource.HTMLImage),$N=laya.resource.HTMLSubImage,$s=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$V=laya.maths.Point,$m=laya.maths.Rectangle,$w=laya.renders.Render,$i=(laya.renders.RenderContext,laya.renders.RenderSprite),$I=laya.resource.Resource,$t=laya.resource.ResourceManager,$K=laya.utils.RunDriver,$C=laya.display.Sprite,$R=laya.display.Stage,$n=laya.utils.Stat,$k=laya.utils.StringKey,$U=(laya.display.css.Style,laya.system.System),$L=laya.display.Text,$Q=laya.resource.Texture,$p=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$f=laya.utils.VectorGraphManager;laya.utils.WordText;$e.interface("laya.webgl.shapes.IShape"),$e.interface("laya.webgl.submit.ISubmit"),$e.interface("laya.webgl.text.ICharSegment"),$e.interface("laya.webgl.canvas.save.ISaveData"),$e.interface("laya.webgl.resource.IMergeAtlasBitmap"),$e.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $F=function(){function $J(){}$j($J,"laya.filters.webgl.FilterActionGL");var $o=$J.prototype;return $e.imps($o,{"laya.filters.IFilterActionGL":!0}),$o.setValue=function($J){},$o.setValueMix=function($J){},$o.apply3d=function($J,$o,$r,$S,$G){return null},$o.apply=function($J){return null},$S(0,$o,"typeMix",function(){return 0}),$J}(),$d=function(){function $J(){}return $j($J,"laya.webgl.shader.ShaderValue"),$J}(),$l=function(){var $S,$G;function $J($J,$o,$r){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $G,void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),this._cells=null,this._rowInfo=null,this._init($J,$o),this._atlasID=$r}$j($J,"laya.webgl.atlas.AtlasGrid");var $o=$J.prototype;return $o.getAltasID=function(){return this._atlasID},$o.setAltasID=function($J){0<=$J&&(this._atlasID=$J)},$o.addTex=function($J,$o,$r){var $S=this._get($o,$r);return 0==$S.ret||(this._fill($S.x,$S.y,$o,$r,$J),this._texCount++),$S},$o._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$o._init=function($J,$o){if(this._width=$J,this._height=$o,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$z(this._height);for(var $r=0;$r<this._height;$r++)this._rowInfo[$r]=new $S;return this._clear(),!0},$o._get=function($J,$o){var $r=new $T;if($J>=this._failSize.width&&$o>=this._failSize.height)return $r;for(var $S=-1,$G=-1,$z=this._width,$A=this._height,$h=this._cells,$Z=0;$Z<$A;$Z++)if(!(this._rowInfo[$Z].spaceCount<$J))for(var $u=0;$u<$z;){var $B=3*($Z*$z+$u);if(0!=$h[$B]||$h[1+$B]<$J||$h[2+$B]<$o)$u+=$h[1+$B];else{$S=$u,$G=$Z;for(var $v=0;$v<$J;$v++)if($h[3*$v+$B+2]<$o){$S=-1;break}if(!($S<0))return $r.ret=!0,$r.x=$S,$r.y=$G,$r;$u+=$h[1+$B]}}return $r},$o._fill=function($J,$o,$r,$S,$G){var $z=this._width,$A=this._height;this._check($J+$r<=$z&&$o+$S<=$A);for(var $h=$o;$h<$S+$o;++$h){this._check(this._rowInfo[$h].spaceCount>=$r),this._rowInfo[$h].spaceCount-=$r;for(var $Z=0;$Z<$r;$Z++){var $u=3*($J+$h*$z+$Z);this._check(0==this._cells[$u]),this._cells[$u]=$G,this._cells[1+$u]=$r,this._cells[2+$u]=$S}}if(0<$J)for($h=0;$h<$S;++$h){var $B=0;for($Z=$J-1;0<=$Z&&0==this._cells[3*(($o+$h)*$z+$Z)];--$Z,++$B);for($Z=$B;0<$Z;--$Z)this._cells[3*(($o+$h)*$z+$J-$Z)+1]=$Z,this._check(0<$Z)}if(0<$o)for($Z=$J;$Z<$J+$r;++$Z){for($B=0,$h=$o-1;0<=$h&&0==this._cells[3*($Z+$h*$z)];--$h,$B++);for($h=$B;0<$h;--$h)this._cells[3*($Z+($o-$h)*$z)+2]=$h,this._check(0<$h)}},$o._check=function($J){0==$J&&console.log("xtexMerger 错误啦")},$o._clear=function(){for(var $J=this._texCount=0;$J<this._height;$J++)this._rowInfo[$J].spaceCount=this._width;for(var $o=0;$o<this._height;$o++)for(var $r=0;$r<this._width;$r++){var $S=3*($o*this._width+$r);this._cells[$S]=0,this._cells[1+$S]=this._width-$r,this._cells[2+$S]=this._width-$o}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$J.__init$=function(){$S=function(){function $J(){this.spaceCount=0}return $j($J,""),$J}(),$G=function(){function $J(){this.width=0,this.height=0}return $j($J,""),$J}()},$J}(),$c=function(){function $w($J,$o,$r,$S){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$J,this._height=$o,this._gridSize=$r,this._maxAtlaserCount=$S,this._gridNumX=$J/$r,this._gridNumY=$o/$r,this._curAtlasIndex=0,this._atlaserArray=[]}$j($w,"laya.webgl.atlas.AtlasResourceManager");var $J=$w.prototype;return $J.setAtlasParam=function($J,$o,$r,$S){if(1==this._setAtlasParam)return $w._sid_=0,this._width=$J,this._height=$o,this._gridSize=$r,this._maxAtlaserCount=$S,this._gridNumX=$J/$r,this._gridNumY=$o/$r,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$J.pushData=function($J){var $o,$r=$J.bitmap,$S=-1,$G=null,$z=0,$A=0;for($z=0,$o=this._atlaserArray.length;$z<$o&&($A=(this._curAtlasIndex+$z)%$o,-1==($S=($G=this._atlaserArray[$A]).findBitmapIsExist($r)));$z++);if(-1!=$S){var $h=$G.InAtlasWebGLImagesOffsetValue[$S];return $_=$h[0],$D=$h[1],$G.addToAtlas($J,$_,$D),!0}this._setAtlasParam=!1;for(var $Z=Math.ceil(($J.bitmap.width+2)/this._gridSize),$u=Math.ceil(($J.bitmap.height+2)/this._gridSize),$B=!1,$v=0;$v<2;$v++){var $j=this._maxAtlaserCount;for($z=0;$z<$j;$z++){$A=(this._curAtlasIndex+$z)%$j,this._atlaserArray.length-1>=$A||this._atlaserArray.push(new $mJ(this._gridNumX,this._gridNumY,this._width,this._height,$w._sid_++));var $Y=this._atlaserArray[$A],$_=0,$D=0,$N=$Y.addTex(1,$Z,$u);if($N.ret){$_=$N.x*this._gridSize+1,$D=$N.y*this._gridSize+1,$r.lock=!0,$Y.addToAtlasTexture($r,$_,$D),$Y.addToAtlas($J,$_,$D),$B=!0,this._curAtlasIndex=$A;break}}if($B)break;this._atlaserArray.push(new $mJ(this._gridNumX,this._gridNumY,this._width,this._height,$w._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $B||console.log(">>>AtlasManager pushData error"),$B},$J.addToAtlas=function($J){laya.webgl.atlas.AtlasResourceManager.instance.pushData($J)},$J.garbageCollection=function(){if(!0===this._needGC){for(var $J=this._atlaserArray.length-this._maxAtlaserCount,$o=0;$o<$J;$o++)this._atlaserArray[$o].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$J),this._atlaserArray.splice(0,$J),this._needGC=!1}return!0},$J.freeAll=function(){for(var $J=0,$o=this._atlaserArray.length;$J<$o;$J++)this._atlaserArray[$J].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$J.getAtlaserCount=function(){return this._atlaserArray.length},$J.getAtlaserByIndex=function($J){return this._atlaserArray[$J]},$S(1,$w,"instance",function(){return $w._Instance||($w._Instance=new $w(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$w._Instance}),$S(1,$w,"enabled",function(){return $y.atlasEnable}),$S(1,$w,"atlasLimitWidth",function(){return $w._atlasLimitWidth},function($J){$w._atlasLimitWidth=$J}),$S(1,$w,"atlasLimitHeight",function(){return $w._atlasLimitHeight},function($J){$w._atlasLimitHeight=$J}),$w._enable=function(){$y.atlasEnable=!0},$w._disable=function(){$y.atlasEnable=!1},$w.__init__=function(){$w.atlasTextureWidth=2048,$w.atlasTextureHeight=2048,$w.maxTextureCount=6,$w.atlasLimitWidth=512,$w.atlasLimitHeight=512},$w._atlasLimitWidth=0,$w._atlasLimitHeight=0,$w.gridSize=16,$w.atlasTextureWidth=0,$w.atlasTextureHeight=0,$w.maxTextureCount=0,$w._atlasRestore=0,$w.BOARDER_TYPE_NO=0,$w.BOARDER_TYPE_RIGHT=1,$w.BOARDER_TYPE_LEFT=2,$w.BOARDER_TYPE_BOTTOM=4,$w.BOARDER_TYPE_TOP=8,$w.BOARDER_TYPE_ALL=15,$w._sid_=0,$w._Instance=null,$w}(),$T=function(){function $J(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $j($J,"laya.webgl.atlas.MergeFillInfo"),$J}(),$b=function(){function $o(){}return $j($o,"laya.webgl.canvas.BlendMode"),$o._init_=function($J){$o.fns=[$o.BlendNormal,$o.BlendAdd,$o.BlendMultiply,$o.BlendScreen,$o.BlendOverlay,$o.BlendLight,$o.BlendMask,$o.BlendDestinationOut],$o.targetFns=[$o.BlendNormalTarget,$o.BlendAddTarget,$o.BlendMultiplyTarget,$o.BlendScreenTarget,$o.BlendOverlayTarget,$o.BlendLightTarget,$o.BlendMask,$o.BlendDestinationOut]},$o.BlendNormal=function($J){$J.blendFunc(1,771)},$o.BlendAdd=function($J){$J.blendFunc(1,772)},$o.BlendMultiply=function($J){$J.blendFunc(774,771)},$o.BlendScreen=function($J){$J.blendFunc(1,1)},$o.BlendOverlay=function($J){$J.blendFunc(1,769)},$o.BlendLight=function($J){$J.blendFunc(1,1)},$o.BlendNormalTarget=function($J){$J.blendFunc(1,771)},$o.BlendAddTarget=function($J){$J.blendFunc(1,772)},$o.BlendMultiplyTarget=function($J){$J.blendFunc(774,771)},$o.BlendScreenTarget=function($J){$J.blendFunc(1,1)},$o.BlendOverlayTarget=function($J){$J.blendFunc(1,769)},$o.BlendLightTarget=function($J){$J.blendFunc(1,1)},$o.BlendMask=function($J){$J.blendFunc(0,770)},$o.BlendDestinationOut=function($J){$J.blendFunc(0,0)},$o.activeBlendFunction=null,$o.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$o.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$o.NORMAL="normal",$o.ADD="add",$o.MULTIPLY="multiply",$o.SCREEN="screen",$o.LIGHT="light",$o.OVERLAY="overlay",$o.DESTINATIONOUT="destination-out",$o.fns=[],$o.targetFns=[],$o}(),$$=function(){function $r($J){this._color=$_.create("black"),this.setValue($J)}$j($r,"laya.webgl.canvas.DrawStyle");var $J=$r.prototype;return $J.setValue=function($J){if($J){if("string"==typeof $J)return void(this._color=$_.create($J));if($J instanceof laya.utils.Color)return void(this._color=$J)}},$J.reset=function(){this._color=$_.create("black")},$J.equal=function($J){return"string"==typeof $J?this._color.strColor===$J:$J instanceof laya.utils.Color&&this._color.numColor===$J.numColor},$J.toColorStr=function(){return this._color.strColor},$r.create=function($J){var $o;if($J&&("string"==typeof $J?$o=$_.create($J):$J instanceof laya.utils.Color&&($o=$J),$o))return $o._drawStyle||($o._drawStyle=new $r($J));return laya.webgl.canvas.DrawStyle.DEFAULT},$A($r,["DEFAULT",function(){return this.DEFAULT=new $r("#000000")}]),$r}(),$q=function(){function $J(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$tJ.mainContext;this.ib=$EJ.create(35048),this.vb=$XJ.create(5)}$j($J,"laya.webgl.canvas.Path");var $o=$J.prototype;return $o.addPoint=function($J,$o){this.tempArray.push($J,$o)},$o.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$o.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$o.polygon=function($J,$o,$r,$S,$G,$z){var $A;return this.geomatrys.push(this._curGeomatry=$A=new $kJ($J,$o,$r,$S,$G,$z)),$S||($A.fill=!1),null==$z&&($A.borderWidth=0),$A},$o.setGeomtry=function($J){this.geomatrys.push(this._curGeomatry=$J)},$o.drawLine=function($J,$o,$r,$S,$G){var $z;return this.closePath?this.geomatrys.push(this._curGeomatry=$z=new $nJ($J,$o,$r,$S,$G)):this.geomatrys.push(this._curGeomatry=$z=new $RJ($J,$o,$r,$S,$G)),$z.fill=!1,$z},$o.update=function(){var $J=this.ib._byteLength,$o=this.geomatrys.length;this.offset=$J;for(var $r=this.geoStart;$r<$o;$r++)this.geomatrys[$r].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$o,this.count=(this.ib._byteLength-$J)/$DJ.BYTES_PIDX},$o.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$o.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$J}(),$H=function(){function $h(){}$j($h,"laya.webgl.canvas.save.SaveBase");var $J=$h.prototype;return $e.imps($J,{"laya.webgl.canvas.save.ISaveData":!0}),$J.isSaveMark=function(){return!1},$J.restore=function($J){this._dataObj[this._valueName]=this._value,($h._cache[$h._cache._length++]=this)._newSubmit&&($J._curSubmit=$zJ.RENDERBASE,$J._renderKey=0)},$h._createArray=function(){var $J=[];return $J._length=0,$J},$h._init=function(){var $J=$h._namemap={};return $J[1]="ALPHA",$J[2]="fillStyle",$J[8]="font",$J[256]="lineWidth",$J[512]="strokeStyle",$J[8192]="_mergeID",$J[1024]=$J[2048]=$J[4096]=[],$J[16384]="textBaseline",$J[32768]="textAlign",$J[65536]="_nBlendType",$J[1048576]="shader",$J[2097152]="filters",$J},$h.save=function($J,$o,$r,$S){if(($J._saveMark._saveuse&$o)!==$o){$J._saveMark._saveuse|=$o;var $G=$h._cache,$z=0<$G._length?$G[--$G._length]:new $h;$z._value=$r[$z._valueName=$h._namemap[$o]],$z._dataObj=$r,$z._newSubmit=$S;var $A=$J._save;$A[$A._length++]=$z}},$h._cache=laya.webgl.canvas.save.SaveBase._createArray(),$h._namemap=$h._init(),$h}(),$a=function(){function $z(){this._clipRect=new $m}$j($z,"laya.webgl.canvas.save.SaveClipRect");var $J=$z.prototype;return $e.imps($J,{"laya.webgl.canvas.save.ISaveData":!0}),$J.isSaveMark=function(){return!1},$J.restore=function($J){$J._clipRect=this._clipSaveRect,($z._cache[$z._cache._length++]=this)._submitScissor.submitLength=$J._submits._length-this._submitScissor.submitIndex,$J._curSubmit=$zJ.RENDERBASE,$J._renderKey=0},$z.save=function($J,$o){if(131072!=(131072&$J._saveMark._saveuse)){$J._saveMark._saveuse|=131072;var $r=$z._cache,$S=0<$r._length?$r[--$r._length]:new $z;$S._clipSaveRect=$J._clipRect,$J._clipRect=$S._clipRect.copyFrom($J._clipRect),$S._submitScissor=$o;var $G=$J._save;$G[$G._length++]=$S}},$A($z,["_cache",function(){return this._cache=$H._createArray()}]),$z}(),$x=function(){function $Y(){this._contextX=0,this._contextY=0,this._clipRect=new $m,this._rect=new $m,this._matrix=new $s}$j($Y,"laya.webgl.canvas.save.SaveClipRectStencil");var $J=$Y.prototype;return $e.imps($J,{"laya.webgl.canvas.save.ISaveData":!0}),$J.isSaveMark=function(){return!1},$J.restore=function($J){$BJ.restore($J,this._rect,this._saveMatrix,this._contextX,this._contextY),$J._clipRect=this._clipSaveRect,$J._curMat=this._saveMatrix,$J._x=this._contextX,$J._y=this._contextY,$Y._cache[$Y._cache._length++]=this,$J._curSubmit=$zJ.RENDERBASE},$Y.save=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){if(262144!=(262144&$J._saveMark._saveuse)){$J._saveMark._saveuse|=262144;var $B=$Y._cache,$v=0<$B._length?$B[--$B._length]:new $Y;$v._clipSaveRect=$J._clipRect,$v._clipRect.setTo($A,$h,$Z,$u),$J._clipRect=$v._clipRect,$v._rect.x=$r,$v._rect.y=$S,$v._rect.width=$G,$v._rect.height=$z,$v._contextX=$J._x,$v._contextY=$J._y,$v._saveMatrix=$J._curMat,$J._curMat.copyTo($v._matrix),$J._curMat=$v._matrix,$v._submitStencil=$o;var $j=$J._save;$j[$j._length++]=$v}},$A($Y,["_cache",function(){return this._cache=$H._createArray()}]),$Y}(),$M=function(){function $S(){this._saveuse=0}$j($S,"laya.webgl.canvas.save.SaveMark");var $J=$S.prototype;return $e.imps($J,{"laya.webgl.canvas.save.ISaveData":!0}),$J.isSaveMark=function(){return!0},$J.restore=function($J){$J._saveMark=this._preSaveMark,$S._no[$S._no._length++]=this},$S.Create=function($J){var $o=$S._no,$r=0<$o._length?$o[--$o._length]:new $S;return $r._saveuse=0,$r._preSaveMark=$J._saveMark,$J._saveMark=$r},$A($S,["_no",function(){return this._no=$H._createArray()}]),$S}(),$O=function(){function $z(){this._matrix=new $s}$j($z,"laya.webgl.canvas.save.SaveTransform");var $J=$z.prototype;return $e.imps($J,{"laya.webgl.canvas.save.ISaveData":!0}),$J.isSaveMark=function(){return!1},$J.restore=function($J){$J._curMat=this._savematrix,$z._no[$z._no._length++]=this},$z.save=function($J){var $o=$J._saveMark;if(2048!=(2048&$o._saveuse)){$o._saveuse|=2048;var $r=$z._no,$S=0<$r._length?$r[--$r._length]:new $z;$S._savematrix=$J._curMat,$J._curMat=$J._curMat.copyTo($S._matrix);var $G=$J._save;$G[$G._length++]=$S}},$A($z,["_no",function(){return this._no=$H._createArray()}]),$z}(),$P=function(){function $G(){}$j($G,"laya.webgl.canvas.save.SaveTranslate");var $J=$G.prototype;return $e.imps($J,{"laya.webgl.canvas.save.ISaveData":!0}),$J.isSaveMark=function(){return!1},$J.restore=function($J){$J._curMat;$J._x=this._x,$J._y=this._y,$G._no[$G._no._length++]=this},$G.save=function($J){var $o=$G._no,$r=0<$o._length?$o[--$o._length]:new $G;$r._x=$J._x,$r._y=$J._y;var $S=$J._save;$S[$S._length++]=$r},$A($G,["_no",function(){return this._no=$H._createArray()}]),$G}(),$W=function(){function $J(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $m}$j($J,"laya.webgl.resource.RenderTargetMAX");var $o=$J.prototype;return $o.setSP=function($J){this._sp=$J},$o.size=function($J,$o){var $r=this;this._width!==$J||this._height!==$o?(this.repaint=!0,this._width=$J,this._height=$o,this.target?this.target.size($J,$o):this.target=$fJ.create($J,$o),this.target.hasListener("recovered")||this.target.on("recovered",this,function($J){$e.timer.callLater($r._sp,$r._sp.repaint)})):this.target.size($J,$o)},$o._flushToTarget=function($J,$o){if(!$o._destroy){var $r=$iJ.worldScissorTest,$S=$iJ.worldClipRect;$iJ.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$iJ.worldScissorTest=!1,$tJ.mainContext.disable(3089);var $G=$iJ.worldAlpha,$z=$iJ.worldMatrix4,$A=$iJ.worldMatrix,$h=$iJ.worldFilters,$Z=$iJ.worldShaderDefines;if($iJ.worldMatrix=$s.EMPTY,$iJ.restoreTempArray(),$iJ.worldMatrix4=$iJ.TEMPMAT4_ARRAY,$iJ.worldAlpha=1,$iJ.worldFilters=null,$iJ.worldShaderDefines=null,$pJ.activeShader=null,$o.start(),$y.showCanvasMark?$o.clear(0,1,0,.3):$o.clear(0,0,0,0),$J.flush(),$o.end(),$pJ.activeShader=null,$iJ.worldAlpha=$G,$iJ.worldMatrix4=$z,$iJ.worldMatrix=$A,$iJ.worldFilters=$h,$iJ.worldShaderDefines=$Z,$iJ.worldScissorTest=$r){var $u=$iJ.height-$S.y-$S.height;$tJ.mainContext.scissor($S.x,$u,$S.width,$S.height),$tJ.mainContext.enable(3089)}$iJ.worldClipRect=$S}},$o.flush=function($J){this.repaint&&(this._flushToTarget($J,this.target),this.repaint=!1)},$o.drawTo=function($J,$o,$r,$S,$G){$J.drawTexture(this.target.getTexture(),$o,$r,$S,$G,0,0)},$o.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$J}(),$E=function(){function $J(){this.ALPHA=1,this.shaderType=0,this.defines=new $CJ}return $j($J,"laya.webgl.shader.d2.Shader2D"),$J.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$J.__init__=function(){var $J,$o;$MJ.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$MJ.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$MJ.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$MJ.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$MJ.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$MJ.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$MJ.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$MJ.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$J="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$o='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$MJ.preCompile2D(0,1,$J,$o,null),$J="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$o='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$MJ.preCompile2D(0,2,$J,$o,null),$J="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$o="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$MJ.preCompile2D(0,4,$J,$o,null),$J="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$o='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$MJ.preCompile2D(0,256,$J,$o,null),$J="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$o="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$MJ.preCompile2D(0,512,$J,$o,null)},$J}(),$X=function(){function $o($J,$o,$r){this._value=0,this._name2int=$J,this._int2name=$o,this._int2nameMap=$r}$j($o,"laya.webgl.shader.ShaderDefines");var $J=$o.prototype;return $J.add=function($J){return"string"==typeof $J&&($J=this._name2int[$J]),this._value|=$J,this._value},$J.addInt=function($J){return this._value|=$J,this._value},$J.remove=function($J){return"string"==typeof $J&&($J=this._name2int[$J]),this._value&=~$J,this._value},$J.isDefine=function($J){return(this._value&$J)===$J},$J.getValue=function(){return this._value},$J.setValue=function($J){this._value=$J},$J.toNameDic=function(){var $J=this._int2nameMap[this._value];return $J||$o._toText(this._value,this._int2name,this._int2nameMap)},$o._reg=function($J,$o,$r,$S){$S[$r[$J]=$o]=$J},$o._toText=function($J,$o,$r){var $S=$r[$J];if($S)return $S;for(var $G={},$z=1,$A=0;$A<32&&!($J<($z=1<<$A));$A++)if($J&$z){var $h=$o[$z];$h&&($G[$h]="")}return $r[$J]=$G},$o._toInt=function($J,$o){for(var $r=$J.split("."),$S=0,$G=0,$z=$r.length;$G<$z;$G++){var $A=$o[$r[$G]];if(!$A)throw new Error("Defines to int err:"+$J+"/"+$r[$G]);$S|=$A}return $S},$o}(),$JJ=function(){function $A(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $s}$j($A,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $J=$A.prototype;return $J.init=function($J,$o,$r){if($o)this._vs=$o;else{this._vs=[];var $S=$J.width,$G=$J.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($S,0,1,0,1,1,1,1),this._vs.push($S,$G,1,1,1,1,1,1),this._vs.push(0,$G,0,1,1,1,1,1)}$r?this._ps=$r:($A._defaultPS||($A._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$A._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$J},$J.init2=function($J,$o,$r,$S,$G){this.transform&&(this.transform=null),$r?this._ps=$r:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$S,this._uvs=$G,this.mEleNum=this._ps.length,this.mTexture=$J,($w.isConchNode||$w.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$J._initMyData=function(){var $J=0,$o=0,$r=4*this._verticles.length;this._vs=$A._tempVS;var $S=!1;if($w.isConchNode||$w.isConchApp?(this._vs.length=$r,$S=!0):this._vs.length<$r&&(this._vs.length=$r,$S=!0),$A._tVSLen=$r,$S)for(;$J<$r;)this._vs[$J]=this._verticles[$o],this._vs[$J+1]=this._verticles[$o+1],this._vs[$J+2]=this._uvs[$o],this._vs[$J+3]=this._uvs[$o+1],this._vs[$J+4]=1,this._vs[$J+5]=1,this._vs[$J+6]=1,this._vs[$J+7]=1,$J+=8,$o+=2;else for(;$J<$r;)this._vs[$J]=this._verticles[$o],this._vs[$J+1]=this._verticles[$o+1],this._vs[$J+2]=this._uvs[$o],this._vs[$J+3]=this._uvs[$o+1],$J+=8,$o+=2},$J.getData2=function($J,$o,$r){var $S;this.mVBBuffer=$J,this.mIBBuffer=$o,this._initMyData(),$J.appendEx2(this._vs,Float32Array,$A._tVSLen,4),this._indexStart=$o._byteLength,($S=$A._tempIB).length<this._ps.length&&($S.length=this._ps.length);for(var $G=0,$z=this._ps.length;$G<$z;$G++)$S[$G]=this._ps[$G]+$r;$o.appendEx2($S,Uint16Array,this._ps.length,2)},$J.getData=function($J,$o,$r){if(this.mVBBuffer=$J,this.mIBBuffer=$o,$J.append(this.mVBData),this._indexStart=$o._byteLength,this.mIBData.start!=$r){for(var $S=0,$G=this._ps.length;$S<$G;$S++)this.mIBData[$S]=this._ps[$S]+$r;this.mIBData.start=$r}$o.append(this.mIBData)},$J.render=function($J,$o,$r){if($w.isWebGL&&this.mTexture){$J._renderKey=0,$J._shader2D.glTexture=null,$oJ.getInstance().addSkinMesh(this);var $S=$zJ.createShape($J,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$gJ.create(512,0));this.transform||(this.transform=$s.EMPTY),this.transform.translate($o,$r),$s.mul(this.transform,$J._curMat,this._tempMatrix),this.transform.translate(-$o,-$r);var $G=$S.shaderValue,$z=$G.u_mmat2||$iJ.getMatrArray();$iJ.mat2MatArray(this._tempMatrix,$z),$G.textureHost=this.mTexture,$G.offsetX=0,$G.offsetY=0,$G.u_mmat2=$z,$G.ALPHA=$J._shader2D.ALPHA,$J._submits[$J._submits._length++]=$S}else $w.isConchApp&&this.mTexture&&(this.transform||(this.transform=$s.EMPTY),$J.setSkinMesh&&$J.setSkinMesh($o,$r,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$A._tempVS=[],$A._tempIB=[],$A._defaultPS=null,$A._tVSLen=0,$A}(),$oJ=function(){function $J(){this.ib=null,this.vb=null;$tJ.mainContext;this.ib=$EJ.create(35048),this.vb=$XJ.create(8)}$j($J,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $o=$J.prototype;return $o.addSkinMesh=function($J){$J.getData2(this.vb,this.ib,this.vb._byteLength/32)},$o.reset=function(){this.vb.clear(),this.ib.clear()},$J.getInstance=function(){return $J.instance=$J.instance||new $J},$J.instance=null,$J}(),$rJ=function(){function $J($J,$o,$r,$S,$G,$z,$A,$h,$Z){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$Z&&($Z=0),this.x=$J,this.y=$o,this.width=$r,this.height=$S,this.edges=$G,this.color=$z,this.borderWidth=$A,this.borderColor=$h}$j($J,"laya.webgl.shapes.BasePoly");var $o=$J.prototype;return $e.imps($o,{"laya.webgl.shapes.IShape":!0}),$o.getData=function($J,$o,$r){},$o.rebuild=function($J){},$o.setMatrix=function($J){},$o.needUpdate=function($J){return!0},$o.sector=function($J,$o,$r){var $S=this.x,$G=this.y,$z=this.edges,$A=(this.r1-this.r0)/$z,$h=this.width,$Z=this.height,$u=this.color,$B=($u>>16&255)/255,$v=($u>>8&255)/255,$j=(255&$u)/255;$J.push($S,$G,$B,$v,$j);for(var $Y=0;$Y<$z+1;$Y++)$J.push($S+Math.sin($A*$Y+this.r0)*$h,$G+Math.cos($A*$Y+this.r0)*$Z),$J.push($B,$v,$j);for($Y=0;$Y<$z;$Y++)$o.push($r,$r+$Y+1,$r+$Y+2)},$o.createLine2=function($J,$o,$r,$S,$G,$z){var $A,$h,$Z,$u,$B,$v,$j,$Y,$_,$D,$N,$w,$i,$I,$t,$K,$e,$y,$g,$s,$V=$J.concat(),$m=$G,$C=this.borderColor,$R=($C>>16&255)/255,$n=($C>>8&255)/255,$k=(255&$C)/255,$U=$V.length/2,$L=$S,$Q=$r/2;$Z=$V[0],$u=$V[1],$D=$Z-($B=$V[2]),$_=($_=-($u-($v=$V[3])))/($s=Math.sqrt($_*$_+$D*$D))*$Q,$D=$D/$s*$Q,$m.push($Z-$_+this.x,$u-$D+this.y,$R,$n,$k,$Z+$_+this.x,$u+$D+this.y,$R,$n,$k);for(var $p=1;$p<$U-1;$p++)$Z=$V[2*($p-1)],$u=$V[2*($p-1)+1],$B=$V[2*$p],$v=$V[2*$p+1],$j=$V[2*($p+1)],$Y=$V[2*($p+1)+1],$D=$Z-$B,$w=$B-$j,$t=(-($_=($_=-($u-$v))/($s=Math.sqrt($_*$_+$D*$D))*$Q)+$Z)*(-($D=$D/$s*$Q)+$v)-(-$_+$B)*(-$D+$u),$y=(-($N=($N=-($v-$Y))/($s=Math.sqrt($N*$N+$w*$w))*$Q)+$j)*(-($w=$w/$s*$Q)+$v)-(-$N+$B)*(-$w+$Y),$g=($i=-$D+$u-(-$D+$v))*($e=-$N+$B-(-$N+$j))-($K=-$w+$Y-(-$w+$v))*($I=-$_+$B-(-$_+$Z)),Math.abs($g)<.1?($g+=10.1,$m.push($B-$_+this.x,$v-$D+this.y,$R,$n,$k,$B+$_+this.x,$v+$D+this.y,$R,$n,$k)):((($A=($I*$y-$e*$t)/$g)-$B)*($A-$B)+(($h=($K*$t-$i*$y)/$g)-$v)+($h-$v),$m.push($A+this.x,$h+this.y,$R,$n,$k,$B-($A-$B)+this.x,$v-($h-$v)+this.y,$R,$n,$k));$Z=$V[$V.length-4],$u=$V[$V.length-3],$D=$Z-($B=$V[$V.length-2]),$_=($_=-($u-($v=$V[$V.length-1])))/($s=Math.sqrt($_*$_+$D*$D))*$Q,$D=$D/$s*$Q,$m.push($B-$_+this.x,$v-$D+this.y,$R,$n,$k,$B+$_+this.x,$v+$D+this.y,$R,$n,$k);var $f=$z;for($p=1;$p<$f;$p++)$o.push($L+2*($p-1),$L+2*($p-1)+1,$L+2*$p+1,$L+2*$p+1,$L+2*$p,$L+2*($p-1));return $m},$o.createLine=function($J,$o,$r,$S){var $G=$J.concat(),$z=$J,$A=this.borderColor,$h=($A>>16&255)/255,$Z=($A>>8&255)/255,$u=(255&$A)/255;$G.splice(0,5);var $B,$v,$j,$Y,$_,$D,$N,$w,$i,$I,$t,$K,$e,$y,$g,$s,$V,$m,$C,$R,$n=$G.length/5,$k=$S,$U=$r/2;$j=$G[0],$Y=$G[1],$I=$j-($_=$G[5]),$i=($i=-($Y-($D=$G[6])))/($R=Math.sqrt($i*$i+$I*$I))*$U,$I=$I/$R*$U,$z.push($j-$i,$Y-$I,$h,$Z,$u,$j+$i,$Y+$I,$h,$Z,$u);for(var $L=1;$L<$n-1;$L++)$j=$G[5*($L-1)],$Y=$G[5*($L-1)+1],$_=$G[5*$L],$D=$G[5*$L+1],$N=$G[5*($L+1)],$w=$G[5*($L+1)+1],$I=$j-$_,$K=$_-$N,$g=(-($i=($i=-($Y-$D))/($R=Math.sqrt($i*$i+$I*$I))*$U)+$j)*(-($I=$I/$R*$U)+$D)-(-$i+$_)*(-$I+$Y),$m=(-($t=($t=-($D-$w))/($R=Math.sqrt($t*$t+$K*$K))*$U)+$N)*(-($K=$K/$R*$U)+$D)-(-$t+$_)*(-$K+$w),$C=($e=-$I+$Y-(-$I+$D))*($V=-$t+$_-(-$t+$N))-($s=-$K+$w-(-$K+$D))*($y=-$i+$_-(-$i+$j)),Math.abs($C)<.1?($C+=10.1,$z.push($_-$i,$D-$I,$h,$Z,$u,$_+$i,$D+$I,$h,$Z,$u)):((($B=($y*$m-$V*$g)/$C)-$_)*($B-$_)+(($v=($s*$g-$e*$m)/$C)-$D)+($v-$D),$z.push($B,$v,$h,$Z,$u,$_-($B-$_),$D-($v-$D),$h,$Z,$u));$j=$G[$G.length-10],$Y=$G[$G.length-9],$I=$j-($_=$G[$G.length-5]),$i=($i=-($Y-($D=$G[$G.length-4])))/($R=Math.sqrt($i*$i+$I*$I))*$U,$I=$I/$R*$U,$z.push($_-$i,$D-$I,$h,$Z,$u,$_+$i,$D+$I,$h,$Z,$u);var $Q=this.edges+1;for($L=1;$L<$Q;$L++)$o.push($k+2*($L-1),$k+2*($L-1)+1,$k+2*$L+1,$k+2*$L+1,$k+2*$L,$k+2*($L-1));return $z},$o.createLoopLine=function($J,$o,$r,$S,$G,$z){var $A=$J.concat(),$h=$G||$J,$Z=this.borderColor,$u=($Z>>16&255)/255,$B=($Z>>8&255)/255,$v=(255&$Z)/255;$A.splice(0,5);var $j=[$A[0],$A[1]],$Y=[$A[$A.length-5],$A[$A.length-4]],$_=$Y[0]+.5*($j[0]-$Y[0]),$D=$Y[1]+.5*($j[1]-$Y[1]);$A.unshift($_,$D,0,0,0),$A.push($_,$D,0,0,0);var $N,$w,$i,$I,$t,$K,$e,$y,$g,$s,$V,$m,$C,$R,$n,$k,$U,$L,$Q,$p,$f=$A.length/5,$F=$S,$d=$r/2;$i=$A[0],$I=$A[1],$s=$i-($t=$A[5]),$g=($g=-($I-($K=$A[6])))/($p=Math.sqrt($g*$g+$s*$s))*$d,$s=$s/$p*$d,$h.push($i-$g,$I-$s,$u,$B,$v,$i+$g,$I+$s,$u,$B,$v);for(var $l=1;$l<$f-1;$l++)$i=$A[5*($l-1)],$I=$A[5*($l-1)+1],$t=$A[5*$l],$K=$A[5*$l+1],$e=$A[5*($l+1)],$y=$A[5*($l+1)+1],$s=$i-$t,$m=$t-$e,$n=(-($g=($g=-($I-$K))/($p=Math.sqrt($g*$g+$s*$s))*$d)+$i)*(-($s=$s/$p*$d)+$K)-(-$g+$t)*(-$s+$I),$L=(-($V=($V=-($K-$y))/($p=Math.sqrt($V*$V+$m*$m))*$d)+$e)*(-($m=$m/$p*$d)+$K)-(-$V+$t)*(-$m+$y),$Q=($C=-$s+$I-(-$s+$K))*($U=-$V+$t-(-$V+$e))-($k=-$m+$y-(-$m+$K))*($R=-$g+$t-(-$g+$i)),Math.abs($Q)<.1?($Q+=10.1,$h.push($t-$g,$K-$s,$u,$B,$v,$t+$g,$K+$s,$u,$B,$v)):((($N=($R*$L-$U*$n)/$Q)-$t)*($N-$t)+(($w=($k*$n-$C*$L)/$Q)-$K)+($w-$K),$h.push($N,$w,$u,$B,$v,$t-($N-$t),$K-($w-$K),$u,$B,$v));$z&&($o=$z);var $c=this.edges+1;for($l=1;$l<$c;$l++)$o.push($F+2*($l-1),$F+2*($l-1)+1,$F+2*$l+1,$F+2*$l+1,$F+2*$l,$F+2*($l-1));return $o.push($F+2*($l-1),$F+2*($l-1)+1,$F+1,$F+1,$F,$F+2*($l-1)),$h},$J}(),$SJ=function(){function $D(){}return $j($D,"laya.webgl.shapes.Earcut"),$D.earcut=function($J,$o,$r){$r=$r||2;var $S,$G,$z,$A,$h,$Z,$u,$B=$o&&$o.length,$v=$B?$o[0]*$r:$J.length,$j=$D.linkedList($J,0,$v,$r,!0),$Y=[];if(!$j)return $Y;if($B&&($j=$D.eliminateHoles($J,$o,$j,$r)),$J.length>80*$r){$S=$z=$J[0],$G=$A=$J[1];for(var $_=$r;$_<$v;$_+=$r)($h=$J[$_])<$S&&($S=$h),($Z=$J[$_+1])<$G&&($G=$Z),$z<$h&&($z=$h),$A<$Z&&($A=$Z);$u=0!==($u=Math.max($z-$S,$A-$G))?1/$u:0}return $D.earcutLinked($j,$Y,$r,$S,$G,$u),$Y},$D.linkedList=function($J,$o,$r,$S,$G){var $z,$A;if($G===0<$D.signedArea($J,$o,$r,$S))for($z=$o;$z<$r;$z+=$S)$A=$D.insertNode($z,$J[$z],$J[$z+1],$A);else for($z=$r-$S;$o<=$z;$z-=$S)$A=$D.insertNode($z,$J[$z],$J[$z+1],$A);return $A&&$D.equals($A,$A.next)&&($D.removeNode($A),$A=$A.next),$A},$D.filterPoints=function($J,$o){if(!$J)return $J;$o||($o=$J);var $r,$S=$J;do{if($r=!1,$S.steiner||!$D.equals($S,$S.next)&&0!==$D.area($S.prev,$S,$S.next))$S=$S.next;else{if($D.removeNode($S),($S=$o=$S.prev)===$S.next)break;$r=!0}}while($r||$S!==$o);return $o},$D.earcutLinked=function($J,$o,$r,$S,$G,$z,$A){if($J){!$A&&$z&&$D.indexCurve($J,$S,$G,$z);for(var $h,$Z,$u=$J;$J.prev!==$J.next;)if($h=$J.prev,$Z=$J.next,$z?$D.isEarHashed($J,$S,$G,$z):$D.isEar($J))$o.push($h.i/$r),$o.push($J.i/$r),$o.push($Z.i/$r),$D.removeNode($J),$J=$Z.next,$u=$Z.next;else if(($J=$Z)===$u){$A?1===$A?($J=$D.cureLocalIntersections($J,$o,$r),$D.earcutLinked($J,$o,$r,$S,$G,$z,2)):2===$A&&$D.splitEarcut($J,$o,$r,$S,$G,$z):$D.earcutLinked($D.filterPoints($J,null),$o,$r,$S,$G,$z,1);break}}},$D.isEar=function($J){var $o=$J.prev,$r=$J,$S=$J.next;if(0<=$D.area($o,$r,$S))return!1;for(var $G=$J.next.next;$G!==$J.prev;){if($D.pointInTriangle($o.x,$o.y,$r.x,$r.y,$S.x,$S.y,$G.x,$G.y)&&0<=$D.area($G.prev,$G,$G.next))return!1;$G=$G.next}return!0},$D.isEarHashed=function($J,$o,$r,$S){var $G=$J.prev,$z=$J,$A=$J.next;if(0<=$D.area($G,$z,$A))return!1;for(var $h=$G.x<$z.x?$G.x<$A.x?$G.x:$A.x:$z.x<$A.x?$z.x:$A.x,$Z=$G.y<$z.y?$G.y<$A.y?$G.y:$A.y:$z.y<$A.y?$z.y:$A.y,$u=$G.x>$z.x?$G.x>$A.x?$G.x:$A.x:$z.x>$A.x?$z.x:$A.x,$B=$G.y>$z.y?$G.y>$A.y?$G.y:$A.y:$z.y>$A.y?$z.y:$A.y,$v=$D.zOrder($h,$Z,$o,$r,$S),$j=$D.zOrder($u,$B,$o,$r,$S),$Y=$J.nextZ;$Y&&$Y.z<=$j;){if($Y!==$J.prev&&$Y!==$J.next&&$D.pointInTriangle($G.x,$G.y,$z.x,$z.y,$A.x,$A.y,$Y.x,$Y.y)&&0<=$D.area($Y.prev,$Y,$Y.next))return!1;$Y=$Y.nextZ}for($Y=$J.prevZ;$Y&&$Y.z>=$v;){if($Y!==$J.prev&&$Y!==$J.next&&$D.pointInTriangle($G.x,$G.y,$z.x,$z.y,$A.x,$A.y,$Y.x,$Y.y)&&0<=$D.area($Y.prev,$Y,$Y.next))return!1;$Y=$Y.prevZ}return!0},$D.cureLocalIntersections=function($J,$o,$r){var $S=$J;do{var $G=$S.prev,$z=$S.next.next;!$D.equals($G,$z)&&$D.intersects($G,$S,$S.next,$z)&&$D.locallyInside($G,$z)&&$D.locallyInside($z,$G)&&($o.push($G.i/$r),$o.push($S.i/$r),$o.push($z.i/$r),$D.removeNode($S),$D.removeNode($S.next),$S=$J=$z),$S=$S.next}while($S!==$J);return $S},$D.splitEarcut=function($J,$o,$r,$S,$G,$z){var $A=$J;do{for(var $h=$A.next.next;$h!==$A.prev;){if($A.i!==$h.i&&$D.isValidDiagonal($A,$h)){var $Z=$D.splitPolygon($A,$h);return $A=$D.filterPoints($A,$A.next),$Z=$D.filterPoints($Z,$Z.next),$D.earcutLinked($A,$o,$r,$S,$G,$z),void $D.earcutLinked($Z,$o,$r,$S,$G,$z)}$h=$h.next}$A=$A.next}while($A!==$J)},$D.eliminateHoles=function($J,$o,$r,$S){var $G,$z,$A,$h,$Z,$u=[];for($G=0,$z=$o.length;$G<$z;$G++)$A=$o[$G]*$S,$h=$G<$z-1?$o[$G+1]*$S:$J.length,($Z=$D.linkedList($J,$A,$h,$S,!1))===$Z.next&&($Z.steiner=!0),$u.push($D.getLeftmost($Z));for($u.sort($D.compareX),$G=0;$G<$u.length;$G++)$D.eliminateHole($u[$G],$r),$r=$D.filterPoints($r,$r.next);return $r},$D.compareX=function($J,$o){return $J.x-$o.x},$D.eliminateHole=function($J,$o){if($o=$D.findHoleBridge($J,$o)){var $r=$D.splitPolygon($o,$J);$D.filterPoints($r,$r.next)}},$D.findHoleBridge=function($J,$o){var $r,$S=$o,$G=$J.x,$z=$J.y,$A=-1/0;do{if($z<=$S.y&&$z>=$S.next.y&&$S.next.y!==$S.y){var $h=$S.x+($z-$S.y)*($S.next.x-$S.x)/($S.next.y-$S.y);if($h<=$G&&$A<$h){if(($A=$h)===$G){if($z===$S.y)return $S;if($z===$S.next.y)return $S.next}$r=$S.x<$S.next.x?$S:$S.next}}$S=$S.next}while($S!==$o);if(!$r)return null;if($G===$A)return $r.prev;var $Z,$u=$r,$B=$r.x,$v=$r.y,$j=1/0;for($S=$r.next;$S!==$u;)$G>=$S.x&&$S.x>=$B&&$G!==$S.x&&$D.pointInTriangle($z<$v?$G:$A,$z,$B,$v,$z<$v?$A:$G,$z,$S.x,$S.y)&&(($Z=Math.abs($z-$S.y)/($G-$S.x))<$j||$Z===$j&&$S.x>$r.x)&&$D.locallyInside($S,$J)&&($r=$S,$j=$Z),$S=$S.next;return $r},$D.indexCurve=function($J,$o,$r,$S){for(var $G=$J;null===$G.z&&($G.z=$D.zOrder($G.x,$G.y,$o,$r,$S)),$G.prevZ=$G.prev,$G.nextZ=$G.next,($G=$G.next)!==$J;);$G.prevZ.nextZ=null,$G.prevZ=null,$D.sortLinked($G)},$D.sortLinked=function($J){var $o,$r,$S,$G,$z,$A,$h,$Z,$u=1;do{for($r=$J,$z=$J=null,$A=0;$r;){for($A++,$S=$r,$o=$h=0;$o<$u&&($h++,$S=$S.nextZ);$o++);for($Z=$u;0<$h||0<$Z&&$S;)0!==$h&&(0===$Z||!$S||$r.z<=$S.z)?($r=($G=$r).nextZ,$h--):($S=($G=$S).nextZ,$Z--),$z?$z.nextZ=$G:$J=$G,$G.prevZ=$z,$z=$G;$r=$S}$z.nextZ=null,$u*=2}while(1<$A);return $J},$D.zOrder=function($J,$o,$r,$S,$G){return($J=1431655765&(($J=858993459&(($J=252645135&(($J=16711935&(($J=32767*($J-$r)*$G)|$J<<8))|$J<<4))|$J<<2))|$J<<1))|($o=1431655765&(($o=858993459&(($o=252645135&(($o=16711935&(($o=32767*($o-$S)*$G)|$o<<8))|$o<<4))|$o<<2))|$o<<1))<<1},$D.getLeftmost=function($J){for(var $o=$J,$r=$J;$o.x<$r.x&&($r=$o),($o=$o.next)!==$J;);return $r},$D.pointInTriangle=function($J,$o,$r,$S,$G,$z,$A,$h){return 0<=($G-$A)*($o-$h)-($J-$A)*($z-$h)&&0<=($J-$A)*($S-$h)-($r-$A)*($o-$h)&&0<=($r-$A)*($z-$h)-($G-$A)*($S-$h)},$D.isValidDiagonal=function($J,$o){return $J.next.i!==$o.i&&$J.prev.i!==$o.i&&!$D.intersectsPolygon($J,$o)&&$D.locallyInside($J,$o)&&$D.locallyInside($o,$J)&&$D.middleInside($J,$o)},$D.area=function($J,$o,$r){return($o.y-$J.y)*($r.x-$o.x)-($o.x-$J.x)*($r.y-$o.y)},$D.equals=function($J,$o){return $J.x===$o.x&&$J.y===$o.y},$D.intersects=function($J,$o,$r,$S){return!!($D.equals($J,$o)&&$D.equals($r,$S)||$D.equals($J,$S)&&$D.equals($r,$o))||0<$D.area($J,$o,$r)!=0<$D.area($J,$o,$S)&&0<$D.area($r,$S,$J)!=0<$D.area($r,$S,$o)},$D.intersectsPolygon=function($J,$o){var $r=$J;do{if($r.i!==$J.i&&$r.next.i!==$J.i&&$r.i!==$o.i&&$r.next.i!==$o.i&&$D.intersects($r,$r.next,$J,$o))return!0;$r=$r.next}while($r!==$J);return!1},$D.locallyInside=function($J,$o){return $D.area($J.prev,$J,$J.next)<0?0<=$D.area($J,$o,$J.next)&&0<=$D.area($J,$J.prev,$o):$D.area($J,$o,$J.prev)<0||$D.area($J,$J.next,$o)<0},$D.middleInside=function($J,$o){for(var $r=$J,$S=!1,$G=($J.x+$o.x)/2,$z=($J.y+$o.y)/2;$r.y>$z!=$r.next.y>$z&&$r.next.y!==$r.y&&$G<($r.next.x-$r.x)*($z-$r.y)/($r.next.y-$r.y)+$r.x&&($S=!$S),($r=$r.next)!==$J;);return $S},$D.splitPolygon=function($J,$o){var $r=new $GJ($J.i,$J.x,$J.y),$S=new $GJ($o.i,$o.x,$o.y),$G=$J.next,$z=$o.prev;return($J.next=$o).prev=$J,($r.next=$G).prev=$r,($S.next=$r).prev=$S,($z.next=$S).prev=$z,$S},$D.insertNode=function($J,$o,$r,$S){var $G=new $GJ($J,$o,$r);return $S?($G.next=$S.next,($G.prev=$S).next.prev=$G,$S.next=$G):($G.prev=$G).next=$G,$G},$D.removeNode=function($J){$J.next.prev=$J.prev,$J.prev.next=$J.next,$J.prevZ&&($J.prevZ.nextZ=$J.nextZ),$J.nextZ&&($J.nextZ.prevZ=$J.prevZ)},$D.signedArea=function($J,$o,$r,$S){for(var $G=0,$z=$o,$A=$r-$S;$z<$r;$z+=$S)$G+=($J[$A]-$J[$z])*($J[$z+1]+$J[$A+1]),$A=$z;return $G},$D}(),$GJ=function(){function $J($J,$o,$r){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$J,this.x=$o,this.y=$r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $j($J,"laya.webgl.shapes.EarcutNode"),$J}(),$zJ=(function(){function $J($J,$o,$r,$S,$G,$z,$A){this.lineWidth=$J,this.lineColor=$o,this.lineAlpha=$r,this.fillColor=$S,this.fillAlpha=$G,this.shape=$A,this.fill=$z}$j($J,"laya.webgl.shapes.GeometryData");var $o=$J.prototype;$o.clone=function(){return new $J(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$o.getIndexData=function(){return null},$o.getVertexData=function(){return null},$o.destroy=function(){this.shape=null}}(),function(){function $J($J){if($J instanceof Float32Array)this.points=$J;else if($J instanceof Array){$J.length;this.points=new Float32Array($J)}}$j($J,"laya.webgl.shapes.Vertex");var $o=$J.prototype;$e.imps($o,{"laya.webgl.shapes.IShape":!0}),$o.getData=function($J,$o,$r){},$o.needUpdate=function($J){return!1},$o.rebuild=function($J){},$o.setMatrix=function($J){}}(),function(){function $Z($J){void 0===$J&&($J=1e4),this._renderType=$J}$j($Z,"laya.webgl.submit.Submit");var $J=$Z.prototype;return $e.imps($J,{"laya.webgl.submit.ISubmit":!0}),$J.releaseRender=function(){var $J=$Z._cache;($J[$J._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$J.getRenderType=function(){return this._renderType},$J.renderSubmit=function(){if(0===this._numEle)return 1;var $J=this.shaderValue.textureHost;if($J){var $o=$J.source;if(!$J.bitmap||!$o)return 1;this.shaderValue.texture=$o,$J.alphaTexture&&$J.alphaTexture.source&&(this.shaderValue.texture1=$J.alphaTexture.source)}this._vb.bind_upload(this._ib);var $r=$tJ.mainContext;return this.shaderValue.upload(),$b.activeBlendFunction!==this._blendFn&&($r.enable(3042),this._blendFn($r),$b.activeBlendFunction=this._blendFn),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,$r.drawElements(4,this._numEle,5123,this._startIdx),1},$Z.__init__=function(){var $J=$Z.RENDERBASE=new $Z(-1);$J.shaderValue=new $gJ(0,0),$J.shaderValue.ALPHA=-1234},$Z.createSubmit=function($J,$o,$r,$S,$G){var $z=$Z._cache._length?$Z._cache[--$Z._cache._length]:new $Z;null==$r&&(($r=$z._selfVb||($z._selfVb=$XJ.create(-1))).clear(),$S=0),$z._ib=$o,$z._vb=$r,$z._startIdx=$S*$DJ.BYTES_PIDX,$z._numEle=0;var $A=$J._nBlendType;$z._blendFn=$J._targets?$b.targetFns[$A]:$b.fns[$A],$z.shaderValue=$G,$z.shaderValue.setValue($J._shader2D);var $h=$J._shader2D.filters;return $h&&$z.shaderValue.setFilters($h),$z},$Z.createShape=function($J,$o,$r,$S,$G,$z){var $A=$Z._cache._length?$Z._cache[--$Z._cache._length]:new $Z;$A._ib=$o,$A._vb=$r,$A._numEle=$S,$A._startIdx=$G,$A.shaderValue=$z,$A.shaderValue.setValue($J._shader2D);var $h=$J._nBlendType;return $A._blendFn=$J._targets?$b.targetFns[$h]:$b.fns[$h],$A},$Z.TYPE_2D=1e4,$Z.TYPE_CANVAS=10003,$Z.TYPE_CMDSETRT=10004,$Z.TYPE_CUSTOM=10005,$Z.TYPE_BLURRT=10006,$Z.TYPE_CMDDESTORYPRERT=10007,$Z.TYPE_DISABLESTENCIL=10008,$Z.TYPE_OTHERIBVB=10009,$Z.TYPE_PRIMITIVE=10010,$Z.TYPE_RT=10011,$Z.TYPE_BLUR_RT=10012,$Z.TYPE_TARGET=10013,$Z.TYPE_CHANGE_VALUE=10014,$Z.TYPE_SHAPE=10015,$Z.TYPE_TEXTURE=10016,$Z.TYPE_FILLTEXTURE=10017,$Z.RENDERBASE=null,$Z._cache=(($Z._cache=[])._length=0,$Z._cache),$Z}()),$AJ=function(){function $S(){this.fun=null,this.args=null}$j($S,"laya.webgl.submit.SubmitCMD");var $J=$S.prototype;return $e.imps($J,{"laya.webgl.submit.ISubmit":!0}),$J.renderSubmit=function(){return this.fun.apply(null,this.args),1},$J.getRenderType=function(){return 0},$J.releaseRender=function(){var $J=$S._cache;$J[$J._length++]=this},$S.create=function($J,$o){var $r=$S._cache._length?$S._cache[--$S._cache._length]:new $S;return $r.fun=$o,$r.args=$J,$r},$S._cache=(($S._cache=[])._length=0,$S._cache),$S}(),$hJ=function(){function $o(){this.variables={}}$j($o,"laya.webgl.submit.SubmitCMDScope");var $J=$o.prototype;return $J.getValue=function($J){return this.variables[$J]},$J.addValue=function($J,$o){return this.variables[$J]=$o},$J.setValue=function($J,$o){return this.variables.hasOwnProperty($J)?this.variables[$J]=$o:null},$J.clear=function(){for(var $J in this.variables)delete this.variables[$J]},$J.recycle=function(){this.clear(),$o.POOL.push(this)},$o.create=function(){var $J=$o.POOL.pop();return $J||($J=new $o),$J},$o.POOL=[],$o}(),$ZJ=function(){function $v(){this.offset=0,this.startIndex=0,this._mat=$s.create()}$j($v,"laya.webgl.submit.SubmitOtherIBVB");var $J=$v.prototype;return $e.imps($J,{"laya.webgl.submit.ISubmit":!0}),$J.releaseRender=function(){var $J=$v._cache;($J[$J._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$J.getRenderType=function(){return 10009},$J.renderSubmit=function(){var $J=this._shaderValue.textureHost;if($J){var $o=$J.source;if(!$J.bitmap||!$o)return 1;this._shaderValue.texture=$o}this._vb.bind_upload(this._ib);var $r=$iJ.worldMatrix4,$S=$s.TEMP;$s.mulPre(this._mat,$r[0],$r[1],$r[4],$r[5],$r[12],$r[13],$S);var $G=$iJ.worldMatrix4=$v.tempMatrix4;$G[0]=$S.a,$G[1]=$S.b,$G[4]=$S.c,$G[5]=$S.d,$G[12]=$S.tx,$G[13]=$S.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $z=$tJ.mainContext;return $b.activeBlendFunction!==this._blendFn&&($z.enable(3042),this._blendFn($z),$b.activeBlendFunction=this._blendFn),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,$z.drawElements(4,this._numEle,5123,this.startIndex),$iJ.worldMatrix4=$r,$pJ.activeShader=null,1},$v.create=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){void 0===$Z&&($Z=0);var $u=$v._cache._length?$v._cache[--$v._cache._length]:new $v;$u._ib=$r,$u._vb=$o,$u._numEle=$S,$u._shader=$G,$u._shaderValue=$z;var $B=$J._nBlendType;switch($u._blendFn=$J._targets?$b.targetFns[$B]:$b.fns[$B],$Z){case 0:$u.offset=0,$u.startIndex=$h/($DJ.BYTES_PE*$o.vertexStride)*1.5,$u.startIndex*=$DJ.BYTES_PIDX;break;case 1:$u.startIndex=$A,$u.offset=$h}return $u},$v._cache=(($v._cache=[])._length=0,$v._cache),$v.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$v}(),$uJ=function(){function $r(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $m,this.screenRect=new $m}$j($r,"laya.webgl.submit.SubmitScissor");var $J=$r.prototype;return $e.imps($J,{"laya.webgl.submit.ISubmit":!0}),$J._scissor=function($J,$o,$r,$S){var $G=$iJ.worldMatrix4,$z=$G[0],$A=$G[5],$h=$G[12],$Z=$G[13];if($S*=$A,($r*=$z)<1||$S<1)return!1;var $u=($J=$J*$z+$h)+$r,$B=($o=$o*$A+$Z)+$S;$J<0&&($r=$u-($J=0)),$o<0&&($S=$B-($o=0));var $v=$iJ.worldClipRect;if($J=Math.max($J,$v.x),$o=Math.max($o,$v.y),$r=Math.min($u,$v.right)-$J,$S=Math.min($B,$v.bottom)-$o,$r<1||$S<1)return!1;var $j=$iJ.worldScissorTest;return this.screenRect.copyFrom($v),$v.x=$J,$v.y=$o,$v.width=$r,$v.height=$S,$iJ.worldScissorTest=!0,$o=$iJ.height-$o-$S,$tJ.mainContext.scissor($J,$o,$r,$S),$tJ.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$j?($o=$iJ.height-this.screenRect.y-this.screenRect.height,$tJ.mainContext.scissor(this.screenRect.x,$o,this.screenRect.width,this.screenRect.height),$tJ.mainContext.enable(3089)):($tJ.mainContext.disable(3089),$iJ.worldScissorTest=!1),$v.copyFrom(this.screenRect),!0},$J._scissorWithTagart=function($J,$o,$r,$S){if($r<1||$S<1)return!1;var $G=$J+$r,$z=$o+$S;$J<0&&($r=$G-($J=0)),$o<0&&($S=$z-($o=0));var $A=$iJ.worldClipRect;if($J=Math.max($J,$A.x),$o=Math.max($o,$A.y),$r=Math.min($G,$A.right)-$J,$S=Math.min($z,$A.bottom)-$o,$r<1||$S<1)return!1;var $h=$iJ.worldScissorTest;return this.screenRect.copyFrom($A),$iJ.worldScissorTest=!0,$A.x=$J,$A.y=$o,$A.width=$r,$A.height=$S,$o=$iJ.height-$o-$S,$tJ.mainContext.scissor($J,$o,$r,$S),$tJ.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$h?($o=$iJ.height-this.screenRect.y-this.screenRect.height,$tJ.mainContext.scissor(this.screenRect.x,$o,this.screenRect.width,this.screenRect.height),$tJ.mainContext.enable(3089)):($tJ.mainContext.disable(3089),$iJ.worldScissorTest=!1),$A.copyFrom(this.screenRect),!0},$J.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$J.getRenderType=function(){return 0},$J.releaseRender=function(){var $J=$r._cache;($J[$J._length++]=this).context=null},$r.create=function($J){var $o=$r._cache._length?$r._cache[--$r._cache._length]:new $r;return $o.context=$J,$o},$r._cache=(($r._cache=[])._length=0,$r._cache),$r}(),$BJ=function(){function $Z(){this.step=0,this.blendMode=null,this.level=0}$j($Z,"laya.webgl.submit.SubmitStencil");var $J=$Z.prototype;return $e.imps($J,{"laya.webgl.submit.ISubmit":!0}),$J.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$J.getRenderType=function(){return 0},$J.releaseRender=function(){var $J=$Z._cache;$J[$J._length++]=this},$J.do1=function(){var $J=$tJ.mainContext;$J.enable(2960),$J.clear(1024),$J.colorMask(!1,!1,!1,!1),$J.stencilFunc(514,this.level,255),$J.stencilOp(7680,7680,7682)},$J.do2=function(){var $J=$tJ.mainContext;$J.stencilFunc(514,this.level+1,255),$J.colorMask(!0,!0,!0,!0),$J.stencilOp(7680,7680,7680)},$J.do3=function(){var $J=$tJ.mainContext;$J.colorMask(!0,!0,!0,!0),$J.stencilOp(7680,7680,7680),$J.clear(1024),$J.disable(2960)},$J.do4=function(){var $J=$tJ.mainContext;0==this.level&&($J.enable(2960),$J.clear(1024)),$J.colorMask(!1,!1,!1,!1),$J.stencilFunc(519,0,255),$J.stencilOp(7680,7680,7682)},$J.do5=function(){var $J=$tJ.mainContext;$J.stencilFunc(514,this.level,255),$J.colorMask(!0,!0,!0,!0),$J.stencilOp(7680,7680,7680)},$J.do6=function(){var $J=$tJ.mainContext;$b.targetFns[$b.TOINT[this.blendMode]]($J)},$J.do7=function(){var $J=$tJ.mainContext;$J.colorMask(!1,!1,!1,!1),$J.stencilOp(7680,7680,7683)},$J.do8=function(){var $J=$tJ.mainContext;$J.colorMask(!0,!0,!0,!0),$J.stencilFunc(514,this.level,255),$J.stencilOp(7680,7680,7680)},$Z.restore=function($J,$o,$r,$S,$G){var $z;if(($J._renderKey=0)<$Z._mask&&$Z._mask--,0==$Z._mask)$z=laya.webgl.submit.SubmitStencil.create(3),$J.addRenderObject($z),$J._curSubmit=$zJ.RENDERBASE;else{$z=laya.webgl.submit.SubmitStencil.create(7),$J.addRenderObject($z);var $A=$J._vb;$A._byteLength;if($NJ.fillRectImgVb($A,null,$o.x,$o.y,$o.width,$o.height,$Q.DEF_UV,$r,$S,$G,0,0)){$J._shader2D.glTexture=null;var $h=$J._curSubmit=$zJ.createSubmit($J,$J._ib,$A,($A._byteLength-64)/32*3,$gJ.create(2,0));$h.shaderValue.ALPHA=1,$J._submits[$J._submits._length++]=$h,$J._curSubmit._numEle+=6,$J._curSubmit=$zJ.RENDERBASE}else alert("clipRect calc stencil rect error");$z=laya.webgl.submit.SubmitStencil.create(8),$J.addRenderObject($z)}},$Z.restore2=function($J,$o){var $r;($J._renderKey=0)<$Z._mask&&$Z._mask--,0==$Z._mask?($r=laya.webgl.submit.SubmitStencil.create(3),$J.addRenderObject($r),$J._curSubmit=$zJ.RENDERBASE):($r=laya.webgl.submit.SubmitStencil.create(7),$J.addRenderObject($r),$J._submits[$J._submits._length++]=$o,$r=laya.webgl.submit.SubmitStencil.create(8),$J.addRenderObject($r))},$Z.create=function($J){var $o=$Z._cache._length?$Z._cache[--$Z._cache._length]:new $Z;return 5==($o.step=$J)&&++$Z._mask,$o.level=$Z._mask,$o},$Z._cache=(($Z._cache=[])._length=0,$Z._cache),$Z._mask=0,$Z}(),$vJ=function(){function $h(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$j($h,"laya.webgl.submit.SubmitTarget");var $J=$h.prototype;return $e.imps($J,{"laya.webgl.submit.ISubmit":!0}),$J.renderSubmit=function(){this._vb.bind_upload(this._ib);var $J=this.scope.getValue(this.proName);return $J&&(this.shaderValue.texture=$J.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$J.width,$J.height]),this.shaderValue.upload(),this.blend(),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,$tJ.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$J.blend=function(){if($b.activeBlendFunction!==$b.fns[this.blendType]){var $J=$tJ.mainContext;$J.enable(3042),$b.fns[this.blendType]($J),$b.activeBlendFunction=$b.fns[this.blendType]}},$J.getRenderType=function(){return 0},$J.releaseRender=function(){var $J=$h._cache;($J[$J._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$h.create=function($J,$o,$r,$S,$G,$z){var $A=$h._cache._length?$h._cache[--$h._cache._length]:new $h;return $A._ib=$o,$A._vb=$r,$A.proName=$z,$A._startIdx=$S*$DJ.BYTES_PIDX,$A._numEle=0,$A.blendType=$J._nBlendType,$A.shaderValue=$G,$A.shaderValue.setValue($J._shader2D),$A},$h._cache=(($h._cache=[])._length=0,$h._cache),$h}(),$jJ=function(){function $J(){this._sourceStr=null}$j($J,"laya.webgl.text.CharSegment");var $o=$J.prototype;return $e.imps($o,{"laya.webgl.text.ICharSegment":!0}),$o.textToSpit=function($J){this._sourceStr=$J},$o.getChar=function($J){return this._sourceStr.charAt($J)},$o.getCharCode=function($J){return this._sourceStr.charCodeAt($J)},$o.length=function(){return this._sourceStr.length},$J}(),$YJ=function(){var $J;function $n(){}return $j($n,"laya.webgl.text.DrawText"),$n.__init__=function(){$n._charsTemp=new Array,$n._drawValue=new $J,$n._charSeg=new $jJ},$n.customCharSeg=function($J){$n._charSeg=$J},$n.getChar=function($J,$o,$r){var $S=$HJ.createOneChar($J,$r);return-1!=$o&&($n._charsCache[$o]=$S),$S},$n._drawSlow=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v,$j,$Y,$_){var $D,$N,$w=$n._drawValue.value($z,$h,$Z,$u,$j,$Y,$_),$i=0,$I=0,$t=$n._charsTemp,$K=0,$e=NaN;if($S)for($t.length=$S.length,$i=0,$I=$S.length;$i<$I;$i++)($N=$S[$i])&&($e=$N.charNum+$w.txtID,$t[$i]=$D=$n._charsCache[$e]||$n.getChar($N.char,$e,$w),$D.active());else{var $y=$r instanceof laya.utils.WordText?$r.toString():$r;if($L.CharacterCache){$n._charSeg.textToSpit($y);var $g=$n._charSeg.length();for($i=0,$I=$t.length=$g;$i<$I;$i++)$e=$n._charSeg.getCharCode($i)+$w.txtID,$t[$i]=$D=$n._charsCache[$e]||$n.getChar($n._charSeg.getChar($i),$e,$w),$D.active(),$K+=$D.cw}else $t.length=0,($D=$n.getChar($y,-1,$w)).active(),$K+=$D.cw,$t[0]=$D}var $s=0;null!==$A&&"left"!==$A&&($s=-("center"==$A?$K/2:$K));var $V,$m,$C=NaN,$R=0;if($S)for($i=0,$I=$t.length;$i<$I;$i++)$D=$t[$i],$N=$S[$i],$D&&$N&&!$D.isSpace&&($C=$D.borderSize,$V=$D.texture,$o._drawText($V,$B+$s+$N.x*$j-$C,$v+$N.y*$Y-$C,$V.width,$V.height,$G,0,0,0,0));else{for($i=0,$I=$t.length;$i<$I;$i++)($D=$t[$i])&&!$D.isSpace&&($C=$D.borderSize,$V=$D.texture,$o._drawText($V,$B+$s-$C,$v-$C,$V.width,$V.height,$G,0,0,0,0),$J&&(($m=$J[$R++])||($m=$J[$R-1]=[]),$m[0]=$V,$m[1]=$s-$C,$m[2]=-$C)),$s+=$D.cw;$J&&($J.length=$R)}},$n._drawFast=function($J,$o,$r,$S,$G){for(var $z,$A,$h=0,$Z=$J.length;$h<$Z;$h++)($z=($A=$J[$h])[0]).active(),$o._drawText($z,$S+$A[1],$G+$A[2],$z.width,$z.height,$r,0,0,0,0)},$n.drawText=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v){if(void 0===$v&&($v=0),!($o&&0===$o.length||$r&&0===$r.length)){var $j=$S.a,$Y=$S.d;(0!==$S.b||0!==$S.c)&&($j=$Y=1);var $_=1!==$j||1!==$Y;if($_&&$e.stage.transform){var $D=$e.stage.transform;$_=$D.a===$j&&$D.d===$Y}else $_=!1;if($_){var $N=($S=$S.copyTo($yJ._tmpMatrix)).tx,$w=$S.ty;$S.scale(1/$j,1/$Y),$S._checkTransform(),$u*=$j,$B*=$Y,$u+=$N-$S.tx,$B+=$w-$S.ty}else $j=$Y=1;if($r)$n._drawSlow(null,$J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$j,$Y,$v);else{if(null===$o.toUpperCase){var $i=$j+1e5*$Y,$I=$o;return void($I.changed||$I.id!==$i?($I.id=$i,$I.changed=!1,$n._drawSlow($I.save,$J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$j,$Y,$v)):$n._drawFast($I.save,$J,$S,$u,$B))}var $t=$o+$G.toString()+$A+$h+$Z+$j+$Y+$z,$K=$n._textsCache[$t];$L.CharacterCache?$K?$n._drawFast($K,$J,$S,$u,$B):($n._textsCache.__length||($n._textsCache.__length=0),$n._textsCache.__length>$y.WebGLTextCacheCount&&(($n._textsCache={}).__length=0,$n._curPoolIndex=0),$n._textCachesPool[$n._curPoolIndex]?($K=$n._textsCache[$t]=$n._textCachesPool[$n._curPoolIndex]).length=0:$n._textCachesPool[$n._curPoolIndex]=$K=$n._textsCache[$t]=[],$n._textsCache.__length++,$n._curPoolIndex++,$n._drawSlow($K,$J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$j,$Y,$v)):$n._drawSlow($K,$J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$j,$Y,$v)}}},$n._charsTemp=null,$n._textCachesPool=[],$n._curPoolIndex=0,$n._charsCache={},$n._textsCache={},$n._drawValue=null,$n.d=[],$n._charSeg=null,$n.__init$=function(){$J=function(){function $Z(){}return $j($Z,""),$Z.prototype.value=function($J,$o,$r,$S,$G,$z,$A){this.font=$J,this.fillColor=$o,this.borderColor=$r,this.lineWidth=$S,this.scaleX=$G,this.scaleY=$z,this.underLine=$A;var $h=$J.toString()+$G+$z+$S+($o?$o.toLowerCase():" ")+($r?$r.toLowerCase():" ")+$A;return this.txtID=$Z._keymap[$h],this.txtID||(this.txtID=1e-7*++$Z._keymapCount,$Z._keymap[$h]=this.txtID),this},$Z.clear=function(){$Z._keymap={},$Z._keymapCount=1},$Z._keymap={},$Z._keymapCount=1,$Z}()},$n}(),$_J=function(){function $G($J){this._index=0,this._size=14,this._italic=-2,$G._cache2=$G._cache2||[],this.setFont($J||"14px Arial")}$j($G,"laya.webgl.text.FontInContext");var $J=$G.prototype;return $J.setFont=function($J){var $o=$G._cache2[$J];if($o)this._words=$o[0],this._size=$o[1];else{this._words=$J.split(" ");for(var $r=0,$S=this._words.length;$r<$S;$r++)if(0<this._words[$r].indexOf("px")){this._index=$r;break}this._size=parseInt(this._words[this._index]),$G._cache2[$J]=[this._words,this._size]}this._text=null,this._italic=-2},$J.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$J.hasType=function($J){for(var $o=0,$r=this._words.length;$o<$r;$o++)if(this._words[$o]===$J)return $o;return-1},$J.removeType=function($J){for(var $o=0,$r=this._words.length;$o<$r;$o++)if(this._words[$o]===$J){this._words.splice($o,1),this._index>$o&&this._index--;break}this._text=null,this._italic=-2},$J.copyTo=function($J){return $J._text=this._text,$J._size=this._size,$J._index=this._index,$J._words=this._words.slice(),$J._italic=-2,$J},$J.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$S(0,$J,"size",function(){return this._size},function($J){this._size=$J,this._words[this._index]=$J+"px",this._text=null}),$G.create=function($J){var $o=$G._cache[$J];return $o||($o=$G._cache[$J]=new $G($J))},$G.EMPTY=new $G,$G._cache={},$G._cache2=null,$G}(),$DJ=function(){function $J(){}return $j($J,"laya.webgl.utils.CONST3D2D"),$J.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$J.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$J.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$J._TMPARRAY=[],$J._OFFSETX=0,$J._OFFSETY=0,$A($J,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$J}(),$NJ=function(){function $_(){}return $j($_,"laya.webgl.utils.GlUtils"),$_.make2DProjection=function($J,$o,$r){return[2/$J,0,0,0,0,-2/$o,0,0,0,0,2/$r,0,-1,1,0,1]},$_.fillIBQuadrangle=function($J,$o){if(65535/4<$o)throw Error("IBQuadrangle count:"+$o+" must<:"+Math.floor(65535/4));$o=Math.floor($o),$J._resizeBuffer(6*($o+1)*2,!1),$J.byteLength=$J.bufferLength;for(var $r=$J.getUint16Array(),$S=0,$G=0;$G<$o;$G++)$r[$S++]=4*$G,$r[$S++]=4*$G+2,$r[$S++]=4*$G+1,$r[$S++]=4*$G,$r[$S++]=4*$G+3,$r[$S++]=4*$G+2;return $J.setNeedUpload(),!0},$_.expandIBQuadrangle=function($J,$o){$J.bufferLength>=6*$o*2||$_.fillIBQuadrangle($J,$o)},$_.mathCeilPowerOfTwo=function($J){return $J--,$J|=$J>>1,$J|=$J>>2,$J|=$J>>4,$J|=$J>>8,$J|=$J>>16,++$J},$_.fillQuadrangleImgVb=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=16+($J._byteLength>>2);$J.byteLength=$Z<<2;var $u=$J.getFloat32Array();$u[($Z-=16)+2]=$G[0],$u[$Z+3]=$G[1],$u[$Z+6]=$G[2],$u[$Z+7]=$G[3],$u[$Z+10]=$G[4],$u[$Z+11]=$G[5],$u[$Z+14]=$G[6],$u[$Z+15]=$G[7];var $B=$z.a,$v=$z.b,$j=$z.c,$Y=$z.d;if(1!==$B||0!==$v||0!==$j||1!==$Y){$z.bTransform=!0;var $_=$z.tx+$A,$D=$z.ty+$h;$u[$Z]=($S[0]+$o)*$B+($S[1]+$r)*$j+$_,$u[$Z+1]=($S[0]+$o)*$v+($S[1]+$r)*$Y+$D,$u[$Z+4]=($S[2]+$o)*$B+($S[3]+$r)*$j+$_,$u[$Z+5]=($S[2]+$o)*$v+($S[3]+$r)*$Y+$D,$u[$Z+8]=($S[4]+$o)*$B+($S[5]+$r)*$j+$_,$u[$Z+9]=($S[4]+$o)*$v+($S[5]+$r)*$Y+$D,$u[$Z+12]=($S[6]+$o)*$B+($S[7]+$r)*$j+$_,$u[$Z+13]=($S[6]+$o)*$v+($S[7]+$r)*$Y+$D}else $z.bTransform=!1,$o+=$z.tx+$A,$r+=$z.ty+$h,$u[$Z]=$o+$S[0],$u[$Z+1]=$r+$S[1],$u[$Z+4]=$o+$S[2],$u[$Z+5]=$r+$S[3],$u[$Z+8]=$o+$S[4],$u[$Z+9]=$r+$S[5],$u[$Z+12]=$o+$S[6],$u[$Z+13]=$r+$S[7];return $J._upload=!0},$_.fillTranglesVB=function($J,$o,$r,$S,$G,$z,$A){var $h=($J._byteLength>>2)+$S.length;$J.byteLength=$h<<2;var $Z=$J.getFloat32Array();$h-=$S.length;for(var $u=$S.length,$B=$G.a,$v=$G.b,$j=$G.c,$Y=$G.d,$_=0;$_<$u;$_+=4)if($Z[$h+$_+2]=$S[$_+2],$Z[$h+$_+3]=$S[$_+3],1!==$B||0!==$v||0!==$j||1!==$Y){$G.bTransform=!0;var $D=$G.tx+$z,$N=$G.ty+$A;$Z[$h+$_]=($S[$_]+$o)*$B+($S[$_+1]+$r)*$j+$D,$Z[$h+$_+1]=($S[$_]+$o)*$v+($S[$_+1]+$r)*$Y+$N}else $G.bTransform=!1,$o+=$G.tx+$z,$r+=$G.ty+$A,$Z[$h+$_]=$o+$S[$_],$Z[$h+$_+1]=$r+$S[$_+1];return $J._upload=!0},$_.copyPreImgVb=function($J,$o,$r){var $S=$J._byteLength>>2;$J.byteLength=$S+16<<2;for(var $G=$J.getFloat32Array(),$z=0,$A=$S-16;$z<4;$z++)$G[$S]=$G[$A]+$o,++$A,$G[++$S]=$G[$A]+$r,++$A,$G[++$S]=$G[$A],++$A,$G[++$S]=$G[$A],++$S,++$A;$J._upload=!0},$_.fillRectImgVb=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v,$j){void 0===$j&&($j=!1);var $Y,$_,$D,$N,$w,$i,$I,$t,$K,$e,$y,$g,$s,$V,$m,$C,$R=1,$n=$h.a,$k=$h.b,$U=$h.c,$L=$h.d,$Q=$o&&$o.width<99999999;if(1!==$n||0!==$k||0!==$U||1!==$L?($h.bTransform=!0,0===$k&&0===$U&&($R=23,$K=$G+$r,$e=$z+$S,$Y=$n*$r+($y=$h.tx+$Z),$D=$n*$K+$y,$_=$L*$S+($g=$h.ty+$u),$N=$L*$e+$g)):($R=23,$h.bTransform=!1,$D=($Y=$r+$h.tx+$Z)+$G,$N=($_=$S+$h.ty+$u)+$z),$Q&&($w=$o.x,$i=$o.y,$I=$o.width+$w,$t=$o.height+$i),1!==$R){if(Math.min($Y,$D)>=$I)return!1;if(Math.min($_,$N)>=$t)return!1;if(Math.max($D,$Y)<=$w)return!1;if(Math.max($N,$_)<=$i)return!1}var $p=$J._byteLength>>2;$J.byteLength=16+$p<<2;var $f=$J.getFloat32Array();switch($f[2+$p]=$A[0],$f[3+$p]=$A[1],$f[6+$p]=$A[2],$f[7+$p]=$A[3],$f[10+$p]=$A[4],$f[11+$p]=$A[5],$f[14+$p]=$A[6],$f[15+$p]=$A[7],$R){case 1:$y=$h.tx+$Z,$g=$h.ty+$u;var $F=$n*$r,$d=$U*$S,$l=$L*$S,$c=$k*$r,$T=$n*($K=$G+$r),$b=$U*($e=$z+$S),$$=$L*$e,$q=$k*$K;$j?($s=$F+$d+$y,$m=Math.round($s)-$s,$V=$l+$c+$g,$C=Math.round($V)-$V,$f[$p]=$s+$m,$f[1+$p]=$V+$C,$f[4+$p]=$T+$d+$y+$m,$f[5+$p]=$l+$q+$g+$C,$f[8+$p]=$T+$b+$y+$m,$f[9+$p]=$$+$q+$g+$C,$f[12+$p]=$F+$b+$y+$m,$f[13+$p]=$$+$c+$g+$C):($f[$p]=$F+$d+$y,$f[1+$p]=$l+$c+$g,$f[4+$p]=$T+$d+$y,$f[5+$p]=$l+$q+$g,$f[8+$p]=$T+$b+$y,$f[9+$p]=$$+$q+$g,$f[12+$p]=$F+$b+$y,$f[13+$p]=$$+$c+$g);break;case 23:$j?($s=$Y+$B,$m=Math.round($s)-$s,$V=$_,$C=Math.round($V)-$V,$f[$p]=$s+$m,$f[1+$p]=$V+$C,$f[4+$p]=$D+$B+$m,$f[5+$p]=$_+$C,$f[8+$p]=$D+$m,$f[9+$p]=$N+$C,$f[12+$p]=$Y+$m,$f[13+$p]=$N+$C):($f[$p]=$Y+$B,$f[1+$p]=$_,$f[4+$p]=$D+$B,$f[5+$p]=$_,$f[8+$p]=$D,$f[9+$p]=$N,$f[12+$p]=$Y,$f[13+$p]=$N)}return $J._upload=!0},$_.fillLineVb=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=.5*$A,$u=$_._fillLineArray,$B=-($S-$z),$v=$r-$G,$j=Math.sqrt($B*$B+$v*$v);$B/=$j,$v/=$j,$B*=$Z,$v*=$Z,$u[0]=$r-$B,$u[1]=$S-$v,$u[4]=$r+$B,$u[5]=$S+$v,$u[8]=$G+$B,$u[9]=$z+$v,$u[12]=$G-$B,$u[13]=$z-$v,$h&&$h.transformPointArray($u,$u);var $Y=16+($J._byteLength>>2);return $J.byteLength=$Y<<2,$J.insertData($u,$Y-16),!0},$_._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$_}(),$wJ=(function(){function $Z(){}$j($Z,"laya.webgl.utils.MatirxArray"),$Z.ArrayMul=function($J,$o,$r){if($J)if($o)for(var $S=NaN,$G=NaN,$z=NaN,$A=NaN,$h=0;$h<4;$h++)$S=$J[$h],$G=$J[$h+4],$z=$J[$h+8],$A=$J[$h+12],$r[$h]=$S*$o[0]+$G*$o[1]+$z*$o[2]+$A*$o[3],$r[$h+4]=$S*$o[4]+$G*$o[5]+$z*$o[6]+$A*$o[7],$r[$h+8]=$S*$o[8]+$G*$o[9]+$z*$o[10]+$A*$o[11],$r[$h+12]=$S*$o[12]+$G*$o[13]+$z*$o[14]+$A*$o[15];else $Z.copyArray($J,$r);else $Z.copyArray($o,$r)},$Z.copyArray=function($J,$o){if($J&&$o)for(var $r=0;$r<$J.length;$r++)$o[$r]=$J[$r]}}(),function(){function $o($J,$o,$r){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$J,this._vb=new $XJ($J,35048),$o&&this._vb._resizeBuffer($o,!1),this._ib=new $EJ,$r&&this._ib._resizeBuffer($r,!1)}$j($o,"laya.webgl.utils.Mesh2D");var $J=$o.prototype;return $J.cloneWithNewVB=function(){var $J=new $o(this._stride,0,0);return $J._ib=this._ib,$J._quadNum=this._quadNum,$J._attribInfo=this._attribInfo,$J},$J.cloneWithNewVBIB=function(){var $J=new $o(this._stride,0,0);return $J._attribInfo=this._attribInfo,$J},$J.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$J.getVBR=function(){return this._vb},$J.getIBR=function(){return this._ib},$J.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$J.createQuadIB=function($J){this._quadNum=$J,this._ib._resizeBuffer(6*$J*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $o=this._ib.getUint16Array(),$r=0,$S=0,$G=0;$G<$J;$G++)$o[$r++]=$S,$o[$r++]=$S+2,$o[$r++]=$S+1,$o[$r++]=$S,$o[$r++]=$S+3,$o[$r++]=$S+2,$S+=4;this._ib.setNeedUpload()},$J.setAttributes=function($J){if(this._attribInfo=$J,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$J.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$J.releaseMesh=function(){},$J.destroy=function(){},$J.clearVB=function(){this._vb.clear()},$o._gvaoid=0,$o}()),$iJ=function(){function $G(){}return $j($G,"laya.webgl.utils.RenderState2D"),$G.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$G.mat2MatArray=function($J,$o){var $r=$J,$S=$o;return $S[0]=$r.a,$S[1]=$r.b,$S[2]=$G.EMPTYMAT4_ARRAY[2],$S[3]=$G.EMPTYMAT4_ARRAY[3],$S[4]=$r.c,$S[5]=$r.d,$S[6]=$G.EMPTYMAT4_ARRAY[6],$S[7]=$G.EMPTYMAT4_ARRAY[7],$S[8]=$G.EMPTYMAT4_ARRAY[8],$S[9]=$G.EMPTYMAT4_ARRAY[9],$S[10]=$G.EMPTYMAT4_ARRAY[10],$S[11]=$G.EMPTYMAT4_ARRAY[11],$S[12]=$r.tx,$S[13]=$r.ty,$S[14]=$G.EMPTYMAT4_ARRAY[14],$S[15]=$G.EMPTYMAT4_ARRAY[15],$o},$G.restoreTempArray=function(){$G.TEMPMAT4_ARRAY[0]=1,$G.TEMPMAT4_ARRAY[1]=0,$G.TEMPMAT4_ARRAY[4]=0,$G.TEMPMAT4_ARRAY[5]=1,$G.TEMPMAT4_ARRAY[12]=0,$G.TEMPMAT4_ARRAY[13]=0},$G.clear=function(){$G.worldScissorTest=!1,$G.worldShaderDefines=null,$G.worldFilters=null,$G.worldAlpha=1,$G.worldClipRect.x=$G.worldClipRect.y=0,$G.worldClipRect.width=$G.width,$G.worldClipRect.height=$G.height,$G.curRenderTarget=null},$G._MAXSIZE=99999999,$G.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$G.worldMatrix4=$G.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$G.worldAlpha=1,$G.worldScissorTest=!1,$G.worldFilters=null,$G.worldShaderDefines=null,$G.curRenderTarget=null,$G.width=0,$G.height=0,$A($G,["worldMatrix",function(){return this.worldMatrix=new $s},"worldClipRect",function(){return this.worldClipRect=new $m(0,0,99999999,99999999)}]),$G}(),$IJ=function(){var $i,$r;function $I($J,$o,$r,$S,$G){var $z=this;function $A($J){var $o=[],$r=new $i($o);return $z._compileToTree($r,$J.split("\n"),0,$o,$G),$r}var $h=$Y.now();this._VS=$A($o),this._PS=$A($r),this._nameMap=$S,2<$Y.now()-$h&&console.log("ShaderCompile use time:"+($Y.now()-$h)+"  size:"+$o.length+"/"+$r.length)}$j($I,"laya.webgl.utils.ShaderCompile");var $J=$I.prototype;return $J._compileToTree=function($J,$o,$r,$S,$G){var $z,$A,$h,$Z,$u,$B,$v,$j=0,$Y=0,$_=0,$D=0;for($Y=$r;$Y<$o.length;$Y++)if(!(($h=$o[$Y]).length<1)&&0!==($j=$h.indexOf("//"))){if(0<=$j&&($h=$h.substr(0,$j)),$z=$v||new $i($S),$v=null,$z.text=$h,$z.noCompile=!0,0<=($j=$h.indexOf("#"))){for($Z="#",$D=$j+1,$_=$h.length;$D<$_;$D++){var $N=$h.charAt($D);if(" "===$N||"\t"===$N||"\r"===$N||"\n"===$N||"?"===$N)break;$Z+=$N}switch($z.name=$Z){case"#ifdef":case"#ifndef":if($z.src=$h,$z.noCompile=null!=$h.match(/[!&|()=<>]/),$z.noCompile?console.log("function():Boolean{return "+$h.substr($j+$z.name.length)+"}"):($B=$h.replace(/^\s*/,"").split(/\s+/),$z.setCondition($B[1],"#ifdef"===$Z?1:2),$z.text="//"+$z.text),$z.setParent($J),$J=$z,$G)for($B=$h.substr($D).split($I._splitToWordExps3),$D=0;$D<$B.length;$D++)($h=$B[$D]).length&&($G[$h]=!0);continue;case"#if":if($z.src=$h,$z.noCompile=!0,$z.setParent($J),$J=$z,$G)for($B=$h.substr($D).split($I._splitToWordExps3),$D=0;$D<$B.length;$D++)($h=$B[$D]).length&&"defined"!=$h&&($G[$h]=!0);continue;case"#else":$z.src=$h,$A=($J=$J.parent).childs[$J.childs.length-1],$z.noCompile=$A.noCompile,$z.noCompile||($z.condition=$A.condition,$z.conditionType=1==$A.conditionType?2:1,$z.text="//"+$z.text+" "+$A.text+" "+$z.conditionType),$z.setParent($J),$J=$z;continue;case"#endif":$A=($J=$J.parent).childs[$J.childs.length-1],$z.noCompile=$A.noCompile,$z.noCompile||($z.text="//"+$z.text),$z.setParent($J);continue;case"#include":$B=$I.splitToWords($h,null);var $w=$I.includes[$B[1]];if(!$w)throw"ShaderCompile error no this include file:"+$B[1];if(($j=$B[0].indexOf("?"))<0){$z.setParent($J),$h=$w.getWith("with"==$B[2]?$B[3]:null),this._compileToTree($z,$h.split("\n"),0,$S,$G),$z.text="";continue}$z.setCondition($B[0].substr($j+1),1),$z.text=$w.getWith("with"==$B[2]?$B[3]:null);break;case"#import":$u=($B=$I.splitToWords($h,null))[1],$S.push({node:$z,file:$I.includes[$u],ofs:$z.text.length});continue}}else{if(($A=$J.childs[$J.childs.length-1])&&!$A.name){0<$S.length&&$I.splitToWords($h,$A),$v=$z,$A.text+="\n"+$h;continue}0<$S.length&&$I.splitToWords($h,$z)}$z.setParent($J)}},$J.createShader=function($J,$o,$r){var $S={},$G="";if($J)for(var $z in $J)$G+="#define "+$z+"\n",$S[$z]=!0;var $A=this._VS.toscript($S,[]),$h=this._PS.toscript($S,[]);return($r||$MJ.create)($G+$A.join("\n"),$G+$h.join("\n"),$o,this._nameMap)},$I._parseOne=function($J,$o,$r,$S,$G,$z){var $A={type:$I.shaderParamsMap[$r[$S+1]],name:$r[$S+2],size:isNaN(parseInt($r[$S+3]))?1:parseInt($r[$S+3])};return $z&&("attribute"==$G?$J.push($A):$o.push($A)),":"==$r[$S+3]&&($A.type=$r[$S+4],$S+=2),$S+=2},$I.addInclude=function($J,$o){if(!$o||0===$o.length)throw new Error("add shader include file err:"+$J);if($I.includes[$J])throw new Error("add shader include file err, has add:"+$J);$I.includes[$J]=new $r($o)},$I.preGetParams=function($J,$o){var $r=[$J,$o],$S={},$G=[],$z=[],$A={},$h=[];$S.attributes=$G,$S.uniforms=$z,$S.defines=$A;for(var $Z=0,$u=0,$B=0;$B<2;$B++){$r[$B]=$r[$B].replace($I._removeAnnotation,"");var $v,$j=$r[$B].match($I._reg);for($Z=0,$u=$j.length;$Z<$u;$Z++){var $Y=$j[$Z];if("attribute"==$Y||"uniform"==$Y)$Z=$I._parseOne($G,$z,$j,$Z,$Y,!0);else{if("#define"==$Y){$h[$Y=$j[++$Z]]=1;continue}if("#ifdef"==$Y){$A[$v=$j[++$Z]]=$A[$v]||[];for($Z++;$Z<$u;$Z++)if("attribute"==($Y=$j[$Z])||"uniform"==$Y)$Z=$I._parseOne($G,$z,$j,$Z,$Y,$h[$v]);else if("#else"==$Y)for($Z++;$Z<$u;$Z++)if("attribute"==($Y=$j[$Z])||"uniform"==$Y)$Z=$I._parseOne($G,$z,$j,$Z,$Y,!$h[$v]);else if("#endif"==$Y)break}}}}return $S},$I.splitToWords=function($J,$o){for(var $r,$S,$G=[],$z=-1,$A=0,$h=$J.length;$A<$h;$A++)if($r=$J.charAt($A),0<=" \t=+-*/&%!<>()'\",;".indexOf($r)){if(0<=$z&&1<$A-$z&&($S=$J.substr($z,$A-$z),$G.push($S)),'"'==$r||"'"==$r){var $Z=$J.indexOf($r,$A+1);if($Z<0)throw"Sharder err:"+$J;$G.push($J.substr($A+1,$Z-$A-1)),$A=$Z,$z=-1;continue}"("==$r&&$o&&0<$G.length&&($S=$G[$G.length-1]+";","vec4;main;".indexOf($S)<0&&($o.useFuns+=$S)),$z=-1}else $z<0&&($z=$A);return $z<$h&&1<$h-$z&&($S=$J.substr($z,$h-$z),$G.push($S)),$G},$I.IFDEF_NO=0,$I.IFDEF_YES=1,$I.IFDEF_ELSE=2,$I.IFDEF_PARENT=3,$I._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$I._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$I._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$I.includes={},$A($I,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$I.__init$=function(){$i=function(){function $r($J){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$J}$j($r,"");var $J=$r.prototype;return $J.setParent=function($J){$J.childs.push(this),this.z=$J.z+1,this.parent=$J},$J.setCondition=function($J,$o){$J&&(this.conditionType=$o,$J=$J.replace(/(\s*$)/g,""),this.condition=function(){return this[$J]},this.condition.__condition=$J)},$J.toscript=function($J,$o){return this._toscript($J,$o,++$r.__id)},$J._toscript=function($S,$G,$z){if(this.childs.length<1&&!this.text)return $G;$G.length;if(this.condition){var $J=!!this.condition.call($S);if(2===this.conditionType&&($J=!$J),!$J)return $G}if(this.text&&$G.push(this.text),0<this.childs.length&&this.childs.forEach(function($J,$o,$r){$J._toscript($S,$G,$z)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $o,$r=0,$A=this.includefiles.length;$r<$A;$r++)this.includefiles[$r].curUseID!=$z&&0<($o=this.includefiles[$r].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$r].curUseID=$z,$G[0]=$o+$G[0]);return $G},$r.__id=1,$r}(),$r=function(){function $J($J){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$J;for(var $o=0,$r=0,$S=0;!(($o=$J.indexOf("#begin",$o))<0);){for($S=$o+5;!(($S=$J.indexOf("#end",$S))<0)&&"i"===$J.charAt($S+4);)$S+=5;if($S<0)throw"add include err,no #end:"+$J;$r=$J.indexOf("\n",$o);var $G=$I.splitToWords($J.substr($o,$r-$o),null);"code"==$G[1]?this.codes[$G[2]]=$J.substr($r+1,$S-$r-1):"function"==$G[1]&&($r=$J.indexOf("function",$o),$r+="function".length,this.funs[$G[3]]=$J.substr($r+1,$S-$r-1),this.funnames+=$G[3]+";"),$o=$S+1}}$j($J,"");var $o=$J.prototype;return $o.getWith=function($J){var $o=$J?this.codes[$J]:this.script;if(!$o)throw"get with error:"+$J;return $o},$o.getFunsScript=function($J){var $o="";for(var $r in this.funs)0<=$J.indexOf($r+";")&&($o+=this.funs[$r]);return $o},$J}()},$I}(),$tJ=function(){function $A(){}return $j($A,"laya.webgl.WebGL"),$A._uint8ArraySlice=function(){for(var $J=this.length,$o=new Uint8Array(this.length),$r=0;$r<$J;$r++)$o[$r]=this[$r];return $o},$A._float32ArraySlice=function(){for(var $J=this.length,$o=new Float32Array(this.length),$r=0;$r<$J;$r++)$o[$r]=this[$r];return $o},$A._uint16ArraySlice=function($J){var $o,$r=arguments,$S=0,$G=0;if(0===$r.length)for($S=this.length,$o=new Uint16Array($S),$G=0;$G<$S;$G++)$o[$G]=this[$G];else if(2===$r.length){var $z=$r[0],$A=$r[1];if($z<$A)for($S=$A-$z,$o=new Uint16Array($S),$G=$z;$G<$A;$G++)$o[$G-$z]=this[$G];else $o=new Uint16Array(0)}return $o},$A.expandContext=function(){var $J=$G.prototype,$o=CanvasRenderingContext2D.prototype;$o.fillTrangles=$J.fillTrangles,$OJ.__int__(null),$o.setIBVB=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){void 0===$Z&&($Z=0),void 0===$u&&($u=0),null===$r&&(this._ib=this._ib||$EJ.QuadrangleIB,$r=this._ib,$NJ.expandIBQuadrangle($r,$S._byteLength/64+8)),this._setIBVB($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u)},$o.fillTrangles=function($J,$o,$r,$S,$G){this._curMat=this._curMat||$s.create(),this._vb=this._vb||$XJ.create(),this._ib||(this._ib=$EJ.create(),$NJ.fillIBQuadrangle(this._ib,$A/4));var $z=this._vb,$A=$S.length>>4;$NJ.fillTranglesVB($z,$o,$r,$S,$G||this._curMat,0,0),$NJ.expandIBQuadrangle(this._ib,$z._byteLength/64+8);var $h=new $gJ(1,0);$h.textureHost=$J;var $Z=new $WJ("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$z._vertType=3,this._setIBVB($o,$r,this._ib,$z,6*$A,$G,$Z,$h,0,0)}},$A.enable=function(){if($Y.__init__(),$w.isConchApp&&!$w.isConchWebGL)return $K.skinAniSprite=function(){return new $JJ},$A.expandContext(),!1;if($K.getWebGLContext=function($J){for(var $o,$r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$S=0;$S<$r.length;$S++){try{$o=$J.getContext($r[$S],{stencil:$y.isStencil,alpha:$y.isAlpha,antialias:$y.isAntialias,premultipliedAlpha:$y.premultipliedAlpha,preserveDrawingBuffer:$y.preserveDrawingBuffer})}catch($J){}if($o)return $o}return null},null==($A.mainContext=$A.mainContext||$K.getWebGLContext($w._mainCanvas)))return!1;if($w.isWebGL)return!0;$D.create=function($J,$o){return new $Jo($J,$o)},$N.create=function($J,$o,$r,$S,$G,$z,$A){return new $xJ($J,$o,$r,$S,$G,$z,$A)},$w.WebGL=$A,$w.isWebGL=!0,$YJ.__init__(),$K.createRenderSprite=function($J,$o){return new $sJ($J,$o)},$K.createWebGLContext2D=function($J){return new $yJ($J)},$K.changeWebGLSize=function($J,$o){laya.webgl.WebGL.onStageResize($J,$o)},$K.createGraphics=function(){return new $eJ};var $J=$K.createFilterAction;return $K.createFilterAction=$J||function($J){return new $VJ},$K.clear=function($J){$iJ.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $o=$w.context.ctx,$r=0==$o._submits._length||$y.preserveDrawingBuffer?$_.create($J)._color:$R._wgColor;$r&&$o.clearBG($r[0],$r[1],$r[2],$r[3]),$iJ.clear()},$K.addToAtlas=function($J,$o){void 0===$o&&($o=!1);var $r=$J.bitmap;$w.optimizeTextureMemory($J.url,$J)?$e.__typeof($r,"laya.webgl.resource.IMergeAtlasBitmap")&&$r.allowMerageInAtlas&&$r.on("recovered",$J,$J.addTextureToAtlas):$r.enableMerageInAtlas=!1},$K.isAtlas=function($J){return $J instanceof laya.webgl.atlas.AtlasWebGLCanvas},$c._enable(),$K.beginFlush=function(){for(var $J=$c.instance,$o=$J.getAtlaserCount(),$r=0;$r<$o;$r++){var $S=$J.getAtlaserByIndex($r).texture;$S._flashCacheImageNeedFlush&&$K.flashFlushImage($S)}},$K.drawToCanvas=function($J,$o,$r,$S,$G,$z){($r<=0||$S<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$r|=0,$S|=0,$G|=0,$z|=0;var $A=$fJ.create($r,$S,6408,5121,0,!1);$A.start(),$A.clear(0,0,0,0),$w.context.clear(),$i.renders[$o]._fun($J,$w.context,$G,$iJ.height-$S+$z),$w.context.flush(),$A.end();var $h=$A.getData(0,0,$r,$S);if($A.recycle(),$h.byteLength==$r*$S*4){var $Z=new $qJ;$Z._canvas=$Y.createElement("canvas"),$Z.size($r,$S);var $u=$Z._canvas.getContext("2d");$Y.canvas.size($r,$S);var $B=$Y.context,$v=$B.createImageData($r,$S);return $v.data.set(new Uint8ClampedArray($h.buffer)),$Z._imgData=$v,$B.putImageData($v,0,0),$u.save(),$u.translate(0,$S),$u.scale(1,-1),$u.drawImage($Y.canvas.source,0,0),$u.restore(),$Z}console.log("drawToCanvas error: w:"+$r+",h:"+$S+",datalen:"+$h.byteLength)},$K.createFilterAction=function($J){var $o;switch($J){case 32:$o=new $VJ}return $o},$K.addTextureToAtlas=function($J){$J._uvID++,$c._atlasRestore++,$J.bitmap.enableMerageInAtlas&&$c.instance.addToAtlas($J)},$K.getTexturePixels=function($J,$o,$r,$S,$G){$w.context.ctx.clear();var $z=new $C;$z.graphics.drawTexture($J,-$o,-$r);var $A=$fJ.create($S,$G);$A.start(),$A.clear(0,0,0,0),$z.render($w.context,0,0),$w.context.ctx.flush(),$A.end();for(var $h=$A.getData(0,0,$S,$G),$Z=[],$u=0,$B=$G-1;0<=$B;$B--)for(var $v=0;$v<$S;$v++)$u=4*($B*$S+$v),$Z.push($h[$u]),$Z.push($h[$u+1]),$Z.push($h[$u+2]),$Z.push($h[$u+3]);return $Z},$K.skinAniSprite=function(){return new $JJ},$u.create=function($J,$o){var $r=new $qJ;return $r._imgData=$o,$r.flipY=!1,$r},$g._filterStart=function($J,$o,$r,$S,$G){var $z=$J.getValue("bounds"),$A=$fJ.create($z.width,$z.height);if($A.start(),$A.clear(0,0,0,0),$J.addValue("src",$A),$J.addValue("ScissorTest",$iJ.worldScissorTest),$iJ.worldScissorTest){var $h=new $m;$h.copyFrom($r.ctx._clipRect),$J.addValue("clipRect",$h),$iJ.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$g._filterEnd=function($J,$o,$r,$S,$G){var $z=$J.getValue("bounds");$J.getValue("src").end();var $A=$fJ.create($z.width,$z.height);$A.start(),$A.clear(0,0,0,0),$J.addValue("out",$A),$o._set$P("_filterCache",$A),$o._set$P("_isHaveGlowFilter",$J.getValue("_isHaveGlowFilter"))},$g._EndTarget=function($J,$o){if($J.getValue("src").recycle(),$J.getValue("out").end(),$J.getValue("ScissorTest")){$iJ.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$o.ctx.save();var $r=$J.getValue("clipRect");$o.ctx.clipRect($r.x,$r.y,$r.width,$r.height)}},$g._useSrc=function($J){var $o=$J.getValue("out");$o.end(),($o=$J.getValue("src")).start(),$o.clear(0,0,0,0)},$g._endSrc=function($J){$J.getValue("src").end()},$g._useOut=function($J){var $o=$J.getValue("src");$o.end(),($o=$J.getValue("out")).start(),$o.clear(0,0,0,0)},$g._endOut=function($J){$J.getValue("out").end()},$g._recycleScope=function($J){$J.recycle()},$g._filter=function($J,$o,$r,$S){var $G=this._next;if($G){var $z,$A,$h=$J.filters,$Z=$h.length;if(1==$Z&&32==$h[0].type)return $o.ctx.save(),$o.ctx.setFilters([$h[0]]),$G._fun.call($G,$J,$o,$r,$S),void $o.ctx.restore();var $u=$hJ.create(),$B=$V.TEMP,$v=$o.ctx._getTransformMatrix(),$j=$s.create();$v.copyTo($j);var $Y=0,$_=0,$D=!1,$N=$J._$P._filterCache?$J._$P._filterCache:null;if(!$N||$J._repaint){$D=$J._isHaveGlowFilter(),$u.addValue("_isHaveGlowFilter",$D),$D&&($Y=50,$_=25),($A=new $m).copyFrom($J.getSelfBounds()),$A.x+=$J.x,$A.y+=$J.y,$A.x-=$J.pivotX+4,$A.y-=$J.pivotY+4;var $w=$A.x,$i=$A.y;if($A.width+=$Y+8,$A.height+=$Y+8,$B.x=$A.x*$j.a+$A.y*$j.c,$B.y=$A.y*$j.d+$A.x*$j.b,$A.x=$B.x,$A.y=$B.y,$B.x=$A.width*$j.a+$A.height*$j.c,$B.y=$A.height*$j.d+$A.width*$j.b,$A.width=$B.x,$A.height=$B.y,$A.width<=0||$A.height<=0)return;$N&&$N.recycle(),$u.addValue("bounds",$A);var $I=$AJ.create([$u,$J,$o,0,0],$g._filterStart);$o.addRenderObject($I),$o.ctx._renderKey=0,$o.ctx._shader2D.glTexture=null;var $t=$J.x-$w+$_,$K=$J.y-$i+$_;$G._fun.call($G,$J,$o,$t,$K),$I=$AJ.create([$u,$J,$o,0,0],$g._filterEnd),$o.addRenderObject($I);for(var $e=0;$e<$Z;$e++){0!=$e&&($I=$AJ.create([$u],$g._useSrc),$o.addRenderObject($I),$z=$gJ.create(1,0),$s.TEMP.identity(),$o.ctx.drawTarget($u,0,0,$A.width,$A.height,$s.TEMP,"out",$z,null,$b.TOINT.overlay),$I=$AJ.create([$u],$g._useOut),$o.addRenderObject($I)),$h[$e].action.apply3d($u,$J,$o,0,0)}$I=$AJ.create([$u,$o],$g._EndTarget),$o.addRenderObject($I)}else{if(($D=!!$J._$P._isHaveGlowFilter&&$J._$P._isHaveGlowFilter)&&($Y=50,$_=25),($A=$J.getBounds()).width<=0||$A.height<=0)return;$A.width+=$Y,$A.height+=$Y,$B.x=$A.x*$j.a+$A.y*$j.c,$B.y=$A.y*$j.d+$A.x*$j.b,$A.x=$B.x,$A.y=$B.y,$B.x=$A.width*$j.a+$A.height*$j.c,$B.y=$A.height*$j.d+$A.width*$j.b,$A.width=$B.x,$A.height=$B.y,$u.addValue("out",$N)}$r=$r-$_-$J.x,$S=$S-$_-$J.y,$B.setTo($r,$S),$j.transformPoint($B),$r=$B.x+$A.x,$S=$B.y+$A.y,$z=$gJ.create(1,0),$s.TEMP.identity(),$o.ctx.drawTarget($u,$r,$S,$A.width,$A.height,$s.TEMP,"out",$z,null,$b.TOINT.overlay),$I=$AJ.create([$u],$g._recycleScope),$o.addRenderObject($I),$j.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$A._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$A._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$A._uint8ArraySlice),!0},$A.onStageResize=function($J,$o){null!=$A.mainContext&&($A.mainContext.viewport(0,0,$J,$o),$iJ.width=$J,$iJ.height=$o)},$A.onInvalidGLRes=function(){$c.instance.freeAll(),$t.releaseContentManagers(!0),$A.doNodeRepaint($e.stage),$A.mainContext.viewport(0,0,$iJ.width,$iJ.height),$e.stage.event("devicelost")},$A.doNodeRepaint=function($J){0==$J.numChildren&&$J.repaint();for(var $o=0;$o<$J.numChildren;$o++)$A.doNodeRepaint($J.getChildAt($o))},$A.init=function($J,$o,$r){$A.mainCanvas=$J,$u._createContext=function($J){return new $yJ($J)},$qJ._createContext=function($J){return new $yJ($J)};var $S=laya.webgl.WebGL.mainContext;if(null!=$S.getShaderPrecisionFormat){var $G=$S.getShaderPrecisionFormat(35633,36338),$z=$S.getShaderPrecisionFormat(35632,36338);$A.shaderHighPrecision=!(!$G.precision||!$z.precision)}else $A.shaderHighPrecision=!1;if($A.compressAstc=$S.getExtension("WEBGL_compressed_texture_astc"),$A.compressAtc=$S.getExtension("WEBGL_compressed_texture_atc"),$A.compressEtc=$S.getExtension("WEBGL_compressed_texture_etc"),$A.compressEtc1=$S.getExtension("WEBGL_compressed_texture_etc1"),$A.compressPvrtc=$S.getExtension("WEBGL_compressed_texture_pvrtc"),$A.compressS3tc=$S.getExtension("WEBGL_compressed_texture_s3tc"),$A.compressS3tc_srgb=$S.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$A.compressAstc=$A.compressAstc?$A.compressAstc:{},$A.compressAtc=$A.compressAtc?$A.compressAtc:{},$A.compressEtc=$A.compressEtc?$A.compressEtc:{},$A.compressEtc1=$A.compressEtc1?$A.compressEtc1:{},$A.compressPvrtc=$A.compressPvrtc?$A.compressPvrtc:{},$A.compressS3tc=$A.compressS3tc?$A.compressS3tc:{},$A.compressS3tc_srgb=$A.compressS3tc_srgb?$A.compressS3tc_srgb:{},$S.deleteTexture1=$S.deleteTexture,$S.deleteTexture=function($J){$J==$KJ.curBindTexValue&&($KJ.curBindTexValue=null),$S.deleteTexture1($J)},$A.onStageResize($o,$r),null==$A.mainContext)throw new Error("webGL getContext err!");$U.__init__(),$c.__init__(),$CJ.__init__(),$zJ.__init__(),$yJ.__init__(),$gJ.__init__(),$E.__init__(),$OJ.__int__($S),$b._init_($S),$w.isConchApp&&conch.setOnInvalidGLRes($A.onInvalidGLRes)},$A.mainCanvas=null,$A.antialias=!0,$A.shaderHighPrecision=!1,$A._bg_null=[0,0,0,0],$A}(),$KJ=function(){function $S(){}return $j($S,"laya.webgl.WebGLContext"),$S.UseProgram=function($J){return $S._useProgram!==$J&&($tJ.mainContext.useProgram($J),$S._useProgram=$J,!0)},$S.setDepthTest=function($J,$o){$o!==$S._depthTest&&(($S._depthTest=$o)?$J.enable(2929):$J.disable(2929))},$S.setDepthMask=function($J,$o){$o!==$S._depthMask&&($S._depthMask=$o,$J.depthMask($o))},$S.setDepthFunc=function($J,$o){$o!==$S._depthFunc&&($S._depthFunc=$o,$J.depthFunc($o))},$S.setBlend=function($J,$o){$o!==$S._blend&&(($S._blend=$o)?$J.enable(3042):$J.disable(3042))},$S.setBlendFunc=function($J,$o,$r){($o!==$S._sFactor||$r!==$S._dFactor)&&($S._sFactor=$o,$S._dFactor=$r,$J.blendFunc($o,$r))},$S.setCullFace=function($J,$o){$o!==$S._cullFace&&(($S._cullFace=$o)?$J.enable(2884):$J.disable(2884))},$S.setFrontFace=function($J,$o){$o!==$S._frontFace&&($S._frontFace=$o,$J.frontFace($o))},$S.bindTexture=function($J,$o,$r){$J.bindTexture($o,$r),$S.curBindTexTarget=$o,$S.curBindTexValue=$r},$S.DEPTH_BUFFER_BIT=256,$S.STENCIL_BUFFER_BIT=1024,$S.COLOR_BUFFER_BIT=16384,$S.POINTS=0,$S.LINES=1,$S.LINE_LOOP=2,$S.LINE_STRIP=3,$S.TRIANGLES=4,$S.TRIANGLE_STRIP=5,$S.TRIANGLE_FAN=6,$S.ZERO=0,$S.ONE=1,$S.SRC_COLOR=768,$S.ONE_MINUS_SRC_COLOR=769,$S.SRC_ALPHA=770,$S.ONE_MINUS_SRC_ALPHA=771,$S.DST_ALPHA=772,$S.ONE_MINUS_DST_ALPHA=773,$S.DST_COLOR=774,$S.ONE_MINUS_DST_COLOR=775,$S.SRC_ALPHA_SATURATE=776,$S.FUNC_ADD=32774,$S.BLEND_EQUATION=32777,$S.BLEND_EQUATION_RGB=32777,$S.BLEND_EQUATION_ALPHA=34877,$S.FUNC_SUBTRACT=32778,$S.FUNC_REVERSE_SUBTRACT=32779,$S.BLEND_DST_RGB=32968,$S.BLEND_SRC_RGB=32969,$S.BLEND_DST_ALPHA=32970,$S.BLEND_SRC_ALPHA=32971,$S.CONSTANT_COLOR=32769,$S.ONE_MINUS_CONSTANT_COLOR=32770,$S.CONSTANT_ALPHA=32771,$S.ONE_MINUS_CONSTANT_ALPHA=32772,$S.BLEND_COLOR=32773,$S.ARRAY_BUFFER=34962,$S.ELEMENT_ARRAY_BUFFER=34963,$S.ARRAY_BUFFER_BINDING=34964,$S.ELEMENT_ARRAY_BUFFER_BINDING=34965,$S.STREAM_DRAW=35040,$S.STATIC_DRAW=35044,$S.DYNAMIC_DRAW=35048,$S.BUFFER_SIZE=34660,$S.BUFFER_USAGE=34661,$S.CURRENT_VERTEX_ATTRIB=34342,$S.FRONT=1028,$S.BACK=1029,$S.CULL_FACE=2884,$S.FRONT_AND_BACK=1032,$S.BLEND=3042,$S.DITHER=3024,$S.STENCIL_TEST=2960,$S.DEPTH_TEST=2929,$S.SCISSOR_TEST=3089,$S.POLYGON_OFFSET_FILL=32823,$S.SAMPLE_ALPHA_TO_COVERAGE=32926,$S.SAMPLE_COVERAGE=32928,$S.NO_ERROR=0,$S.INVALID_ENUM=1280,$S.INVALID_VALUE=1281,$S.INVALID_OPERATION=1282,$S.OUT_OF_MEMORY=1285,$S.CW=2304,$S.CCW=2305,$S.LINE_WIDTH=2849,$S.ALIASED_POINT_SIZE_RANGE=33901,$S.ALIASED_LINE_WIDTH_RANGE=33902,$S.CULL_FACE_MODE=2885,$S.FRONT_FACE=2886,$S.DEPTH_RANGE=2928,$S.DEPTH_WRITEMASK=2930,$S.DEPTH_CLEAR_VALUE=2931,$S.DEPTH_FUNC=2932,$S.STENCIL_CLEAR_VALUE=2961,$S.STENCIL_FUNC=2962,$S.STENCIL_FAIL=2964,$S.STENCIL_PASS_DEPTH_FAIL=2965,$S.STENCIL_PASS_DEPTH_PASS=2966,$S.STENCIL_REF=2967,$S.STENCIL_VALUE_MASK=2963,$S.STENCIL_WRITEMASK=2968,$S.STENCIL_BACK_FUNC=34816,$S.STENCIL_BACK_FAIL=34817,$S.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$S.STENCIL_BACK_PASS_DEPTH_PASS=34819,$S.STENCIL_BACK_REF=36003,$S.STENCIL_BACK_VALUE_MASK=36004,$S.STENCIL_BACK_WRITEMASK=36005,$S.VIEWPORT=2978,$S.SCISSOR_BOX=3088,$S.COLOR_CLEAR_VALUE=3106,$S.COLOR_WRITEMASK=3107,$S.UNPACK_ALIGNMENT=3317,$S.PACK_ALIGNMENT=3333,$S.MAX_TEXTURE_SIZE=3379,$S.MAX_VIEWPORT_DIMS=3386,$S.SUBPIXEL_BITS=3408,$S.RED_BITS=3410,$S.GREEN_BITS=3411,$S.BLUE_BITS=3412,$S.ALPHA_BITS=3413,$S.DEPTH_BITS=3414,$S.STENCIL_BITS=3415,$S.POLYGON_OFFSET_UNITS=10752,$S.POLYGON_OFFSET_FACTOR=32824,$S.TEXTURE_BINDING_2D=32873,$S.SAMPLE_BUFFERS=32936,$S.SAMPLES=32937,$S.SAMPLE_COVERAGE_VALUE=32938,$S.SAMPLE_COVERAGE_INVERT=32939,$S.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$S.COMPRESSED_TEXTURE_FORMATS=34467,$S.DONT_CARE=4352,$S.FASTEST=4353,$S.NICEST=4354,$S.GENERATE_MIPMAP_HINT=33170,$S.BYTE=5120,$S.UNSIGNED_BYTE=5121,$S.SHORT=5122,$S.UNSIGNED_SHORT=5123,$S.INT=5124,$S.UNSIGNED_INT=5125,$S.FLOAT=5126,$S.DEPTH_COMPONENT=6402,$S.ALPHA=6406,$S.RGB=6407,$S.RGBA=6408,$S.LUMINANCE=6409,$S.LUMINANCE_ALPHA=6410,$S.UNSIGNED_SHORT_4_4_4_4=32819,$S.UNSIGNED_SHORT_5_5_5_1=32820,$S.UNSIGNED_SHORT_5_6_5=33635,$S.FRAGMENT_SHADER=35632,$S.VERTEX_SHADER=35633,$S.MAX_VERTEX_ATTRIBS=34921,$S.MAX_VERTEX_UNIFORM_VECTORS=36347,$S.MAX_VARYING_VECTORS=36348,$S.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$S.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$S.MAX_TEXTURE_IMAGE_UNITS=34930,$S.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$S.SHADER_TYPE=35663,$S.DELETE_STATUS=35712,$S.LINK_STATUS=35714,$S.VALIDATE_STATUS=35715,$S.ATTACHED_SHADERS=35717,$S.ACTIVE_UNIFORMS=35718,$S.ACTIVE_ATTRIBUTES=35721,$S.SHADING_LANGUAGE_VERSION=35724,$S.CURRENT_PROGRAM=35725,$S.NEVER=512,$S.LESS=513,$S.EQUAL=514,$S.LEQUAL=515,$S.GREATER=516,$S.NOTEQUAL=517,$S.GEQUAL=518,$S.ALWAYS=519,$S.KEEP=7680,$S.REPLACE=7681,$S.INCR=7682,$S.DECR=7683,$S.INVERT=5386,$S.INCR_WRAP=34055,$S.DECR_WRAP=34056,$S.VENDOR=7936,$S.RENDERER=7937,$S.VERSION=7938,$S.NEAREST=9728,$S.LINEAR=9729,$S.NEAREST_MIPMAP_NEAREST=9984,$S.LINEAR_MIPMAP_NEAREST=9985,$S.NEAREST_MIPMAP_LINEAR=9986,$S.LINEAR_MIPMAP_LINEAR=9987,$S.TEXTURE_MAG_FILTER=10240,$S.TEXTURE_MIN_FILTER=10241,$S.TEXTURE_WRAP_S=10242,$S.TEXTURE_WRAP_T=10243,$S.TEXTURE_2D=3553,$S.TEXTURE=5890,$S.TEXTURE_CUBE_MAP=34067,$S.TEXTURE_BINDING_CUBE_MAP=34068,$S.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$S.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$S.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$S.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$S.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$S.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$S.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$S.TEXTURE0=33984,$S.TEXTURE1=33985,$S.TEXTURE2=33986,$S.TEXTURE3=33987,$S.TEXTURE4=33988,$S.TEXTURE5=33989,$S.TEXTURE6=33990,$S.TEXTURE7=33991,$S.TEXTURE8=33992,$S.TEXTURE9=33993,$S.TEXTURE10=33994,$S.TEXTURE11=33995,$S.TEXTURE12=33996,$S.TEXTURE13=33997,$S.TEXTURE14=33998,$S.TEXTURE15=33999,$S.TEXTURE16=34e3,$S.TEXTURE17=34001,$S.TEXTURE18=34002,$S.TEXTURE19=34003,$S.TEXTURE20=34004,$S.TEXTURE21=34005,$S.TEXTURE22=34006,$S.TEXTURE23=34007,$S.TEXTURE24=34008,$S.TEXTURE25=34009,$S.TEXTURE26=34010,$S.TEXTURE27=34011,$S.TEXTURE28=34012,$S.TEXTURE29=34013,$S.TEXTURE30=34014,$S.TEXTURE31=34015,$S.ACTIVE_TEXTURE=34016,$S.REPEAT=10497,$S.CLAMP_TO_EDGE=33071,$S.MIRRORED_REPEAT=33648,$S.FLOAT_VEC2=35664,$S.FLOAT_VEC3=35665,$S.FLOAT_VEC4=35666,$S.INT_VEC2=35667,$S.INT_VEC3=35668,$S.INT_VEC4=35669,$S.BOOL=35670,$S.BOOL_VEC2=35671,$S.BOOL_VEC3=35672,$S.BOOL_VEC4=35673,$S.FLOAT_MAT2=35674,$S.FLOAT_MAT3=35675,$S.FLOAT_MAT4=35676,$S.SAMPLER_2D=35678,$S.SAMPLER_CUBE=35680,$S.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$S.VERTEX_ATTRIB_ARRAY_SIZE=34339,$S.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$S.VERTEX_ATTRIB_ARRAY_TYPE=34341,$S.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$S.VERTEX_ATTRIB_ARRAY_POINTER=34373,$S.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$S.COMPILE_STATUS=35713,$S.LOW_FLOAT=36336,$S.MEDIUM_FLOAT=36337,$S.HIGH_FLOAT=36338,$S.LOW_INT=36339,$S.MEDIUM_INT=36340,$S.HIGH_INT=36341,$S.FRAMEBUFFER=36160,$S.RENDERBUFFER=36161,$S.RGBA4=32854,$S.RGB5_A1=32855,$S.RGB565=36194,$S.DEPTH_COMPONENT16=33189,$S.STENCIL_INDEX=6401,$S.STENCIL_INDEX8=36168,$S.DEPTH_STENCIL=34041,$S.RENDERBUFFER_WIDTH=36162,$S.RENDERBUFFER_HEIGHT=36163,$S.RENDERBUFFER_INTERNAL_FORMAT=36164,$S.RENDERBUFFER_RED_SIZE=36176,$S.RENDERBUFFER_GREEN_SIZE=36177,$S.RENDERBUFFER_BLUE_SIZE=36178,$S.RENDERBUFFER_ALPHA_SIZE=36179,$S.RENDERBUFFER_DEPTH_SIZE=36180,$S.RENDERBUFFER_STENCIL_SIZE=36181,$S.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$S.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$S.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$S.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$S.COLOR_ATTACHMENT0=36064,$S.DEPTH_ATTACHMENT=36096,$S.STENCIL_ATTACHMENT=36128,$S.DEPTH_STENCIL_ATTACHMENT=33306,$S.NONE=0,$S.FRAMEBUFFER_COMPLETE=36053,$S.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$S.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$S.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$S.FRAMEBUFFER_UNSUPPORTED=36061,$S.FRAMEBUFFER_BINDING=36006,$S.RENDERBUFFER_BINDING=36007,$S.MAX_RENDERBUFFER_SIZE=34024,$S.INVALID_FRAMEBUFFER_OPERATION=1286,$S.UNPACK_FLIP_Y_WEBGL=37440,$S.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$S.CONTEXT_LOST_WEBGL=37442,$S.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$S.BROWSER_DEFAULT_WEBGL=37444,$S._useProgram=null,$S._depthTest=!0,$S._depthMask=!0,$S._blend=!1,$S._cullFace=!1,$S.curBindTexTarget=null,$S.curBindTexValue=null,$A($S,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$S}(),$eJ=function($J){function $o(){$o.__super.call(this)}$j($o,"laya.webgl.display.GraphicsGL",$h);var $r=$o.prototype;return $r.setShader=function($J){this._saveToCmd($w.context._setShader,[$J])},$r.setIBVB=function($J,$o,$r,$S,$G,$z){this._saveToCmd($w.context._setIBVB,[$J,$o,$r,$S,$G,$z])},$r.drawParticle=function($J,$o,$r){var $S=$K.createParticleTemplate2D($r);$S.x=$J,$S.y=$o,this._saveToCmd($w.context._drawParticle,[$S])},$o}(),$yJ=function($J){var $r;function $l($J){this._x=0,this._y=0,this._id=++$l._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$l.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$l.MAXCLIPRECT,this.mOutPoint,this._canvas=$J,this._canvas._addReference(),$l._contextcount++,$w.isFlash?(this._ib=$EJ.create(35044),$NJ.fillIBQuadrangle(this._ib,16)):this._ib=$EJ.QuadrangleIB,this.clear()}$j($l,"laya.webgl.canvas.WebGLContext2D",$G);var $o=$l.prototype;return $o.setIsMainContext=function(){this._isMain=!0},$o.clearBG=function($J,$o,$r,$S){var $G=$tJ.mainContext;$G.clearColor($J,$o,$r,$S),$G.clear(16384)},$o._getSubmits=function(){return this._submits},$o._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $J=0,$o=this._submits._length;$J<$o;$J++)this._submits[$J].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$o.destroy=function(){--$l._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$EJ.QuadrangleIB&&this._ib.releaseResource()},$o.clear=function(){this._submits||(this._other=$r.DEFAULT,this._curMat=$s.create(),this._vb=$XJ.create(-1),this._submits=[],this._save=[$M.Create(this)],this._save.length=10,this._shader2D=new $E,this._triangleMesh=$QJ.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$r.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$l.MAXCLIPRECT,this._curSubmit=$zJ.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$$.DEFAULT;for(var $J=0,$o=this._submits._length;$J<$o;$J++)this._submits[$J].releaseRender(),this._submits[$J]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$o.size=function($J,$o){if(this._width!=$J||this._height!=$o)if(0==$J||0==$o){0!=this._vb._byteLength&&(this._width=$J,this._height=$o,this._vb.clear(),this._vb.upload());for(var $r=0,$S=this._submits._length;$r<$S;$r++)this._submits[$r].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$J,this._height=$o,this._targets&&this._targets.size($J,$o),this._canvas.memorySize-=this._canvas.memorySize;0===$J&&0===$o&&this._releaseMem()},$o._getTransformMatrix=function(){return this._curMat},$o.translate=function($J,$o){0===$J&&0===$o||($P.save(this),this._curMat.bTransform&&($O.save(this),this._curMat.transformPointN($V.TEMP.setTo($J,$o)),$J=$V.TEMP.x,$o=$V.TEMP.y),this._x+=$J,this._y+=$o)},$o.save=function(){this._save[this._save._length++]=$M.Create(this)},$o.restore=function(){var $J=this._save._length;if(!($J<1))for(var $o=$J-1;0<=$o;$o--){var $r=this._save[$o];if($r.restore(this),$r.isSaveMark())return void(this._save._length=$o)}},$o._fillText=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){void 0===$u&&($u=0);var $B=this._shader2D,$v=this._curSubmit.shaderValue,$j=$G?$_J.create($G):this._other.font;if($c.enabled)$B.ALPHA!==$v.ALPHA&&($B.glTexture=null),$YJ.drawText(this,$J,$o,this._curMat,$j,$Z||this._other.textAlign,$z,$A,$h,$r,$S,$u);else{this._shader2D.defines.getValue();var $Y=$z?$_.create($z)._color:$B.colorAdd;$B.ALPHA===$v.ALPHA&&$Y===$B.colorAdd&&$v.colorAdd===$B.colorAdd||($B.glTexture=null,$B.colorAdd=$Y),$YJ.drawText(this,$J,$o,this._curMat,$j,$Z||this._other.textAlign,$z,$A,$h,$r,$S,$u)}},$o.fillWords=function($J,$o,$r,$S,$G,$z){this._fillText(null,$J,$o,$r,$S,$G,null,-1,null,$z)},$o.fillBorderWords=function($J,$o,$r,$S,$G,$z,$A){this._fillBorderText(null,$J,$o,$r,$S,$G,$z,$A,null)},$o.fillText=function($J,$o,$r,$S,$G,$z){this._fillText($J,null,$o,$r,$S,$G,null,-1,$z)},$o.strokeText=function($J,$o,$r,$S,$G,$z,$A){this._fillText($J,null,$o,$r,$S,null,$G,$z||1,$A)},$o.fillBorderText=function($J,$o,$r,$S,$G,$z,$A,$h){this._fillBorderText($J,null,$o,$r,$S,$G,$z,$A,$h)},$o._fillBorderText=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){if(!$c.enabled)return this._fillText($J,$o,$r,$S,$G,null,$A,$h||1,$Z),void this._fillText($J,$o,$r,$S,$G,$z,null,-1,$Z);var $u=this._shader2D,$B=this._curSubmit.shaderValue;$u.ALPHA!==$B.ALPHA&&($u.glTexture=null);var $v=$G?($l._fontTemp.setFont($G),$l._fontTemp):this._other.font;$YJ.drawText(this,$J,$o,this._curMat,$v,$Z||this._other.textAlign,$z,$A,$h||1,$r,$S,0)},$o.fillRect=function($J,$o,$r,$S,$G){var $z=this._vb;if($NJ.fillRectImgVb($z,this._clipRect,$J,$o,$r,$S,$Q.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $A=this._shader2D.fillStyle;$G&&(this._shader2D.fillStyle=$$.create($G));var $h=this._shader2D,$Z=this._curSubmit.shaderValue;if($h.fillStyle!==$Z.fillStyle||$h.ALPHA!==$Z.ALPHA){$h.glTexture=null;var $u=this._curSubmit=$zJ.createSubmit(this,this._ib,$z,($z._byteLength-64)/32*3,$gJ.create(2,0));$u.shaderValue.color=$h.fillStyle._color._color,$u.shaderValue.ALPHA=$h.ALPHA,this._submits[this._submits._length++]=$u}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$A}},$o.fillTexture=function($J,$o,$r,$S,$G,$z,$A,$h){if($J.loaded&&$J.bitmap&&$J.source){var $Z=this._vb,$u=$J.bitmap.width,$B=$J.bitmap.height,$v=$J.uv,$j=$A.x%$J.width,$Y=$A.y%$J.height;if($u!=$h.w||$B!=$h.h){if(!$h.w&&!$h.h)switch($h.oy=$h.ox=0,$z){case"repeat":$h.width=$S,$h.height=$G;break;case"repeat-x":$h.width=$S,$Y<0?$J.height+$Y>$G?$h.height=$G:$h.height=$J.height+$Y:($h.oy=$Y,$J.height+$Y>$G?$h.height=$G-$Y:$h.height=$J.height);break;case"repeat-y":$j<0?$J.width+$j>$S?$h.width=$S:$h.width=$J.width+$j:($h.ox=$j,$J.width+$j>$S?$h.width=$S-$j:$h.width=$J.width),$h.height=$G;break;case"no-repeat":$j<0?$J.width+$j>$S?$h.width=$S:$h.width=$J.width+$j:($h.ox=$j,$J.width+$j>$S?$h.width=$S-$j:$h.width=$J.width),$Y<0?$J.height+$Y>$G?$h.height=$G:$h.height=$J.height+$Y:($h.oy=$Y,$J.height+$Y>$G?$h.height=$G-$Y:$h.height=$J.height);break;default:$h.width=$S,$h.height=$G}$h.w=$u,$h.h=$B,$h.uv=[0,0,$h.width/$u,0,$h.width/$u,$h.height/$B,0,$h.height/$B]}if($o+=$h.ox,$r+=$h.oy,$j-=$h.ox,$Y-=$h.oy,$NJ.fillRectImgVb($Z,this._clipRect,$o,$r,$h.width,$h.height,$h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $_=$LJ.create(this,this._ib,$Z,($Z._byteLength-64)/32*3,$gJ.create(256,0)),$D=(this._submits[this._submits._length++]=$_).shaderValue;$D.textureHost=$J;var $N=$v[0]*$u,$w=$v[1]*$B,$i=($v[2]-$v[0])*$u,$I=($v[5]-$v[3])*$B,$t=-$j/$u,$K=-$Y/$B;$D.u_TexRange[0]=$N/$u,$D.u_TexRange[1]=$i/$u,$D.u_TexRange[2]=$w/$B,$D.u_TexRange[3]=$I/$B,$D.u_offset[0]=$t,$D.u_offset[1]=$K,$c.enabled&&!this._isMain&&$_.addTexture($J,($Z._byteLength>>2)-16),(this._curSubmit=$_)._renderType=10017,$_._numEle+=6}}else this.sprite&&$e.timer.callLater(this,this._repaintSprite)},$o.setShader=function($J){$H.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$J},$o.setFilters=function($J){$H.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$J,this._curSubmit=$zJ.RENDERBASE,this._renderKey=0,this._drawCount++},$o.drawTexture=function($J,$o,$r,$S,$G,$z,$A){this._drawTextureM($J,$o,$r,$S,$G,$z,$A,null,1)},$o.addTextureVb=function($J,$o,$r){var $S=this._curSubmit._vb||this._vb,$G=$S._byteLength>>2;$S.byteLength=$G+16<<2;for(var $z=$S.getFloat32Array(),$A=0;$A<16;$A+=4)$z[$G++]=$J[$A]+$o,$z[$G++]=$J[$A+1]+$r,$z[$G++]=$J[$A+2],$z[$G++]=$J[$A+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$S._upload=!0},$o.willDrawTexture=function($J,$o){if(!($J.loaded&&$J.bitmap&&$J.source))return this.sprite&&$e.timer.callLater(this,this._repaintSprite),0;var $r=$J.bitmap,$S=$r.id+this._shader2D.ALPHA*$o+10016;if($S==this._renderKey)return $S;var $G=this._shader2D,$z=$G.ALPHA,$A=this._curSubmit.shaderValue;$G.ALPHA*=$o,this._renderKey=$S,this._drawCount++,$G.glTexture=$r;var $h=this._vb,$Z=null,$u=$h._byteLength/32*3,$B=$A.textureHost&&$A.textureHost==$J&&$A.textureHost.alphaTexture==$J.alphaTexture;return $Z=$LJ.create(this,this._ib,$h,$u,$gJ.create(1,0)),(this._submits[this._submits._length++]=$Z).shaderValue.textureHost=$J,$Z._renderType=10016,$Z._preIsSameTextureShader=10016===this._curSubmit._renderType&&$G.ALPHA===$A.ALPHA&&$B,this._curSubmit=$Z,$G.ALPHA=$z,$S},$o.drawTextures=function($J,$o,$r,$S){if($J.loaded&&$J.bitmap&&$J.source){var $G=this._clipRect;if(this._clipRect=$l.MAXCLIPRECT,this._drawTextureM($J,$o[0],$o[1],$J.width,$J.height,$r,$S,null,1)){if(this._clipRect=$G,$n.drawCall++,!($o.length<4)){for(var $z=this._curSubmit._vb||this._vb,$A=this._curMat.a,$h=this._curMat.d,$Z=2,$u=$o.length;$Z<$u;$Z+=2)$NJ.copyPreImgVb($z,($o[$Z]-$o[$Z-2])*$A,($o[$Z+1]-$o[$Z-1])*$h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$e.timer.callLater(this,this._repaintSprite)},$o._drawTextureM=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){if(!$J.loaded||!$J.source)return this.sprite&&$e.timer.callLater(this,this._repaintSprite),!1;var $u=this._curSubmit._vb||this._vb,$B=$J.bitmap;$o+=$z,$r+=$A,this._drawCount++;var $v=$B.id+this._shader2D.ALPHA*$Z+10016;if($v!=this._renderKey){this._renderKey=$v;var $j=this._curSubmit.shaderValue,$Y=this._shader2D,$_=$Y.ALPHA;$Y.ALPHA*=$Z,$Y.glTexture=$B;var $D=this._vb,$N=null,$w=$D._byteLength/32*3,$i=$j.textureHost&&$j.textureHost==$J&&$j.textureHost.alphaTexture==$J.alphaTexture;$N=$LJ.create(this,this._ib,$D,$w,$gJ.create(1,0)),(this._submits[this._submits._length++]=$N).shaderValue.textureHost=$J,$N._renderType=10016,$N._preIsSameTextureShader=10016===this._curSubmit._renderType&&$Y.ALPHA===$j.ALPHA&&$i,this._curSubmit=$N,$u=this._curSubmit._vb||this._vb,$Y.ALPHA=$_}return!!$NJ.fillRectImgVb($u,this._clipRect,$o,$r,$S||$J.width,$G||$J.height,$J.uv,$h||this._curMat,this._x,this._y,0,0)&&($c.enabled&&!this._isMain&&this._curSubmit.addTexture($J,($u._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$o._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$o._drawText=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){var $B=$J.bitmap;this._drawCount++;var $v=$B.id+this._shader2D.ALPHA+10016;if($v!=this._renderKey){this._renderKey=$v;var $j=this._curSubmit.shaderValue,$Y=this._shader2D;$Y.glTexture=$B;var $_=this._vb,$D=null,$N=$_._byteLength/32*3,$w=$j.textureHost&&$j.textureHost==$J&&$j.textureHost.alphaTexture==$J.alphaTexture;($D=$c.enabled?$LJ.create(this,this._ib,$_,$N,$gJ.create(1,0)):$LJ.create(this,this._ib,$_,$N,$PJ.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$Y.ALPHA===$j.ALPHA&&$w,(this._submits[this._submits._length++]=$D).shaderValue.textureHost=$J,$D._renderType=10016,this._curSubmit=$D}$J.active();var $i=this._curSubmit._vb||this._vb;$NJ.fillRectImgVb($i,this._clipRect,$o+$A,$r+$h,$S||$J.width,$G||$J.height,$J.uv,$z||this._curMat,this._x,this._y,$Z,$u,!0)&&($c.enabled&&!this._isMain&&this._curSubmit.addTexture($J,($i._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$o.drawTextureWithTransform=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){if($z){var $u=this._curMat,$B=this._x,$v=this._y;(0!==$A||0!==$h)&&(this._x=$A*$u.a+$h*$u.c,this._y=$h*$u.d+$A*$u.b),$z&&$u.bTransform?($s.mul($z,$u,$l._tmpMatrix),($z=$l._tmpMatrix)._checkTransform()):(this._x+=$u.tx,this._y+=$u.ty),this._drawTextureM($J,$o,$r,$S,$G,0,0,$z,$Z),this._x=$B,this._y=$v}else this._drawTextureM($J,$o,$r,$S,$G,$A,$h,null,$Z)},$o.fillQuadrangle=function($J,$o,$r,$S,$G){var $z=this._curSubmit,$A=this._vb,$h=this._shader2D,$Z=$z.shaderValue;if(this._renderKey=0,$J.bitmap){var $u=$J.bitmap;$h.glTexture==$u&&$h.ALPHA===$Z.ALPHA||($h.glTexture=$u,($z=this._curSubmit=$zJ.createSubmit(this,this._ib,$A,$A._byteLength/32*3,$gJ.create(1,0))).shaderValue.glTexture=$u,this._submits[this._submits._length++]=$z),$NJ.fillQuadrangleImgVb($A,$o,$r,$S,$J.uv,$G||this._curMat,this._x,this._y)}else $z.shaderValue.fillStyle&&$z.shaderValue.fillStyle.equal($J)&&$h.ALPHA===$Z.ALPHA||($h.glTexture=null,($z=this._curSubmit=$zJ.createSubmit(this,this._ib,$A,$A._byteLength/32*3,$gJ.create(2,0))).shaderValue.defines.add(2),$z.shaderValue.fillStyle=$$.create($J),this._submits[this._submits._length++]=$z),$NJ.fillQuadrangleImgVb($A,$o,$r,$S,$Q.DEF_UV,$G||this._curMat,this._x,this._y);$z._numEle+=6},$o.drawTexture2=function($J,$o,$r,$S,$G,$z,$A,$h){if(0!=$z){var $Z=this._curMat;if(this._x=$J*$Z.a+$o*$Z.c,this._y=$o*$Z.d+$J*$Z.b,$G&&($G=$Z.bTransform||$G.bTransform?($s.mul($G,$Z,$l._tmpMatrix),$l._tmpMatrix):(this._x+=$G.tx+$Z.tx,this._y+=$G.ty+$Z.ty,$s.EMPTY)),1!==$z||$A){var $u=this._shader2D.ALPHA,$B=this._nBlendType;this._shader2D.ALPHA=$z,$A&&(this._nBlendType=$b.TOINT($A)),this._drawTextureM($h[0],$h[1]-$r,$h[2]-$S,$h[3],$h[4],0,0,$G,1),this._shader2D.ALPHA=$u,this._nBlendType=$B}else this._drawTextureM($h[0],$h[1]-$r,$h[2]-$S,$h[3],$h[4],0,0,$G,1);this._x=this._y=0}},$o.drawCanvas=function($J,$o,$r,$S,$G){var $z=$J.context;if(this._renderKey=0,$z._targets)this._submits[this._submits._length++]=$UJ.create($z,0,null),this._curSubmit=$zJ.RENDERBASE,$z._targets.drawTo(this,$o,$r,$S,$G);else{var $A=this._submits[this._submits._length++]=$UJ.create($z,this._shader2D.ALPHA,this._shader2D.filters),$h=$S/$J.width,$Z=$G/$J.height,$u=$A._matrix;this._curMat.copyTo($u),1!=$h&&1!=$Z&&$u.scale($h,$Z);var $B=$u.tx,$v=$u.ty;$u.tx=$u.ty=0,$u.transformPoint($V.TEMP.setTo($o,$r)),$u.translate($V.TEMP.x+$B,$V.TEMP.y+$v),this._curSubmit=$zJ.RENDERBASE}$y.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$z._targets?"yellow":"green",this.strokeRect($o-1,$r-1,$S+2,$G+2,1),this.strokeRect($o,$r,$S,$G,1),this.restore())},$o.drawTarget=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){void 0===$u&&($u=-1);var $B=this._vb;if($NJ.fillRectImgVb($B,this._clipRect,$o,$r,$S,$G,$Z||$Q.DEF_UV,$z||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $v=this._curSubmit=$vJ.create(this,this._ib,$B,($B._byteLength-64)/32*3,$h,$A);$v.blendType=-1==$u?this._nBlendType:$u,$v.scope=$J,this._submits[this._submits._length++]=$v,this._curSubmit._numEle+=6}},$o.mixRGBandAlpha=function($J){return this._mixRGBandAlpha($J,this._shader2D.ALPHA)},$o._mixRGBandAlpha=function($J,$o){var $r=(4278190080&$J)>>>24;return 0!=$r?$r*=$o:$r=255*$o,16777215&$J|$r<<24},$o.drawTriangles=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){if(!$J.loaded||!$J.source)return this.sprite&&$e.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$J.bitmap;var $B=this._mixRGBandAlpha(4294967295,$h),$v=($S.length,$z.length);this._renderKey=-1;var $j=this._curSubmit=$LJ.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$gJ.create(1,0));return $j.shaderValue.textureHost=$J,$j._renderType=10016,this._submits[this._submits._length++]=$j,$A?($l._tmpMatrix.a=$A.a,$l._tmpMatrix.b=$A.b,$l._tmpMatrix.c=$A.c,$l._tmpMatrix.d=$A.d,$l._tmpMatrix.tx=$A.tx+$o,$l._tmpMatrix.ty=$A.ty+$r,$s.mul($l._tmpMatrix,this._curMat,$l._tmpMatrix)):($l._tmpMatrix.a=this._curMat.a,$l._tmpMatrix.b=this._curMat.b,$l._tmpMatrix.c=this._curMat.c,$l._tmpMatrix.d=this._curMat.d,$l._tmpMatrix.tx=this._curMat.tx+$o,$l._tmpMatrix.ty=this._curMat.ty+$r),this._triangleMesh.addData($S,$G,$z,$l._tmpMatrix,$B,this),this._curSubmit._numEle+=$v,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$o.transform=function($J,$o,$r,$S,$G,$z){$O.save(this),$s.mul($s.TEMP.setTo($J,$o,$r,$S,$G,$z),this._curMat,this._curMat),this._curMat._checkTransform()},$o.setTransformByMatrix=function($J){$J.copyTo(this._curMat)},$o.transformByMatrix=function($J){$O.save(this),$s.mul($J,this._curMat,this._curMat),this._curMat._checkTransform()},$o.rotate=function($J){$O.save(this),this._curMat.rotateEx($J)},$o.scale=function($J,$o){$O.save(this),this._curMat.scaleEx($J,$o)},$o.clipRect=function($J,$o,$r,$S){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $G=$BJ.create(4);this.addRenderObject($G);var $z=this._vb,$A=$z._byteLength>>2;if($NJ.fillRectImgVb($z,null,$J,$o,$r,$S,$Q.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $h=this._curSubmit=$zJ.createSubmit(this,this._ib,$z,($z._byteLength-64)/32*3,$gJ.create(2,0));$h.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$h,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $Z=$BJ.create(5);this.addRenderObject($Z);var $u=$z.getFloat32Array(),$B=Math.min(Math.min(Math.min($u[0+$A],$u[4+$A]),$u[8+$A]),$u[12+$A]),$v=Math.max(Math.max(Math.max($u[0+$A],$u[4+$A]),$u[8+$A]),$u[12+$A]),$j=Math.min(Math.min(Math.min($u[1+$A],$u[5+$A]),$u[9+$A]),$u[13+$A]),$Y=Math.max(Math.max(Math.max($u[1+$A],$u[5+$A]),$u[9+$A]),$u[13+$A]);$x.save(this,$Z,$J,$o,$r,$S,$B,$j,$v-$B,$Y-$j),this._curSubmit=$zJ.RENDERBASE}else{$r*=this._curMat.a,$S*=this._curMat.d;var $_=$V.TEMP;this._curMat.transformPoint($_.setTo($J,$o)),$r<0&&($_.x=$_.x+$r,$r=-$r),$S<0&&($_.y=$_.y+$S,$S=-$S),this._renderKey=0;var $D=this._curSubmit=$uJ.create(this);(this._submits[this._submits._length++]=$D).submitIndex=this._submits._length,$D.submitLength=9999999,$a.save(this,$D);var $N=this._clipRect,$w=$N.x,$i=$N.y,$I=$_.x+$r,$t=$_.y+$S;$w<$_.x&&($N.x=$_.x),$i<$_.y&&($N.y=$_.y),$N.width=Math.min($I,$w+$N.width)-$N.x,$N.height=Math.min($t,$i+$N.height)-$N.y,this._shader2D.glTexture=null,$D.clipRect.copyFrom($N),this._curSubmit=$zJ.RENDERBASE}},$o.setIBVB=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B){if(void 0===$Z&&($Z=0),void 0===$u&&($u=0),void 0===$B&&($B=0),null===$r){if($w.isFlash){var $v=$S;$v._selfIB||($v._selfIB=$EJ.create(35044)),$v._selfIB.clear(),$r=$v._selfIB}else $r=this._ib;$NJ.expandIBQuadrangle($r,$S._byteLength/(4*$S.vertexStride*4))}if(!$h||!$A)throw Error("setIBVB must input:shader shaderValues");var $j=$ZJ.create(this,$S,$r,$G,$A,$h,$Z,$u,$B);$z||($z=$s.EMPTY),$z.translate($J,$o),$s.mul($z,this._curMat,$j._mat),$z.translate(-$J,-$o),this._submits[this._submits._length++]=$j,this._curSubmit=$zJ.RENDERBASE,this._renderKey=0},$o.addRenderObject=function($J){this._submits[this._submits._length++]=$J},$o.fillTrangles=function($J,$o,$r,$S,$G){var $z=this._curSubmit,$A=this._vb,$h=this._shader2D,$Z=$z.shaderValue,$u=$S.length>>4,$B=$J.bitmap;this._renderKey=0,$h.glTexture==$B&&$h.ALPHA===$Z.ALPHA||(($z=this._curSubmit=$zJ.createSubmit(this,this._ib,$A,$A._byteLength/32*3,$gJ.create(1,0))).shaderValue.textureHost=$J,this._submits[this._submits._length++]=$z),$NJ.fillTranglesVB($A,$o,$r,$S,$G||this._curMat,this._x,this._y),$z._numEle+=6*$u},$o.submitElement=function($J,$o){var $r=this._submits;for($o<0&&($o=$r._length);$J<$o;)$J+=$r[$J].renderSubmit()},$o.finish=function(){$tJ.mainContext.finish()},$o.flush=function(){var $J=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($J>this._ib.bufferLength/12&&$NJ.expandIBQuadrangle(this._ib,$J),!this._isMain&&$c.enabled&&$c._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$c._atlasRestore;for(var $o=this._submits,$r=0,$S=$o._length;$r<$S;$r++){var $G=$o[$r];10016===$G.getRenderType()&&$G.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$oJ.instance&&$oJ.getInstance().reset();var $z;for($r=0,$z=this.meshlist.length;$r<$z;$r++){var $A=this.meshlist[$r];$A.canReuse?$A.releaseMesh():$A.destroy()}return this.meshlist.length=0,this._curSubmit=$zJ.RENDERBASE,this._renderKey=0,this._triangleMesh=$QJ.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$o.setPathId=function($J){if(this.mId=$J,-1!=this.mId){this.mHaveKey=!1;var $o=$f.getInstance();$o.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$o.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$o.movePath=function($J,$o){var $r=$J,$S=$o;$J=this._curMat.a*$r+this._curMat.c*$S+this._curMat.tx,$o=this._curMat.b*$r+this._curMat.d*$S+this._curMat.ty,this.mX+=$J,this.mY+=$o},$o.beginPath=function(){var $J=this._getPath();$J.tempArray.length=0,$J.closePath=!1,this.mX=0,this.mY=0},$o.closePath=function(){this._path.closePath=!0},$o.fill=function($J){void 0===$J&&($J=!1);var $o=this._getPath();this.drawPoly(0,0,$o.tempArray,this.fillStyle._color.numColor,0,0,$J)},$o.stroke=function(){var $J=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$J.drawLine(0,0,$J.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $o=$f.getInstance().shapeLineDic[this.mId];$o.rebuild($J.tempArray),$J.setGeomtry($o)}else $f.getInstance().addLine(this.mId,$J.drawLine(0,0,$J.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$J.update();var $r=[this.mX,this.mY],$S=$zJ.createShape(this,$J.ib,$J.vb,$J.count,$J.offset,$gJ.create(4,0));$S.shaderValue.ALPHA=this._shader2D.ALPHA,$S.shaderValue.u_pos=$r,$S.shaderValue.u_mmat2=$iJ.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$S,this._renderKey=-1}},$o.line=function($J,$o,$r,$S,$G,$z){var $A=this._curSubmit,$h=this._vb;if($NJ.fillLineVb($h,this._clipRect,$J,$o,$r,$S,$G,$z)){this._renderKey=0;var $Z=this._shader2D,$u=$A.shaderValue;$Z.strokeStyle===$u.strokeStyle&&$Z.ALPHA===$u.ALPHA||($Z.glTexture=null,($A=this._curSubmit=$zJ.createSubmit(this,this._ib,$h,($h._byteLength-64)/32*3,$gJ.create(2,0))).shaderValue.strokeStyle=$Z.strokeStyle,$A.shaderValue.mainID=2,$A.shaderValue.ALPHA=$Z.ALPHA,this._submits[this._submits._length++]=$A),$A._numEle+=6}},$o.moveTo=function($J,$o,$r){void 0===$r&&($r=!0);var $S=this._getPath();if($r){var $G=$J,$z=$o;$J=this._curMat.a*$G+this._curMat.c*$z,$o=this._curMat.b*$G+this._curMat.d*$z}$S.addPoint($J,$o)},$o.lineTo=function($J,$o,$r){void 0===$r&&($r=!0);var $S=this._getPath();if($r){var $G=$J,$z=$o;$J=this._curMat.a*$G+this._curMat.c*$z,$o=this._curMat.b*$G+this._curMat.d*$z}$S.addPoint($J,$o)},$o.drawCurves=function($J,$o,$r){this.setPathId(-1),this.beginPath(),this.strokeStyle=$r[3],this.lineWidth=$r[4];var $S=$r[2];$J+=$r[0],$o+=$r[1],this.movePath($J,$o),this.moveTo($S[0],$S[1]);for(var $G=2,$z=$S.length;$G<$z;)this.quadraticCurveTo($S[$G++],$S[$G++],$S[$G++],$S[$G++]);this.stroke()},$o.arcTo=function($J,$o,$r,$S,$G){if(-1==this.mId||!this.mHaveKey){var $z=0,$A=0,$h=0,$Z=this._getPath();this._curMat.copyTo($l._tmpMatrix),$l._tmpMatrix.tx=$l._tmpMatrix.ty=0,$l._tempPoint.setTo($Z.getEndPointX(),$Z.getEndPointY()),$l._tmpMatrix.invertTransformPoint($l._tempPoint);var $u=$l._tempPoint.x-$J,$B=$l._tempPoint.y-$o,$v=Math.sqrt($u*$u+$B*$B);if(!($v<=1e-6)){var $j=$u/$v,$Y=$B/$v,$_=$r-$J,$D=$S-$o,$N=$_*$_+$D*$D,$w=Math.sqrt($N);if(!($w<=1e-6)){var $i=$_/$w,$I=$D/$w,$t=$j+$i,$K=$Y+$I,$e=Math.sqrt($t*$t+$K*$K);if(!($e<=1e-6)){var $y=$t/$e,$g=$K/$e,$s=Math.acos($y*$j+$g*$Y),$V=Math.PI/2-$s,$m=($v=$G/Math.tan($V))*$j+$J,$C=$v*$Y+$o,$R=Math.sqrt($v*$v+$G*$G),$n=$J+$y*$R,$k=$o+$g*$R,$U=0,$L=0;if(0<=$j*$I-$Y*$i){var $Q=2*$V/$l.SEGNUM;$U=Math.sin($Q),$L=Math.cos($Q)}else $Q=2*-$V/$l.SEGNUM,$U=Math.sin($Q),$L=Math.cos($Q);$A=this._curMat.a*$m+this._curMat.c*$C,$h=this._curMat.b*$m+this._curMat.d*$C,$A==this._path.getEndPointX()&&$h==this._path.getEndPointY()||$Z.addPoint($A,$h);var $p=$m-$n,$f=$C-$k;for($z=0;$z<$l.SEGNUM;$z++){var $F=$p*$L+$f*$U,$d=-$p*$U+$f*$L;$A=$F+$n,$h=$d+$k,$J=this._curMat.a*$A+this._curMat.c*$h,$h=$o=this._curMat.b*$A+this._curMat.d*$h,($A=$J)==this._path.getEndPointX()&&$h==this._path.getEndPointY()||$Z.addPoint($A,$h),$p=$F,$f=$d}}}}}},$o.arc=function($J,$o,$r,$S,$G,$z,$A){if(void 0===$z&&($z=!1),void 0===$A&&($A=!0),-1!=this.mId){var $h=$f.getInstance().shapeDic[this.mId];if($h&&this.mHaveKey&&!$h.needUpdate(this._curMat))return;$o=$J=0}var $Z,$u=0,$B=0,$v=0,$j=0,$Y=0,$_=0,$D=0;if($B=$G-$S,$z)if(Math.abs($B)>=2*Math.PI)$B=2*-Math.PI;else for(;0<$B;)$B-=2*Math.PI;else if(Math.abs($B)>=2*Math.PI)$B=2*Math.PI;else for(;$B<0;)$B+=2*Math.PI;$Z=$B/($D=$r<101?Math.max(10,$B*$r/5):$r<201?Math.max(10,$B*$r/20):Math.max(10,$B*$r/40))/2,$v=Math.abs(4/3*(1-Math.cos($Z))/Math.sin($Z)),$z&&($v=-$v);var $N=this._getPath(),$w=NaN,$i=NaN;for($_=0;$_<=$D;$_++)$u=$S+$B*($_/$D),$j=$J+Math.cos($u)*$r,$Y=$o+Math.sin($u)*$r,$A&&($w=$j,$i=$Y,$j=this._curMat.a*$w+this._curMat.c*$i,$Y=this._curMat.b*$w+this._curMat.d*$i),$j==this._path.getEndPointX()&&$Y==this._path.getEndPointY()||$N.addPoint($j,$Y);$j=$J+Math.cos($G)*$r,$Y=$o+Math.sin($G)*$r,$A&&($w=$j,$i=$Y,$j=this._curMat.a*$w+this._curMat.c*$i,$Y=this._curMat.b*$w+this._curMat.d*$i),$j==this._path.getEndPointX()&&$Y==this._path.getEndPointY()||$N.addPoint($j,$Y)},$o.quadraticCurveTo=function($J,$o,$r,$S){var $G=$v.I,$z=$r,$A=$S;$r=this._curMat.a*$z+this._curMat.c*$A,$S=this._curMat.b*$z+this._curMat.d*$A,$z=$J,$A=$o,$J=this._curMat.a*$z+this._curMat.c*$A,$o=this._curMat.b*$z+this._curMat.d*$A;for(var $h=$G.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$J,$o,$r,$S],30,2),$Z=0,$u=$h.length/2;$Z<$u;$Z++)this.lineTo($h[2*$Z],$h[2*$Z+1],!1);this.lineTo($r,$S,!1)},$o.rect=function($J,$o,$r,$S){this._other=this._other.make(),this._other.path||(this._other.path=new $q),this._other.path.rect($J,$o,$r,$S)},$o.strokeRect=function($J,$o,$r,$S,$G){var $z=.5*$G;this.line($J-$z,$o,$J+$r+$z,$o,$G,this._curMat),this.line($J+$r,$o,$J+$r,$o+$S,$G,this._curMat),this.line($J,$o,$J,$o+$S,$G,this._curMat),this.line($J-$z,$o+$S,$J+$r+$z,$o+$S,$G,this._curMat)},$o.clip=function(){},$o.drawPoly=function($J,$o,$r,$S,$G,$z,$A){void 0===$A&&($A=!1),this._renderKey=0,this._shader2D.glTexture=null;var $h=this._getPath();if(-1==this.mId)$h.polygon($J,$o,$r,$S,$G||1,$z);else if(this.mHaveKey){var $Z=$f.getInstance().shapeDic[this.mId];$Z.setMatrix(this._curMat),$Z.rebuild($h.tempArray),$h.setGeomtry($Z)}else{var $u=$h.polygon($J,$o,$r,$S,$G||1,$z);$f.getInstance().addShape(this.mId,$u),$u.setMatrix(this._curMat)}$h.update();var $B,$v=[this.mX,this.mY];if(($B=$zJ.createShape(this,$h.ib,$h.vb,$h.count,$h.offset,$gJ.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$B.shaderValue.u_pos=$v,$B.shaderValue.u_mmat2=$iJ.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$B,0<$G){if(this.mHaveLineKey){var $j=$f.getInstance().shapeLineDic[this.mId];$j.rebuild($h.tempArray),$h.setGeomtry($j)}else $f.getInstance().addShape(this.mId,$h.drawLine($J,$o,$r,$G,$z));$h.update(),($B=$zJ.createShape(this,$h.ib,$h.vb,$h.count,$h.offset,$gJ.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$B.shaderValue.u_mmat2=$iJ.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$B}},$o.drawParticle=function($J,$o,$r){$r.x=$J,$r.y=$o,this._submits[this._submits._length++]=$r},$o._getPath=function(){return this._path||(this._path=new $q)},$S(0,$o,"globalCompositeOperation",function(){return $b.NAMES[this._nBlendType]},function($J){var $o=$b.TOINT[$J];null==$o||this._nBlendType===$o||($H.save(this,65536,this,!0),this._curSubmit=$zJ.RENDERBASE,this._renderKey=0,this._nBlendType=$o)}),$S(0,$o,"strokeStyle",function(){return this._shader2D.strokeStyle},function($J){this._shader2D.strokeStyle.equal($J)||($H.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$$.create($J))}),$S(0,$o,"globalAlpha",function(){return this._shader2D.ALPHA},function($J){($J=Math.floor(1e3*$J)/1e3)!=this._shader2D.ALPHA&&($H.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$J)}),$S(0,$o,"asBitmap",null,function($J){if($J){if(this._targets||(this._targets=new $W),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$S(0,$o,"fillStyle",function(){return this._shader2D.fillStyle},function($J){this._shader2D.fillStyle.equal($J)||($H.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$$.create($J))}),$S(0,$o,"textAlign",function(){return this._other.textAlign},function($J){this._other.textAlign===$J||(this._other=this._other.make(),$H.save(this,32768,this._other,!1),this._other.textAlign=$J)}),$S(0,$o,"lineWidth",function(){return this._other.lineWidth},function($J){this._other.lineWidth===$J||(this._other=this._other.make(),$H.save(this,256,this._other,!1),this._other.lineWidth=$J)}),$S(0,$o,"textBaseline",function(){return this._other.textBaseline},function($J){this._other.textBaseline===$J||(this._other=this._other.make(),$H.save(this,16384,this._other,!1),this._other.textBaseline=$J)}),$S(0,$o,"font",null,function($J){$J!=this._other.font.toString()&&(this._other=this._other.make(),$H.save(this,8,this._other,!1),this._other.font===$_J.EMPTY?this._other.font=new $_J($J):this._other.font.setFont($J))}),$l.__init__=function(){$r.DEFAULT=new $r},$l._tempPoint=new $V,$l._SUBMITVBSIZE=32e3,$l._MAXSIZE=99999999,$l._RECTVBSIZE=16,$l.MAXCLIPRECT=new $m(0,0,99999999,99999999),$l._COUNT=0,$l._tmpMatrix=new $s,$l.SEGNUM=32,$l._contextcount=0,$A($l,["_fontTemp",function(){return this._fontTemp=new $_J},"_drawStyleTemp",function(){return this._drawStyleTemp=new $$(null)}]),$l.__init$=function(){$r=function(){function $J(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$_J.EMPTY}$j($J,"");var $o=$J.prototype;return $o.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$_J.EMPTY},$o.make=function(){return this===$J.DEFAULT?new $J:this},$J.DEFAULT=null,$J}()},$l}(),$gJ=function($J){function $S($J,$o){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$S.__super.call(this),this.defines=new $CJ,this.position=$S._POSITION,this.mainID=$J,this.subID=$o,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$J|$o,this._inClassCache=$S._cache[this._cacheID],0<$J&&!this._inClassCache&&(this._inClassCache=$S._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$j($S,"laya.webgl.shader.d2.value.Value2D",$d);var $o=$S.prototype;return $o.setValue=function($J){},$o.refresh=function(){var $J=this.size;return $J[0]=$iJ.width,$J[1]=$iJ.height,this.alpha=this.ALPHA*$iJ.worldAlpha,this.mmat=$iJ.worldMatrix4,this},$o._ShaderWithCompile=function(){return $MJ.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$WJ.create)},$o._withWorldShaderDefines=function(){var $J=$iJ.worldShaderDefines,$o=$MJ.sharders[this.mainID|this.defines._value|$J.getValue()];if(!$o){var $r,$S={};for($r in this.defines.toNameDic())$S[$r]="";for($r in $J.toNameDic())$S[$r]="";$o=$MJ.withCompile2D(0,this.mainID,$S,this.mainID|this.defines._value|$J.getValue(),$WJ.create)}var $G=$iJ.worldFilters;if(!$G)return $o;for(var $z,$A=$G.length,$h=0;$h<$A;$h++)($z=$G[$h])&&$z.action.setValue(this);return $o},$o.upload=function(){var $J=$iJ;this.alpha=this.ALPHA*$J.worldAlpha,$iJ.worldMatrix4!==$iJ.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$tJ.shaderHighPrecision&&this.defines.add(1024);var $o,$r=$J.worldShaderDefines?this._withWorldShaderDefines():$MJ.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$J.width,this.size[1]=$J.height,this.mmat=$J.worldMatrix4,$pJ.activeShader!==$r?$r._shaderValueWidth!==$J.width||$r._shaderValueHeight!==$J.height?($r._shaderValueWidth=$J.width,$r._shaderValueHeight=$J.height):$o=$r._params2dQuick2||$r._make2dQuick2():$r._shaderValueWidth!==$J.width||$r._shaderValueHeight!==$J.height?($r._shaderValueWidth=$J.width,$r._shaderValueHeight=$J.height):$o=$r._params2dQuick1||$r._make2dQuick1(),$r.upload(this,$o)},$o.setFilters=function($J){if(this.filters=$J)for(var $o,$r=$J.length,$S=0;$S<$r;$S++)($o=$J[$S])&&(this.defines.add($o.type),$o.action.setValue(this))},$o.clear=function(){this.defines.setValue(this.subID)},$o.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$S._initone=function($J,$o){$S._typeClass[$J]=$o,$S._cache[$J]=[],$S._cache[$J]._length=0},$S.__init__=function(){$S._POSITION=[2,5126,!1,4*$DJ.BYTES_PE,0],$S._TEXCOORD=[2,5126,!1,4*$DJ.BYTES_PE,2*$DJ.BYTES_PE],$S._initone(2,$lJ),$S._initone(4,$bJ),$S._initone(256,$cJ),$S._initone(512,$dJ),$S._initone(1,$TJ),$S._initone(65,$PJ),$S._initone(9,$TJ)},$S.create=function($J,$o){var $r=$S._cache[$J|$o];return $r._length?$r[--$r._length]:new $S._typeClass[$J|$o]($o)},$S._POSITION=null,$S._TEXCOORD=null,$S._cache=[],$S._typeClass=[],$S.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$S}(),$sJ=function($J){function $N($J,$o){$N.__super.call(this,$J,$o)}$j($N,"laya.webgl.utils.RenderSprite3D",$i);var $o=$N.prototype;return $o.onCreate=function($J){switch($J){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$o._mask=function($J,$o,$r,$S){var $G,$z,$A=this._next,$h=$J.mask;if($h){$o.ctx.save();var $Z=$o.ctx.globalCompositeOperation,$u=new $m;if($u.copyFrom($h.getBounds()),$u.width=Math.round($u.width),$u.height=Math.round($u.height),$u.x=Math.round($u.x),$u.y=Math.round($u.y),0<$u.width&&0<$u.height){var $B=$J._style._tf,$v=$hJ.create();$v.addValue("bounds",$u),$G=$AJ.create([$v,$o],laya.webgl.utils.RenderSprite3D.tmpTarget),$o.addRenderObject($G),$h.render($o,-$u.x,-$u.y),$G=$AJ.create([$v],laya.webgl.utils.RenderSprite3D.endTmpTarget),$o.addRenderObject($G),$o.ctx.save(),$o.clipRect($r-$B.translateX+$u.x,$S-$B.translateY+$u.y,$u.width,$u.height),$A._fun.call($A,$J,$o,$r,$S),$o.ctx.restore(),$z=$BJ.create(6),$Z=$o.ctx.globalCompositeOperation,$z.blendMode="mask",$o.addRenderObject($z),$s.TEMP.identity();var $j=$gJ.create(1,0),$Y=$Q.INV_UV,$_=$u.width,$D=$u.height;($u.width<32||$u.height<32)&&(($Y=$N.tempUV)[0]=0,$Y[1]=0,$Y[2]=32<=$u.width?1:$u.width/32,$Y[3]=0,$Y[4]=32<=$u.width?1:$u.width/32,$Y[5]=32<=$u.height?1:$u.height/32,$Y[6]=0,$Y[7]=32<=$u.height?1:$u.height/32,$u.width=32<=$u.width?$u.width:32,$u.height=32<=$u.height?$u.height:32,$Y[1]*=-1,$Y[3]*=-1,$Y[5]*=-1,$Y[7]*=-1,$Y[1]+=1,$Y[3]+=1,$Y[5]+=1,$Y[7]+=1),$o.ctx.drawTarget($v,$r+$u.x-$B.translateX,$S+$u.y-$B.translateY,$_,$D,$s.TEMP,"tmpTarget",$j,$Y,6),$G=$AJ.create([$v],laya.webgl.utils.RenderSprite3D.recycleTarget),$o.addRenderObject($G),($z=$BJ.create(6)).blendMode=$Z,$o.addRenderObject($z)}$o.ctx.restore()}else $A._fun.call($A,$J,$o,$r,$S)},$o._blend=function($J,$o,$r,$S){var $G=$J._style,$z=this._next;$G.blendMode?($o.ctx.save(),$o.ctx.globalCompositeOperation=$G.blendMode,$z._fun.call($z,$J,$o,$r,$S),$o.ctx.restore()):$z._fun.call($z,$J,$o,$r,$S)},$o._transform=function($J,$o,$r,$S){var $G=$J.transform,$z=this._next;if($G&&$z!=$i.NORENDER){var $A=$o.ctx;$J._style;$G.tx=$r,$G.ty=$S;var $h=$A._getTransformMatrix(),$Z=$h.clone();$s.mul($G,$h,$h),$h._checkTransform(),$G.tx=$G.ty=0,$z._fun.call($z,$J,$o,0,0),$Z.copyTo($h),$Z.destroy()}else $z._fun.call($z,$J,$o,$r,$S)},$N.tmpTarget=function($J,$o){var $r=$J.getValue("bounds"),$S=$fJ.create($r.width,$r.height);$S.start(),$S.clear(0,0,0,0),$J.addValue("tmpTarget",$S)},$N.endTmpTarget=function($J){$J.getValue("tmpTarget").end()},$N.recycleTarget=function($J){$J.getValue("tmpTarget").recycle(),$J.recycle()},$A($N,["tempUV",function(){return this.tempUV=new Array(8)}]),$N}(),$VJ=function($J){function $o(){this.data=null,$o.__super.call(this)}$j($o,"laya.filters.webgl.ColorFilterActionGL",$F);var $r=$o.prototype;return $e.imps($r,{"laya.filters.IFilterActionGL":!0}),$r.setValue=function($J){$J.colorMat=this.data._mat,$J.colorAlpha=this.data._alpha},$r.apply3d=function($J,$o,$r,$S,$G){var $z=$J.getValue("bounds"),$A=$gJ.create(1,0);$A.setFilters([this.data]);var $h=$s.TEMP;$h.identity(),$r.ctx.drawTarget($J,0,0,$z.width,$z.height,$h,"src",$A)},$o}(),$mJ=function($J){function $z($J,$o,$r,$S,$G){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$z.__super.call(this,$J,$o,$G),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $$J,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$r,this._atlasCanvas.height=$S,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$j($z,"laya.webgl.atlas.Atlaser",$l);var $o=$z.prototype;return $o.computeUVinAtlasTexture=function($J,$o,$r,$S){var $G=$c.atlasTextureWidth,$z=$c.atlasTextureHeight,$A=$r/$G,$h=$S/$z,$Z=($r+$J.bitmap.width)/$G,$u=($S+$J.bitmap.height)/$z,$B=$J.bitmap.width/$G,$v=$J.bitmap.height/$z;$J.uv=[$A+$o[0]*$B,$h+$o[1]*$v,$Z-(1-$o[2])*$B,$h+$o[3]*$v,$Z-(1-$o[4])*$B,$u-(1-$o[5])*$v,$A+$o[6]*$B,$u-(1-$o[7])*$v]},$o.findBitmapIsExist=function($J){if($J instanceof laya.webgl.resource.WebGLImage){var $o=$J,$r=$o.url,$S=this._InAtlasWebGLImagesKey[$r||$o.id];if($S)return $S.offsetInfoID}return-1},$o.addToAtlasTexture=function($J,$o,$r){if($J instanceof laya.webgl.resource.WebGLImage){var $S=$J,$G=$S.url;this._InAtlasWebGLImagesKey[$G||$S.id]={bitmap:$J,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$o,$r])}this._atlasCanvas.texSubImage2D($o,$r,$J.atlasSource),$J.clearAtlasSource()},$o.addToAtlas=function($J,$o,$r){$J._atlasID=this._inAtlasTextureKey.length;var $S=$J.uv.slice(),$G=$J.bitmap;this._inAtlasTextureKey.push($J),this._inAtlasTextureOriUVValue.push($S),this._inAtlasTextureBitmapValue.push($G),this.computeUVinAtlasTexture($J,$S,$o,$r),$J.bitmap=this._atlasCanvas},$o.clear=function(){for(var $J=0,$o=this._inAtlasTextureKey.length;$J<$o;$J++)this._inAtlasTextureKey[$J].bitmap=this._inAtlasTextureBitmapValue[$J],this._inAtlasTextureKey[$J].uv=this._inAtlasTextureOriUVValue[$J],this._inAtlasTextureKey[$J]._atlasID=-1,this._inAtlasTextureKey[$J].bitmap.lock=!1,this._inAtlasTextureKey[$J].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$o.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$S(0,$o,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$S(0,$o,"texture",function(){return this._atlasCanvas}),$S(0,$o,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$z}(),$CJ=function($J){function $r(){$r.__super.call(this,$r.__name2int,$r.__int2name,$r.__int2nameMap)}return $j($r,"laya.webgl.shader.d2.ShaderDefines2D",$X),$r.__init__=function(){$r.reg("TEXTURE2D",1),$r.reg("COLOR2D",2),$r.reg("PRIMITIVE",4),$r.reg("GLOW_FILTER",8),$r.reg("BLUR_FILTER",16),$r.reg("COLOR_FILTER",32),$r.reg("COLOR_ADD",64),$r.reg("WORLDMAT",128),$r.reg("FILLTEXTURE",256),$r.reg("FSHIGHPRECISION",1024),$r.reg("TXTALPHA",2048),$r.reg("TXTCOMPRESS",4096)},$r.reg=function($J,$o){$X._reg($J,$o,$r.__name2int,$r.__int2name)},$r.toText=function($J,$o,$r){return $X._toText($J,$o,$r)},$r.toInt=function($J){return $X._toInt($J,$r.__name2int)},$r.TEXTURE2D=1,$r.COLOR2D=2,$r.PRIMITIVE=4,$r.FILTERGLOW=8,$r.FILTERBLUR=16,$r.FILTERCOLOR=32,$r.COLORADD=64,$r.WORLDMAT=128,$r.FILLTEXTURE=256,$r.SKINMESH=512,$r.SHADERDEFINE_FSHIGHPRECISION=1024,$r.TXTALPHA=2048,$r.TXTCOMPRESS=4096,$r.__name2int={},$r.__int2name=[],$r.__int2nameMap=[],$r}(),$RJ=(function($J){function $h($J,$o,$r,$S,$G,$z,$A){$h.__super.call(this,$J,$o,$r,$S,40,$G,$z,$A)}$j($h,"laya.webgl.shapes.Ellipse",$rJ)}(),function($J){function $z($J,$o,$r,$S,$G){this._points=[],this.rebuild($r),$z.__super.call(this,$J,$o,0,0,0,$G,$S,$G,0)}$j($z,"laya.webgl.shapes.Line",$rJ);var $o=$z.prototype;return $o.rebuild=function($J){var $o=$J.length;$o!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($o/2-1)),this.mFloat32Array=new Float32Array(5*$o)),this._points.length=0;for(var $r=NaN,$S=NaN,$G=-1,$z=-1,$A=$J.length/2,$h=0;$h<$A;$h++)$r=$J[2*$h],$S=$J[2*$h+1],(.01<Math.abs($G-$r)||.01<Math.abs($z-$S))&&this._points.push($r,$S),$G=$r,$z=$S},$o.getData=function($J,$o,$r){var $S=[],$G=[];0<this.borderWidth&&this.createLine2(this._points,$S,this.borderWidth,$r,$G,this._points.length/2),this.mUint16Array.set($S,0),this.mFloat32Array.set($G,0),$J.append(this.mUint16Array),$o.append(this.mFloat32Array)},$z}()),$nJ=function($J){function $v($J,$o,$r,$S,$G){this._points=[];for(var $z=NaN,$A=NaN,$h=-1,$Z=-1,$u=$r.length/2-1,$B=0;$B<$u;$B++)$z=$r[2*$B],$A=$r[2*$B+1],(.01<Math.abs($h-$z)||.01<Math.abs($Z-$A))&&this._points.push($z,$A),$h=$z,$Z=$A;$z=$r[2*$u],$A=$r[2*$u+1],$h=this._points[0],$Z=this._points[1],(.01<Math.abs($h-$z)||.01<Math.abs($Z-$A))&&this._points.push($z,$A),$v.__super.call(this,$J,$o,0,0,this._points.length/2,0,$S,$G)}$j($v,"laya.webgl.shapes.LoopLine",$rJ);var $o=$v.prototype;return $o.getData=function($J,$o,$r){if(0<this.borderWidth){for(var $S=this.color,$G=($S>>16&255)/255,$z=($S>>8&255)/255,$A=(255&$S)/255,$h=[],$Z=0,$u=0,$B=[],$v=Math.floor(this._points.length/2),$j=0;$j<$v;$j++)$Z=this._points[2*$j],$u=this._points[2*$j+1],$h.push(this.x+$Z,this.y+$u,$G,$z,$A);this.createLoopLine($h,$B,this.borderWidth,$r+$h.length/5),$J.append(new Uint16Array($B)),$o.append(new Float32Array($h))}},$o.createLoopLine=function($J,$o,$r,$S,$G,$z){$J.length;var $A=$J.concat(),$h=$G||$J,$Z=this.borderColor,$u=($Z>>16&255)/255,$B=($Z>>8&255)/255,$v=(255&$Z)/255,$j=[$A[0],$A[1]],$Y=[$A[$A.length-5],$A[$A.length-4]],$_=$Y[0]+.5*($j[0]-$Y[0]),$D=$Y[1]+.5*($j[1]-$Y[1]);$A.unshift($_,$D,0,0,0),$A.push($_,$D,0,0,0);var $N,$w,$i,$I,$t,$K,$e,$y,$g,$s,$V,$m,$C,$R,$n,$k,$U,$L,$Q,$p,$f=$A.length/5,$F=$S,$d=$r/2;$i=$A[0],$I=$A[1],$s=$i-($t=$A[5]),$g=($g=-($I-($K=$A[6])))/($p=Math.sqrt($g*$g+$s*$s))*$d,$s=$s/$p*$d,$h.push($i-$g,$I-$s,$u,$B,$v,$i+$g,$I+$s,$u,$B,$v);for(var $l=1;$l<$f-1;$l++)$i=$A[5*($l-1)],$I=$A[5*($l-1)+1],$t=$A[5*$l],$K=$A[5*$l+1],$e=$A[5*($l+1)],$y=$A[5*($l+1)+1],$s=$i-$t,$m=$t-$e,$n=(-($g=($g=-($I-$K))/($p=Math.sqrt($g*$g+$s*$s))*$d)+$i)*(-($s=$s/$p*$d)+$K)-(-$g+$t)*(-$s+$I),$L=(-($V=($V=-($K-$y))/($p=Math.sqrt($V*$V+$m*$m))*$d)+$e)*(-($m=$m/$p*$d)+$K)-(-$V+$t)*(-$m+$y),$Q=($C=-$s+$I-(-$s+$K))*($U=-$V+$t-(-$V+$e))-($k=-$m+$y-(-$m+$K))*($R=-$g+$t-(-$g+$i)),Math.abs($Q)<.1?($Q+=10.1,$h.push($t-$g,$K-$s,$u,$B,$v,$t+$g,$K+$s,$u,$B,$v)):((($N=($R*$L-$U*$n)/$Q)-$t)*($N-$t)+(($w=($k*$n-$C*$L)/$Q)-$K)+($w-$K),$h.push($N,$w,$u,$B,$v,$t-($N-$t),$K-($w-$K),$u,$B,$v));$z&&($o=$z);var $c=this.edges+1;for($l=1;$l<$c;$l++)$o.push($F+2*($l-1),$F+2*($l-1)+1,$F+2*$l+1,$F+2*$l+1,$F+2*$l,$F+2*($l-1));return $o.push($F+2*($l-1),$F+2*($l-1)+1,$F+1,$F+1,$F,$F+2*($l-1)),$h},$v}(),$kJ=function($J){function $A($J,$o,$r,$S,$G,$z){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$s.create(),this._points=$r.slice(0,$r.length),$A.__super.call(this,$J,$o,0,0,this._points.length/2,$S,$G,$z)}$j($A,"laya.webgl.shapes.Polygon",$rJ);var $o=$A.prototype;return $o.rebuild=function($J){this._repaint||(this._points.length=0,this._points=this._points.concat($J))},$o.setMatrix=function($J){$J.copyTo(this._mat)},$o.needUpdate=function($J){return this._repaint=this._mat.a==$J.a&&this._mat.b==$J.b&&this._mat.c==$J.c&&this._mat.d==$J.d&&this._mat.tx==$J.tx&&this._mat.ty==$J.ty,!this._repaint},$o.getData=function($J,$o,$r){var $S,$G=0,$z=this._points,$A=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$r){for(this._start=$r,$S=[],$A=this.earcutTriangles.length,$G=0;$G<$A;$G++)$S.push(this.earcutTriangles[$G]+$r);this.mUint16Array=new Uint16Array($S)}}else{this._start=$r,$S=[];var $h=[],$Z=[],$u=this.color,$B=($u>>16&255)/255,$v=($u>>8&255)/255,$j=(255&$u)/255;for($A=Math.floor($z.length/2),$G=0;$G<$A;$G++)$h.push(this.x+$z[2*$G],this.y+$z[2*$G+1],$B,$v,$j),$Z.push(this.x+$z[2*$G],this.y+$z[2*$G+1]);for(this.earcutTriangles=$SJ.earcut($Z,null,2),$A=this.earcutTriangles.length,$G=0;$G<$A;$G++)$S.push(this.earcutTriangles[$G]+$r);this.mUint16Array=new Uint16Array($S),this.mFloat32Array=new Float32Array($h)}$J.append(this.mUint16Array),$o.append(this.mFloat32Array)},$A}(),$UJ=function($J){function $z(){this._matrix=new $s,this._matrix4=$DJ.defaultMatrix4.concat(),$z.__super.call(this,1e4),this.shaderValue=new $gJ(0,0)}$j($z,"laya.webgl.submit.SubmitCanvas",$zJ);var $o=$z.prototype;return $o.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $J=$iJ.worldAlpha,$o=$iJ.worldMatrix4,$r=$iJ.worldMatrix,$S=$iJ.worldFilters,$G=$iJ.worldShaderDefines,$z=this.shaderValue,$A=this._matrix,$h=this._matrix4,$Z=$s.TEMP;return $s.mul($A,$r,$Z),$h[0]=$Z.a,$h[1]=$Z.b,$h[4]=$Z.c,$h[5]=$Z.d,$h[12]=$Z.tx,$h[13]=$Z.ty,$iJ.worldMatrix=$Z.clone(),$iJ.worldMatrix4=$h,$iJ.worldAlpha=$iJ.worldAlpha*$z.alpha,$z.filters&&$z.filters.length&&($iJ.worldFilters=$z.filters,$iJ.worldShaderDefines=$z.defines),this._ctx_src.flush(),$iJ.worldAlpha=$J,$iJ.worldMatrix4=$o,$iJ.worldMatrix.destroy(),$iJ.worldMatrix=$r,$iJ.worldFilters=$S,$iJ.worldShaderDefines=$G,1},$o.releaseRender=function(){var $J=$z._cache;this._ctx_src=null,$J[$J._length++]=this},$o.getRenderType=function(){return 10003},$z.create=function($J,$o,$r){var $S=$z._cache._length?$z._cache[--$z._cache._length]:new $z;$S._ctx_src=$J;var $G=$S.shaderValue;return $G.alpha=$o,$G.defines.setValue(0),$r&&$r.length&&$G.setFilters($r),$S},$z._cache=(($z._cache=[])._length=0,$z._cache),$z}(),$LJ=function($J){function $u($J){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$J&&($J=1e4),$u.__super.call(this,$J)}$j($u,"laya.webgl.submit.SubmitTexture",$zJ);var $o=$u.prototype;return $o.releaseRender=function(){var $J=$u._cache;($J[$J._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$o.addTexture=function($J,$o){this._texsID[this._texs.length]=$J._uvID,this._texs.push($J),this._vbPos.push($o)},$o.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $J=this.shaderValue.textureHost.bitmap;if(null!==$J)for(var $o=this._vb.getFloat32Array(),$r=0,$S=this._texs.length;$r<$S;$r++){var $G=this._texs[$r];$G.active();var $z=$G.uv;if(this._texsID[$r]!==$G._uvID){this._texsID[$r]=$G._uvID;var $A=this._vbPos[$r];$o[$A+2]=$z[0],$o[$A+3]=$z[1],$o[$A+6]=$z[2],$o[$A+7]=$z[3],$o[$A+10]=$z[4],$o[$A+11]=$z[5],$o[$A+14]=$z[6],$o[$A+15]=$z[7],this._vb.setNeedUpload()}$G.bitmap!==$J&&(this._isSameTexture=!1)}}},$o.renderSubmit=function(){if(0===this._numEle)return $u._shaderSet=!1,1;var $J=this.shaderValue.textureHost;if($J){var $o=$J.source;if(!$J.bitmap||!$o)return $u._shaderSet=!1,1;this.shaderValue.texture=$o,$J.alphaTexture&&$J.alphaTexture.source&&(this.shaderValue.texture1=$J.alphaTexture.source)}this._vb.bind_upload(this._ib);var $r=$tJ.mainContext;if($b.activeBlendFunction!==this._blendFn&&($r.enable(3042),this._blendFn($r),$b.activeBlendFunction=this._blendFn),$n.drawCall++,$n.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$pJ.activeShader&&$u._shaderSet?($pJ.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$pJ.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$u._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $S=$J.bitmap,$G=0,$z=$pJ.activeShader,$A=0,$h=this._texs.length;$A<$h;$A++){var $Z=this._texs[$A];$Z.bitmap===$S&&$A+1!==$h||($z.uploadTexture2D($Z.source),$r.drawElements(4,6*($A-$G+1),5123,this._startIdx+6*$G*$DJ.BYTES_PIDX),$S=$Z.bitmap,$G=$A)}else $r.drawElements(4,this._numEle,5123,this._startIdx);return 1},$u.create=function($J,$o,$r,$S,$G){var $z=$u._cache._length?$u._cache[--$u._cache._length]:new $u;null==$r&&(($r=$z._selfVb||($z._selfVb=$XJ.create(-1))).clear(),$S=0),$z._ib=$o,$z._vb=$r,$z._startIdx=$S*$DJ.BYTES_PIDX,$z._numEle=0;var $A=$J._nBlendType;$z._blendFn=$J._targets?$b.targetFns[$A]:$b.fns[$A],$z.shaderValue=$G,$z.shaderValue.setValue($J._shader2D);var $h=$J._shader2D.filters;return $h&&$z.shaderValue.setFilters($h),$z},$u._cache=(($u._cache=[])._length=0,$u._cache),$u._shaderSet=!0,$u}(),$QJ=function($J){function $w(){$w.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$j($w,"laya.webgl.utils.MeshTexture",$wJ);var $o=$w.prototype;return $o.addData=function($J,$o,$r,$S,$G,$z){for(var $A=$J.length/2,$h=this._vb.needSize($A*$w.const_stride)>>2,$Z=this._vb.getFloat32Array(),$u=0,$B=0;$B<$A;$B++){var $v=$J[$u],$j=$J[$u+1],$Y=$v*$S.a+$j*$S.c+$S.tx,$_=$v*$S.b+$j*$S.d+$S.ty;$Z[$h++]=$Y,$Z[$h++]=$_,$Z[$h++]=$o[$u],$Z[$h++]=$o[$u+1],$u+=2}this._vb.setNeedUpload();var $D=this.vertNum;if(0<$D){($A=$r.length)>$w.tmpIdx.length&&($w.tmpIdx=new Uint16Array($A));for(var $N=0;$N<$A;$N++)$w.tmpIdx[$N]=$r[$N]+$D;this._ib.appendU16Array($w.tmpIdx,$r.length)}else this._ib.append($r);this._ib.setNeedUpload(),this.vertNum+=$A,this.indexNum+=$r.length},$o.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$o.destroy=function(){this._ib.destroy(),this._vb.destroy()},$w.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $w},$w.const_stride=16,$w._POOL=[],$A($w,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$w}(),$pJ=function($J){function $o(){$o.__super.call(this),this.lock=!0}return $j($o,"laya.webgl.shader.BaseShader",$I),$o.activeShader=null,$o.bindShader=null,$o}(),$fJ=function($o){function $B($J,$o,$r,$S,$G,$z,$A,$h,$Z){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$r&&($r=6408),void 0===$S&&($S=5121),void 0===$G&&($G=34041),void 0===$z&&($z=!1),void 0===$A&&($A=!1),void 0===$h&&($h=-1),void 0===$Z&&($Z=-1),this._type=1,this._w=$J,this._h=$o,this._surfaceFormat=$r,this._surfaceType=$S,this._depthStencilFormat=$G,$w.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$z,this._repeat=$A,this._minFifter=$h,this._magFifter=$Z,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$B.__super.call(this,this.bitmap,$Q.INV_UV)}$j($B,"laya.webgl.resource.RenderTarget2D",$o);var $J=$B.prototype;return $e.imps($J,{"laya.resource.IDispose":!0}),$J.getType=function(){return this._type},$J.getTexture=function(){return this},$J.size=function($J,$o){this._w==$J&&this._h==$o||(this._w=$J,this._h=$o,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$J.release=function(){this.destroy()},$J.recycle=function(){$B.POOL.push(this)},$J.start=function(){var $J=$tJ.mainContext;return this._preRenderTarget=$iJ.curRenderTarget,$iJ.curRenderTarget=this,$J.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($J.viewport(0,0,this._w,this._h),this._svWidth=$iJ.width,this._svHeight=$iJ.height,$iJ.width=this._w,$iJ.height=this._h,$pJ.activeShader=null),this},$J.clear=function($J,$o,$r,$S){void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=1);var $G=$tJ.mainContext;$G.clearColor($J,$o,$r,$S);var $z=16384;switch(this._depthStencilFormat){case 33189:$z|=256;break;case 36168:$z|=1024;break;case 34041:$z|=256,$z|=1024}$G.clear($z)},$J.end=function(){var $J=$tJ.mainContext;$J.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$iJ.curRenderTarget=this._preRenderTarget,1==this._type?($J.viewport(0,0,this._svWidth,this._svHeight),$iJ.width=this._svWidth,$iJ.height=this._svHeight,$pJ.activeShader=null):$J.viewport(0,0,$e.stage.width,$e.stage.height)},$J.getData=function($J,$o,$r,$S){var $G=$tJ.mainContext;if($G.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$G.checkFramebufferStatus(36160)))return $G.bindFramebuffer(36160,null),null;var $z=new Uint8Array(this._w*this._h*4);return $G.readPixels($J,$o,$r,$S,this._surfaceFormat,this._surfaceType,$z),$G.bindFramebuffer(36160,null),$z},$J.destroy=function($J){void 0===$J&&($J=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$o.prototype.destroy.call(this))},$J.dispose=function(){},$J._createWebGLRenderTarget=function(){this.bitmap=new $aJ(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($J){this.event("recovered")})},$S(0,$J,"surfaceFormat",function(){return this._surfaceFormat}),$S(0,$J,"magFifter",function(){return this._magFifter}),$S(0,$J,"surfaceType",function(){return this._surfaceType}),$S(0,$J,"mipMap",function(){return this._mipMap}),$S(0,$J,"depthStencilFormat",function(){return this._depthStencilFormat}),$S(0,$J,"minFifter",function(){return this._minFifter}),$S(0,$J,"source",function(){return this._alreadyResolved?$e.superGet($Q,this,"source"):null}),$B.create=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){void 0===$r&&($r=6408),void 0===$S&&($S=5121),void 0===$G&&($G=34041),void 0===$z&&($z=!1),void 0===$A&&($A=!1),void 0===$h&&($h=-1),void 0===$Z&&($Z=-1);var $u=$B.POOL.pop();return $u||($u=new $B($J,$o)),$u.bitmap&&$u._w==$J&&$u._h==$o&&$u._surfaceFormat==$r&&$u._surfaceType==$S&&$u._depthStencilFormat==$G&&$u._mipMap==$z&&$u._repeat==$A&&$u._minFifter==$h&&$u._magFifter==$Z||($u._w=$J,$u._h=$o,$u._surfaceFormat=$r,$u._surfaceType=$S,$u._depthStencilFormat=$G,$w.isConchWebGL&&34041===$u._depthStencilFormat&&($u._depthStencilFormat=33189),$u._mipMap=$z,$u._repeat=$A,$u._minFifter=$h,$u._magFifter=$Z,$u.release(),$u._createWebGLRenderTarget()),$u},$B.TYPE2D=1,$B.TYPE3D=2,$B.POOL=[],$B}($Q),$FJ=function($J){function $o(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$o.__super.call(this),$o._gl=$tJ.mainContext}$j($o,"laya.webgl.utils.Buffer",$I);var $r=$o.prototype;return $r._bind=function(){this.activeResource(),$o._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($o._bindVertexBuffer=this._glBuffer),$o._gl.bindBuffer(this._bufferType,$o._bindActive[this._bufferType]=this._glBuffer),$pJ.activeShader=null)},$r.recreateResource=function(){this._glBuffer||(this._glBuffer=$o._gl.createBuffer()),this.completeCreate()},$r.disposeResource=function(){this._glBuffer&&($tJ.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$S(0,$r,"bufferUsage",function(){return this._bufferUsage}),$o._gl=null,$o._bindActive={},$o._bindVertexBuffer=null,$o._enableAtributes=[],$o}(),$dJ=function($J){function $r($J){this.texcoord=null,this.offsetX=300,this.offsetY=0,$r.__super.call(this,512,0);var $o=8*$DJ.BYTES_PE;this.position=[2,5126,!1,$o,0],this.texcoord=[2,5126,!1,$o,2*$DJ.BYTES_PE],this.color=[4,5126,!1,$o,4*$DJ.BYTES_PE]}return $j($r,"laya.webgl.shader.d2.skinAnishader.SkinSV",$gJ),$r}(),$lJ=function($J){function $o($J){$o.__super.call(this,2,0),this.color=[]}return $j($o,"laya.webgl.shader.d2.value.Color2dSV",$gJ),$o.prototype.setValue=function($J){$J.fillStyle&&(this.color=$J.fillStyle._color._color),$J.strokeStyle&&(this.color=$J.strokeStyle._color._color)},$o}(),$cJ=function($J){function $o($J){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$gJ._TEXCOORD,$o.__super.call(this,256,0)}$j($o,"laya.webgl.shader.d2.value.FillTextureSV",$gJ);var $r=$o.prototype;return $r.setValue=function($J){this.ALPHA=$J.ALPHA,$J.filters&&this.setFilters($J.filters)},$r.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$o}(),$TJ=function($J){function $o($J){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$gJ._TEXCOORD,void 0===$J&&($J=0),$o.__super.call(this,1,$J)}$j($o,"laya.webgl.shader.d2.value.TextureSV",$gJ);var $r=$o.prototype;return $r.setValue=function($J){this.ALPHA=$J.ALPHA,$J.filters&&this.setFilters($J.filters)},$r.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$o}(),$bJ=function($J){function $o($J){this.a_color=null,this.u_pos=[0,0],$o.__super.call(this,4,0),this.position=[2,5126,!1,5*$DJ.BYTES_PE,0],this.a_color=[3,5126,!1,5*$DJ.BYTES_PE,2*$DJ.BYTES_PE]}return $j($o,"laya.webgl.shader.d2.value.PrimitiveSV",$gJ),$o}(),$$J=function($J){function $o(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$o.__super.call(this)}$j($o,"laya.webgl.atlas.AtlasWebGLCanvas",$J);var $r=$o.prototype;return $r.recreateResource=function(){var $J=$tJ.mainContext,$o=this._source=$J.createTexture(),$r=$KJ.curBindTexTarget,$S=$KJ.curBindTexValue;$KJ.bindTexture($J,3553,$o),$J.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$J.texParameteri(3553,10241,9729),$J.texParameteri(3553,10240,9729),$J.texParameteri(3553,10242,33071),$J.texParameteri(3553,10243,33071),$r&&$S&&$KJ.bindTexture($J,$r,$S),this.memorySize=this._w*this._h*4,this.completeCreate()},$r.disposeResource=function(){this._source&&($tJ.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$r.texSubImage2D=function($J,$o,$r){if($w.isFlash){this._flashCacheImage||(this._flashCacheImage=$D.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $S=$r.bitmapdata;this._flashCacheImage._image.copyPixels($S,0,0,$S.width,$S.height,$J,$o),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $G=$tJ.mainContext,$z=$KJ.curBindTexTarget,$A=$KJ.curBindTexValue;$KJ.bindTexture($G,3553,this._source),$G.pixelStorei(37441,!0),0<=$J-1&&$G.texSubImage2D(3553,0,$J-1,$o,6408,5121,$r),$J+1<=this._w&&$G.texSubImage2D(3553,0,$J+1,$o,6408,5121,$r),0<=$o-1&&$G.texSubImage2D(3553,0,$J,$o-1,6408,5121,$r),$o+1<=this._h&&$G.texSubImage2D(3553,0,$J,$o+1,6408,5121,$r),$G.texSubImage2D(3553,0,$J,$o,6408,5121,$r),$G.pixelStorei(37441,!1),$z&&$A&&$KJ.bindTexture($G,$z,$A)}},$r.texSubImage2DPixel=function($J,$o,$r,$S,$G){var $z=$tJ.mainContext,$A=$KJ.curBindTexTarget,$h=$KJ.curBindTexValue;$KJ.bindTexture($z,3553,this._source);var $Z=new Uint8Array($G.data);$z.pixelStorei(37441,!0),$z.texSubImage2D(3553,0,$J,$o,$r,$S,6408,5121,$Z),$z.pixelStorei(37441,!1),$A&&$h&&$KJ.bindTexture($z,$A,$h)},$S(0,$r,"width",$J.prototype._$get_width,function($J){this._w=$J}),$S(0,$r,"height",$J.prototype._$get_height,function($J){this._h=$J}),$o}($r),$qJ=function($J){function $G(){this.flipY=!0,this.alwaysChange=!1,$G.__super.call(this)}$j($G,"laya.webgl.resource.WebGLCanvas",$r);var $o=$G.prototype;return $o.getCanvas=function(){return this._canvas},$o.clear=function(){this._ctx&&this._ctx.clear()},$o.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$o._setContext=function($J){this._ctx=$J},$o.getContext=function($J,$o){return this._ctx?this._ctx:this._ctx=$G._createContext(this)},$o.size=function($J,$o){this._w==$J&&this._h==$o||(this._w=$J,this._h=$o,this._ctx&&this._ctx.size($J,$o),this._canvas&&(this._canvas.height=$o,this._canvas.width=$J))},$o.activeResource=function($J){void 0===$J&&($J=!1),this._source||this.recreateResource()},$o.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$o.disposeResource=function(){this._source&&!this.iscpuSource&&($tJ.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$o.createWebGlTexture=function(){var $J=$tJ.mainContext;this._canvas;var $o=this._source=$J.createTexture();this.iscpuSource=!1;var $r=$KJ.curBindTexTarget,$S=$KJ.curBindTexValue;$KJ.bindTexture($J,3553,$o),$J.pixelStorei(37440,this.flipY?1:0),$G.premulAlpha&&$J.pixelStorei(37441,!0),$J.texImage2D(3553,0,6408,6408,5121,this._imgData),$G.premulAlpha&&$J.pixelStorei(37441,!1),$J.texParameteri(3553,10240,9729),$J.texParameteri(3553,10241,9729),$J.texParameteri(3553,10242,33071),$J.texParameteri(3553,10243,33071),$J.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$r&&$S&&$KJ.bindTexture($J,$r,$S)},$o.reloadCanvasData=function(){var $J=$tJ.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $o=$KJ.curBindTexTarget,$r=$KJ.curBindTexValue;$KJ.bindTexture($J,3553,this._source),$G.premulAlpha&&$J.pixelStorei(37441,!0),$J.texImage2D(3553,0,6408,6408,5121,this._imgData),$G.premulAlpha&&$J.pixelStorei(37441,!1),$J.pixelStorei(37440,0),$o&&$r&&$KJ.bindTexture($J,$o,$r)},$o.texSubImage2D=function($J,$o,$r){var $S=$tJ.mainContext,$G=$KJ.curBindTexTarget,$z=$KJ.curBindTexValue;$KJ.bindTexture($S,3553,this._source),$S.pixelStorei(37441,!0),$S.texSubImage2D(3553,0,$o,$r,6408,5121,$J._source),$S.pixelStorei(37441,!1),$G&&$z&&$KJ.bindTexture($S,$G,$z)},$o.toBase64=function($J,$o,$r){var $S=null;this._canvas&&($S=this._canvas.toDataURL($J,$o)),$r.call(this,$S)},$S(0,$o,"context",function(){return this._ctx}),$S(0,$o,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$S(0,$o,"asBitmap",null,function($J){this._ctx&&(this._ctx.asBitmap=$J)}),$G._createContext=null,$G.premulAlpha=!1,$G}(),$HJ=function($J){function $z($J,$o){this.CborderSize=12,$z.__super.call(this),this.char=$J,this.isSpace=" "===$J,this.xs=$o.scaleX,this.ys=$o.scaleY,this.font=$o.font.toString(),this.fontSize=$o.font.size,this.fillColor=$o.fillColor,this.borderColor=$o.borderColor,this.lineWidth=$o.lineWidth,this.underLine=$o.underLine;var $r,$S=$w.isConchApp;$S?(($r=ConchTextCanvas)._source=ConchTextCanvas,$r._source.canvas=ConchTextCanvas):$r=$Y.canvas.source,this.canvas=$r,this._enableMerageInAtlas=!0,this._ctx=$S?$r:this.canvas.getContext("2d",void 0);var $G=$p.measureText(this.char,this.font);this.cw=$G.width*this.xs,this.ch=($G.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $Q(this)}$j($z,"laya.webgl.resource.WebGLCharImage",$r);var $o=$z.prototype;return $e.imps($o,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$o.active=function(){this.texture.active()},$o.recreateResource=function(){var $J=$w.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$J){var $o=this.fontSize;1==this.xs&&1==this.ys||($o=parseInt($o*(this.xs>this.ys?this.xs:this.ys)+""));var $r="normal 100 "+this.font;$r=$r.replace($z._fontSizeReg,$o),this.borderColor&&($r+=" 1 "+this.borderColor),this._ctx.font=$r,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$L.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $S=this._ctx.measureText(this.char);$S||($S={width:16});var $G=$S.width+1;this._ctx.lineTo($G,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$o.onresize=function($J,$o){this._w=$J,this._h=$o,this._allowMerageInAtlas=!0},$o.clearAtlasSource=function(){},$S(0,$o,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$S(0,$o,"atlasSource",function(){return this.canvas}),$S(0,$o,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($J){this._enableMerageInAtlas=$J}),$z.createOneChar=function($J,$o){return new $z($J,$o)},$z._fontSizeReg=new RegExp("\\d+(?=px)","g"),$z}(),$aJ=function($J){function $u($J,$o,$r,$S,$G,$z,$A,$h,$Z){void 0===$r&&($r=6408),void 0===$S&&($S=5121),void 0===$G&&($G=34041),void 0===$z&&($z=!1),void 0===$A&&($A=!1),void 0===$h&&($h=-1),void 0===$Z&&($Z=1),$u.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$J,this._h=$o,this._surfaceFormat=$r,this._surfaceType=$S,this._depthStencilFormat=$G,this._mipMap=$z,this._repeat=$A,this._minFifter=$h,this._magFifter=$Z}$j($u,"laya.webgl.resource.WebGLRenderTarget",$r);var $o=$u.prototype;return $o.recreateResource=function(){var $J=$tJ.mainContext;this._frameBuffer||(this._frameBuffer=$J.createFramebuffer()),this._source||(this._source=$J.createTexture());var $o=$KJ.curBindTexTarget,$r=$KJ.curBindTexValue;$KJ.bindTexture($J,3553,this._source),$J.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $S=this._minFifter,$G=this._magFifter,$z=this._repeat?10497:33071,$A=$B.isPOT(this._w,this._h);if($A?(this._mipMap?-1!==$S||($S=9987):-1!==$S||($S=9729),-1!==$G||($G=9729),$J.texParameteri(3553,10241,$S),$J.texParameteri(3553,10240,$G),$J.texParameteri(3553,10242,$z),$J.texParameteri(3553,10243,$z),this._mipMap&&$J.generateMipmap(3553)):(-1!==$S||($S=9729),-1!==$G||($G=9729),$J.texParameteri(3553,10241,$S),$J.texParameteri(3553,10240,$G),$J.texParameteri(3553,10242,33071),$J.texParameteri(3553,10243,33071)),$J.bindFramebuffer(36160,this._frameBuffer),$J.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$J.createRenderbuffer()),$J.bindRenderbuffer(36161,this._depthStencilBuffer),$J.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$J.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$J.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$J.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$J.bindFramebuffer(36160,null),$o&&$r&&$KJ.bindTexture($J,$o,$r),$J.bindRenderbuffer(36161,null),$A&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$o.disposeResource=function(){this._frameBuffer&&($tJ.mainContext.deleteTexture(this._source),$tJ.mainContext.deleteFramebuffer(this._frameBuffer),$tJ.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$S(0,$o,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$S(0,$o,"frameBuffer",function(){return this._frameBuffer}),$u}(),$xJ=function($J){function $h($J,$o,$r,$S,$G,$z,$A){this.offsetX=0,this.offsetY=0,$h.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$z,this.canvas=$J,this._ctx=$J.getContext("2d",void 0),this._w=$S,this._h=$G,this.offsetX=$o,this.offsetY=$r,this.src=$A,this._enableMerageInAtlas=!0,$c.enabled&&this._w<$c.atlasLimitWidth&&this._h<$c.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$j($h,"laya.webgl.resource.WebGLSubImage",$r);var $o=$h.prototype;return $e.imps($o,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$o.size=function($J,$o){this._w=$J,this._h=$o,this._ctx&&this._ctx.size($J,$o),this.canvas&&(this.canvas.height=$o,this.canvas.width=$J)},$o.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$o.createWebGlTexture=function(){var $J=$tJ.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $o=this._source=$J.createTexture(),$r=$KJ.curBindTexTarget,$S=$KJ.curBindTexValue;$KJ.bindTexture($J,3553,$o),$J.pixelStorei(37441,!0),$J.texImage2D(3553,0,6408,6408,5121,this.canvas),$J.pixelStorei(37441,!1);var $G=this.minFifter,$z=this.magFifter,$A=this.repeat?10497:33071,$h=$B.isPOT(this.width,this.height);$h?(this.mipmap?-1!==$G||($G=9987):-1!==$G||($G=9729),-1!==$z||($z=9729),$J.texParameteri(3553,10240,$z),$J.texParameteri(3553,10241,$G),$J.texParameteri(3553,10242,$A),$J.texParameteri(3553,10243,$A),this.mipmap&&$J.generateMipmap(3553)):(-1!==$G||($G=9729),-1!==$z||($z=9729),$J.texParameteri(3553,10241,$G),$J.texParameteri(3553,10240,$z),$J.texParameteri(3553,10242,33071),$J.texParameteri(3553,10243,33071)),$r&&$S&&$KJ.bindTexture($J,$r,$S),this.canvas=null,$h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$o.disposeResource=function(){$c.enabled&&this._allowMerageInAtlas||!this._source||($tJ.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$o.clearAtlasSource=function(){},$S(0,$o,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$S(0,$o,"atlasSource",function(){return this.canvas}),$S(0,$o,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($J){this._allowMerageInAtlas=$J}),$h}(),$MJ=function($J){function $u($J,$o,$r,$S){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$u.__super.call(this),!$J||!$o)throw"Shader Error";this._id=++$u._count,this._vs=$J,this._ps=$o,this._nameMap=$S||{},null!=$r&&($u.sharders[$r]=this)}$j($u,"laya.webgl.shader.Shader",$pJ);var $o=$u.prototype;return $o.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$o.disposeResource=function(){$tJ.mainContext.deleteShader(this._vshader),$tJ.mainContext.deleteShader(this._pshader),$tJ.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$o._compile=function(){if(!$tJ.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $J=[this._vs,this._ps],$o=$tJ.mainContext;if(this._program=$o.createProgram(),this._vshader=$u._createShader($o,$J[0],35633),this._pshader=$u._createShader($o,$J[1],35632),$o.attachShader(this._program,this._vshader),$o.attachShader(this._program,this._pshader),$o.linkProgram(this._program),!$w.isConchApp&&!$o.getProgramParameter(this._program,35714))throw $o.getProgramInfoLog(this._program);var $r,$S,$G=0,$z=0;for($z=$w.isConchApp?$o.getProgramParameterEx(this._vs,this._ps,"",35721):$o.getProgramParameter(this._program,35721),$G=0;$G<$z;$G++){var $A=null;$r={vartype:"attribute",glfun:null,ivartype:0,attrib:$A=$w.isConchApp?$o.getActiveAttribEx(this._vs,this._ps,"",$G):$o.getActiveAttrib(this._program,$G),location:$o.getAttribLocation(this._program,$A.name),name:$A.name,type:$A.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($r)}var $h=0;for($h=$w.isConchApp?$o.getProgramParameterEx(this._vs,this._ps,"",35718):$o.getProgramParameter(this._program,35718),$G=0;$G<$h;$G++){var $Z=null;$Z=$w.isConchApp?$o.getActiveUniformEx(this._vs,this._ps,"",$G):$o.getActiveUniform(this._program,$G),0<($r={vartype:"uniform",glfun:null,ivartype:1,attrib:$A,location:$o.getUniformLocation(this._program,$Z.name),name:$Z.name,type:$Z.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($r.name=$r.name.substr(0,$r.name.length-3),$r.isArray=!0,$r.location=$o.getUniformLocation(this._program,$r.name)),this._params.push($r)}for($G=0,$S=this._params.length;$G<$S;$G++)if(($r=this._params[$G]).indexOfParams=$G,$r.index=1,$r.value=[$r.location,null],$r.codename=$r.name,$r.name=this._nameMap[$r.codename]?this._nameMap[$r.codename]:$r.codename,(this._paramsMap[$r.name]=$r)._this=this,$r.uploadedValue=[],"attribute"!==$r.vartype)switch($r.type){case 5124:$r.fun=$r.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$r.fun=$r.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$r.fun=$r.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$r.fun=$r.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$r.fun=$r.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$r.fun=this._uniform_sampler2D;break;case 35680:$r.fun=this._uniform_samplerCube;break;case 35676:$r.glfun=$o.uniformMatrix4fv,$r.fun=this._uniformMatrix4fv;break;case 35670:$r.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $r.fun=this._attribute}},$o.getUniform=function($J){return this._paramsMap[$J]},$o._attribute=function($J,$o){var $r=$tJ.mainContext,$S=$FJ._enableAtributes,$G=$J.location;return $S[$G]||$r.enableVertexAttribArray($G),$r.vertexAttribPointer($G,$o[0],$o[1],$o[2],$o[3],$o[4]+this._offset),$S[$G]=$FJ._bindVertexBuffer,1},$o._uniform1f=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o?($tJ.mainContext.uniform1f($J.location,$r[0]=$o),1):0},$o._uniform1fv=function($J,$o){if($o.length<4){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($tJ.mainContext.uniform1fv($J.location,$o),$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3],1):0}return $tJ.mainContext.uniform1fv($J.location,$o),1},$o._uniform_vec2=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]?($tJ.mainContext.uniform2f($J.location,$r[0]=$o[0],$r[1]=$o[1]),1):0},$o._uniform_vec2v=function($J,$o){if($o.length<2){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($tJ.mainContext.uniform2fv($J.location,$o),$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3],1):0}return $tJ.mainContext.uniform2fv($J.location,$o),1},$o._uniform_vec3=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]?($tJ.mainContext.uniform3f($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2]),1):0},$o._uniform_vec3v=function($J,$o){return $tJ.mainContext.uniform3fv($J.location,$o),1},$o._uniform_vec4=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($tJ.mainContext.uniform4f($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3]),1):0},$o._uniform_vec4v=function($J,$o){return $tJ.mainContext.uniform4fv($J.location,$o),1},$o._uniformMatrix2fv=function($J,$o){return $tJ.mainContext.uniformMatrix2fv($J.location,!1,$o),1},$o._uniformMatrix3fv=function($J,$o){return $tJ.mainContext.uniformMatrix3fv($J.location,!1,$o),1},$o._uniformMatrix4fv=function($J,$o){return $tJ.mainContext.uniformMatrix4fv($J.location,!1,$o),1},$o._uniform1i=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o?($tJ.mainContext.uniform1i($J.location,$r[0]=$o),1):0},$o._uniform1iv=function($J,$o){return $tJ.mainContext.uniform1iv($J.location,$o),1},$o._uniform_ivec2=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]?($tJ.mainContext.uniform2i($J.location,$r[0]=$o[0],$r[1]=$o[1]),1):0},$o._uniform_ivec2v=function($J,$o){return $tJ.mainContext.uniform2iv($J.location,$o),1},$o._uniform_vec3i=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]?($tJ.mainContext.uniform3i($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2]),1):0},$o._uniform_vec3vi=function($J,$o){return $tJ.mainContext.uniform3iv($J.location,$o),1},$o._uniform_vec4i=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($tJ.mainContext.uniform4i($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3]),1):0},$o._uniform_vec4vi=function($J,$o){return $tJ.mainContext.uniform4iv($J.location,$o),1},$o._uniform_sampler2D=function($J,$o){var $r=$tJ.mainContext,$S=$J.uploadedValue;return null==$S[0]?($S[0]=this._curActTexIndex,$r.uniform1i($J.location,this._curActTexIndex),$r.activeTexture($u._TEXTURES[this._curActTexIndex]),$KJ.bindTexture($r,3553,$o),this._curActTexIndex++,1):($r.activeTexture($u._TEXTURES[$S[0]]),$KJ.bindTexture($r,3553,$o),0)},$o._uniform_samplerCube=function($J,$o){var $r=$tJ.mainContext,$S=$J.uploadedValue;return null==$S[0]?($S[0]=this._curActTexIndex,$r.uniform1i($J.location,this._curActTexIndex),$r.activeTexture($u._TEXTURES[this._curActTexIndex]),$KJ.bindTexture($r,34067,$o),this._curActTexIndex++,1):($r.activeTexture($u._TEXTURES[$S[0]]),$KJ.bindTexture($r,34067,$o),0)},$o._noSetValue=function($J){console.log("no....:"+$J.name)},$o.uploadOne=function($J,$o){this.activeResource(),$KJ.UseProgram(this._program);var $r=this._paramsMap[$J];$r.fun.call(this,$r,$o)},$o.uploadTexture2D=function($J){$n.shaderCall++;var $o=$tJ.mainContext;$o.activeTexture(33984),$KJ.bindTexture($o,3553,$J)},$o.uploadTexture2D1=function($J){$n.shaderCall++;var $o=$tJ.mainContext;$o.activeTexture(33985),$KJ.bindTexture($o,3553,$J)},$o.upload=function($J,$o){$pJ.activeShader=$pJ.bindShader=this,this._lastUseFrameCount===$n.loopCount||this.activeResource(),$KJ.UseProgram(this._program),this._reCompile?($o=this._params,this._reCompile=!1):$o=$o||this._params;$tJ.mainContext;for(var $r,$S,$G=$o.length,$z=0,$A=0;$A<$G;$A++)null!==($S=$J[($r=$o[$A]).name])&&($z+=$r.fun.call(this,$r,$S));$n.shaderCall+=$z},$o.uploadArray=function($J,$o,$r){$pJ.activeShader=this,($pJ.bindShader=this).activeResource(),$KJ.UseProgram(this._program);this._params;for(var $S,$G,$z=0,$A=$o-2;0<=$A;$A-=2)($G=this._paramsMap[$J[$A]])&&null!=($S=$J[$A+1])&&($r&&$r[$G.name]&&$r[$G.name].bind(),$z+=$G.fun.call(this,$G,$S));$n.shaderCall+=$z},$o.getParams=function(){return this._params},$u.getShader=function($J){return $u.sharders[$J]},$u.create=function($J,$o,$r,$S){return new $u($J,$o,$r,$S)},$u.withCompile=function($J,$o,$r,$S){if($r&&$u.sharders[$r])return $u.sharders[$r];var $G=$u._preCompileShader[2e-4*$J];if(!$G)throw new Error("withCompile shader err!"+$J);return $G.createShader($o,$r,$S)},$u.withCompile2D=function($J,$o,$r,$S,$G){if($S&&$u.sharders[$S])return $u.sharders[$S];var $z=$u._preCompileShader[2e-4*$J+$o];if(!$z)throw new Error("withCompile shader err!"+$J+" "+$o);return $z.createShader($r,$S,$G)},$u.addInclude=function($J,$o){$IJ.addInclude($J,$o)},$u.preCompile=function($J,$o,$r,$S){var $G=2e-4*$J;$u._preCompileShader[$G]=new $IJ($G,$o,$r,$S)},$u.preCompile2D=function($J,$o,$r,$S,$G){var $z=2e-4*$J+$o;$u._preCompileShader[$z]=new $IJ($z,$r,$S,$G)},$u._createShader=function($J,$o,$r){var $S=$J.createShader($r);return $J.shaderSource($S,$o),$J.compileShader($S),$S},$u._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$u._count=0,$u._preCompileShader={},$u.SHADERNAME2ID=2e-4,$u.sharders=(($u.sharders=[]).length=32,$u.sharders),$A($u,["nameKey",function(){return this.nameKey=new $k}]),$u}(),$OJ=function($J){function $o(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$o.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$j($o,"laya.webgl.utils.Buffer2D",$J);var $r=$o.prototype;return $r.needSize=function($J){var $o=this._byteLength;if($J){var $r=this._byteLength+$J;$r<=this._buffer.byteLength||this._resizeBuffer($r<<1,!0),this._byteLength=$r}return $o},$r._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$n.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$FJ._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$FJ._gl.bufferSubData(this._bufferType,0,this._buffer)},$r._bufferSubData=function($J,$o,$r){if(void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$n.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$FJ._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$o||$r){var $S=this._buffer.slice($o,$r);$FJ._gl.bufferSubData(this._bufferType,$J,$S)}else $FJ._gl.bufferSubData(this._bufferType,$J,this._buffer)},$r._checkArrayUse=function(){},$r._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$r._bind_subUpload=function($J,$o,$r){return void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($J,$o,$r),!0)},$r._resizeBuffer=function($J,$o){if($J<this._buffer.byteLength)return this;if(this.memorySize=$J,$o&&this._buffer&&0<this._buffer.byteLength){var $r=new ArrayBuffer($J);new Uint8Array($r).set(new Uint8Array(this._buffer),0),this._buffer=$r}else this._buffer=new ArrayBuffer($J);return this._checkArrayUse(),this._upload=!0,this},$r.append=function($J){this._upload=!0;var $o,$r;$o=$J.byteLength,$J instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$o,!0),$r=new Uint8Array(this._buffer,this._byteLength)):$J instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$o,!0),$r=new Uint16Array(this._buffer,this._byteLength)):$J instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$o,!0),$r=new Float32Array(this._buffer,this._byteLength)),$r.set($J,0),this._byteLength+=$o,this._checkArrayUse()},$r.appendU16Array=function($J,$o){this._resizeBuffer(this._byteLength+2*$o,!0);for(var $r=new Uint16Array(this._buffer,this._byteLength,$o),$S=0;$S<$o;$S++)$r[$S]=$J[$S];this._byteLength+=2*$o,this._checkArrayUse()},$r.appendEx=function($J,$o){this._upload=!0;var $r;$r=$J.byteLength,this._resizeBuffer(this._byteLength+$r,!0),new $o(this._buffer,this._byteLength).set($J,0),this._byteLength+=$r,this._checkArrayUse()},$r.appendEx2=function($J,$o,$r,$S){void 0===$S&&($S=1),this._upload=!0;var $G,$z;$G=$r*$S,this._resizeBuffer(this._byteLength+$G,!0),$z=new $o(this._buffer,this._byteLength);var $A=0;for($A=0;$A<$r;$A++)$z[$A]=$J[$A];this._byteLength+=$G,this._checkArrayUse()},$r.getBuffer=function(){return this._buffer},$r.setNeedUpload=function(){this._upload=!0},$r.getNeedUpload=function(){return this._upload},$r.upload=function(){var $J=this._bind_upload();return $FJ._gl.bindBuffer(this._bufferType,null),$FJ._bindActive[this._bufferType]=null,$pJ.activeShader=null,$J},$r.subUpload=function($J,$o,$r){void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0);var $S=this._bind_subUpload();return $FJ._gl.bindBuffer(this._bufferType,null),$FJ._bindActive[this._bufferType]=null,$pJ.activeShader=null,$S},$r.disposeResource=function(){$J.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$r.clear=function(){this._byteLength=0,this._upload=!0},$S(0,$r,"bufferLength",function(){return this._buffer.byteLength}),$S(0,$r,"byteLength",null,function($J){this._byteLength!==$J&&($J<=this._buffer.byteLength||this._resizeBuffer(2*$J+256,!0),this._byteLength=$J)}),$o.__int__=function($J){$EJ.QuadrangleIB=$EJ.create(35044),$NJ.fillIBQuadrangle($EJ.QuadrangleIB,16)},$o.FLOAT32=4,$o.SHORT=2,$o}($FJ),$PJ=(function($o){function $r($J){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$r.__super.call(this,9)}$j($r,"laya.webgl.shader.d2.value.GlowSV",$o);var $J=$r.prototype;$J.setValue=function($J){$o.prototype.setValue.call(this,$J)},$J.clear=function(){$o.prototype.clear.call(this)}}($TJ),function($J){function $o($J){$o.__super.call(this,64),this.defines.add(64)}$j($o,"laya.webgl.shader.d2.value.TextSV",$J);var $r=$o.prototype;return $r.release=function(){($o.pool[$o._length++]=this).clear()},$r.clear=function(){$J.prototype.clear.call(this)},$o.create=function(){return $o._length?$o.pool[--$o._length]:new $o(null)},$o.pool=[],$o._length=0,$o}($TJ)),$WJ=function($J){function $G($J,$o,$r,$S){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$G.__super.call(this,$J,$o,$r,$S)}$j($G,"laya.webgl.shader.d2.Shader2X",$J);var $o=$G.prototype;return $o.upload2dQuick1=function($J){this.upload($J,this._params2dQuick1||this._make2dQuick1())},$o._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $J,$o=this._params,$r=0,$S=$o.length;$r<$S;$r++)$J=$o[$r],($w.isFlash||"size"!==$J.name&&"position"!==$J.name&&"texcoord"!==$J.name)&&this._params2dQuick1.push($J)}return this._params2dQuick1},$o.disposeResource=function(){$J.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$o.upload2dQuick2=function($J){this.upload($J,this._params2dQuick2||this._make2dQuick2())},$o._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $J,$o=this._params,$r=0,$S=$o.length;$r<$S;$r++)$J=$o[$r],($w.isFlash||"size"!==$J.name)&&this._params2dQuick2.push($J)}return this._params2dQuick2},$G.create=function($J,$o,$r,$S){return new $G($J,$o,$r,$S)},$G}($MJ),$EJ=function($J){function $o($J){this._uint8Array=null,this._uint16Array=null,void 0===$J&&($J=35044),$o.__super.call(this),this._bufferUsage=$J,this._bufferType=34963,$w.isFlash||(this._buffer=new ArrayBuffer(8))}$j($o,"laya.webgl.utils.IndexBuffer2D",$OJ);var $r=$o.prototype;return $r._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$r.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$r.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$r.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$o.QuadrangleIB=null,$o.create=function($J){return void 0===$J&&($J=35044),new $o($J)},$o}(),$XJ=function($J){function $r($J,$o){this._floatArray32=null,this._vertexStride=0,$r.__super.call(this),this._vertexStride=$J,this._bufferUsage=$o,this._bufferType=34962,$w.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$j($r,"laya.webgl.utils.VertexBuffer2D",$J);var $o=$r.prototype;return $o.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$o.bind=function($J){$J&&$J._bind(),this._bind()},$o.insertData=function($J,$o){this.getFloat32Array().set($J,$o),this._upload=!0},$o.bind_upload=function($J){$J._bind_upload()||$J._bind(),this._bind_upload()||this._bind()},$o._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$o.disposeResource=function(){$J.prototype.disposeResource.call(this)},$o.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$S(0,$o,"vertexStride",function(){return this._vertexStride}),$r.create=function($J,$o){return void 0===$o&&($o=35048),new $r($J,$o)},$r}($OJ),$Jo=function($J){function $h($J,$o,$r,$S,$G,$z){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$r&&($r=6408),void 0===$S&&($S=!0),$h.__super.call(this,$J,$o),$J){if(this._format=$r,this._mipmap=$S,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $J)this._url=$J,this._src=$J,this._image=new $Y.window.Image,$o&&($o.onload&&(this.onload=$o.onload),$o.onerror&&(this.onerror=$o.onerror),$o.onCreate&&$o.onCreate(this)),this._image.crossOrigin=$J&&0==$J.indexOf("data:")?null:"",$J&&(this._image.src=$J);else if($J instanceof ArrayBuffer){this._src=$o,this._url=this._src;var $A=new $Z($J);$A.readUTFBytes(4),$A.readUTFBytes(2),$A.getInt16();$A.endian="bigEndian",this._w=$A.getInt16(),this._h=$A.getInt16();$A.getInt16(),$A.getInt16();this._image=new Uint8Array($J,$A.pos),this._format=$tJ.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$c.enabled&&this._w<$c.atlasLimitWidth&&this._h<$c.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($J instanceof Uint8Array))return this._src=$o,this._url=this._src,this._image=$J.source||$J,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$o,this._url=this._src,this._w=$G,this._h=$z,this._image=$J,this._format=0===$r?$J.byteLength/($G*$z)==4?6408:6407:$r}this._$5__enableMerageInAtlas=!0}}$j($h,"laya.webgl.resource.WebGLImage",$D);var $o=$h.prototype;return $e.imps($o,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$o._init_=function($J,$o){},$o._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $J=$tJ.mainContext,$o=this._source=$J.createTexture(),$r=$KJ.curBindTexTarget,$S=$KJ.curBindTexValue;$KJ.bindTexture($J,3553,$o);var $G=this.minFifter,$z=this.magFifter,$A=this.repeat?10497:33071,$h=$B.isPOT(this._w,this._h),$Z=!1;switch($h?(this.mipmap?-1!==$G||($G=9987):-1!==$G||($G=9729),-1!==$z||($z=9729),$J.texParameteri(3553,10241,$G),$J.texParameteri(3553,10240,$z),$J.texParameteri(3553,10242,$A),$J.texParameteri(3553,10243,$A),this.mipmap&&$J.generateMipmap(3553)):(-1!==$G||($G=9729),-1!==$z||($z=9729),$J.texParameteri(3553,10241,$G),$J.texParameteri(3553,10240,$z),$J.texParameteri(3553,10242,33071),$J.texParameteri(3553,10243,33071)),$J.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$J.pixelStorei($J.UNPACK_ALIGNMENT,1),$J.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$J.pixelStorei($J.UNPACK_ALIGNMENT,1),$J.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$Z=!0,$J.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $tJ.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$Z=!0,$J.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$J.pixelStorei(37441,!1),$r&&$S&&$KJ.bindTexture($J,$r,$S),this.uri||(this.uri=this._url),$Z?this.memorySize=this._image.length:$h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$o.recreateResource=function(){var $J=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $o=this;this._image=new $Y.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($o._needReleaseAgain)return $o._needReleaseAgain=!1,$o._image.onload=null,void($o._image=null);$o._allowMerageInAtlas&&$o._enableMerageInAtlas?($J.memorySize=0,$J._recreateLock=!1):$o._createWebGlTexture(),$o.completeCreate()},this._image.src=this._src}},$o.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$tJ.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$o.onresize=function(){this._w=this._image.width,this._h=this._image.height,$c.enabled&&this._w<$c.atlasLimitWidth&&this._h<$c.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$o.clearAtlasSource=function(){this._image=null},$S(0,$o,"format",function(){return this._format}),$S(0,$o,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($J){this._$5__enableMerageInAtlas=$J}),$S(0,$o,"mipmap",function(){return this._mipmap}),$S(0,$o,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$S(0,$o,"atlasSource",function(){return this._image}),$S(0,$o,"onload",null,function($J){var $o=this;this._onload=$J,this._image&&(this._image.onload=null!=this._onload?function(){$o.onresize(),$o._onload()}:null)}),$S(0,$o,"onerror",null,function($J){var $o=this;this._onerror=$J,this._image&&(this._image.onerror=null!=this._onerror?function(){$o._onerror()}:null)}),$h}();$e.__init([$YJ,$l,$yJ,$IJ])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($J,$o){"use strict";for(var $r in Object.defineProperty($o,"__esModule",{value:!0}),Laya){var $S=Laya[$r];$S&&$S.__isclass&&($o[$r]=$S)}}),function($z,$J,$S){$S.un,$S.uns;var $G=$S.static,$A=$S.class,$h=$S.getset,$Z=($S.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$_=laya.utils.ClassUtils,$v=(laya.events.Event,laya.utils.HTMLChar),$u=laya.net.Loader,$B=(laya.display.Node,laya.maths.Rectangle),$j=laya.renders.Render,$Y=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$D=laya.utils.Stat,$p=laya.display.Text,$N=laya.resource.Texture,$w=laya.net.URL,$i=laya.utils.Utils,$I=function(){function $Y(){}return $A($Y,"laya.html.utils.HTMLParse"),$Y.parse=function($J,$o,$r){$o=($o="<root>"+($o=$o.replace(/<br>/g,"<br/>"))+"</root>").replace($Y.spacePattern,$Y.char255);var $S=$i.parseXMLFromString($o);$Y._parseXML($J,$S.childNodes[0].childNodes,$r)},$Y._parseXML=function($J,$o,$r,$S){var $G=0,$z=0;if($o.join||$o.item)for($G=0,$z=$o.length;$G<$z;++$G)$Y._parseXML($J,$o[$G],$r,$S);else{var $A,$h,$Z;if(3==$o.nodeType)return void($J instanceof laya.html.dom.HTMLDivElement?(null==$o.nodeName&&($o.nodeName="#text"),$h=$o.nodeName.toLowerCase(),0<($Z=$o.textContent.replace(/^\s+|\s+$/g,"")).length&&($A=$_.getInstance($h))&&($J.addChild($A),$A.innerTEXT=$Z.replace($Y.char255AndOneSpacePattern," "))):0<($Z=$o.textContent.replace(/^\s+|\s+$/g,"")).length&&($J.innerTEXT=$Z.replace($Y.char255AndOneSpacePattern," ")));if("#comment"==($h=$o.nodeName.toLowerCase()))return;if($A=$_.getInstance($h)){($A=$J.addChild($A)).URI=$r,$A.href=$S;var $u=$o.attributes;if($u&&0<$u.length)for($G=0,$z=$u.length;$G<$z;++$G){var $B=$u[$G],$v=$B.nodeName,$j=$B.value;$A._setAttributes($v,$j)}$Y._parseXML($A,$o.childNodes,$r,$A.href)}else $Y._parseXML($J,$o.childNodes,$r,$S)}},$Y.char255=String.fromCharCode(255),$Y.spacePattern=/&nbsp;|&#160;/g,$Y.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$Y}(),$t=function(){function $Q(){}return $A($Q,"laya.html.utils.Layout"),$Q.later=function($J){null==$Q._will&&($Q._will=[],$S.stage.frameLoop(1,null,function(){if(!($Q._will.length<1)){for(var $J=0;$J<$Q._will.length;$J++)laya.html.utils.Layout.layout($Q._will[$J]);$Q._will.length=0}})),$Q._will.push($J)},$Q.layout=function($J){if(!$J||!$J._style)return null;if(0==(512&$J._style._type))return null;$J.getStyle()._type&=-513;var $o=$Q._multiLineLayout($J);return $j.isConchApp&&$J.layaoutCallNative&&$J.layaoutCallNative(),$o},$Q._multiLineLayout=function($J){if($p.RightToLeft)return $Q._multiLineLayout2($J);var $o=new Array;$J._addChildsToLayout($o);var $r,$S,$G,$z,$A,$h=0,$Z=$o.length,$u=$J._getCSSStyle(),$B=$u.letterSpacing,$v=$u.leading,$j=$u.lineHeight,$Y=$u._widthAuto()||!$u.wordWrap,$_=$Y?999999:$J.width,$D=($J.height,0),$N=$u.italic?$u.fontSize/3:0,$w=$u._getAlign(),$i=$u._getValign(),$I=0!==$i||0!==$w||0!=$j,$t=0,$K=0,$e=0,$y=0,$g=new Array,$s=$g[0]=new $f,$V=!1,$m=!1;$s.h=0,$u.italic&&($_-=$u.fontSize/3);var $C=0,$R=!0;function $n(){$s.y=$K,$K+=$s.h+$v,0==$s.h&&($K+=$j),$s.mWidth=$C,$C=0,$s=new $f,$g.push($s),$s.h=0,$V=!($R=!($t=0))}for($h=0;$h<$Z;$h++)if(null!=($r=$o[$h]))if($R=!1,$r instanceof laya.html.dom.HTMLBrElement)$n(),$s.y=$K;else{if($r._isChar()){if(($z=$r).isWord)$V=$m||"\n"===$z.char,$s.wordStartIndex=$s.elements.length;else{if($e=$z.width+$z.style.letterSpacin,0<$g.length&&$_<$t+$e&&0<$s.wordStartIndex){var $k;$k=$s.elements.length-$s.wordStartIndex+1,$s.elements.length=$s.wordStartIndex,$h-=$k,$n();continue}$V=!1,$C+=$z.width}$e=$z.width+$B,$y=$z.height,$m=!1,($V=$V||$_<$t+$e)&&$n(),$s.minTextHeight=Math.min($s.minTextHeight,$r.height)}else $S=$r._getCSSStyle(),$A=$r,$G=$S.padding,0===$S._getCssFloat()||($I=!0),$V=$m||$S.lineElement,$e=$A.width*$A._style._tf.scaleX+$G[1]+$G[3]+$B,$y=$A.height*$A._style._tf.scaleY+$G[0]+$G[2],$m=$S.lineElement,($V=$V||$_<$t+$e&&$S.wordWrap)&&$n();$s.elements.push($r),$s.h=Math.max($s.h,$y),$r.x=$t,$r.y=$K,$t+=$e,$s.w=$t-$B,$s.y=$K,$D=Math.max($t+$N,$D)}else $R||($t+=$Q.DIV_ELEMENT_PADDING),$s.wordStartIndex=$s.elements.length;if($K=$s.y+$s.h,$I){var $U=0,$L=$_;for($Y&&0<$J.width&&($L=$J.width),$h=0,$Z=$g.length;$h<$Z;$h++)$g[$h].updatePos(0,$L,$h,$U,$w,$i,$j),$U+=Math.max($j,$g[$h].h+$v);$K=$U}return $Y&&($J.width=$D),$K>$J.height&&($J.height=$K),[$D,$K]},$Q._multiLineLayout2=function($J){var $o=new Array;$J._addChildsToLayout($o);var $r,$S,$G,$z,$A,$h=0,$Z=$o.length,$u=$J._getCSSStyle(),$B=$u.letterSpacing,$v=$u.leading,$j=$u.lineHeight,$Y=$u._widthAuto()||!$u.wordWrap,$_=$Y?999999:$J.width,$D=($J.height,0),$N=$u.italic?$u.fontSize/3:0,$w=2-$u._getAlign(),$i=$u._getValign(),$I=0!==$i||0!=$w||0!=$j,$t=0,$K=0,$e=0,$y=0,$g=new Array,$s=$g[0]=new $f,$V=!1,$m=!1;$s.h=0,$u.italic&&($_-=$u.fontSize/3);var $C=0,$R=!0;function $n(){$s.y=$K,$K+=$s.h+$v,0==$s.h&&($K+=$j),$s.mWidth=$C,$C=0,$s=new $f,$g.push($s),$s.h=0,$V=!($R=!($t=0))}for($h=0;$h<$Z;$h++)if(null!=($r=$o[$h]))if($R=!1,$r instanceof laya.html.dom.HTMLBrElement)$n(),$s.y=$K;else{if($r._isChar()){if(($z=$r).isWord)$V=$m||"\n"===$z.char,$s.wordStartIndex=$s.elements.length;else{if(0<$g.length&&$_<$t+$e&&0<$s.wordStartIndex){var $k;$k=$s.elements.length-$s.wordStartIndex+1,$s.elements.length=$s.wordStartIndex,$h-=$k,$n();continue}$V=!1,$C+=$z.width}$e=$z.width+$B,$y=$z.height,$m=!1,($V=$V||$_<$t+$e)&&$n(),$s.minTextHeight=Math.min($s.minTextHeight,$r.height)}else $S=$r._getCSSStyle(),$A=$r,$G=$S.padding,0===$S._getCssFloat()||($I=!0),$V=$m||$S.lineElement,$e=$A.width*$A._style._tf.scaleX+$G[1]+$G[3]+$B,$y=$A.height*$A._style._tf.scaleY+$G[0]+$G[2],$m=$S.lineElement,($V=$V||$_<$t+$e&&$S.wordWrap)&&$n();$s.elements.push($r),$s.h=Math.max($s.h,$y),$r.x=$t,$r.y=$K,$t+=$e,$s.w=$t-$B,$s.y=$K,$D=Math.max($t+$N,$D)}else $R||($t+=$Q.DIV_ELEMENT_PADDING),$s.wordStartIndex=$s.elements.length;if($K=$s.y+$s.h,$I){var $U=0,$L=$_;for($h=0,$Z=$g.length;$h<$Z;$h++)$g[$h].updatePos(0,$L,$h,$U,$w,$i,$j),$U+=Math.max($j,$g[$h].h+$v);$K=$U}for($Y&&($J.width=$D),$K>$J.height&&($J.height=$K),$h=0,$Z=$g.length;$h<$Z;$h++)$g[$h].revertOrder($_);return[$D,$K]},$Q._will=null,$Q.DIV_ELEMENT_PADDING=0,$Q}(),$f=function(){function $J(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$A($J,"laya.html.utils.LayoutLine");var $o=$J.prototype;return $o.updatePos=function($J,$o,$r,$S,$G,$z,$A){var $h,$Z=0;0<this.elements.length&&($Z=($h=this.elements[this.elements.length-1]).x+$h.width-this.elements[0].x);var $u=0,$B=NaN;1===$G&&($u=($o-$Z)/2),2===$G&&($u=$o-$Z),0===$A||0!=$z||($z=1);for(var $v=0,$j=this.elements.length;$v<$j;$v++){var $Y=($h=this.elements[$v])._getCSSStyle();switch(0!==$u&&($h.x+=$u),$Y._getValign()){case 0:$h.y=$S;break;case 1:var $_=0;99999!=this.minTextHeight&&($_=this.minTextHeight);var $D=($_+$A)/2;$D=Math.max($D,this.h),$B=(laya.html.dom.HTMLImageElement,$S+$D-$h.height),$h.y=$B;break;case 2:$h.y=$S+($A-$h.height)}}},$o.revertOrder=function($J){var $o;if(0<this.elements.length){var $r,$S=0;for($r=this.elements.length,$S=0;$S<$r;$S++)($o=this.elements[$S]).x=$J-$o.x-$o.width}},$J}(),$K=function($r){function $o(){this.URI=null,this._href=null,$o.__super.call(this),this._text=$o._EMPTYTEXT,this.setStyle(new $Z(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$A($o,"laya.html.dom.HTMLElement",$r);var $J=$o.prototype;return $J.layaoutCallNative=function(){var $J=0;if(this._childs&&0<($J=this._childs.length))for(var $o=0;$o<$J;$o++)this._childs[$o].layaoutCallNative&&this._childs[$o].layaoutCallNative();var $r=this._getWords();$r?laya.html.dom.HTMLElement.fillWords(this,$r,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$J.appendChild=function($J){return this.addChild($J)},$J._getWords2=function(){var $J=this._text.text;if(!$J||0===$J.length)return null;var $o,$r,$S=0,$G=0;if(this._text.drawWords)$r=this._text.drawWords;else{for($G=($o=$J.split(" ")).length-1,$r=[],$S=0;$S<$G;$S++)$r.push($o[$S]," ");0<=$G&&$r.push($o[$G]),this._text.drawWords=$r}var $z,$A=this._text.words;if($A&&$A.length===$r.length)return $A;null===$A&&(this._text.words=$A=[]),$A.length=$r.length;var $h=this.style,$Z=$h.font;for($S=0,$G=$r.length;$S<$G;$S++){$z=$i.measureText($r[$S],$Z);var $u=$A[$S]=new $v($r[$S],$z.width,$z.height||$h.fontSize,$h);if(1<$u.char.length&&($u.charNum=$u.char),this.href){var $B=new $Y;this.addChild($B),$u.setSprite($B)}}return $A},$J._getWords=function(){if(!$p.CharacterCache)return this._getWords2();var $J=this._text.text;if(!$J||0===$J.length)return null;var $o,$r=this._text.words;if($r&&$r.length===$J.length)return $r;null===$r&&(this._text.words=$r=[]),$r.length=$J.length;for(var $S=this.style,$G=$S.font,$z=0,$A=$J.length;$z<$A;$z++)if($o=$i.measureText($J.charAt($z),$G)){var $h=$r[$z]=new $v($J.charAt($z),$o.width,$o.height||$S.fontSize,$S);if(this.href){var $Z=new $Y;this.addChild($Z),$h.setSprite($Z)}}else console.warn("_getWords size is null"+$J.charAt($z),$G);return $r},$J.showLinkSprite=function(){var $J=this._text.words;if($J)for(var $o,$r,$S=[],$G=0;$G<$J.length;$G++)$r=$J[$G],($o=new $Y).graphics.drawRect(0,0,$r.width,$r.height,"#ff0000"),$o.width=$r.width,$o.height=$r.height,this.addChild($o),$S.push($o)},$J._layoutLater=function(){var $J=this.style;512&$J._type||($J.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$J.block?($t.later(this),$J._type|=512):this.parent&&this.parent._layoutLater())},$J._setAttributes=function($J,$o){switch($J){case"style":return void this.style.cssText($o);case"class":return void(this.className=$o)}$r.prototype._setAttributes.call(this,$J,$o)},$J.updateHref=function(){if(null!=this._href){var $J=this._getWords();if($J)for(var $o,$r,$S=0;$S<$J.length;$S++)($r=($o=$J[$S]).getSprite())&&($r.size($o.width,$o.height),$r.on("click",this,this.onLinkHandler))}},$J.onLinkHandler=function($J){switch($J.type){case"click":for(var $o=this;$o;)$o.event("link",[this.href]),$o=$o.parent}},$J.formatURL=function($J){return this.URI?$w.formatURL($J,this.URI?this.URI.path:null):$J},$h(0,$J,"href",function(){return this._href},function($J){null!=(this._href=$J)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$h(0,$J,"color",null,function($J){this.style.color=$J}),$h(0,$J,"onClick",null,function($J){$S._runScript("fn=function(event){"+$J+";}"),this.on("click",this,void 0)}),$h(0,$J,"id",null,function($J){$e.document.setElementById($J,this)}),$h(0,$J,"innerTEXT",function(){return this._text.text},function($J){this.text=$J}),$h(0,$J,"style",function(){return this._style}),$h(0,$J,"text",function(){return this._text.text},function($J){this._text==$o._EMPTYTEXT?this._text={text:$J,words:null}:(this._text.text=$J,this._text.words&&(this._text.words.length=0)),$j.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$h(0,$J,"parent",$r.prototype._$get_parent,function($J){if($J instanceof laya.html.dom.HTMLElement){var $o=$J;this.URI||(this.URI=$o.URI),this.style.inherit($o.style)}$S.superSet($Y,this,"parent",$J)}),$h(0,$J,"className",null,function($J){this.style.attrs($e.document.styleSheets["."+$J])}),$o.fillWords=function($J,$o,$r,$S,$G,$z,$A){$J.graphics.clear();for(var $h=0,$Z=$o.length;$h<$Z;$h++){var $u=$o[$h];$J.graphics.fillText($u.char,$u.x+$r,$u.y+$S,$G,$z,"left",$A)}},$o._EMPTYTEXT={text:null,words:null},$o}($Y),$o=(function($J){function $o(){$o.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$A($o,"laya.html.dom.HTMLBrElement",$K)}(),function($J){function $o(){this.contextHeight=NaN,this.contextWidth=NaN,$o.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$A($o,"laya.html.dom.HTMLDivElement",$J);var $r=$o.prototype;return $r.appendHTML=function($J){$I.parse(this,$J,this.URI),this.layout()},$r._addChildsToLayout=function($o){var $J=this._getWords();if(null==$J&&0==this._childs.length)return!1;$J&&$J.forEach(function($J){$o.push($J)});for(var $r=!0,$S=0,$G=this._childs.length;$S<$G;$S++){var $z=this._childs[$S];$r?$r=!1:$o.push(null),$z._addToLayout($o)}return!0},$r._addToLayout=function($J){this.layout()},$r.layout=function(){if(this.style){this.style._type|=512;var $J=$t.layout(this);if($J){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $B);var $o=this._$P.mHtmlBounds;$o.x=$o.y=0,$o.width=this.contextWidth=$J[0],$o.height=this.contextHeight=$J[1],this.setBounds($o)}}},$h(0,$r,"height",function(){return this._height?this._height:this.contextHeight},$J.prototype._$set_height),$h(0,$r,"innerHTML",null,function($J){this.destroyChildren(),this.appendHTML($J)}),$h(0,$r,"width",function(){return this._width?this._width:this.contextWidth},function($J){var $o=!1;$o=0===$J?$J!=this._width:$J!=this.width,$S.superSet($K,this,"width",$J),$o&&this.layout()}),$o}($K)),$e=function($J){function $o(){this.all=new Array,this.styleSheets=$Z.styleSheets,$o.__super.call(this)}$A($o,"laya.html.dom.HTMLDocument",$K);var $r=$o.prototype;return $r.getElementById=function($J){return this.all[$J]},$r.setElementById=function($J,$o){this.all[$J]=$o},$G($o,["document",function(){return this.document=new $o}]),$o}();(function($J){function $o(){this._tex=null,this._url=null,this._renderArgs=[],$o.__super.call(this),this.style.block=!0}$A($o,"laya.html.dom.HTMLImageElement",$K);var $r=$o.prototype;$r._addToLayout=function($J){!this._style.absolute&&$J.push(this)},$r.render=function($J,$o,$r){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($D.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$J.ctx.drawTexture2($o,$r,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$r.layaoutCallNative=function(){var $J=0;if(this._childs&&0<($J=this._childs.length))for(var $o=0;$o<$J;$o++)this._childs[$o].layaoutCallNative&&this._childs[$o].layaoutCallNative()},$h(0,$r,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($J){this._width!==$J&&(this._width=$J,this._style.width=$J,this.repaint())}),$h(0,$r,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($J){this._height!==$J&&(this._height=$J,this._style.height=$J,this.repaint())}),$r.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$u.clearCache(this,this._url),this._tex=null),$K.prototype.destroy.call(this)},$r.onloaded=function(){var $J=this._style;$J&&!$J.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$J&&!$J.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$j.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$r._loadImageComplete=function($J,$o,$r){if(!this._destroyed)if(null!=$r)if($r instanceof ArrayBuffer){var $S=new DataView($r);new laya.webgl.resource.WebGLImage(new Uint8Array($r,8),$J,0,!1,$S.getUint32(0),$S.getUint32(4));this.onloaded()}else if($r instanceof $N)$u.imgMgrSet[$J]=$o,$z.imgMgrLock($J,$u.imgMgrSet[$J]),this._url=$J,this._tex=$r,$u.keepCache(this,$J),$u.cacheRes($J,this._tex),this.onloaded();else{var $G=-1!=$J.indexOf(".png",$J.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($r,$J,$G,!1,$r.width,$r.height);this.onloaded()}else this.event("error","Load image failed")},$h(0,$r,"src",null,function($J){($J=this.formatURL($J),this._url!=$J)&&(null!=this._tex&&($u.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$J,(this._tex=$u.getRes($J))?($u.keepCache(this,$J),this.onloaded()):$z.imgMgrLoad($J,this._loadImageComplete.bind(this),2,!1))})})(),function($J){function $o(){this.type=null,$o.__super.call(this),this.visible=!1}$A($o,"laya.html.dom.HTMLLinkElement",$J);var $r=$o.prototype;$r._onload=function($J){switch(this.type){case"text/css":$Z.parseCSS($J,this.URI)}},$h(0,$r,"href",$J.prototype._$get_href,function($J){var $o=this;$J=this.formatURL($J),this.URI=new $w($J);var $r=new $u;$r.once("complete",null,function($J){$o._onload($J)}),$r.load($J,"text")}),$o._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($K),function($J){function $o(){$o.__super.call(this),this.visible=!1}$A($o,"laya.html.dom.HTMLStyleElement",$J),$h(0,$o.prototype,"text",$J.prototype._$get_text,function($J){$Z.parseCSS($J,null)})}($K),function($J){function $o(){$o.__super.call(this),this._getCSSStyle().valign="middle"}$A($o,"laya.html.dom.HTMLIframeElement",$J),$h(0,$o.prototype,"href",$J.prototype._$get_href,function($r){var $S=this;$r=this.formatURL($r);var $J=new $u;$J.once("complete",null,function($J){var $o=$S.URI;$S.URI=new $w($r),$S.innerHTML=$J,!$o||($S.URI=$o)}),$J.load($r,"text")})}($o)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($J,$o){"use strict";for(var $r in Object.defineProperty($o,"__esModule",{value:!0}),Laya){var $S=Laya[$r];$S&&$S.__isclass&&($o[$r]=$S)}}),function($G,$J,$D){$D.un,$D.uns;var $S=$D.static,$z=$D.class,$A=$D.getset,$r=($D.__newvec,laya.display.Animation),$N=(laya.utils.Browser,laya.utils.ClassUtils),$h=laya.filters.ColorFilter,$Z=laya.utils.Ease,$u=laya.events.Event,$B=(laya.events.EventDispatcher,laya.display.css.Font),$v=laya.display.FrameAnimation,$o=laya.display.Graphics,$j=laya.utils.Handler,$Y=laya.display.Input,$i=laya.net.Loader,$_=(laya.display.Node,laya.maths.Point),$w=laya.maths.Rectangle,$I=laya.renders.Render,$t=laya.display.Sprite,$K=laya.display.Text,$e=laya.resource.Texture,$y=laya.utils.Tween,$g=laya.utils.Utils,$s=laya.utils.WeakObject;$D.interface("laya.ui.IItem"),$D.interface("laya.ui.ISelect"),$D.interface("laya.ui.IRender"),$D.interface("laya.ui.IComponent"),$D.interface("laya.ui.IBox","IComponent");var $V=function(){function $J(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $z($J,"laya.ui.LayoutStyle"),$S($J,["EMPTY",function(){return this.EMPTY=new $J}]),$J}(),$m=function(){function $J(){}return $z($J,"laya.ui.Styles"),$J.labelColor="#000000",$J.buttonStateNum=3,$J.scrollBarMinNum=15,$J.scrollBarDelayTime=500,$S($J,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$J}(),$C=function(){function $G(){}return $z($G,"laya.ui.UIUtils"),$G.fillArray=function($J,$o,$r){var $S=$J.concat();if($o)for(var $G=$o.split(","),$z=0,$A=Math.min($S.length,$G.length);$z<$A;$z++){var $h=$G[$z];$S[$z]="true"==$h||"false"!=$h&&$h,null!=$r&&($S[$z]=$r($h))}return $S},$G.toColor=function($J){return $g.toHexColor($J)},$G.gray=function($J,$o){void 0===$o&&($o=!0),$o?$G.addFilter($J,$G.grayFilter):$G.clearFilter($J,$h)},$G.addFilter=function($J,$o){var $r=$J.filters||[];$r.push($o),$J.filters=$r},$G.clearFilter=function($J,$o){var $r=$J.filters;if(null!=$r&&0<$r.length){for(var $S=$r.length-1;-1<$S;$S--){var $G=$r[$S];$D.__typeof($G,$o)&&$r.splice($S,1)}$J.filters=$r}},$G._getReplaceStr=function($J){return $G.escapeSequence[$J]},$G.adptString=function($J){return $J.replace(/\\(\w)/g,$G._getReplaceStr)},$G.getBindFun=function($J){var $o=$G._funMap.get($J);if(null==$o){var $r='"'+$J+'"',$S="(function(data){if(data==null)return;with(data){try{\nreturn "+($r=$r.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$o=$D._runScript($S),$G._funMap.set($J,$o)}return $o},$S($G,["grayFilter",function(){return this.grayFilter=new $h([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $s}]),$G}(),$R=function(){function $J(){}return $z($J,"UIConfig"),$J.touchScrollEnable=!0,$J.mouseWheelEnable=!0,$J.showButtons=!0,$J.popupBgColor="#000000",$J.popupBgAlpha=.5,$J.closeDialogOnSide=!0,$J}(),$n=function($r){function $w(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$w.__super.call(this),this._weakKeys=[]}$z($w,"laya.ui.AutoBitmap",$r);var $J=$w.prototype;return $J.destroy=function(){if($i.clearObject(this,this._weakKey),this._weakKeys){for(var $J=0,$o=this._weakKeys.length;$J<$o;++$J)$i.clearObject(this,this._weakKeys[$J]);this._weakKeys=null}$r.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$J._setChanged=function(){this._isChanged||(this._isChanged=!0,$D.timer.callLater(this,this.changeSource))},$J.changeSource=function(){this._isChanged=!1;var $J=this._source;if($J&&$J.bitmap){var $o=this.width,$r=this.height,$S=this._sizeGrid,$G=$J.sourceWidth,$z=$J.sourceHeight;if(!$S||$G===$o&&$z===$r)this.cleanByTexture($J,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$o,$r);else{$i.clearObject(this,this._weakKey),$J.$_GID||($J.$_GID=$g.getGID());var $A=$J.$_GID+"."+$o+"."+$r+"."+$S.join("."),$h=$i.findObject($A);if($g.isOKCmdList($h))return this._weakKey=$A,$i.keepObject(this,this._weakKey),void(this.cmds=$h);this.clear();var $Z,$u,$B=$S[0],$v=$S[1],$j=$S[2],$Y=$S[3],$_=$S[4],$D=!1;if($o==$G&&($Y=$v=0),$r==$z&&($B=$j=0),$o<$Y+$v){var $N=$o;$D=!0,$o=$Y+$v,this.save(),this.clipRect(0,0,$N,$r)}$Y&&$B&&($Z=$w.getTexture($J,0,0,$Y,$B),$u=this._weakKeys[0],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[0]=$Z.weakKey),this.drawTexture($Z,0,0,$Y,$B)):($i.clearObject(this,$u),this._weakKeys[0]="")),$v&&$B&&($Z=$w.getTexture($J,$G-$v,0,$v,$B),$u=this._weakKeys[1],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[1]=$Z.weakKey),this.drawTexture($Z,$o-$v,0,$v,$B)):($i.clearObject(this,$u),this._weakKeys[1]="")),$Y&&$j&&($Z=$w.getTexture($J,0,$z-$j,$Y,$j),$u=this._weakKeys[2],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[2]=$Z.weakKey),this.drawTexture($Z,0,$r-$j,$Y,$j)):($i.clearObject(this,$u),this._weakKeys[2]="")),$v&&$j&&($Z=$w.getTexture($J,$G-$v,$z-$j,$v,$j),$u=this._weakKeys[3],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[3]=$Z.weakKey),this.drawTexture($Z,$o-$v,$r-$j,$v,$j)):($i.clearObject(this,$u),this._weakKeys[3]="")),$B&&($Z=$w.getTexture($J,$Y,0,$G-$Y-$v,$B),$u=this._weakKeys[4],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[4]=$Z.weakKey),this.drawBitmap($_,$Z,$Y,0,$o-$Y-$v,$B)):($i.clearObject(this,$u),this._weakKeys[4]="")),$j&&($Z=$w.getTexture($J,$Y,$z-$j,$G-$Y-$v,$j),$u=this._weakKeys[5],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[5]=$Z.weakKey),this.drawBitmap($_,$Z,$Y,$r-$j,$o-$Y-$v,$j)):($i.clearObject(this,$u),this._weakKeys[5]="")),$Y&&($Z=$w.getTexture($J,0,$B,$Y,$z-$B-$j),$u=this._weakKeys[6],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[6]=$Z.weakKey),this.drawBitmap($_,$Z,0,$B,$Y,$r-$B-$j)):($i.clearObject(this,$u),this._weakKeys[6]="")),$v&&($Z=$w.getTexture($J,$G-$v,$B,$v,$z-$B-$j),$u=this._weakKeys[7],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[7]=$Z.weakKey),this.drawBitmap($_,$Z,$o-$v,$B,$v,$r-$B-$j)):($i.clearObject(this,$u),this._weakKeys[7]="")),$Z=$w.getTexture($J,$Y,$B,$G-$Y-$v,$z-$B-$j),$u=this._weakKeys[8],$Z?($u!=$Z.weakKey&&($i.clearObject(this,$u),$i.keepObject(this,$Z.weakKey),this._weakKeys[8]=$Z.weakKey),this.drawBitmap($_,$Z,$Y,$B,$o-$Y-$v,$r-$B-$j)):($i.clearObject(this,$u),this._weakKeys[8]=""),$D&&this.restore(),this.autoCacheCmd&&!$I.isConchApp&&($i.saveObject($A,this.cmds,null),this._weakKey=$A,$i.keepObject(this,this._weakKey))}this._repaint()}},$J.drawBitmap=function($J,$o,$r,$S,$G,$z){void 0===$G&&($G=0),void 0===$z&&($z=0),$G<.1||$z<.1||(!$J||$o.width==$G&&$o.height==$z?this.drawTexture($o,$r,$S,$G,$z):this.fillTexture($o,$r,$S,$G,$z))},$J.clear=function($J){void 0===$J&&($J=!0),$r.prototype.clear.call(this,!1)},$A(0,$J,"sizeGrid",function(){return this._sizeGrid},function($J){this._sizeGrid=$J,this._setChanged()}),$A(0,$J,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($J){this._width!=$J&&(this._width=$J,this._setChanged())}),$A(0,$J,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($J){this._height!=$J&&(this._height=$J,this._setChanged())}),$A(0,$J,"source",function(){return this._source},function($J){$J?(this._source=$J,this._setChanged()):(this._source=null,this.clear())}),$w.getTexture=function($J,$o,$r,$S,$G){$S<=0&&($S=1),$G<=0&&($G=1),$J.$_GID||($J.$_GID=$g.getGID());var $z=$J.$_GID+"."+$o+"."+$r+"."+$S+"."+$G,$A=$i.findObject($z);if((!$A||!$A.source)&&($A=$e.createFromTexture($J,$o,$r,$S,$G))){if($J.alphaTexture){var $h=$J.width/$J.alphaTexture.width;$A.alphaTexture=$e.createFromTexture($J.alphaTexture,$o/$h,$r/$h,$S/$h,$G/$h)}$i.saveObject($z,$A),$A.weakKey=$z}return $A},$w}($o),$k=(function($J){function $o(){$o.__super.call(this)}$z($o,"laya.ui.UIEvent",$u),$o.SHOW_TIP="showtip",$o.HIDE_TIP="hidetip"}(),function($o){function $J(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$J.__super.call(this),this._layout=$V.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$z($J,"laya.ui.Component",$o);var $r=$J.prototype;return $D.imps($r,{"laya.ui.IComponent":!0}),$r.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$r.preinitialize=function(){},$r.createChildren=function(){},$r.initialize=function(){},$r.callLater=function($J,$o){$D.timer.callLater(this,$J,$o)},$r.runCallLater=function($J){$D.timer.runCallLater(this,$J)},$r.commitMeasure=function(){},$r.changeSize=function(){this.event("resize")},$r.getLayout=function(){return this._layout===$V.EMPTY&&(this._layout=new $V),this._layout},$r._setLayoutEnabled=function($J){this._layout&&this._layout.enable!=$J&&(this._layout.enable=$J,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$r.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$r.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$r.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$r.resetLayoutX=function(){var $J=this._layout;if(isNaN($J.anchorX)||(this.pivotX=$J.anchorX*this.width),this.layoutEnabled){var $o=this.parent;$o&&(isNaN($J.centerX)?isNaN($J.left)?isNaN($J.right)||(this.x=Math.round($o.width-this.displayWidth-$J.right+this.pivotX*this.scaleX)):(this.x=Math.round($J.left+this.pivotX*this.scaleX),isNaN($J.right)||(this.width=($o._width-$J.left-$J.right)/(this.scaleX||.01))):this.x=Math.round(.5*($o.width-this.displayWidth)+$J.centerX+this.pivotX*this.scaleX))}},$r.resetLayoutY=function(){var $J=this._layout;if(isNaN($J.anchorY)||(this.pivotY=$J.anchorY*this.height),this.layoutEnabled){var $o=this.parent;$o&&(isNaN($J.centerY)?isNaN($J.top)?isNaN($J.bottom)||(this.y=Math.round($o.height-this.displayHeight-$J.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($J.top+this.pivotY*this.scaleY),isNaN($J.bottom)||(this.height=($o._height-$J.top-$J.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($o.height-this.displayHeight)+$J.centerY+this.pivotY*this.scaleY))}},$r.onMouseOver=function($J){$D.stage.event("showtip",this._toolTip)},$r.onMouseOut=function($J){$D.stage.event("hidetip",this._toolTip)},$A(0,$r,"displayWidth",function(){return this.width*this.scaleX}),$A(0,$r,"width",function(){return this._width?this._width:this.measureWidth},function($J){this._width!=$J&&(this._width=$J,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$A(0,$r,"measureWidth",function(){var $J=0;this.commitMeasure();for(var $o=this.numChildren-1;-1<$o;$o--){var $r=this.getChildAt($o);$r.visible&&($J=Math.max($r.x+$r.width*$r.scaleX,$J))}return $J}),$A(0,$r,"displayHeight",function(){return this.height*this.scaleY}),$A(0,$r,"height",function(){return this._height?this._height:this.measureHeight},function($J){this._height!=$J&&(this._height=$J,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$A(0,$r,"dataSource",function(){return this._dataSource},function($J){for(var $o in this._dataSource=$J,this._dataSource)this.hasOwnProperty($o)&&"function"!=typeof this[$o]&&(this[$o]=this._dataSource[$o])}),$A(0,$r,"scaleY",$o.prototype._$get_scaleY,function($J){$D.superGet($t,this,"scaleY")!=$J&&($D.superSet($t,this,"scaleY",$J),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$A(0,$r,"measureHeight",function(){var $J=0;this.commitMeasure();for(var $o=this.numChildren-1;-1<$o;$o--){var $r=this.getChildAt($o);$r.visible&&($J=Math.max($r.y+$r.height*$r.scaleY,$J))}return $J}),$A(0,$r,"scaleX",$o.prototype._$get_scaleX,function($J){$D.superGet($t,this,"scaleX")!=$J&&($D.superSet($t,this,"scaleX",$J),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$A(0,$r,"top",function(){return this._layout.top},function($J){$J!=this._layout.top&&(this.getLayout().top=$J,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$A(0,$r,"bottom",function(){return this._layout.bottom},function($J){$J!=this._layout.bottom&&(this.getLayout().bottom=$J,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$A(0,$r,"left",function(){return this._layout.left},function($J){$J!=this._layout.left&&(this.getLayout().left=$J,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$A(0,$r,"right",function(){return this._layout.right},function($J){$J!=this._layout.right&&(this.getLayout().right=$J,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$A(0,$r,"centerX",function(){return this._layout.centerX},function($J){$J!=this._layout.centerX&&(this.getLayout().centerX=$J,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$A(0,$r,"centerY",function(){return this._layout.centerY},function($J){$J!=this._layout.centerY&&(this.getLayout().centerY=$J,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$A(0,$r,"anchorX",function(){return this._layout.anchorX},function($J){$J!=this._layout.anchorX&&(this.getLayout().anchorX=$J,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$A(0,$r,"anchorY",function(){return this._layout.anchorY},function($J){$J!=this._layout.anchorY&&(this.getLayout().anchorY=$J,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$A(0,$r,"tag",function(){return this._tag},function($J){this._tag=$J}),$A(0,$r,"toolTip",function(){return this._toolTip},function($J){this._toolTip!=$J&&(null!=(this._toolTip=$J)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$A(0,$r,"comXml",function(){return this._comXml},function($J){this._comXml=$J}),$A(0,$r,"gray",function(){return this._gray},function($J){$J!==this._gray&&(this._gray=$J,$C.gray(this,$J))}),$A(0,$r,"disabled",function(){return this._disabled},function($J){$J!==this._disabled&&(this.gray=this._disabled=$J,this.mouseEnabled=!$J)}),$J}($t)),$U=function($J){function $o(){this.lockLayer=null,this.popupEffect=function($J){$J.scale(1,1),$y.from($J,{x:$D.stage.width/2,y:$D.stage.height/2,scaleX:0,scaleY:0},300,$Z.backOut,$j.create(this,this.doOpen,[$J]))},this.closeEffect=function($J,$o){$y.to($J,{x:$D.stage.width/2,y:$D.stage.height/2,scaleX:0,scaleY:0},300,$Z.strongOut,$j.create(this,this.doClose,[$J,$o]))},$o.__super.call(this),this.maskLayer=new $t,this.popupEffectHandler=$j.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$j.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$D.stage.addChild(this),$D.stage.on("resize",this,this._onResize),$R.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$z($o,"laya.ui.DialogManager",$t);var $r=$o.prototype;return $r._closeOnSide=function(){var $J=this.getChildAt(this.numChildren-1);$J instanceof laya.ui.Dialog&&$J.close("side")},$r.setLockView=function($J){this.lockLayer||(this.lockLayer=new $L,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($D.stage.width,$D.stage.height)),this.lockLayer.removeChildren(),$J&&($J.centerX=$J.centerY=0,this.lockLayer.addChild($J))},$r._onResize=function($J){var $o=this.maskLayer.width=$D.stage.width,$r=this.maskLayer.height=$D.stage.height;this.lockLayer&&this.lockLayer.size($o,$r),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$o,$r,$R.popupBgColor),this.maskLayer.alpha=$R.popupBgAlpha;for(var $S=this.numChildren-1;-1<$S;$S--){var $G=this.getChildAt($S);$G.popupCenter&&this._centerDialog($G)}},$r._centerDialog=function($J){$J.x=Math.round(($D.stage.width-$J.width>>1)+$J.pivotX),$J.y=Math.round(($D.stage.height-$J.height>>1)+$J.pivotY)},$r.open=function($J,$o,$r){void 0===$o&&($o=!1),void 0===$r&&($r=!1),$o&&this._closeAll(),$J.popupCenter&&this._centerDialog($J),this.addChild($J),($J.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$r&&null!=$J.popupEffect?$J.popupEffect.runWith($J):this.doOpen($J),this.event("open")},$r.doOpen=function($J){$J.onOpened()},$r.lock=function($J){this.lockLayer&&($J?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$r.close=function($J,$o,$r){void 0===$r&&($r=!1),$r&&null!=$J.closeEffect?$J.closeEffect.runWith([$J,$o]):this.doClose($J,$o),this.event("close")},$r.doClose=function($J,$o){$J.removeSelf(),$J.isModal&&this._checkMask(),$J.closeHandler&&$J.closeHandler.runWith($o),$J.onClosed($o)},$r.closeAll=function(){this._closeAll(),this.event("close")},$r._closeAll=function(){for(var $J=this.numChildren-1;-1<$J;$J--){var $o=this.getChildAt($J);$o&&null!=$o.close&&this.doClose($o)}},$r.getDialogsByGroup=function($J){for(var $o=[],$r=this.numChildren-1;-1<$r;$r--){var $S=this.getChildAt($r);$S&&$S.group===$J&&$o.push($S)}return $o},$r.closeByGroup=function($J){for(var $o=[],$r=this.numChildren-1;-1<$r;$r--){var $S=this.getChildAt($r);$S&&$S.group===$J&&($S.close(),$o.push($S))}return $o},$r._checkMask=function(){this.maskLayer.removeSelf();for(var $J=this.numChildren-1;-1<$J;$J--){var $o=this.getChildAt($J);if($o&&$o.isModal)return void this.addChildAt(this.maskLayer,$J)}},$o}(),$L=function($J){function $o(){$o.__super.call(this)}$z($o,"laya.ui.Box",$J);var $r=$o.prototype;return $D.imps($r,{"laya.ui.IBox":!0}),$A(0,$r,"dataSource",$J.prototype._$get_dataSource,function($J){for(var $o in this._dataSource=$J){var $r=this.getChildByName($o);$r?$r.dataSource=$J[$o]:this.hasOwnProperty($o)&&"function"!=typeof this[$o]&&(this[$o]=$J[$o])}}),$o}($k),$Q=function($o){function $r($J,$o){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$r.__super.call(this),this._labelColors=$m.buttonLabelColors,this._stateNum=$m.buttonStateNum,void 0===$o&&($o=""),this.skin=$J,this.label=$o}$z($r,"laya.ui.Button",$o);var $J=$r.prototype;return $D.imps($J,{"laya.ui.ISelect":!0}),$J.destroy=function($J){this.clearEvent(),$i.clearCache(this,this._skin),$i.clearObject(this,this._weakKey),void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($J),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$J.clearEvent=function(){this._skin&&$G.atalsNotify&&$G.atalsNotify.off(this._skin,this,this._setBtnSource)},$J.createChildren=function(){this.graphics=this._bitmap=new $n},$J.createText=function(){this._text||(this._text=new $K,this._text.overflow=$K.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$J.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$J.onMouse=function($J){if(!1!==this.toggle||!this._selected)return"click"===$J.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$r.stateMap[$J.type]))},$J.changeClips=function(){var $J=$i.getRes(this._skin);if($J)if(this._skin&&""!=this._skin){$i.clearObject(this,this._weakKey);var $o=$J.sourceWidth,$r=$J.sourceHeight/this._stateNum;$J.$_GID||($J.$_GID=$g.getGID());var $S=$J.$_GID+"-"+this._stateNum,$G=$i.findObject($S);if($g.isOkTextureList($G)||($G=null),$G)this._weakKey=$S,$i.keepObject(this,this._weakKey),this._sources=$G;else{if(this._sources=[],1===this._stateNum)this._sources.push($J);else for(var $z=0;$z<this._stateNum;$z++){var $A=$e.createFromTexture($J,0,$r*$z,$o,$r);if($J.alphaTexture){var $h=$J.width/$J.alphaTexture.width;$A.alphaTexture=$e.createFromTexture($J.alphaTexture,0/$h,$r*$z/$h,$o/$h,$r/$h)}this._sources.push($A)}$i.saveObject($S,this._sources),this._weakKey=$S,$i.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$o,this._bitmap.height=this._height||$r,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$o)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$J.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $J=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$J]),this.label&&(this._text.color=this._labelColors[$J],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$J]))},$J._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$A(0,$J,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($J){this.createText(),this._text.strokeColor=$J}),$A(0,$J,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$A(0,$J,"skin",function(){return this._skin},function($J){if(this._skin!=$J)if(this.clearEvent(),$i.clearCache(this,this._skin),this._skin=$J,$i.keepCache(this,this._skin),$i.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $o=$G.resAtalsObj&&$G.resAtalsObj[this._skin];$o?($G.atalsNotify&&$G.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$o.sourceW),0==this.height&&(this.height=$o.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$J._setBtnSource=function($J,$o){$J===this._skin&&$o&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$A(0,$J,"state",function(){return this._state},function($J){this._state!=$J&&(this._state=$J,this._setStateChanged())}),$A(0,$J,"text",function(){return this.createText(),this._text}),$A(0,$J,"stateNum",function(){return this._stateNum},function($J){"string"==typeof $J&&($J=parseInt($J)),this._stateNum!=$J&&(this._stateNum=$J<1?1:3<$J?3:$J,this.callLater(this.changeClips))}),$A(0,$J,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($J){this._strokeColors=$C.fillArray($m.buttonLabelColors,$J,String),this._setStateChanged()}),$A(0,$J,"labelColors",function(){return this._labelColors.join(",")},function($J){this._labelColors=$C.fillArray($m.buttonLabelColors,$J,String),this._setStateChanged()}),$A(0,$J,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$A(0,$J,"label",function(){return this._text?this._text.text:null},function($J){(this._text||$J)&&(this.createText(),this._text.text!=$J&&($J&&!this._text.parent&&this.addChild(this._text),this._text.text=($J+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$A(0,$J,"selected",function(){return this._selected},function($J){this._selected!=$J&&(this._selected=$J,this.state=this._selected?2:0,this.event("change"))}),$A(0,$J,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($J){this.createText(),this._text.padding=$C.fillArray($m.labelPadding,$J,Number)}),$A(0,$J,"labelSize",function(){return this.createText(),this._text.fontSize},function($J){this.createText(),this._text.fontSize=$J}),$A(0,$J,"labelStroke",function(){return this.createText(),this._text.stroke},function($J){this.createText(),this._text.stroke=$J}),$A(0,$J,"labelBold",function(){return this.createText(),this._text.bold},function($J){this.createText(),this._text.bold=$J}),$A(0,$J,"labelFont",function(){return this.createText(),this._text.font},function($J){this.createText(),this._text.font=$J}),$A(0,$J,"labelAlign",function(){return this.createText(),this._text.align},function($J){this.createText(),this._text.align=$J}),$A(0,$J,"clickHandler",function(){return this._clickHandler},function($J){this._clickHandler=$J}),$A(0,$J,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($J){this._bitmap.sizeGrid=$C.fillArray($m.defaultSizeGrid,$J,Number)}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($k,this,"width",$J),this._autoSize&&(this._bitmap.width=$J,this._text&&(this._text.width=$J))}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($k,this,"height",$J),this._autoSize&&(this._bitmap.height=$J,this._text&&(this._text.height=$J))}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)||"string"==typeof $J?this.label=$J+"":$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($J){this._bitmap._offset=$J?$C.fillArray([1,1],$J,Number):[]}),$S($r,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$r}($k),$p=function($o){function $S($J,$o,$r){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$S.__super.call(this),void 0===$o&&($o=1),void 0===$r&&($r=1),this._clipX=$o,this._clipY=$r,this.skin=$J}$z($S,"laya.ui.Clip",$o);var $J=$S.prototype;return $J.destroy=function($J){this.clearEvent(),this.clearLoad(),$i.clearCache(this,this._skin),$i.clearObject(this,this._weakKey),void 0===$J&&($J=!0),$o.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$J.dispose=function(){this.destroy(!0),$D.loader.clearRes(this._skin)},$J.createChildren=function(){this.graphics=this._bitmap=new $n},$J._onDisplay=function($J){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$J.changeClip=function(){if(this._clipChanged=!1,this._skin){var $J=$i.getRes(this._skin);if($J)this.loadComplete(this._skin,$J);else{if($G.resAtalsObj&&$G.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$j.create(this,this.loadComplete,[this._skin]),this._progress=null,$D.loader.load(this._skin,this._complete,this._progress)}}},$J.loadComplete=function($J,$o){if($J===this._skin&&$o){$i.clearObject(this,this._weakKey);var $r=this._clipWidth||Math.ceil($o.sourceWidth/this._clipX),$S=this._clipHeight||Math.ceil($o.sourceHeight/this._clipY),$G=this._skin+$r+$S,$z=$i.findObject($G);if($g.isOkTextureList($z)||($z=null),$z)this._weakKey=$G,$i.keepObject(this,this._weakKey),this._sources=$z;else{this._sources=[];for(var $A=0;$A<this._clipY;$A++)for(var $h=0;$h<this._clipX;$h++){var $Z=$e.createFromTexture($o,$r*$h,$S*$A,$r,$S);if($o.alphaTexture){var $u=$o.width/$o.alphaTexture.width;$Z.alphaTexture=$e.createFromTexture($o.alphaTexture,$r*$h/$u,$S*$A/$u,$r/$u,$S/$u)}this._sources.push($Z)}$i.saveObject($G,this._sources),this._weakKey=$G,$i.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$J.play=function($J,$o){void 0===$J&&($J=0),void 0===$o&&($o=-1),this._isPlaying=!0,this.index=$J,this._toIndex=$o,this._index++,$D.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$J._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$J.stop=function(){this._isPlaying=!1,$D.timer.clear(this,this._loop),this.event("complete")},$J._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$A(0,$J,"interval",function(){return this._interval},function($J){this._interval!=$J&&(this._interval=$J,this._isPlaying&&this.play())}),$J.clearEvent=function(){this._skin&&$G.atalsNotify&&$G.atalsNotify.off(this._skin,this,this._setBtnSource)},$J.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$D.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$A(0,$J,"skin",function(){return this._skin},function($J){if(this._skin!=$J)if(this.clearLoad(),this.clearEvent(),$i.clearCache(this,this._skin),this._skin=$J){$i.keepCache(this,this._skin);var $o=$i.getRes($J),$r=$G.resAtalsObj&&$G.resAtalsObj[this._skin];!$o&&$r?$G.atalsNotify&&$G.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$J._setBtnSource=function($J,$o){$J===this._skin&&$o&&(this.loadComplete($J,$o),this.clearEvent())},$A(0,$J,"sources",function(){return this._sources},function($J){this._sources=$J,this.index=this._index,this.event("loaded")}),$A(0,$J,"clipX",function(){return this._clipX},function($J){this._clipX=$J||1,this._setClipChanged()}),$A(0,$J,"clipY",function(){return this._clipY},function($J){this._clipY=$J||1,this._setClipChanged()}),$A(0,$J,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$A(0,$J,"clipWidth",function(){return this._clipWidth},function($J){this._clipWidth=$J,this._setClipChanged()}),$A(0,$J,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($J){this._bitmap.sizeGrid=$C.fillArray($m.defaultSizeGrid,$J,Number)}),$A(0,$J,"group",function(){return this._group},function($J){$J&&this._skin&&$i.setGroup(this._skin,$J),this._group=$J}),$A(0,$J,"clipHeight",function(){return this._clipHeight},function($J){this._clipHeight=$J,this._setClipChanged()}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($k,this,"width",$J),this._bitmap.width=$J}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($k,this,"height",$J),this._bitmap.height=$J}),$A(0,$J,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$A(0,$J,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$A(0,$J,"index",function(){return this._index},function($J){this._index=$J,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$J]),this.event("change")}),$A(0,$J,"autoPlay",function(){return this._autoPlay},function($J){this._autoPlay!=$J&&((this._autoPlay=$J)?this.play():this.stop())}),$A(0,$J,"isPlaying",function(){return this._isPlaying},function($J){this._isPlaying=$J}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)&&Math.floor($J)==$J||"string"==typeof $J?this.index=parseInt($J):$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"bitmap",function(){return this._bitmap}),$S}($k),$f=function($o){function $J(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$J.__super.call(this)}$z($J,"laya.ui.ColorPicker",$o);var $r=$J.prototype;return $r.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._colorPanel&&this._colorPanel.destroy($J),this._colorButton&&this._colorButton.destroy($J),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$r.createChildren=function(){this.addChild(this._colorButton=new $Q),this._colorPanel=new $L,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $t),this._colorPanel.addChild(this._colorBlock=new $t),this._colorPanel.addChild(this._colorInput=new $Y)},$r.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$r.onPanelMouseDown=function($J){$J.stopPropagation()},$r.changePanel=function(){this._panelChanged=!1;var $J=this._colorPanel.graphics;$J.clear(),$J.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($J=this._colorTiles.graphics).clear();for(var $o=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$r=0;$r<12;$r++)for(var $S=0;$S<20;$S++){var $G=0;$G=0===$S?$o[$r]:1===$S?0:51*(((3*$r+$S/6)%3<<0)+3*($r/6<<0))<<16|$S%6*51<<8|($r<<0)%6*51;var $z=$C.toColor($G);this._colors.push($z);var $A=$S*this._gridSize,$h=$r*this._gridSize;$J.drawRect($A,$h,this._gridSize,this._gridSize,$z,"#000000")}},$r.onColorButtonClick=function($J){this._colorPanel.parent?this.close():this.open()},$r.open=function(){var $J=this.localToGlobal(new $_),$o=$J.x+this._colorPanel.width<=$D.stage.width?$J.x:$D.stage.width-this._colorPanel.width,$r=$J.y+this._colorButton.height;$r=$r+this._colorPanel.height<=$D.stage.height?$r:$J.y-this._colorPanel.height,this._colorPanel.pos($o,$r),this._colorPanel.zOrder=1001,$D._currentStage.addChild(this._colorPanel),$D.stage.on("mousedown",this,this.removeColorBox)},$r.close=function(){$D.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$r.removeColorBox=function($J){this.close()},$r.onColorFieldKeyDown=function($J){13==$J.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$J.stopPropagation())},$r.onColorInputChange=function($J){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$r.onColorTilesClick=function($J){this.selectedColor=this.getColorByMouse(),this.close()},$r.onColorTilesMouseMove=function($J){this._colorInput.focus=!1;var $o=this.getColorByMouse();this._colorInput.text=$o,this.drawBlock($o)},$r.getColorByMouse=function(){var $J=this._colorTiles.getMousePoint(),$o=Math.floor($J.x/this._gridSize),$r=Math.floor($J.y/this._gridSize);return this._colors[20*$r+$o]},$r.drawBlock=function($J){var $o=this._colorBlock.graphics;$o.clear();var $r=$J||"#ffffff";$o.drawRect(0,0,50,20,$r,this._borderColor),$J||$o.drawLine(0,0,50,20,"#ff0000")},$r.changeColor=function(){var $J=this.graphics;$J.clear();var $o=this._selectedColor||"#000000";$J.drawRect(0,0,this._colorButton.width,this._colorButton.height,$o)},$r._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$A(0,$r,"inputBgColor",function(){return this._inputBgColor},function($J){this._inputBgColor=$J,this._setPanelChanged()}),$A(0,$r,"selectedColor",function(){return this._selectedColor},function($J){this._selectedColor!=$J&&(this._selectedColor=this._colorInput.text=$J,this.drawBlock($J),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$u.EMPTY.setTo("change",this,this)))}),$A(0,$r,"skin",function(){return this._colorButton.skin},function($J){this._colorButton.skin=$J,this.changeColor()}),$A(0,$r,"bgColor",function(){return this._bgColor},function($J){this._bgColor=$J,this._setPanelChanged()}),$A(0,$r,"borderColor",function(){return this._borderColor},function($J){this._borderColor=$J,this._setPanelChanged()}),$A(0,$r,"inputColor",function(){return this._inputColor},function($J){this._inputColor=$J,this._setPanelChanged()}),$J}($k),$F=function($o){function $r($J,$o){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$r.__super.call(this),this._itemColors=$m.comboBoxItemColors,this.skin=$J,this.labels=$o}$z($r,"laya.ui.ComboBox",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._button&&this._button.destroy($J),this._list&&this._list.destroy($J),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$J.createChildren=function(){this.addChild(this._button=new $Q),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$J._createList=function(){this._list=new $x,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$J._setListEvent=function($J){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$j.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$J.onListDown=function($J){$J.stopPropagation()},$J.onScrollBarDown=function($J){$J.stopPropagation()},$J.onButtonMouseDown=function($J){this.callLater(this.switchTo,[!this._isOpen])},$J.changeList=function(){this._listChanged=!1;var $J=this.width-2,$o=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$J,height:this._itemHeight,fontSize:this._itemSize,color:$o}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$J.onlistItemMouse=function($J,$o){var $r=$J.type;if("mouseover"===$r||"mouseout"===$r){if(this._isCustomList)return;var $S=this._list.getCell($o);if(!$S)return;var $G=$S.getChildByName("label");$G&&("mouseover"===$r?($G.bgColor=this._itemColors[0],$G.color=this._itemColors[1]):($G.bgColor=null,$G.color=this._itemColors[2]))}else"click"===$r&&(this.selectedIndex=$o,this.isOpen=!1)},$J.switchTo=function($J){this.isOpen=$J},$J.changeOpen=function(){this.isOpen=!this._isOpen},$J.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $J=this._list.graphics;$J.clear(),$J.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $o=this._list.array||[],$r=$o.length=0,$S=this._labels.length;$r<$S;$r++)$o.push({label:this._labels[$r]});this._list.height=this._listHeight,this._list.array=$o},$J.changeSelected=function(){this._button.label=this.selectedLabel},$J._onStageMouseWheel=function($J){this._list&&!this._list.contains($J.target)&&this.removeList(null)},$J.removeList=function($J){$D.stage.off("mousedown",this,this.removeList),$D.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$A(0,$J,"selectedIndex",function(){return this._selectedIndex},function($J){this._selectedIndex!=$J&&(this._selectedIndex=$J,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$u.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$A(0,$J,"measureHeight",function(){return this._button.height}),$A(0,$J,"skin",function(){return this._button.skin},function($J){this._button.skin!=$J&&(this._button.skin=$J,this._listChanged=!0)}),$A(0,$J,"measureWidth",function(){return this._button.width}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($k,this,"width",$J),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$A(0,$J,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($J){this.selectedIndex=this._labels.indexOf($J)}),$A(0,$J,"labels",function(){return this._labels.join(",")},function($J){0<this._labels.length&&(this.selectedIndex=-1),$J?this._labels=$J.split(","):this._labels.length=0,this._itemChanged=!0}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($k,this,"height",$J),this._button.height=this._height}),$A(0,$J,"selectHandler",function(){return this._selectHandler},function($J){this._selectHandler=$J}),$A(0,$J,"visibleNum",function(){return this._visibleNum},function($J){this._visibleNum=$J,this._listChanged=!0}),$A(0,$J,"labelBold",function(){return this._button.text.bold},function($J){this._button.text.bold=$J}),$A(0,$J,"itemColors",function(){return String(this._itemColors)},function($J){this._itemColors=$C.fillArray(this._itemColors,$J,String),this._listChanged=!0}),$A(0,$J,"itemSize",function(){return this._itemSize},function($J){this._itemSize=$J,this._listChanged=!0}),$A(0,$J,"scrollBar",function(){return this.list.scrollBar}),$A(0,$J,"isOpen",function(){return this._isOpen},function($J){if(this._isOpen!=$J)if(this._isOpen=$J,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $o=this.localToGlobal($_.TEMP.setTo(0,0)),$r=$o.y+this._button.height;$r=$r+this._listHeight<=$D.stage.height?$r:$o.y-this._listHeight,this._list.pos($o.x,$r),this._list.zOrder=1001,$D._currentStage.addChild(this._list),$D.stage.once("mousedown",this,this.removeList),$D.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$A(0,$J,"scrollBarSkin",function(){return this._scrollBarSkin},function($J){this._scrollBarSkin=$J}),$A(0,$J,"sizeGrid",function(){return this._button.sizeGrid},function($J){this._button.sizeGrid=$J}),$A(0,$J,"button",function(){return this._button}),$A(0,$J,"list",function(){return this._list||this._createList(),this._list},function($J){$J&&($J.removeSelf(),this._isCustomList=!0,this._list=$J,this._setListEvent($J),this._itemHeight=$J.getCell(0).height+$J.spaceY)}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)&&Math.floor($J)==$J||"string"==typeof $J?this.selectedIndex=parseInt($J):$J instanceof Array?this.labels=$J.join(","):$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"labelColors",function(){return this._button.labelColors},function($J){this._button.labelColors!=$J&&(this._button.labelColors=$J)}),$A(0,$J,"labelPadding",function(){return this._button.text.padding.join(",")},function($J){this._button.text.padding=$C.fillArray($m.labelPadding,$J,Number)}),$A(0,$J,"labelSize",function(){return this._button.text.fontSize},function($J){this._button.text.fontSize=$J}),$A(0,$J,"labelFont",function(){return this._button.text.font},function($J){this._button.text.font=$J}),$A(0,$J,"stateNum",function(){return this._button.stateNum},function($J){this._button.stateNum=$J}),$r}($k),$d=function($o){function $r($J){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$r.__super.call(this),this._showButtons=$R.showButtons,this._touchScrollEnable=$R.touchScrollEnable,this._mouseWheelEnable=$R.mouseWheelEnable,this.skin=$J,this.max=1}$z($r,"laya.ui.ScrollBar",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),this.stopScroll(),this.target=null,$o.prototype.destroy.call(this,$J),this.upButton&&this.upButton.destroy($J),this.downButton&&this.downButton.destroy($J),this.slider&&this.slider.destroy($J),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$J.createChildren=function(){this.addChild(this.slider=new $l),this.addChild(this.upButton=new $Q),this.addChild(this.downButton=new $Q)},$J.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$J.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$J.onButtonMouseDown=function($J){var $o=$J.currentTarget===this.upButton;this.slide($o),$D.timer.once($m.scrollBarDelayTime,this,this.startLoop,[$o]),$D.stage.once("mouseup",this,this.onStageMouseUp)},$J.startLoop=function($J){$D.timer.frameLoop(1,this,this.slide,[$J])},$J.slide=function($J){$J?this.value-=this._scrollSize:this.value+=this._scrollSize},$J.onStageMouseUp=function($J){$D.timer.clear(this,this.startLoop),$D.timer.clear(this,this.slide)},$J.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$J.changeSize=function(){$o.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$J.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$J.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$J.setScroll=function($J,$o,$r){this.runCallLater(this.changeSize),this.slider.setSlider($J,$o,$r),this.slider.bar.visible=0<$o,!this._hide&&this.autoHide&&(this.visible=!1)},$J.onTargetMouseWheel=function($J){this.value-=$J.delta*this._scrollSize,this.target=this._target},$J.onTargetMouseDown=function($J){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $_),this._lastPoint.setTo($D.stage.mouseX,$D.stage.mouseY),$D.timer.clear(this,this.tweenMove),$y.clearTween(this),$D.stage.once("mouseup",this,this.onStageMouseUp2),$D.stage.once("mouseout",this,this.onStageMouseUp2),$D.timer.frameLoop(1,this,this.loop)},$J.loop=function(){var $J=$D.stage.mouseY,$o=$D.stage.mouseX;if(this._lastOffset=this.isVertical?$J-this._lastPoint.y:$o-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$D.stage._canvasTransform.getScaleY():$D.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$o,this._lastPoint.y=$J,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$J.onStageMouseUp2=function($J){if($D.stage.off("mouseup",this,this.onStageMouseUp2),$D.stage.off("mouseout",this,this.onStageMouseUp2),$D.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$y.to(this,{value:this.min},this.elasticBackTime,$Z.sineOut,$j.create(this,this.elasticOver)):this._value>this.max&&$y.to(this,{value:this.max},this.elasticBackTime,$Z.sineOut,$j.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$D.stage.mouseY-this._lastPoint.y:$D.stage.mouseX-this._lastPoint.x);for(var $o=0,$r=Math.min(this._offsets.length,3),$S=0;$S<$r;$S++)$o+=this._offsets[this._offsets.length-1-$S];if(this._lastOffset=$o/$r,($o=Math.abs(this._lastOffset))<2)return void this.event("end");60<$o&&(this._lastOffset=0<this._lastOffset?60:-60);var $G=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$D.timer.frameLoop(1,this,this.tweenMove,[$G])}},$J.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$y.to(this,{alpha:0},500),this.event("end")},$J.tweenMove=function($J){this._lastOffset*=this.rollRatio;var $o=NaN;if(0<$J&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$o=.5*-(this.min-$J-this.value),this._lastOffset>$o&&(this._lastOffset=$o)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$o=.5*-(this.max+$J-this.value),this._lastOffset<$o&&(this._lastOffset=$o))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($D.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$y.to(this,{value:this.min},this.elasticBackTime,$Z.sineOut,$j.create(this,this.elasticOver)):this._value>this.max?$y.to(this,{value:this.max},this.elasticBackTime,$Z.sineOut,$j.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$y.to(this,{alpha:0},500)}},$J.stopScroll=function(){this.onStageMouseUp2(null),$D.timer.clear(this,this.tweenMove),$y.clearTween(this)},$A(0,$J,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$A(0,$J,"skin",function(){return this._skin},function($J){this._skin!=$J&&(this._skin=$J,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$A(0,$J,"max",function(){return this.slider.max},function($J){this.slider.max=$J}),$A(0,$J,"showButtons",function(){return this._showButtons},function($J){this._showButtons=$J,this.callLater(this.changeScrollBar)}),$A(0,$J,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$A(0,$J,"min",function(){return this.slider.min},function($J){this.slider.min=$J}),$A(0,$J,"value",function(){return this._value},function($J){$J!==this._value&&(this._value=$J,this._isElastic||(this.slider._value!=$J&&(this.slider._value=$J,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$A(0,$J,"isVertical",function(){return this.slider.isVertical},function($J){this.slider.isVertical=$J}),$A(0,$J,"sizeGrid",function(){return this.slider.sizeGrid},function($J){this.slider.sizeGrid=$J}),$A(0,$J,"scrollSize",function(){return this._scrollSize},function($J){this._scrollSize=$J}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)||"string"==typeof $J?this.value=Number($J):$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"thumbPercent",function(){return this._thumbPercent},function($J){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$J=1<=$J?.99:$J,this._thumbPercent=$J,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$J,$m.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$J,$m.scrollBarMinNum))}),$A(0,$J,"target",function(){return this._target},function($J){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$J)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$A(0,$J,"hide",function(){return this._hide},function($J){this._hide=$J,this.visible=!$J}),$A(0,$J,"touchScrollEnable",function(){return this._touchScrollEnable},function($J){this._touchScrollEnable=$J,this.target=this._target}),$A(0,$J,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($J){this._mouseWheelEnable=$J,this.target=this._target}),$A(0,$J,"tick",function(){return this.slider.tick},function($J){this.slider.tick=$J}),$r}($k),$l=function($o){function $r($J){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$r.__super.call(this),this.skin=$J}$z($r,"laya.ui.Slider",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._bg&&this._bg.destroy($J),this._bar&&this._bar.destroy($J),this._progress&&this._progress.destroy($J),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$J.createChildren=function(){this.addChild(this._bg=new $c),this.addChild(this._bar=new $Q)},$J.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$J.onBarMouseDown=function($J){this._globalSacle||(this._globalSacle=new $_),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$D.stage.mouseX,this._ty=$D.stage.mouseY,$D.stage.on("mousemove",this,this.mouseMove),$D.stage.once("mouseup",this,this.mouseUp),$D.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$J.showValueText=function(){if(this.showLabel){var $J=laya.ui.Slider.label;this.addChild($J),$J.textField.changeText(this._value+""),this.isVertical?($J.x=this._bar.x+20,$J.y=.5*(this._bar.height-$J.height)+this._bar.y):($J.y=this._bar.y-20,$J.x=.5*(this._bar.width-$J.width)+this._bar.x)}},$J.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$J.mouseUp=function($J){$D.stage.off("mousemove",this,this.mouseMove),$D.stage.off("mouseup",this,this.mouseUp),$D.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$J.mouseMove=function($J){var $o=this._value;this.isVertical?(this._bar.y+=($D.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($D.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$D.stage.mouseX,this._ty=$D.stage.mouseY;var $r=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$r)/$r,this._value!=$o&&this.sendChangeEvent(),this.showValueText()},$J.sendChangeEvent=function($J){void 0===$J&&($J="change"),this.event($J),this.changeHandler&&this.changeHandler.runWith(this._value)},$J.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$J.changeSize=function(){$o.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$J.setSlider=function($J,$o,$r){this._value=-1,this._min=$J,this._max=$J<$o?$o:$J,this.value=$r<$J?$J:$o<$r?$o:$r},$J.changeValue=function(){var $J=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$J)/$J,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $o=this._max-this._min;0===$o&&($o=1),this.isVertical?(this._bar.y=(this._value-this._min)/$o*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$o*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$J.onBgMouseDown=function($J){var $o=this._bg.getMousePoint();this.isVertical?this.value=$o.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$o.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$A(0,$J,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$A(0,$J,"skin",function(){return this._skin},function($J){if(this._skin!=$J){this._skin=$J,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $o=this._skin.replace(".png","$progress.png");$i.getRes($o)&&(this._progress||(this.addChild(this._progress=new $c),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$o),this.setBarPoint(),this.callLater(this.changeValue)}}),$A(0,$J,"allowClickBack",function(){return this._allowClickBack},function($J){this._allowClickBack!=$J&&((this._allowClickBack=$J)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$A(0,$J,"max",function(){return this._max},function($J){this._max!=$J&&(this._max=$J,this.callLater(this.changeValue))}),$A(0,$J,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$A(0,$J,"tick",function(){return this._tick},function($J){this._tick!=$J&&(this._tick=$J,this.callLater(this.changeValue))}),$A(0,$J,"sizeGrid",function(){return this._bg.sizeGrid},function($J){this._bg.sizeGrid=$J,this._bar.sizeGrid=$J,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$A(0,$J,"min",function(){return this._min},function($J){this._min!=$J&&(this._min=$J,this.callLater(this.changeValue))}),$A(0,$J,"value",function(){return this._value},function($J){if(this._value!=$J){var $o=this._value;this._value=$J,this.changeValue(),this._value!=$o&&this.sendChangeEvent()}}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)||"string"==typeof $J?this.value=Number($J):$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"bar",function(){return this._bar}),$S($r,["label",function(){return this.label=new $T}]),$r}($k),$c=function($o){function $r($J){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$r.__super.call(this),this.skin=$J}$z($r,"laya.ui.Image",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$i.clearCache(this,this._skin)},$J.dispose=function(){this.destroy(!0),$i.clearCache(this,this._skin),this.clearEvent()},$J.createChildren=function(){this.graphics=this._bitmap=new $n},$J.setSource=function($J,$o){this.destroyed||$J===this._skin&&$o&&(this.source=$o,this.onCompResize(),this.clearEvent())},$J.clearEvent=function(){this._skin&&$G.atalsNotify&&$G.atalsNotify.off(this._skin,this,this.setSource)},$J.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$D.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$A(0,$J,"source",function(){return this._bitmap.source},function($J){this._bitmap&&(this._bitmap.source=$J,this.event("loaded"),this.repaint())}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"string"==typeof(this._dataSource=$J)?this.skin=$J:$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"measureHeight",function(){return this._bitmap.height}),$A(0,$J,"skin",function(){return this._skin},function($J){if(this._skin!=$J)if($i.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$J){$i.keepCache(this,this._skin);var $o=$i.getRes($J),$r=$G.resAtalsObj&&$G.resAtalsObj[this._skin];$o?(this.source=$o,this.onCompResize()):$r?($G.atalsNotify&&$G.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$r.sourceW),0==this.height&&(this.height=$r.sourceH)):(this._complete=$j.create(this,this.setSource,[this._skin]),this._progress=null,$D.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$A(0,$J,"group",function(){return this._group},function($J){$J&&this._skin&&$i.setGroup(this._skin,$J),this._group=$J}),$A(0,$J,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($J){this._bitmap.sizeGrid=$C.fillArray($m.defaultSizeGrid,$J,Number)}),$A(0,$J,"measureWidth",function(){return this._bitmap.width}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($k,this,"width",$J),this._bitmap.width=0==$J?1e-7:$J}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($k,this,"height",$J),this._bitmap.height=0==$J?1e-7:$J}),$r}($k),$T=function($o){function $r($J){this._tf=null,$r.__super.call(this),void 0===$J&&($J=""),$B.defaultColor=$m.labelColor,this.text=$J}$z($r,"laya.ui.Label",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._tf=null},$J.createChildren=function(){this.addChild(this._tf=new $K)},$J.changeText=function($J){this._tf.changeText($J)},$A(0,$J,"padding",function(){return this._tf.padding.join(",")},function($J){this._tf.padding=$C.fillArray($m.labelPadding,$J,Number)}),$A(0,$J,"bold",function(){return this._tf.bold},function($J){this._tf.bold=$J}),$A(0,$J,"align",function(){return this._tf.align},function($J){this._tf.align=$J}),$A(0,$J,"text",function(){return this._tf.text},function($J){this._tf.text!=$J&&($J&&($J=$C.adptString($J+"")),this._tf.text=$J,this.event("change"),this._width&&this._height||this.onCompResize())}),$A(0,$J,"italic",function(){return this._tf.italic},function($J){this._tf.italic=$J}),$A(0,$J,"wordWrap",function(){return this._tf.wordWrap},function($J){this._tf.wordWrap=$J}),$A(0,$J,"font",function(){return this._tf.font},function($J){this._tf.font=$J}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)||"string"==typeof $J?this.text=$J+"":$D.superSet($k,this,"dataSource",$J)}),$A(0,$J,"color",function(){return this._tf.color},function($J){this._tf.color=$J}),$A(0,$J,"valign",function(){return this._tf.valign},function($J){this._tf.valign=$J}),$A(0,$J,"leading",function(){return this._tf.leading},function($J){this._tf.leading=$J}),$A(0,$J,"fontSize",function(){return this._tf.fontSize},function($J){this._tf.fontSize=$J}),$A(0,$J,"bgColor",function(){return this._tf.bgColor},function($J){this._tf.bgColor=$J}),$A(0,$J,"borderColor",function(){return this._tf.borderColor},function($J){this._tf.borderColor=$J}),$A(0,$J,"stroke",function(){return this._tf.stroke},function($J){this._tf.stroke=$J}),$A(0,$J,"strokeColor",function(){return this._tf.strokeColor},function($J){this._tf.strokeColor=$J}),$A(0,$J,"textField",function(){return this._tf}),$A(0,$J,"measureWidth",function(){return this._tf.width}),$A(0,$J,"measureHeight",function(){return this._tf.height}),$A(0,$J,"width",function(){return this._width||this._tf.text?$D.superGet($k,this,"width"):0},function($J){$D.superSet($k,this,"width",$J),this._tf.width=$J}),$A(0,$J,"height",function(){return this._height||this._tf.text?$D.superGet($k,this,"height"):0},function($J){$D.superSet($k,this,"height",$J),this._tf.height=$J}),$A(0,$J,"overflow",function(){return this._tf.overflow},function($J){this._tf.overflow=$J}),$A(0,$J,"underline",function(){return this._tf.underline},function($J){this._tf.underline=$J}),$A(0,$J,"underlineColor",function(){return this._tf.underlineColor},function($J){this._tf.underlineColor=$J}),$r}($k),$b=function($o){function $r($J){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$r.__super.call(this),this.skin=$J}$z($r,"laya.ui.ProgressBar",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._bg&&this._bg.destroy($J),this._bar&&this._bar.destroy($J),this._bg=this._bar=null,this.changeHandler=null},$J.createChildren=function(){this.addChild(this._bg=new $c),this.addChild(this._bar=new $c)},$J.changeValue=function(){if(this.sizeGrid){var $J=this.sizeGrid.split(","),$o=Number($J[3]),$r=Number($J[1]),$S=(this.width-$o-$r)*this._value;this._bar.width=$o+$r+$S,this._bar.visible=this._bar.width>$o+$r}else this._bar.width=this.width*this._value},$A(0,$J,"measureHeight",function(){return this._bg.height}),$A(0,$J,"skin",function(){return this._skin},function($J){this._skin!=$J&&(this._skin=$J,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$A(0,$J,"measureWidth",function(){return this._bg.width}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($k,this,"height",$J),this._bg.height=this._height,this._bar.height=this._height}),$A(0,$J,"bar",function(){return this._bar}),$A(0,$J,"value",function(){return this._value},function($J){this._value!=$J&&($J=1<$J?1:$J<0?0:$J,this._value=$J,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($J))}),$A(0,$J,"bg",function(){return this._bg}),$A(0,$J,"sizeGrid",function(){return this._bg.sizeGrid},function($J){this._bg.sizeGrid=this._bar.sizeGrid=$J}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($k,this,"width",$J),this._bg.width=this._width,this.callLater(this.changeValue)}),$A(0,$J,"dataSource",$o.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)||"string"==typeof $J?this.value=Number($J):$D.superSet($k,this,"dataSource",$J)}),$r}($k),$$=(function($J){function $r(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$r.__super.call(this),this._tipBox=new $k,this._tipBox.addChild(this._tipText=new $K),this._tipText.x=this._tipText.y=5,this._tipText.color=$r.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$D.stage.on("showtip",this,this._onStageShowTip),$D.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$z($r,"laya.ui.TipManager",$k);var $o=$r.prototype;$o._onStageHideTip=function($J){$D.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$o._onStageShowTip=function($J){$D.timer.once($r.tipDelay,this,this._showTip,[$J],!0)},$o._showTip=function($J){if("string"==typeof $J){var $o=String($J);Boolean($o)&&this._defaultTipHandler($o)}else $J instanceof laya.utils.Handler?$J.run():"function"==typeof $J&&$J.apply();$D.stage.on("mousemove",this,this._onStageMouseMove),$D.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$o._onStageMouseDown=function($J){this.closeAll()},$o._onStageMouseMove=function($J){this._showToStage(this,$r.offsetX,$r.offsetY)},$o._showToStage=function($J,$o,$r){void 0===$o&&($o=0),void 0===$r&&($r=0);var $S=$J.getBounds();$J.x=$D.stage.mouseX+$o,$J.y=$D.stage.mouseY+$r,$J.x+$S.width>$D.stage.width&&($J.x-=$S.width+$o),$J.y+$S.height>$D.stage.height&&($J.y-=$S.height+$r)},$o.closeAll=function(){$D.timer.clear(this,this._showTip),$D.stage.off("mousemove",this,this._onStageMouseMove),$D.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$o.showDislayTip=function($J){this.addChild($J),this._showToStage(this),$D._currentStage.addChild(this)},$o._showDefaultTip=function($J){this._tipText.text=$J;var $o=this._tipBox.graphics;$o.clear(),$o.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$r.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$D._currentStage.addChild(this)},$A(0,$o,"defaultTipHandler",function(){return this._defaultTipHandler},function($J){this._defaultTipHandler=$J}),$r.offsetX=10,$r.offsetY=15,$r.tipTextColor="#ffffff",$r.tipBackColor="#111111",$r.tipDelay=200}(),function($J){var $Y;function $_(){this._idMap=null,this._aniList=null,this._watchMap={},$_.__super.call(this)}$z($_,"laya.ui.View",$L);var $o=$_.prototype;return $o.createView=function($J){if($J.animations&&!this._idMap&&(this._idMap={}),$_.createComp($J,this,this),$J.animations){var $o,$r,$S=[],$G=$J.animations,$z=0,$A=$G.length;for($z=0;$z<$A;$z++){switch($o=new $v,$r=$G[$z],$o._setUp(this._idMap,$r),(this[$r.name]=$o)._setControlNode(this),$r.action){case 1:$o.play(0,!1);break;case 2:$o.play(0,!0)}$S.push($o)}this._aniList=$S}0<this._width&&null==$J.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$o.onEvent=function($J,$o){},$o.loadUI=function($J){var $o=$_.uiMap[$J];$o&&this.createView($o)},$o.destroy=function($J){void 0===$J&&($J=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$J)},$o.changeData=function($J){var $o=this._watchMap[$J];if($o){console.log("change",$J);for(var $r=0,$S=$o.length;$r<$S;$r++){$o[$r].exe(this)}}},$_._regs=function(){for(var $J in $_.uiClassMap)$N.regClass($J,$_.uiClassMap[$J])},$_.createComp=function($J,$o,$r,$S){if(!($o=$o||$_.getCompInstance($J)))return console.warn("can not create:"+$J.type),null;var $G=$J.child;if($G)for(var $z=$o instanceof laya.ui.List,$A=0,$h=$G.length;$A<$h;$A++){var $Z=$G[$A];if(!$o.hasOwnProperty("itemRender")||"render"!=$Z.props.name&&"render"!==$Z.props.renderType)if("Graphic"==$Z.type)$N.addGraphicsToSprite($Z,$o);else if($N.isDrawType($Z.type))$N.addGraphicToSprite($Z,$o,!0);else{if($z){var $u=[],$B=$_.createComp($Z,null,$r,$u);$u.length&&($B._$bindData=$u)}else $B=$_.createComp($Z,null,$r,$S);"Script"==$Z.type?"owner"in $B?$B.owner=$o:"target"in $B&&($B.target=$o):"mask"==$Z.props.renderType||"mask"==$Z.props.name?$o.mask=$B:$B instanceof laya.display.Sprite&&$o.addChild($B)}else $o.itemRender=$Z}var $v=$J.props;for(var $j in $v){var $Y=$v[$j];$_.eventDic[$j]?$Y&&$r&&$o.on($j,$r,$r.onEvent,[$Y]):$_.setCompValue($o,$j,$Y,$r,$S)}return $D.__typeof($o,"laya.ui.IItem")&&$o.initItems(),$J.compId&&$r&&$r._idMap&&($r._idMap[$J.compId]=$o),$o},$_.setCompValue=function($J,$o,$r,$S,$G){if("string"==typeof $r&&-1<$r.indexOf("${")){if($_._sheet||($_._sheet=$N.getClass("laya.data.Table")),!$_._sheet)return void console.warn("Can not find class Sheet");if($G)$G.push($J,$o,$r);else if($S){-1==$r.indexOf("].")&&($r=$r.replace(".","[0]."));var $z,$A,$h=new $Y($J,$o,$r);$h.exe($S);for(var $Z=$r.replace(/\[.*?\]\./g,".");null!=($z=$_._parseWatchData.exec($Z));){for(var $u=$z[1];null!=($A=$_._parseKeyWord.exec($u));){var $B=$A[0],$v=$S._watchMap[$B]||($S._watchMap[$B]=[]);$v.push($h),$_._sheet.I.notifer.on($B,$S,$S.changeData,[$B])}($v=$S._watchMap[$u]||($S._watchMap[$u]=[])).push($h),$_._sheet.I.notifer.on($u,$S,$S.changeData,[$u])}}}else if("var"===$o&&$S)$S[$r]=$J;else if("onClick"==$o){var $j=$D._runScript("(function(){"+$r+"})");$J.on("click",$S,$j)}else $J[$o]="true"===$r||"false"!==$r&&$r},$_.getCompInstance=function($J){var $o,$r=$J.props?$J.props.runtime:null;return $o=$r?$_.viewClassMap[$r]||$_.uiClassMap[$r]||$D.__classmap[$r]:$_.uiClassMap[$J.type],$J.props&&$J.props.hasOwnProperty("renderType")&&"instance"==$J.props.renderType?$o.instance:$o?new $o:null},$_.regComponent=function($J,$o){$_.uiClassMap[$J]=$o,$N.regClass($J,$o)},$_.regViewRuntime=function($J,$o){$_.viewClassMap[$J]=$o},$_.uiMap={},$_.viewClassMap={},$_._sheet=null,$S($_,["uiClassMap",function(){return this.uiClassMap={ViewStack:$JJ,LinkButton:$Q,TextArea:$uJ,ColorPicker:$f,Box:$L,Button:$Q,CheckBox:$q,Clip:$p,ComboBox:$F,Component:$k,HScrollBar:$M,HSlider:$P,Image:$c,Label:$T,List:$x,Panel:$O,ProgressBar:$b,Radio:$E,RadioGroup:$hJ,ScrollBar:$d,Slider:$l,Tab:$ZJ,TextInput:$rJ,View:$_,VScrollBar:$oJ,VSlider:$SJ,Tree:$X,HBox:$zJ,VBox:$AJ,Sprite:$t,Animation:$r,Text:$K,FontClip:$a}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$_.__init$=function(){$_._regs(),$Y=function(){function $J($J,$o,$r){this.comp=null,this.prop=null,this.value=null,this.comp=$J,this.prop=$o,this.value=$r}return $z($J,""),$J.prototype.exe=function($J){var $o=$C.getBindFun(this.value);this.comp[this.prop]=$o.call(this,$J)},$J}()},$_}()),$q=function($J){function $r($J,$o){void 0===$o&&($o=""),$r.__super.call(this,$J,$o)}$z($r,"laya.ui.CheckBox",$J);var $o=$r.prototype;return $o.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$o.initialize=function(){$J.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$A(0,$o,"dataSource",$J.prototype._$get_dataSource,function($J){"boolean"==typeof(this._dataSource=$J)?this.selected=$J:"string"==typeof $J?this.selected="true"===$J:$D.superSet($Q,this,"dataSource",$J)}),$r}($Q),$H=function($J){function $o(){this._space=0,this._align="none",this._itemChanged=!1,$o.__super.call(this)}$z($o,"laya.ui.LayoutBox",$L);var $r=$o.prototype;return $r.addChild=function($J){return $J.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$J)},$r.onResize=function($J){this._setItemChanged()},$r.addChildAt=function($J,$o){return $J.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$J,$o)},$r.removeChild=function($J){return $J.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$J)},$r.removeChildAt=function($J){return this.getChildAt($J).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$J)},$r.refresh=function(){this._setItemChanged()},$r.changeItems=function(){this._itemChanged=!1},$r.sortItem=function($J){$J&&$J.sort(function($J,$o){return $J.y-$o.y})},$r._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$A(0,$r,"space",function(){return this._space},function($J){this._space=$J,this._setItemChanged()}),$A(0,$r,"align",function(){return this._align},function($J){this._align=$J,this._setItemChanged()}),$o}(),$a=function($o){function $r($J,$o){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$r.__super.call(this),$J&&(this.skin=$J),$o&&(this.sheet=$o)}$z($r,"laya.ui.FontClip",$o);var $J=$r.prototype;return $J.createChildren=function(){this._bitmap=new $n,this.on("loaded",this,this._onClipLoaded)},$J._onClipLoaded=function(){this.callLater(this.changeValue)},$J.changeValue=function(){var $J;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$J=this._sources[0]))){var $o="horizontal"===this._direction;$o?(this._wordsW=this._valueArr.length*($J.sourceWidth+this.spaceX),this._wordsH=$J.sourceHeight):(this._wordsW=$J.sourceWidth,this._wordsH=($J.sourceHeight+this.spaceY)*this._valueArr.length);var $r=0;if(this._width)switch(this._align){case"center":$r=.5*(this._width-this._wordsW);break;case"right":$r=this._width-this._wordsW;break;default:$r=0}for(var $S=0,$G=this._valueArr.length;$S<$G;$S++){var $z=this._indexMap[this._valueArr.charAt($S)];this.sources[$z]&&($J=this.sources[$z],$o?this.graphics.drawTexture($J,$r+$S*($J.sourceWidth+this.spaceX),0,$J.sourceWidth,$J.sourceHeight):this.graphics.drawTexture($J,0+$r,$S*($J.sourceHeight+this.spaceY),$J.sourceWidth,$J.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$J.destroy=function($J){void 0===$J&&($J=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$o.prototype.destroy.call(this,$J)},$A(0,$J,"sheet",function(){return this._sheet},function($J){$J+="";var $o=(this._sheet=$J).split(" ");this._clipX=String($o[0]).length,this.clipY=$o.length,this._indexMap={};for(var $r=0;$r<this._clipY;$r++)for(var $S=$o[$r].split(""),$G=0,$z=$S.length;$G<$z;$G++)this._indexMap[$S[$G]]=$r*this._clipX+$G}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($p,this,"height",$J),this.callLater(this.changeValue)}),$A(0,$J,"direction",function(){return this._direction},function($J){this._direction=$J,this.callLater(this.changeValue)}),$A(0,$J,"value",function(){return this._valueArr?this._valueArr:""},function($J){$J+="",this._valueArr=$J,this.callLater(this.changeValue)}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($p,this,"width",$J),this.callLater(this.changeValue)}),$A(0,$J,"spaceX",function(){return this._spaceX},function($J){this._spaceX=$J,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$A(0,$J,"spaceY",function(){return this._spaceY},function($J){this._spaceY=$J,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$A(0,$J,"align",function(){return this._align},function($J){this._align=$J,this.callLater(this.changeValue)}),$A(0,$J,"measureWidth",function(){return this._wordsW}),$A(0,$J,"measureHeight",function(){return this._wordsH}),$r}($p),$x=function($J){function $o(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $_,$o.__super.call(this)}$z($o,"laya.ui.List",$J);var $r=$o.prototype;return $D.imps($r,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$r.destroy=function($J){void 0===$J&&($J=!0),this._content&&this._content.destroy($J),this._scrollBar&&this._scrollBar.destroy($J),laya.ui.Component.prototype.destroy.call(this,$J),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$r.createChildren=function(){this.addChild(this._content=new $L)},$r.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$D.superGet($L,this,"cacheAs")),$D.superSet($L,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$r.onScrollEnd=function(){$D.superSet($L,this,"cacheAs",this._$P.cacheAs)},$r._removePreScrollBar=function(){var $J=this.removeChildByName("scrollBar");$J&&$J.destroy(!0)},$r.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $J=this._getOneCell(),$o=$J.width+this._spaceX||1,$r=$J.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$o):Math.ceil(this._width/$o)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$r):Math.round(this._height/$r));var $S=this._width?this._width:$o*this.repeatX-this._spaceX,$G=this._height?this._height:$r*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$r:$o,this._cellOffset=this._isVertical?$r*Math.max(this._repeatY2,this._repeatY)-$G-this._spaceY:$o*Math.max(this._repeatX2,this._repeatX)-$S-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$G:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$S),this.setContentSize($S,$G);var $z=this._isVertical?this.repeatX:this.repeatY,$A=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$z,$A),this._createdLine=$A,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$r._getOneCell=function(){if(0===this._cells.length){var $J=this.createItem();if(this._offset.setTo($J.x,$J.y),this.cacheContent)return $J;this._cells.push($J)}return this._cells[0]},$r._createItems=function($J,$o,$r){var $S=this._content,$G=this._getOneCell(),$z=$G.width+this._spaceX,$A=$G.height+this._spaceY;if(this.cacheContent){var $h=new $L;$h.cacheAsBitmap=!0,$h.pos((this._isVertical?0:$J)*$z,(this._isVertical?$J:0)*$A),this._content.addChild($h),this._content.optimizeScrollRect=!0,$S=$h}else{for(var $Z=[],$u=this._cells.length-1;-1<$u;$u--){var $B=this._cells[$u];$B.removeSelf(),$Z.push($B)}this._cells.length=0}for(var $v=$J;$v<$r;$v++)for(var $j=0;$j<$o;$j++)($G=$Z&&$Z.length?$Z.pop():this.createItem()).x=(this._isVertical?$j:$v)*$z-$S.x,$G.y=(this._isVertical?$v:$j)*$A-$S.y,$G.name="item"+($v*$o+$j),$S.addChild($G),this.addCell($G)},$r.createItem=function(){var $J=[];if("function"==typeof this._itemRender)var $o=new this._itemRender;else $o=$$.createComp(this._itemRender,null,null,$J);if(0==$J.length&&$o._watchMap){var $r=$o._watchMap;for(var $S in $r)for(var $G=$r[$S],$z=0;$z<$G.length;$z++){var $A=$G[$z];$J.push($A.comp,$A.prop,$A.value)}}return $J.length&&($o._$bindData=$J),$o},$r.addCell=function($J){$J.on("click",this,this.onCellMouse),$J.on("rightclick",this,this.onCellMouse),$J.on("mouseover",this,this.onCellMouse),$J.on("mouseout",this,this.onCellMouse),$J.on("mousedown",this,this.onCellMouse),$J.on("mouseup",this,this.onCellMouse),this._cells.push($J)},$r.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $J=0,$o=$J=0;$o<1e4;$o++){var $r=this.getChildByName("item"+$o);if(!$r)break;this.addCell($r),$J++}this.repeatY=$J}},$r.setContentSize=function($J,$o){this._content.width=$J,this._content.height=$o,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $w),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$J,$o),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$r.onCellMouse=function($J){"mousedown"===$J.type&&(this._isMoved=!1);var $o=$J.currentTarget,$r=this._startIndex+this._cells.indexOf($o);$r<0||("click"===$J.type||"rightclick"===$J.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$r:this.changeCellState($o,!0,0):"mouseover"!==$J.type&&"mouseout"!==$J.type||this._selectedIndex===$r||this.changeCellState($o,"mouseover"===$J.type,0),this.mouseHandler&&this.mouseHandler.runWith([$J,$r]))},$r.changeCellState=function($J,$o,$r){var $S=$J.getChildByName("selectBox");$S&&(this.selectEnable=!0,$S.visible=$o,$S.index=$r)},$r.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$r.onScrollBarChange=function($J){this.runCallLater(this.changeCells);var $o=this._scrollBar.value,$r=this._isVertical?this.repeatX:this.repeatY,$S=this._isVertical?this.repeatY:this.repeatX,$G=Math.floor($o/this._cellSize);if(this.cacheContent)$A=$S+1,this._createdLine-$G<$A&&(this._createItems(this._createdLine,$r,this._createdLine+$A),this.renderItems(this._createdLine*$r,0),this._createdLine+=$A);else{var $z=$G*$r,$A=0;if($z>this._startIndex){$A=$z-this._startIndex;var $h=!0,$Z=this._startIndex+$r*($S+1);this._isMoved=!0}else $z<this._startIndex&&($A=this._startIndex-$z,$h=!1,$Z=this._startIndex-1,this._isMoved=!0);for(var $u=0;$u<$A;$u++){if($h){var $B=this._cells.shift();this._cells[this._cells.length]=$B;var $v=$Z+$u}else $B=this._cells.pop(),this._cells.unshift($B),$v=$Z-$u;var $j=Math.floor($v/$r)*this._cellSize;this._isVertical?$B.y=$j:$B.x=$j,this.renderItem($B,$v)}this._startIndex=$z,this.changeSelectStatus()}var $Y=this._content.scrollRect;this._isVertical?($Y.y=$o-this._offset.y,$Y.x=-this._offset.x):($Y.y=-this._offset.y,$Y.x=$o-this._offset.x),this._content.scrollRect=$Y},$r.posCell=function($J,$o){if(this._scrollBar){var $r=this._isVertical?this.repeatX:this.repeatY,$S=(this._isVertical?this.repeatY:this.repeatX,Math.floor($o/$r)*this._cellSize);this._isVertical?$J.y=$S:$J.x=$S}},$r.changeSelectStatus=function(){for(var $J=0,$o=this._cells.length;$J<$o;$J++)this.changeCellState(this._cells[$J],this._selectedIndex===this._startIndex+$J,1)},$r.renderItems=function($J,$o){void 0===$J&&($J=0),void 0===$o&&($o=0);for(var $r=$J,$S=$o||this._cells.length;$r<$S;$r++)this.renderItem(this._cells[$r],this._startIndex+$r);this.changeSelectStatus(),this._twDone=!0},$r.renderItem=function($J,$o){this._array&&0<=$o&&$o<this._array.length?($J.visible=!0,$J._$bindData?($J._dataSource=this._array[$o],this._bindData($J,this._array[$o])):$J.dataSource=this._array[$o],this.cacheContent||this.posCell($J,$o),this.hasListener("render")&&this.event("render",[$J,$o]),this.renderHandler&&this.renderHandler.runWith([$J,$o]),this.renderTwHandler&&this.renderTwHandler.runWith([$J,$o])):($J.visible=!1,$J.dataSource=null)},$r._bindData=function($J,$o){for(var $r=$J._$bindData,$S=0,$G=$r.length;$S<$G;$S++){var $z=$r[$S++],$A=$r[$S++],$h=$r[$S],$Z=$C.getBindFun($h);$z[$A]=$Z.call(this,$o)}},$r.refresh=function(){this.array=this._array},$r.getItem=function($J){return-1<$J&&$J<this._array.length?this._array[$J]:null},$r.changeItem=function($J,$o){-1<$J&&$J<this._array.length&&(this._array[$J]=$o,$J>=this._startIndex&&$J<this._startIndex+this._cells.length&&this.renderItem(this.getCell($J),$J))},$r.setItem=function($J,$o){this.changeItem($J,$o)},$r.addItem=function($J){this._array.push($J),this.array=this._array},$r.addItemAt=function($J,$o){this._array.splice($o,0,$J),this.array=this._array},$r.deleteItem=function($J){this._array.splice($J,1),this.array=this._array},$r.getCell=function($J){return this.runCallLater(this.changeCells),-1<$J&&this._cells?this._cells[($J-this._startIndex)%this._cells.length]:null},$r.scrollTo=function($J){if(this._scrollBar){var $o=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($J/$o)*this._cellSize}else this.startIndex=$J},$r.tweenTo=function($J,$o,$r){if(void 0===$o&&($o=200),this._scrollBar){var $S=this._isVertical?this.repeatX:this.repeatY;$y.to(this._scrollBar,{value:Math.floor($J/$S)*this._cellSize},$o,null,$r,0,!0)}else this.startIndex=$J,$r&&$r.run()},$r._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$r.commitMeasure=function(){this.runCallLater(this.changeCells)},$A(0,$r,"cacheAs",$J.prototype._$get_cacheAs,function($J){$D.superSet($L,this,"cacheAs",$J),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$J?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$A(0,$r,"content",function(){return this._content}),$A(0,$r,"height",$J.prototype._$get_height,function($J){$J!=this._height&&($D.superSet($L,this,"height",$J),this._setCellChanged())}),$A(0,$r,"itemRender",function(){return this._itemRender},function($J){if(this._itemRender!=$J){this._itemRender=$J;for(var $o=this._cells.length-1;-1<$o;$o--)this._cells[$o].destroy();this._cells.length=0,this._setCellChanged()}}),$A(0,$r,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($J){this._removePreScrollBar();var $o=new $oJ;$o.name="scrollBar",$o.right=0,$J&&" "!=$J&&($o.skin=$J),this.scrollBar=$o,this.addChild($o),this._setCellChanged()}),$A(0,$r,"page",function(){return this._page},function($J){this._page=$J,this._array&&(this._page=0<$J?$J:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$A(0,$r,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($J){this._removePreScrollBar();var $o=new $M;$o.name="scrollBar",$o.bottom=0,$J&&" "!=$J&&($o.skin=$J),this.scrollBar=$o,this.addChild($o),this._setCellChanged()}),$A(0,$r,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($J){this._repeatX=$J,this._setCellChanged()}),$A(0,$r,"scrollBar",function(){return this._scrollBar},function($J){this._scrollBar!=$J&&(this._scrollBar=$J)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$A(0,$r,"width",$J.prototype._$get_width,function($J){$J!=this._width&&($D.superSet($L,this,"width",$J),this._setCellChanged())}),$A(0,$r,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($J){this._repeatY=$J,this._setCellChanged()}),$A(0,$r,"spaceX",function(){return this._spaceX},function($J){this._spaceX=$J,this._setCellChanged()}),$A(0,$r,"spaceY",function(){return this._spaceY},function($J){this._spaceY=$J,this._setCellChanged()}),$A(0,$r,"selectedIndex",function(){return this._selectedIndex},function($J){this._selectedIndex!=$J&&(this._selectedIndex=$J,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($J),this.startIndex=this._startIndex)}),$A(0,$r,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($J){this.selectedIndex=this._array.indexOf($J)}),$A(0,$r,"length",function(){return this._array?this._array.length:0}),$A(0,$r,"selection",function(){return this.getCell(this._selectedIndex)},function($J){this.selectedIndex=this._startIndex+this._cells.indexOf($J)}),$A(0,$r,"startIndex",function(){return this._startIndex},function($J){this._startIndex=0<$J?$J:0,this.callLater(this.renderItems)}),$A(0,$r,"twSwitch",function(){return this._twSwitch},function($J){this._twSwitch=$J}),$A(0,$r,"twDone",function(){return this._twDone},function($J){this._twDone=$J}),$A(0,$r,"array",function(){return this._array},function($J){this.runCallLater(this.changeCells),this._array=$J||[];var $o=this._array.length;if(this.totalPage=Math.ceil($o/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$o?this._selectedIndex:$o-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $r=this._isVertical?this.repeatX:this.repeatY,$S=this._isVertical?this.repeatY:this.repeatX,$G=Math.ceil($o/$r);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$S/$G,this._scrollBar.setScroll(0,($G-$S)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$A(0,$r,"dataSource",$J.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)&&Math.floor($J)==$J||"string"==typeof $J?this.selectedIndex=parseInt($J):$J instanceof Array?this.array=$J:$D.superSet($L,this,"dataSource",$J)}),$A(0,$r,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$o}($L),$M=function($J){function $o(){$o.__super.call(this)}return $z($o,"laya.ui.HScrollBar",$J),$o.prototype.initialize=function(){$J.prototype.initialize.call(this),this.slider.isVertical=!1},$o}($d),$O=function($J){function $o(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$o.__super.call(this),this.width=this.height=100}$z($o,"laya.ui.Panel",$J);var $r=$o.prototype;return $r.destroy=function($J){void 0===$J&&($J=!0),laya.ui.Component.prototype.destroy.call(this,$J),this._content&&this._content.destroy($J),this._vScrollBar&&this._vScrollBar.destroy($J),this._hScrollBar&&this._hScrollBar.destroy($J),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$r.destroyChildren=function(){this._content.destroyChildren()},$r.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $L)},$r.addChild=function($J){return $J.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($J)},$r.onResize=function(){this._setScrollChanged()},$r.addChildAt=function($J,$o){return $J.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($J,$o)},$r.removeChild=function($J){return $J.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($J)},$r.removeChildAt=function($J){return this.getChildAt($J).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($J)},$r.removeChildren=function($J,$o){return void 0===$J&&($J=0),void 0===$o&&($o=2147483647),this._content.removeChildren($J,$o),this._setScrollChanged(),this},$r.getChildAt=function($J){return this._content.getChildAt($J)},$r.getChildByName=function($J){return this._content.getChildByName($J)},$r.getChildIndex=function($J){return this._content.getChildIndex($J)},$r.changeScroll=function(){this._scrollChanged=!1;var $J=this.contentWidth||1,$o=this.contentHeight||1,$r=this._vScrollBar,$S=this._hScrollBar,$G=$r&&$o>this._height,$z=$S&&$J>this._width,$A=$G?this._width-$r.width:this._width,$h=$z?this._height-$S.height:this._height;$r&&($r.x=this._width-$r.width,$r.y=0,$r.height=this._height-($z?$S.height:0),$r.scrollSize=Math.max(.033*this._height,1),$r.thumbPercent=$h/$o,$r.setScroll(0,$o-$h,$r.value)),$S&&($S.x=0,$S.y=this._height-$S.height,$S.width=this._width-($G?$r.width:0),$S.scrollSize=Math.max(.033*this._width,1),$S.thumbPercent=$A/$J,$S.setScroll(0,$J-$A,$S.value))},$r.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$r.setContentSize=function($J,$o){var $r=this._content;$r.width=$J,$r.height=$o,$r.scrollRect||($r.scrollRect=new $w),$r.scrollRect.setTo(0,0,$J,$o),$r.scrollRect=$r.scrollRect},$r.onScrollBarChange=function($J){var $o=this._content.scrollRect;if($o){var $r=Math.round($J.value);$J.isVertical?$o.y=$r:$o.x=$r,this._content.scrollRect=$o}},$r.scrollTo=function($J,$o){void 0===$J&&($J=0),void 0===$o&&($o=0),this.vScrollBar&&(this.vScrollBar.value=$o),this.hScrollBar&&(this.hScrollBar.value=$J)},$r.refresh=function(){this.changeScroll()},$r.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$D.superGet($L,this,"cacheAs")),$D.superSet($L,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$r.onScrollEnd=function(){$D.superSet($L,this,"cacheAs",this._$P.cacheAs)},$r._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$A(0,$r,"numChildren",function(){return this._content.numChildren}),$A(0,$r,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($J){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $M),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$J}),$A(0,$r,"contentWidth",function(){for(var $J=0,$o=this._content.numChildren-1;-1<$o;$o--){var $r=this._content.getChildAt($o);$J=Math.max($r.x+$r.width*$r.scaleX,$J)}return $J}),$A(0,$r,"contentHeight",function(){for(var $J=0,$o=this._content.numChildren-1;-1<$o;$o--){var $r=this._content.getChildAt($o);$J=Math.max($r.y+$r.height*$r.scaleY,$J)}return $J}),$A(0,$r,"width",$J.prototype._$get_width,function($J){$D.superSet($L,this,"width",$J),this._setScrollChanged()}),$A(0,$r,"hScrollBar",function(){return this._hScrollBar}),$A(0,$r,"content",function(){return this._content}),$A(0,$r,"height",$J.prototype._$get_height,function($J){$D.superSet($L,this,"height",$J),this._setScrollChanged()}),$A(0,$r,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($J){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $oJ),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$J}),$A(0,$r,"vScrollBar",function(){return this._vScrollBar}),$A(0,$r,"cacheAs",$J.prototype._$get_cacheAs,function($J){$D.superSet($L,this,"cacheAs",$J),this._$P.cacheAs=null,"none"!==$J?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$o}($L),$P=function($J){function $o($J){$o.__super.call(this,$J),this.isVertical=!1}return $z($o,"laya.ui.HSlider",$l),$o}(),$W=function($J){function $r($J,$o){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$r.__super.call(this),this.skin=$o,this.labels=$J}$z($r,"laya.ui.UIGroup",$J);var $o=$r.prototype;return $D.imps($o,{"laya.ui.IItem":!0}),$o.preinitialize=function(){this.mouseEnabled=!0},$o.destroy=function($J){void 0===$J&&($J=!0),laya.ui.Component.prototype.destroy.call(this,$J),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$o.addItem=function($J,$o){void 0===$o&&($o=!0);var $r=$J,$S=this._items.length;if($r.name="item"+$S,this.addChild($r),this.initItems(),$o&&0<$S){var $G=this._items[$S-1];"horizontal"==this._direction?$r.x=$G.x+$G.width+this._space:$r.y=$G.y+$G.height+this._space}else $o&&($r.x=0,$r.y=0);return $S},$o.delItem=function($J,$o){void 0===$o&&($o=!0);var $r=this._items.indexOf($J);if(-1!=$r){var $S=$J;this.removeChild($S);for(var $G=$r+1,$z=this._items.length;$G<$z;$G++){var $A=this._items[$G];$A.name="item"+($G-1),$o&&("horizontal"==this._direction?$A.x-=$S.width+this._space:$A.y-=$S.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $h;$h=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$h}}},$o.initItems=function(){this._items||(this._items=[]);for(var $J=this._items.length=0;$J<1e4;$J++){var $o=this.getChildByName("item"+$J);if(null==$o)break;this._items.push($o),$o.selected=$J===this._selectedIndex,$o.clickHandler=$j.create(this,this.itemClick,[$J],!1)}},$o.itemClick=function($J){this.selectedIndex=$J},$o.setSelect=function($J,$o){this._items&&-1<$J&&$J<this._items.length&&(this._items[$J].selected=$o)},$o.createItem=function($J,$o){return null},$o.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $J=0,$o=0,$r=this._items.length;$o<$r;$o++){var $S=this._items[$o];this._skin&&($S.skin=this._skin),this._labelColors&&($S.labelColors=this._labelColors),this._labelSize&&($S.labelSize=this._labelSize),this._labelStroke&&($S.labelStroke=this._labelStroke),this._labelStrokeColor&&($S.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($S.strokeColors=this._strokeColors),this._labelBold&&($S.labelBold=this._labelBold),this._labelPadding&&($S.labelPadding=this._labelPadding),this._labelAlign&&($S.labelAlign=this._labelAlign),this._stateNum&&($S.stateNum=this._stateNum),this._labelFont&&($S.labelFont=this._labelFont),"horizontal"===this._direction?($S.y=0,$S.x=$J,$J+=$S.width+this._space):($S.x=0,$S.y=$J,$J+=$S.height+this._space)}this.changeSize()},$o.commitMeasure=function(){this.runCallLater(this.changeLabels)},$o._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$A(0,$o,"labelStrokeColor",function(){return this._labelStrokeColor},function($J){this._labelStrokeColor!=$J&&(this._labelStrokeColor=$J,this._setLabelChanged())}),$A(0,$o,"skin",function(){return this._skin},function($J){this._skin!=$J&&(this._skin=$J,this._setLabelChanged())}),$A(0,$o,"selectedIndex",function(){return this._selectedIndex},function($J){this._selectedIndex!=$J&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$J,this.setSelect($J,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$A(0,$o,"labels",function(){return this._labels},function($J){if(this._labels!=$J){if(this._labels=$J,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $o=this._labels.split(","),$r=0,$S=$o.length;$r<$S;$r++){var $G=this.createItem(this._skin,$o[$r]);$G.name="item"+$r,this.addChild($G)}this.initItems()}}),$A(0,$o,"strokeColors",function(){return this._strokeColors},function($J){this._strokeColors!=$J&&(this._strokeColors=$J,this._setLabelChanged())}),$A(0,$o,"labelColors",function(){return this._labelColors},function($J){this._labelColors!=$J&&(this._labelColors=$J,this._setLabelChanged())}),$A(0,$o,"labelStroke",function(){return this._labelStroke},function($J){this._labelStroke!=$J&&(this._labelStroke=$J,this._setLabelChanged())}),$A(0,$o,"labelSize",function(){return this._labelSize},function($J){this._labelSize!=$J&&(this._labelSize=$J,this._setLabelChanged())}),$A(0,$o,"stateNum",function(){return this._stateNum},function($J){this._stateNum!=$J&&(this._stateNum=$J,this._setLabelChanged())}),$A(0,$o,"labelBold",function(){return this._labelBold},function($J){this._labelBold!=$J&&(this._labelBold=$J,this._setLabelChanged())}),$A(0,$o,"labelFont",function(){return this._labelFont},function($J){this._labelFont!=$J&&(this._labelFont=$J,this._setLabelChanged())}),$A(0,$o,"labelPadding",function(){return this._labelPadding},function($J){this._labelPadding!=$J&&(this._labelPadding=$J,this._setLabelChanged())}),$A(0,$o,"direction",function(){return this._direction},function($J){this._direction=$J,this._setLabelChanged()}),$A(0,$o,"space",function(){return this._space},function($J){this._space=$J,this._setLabelChanged()}),$A(0,$o,"items",function(){return this._items}),$A(0,$o,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($J){this.selectedIndex=this._items.indexOf($J)}),$A(0,$o,"dataSource",$J.prototype._$get_dataSource,function($J){"number"==typeof(this._dataSource=$J)&&Math.floor($J)==$J||"string"==typeof $J?this.selectedIndex=parseInt($J):$J instanceof Array?this.labels=$J.join(","):$D.superSet($L,this,"dataSource",$J)}),$r}($L),$E=function($o){function $r($J,$o){this._value=null,void 0===$o&&($o=""),$r.__super.call(this,$J,$o)}$z($r,"laya.ui.Radio",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._value=null},$J.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$J.initialize=function(){$o.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$J.onClick=function($J){this.selected=!0},$A(0,$J,"value",function(){return null!=this._value?this._value:this.label},function($J){this._value=$J}),$r}($Q),$X=function($J){function $o(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$o.__super.call(this),this.width=this.height=200}$z($o,"laya.ui.Tree",$J);var $r=$o.prototype;return $D.imps($r,{"laya.ui.IRender":!0}),$r.destroy=function($J){void 0===$J&&($J=!0),laya.ui.Component.prototype.destroy.call(this,$J),this._list&&this._list.destroy($J),this._list=null,this._source=null,this._renderHandler=null},$r.createChildren=function(){this.addChild(this._list=new $x),this._list.renderHandler=$j.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$r.onListChange=function($J){this.event("change")},$r.getArray=function(){var $J,$o=[];for(var $r in this._source)$J=this._source[$r],this.getParentOpenStatus($J)&&($J.x=this._spaceLeft*this.getDepth($J),$o.push($J));return $o},$r.getDepth=function($J,$o){return void 0===$o&&($o=0),null==$J.nodeParent?$o:this.getDepth($J.nodeParent,$o+1)},$r.getParentOpenStatus=function($J){var $o=$J.nodeParent;return null==$o||!!$o.isOpen&&(null==$o.nodeParent||this.getParentOpenStatus($o))},$r.renderItem=function($J,$o){var $r=$J.dataSource;if($r){$J.left=$r.x;var $S=$J.getChildByName("arrow");$S&&($r.hasChild?($S.visible=!0,$S.index=$r.isOpen?1:0,$S.tag=$o,$S.off("click",this,this.onArrowClick),$S.on("click",this,this.onArrowClick)):$S.visible=!1);var $G=$J.getChildByName("folder");$G&&(2==$G.clipY?$G.index=$r.isDirectory?0:1:$G.index=$r.isDirectory?$r.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$J,$o])}},$r.onArrowClick=function($J){var $o=$J.currentTarget.tag;this._list.array[$o].isOpen=!this._list.array[$o].isOpen,this.event("open"),this._list.array=this.getArray()},$r.setItemState=function($J,$o){this._list.array[$J]&&(this._list.array[$J].isOpen=$o,this._list.array=this.getArray())},$r.fresh=function(){this._list.array=this.getArray(),this.repaint()},$r.parseXml=function($J,$o,$r,$S){var $G,$z=$J.childNodes,$A=$z.length;if(!$S){$G={};var $h,$Z=$J.attributes;for(var $u in $Z){var $B=($h=$Z[$u]).nodeName,$v=$h.nodeValue;$G[$B]="true"==$v||"false"!=$v&&$v}$G.nodeParent=$r,0<$A&&($G.isDirectory=!0),$G.hasChild=0<$A,$o.push($G)}for(var $j=0;$j<$A;$j++){var $Y=$z[$j];this.parseXml($Y,$o,$G,!1)}},$r.parseOpenStatus=function($J,$o){for(var $r=0,$S=$o.length;$r<$S;$r++){var $G=$o[$r];if($G.isDirectory)for(var $z=0,$A=$J.length;$z<$A;$z++){var $h=$J[$z];if($h.isDirectory&&this.isSameParent($h,$G)&&$G.label==$h.label){$G.isOpen=$h.isOpen;break}}}},$r.isSameParent=function($J,$o){return null==$J.nodeParent&&null==$o.nodeParent||null!=$J.nodeParent&&null!=$o.nodeParent&&($J.nodeParent.label==$o.nodeParent.label&&this.isSameParent($J.nodeParent,$o.nodeParent))},$r.filter=function($J){if(Boolean($J)){var $o=[];this.getFilterSource(this._source,$o,$J),this._list.array=$o}else this._list.array=this.getArray()},$r.getFilterSource=function($J,$o,$r){var $S;for(var $G in $r=$r.toLocaleLowerCase(),$J)!($S=$J[$G]).isDirectory&&-1<String($S.label).toLowerCase().indexOf($r)&&($S.x=0,$o.push($S)),$S.child&&0<$S.child.length&&this.getFilterSource($S.child,$o,$r)},$A(0,$r,"spaceBottom",function(){return this._list.spaceY},function($J){this._list.spaceY=$J}),$A(0,$r,"keepStatus",function(){return this._keepStatus},function($J){this._keepStatus=$J}),$A(0,$r,"itemRender",function(){return this._list.itemRender},function($J){this._list.itemRender=$J}),$A(0,$r,"array",function(){return this._list.array},function($J){this._keepStatus&&this._list.array&&$J&&this.parseOpenStatus(this._list.array,$J),this._source=$J,this._list.array=this.getArray()}),$A(0,$r,"mouseHandler",function(){return this._list.mouseHandler},function($J){this._list.mouseHandler=$J}),$A(0,$r,"dataSource",$J.prototype._$get_dataSource,function($J){this._dataSource=$J,$D.superSet($L,this,"dataSource",$J)}),$A(0,$r,"source",function(){return this._source}),$A(0,$r,"scrollBar",function(){return this._list.scrollBar}),$A(0,$r,"list",function(){return this._list}),$A(0,$r,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($J){this._list.vScrollBarSkin=$J}),$A(0,$r,"renderHandler",function(){return this._renderHandler},function($J){this._renderHandler=$J}),$A(0,$r,"selectedIndex",function(){return this._list.selectedIndex},function($J){this._list.selectedIndex=$J}),$A(0,$r,"spaceLeft",function(){return this._spaceLeft},function($J){this._spaceLeft=$J}),$A(0,$r,"selectedItem",function(){return this._list.selectedItem},function($J){this._list.selectedItem=$J}),$A(0,$r,"width",$J.prototype._$get_width,function($J){$D.superSet($L,this,"width",$J),this._list.width=$J}),$A(0,$r,"height",$J.prototype._$get_height,function($J){$D.superSet($L,this,"height",$J),this._list.height=$J}),$A(0,$r,"xml",null,function($J){var $o=[];this.parseXml($J.childNodes[0],$o,null,!0),this.array=$o}),$A(0,$r,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$o}($L),$JJ=function($J){function $o(){this._items=null,this._selectedIndex=0,$o.__super.call(this),this._setIndexHandler=$j.create(this,this.setIndex,null,!1)}$z($o,"laya.ui.ViewStack",$J);var $r=$o.prototype;return $D.imps($r,{"laya.ui.IItem":!0}),$r.setItems=function($J){this.removeChildren();for(var $o=0,$r=0,$S=$J.length;$r<$S;$r++){var $G=$J[$r];$G&&($G.name="item"+$o,this.addChild($G),$o++)}this.initItems()},$r.addItem=function($J){$J.name="item"+this._items.length,this.addChild($J),this.initItems()},$r.initItems=function(){this._items=[];for(var $J=0;$J<1e4;$J++){var $o=this.getChildByName("item"+$J);if(null==$o)break;this._items.push($o),$o.visible=$J==this._selectedIndex}},$r.setSelect=function($J,$o){this._items&&-1<$J&&$J<this._items.length&&(this._items[$J].visible=$o)},$r.setIndex=function($J){this.selectedIndex=$J},$A(0,$r,"dataSource",$J.prototype._$get_dataSource,function($J){if("number"==typeof(this._dataSource=$J)&&Math.floor($J)==$J||"string"==typeof $J)this.selectedIndex=parseInt($J);else for(var $o in this._dataSource)this.hasOwnProperty($o)&&(this[$o]=this._dataSource[$o])}),$A(0,$r,"selectedIndex",function(){return this._selectedIndex},function($J){this._selectedIndex!=$J&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$J,this.setSelect(this._selectedIndex,!0))}),$A(0,$r,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($J){this.selectedIndex=this._items.indexOf($J)}),$A(0,$r,"items",function(){return this._items}),$A(0,$r,"setIndexHandler",function(){return this._setIndexHandler},function($J){this._setIndexHandler=$J}),$o}($L),$oJ=function($J){function $o(){$o.__super.call(this)}return $z($o,"laya.ui.VScrollBar",$d),$o}(),$rJ=function($o){function $r($J){this._bg=null,this._skin=null,$r.__super.call(this),void 0===$J&&($J=""),this.text=$J,this.skin=this.skin}$z($r,"laya.ui.TextInput",$o);var $J=$r.prototype;return $J.preinitialize=function(){this.mouseEnabled=!0},$J.destroy=function($J){$i.clearCache(this,this._skin),void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._bg&&this._bg.destroy(),this._bg=null},$J.createChildren=function(){this.addChild(this._tf=new $Y),this._tf.padding=$m.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$J._onFocus=function(){this.event("focus",this)},$J._onBlur=function(){this.event("blur",this)},$J._onInput=function(){this.event("input",this)},$J._onEnter=function(){this.event("enter",this)},$J.initialize=function(){this.width=128,this.height=22},$J.select=function(){this._tf.select()},$J.setSelection=function($J,$o){this._tf.setSelection($J,$o)},$A(0,$J,"text",$o.prototype._$get_text,function($J){this._tf.text!=$J&&($J+="",this._tf.text=$J,this.event("change"))}),$A(0,$J,"bg",function(){return this._bg},function($J){this.graphics=this._bg=$J}),$A(0,$J,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($J){this._tf.inputElementYAdjuster=$J}),$A(0,$J,"multiline",function(){return this._tf.multiline},function($J){this._tf.multiline=$J}),$A(0,$J,"skin",function(){return this._skin},function($J){this._skin!=$J&&($i.clearCache(this,this._skin),this._skin=$J,this._bg||(this.graphics=this._bg=new $n),$i.keepCache(this,this._skin),this._bg.source=$i.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$A(0,$J,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($J){this._bg||(this.graphics=this._bg=new $n),this._bg.sizeGrid=$C.fillArray($m.defaultSizeGrid,$J,Number)}),$A(0,$J,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($J){this._tf.inputElementXAdjuster=$J}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($T,this,"width",$J),this._bg&&(this._bg.width=$J)}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($T,this,"height",$J),this._bg&&(this._bg.height=$J)}),$A(0,$J,"editable",function(){return this._tf.editable},function($J){this._tf.editable=$J}),$A(0,$J,"restrict",function(){return this._tf.restrict},function($J){this._tf.restrict=$J}),$A(0,$J,"prompt",function(){return this._tf.prompt},function($J){this._tf.prompt=$J}),$A(0,$J,"promptColor",function(){return this._tf.promptColor},function($J){this._tf.promptColor=$J}),$A(0,$J,"maxChars",function(){return this._tf.maxChars},function($J){this._tf.maxChars=$J}),$A(0,$J,"focus",function(){return this._tf.focus},function($J){this._tf.focus=$J}),$A(0,$J,"type",function(){return this._tf.type},function($J){this._tf.type=$J}),$A(0,$J,"asPassword",function(){return this._tf.asPassword},function($J){this._tf.asPassword=$J}),$r}($T),$SJ=function($J){function $o(){$o.__super.call(this)}return $z($o,"laya.ui.VSlider",$l),$o}(),$GJ=function($J){function $S(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$S.__super.call(this)}$z($S,"laya.ui.Dialog",$J);var $o=$S.prototype;return $o.initialize=function(){this.popupEffect=$S.manager.popupEffectHandler,this.closeEffect=$S.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$o._dealDragArea=function(){var $J=this.getChildByName("drag");$J&&(this.dragArea=$J.x+","+$J.y+","+$J.width+","+$J.height,$J.removeSelf())},$o._onClick=function($J){var $o=$J.target;if($o)switch($o.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($o.name)}},$o.show=function($J,$o){void 0===$J&&($J=!1),void 0===$o&&($o=!0),this._open(!1,$J,$o)},$o.popup=function($J,$o){void 0===$J&&($J=!1),void 0===$o&&($o=!0),this._open(!0,$J,$o)},$o._open=function($J,$o,$r){$S.manager.lock(!1),this.isModal=$J,$S.manager.open(this,$o,$r)},$o.onOpened=function(){},$o.close=function($J,$o){void 0===$o&&($o=!0),$S.manager.close(this,$J,$o)},$o.onClosed=function($J){},$o._onMouseDown=function($J){var $o=this.getMousePoint();this._dragArea.contains($o.x,$o.y)?this.startDrag():this.stopDrag()},$A(0,$o,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($J){if($J){var $o=$C.fillArray([0,0,0,0],$J,Number);this._dragArea=new $w($o[0],$o[1],$o[2],$o[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$A(0,$o,"isPopup",function(){return null!=this.parent}),$A(0,$o,"zOrder",$J.prototype._$get_zOrder,function($J){$D.superSet($$,this,"zOrder",$J),$S.manager._checkMask()}),$A(1,$S,"manager",function(){return $S._manager=$S._manager||new $U},function($J){$S._manager=$J}),$S.setLockView=function($J){$S.manager.setLockView($J)},$S.lock=function($J){$S.manager.lock($J)},$S.closeAll=function(){$S.manager.closeAll()},$S.getDialogsByGroup=function($J){return $S.manager.getDialogsByGroup($J)},$S.closeByGroup=function($J){return $S.manager.closeByGroup($J)},$S.CLOSE="close",$S.CANCEL="cancel",$S.SURE="sure",$S.NO="no",$S.OK="ok",$S.YES="yes",$S._manager=null,$S}($$),$zJ=function($J){function $o(){$o.__super.call(this)}$z($o,"laya.ui.HBox",$J);var $r=$o.prototype;return $r.sortItem=function($J){$J&&$J.sort(function($J,$o){return $J.x-$o.x})},$r.changeItems=function(){this._itemChanged=!1;for(var $J=[],$o=0,$r=0,$S=this.numChildren;$r<$S;$r++){var $G=this.getChildAt($r);$G&&$G.layoutEnabled&&($J.push($G),$o=this._height?this._height:Math.max($o,$G.height*$G.scaleY))}this.sortItem($J);var $z=0;for($r=0,$S=$J.length;$r<$S;$r++)($G=$J[$r]).x=$z,$z+=$G.width*$G.scaleX+this._space,"top"==this._align?$G.y=0:"middle"==this._align?$G.y=.5*($o-$G.height*$G.scaleY):"bottom"==this._align&&($G.y=$o-$G.height*$G.scaleY);this.changeSize()},$A(0,$r,"height",$J.prototype._$get_height,function($J){this._height!=$J&&($D.superSet($H,this,"height",$J),this.callLater(this.changeItems))}),$o.NONE="none",$o.TOP="top",$o.MIDDLE="middle",$o.BOTTOM="bottom",$o}($H),$AJ=function($J){function $o(){$o.__super.call(this)}$z($o,"laya.ui.VBox",$J);var $r=$o.prototype;return $r.changeItems=function(){this._itemChanged=!1;for(var $J=[],$o=0,$r=0,$S=this.numChildren;$r<$S;$r++){var $G=this.getChildAt($r);$G&&$G.layoutEnabled&&($J.push($G),$o=this._width?this._width:Math.max($o,$G.width*$G.scaleX))}this.sortItem($J);var $z=0;for($r=0,$S=$J.length;$r<$S;$r++)($G=$J[$r]).y=$z,$z+=$G.height*$G.scaleY+this._space,"left"==this._align?$G.x=0:"center"==this._align?$G.x=.5*($o-$G.width*$G.scaleX):"right"==this._align&&($G.x=$o-$G.width*$G.scaleX);this.changeSize()},$A(0,$r,"width",$J.prototype._$get_width,function($J){this._width!=$J&&($D.superSet($H,this,"width",$J),this.callLater(this.changeItems))}),$o.NONE="none",$o.LEFT="left",$o.CENTER="center",$o.RIGHT="right",$o}($H),$hJ=function($J){function $o(){$o.__super.call(this)}return $z($o,"laya.ui.RadioGroup",$W),$o.prototype.createItem=function($J,$o){return new $E($J,$o)},$o}(),$ZJ=function($J){function $o(){$o.__super.call(this)}return $z($o,"laya.ui.Tab",$W),$o.prototype.createItem=function($J,$o){return new $Q($J,$o)},$o}(),$uJ=function($o){function $r($J){this._vScrollBar=null,this._hScrollBar=null,void 0===$J&&($J=""),$r.__super.call(this,$J)}$z($r,"laya.ui.TextArea",$o);var $J=$r.prototype;return $J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$J.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$J.onVBarChanged=function($J){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$J.onHBarChanged=function($J){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$J.changeScroll=function(){var $J=this._vScrollBar&&0<this._tf.maxScrollY,$o=this._hScrollBar&&0<this._tf.maxScrollX,$r=$J?this._width-this._vScrollBar.width:this._width,$S=$o?this._height-this._hScrollBar.height:this._height,$G=this._tf.padding||$m.labelPadding;this._tf.width=$r,this._tf.height=$S,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$G[2],this._vScrollBar.y=$G[1],this._vScrollBar.height=this._height-($o?this._hScrollBar.height:0)-$G[1]-$G[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$S/Math.max(this._tf.textHeight,$S),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$J),this._hScrollBar&&(this._hScrollBar.x=$G[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$G[3],this._hScrollBar.width=this._width-($J?this._vScrollBar.width:0)-$G[0]-$G[2],this._hScrollBar.scrollSize=Math.max(.033*$r,1),this._hScrollBar.thumbPercent=$r/Math.max(this._tf.textWidth,$r),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$o)},$J.scrollTo=function($J){this.commitMeasure(),this._tf.scrollY=$J},$A(0,$J,"scrollY",function(){return this._tf.scrollY}),$A(0,$J,"width",$o.prototype._$get_width,function($J){$D.superSet($rJ,this,"width",$J),this.callLater(this.changeScroll)}),$A(0,$J,"hScrollBar",function(){return this._hScrollBar}),$A(0,$J,"height",$o.prototype._$get_height,function($J){$D.superSet($rJ,this,"height",$J),this.callLater(this.changeScroll)}),$A(0,$J,"maxScrollX",function(){return this._tf.maxScrollX}),$A(0,$J,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($J){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $oJ),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$J}),$A(0,$J,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($J){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $M),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$J}),$A(0,$J,"vScrollBar",function(){return this._vScrollBar}),$A(0,$J,"maxScrollY",function(){return this._tf.maxScrollY}),$A(0,$J,"scrollX",function(){return this._tf.scrollX}),$r}($rJ);!function($J){function $o(){this._uiView=null,this.isCloseOther=!1,$o.__super.call(this)}$z($o,"laya.ui.AsynDialog",$GJ);var $r=$o.prototype;$r.createView=function($J){this._uiView=$J},$r._open=function($J,$o,$r){this.isModal=$J,this.isCloseOther=$o,$GJ.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$r.onCreated=function(){this.createUI(),this.onOpen()},$r.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$r.onOpen=function(){$GJ.manager.open(this,this.isCloseOther),$GJ.manager.lock(!1)},$r.close=function($J,$o){void 0===$o&&($o=!0),$GJ.manager.close(this),this.onClose()},$r.onClose=function(){},$r.destroy=function($J){void 0===$J&&($J=!0),laya.ui.View.prototype.destroy.call(this,$J),this._uiView=null,this.onDestroy()},$r.onDestroy=function(){}}();$D.__init([$$])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($J,$o){"use strict";for(var $r in Object.defineProperty($o,"__esModule",{value:!0}),Laya){var $S=Laya[$r];$S&&$S.__isclass&&($o[$r]=$S)}}),function($j,$J,$K){$K.un,$K.uns;var $v=$K.static,$Y=$K.class,$_=$K.getset,$S=$K.__newvec,$t=laya.maths.Arith,$A=laya.webgl.atlas.AtlasResourceManager,$r=laya.webgl.shader.BaseShader,$k=laya.utils.Browser,$h=laya.webgl.utils.Buffer,$e=laya.utils.Byte,$G=laya.utils.ClassUtils,$Z=$K.Config,$z=(laya.events.Event,laya.events.EventDispatcher),$m=laya.utils.Handler,$w=laya.net.Loader,$o=laya.net.LoaderManager,$u=(laya.maths.MathUtil,laya.display.Node),$D=laya.renders.Render,$B=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$N=laya.resource.Resource,$i=laya.utils.RunDriver,$I=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$y=laya.display.Sprite,$g=laya.utils.Stat,$s=laya.utils.StringKey,$C=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$V=laya.utils.Utils,$R=laya.webgl.WebGL,$n=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$K.interface("laya.d3.core.IClone"),$K.interface("laya.d3.graphics.IVertex"),$K.interface("laya.d3.core.render.IUpdate"),$K.interface("laya.d3.core.scene.ITreeNode"),$K.interface("laya.d3.core.render.IRenderable");(function(){function $Q(){}$Y($Q,"laya.d3.animation.AnimationClipParser01"),$Q.READ_DATA=function(){$Q._DATA.offset=$Q._reader.getUint32(),$Q._DATA.size=$Q._reader.getUint32()},$Q.READ_BLOCK=function(){for(var $J=$Q._BLOCK.count=$Q._reader.getUint16(),$o=$Q._BLOCK.blockStarts=[],$r=$Q._BLOCK.blockLengths=[],$S=0;$S<$J;$S++)$o.push($Q._reader.getUint32()),$r.push($Q._reader.getUint32())},$Q.READ_STRINGS=function(){var $J=$Q._reader.getUint32(),$o=$Q._reader.getUint16(),$r=$Q._reader.pos;$Q._reader.pos=$J+$Q._DATA.offset;for(var $S=0;$S<$o;$S++)$Q._strings[$S]=$Q._reader.readUTFString();$Q._reader.pos=$r},$Q.parse=function($J,$o){$Q._animationClip=$J;($Q._reader=$o).__getBuffer();$Q.READ_DATA(),$Q.READ_BLOCK(),$Q.READ_STRINGS();for(var $r=0,$S=$Q._BLOCK.count;$r<$S;$r++){var $G=$o.getUint16(),$z=$Q._strings[$G],$A=$Q["READ_"+$z];if(null==$A)throw new Error("model file err,no this function:"+$G+" "+$z);$A.call()}},$Q.READ_ANIMATIONS=function(){var $J,$o=0,$r=0,$S=$Q._reader,$G=$S.__getBuffer(),$z=[],$A=$S.getUint8();for($z.length=$A,$o=0;$o<$A;$o++)$z[$o]=$S.getUint16();var $h=[],$Z=$S.getUint16();for($h.length=$Z,$o=0;$o<$Z;$o++)$h[$o]=$S.getFloat32();var $u=$Q._animationClip;$u.name=$Q._strings[$S.getUint16()];var $B=$u._duration=$S.getFloat32();$u.islooping=!!$S.getByte(),$u._frameRate=$S.getInt16();var $v=$S.getInt16(),$j=$u._nodes=new Array;$j.length=$v,($u._publicClipDatas=[]).length=$v;var $Y=$u._nodesMap={},$_=0,$D=0;for($o=0;$o<$v;$o++){$J=$j[$o]=new $b;var $N=$S.getUint16(),$w=$J.path=[];for($w.length=$N,$r=0;$r<$N;$r++)$w[$r]=$Q._strings[$S.getUint16()];var $i=$w.join("/"),$I=$Y[$i];$I||($Y[$i]=$I=[]),$I.push($J);var $t=$S.getInt16();-1!==$t&&($J.componentType=$Q._strings[$t]);var $K=$c._propertyIndexDic[$Q._strings[$S.getUint16()]];if(null==$K)throw new Error("AnimationClipParser01:unknown property name.");var $e=$K<4,$y=!$e||$e&&""===$w[0];($J._cacheProperty=$y)?$_++:$D++,$J.propertyNameID=$K;var $g=$z[$S.getUint8()];$J.keyFrameWidth=$g/4;var $s=$J.keyFrames=[],$V=$s.length=$S.getUint16(),$m=null,$C=NaN;for($r=0;$r<$V;$r++){var $R=$s[$r]=new $T;$C=$R.startTime=$h[$S.getUint16()];var $n=$S.pos;$R.inTangent=new Float32Array($G.slice($n,$n+$g)),$S.pos+=$g,$n=$S.pos,$R.outTangent=new Float32Array($G.slice($n,$n+$g)),$S.pos+=$g,$n=$S.pos,$R.data=new Float32Array($G.slice($n,$n+$g)),$S.pos+=$g,$m&&($m.next=$R,$m.duration=$C-$m.startTime),$m=$R}$R.next=null,$R.duration=$B-$C}var $k=$u._nodeToCachePropertyMap=new Int32Array($v),$U=$u._cachePropertyMap=new Int32Array($_),$L=$u._unCachePropertyMap=new Int32Array($D);for($_=$D=0,$o=0;$o<$v;$o++)($J=$j[$o])._cacheProperty?($k[$o]=$_,$U[$_++]=$o):$L[$D++]=$o},$Q._animationClip=null,$Q._reader=null,$Q._strings=[],$v($Q,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $d(){}$Y($d,"laya.d3.animation.AnimationClipParser02"),$d.READ_DATA=function(){$d._DATA.offset=$d._reader.getUint32(),$d._DATA.size=$d._reader.getUint32()},$d.READ_BLOCK=function(){for(var $J=$d._BLOCK.count=$d._reader.getUint16(),$o=$d._BLOCK.blockStarts=[],$r=$d._BLOCK.blockLengths=[],$S=0;$S<$J;$S++)$o.push($d._reader.getUint32()),$r.push($d._reader.getUint32())},$d.READ_STRINGS=function(){var $J=$d._reader.getUint32(),$o=$d._reader.getUint16(),$r=$d._reader.pos;$d._reader.pos=$J+$d._DATA.offset;for(var $S=0;$S<$o;$S++)$d._strings[$S]=$d._reader.readUTFString();$d._reader.pos=$r},$d.parse=function($J,$o){$d._animationClip=$J;($d._reader=$o).__getBuffer();$d.READ_DATA(),$d.READ_BLOCK(),$d.READ_STRINGS();for(var $r=0,$S=$d._BLOCK.count;$r<$S;$r++){var $G=$o.getUint16(),$z=$d._strings[$G],$A=$d["READ_"+$z];if(null==$A)throw new Error("model file err,no this function:"+$G+" "+$z);$A.call()}},$d.READ_ANIMATIONS=function(){var $J,$o=0,$r=0,$S=$d._reader,$G=$S.__getBuffer(),$z=[],$A=$S.getUint8();for($z.length=$A,$o=0;$o<$A;$o++)$z[$o]=$S.getUint16();var $h=[],$Z=$S.getUint16();for($h.length=$Z,$o=0;$o<$Z;$o++)$h[$o]=$S.getFloat32();var $u=$d._animationClip;$u.name=$d._strings[$S.getUint16()];var $B=$u._duration=$S.getFloat32();$u.islooping=!!$S.getByte(),$u._frameRate=$S.getInt16();var $v=$S.getInt16(),$j=$u._nodes=new Array;$j.length=$v,($u._publicClipDatas=[]).length=$v;var $Y=$u._nodesMap={},$_=0,$D=0;for($o=0;$o<$v;$o++){$J=$j[$o]=new $b;var $N=$S.getUint16(),$w=$J.path=[];for($w.length=$N,$r=0;$r<$N;$r++)$w[$r]=$d._strings[$S.getUint16()];var $i=$w.join("/"),$I=$Y[$i];$I||($Y[$i]=$I=[]),$I.push($J);var $t=$S.getInt16();-1!==$t&&($J.componentType=$d._strings[$t]);var $K=$c._propertyIndexDic[$d._strings[$S.getUint16()]];if(null==$K)throw new Error("AnimationClipParser02:unknown property name.");var $e=$K<4,$y=!$e||$e&&""===$w[0];($J._cacheProperty=$y)?$_++:$D++,$J.propertyNameID=$K;var $g=$z[$S.getUint8()];$J.keyFrameWidth=$g/4;var $s=$J.keyFrames=[],$V=$s.length=$S.getUint16(),$m=null,$C=NaN;for($r=0;$r<$V;$r++){var $R=$s[$r]=new $T;$C=$R.startTime=$h[$S.getUint16()];var $n=$S.pos;$R.inTangent=new Float32Array($G.slice($n,$n+$g)),$S.pos+=$g,$n=$S.pos,$R.outTangent=new Float32Array($G.slice($n,$n+$g)),$S.pos+=$g,$n=$S.pos,$R.data=new Float32Array($G.slice($n,$n+$g)),$S.pos+=$g,$m&&($m.next=$R,$m.duration=$C-$m.startTime),$m=$R}$R.next=null,$R.duration=$B-$C}var $k=$S.getUint16();for($o=0;$o<$k;$o++){var $U,$L=new $l;$L.time=$S.getFloat32(),$L.eventName=$d._strings[$S.getUint16()];var $Q=$S.getUint16();for(0<$Q&&($L.params=$U=[]),$r=0;$r<$Q;$r++){switch($S.getByte()){case 0:$U.push(!!$S.getByte());break;case 1:$U.push($S.getInt32());break;case 2:$U.push($S.getFloat32());break;case 3:$U.push($d._strings[$S.getUint16()]);break;default:throw new Error("unknown type.")}}$u.addEvent($L)}var $p=$u._nodeToCachePropertyMap=new Int32Array($v),$f=$u._cachePropertyMap=new Int32Array($_),$F=$u._unCachePropertyMap=new Int32Array($D);for($_=$D=0,$o=0;$o<$v;$o++)($J=$j[$o])._cacheProperty?($p[$o]=$_,$f[$_++]=$o):$F[$D++]=$o},$d._animationClip=null,$d._reader=null,$d._strings=[],$v($d,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $l=function(){function $J(){this.time=NaN,this.eventName=null,this.params=null}return $Y($J,"laya.d3.animation.AnimationEvent"),$J}(),$c=function(){function $S(){this._childs=[],this.transform=new $io(this)}$Y($S,"laya.d3.animation.AnimationNode");var $J=$S.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.addChild=function($J){$J._parent=this,$J.transform.setParent(this.transform),this._childs.push($J)},$J.removeChild=function($J){var $o=this._childs.indexOf($J);-1!==$o&&this._childs.splice($o,1)},$J.getChildByName=function($J){for(var $o=0,$r=this._childs.length;$o<$r;$o++){var $S=this._childs[$o];if($S.name===$J)return $S}return null},$J.getChildByIndex=function($J){return this._childs[$J]},$J.getChildCount=function(){return this._childs.length},$J.cloneTo=function($J){var $o=$J;$o.name=this.name;for(var $r=0,$S=this._childs.length;$r<$S;$r++){var $G=this._childs[$r],$z=$G.clone();$o.addChild($z);var $A=$G.transform,$h=$z.transform;$h.setLocalPosition($A.getLocalPosition()),$h.setLocalRotation($A.getLocalRotation()),$h.setLocalScale($A.getLocalScale()),$h._localRotationEuler=$A._localRotationEuler,$h._setWorldMatrixIgnoreUpdate($A.getWorldMatrix())}},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$S.__init__=function(){$S.registerAnimationNodeProperty("localPosition",$S._getLocalPosition,$S._setLocalPosition),$S.registerAnimationNodeProperty("localRotation",$S._getLocalRotation,$S._setLocalRotation),$S.registerAnimationNodeProperty("localScale",$S._getLocalScale,$S._setLocalScale),$S.registerAnimationNodeProperty("localRotationEuler",$S._getLocalRotationEuler,$S._setLocalRotationEuler),$S.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$S._getParticleRenderSharedMaterialTintColor,$S._setParticleRenderSharedMaterialTintColor),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$S._getMeshRenderSharedMaterialTilingOffset,$S._setMeshRenderSharedMaterialTilingOffset),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$S._getMeshRenderSharedMaterialAlbedo,$S._setMeshRenderSharedMaterialAlbedo),$S.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$S._getSkinnedMeshRenderSharedMaterialTilingOffset,$S._setSkinnedMeshRenderSharedMaterialTilingOffset),$S.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$S._getSkinnedMeshRenderSharedMaterialAlbedo,$S._setSkinnedMeshRenderSharedMaterialAlbedo),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$S._getMeshRenderSharedMaterialAlbedo,$S._setMeshRenderSharedMaterialAlbedo),$S.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$S._getSkinnedMeshRenderSharedMaterialAlbedo,$S._setSkinnedMeshRenderSharedMaterialAlbedo),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$S._getMeshRenderSharedMaterialIntensity,$S._setMeshRenderSharedMaterialIntensity),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$S._getMeshRenderSharedMaterialAlpha,$S._setMeshRenderSharedMaterialAlpha),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$S._getMeshRenderSharedMaterialAlphaColor,$S._setMeshRenderSharedMaterialAlphaColor),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$S._getMeshRenderSharedMaterialBaseColor,$S._setMeshRenderSharedMaterialBaseColor),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$S._getMeshRenderSharedMaterialDissolve,$S._setMeshRenderSharedMaterialDissolve),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$S._getMeshRenderSharedMaterialDissolveSpeed,$S._setMeshRenderSharedMaterialDissolveSpeed),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$S._getMeshRenderSharedMaterialMMultiplier,$S._setMeshRenderSharedMaterialMMultiplier),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$S._getMeshRenderSharedMaterialBaseScrollSpeedX,$S._setMeshRenderSharedMaterialBaseScrollSpeedX),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$S._getMeshRenderSharedMaterialBaseScrollSpeedY,$S._setMeshRenderSharedMaterialBaseScrollSpeedY),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$S._getMeshRenderSharedMaterialSecondScrollSpeedX,$S._setMeshRenderSharedMaterialSecondScrollSpeedX),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$S._getMeshRenderSharedMaterialSecondScrollSpeedY,$S._setMeshRenderSharedMaterialSecondScrollSpeedY),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$S._getMeshRenderSharedMaterialDetailTilingOffset,$S._setMeshRenderSharedMaterialDetailTilingOffset),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$S._getMeshRenderSharedMaterialDissolveTilingOffset,$S._setMeshRenderSharedMaterialDissolveTilingOffset),$S.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$S._getMeshRenderSharedMaterialMaskTilingOffset,$S._setMeshRenderSharedMaterialMaskTilingOffset)},$S.registerAnimationNodeProperty=function($J,$o,$r){if($S._propertyIndexDic[$J])throw new Error("AnimationNode: this propertyName has registered.");$S._propertyIndexDic[$J]=$S._propertyIDCounter,$S._propertyGetFuncs[$S._propertyIDCounter]=$o,$S._propertySetFuncs[$S._propertyIDCounter]=$r,$S._propertyIDCounter++},$S._getLocalPosition=function($J,$o){return $J?$J.transform.getLocalPosition():$o._transform.localPosition.elements},$S._setLocalPosition=function($J,$o,$r){if($J)$J.transform.setLocalPosition($r);else{var $S=$o._transform,$G=$S.localPosition;$G.elements=$r,$S.localPosition=$G}},$S._getLocalRotation=function($J,$o){return $J?$J.transform.getLocalRotation():$o._transform.localRotation.elements},$S._setLocalRotation=function($J,$o,$r){if($J)$J.transform.setLocalRotation($r);else{var $S=$o._transform,$G=$S.localRotation;$G.elements=$r,$S.localRotation=$G}},$S._getLocalScale=function($J,$o){return $J?$J.transform.getLocalScale():$o._transform.localScale.elements},$S._setLocalScale=function($J,$o,$r){if($J)$J.transform.setLocalScale($r);else{var $S=$o._transform,$G=$S.localScale;$G.elements=$r,$S.localScale=$G}},$S._getLocalRotationEuler=function($J,$o){return $J?$J.transform.getLocalRotationEuler():$o._transform.localRotationEuler.elements},$S._setLocalRotationEuler=function($J,$o,$r){if($J)$J.transform.setLocalRotationEuler($r);else{var $S=$o._transform,$G=$S.localRotationEuler;$G.elements=$r,$S.localRotationEuler=$G}},$S._getMeshRenderSharedMaterialTilingOffset=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $o.meshRender.sharedMaterial.tilingOffset.elements},$S._setMeshRenderSharedMaterialTilingOffset=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).tilingOffset).elements=$r,$S.tilingOffset=$G)}else($G=($S=$o.meshRender.material).tilingOffset).elements=$r,$S.tilingOffset=$G},$S._getMeshRenderSharedMaterialAlbedo=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $o.meshRender.sharedMaterial.albedoColor.elements},$S._setMeshRenderSharedMaterialAlbedo=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).albedoColor).elements=$r,$S.albedoColor=$G)}else($G=($S=$o.meshRender.material).albedoColor).elements=$r,$S.albedoColor=$G},$S._getSkinnedMeshRenderSharedMaterialTilingOffset=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $o.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$S._setSkinnedMeshRenderSharedMaterialTilingOffset=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.skinnedMeshRender.material).tilingOffset).elements=$r,$S.tilingOffset=$G)}else($G=($S=$o.skinnedMeshRender.material).tilingOffset).elements=$r,$S.tilingOffset=$G},$S._getSkinnedMeshRenderSharedMaterialAlbedo=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $o.skinnedMeshRender.sharedMaterial.albedoColor.elements},$S._setSkinnedMeshRenderSharedMaterialAlbedo=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.skinnedMeshRender.material).albedoColor).elements=$r,$S.albedoColor=$G)}else($G=($S=$o.skinnedMeshRender.material).albedoColor).elements=$r,$S.albedoColor=$G},$S._getParticleRenderSharedMaterialTintColor=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.particleRender.sharedMaterial.tintColor.elements:null}return $o.particleRender.sharedMaterial.tintColor.elements},$S._setParticleRenderSharedMaterialTintColor=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.particleRender.material).tintColor).elements=$r,$S.tintColor=$G)}else($G=($S=$o.particleRender.material).tintColor).elements=$r,$S.tintColor=$G},$S._getMeshRenderSharedMaterialAlphaColor=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $o.meshRender.sharedMaterial.alphaColor.elements},$S._setMeshRenderSharedMaterialAlphaColor=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).alphaColor).elements=$r,$S.alphaColor=$G)}else($G=($S=$o.meshRender.material).alphaColor).elements=$r,$S.alphaColor=$G},$S._getMeshRenderSharedMaterialBaseColor=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.baseColor.elements:null}return $o.meshRender.sharedMaterial.baseColor.elements},$S._setMeshRenderSharedMaterialBaseColor=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).baseColor).elements=$r,$S.baseColor=$G)}else($G=($S=$o.meshRender.material).baseColor).elements=$r,$S.baseColor=$G},$S._getMeshRenderSharedMaterialDissolve=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.dissolve:0}return $o.meshRender.sharedMaterial.dissolve},$S._setMeshRenderSharedMaterialDissolve=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.dissolve=$r[0])}else $o.meshRender.material.dissolve=$r[0]},$S._getMeshRenderSharedMaterialDissolveSpeed=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $o.meshRender.sharedMaterial.dissolveSpeed},$S._setMeshRenderSharedMaterialDissolveSpeed=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.dissolveSpeed=$r[0])}else $o.meshRender.material.dissolveSpeed=$r[0]},$S._getMeshRenderSharedMaterialMMultiplier=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.mMultiplier:0}return $o.meshRender.sharedMaterial.mMultiplier},$S._setMeshRenderSharedMaterialMMultiplier=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.mMultiplier=$r[0])}else $o.meshRender.material.mMultiplier=$r[0]},$S._getMeshRenderSharedMaterialBaseScrollSpeedX=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $o.meshRender.sharedMaterial.baseScrollSpeedX},$S._setMeshRenderSharedMaterialBaseScrollSpeedX=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.baseScrollSpeedX=$r[0])}else $o.meshRender.material.baseScrollSpeedX=$r[0]},$S._getMeshRenderSharedMaterialBaseScrollSpeedY=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $o.meshRender.sharedMaterial.baseScrollSpeedY},$S._setMeshRenderSharedMaterialBaseScrollSpeedY=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.baseScrollSpeedY=$r[0])}else $o.meshRender.material.baseScrollSpeedY=$r[0]},$S._getMeshRenderSharedMaterialSecondScrollSpeedX=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $o.meshRender.sharedMaterial.secondScrollSpeedX},$S._setMeshRenderSharedMaterialSecondScrollSpeedX=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.secondScrollSpeedX=$r[0])}else $o.meshRender.material.secondScrollSpeedX=$r[0]},$S._getMeshRenderSharedMaterialSecondScrollSpeedY=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $o.meshRender.sharedMaterial.secondScrollSpeedY},$S._setMeshRenderSharedMaterialSecondScrollSpeedY=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.secondScrollSpeedY=$r[0])}else $o.meshRender.material.secondScrollSpeedY=$r[0]},$S._getMeshRenderSharedMaterialAlpha=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.alpha:0}return $o.meshRender.sharedMaterial.alpha},$S._setMeshRenderSharedMaterialAlpha=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.alpha=$r[0])}else $o.meshRender.material.alpha=$r[0]},$S._getMeshRenderSharedMaterialIntensity=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.intensity:0}return $o.meshRender.sharedMaterial.intensity},$S._setMeshRenderSharedMaterialIntensity=function($J,$o,$r){if($J){var $S=$J.transform._entity;$S&&($S.owner.meshRender.material.intensity=$r[0])}else $o.meshRender.material.intensity=$r[0]},$S._getMeshRenderSharedMaterialDetailTilingOffset=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $o.meshRender.sharedMaterial.detailTilingOffset.elements},$S._setMeshRenderSharedMaterialDetailTilingOffset=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).detailTilingOffset).elements=$r,$S.detailTilingOffset=$G)}else($G=($S=$o.meshRender.material).detailTilingOffset).elements=$r,$S.detailTilingOffset=$G},$S._getMeshRenderSharedMaterialDissolveTilingOffset=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $o.meshRender.sharedMaterial.dissolveTilingOffset.elements},$S._setMeshRenderSharedMaterialDissolveTilingOffset=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).dissolveTilingOffset).elements=$r,$S.dissolveTilingOffset=$G)}else($G=($S=$o.meshRender.material).dissolveTilingOffset).elements=$r,$S.dissolveTilingOffset=$G},$S._getMeshRenderSharedMaterialMaskTilingOffset=function($J,$o){if($J){var $r=$J.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $o.meshRender.sharedMaterial.maskTilingOffset.elements},$S._setMeshRenderSharedMaterialMaskTilingOffset=function($J,$o,$r){var $S,$G;if($J){var $z=$J.transform._entity;$z&&(($G=($S=$z.owner.meshRender.material).maskTilingOffset).elements=$r,$S.maskTilingOffset=$G)}else($G=($S=$o.meshRender.material).maskTilingOffset).elements=$r,$S.maskTilingOffset=$G},$S._propertyIDCounter=0,$S._propertyIndexDic={},$S._propertySetFuncs=[],$S._propertyGetFuncs=[],$S}(),$T=function(){function $J(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $Y($J,"laya.d3.animation.Keyframe"),$J}(),$b=function(){function $J(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $Y($J,"laya.d3.animation.KeyframeNode"),$J}(),$U=(function(){function $J(){this._tempVector30=new $Ao,this._tempVector31=new $Ao,this._tempVector32=new $Ao,this._a=new $Ao,this._b=new $Ao,this._c=new $Ao,this._d=new $Ao}$Y($J,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $o=$J.prototype;$o.Init=function($J,$o,$r,$S){$J.cloneTo(this._d),$o.cloneTo(this._c),$Ao.scale($J,2,this._a),$Ao.scale($r,2,this._tempVector30),$Ao.subtract(this._a,this._tempVector30,this._a),$Ao.add(this._a,$o,this._a),$Ao.add(this._a,$S,this._a),$Ao.scale($r,3,this._b),$Ao.scale($J,3,this._tempVector30),$Ao.subtract(this._b,this._tempVector30,this._b),$Ao.subtract(this._b,$S,this._b),$Ao.scale($o,2,this._tempVector30),$Ao.subtract(this._b,this._tempVector30,this._b)},$o.Slerp=function($J,$o){$Ao.scale(this._a,$J*$J*$J,this._tempVector30),$Ao.scale(this._b,$J*$J,this._tempVector31),$Ao.scale(this._c,$J,this._tempVector32),$Ao.add(this._tempVector30,this._tempVector31,$o),$Ao.add($o,this._tempVector32,$o),$Ao.add($o,this._d,$o)}}(),function(){function $f($J,$o,$r,$S){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$J,this._h=$o,this._minHeight=$r,this._maxHeight=$S}$Y($f,"laya.d3.core.HeightMap");var $J=$f.prototype;$J._inBounds=function($J,$o){return 0<=$J&&$J<this._h&&0<=$o&&$o<this._w},$J.getHeight=function($J,$o){return this._inBounds($J,$o)?this._datas[$J][$o]:NaN},$_(0,$J,"width",function(){return this._w}),$_(0,$J,"height",function(){return this._h}),$_(0,$J,"maxHeight",function(){return this._maxHeight}),$_(0,$J,"minHeight",function(){return this._minHeight}),$f.creatFromMesh=function($J,$o,$r,$S){for(var $G=[],$z=[],$A=$J.getSubMeshCount(),$h=0;$h<$A;$h++){for(var $Z=$J.getSubMesh($h),$u=$Z._getVertexBuffer(),$B=$u.getData(),$v=[],$j=0;$j<$B.length;$j+=$u.vertexDeclaration.vertexStride/4){var $Y=new $Ao($B[$j+0],$B[$j+1],$B[$j+2]);$v.push($Y)}$G.push($v);var $_=$Z._getIndexBuffer();$z.push($_.getData())}var $D=$J.boundingBox,$N=$D.min.x,$w=$D.min.z,$i=$D.max.x,$I=$D.max.z,$t=$D.min.y,$K=$D.max.y,$e=$i-$N,$y=$I-$w,$g=$S.elements[0]=$e/($o-1),$s=$S.elements[1]=$y/($r-1),$V=new $f($o,$r,$t,$K),$m=$f._tempRay,$C=$m.direction.elements;$C[0]=0,$C[1]=-1,$C[2]=0;var $R=$K+.1;$m.origin.elements[1]=$R;for(var $n=0;$n<$r;$n++){var $k=$w+$n*$s;$V._datas[$n]=[];for(var $U=0;$U<$o;$U++){var $L=$N+$U*$g,$Q=$m.origin.elements;$Q[0]=$L,$Q[2]=$k;var $p=$f._getPosition($m,$G,$z);$V._datas[$n][$U]=$p===Number.MAX_VALUE?NaN:$R-$p}}return $V},$f.createFromImage=function($J,$o,$r){for(var $S=$J.width,$G=$J.height,$z=new $f($S,$G,$o,$r),$A=($r-$o)/254,$h=$J.getPixels(),$Z=0,$u=0;$u<$G;$u++)for(var $B=$z._datas[$u]=[],$v=0;$v<$S;$v++){var $j=$h[$Z++],$Y=$h[$Z++],$_=$h[$Z++],$D=$h[$Z++];$B[$v]=255==$j&&255==$Y&&255==$_&&255==$D?NaN:($j+$Y+$_)/3*$A+$o}return $z},$f._getPosition=function($J,$o,$r){for(var $S=Number.MAX_VALUE,$G=0;$G<$o.length;$G++)for(var $z=$o[$G],$A=$r[$G],$h=0;$h<$A.length;$h+=3){var $Z=$z[$A[$h+0]],$u=$z[$A[$h+1]],$B=$z[$A[$h+2]],$v=$_o.rayIntersectsTriangle($J,$Z,$u,$B);!isNaN($v)&&$v<$S&&($S=$v)}return $S},$v($f,["_tempRay",function(){return this._tempRay=new $Go(new $Ao,new $Ao)}])}(),function(){function $G(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$Y($G,"laya.d3.core.Layer");var $J=$G.prototype;return $J._binarySearchIndex=function(){for(var $J=0,$o=$G._collsionTestList.length-1,$r=0;$J<=$o;){$r=Math.floor(($J+$o)/2);var $S=$G._collsionTestList[$r];if($S==this._number)return $r;$S>this._number?$o=$r-1:$J=$r+1}return $J},$J._addCollider=function($J){0===this._colliders.length&&$G._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$J._isRigidbody?(this._colliders.unshift($J),this._nonRigidbodyOffset++):this._colliders.push($J)},$J._removeCollider=function($J){var $o=this._colliders.indexOf($J);$o<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($o,1),0===this._colliders.length&&$G._collsionTestList.splice($G._collsionTestList.indexOf(this._number),1)},$_(0,$J,"number",function(){return this._number}),$_(0,$J,"visible",function(){return this._visible},function($J){this._visible=$J,$G._visibleLayers=$J?$G._visibleLayers|this.mask:$G._visibleLayers&~this.mask}),$_(0,$J,"mask",function(){return this._mask}),$_(1,$G,"visibleLayers",function(){return $G._visibleLayers},function($J){$G._visibleLayers=$J;for(var $o=0,$r=$G._layerList.length;$o<$r;$o++){var $S=$G._layerList[$o];$S._visible=0!=($S._mask&$G._visibleLayers)}}),$G.__init__=function(){$G._layerList.length=31;for(var $J=0;$J<31;$J++){var $o=new $G;$G._layerList[$J]=$o,0===$J?($o.name="Default Layer",$o.visible=!0):($o.name="Layer-"+$J,$o.visible=!1),$o._number=$J,$o._mask=Math.pow(2,$J)}$G.currentCreationLayer=$G._layerList[0]},$G.getLayerByNumber=function($J){if($J<0||30<$J)throw new Error("无法返回指定Layer，该number超出范围！");return $G._layerList[$J]},$G.getLayerByName=function($J){for(var $o=0;$o<31;$o++)if($G._layerList[$o].name===$J)return $G._layerList[$o];throw new Error("无法返回指定Layer,该name不存在")},$G.isVisible=function($J){return 0!=($J&$G._currentCameraCullingMask&$G._visibleLayers)},$G._layerList=[],$G._visibleLayers=2147483647,$G._collsionTestList=[],$G._currentCameraCullingMask=2147483647,$G.maxCount=31,$G.currentCreationLayer=null,$G}()),$L=(function(){function $J($J,$o,$r){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$J,this._minCount=$o,this._maxCount=$r}$Y($J,"laya.d3.core.particleShuriKen.module.Burst");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.cloneTo=function($J){var $o=$J;$o._time=this._time,$o._minCount=this._minCount,$o._maxCount=this._maxCount},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"time",function(){return this._time}),$_(0,$o,"minCount",function(){return this._minCount}),$_(0,$o,"maxCount",function(){return this._maxCount})}(),function(){function $J($J){this._color=null,this.enbale=!1,this._color=$J}$Y($J,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $o=$J.prototype;$o.cloneTo=function($J){var $o=$J;this._color.cloneTo($o._color),$o.enbale=this.enbale},$o.clone=function(){var $J;switch(this._color.type){case 0:$J=$p.createByConstant(this._color.constant.clone());break;case 1:$J=$p.createByGradient(this._color.gradient.clone());break;case 2:$J=$p.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$J=$p.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $o=new this.constructor($J);return $o.enbale=this.enbale,$o},$_(0,$o,"color",function(){return this._color})}(),function(){function $J(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$Y($J,"laya.d3.core.particleShuriKen.module.Emission");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$o._destroy=function(){this._bursts=null,this._destroyed=!0},$o.getBurstsCount=function(){return this._bursts.length},$o.getBurstByIndex=function($J){return this._bursts[$J]},$o.addBurst=function($J){var $o=this._bursts.length;if(0<$o)for(var $r=0;$r<$o;$r++)this._bursts[$r].time>$J.time&&this._bursts.splice($r,0,$J);this._bursts.push($J)},$o.removeBurst=function($J){var $o=this._bursts.indexOf($J);-1!==$o&&this._bursts.splice($o,1)},$o.removeBurstByIndex=function($J){this._bursts.splice($J,1)},$o.clearBurst=function(){this._bursts.length=0},$o.cloneTo=function($J){var $o=$J,$r=$o._bursts;$r.length=this._bursts.length;for(var $S=0,$G=this._bursts.length;$S<$G;$S++){var $z=$r[$S];$z?this._bursts[$S].cloneTo($z):$r[$S]=this._bursts[$S].clone()}$o._emissionRate=this._emissionRate,$o.enbale=this.enbale},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"destroyed",function(){return this._destroyed}),$_(0,$o,"emissionRate",function(){return this._emissionRate},function($J){if($J<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$J})}(),function(){function $S(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$Y($S,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $J=$S.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.cloneTo=function($J){var $o=$J;$o._type=this._type,$o._constant=this._constant,this._overTime.cloneTo($o._overTime),$o._constantMin=this._constantMin,$o._constantMax=this._constantMax,this._overTimeMin.cloneTo($o._overTimeMin),this._overTimeMax.cloneTo($o._overTimeMax)},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$J,"frameOverTimeData",function(){return this._overTime}),$_(0,$J,"constant",function(){return this._constant}),$_(0,$J,"type",function(){return this._type}),$_(0,$J,"frameOverTimeDataMin",function(){return this._overTimeMin}),$_(0,$J,"constantMin",function(){return this._constantMin}),$_(0,$J,"frameOverTimeDataMax",function(){return this._overTimeMax}),$_(0,$J,"constantMax",function(){return this._constantMax}),$S.createByConstant=function($J){var $o=new $S;return $o._type=0,$o._constant=$J,$o},$S.createByOverTime=function($J){var $o=new $S;return $o._type=1,$o._overTime=$J,$o},$S.createByRandomTwoConstant=function($J,$o){var $r=new $S;return $r._type=2,$r._constantMin=$J,$r._constantMax=$o,$r},$S.createByRandomTwoOverTime=function($J,$o){var $r=new $S;return $r._type=3,$r._overTimeMin=$J,$r._overTimeMax=$o,$r},$S}()),$Q=function(){function $u(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$Y($u,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $J=$u.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.cloneTo=function($J){var $o=$J;$o._type=this._type,$o._separateAxes=this._separateAxes,$o._constant=this._constant,this._constantSeparate.cloneTo($o._constantSeparate),this._gradient.cloneTo($o._gradient),this._gradientX.cloneTo($o._gradientX),this._gradientY.cloneTo($o._gradientY),this._gradientZ.cloneTo($o._gradientZ),$o._constantMin=this._constantMin,$o._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($o._constantMinSeparate),this._constantMaxSeparate.cloneTo($o._constantMaxSeparate),this._gradientMin.cloneTo($o._gradientMin),this._gradientMax.cloneTo($o._gradientMax),this._gradientXMin.cloneTo($o._gradientXMin),this._gradientXMax.cloneTo($o._gradientXMax),this._gradientYMin.cloneTo($o._gradientYMin),this._gradientYMax.cloneTo($o._gradientYMax),this._gradientZMin.cloneTo($o._gradientZMin),this._gradientZMax.cloneTo($o._gradientZMax)},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$J,"gradientZ",function(){return this._gradientZ}),$_(0,$J,"constant",function(){return this._constant}),$_(0,$J,"gradient",function(){return this._gradient}),$_(0,$J,"separateAxes",function(){return this._separateAxes}),$_(0,$J,"type",function(){return this._type}),$_(0,$J,"constantSeparate",function(){return this._constantSeparate}),$_(0,$J,"gradientX",function(){return this._gradientX}),$_(0,$J,"gradientY",function(){return this._gradientY}),$_(0,$J,"gradientW",function(){return this._gradientW}),$_(0,$J,"gradientMin",function(){return this._gradientMin}),$_(0,$J,"constantMin",function(){return this._constantMin}),$_(0,$J,"gradientMax",function(){return this._gradientMax}),$_(0,$J,"constantMax",function(){return this._constantMax}),$_(0,$J,"gradientWMin",function(){return this._gradientWMin}),$_(0,$J,"constantMinSeparate",function(){return this._constantMinSeparate}),$_(0,$J,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$_(0,$J,"gradientXMin",function(){return this._gradientXMin}),$_(0,$J,"gradientXMax",function(){return this._gradientXMax}),$_(0,$J,"gradientWMax",function(){return this._gradientWMax}),$_(0,$J,"gradientYMin",function(){return this._gradientYMin}),$_(0,$J,"gradientYMax",function(){return this._gradientYMax}),$_(0,$J,"gradientZMin",function(){return this._gradientZMin}),$_(0,$J,"gradientZMax",function(){return this._gradientZMax}),$u.createByConstant=function($J){var $o=new $u;return $o._type=0,$o._separateAxes=!1,$o._constant=$J,$o},$u.createByConstantSeparate=function($J){var $o=new $u;return $o._type=0,$o._separateAxes=!0,$o._constantSeparate=$J,$o},$u.createByGradient=function($J){var $o=new $u;return $o._type=1,$o._separateAxes=!1,$o._gradient=$J,$o},$u.createByGradientSeparate=function($J,$o,$r,$S){var $G=new $u;return $G._type=1,$G._separateAxes=!0,$G._gradientX=$J,$G._gradientY=$o,$G._gradientZ=$r,$G._gradientW=$S,$G},$u.createByRandomTwoConstant=function($J,$o){var $r=new $u;return $r._type=2,$r._separateAxes=!1,$r._constantMin=$J,$r._constantMax=$o,$r},$u.createByRandomTwoConstantSeparate=function($J,$o){var $r=new $u;return $r._type=2,$r._separateAxes=!0,$r._constantMinSeparate=$J,$r._constantMaxSeparate=$o,$r},$u.createByRandomTwoGradient=function($J,$o){var $r=new $u;return $r._type=3,$r._separateAxes=!1,$r._gradientMin=$J,$r._gradientMax=$o,$r},$u.createByRandomTwoGradientSeparate=function($J,$o,$r,$S,$G,$z,$A,$h){var $Z=new $u;return $Z._type=3,$Z._separateAxes=!0,$Z._gradientXMin=$J,$Z._gradientXMax=$o,$Z._gradientYMin=$r,$Z._gradientYMax=$S,$Z._gradientZMin=$G,$Z._gradientZMax=$z,$Z._gradientWMin=$A,$Z._gradientWMax=$h,$Z},$u}(),$p=function(){function $S(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$Y($S,"laya.d3.core.particleShuriKen.module.GradientColor");var $J=$S.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.cloneTo=function($J){var $o=$J;$o._type=this._type,this._constant.cloneTo($o._constant),this._constantMin.cloneTo($o._constantMin),this._constantMax.cloneTo($o._constantMax),this._gradient.cloneTo($o._gradient),this._gradientMin.cloneTo($o._gradientMin),this._gradientMax.cloneTo($o._gradientMax)},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$J,"gradient",function(){return this._gradient}),$_(0,$J,"constant",function(){return this._constant}),$_(0,$J,"type",function(){return this._type}),$_(0,$J,"gradientMin",function(){return this._gradientMin}),$_(0,$J,"constantMin",function(){return this._constantMin}),$_(0,$J,"gradientMax",function(){return this._gradientMax}),$_(0,$J,"constantMax",function(){return this._constantMax}),$S.createByConstant=function($J){var $o=new $S;return $o._type=0,$o._constant=$J,$o},$S.createByGradient=function($J){var $o=new $S;return $o._type=1,$o._gradient=$J,$o},$S.createByRandomTwoConstant=function($J,$o){var $r=new $S;return $r._type=2,$r._constantMin=$J,$r._constantMax=$o,$r},$S.createByRandomTwoGradient=function($J,$o){var $r=new $S;return $r._type=3,$r._gradientMin=$J,$r._gradientMax=$o,$r},$S}(),$f=(function(){function $J(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$Y($J,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.addAlpha=function($J,$o){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$J&&($J=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$J,this._alphaElements[this._alphaCurrentLength++]=$o):DEBUG},$o.addRGB=function($J,$o){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$J&&($J=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$J,this._rgbElements[this._rgbCurrentLength++]=$o.x,this._rgbElements[this._rgbCurrentLength++]=$o.y,this._rgbElements[this._rgbCurrentLength++]=$o.z):DEBUG},$o.cloneTo=function($J){var $o=$J,$r=0,$S=0;$o._alphaCurrentLength=this._alphaCurrentLength;var $G=$o._alphaElements;for($G.length=this._alphaElements.length,$r=0,$S=this._alphaElements.length;$r<$S;$r++)$G[$r]=this._alphaElements[$r];$o._rgbCurrentLength=this._rgbCurrentLength;var $z=$o._rgbElements;for($z.length=this._rgbElements.length,$r=0,$S=this._rgbElements.length;$r<$S;$r++)$z[$r]=this._rgbElements[$r]},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$_(0,$o,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $J(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$Y($J,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.add=function($J,$o){this._currentLength<8?(6===this._currentLength&&1!==$J&&($J=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$J,this._elements[this._currentLength++]=$o):console.log("Warning:data count must lessEqual than 4")},$o.cloneTo=function($J){var $o=$J;$o._currentLength=this._currentLength;var $r=$o._elements;$r.length=this._elements.length;for(var $S=0,$G=this._elements.length;$S<$G;$S++)$r[$S]=this._elements[$S]},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"gradientCount",function(){return this._currentLength/2})}(),function(){function $J(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$Y($J,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.add=function($J,$o){this._currentLength<8?(6===this._currentLength&&1!==$J&&($J=1,DEBUG),this._elements[this._currentLength++]=$J,this._elements[this._currentLength++]=$o):DEBUG},$o.getKeyByIndex=function($J){return this._elements[2*$J]},$o.getValueByIndex=function($J){return this._elements[2*$J+1]},$o.getAverageValue=function(){for(var $J=0,$o=this._currentLength-2;$J<$o;$J+=2){this._elements[$J+1];this._elements[$J+3],this._elements[$J+2]-this._elements[$J]}return 0},$o.cloneTo=function($J){var $o=$J;$o._currentLength=this._currentLength;var $r=$o._elements;$r.length=this._elements.length;for(var $S=0,$G=this._elements.length;$S<$G;$S++)$r[$S]=this._elements[$S]},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"gradientCount",function(){return this._currentLength/2})}(),function(){function $J(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$Y($J,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.add=function($J,$o){this._currentLength<8?(6===this._currentLength&&1!==$J&&($J=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$J,this._elements[this._currentLength++]=$o.x,this._elements[this._currentLength++]=$o.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$o.cloneTo=function($J){var $o=$J;$o._currentLength=this._currentLength;var $r=$o._elements;$r.length=this._elements.length;for(var $S=0,$G=this._elements.length;$S<$G;$S++)$r[$S]=this._elements[$S]},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"gradientCount",function(){return this._currentLength/3})}(),function(){function $h(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$Y($h,"laya.d3.core.particleShuriKen.module.GradientSize");var $J=$h.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.getMaxSizeInGradient=function(){var $J=0,$o=0,$r=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($J=0,$o=this._gradientX.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientX.getValueByIndex($J));for($J=0,$o=this._gradientY.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientY.getValueByIndex($J))}else for($J=0,$o=this._gradient.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradient.getValueByIndex($J));break;case 1:$r=this._separateAxes?($r=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$r=Math.max($r,this._constantMinSeparate.y),Math.max($r,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($J=0,$o=this._gradientXMin.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientXMin.getValueByIndex($J));for($J=0,$o=this._gradientXMax.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientXMax.getValueByIndex($J));for($J=0,$o=this._gradientYMin.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientYMin.getValueByIndex($J));for($J=0,$o=this._gradientZMax.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientZMax.getValueByIndex($J))}else{for($J=0,$o=this._gradientMin.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientMin.getValueByIndex($J));for($J=0,$o=this._gradientMax.gradientCount;$J<$o;$J++)$r=Math.max($r,this._gradientMax.getValueByIndex($J))}}return $r},$J.cloneTo=function($J){var $o=$J;$o._type=this._type,$o._separateAxes=this._separateAxes,this._gradient.cloneTo($o._gradient),this._gradientX.cloneTo($o._gradientX),this._gradientY.cloneTo($o._gradientY),this._gradientZ.cloneTo($o._gradientZ),$o._constantMin=this._constantMin,$o._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($o._constantMinSeparate),this._constantMaxSeparate.cloneTo($o._constantMaxSeparate),this._gradientMin.cloneTo($o._gradientMin),this._gradientMax.cloneTo($o._gradientMax),this._gradientXMin.cloneTo($o._gradientXMin),this._gradientXMax.cloneTo($o._gradientXMax),this._gradientYMin.cloneTo($o._gradientYMin),this._gradientYMax.cloneTo($o._gradientYMax),this._gradientZMin.cloneTo($o._gradientZMin),this._gradientZMax.cloneTo($o._gradientZMax)},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$J,"gradientZ",function(){return this._gradientZ}),$_(0,$J,"gradient",function(){return this._gradient}),$_(0,$J,"separateAxes",function(){return this._separateAxes}),$_(0,$J,"type",function(){return this._type}),$_(0,$J,"gradientMin",function(){return this._gradientMin}),$_(0,$J,"constantMin",function(){return this._constantMin}),$_(0,$J,"gradientX",function(){return this._gradientX}),$_(0,$J,"gradientY",function(){return this._gradientY}),$_(0,$J,"gradientMax",function(){return this._gradientMax}),$_(0,$J,"constantMax",function(){return this._constantMax}),$_(0,$J,"constantMinSeparate",function(){return this._constantMinSeparate}),$_(0,$J,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$_(0,$J,"gradientXMin",function(){return this._gradientXMin}),$_(0,$J,"gradientXMax",function(){return this._gradientXMax}),$_(0,$J,"gradientYMin",function(){return this._gradientYMin}),$_(0,$J,"gradientYMax",function(){return this._gradientYMax}),$_(0,$J,"gradientZMin",function(){return this._gradientZMin}),$_(0,$J,"gradientZMax",function(){return this._gradientZMax}),$h.createByGradient=function($J){var $o=new $h;return $o._type=0,$o._separateAxes=!1,$o._gradient=$J,$o},$h.createByGradientSeparate=function($J,$o,$r){var $S=new $h;return $S._type=0,$S._separateAxes=!0,$S._gradientX=$J,$S._gradientY=$o,$S._gradientZ=$r,$S},$h.createByRandomTwoConstant=function($J,$o){var $r=new $h;return $r._type=1,$r._separateAxes=!1,$r._constantMin=$J,$r._constantMax=$o,$r},$h.createByRandomTwoConstantSeparate=function($J,$o){var $r=new $h;return $r._type=1,$r._separateAxes=!0,$r._constantMinSeparate=$J,$r._constantMaxSeparate=$o,$r},$h.createByRandomTwoGradient=function($J,$o){var $r=new $h;return $r._type=2,$r._separateAxes=!1,$r._gradientMin=$J,$r._gradientMax=$o,$r},$h.createByRandomTwoGradientSeparate=function($J,$o,$r,$S,$G,$z){var $A=new $h;return $A._type=2,$A._separateAxes=!0,$A._gradientXMin=$J,$A._gradientXMax=$o,$A._gradientYMin=$r,$A._gradientYMax=$S,$A._gradientZMin=$G,$A._gradientZMax=$z,$A},$h}()),$F=function(){function $h(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$Y($h,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $J=$h.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.cloneTo=function($J){var $o=$J;$o._type=this._type,this._constant.cloneTo($o._constant),this._gradientX.cloneTo($o._gradientX),this._gradientY.cloneTo($o._gradientY),this._gradientZ.cloneTo($o._gradientZ),this._constantMin.cloneTo($o._constantMin),this._constantMax.cloneTo($o._constantMax),this._gradientXMin.cloneTo($o._gradientXMin),this._gradientXMax.cloneTo($o._gradientXMax),this._gradientYMin.cloneTo($o._gradientYMin),this._gradientYMax.cloneTo($o._gradientYMax),this._gradientZMin.cloneTo($o._gradientZMin),this._gradientZMax.cloneTo($o._gradientZMax)},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$J,"gradientZ",function(){return this._gradientZ}),$_(0,$J,"constant",function(){return this._constant}),$_(0,$J,"type",function(){return this._type}),$_(0,$J,"gradientXMax",function(){return this._gradientXMax}),$_(0,$J,"constantMin",function(){return this._constantMin}),$_(0,$J,"gradientX",function(){return this._gradientX}),$_(0,$J,"gradientY",function(){return this._gradientY}),$_(0,$J,"gradientXMin",function(){return this._gradientXMin}),$_(0,$J,"constantMax",function(){return this._constantMax}),$_(0,$J,"gradientYMin",function(){return this._gradientYMin}),$_(0,$J,"gradientYMax",function(){return this._gradientYMax}),$_(0,$J,"gradientZMin",function(){return this._gradientZMin}),$_(0,$J,"gradientZMax",function(){return this._gradientZMax}),$h.createByConstant=function($J){var $o=new $h;return $o._type=0,$o._constant=$J,$o},$h.createByGradient=function($J,$o,$r){var $S=new $h;return $S._type=1,$S._gradientX=$J,$S._gradientY=$o,$S._gradientZ=$r,$S},$h.createByRandomTwoConstant=function($J,$o){var $r=new $h;return $r._type=2,$r._constantMin=$J,$r._constantMax=$o,$r},$h.createByRandomTwoGradient=function($J,$o,$r,$S,$G,$z){var $A=new $h;return $A._type=3,$A._gradientXMin=$J,$A._gradientXMax=$o,$A._gradientYMin=$r,$A._gradientYMax=$S,$A._gradientZMin=$G,$A._gradientZMax=$z,$A},$h}(),$d=(function(){function $J($J){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$J}$Y($J,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.cloneTo=function($J){var $o=$J;this._angularVelocity.cloneTo($o._angularVelocity),$o.enbale=this.enbale},$o.clone=function(){var $J;switch(this._angularVelocity.type){case 0:$J=this._angularVelocity.separateAxes?$Q.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$Q.createByConstant(this._angularVelocity.constant);break;case 1:$J=this._angularVelocity.separateAxes?$Q.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$Q.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$J=this._angularVelocity.separateAxes?$Q.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$Q.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$J=this._angularVelocity.separateAxes?$Q.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$Q.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $o=new this.constructor($J);return $o.enbale=this.enbale,$o},$_(0,$o,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $J(){this.enable=!1,this.randomDirection=!1}$Y($J,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $o=$J.prototype;return $K.imps($o,{"laya.d3.core.IClone":!0}),$o._getShapeBoundBox=function($J){throw new Error("BaseShape: must override it.")},$o._getSpeedBoundBox=function($J){throw new Error("BaseShape: must override it.")},$o.generatePositionAndDirection=function($J,$o,$r,$S){throw new Error("BaseShape: must override it.")},$o._calculateProceduralBounds=function($J,$o,$r){this._getShapeBoundBox($J);var $S=$J.min,$G=$J.max;$Ao.multiply($S,$o,$S),$Ao.multiply($G,$o,$G);var $z=new $OJ(new $Ao,new $Ao);this.randomDirection?($z.min=new $Ao(-1,-1,-1),$z.max=new $Ao(1,1,1)):this._getSpeedBoundBox($z);var $A=new $OJ(new $Ao,new $Ao),$h=$A.min,$Z=$A.max;$Ao.scale($z.min,$r.y,$h),$Ao.scale($z.max,$r.y,$Z),$Ao.add($J.min,$h,$h),$Ao.add($J.max,$Z,$Z),$Ao.min($J.min,$h,$J.min),$Ao.max($J.max,$h,$J.max);var $u=new $OJ(new $Ao,new $Ao),$B=$u.min,$v=$u.max;$Ao.scale($z.min,$r.x,$B),$Ao.scale($z.max,$r.x,$v),$Ao.min($u.min,$v,$h),$Ao.max($u.min,$v,$Z),$Ao.min($J.min,$h,$J.min),$Ao.max($J.max,$h,$J.max)},$o.cloneTo=function($J){$J.enable=this.enable},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$J}()),$$=function(){function $z(){}return $Y($z,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$z._randomPointUnitArcCircle=function($J,$o,$r){var $S=$o.elements,$G=NaN;$G=$r?$r.getFloat()*$J:Math.random()*$J,$S[0]=Math.cos($G),$S[1]=Math.sin($G)},$z._randomPointInsideUnitArcCircle=function($J,$o,$r){var $S=$o.elements;$z._randomPointUnitArcCircle($J,$o,$r);var $G=NaN;$G=$r?Math.pow($r.getFloat(),.5):Math.pow(Math.random(),.5),$S[0]=$S[0]*$G,$S[1]=$S[1]*$G},$z._randomPointUnitCircle=function($J,$o){var $r=$J.elements,$S=NaN;$S=$o?$o.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$r[0]=Math.cos($S),$r[1]=Math.sin($S)},$z._randomPointInsideUnitCircle=function($J,$o){var $r=$J.elements;$z._randomPointUnitCircle($J);var $S=NaN;$S=$o?Math.pow($o.getFloat(),.5):Math.pow(Math.random(),.5),$r[0]=$r[0]*$S,$r[1]=$r[1]*$S},$z._randomPointUnitSphere=function($J,$o){var $r=$J.elements,$S=NaN,$G=NaN;$G=$o?($S=$r[2]=2*$o.getFloat()-1,$o.getFloat()*Math.PI*2):($S=$r[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $z=Math.sqrt(1-$S*$S);$r[0]=$z*Math.cos($G),$r[1]=$z*Math.sin($G)},$z._randomPointInsideUnitSphere=function($J,$o){var $r=$J.elements;$z._randomPointUnitSphere($J);var $S=NaN;$S=$o?Math.pow($o.getFloat(),1/3):Math.pow(Math.random(),1/3),$r[0]=$r[0]*$S,$r[1]=$r[1]*$S,$r[2]=$r[2]*$S},$z._randomPointInsideHalfUnitBox=function($J,$o){var $r=$J.elements;$o?($r[0]=$o.getFloat()-.5,$r[1]=$o.getFloat()-.5,$r[2]=$o.getFloat()-.5):($r[0]=Math.random()-.5,$r[1]=Math.random()-.5,$r[2]=Math.random()-.5)},$z}(),$q=(function(){function $J($J){this._size=null,this.enbale=!1,this._size=$J}$Y($J,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.cloneTo=function($J){var $o=$J;this._size.cloneTo($o._size),$o.enbale=this.enbale},$o.clone=function(){var $J;switch(this._size.type){case 0:$J=this._size.separateAxes?$f.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$f.createByGradient(this._size.gradient.clone());break;case 1:$J=this._size.separateAxes?$f.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$f.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$J=this._size.separateAxes?$f.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$f.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $o=new this.constructor($J);return $o.enbale=this.enbale,$o},$_(0,$o,"size",function(){return this._size})}(),function(){function $S(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$Y($S,"laya.d3.core.particleShuriKen.module.StartFrame");var $J=$S.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.cloneTo=function($J){var $o=$J;$o._type=this._type,$o._constant=this._constant,$o._constantMin=this._constantMin,$o._constantMax=this._constantMax},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$J,"constant",function(){return this._constant}),$_(0,$J,"type",function(){return this._type}),$_(0,$J,"constantMin",function(){return this._constantMin}),$_(0,$J,"constantMax",function(){return this._constantMax}),$S.createByConstant=function($J){var $o=new $S;return $o._type=0,$o._constant=$J,$o},$S.createByRandomTwoConstant=function($J,$o){var $r=new $S;return $r._type=1,$r._constantMin=$J,$r._constantMax=$o,$r},$S}()),$H=(function(){function $J($J,$o){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $zo(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$J,this._startFrame=$o}$Y($J,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.cloneTo=function($J){var $o=$J;this.tiles.cloneTo($o.tiles),$o.type=this.type,$o.randomRow=this.randomRow,this._frame.cloneTo($o._frame),this._startFrame.cloneTo($o._startFrame),$o.cycles=this.cycles,$o.enableUVChannels=this.enableUVChannels,$o.enable=this.enable},$o.clone=function(){var $J,$o;switch(this._frame.type){case 0:$J=$L.createByConstant(this._frame.constant);break;case 1:$J=$L.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$J=$L.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$J=$L.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$o=$q.createByConstant(this._startFrame.constant);break;case 1:$o=$q.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $r=new this.constructor($J,$o);return this.tiles.cloneTo($r.tiles),$r.type=this.type,$r.randomRow=this.randomRow,$r.cycles=this.cycles,$r.enableUVChannels=this.enableUVChannels,$r.enable=this.enable,$r},$_(0,$o,"frame",function(){return this._frame}),$_(0,$o,"startFrame",function(){return this._startFrame})}(),function(){function $J($J){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$J}$Y($J,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $o=$J.prototype;$K.imps($o,{"laya.d3.core.IClone":!0}),$o.cloneTo=function($J){var $o=$J;this._velocity.cloneTo($o._velocity),$o.enbale=this.enbale,$o.space=this.space},$o.clone=function(){var $J;switch(this._velocity.type){case 0:$J=$F.createByConstant(this._velocity.constant.clone());break;case 1:$J=$F.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$J=$F.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$J=$F.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $o=new this.constructor($J);return $o.enbale=this.enbale,$o.space=this.space,$o},$_(0,$o,"velocity",function(){return this._velocity})}(),function(){function $J(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $jo,this._vb=$do.create($J._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$Fo.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$po.nameKey.getID("LINE"),this._shaderCompile=$go._preCompileShader[this._sharderNameID]}$Y($J,"laya.d3.core.PhasorSpriter3D");var $o=$J.prototype;return $o.line=function($J,$o,$r,$S){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($J.x,$J.y,$J.z,$o.x,$o.y,$o.z,$o.w),this.addVertex($r.x,$r.y,$r.z,$S.x,$S.y,$S.z,$S.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$o.circle=function($J,$o,$r,$S,$G,$z){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$o,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$o,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$J,Math.cos(this._tempNumver0)*$J,0,$r,$S,$G,$z),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$o.plane=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$S/2,this._tempNumver1=$G/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($J-this._tempNumver0,$o+this._tempNumver1,$r,$z,$A,$h,$Z),this.addVertex($J+this._tempNumver0,$o+this._tempNumver1,$r,$z,$A,$h,$Z),this.addVertex($J-this._tempNumver0,$o-this._tempNumver1,$r,$z,$A,$h,$Z),this.addVertex($J+this._tempNumver0,$o-this._tempNumver1,$r,$z,$A,$h,$Z),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$o.box=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$S/2,this._tempNumver1=$G/2,this._tempNumver2=$z/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($J-this._tempNumver0,$o+this._tempNumver1,$r+this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J+this._tempNumver0,$o+this._tempNumver1,$r+this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J-this._tempNumver0,$o-this._tempNumver1,$r+this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J+this._tempNumver0,$o-this._tempNumver1,$r+this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J+this._tempNumver0,$o+this._tempNumver1,$r-this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J-this._tempNumver0,$o+this._tempNumver1,$r-this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J+this._tempNumver0,$o-this._tempNumver1,$r-this._tempNumver2,$A,$h,$Z,$u),this.addVertex($J-this._tempNumver0,$o-this._tempNumver1,$r-this._tempNumver2,$A,$h,$Z,$u),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$o.cone=function($J,$o,$r,$S,$G,$z,$A){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$r+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$r>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$r,this.addVertexIndex(0,$o,0,$S,$G,$z,$A,this._tempUint0),this.addVertexIndex(0,0,0,$S,$G,$z,$A,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$r;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($J*this._tempNumver2,0,$J*this._tempNumver3,$S,$G,$z,$A,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$r-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($J*this._tempNumver2,0,$J*this._tempNumver3,$S,$G,$z,$A,this._tempUint0+(this._tempInt0+$r)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$r-1?this.addIndexes(this._tempUint1+$r+2):this.addIndexes(this._tempUint1+this._tempInt0+$r+1),this.addIndexes(this._tempUint1+this._tempInt0+$r),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$o.boundingBoxLine=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($J,$G,$z,$A,$h,$Z,$u),this.addVertex($S,$G,$z,$A,$h,$Z,$u),this.addVertex($J,$o,$z,$A,$h,$Z,$u),this.addVertex($S,$o,$z,$A,$h,$Z,$u),this.addVertex($S,$G,$r,$A,$h,$Z,$u),this.addVertex($J,$G,$r,$A,$h,$Z,$u),this.addVertex($S,$o,$r,$A,$h,$Z,$u),this.addVertex($J,$o,$r,$A,$h,$Z,$u),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$o.addVertex=function($J,$o,$r,$S,$G,$z,$A){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$J,this._vbData[this._posInVBData+1]=$o,this._vbData[this._posInVBData+2]=$r,this._vbData[this._posInVBData+3]=$S,this._vbData[this._posInVBData+4]=$G,this._vbData[this._posInVBData+5]=$z,this._vbData[this._posInVBData+6]=$A,this._posInVBData+=this._floatSizePerVer,this},$o.addVertexIndex=function($J,$o,$r,$S,$G,$z,$A,$h){return this._hasBegun||this.addVertexIndexException(),this._vbData[$h]=$J,this._vbData[$h+1]=$o,this._vbData[$h+2]=$r,this._vbData[$h+3]=$S,this._vbData[$h+4]=$G,this._vbData[$h+5]=$z,this._vbData[$h+6]=$A,($h+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$h),this},$o.addIndexes=function($J){var $o=arguments;this._hasBegun||this.addVertexIndexException();for(var $r=0;$r<$o.length;$r++)this._ibData[this._posInIBData]=$o[$r],this._posInIBData++;return this},$o.begin=function($J,$o){return this._hasBegun&&this.beginException0(),1!==$J&&4!==$J&&this.beginException1(),this._primitiveType=$J,this._camera=$o,this._hasBegun=!0,this},$o.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$o.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($J._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$g.drawCall++,$R.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$o.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$o.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$o.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$o.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$o.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$o.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(28,[new $AJ(0,"vector3",0),new $AJ(12,"vector4",1)])}]),$J}()),$a=function(){function $J(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$J._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $jo}$Y($J,"laya.d3.core.render.RenderElement");var $o=$J.prototype;return $o.getDynamicBatchBakedVertexs=function($J){for(var $o=this._renderObj._getVertexBuffer($J),$r=$o.getData().slice(),$S=$o.vertexDeclaration,$G=$S.getVertexElementByUsage(0).offset/4,$z=$S.getVertexElementByUsage(3).offset/4,$A=this._sprite3D.transform,$h=$A.worldMatrix,$Z=$A.rotation,$u=$S.vertexStride/4,$B=0,$v=$r.length;$B<$v;$B+=$u){var $j=$B+$G,$Y=$B+$z;$No.transformVector3ArrayToVector3ArrayCoordinate($r,$j,$h,$r,$j),$No.transformVector3ArrayByQuat($r,$Y,$Z,$r,$Y)}return $r},$o.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$o._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$_(0,$o,"id",function(){return this._id}),$_(0,$o,"renderObj",function(){return this._renderObj},function($J){this._renderObj!==$J&&(this._renderObj=$J)}),$J._uniqueIDCounter=0,$J}(),$x=function(){function $o($J){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$o._uniqueIDCounter,this._needSort=!1,this._scene=$J,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$Y($o,"laya.d3.core.render.RenderQueue");var $J=$o.prototype;return $J._sortOpaqueFunc=function($J,$o){if($J._render&&$o._render){var $r=$J._material.renderQueue-$o._material.renderQueue;return 0==$r?$J._render._distanceForSort-$o._render._distanceForSort:$r}return 0},$J._sortAlphaFunc=function($J,$o){if($J._render&&$o._render){var $r=$J._material.renderQueue-$o._material.renderQueue;return 0==$r?$o._render._distanceForSort-$J._render._distanceForSort:$r}return 0},$J._begainRenderElement=function($J,$o,$r){return!!$o._beforeRender($J)},$J._sortAlpha=function($J){$o._cameraPosition=$J,this._finalElements.sort(this._sortAlphaFunc)},$J._sortOpaque=function($J){$o._cameraPosition=$J,this._finalElements.sort(this._sortOpaqueFunc)},$J._preRender=function($J){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$J._render=function($J,$o){for(var $r,$S,$G,$z,$A,$h,$Z=$g.loopCount,$u=this._scene,$B=$J.camera,$v=($B.id,!1),$j=0,$Y=this._finalElements.length;$j<$Y;$j++){var $_,$D,$N,$w=this._finalElements[$j];if(null!=$w._onPreRenderFunction&&$w._onPreRenderFunction.call($w._sprite3D,$J),0===$w._type){if($J.owner=$N=$w._sprite3D,$J.renderElement=$w,$N._preRenderUpdateComponents($J),$_=$w.renderObj,$D=$w._material,this._begainRenderElement($J,$_,$D)){if($r=$_._getVertexBuffers(),!($G=($S=$_._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$S.id]){this._errorRecord[$S.id]=1;var $i="vertexBuffer:"+("("+$S._destroyed+","+$S._released+","+$S._referenceCount+","+$S._buffer+")")+", material:"+($D?$D.__className+"("+$D._destroyed+","+$D._released+")":"null")+", owner:"+($N?$N.__className+"("+$N._destroyed+","+$N._activeInHierarchy+","+$N._displayedInStage+")":"null")+", renderObj:"+($_?$_.__className+"("+$_._destroyed+","+$_._released+","+$_._referenceCount+")":"")+", parent:, url:"+($N?$N.url:"")+", disposeStack:"+$S.disposeStack;$K.recordError("报错：unknown vertexDeclaration  "+$i)}continue}if($v=($z=$J._shader=$D._getShader($u._shaderDefineValue,$G.shaderDefineValue,$N._shaderDefineValue)).bind()||$Z!==$z._uploadLoopCount,$r){if($z._uploadVertexBuffer!==$r||$v){for(var $I=0;$I<$r.length;$I++){var $t=$r[$I];$z.uploadAttributesX($t.vertexDeclaration.shaderValues.data,$t)}$z._uploadVertexBuffer=$r}}else($z._uploadVertexBuffer!==$S||$v)&&($z.uploadAttributes($G.shaderValues.data,null),$z._uploadVertexBuffer=$S);($z._uploadScene!==$u||$v)&&($z.uploadSceneUniforms($u._shaderValues.data),$z._uploadScene=$u),($B!==$z._uploadCamera||$z._uploadSprite3D!==$N||$v)&&($z.uploadSpriteUniforms($N._shaderValues.data),$z._uploadSprite3D=$N),($B!==$z._uploadCamera||$v)&&($z.uploadCameraUniforms($B._shaderValues.data),$z._uploadCamera=$B),($z._uploadMaterial!==$D||$v)&&($D._upload(),$z._uploadMaterial=$D),$A!==$D?($D._setRenderStateBlendDepth(),$D._setRenderStateFrontFace($o,$N.transform),$A=$D,$h=$N):$h!==$N&&($D._setRenderStateFrontFace($o,$N.transform),$h=$N),$_._render($J),$z._uploadLoopCount=$Z}$N._postRenderUpdateComponents($J)}else if(2===$w._type){$w.renderObj;$J.owner=$N=$w._sprite3D,$J.renderElement=$w,$J._batchIndexStart=$w._tempBatchIndexStart,$J._batchIndexEnd=$w._tempBatchIndexEnd,$_=$w.renderObj,$D=$w._material,this._begainRenderElement($J,$_,$D)&&($G=($S=$_._getVertexBuffer(0)).vertexDeclaration,$v=($z=$J._shader=$D._getShader($u._shaderDefineValue,$G.shaderDefineValue,$N._shaderDefineValue)).bind()||$Z!==$z._uploadLoopCount,($z._uploadVertexBuffer!==$S||$v)&&($z.uploadAttributes($G.shaderValues.data,null),$z._uploadVertexBuffer=$S),($z._uploadScene!==$u||$v)&&($z.uploadSceneUniforms($u._shaderValues.data),$z._uploadScene=$u),($B!==$z._uploadCamera||$z._uploadSprite3D!==$N||$v)&&($z.uploadSpriteUniforms($N._shaderValues.data),$z._uploadSprite3D=$N),($B!==$z._uploadCamera||$v)&&($z.uploadCameraUniforms($B._shaderValues.data),$z._uploadCamera=$B),($z._uploadMaterial!==$D||$v)&&($D._upload(),$z._uploadMaterial=$D),$A!==$D?($D._setRenderStateBlendDepth(),$D._setRenderStateFrontFace($o,$N.transform),$A=$D,$h=$N):$h!==$N&&($D._setRenderStateFrontFace($o,$N.transform),$h=$N),$_._render($J),$z._uploadLoopCount=$Z)}}},$J._renderShadow=function($J,$o){for(var $r,$S,$G,$z,$A,$h=$g.loopCount,$Z=this._scene,$u=$J.camera,$B=!1,$v=0,$j=this._finalElements.length;$v<$j;$v++){var $Y,$_,$D,$N=this._finalElements[$v];0===$N._type&&($J.owner=$D=$N._sprite3D,$o||$D._projectionViewWorldUpdateCamera===$u&&$D._projectionViewWorldUpdateLoopCount===$g.loopCount||($D._render._renderUpdate($J._projectionViewMatrix),$D._projectionViewWorldUpdateLoopCount=$g.loopCount,$D._projectionViewWorldUpdateCamera=$u),$J.renderElement=$N,$D._preRenderUpdateComponents($J),$Y=$N.renderObj,$_=$N._material,this._begainRenderElement($J,$Y,null)&&($S=($r=$Y._getVertexBuffer(0)).vertexDeclaration,$B=($G=$J._shader=$_._getShader($Z._shaderDefineValue,$S.shaderDefineValue,$D._shaderDefineValue)).bind()||$h!==$G._uploadLoopCount,($G._uploadVertexBuffer!==$r||$B)&&($G.uploadAttributes($S.shaderValues.data,null),$G._uploadVertexBuffer=$r),($u!==$G._uploadCamera||$G._uploadSprite3D!==$D||$B)&&($G.uploadSpriteUniforms($D._shaderValues.data),$G._uploadSprite3D=$D),($u!==$G._uploadCamera||$B)&&($G.uploadCameraUniforms($u._shaderValues.data),$G._uploadCamera=$u),($G._uploadMaterial!==$_||$B)&&($_._upload(),$G._uploadMaterial=$_),$G._uploadRenderElement,$z!==$_?($_._setRenderStateFrontFace(!1,$D.transform),$z=$_,$A=$D):$A!==$D&&($_._setRenderStateFrontFace(!1,$D.transform),$A=$D),$Y._render($J),$G._uploadLoopCount=$h),$D._postRenderUpdateComponents($J))}},$J._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$J._addRenderElement=function($J){this._renderElements.push($J),this._needSort=!0},$J._addDynamicBatchElement=function($J){this._dynamicBatchCombineRenderElements.push($J)},$_(0,$J,"id",function(){return this._id}),$o._uniqueIDCounter=0,$o._cameraPosition=null,$o}(),$M=function(){function $J(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $Y($J,"laya.d3.core.render.RenderState"),$J.clientWidth=0,$J.clientHeight=0,$J}(),$O=function(){function $A($J,$o){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $WJ(new $Ao,0),this._corners=[new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao],this._boundingBoxCenter=new $Ao,this._children=$S(8),this._objects=[],this._tempBoundBoxCorners=[new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao],this._scene=$J,this._currentDepth=$o}$Y($A,"laya.d3.core.scene.OctreeNode");var $J=$A.prototype;return $K.imps($J,{"laya.d3.core.scene.ITreeNode":!0}),$J.init=function($J,$o){var $r=new $Ao,$S=new $Ao;$Ao.scale($o,-.5,$r),$Ao.scale($o,.5,$S),$Ao.add($r,$J,$r),$Ao.add($S,$J,$S),this.exactBox=new $OJ($r,$S),this.relaxBox=new $OJ($r,$S)},$J.addTreeNode=function($J){1===Collision.boxContainsBox(this._relaxBox,$J.boundingBox)?this.addNodeDown($J,0):this.addObject($J)},$J.addChild=function($J){var $o=this._children[$J];if(null==$o){$o=new $A(this._scene,this._currentDepth+1),(this._children[$J]=$o)._parent=this,$Ao.subtract(this._exactBox.max,this._exactBox.min,$A.tempSize),$Ao.multiply($A.tempSize,$A._octreeSplit[$J],$A.tempCenter),$Ao.add(this._exactBox.min,$A.tempCenter,$A.tempCenter),$Ao.scale($A.tempSize,.25,$A.tempSize);var $r=new $Ao,$S=new $Ao;$Ao.subtract($A.tempCenter,$A.tempSize,$r),$Ao.add($A.tempCenter,$A.tempSize,$S),$o.exactBox=new $OJ($r,$S),$Ao.scale($A.tempSize,$A.relax,$A.tempSize);var $G=new $Ao,$z=new $Ao;$Ao.subtract($A.tempCenter,$A.tempSize,$G),$Ao.add($A.tempCenter,$A.tempSize,$z),$o.relaxBox=new $OJ($G,$z)}return $o},$J.addObject=function($J){($J._treeNode=this)._objects.push($J)},$J.removeObject=function($J){if($J._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $o=this._objects.indexOf($J);return-1!==$o&&(this._objects.splice($o,1),!0)},$J.clearObject=function(){this._objects.length=0},$J.addNodeUp=function($J,$o){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$J.boundingBox)?this._parent.addNodeUp($J,$o-1):this.addNodeDown($J,$o)},$J.addNodeDown=function($J,$o){if($o<this._scene.treeLevel){var $r=this.inChildIndex($J.boundingBoxCenter),$S=this.addChild($r);1===Collision.boxContainsBox($S._relaxBox,$J.boundingBox)?$S.addNodeDown($J,++$o):this.addObject($J)}else this.addObject($J)},$J.inChildIndex=function($J){return 4*($J.z<this._boundingBoxCenter.z?0:1)+2*($J.y<this._boundingBoxCenter.y?0:1)+($J.x<this._boundingBoxCenter.x?0:1)},$J.updateObject=function($J){1===Collision.boxContainsBox(this._relaxBox,$J.boundingBox)?(this.removeObject($J),$J._treeNode=null,this.addNodeDown($J,this._currentDepth)):this._parent&&(this.removeObject($J),$J._treeNode=null,this._parent.addNodeUp($J,this._currentDepth-1))},$J.cullingObjects=function($J,$o,$r,$S,$G){var $z,$A=0,$h=0,$Z=0,$u=this._scene._dynamicBatchManager;for($A=0,$z=this._objects.length;$A<$z;$A++){var $B=this._objects[$A];if($U.isVisible($B._owner.layer.mask)&&$B.enable){if($o&&($g.treeSpriteCollision+=1,0===$J.containsBoundSphere($B.boundingSphere)))continue;$B._renderUpdate($G),$B._distanceForSort=$Ao.distance($B.boundingSphere.center,$S)+$B.sortingFudge;var $v=$B._renderElements;for($h=0,$Z=$v.length;$h<$Z;$h++){var $j=$v[$h],$Y=$j._staticBatch;if($Y&&$Y._material===$j._material)$Y._addBatchRenderElement($j);else{var $_=$j.renderObj;$_.triangleCount<10&&1===$_._vertexBufferCount&&$_._getIndexBuffer()&&$j._material.renderQueue<2&&$j._canDynamicBatch&&!$B._owner.isStatic?$u._addPrepareRenderElement($j):this._scene.getRenderQueue($j._material.renderQueue)._addRenderElement($j)}}}}for($A=0;$A<8;$A++){var $D=this._children[$A];if(null!=$D){var $N=$o;if($o){var $w=$J.containsBoundBox($D._relaxBox);if($g.treeNodeCollision+=1,0===$w)continue;$N=2===$w}$D.cullingObjects($J,$N,$r,$S,$G)}}},$J.cullingShadowObjects=function($J,$o,$r,$S,$G){var $z,$A=0,$h=0,$Z=0;this._scene._dynamicBatchManager;for($A=0,$z=this._objects.length;$A<$z;$A++){var $u=this._objects[$A];if($u.castShadow&&$U.isVisible($u._owner.layer.mask)&&$u.enable){if($r&&0===$J[0].containsBoundSphere($u.boundingSphere))continue;for(var $B=1,$v=$J.length;$B<$v;$B++){var $j=$o[$B-1];if(0!==$J[$B].containsBoundSphere($u.boundingSphere)){var $Y=$u._renderElements;for($h=0,$Z=$Y.length;$h<$Z;$h++)$j._addRenderElement($Y[$h])}}}}for($A=0;$A<8;$A++){var $_=this._children[$A];if(null!=$_){var $D=$r;if($r){var $N=$J[0].containsBoundBox($_._relaxBox);if(0===$N)continue;$D=2===$N}$_.cullingShadowObjects($J,$o,$D,$S,$G)}}},$J.cullingShadowObjectsOnePSSM=function($J,$o,$r,$S,$G,$z){var $A,$h=$o[0],$Z=0,$u=0,$B=0;for($Z=0,$A=this._objects.length;$Z<$A;$Z++){var $v=this._objects[$Z];if($v.castShadow&&$U.isVisible($v._owner.layer.mask)&&$v.enable){if($S&&0===$J.containsBoundSphere($v.boundingSphere))continue;$v._renderUpdate($r);var $j=$v._renderElements;for($u=0,$B=$j.length;$u<$B;$u++)$h._addRenderElement($j[$u])}}for($Z=0;$Z<8;$Z++){var $Y=this._children[$Z];if(null!=$Y){var $_=$S;if($S){var $D=$J.containsBoundBox($Y._relaxBox);if(0===$D)continue;$_=2===$D}$Y.cullingShadowObjectsOnePSSM($J,$o,$r,$_,$G,$z)}}},$J.renderBoudingBox=function($J){this._renderBoudingBox($J);for(var $o=0;$o<8;++$o){var $r=this._children[$o];$r&&$r.renderBoudingBox($J)}},$J.buildAllChild=function($J){if($J<this._scene.treeLevel)for(var $o=0;$o<8;$o++){this.addChild($o).buildAllChild($J+1)}},$J._renderBoudingBox=function($J){},$_(0,$J,"exactBox",function(){return this._exactBox},function($J){this._exactBox=$J,$Ao.add($J.min,$J.max,this._boundingBoxCenter),$Ao.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$_(0,$J,"relaxBox",function(){return this._relaxBox},function($J){(this._relaxBox=$J).getCorners(this._corners),$WJ.createfromPoints(this._corners,this._boundingSphere)}),$A.debugMode=!1,$A.relax=1.15,$A.CHILDNUM=8,$v($A,["tempVector0",function(){return this.tempVector0=new $Ao},"tempSize",function(){return this.tempSize=new $Ao},"tempCenter",function(){return this.tempCenter=new $Ao},"_octreeSplit",function(){return this._octreeSplit=[new $Ao(.25,.25,.25),new $Ao(.75,.25,.25),new $Ao(.25,.75,.25),new $Ao(.75,.75,.25),new $Ao(.25,.25,.75),new $Ao(.75,.25,.75),new $Ao(.25,.75,.75),new $Ao(.75,.75,.75)]}]),$A}(),$P=(function(){function $J(){}$Y($J,"laya.d3.core.scene.SceneManager")}(),function(){function $J($J,$o,$r,$S){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$J&&($J=1),void 0===$o&&($o=1),void 0===$r&&($r=1),void 0===$S&&($S=1),this._r=$J,this._g=$o,this._b=$r,this._a=$S}return $Y($J,"laya.d3.core.trail.module.Color",null,"Color$1"),$J.prototype.cloneTo=function($J){$J._r=this._r,$J._g=this._g,$J._b=this._b,$J._a=this._a},$v($J,["RED",function(){return this.RED=new $J(1,0,0,1)},"GREEN",function(){return this.GREEN=new $J(0,1,0,1)},"BLUE",function(){return this.BLUE=new $J(0,0,1,1)},"CYAN",function(){return this.CYAN=new $J(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $J(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $J(1,0,1,1)},"GRAY",function(){return this.GRAY=new $J(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $J(1,1,1,1)},"BLACK",function(){return this.BLACK=new $J(0,0,0,1)}]),$J}()),$W=(function(){function $J(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$Y($J,"laya.d3.core.trail.module.Gradient");var $o=$J.prototype;$o.setKeys=function($J,$o){var $r,$S;this._colorKeys=$J;for(var $G=this.index=0;$G<$J.length;$G++){var $z=($r=$J[$G]).color;this._colorKeyData[this.index++]=$z._r,this._colorKeyData[this.index++]=$z._g,this._colorKeyData[this.index++]=$z._b,this._colorKeyData[this.index++]=$r.time}this._alphaKeys=$o;for(var $A=this.index=0;$A<$o.length;$A++)$S=$o[$A],this._alphaKeyData[this.index++]=$S.alpha,this._alphaKeyData[this.index++]=$S.time},$o.cloneTo=function($J){var $o=0,$r=0,$S=this.colorKeys,$G=[];for($o=0,$r=$S.length;$o<$r;$o++){var $z=new $E;$S[$o].cloneTo($z),$G.push($z)}var $A=this.alphaKeys,$h=[];for($o=0,$r=$A.length;$o<$r;$o++){var $Z=new $W;$A[$o].cloneTo($Z),$h.push($Z)}$J.setKeys($G,$h)},$_(0,$o,"mode",function(){return this._mode},function($J){this._mode=$J}),$_(0,$o,"colorKeys",function(){return this._colorKeys},function($J){this._colorKeys=$J;for(var $o=this.index=0;$o<$J.length;$o++){var $r=$J[$o],$S=$r.color;this._colorKeyData[this.index++]=$S._r,this._colorKeyData[this.index++]=$S._g,this._colorKeyData[this.index++]=$S._b,this._colorKeyData[this.index++]=$r.time}}),$_(0,$o,"alphaKeys",function(){return this._alphaKeys},function($J){this._alphaKeys=$J;for(var $o=this.index=0;$o<$J.length;$o++){var $r=$J[$o];this._alphaKeyData[this.index++]=$r.alpha,this._alphaKeyData[this.index++]=$r.time}})}(),function(){function $J($J,$o){this._alpha=NaN,this._time=NaN,void 0===$J&&($J=0),void 0===$o&&($o=0),this._alpha=$J,this._time=$o}$Y($J,"laya.d3.core.trail.module.GradientAlphaKey");var $o=$J.prototype;return $o.cloneTo=function($J){$J.alpha=this.alpha,$J.time=this.time},$_(0,$o,"alpha",function(){return this._alpha},function($J){this._alpha=$J}),$_(0,$o,"time",function(){return this._time},function($J){this._time=$J}),$J}()),$E=function(){function $J($J,$o){this._color=null,this._time=NaN,void 0===$o&&($o=0),this._color=$J||new $P,this._time=$o}$Y($J,"laya.d3.core.trail.module.GradientColorKey");var $o=$J.prototype;return $o.cloneTo=function($J){this.color.cloneTo($J.color),$J.time=this.time},$_(0,$o,"color",function(){return this._color},function($J){this._color=$J}),$_(0,$o,"time",function(){return this._time},function($J){this._time=$J}),$J}(),$X=(function(){function $J(){}$Y($J,"laya.d3.core.trail.module.GradientMode"),$J.Blend=0,$J.Fixed=1}(),function(){function $J(){}$Y($J,"laya.d3.core.trail.module.TextureMode"),$J.Stretch=0,$J.Tile=1}(),function(){function $J(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$Y($J,"laya.d3.core.trail.module.TrailKeyFrame"),$J.prototype.cloneTo=function($J){$J.time=this.time,$J.inTangent=this.inTangent,$J.outTangent=this.outTangent,$J.value=this.value}}(),function(){function $o($J){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $Ao,this._curPosition=new $Ao,this._delVector3=new $Ao,this._lastFixedVertexPosition=new $Ao,this._pointAtoBVector3=new $Ao,this._pointA=new $Ao,this._pointB=new $Ao,this._owner=$J,this._id=$o.renderElementCount++,0==this._id?$J._owner.transform.position.cloneTo(this._lastPosition):$J._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $do($X.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $do($X.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$Y($o,"laya.d3.core.trail.TrailRenderElement");var $J=$o.prototype;$K.imps($J,{"laya.d3.core.render.IRenderable":!0}),$J._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$J._addTrailByFirstPosition=function($J,$o){$Ao.subtract($o,$J,this._delVector3),$Ao.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$Ao.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$Ao.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($J),$J.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$J._addTrailByNextPosition=function($J){$Ao.subtract($J,this._lastFixedVertexPosition,this._delVector3),$Ao.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$Ao.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$Ao.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$Ao.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$EJ.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($J),$J.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($J),this._virtualVerticesCount=2)},$J._updateVerticesByPosition=function($J){this._pointe=$J.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$J._updateVertexBuffer2=function(){var $J,$o=0,$r=0,$S=0;for($S=0,$J=(this._verticesCount+this._virtualVerticesCount)/2;$S<$J;$S++)$r=0==this._owner.textureMode?(this._VerticesToTailLength[$S]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$S],this._vertices2[$o++]=1-$r,this._vertices2[$o++]=1-$r;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$J._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$J._updateDisappear=function(){var $J,$o=0;for($o=this._curDisappearIndex,$J=(this._verticesCount+this._virtualVerticesCount)/2;$o<$J;$o++)this._owner._curtime-this._everyGroupVertexBirthTime[$o]>=this._owner.time+$EJ.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$J._beforeRender=function($J){return this._camera=$J.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$Ao.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$J._render=function($J){this._isDead||($R.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$g.drawCall++,$g.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$J._getVertexBuffer=function($J){return void 0===$J&&($J=0),0===$J?this._vertexBuffer1:1===$J?this._vertexBuffer2:null},$J._getVertexBuffers=function(){return this._vertexBuffers},$J._getIndexBuffer=function(){return null},$J.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$J._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$_(0,$J,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$_(0,$J,"triangleCount",function(){return 0}),$o.renderElementCount=0}(),function(){function $J(){}$Y($J,"laya.d3.core.trail.VertexTrail");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration1}),$_(1,$J,"vertexDeclaration1",function(){return $J._vertexDeclaration1}),$_(1,$J,"vertexDeclaration2",function(){return $J._vertexDeclaration2}),$v($J,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $zJ(32,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",41),new $AJ(24,"single",33),new $AJ(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $zJ(4,[new $AJ(0,"single",38)])}]),$J}()),$JJ=function(){function $t($J){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$J}$Y($t,"laya.d3.graphics.DynamicBatch");var $J=$t.prototype;return $K.imps($J,{"laya.d3.core.render.IRenderable":!0}),$J._getVertexBuffer=function($J){return void 0===$J&&($J=0),0===$J?this._vertexBuffer:null},$J._getIndexBuffer=function(){return this._indexBuffer},$J._getCombineRenderElementFromPool=function($J,$o,$r){var $S=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $S||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$S=new $a,$S._sprite3D=new $xo),$S._sprite3D._render._renderUpdate($r),$S},$J._getRenderElement=function($J,$o,$r){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$t.maxVertexCount),this._indexDatas=new Uint16Array($t.maxIndexCount),this._vertexBuffer=$do.create(this._vertexDeclaration,$t.maxVertexCount,35048),this._indexBuffer=$Fo.create("ushort",$t.maxIndexCount,35048));for(var $S=this._merageElements.length=0,$G=0,$z=0,$A=this._combineRenderElements.length;$z<$A;$z++){var $h=this._combineRenderElements[$z],$Z=$h.getDynamicBatchBakedVertexs(0),$u=$h.getBakedIndices(),$B=$h._sprite3D.transform._isFrontFaceInvert,$v=$S/(this._vertexDeclaration.vertexStride/4),$j=$G,$Y=$j+$u.length;$h._tempBatchIndexStart=$j,$h._tempBatchIndexEnd=$Y,this._indexDatas.set($u,$G);var $_=0;if($B)for($_=$j;$_<$Y;$_+=3){this._indexDatas[$_]=$v+this._indexDatas[$_];var $D=this._indexDatas[$_+1],$N=this._indexDatas[$_+2];this._indexDatas[$_+1]=$v+$N,this._indexDatas[$_+2]=$v+$D}else for($_=$j;$_<$Y;$_+=3)this._indexDatas[$_]=$v+this._indexDatas[$_],this._indexDatas[$_+1]=$v+this._indexDatas[$_+1],this._indexDatas[$_+2]=$v+this._indexDatas[$_+2];$G+=$u.length,this._vertexDatas.set($Z,$S),$S+=$Z.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$z=this._combineRenderElementPoolIndex=0,$A=this._materials.length;$z<$A;$z++){var $w=this._getCombineRenderElementFromPool($J,$o,$r);$w._type=2,$w._staticBatch=null;var $i=($w.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$z]]._tempBatchIndexStart,$I=$z+1===this._materialToRenderElementsOffsets.length?$G:this._combineRenderElements[this._materialToRenderElementsOffsets[$z+1]]._tempBatchIndexStart;$w._tempBatchIndexStart=$i,$w._tempBatchIndexEnd=$I,$w._material=this._materials[$z],this._merageElements.push($w)}},$J._addCombineRenderObjTest=function($J){var $o=$J.renderObj,$r=this._currentCombineIndexCount+$o._getIndexBuffer().indexCount,$S=this._currentCombineVertexCount+$o._getVertexBuffer().vertexCount;return!($t.maxVertexCount<$S||$t.maxIndexCount<$r)},$J._addCombineRenderObj=function($J){var $o=$J.renderObj;this._combineRenderElements.push($J),this._currentCombineIndexCount=this._currentCombineIndexCount+$o._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$o._getVertexBuffer().vertexCount},$J._addCombineMaterial=function($J){this._materials.push($J)},$J._addMaterialToRenderElementOffset=function($J){this._materialToRenderElementsOffsets.push($J)},$J._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$J._addToRenderQueue=function($J,$o,$r,$S){this._getRenderElement($o,$r,$S);for(var $G=0,$z=this._materials.length;$G<$z;$G++)$J.getRenderQueue(this._materials[$G].renderQueue)._addDynamicBatchElement(this._merageElements[$G])},$J._beforeRender=function($J){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$J._render=function($J){var $o=$J._batchIndexEnd-$J._batchIndexStart;$R.mainContext.drawElements(4,$o,5123,2*$J._batchIndexStart),$g.drawCall++,$g.trianglesFaces+=$o/3},$J._getVertexBuffers=function(){return null},$_(0,$J,"_vertexBufferCount",function(){return 1}),$_(0,$J,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$_(0,$J,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$t.maxVertexCount=2e4,$t.maxIndexCount=4e4,$t.maxCombineTriangleCount=10,$t}(),$oJ=function(){function $t(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$Y($t,"laya.d3.graphics.DynamicBatchManager");var $J=$t.prototype;return $J.getDynamicBatch=function($J,$o){var $r,$S=$J.id.toString()+$o;return this._dynamicBatches[$S]?$r=this._dynamicBatches[$S]:this._dynamicBatches[$S]=$r=new $JJ($J),$r},$J._garbageCollection=function(){for(var $J in this._dynamicBatches)0===this._dynamicBatches[$J].combineRenderElementsCount&&delete this._dynamicBatches[$J]},$J._addPrepareRenderElement=function($J){this._prepareDynamicBatchCombineElements.push($J)},$J._finishCombineDynamicBatch=function($J){var $o,$r,$S;this._prepareDynamicBatchCombineElements.sort($t._sortPrepareDynamicBatch);for(var $G,$z,$A,$h,$Z,$u=-1,$B=!0,$v=0,$j=-1,$Y=0,$_=this._prepareDynamicBatchCombineElements.length;$Y<$_;$Y++){var $D=($z=this._prepareDynamicBatchCombineElements[$Y]).renderObj._getVertexBuffer(0).vertexDeclaration,$N=$r!==$D;$N&&($v=0,$r=$D);var $w=$v!==$u;if($w&&($u=$v),($N||$w)&&($A=this.getDynamicBatch($D,$v),$o=null),$B)if($A._addCombineRenderObjTest($z)){if($o!==($G=$z._material))$h&&($J.getRenderQueue($Z._material.renderQueue)._addRenderElement($Z),$Z=$h=null,$j=-1),$h=$G,$j=$A.combineRenderElementsCount,$Z=$z,$o=$G;else if($h){var $i=$Z.renderObj,$I=$z.renderObj;$i._getVertexBuffer().vertexCount+$I._getVertexBuffer().vertexCount>$JJ.maxVertexCount||$i._getIndexBuffer().indexCount+$I._getIndexBuffer().indexCount>$JJ.maxIndexCount?($J.getRenderQueue($Z._material.renderQueue)._addRenderElement($Z),$h=$G,$j=$A.combineRenderElementsCount,$Z=$z):($A._addCombineMaterial($h),$A._addMaterialToRenderElementOffset($j),$A._addCombineRenderObj($Z),$Z=$h=null,$j=-1,$A._addCombineRenderObj($z))}else $A._addCombineRenderObj($z);$B=!0}else $h&&($J.getRenderQueue($Z._material.renderQueue)._addRenderElement($Z),$Z=$h=null,$j=-1),$v++,$B=!1;else $S=this._prepareDynamicBatchCombineElements[$Y-1],$A._addMaterialToRenderElementOffset($A.combineRenderElementsCount),$o=$S._material,$A._addCombineMaterial($o),$A._addCombineRenderObj($S),$B=!0,$o!==($G=$z._material)?($h=$G,$j=$A.combineRenderElementsCount,$Z=$z):$A._addCombineRenderObj($z),$o=$G}$h&&($J.getRenderQueue($Z._material.renderQueue)._addRenderElement($Z),$Z=$h=null,$j=-1),this._prepareDynamicBatchCombineElements.length=0},$J._clearRenderElements=function(){for(var $J in this._dynamicBatches)this._dynamicBatches[$J]._clearRenderElements()},$J._addToRenderQueue=function($J,$o,$r,$S){for(var $G in this._dynamicBatches){var $z=this._dynamicBatches[$G];0<$z.combineRenderElementsCount&&$z._addToRenderQueue($J,$o,$r,$S)}},$J.dispose=function(){this._dynamicBatches=null},$t._sortPrepareDynamicBatch=function($J,$o){return $J._mainSortID-$o._mainSortID},$t}(),$rJ=function(){function $J(){}return $Y($J,"laya.d3.graphics.FrustumCulling"),$J.renderShadowObjectCulling=function($J,$o,$r,$S,$G){var $z=0,$A=0,$h=0,$Z=0;for($z=0,$h=$r.length;$z<$h;$z++){var $u=$r[$z];$u&&$u._clearRenderElements()}var $B,$v,$j,$Y=$J._cullingRenders;if(1<$G){for($z=0,$h=$J._cullingRendersLength;$z<$h;$z++)if(($B=$Y[$z]).castShadow&&$U.isVisible($B._owner.layer.mask)&&$B.enable)for(var $_=1,$D=$o.length;$_<$D;$_++)if($v=$r[$_-1],0!==$o[$_].containsBoundSphere($B.boundingSphere))for($A=0,$Z=($j=$B._renderElements).length;$A<$Z;$A++)$v._addRenderElement($j[$A])}else for($z=0,$h=$J._cullingRendersLength;$z<$h;$z++)if(($B=$Y[$z]).castShadow&&$U.isVisible($B._owner.layer.mask)&&$B.enable&&0!==$o[0].containsBoundSphere($B.boundingSphere))for($B._renderUpdate($S),$v=$r[0],$A=0,$Z=($j=$B._renderElements).length;$A<$Z;$A++)$v._addRenderElement($j[$A])},$J.renderShadowObjectCullingOctree=function($J,$o,$r,$S,$G){for(var $z=0,$A=$r.length;$z<$A;$z++){var $h=$r[$z];$h&&$h._clearRenderElements()}1<$G?$J.treeRoot.cullingShadowObjects($o,$r,!0,0,$J):$J.treeRoot.cullingShadowObjectsOnePSSM($o[0],$r,$S,!0,0,$J)},$J.renderObjectCulling=function($J,$o,$r,$S,$G,$z){var $A=0,$h=0,$Z=0,$u=0,$B=$o._quenes,$v=$o._dynamicBatchManager,$j=$o._cullingRenders;for($A=0,$h=$B.length;$A<$h;$A++){var $Y=$B[$A];$Y&&$Y._clearRenderElements()}var $_=$SJ._staticBatchManagers;for($A=0,$h=$_.length;$A<$h;$A++)$_[$A]._clearRenderElements();$v._clearRenderElements();var $D=$r.transform.position;for($A=0,$h=$o._cullingRendersLength;$A<$h;$A++){var $N=$j[$A];if($U.isVisible($N._owner.layer.mask)&&$N.enable&&0!==$J.containsBoundSphere($N.boundingSphere)&&$N._renderUpdate($z)){$N._distanceForSort=$Ao.distance($N.boundingSphere.center,$D)+$N.sortingFudge;var $w=$N._renderElements;for($Z=0,$u=$w.length;$Z<$u;$Z++){var $i=$w[$Z],$I=$i._staticBatch;if($I&&$I._material===$i._material)$I._addBatchRenderElement($i);else{var $t=$i.renderObj;$t.triangleCount<10&&1===$t._vertexBufferCount&&$t._getIndexBuffer()&&$i._material.renderQueue<2&&$i._canDynamicBatch&&!$N._owner.isStatic?$v._addPrepareRenderElement($i):$o.getRenderQueue($i._material.renderQueue)._addRenderElement($i)}}}}for($A=0,$h=$_.length;$A<$h;$A++)$_[$A]._addToRenderQueue($o,$S,$G,$z);$v._finishCombineDynamicBatch($o),$v._addToRenderQueue($o,$S,$G,$z)},$J.renderObjectCullingOctree=function($J,$o,$r,$S,$G,$z){var $A=0,$h=0,$Z=$o._quenes,$u=$o._dynamicBatchManager;for($A=0,$h=$Z.length;$A<$h;$A++){var $B=$Z[$A];$B&&$B._clearRenderElements()}var $v=$SJ._staticBatchManagers;for($A=0,$h=$v.length;$A<$h;$A++)$v[$A]._clearRenderElements();for($u._clearRenderElements(),$o._cullingRenders.length=0,$o.treeRoot.cullingObjects($J,!0,0,$r.transform.position,$z),$A=0,$h=$v.length;$A<$h;$A++)$v[$A]._addToRenderQueue($o,$S,$G,$z);$u._finishCombineDynamicBatch($o),$u._addToRenderQueue($o,$S,$G,$z)},$J.renderObjectCullingNoBoundFrustum=function($J,$o,$r,$S,$G){var $z=0,$A=0,$h=0,$Z=0,$u=$J._quenes,$B=$J._dynamicBatchManager,$v=$J._cullingRenders;for($z=0,$A=$u.length;$z<$A;$z++){var $j=$u[$z];$j&&$j._clearRenderElements()}var $Y=$SJ._staticBatchManagers;for($z=0,$A=$Y.length;$z<$A;$z++)$Y[$z]._clearRenderElements();$B._clearRenderElements();var $_=$o.transform.position;for($z=0,$A=$J._cullingRendersLength;$z<$A;$z++){var $D=$v[$z];if($U.isVisible($D._owner.layer.mask)&&$D.enable){$D._renderUpdate($G),$D._distanceForSort=$Ao.distance($D.boundingSphere.center,$_)+$D.sortingFudge;var $N=$D._renderElements;for($h=0,$Z=$N.length;$h<$Z;$h++){var $w=$N[$h],$i=$w._staticBatch;if($i&&$i._material===$w._material)$i._addBatchRenderElement($w);else{var $I=$w.renderObj;$I.triangleCount<10&&1===$I._vertexBufferCount&&$I._getIndexBuffer()&&$w._material.renderQueue<2&&$w._canDynamicBatch&&!$D._owner.isStatic?$B._addPrepareRenderElement($w):$J.getRenderQueue($w._material.renderQueue)._addRenderElement($w)}}}}for($z=0,$A=$Y.length;$z<$A;$z++)$Y[$z]._addToRenderQueue($J,$r,$S,$G);$B._finishCombineDynamicBatch($J),$B._addToRenderQueue($J,$r,$S,$G)},$J}(),$SJ=function(){function $z(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$Y($z,"laya.d3.graphics.StaticBatchManager");var $J=$z.prototype;return $J._finishInit=function(){for(var $J in this._staticBatches)this._staticBatches[$J]._finishInit();this._initBatchRenderElements.length=0},$J._initStaticBatchs=function($J){throw new Error("StaticBatchManager:must override this function.")},$J._addInitBatchSprite=function($J){for(var $o=$J._render._renderElements,$r=0,$S=$o.length;$r<$S;$r++)this._initBatchRenderElements.push($o[$r])},$J._clearRenderElements=function(){for(var $J in this._staticBatches)this._staticBatches[$J]._clearRenderElements()},$J._garbageCollection=function($J){var $o=$J._staticBatch,$r=$o._initBatchRenderElements,$S=$r.indexOf($J);$r.splice($S,1),0===$r.length&&($o.dispose(),delete this._staticBatches[$o._key])},$J._addToRenderQueue=function($J,$o,$r,$S){for(var $G in this._staticBatches){var $z=this._staticBatches[$G];0<$z._batchRenderElements.length&&$z._updateToRenderQueue($J,$S)}},$J.dispose=function(){this._staticBatches=null},$z._addToStaticBatchQueue=function($J){$J instanceof laya.d3.core.RenderableSprite3D&&$J._addToInitStaticBatchManager();for(var $o=0,$r=$J.numChildren;$o<$r;$o++)$z._addToStaticBatchQueue($J._childs[$o])},$z.combine=function($J,$o){var $r,$S=0,$G=0;if($o)for($S=0,$G=$o.length;$S<$G;$S++){$o[$S]._addToInitStaticBatchManager()}else $J&&$z._addToStaticBatchQueue($J);for($S=0,$G=$z._staticBatchManagers.length;$S<$G;$S++)($r=$z._staticBatchManagers[$S])._initStaticBatchs($J),$r._finishInit()},$z._staticBatchManagers=[],$z}(),$GJ=function(){function $J($J,$o,$r){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$J,this._manager=$o,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$r}$Y($J,"laya.d3.graphics.StaticBatch");var $o=$J.prototype;return $K.imps($o,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$o._binarySearch=function($J){for(var $o=0,$r=this._batchRenderElements.length-1,$S=0;$o<=$r;)$S=Math.floor(($o+$r)/2),this._compareBatchRenderElement(this._batchRenderElements[$S],$J)?$r=$S-1:$o=$S+1;return $o},$o._compareBatchRenderElement=function($J,$o){throw new Error("StaticBatch:must override this function.")},$o._getVertexDecLightMap=function($J){return $J===$FJ.vertexDeclaration?$UJ.vertexDeclaration:$J===$fJ.vertexDeclaration?$kJ.vertexDeclaration:$J===$sJ.vertexDeclaration?$tJ.vertexDeclaration:$J===$TJ.vertexDeclaration?null:$J===$DJ.vertexDeclaration?$NJ.vertexDeclaration:$J===$lJ.vertexDeclaration?$QJ.vertexDeclaration:$J===$RJ.vertexDeclaration?$nJ.vertexDeclaration:$J===$dJ.vertexDeclaration?$LJ.vertexDeclaration:$J===$fJ.vertexDeclaration?$kJ.vertexDeclaration:$J===$VJ.vertexDeclaration?$KJ.vertexDeclaration:$J===$TJ.vertexDeclaration?null:$J===$DJ.vertexDeclaration?$NJ.vertexDeclaration:$J===$cJ.vertexDeclaration?$pJ.vertexDeclaration:$J===$RJ.vertexDeclaration?$nJ.vertexDeclaration:$J},$o._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$o._addBatchRenderElement=function($J){this._batchRenderElements.splice(this._binarySearch($J),0,$J)},$o._updateToRenderQueue=function($J,$o){this._combineRenderElementPoolIndex=0,this._getRenderElement($J.getRenderQueue(this._material.renderQueue)._renderElements,$J,$o)},$o._getRenderElement=function($J,$o,$r){throw new Error("StaticBatch:must override this function.")},$o._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$o._clearRenderElements=function(){this._batchRenderElements.length=0},$o.dispose=function(){},$o._getVertexBuffer=function($J){return void 0===$J&&($J=0),null},$o._getIndexBuffer=function(){return null},$o._beforeRender=function($J){return!0},$o._render=function($J){},$o._getVertexBuffers=function(){return null},$_(0,$o,"_vertexBufferCount",function(){return 1}),$_(0,$o,"triangleCount",function(){return 0}),$J.combine=function($J){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$SJ.combine($J)},$J.maxBatchVertexCount=65535,$J}(),$zJ=function(){function $A($J,$o){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$A._uniqueIDCounter,this._id>$A.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$A.maxVertexDeclaration);this._shaderValues=new $jo,this._vertexElementsDic={},this._vertexStride=$J,this._vertexElements=$o;for(var $r=0;$r<$o.length;$r++){var $S=$o[$r],$G=$S.elementUsage;this._vertexElementsDic[$G]=$S;var $z=[$A._getTypeSize($S.elementFormat)/4,5126,!1,this._vertexStride,$S.offset];switch(this._shaderValues.setValue($G,$z),$G){case 1:this._addShaderDefine($go.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($go.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($go.SHADERDEFINE_UV1)}}}$Y($A,"laya.d3.graphics.VertexDeclaration");var $J=$A.prototype;return $J._addShaderDefine=function($J){this._shaderDefineValue|=$J},$J._removeShaderDefine=function($J){this._shaderDefineValue&=~$J},$J.getVertexElements=function(){return this._vertexElements.slice()},$J.getVertexElementByUsage=function($J){return this._vertexElementsDic[$J]},$J.unBinding=function(){},$_(0,$J,"shaderDefineValue",function(){return this._shaderDefineValue}),$_(0,$J,"id",function(){return this._id}),$_(0,$J,"vertexStride",function(){return this._vertexStride}),$_(0,$J,"shaderValues",function(){return this._shaderValues}),$A._getTypeSize=function($J){switch($J){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$A.getVertexStride=function($J){for(var $o=0,$r=0;$r<$J.Length;$r++){var $S=$J[$r],$G=$S.offset+$A._getTypeSize($S.elementFormat);$o<$G&&($o=$G)}return $o},$A._maxVertexDeclarationBit=1e3,$A._uniqueIDCounter=1,$v($A,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$A}(),$AJ=function(){function $J($J,$o,$r){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$J,this.elementFormat=$o,this.elementUsage=$r}return $Y($J,"laya.d3.graphics.VertexElement"),$J}(),$hJ=(function(){function $J(){}$Y($J,"laya.d3.graphics.VertexElementFormat"),$J.Single="single",$J.Vector2="vector2",$J.Vector3="vector3",$J.Vector4="vector4",$J.Color="color",$J.Byte4="byte4",$J.Short2="short2",$J.Short4="short4",$J.NormalizedShort2="normalizedshort2",$J.NormalizedShort4="normalizedshort4",$J.HalfVector2="halfvector2",$J.HalfVector4="halfvector4"}(),function(){function $J(){}$Y($J,"laya.d3.graphics.VertexElementUsage"),$J.POSITION0=0,$J.COLOR0=1,$J.TEXTURECOORDINATE0=2,$J.NORMAL0=3,$J.BINORMAL0=4,$J.TANGENT0=5,$J.BLENDINDICES0=6,$J.BLENDWEIGHT0=7,$J.DEPTH0=8,$J.FOG0=9,$J.POINTSIZE0=10,$J.SAMPLE0=11,$J.TESSELLATEFACTOR0=12,$J.COLOR1=13,$J.NEXTTEXTURECOORDINATE0=14,$J.TEXTURECOORDINATE1=15,$J.NEXTTEXTURECOORDINATE1=16,$J.CORNERTEXTURECOORDINATE0=17,$J.VELOCITY0=18,$J.STARTCOLOR0=19,$J.STARTSIZE=20,$J.AGEADDSCALE0=21,$J.STARTROTATION=22,$J.ENDCOLOR0=23,$J.STARTLIFETIME=24,$J.TIME0=33,$J.SHAPEPOSITIONSTARTLIFETIME=30,$J.DIRECTIONTIME=32,$J.SIZEROTATION0=27,$J.RADIUS0=28,$J.RADIAN0=29,$J.STARTSPEED=31,$J.RANDOM0=34,$J.RANDOM1=35,$J.SIMULATIONWORLDPOSTION=36,$J.SIMULATIONWORLDROTATION=37,$J.TEXTURECOORDINATE0X=38,$J.TEXTURECOORDINATE0X1=39,$J.TEXTURECOORDINATE0Y=40,$J.OFFSETVECTOR=41}(),function(){function $J($J,$o,$r){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$J,this._textureCoordinate0=$o,this._time=$r}$Y($J,"laya.d3.graphics.VertexGlitter");var $o=$J.prototype;$K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate0}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"time",function(){return this._time}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(24,[new $AJ(0,"vector3",0),new $AJ(12,"vector2",2),new $AJ(20,"single",33)])}])}(),function(){function $J($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$J,this._position=$o,this._velocity=$r,this._startColor=$S,this._endColor=$G,this._sizeRotation=$z,this._radius=$A,this._radian=$h,this._ageAddScale=$Z,this._time=$u}$Y($J,"laya.d3.graphics.VertexParticle");var $o=$J.prototype;$K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"endColor",function(){return this._endColor}),$_(0,$o,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$_(0,$o,"sizeRotation",function(){return this._sizeRotation}),$_(0,$o,"velocity",function(){return this._velocity}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"startColor",function(){return this._startColor}),$_(0,$o,"radius",function(){return this._radius}),$_(0,$o,"radian",function(){return this._radian}),$_(0,$o,"ageAddScale",function(){return this._ageAddScale}),$_(0,$o,"time",function(){return this._time}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(116,[new $AJ(0,"vector4",17),new $AJ(16,"vector3",0),new $AJ(28,"vector3",18),new $AJ(40,"vector4",19),new $AJ(56,"vector4",23),new $AJ(72,"vector3",27),new $AJ(84,"vector2",28),new $AJ(92,"vector4",29),new $AJ(108,"single",24),new $AJ(112,"single",33)])}])}(),function(){function $J($J){this._position=null,this._position=$J}$Y($J,"laya.d3.graphics.VertexPosition");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(12,[new $AJ(0,"vector3",0)])}]),$J}()),$ZJ=function(){function $J($J,$o){this._position=null,this._normal=null,this._position=$J,this._normal=$o}$Y($J,"laya.d3.graphics.VertexPositionNormal");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(24,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3)])}]),$J}(),$uJ=function(){function $J($J,$o,$r){this._position=null,this._normal=null,this._color=null,this._position=$J,this._normal=$o,this._color=$r}$Y($J,"laya.d3.graphics.VertexPositionNormalColor");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(40,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1)])}]),$J}(),$BJ=function(){function $J($J,$o,$r,$S,$G){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$J,this._normal=$o,this._color=$r,this._blendIndex=$S,this._blendWeight=$G}$Y($J,"laya.d3.graphics.VertexPositionNormalColorSkin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(72,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector4",7),new $AJ(56,"vector4",6)])}]),$J}(),$vJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._tangent=$S,this._blendIndex=$G,this._blendWeight=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(88,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector4",7),new $AJ(56,"vector4",6),new $AJ(72,"vector4",5)])}]),$J}(),$jJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._tangent=$S,this._blendIndex=$G,this._blendWeight=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(84,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector4",7),new $AJ(56,"vector4",6),new $AJ(72,"vector3",5)])}]),$J}(),$YJ=function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._tangent=$S}$Y($J,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(56,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector4",5)])}]),$J}(),$_J=function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._tangent=$S}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(52,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector3",5)])}]),$J}(),$DJ=function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate=$S}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(48,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2)])}]),$J}(),$NJ=function(){function $J($J,$o,$r,$S,$G){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate0=$S,this._textureCoordinate1=$G}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(56,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector2",15)])}]),$J}(),$wJ=function(){function $J($J,$o,$r,$S,$G,$z,$A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate0=$S,this._textureCoordinate1=$G,this._blendIndex=$z,this._blendWeight=$A}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(88,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector2",15),new $AJ(56,"vector4",7),new $AJ(72,"vector4",6)])}]),$J}(),$iJ=function(){function $J($J,$o,$r,$S,$G,$z,$A,$h){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate0=$S,this._textureCoordinate1=$G,this._tangent=$z,this._blendIndex=$A,this._blendWeight=$h}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(104,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector2",15),new $AJ(56,"vector4",7),new $AJ(72,"vector4",6),new $AJ(88,"vector4",5)])}]),$J}(),$IJ=function(){function $J(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$o.VertexPositionNormalColorTexture0SkinTangent=function($J,$o,$r,$S,$G,$z,$A,$h){this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate0=$S,this._textureCoordinate1=$G,this._tangent=$z,this._blendIndex=$A,this._blendWeight=$h},$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(100,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector2",15),new $AJ(56,"vector4",7),new $AJ(72,"vector4",6),new $AJ(88,"vector3",5)])}]),$J}(),$tJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate0=$S,this._textureCoordinate1=$G,this._tangent=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(72,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector2",15),new $AJ(56,"vector4",5)])}]),$J}(),$KJ=function(){function $J(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$o.VertexPositionNormalColorTexture0Tangent=function($J,$o,$r,$S,$G,$z){this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate0=$S,this._textureCoordinate1=$G,this._tangent=$z},$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(68,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector2",15),new $AJ(56,"vector3",5)])}]),$J}(),$eJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate=$S,this._blendIndex=$G,this._blendWeight=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(80,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector4",7),new $AJ(64,"vector4",6)])}]),$J}(),$yJ=function(){function $J($J,$o,$r,$S,$G,$z,$A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate=$S,this._tangent=$G,this._blendIndex=$z,this._blendWeight=$A}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(96,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector4",7),new $AJ(64,"vector4",6),new $AJ(80,"vector4",5)])}]),$J}(),$gJ=function(){function $J($J,$o,$r,$S,$G,$z,$A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate=$S,this._tangent=$G,this._blendIndex=$z,this._blendWeight=$A}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(92,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector4",7),new $AJ(64,"vector4",6),new $AJ(80,"vector3",5)])}]),$J}(),$sJ=function(){function $J($J,$o,$r,$S,$G){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate=$S,this._tangent=$G}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(64,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector4",5)])}]),$J}(),$VJ=function(){function $J($J,$o,$r,$S,$G){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$J,this._normal=$o,this._color=$r,this._textureCoordinate=$S,this._tangent=$G}$Y($J,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"color",function(){return this._color}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(60,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",1),new $AJ(40,"vector2",2),new $AJ(48,"vector3",5)])}]),$J}(),$mJ=function(){function $J($J,$o,$r){this._position=null,this._normal=null,this._tangent=null,this._position=$J,this._normal=$o,this._tangent=$r}$Y($J,"laya.d3.graphics.VertexPositionNormalSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(40,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector4",5)])}]),$J}(),$CJ=function(){function $J($J,$o,$r){this._position=null,this._normal=null,this._tangent=null,this._position=$J,this._normal=$o,this._tangent=$r}$Y($J,"laya.d3.graphics.VertexPositionNormalTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(36,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector3",5)])}]),$J}(),$RJ=function(){function $J($J,$o,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(32,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2)])}]),$J}(),$nJ=function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$J,this._normal=$o,this._textureCoordinate0=$r,this._textureCoordinate1=$S}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(40,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15)])}]),$J}(),$kJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$J,this._normal=$o,this._textureCoordinate0=$r,this._textureCoordinate1=$S,this._blendIndex=$G,this._blendWeight=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(72,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15),new $AJ(40,"vector4",7),new $AJ(56,"vector4",6)])}]),$J}(),$UJ=function(){function $J($J,$o,$r,$S,$G,$z,$A){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._textureCoordinate0=$r,this._textureCoordinate1=$S,this._tangent=$G,this._blendIndex=$z,this._blendWeight=$A}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(88,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15),new $AJ(40,"vector4",7),new $AJ(56,"vector4",6),new $AJ(72,"vector4",5)])}]),$J}(),$LJ=function(){function $J(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$o.VertexPositionNormalTexture0SkinTangent=function($J,$o,$r,$S,$G,$z,$A){this._position=$J,this._normal=$o,this._textureCoordinate0=$r,this._textureCoordinate1=$S,this._tangent=$G,this._blendIndex=$z,this._blendWeight=$A},$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(84,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15),new $AJ(40,"vector4",7),new $AJ(56,"vector4",6),new $AJ(72,"vector3",5)])}]),$J}(),$QJ=function(){function $J($J,$o,$r,$S,$G){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$J,this._normal=$o,this._textureCoordinate0=$r,this._textureCoordinate1=$S,this._tangent=$G}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(56,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15),new $AJ(40,"vector4",5)])}]),$J}(),$pJ=function(){function $J(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$Y($J,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$o.VertexPositionNormalTexture0Tangent=function($J,$o,$r,$S,$G){this._position=$J,this._normal=$o,this._textureCoordinate0=$r,this._textureCoordinate1=$S,this._tangent=$G},$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(52,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15),new $AJ(40,"vector3",5)])}]),$J}(),$fJ=function(){function $J($J,$o,$r,$S,$G){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r,this._blendIndex=$S,this._blendWeight=$G}$Y($J,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(64,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector4",7),new $AJ(48,"vector4",6)])}]),$J}(),$FJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r,this._tangent=$S,this._blendIndex=$G,this._blendWeight=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(80,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector4",7),new $AJ(48,"vector4",6),new $AJ(64,"vector4",5)])}]),$J}(),$dJ=function(){function $J($J,$o,$r,$S,$G,$z){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r,this._tangent=$S,this._blendIndex=$G,this._blendWeight=$z}$Y($J,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(76,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector4",7),new $AJ(48,"vector4",6),new $AJ(64,"vector3",5)])}]),$J}(),$lJ=function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r,this._tangent=$S}$Y($J,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(48,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector4",5)])}]),$J}(),$cJ=function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r,this._tangent=$S}$Y($J,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(44,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector3",5)])}]),$J}(),$TJ=function(){function $J($J,$o,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r}$Y($J,"laya.d3.graphics.VertexPositionNTBTexture");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(56,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector3",5),new $AJ(36,"vector3",4),new $AJ(48,"vector2",2)])}]),$J}(),$bJ=function(){function $J($J,$o,$r,$S,$G,$z,$A,$h){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$J,this._normal=$o,this._textureCoordinate0=$S,this._textureCoordinate1=$G,this._tangent=$z,$r=$r,this._blendIndex=$A,this._blendWeight=$h}$Y($J,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"tangent",function(){return this._tangent}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(0,$o,"textureCoordinate1",function(){return this._textureCoordinate1}),$_(0,$o,"blendIndex",function(){return this._blendIndex}),$_(0,$o,"blendWeight",function(){return this._blendWeight}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(96,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector3",5),new $AJ(36,"vector3",4),new $AJ(48,"vector2",2),new $AJ(56,"vector2",15),new $AJ(64,"vector4",7),new $AJ(80,"vector4",6)])}]),$J}(),$$J=function(){function $J($J,$o,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$J,this._normal=$o,this._textureCoordinate=$r}$Y($J,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"textureCoordinate",function(){return this._textureCoordinate}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(88,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector3",5),new $AJ(36,"vector3",4),new $AJ(48,"vector2",2),new $AJ(56,"vector4",7),new $AJ(72,"vector4",6)])}]),$J}(),$qJ=(function(){function $J($J,$o,$r,$S){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$J,this._normal=$o,this._textureCoord0=$r,this._textureCoord1=$S}$Y($J,"laya.d3.graphics.VertexPositionTerrain");var $o=$J.prototype;$K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"normal",function(){return this._normal}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoord0",function(){return this._textureCoord0}),$_(0,$o,"textureCoord1",function(){return this._textureCoord1}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(40,[new $AJ(0,"vector3",0),new $AJ(12,"vector3",3),new $AJ(24,"vector2",2),new $AJ(32,"vector2",15)])}])}(),function(){function $J($J,$o){this._position=null,this._textureCoordinate0=null,this._position=$J,this._textureCoordinate0=$o}$Y($J,"laya.d3.graphics.VertexPositionTexture0");var $o=$J.prototype;return $K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"position",function(){return this._position}),$_(0,$o,"textureCoordinate0",function(){return this._textureCoordinate0}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(20,[new $AJ(0,"vector3",0),new $AJ(12,"vector2",2)])}]),$J}()),$HJ=(function(){function $J($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v,$j,$Y){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$J,this._positionStartLifeTime=$o,this._velocity=$r,this._startColor=$S,this._startSize=$G,this._startRotation0=$z,this._startRotation1=$A,this._startRotation2=$h,this._startLifeTime=$Z,this._time=$u,this._startSpeed=$B,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$Y}$Y($J,"laya.d3.graphics.VertexShurikenParticleBillboard");var $o=$J.prototype;$K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$_(0,$o,"random1",function(){return this._randoms1}),$_(0,$o,"startRotation2",function(){return this._startRotation2}),$_(0,$o,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$_(0,$o,"velocity",function(){return this._velocity}),$_(0,$o,"random0",function(){return this._randoms0}),$_(0,$o,"startSize",function(){return this._startSize}),$_(0,$o,"startColor",function(){return this._startColor}),$_(0,$o,"startRotation0",function(){return this._startRotation0}),$_(0,$o,"startRotation1",function(){return this._startRotation1}),$_(0,$o,"startLifeTime",function(){return this._startLifeTime}),$_(0,$o,"time",function(){return this._time}),$_(0,$o,"startSpeed",function(){return this._startSpeed}),$_(0,$o,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(152,[new $AJ(0,"vector4",17),new $AJ(16,"vector4",30),new $AJ(32,"vector4",32),new $AJ(48,"vector4",19),new $AJ(64,"vector3",20),new $AJ(76,"vector3",22),new $AJ(88,"single",31),new $AJ(92,"vector4",34),new $AJ(108,"vector4",35),new $AJ(124,"vector3",36),new $AJ(136,"vector4",37)])}])}(),function(){function $J($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v,$j,$Y){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$J,this._positionStartLifeTime=$o,this._velocity=$r,this._startColor=$S,this._startSize=$G,this._startRotation0=$z,this._startRotation1=$A,this._startRotation2=$h,this._startLifeTime=$Z,this._time=$u,this._startSpeed=$B,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$Y}$Y($J,"laya.d3.graphics.VertexShurikenParticleMesh");var $o=$J.prototype;$K.imps($o,{"laya.d3.graphics.IVertex":!0}),$_(0,$o,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$_(0,$o,"velocity",function(){return this._velocity}),$_(0,$o,"position",function(){return this._positionStartLifeTime}),$_(0,$o,"random0",function(){return this._randoms0}),$_(0,$o,"startSize",function(){return this._startSize}),$_(0,$o,"startColor",function(){return this._startColor}),$_(0,$o,"startRotation0",function(){return this._startRotation0}),$_(0,$o,"startRotation1",function(){return this._startRotation1}),$_(0,$o,"random1",function(){return this._randoms1}),$_(0,$o,"startRotation2",function(){return this._startRotation2}),$_(0,$o,"startLifeTime",function(){return this._startLifeTime}),$_(0,$o,"time",function(){return this._time}),$_(0,$o,"startSpeed",function(){return this._startSpeed}),$_(0,$o,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$_(0,$o,"vertexDeclaration",function(){return $J._vertexDeclaration}),$_(1,$J,"vertexDeclaration",function(){return $J._vertexDeclaration}),$v($J,["_vertexDeclaration",function(){return this._vertexDeclaration=new $zJ(172,[new $AJ(0,"vector3",0),new $AJ(12,"vector4",1),new $AJ(28,"vector2",2),new $AJ(36,"vector4",30),new $AJ(52,"vector4",32),new $AJ(68,"vector4",19),new $AJ(84,"vector3",20),new $AJ(96,"vector3",22),new $AJ(108,"single",31),new $AJ(112,"vector4",34),new $AJ(128,"vector4",35),new $AJ(144,"vector3",36),new $AJ(156,"vector4",37)])}])}(),function(){function $I($J,$o,$r,$S,$G,$z){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$r,this._materials=$S,this._subMeshes=$G,this._materialMap=$z,this._version=$o,this._onLoaded($J)}$Y($I,"laya.d3.loaders.LoadModelV01");var $J=$I.prototype;return $J._onLoaded=function($J){this._readData=$J,this.READ_BLOCK();for(var $o=0;$o<this._BLOCK.count;$o++){var $r=this._readData.getUint16(),$S=this._strings[$r],$G=this["READ_"+$S];if(null==$G)throw new Error("model file err,no this function:"+$r+" "+$S);if(!$G.call(this))break}return this._mesh},$J.onError=function(){},$J._readString=function(){return this._strings[this._readData.getUint16()]},$J.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$J.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$J.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $J=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $o=0;$o<this._STRINGS.size;$o++)this._strings[$o]=this._readData.readUTFString();return this._readData.pos=$J,!0},$J.READ_MATERIAL=function(){var $J=this._readData.getUint16(),$o=(this._readString(),this._readString());return this._materials[$J]="null"!==$o?$w.getRes(this._materialMap[$o]):new $Co,!0},$J.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $J,$o=this._readData.__getBuffer(),$r=0,$S=this._readData.getUint32(),$G=this._readData.getUint32(),$z=(new Float32Array($o.slice($S+this._DATA.offset,$S+this._DATA.offset+$G)),this._readData.getUint32()),$A=this._readData.getUint32(),$h=new Float32Array($o.slice($z+this._DATA.offset,$z+this._DATA.offset+$A));for(this.mesh._inverseBindPoses=[],$r=0,$J=$h.length;$r<$J;$r+=16){var $Z=new $Jo($h[$r+0],$h[$r+1],$h[$r+2],$h[$r+3],$h[$r+4],$h[$r+5],$h[$r+6],$h[$r+7],$h[$r+8],$h[$r+9],$h[$r+10],$h[$r+11],$h[$r+12],$h[$r+13],$h[$r+14],$h[$r+15]);this.mesh._inverseBindPoses.push($Z)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$J.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $J=this._readString();this._shaderAttributes=$J.match($I._attrReg);var $o=this._readData.getUint32(),$r=this._readData.getUint32(),$S=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$G=this._readData.getUint32(),$z=this._readData.getUint32(),$A=this._readData.getUint32(),$h=this._readData.__getBuffer(),$Z=new $uo(this._mesh),$u=this._getVertexDeclaration(),$B=$do.create($u,$G/$u.vertexStride,35044,!0),$v=$S+this._DATA.offset,$j=$h.slice($v,$v+$G);$B.setData(new Float32Array($j));for(var $Y=($Z._vertexBuffer=$B).vertexDeclaration.getVertexElements(),$_=0;$_<$Y.length;$_++)$Z._bufferUsage[$Y[$_].elementUsage]=$B;var $D=$Fo.create("ushort",$r/2,35044,!0),$N=$o+this._DATA.offset,$w=$h.slice($N,$N+$r);$D.setData(new Uint16Array($w)),$Z._indexBuffer=$D;var $i=$h.slice($z+this._DATA.offset,$z+this._DATA.offset+$A);return $Z._boneIndicesList[0]=new Uint8Array($i),this._subMeshes.push($Z),!0},$J.READ_DATAAREA=function(){return!1},$J._getVertexDeclaration=function(){for(var $J,$o=!1,$r=!1,$S=!1,$G=!1,$z=!1,$A=!1,$h=!1,$Z=!1,$u=!1,$B=0;$B<this._shaderAttributes.length;$B+=8)switch(this._shaderAttributes[$B]){case"POSITION":$o=!0;break;case"NORMAL":$r=!0;break;case"COLOR":$S=!0;break;case"UV":$G=!0;break;case"UV1":$z=!0;break;case"BLENDWEIGHT":$h=!0;break;case"BLENDINDICES":$Z=!0;break;case"TANGENT":$A=!0;break;case"BINORMAL":$u=!0}return $o&&$r&&$S&&$G&&$z&&$h&&$Z&&$A?$J=$IJ.vertexDeclaration:$o&&$r&&$S&&$G&&$z&&$h&&$Z?$J=$wJ.vertexDeclaration:$o&&$r&&$G&&$z&&$h&&$Z&&$A?$J=$LJ.vertexDeclaration:$o&&$r&&$G&&$z&&$h&&$Z?$J=$kJ.vertexDeclaration:$o&&$r&&$S&&$G&&$h&&$Z&&$A?$J=$gJ.vertexDeclaration:$o&&$r&&$S&&$G&&$h&&$Z?$J=$eJ.vertexDeclaration:$o&&$r&&$A&&$u&&$G&&$h&&$Z?$J=$$J.vertexDeclaration:$o&&$r&&$G&&$h&&$Z&&$A?$J=$dJ.vertexDeclaration:$o&&$r&&$G&&$h&&$Z?$J=$fJ.vertexDeclaration:$o&&$r&&$S&&$h&&$Z&&$A?$J=$jJ.vertexDeclaration:$o&&$r&&$S&&$h&&$Z?$J=$BJ.vertexDeclaration:$o&&$r&&$S&&$G&&$z&&$A?$J=$KJ.vertexDeclaration:$o&&$r&&$S&&$G&&$z?$J=$NJ.vertexDeclaration:$o&&$r&&$G&&$z&&$A?$J=$pJ.vertexDeclaration:$o&&$r&&$G&&$z?$J=$nJ.vertexDeclaration:$o&&$r&&$S&&$G&&$A?$J=$VJ.vertexDeclaration:$o&&$r&&$G&&$A&&$u?$J=$TJ.vertexDeclaration:$o&&$r&&$S&&$G?$J=$DJ.vertexDeclaration:$o&&$r&&$G&&$A?$J=$cJ.vertexDeclaration:$o&&$r&&$G?$J=$RJ.vertexDeclaration:$o&&$r&&$S&&$A?$J=$_J.vertexDeclaration:$o&&$r&&$S&&($J=$uJ.vertexDeclaration),$J},$_(0,$J,"mesh",function(){return this._mesh}),$I._attrReg=new RegExp("(\\w+)|([:,;])","g"),$I}()),$aJ=function(){function $y(){}return $Y($y,"laya.d3.loaders.LoadModelV02"),$y.parse=function($J,$o,$r,$S,$G,$z){$y._mesh=$r,$y._materials=$S,$y._subMeshes=$G,$y._materialMap=$z,$y._version=$o,$y._readData=$J,$y.READ_DATA(),$y.READ_BLOCK(),$y.READ_STRINGS();for(var $A=0,$h=$y._BLOCK.count;$A<$h;$A++){$y._readData.pos=$y._BLOCK.blockStarts[$A];var $Z=$y._readData.getUint16(),$u=$y._strings[$Z],$B=$y["READ_"+$u];if(null==$B)throw new Error("model file err,no this function:"+$Z+" "+$u);$B.call()}$y._strings.length=0,$y._readData=null,$y._version=null,$y._mesh=null,$y._materials=null,$y._subMeshes=null,$y._materialMap=null},$y._readString=function(){return $y._strings[$y._readData.getUint16()]},$y.READ_DATA=function(){$y._DATA.offset=$y._readData.getUint32(),$y._DATA.size=$y._readData.getUint32()},$y.READ_BLOCK=function(){for(var $J=$y._BLOCK.count=$y._readData.getUint16(),$o=$y._BLOCK.blockStarts=[],$r=$y._BLOCK.blockLengths=[],$S=0;$S<$J;$S++)$o.push($y._readData.getUint32()),$r.push($y._readData.getUint32())},$y.READ_STRINGS=function(){var $J=$y._readData.getUint32(),$o=$y._readData.getUint16(),$r=$y._readData.pos;$y._readData.pos=$J+$y._DATA.offset;for(var $S=0;$S<$o;$S++)$y._strings[$S]=$y._readData.readUTFString();$y._readData.pos=$r},$y.READ_MATERIAL=function(){$y._readString(),$y._readString();var $J=$y._readString();return""!==$J&&$y._materials.push($w.getRes($y._materialMap[$J])),!0},$y.READ_MESH=function(){$y._readString();var $J,$o=$y._readData.__getBuffer(),$r=0,$S=$y._readData.getInt16(),$G=$y._DATA.offset;for($r=0;$r<$S;$r++){var $z=$G+$y._readData.getUint32(),$A=$y._readData.getUint32(),$h=new Float32Array($o.slice($z,$z+$A)),$Z=$y._readString().match($y._attrReg),$u=$y._getVertexDeclaration($Z),$B=$do.create($u,4*$h.length/$u.vertexStride,35044,!0);$B.setData($h),$y._mesh._vertexBuffers.push($B)}var $v=$G+$y._readData.getUint32(),$j=$y._readData.getUint32(),$Y=new Uint16Array($o.slice($v,$v+$j)),$_=$Fo.create("ushort",$j/2,35044,!0);$_.setData($Y),$y._mesh._indexBuffer=$_;var $D=$y._mesh._boneNames=[],$N=$y._readData.getUint16();for($D.length=$N,$r=0;$r<$N;$r++)$D[$r]=$y._strings[$y._readData.getUint16()];var $w=$y._readData.getUint32(),$i=$y._readData.getUint32(),$I=(new Float32Array($o.slice($G+$w,$G+$w+$i)),$y._readData.getUint32()),$t=$y._readData.getUint32(),$K=new Float32Array($o.slice($G+$I,$G+$I+$t));for($y._mesh._inverseBindPoses=[],$r=0,$J=$K.length;$r<$J;$r+=16){var $e=new $Jo($K[$r+0],$K[$r+1],$K[$r+2],$K[$r+3],$K[$r+4],$K[$r+5],$K[$r+6],$K[$r+7],$K[$r+8],$K[$r+9],$K[$r+10],$K[$r+11],$K[$r+12],$K[$r+13],$K[$r+14],$K[$r+15]);$y._mesh._inverseBindPoses.push($e)}return $y._mesh._skinnedDatas=new Float32Array(16*$K.length),!0},$y.READ_SUBMESH=function(){var $J=$y._readData.__getBuffer(),$o=new $uo($y._mesh),$r=$y._readData.getInt16(),$S=$y._readData.getUint32(),$G=$y._readData.getUint32();$o._vertexBuffer=$y._mesh._vertexBuffers[$r],$o._vertexStart=$S,$o._vertexCount=$G;var $z=$y._readData.getUint32(),$A=$y._readData.getUint32(),$h=$y._mesh._indexBuffer;$o._indexBuffer=$h,$o._indexStart=$z,$o._indexCount=$A,$o._indices=new Uint16Array($h.getData().buffer,2*$z,$A);var $Z=$y._DATA.offset,$u=$o._subIndexBufferStart,$B=$o._subIndexBufferCount,$v=$o._boneIndicesList,$j=$y._readData.getUint16();$u.length=$j,$B.length=$j,$v.length=$j;for(var $Y=0;$Y<$j;$Y++){$u[$Y]=$y._readData.getUint32(),$B[$Y]=$y._readData.getUint32();var $_=$y._readData.getUint32(),$D=$y._readData.getUint32();$o._boneIndicesList[$Y]=new Uint8Array($J.slice($Z+$_,$Z+$_+$D))}return $y._subMeshes.push($o),!0},$y._getVertexDeclaration=function($J){for(var $o,$r=!1,$S=!1,$G=!1,$z=!1,$A=!1,$h=!1,$Z=!1,$u=!1,$B=!1,$v=0;$v<$J.length;$v++)switch($J[$v]){case"POSITION":$r=!0;break;case"NORMAL":$S=!0;break;case"COLOR":$G=!0;break;case"UV":$z=!0;break;case"UV1":$A=!0;break;case"BLENDWEIGHT":$Z=!0;break;case"BLENDINDICES":$u=!0;break;case"TANGENT":$h=!0;break;case"BINORMAL":$B=!0}return $r&&$S&&$G&&$z&&$A&&$Z&&$u&&$h?$o=$IJ.vertexDeclaration:$r&&$S&&$G&&$z&&$A&&$Z&&$u?$o=$wJ.vertexDeclaration:$r&&$S&&$z&&$A&&$Z&&$u&&$h?$o=$LJ.vertexDeclaration:$r&&$S&&$z&&$A&&$Z&&$u?$o=$kJ.vertexDeclaration:$r&&$S&&$G&&$z&&$Z&&$u&&$h?$o=$gJ.vertexDeclaration:$r&&$S&&$G&&$z&&$Z&&$u?$o=$eJ.vertexDeclaration:$r&&$S&&$z&&$Z&&$u&&$h?$o=$dJ.vertexDeclaration:$r&&$S&&$z&&$Z&&$u?$o=$fJ.vertexDeclaration:$r&&$S&&$G&&$Z&&$u&&$h?$o=$jJ.vertexDeclaration:$r&&$S&&$G&&$Z&&$u?$o=$BJ.vertexDeclaration:$r&&$S&&$G&&$z&&$A&&$h?$o=$KJ.vertexDeclaration:$r&&$S&&$G&&$z&&$A?$o=$NJ.vertexDeclaration:$r&&$S&&$z&&$A&&$h?$o=$pJ.vertexDeclaration:$r&&$S&&$z&&$A?$o=$nJ.vertexDeclaration:$r&&$S&&$G&&$z&&$h?$o=$VJ.vertexDeclaration:$r&&$S&&$z&&$h&&$B?$o=$TJ.vertexDeclaration:$r&&$S&&$G&&$z?$o=$DJ.vertexDeclaration:$r&&$S&&$z&&$h?$o=$cJ.vertexDeclaration:$r&&$S&&$z?$o=$RJ.vertexDeclaration:$r&&$S&&$G&&$h?$o=$_J.vertexDeclaration:$r&&$S&&$G&&($o=$uJ.vertexDeclaration),$o},$y._attrReg=new RegExp("(\\w+)|([:,;])","g"),$y._strings=[],$y._readData=null,$y._version=null,$y._mesh=null,$y._materials=null,$y._subMeshes=null,$y._materialMap=null,$v($y,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$y}(),$xJ=function(){function $e(){}return $Y($e,"laya.d3.loaders.LoadModelV03"),$e.parse=function($J,$o,$r,$S,$G){$e._mesh=$r,$e._subMeshes=$S,$e._materialMap=$G,$e._version=$o,$e._readData=$J,$e.READ_DATA(),$e.READ_BLOCK(),$e.READ_STRINGS();for(var $z=0,$A=$e._BLOCK.count;$z<$A;$z++){$e._readData.pos=$e._BLOCK.blockStarts[$z];var $h=$e._readData.getUint16(),$Z=$e._strings[$h],$u=$e["READ_"+$Z];if(null==$u)throw new Error("model file err,no this function:"+$h+" "+$Z);$u.call()}$e._strings.length=0,$e._readData=null,$e._version=null,$e._mesh=null,$e._subMeshes=null,$e._materialMap=null},$e._readString=function(){return $e._strings[$e._readData.getUint16()]},$e.READ_DATA=function(){$e._DATA.offset=$e._readData.getUint32(),$e._DATA.size=$e._readData.getUint32()},$e.READ_BLOCK=function(){for(var $J=$e._BLOCK.count=$e._readData.getUint16(),$o=$e._BLOCK.blockStarts=[],$r=$e._BLOCK.blockLengths=[],$S=0;$S<$J;$S++)$o.push($e._readData.getUint32()),$r.push($e._readData.getUint32())},$e.READ_STRINGS=function(){var $J=$e._readData.getUint32(),$o=$e._readData.getUint16(),$r=$e._readData.pos;$e._readData.pos=$J+$e._DATA.offset;for(var $S=0;$S<$o;$S++)$e._strings[$S]=$e._readData.readUTFString();$e._readData.pos=$r},$e.READ_MESH=function(){var $J,$o=$e._readString(),$r=$e._readData.__getBuffer(),$S=0,$G=$e._readData.getInt16(),$z=$e._DATA.offset;for($S=0;$S<$G;$S++){var $A,$h=$z+$e._readData.getUint32(),$Z=$e._readData.getUint32(),$u=new Float32Array($r.slice($h,$h+$Z)),$B=$e._readString();switch($e._version){case"LAYAMODEL:03":$A=$e._vertexDeclarationMap_Discard[$B];break;case"LAYAMODEL:0301":$A=$e._vertexDeclarationMap[$B];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$A)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$e._version+"  bufferAttribute="+$B+"  name="+$o+"  url="+($e._mesh?$e._mesh.url:"null"));var $v=$do.create($A,4*$u.length/$A.vertexStride,35044,!0,$e._mesh._url+"_"+$S);$v.setData($u),$e._mesh._vertexBuffers.push($v)}var $j=$z+$e._readData.getUint32(),$Y=$e._readData.getUint32(),$_=new Uint16Array($r.slice($j,$j+$Y)),$D=$Fo.create("ushort",$Y/2,35044,!0,$e._mesh._url);$D.setData($_),$e._mesh._indexBuffer=$D;var $N=$e._mesh._boneNames=[],$w=$e._readData.getUint16();for($N.length=$w,$S=0;$S<$w;$S++)$N[$S]=$e._strings[$e._readData.getUint16()];$e._readData.pos+=8;var $i=$e._readData.getUint32(),$I=$e._readData.getUint32(),$t=new Float32Array($r.slice($z+$i,$z+$i+$I));for($e._mesh._inverseBindPoses=[],$S=0,$J=$t.length;$S<$J;$S+=16){var $K=new $Jo($t[$S+0],$t[$S+1],$t[$S+2],$t[$S+3],$t[$S+4],$t[$S+5],$t[$S+6],$t[$S+7],$t[$S+8],$t[$S+9],$t[$S+10],$t[$S+11],$t[$S+12],$t[$S+13],$t[$S+14],$t[$S+15]);$e._mesh._inverseBindPoses.push($K)}return $e._mesh._skinnedDatas=new Float32Array(16*$t.length),!0},$e.READ_SUBMESH=function(){var $J=$e._readData.__getBuffer(),$o=new $uo($e._mesh),$r=$e._readData.getInt16(),$S=$e._readData.getUint32(),$G=$e._readData.getUint32();$o._vertexBuffer=$e._mesh._vertexBuffers[$r],$o._vertexStart=$S,$o._vertexCount=$G;var $z=$e._readData.getUint32(),$A=$e._readData.getUint32(),$h=$e._mesh._indexBuffer;$o._indexBuffer=$h,$o._indexStart=$z,$o._indexCount=$A,$o._indices=new Uint16Array($h.getData().buffer,2*$z,$A);var $Z=$e._DATA.offset,$u=$o._subIndexBufferStart,$B=$o._subIndexBufferCount,$v=$o._boneIndicesList,$j=$e._readData.getUint16();$u.length=$j,$B.length=$j,$v.length=$j;for(var $Y=0;$Y<$j;$Y++){$u[$Y]=$e._readData.getUint32(),$B[$Y]=$e._readData.getUint32();var $_=$e._readData.getUint32(),$D=$e._readData.getUint32();$v[$Y]=new Uint8Array($J.slice($Z+$_,$Z+$_+$D))}return $e._subMeshes.push($o),!0},$e._strings=[],$e._readData=null,$e._version=null,$e._mesh=null,$e._subMeshes=null,$e._materialMap=null,$v($e,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$IJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$wJ.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$bJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$LJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$kJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$gJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$eJ.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$dJ.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$fJ.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$jJ.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$BJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$KJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$NJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$pJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$nJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$VJ.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$TJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$DJ.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$cJ.vertexDeclaration,"POSITION,NORMAL,UV":$RJ.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$_J.vertexDeclaration,"POSITION,NORMAL,COLOR":$uJ.vertexDeclaration,"POSITION,NORMAL,TANGENT":$CJ.vertexDeclaration,"POSITION,NORMAL":$ZJ.vertexDeclaration,"POSITION,UV":$qJ.vertexDeclaration,POSITION:$hJ.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$iJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$wJ.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$bJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$UJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$kJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$yJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$eJ.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$FJ.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$fJ.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$vJ.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$BJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$tJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$NJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$QJ.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$nJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$sJ.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$TJ.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$DJ.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$lJ.vertexDeclaration,"POSITION,NORMAL,UV":$RJ.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$YJ.vertexDeclaration,"POSITION,NORMAL,COLOR":$uJ.vertexDeclaration,"POSITION,NORMAL,TANGENT":$mJ.vertexDeclaration,"POSITION,NORMAL":$ZJ.vertexDeclaration,"POSITION,UV":$qJ.vertexDeclaration,POSITION:$hJ.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$e}(),$MJ=function(){function $h(){}return $Y($h,"laya.d3.loaders.MeshReader"),$h.read=function($J,$o,$r,$S,$G){var $z=new $e($J);$z.pos=0;var $A=$z.readUTFString();switch($A){case"LAYAMODEL:01":case"LAYASKINANI:01":$h._readVersion01($z,$A,$o,$r,$S,$G);break;case"LAYAMODEL:02":$aJ.parse($z,$A,$o,$r,$S,$G);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$xJ.parse($z,$A,$o,$S,$G);break;default:throw new Error("MeshReader: unknown mesh version.")}$o._setSubMeshes($S)},$h._readVersion01=function($J,$o,$r,$S,$G,$z){new $HJ($J,$o,$r,$S,$G,$z)},$h}(),$OJ=function(){function $J($J,$o){this.min=null,this.max=null,this.min=$J,this.max=$o}$Y($J,"laya.d3.math.BoundBox");var $o=$J.prototype;return $K.imps($o,{"laya.d3.core.IClone":!0}),$o.getCorners=function($J){$J.length=8;var $o=this.min.elements,$r=this.max.elements,$S=$o[0],$G=$o[1],$z=$o[2],$A=$r[0],$h=$r[1],$Z=$r[2];$J[0]=new $Ao($S,$h,$Z),$J[1]=new $Ao($A,$h,$Z),$J[2]=new $Ao($A,$G,$Z),$J[3]=new $Ao($S,$G,$Z),$J[4]=new $Ao($S,$h,$z),$J[5]=new $Ao($A,$h,$z),$J[6]=new $Ao($A,$G,$z),$J[7]=new $Ao($S,$G,$z)},$o.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$o.cloneTo=function($J){var $o=$J;this.min.cloneTo($o.min),this.max.cloneTo($o.max)},$o.clone=function(){var $J=new this.constructor(new $Ao,new $Ao);return this.cloneTo($J),$J},$J.createfromPoints=function($J,$o){if(null==$J)throw new Error("points");var $r=$o.min,$S=$o.max,$G=$r.elements;$G[0]=Number.MAX_VALUE,$G[1]=Number.MAX_VALUE,$G[2]=Number.MAX_VALUE;var $z=$S.elements;$z[0]=-Number.MAX_VALUE,$z[1]=-Number.MAX_VALUE,$z[2]=-Number.MAX_VALUE;for(var $A=0,$h=$J.length;$A<$h;++$A)$Ao.min($r,$J[$A],$r),$Ao.max($S,$J[$A],$S)},$J.merge=function($J,$o,$r){$Ao.min($J.min,$o.min,$r.min),$Ao.max($J.max,$o.max,$r.max)},$J}(),$PJ=function(){function $u($J){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$J,this._near=new $oo(new $Ao),this._far=new $oo(new $Ao),this._left=new $oo(new $Ao),this._right=new $oo(new $Ao),this._top=new $oo(new $Ao),this._bottom=new $oo(new $Ao),$u._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$Y($u,"laya.d3.math.BoundFrustum");var $J=$u.prototype;return $J.equalsBoundFrustum=function($J){return this._matrix.equalsOtherMatrix($J.matrix)},$J.equalsObj=function($J){if($J instanceof laya.d3.math.BoundFrustum){var $o=$J;return this.equalsBoundFrustum($o)}return!1},$J.getPlane=function($J){switch($J){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$J.getCorners=function($J){$u._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($J[0]),$u._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($J[1]),$u._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($J[2]),$u._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($J[3]),$u._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($J[4]),$u._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($J[5]),$u._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($J[6]),$u._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($J[7])},$J.containsPoint=function($J){for(var $o=$oo.PlaneIntersectionType_Front,$r=$oo.PlaneIntersectionType_Front,$S=0;$S<6;$S++){switch($S){case 0:$r=Collision.intersectsPlaneAndPoint(this._near,$J);break;case 1:$r=Collision.intersectsPlaneAndPoint(this._far,$J);break;case 2:$r=Collision.intersectsPlaneAndPoint(this._left,$J);break;case 3:$r=Collision.intersectsPlaneAndPoint(this._right,$J);break;case 4:$r=Collision.intersectsPlaneAndPoint(this._top,$J);break;case 5:$r=Collision.intersectsPlaneAndPoint(this._bottom,$J)}switch($r){case $oo.PlaneIntersectionType_Back:return 0;case $oo.PlaneIntersectionType_Intersecting:$o=$oo.PlaneIntersectionType_Intersecting}}switch($o){case $oo.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$J.containsBoundBox=function($J){for(var $o,$r=$u._tempV30,$S=$u._tempV31,$G=1,$z=0;$z<6;$z++){if($o=this.getPlane($z),this._getBoxToPlanePVertexNVertex($J,$o.normal,$r,$S),Collision.intersectsPlaneAndPoint($o,$r)===$oo.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($o,$S)===$oo.PlaneIntersectionType_Back&&($G=2)}return $G},$J.containsBoundSphere=function($J){for(var $o=$oo.PlaneIntersectionType_Front,$r=$oo.PlaneIntersectionType_Front,$S=0;$S<6;$S++){switch($S){case 0:$r=Collision.intersectsPlaneAndSphere(this._near,$J);break;case 1:$r=Collision.intersectsPlaneAndSphere(this._far,$J);break;case 2:$r=Collision.intersectsPlaneAndSphere(this._left,$J);break;case 3:$r=Collision.intersectsPlaneAndSphere(this._right,$J);break;case 4:$r=Collision.intersectsPlaneAndSphere(this._top,$J);break;case 5:$r=Collision.intersectsPlaneAndSphere(this._bottom,$J)}switch($r){case $oo.PlaneIntersectionType_Back:return 0;case $oo.PlaneIntersectionType_Intersecting:$o=$oo.PlaneIntersectionType_Intersecting}}switch($o){case $oo.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$J._getBoxToPlanePVertexNVertex=function($J,$o,$r,$S){var $G=$J.min,$z=$G.elements,$A=$J.max,$h=$A.elements,$Z=$o.elements,$u=$Z[0],$B=$Z[1],$v=$Z[2];$G.cloneTo($r);var $j=$r.elements;0<=$u&&($j[0]=$h[0]),0<=$B&&($j[1]=$h[1]),0<=$v&&($j[2]=$h[2]),$A.cloneTo($S);var $Y=$S.elements;0<=$u&&($Y[0]=$z[0]),0<=$B&&($Y[1]=$z[1]),0<=$v&&($Y[2]=$z[2])},$_(0,$J,"top",function(){return this._top}),$_(0,$J,"matrix",function(){return this._matrix},function($J){this._matrix=$J,$u._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$_(0,$J,"near",function(){return this._near}),$_(0,$J,"far",function(){return this._far}),$_(0,$J,"left",function(){return this._left}),$_(0,$J,"right",function(){return this._right}),$_(0,$J,"bottom",function(){return this._bottom}),$u._getPlanesFromMatrix=function($J,$o,$r,$S,$G,$z,$A){var $h=$J.elements,$Z=$h[0],$u=$h[1],$B=$h[2],$v=$h[3],$j=$h[4],$Y=$h[5],$_=$h[6],$D=$h[7],$N=$h[8],$w=$h[9],$i=$h[10],$I=$h[11],$t=$h[12],$K=$h[13],$e=$h[14],$y=$h[15],$g=$o.normal.elements;$g[0]=$v+$B,$g[1]=$D+$_,$g[2]=$I+$i,$o.distance=$y+$e,$o.normalize();var $s=$r.normal.elements;$s[0]=$v-$B,$s[1]=$D-$_,$s[2]=$I-$i,$r.distance=$y-$e,$r.normalize();var $V=$S.normal.elements;$V[0]=$v+$Z,$V[1]=$D+$j,$V[2]=$I+$N,$S.distance=$y+$t,$S.normalize();var $m=$G.normal.elements;$m[0]=$v-$Z,$m[1]=$D-$j,$m[2]=$I-$N,$G.distance=$y-$t,$G.normalize();var $C=$z.normal.elements;$C[0]=$v-$u,$C[1]=$D-$Y,$C[2]=$I-$w,$z.distance=$y-$K,$z.normalize();var $R=$A.normal.elements;$R[0]=$v+$u,$R[1]=$D+$Y,$R[2]=$I+$w,$A.distance=$y+$K,$A.normalize()},$u._get3PlaneInterPoint=function($J,$o,$r){var $S=$J.normal,$G=$o.normal,$z=$r.normal;$Ao.cross($G,$z,$u._tempV30),$Ao.cross($z,$S,$u._tempV31),$Ao.cross($S,$G,$u._tempV32);var $A=$Ao.dot($S,$u._tempV30),$h=$Ao.dot($G,$u._tempV31),$Z=$Ao.dot($z,$u._tempV32);return $Ao.scale($u._tempV30,-$J.distance/$A,$u._tempV33),$Ao.scale($u._tempV31,-$o.distance/$h,$u._tempV34),$Ao.scale($u._tempV32,-$r.distance/$Z,$u._tempV35),$Ao.add($u._tempV33,$u._tempV34,$u._tempV36),$Ao.add($u._tempV35,$u._tempV36,$u._tempV37),$u._tempV37},$v($u,["_tempV30",function(){return this._tempV30=new $Ao},"_tempV31",function(){return this._tempV31=new $Ao},"_tempV32",function(){return this._tempV32=new $Ao},"_tempV33",function(){return this._tempV33=new $Ao},"_tempV34",function(){return this._tempV34=new $Ao},"_tempV35",function(){return this._tempV35=new $Ao},"_tempV36",function(){return this._tempV36=new $Ao},"_tempV37",function(){return this._tempV37=new $Ao}]),$u}(),$WJ=function(){function $B($J,$o){this.center=null,this.radius=NaN,this.center=$J,this.radius=$o}$Y($B,"laya.d3.math.BoundSphere");var $J=$B.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.toDefault=function(){this.center.toDefault(),this.radius=0},$J.intersectsRayDistance=function($J){return Collision.intersectsRayAndSphereRD($J,this)},$J.intersectsRayPoint=function($J,$o){return Collision.intersectsRayAndSphereRP($J,this,$o)},$J.cloneTo=function($J){var $o=$J;this.center.cloneTo($o.center),$o.radius=this.radius},$J.clone=function(){var $J=new this.constructor(new $Ao,new $Ao);return this.cloneTo($J),$J},$B.createFromSubPoints=function($J,$o,$r,$S){if(null==$J)throw new Error("points");if($o<0||$o>=$J.length)throw new Error("start"+$o+"Must be in the range [0, "+($J.length-1)+"]");if($r<0||$o+$r>$J.length)throw new Error("count"+$r+"Must be in the range <= "+$J.length+"}");var $G=$o+$r,$z=$B._tempVector3;$z.elements[0]=0,$z.elements[1]=0,$z.elements[2]=0;for(var $A=$o;$A<$G;++$A)$Ao.add($J[$A],$z,$z);var $h=$S.center;$Ao.scale($z,1/$r,$h);var $Z=0;for($A=$o;$A<$G;++$A){var $u=$Ao.distanceSquared($h,$J[$A]);$Z<$u&&($Z=$u)}$S.radius=Math.sqrt($Z)},$B.createfromPoints=function($J,$o){if(null==$J)throw new Error("points");$B.createFromSubPoints($J,0,$J.length,$o)},$v($B,["_tempVector3",function(){return this._tempVector3=new $Ao}]),$B}(),$EJ=(function(){function $J(){}$Y($J,"laya.d3.math.ContainmentType"),$J.Disjoint=0,$J.Contains=1,$J.Intersects=2}(),function(){function $r(){}return $Y($r,"laya.d3.math.MathUtils3D"),$r.isZero=function($J){return Math.abs($J)<$r.zeroTolerance},$r.nearEqual=function($J,$o){return!!$r.isZero($J-$o)},$r.fastInvSqrt=function($J){return $r.isZero($J)?$J:1/Math.sqrt($J)},$v($r,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$r}()),$XJ=function(){function $Z(){var $J=this.elements=new Float32Array(9);$J[0]=1,$J[1]=0,$J[2]=0,$J[3]=0,$J[4]=1,$J[5]=0,$J[6]=0,$J[7]=0,$J[8]=1}$Y($Z,"laya.d3.math.Matrix3x3");var $J=$Z.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.determinant=function(){var $J=this.elements,$o=$J[0],$r=$J[1],$S=$J[2],$G=$J[3],$z=$J[4],$A=$J[5],$h=$J[6],$Z=$J[7],$u=$J[8];return $o*($u*$z-$A*$Z)+$r*(-$u*$G+$A*$h)+$S*($Z*$G-$z*$h)},$J.translate=function($J,$o){var $r=$o.elements,$S=this.elements,$G=$J.elements,$z=$S[0],$A=$S[1],$h=$S[2],$Z=$S[3],$u=$S[4],$B=$S[5],$v=$S[6],$j=$S[7],$Y=$S[8],$_=$G[0],$D=$G[1];$r[0]=$z,$r[1]=$A,$r[2]=$h,$r[3]=$Z,$r[4]=$u,$r[5]=$B,$r[6]=$_*$z+$D*$Z+$v,$r[7]=$_*$A+$D*$u+$j,$r[8]=$_*$h+$D*$B+$Y},$J.rotate=function($J,$o){var $r=$o.elements,$S=this.elements,$G=$S[0],$z=$S[1],$A=$S[2],$h=$S[3],$Z=$S[4],$u=$S[5],$B=$S[6],$v=$S[7],$j=$S[8],$Y=Math.sin($J),$_=Math.cos($J);$r[0]=$_*$G+$Y*$h,$r[1]=$_*$z+$Y*$Z,$r[2]=$_*$A+$Y*$u,$r[3]=$_*$h-$Y*$G,$r[4]=$_*$Z-$Y*$z,$r[5]=$_*$u-$Y*$A,$r[6]=$B,$r[7]=$v,$r[8]=$j},$J.scale=function($J,$o){var $r=$o.elements,$S=this.elements,$G=$J.elements,$z=$G[0],$A=$G[1];$r[0]=$z*$S[0],$r[1]=$z*$S[1],$r[2]=$z*$S[2],$r[3]=$A*$S[3],$r[4]=$A*$S[4],$r[5]=$A*$S[5],$r[6]=$S[6],$r[7]=$S[7],$r[8]=$S[8]},$J.invert=function($J){var $o=$J.elements,$r=this.elements,$S=$r[0],$G=$r[1],$z=$r[2],$A=$r[3],$h=$r[4],$Z=$r[5],$u=$r[6],$B=$r[7],$v=$r[8],$j=$v*$h-$Z*$B,$Y=-$v*$A+$Z*$u,$_=$B*$A-$h*$u,$D=$S*$j+$G*$Y+$z*$_;$D||($J=null),$D=1/$D,$o[0]=$j*$D,$o[1]=(-$v*$G+$z*$B)*$D,$o[2]=($Z*$G-$z*$h)*$D,$o[3]=$Y*$D,$o[4]=($v*$S-$z*$u)*$D,$o[5]=(-$Z*$S+$z*$A)*$D,$o[6]=$_*$D,$o[7]=(-$B*$S+$G*$u)*$D,$o[8]=($h*$S-$G*$A)*$D},$J.transpose=function($J){var $o=$J.elements,$r=this.elements;if($J===this){var $S=$r[1],$G=$r[2],$z=$r[5];$o[1]=$r[3],$o[2]=$r[6],$o[3]=$S,$o[5]=$r[7],$o[6]=$G,$o[7]=$z}else $o[0]=$r[0],$o[1]=$r[3],$o[2]=$r[6],$o[3]=$r[1],$o[4]=$r[4],$o[5]=$r[7],$o[6]=$r[2],$o[7]=$r[5],$o[8]=$r[8]},$J.identity=function(){var $J=this.elements;$J[0]=1,$J[1]=0,$J[2]=0,$J[3]=0,$J[4]=1,$J[5]=0,$J[6]=0,$J[7]=0,$J[8]=1},$J.cloneTo=function($J){var $o,$r,$S;if(($r=this.elements)!==($S=$J.elements))for($o=0;$o<9;++$o)$S[$o]=$r[$o]},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$Z.createFromTranslation=function($J,$o){$o.elements;var $r=$J.elements;$o[0]=1,$o[1]=0,$o[2]=0,$o[3]=0,$o[4]=1,$o[5]=0,$o[6]=$r[0],$o[7]=$r[1],$o[8]=1},$Z.createFromRotation=function($J,$o){var $r=$o.elements,$S=Math.sin($J),$G=Math.cos($J);$r[0]=$G,$r[1]=$S,$r[2]=0,$r[3]=-$S,$r[4]=$G,$r[5]=0,$r[6]=0,$r[7]=0,$r[8]=1},$Z.createFromScaling=function($J,$o){var $r=$o.elements,$S=$J.elements;$r[0]=$S[0],$r[1]=0,$r[2]=0,$r[3]=0,$r[4]=$S[1],$r[5]=0,$r[6]=0,$r[7]=0,$r[8]=1},$Z.createFromMatrix4x4=function($J,$o){$o[0]=$J[0],$o[1]=$J[1],$o[2]=$J[2],$o[3]=$J[4],$o[4]=$J[5],$o[5]=$J[6],$o[6]=$J[8],$o[7]=$J[9],$o[8]=$J[10]},$Z.multiply=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements,$A=$G[0],$h=$G[1],$Z=$G[2],$u=$G[3],$B=$G[4],$v=$G[5],$j=$G[6],$Y=$G[7],$_=$G[8],$D=$z[0],$N=$z[1],$w=$z[2],$i=$z[3],$I=$z[4],$t=$z[5],$K=$z[6],$e=$z[7],$y=$z[8];$S[0]=$D*$A+$N*$u+$w*$j,$S[1]=$D*$h+$N*$B+$w*$Y,$S[2]=$D*$Z+$N*$v+$w*$_,$S[3]=$i*$A+$I*$u+$t*$j,$S[4]=$i*$h+$I*$B+$t*$Y,$S[5]=$i*$Z+$I*$v+$t*$_,$S[6]=$K*$A+$e*$u+$y*$j,$S[7]=$K*$h+$e*$B+$y*$Y,$S[8]=$K*$Z+$e*$v+$y*$_},$Z.lookAt=function($J,$o,$r,$S){$Ao.subtract($J,$o,$Z._tempV30),$Ao.normalize($Z._tempV30,$Z._tempV30),$Ao.cross($r,$Z._tempV30,$Z._tempV31),$Ao.normalize($Z._tempV31,$Z._tempV31),$Ao.cross($Z._tempV30,$Z._tempV31,$Z._tempV32);var $G=$Z._tempV30.elements,$z=$Z._tempV31.elements,$A=$Z._tempV32.elements,$h=$S.elements;$h[0]=$z[0],$h[3]=$z[1],$h[6]=$z[2],$h[1]=$A[0],$h[4]=$A[1],$h[7]=$A[2],$h[2]=$G[0],$h[5]=$G[1],$h[8]=$G[2]},$Z.DEFAULT=new $Z,$v($Z,["_tempV30",function(){return this._tempV30=new $Ao},"_tempV31",function(){return this._tempV31=new $Ao},"_tempV32",function(){return this._tempV32=new $Ao}]),$Z}(),$Jo=function(){function $s($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v,$j,$Y,$_,$D){void 0===$J&&($J=1),void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$z&&($z=1),void 0===$A&&($A=0),void 0===$h&&($h=0),void 0===$Z&&($Z=0),void 0===$u&&($u=0),void 0===$B&&($B=1),void 0===$v&&($v=0),void 0===$j&&($j=0),void 0===$Y&&($Y=0),void 0===$_&&($_=0),void 0===$D&&($D=1);var $N=this.elements=new Float32Array(16);$N[0]=$J,$N[1]=$o,$N[2]=$r,$N[3]=$S,$N[4]=$G,$N[5]=$z,$N[6]=$A,$N[7]=$h,$N[8]=$Z,$N[9]=$u,$N[10]=$B,$N[11]=$v,$N[12]=$j,$N[13]=$Y,$N[14]=$_,$N[15]=$D}$Y($s,"laya.d3.math.Matrix4x4");var $J=$s.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.getElementByRowColumn=function($J,$o){if($J<0||3<$J)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($o<0||3<$o)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$J+$o]},$J.setElementByRowColumn=function($J,$o,$r){if($J<0||3<$J)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($o<0||3<$o)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$J+$o]=$r},$J.equalsOtherMatrix=function($J){var $o=this.elements,$r=$J.elements;return $EJ.nearEqual($o[0],$r[0])&&$EJ.nearEqual($o[1],$r[1])&&$EJ.nearEqual($o[2],$r[2])&&$EJ.nearEqual($o[3],$r[3])&&$EJ.nearEqual($o[4],$r[4])&&$EJ.nearEqual($o[5],$r[5])&&$EJ.nearEqual($o[6],$r[6])&&$EJ.nearEqual($o[7],$r[7])&&$EJ.nearEqual($o[8],$r[8])&&$EJ.nearEqual($o[9],$r[9])&&$EJ.nearEqual($o[10],$r[10])&&$EJ.nearEqual($o[11],$r[11])&&$EJ.nearEqual($o[12],$r[12])&&$EJ.nearEqual($o[13],$r[13])&&$EJ.nearEqual($o[14],$r[14])&&$EJ.nearEqual($o[15],$r[15])},$J.decomposeTransRotScale=function($J,$o,$r){var $S=$s._tempMatrix4x4;return this.decomposeTransRotMatScale($J,$S,$r)?($ro.createFromMatrix4x4($S,$o),!0):($o.identity(),!1)},$J.decomposeTransRotMatScale=function($J,$o,$r){var $S=this.elements,$G=$J.elements,$z=$o.elements,$A=$r.elements;$G[0]=$S[12],$G[1]=$S[13],$G[2]=$S[14];var $h=$S[0],$Z=$S[1],$u=$S[2],$B=$S[4],$v=$S[5],$j=$S[6],$Y=$S[8],$_=$S[9],$D=$S[10],$N=$A[0]=Math.sqrt($h*$h+$Z*$Z+$u*$u),$w=$A[1]=Math.sqrt($B*$B+$v*$v+$j*$j),$i=$A[2]=Math.sqrt($Y*$Y+$_*$_+$D*$D);if($EJ.isZero($N)||$EJ.isZero($w)||$EJ.isZero($i))return $z[1]=$z[2]=$z[3]=$z[4]=$z[6]=$z[7]=$z[8]=$z[9]=$z[11]=$z[12]=$z[13]=$z[14]=0,$z[0]=$z[5]=$z[10]=$z[15]=1,!1;var $I=$s._tempVector0,$t=$I.elements;$t[0]=$Y/$i,$t[1]=$_/$i,$t[2]=$D/$i;var $K=$s._tempVector1,$e=$K.elements;$e[0]=$h/$N,$e[1]=$Z/$N,$e[2]=$u/$N;var $y=$s._tempVector2;$Ao.cross($I,$K,$y);var $g=$s._tempVector1;return $Ao.cross($y,$I,$g),$z[3]=$z[7]=$z[11]=$z[12]=$z[13]=$z[14]=0,$z[15]=1,$z[0]=$g.x,$z[1]=$g.y,$z[2]=$g.z,$z[4]=$y.x,$z[5]=$y.y,$z[6]=$y.z,$z[8]=$I.x,$z[9]=$I.y,$z[10]=$I.z,$z[0]*$h+$z[1]*$Z+$z[2]*$u<0&&($A[0]=-$N),$z[4]*$B+$z[5]*$v+$z[6]*$j<0&&($A[1]=-$w),$z[8]*$Y+$z[9]*$_+$z[10]*$D<0&&($A[2]=-$i),!0},$J.decomposeYawPitchRoll=function($J){var $o=$J.elements,$r=Math.asin(-this.elements[9]);$o[1]=$r,Math.cos($r)>$EJ.zeroTolerance?($o[2]=Math.atan2(this.elements[1],this.elements[5]),$o[0]=Math.atan2(this.elements[8],this.elements[10])):($o[2]=Math.atan2(-this.elements[4],this.elements[0]),$o[0]=0)},$J.normalize=function(){var $J=this.elements,$o=$J[0],$r=$J[1],$S=$J[2],$G=Math.sqrt($o*$o+$r*$r+$S*$S);if(!$G)return $J[0]=0,$J[1]=0,void($J[2]=0);1!=$G&&($G=1/$G,$J[0]=$o*$G,$J[1]=$r*$G,$J[2]=$S*$G)},$J.transpose=function(){var $J,$o;return $o=($J=this.elements)[1],$J[1]=$J[4],$J[4]=$o,$o=$J[2],$J[2]=$J[8],$J[8]=$o,$o=$J[3],$J[3]=$J[12],$J[12]=$o,$o=$J[6],$J[6]=$J[9],$J[9]=$o,$o=$J[7],$J[7]=$J[13],$J[13]=$o,$o=$J[11],$J[11]=$J[14],$J[14]=$o,this},$J.invert=function($J){var $o=this.elements,$r=$J.elements,$S=$o[0],$G=$o[1],$z=$o[2],$A=$o[3],$h=$o[4],$Z=$o[5],$u=$o[6],$B=$o[7],$v=$o[8],$j=$o[9],$Y=$o[10],$_=$o[11],$D=$o[12],$N=$o[13],$w=$o[14],$i=$o[15],$I=$S*$Z-$G*$h,$t=$S*$u-$z*$h,$K=$S*$B-$A*$h,$e=$G*$u-$z*$Z,$y=$G*$B-$A*$Z,$g=$z*$B-$A*$u,$s=$v*$N-$j*$D,$V=$v*$w-$Y*$D,$m=$v*$i-$_*$D,$C=$j*$w-$Y*$N,$R=$j*$i-$_*$N,$n=$Y*$i-$_*$w,$k=$I*$n-$t*$R+$K*$C+$e*$m-$y*$V+$g*$s;0!==Math.abs($k)&&($k=1/$k,$r[0]=($Z*$n-$u*$R+$B*$C)*$k,$r[1]=($z*$R-$G*$n-$A*$C)*$k,$r[2]=($N*$g-$w*$y+$i*$e)*$k,$r[3]=($Y*$y-$j*$g-$_*$e)*$k,$r[4]=($u*$m-$h*$n-$B*$V)*$k,$r[5]=($S*$n-$z*$m+$A*$V)*$k,$r[6]=($w*$K-$D*$g-$i*$t)*$k,$r[7]=($v*$g-$Y*$K+$_*$t)*$k,$r[8]=($h*$R-$Z*$m+$B*$s)*$k,$r[9]=($G*$m-$S*$R-$A*$s)*$k,$r[10]=($D*$y-$N*$K+$i*$I)*$k,$r[11]=($j*$K-$v*$y-$_*$I)*$k,$r[12]=($Z*$V-$h*$C-$u*$s)*$k,$r[13]=($S*$C-$G*$V+$z*$s)*$k,$r[14]=($N*$t-$D*$e-$w*$I)*$k,$r[15]=($v*$e-$j*$t+$Y*$I)*$k)},$J.identity=function(){var $J=this.elements;$J[1]=$J[2]=$J[3]=$J[4]=$J[6]=$J[7]=$J[8]=$J[9]=$J[11]=$J[12]=$J[13]=$J[14]=0,$J[0]=$J[5]=$J[10]=$J[15]=1},$J.cloneTo=function($J){var $o,$r,$S;if(($r=this.elements)!==($S=$J.elements))for($o=0;$o<16;++$o)$S[$o]=$r[$o]},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$J.getTranslationVector=function($J){var $o=this.elements,$r=$J.elements;$r[0]=$o[12],$r[1]=$o[13],$r[2]=$o[14]},$J.setTranslationVector=function($J){var $o=this.elements,$r=$J.elements;$o[12]=$r[0],$o[13]=$r[1],$o[14]=$r[2]},$J.getForward=function($J){var $o=this.elements,$r=$J.elements;$r[0]=-$o[8],$r[1]=-$o[9],$r[2]=-$o[10]},$J.setForward=function($J){var $o=this.elements,$r=$J.elements;$o[8]=-$r[0],$o[9]=-$r[1],$o[10]=-$r[2]},$s.createRotationX=function($J,$o){var $r=$o.elements,$S=Math.sin($J),$G=Math.cos($J);$r[1]=$r[2]=$r[3]=$r[4]=$r[7]=$r[8]=$r[11]=$r[12]=$r[13]=$r[14]=0,$r[0]=$r[15]=1,$r[5]=$r[10]=$G,$r[6]=$S,$r[9]=-$S},$s.createRotationY=function($J,$o){var $r=$o.elements,$S=Math.sin($J),$G=Math.cos($J);$r[1]=$r[3]=$r[4]=$r[6]=$r[7]=$r[9]=$r[11]=$r[12]=$r[13]=$r[14]=0,$r[5]=$r[15]=1,$r[0]=$r[10]=$G,$r[2]=-$S,$r[8]=$S},$s.createRotationZ=function($J,$o){var $r=$o.elements,$S=Math.sin($J),$G=Math.cos($J);$r[2]=$r[3]=$r[6]=$r[7]=$r[8]=$r[9]=$r[11]=$r[12]=$r[13]=$r[14]=0,$r[10]=$r[15]=1,$r[0]=$r[5]=$G,$r[1]=$S,$r[4]=-$S},$s.createRotationYawPitchRoll=function($J,$o,$r,$S){$ro.createFromYawPitchRoll($J,$o,$r,$s._tempQuaternion),$s.createRotationQuaternion($s._tempQuaternion,$S)},$s.createRotationAxis=function($J,$o,$r){var $S=$J.elements,$G=$S[0],$z=$S[1],$A=$S[2],$h=Math.cos($o),$Z=Math.sin($o),$u=$G*$G,$B=$z*$z,$v=$A*$A,$j=$G*$z,$Y=$G*$A,$_=$z*$A,$D=$r.elements;$D[3]=$D[7]=$D[11]=$D[12]=$D[13]=$D[14]=0,$D[15]=1,$D[0]=$u+$h*(1-$u),$D[1]=$j-$h*$j+$Z*$A,$D[2]=$Y-$h*$Y-$Z*$z,$D[4]=$j-$h*$j-$Z*$A,$D[5]=$B+$h*(1-$B),$D[6]=$_-$h*$_+$Z*$G,$D[8]=$Y-$h*$Y+$Z*$z,$D[9]=$_-$h*$_-$Z*$G,$D[10]=$v+$h*(1-$v)},$s.createRotationQuaternion=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$r[0],$z=$r[1],$A=$r[2],$h=$r[3],$Z=$G*$G,$u=$z*$z,$B=$A*$A,$v=$G*$z,$j=$A*$h,$Y=$A*$G,$_=$z*$h,$D=$z*$A,$N=$G*$h;$S[3]=$S[7]=$S[11]=$S[12]=$S[13]=$S[14]=0,$S[15]=1,$S[0]=1-2*($u+$B),$S[1]=2*($v+$j),$S[2]=2*($Y-$_),$S[4]=2*($v-$j),$S[5]=1-2*($B+$Z),$S[6]=2*($D+$N),$S[8]=2*($Y+$_),$S[9]=2*($D-$N),$S[10]=1-2*($u+$Z)},$s.createTranslate=function($J,$o){var $r=$J.elements,$S=$o.elements;$S[4]=$S[8]=$S[1]=$S[9]=$S[2]=$S[6]=$S[3]=$S[7]=$S[11]=0,$S[0]=$S[5]=$S[10]=$S[15]=1,$S[12]=$r[0],$S[13]=$r[1],$S[14]=$r[2]},$s.createScaling=function($J,$o){var $r=$J.elements,$S=$o.elements;$S[0]=$r[0],$S[5]=$r[1],$S[10]=$r[2],$S[1]=$S[4]=$S[8]=$S[12]=$S[9]=$S[13]=$S[2]=$S[6]=$S[14]=$S[3]=$S[7]=$S[11]=0,$S[15]=1},$s.multiply=function($J,$o,$r){var $S,$G,$z,$A,$h,$Z,$u,$B;for($G=$r.elements,$z=$J.elements,$G===($A=$o.elements)&&($A=$A.slice()),$S=0;$S<4;$S++)$h=$z[$S],$Z=$z[$S+4],$u=$z[$S+8],$B=$z[$S+12],$G[$S]=$h*$A[0]+$Z*$A[1]+$u*$A[2]+$B*$A[3],$G[$S+4]=$h*$A[4]+$Z*$A[5]+$u*$A[6]+$B*$A[7],$G[$S+8]=$h*$A[8]+$Z*$A[9]+$u*$A[10]+$B*$A[11],$G[$S+12]=$h*$A[12]+$Z*$A[13]+$u*$A[14]+$B*$A[15]},$s.createFromQuaternion=function($J,$o){var $r=$o.elements,$S=$J.elements,$G=$S[0],$z=$S[1],$A=$S[2],$h=$S[3],$Z=$G+$G,$u=$z+$z,$B=$A+$A,$v=$G*$Z,$j=$z*$Z,$Y=$z*$u,$_=$A*$Z,$D=$A*$u,$N=$A*$B,$w=$h*$Z,$i=$h*$u,$I=$h*$B;$r[0]=1-$Y-$N,$r[1]=$j+$I,$r[2]=$_-$i,$r[3]=0,$r[4]=$j-$I,$r[5]=1-$v-$N,$r[6]=$D+$w,$r[7]=0,$r[8]=$_+$i,$r[9]=$D-$w,$r[10]=1-$v-$Y,$r[11]=0,$r[12]=0,$r[13]=0,$r[14]=0,$r[15]=1},$s.createAffineTransformation=function($J,$o,$r,$S){var $G=$J.elements,$z=$o.elements,$A=$r.elements,$h=$S.elements,$Z=$z[0],$u=$z[1],$B=$z[2],$v=$z[3],$j=$Z+$Z,$Y=$u+$u,$_=$B+$B,$D=$Z*$j,$N=$Z*$Y,$w=$Z*$_,$i=$u*$Y,$I=$u*$_,$t=$B*$_,$K=$v*$j,$e=$v*$Y,$y=$v*$_,$g=$A[0],$s=$A[1],$V=$A[2];$h[0]=(1-($i+$t))*$g,$h[1]=($N+$y)*$g,$h[2]=($w-$e)*$g,$h[3]=0,$h[4]=($N-$y)*$s,$h[5]=(1-($D+$t))*$s,$h[6]=($I+$K)*$s,$h[7]=0,$h[8]=($w+$e)*$V,$h[9]=($I-$K)*$V,$h[10]=(1-($D+$i))*$V,$h[11]=0,$h[12]=$G[0],$h[13]=$G[1],$h[14]=$G[2],$h[15]=1},$s.createLookAt=function($J,$o,$r,$S){var $G=$S.elements,$z=$s._tempVector0,$A=$s._tempVector1,$h=$s._tempVector2;$Ao.subtract($J,$o,$h),$Ao.normalize($h,$h),$Ao.cross($r,$h,$z),$Ao.normalize($z,$z),$Ao.cross($h,$z,$A),$S.identity(),$G[0]=$z.x,$G[4]=$z.y,$G[8]=$z.z,$G[1]=$A.x,$G[5]=$A.y,$G[9]=$A.z,$G[2]=$h.x,$G[6]=$h.y,$G[10]=$h.z,$G[12]=-$Ao.dot($z,$J),$G[13]=-$Ao.dot($A,$J),$G[14]=-$Ao.dot($h,$J)},$s.createPerspective=function($J,$o,$r,$S,$G){var $z=$G.elements,$A=1/Math.tan($J/2),$h=1/($r-$S);$z[0]=$A/$o,$z[5]=$A,$z[10]=($S+$r)*$h,$z[11]=-1,$z[14]=2*$S*$r*$h,$z[1]=$z[2]=$z[3]=$z[4]=$z[6]=$z[7]=$z[8]=$z[9]=$z[12]=$z[13]=$z[15]=0},$s.createOrthoOffCenterRH=function($J,$o,$r,$S,$G,$z,$A){var $h=$A.elements,$Z=1/($J-$o),$u=1/($r-$S),$B=1/($G-$z);$h[1]=$h[2]=$h[3]=$h[4]=$h[6]=$h[7]=$h[8]=$h[9]=$h[11]=0,$h[15]=1,$h[0]=-2*$Z,$h[5]=-2*$u,$h[10]=2*$B,$h[12]=($J+$o)*$Z,$h[13]=($S+$r)*$u,$h[14]=($z+$G)*$B},$s.translation=function($J,$o){var $r=$J.elements,$S=$o.elements;$S[0]=$S[5]=$S[10]=$S[15]=1,$S[12]=$r[0],$S[13]=$r[1],$S[14]=$r[2]},$v($s,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $s},"_tempVector0",function(){return this._tempVector0=new $Ao},"_tempVector1",function(){return this._tempVector1=new $Ao},"_tempVector2",function(){return this._tempVector2=new $Ao},"_tempQuaternion",function(){return this._tempQuaternion=new $ro},"DEFAULT",function(){return this.DEFAULT=new $s},"ZERO",function(){return this.ZERO=new $s(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$s}(),$oo=(function(){function $I($J,$o){this.extents=null,this.transformation=null,this.extents=$J,this.transformation=$o}$Y($I,"laya.d3.math.OrientedBoundBox");var $J=$I.prototype;$J.getCorners=function($J){var $o=$I._tempV30.elements,$r=$I._tempV31.elements,$S=$I._tempV32.elements,$G=this.extents.elements;$o[0]=$G[0],$o[1]=$o[2]=0,$r[1]=$G[1],$r[0]=$r[2]=0,$S[2]=$G[2],$S[0]=$S[1]=0,$Ao.TransformNormal($I._tempV30,this.transformation,$I._tempV30),$Ao.TransformNormal($I._tempV31,this.transformation,$I._tempV31),$Ao.TransformNormal($I._tempV32,this.transformation,$I._tempV32);var $z=$I._tempV33;this.transformation.getTranslationVector($z),$J.length=8,$Ao.add($z,$I._tempV30,$I._tempV34),$Ao.add($I._tempV34,$I._tempV31,$I._tempV34),$Ao.add($I._tempV34,$I._tempV32,$J[0]),$Ao.add($z,$I._tempV30,$I._tempV34),$Ao.add($I._tempV34,$I._tempV31,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV32,$J[1]),$Ao.subtract($z,$I._tempV30,$I._tempV34),$Ao.add($I._tempV34,$I._tempV31,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV32,$J[2]),$Ao.subtract($z,$I._tempV30,$I._tempV34),$Ao.add($I._tempV34,$I._tempV31,$I._tempV34),$Ao.add($I._tempV34,$I._tempV32,$J[3]),$Ao.add($z,$I._tempV30,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV31,$I._tempV34),$Ao.add($I._tempV34,$I._tempV32,$J[4]),$Ao.add($z,$I._tempV30,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV31,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV32,$J[5]),$Ao.subtract($z,$I._tempV30,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV31,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV32,$J[6]),$Ao.subtract($z,$I._tempV30,$I._tempV34),$Ao.subtract($I._tempV34,$I._tempV31,$I._tempV34),$Ao.add($I._tempV34,$I._tempV32,$J[7])},$J.transform=function($J){$Jo.multiply(this.transformation,$J,this.transformation)},$J.scale=function($J){$Ao.multiply(this.extents,$J,this.extents)},$J.translate=function($J){this.transformation.getTranslationVector($I._tempV30),$Ao.add($I._tempV30,$J,$I._tempV31),this.transformation.setTranslationVector($I._tempV31)},$J.Size=function($J){$Ao.scale(this.extents,2,$J)},$J.getSize=function($J){var $o=this.extents.elements;$I._tempV30.x=$o[0],$I._tempV31.y=$o[1],$I._tempV32.z=$o[2],$Ao.TransformNormal($I._tempV30,this.transformation,$I._tempV30),$Ao.TransformNormal($I._tempV31,this.transformation,$I._tempV31),$Ao.TransformNormal($I._tempV31,this.transformation,$I._tempV32);var $r=$J.elements;$r[0]=$Ao.scalarLength($I._tempV30),$r[1]=$Ao.scalarLength($I._tempV31),$r[2]=$Ao.scalarLength($I._tempV32)},$J.getSizeSquared=function($J){var $o=this.extents.elements;$I._tempV30.x=$o[0],$I._tempV31.y=$o[1],$I._tempV32.z=$o[2],$Ao.TransformNormal($I._tempV30,this.transformation,$I._tempV30),$Ao.TransformNormal($I._tempV31,this.transformation,$I._tempV31),$Ao.TransformNormal($I._tempV31,this.transformation,$I._tempV32);var $r=$J.elements;$r[0]=$Ao.scalarLengthSquared($I._tempV30),$r[1]=$Ao.scalarLengthSquared($I._tempV31),$r[2]=$Ao.scalarLengthSquared($I._tempV32)},$J.getCenter=function($J){this.transformation.getTranslationVector($J)},$J.containsPoint=function($J){var $o=this.extents.elements,$r=$o[0],$S=$o[1],$G=$o[2];this.transformation.invert($I._tempM0),$Ao.transformCoordinate($J,$I._tempM0,$I._tempV30);var $z=$I._tempV30.elements,$A=Math.abs($z[0]),$h=Math.abs($z[1]),$Z=Math.abs($z[2]);return $EJ.nearEqual($A,$r)&&$EJ.nearEqual($h,$S)&&$EJ.nearEqual($Z,$G)?2:$A<$r&&$h<$S&&$Z<$G?1:0},$J.containsPoints=function($J){var $o=this.extents.elements,$r=$o[0],$S=$o[1],$G=$o[2];this.transformation.invert($I._tempM0);for(var $z=!0,$A=!1,$h=0;$h<$J.length;$h++){$Ao.transformCoordinate($J[$h],$I._tempM0,$I._tempV30);var $Z=$I._tempV30.elements,$u=Math.abs($Z[0]),$B=Math.abs($Z[1]),$v=Math.abs($Z[2]);$EJ.nearEqual($u,$r)&&$EJ.nearEqual($B,$S)&&$EJ.nearEqual($v,$G)&&($A=!0),$u<$r&&$B<$S&&$v<$G?$A=!0:$z=!1}return $z?1:$A?2:0},$J.containsSphere=function($J,$o){void 0===$o&&($o=!1);var $r=this.extents.elements,$S=$r[0],$G=$r[1],$z=$r[2],$A=$J.radius;this.transformation.invert($I._tempM0),$Ao.transformCoordinate($J.center,$I._tempM0,$I._tempV30);var $h=NaN;if($h=$o?$A:($Ao.scale($Ao.UnitX,$A,$I._tempV31),$Ao.TransformNormal($I._tempV31,$I._tempM0,$I._tempV31),$Ao.scalarLength($I._tempV31)),$Ao.scale(this.extents,-1,$I._tempV32),$Ao.Clamp($I._tempV30,$I._tempV32,this.extents,$I._tempV33),$h*$h<$Ao.distanceSquared($I._tempV30,$I._tempV33))return 0;var $Z=$I._tempV30.elements,$u=$Z[0],$B=$Z[1],$v=$Z[2],$j=$I._tempV32.elements,$Y=$j[0],$_=$j[1],$D=$j[2];return $Y+$h<=$u&&$u<=$S-$h&&$h<$S-$Y&&$_+$h<=$B&&$B<=$G-$h&&$h<$G-$_&&$D+$h<=$v&&$v<=$z-$h&&$h<$z-$D?1:2},$J.containsOrientedBoundBox=function($J){var $o=0,$r=0;$J.getCorners($I._corners);var $S=this.containsPoints($I._corners);if(0!=$S)return $S;var $G=this.extents.elements;$J.extents.cloneTo($I._tempV35);var $z=$I._tempV35.elements;$I._getRows(this.transformation,$I._rows1),$I._getRows($J.transformation,$I._rows2);var $A=NaN;for($o=0;$o<4;$o++)for($r=0;$r<4;$r++)3==$o||3==$r?($I._tempM0.setElementByRowColumn($o,$r,0),$I._tempM1.setElementByRowColumn($o,$r,0)):($A=$Ao.dot($I._rows1[$o],$I._rows2[$r]),$I._tempM0.setElementByRowColumn($o,$r,$A),$I._tempM1.setElementByRowColumn($o,$r,Math.abs($A)));$J.getCenter($I._tempV34),this.getCenter($I._tempV36),$Ao.subtract($I._tempV34,$I._tempV36,$I._tempV30);var $h=$I._tempV31.elements;$h[0]=$Ao.dot($I._tempV30,$I._rows1[0]),$h[1]=$Ao.dot($I._tempV30,$I._rows1[1]),$h[2]=$Ao.dot($I._tempV30,$I._rows1[2]);var $Z=$I._tempV32.elements,$u=$I._tempV33.elements;for($o=0;$o<3;$o++)if($Z[0]=$I._tempM1.getElementByRowColumn($o,0),$Z[1]=$I._tempM1.getElementByRowColumn($o,1),$Z[2]=$I._tempM1.getElementByRowColumn($o,2),$G[$o]+$Ao.dot($I._tempV35,$I._tempV32)<Math.abs($h[$o]))return 0;for($r=0;$r<3;$r++)if($Z[0]=$I._tempM1.getElementByRowColumn(0,$r),$Z[1]=$I._tempM1.getElementByRowColumn(1,$r),$Z[2]=$I._tempM1.getElementByRowColumn(2,$r),$u[0]=$I._tempM0.getElementByRowColumn(0,$r),$u[1]=$I._tempM0.getElementByRowColumn(1,$r),$u[2]=$I._tempM0.getElementByRowColumn(2,$r),$Ao.dot(this.extents,$I._tempV32)+$z[$r]<Math.abs($Ao.dot($I._tempV31,$I._tempV33)))return 0;for($o=0;$o<3;$o++)for($r=0;$r<3;$r++){var $B=($o+1)%3,$v=($o+2)%3,$j=($r+1)%3,$Y=($r+2)%3;if($G[$B]*$I._tempM1.getElementByRowColumn($v,$r)+$G[$v]*$I._tempM1.getElementByRowColumn($B,$r)+($z[$j]*$I._tempM1.getElementByRowColumn($o,$Y)+$z[$Y]*$I._tempM1.getElementByRowColumn($o,$j))<Math.abs($h[$v]*$I._tempM0.getElementByRowColumn($B,$r)-$h[$B]*$I._tempM0.getElementByRowColumn($v,$r)))return 0}return 2},$J.containsLine=function($J,$o){$I._corners[0]=$J,$I._corners[1]=$o;var $r=this.containsPoints($I._corners);if(0!=$r)return $r;var $S=this.extents.elements,$G=$S[0],$z=$S[1],$A=$S[2];this.transformation.invert($I._tempM0),$Ao.transformCoordinate($J,$I._tempM0,$I._tempV30),$Ao.transformCoordinate($o,$I._tempM0,$I._tempV31),$Ao.add($I._tempV30,$I._tempV31,$I._tempV32),$Ao.scale($I._tempV32,.5,$I._tempV32),$Ao.subtract($I._tempV30,$I._tempV32,$I._tempV33);var $h=$I._tempV33.elements,$Z=$h[0],$u=$h[1],$B=$h[2],$v=$I._tempV34.elements,$j=$v[0]=Math.abs($h[0]),$Y=$v[1]=Math.abs($h[1]),$_=$v[2]=Math.abs($h[2]),$D=$I._tempV32.elements,$N=$D[0],$w=$D[1],$i=$D[2];return Math.abs($N)>$G+$j?0:Math.abs($w)>$z+$Y?0:Math.abs($i)>$A+$_?0:Math.abs($w*$B-$i*$u)>$z*$_+$A*$Y?0:Math.abs($N*$B-$i*$Z)>$G*$_+$A*$j?0:Math.abs($N*$u-$w*$Z)>$G*$Y+$z*$j?0:2},$J.containsBoundBox=function($J){var $o=0,$r=0,$S=$J.min,$G=$J.max;$J.getCorners($I._corners);var $z=this.containsPoints($I._corners);if(0!=$z)return $z;$Ao.subtract($G,$S,$I._tempV30),$Ao.scale($I._tempV30,.5,$I._tempV30),$Ao.add($S,$I._tempV30,$I._tempV30),$Ao.subtract($G,$I._tempV30,$I._tempV31);var $A=this.extents.elements,$h=$I._tempV31.elements;$I._getRows(this.transformation,$I._rows1),this.transformation.invert($I._tempM0);for($o=0;$o<3;$o++)for($r=0;$r<3;$r++)$I._tempM1.setElementByRowColumn($o,$r,Math.abs($I._tempM0.getElementByRowColumn($o,$r)));this.getCenter($I._tempV35),$Ao.subtract($I._tempV30,$I._tempV35,$I._tempV32);var $Z=$I._tempV31.elements;$Z[0]=$Ao.dot($I._tempV32,$I._rows1[0]),$Z[1]=$Ao.dot($I._tempV32,$I._rows1[1]),$Z[2]=$Ao.dot($I._tempV32,$I._rows1[2]);var $u=$I._tempV33.elements,$B=$I._tempV34.elements;for($o=0;$o<3;$o++)if($u[0]=$I._tempM1.getElementByRowColumn($o,0),$u[1]=$I._tempM1.getElementByRowColumn($o,1),$u[2]=$I._tempM1.getElementByRowColumn($o,2),$A[$o]+$Ao.dot($I._tempV31,$I._tempV33)<Math.abs($Z[$o]))return 0;for($r=0;$r<3;$r++)if($u[0]=$I._tempM1.getElementByRowColumn(0,$r),$u[1]=$I._tempM1.getElementByRowColumn(1,$r),$u[2]=$I._tempM1.getElementByRowColumn(2,$r),$B[0]=$I._tempM0.getElementByRowColumn(0,$r),$B[1]=$I._tempM0.getElementByRowColumn(1,$r),$B[2]=$I._tempM0.getElementByRowColumn(2,$r),$Ao.dot(this.extents,$I._tempV33)+$h[$r]<Math.abs($Ao.dot($I._tempV31,$I._tempV34)))return 0;for($o=0;$o<3;$o++)for($r=0;$r<3;$r++){var $v=($o+1)%3,$j=($o+2)%3,$Y=($r+1)%3,$_=($r+2)%3;if($A[$v]*$I._tempM1.getElementByRowColumn($j,$r)+$A[$j]*$I._tempM1.getElementByRowColumn($v,$r)+($h[$Y]*$I._tempM1.getElementByRowColumn($o,$_)+$h[$_]*$I._tempM1.getElementByRowColumn($o,$Y))<Math.abs($Z[$j]*$I._tempM0.getElementByRowColumn($v,$r)-$Z[$v]*$I._tempM0.getElementByRowColumn($j,$r)))return 0}return 2},$J.intersectsRay=function($J,$o){$Ao.scale(this.extents,-1,$I._tempV30),this.transformation.invert($I._tempM0),$Ao.TransformNormal($J.direction,$I._tempM0,$I._ray.direction),$Ao.transformCoordinate($J.origin,$I._tempM0,$I._ray.origin),$I._boxBound1.min=$I._tempV30,$I._boxBound1.max=this.extents;var $r=Collision.intersectsRayAndBoxRP($I._ray,$I._boxBound1,$o);return-1!==$r&&$Ao.transformCoordinate($o,this.transformation,$o),$r},$J._getLocalCorners=function($J){$J.length=8;var $o=this.extents.elements;$I._tempV30.x=$o[0],$I._tempV31.y=$o[1],$I._tempV32.z=$o[2],$Ao.add($I._tempV30,$I._tempV31,$I._tempV33),$Ao.add($I._tempV33,$I._tempV32,$J[0]),$Ao.add($I._tempV30,$I._tempV31,$I._tempV33),$Ao.subtract($I._tempV33,$I._tempV32,$J[1]),$Ao.subtract($I._tempV31,$I._tempV30,$I._tempV33),$Ao.subtract($I._tempV33,$I._tempV30,$J[2]),$Ao.subtract($I._tempV31,$I._tempV30,$I._tempV33),$Ao.add($I._tempV33,$I._tempV32,$J[3]),$Ao.subtract($I._tempV30,$I._tempV31,$I._tempV33),$Ao.add($I._tempV33,$I._tempV32,$J[4]),$Ao.subtract($I._tempV30,$I._tempV31,$I._tempV33),$Ao.subtract($I._tempV33,$I._tempV32,$J[5]),$Ao.scale($J[0],-1,$J[6]),$Ao.subtract($I._tempV32,$I._tempV30,$I._tempV33),$Ao.subtract($I._tempV33,$I._tempV31,$J[7])},$J.equals=function($J){return this.extents==$J.extents&&this.transformation==$J.transformation},$J.cloneTo=function($J){var $o=$J;this.extents.cloneTo($o.extents),this.transformation.cloneTo($o.transformation)},$I.createByBoundBox=function($J,$o){var $r=$J.min,$S=$J.max;$Ao.subtract($S,$r,$I._tempV30),$Ao.scale($I._tempV30,.5,$I._tempV30),$Ao.add($r,$I._tempV30,$I._tempV31),$Ao.subtract($S,$I._tempV31,$I._tempV32),$Jo.translation($I._tempV31,$I._tempM0);var $G=$I._tempV32.clone(),$z=$I._tempM0.clone();$o.extents=$G,$o.transformation=$z},$I.createByMinAndMaxVertex=function($J,$o){return $Ao.subtract($o,$J,$I._tempV30),$Ao.scale($I._tempV30,.5,$I._tempV30),$Ao.add($J,$I._tempV30,$I._tempV31),$Ao.subtract($o,$I._tempV31,$I._tempV32),$Jo.translation($I._tempV31,$I._tempM0),new $I($I._tempV32,$I._tempM0)},$I._getRows=function($J,$o){$o.length=3;var $r=$J.elements,$S=$o[0].elements;$S[0]=$r[0],$S[1]=$r[1],$S[2]=$r[2];var $G=$o[1].elements;$G[0]=$r[4],$G[1]=$r[5],$G[2]=$r[6];var $z=$o[2].elements;$z[0]=$r[8],$z[1]=$r[9],$z[2]=$r[10]},$I.getObbtoObbMatrix4x4=function($J,$o,$r,$S){var $G=$J.transformation,$z=$o.transformation;if($r){$I._getRows($G,$I._rows1),$I._getRows($z,$I._rows2);for(var $A=0;$A<3;$A++)for(var $h=0;$h<3;$h++)$S.setElementByRowColumn($A,$h,$Ao.dot($I._rows2[$A],$I._rows1[$h]));$o.getCenter($I._tempV30),$J.getCenter($I._tempV31),$Ao.subtract($I._tempV30,$I._tempV31,$I._tempV32);var $Z=$S.elements;$Z[12]=$Ao.dot($I._tempV32,$I._rows1[0]),$Z[13]=$Ao.dot($I._tempV32,$I._rows1[1]),$Z[14]=$Ao.dot($I._tempV32,$I._rows1[2]),$Z[15]=1}else $G.invert($I._tempM0),$Jo.multiply($z,$I._tempM0,$S)},$I.merge=function($J,$o,$r){var $S=$J.extents,$G=$J.transformation;$I.getObbtoObbMatrix4x4($J,$o,$r,$I._tempM0),$o._getLocalCorners($I._corners),$Ao.transformCoordinate($I._corners[0],$I._tempM0,$I._corners[0]),$Ao.transformCoordinate($I._corners[1],$I._tempM0,$I._corners[1]),$Ao.transformCoordinate($I._corners[2],$I._tempM0,$I._corners[2]),$Ao.transformCoordinate($I._corners[3],$I._tempM0,$I._corners[3]),$Ao.transformCoordinate($I._corners[4],$I._tempM0,$I._corners[4]),$Ao.transformCoordinate($I._corners[5],$I._tempM0,$I._corners[5]),$Ao.transformCoordinate($I._corners[6],$I._tempM0,$I._corners[6]),$Ao.transformCoordinate($I._corners[7],$I._tempM0,$I._corners[7]),$Ao.scale($S,-1,$I._boxBound1.min),$S.cloneTo($I._boxBound1.max),$OJ.createfromPoints($I._corners,$I._boxBound2),$OJ.merge($I._boxBound2,$I._boxBound1,$I._boxBound3);var $z=$I._boxBound3.min,$A=$I._boxBound3.max;$Ao.subtract($A,$z,$I._tempV30),$Ao.scale($I._tempV30,.5,$I._tempV30),$Ao.add($z,$I._tempV30,$I._tempV32),$Ao.subtract($A,$I._tempV32,$S),$Ao.transformCoordinate($I._tempV32,$G,$I._tempV33)},$v($I,["_tempV30",function(){return this._tempV30=new $Ao},"_tempV31",function(){return this._tempV31=new $Ao},"_tempV32",function(){return this._tempV32=new $Ao},"_tempV33",function(){return this._tempV33=new $Ao},"_tempV34",function(){return this._tempV34=new $Ao},"_tempV35",function(){return this._tempV35=new $Ao},"_tempV36",function(){return this._tempV36=new $Ao},"_tempM0",function(){return this._tempM0=new $Jo},"_tempM1",function(){return this._tempM1=new $Jo},"_corners",function(){return this._corners=[new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao]},"_rows1",function(){return this._rows1=[new $Ao,new $Ao,new $Ao]},"_rows2",function(){return this._rows2=[new $Ao,new $Ao,new $Ao]},"_ray",function(){return this._ray=new $Go(new $Ao,new $Ao)},"_boxBound1",function(){return this._boxBound1=new $OJ(new $Ao,new $Ao)},"_boxBound2",function(){return this._boxBound2=new $OJ(new $Ao,new $Ao)},"_boxBound3",function(){return this._boxBound3=new $OJ(new $Ao,new $Ao)}])}(),function(){function $K($J,$o){this.normal=null,this.distance=NaN,void 0===$o&&($o=0),this.normal=$J,this.distance=$o}return $Y($K,"laya.d3.math.Plane"),$K.prototype.normalize=function(){var $J=this.normal.elements,$o=$J[0],$r=$J[1],$S=$J[2],$G=1/Math.sqrt($o*$o+$r*$r+$S*$S);$J[0]=$o*$G,$J[1]=$r*$G,$J[2]=$S*$G,this.distance*=$G},$K.createPlaneBy3P=function($J,$o,$r){var $S=$J.elements,$G=$o.elements,$z=$r.elements,$A=$G[0]-$S[0],$h=$G[1]-$S[1],$Z=$G[2]-$S[2],$u=$z[0]-$S[0],$B=$z[1]-$S[1],$v=$z[2]-$S[2],$j=$h*$v-$Z*$B,$Y=$Z*$u-$A*$v,$_=$A*$B-$h*$u,$D=1/Math.sqrt($j*$j+$Y*$Y+$_*$_),$N=$j*$D,$w=$Y*$D,$i=$_*$D,$I=$K._TEMPVec3.elements;$I[0]=$N,$I[1]=$w,$I[2]=$i;var $t=-($N*$S[0]+$w*$S[1]+$i*$S[2]);return new $K($K._TEMPVec3,$t)},$K.PlaneIntersectionType_Back=0,$K.PlaneIntersectionType_Front=1,$K.PlaneIntersectionType_Intersecting=2,$v($K,["_TEMPVec3",function(){return this._TEMPVec3=new $Ao}]),$K}()),$ro=function(){function $G($J,$o,$r,$S){this.elements=new Float32Array(4),void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=1),this.elements[0]=$J,this.elements[1]=$o,this.elements[2]=$r,this.elements[3]=$S}$Y($G,"laya.d3.math.Quaternion");var $J=$G.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.scaling=function($J,$o){var $r=$o.elements,$S=this.elements;$r[0]=$S[0]*$J,$r[1]=$S[1]*$J,$r[2]=$S[2]*$J,$r[3]=$S[3]*$J},$J.normalize=function($J){var $o=$J.elements,$r=this.elements,$S=$r[0],$G=$r[1],$z=$r[2],$A=$r[3],$h=$S*$S+$G*$G+$z*$z+$A*$A;0<$h&&($h=1/Math.sqrt($h),$o[0]=$S*$h,$o[1]=$G*$h,$o[2]=$z*$h,$o[3]=$A*$h)},$J.length=function(){var $J=this.elements,$o=$J[0],$r=$J[1],$S=$J[2],$G=$J[3];return Math.sqrt($o*$o+$r*$r+$S*$S+$G*$G)},$J.rotateX=function($J,$o){var $r=$o.elements,$S=this.elements;$J*=.5;var $G=$S[0],$z=$S[1],$A=$S[2],$h=$S[3],$Z=Math.sin($J),$u=Math.cos($J);$r[0]=$G*$u+$h*$Z,$r[1]=$z*$u+$A*$Z,$r[2]=$A*$u-$z*$Z,$r[3]=$h*$u-$G*$Z},$J.rotateY=function($J,$o){var $r=$o.elements,$S=this.elements;$J*=.5;var $G=$S[0],$z=$S[1],$A=$S[2],$h=$S[3],$Z=Math.sin($J),$u=Math.cos($J);$r[0]=$G*$u-$A*$Z,$r[1]=$z*$u+$h*$Z,$r[2]=$A*$u+$G*$Z,$r[3]=$h*$u-$z*$Z},$J.rotateZ=function($J,$o){var $r=$o.elements,$S=this.elements;$J*=.5;var $G=$S[0],$z=$S[1],$A=$S[2],$h=$S[3],$Z=Math.sin($J),$u=Math.cos($J);$r[0]=$G*$u+$z*$Z,$r[1]=$z*$u-$G*$Z,$r[2]=$A*$u+$h*$Z,$r[3]=$h*$u-$A*$Z},$J.getYawPitchRoll=function($J){$Ao.transformQuat($Ao.ForwardRH,this,$G.TEMPVector31),$Ao.transformQuat($Ao.Up,this,$G.TEMPVector32);var $o=$G.TEMPVector32.elements;$G.angleTo($Ao.ZERO,$G.TEMPVector31,$G.TEMPVector33);var $r=$G.TEMPVector33.elements;$r[0]==Math.PI/2?($r[1]=$G.arcTanAngle($o[2],$o[0]),$r[2]=0):$r[0]==-Math.PI/2?($r[1]=$G.arcTanAngle(-$o[2],-$o[0]),$r[2]=0):($Jo.createRotationY(-$r[1],$G.TEMPMatrix0),$Jo.createRotationX(-$r[0],$G.TEMPMatrix1),$Ao.transformCoordinate($G.TEMPVector32,$G.TEMPMatrix0,$G.TEMPVector32),$Ao.transformCoordinate($G.TEMPVector32,$G.TEMPMatrix1,$G.TEMPVector32),$r[2]=$G.arcTanAngle($o[1],-$o[0])),$r[1]<=-Math.PI&&($r[1]=Math.PI),$r[2]<=-Math.PI&&($r[2]=Math.PI),$r[1]>=Math.PI&&$r[2]>=Math.PI&&($r[1]=0,$r[2]=0,$r[0]=Math.PI-$r[0]);var $S=$J.elements;$S[0]=$r[1],$S[1]=$r[0],$S[2]=$r[2]},$J.invert=function($J){var $o=$J.elements,$r=this.elements,$S=$r[0],$G=$r[1],$z=$r[2],$A=$r[3],$h=$S*$S+$G*$G+$z*$z+$A*$A,$Z=$h?1/$h:0;$o[0]=-$S*$Z,$o[1]=-$G*$Z,$o[2]=-$z*$Z,$o[3]=$A*$Z},$J.identity=function(){var $J=this.elements;$J[0]=0,$J[1]=0,$J[2]=0,$J[3]=1},$J.fromArray=function($J,$o){void 0===$o&&($o=0),this.elements[0]=$J[$o+0],this.elements[1]=$J[$o+1],this.elements[2]=$J[$o+2],this.elements[3]=$J[$o+3]},$J.cloneTo=function($J){var $o,$r,$S;if(($r=this.elements)!==($S=$J.elements))for($o=0;$o<4;++$o)$S[$o]=$r[$o]},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$J.equals=function($J){var $o=this.elements,$r=$J.elements;return $EJ.nearEqual($o[0],$r[0])&&$EJ.nearEqual($o[1],$r[1])&&$EJ.nearEqual($o[2],$r[2])&&$EJ.nearEqual($o[3],$r[3])},$J.lengthSquared=function(){var $J=this.elements[0],$o=this.elements[1],$r=this.elements[2],$S=this.elements[3];return $J*$J+$o*$o+$r*$r+$S*$S},$_(0,$J,"x",function(){return this.elements[0]}),$_(0,$J,"y",function(){return this.elements[1]}),$_(0,$J,"z",function(){return this.elements[2]}),$_(0,$J,"w",function(){return this.elements[3]}),$G.createFromYawPitchRoll=function($J,$o,$r,$S){var $G=.5*$r,$z=.5*$o,$A=.5*$J,$h=Math.sin($G),$Z=Math.cos($G),$u=Math.sin($z),$B=Math.cos($z),$v=Math.sin($A),$j=Math.cos($A),$Y=$S.elements;$Y[0]=$j*$u*$Z+$v*$B*$h,$Y[1]=$v*$B*$Z-$j*$u*$h,$Y[2]=$j*$B*$h-$v*$u*$Z,$Y[3]=$j*$B*$Z+$v*$u*$h},$G.multiply=function($J,$o,$r){var $S=$J.elements,$G=$o.elements,$z=$r.elements,$A=$S[0],$h=$S[1],$Z=$S[2],$u=$S[3],$B=$G[0],$v=$G[1],$j=$G[2],$Y=$G[3],$_=$h*$j-$Z*$v,$D=$Z*$B-$A*$j,$N=$A*$v-$h*$B,$w=$A*$B+$h*$v+$Z*$j;$z[0]=$A*$Y+$B*$u+$_,$z[1]=$h*$Y+$v*$u+$D,$z[2]=$Z*$Y+$j*$u+$N,$z[3]=$u*$Y-$w},$G.arcTanAngle=function($J,$o){return 0==$J?1==$o?Math.PI/2:-Math.PI/2:0<$J?Math.atan($o/$J):$J<0?0<$o?Math.atan($o/$J)+Math.PI:Math.atan($o/$J)-Math.PI:0},$G.angleTo=function($J,$o,$r){$Ao.subtract($o,$J,$G.TEMPVector30),$Ao.normalize($G.TEMPVector30,$G.TEMPVector30),$r.elements[0]=Math.asin($G.TEMPVector30.y),$r.elements[1]=$G.arcTanAngle(-$G.TEMPVector30.z,-$G.TEMPVector30.x)},$G.createFromAxisAngle=function($J,$o,$r){var $S=$r.elements,$G=$J.elements;$o*=.5;var $z=Math.sin($o);$S[0]=$z*$G[0],$S[1]=$z*$G[1],$S[2]=$z*$G[2],$S[3]=Math.cos($o)},$G.createFromMatrix3x3=function($J,$o){var $r,$S=$o.elements,$G=$J.elements,$z=$G[0]+$G[4]+$G[8];if(0<$z)$r=Math.sqrt($z+1),$S[3]=.5*$r,$r=.5/$r,$S[0]=($G[5]-$G[7])*$r,$S[1]=($G[6]-$G[2])*$r,$S[2]=($G[1]-$G[3])*$r;else{var $A=0;$G[4]>$G[0]&&($A=1),$G[8]>$G[3*$A+$A]&&($A=2);var $h=($A+1)%3,$Z=($A+2)%3;$r=Math.sqrt($G[3*$A+$A]-$G[3*$h+$h]-$G[3*$Z+$Z]+1),$S[$A]=.5*$r,$r=.5/$r,$S[3]=($G[3*$h+$Z]-$G[3*$Z+$h])*$r,$S[$h]=($G[3*$h+$A]+$G[3*$A+$h])*$r,$S[$Z]=($G[3*$Z+$A]+$G[3*$A+$Z])*$r}},$G.createFromMatrix4x4=function($J,$o){var $r,$S,$G=$J.elements,$z=$o.elements,$A=$G[0]+$G[5]+$G[10];0<$A?($r=Math.sqrt($A+1),$z[3]=.5*$r,$r=.5/$r,$z[0]=($G[6]-$G[9])*$r,$z[1]=($G[8]-$G[2])*$r,$z[2]=($G[1]-$G[4])*$r):$G[0]>=$G[5]&&$G[0]>=$G[10]?($S=.5/($r=Math.sqrt(1+$G[0]-$G[5]-$G[10])),$z[0]=.5*$r,$z[1]=($G[1]+$G[4])*$S,$z[2]=($G[2]+$G[8])*$S,$z[3]=($G[6]-$G[9])*$S):$G[5]>$G[10]?($S=.5/($r=Math.sqrt(1+$G[5]-$G[0]-$G[10])),$z[0]=($G[4]+$G[1])*$S,$z[1]=.5*$r,$z[2]=($G[9]+$G[6])*$S,$z[3]=($G[8]-$G[2])*$S):($S=.5/($r=Math.sqrt(1+$G[10]-$G[0]-$G[5])),$z[0]=($G[8]+$G[2])*$S,$z[1]=($G[9]+$G[6])*$S,$z[2]=.5*$r,$z[3]=($G[1]-$G[4])*$S)},$G.slerp=function($J,$o,$r,$S){var $G,$z,$A,$h,$Z,$u=$J.elements,$B=$o.elements,$v=$S.elements,$j=$u[0],$Y=$u[1],$_=$u[2],$D=$u[3],$N=$B[0],$w=$B[1],$i=$B[2],$I=$B[3];return($z=$j*$N+$Y*$w+$_*$i+$D*$I)<0&&($z=-$z,$N=-$N,$w=-$w,$i=-$i,$I=-$I),$Z=1e-6<1-$z?($G=Math.acos($z),$A=Math.sin($G),$h=Math.sin((1-$r)*$G)/$A,Math.sin($r*$G)/$A):($h=1-$r,$r),$v[0]=$h*$j+$Z*$N,$v[1]=$h*$Y+$Z*$w,$v[2]=$h*$_+$Z*$i,$v[3]=$h*$D+$Z*$I,$v},$G.lerp=function($J,$o,$r,$S){var $G=$S.elements,$z=$J.elements,$A=$o.elements,$h=$z[0],$Z=$z[1],$u=$z[2],$B=$z[3];$G[0]=$h+$r*($A[0]-$h),$G[1]=$Z+$r*($A[1]-$Z),$G[2]=$u+$r*($A[2]-$u),$G[3]=$B+$r*($A[3]-$B)},$G.add=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]+$z[0],$S[1]=$G[1]+$z[1],$S[2]=$G[2]+$z[2],$S[3]=$G[3]+$z[3]},$G.dot=function($J,$o){var $r=$J.elements,$S=$o.elements;return $r[0]*$S[0]+$r[1]*$S[1]+$r[2]*$S[2]+$r[3]*$S[3]},$G.rotationLookAt=function($J,$o,$r){$G.lookAt($Ao.ZERO,$J,$o,$r)},$G.lookAt=function($J,$o,$r,$S){$XJ.lookAt($J,$o,$r,$G._tempMatrix3x3),$G.rotationMatrix($G._tempMatrix3x3,$S)},$G.invert=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$J.lengthSquared();$EJ.isZero($G)||($G=1/$G,$S[0]=-$r[0]*$G,$S[1]=-$r[1]*$G,$S[2]=-$r[2]*$G,$S[3]=$r[3]*$G)},$G.rotationMatrix=function($J,$o){var $r=$J.elements,$S=$r[0],$G=$r[1],$z=$r[2],$A=$r[3],$h=$r[4],$Z=$r[5],$u=$r[6],$B=$r[7],$v=$r[8],$j=$o.elements,$Y=NaN,$_=NaN,$D=$S+$h+$v;0<$D?($Y=Math.sqrt($D+1),$j[3]=.5*$Y,$Y=.5/$Y,$j[0]=($Z-$B)*$Y,$j[1]=($u-$z)*$Y,$j[2]=($G-$A)*$Y):$h<=$S&&$v<=$S?($_=.5/($Y=Math.sqrt(1+$S-$h-$v)),$j[0]=.5*$Y,$j[1]=($G+$A)*$_,$j[2]=($z+$u)*$_,$j[3]=($Z-$B)*$_):$v<$h?($_=.5/($Y=Math.sqrt(1+$h-$S-$v)),$j[0]=($A+$G)*$_,$j[1]=.5*$Y,$j[2]=($B+$Z)*$_,$j[3]=($u-$z)*$_):($_=.5/($Y=Math.sqrt(1+$v-$S-$h)),$j[0]=($u+$z)*$_,$j[1]=($B+$Z)*$_,$j[2]=.5*$Y,$j[3]=($G-$A)*$_)},$G.DEFAULT=new $G,$v($G,["TEMPVector30",function(){return this.TEMPVector30=new $Ao},"TEMPVector31",function(){return this.TEMPVector31=new $Ao},"TEMPVector32",function(){return this.TEMPVector32=new $Ao},"TEMPVector33",function(){return this.TEMPVector33=new $Ao},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $Jo},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $Jo},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $XJ},"NAN",function(){return this.NAN=new $G(NaN,NaN,NaN,NaN)}]),$G}(),$So=function(){function $J($J){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$J,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$Y($J,"laya.d3.math.Rand");var $o=$J.prototype;return $o.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$o.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$o.getSignedFloat=function(){return 2*this.getFloat()-1},$_(0,$o,"seed",function(){return this.seeds[0]},function($J){this.seeds[0]=$J,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$J.getFloatFromInt=function($J){return 1/8388607*(8388607&$J)},$J.getByteFromInt=function($J){return(8388607&$J)>>>15},$J}(),$Go=(function(){function $G($J){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($J instanceof Array)||4!==$J.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$J[0],this._state0L=0|$J[1],this._state1U=0|$J[2],this._state1L=0|$J[3]}$Y($G,"laya.d3.math.RandX");var $J=$G.prototype;$J.randomint=function(){var $J=this._state0U,$o=this._state0L,$r=this._state1U,$S=this._state1L,$G=($S>>>0)+($o>>>0),$z=$r+$J+($G/2>>>31)>>>0,$A=$G>>>0,$h=0,$Z=0;$h=($J^=$h=$J<<23|(-512&$o)>>>9)^(this._state0U=$r),$Z=($o^=$Z=$o<<23)^(this._state0L=$S);$h^=$J>>>18,$Z^=$o>>>18|(262143&$J)<<14;return $h^=$r>>>5,$Z^=$S>>>5|(31&$r)<<27,this._state1U=$h,this._state1L=$Z,[$z,$A]},$J.random=function(){var $J=this.randomint(),$o=$J[0],$r=1023<<20|$o>>>12,$S=0|($J[1]>>>12|(4095&$o)<<20);return $G._CONVERTION_BUFFER.setUint32(0,$r,!1),$G._CONVERTION_BUFFER.setUint32(4,$S,!1),$So._CONVERTION_BUFFER.getFloat64(0,!1)-1},$v($G,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $So([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $J($J,$o){this.origin=null,this.direction=null,this.origin=$J,this.direction=$o}return $Y($J,"laya.d3.math.Ray"),$J}()),$zo=function(){function $J($J,$o){this.elements=new Float32Array(2),void 0===$J&&($J=0),void 0===$o&&($o=0);var $r=this.elements;$r[0]=$J,$r[1]=$o}$Y($J,"laya.d3.math.Vector2");var $o=$J.prototype;return $K.imps($o,{"laya.d3.core.IClone":!0}),$o.fromArray=function($J,$o){void 0===$o&&($o=0),this.elements[0]=$J[$o+0],this.elements[1]=$J[$o+1]},$o.cloneTo=function($J){var $o=$J.elements,$r=this.elements;$o[0]=$r[0],$o[1]=$r[1]},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"x",function(){return this.elements[0]},function($J){this.elements[0]=$J}),$_(0,$o,"y",function(){return this.elements[1]},function($J){this.elements[1]=$J}),$J.scale=function($J,$o,$r){var $S=$r.elements,$G=$J.elements;$S[0]=$G[0]*$o,$S[1]=$G[1]*$o},$v($J,["ZERO",function(){return this.ZERO=new $J(0,0)},"ONE",function(){return this.ONE=new $J(1,1)}]),$J}(),$Ao=function(){function $B($J,$o,$r){this.elements=new Float32Array(3),void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0);var $S=this.elements;$S[0]=$J,$S[1]=$o,$S[2]=$r}$Y($B,"laya.d3.math.Vector3");var $J=$B.prototype;return $K.imps($J,{"laya.d3.core.IClone":!0}),$J.fromArray=function($J,$o){void 0===$o&&($o=0),this.elements[0]=$J[$o+0],this.elements[1]=$J[$o+1],this.elements[2]=$J[$o+2]},$J.cloneTo=function($J){var $o=$J.elements,$r=this.elements;$o[0]=$r[0],$o[1]=$r[1],$o[2]=$r[2]},$J.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$J.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$J.reset=function($J,$o,$r){this.elements[0]=$J,this.elements[1]=$o,this.elements[2]=$r},$_(0,$J,"x",function(){return this.elements[0]},function($J){this.elements[0]=$J}),$_(0,$J,"y",function(){return this.elements[1]},function($J){this.elements[1]=$J}),$_(0,$J,"z",function(){return this.elements[2]},function($J){this.elements[2]=$J}),$B.distanceSquared=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$r[0]-$S[0],$z=$r[1]-$S[1],$A=$r[2]-$S[2];return $G*$G+$z*$z+$A*$A},$B.distance=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$r[0]-$S[0],$z=$r[1]-$S[1],$A=$r[2]-$S[2];return Math.sqrt($G*$G+$z*$z+$A*$A)},$B.min=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=Math.min($G[0],$z[0]),$S[1]=Math.min($G[1],$z[1]),$S[2]=Math.min($G[2],$z[2])},$B.max=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=Math.max($G[0],$z[0]),$S[1]=Math.max($G[1],$z[1]),$S[2]=Math.max($G[2],$z[2])},$B.transformQuat=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements,$A=$G[0],$h=$G[1],$Z=$G[2],$u=$z[0],$B=$z[1],$v=$z[2],$j=$z[3],$Y=$j*$A+$B*$Z-$v*$h,$_=$j*$h+$v*$A-$u*$Z,$D=$j*$Z+$u*$h-$B*$A,$N=-$u*$A-$B*$h-$v*$Z;$S[0]=$Y*$j+$N*-$u+$_*-$v-$D*-$B,$S[1]=$_*$j+$N*-$B+$D*-$u-$Y*-$v,$S[2]=$D*$j+$N*-$v+$Y*-$B-$_*-$u},$B.scalarLength=function($J){var $o=$J.elements,$r=$o[0],$S=$o[1],$G=$o[2];return Math.sqrt($r*$r+$S*$S+$G*$G)},$B.scalarLengthSquared=function($J){var $o=$J.elements,$r=$o[0],$S=$o[1],$G=$o[2];return $r*$r+$S*$S+$G*$G},$B.normalize=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$r[0],$z=$r[1],$A=$r[2],$h=$G*$G+$z*$z+$A*$A;0<$h&&($h=1/Math.sqrt($h),$S[0]=$r[0]*$h,$S[1]=$r[1]*$h,$S[2]=$r[2]*$h)},$B.multiply=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]*$z[0],$S[1]=$G[1]*$z[1],$S[2]=$G[2]*$z[2]},$B.scale=function($J,$o,$r){var $S=$r.elements,$G=$J.elements;$S[0]=$G[0]*$o,$S[1]=$G[1]*$o,$S[2]=$G[2]*$o},$B.lerp=function($J,$o,$r,$S){var $G=$S.elements,$z=$J.elements,$A=$o.elements,$h=$z[0],$Z=$z[1],$u=$z[2];$G[0]=$h+$r*($A[0]-$h),$G[1]=$Z+$r*($A[1]-$Z),$G[2]=$u+$r*($A[2]-$u)},$B.transformV3ToV3=function($J,$o,$r){var $S=$B._tempVector4;$B.transformV3ToV4($J,$o,$S);var $G=$S.elements,$z=$r.elements;$z[0]=$G[0],$z[1]=$G[1],$z[2]=$G[2]},$B.transformV3ToV4=function($J,$o,$r){var $S=$J.elements,$G=$S[0],$z=$S[1],$A=$S[2],$h=$o.elements,$Z=$r.elements;$Z[0]=$G*$h[0]+$z*$h[4]+$A*$h[8]+$h[12],$Z[1]=$G*$h[1]+$z*$h[5]+$A*$h[9]+$h[13],$Z[2]=$G*$h[2]+$z*$h[6]+$A*$h[10]+$h[14],$Z[3]=$G*$h[3]+$z*$h[7]+$A*$h[11]+$h[15]},$B.TransformNormal=function($J,$o,$r){var $S=$J.elements,$G=$S[0],$z=$S[1],$A=$S[2],$h=$o.elements,$Z=$r.elements;$Z[0]=$G*$h[0]+$z*$h[4]+$A*$h[8],$Z[1]=$G*$h[1]+$z*$h[5]+$A*$h[9],$Z[2]=$G*$h[2]+$z*$h[6]+$A*$h[10]},$B.transformCoordinate=function($J,$o,$r){var $S=$B._tempVector4.elements,$G=$J.elements,$z=$G[0],$A=$G[1],$h=$G[2],$Z=$o.elements;$S[0]=$z*$Z[0]+$A*$Z[4]+$h*$Z[8]+$Z[12],$S[1]=$z*$Z[1]+$A*$Z[5]+$h*$Z[9]+$Z[13],$S[2]=$z*$Z[2]+$A*$Z[6]+$h*$Z[10]+$Z[14],$S[3]=1/($z*$Z[3]+$A*$Z[7]+$h*$Z[11]+$Z[15]);var $u=$r.elements;$u[0]=$S[0]*$S[3],$u[1]=$S[1]*$S[3],$u[2]=$S[2]*$S[3]},$B.Clamp=function($J,$o,$r,$S){var $G=$J.elements,$z=$G[0],$A=$G[1],$h=$G[2],$Z=$o.elements,$u=$Z[0],$B=$Z[1],$v=$Z[2],$j=$r.elements,$Y=$j[0],$_=$j[1],$D=$j[2],$N=$S.elements;$z=($z=$Y<$z?$Y:$z)<$u?$u:$z,$A=($A=$_<$A?$_:$A)<$B?$B:$A,$h=($h=$D<$h?$D:$h)<$v?$v:$h,$N[0]=$z,$N[1]=$A,$N[2]=$h},$B.add=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]+$z[0],$S[1]=$G[1]+$z[1],$S[2]=$G[2]+$z[2]},$B.subtract=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]-$z[0],$S[1]=$G[1]-$z[1],$S[2]=$G[2]-$z[2]},$B.cross=function($J,$o,$r){var $S=$J.elements,$G=$o.elements,$z=$r.elements,$A=$S[0],$h=$S[1],$Z=$S[2],$u=$G[0],$B=$G[1],$v=$G[2];$z[0]=$h*$v-$Z*$B,$z[1]=$Z*$u-$A*$v,$z[2]=$A*$B-$h*$u},$B.dot=function($J,$o){var $r=$J.elements,$S=$o.elements;return $r[0]*$S[0]+$r[1]*$S[1]+$r[2]*$S[2]},$B.equals=function($J,$o){var $r=$J.elements,$S=$o.elements;return $EJ.nearEqual(Math.abs($r[0]),Math.abs($S[0]))&&$EJ.nearEqual(Math.abs($r[1]),Math.abs($S[1]))&&$EJ.nearEqual(Math.abs($r[2]),Math.abs($S[2]))},$B.ZERO=new $B(0,0,0),$B.ONE=new $B(1,1,1),$B.NegativeUnitX=new $B(-1,0,0),$B.UnitX=new $B(1,0,0),$B.UnitY=new $B(0,1,0),$B.UnitZ=new $B(0,0,1),$B.ForwardRH=new $B(0,0,-1),$B.ForwardLH=new $B(0,0,1),$B.Up=new $B(0,1,0),$B.NAN=new $B(NaN,NaN,NaN),$v($B,["_tempVector4",function(){return this._tempVector4=new $ho}]),$B}(),$ho=function(){function $J($J,$o,$r,$S){this.elements=new Float32Array(4),void 0===$J&&($J=0),void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=0);var $G=this.elements;$G[0]=$J,$G[1]=$o,$G[2]=$r,$G[3]=$S}$Y($J,"laya.d3.math.Vector4");var $o=$J.prototype;return $K.imps($o,{"laya.d3.core.IClone":!0}),$o.fromArray=function($J,$o){void 0===$o&&($o=0),this.elements[0]=$J[$o+0],this.elements[1]=$J[$o+1],this.elements[2]=$J[$o+2],this.elements[3]=$J[$o+3]},$o.cloneTo=function($J){var $o=$J.elements,$r=this.elements;$o[0]=$r[0],$o[1]=$r[1],$o[2]=$r[2],$o[3]=$r[3]},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$o.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$o.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$_(0,$o,"x",function(){return this.elements[0]},function($J){this.elements[0]=$J}),$_(0,$o,"y",function(){return this.elements[1]},function($J){this.elements[1]=$J}),$_(0,$o,"z",function(){return this.elements[2]},function($J){this.elements[2]=$J}),$_(0,$o,"w",function(){return this.elements[3]},function($J){this.elements[3]=$J}),$J.lerp=function($J,$o,$r,$S){var $G=$S.elements,$z=$J.elements,$A=$o.elements,$h=$z[0],$Z=$z[1],$u=$z[2],$B=$z[3];$G[0]=$h+$r*($A[0]-$h),$G[1]=$Z+$r*($A[1]-$Z),$G[2]=$u+$r*($A[2]-$u),$G[3]=$B+$r*($A[3]-$B)},$J.transformByM4x4=function($J,$o,$r){var $S=$J.elements,$G=$S[0],$z=$S[1],$A=$S[2],$h=$S[3],$Z=$o.elements,$u=$r.elements;$u[0]=$G*$Z[0]+$z*$Z[4]+$A*$Z[8]+$h*$Z[12],$u[1]=$G*$Z[1]+$z*$Z[5]+$A*$Z[9]+$h*$Z[13],$u[2]=$G*$Z[2]+$z*$Z[6]+$A*$Z[10]+$h*$Z[14],$u[3]=$G*$Z[3]+$z*$Z[7]+$A*$Z[11]+$h*$Z[15]},$J.equals=function($J,$o){var $r=$J.elements,$S=$o.elements;return $EJ.nearEqual(Math.abs($r[0]),Math.abs($S[0]))&&$EJ.nearEqual(Math.abs($r[1]),Math.abs($S[1]))&&$EJ.nearEqual(Math.abs($r[2]),Math.abs($S[2]))&&$EJ.nearEqual(Math.abs($r[3]),Math.abs($S[3]))},$J.normalize=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$J.length();0<$G&&($S[0]=$r[0]*$G,$S[1]=$r[1]*$G,$S[2]=$r[2]*$G,$S[3]=$r[3]*$G)},$J.add=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]+$z[0],$S[1]=$G[1]+$z[1],$S[2]=$G[2]+$z[2],$S[3]=$G[3]+$z[3]},$J.subtract=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]-$z[0],$S[1]=$G[1]-$z[1],$S[2]=$G[2]-$z[2],$S[3]=$G[3]-$z[3]},$J.multiply=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=$G[0]*$z[0],$S[1]=$G[1]*$z[1],$S[2]=$G[2]*$z[2],$S[3]=$G[3]*$z[3]},$J.scale=function($J,$o,$r){var $S=$r.elements,$G=$J.elements;$S[0]=$G[0]*$o,$S[1]=$G[1]*$o,$S[2]=$G[2]*$o,$S[3]=$G[3]*$o},$J.Clamp=function($J,$o,$r,$S){var $G=$J.elements,$z=$G[0],$A=$G[1],$h=$G[2],$Z=$G[3],$u=$o.elements,$B=$u[0],$v=$u[1],$j=$u[2],$Y=$u[3],$_=$r.elements,$D=$_[0],$N=$_[1],$w=$_[2],$i=$_[3],$I=$S.elements;$z=($z=$D<$z?$D:$z)<$B?$B:$z,$A=($A=$N<$A?$N:$A)<$v?$v:$A,$h=($h=$w<$h?$w:$h)<$j?$j:$h,$Z=($Z=$i<$Z?$i:$Z)<$Y?$Y:$Z,$I[0]=$z,$I[1]=$A,$I[2]=$h,$I[3]=$Z},$J.distanceSquared=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$r[0]-$S[0],$z=$r[1]-$S[1],$A=$r[2]-$S[2],$h=$r[3]-$S[3];return $G*$G+$z*$z+$A*$A+$h*$h},$J.distance=function($J,$o){var $r=$J.elements,$S=$o.elements,$G=$r[0]-$S[0],$z=$r[1]-$S[1],$A=$r[2]-$S[2],$h=$r[3]-$S[3];return Math.sqrt($G*$G+$z*$z+$A*$A+$h*$h)},$J.dot=function($J,$o){var $r=$J.elements,$S=$o.elements;return $r[0]*$S[0]+$r[1]*$S[1]+$r[2]*$S[2]+$r[3]*$S[3]},$J.min=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=Math.min($G[0],$z[0]),$S[1]=Math.min($G[1],$z[1]),$S[2]=Math.min($G[2],$z[2]),$S[3]=Math.min($G[3],$z[3])},$J.max=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o.elements;$S[0]=Math.max($G[0],$z[0]),$S[1]=Math.max($G[1],$z[1]),$S[2]=Math.max($G[2],$z[2]),$S[3]=Math.max($G[3],$z[3])},$v($J,["ZERO",function(){return this.ZERO=new $J},"ONE",function(){return this.ONE=new $J(1,1,1,1)},"UnitX",function(){return this.UnitX=new $J(1,0,0,0)},"UnitY",function(){return this.UnitY=new $J(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $J(0,0,1,0)},"UnitW",function(){return this.UnitW=new $J(0,0,0,1)}]),$J}(),$Zo=function(){function $z($J,$o,$r,$S){this.minDepth=0,this.maxDepth=1,this.x=$J,this.y=$o,this.width=$r,this.height=$S}$Y($z,"laya.d3.math.Viewport");var $J=$z.prototype;return $J.project=function($J,$o,$r){$Ao.transformV3ToV3($J,$o,$r);var $S=$J.elements,$G=$o.elements,$z=$r.elements,$A=$S[0]*$G[3]+$S[1]*$G[7]+$S[2]*$G[11]+$G[15];1!==$A&&($z[0]=$z[0]/$A,$z[1]=$z[1]/$A,$z[2]=$z[2]/$A),$z[0]=.5*($z[0]+1)*this.width+this.x,$z[1]=.5*(1-$z[1])*this.height+this.y,$z[2]=$z[2]*(this.maxDepth-this.minDepth)+this.minDepth},$J.unprojectFromMat=function($J,$o,$r){var $S=$J.elements,$G=$o.elements,$z=$r.elements;$z[0]=($S[0]-this.x)/this.width*2-1,$z[1]=-(($S[1]-this.y)/this.height*2-1);var $A=(this.maxDepth-this.minDepth)/2;$z[2]=($S[2]-this.minDepth-$A)/$A;var $h=$z[0]*$G[3]+$z[1]*$G[7]+$z[2]*$G[11]+$G[15];$Ao.transformV3ToV3($r,$o,$r),1!==$h&&($z[0]=$z[0]/$h,$z[1]=$z[1]/$h,$z[2]=$z[2]/$h)},$J.unprojectFromWVP=function($J,$o,$r,$S,$G){$Jo.multiply($o,$r,$z._tempMatrix4x4),$S&&$Jo.multiply($z._tempMatrix4x4,$S,$z._tempMatrix4x4),$z._tempMatrix4x4.invert($z._tempMatrix4x4),this.unprojectFromMat($J,$z._tempMatrix4x4,$G)},$v($z,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $Jo}]),$z}(),$uo=function(){function $C($J){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$J,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$Y($C,"laya.d3.resource.models.SubMesh");var $J=$C.prototype;return $K.imps($J,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$J._getVertexBuffer=function($J){return void 0===$J&&($J=0),0===$J?this._vertexBuffer:null},$J._getIndexBuffer=function(){return this._indexBuffer},$J._getStaticBatchBakedVertexs=function($J,$o){var $r,$S,$G=this._vertexBuffer,$z=$G.vertexDeclaration,$A=$z.getVertexElementByUsage(0).offset/4,$h=$z.getVertexElementByUsage(3).offset/4,$Z=$o.meshRender.lightmapScaleOffset,$u=0,$B=0,$v=0,$j=0,$Y=0,$_=0;if($Z)if($S=$z.getVertexElementByUsage(15))$v=$z.vertexStride/4,$r=0<this._vertexCount?$G.getData().slice(this._vertexStart*$v,(this._vertexStart+this._vertexCount)*$v):$G.getData().slice(),$j=$S.offset/4;else{$v=($_=$z.vertexStride/4)+2,$r=this._vertexCount?new Float32Array(this._vertexCount*($G.vertexDeclaration.vertexStride/4+2)):new Float32Array($G.vertexCount*($G.vertexDeclaration.vertexStride/4+2)),$j=($Y=$z.getVertexElementByUsage(2).offset/4)+2;var $D=$G.getData();for($u=0,$B=$D.length/$_;$u<$B;$u++){var $N=0;$N=0<this._vertexCount?(this._vertexStart+$u)*$_:$u*$_;var $w=$u*$v,$i=0;for($i=0;$i<$j;$i++)$r[$w+$i]=$D[$N+$i];for($i=$j;$i<$_;$i++)$r[$w+$i+2]=$D[$N+$i]}}else $v=$z.vertexStride/4,$r=this._vertexCount?$G.getData().slice(this._vertexStart*$v,(this._vertexStart+this._vertexCount)*$v):$G.getData().slice();if($J){var $I=$J.worldMatrix,$t=$C._tempMatrix4x40;$I.invert($t);var $K=$C._tempMatrix4x41,$e=$o.transform.worldMatrix;$Jo.multiply($t,$e,$K)}else $K=$o.transform.worldMatrix;var $y=$C._tempQuaternion0;for($K.decomposeTransRotScale($C._tempVector30,$y,$C._tempVector31),$u=0,$B=$r.length/$v;$u<$B;$u++){var $g=$u*$v+$A,$s=$u*$v+$h;if($No.transformVector3ArrayToVector3ArrayCoordinate($r,$g,$K,$r,$g),$No.transformVector3ArrayByQuat($r,$s,$y,$r,$s),$Z){var $V=$u*$v+$j;if($S)$No.transformLightingMapTexcoordByUV1Array($r,$V,$Z,$r,$V);else{var $m=$u*$_+$Y;$No.transformLightingMapTexcoordByUV0Array($D,$m,$Z,$r,$V)}}}return $r},$J._getVertexBuffers=function(){return null},$J._beforeRender=function($J){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$J._render=function($J){var $o,$r=0,$S=$J.renderElement;if(1<this._indexCount){var $G=this._boneIndicesList.length;if(1<$G){for(var $z=0;$z<$G;$z++)($o=$S._skinAnimationDatas||this._skinAnimationDatas)&&($S._shaderValue.setValue(0,$o[$z]),$J._shader.uploadRenderElementUniforms($S._shaderValue.data)),$R.mainContext.drawElements(4,this._subIndexBufferCount[$z],5123,2*this._subIndexBufferStart[$z]);$g.drawCall+=$G}else($o=$S._skinAnimationDatas||this._skinAnimationDatas)&&($S._shaderValue.setValue(0,$o[0]),$J._shader.uploadRenderElementUniforms($S._shaderValue.data)),$R.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$g.drawCall++;$r=this._indexCount}else $r=this._indexBuffer.indexCount,($o=$S._skinAnimationDatas||this._skinAnimationDatas)&&($S._shaderValue.setValue(0,$o[0]),$J._shader.uploadRenderElementUniforms($S._shaderValue.data)),$R.mainContext.drawElements(4,$r,5123,0),$g.drawCall++;$g.trianglesFaces+=$r/3},$J.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$J.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$_(0,$J,"_vertexBufferCount",function(){return 1}),$_(0,$J,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$v($C,["_tempVector30",function(){return this._tempVector30=new $Ao},"_tempVector31",function(){return this._tempVector31=new $Ao},"_tempQuaternion0",function(){return this._tempQuaternion0=new $ro},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $Jo},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $Jo}]),$C}(),$Bo=function(){function $J($J){this.defineCounter=0,this.defines=null,$J?(this.defineCounter=$J.defineCounter,this.defines=$J.defines.slice()):(this.defineCounter=0,this.defines=[])}return $Y($J,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$J.prototype.registerDefine=function($J){var $o=Math.pow(2,this.defineCounter++);return this.defines[$o]=$J,$o},$J}(),$vo=function(){function $J(){}return $Y($J,"laya.d3.shader.ShaderInit3D"),$J.__init__=function(){var $J,$o;$go._globalRegDefine("HIGHPRECISION",$go.SHADERDEFINE_HIGHPRECISION),$go._globalRegDefine("FOG",$go.SHADERDEFINE_FOG),$go._globalRegDefine("DIRECTIONLIGHT",$go.SHADERDEFINE_DIRECTIONLIGHT),$go._globalRegDefine("POINTLIGHT",$go.SHADERDEFINE_POINTLIGHT),$go._globalRegDefine("SPOTLIGHT",$go.SHADERDEFINE_SPOTLIGHT),$go._globalRegDefine("UV",$go.SHADERDEFINE_UV0),$go._globalRegDefine("COLOR",$go.SHADERDEFINE_COLOR),$go._globalRegDefine("UV1",$go.SHADERDEFINE_UV1),$go._globalRegDefine("CASTSHADOW",$Yo.SHADERDEFINE_CAST_SHADOW),$go._globalRegDefine("SHADOWMAP_PSSM1",$Yo.SHADERDEFINE_SHADOW_PSSM1),$go._globalRegDefine("SHADOWMAP_PSSM2",$Yo.SHADERDEFINE_SHADOW_PSSM2),$go._globalRegDefine("SHADOWMAP_PSSM3",$Yo.SHADERDEFINE_SHADOW_PSSM3),$go._globalRegDefine("SHADOWMAP_PCF_NO",$Yo.SHADERDEFINE_SHADOW_PCF_NO),$go._globalRegDefine("SHADOWMAP_PCF1",$Yo.SHADERDEFINE_SHADOW_PCF1),$go._globalRegDefine("SHADOWMAP_PCF2",$Yo.SHADERDEFINE_SHADOW_PCF2),$go._globalRegDefine("SHADOWMAP_PCF3",$Yo.SHADERDEFINE_SHADOW_PCF3),$go._globalRegDefine("DEPTHFOG",$go.SAHDERDEFINE_DEPTHFOG),$po.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$po.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$J={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$o={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $r=$po.nameKey.add("SIMPLE");shaderCompile=$go.add($r,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$J,$o),$fo.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$fo.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$fo.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$fo.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$fo.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$fo.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$fo.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$fo.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$fo.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$J}(),$jo=function(){function $J(){this._data=null,this._data=[]}$Y($J,"laya.d3.shader.ValusArray");var $o=$J.prototype;return $o.setValue=function($J,$o){this._data[$J]=$o},$_(0,$o,"data",function(){return this._data}),$J}(),$Yo=function(){function $J(){}return $J.SHADERDEFINE_RECEIVE_SHADOW=1,$J.SHADERDEFINE_CAST_SHADOW=512,$J.SHADERDEFINE_SHADOW_PSSM1=1024,$J.SHADERDEFINE_SHADOW_PSSM2=2048,$J.SHADERDEFINE_SHADOW_PSSM3=4096,$J.SHADERDEFINE_SHADOW_PCF_NO=8192,$J.SHADERDEFINE_SHADOW_PCF1=16384,$J.SHADERDEFINE_SHADOW_PCF2=32768,$J.SHADERDEFINE_SHADOW_PCF3=65536,$J.MAX_PSSM_COUNT=3,$J}(),$_o=function(){function $x(){}return $Y($x,"laya.d3.utils.Picker"),$x.calculateCursorRay=function($J,$o,$r,$S,$G,$z){var $A=$J.elements[0],$h=$J.elements[1],$Z=$x._tempVector30,$u=$Z.elements;$u[0]=$A,$u[1]=$h,$u[2]=$o.minDepth;var $B=$x._tempVector31,$v=$B.elements;$v[0]=$A,$v[1]=$h,$v[2]=$o.maxDepth;var $j=$z.origin,$Y=$x._tempVector32;$o.unprojectFromWVP($Z,$r,$S,$G,$j),$o.unprojectFromWVP($B,$r,$S,$G,$Y);var $_=$z.direction.elements;$_[0]=$Y.x-$j.x,$_[1]=$Y.y-$j.y,$_[2]=$Y.z-$j.z,$Ao.normalize($z.direction,$z.direction)},$x.rayIntersectsPositionsAndIndices=function($J,$o,$r,$S,$G){for(var $z=$r.vertexStride/4,$A=$r.getVertexElementByUsage(0).offset/4,$h=Number.MAX_VALUE,$Z=-1,$u=-1,$B=-1,$v=0;$v<$S.length;$v+=3){var $j=$x._tempVector35,$Y=$j.elements,$_=$S[$v]*$z,$D=$_+$A;$Y[0]=$o[$D],$Y[1]=$o[1+$D],$Y[2]=$o[2+$D];var $N=$x._tempVector36,$w=$N.elements,$i=$S[$v+1]*$z,$I=$i+$A;$w[0]=$o[$I],$w[1]=$o[1+$I],$w[2]=$o[2+$I];var $t=$x._tempVector37,$K=$t.elements,$e=$S[$v+2]*$z,$y=$e+$A;$K[0]=$o[$y],$K[1]=$o[1+$y],$K[2]=$o[2+$y];var $g=laya.d3.utils.Picker.rayIntersectsTriangle($J,$j,$N,$t);!isNaN($g)&&$g<$h&&($h=$g,$Z=$_,$u=$i,$B=$e)}if($h===Number.MAX_VALUE)return $G.position.toDefault(),$G.distance=Number.MAX_VALUE,$G.trianglePositions[0].toDefault(),$G.trianglePositions[1].toDefault(),$G.trianglePositions[2].toDefault(),$G.triangleNormals[0].toDefault(),$G.triangleNormals[1].toDefault(),$G.triangleNormals[2].toDefault(),!1;$G.distance=$h,$Ao.scale($J.direction,$h,$G.position),$Ao.add($J.origin,$G.position,$G.position);var $s=$G.trianglePositions,$V=$s[0],$m=$s[1],$C=$s[2],$R=$V.elements,$n=$m.elements,$k=$C.elements,$U=$Z+$A;$R[0]=$o[$U],$R[1]=$o[$U+1],$R[2]=$o[$U+2];var $L=$u+$A;$n[0]=$o[$L],$n[1]=$o[$L+1],$n[2]=$o[$L+2];var $Q=$B+$A;$k[0]=$o[$Q],$k[1]=$o[$Q+1],$k[2]=$o[$Q+2];var $p=$r.getVertexElementByUsage(3);if($p){var $f=$p.offset/4,$F=$G.triangleNormals,$d=$F[0],$l=$F[1],$c=$F[2],$T=$d.elements,$b=$l.elements,$$=$c.elements,$q=$Z+$f;$T[0]=$o[$q],$T[1]=$o[$q+1],$T[2]=$o[$q+2];var $H=$u+$f;$b[0]=$o[$H],$b[1]=$o[$H+1],$b[2]=$o[$H+2];var $a=$B+$f;$$[0]=$o[$a],$$[1]=$o[$a+1],$$[2]=$o[$a+2]}return!0},$x.rayIntersectsTriangle=function($J,$o,$r,$S){var $G=$x._tempVector30,$z=$x._tempVector31;$Ao.subtract($r,$o,$G),$Ao.subtract($S,$o,$z);var $A,$h=$x._tempVector32;if($Ao.cross($J.direction,$z,$h),($A=$Ao.dot($G,$h))>-Number.MIN_VALUE&&$A<Number.MIN_VALUE)return Number.NaN;var $Z,$u=1/$A,$B=$x._tempVector33;if($Ao.subtract($J.origin,$o,$B),$Z=$Ao.dot($B,$h),($Z*=$u)<0||1<$Z)return Number.NaN;var $v,$j,$Y=$x._tempVector34;return $Ao.cross($B,$G,$Y),$v=$Ao.dot($J.direction,$Y),($v*=$u)<0||1<$Z+$v?Number.NaN:($j=$Ao.dot($z,$Y),($j*=$u)<0?Number.NaN:$j)},$v($x,["_tempVector30",function(){return this._tempVector30=new $Ao},"_tempVector31",function(){return this._tempVector31=new $Ao},"_tempVector32",function(){return this._tempVector32=new $Ao},"_tempVector33",function(){return this._tempVector33=new $Ao},"_tempVector34",function(){return this._tempVector34=new $Ao},"_tempVector35",function(){return this._tempVector35=new $Ao},"_tempVector36",function(){return this._tempVector36=new $Ao},"_tempVector37",function(){return this._tempVector37=new $Ao}]),$x}(),$Do=(function(){function $J(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $Ao,new $Ao,new $Ao],this.trianglePositions.length=3,this.triangleNormals=[new $Ao,new $Ao,new $Ao],this.triangleNormals.length=3,this.position=new $Ao}$Y($J,"laya.d3.utils.RaycastHit"),$J.prototype.cloneTo=function($J){$J.distance=this.distance,this.trianglePositions[0].cloneTo($J.trianglePositions[0]),this.trianglePositions[1].cloneTo($J.trianglePositions[1]),this.trianglePositions[2].cloneTo($J.trianglePositions[2]),this.triangleNormals[0].cloneTo($J.triangleNormals[0]),this.triangleNormals[1].cloneTo($J.triangleNormals[1]),this.triangleNormals[2].cloneTo($J.triangleNormals[2]),this.position.cloneTo($J.position),$J.sprite3D=this.sprite3D}}(),function(){function $J($J,$o){this._width=0,this._height=0,this._width=$J,this._height=$o}$Y($J,"laya.d3.utils.Size");var $o=$J.prototype;return $_(0,$o,"width",function(){return-1===this._width?$M.clientWidth:this._width}),$_(0,$o,"height",function(){return-1===this._height?$M.clientHeight:this._height}),$_(1,$J,"fullScreen",function(){return new $J(-1,-1)}),$J}()),$No=function(){function $U(){}return $Y($U,"laya.d3.utils.Utils3D"),$U._rotationTransformScaleSkinAnimation=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v){var $j,$Y,$_,$D,$N,$w=$U._tempArray16_0,$i=$U._tempArray16_1,$I=$U._tempArray16_2,$t=$S+$S,$K=$G+$G,$e=$z+$z,$y=$S*$t,$g=$G*$t,$s=$G*$K,$V=$z*$t,$m=$z*$K,$C=$z*$e,$R=$A*$t,$n=$A*$K,$k=$A*$e;for($w[15]=1,$w[0]=1-$s-$C,$w[1]=$g+$k,$w[2]=$V-$n,$w[4]=$g-$k,$w[5]=1-$y-$C,$w[6]=$m+$R,$w[8]=$V+$n,$w[9]=$m-$R,$w[10]=1-$y-$s,$i[15]=1,$i[0]=$h,$i[5]=$Z,$i[10]=$u,$j=0;$j<4;$j++)$Y=$w[$j],$_=$w[$j+4],$D=$w[$j+8],$N=$w[$j+12],$I[$j]=$Y,$I[$j+4]=$_,$I[$j+8]=$D,$I[$j+12]=$Y*$J+$_*$o+$D*$r+$N;for($j=0;$j<4;$j++)$Y=$I[$j],$_=$I[$j+4],$D=$I[$j+8],$N=$I[$j+12],$B[$j+$v]=$Y*$i[0]+$_*$i[1]+$D*$i[2]+$N*$i[3],$B[$j+$v+4]=$Y*$i[4]+$_*$i[5]+$D*$i[6]+$N*$i[7],$B[$j+$v+8]=$Y*$i[8]+$_*$i[9]+$D*$i[10]+$N*$i[11],$B[$j+$v+12]=$Y*$i[12]+$_*$i[13]+$D*$i[14]+$N*$i[15]},$U._createNodeByJson=function($J,$o,$r,$S){if(!$r)switch($o.type){case"Sprite3D":$r=new $Qo;break;case"MeshSprite3D":$r=new $xo;break;case"SkinnedMeshSprite3D":$r=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$r=new ShuriKenParticle3D;break;case"TrailSprite3D":$r=new TrailSprite3D;break;case"Terrain":$r=new Terrain;break;case"Camera":$r=new $ao;break;case"DirectionLight":$r=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $G=$o.props;if($G)for(var $z in $G)$r[$z]=$G[$z];var $A=$o.customProps;$A&&($r instanceof laya.d3.core.Sprite3D?($r._parseBaseCustomProps($A),$r._parseCustomProps($J,$S,$A,$o),$r._parseCustomComponent($J,$S,$o.components)):$r._parseCustomProps($J,$S,$A,$o));var $h=$o.child;if($h)for(var $Z=0,$u=$h.length;$Z<$u;$Z++){var $B=$U._createNodeByJson($J,$h[$Z],null,$S);$r.addChild($B)}return $r},$U._computeBoneAndAnimationDatasByBindPoseMatrxix=function($J,$o,$r,$S,$G,$z){var $A,$h,$Z=0,$u=0,$B=$J.length;for($A=0;$A<$B;$Z+=$J[$A].keyframeWidth,$u+=16,$A++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($o[$Z+0],$o[$Z+1],$o[$Z+2],$o[$Z+3],$o[$Z+4],$o[$Z+5],$o[$Z+6],$o[$Z+7],$o[$Z+8],$o[$Z+9],$S,$u),0!=$A&&($h=16*$J[$A].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($S,$h,$S,$u,$S,$u));var $v=$r.length;for($A=0;$A<$v;$A++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($S,16*$z[$A],$r[$A],$G,16*$A)},$U._computeAnimationDatasByArrayAndMatrixFast=function($J,$o,$r,$S){for(var $G=0,$z=$J.length;$G<$z;$G++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($o,16*$S[$G],$J[$G],$r,16*$G)},$U._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($J,$o,$r,$S,$G){var $z,$A,$h=0,$Z=0,$u=$J.length;for($z=0;$z<$u;$h+=$J[$z].keyframeWidth,$Z+=16,$z++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($o[$h+7],$o[$h+8],$o[$h+9],$o[$h+3],$o[$h+4],$o[$h+5],$o[$h+6],$o[$h+0],$o[$h+1],$o[$h+2],$S,$Z),0!=$z&&($A=16*$J[$z].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($S,$A,$S,$Z,$S,$Z));var $B=$r.length;for($z=0;$z<$B;$z++){var $v=16*$z;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($S,$v,$r[$z],$G,$v)}},$U._computeAnimationDatasByArrayAndMatrixFastOld=function($J,$o,$r){for(var $S=$J.length,$G=0;$G<$S;$G++){var $z=16*$G;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($o,$z,$J[$G],$r,$z)}},$U._computeRootAnimationData=function($J,$o,$r){for(var $S=0,$G=0,$z=0,$A=$J.length;$S<$A;$G+=$J[$S].keyframeWidth,$z+=16,$S++)laya.d3.utils.Utils3D.createAffineTransformationArray($o[$G+0],$o[$G+1],$o[$G+2],$o[$G+3],$o[$G+4],$o[$G+5],$o[$G+6],$o[$G+7],$o[$G+8],$o[$G+9],$r,$z)},$U.transformVector3ArrayByQuat=function($J,$o,$r,$S,$G){var $z=$r.elements,$A=$J[$o],$h=$J[$o+1],$Z=$J[$o+2],$u=$z[0],$B=$z[1],$v=$z[2],$j=$z[3],$Y=$j*$A+$B*$Z-$v*$h,$_=$j*$h+$v*$A-$u*$Z,$D=$j*$Z+$u*$h-$B*$A,$N=-$u*$A-$B*$h-$v*$Z;$S[$G]=$Y*$j+$N*-$u+$_*-$v-$D*-$B,$S[$G+1]=$_*$j+$N*-$B+$D*-$u-$Y*-$v,$S[$G+2]=$D*$j+$N*-$v+$Y*-$B-$_*-$u},$U.mulMatrixByArray=function($J,$o,$r,$S,$G,$z){var $A,$h,$Z,$u,$B;if($G===$r){for($r=$U._tempArray16_3,$A=0;$A<16;++$A)$r[$A]=$G[$z+$A];$S=0}for($A=0;$A<4;$A++)$h=$J[$o+$A],$Z=$J[$o+$A+4],$u=$J[$o+$A+8],$B=$J[$o+$A+12],$G[$z+$A]=$h*$r[$S+0]+$Z*$r[$S+1]+$u*$r[$S+2]+$B*$r[$S+3],$G[$z+$A+4]=$h*$r[$S+4]+$Z*$r[$S+5]+$u*$r[$S+6]+$B*$r[$S+7],$G[$z+$A+8]=$h*$r[$S+8]+$Z*$r[$S+9]+$u*$r[$S+10]+$B*$r[$S+11],$G[$z+$A+12]=$h*$r[$S+12]+$Z*$r[$S+13]+$u*$r[$S+14]+$B*$r[$S+15]},$U.mulMatrixByArrayFast=function($J,$o,$r,$S,$G,$z){var $A,$h,$Z,$u,$B;for($A=0;$A<4;$A++)$h=$J[$o+$A],$Z=$J[$o+$A+4],$u=$J[$o+$A+8],$B=$J[$o+$A+12],$G[$z+$A]=$h*$r[$S+0]+$Z*$r[$S+1]+$u*$r[$S+2]+$B*$r[$S+3],$G[$z+$A+4]=$h*$r[$S+4]+$Z*$r[$S+5]+$u*$r[$S+6]+$B*$r[$S+7],$G[$z+$A+8]=$h*$r[$S+8]+$Z*$r[$S+9]+$u*$r[$S+10]+$B*$r[$S+11],$G[$z+$A+12]=$h*$r[$S+12]+$Z*$r[$S+13]+$u*$r[$S+14]+$B*$r[$S+15]},$U.mulMatrixByArrayAndMatrixFast=function($J,$o,$r,$S,$G){var $z,$A,$h,$Z,$u,$B=$r.elements,$v=$B[0],$j=$B[1],$Y=$B[2],$_=$B[3],$D=$B[4],$N=$B[5],$w=$B[6],$i=$B[7],$I=$B[8],$t=$B[9],$K=$B[10],$e=$B[11],$y=$B[12],$g=$B[13],$s=$B[14],$V=$B[15],$m=$o,$C=$o+4,$R=$o+8,$n=$o+12,$k=$G,$U=$G+4,$L=$G+8,$Q=$G+12;for($z=0;$z<4;$z++)$A=$J[$m+$z],$h=$J[$C+$z],$Z=$J[$R+$z],$u=$J[$n+$z],$S[$k+$z]=$A*$v+$h*$j+$Z*$Y+$u*$_,$S[$U+$z]=$A*$D+$h*$N+$Z*$w+$u*$i,$S[$L+$z]=$A*$I+$h*$t+$Z*$K+$u*$e,$S[$Q+$z]=$A*$y+$h*$g+$Z*$s+$u*$V},$U.createAffineTransformationArray=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v){var $j=$S+$S,$Y=$G+$G,$_=$z+$z,$D=$S*$j,$N=$S*$Y,$w=$S*$_,$i=$G*$Y,$I=$G*$_,$t=$z*$_,$K=$A*$j,$e=$A*$Y,$y=$A*$_;$B[$v+0]=(1-($i+$t))*$h,$B[$v+1]=($N+$y)*$h,$B[$v+2]=($w-$e)*$h,$B[$v+3]=0,$B[$v+4]=($N-$y)*$Z,$B[$v+5]=(1-($D+$t))*$Z,$B[$v+6]=($I+$K)*$Z,$B[$v+7]=0,$B[$v+8]=($w+$e)*$u,$B[$v+9]=($I-$K)*$u,$B[$v+10]=(1-($D+$i))*$u,$B[$v+11]=0,$B[$v+12]=$J,$B[$v+13]=$o,$B[$v+14]=$r,$B[$v+15]=1},$U.transformVector3ArrayToVector3ArrayCoordinate=function($J,$o,$r,$S,$G){var $z=$U._tempArray4_0,$A=$J[$o+0],$h=$J[$o+1],$Z=$J[$o+2],$u=$r.elements;$z[0]=$A*$u[0]+$h*$u[4]+$Z*$u[8]+$u[12],$z[1]=$A*$u[1]+$h*$u[5]+$Z*$u[9]+$u[13],$z[2]=$A*$u[2]+$h*$u[6]+$Z*$u[10]+$u[14],$z[3]=1/($A*$u[3]+$h*$u[7]+$Z*$u[11]+$u[15]),$S[$G+0]=$z[0]*$z[3],$S[$G+1]=$z[1]*$z[3],$S[$G+2]=$z[2]*$z[3]},$U.transformLightingMapTexcoordByUV0Array=function($J,$o,$r,$S,$G){var $z=$r.elements;$S[$G+0]=$J[$o+0]*$z[0]+$z[2],$S[$G+1]=($J[$o+1]-1)*$z[1]+$z[3]},$U.transformLightingMapTexcoordByUV1Array=function($J,$o,$r,$S,$G){var $z=$r.elements;$S[$G+0]=$J[$o+0]*$z[0]+$z[2],$S[$G+1]=1+$J[$o+1]*$z[1]+$z[3]},$U.getURLVerion=function($J){var $o=$J.indexOf("?");return 0<=$o?$J.substr($o):null},$U._quaternionCreateFromYawPitchRollArray=function($J,$o,$r,$S){var $G=.5*$r,$z=.5*$o,$A=.5*$J,$h=Math.sin($G),$Z=Math.cos($G),$u=Math.sin($z),$B=Math.cos($z),$v=Math.sin($A),$j=Math.cos($A);$S[0]=$j*$u*$Z+$v*$B*$h,$S[1]=$v*$B*$Z-$j*$u*$h,$S[2]=$j*$B*$h-$v*$u*$Z,$S[3]=$j*$B*$Z+$v*$u*$h},$U._createAffineTransformationArray=function($J,$o,$r,$S){var $G=$o[0],$z=$o[1],$A=$o[2],$h=$o[3],$Z=$G+$G,$u=$z+$z,$B=$A+$A,$v=$G*$Z,$j=$G*$u,$Y=$G*$B,$_=$z*$u,$D=$z*$B,$N=$A*$B,$w=$h*$Z,$i=$h*$u,$I=$h*$B,$t=$r[0],$K=$r[1],$e=$r[2];$S[0]=(1-($_+$N))*$t,$S[1]=($j+$I)*$t,$S[2]=($Y-$i)*$t,$S[3]=0,$S[4]=($j-$I)*$K,$S[5]=(1-($v+$N))*$K,$S[6]=($D+$w)*$K,$S[7]=0,$S[8]=($Y+$i)*$e,$S[9]=($D-$w)*$e,$S[10]=(1-($v+$_))*$e,$S[11]=0,$S[12]=$J[0],$S[13]=$J[1],$S[14]=$J[2],$S[15]=1},$U._mulMatrixArray=function($J,$o,$r,$S){var $G,$z,$A,$h,$Z,$u=$o.elements,$B=$u[0],$v=$u[1],$j=$u[2],$Y=$u[3],$_=$u[4],$D=$u[5],$N=$u[6],$w=$u[7],$i=$u[8],$I=$u[9],$t=$u[10],$K=$u[11],$e=$u[12],$y=$u[13],$g=$u[14],$s=$u[15],$V=$S,$m=$S+4,$C=$S+8,$R=$S+12;for($G=0;$G<4;$G++)$z=$J[$G],$A=$J[$G+4],$h=$J[$G+8],$Z=$J[$G+12],$r[$V+$G]=$z*$B+$A*$v+$h*$j+$Z*$Y,$r[$m+$G]=$z*$_+$A*$D+$h*$N+$Z*$w,$r[$C+$G]=$z*$i+$A*$I+$h*$t+$Z*$K,$r[$R+$G]=$z*$e+$A*$y+$h*$g+$Z*$s},$U.getYawPitchRoll=function($J,$o){$U.transformQuat($Ao.ForwardRH,$J,$ro.TEMPVector31),$U.transformQuat($Ao.Up,$J,$ro.TEMPVector32);var $r=$ro.TEMPVector32.elements;$U.angleTo($Ao.ZERO,$ro.TEMPVector31,$ro.TEMPVector33);var $S=$ro.TEMPVector33.elements;$S[0]==Math.PI/2?($S[1]=$U.arcTanAngle($r[2],$r[0]),$S[2]=0):$S[0]==-Math.PI/2?($S[1]=$U.arcTanAngle(-$r[2],-$r[0]),$S[2]=0):($Jo.createRotationY(-$S[1],$ro.TEMPMatrix0),$Jo.createRotationX(-$S[0],$ro.TEMPMatrix1),$Ao.transformCoordinate($ro.TEMPVector32,$ro.TEMPMatrix0,$ro.TEMPVector32),$Ao.transformCoordinate($ro.TEMPVector32,$ro.TEMPMatrix1,$ro.TEMPVector32),$S[2]=$U.arcTanAngle($r[1],-$r[0])),$S[1]<=-Math.PI&&($S[1]=Math.PI),$S[2]<=-Math.PI&&($S[2]=Math.PI),$S[1]>=Math.PI&&$S[2]>=Math.PI&&($S[1]=0,$S[2]=0,$S[0]=Math.PI-$S[0]),$o[0]=$S[1],$o[1]=$S[0],$o[2]=$S[2]},$U.arcTanAngle=function($J,$o){return 0==$J?1==$o?Math.PI/2:-Math.PI/2:0<$J?Math.atan($o/$J):$J<0?0<$o?Math.atan($o/$J)+Math.PI:Math.atan($o/$J)-Math.PI:0},$U.angleTo=function($J,$o,$r){$Ao.subtract($o,$J,$ro.TEMPVector30),$Ao.normalize($ro.TEMPVector30,$ro.TEMPVector30),$r.elements[0]=Math.asin($ro.TEMPVector30.y),$r.elements[1]=$U.arcTanAngle(-$ro.TEMPVector30.z,-$ro.TEMPVector30.x)},$U.transformQuat=function($J,$o,$r){var $S=$r.elements,$G=$J.elements,$z=$o,$A=$G[0],$h=$G[1],$Z=$G[2],$u=$z[0],$B=$z[1],$v=$z[2],$j=$z[3],$Y=$j*$A+$B*$Z-$v*$h,$_=$j*$h+$v*$A-$u*$Z,$D=$j*$Z+$u*$h-$B*$A,$N=-$u*$A-$B*$h-$v*$Z;$S[0]=$Y*$j+$N*-$u+$_*-$v-$D*-$B,$S[1]=$_*$j+$N*-$B+$D*-$u-$Y*-$v,$S[2]=$D*$j+$N*-$v+$Y*-$B-$_*-$u},$U.quaterionNormalize=function($J,$o){var $r=$J[0],$S=$J[1],$G=$J[2],$z=$J[3],$A=$r*$r+$S*$S+$G*$G+$z*$z;0<$A&&($A=1/Math.sqrt($A),$o[0]=$r*$A,$o[1]=$S*$A,$o[2]=$G*$A,$o[3]=$z*$A)},$U.matrix4x4MultiplyFFF=function($J,$o,$r){var $S,$G,$z,$A,$h;if($r===$o)for($o=new Float32Array(16),$S=0;$S<16;++$S)$o[$S]=$r[$S];for($S=0;$S<4;$S++)$G=$J[$S],$z=$J[$S+4],$A=$J[$S+8],$h=$J[$S+12],$r[$S]=$G*$o[0]+$z*$o[1]+$A*$o[2]+$h*$o[3],$r[$S+4]=$G*$o[4]+$z*$o[5]+$A*$o[6]+$h*$o[7],$r[$S+8]=$G*$o[8]+$z*$o[9]+$A*$o[10]+$h*$o[11],$r[$S+12]=$G*$o[12]+$z*$o[13]+$A*$o[14]+$h*$o[15]},$U.matrix4x4MultiplyMFM=function($J,$o,$r){$U.matrix4x4MultiplyFFF($J.elements,$o,$r.elements)},$v($U,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $Ao},"_tempVector3_1",function(){return this._tempVector3_1=new $Ao},"_tempVector3_2",function(){return this._tempVector3_2=new $Ao},"_tempVector3_3",function(){return this._tempVector3_3=new $Ao},"_tempVector3_4",function(){return this._tempVector3_4=new $Ao},"_tempVector3_5",function(){return this._tempVector3_5=new $Ao},"_tempVector3_6",function(){return this._tempVector3_6=new $Ao},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$U}(),$wo=function(){function $n(){}return $Y($n,"Laya3D"),$n._cancelLoadByUrl=function($J){$K.loader.cancelLoadByUrl($J),$n._innerFirstLevelLoaderManager.cancelLoadByUrl($J),$n._innerSecondLevelLoaderManager.cancelLoadByUrl($J),$n._innerThirdLevelLoaderManager.cancelLoadByUrl($J),$n._innerFourthLevelLoaderManager.cancelLoadByUrl($J)},$n._changeWebGLSize=function($J,$o){$R.onStageResize($J,$o),$M.clientWidth=$J,$M.clientHeight=$o},$n.__init__=function(){var $J=$o.createMap;$J.lh=[$Qo,"SPRITE3DHIERARCHY"],$J.ls=[$Lo,"SPRITE3DHIERARCHY"],$J.lm=[$To,"MESH"],$J.lmat=[$fo,"MATERIAL"],$J.jpg=[$$o,"nativeimage"],$J.jpeg=[$$o,"nativeimage"],$J.png=[$$o,"nativeimage"],$J.pkm=[$$o,"arraybuffer"],$J.raw=[$lo,"arraybuffer"],$J.mipmaps=[$lo,"arraybuffer"],$w.parserMap.SPRITE3DHIERARCHY=$n._loadHierarchy,$w.parserMap.MESH=$n._loadMesh,$w.parserMap.MATERIAL=$n._loadMaterial,$w.parserMap.TEXTURECUBE=$n._loadTextureCube,$w.parserMap.TERRAIN=$n._loadTerrain,$n._innerFirstLevelLoaderManager.on("error",null,$n._eventLoadManagerError),$n._innerSecondLevelLoaderManager.on("error",null,$n._eventLoadManagerError),$n._innerThirdLevelLoaderManager.on("error",null,$n._eventLoadManagerError),$n._innerFourthLevelLoaderManager.on("error",null,$n._eventLoadManagerError)},$n.READ_BLOCK=function(){return $n._readData.pos+=4,!0},$n.READ_DATA=function(){return $n._DATA.offset=$n._readData.getUint32(),$n._DATA.size=$n._readData.getUint32(),!0},$n.READ_STRINGS=function(){var $J=[],$o={offset:0,size:0};$o.offset=$n._readData.getUint16(),$o.size=$n._readData.getUint16();$n._readData.pos;$n._readData.pos=$o.offset+$n._DATA.offset;for(var $r=0;$r<$o.size;$r++){var $S=$n._readData.readUTFString();-1===$S.lastIndexOf(".lmat")&&-1===$S.lastIndexOf(".lpbr")||$J.push($S)}return $J},$n.formatRelativePath=function($J,$o){var $r;if("."===$o.charAt(0)){for(var $S=($J+$o).split("/"),$G=0,$z=$S.length;$G<$z;$G++)if(".."==$S[$G]){var $A=$G-1;0<$A&&".."!==$S[$A]&&($S.splice($A,2),$G-=2)}$r=$S.join("/")}else $r=$J+$o;return null!=$C.customFormat&&($r=$C.customFormat($r,null)),$r},$n._eventLoadManagerError=function($J){$K.loader.event("error",$J)},$n._addHierarchyInnerUrls=function($J,$o,$r,$S,$G,$z){var $A=$n.formatRelativePath($S,$G);$r&&($A+=$r),$J.push({url:$A,clas:$z}),$o[$G]=$A},$n._getSprite3DHierarchyInnerUrls=function($J,$o,$r,$S,$G,$z,$A){var $h,$Z=0,$u=0;switch($J.type){case"Scene":var $B=$J.customProps.lightmaps;for($Z=0,$u=$B.length;$Z<$u;$Z++){var $v=$B[$Z].replace(".exr",".png");$n._addHierarchyInnerUrls($S,$G,$z,$A,$v,$$o)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $j;if($J.instanceParams)($j=$J.instanceParams.loadPath)&&$n._addHierarchyInnerUrls($o,$G,$z,$A,$j,$To);else{($j=($h=$J.customProps).meshPath)&&$n._addHierarchyInnerUrls($o,$G,$z,$A,$j,$To);var $Y=$h.materials;if($Y)for($Z=0,$u=$Y.length;$Z<$u;$Z++){for(var $_=$Y[$Z],$D=$_.type.split("."),$N=$k.window,$w=0,$i=$D.length;$w<$i;++$w){$N=$N[this.clasPaths[$w]]}if("function"!=typeof $N)throw"_getSprite3DHierarchyInnerUrls 错误: "+$_.type+" 不是类";$n._addHierarchyInnerUrls($r,$G,$z,$A,$_.path,$N)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $I=($h=$J.customProps).meshPath;$I&&$n._addHierarchyInnerUrls($o,$G,$z,$A,$I,$To);var $t=$h.material;if($t){$D=$t.type.split("."),$N=$k.window;for($w=0,$i=$D.length;$w<$i;++$w){$N=$N[this.clasPaths[$w]]}$n._addHierarchyInnerUrls($r,$G,$z,$A,$t.path,$N)}else{var $K=$h.materialPath;if($K)$n._addHierarchyInnerUrls($r,$G,$z,$A,$K,ShurikenParticleMaterial);else{var $e=$h.texturePath;$e&&$n._addHierarchyInnerUrls($S,$G,$z,$A,$e,$$o)}}break;case"Terrain":$n._addHierarchyInnerUrls($S,$G,$z,$A,$J.customProps.dataPath,TerrainRes)}var $y=$J.components;for(var $g in $y){var $s=$y[$g];switch($g){case"Animator":var $V=$s.avatarPath;if($V)$n._addHierarchyInnerUrls($S,$G,$z,$A,$V,Avatar);else{var $m=$s.avatar;$m&&$n._addHierarchyInnerUrls($S,$G,$z,$A,$m.path,Avatar)}var $C=$s.clipPaths;for($Z=0,$u=$C.length;$Z<$u;$Z++)$n._addHierarchyInnerUrls($S,$G,$z,$A,$C[$Z],AnimationClip)}}var $R=$J.child;for($Z=0,$u=$R.length;$Z<$u;$Z++)$n._getSprite3DHierarchyInnerUrls($R[$Z],$o,$r,$S,$G,$z,$A)},$n._loadHierarchy=function($J){$J.on("loaded",null,$n._onHierarchylhLoaded,[$J,$J._class._getGroup()]),$J.load($J.url,"json",!1,null,!0)},$n._onHierarchylhLoaded=function($J,$o,$r){if($J._class.destroyed)$J.endLoad();else{var $S=$J.url,$G=$No.getURLVerion($S),$z=$C.getPath($S),$A=[],$h=[],$Z=[],$u={};$n._getSprite3DHierarchyInnerUrls($r,$A,$h,$Z,$u,$G,$z);var $B=$A.length+$h.length+$Z.length,$v=$B+1,$j=1/$v;if($n._onProcessChange($J,0,$j,1),0<$Z.length){var $Y=$B/$v,$_=$m.create(null,$n._onProcessChange,[$J,$j,$Y],!1);$n._innerFourthLevelLoaderManager.create($Z,$m.create(null,$n._onHierarchyInnerForthLevResouLoaded,[$J,$o,$_,$r,$u,$A,$h,$j+$Y*$Z.length,$Y]),$_,null,null,1,!0,$o)}else $n._onHierarchyInnerForthLevResouLoaded($J,$o,null,$r,$u,$A,$h,$j,$Y)}},$n._onHierarchyInnerForthLevResouLoaded=function($J,$o,$r,$S,$G,$z,$A,$h,$Z){if($J._class.destroyed)$J.endLoad();else if($r&&$r.recover(),0<$A.length){var $u=$m.create(null,$n._onProcessChange,[$J,$h,$Z],!1);$n._innerSecondLevelLoaderManager.create($A,$m.create(null,$n._onHierarchyInnerSecondLevResouLoaded,[$J,$o,$u,$S,$G,$z,$h+$Z*$A.length,$Z]),$r,null,null,1,!0,$o)}else $n._onHierarchyInnerSecondLevResouLoaded($J,$o,null,$S,$G,$z,$h,$Z)},$n._onHierarchyInnerSecondLevResouLoaded=function($J,$o,$r,$S,$G,$z,$A,$h){if($J._class.destroyed)$J.endLoad();else if($r&&$r.recover(),0<$z.length){var $Z=$m.create(null,$n._onProcessChange,[$J,$A,$h],!1);$n._innerFirstLevelLoaderManager.create($z,$m.create(null,$n._onHierarchyInnerFirstLevResouLoaded,[$J,$Z,$S,$G]),$r,null,null,1,!0,$o)}else $n._onHierarchyInnerFirstLevResouLoaded($J,null,$S,$G)},$n._onHierarchyInnerFirstLevResouLoaded=function($J,$o,$r,$S){$o&&$o.recover(),$J.endLoad([$r,$S])},$n._loadTerrain=function($J){$J.on("loaded",null,$n._onTerrainLtLoaded,[$J,$J._class._getGroup()]),$J.load($J.url,"json",!1,null,!0)},$n._onTerrainLtLoaded=function($J,$o,$r){if($J._class.destroyed)$J.endLoad();else{var $S,$G,$z=$J.url,$A=$No.getURLVerion($z),$h=$C.getPath($z),$Z=[],$u={},$B=0,$v=0,$j=$r.heightData;$S=$j.url,$G=$n.formatRelativePath($h,$S),$A&&($G+=$A),$S=$u[$S]=$G;var $Y=$r.detailTexture;for($B=0,$v=$Y.length;$B<$v;$B++)$Z.push({url:$Y[$B].diffuse});var $_=$r.normalMap;for($B=0,$v=$_.length;$B<$v;$B++)$Z.push({url:$_[$B]});var $D=$r.alphaMap;for($B=0,$v=$D.length;$B<$v;$B++)$Z.push({url:$D[$B],params:[!1,!1,6408,!0]});for($B=0,$v=$Z.length;$B<$v;$B++){var $N=$Z[$B].url;$G=$n.formatRelativePath($h,$N),$A&&($G+=$A),$Z[$B].url=$G,$u[$N]=$G}var $w=$Z.length,$i=$w+2,$I=1/$i;$n._onProcessChange($J,0,$I,1);var $t={heightMapLoaded:!1,texturesLoaded:!1},$K=$m.create(null,$n._onProcessChange,[$J,$I,$I],!1);$n._innerFourthLevelLoaderManager.create($S,$m.create(null,$n._onTerrainHeightMapLoaded,[$J,$K,$r,$u,$t]),$K,null,[$j.numX,$j.numZ,$j.bitType,$j.value],1,!0,$o);var $e=$m.create(null,$n._onProcessChange,[$J,2*$I,$w/$i],!1);$n._innerFourthLevelLoaderManager.create($Z,$m.create(null,$n._onTerrainTexturesLoaded,[$J,$e,$r,$u,$t]),$e,null,null,1,!0,$o)}},$n._onTerrainHeightMapLoaded=function($J,$o,$r,$S,$G){$G.heightMapLoaded=!0,$G.texturesLoaded&&($J.endLoad([$r,$S]),$o.recover())},$n._onTerrainTexturesLoaded=function($J,$o,$r,$S,$G){$G.texturesLoaded=!0,$G.heightMapLoaded&&($J.endLoad([$r,$S]),$o.recover())},$n._loadMesh=function($J){$J.on("loaded",null,$n._onMeshLmLoaded,[$J,$J._class._getGroup()]),$J.load($J.url,"arraybuffer",!1,null,!0)},$n._onMeshLmLoaded=function($J,$o,$r){if($J._class.destroyed)$J.endLoad();else{var $S,$G,$z,$A=$J.url,$h=$No.getURLVerion($A),$Z=$C.getPath($A),$u={},$B=0,$v=0;switch(($n._readData=new $e($r)).pos=0,$n._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $j=$n._readData.getUint32();$n._readData.pos=$n._readData.pos+4,$v=$n._readData.getUint16(),$n._readData.pos=$n._readData.pos+8*$v;var $Y=$n._readData.getUint32();for($v=$n._readData.getUint16(),$n._readData.pos=$j+$Y,$S=[],$B=0;$B<$v;$B++){var $_=$n._readData.readUTFString();-1!==$_.lastIndexOf(".lmat")&&$S.push($_)}break;default:for($n.READ_BLOCK(),$B=0;$B<2;$B++){var $D=$n._readData.getUint16(),$N=$n._strings[$D],$w=$n["READ_"+$N];if(null==$w)throw new Error("model file err,no this function:"+$D+" "+$N);1===$B?$S=$w.call():$w.call()}}for($B=0,$z=$S.length;$B<$z;$B++){var $i=$S[$B];$G=$n.formatRelativePath($Z,$i),$h&&($G+=$h),$S[$B]=$G,$u[$i]=$G}if(0<$S.length){$n._onProcessChange($J,0,.5,1);var $I=$m.create(null,$n._onProcessChange,[$J,.5,.5],!1);$n._innerSecondLevelLoaderManager.create($S,$m.create(null,$n._onMeshMateialLoaded,[$J,$I,$r,$u]),$I,null,null,1,!0,$o)}else $J.endLoad([$r,$u])}},$n._onMeshMateialLoaded=function($J,$o,$r,$S){$J.endLoad([$r,$S]),$o.recover()},$n._getMaterialTexturePath=function($J,$o,$r){var $S=$J.length-4;return $J.indexOf(".dds")!=$S&&$J.indexOf(".tga")!=$S&&$J.indexOf(".exr")!=$S&&$J.indexOf(".DDS")!=$S&&$J.indexOf(".TGA")!=$S&&$J.indexOf(".EXR")!=$S||($J=$J.substr(0,$S)+".png"),$J=$n.formatRelativePath($r,$J),$o&&($J+=$o),$J},$n._loadMaterial=function($J){$J.on("loaded",null,$n._onMaterilLmatLoaded,[$J,$J._class._getGroup()]),$J.load($J.url,"json",!1,null,!0)},$n._onMaterilLmatLoaded=function($J,$o,$r){if($J._class.destroyed)$J.endLoad();else{var $S,$G=$J.url,$z=$No.getURLVerion($G),$A=$C.getPath($G),$h=[],$Z={},$u=$r.customProps,$B=$r.version;if($B)switch($B){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $v=$r.props.textures,$j=0,$Y=$v.length;$j<$Y;$j++){var $_=$v[$j],$D=$_.path;if($D){var $N=$D.length-4;$D.indexOf(".exr")!=$N&&$D.indexOf(".EXR")!=$N||($D=$D.substr(0,$N)+".png"),$S=$n.formatRelativePath($A,$D),$z&&($S+=$z),$h.push({url:$S,params:$_.params}),$Z[$D]=$S}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $w=$u.diffuseTexture.texture2D;if($w&&($S=$n._getMaterialTexturePath($w,$z,$A),$h.push($S),$Z[$w]=$S),$u.normalTexture){var $i=$u.normalTexture.texture2D;$i&&($S=$n._getMaterialTexturePath($i,$z,$A),$h.push($S),$Z[$i]=$S)}if($u.specularTexture){var $I=$u.specularTexture.texture2D;$I&&($S=$n._getMaterialTexturePath($I,$z,$A),$h.push($S),$Z[$I]=$S)}if($u.emissiveTexture){var $t=$u.emissiveTexture.texture2D;$t&&($S=$n._getMaterialTexturePath($t,$z,$A),$h.push($S),$Z[$t]=$S)}if($u.ambientTexture){var $K=$u.ambientTexture.texture2D;$K&&($S=$n._getMaterialTexturePath($K,$z,$A),$h.push($S),$Z[$K]=$S)}if($u.reflectTexture){var $e=$u.reflectTexture.texture2D;$e&&($S=$n._getMaterialTexturePath($e,$z,$A),$h.push($S),$Z[$e]=$S)}}var $y=$h.length,$g=$y+1,$s=1/$g;if($n._onProcessChange($J,0,$s,1),0<$y){var $V=$m.create(null,$n._onProcessChange,[$J,$s,$y/$g],!1);$n._innerFourthLevelLoaderManager.create($h,$m.create(null,$n._onMateialTexturesLoaded,[$J,$V,$r,$Z]),$V,$$o,null,1,!0,$o)}else $n._onMateialTexturesLoaded($J,null,$r,null)}},$n._onMateialTexturesLoaded=function($J,$o,$r,$S){$J.endLoad([$r,$S]),$o&&$o.recover()},$n._loadTextureCube=function($J){$J.on("loaded",null,$n._onTextureCubeLtcLoaded,[$J]),$J.load($J.url,"json",!1,null,!0)},$n._onTextureCubeLtcLoaded=function($J,$o){if($J._class.destroyed)$J.endLoad();else{var $r=$C.getPath($J.url),$S=[$n.formatRelativePath($r,$o.px),$n.formatRelativePath($r,$o.nx),$n.formatRelativePath($r,$o.py),$n.formatRelativePath($r,$o.ny),$n.formatRelativePath($r,$o.pz),$n.formatRelativePath($r,$o.nz)];$n._onProcessChange($J,0,1/7,1);var $G=$m.create(null,$n._onProcessChange,[$J,1/7,6/7],!1);$n._innerFourthLevelLoaderManager.load($S,$m.create(null,$n._onTextureCubeImagesLoaded,[$J,$S,$G]),$G,"nativeimage")}},$n._onTextureCubeImagesLoaded=function($J,$o,$r){var $S=[];$S.length=6;for(var $G=0;$G<6;$G++){var $z=$o[$G];$S[$G]=$w.getRes($z),$w.clearRes($z)}$J.endLoad($S),$r.recover()},$n._onProcessChange=function($J,$o,$r,$S){($S=$o+$S*$r)<1&&$J.event("progress",$S)},$n.init=function($J,$o,$r,$S,$G,$z){if(void 0===$r&&($r=!1),void 0===$S&&($S=!1),void 0===$G&&($G=!0),void 0===$z&&($z=!0),$i.update3DLoop=function(){},$i.cancelLoadByUrl=function($J){$n._cancelLoadByUrl($J)},$Z.isAntialias=$r,$Z.isAlpha=$S,$Z.premultipliedAlpha=$G,$Z.isStencil=$z,!$R.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$i.changeWebGLSize=$n._changeWebGLSize,$D.is3DMode=!0,$K.init($J,$o),$U.__init__(),$vo.__init__(),$xo.__init__(),$c.__init__(),$n.__init__(),$A.maxTextureCount=2,($n.debugMode||$O.debugMode)&&($n._debugPhasorSprite=new $H)},$n.HIERARCHY="SPRITE3DHIERARCHY",$n.MESH="MESH",$n.MATERIAL="MATERIAL",$n.PBRMATERIAL="PBRMTL",$n.TEXTURECUBE="TEXTURECUBE",$n.TERRAIN="TERRAIN",$n._readData=null,$n._debugPhasorSprite=null,$n.debugMode=!1,$v($n,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $o},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $o},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $o},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $o}]),$n}(),$io=function($J){function $G($J){$G.__super.call(this),this._owner=$J,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$Y($G,"laya.d3.animation.AnimationTransform3D",$z);var $o=$G.prototype;return $o._getlocalMatrix=function(){return this._localUpdate&&($No._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$o._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldTransform()}},$o._setWorldMatrixAndUpdate=function($J){if(this._worldMatrix=$J,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $o=this._getlocalMatrix(),$r=0;$r<16;++$r)this._worldMatrix[$r]=$o[$r];else $No.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$o._setWorldMatrixNoUpdate=function($J){this._worldMatrix=$J},$o._setWorldMatrixIgnoreUpdate=function($J){this._worldMatrix=$J,this._worldUpdate=!1},$o.getLocalPosition=function(){return this._localPosition},$o.setLocalPosition=function($J){if(this._parent)this._localPosition=$J,this._localUpdate=!0,this._onWorldTransform();else{var $o=this._entity.owner._transform,$r=this._entity.localPosition,$S=$r.elements;$S[0]=$J[0],$S[1]=$J[1],$S[2]=$J[2],$o.localPosition=$r}},$o.getLocalRotation=function(){if(this._localQuaternionUpdate){var $J=this._localRotationEuler;$No._quaternionCreateFromYawPitchRollArray($J[1]/$G._angleToRandin,$J[0]/$G._angleToRandin,$J[2]/$G._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$o.setLocalRotation=function($J){if(this._parent)this._localRotation=$J,$No.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $o=this._entity.owner._transform,$r=this._entity.localRotation,$S=$r.elements;$S[0]=$J[0],$S[1]=$J[1],$S[2]=$J[2],$S[3]=$J[3],$o.localRotation=$r}},$o.getLocalScale=function(){return this._localScale},$o.setLocalScale=function($J){if(this._parent)this._localScale=$J,this._localUpdate=!0,this._onWorldTransform();else{var $o=this._entity.owner._transform,$r=this._entity.localScale,$S=$r.elements;$S[0]=$J[0],$S[1]=$J[1],$S[2]=$J[2],$o.localScale=$r}},$o.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$No.getYawPitchRoll(this._localRotation,$G._tempVector3);var $J=$G._tempVector3,$o=this._localRotationEuler;$o[0]=$J[1]*$G._angleToRandin,$o[1]=$J[0]*$G._angleToRandin,$o[2]=$J[2]*$G._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$o.setLocalRotationEuler=function($J){if(this._parent)$No._quaternionCreateFromYawPitchRollArray($J[1]/$G._angleToRandin,$J[0]/$G._angleToRandin,$J[2]/$G._angleToRandin,this._localRotation),this._localRotationEuler=$J,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $o=this._entity.owner._transform,$r=this._entity.localRotationEuler,$S=$r.elements;$S[0]=$J[0],$S[1]=$J[1],$S[2]=$J[2],$o.localRotationEuler=$r}},$o.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$No.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $J=this._getlocalMatrix(),$o=0;$o<16;++$o)this._worldMatrix[$o]=$J[$o];this._worldUpdate=!1}return this._worldMatrix},$o.setParent=function($J){if(this._parent!==$J){if(this._parent){var $o=this._parent._childs,$r=$o.indexOf(this);$o.splice($r,1)}$J&&($J._childs.push(this),$J&&this._onWorldTransform()),this._parent=$J}},$v($G,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$G}(),$Io=function($J){function $o(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$o.__super.call(this),this._destroyed=!1,this._id=$o._uniqueIDCounter,$o._uniqueIDCounter++}$Y($o,"laya.d3.component.Component3D",$z);var $r=$o.prototype;return $K.imps($r,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$r._initialize=function($J){this._owner=$J,this._enable=!0,this.started=!1,this._load($J)},$r._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$r._load=function($J){},$r._start=function($J){},$r._update=function($J){},$r._lateUpdate=function($J){},$r._preRenderUpdate=function($J){},$r._postRenderUpdate=function($J){},$r._unload=function($J){this.offAll()},$r._cloneTo=function($J){},$_(0,$r,"id",function(){return this._id}),$_(0,$r,"destroyed",function(){return this._destroyed}),$_(0,$r,"owner",function(){return this._owner}),$_(0,$r,"enable",function(){return this._enable},function($J){this._enable!==$J&&(this._enable=$J,this.event("enablechanged",this._enable))}),$_(0,$r,"isSingleton",function(){return $o._isSingleton}),$o._isSingleton=!0,$o._uniqueIDCounter=1,$o}(),$to=function($J){function $o(){this._destroyed=!1,$o.__super.call(this),this._destroyed=!1}$Y($o,"laya.d3.core.GeometryFilter",$z);var $r=$o.prototype;return $K.imps($r,{"laya.resource.IDestroy":!0}),$r._destroy=function(){this.offAll(),this._destroyed=!0},$_(0,$r,"_isAsyncLoaded",function(){return!0}),$_(0,$r,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$_(0,$r,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$_(0,$r,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$_(0,$r,"destroyed",function(){return this._destroyed}),$o}(),$Ko=function($J){function $S($J){$S.__super.call(this),this._id=++$S._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $OJ(new $Ao,new $Ao),this._boundingBoxCenter=new $Ao,this._boundingSphere=new $WJ(new $Ao,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$J,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$Y($S,"laya.d3.core.render.BaseRender",$z);var $o=$S.prototype;return $K.imps($o,{"laya.resource.IDestroy":!0}),$o._changeMaterialReference=function($J,$o){$J&&$J._removeReference(),$o._addReference()},$o._getInstanceMaterial=function($J,$o){var $r=new $J.constructor;return $J.cloneTo($r),$r.name=$r.name+"(Instance)",this._materialsInstance[$o]=!0,this._changeMaterialReference(this._materials[$o],$r),this._materials[$o]=$r},$o._setShaderValuelightMap=function($J){this._setShaderValueTexture(3,$J)},$o._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$o._renderRenderableBoundBox=function(){var $J=$wo._debugPhasorSprite,$o=this.boundingBox,$r=$S._tempBoundBoxCorners;$o.getCorners($r),$J.line($r[0],$S._greenColor,$r[1],$S._greenColor),$J.line($r[2],$S._greenColor,$r[3],$S._greenColor),$J.line($r[4],$S._greenColor,$r[5],$S._greenColor),$J.line($r[6],$S._greenColor,$r[7],$S._greenColor),$J.line($r[0],$S._greenColor,$r[3],$S._greenColor),$J.line($r[1],$S._greenColor,$r[2],$S._greenColor),$J.line($r[2],$S._greenColor,$r[6],$S._greenColor),$J.line($r[3],$S._greenColor,$r[7],$S._greenColor),$J.line($r[0],$S._greenColor,$r[4],$S._greenColor),$J.line($r[1],$S._greenColor,$r[5],$S._greenColor),$J.line($r[4],$S._greenColor,$r[7],$S._greenColor),$J.line($r[5],$S._greenColor,$r[6],$S._greenColor)},$o._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$o._calculateBoundingBox=function(){throw"BaseRender: must override it."},$o._setShaderValueTexture=function($J,$o){this._owner._shaderValues.setValue($J,$o)},$o._setShaderValueMatrix4x4=function($J,$o){this._owner._shaderValues.setValue($J,$o?$o.elements:null)},$o._setShaderValueColor=function($J,$o){this._owner._shaderValues.setValue($J,$o?$o.elements:null)},$o._setShaderValueBuffer=function($J,$o){this._owner._shaderValues.setValue($J,$o)},$o._setShaderValueInt=function($J,$o){this._owner._shaderValues.setValue($J,$o)},$o._setShaderValueBool=function($J,$o){this._owner._shaderValues.setValue($J,$o)},$o._setShaderValueNumber=function($J,$o){this._owner._shaderValues.setValue($J,$o)},$o._setShaderValueVector2=function($J,$o){this._owner._shaderValues.setValue($J,$o?$o.elements:null)},$o._addShaderDefine=function($J){this._owner._shaderDefineValue|=$J},$o._removeShaderDefine=function($J){this._owner._shaderDefineValue&=~$J},$o._renderUpdate=function($J){return!0},$o._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $J=this._owner.scene;if($J){var $o=$J.getlightmaps()[this._lightmapIndex];$o?(this._addShaderDefine($Ho.SAHDERDEFINE_LIGHTMAP),$o.loaded?this._setShaderValuelightMap($o):$o.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($Ho.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($Ho.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($Ho.SAHDERDEFINE_LIGHTMAP)},$o._updateOctreeNode=function(){var $J=this._treeNode;$J&&this._octreeNodeNeedChange&&($J.updateObject(this),this._octreeNodeNeedChange=!1)},$o._destroy=function(){this.offAll();var $J=0,$o=0;for($J=0,$o=this._renderElements.length;$J<$o;$J++)this._renderElements[$J]._destroy();for($J=0,$o=this._materials.length;$J<$o;$J++)this._materials[$J]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$_(0,$o,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$_(0,$o,"id",function(){return this._id}),$_(0,$o,"material",function(){var $J=this._materials[0];if($J&&!this._materialsInstance[0]){var $o=this._getInstanceMaterial($J,0);this.event("materialchanged",[this,0,$o])}return this._materials[0]},function($J){this.sharedMaterial=$J}),$_(0,$o,"sharedMaterial",function(){return this._materials[0]},function($J){var $o=this._materials[0];$o!==$J&&(this._materials[0]=$J,this._materialsInstance[0]=!1,this._changeMaterialReference($o,$J),this.event("materialchanged",[this,0,$J]))}),$_(0,$o,"lightmapIndex",function(){return this._lightmapIndex},function($J){this._lightmapIndex=$J,this._applyLightMapParams()}),$_(0,$o,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($J){this._lightmapScaleOffset=$J,this._setShaderValueColor(2,$J),this._addShaderDefine($Ho.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$_(0,$o,"enable",function(){return this._enable},function($J){this._enable=$J,this.event("enablechanged",[this,$J])}),$_(0,$o,"materials",function(){for(var $J=0,$o=this._materials.length;$J<$o;$J++)if(!this._materialsInstance[$J]){var $r=this._getInstanceMaterial(this._materials[$J],$J);this.event("materialchanged",[this,$J,$r])}return this._materials.slice()},function($J){this.sharedMaterials=$J}),$_(0,$o,"sharedMaterials",function(){return this._materials.slice()},function($J){if(!$J)throw new Error("MeshRender: shadredMaterials value can't be null.");var $o=$J.length;this._materialsInstance.length=$o;for(var $r=0;$r<$o;$r++){var $S=this._materials[$r];$S!==$J[$r]&&(this._materialsInstance[$r]=!1,this._changeMaterialReference($S,$J[$r]),this.event("materialchanged",[this,$r,$J[$r]]))}this._materials=$J}),$_(0,$o,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$_(0,$o,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $J=this.boundingBox;$Ao.add($J.min,$J.max,this._boundingBoxCenter),$Ao.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$_(0,$o,"receiveShadow",function(){return this._receiveShadow},function($J){this._receiveShadow!==$J&&((this._receiveShadow=$J)?this._addShaderDefine($Yo.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($Yo.SHADERDEFINE_RECEIVE_SHADOW))}),$_(0,$o,"destroyed",function(){return this._destroyed}),$S._uniqueIDCounter=0,$v($S,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao,new $Ao]},"_greenColor",function(){return this._greenColor=new $ho(0,1,0,1)}]),$S}(),$eo=function($J){function $h($J){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$h.__super.call(this),this._localPosition=new $Ao,this._localRotation=new $ro(0,0,0,1),this._localScale=new $Ao(1,1,1),this._localRotationEuler=new $Ao,this._localMatrix=new $Jo,this._position=new $Ao,this._rotation=new $ro(0,0,0,1),this._scale=new $Ao(1,1,1),this._worldMatrix=new $Jo,this._forward=new $Ao,this._up=new $Ao,this._right=new $Ao,this._owner=$J,this._childs=[]}$Y($h,"laya.d3.core.Transform3D",$z);var $o=$h.prototype;return $o._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$Jo.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $J=$h._tempVector30;$Ao.multiply(this.pivot,this._localScale,$J);var $o=$h._tempVector31;$Ao.subtract($J,this.pivot,$o);var $r=$h._tempVector32,$S=this.localRotation;$Ao.transformQuat($J,$S,$r),$Ao.subtract($r,$J,$r);var $G=$h._tempVector33;$Ao.subtract(this._localPosition,$o,$G),$Ao.subtract($G,$r,$G),$Jo.createAffineTransformation($G,$S,this._localScale,this._localMatrix)}},$o._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldPositionRotationTransform()}},$o._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldPositionScaleTransform()}},$o._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldPositionTransform()}},$o._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldPositionRotationTransform()}},$o._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldPositionScaleTransform()}},$o._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._onWorldTransform()}},$o.translate=function($J,$o){void 0===$o&&($o=!0),$o?($Jo.createFromQuaternion(this.localRotation,$h._tempMatrix0),$Ao.transformCoordinate($J,$h._tempMatrix0,$h._tempVector30),$Ao.add(this.localPosition,$h._tempVector30,this._localPosition),this.localPosition=this._localPosition):($Ao.add(this.position,$J,this._position),this.position=this._position)},$o.rotate=function($J,$o,$r){var $S;void 0===$o&&($o=!0),void 0===$r&&($r=!0),$S=$r?$J:($Ao.scale($J,Math.PI/180,$h._tempVector30),$h._tempVector30),$ro.createFromYawPitchRoll($S.y,$S.x,$S.z,$h._tempQuaternion0),$o?($ro.multiply(this._localRotation,$h._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($ro.multiply($h._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$o.lookAt=function($J,$o,$r){void 0===$r&&($r=!1);var $S,$G=$J.elements;if($r){if($S=this._localPosition.elements,Math.abs($S[0]-$G[0])<$EJ.zeroTolerance&&Math.abs($S[1]-$G[1])<$EJ.zeroTolerance&&Math.abs($S[2]-$G[2])<$EJ.zeroTolerance)return;$ro.lookAt(this._localPosition,$J,$o,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $z=this.position;if($S=$z.elements,Math.abs($S[0]-$G[0])<$EJ.zeroTolerance&&Math.abs($S[1]-$G[1])<$EJ.zeroTolerance&&Math.abs($S[2]-$G[2])<$EJ.zeroTolerance)return;$ro.lookAt($z,$J,$o,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$_(0,$o,"_isFrontFaceInvert",function(){var $J=this.scale,$o=$J.x<0;return $J.y<0&&($o=!$o),$J.z<0&&($o=!$o),$o}),$_(0,$o,"owner",function(){return this._owner}),$_(0,$o,"localRotation",function(){if(this._localQuaternionUpdate){var $J=this._localRotationEuler.elements;$ro.createFromYawPitchRoll($J[1]/$h._angleToRandin,$J[0]/$h._angleToRandin,$J[2]/$h._angleToRandin,this._localRotation)}return this._localRotation},function($J){this._localRotation=$J,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$_(0,$o,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$Jo.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($J){null===this._parent?$J.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$Jo.multiply(this._localMatrix,$J,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$J,this._worldUpdate=!1}),$_(0,$o,"worldNeedUpdate",function(){return this._worldUpdate}),$_(0,$o,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($J){this._localMatrix=$J,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$_(0,$o,"dummy",function(){return this._dummy},function($J){this._dummy!==$J&&(this._dummy&&(this._dummy._entity=null),$J&&($J._entity=this),this._dummy=$J)}),$_(0,$o,"localPosition",function(){return this._localPosition},function($J){this._localPosition=$J,this._localUpdate=!0,this._onWorldPositionTransform()}),$_(0,$o,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $J=this._parent.position;$Ao.multiply(this._localPosition,this._parent.scale,$h._tempVector30),$Ao.transformQuat($h._tempVector30,this._parent.rotation,$h._tempVector30),$Ao.add($J,$h._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($J){if(null!=this._parent){$Ao.subtract($J,this._parent.position,this._localPosition);var $o=this._parent.scale.elements,$r=$o[0],$S=$o[1],$G=$o[2];if(1!==$r||1!==$S||1!==$G){var $z=$h._tempVector30,$A=$z.elements;$A[0]=1/$r,$A[1]=1/$S,$A[2]=1/$G,$Ao.multiply(this._localPosition,$z,this._localPosition)}this._parent.rotation.invert($h._tempQuaternion0),$Ao.transformQuat(this._localPosition,$h._tempQuaternion0,this._localPosition)}else $J.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$J,this._positionUpdate=!1}),$_(0,$o,"localScale",function(){return this._localScale},function($J){this._localScale=$J,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$_(0,$o,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($h._tempVector30);var $J=$h._tempVector30.elements,$o=this._localRotationEuler.elements;$o[0]=$J[1]*$h._angleToRandin,$o[1]=$J[0]*$h._angleToRandin,$o[2]=$J[2]*$h._angleToRandin}return this._localRotationEuler},function($J){this._localRotationEuler=$J,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$_(0,$o,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$ro.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($J){null!=this._parent?(this._parent.rotation.invert($h._tempQuaternion0),$ro.multiply($J,$h._tempQuaternion0,this._localRotation)):$J.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$J,this._rotationUpdate=!1}),$_(0,$o,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$Ao.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($J){if(null!==this._parent){var $o=this._parent.scale.elements,$r=$h._tempVector30.elements;$r[0]=1/$o[0],$r[1]=1/$o[1],$r[2]=1/$o[2],$Ao.multiply($J,$h._tempVector30,this._localScale)}else $J.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$J,this._scaleUpdate=!1}),$_(0,$o,"rotationEuler",null,function($J){$ro.createFromYawPitchRoll($J.y,$J.x,$J.z,this._rotation),this.rotation=this._rotation}),$_(0,$o,"forward",function(){var $J=this.worldMatrix.elements;return this._forward.elements[0]=-$J[8],this._forward.elements[1]=-$J[9],this._forward.elements[2]=-$J[10],this._forward}),$_(0,$o,"up",function(){var $J=this.worldMatrix.elements;return this._up.elements[0]=$J[4],this._up.elements[1]=$J[5],this._up.elements[2]=$J[6],this._up}),$_(0,$o,"right",function(){var $J=this.worldMatrix.elements;return this._right.elements[0]=$J[0],this._right.elements[1]=$J[1],this._right.elements[2]=$J[2],this._right}),$_(0,$o,"parent",function(){return this._parent},function($J){if(this._parent!==$J){if(this._parent){var $o=this._parent._childs,$r=$o.indexOf(this);$o.splice($r,1)}$J&&($J._childs.push(this),$J&&this._onWorldTransform()),this._parent=$J}}),$v($h,["_tempVector30",function(){return this._tempVector30=new $Ao},"_tempVector31",function(){return this._tempVector31=new $Ao},"_tempVector32",function(){return this._tempVector32=new $Ao},"_tempVector33",function(){return this._tempVector33=new $Ao},"_tempQuaternion0",function(){return this._tempQuaternion0=new $ro},"_tempMatrix0",function(){return this._tempMatrix0=new $Jo},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$h}(),$yo=(function($J){function $o(){this._rotation=0,this._matNeedUpdte=!1,$o.__super.call(this),this._matrix=new $Jo,this._offset=new $zo,this._tiling=new $zo(1,1)}$Y($o,"laya.d3.core.TransformUV",$z);var $r=$o.prototype;$K.imps($r,{"laya.d3.core.IClone":!0}),$r._updateMatrix=function(){$o._tempOffsetV3.elements[0]=this._offset.x,$o._tempOffsetV3.elements[1]=this._offset.y,$ro.createFromYawPitchRoll(0,0,this._rotation,$o._tempRotationQua),$o._tempTitlingV3.elements[0]=this._tiling.x,$o._tempTitlingV3.elements[1]=this._tiling.y,$Jo.createAffineTransformation($o._tempOffsetV3,$o._tempRotationQua,$o._tempTitlingV3,this._matrix)},$r.cloneTo=function($J){$J._matrix=this._matrix.clone(),$J._offset=this._offset.clone(),$J._rotation=this._rotation,$J._tiling=this._tiling.clone()},$r.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$r,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$_(0,$r,"tiling",function(){return this._tiling},function($J){this._tiling=$J,this._matNeedUpdte=!0}),$_(0,$r,"offset",function(){return this._offset},function($J){this._offset=$J,this._matNeedUpdte=!0}),$_(0,$r,"rotation",function(){return this._rotation},function($J){this._rotation=$J,this._matNeedUpdte=!0}),$v($o,["_tempOffsetV3",function(){return this._tempOffsetV3=new $Ao(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $ro},"_tempTitlingV3",function(){return this._tempTitlingV3=new $Ao(1,1,1)}])}(),function($r){function $J(){this.x=NaN,this.y=NaN,this.z=NaN,$J.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$Y($J,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$r);var $o=$J.prototype;$o._getShapeBoundBox=function($J){var $o=$J.min.elements;$o[0]=.5*-this.x,$o[1]=.5*-this.y,$o[2]=.5*-this.z;var $r=$J.max.elements;$r[0]=.5*this.x,$r[1]=.5*this.y,$r[2]=.5*this.z},$o._getSpeedBoundBox=function($J){var $o=$J.min.elements;$o[0]=0,$o[1]=0,$o[2]=0;var $r=$J.max.elements;$r[0]=0,$r[1]=1,$r[2]=0},$o.generatePositionAndDirection=function($J,$o,$r,$S){var $G=$J.elements,$z=$o.elements;$r?($r.seed=$S[16],$$._randomPointInsideHalfUnitBox($J,$r),$S[16]=$r.seed):$$._randomPointInsideHalfUnitBox($J),$G[0]=this.x*$G[0],$G[1]=this.y*$G[1],$G[2]=this.z*$G[2],this.randomDirection?$r?($r.seed=$S[17],$$._randomPointUnitSphere($o,$r),$S[17]=$r.seed):$$._randomPointUnitSphere($o):($z[0]=0,$z[1]=0,$z[2]=1)},$o.cloneTo=function($J){$r.prototype.cloneTo.call(this,$J);var $o=$J;$o.x=this.x,$o.y=this.y,$o.z=this.z,$o.randomDirection=this.randomDirection}}($d),function($r){function $A(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$A.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$Y($A,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$r);var $J=$A.prototype;$J._getShapeBoundBox=function($J){var $o=$J.min.elements;$o[0]=$o[2]=-this.radius,$o[1]=0;var $r=$J.max.elements;$r[0]=$r[2]=this.radius,$r[1]=0},$J._getSpeedBoundBox=function($J){var $o=$J.min.elements;$o[0]=$o[1]=-1,$o[2]=0;var $r=$J.max.elements;$r[0]=$r[1]=1,$r[2]=0},$J.generatePositionAndDirection=function($J,$o,$r,$S){var $G=$J.elements,$z=$A._tempPositionPoint.elements;$r?($r.seed=$S[16],this.emitFromEdge?$$._randomPointUnitArcCircle(this.arc,$A._tempPositionPoint,$r):$$._randomPointInsideUnitArcCircle(this.arc,$A._tempPositionPoint,$r),$S[16]=$r.seed):this.emitFromEdge?$$._randomPointUnitArcCircle(this.arc,$A._tempPositionPoint):$$._randomPointInsideUnitArcCircle(this.arc,$A._tempPositionPoint),$G[0]=-$z[0],$G[1]=$z[1],$G[2]=0,$Ao.scale($J,this.radius,$J),this.randomDirection?$r?($r.seed=$S[17],$$._randomPointUnitSphere($o,$r),$S[17]=$r.seed):$$._randomPointUnitSphere($o):$J.cloneTo($o)},$J.cloneTo=function($J){$r.prototype.cloneTo.call(this,$J);var $o=$J;$o.radius=this.radius,$o.arc=this.arc,$o.emitFromEdge=this.emitFromEdge,$o.randomDirection=this.randomDirection},$v($A,["_tempPositionPoint",function(){return this._tempPositionPoint=new $zo}])}($d),function($r){function $j(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$j.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$Y($j,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$r);var $J=$j.prototype;$J._getShapeBoundBox=function($J){var $o=this.radius+this.length*Math.sin(this.angle),$r=this.length*Math.cos(this.angle),$S=$J.min.elements;$S[0]=$S[1]=-$o,$S[2]=0;var $G=$J.max.elements;$G[0]=$G[1]=$o,$G[2]=$r},$J._getSpeedBoundBox=function($J){var $o=Math.sin(this.angle),$r=$J.min.elements;$r[0]=$r[1]=-$o,$r[2]=0;var $S=$J.max.elements;$S[0]=$r[1]=$o,$S[2]=1},$J.generatePositionAndDirection=function($J,$o,$r,$S){var $G,$z=$J.elements,$A=$o.elements,$h=$j._tempPositionPoint.elements,$Z=NaN,$u=NaN,$B=Math.cos(this.angle),$v=Math.sin(this.angle);switch(this.emitType){case 0:$r?($r.seed=$S[16],$$._randomPointInsideUnitCircle($j._tempPositionPoint,$r),$S[16]=$r.seed):$$._randomPointInsideUnitCircle($j._tempPositionPoint),$Z=$h[0],$u=$h[1],$z[0]=$Z*this.radius,$z[1]=$u*this.radius,$z[2]=0,this.randomDirection?($r?($r.seed=$S[17],$$._randomPointInsideUnitCircle($j._tempDirectionPoint,$r),$S[17]=$r.seed):$$._randomPointInsideUnitCircle($j._tempDirectionPoint),$G=$j._tempDirectionPoint.elements,$A[0]=$G[0]*$v,$A[1]=$G[1]*$v):($A[0]=$Z*$v,$A[1]=$u*$v),$A[2]=$B;break;case 1:$r?($r.seed=$S[16],$$._randomPointUnitCircle($j._tempPositionPoint,$r),$S[16]=$r.seed):$$._randomPointUnitCircle($j._tempPositionPoint),$Z=$h[0],$u=$h[1],$z[0]=$Z*this.radius,$z[1]=$u*this.radius,$z[2]=0,this.randomDirection?($r?($r.seed=$S[17],$$._randomPointInsideUnitCircle($j._tempDirectionPoint,$r),$S[17]=$r.seed):$$._randomPointInsideUnitCircle($j._tempDirectionPoint),$G=$j._tempDirectionPoint.elements,$A[0]=$G[0]*$v,$A[1]=$G[1]*$v):($A[0]=$Z*$v,$A[1]=$u*$v),$A[2]=$B;break;case 2:$r?($r.seed=$S[16],$$._randomPointInsideUnitCircle($j._tempPositionPoint,$r)):$$._randomPointInsideUnitCircle($j._tempPositionPoint),$Z=$h[0],$u=$h[1],$z[0]=$Z*this.radius,$z[1]=$u*this.radius,$A[$z[2]=0]=$Z*$v,$A[1]=$u*$v,$A[2]=$B,$Ao.normalize($o,$o),$r?($Ao.scale($o,this.length*$r.getFloat(),$o),$S[16]=$r.seed):$Ao.scale($o,this.length*Math.random(),$o),$Ao.add($J,$o,$J),this.randomDirection&&($r?($r.seed=$S[17],$$._randomPointUnitSphere($o,$r),$S[17]=$r.seed):$$._randomPointUnitSphere($o));break;case 3:$r?($r.seed=$S[16],$$._randomPointUnitCircle($j._tempPositionPoint,$r)):$$._randomPointUnitCircle($j._tempPositionPoint),$Z=$h[0],$u=$h[1],$z[0]=$Z*this.radius,$z[1]=$u*this.radius,$A[$z[2]=0]=$Z*$v,$A[1]=$u*$v,$A[2]=$B,$Ao.normalize($o,$o),$r?($Ao.scale($o,this.length*$r.getFloat(),$o),$S[16]=$r.seed):$Ao.scale($o,this.length*Math.random(),$o),$Ao.add($J,$o,$J),this.randomDirection&&($r?($r.seed=$S[17],$$._randomPointUnitSphere($o,$r),$S[17]=$r.seed):$$._randomPointUnitSphere($o));break;default:throw new Error("ConeShape:emitType is invalid.")}},$J.cloneTo=function($J){$r.prototype.cloneTo.call(this,$J);var $o=$J;$o.angle=this.angle,$o.radius=this.radius,$o.length=this.length,$o.emitType=this.emitType,$o.randomDirection=this.randomDirection},$v($j,["_tempPositionPoint",function(){return this._tempPositionPoint=new $zo},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $zo}])}($d),function($r){function $J(){this.radius=NaN,this.emitFromShell=!1,$J.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$Y($J,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$r);var $o=$J.prototype;$o._getShapeBoundBox=function($J){var $o=$J.min.elements;$o[0]=$o[1]=$o[2]=-this.radius;var $r=$J.max.elements;$r[0]=$r[1]=this.radius,$r[2]=0},$o._getSpeedBoundBox=function($J){var $o=$J.min.elements;$o[0]=$o[1]=-1,$o[2]=0;var $r=$J.max.elements;$r[0]=$r[1]=$r[2]=1},$o.generatePositionAndDirection=function($J,$o,$r,$S){var $G=$J.elements;$r?($r.seed=$S[16],this.emitFromShell?$$._randomPointUnitSphere($J,$r):$$._randomPointInsideUnitSphere($J,$r),$S[16]=$r.seed):this.emitFromShell?$$._randomPointUnitSphere($J):$$._randomPointInsideUnitSphere($J),$Ao.scale($J,this.radius,$J);var $z=$G[2];$z<0&&($G[2]=-1*$z),this.randomDirection?$r?($r.seed=$S[17],$$._randomPointUnitSphere($o,$r),$S[17]=$r.seed):$$._randomPointUnitSphere($o):$J.cloneTo($o)},$o.cloneTo=function($J){$r.prototype.cloneTo.call(this,$J);var $o=$J;$o.radius=this.radius,$o.emitFromShell=this.emitFromShell,$o.randomDirection=this.randomDirection}}($d),function($r){function $J(){this.radius=NaN,this.emitFromShell=!1,$J.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$Y($J,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$r);var $o=$J.prototype;$o._getShapeBoundBox=function($J){var $o=$J.min.elements;$o[0]=$o[1]=$o[2]=-this.radius;var $r=$J.max.elements;$r[0]=$r[1]=$r[2]=this.radius},$o._getSpeedBoundBox=function($J){var $o=$J.min.elements;$o[0]=$o[1]=$o[2]=-1;var $r=$J.max.elements;$r[0]=$r[1]=$r[2]=1},$o.generatePositionAndDirection=function($J,$o,$r,$S){$r?($r.seed=$S[16],this.emitFromShell?$$._randomPointUnitSphere($J,$r):$$._randomPointInsideUnitSphere($J,$r),$S[16]=$r.seed):this.emitFromShell?$$._randomPointUnitSphere($J):$$._randomPointInsideUnitSphere($J),$Ao.scale($J,this.radius,$J),this.randomDirection?$r?($r.seed=$S[17],$$._randomPointUnitSphere($o,$r),$S[17]=$r.seed):$$._randomPointUnitSphere($o):$J.cloneTo($o)},$o.cloneTo=function($J){$r.prototype.cloneTo.call(this,$J);var $o=$J;$o.radius=this.radius,$o.emitFromShell=this.emitFromShell,$o.randomDirection=this.randomDirection}}($d),function($J){function $o(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$o.__super.call(this)}return $Y($o,"laya.d3.core.render.SubMeshRenderElement",$a),$o}()),$go=function($J){function $N($J,$o,$r,$S,$G,$z){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$J,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$Yo.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$Ho.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$Ho.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$Co.SHADERDEFINE_ALPHATEST]="ALPHATEST";$N.__super.call(this,$J,$o,$r,null,{}),this._attributeMap=$S;var $A;for($A in $G){var $h=$G[$A];switch($h[1]){case 0:this._renderElementUniformMap[$A]=$h[0];break;case 1:this._materialUniformMap[$A]=$h[0];break;case 2:this._spriteUniformMap[$A]=$h[0];break;case 3:this._cameraUniformMap[$A]=$h[0];break;case 4:this._sceneUniformMap[$A]=$h[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$Y($N,"laya.d3.shader.ShaderCompile3D",$I);var $o=$N.prototype;return $o._definesToNameDic=function($J,$o){for(var $r={},$S=1,$G=0;$G<32&&!($J<($S=1<<$G));$G++)if($J&$S){var $z=$o[$S];$z&&($r[$z]="")}return $r},$o.withCompile=function($J,$o,$r,$S){var $G,$z,$A;if($z=this.sharders[$J])if($A=$z[$o]){if($G=$A[$r])return $G}else $A=$z[$o]=[];else $A=($z=this.sharders[$J]=[])[$o]=[];var $h,$Z=this._definesToNameDic($J,$N._globalInt2name),$u=this._definesToNameDic($o,this._spriteInt2name),$B=this._definesToNameDic($r,this._materialInt2name),$v={},$j="";if($Z)for($h in $Z)$j+="#define "+$h+"\n",$v[$h]=!0;if($u)for($h in $u)$j+="#define "+$h+"\n",$v[$h]=!0;if($B)for($h in $B)$j+="#define "+$h+"\n",$v[$h]=!0;var $Y=$po.nameKey.getName(this._name)+" compile ("+$J+","+$o+","+$r+")",$_=this._VS.toscript($v,[]),$D=this._PS.toscript($v,[]);$k.now();if($G=$po.create($j+$_.join("\n"),$j+$D.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$S,$Y),$A[$r]=$G,laya.d3.shader.ShaderCompile3D.debugMode)$k.now();return $G},$o.precompileShaderWithShaderDefine=function($J,$o,$r){this.withCompile($J,$o,$r,!0)},$o.addMaterialDefines=function($J){var $o=$J.defines;for(var $r in $o){var $S=$o[$r],$G=parseInt($r);this._materialInt2name[$G]=$S,this._materialName2Int[$S]=$G}},$o.addSpriteDefines=function($J){var $o=$J.defines;for(var $r in $o){var $S=$o[$r],$G=parseInt($r);this._spriteInt2name[$G]=$S,this._spriteName2Int[$S]=$G}},$o.getMaterialDefineByName=function($J){return this._materialName2Int[$J]},$o.registerMaterialDefine=function($J){var $o=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$o]=$J,this._materialName2Int[$J]=$o},$o.registerSpriteDefine=function($J){var $o=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$o]=$J,this._spriteName2Int[$J]=$o},$N._globalRegDefine=function($J,$o){$N._globalInt2name[$o]=$J},$N.add=function($J,$o,$r,$S,$G){return laya.d3.shader.ShaderCompile3D._preCompileShader[$J]=new $N($J,$o,$r,$S,$G,$I.includes)},$N.get=function($J){return laya.d3.shader.ShaderCompile3D._preCompileShader[$po.nameKey.getID($J)]},$N._preCompileShader={},$N._globalInt2name=[],$N.debugMode=!1,$N.SHADERDEFINE_HIGHPRECISION=1,$N.SHADERDEFINE_FOG=4,$N.SHADERDEFINE_DIRECTIONLIGHT=8,$N.SHADERDEFINE_POINTLIGHT=16,$N.SHADERDEFINE_SPOTLIGHT=32,$N.SHADERDEFINE_UV0=64,$N.SHADERDEFINE_COLOR=128,$N.SHADERDEFINE_UV1=256,$N.SAHDERDEFINE_DEPTHFOG=131072,$N}(),$so=function($J){function $_(){$_.__super.call(this)}$Y($_,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$SJ);var $o=$_.prototype;return $o._getStaticBatch=function($J,$o,$r,$S){var $G,$z;return $z=$J?$J.id.toString()+$r.id.toString()+$o.id.toString()+$S.toString():$r.id.toString()+$o.id.toString()+$S.toString(),this._staticBatches[$z]?$G=this._staticBatches[$z]:this._staticBatches[$z]=$G=new $Vo($z,this,$J,$o,$r),$G},$o._initStaticBatchs=function($J){var $o,$r;this._initBatchRenderElements.sort($_._sortPrepareStaticBatch);for(var $S,$G=!1,$z=0,$A=0,$h=this._initBatchRenderElements.length;$A<$h;$A++){var $Z,$u=this._initBatchRenderElements[$A],$B=$u.renderObj._getVertexBuffer(0);$u._sprite3D;if($r===$B.vertexDeclaration&&$o===$u._material)if($G)$S._addCombineBatchRenderObjTest($u)?($Z=$u._staticBatch)!==$S&&($Z&&$Z._deleteCombineBatchRenderObj($u),$S._addCombineBatchRenderObj($u)):($G=!1,$z++);else{var $v=this._initBatchRenderElements[$A-1],$j=$v.renderObj,$Y=$u.renderObj;$G=!(65535<$j._getVertexBuffer().vertexCount+$Y._getVertexBuffer().vertexCount)&&($S=this._getStaticBatch($J,$r,$o,$z),($Z=$v._staticBatch)!==$S&&($Z&&$Z._deleteCombineBatchRenderObj($v),$S._addCombineBatchRenderObj($v)),($Z=$u._staticBatch)!==$S&&($Z&&$Z._deleteCombineBatchRenderObj($u),$S._addCombineBatchRenderObj($u)),!0)}else $G=!1,$z=0;$o=$u._material,$r=$B.vertexDeclaration}},$_._sortPrepareStaticBatch=function($J,$o){var $r=$J._render,$S=$o._render,$G=$r.lightmapIndex-$S.lightmapIndex;if(0!=$G)return $G;var $z=$r.receiveShadow-$S.receiveShadow;if(0!=$z)return $z;var $A=$J._mainSortID-$o._mainSortID;return 0==$A?$J.renderObj.triangleCount-$o.renderObj.triangleCount:$A},$_}(),$Vo=function($J){function $z($J,$o,$r,$S,$G){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$z.__super.call(this,$J,$o,$r),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$S,this._material=$G}$Y($z,"laya.d3.graphics.SubMeshStaticBatch",$GJ);var $o=$z.prototype;return $o._compareBatchRenderElement=function($J,$o){return $J._batchIndexStart>$o._batchIndexStart},$o._addCombineBatchRenderObjTest=function($J){var $o=$J.renderObj._vertexCount;return!(65535<(0<$o?this._currentCombineVertexCount+$o:this._currentCombineVertexCount+$J.renderObj._getVertexBuffer().vertexCount))},$o._addCombineBatchRenderObj=function($J){var $o=$J.renderObj,$r=$o._vertexCount;this._initBatchRenderElements.push($J),$J._staticBatch=this,0<$r?(this._currentCombineIndexCount+=$o._indexCount,this._currentCombineVertexCount+=$r):(this._currentCombineIndexCount=this._currentCombineIndexCount+$o._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$o._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$o._deleteCombineBatchRenderObj=function($J){var $o=$J.renderObj,$r=this._initBatchRenderElements.indexOf($J);if(-1!==$r){this._initBatchRenderElements.splice($r,1),$J._staticBatch=null;var $S=$o._vertexCount;0<$S?(this._currentCombineIndexCount=this._currentCombineIndexCount-$o._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$S):(this._currentCombineIndexCount=this._currentCombineIndexCount-$o._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$o._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$o._finishInit=function(){if(this._needFinishCombine){var $J=0,$o=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $r=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$S=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$do.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$Fo.create("ushort",this._currentCombineIndexCount,35044);for(var $G=0,$z=this._initBatchRenderElements.length;$G<$z;$G++){var $A=this._initBatchRenderElements[$G],$h=$A.renderObj,$Z=$h._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$A._sprite3D),$u=$h.getIndices(),$B=$A._sprite3D.transform._isFrontFaceInvert,$v=$J/(this._vertexDeclaration.vertexStride/4)-$h._vertexStart,$j=$o,$Y=$j+$u.length;$A._batchIndexStart=$j,$A._batchIndexEnd=$Y,$S.set($u,$o);var $_=0;if($B)for($_=$j;$_<$Y;$_+=3){$S[$_]=$v+$S[$_];var $D=$S[$_+1],$N=$S[$_+2];$S[$_+1]=$v+$N,$S[$_+2]=$v+$D}else for($_=$j;$_<$Y;$_+=3)$S[$_]=$v+$S[$_],$S[$_+1]=$v+$S[$_+1],$S[$_+2]=$v+$S[$_+2];$o+=$u.length,$r.set($Z,$J),$J+=$Z.length}this._vertexBuffer.setData($r),this._indexBuffer.setData($S),this._needFinishCombine=!1}},$o._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $yo)},$o._getRenderElement=function($J,$o,$r){for(var $S,$G,$z=this._batchRenderElements.length,$A=!0,$h=0;$h<$z;$h++){var $Z,$u,$B=($G=this._batchRenderElements[$h])._sprite3D._render;if(0!==$h&&($A=($Z=($S=this._batchRenderElements[$h-1])._sprite3D._render).lightmapIndex!==$B.lightmapIndex||$Z.receiveShadow!==$B.receiveShadow||$S._batchIndexEnd!==$G._batchIndexStart),$A){($u=this._getCombineRenderElementFromPool()).renderObj=this,$u._material=this._material,$u._batchIndexStart=$G._batchIndexStart,$u._batchIndexEnd=$G._batchIndexEnd;var $v=$B.lightmapIndex,$j=$v+1,$Y=this._batchOwnerIndices[$j];$Y||($Y=this._batchOwnerIndices[$j]=[]);var $_,$D=$Y[$G._render.receiveShadow?1:0];void 0===$D?($Y[$B.receiveShadow?1:0]=this._batchOwners.length,($_=new $xo(null,"StaticBatchMeshSprite3D"))._scene=$o,$_._transform=this._rootOwner?this._rootOwner._transform:null,$_._render.lightmapIndex=$v,$_._render.receiveShadow=$G._render.receiveShadow,this._batchOwners.push($_)):$_=this._batchOwners[$D],$_._render._renderUpdate($r),$u._sprite3D=$_,$J.push($u)}else $u._batchIndexEnd=$G._batchIndexEnd}},$o._beforeRender=function($J){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$o._render=function($J){var $o=$J.renderElement,$r=$o._batchIndexStart,$S=$o._batchIndexEnd-$r;$R.mainContext.drawElements(4,$S,5123,2*$r),$g.drawCall++,$g.trianglesFaces+=$S/3},$o.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$o._getVertexBuffer=function($J){return void 0===$J&&($J=0),this._vertexBuffer},$z}(),$mo=function($J){function $o(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$o.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$Y($o,"laya.d3.core.ComponentNode",$u);var $r=$o.prototype;return $r.addComponent=function($J){var $o,$r=this._componentsMap.indexOf($J);if(-1===$r)$o=[],this._componentsMap.push($J),this._typeComponentsIndices.push($o);else if($o=this._typeComponentsIndices[$r],this._components[$o[0]].isSingleton)throw new Error("无法单实例创建"+$J+"组件，"+$J+"组件已存在！");var $S=$G.getInstance($J);return $o.push(this._components.length),this._components.push($S),$S instanceof laya.d3.component.Script&&this._scripts.push($S),$S._initialize(this),$S},$r._removeComponent=function($J,$o){var $r=this._typeComponentsIndices[$J],$S=$r[$o],$G=this._components[$S];this._components.splice($S,1),$G instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($G),1),$r.splice($o,1),0===$r.length&&(this._typeComponentsIndices.splice($J,1),this._componentsMap.splice($J,1));for(var $z=0,$A=this._componentsMap.length;$z<$A;$z++)for(var $h=($r=this._typeComponentsIndices[$z]).length-1;0<=$h;$h--){var $Z=$r[$h];if(!($S<$Z))break;$r[$h]=--$Z}$G._destroy()},$r.getComponentByType=function($J,$o){void 0===$o&&($o=0);var $r=this._componentsMap.indexOf($J);return-1===$r?null:this._components[this._typeComponentsIndices[$r][$o]]},$r.getComponentsByType=function($J,$o){var $r=this._componentsMap.indexOf($J);if(-1!==$r){var $S=this._typeComponentsIndices[$r],$G=$S.length;$o.length=$G;for(var $z=0;$z<$G;$z++)$o[$z]=this._components[$S[$z]]}else $o.length=0},$r.getComponentByIndex=function($J){return this._components[$J]},$r.removeComponentByType=function($J,$o){void 0===$o&&($o=0);var $r=this._componentsMap.indexOf($J);-1!==$r&&this._removeComponent($r,$o)},$r.removeComponentsByType=function($J){var $o=this._componentsMap.indexOf($J);if(-1!==$o)for(var $r=this._typeComponentsIndices[$o],$S=0,$G=$r.length;$S<$G;$r.length<$G?$G--:$S++)this._removeComponent($o,$S)},$r.removeAllComponent=function(){for(var $J=0,$o=this._componentsMap.length;$J<$o;this._componentsMap.length<$o?$o--:$J++)this.removeComponentsByType(this._componentsMap[$J])},$r._updateComponents=function($J){for(var $o=0,$r=this._components.length;$o<$r;$o++){var $S=this._components[$o];!$S.started&&($S._start($J),$S.started=!0),$S.enable&&$S._update($J)}},$r._lateUpdateComponents=function($J){for(var $o=0;$o<this._components.length;$o++){var $r=this._components[$o];!$r.started&&($r._start($J),$r.started=!0),$r.enable&&$r._lateUpdate($J)}},$r._preRenderUpdateComponents=function($J){for(var $o=0;$o<this._components.length;$o++){var $r=this._components[$o];!$r.started&&($r._start($J),$r.started=!0),$r.enable&&$r._preRenderUpdate($J)}},$r._postRenderUpdateComponents=function($J){for(var $o=0;$o<this._components.length;$o++){var $r=this._components[$o];!$r.started&&($r._start($J),$r.started=!0),$r.enable&&$r._postRenderUpdate($J)}},$o}(),$Co=function($S){function $J(){$J.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $jo,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $ho(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$Y($J,"laya.d3.core.material.BaseMaterial",$S);var $o=$J.prototype;return $K.imps($o,{"laya.d3.core.IClone":!0}),$o._addShaderDefine=function($J){this._shaderDefineValue|=$J},$o._removeShaderDefine=function($J){this._shaderDefineValue&=~$J},$o._addDisablePublicShaderDefine=function($J){this._disablePublicShaderDefine|=$J},$o._removeDisablePublicShaderDefine=function($J){this._disablePublicShaderDefine&=~$J},$o._setBuffer=function($J,$o){this._shaderValues.setValue($J,$o),this._values[$J]=$o},$o._getBuffer=function($J){return this._values[$J]},$o._setMatrix4x4=function($J,$o){this._shaderValues.setValue($J,$o?$o.elements:null),this._values[$J]=$o},$o._getMatrix4x4=function($J){return this._values[$J]},$o._setInt=function($J,$o){this._shaderValues.setValue($J,$o),this._values[$J]=$o},$o._getInt=function($J){return this._values[$J]},$o._setNumber=function($J,$o){this._shaderValues.setValue($J,$o),this._values[$J]=$o},$o._getNumber=function($J){return this._values[$J]},$o._setBool=function($J,$o){this._shaderValues.setValue($J,$o),this._values[$J]=$o},$o._getBool=function($J){return this._values[$J]},$o._setVector2=function($J,$o){this._shaderValues.setValue($J,$o?$o.elements:null),this._values[$J]=$o},$o._getVector2=function($J){return this._values[$J]},$o._setColor=function($J,$o){this._shaderValues.setValue($J,$o?$o.elements:null),this._values[$J]=$o},$o._getColor=function($J){return this._values[$J]},$o._setTexture=function($J,$o){var $r=this._values[$J];this._values[$J]=$o,this._shaderValues.setValue($J,$o),0<this.referenceCount&&($r&&$r._removeReference(),$o&&$o._addReference())},$o._getTexture=function($J){return this._values[$J]},$o._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$o._getShader=function($J,$o,$r){var $S=($J|$o)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($S,$r,this._shaderDefineValue),this._shader},$o._setRenderStateBlendDepth=function(){var $J=$R.mainContext;switch($n.setDepthMask($J,this.depthWrite),0===this.depthTest?$n.setDepthTest($J,!1):($n.setDepthTest($J,!0),$n.setDepthFunc($J,this.depthTest)),this.blend){case 0:$n.setBlend($J,!1);break;case 1:$n.setBlend($J,!0),$n.setBlendFunc($J,this.srcBlend,this.dstBlend);break;case 2:$n.setBlend($J,!0)}},$o._setRenderStateFrontFace=function($J,$o){var $r=$R.mainContext,$S=0;switch(this.cull){case 0:$n.setCullFace($r,!1);break;case 1:$n.setCullFace($r,!0),$S=$J?$o&&$o._isFrontFaceInvert?2305:2304:$o&&$o._isFrontFaceInvert?2304:2305,$n.setFrontFace($r,$S);break;case 2:$n.setCullFace($r,!0),$S=$J?$o&&$o._isFrontFaceInvert?2304:2305:$o&&$o._isFrontFaceInvert?2305:2304,$n.setFrontFace($r,$S)}},$o.onAsynLoaded=function($J,$o,$r){var $S=$o[0],$G=$o[1];switch($S.version){case"LAYAMATERIAL:01":var $z=0,$A=0,$h=$S.props;for(var $Z in $h)switch($Z){case"vectors":var $u=$h[$Z];for($z=0,$A=$u.length;$z<$A;$z++){var $B=$u[$z],$v=$B.value;switch($v.length){case 2:this[$B.name]=new $zo($v[0],$v[1]);break;case 3:this[$B.name]=new $Ao($v[0],$v[1],$v[2]);break;case 4:this[$B.name]=new $ho($v[0],$v[1],$v[2],$v[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $j=$h[$Z];for($z=0,$A=$j.length;$z<$A;$z++){var $Y=$j[$z],$_=$Y.path;$_&&(this[$Y.name]=$w.getRes($G[$_]))}break;case"defines":var $D=$h[$Z];for($z=0,$A=$D.length;$z<$A;$z++){var $N=this._shaderCompile.getMaterialDefineByName($D[$z]);this._addShaderDefine($N)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$Z]=$h[$Z];break;case"renderQueue":switch($h[$Z]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$Z]=$h[$Z]}break;case"LAYAMATERIAL:02":for($Z in $h=$S.props)switch($Z){case"vectors":for($z=0,$A=($u=$h[$Z]).length;$z<$A;$z++)switch(($v=($B=$u[$z]).value).length){case 2:this[$B.name]=new $zo($v[0],$v[1]);break;case 3:this[$B.name]=new $Ao($v[0],$v[1],$v[2]);break;case 4:this[$B.name]=new $ho($v[0],$v[1],$v[2],$v[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($z=0,$A=($j=$h[$Z]).length;$z<$A;$z++)($_=($Y=$j[$z]).path)&&(this[$Y.name]=$w.getRes($G[$_]));break;case"defines":for($z=0,$A=($D=$h[$Z]).length;$z<$A;$z++)$N=this._shaderCompile.getMaterialDefineByName($D[$z]),this._addShaderDefine($N);break;default:this[$Z]=$h[$Z]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$o._addReference=function(){$S.prototype._addReference.call(this);for(var $J=0,$o=this._values.length;$J<$o;$J++){var $r=this._values[$J];$r&&$r instanceof laya.d3.resource.BaseTexture&&$r._addReference()}},$o._removeReference=function(){$S.prototype._removeReference.call(this);for(var $J=0,$o=this._values.length;$J<$o;$J++){var $r=this._values[$J];$r&&$r instanceof laya.d3.resource.BaseTexture&&$r._removeReference()}},$o.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$o.setShaderName=function($J){var $o=$po.nameKey.getID($J);if(-1===$o)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$go._preCompileShader[$o]},$o.cloneTo=function($J){var $o=$J;$o.name=this.name,$o.cull=this.cull,$o.blend=this.blend,$o.srcBlend=this.srcBlend,$o.dstBlend=this.dstBlend,$o.srcBlendRGB=this.srcBlendRGB,$o.dstBlendRGB=this.dstBlendRGB,$o.srcBlendAlpha=this.srcBlendAlpha,$o.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($o.blendConstColor),$o.blendEquation=this.blendEquation,$o.blendEquationRGB=this.blendEquationRGB,$o.blendEquationAlpha=this.blendEquationAlpha,$o.depthTest=this.depthTest,$o.depthWrite=this.depthWrite,$o.renderQueue=this.renderQueue,$o._shader=this._shader,$o._disablePublicShaderDefine=this._disablePublicShaderDefine,$o._shaderDefineValue=this._shaderDefineValue;var $r,$S=0,$G=$o._shaderValues;$o._shaderValues.data.length=this._shaderValues.data.length;var $z=this._values.length,$A=$o._values;for($S=0,$r=$A.length=$z;$S<$r;$S++){var $h=this._values[$S];if($h)if("number"==typeof $h)$A[$S]=$h,$G.data[$S]=$h;else if("number"==typeof $h&&Math.floor($h)==$h)$A[$S]=$h,$G.data[$S]=$h;else if("boolean"==typeof $h)$A[$S]=$h,$G.data[$S]=$h;else if($h instanceof laya.d3.math.Vector2){var $Z=$A[$S]||($A[$S]=new $zo);$h.cloneTo($Z),$G.data[$S]=$Z.elements}else if($h instanceof laya.d3.math.Vector3){var $u=$A[$S]||($A[$S]=new $Ao);$h.cloneTo($u),$G.data[$S]=$u.elements}else if($h instanceof laya.d3.math.Vector4){var $B=$A[$S]||($A[$S]=new $ho);$h.cloneTo($B),$G.data[$S]=$B.elements}else if($h instanceof laya.d3.math.Matrix4x4){var $v=$A[$S]||($A[$S]=new $Jo);$h.cloneTo($v),$G.data[$S]=$v.elements}else $h instanceof laya.d3.resource.BaseTexture&&($A[$S]=$h,$G.data[$S]=$h)}},$o.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$_(0,$o,"alphaTestValue",function(){return this._getNumber(0)},function($J){this._setNumber(0,$J)}),$_(0,$o,"alphaTest",function(){return this._alphaTest},function($J){(this._alphaTest=$J)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$J.__init__=function(){$J.SHADERDEFINE_ALPHATEST=$J.shaderDefines.registerDefine("ALPHATEST")},$J.RENDERQUEUE_OPAQUE=2e3,$J.RENDERQUEUE_ALPHATEST=2450,$J.RENDERQUEUE_TRANSPARENT=3e3,$J.CULL_NONE=0,$J.CULL_FRONT=1,$J.CULL_BACK=2,$J.BLEND_DISABLE=0,$J.BLEND_ENABLE_ALL=1,$J.BLEND_ENABLE_SEPERATE=2,$J.BLENDPARAM_ZERO=0,$J.BLENDPARAM_ONE=1,$J.BLENDPARAM_SRC_COLOR=768,$J.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$J.BLENDPARAM_DST_COLOR=774,$J.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$J.BLENDPARAM_SRC_ALPHA=770,$J.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$J.BLENDPARAM_DST_ALPHA=772,$J.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$J.BLENDPARAM_SRC_ALPHA_SATURATE=776,$J.BLENDEQUATION_ADD=0,$J.BLENDEQUATION_SUBTRACT=1,$J.BLENDEQUATION_REVERSE_SUBTRACT=2,$J.DEPTHTEST_OFF=0,$J.DEPTHTEST_NEVER=512,$J.DEPTHTEST_LESS=513,$J.DEPTHTEST_EQUAL=514,$J.DEPTHTEST_LEQUAL=515,$J.DEPTHTEST_GREATER=516,$J.DEPTHTEST_NOTEQUAL=517,$J.DEPTHTEST_GEQUAL=518,$J.DEPTHTEST_ALWAYS=519,$J.SHADERDEFINE_ALPHATEST=1,$J.ALPHATESTVALUE=0,$v($J,["shaderDefines",function(){return this.shaderDefines=new $Bo}]),$J}($N),$Ro=function($J){function $o(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$o.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$Y($o,"laya.d3.resource.BaseTexture",$N);var $r=$o.prototype;return $_(0,$r,"width",function(){return this._width}),$_(0,$r,"repeat",function(){return this._repeat},function($J){if(this._repeat!==$J&&(this._repeat=$J,this._source)){var $o=$R.mainContext;$n.bindTexture($o,this._type,this._source),$t.isPOT(this._width,this._height)&&this._repeat?($o.texParameteri(this._type,10242,10497),$o.texParameteri(this._type,10243,10497)):($o.texParameteri(this._type,10242,33071),$o.texParameteri(this._type,10243,33071))}}),$_(0,$r,"height",function(){return this._height}),$_(0,$r,"magFifter",function(){return this._magFifter},function($J){(this._magFifter=$J)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($J)}),$_(0,$r,"wrapModeV",function(){return this._wrapModeV}),$_(0,$r,"size",function(){return this._size}),$_(0,$r,"wrapModeU",function(){return this._wrapModeU}),$_(0,$r,"mipmap",function(){return this._mipmap},function($J){this._mipmap=$J,this._mipmap!=$J&&this._conchTexture&&this._conchTexture.setMipMap($J)}),$_(0,$r,"minFifter",function(){return this._minFifter},function($J){this._minFifter=$J,this._minFifter!=$J&&this._conchTexture&&this._conchTexture.setMinFifter($J)}),$_(0,$r,"format",function(){return this._format}),$_(0,$r,"source",function(){return this.activeResource(),this._source}),$_(0,$r,"defaulteTexture",function(){return $bo.grayTexture}),$o.WARPMODE_REPEAT=0,$o.WARPMODE_CLAMP=1,$o}(),$no=function($J){function $o(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$o.__super.call(this),this._boundingBoxCorners=$S(8,null)}$Y($o,"laya.d3.resource.models.BaseMesh",$N);var $r=$o.prototype;return $r._getPositions=function(){throw new Error("未Override,请重载该属性！")},$r._generateBoundingObject=function(){this._boundingSphere=new $WJ(new $Ao,0),$WJ.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $OJ(new $Ao,new $Ao),$OJ.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$r.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$r.getRenderElement=function($J){throw new Error("未Override,请重载该属性！")},$_(0,$r,"subMeshCount",function(){return this._subMeshCount}),$_(0,$r,"boundingBox",function(){return this._boundingBox}),$_(0,$r,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$_(0,$r,"boundingSphere",function(){return this._boundingSphere}),$o}(),$ko=(function($J){function $o(){$o.__super.call(this)}$Y($o,"laya.d3.component.Script",$Io);var $r=$o.prototype;$r.onTriggerEnter=function($J){},$r.onTriggerExit=function($J){},$r.onTriggerStay=function($J){},$_(0,$r,"isSingleton",function(){return $o._isSingleton}),$o._isSingleton=!1}(),function($J){function $o($J){this._owner=null,this._sharedMesh=null,$o.__super.call(this),this._owner=$J}$Y($o,"laya.d3.core.MeshFilter",$J);var $r=$o.prototype;return $r._sharedMeshLoaded=function(){this.event("loaded")},$r._destroy=function(){$J.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$_(0,$r,"sharedMesh",function(){return this._sharedMesh},function($J){var $o=this._sharedMesh;$o&&$o._removeReference(),(this._sharedMesh=$J)._addReference(),this.event("meshchanged",[this,$o,$J]),$J.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$_(0,$r,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$_(0,$r,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$_(0,$r,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$_(0,$r,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$o}($to)),$Uo=function($J){function $o($J){$o.__super.call(this,$J),$J.meshFilter.on("meshchanged",this,this._onMeshChanged)}$Y($o,"laya.d3.core.MeshRender",$Ko);var $r=$o.prototype;return $r._onMeshChanged=function($J,$o,$r){$r.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$r.once("loaded",this,this._onMeshLoaed)},$r._onMeshLoaed=function($J,$o){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$r._calculateBoundingSphereByInitSphere=function($J){var $o=NaN,$r=this._owner.transform,$S=$r.scale.elements,$G=Math.abs($S[0]),$z=Math.abs($S[1]),$A=Math.abs($S[2]);$o=$z<=$G&&$A<=$G?$G:$A<=$z?$z:$A,$Ao.transformCoordinate($J.center,$r.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$J.radius*$o},$r._calculateBoundBoxByInitCorners=function($J){for(var $o=this._owner.transform.worldMatrix,$r=0;$r<8;$r++)$Ao.transformCoordinate($J[$r],$o,$Ko._tempBoundBoxCorners[$r]);$OJ.createfromPoints($Ko._tempBoundBoxCorners,this._boundingBox)},$r._calculateBoundingSphere=function(){var $J=this._owner.meshFilter.sharedMesh;null==$J||null==$J.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($J.boundingSphere)},$r._calculateBoundingBox=function(){var $J=this._owner.meshFilter.sharedMesh;null==$J||null==$J.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($J.boundingBoxCorners)},$r._renderUpdate=function($J){var $o=this._owner.transform;if($o){this._setShaderValueMatrix4x4(0,$o.worldMatrix);var $r=this._owner.getProjectionViewWorldMatrix($J);this._setShaderValueMatrix4x4(1,$r)}else this._setShaderValueMatrix4x4(0,$Jo.DEFAULT),this._setShaderValueMatrix4x4(1,$J);return $wo.debugMode&&this._renderRenderableBoundBox(),!0},$o}(),$Lo=function($o){function $S(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$S.__super.call(this),this._renderState=new $M,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $jo,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $oJ,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $Ao(.7,.7,.7),this.ambientColor=new $Ao(.212,.227,.259),$R.shaderHighPrecision&&this.addShaderDefine($go.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$Y($S,"laya.d3.core.scene.Scene",$o);var $J=$S.prototype;return $K.imps($J,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$J._setUrl=function($J){this._url=$J},$J._getGroup=function(){return this._group},$J._setGroup=function($J){this._group=$J},$J._display=function(){$K.stage._scenes.push(this),$K.stage._scenes.sort($S._sortScenes);for(var $J=0,$o=this._childs.length;$J<$o;$J++){var $r=this._childs[$J];$r.active&&$r._activeHierarchy()}},$J._unDisplay=function(){var $J=$K.stage._scenes;$J.splice($J.indexOf(this),1);for(var $o=0,$r=this._childs.length;$o<$r;$o++){var $S=this._childs[$o];$S.active&&$S._inActiveHierarchy()}},$J._addChild3D=function($J){$J.transform._onWorldTransform(),$J._setBelongScene(this),this.displayedInStage&&$J.active&&$J._activeHierarchy()},$J._removeChild3D=function($J){$J.transform.parent=null,this.displayedInStage&&$J.active&&$J._inActiveHierarchy(),$J._setUnBelongScene()},$J.initOctree=function($J,$o,$r,$S,$G){void 0===$G&&($G=6),this.treeSize=new $Ao($J,$o,$r),this.treeLevel=$G,this.treeRoot=new $O(this,0),this.treeRoot.init($S,this.treeSize)},$J._prepareUpdateToRenderState=function($J,$o){$o.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$o.scene=this},$J._prepareSceneToRender=function($J){var $o=this._lights.length;if(0<$o)for(var $r=0,$S=0;$S<$o&&!(this._lights[$S]._prepareToScene($J)&&++$r>=this._enableLightCount);$S++);},$J._updateChilds=function($J){for(var $o=0,$r=this._childs.length;$o<$r;++$o)this._childs[$o]._update($J)},$J._preRenderScene=function($J,$o,$r){var $S,$G=$o._viewMatrix,$z=$o._projectionMatrix,$A=$o._projectionViewMatrix,$h=0,$Z=$o.camera;for($Z.useOcclusionCulling?this.treeRoot?$rJ.renderObjectCullingOctree($r,this,$Z,$G,$z,$A):$rJ.renderObjectCulling($r,this,$Z,$G,$z,$A):$rJ.renderObjectCullingNoBoundFrustum(this,$Z,$G,$z,$A),$h=0,$S=this._quenes.length;$h<$S;$h++)this._quenes[$h]&&this._quenes[$h]._preRender($o)},$J._clear=function($J,$o){var $r=$o._viewport,$S=$o.camera,$G=$r.x,$z=$S.renderTargetSize.height-$r.y-$r.height,$A=$r.width,$h=$r.height;$J.viewport($G,$z,$A,$h);var $Z=256,$u=$S.renderTarget;switch($S.clearFlag){case 0:var $B=$S.clearColor;if($B){$J.enable(3089),$J.scissor($G,$z,$A,$h);var $v=$B.elements;$J.clearColor($v[0],$v[1],$v[2],$v[3]),$Z|=16384}if($u)switch($B||($Z=16384),$u.depthStencilFormat){case 33189:$Z|=256;break;case 36168:$Z|=1024;break;case 34041:$Z|=256,$Z|=1024}$J.clear($Z),$B&&$J.disable(3089);break;case 1:case 2:if($u)switch($Z=16384,$u.depthStencilFormat){case 33189:$Z|=256;break;case 36168:$Z|=1024;break;case 34041:$Z|=256,$Z|=1024}$J.clear($Z);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$J._renderScene=function($J,$o){var $r,$S,$G=$o.camera,$z=0;for($z=0;$z<2;$z++)($S=this._quenes[$z])&&($G.renderTarget?$S._render($o,!0):$S._render($o,!1));if(1===$G.clearFlag){var $A=$G.sky;$A&&($n.setCullFace($J,!1),$n.setDepthFunc($J,515),$n.setDepthMask($J,!1),$A._render($o),$n.setDepthFunc($J,513),$n.setDepthMask($J,!0))}for($z=2,$r=this._quenes.length;$z<$r;$z++)($S=this._quenes[$z])&&($S._sortAlpha($o.camera.transform.position),$G.renderTarget?$S._render($o,!0):$S._render($o,!1))},$J._set3DRenderConfig=function($J){$J.disable(3042),$n._blend=!1,$J.blendFunc(770,771),$n._sFactor=770,$n._dFactor=771,$J.disable(2929),$n._depthTest=!1,$J.enable(2884),$n._cullFace=!0,$J.depthMask(1),$n._depthMask=!0,$J.frontFace(2304),$n._frontFace=2304},$J._set2DRenderConfig=function($J){$n.setBlend($J,!0),$n.setBlendFunc($J,1,771),$n.setDepthTest($J,!1),$n.setCullFace($J,!1),$n.setDepthMask($J,!0),$n.setFrontFace($J,2305),$J.viewport(0,0,$B.width,$B.height)},$J._parseCustomProps=function($J,$o,$r,$S){var $G=$S.customProps.lightmaps,$z=$G.length,$A=this._lightmaps;$A.length=$z;for(var $h=0;$h<$z;$h++)$A[$h]=$w.getRes($o[$G[$h].replace(".exr",".png")]);this.setlightmaps($A);var $Z=$S.customProps.ambientColor;$Z&&(this.ambientColor=new $Ao($Z[0],$Z[1],$Z[2]));var $u=$S.customProps.fogColor;$u&&(this.fogColor=new $Ao($u[0],$u[1],$u[2]))},$J._addLight=function($J){this._lights.indexOf($J)<0&&this._lights.push($J)},$J._removeLight=function($J){var $o=this._lights.indexOf($J);0<=$o&&this._lights.splice($o,1)},$J._updateScene=function(){var $J=this._renderState;this._prepareUpdateToRenderState($R.mainContext,$J),this._updateComponents($J),this._updateChilds($J),this._lateUpdateComponents($J),this._time+=$J.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$J._updateSceneConch=function(){var $J=this._renderState;this._prepareUpdateToRenderState($R.mainContext,$J),this._updateComponents($J),this._lateUpdateComponents($J),this._prepareSceneToRender($J);for(var $o=0,$r=this._cameraPool.length;$o<$r;$o++){var $S=this._cameraPool[$o];($J.camera=$S)._prepareCameraToRender()}},$J._preRenderShadow=function($J,$o,$r,$S,$G){this.treeRoot?$rJ.renderShadowObjectCullingOctree(this,$o,$r,$S,$G):$rJ.renderShadowObjectCulling(this,$o,$r,$S,$G);for(var $z=0,$A=$r.length;$z<$A;$z++)$r[$z]&&$r[$z]._preRender($J)},$J._renderShadowMap=function($J,$o,$r){var $S=this.parallelSplitShadowMaps[0];$S._calcAllLightCameraInfo($r);var $G,$z,$A,$h=$S.PSSMNum;if(this._preRenderShadow($o,$S._lightCulling,$S._shadowQuenes,$S._lightVPMatrix[0],$h),this.addShaderDefine($Yo.SHADERDEFINE_CAST_SHADOW),1<$h)for(var $Z=0;$Z<$h;$Z++)$G=$S.getRenderTarget($Z+1),$S.beginRenderTarget($Z+1),$J.clearColor(1,1,1,1),$J.clear(16640),$J.viewport(0,0,$G.width,$G.height),$o.camera=$A=$S.getLightCamera($Z),$A._prepareCameraToRender(),$A._prepareCameraViewProject($A.viewMatrix,$A.projectionMatrix),$o._projectionViewMatrix=$S._lightVPMatrix[$Z+1],($z=$S._shadowQuenes[$Z])._preRender($o),$z._renderShadow($o,!1),$S.endRenderTarget($Z+1);else $G=$S.getRenderTarget(1),$S.beginRenderTarget(1),$J.clearColor(1,1,1,1),$J.clear(16640),$J.viewport(0,0,$G.width,$G.height),$o.camera=$A=$S.getLightCamera(0),$A._prepareCameraToRender(),$A._prepareCameraViewProject($A.viewMatrix,$A.projectionMatrix),$o._projectionViewMatrix=$S._lightVPMatrix[0],($z=$S._shadowQuenes[0])._preRender($o),$z._renderShadow($o,!0),$S.endRenderTarget(1);this.removeShaderDefine($Yo.SHADERDEFINE_CAST_SHADOW)},$J.addTreeNode=function($J){this.treeRoot.addTreeNode($J)},$J.removeTreeNode=function($J){this.treeSize&&$J._treeNode&&$J._treeNode.removeObject($J)},$J.setlightmaps=function($J){this._lightmaps=$J;for(var $o=0,$r=this._renderableSprite3Ds.length;$o<$r;$o++)this._renderableSprite3Ds[$o]._render._applyLightMapParams()},$J.getlightmaps=function(){return this._lightmaps},$J.addChildAt=function($J,$o){if(!($J instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($J&&$J.__className));if(!$J||this.destroyed||$J===this)return $J;if($J.zOrder&&this._set$P("hasZorder",!0),0<=$o&&$o<=this._childs.length){if($J._parent===this){var $r=this.getChildIndex($J);this._childs.splice($r,1),this._childs.splice($o,0,$J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,$o)),this._childChanged()}else $J.parent&&$J.parent.removeChild($J),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($o,0,$J),this.conchModel&&this.conchModel.addChildAt($J.conchModel,$o),($J.parent=this)._addChild3D($J);return $J}throw new Error("appendChildAt:The index is out of bounds")},$J.addChild=function($J){if(!($J instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$J||this.destroyed||$J===this)return $J;if($J.zOrder&&this._set$P("hasZorder",!0),$J._parent===this){var $o=this.getChildIndex($J);$o!==this._childs.length-1&&(this._childs.splice($o,1),this._childs.push($J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,this._childs.length-1)),this._childChanged())}else $J.parent&&$J.parent.removeChild($J),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($J),this.conchModel&&this.conchModel.addChildAt($J.conchModel,this._childs.length-1),($J.parent=this)._childChanged(),this._addChild3D($J);return $J},$J.removeChildAt=function($J){var $o=this.getChildAt($J);return $o&&(this._removeChild3D($o),this._childs.splice($J,1),this.conchModel&&this.conchModel.removeChild($o.conchModel),$o.parent=null),$o},$J.removeChildren=function($J,$o){if(void 0===$J&&($J=0),void 0===$o&&($o=2147483647),this._childs&&0<this._childs.length){var $r=this._childs;if(0===$J&&$z<=$o){var $S=$r;this._childs=$u.ARRAY_EMPTY}else $S=$r.splice($J,$o-$J);for(var $G=0,$z=$S.length;$G<$z;$G++)this._removeChild3D($S[$G]),$S[$G].parent=null,this.conchModel&&this.conchModel.removeChild($S[$G].conchModel)}return this},$J.addFrustumCullingObject=function($J){this.treeRoot?this.addTreeNode($J):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($J):this._cullingRenders[this._cullingRendersLength]=$J,$J._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$J.removeFrustumCullingObject=function($J){if(this.treeRoot)this.removeTreeNode($J);else{this._cullingRendersLength--;var $o=$J._indexInSceneFrustumCullingObjects;if($o!==this._cullingRendersLength){var $r=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$o]=$r)._indexInSceneFrustumCullingObjects=$o,$J._indexInSceneFrustumCullingObjects=-1}}},$J.getRenderQueue=function($J){return $J<3e3?this._quenes[1]||(this._quenes[1]=new $x(this)):this._quenes[2]||(this._quenes[2]=new $x(this))},$J.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $x(this)},$J.addShaderDefine=function($J){this._shaderDefineValue|=$J},$J.removeShaderDefine=function($J){this._shaderDefineValue&=~$J},$J.addScript=function($J){return this._addComponent($J)},$J.getScriptByType=function($J,$o){return void 0===$o&&($o=0),this._getComponentByType($J,$o)},$J.getScriptsByType=function($J,$o){this._getComponentsByType($J,$o)},$J.getScriptByIndex=function($J){return this._getComponentByIndex($J)},$J.removeScriptByType=function($J,$o){void 0===$o&&($o=0),this._removeComponentByType($J,$o)},$J.removeScriptsByType=function($J){this._removeComponentByType($J)},$J.removeAllScript=function(){this._removeAllComponent()},$J.render=function($J,$o,$r){($D._context.ctx._renderKey=0)<this._childs.length&&$J.addRenderObject(this)},$J.renderSubmit=function(){var $J=$R.mainContext,$o=this._renderState;this._set3DRenderConfig($J),this._prepareSceneToRender(this._renderState);var $r,$S=0,$G=0;if($wo.debugMode||$O.debugMode)for($S=0,$G=this._cameraPool.length;$S<$G;$S++)$r=this._cameraPool[$S],$wo._debugPhasorSprite.begin(1,$r),$r.activeInHierarchy&&$r._renderCamera($J,$o,this),$wo._debugPhasorSprite.end();else for($S=0,$G=this._cameraPool.length;$S<$G;$S++)($r=this._cameraPool[$S]).activeInHierarchy&&$r._renderCamera($J,$o,this);return this._set2DRenderConfig($J),1},$J.onAsynLoaded=function($J,$o,$r){var $S=$o[0];if("Scene"!==$S.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $G=$o[1];$No._createNodeByJson(this,$S,this,$G),this.event("hierarchyloaded",[this]),this.__loaded=!0},$J.destroy=function($J){void 0===$J&&($J=!0),this.destroyed||($o.prototype.destroy.call(this,$J),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$w.clearRes(this.url),this.loaded||$wo._cancelLoadByUrl(this.url))},$J.getRenderType=function(){return 0},$J.releaseRender=function(){},$J._addComponent=function($J){var $o,$r=this._componentsMap.indexOf($J);if(-1===$r)$o=[],this._componentsMap.push($J),this._typeComponentsIndices.push($o);else if($o=this._typeComponentsIndices[$r],this._components[$o[0]].isSingleton)throw new Error("无法单实例创建"+$J+"组件，"+$J+"组件已存在！");var $S=$G.getInstance($J);$o.push(this._components.length),this._components.push($S);return $S._initialize(this),$S},$J._removeComponent=function($J,$o){var $r=this._typeComponentsIndices[$J],$S=$r[$o],$G=this._components[$S];this._components.splice($S,1),$r.splice($o,1),0===$r.length&&(this._typeComponentsIndices.splice($J,1),this._componentsMap.splice($J,1));for(var $z=0,$A=this._componentsMap.length;$z<$A;$z++)for(var $h=($r=this._typeComponentsIndices[$z]).length-1;0<=$h;$h--){var $Z=$r[$h];if(!($S<$Z))break;$r[$h]=--$Z}$G._destroy()},$J._getComponentByType=function($J,$o){void 0===$o&&($o=0);var $r=this._componentsMap.indexOf($J);return-1===$r?null:this._components[this._typeComponentsIndices[$r][$o]]},$J._getComponentsByType=function($J,$o){var $r=this._componentsMap.indexOf($J);if(-1!==$r){var $S=this._typeComponentsIndices[$r],$G=$S.length;$o.length=$G;for(var $z=0;$z<$G;$z++)$o[$z]=this._components[$S[$z]]}else $o.length=0},$J._getComponentByIndex=function($J){return this._components[$J]},$J._removeComponentByType=function($J,$o){void 0===$o&&($o=0);var $r=this._componentsMap.indexOf($J);-1!==$r&&this._removeComponent($r,$o)},$J._removeComponentsByType=function($J){var $o=this._componentsMap.indexOf($J);if(-1!==$o)for(var $r=this._typeComponentsIndices[$o],$S=0,$G=$r.length;$S<$G;$r.length<$G?$G--:$S++)this._removeComponent($o,$S)},$J._removeAllComponent=function(){for(var $J=0,$o=this._componentsMap.length;$J<$o;this._componentsMap.length<$o?$o--:$J++)this._removeComponentsByType(this._componentsMap[$J])},$J._updateComponents=function($J){for(var $o=0,$r=this._components.length;$o<$r;$o++){var $S=this._components[$o];!$S.started&&($S._start($J),$S.started=!0),$S.enable&&$S._update($J)}},$J._lateUpdateComponents=function($J){for(var $o=0;$o<this._components.length;$o++){var $r=this._components[$o];!$r.started&&($r._start($J),$r.started=!0),$r.enable&&$r._lateUpdate($J)}},$J._preRenderUpdateComponents=function($J){for(var $o=0;$o<this._components.length;$o++){var $r=this._components[$o];!$r.started&&($r._start($J),$r.started=!0),$r.enable&&$r._preRenderUpdate($J)}},$J._postRenderUpdateComponents=function($J){for(var $o=0;$o<this._components.length;$o++){var $r=this._components[$o];!$r.started&&($r._start($J),$r.started=!0),$r.enable&&$r._postRenderUpdate($J)}},$_(0,$J,"_loaded",null,function($J){this.__loaded=$J}),$_(0,$J,"fogColor",function(){return this._fogColor},function($J){this._fogColor=$J,this._shaderValues.setValue(0,$J.elements)}),$_(0,$J,"enableFog",function(){return this._enableFog},function($J){this._enableFog!==$J&&((this._enableFog=$J)?(this.addShaderDefine($go.SHADERDEFINE_FOG),this.removeShaderDefine($go.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($go.SHADERDEFINE_FOG))}),$_(0,$J,"url",function(){return this._url}),$_(0,$J,"loaded",function(){return this.__loaded}),$_(0,$J,"enableDepthFog",function(){return this._enableDepthFog},function($J){this._enableDepthFog!=$J&&((this._enableDepthFog=$J)?(this.addShaderDefine($go.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($go.SHADERDEFINE_FOG)):this.removeShaderDefine($go.SAHDERDEFINE_DEPTHFOG))}),$_(0,$J,"fogStart",function(){return this._fogStart},function($J){this._fogStart=$J,this._shaderValues.setValue(1,$J)}),$_(0,$J,"fogRange",function(){return this._fogRange},function($J){this._fogRange=$J,this._shaderValues.setValue(2,$J)}),$_(0,$J,"ambientColor",function(){return this._ambientColor},function($J){this._ambientColor=$J,this._shaderValues.setValue(21,$J.elements)}),$_(0,$J,"scene",function(){return this}),$_(0,$J,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$S._sortScenes=function($J,$o){if($J.parent!==$K.stage||$o.parent!==$K.stage)return $J.parent!==$K.stage&&$o.parent!==$K.stage?$S._sortScenes($J.parent,$o.parent):$J.parent===$K.stage?-1:1;var $r=$K.stage._childs;return $r.indexOf($J)-$r.indexOf($o)},$S.load=function($J){return $K.loader.create($J,null,null,$S)},$S.FOGCOLOR=0,$S.FOGSTART=1,$S.FOGRANGE=2,$S.LIGHTDIRECTION=3,$S.LIGHTDIRCOLOR=4,$S.POINTLIGHTPOS=5,$S.POINTLIGHTRANGE=6,$S.POINTLIGHTATTENUATION=7,$S.POINTLIGHTCOLOR=8,$S.SPOTLIGHTPOS=9,$S.SPOTLIGHTDIRECTION=10,$S.SPOTLIGHTSPOT=11,$S.SPOTLIGHTRANGE=12,$S.SPOTLIGHTATTENUATION=13,$S.SPOTLIGHTCOLOR=14,$S.SHADOWDISTANCE=15,$S.SHADOWLIGHTVIEWPROJECT=16,$S.SHADOWMAPPCFOFFSET=17,$S.SHADOWMAPTEXTURE1=18,$S.SHADOWMAPTEXTURE2=19,$S.SHADOWMAPTEXTURE3=20,$S.AMBIENTCOLOR=21,$S.TIME=22,$S}($y),$Qo=function($J){function $o($J){$o.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $Jo,this._shaderValues=new $jo,this._colliders=[],this._id=++$o._uniqueIDCounter,this._transform=new $eo(this),this.name=$J||"Sprite3D-"+$o._nameNumberCounter++,this.layer=$U.currentCreationLayer,this.active=!0}$Y($o,"laya.d3.core.Sprite3D",$mo);var $r=$o.prototype;return $K.imps($r,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$r._setUrl=function($J){this._url=$J},$r._getGroup=function(){return this._group},$r._setGroup=function($J){this._group=$J},$r._addChild3D=function($J){$J.transform.parent=this.transform,this._hierarchyAnimator&&(!$J._hierarchyAnimator&&$J._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($J,!0,[$J.name])),this._scene&&($J._setBelongScene(this._scene),this._activeInHierarchy&&$J._active&&$J._activeHierarchy())},$r._removeChild3D=function($J){$J.transform.parent=null,this._scene&&(this._activeInHierarchy&&$J._active&&$J._inActiveHierarchy(),$J._setUnBelongScene()),this._hierarchyAnimator&&($J._hierarchyAnimator==this._hierarchyAnimator&&$J._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($J,!1,[$J.name]))},$r._parseBaseCustomProps=function($J){var $o=this.transform.localPosition;$J.translate?($o.fromArray($J.translate),$o.x*=100,$o.y*=100,$o.z*=100):$o.elements.fill(0),this.transform.localPosition=$o;var $r=this.transform.localRotation;$J.rotation?$r.fromArray($J.rotation):$r.fromArray([0,0,0,-1]),this.transform.localRotation=$r;var $S=this.transform.localScale;$J.scale?$S.fromArray($J.scale):$S.elements.fill(1),this.transform.localScale=$S;var $G=$J.layer;null!=$G&&(this.layer=$U.getLayerByNumber($G))},$r._parseCustomComponent=function($J,$o,$r){for(var $S in $r){var $G=$r[$S];switch($S){case"Animator":var $z=this.addComponent(Animator);if($G.avatarPath)$z.avatar=$w.getRes($o[$G.avatarPath]);else{var $A=$G.avatar;if($A){$z.avatar=$w.getRes($o[$A.path]);var $h=$A.linkSprites;$h&&$J.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$z,$h])}}for(var $Z=$G.clipPaths,$u=$Z.length,$B=0;$B<$u;$B++)$z.addClip($w.getRes($o[$Z[$B]]));$z.clip=$w.getRes($o[$Z[0]]);var $v=$G.playOnWake;void 0!==$v&&($z.playOnWake=$v);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $j=this.addComponent(SphereCollider);$j.isTrigger=$G.isTrigger;var $Y=$j.center;$Y.fromArray($G.center),$j.center=$Y,$j.radius=$G.radius;break;case"BoxCollider":var $_=this.addComponent(BoxCollider);$_.isTrigger=$G.isTrigger,$_.center.fromArray($G.center);var $D=$_.size;$D.fromArray($G.size),$_.size=$D;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$r._onRootNodeHierarchyLoaded=function($J,$o){for(var $r in $o){for(var $S=this,$G=$o[$r],$z=0,$A=$G.length;$z<$A;$z++){var $h=$G[$z];if(""===$h)break;if(!($S=$S.getChildByName($h)))break}$S&&$J.linkSprite3DToAvatarNode($r,$S)}},$r._setHierarchyAnimator=function($J,$o){this._changeHierarchyAnimator($J);for(var $r=0,$S=this._childs.length;$r<$S;$r++){var $G=this._childs[$r];$G._hierarchyAnimator==$o&&$G._setHierarchyAnimator($J,$o)}},$r._clearHierarchyAnimator=function($J,$o){this._changeHierarchyAnimator($o);for(var $r=0,$S=this._childs.length;$r<$S;$r++){var $G=this._childs[$r];$G._hierarchyAnimator==$J&&$G._clearHierarchyAnimator($J,$o)}},$r._getAnimatorToLinkSprite3D=function($J,$o,$r){var $S=this.getComponentByType(Animator);if($S&&($S.avatar?$S.avatar._version||$J._setAnimatorToLinkAvatar($S,$o):$J._setAnimatorToLinkSprite3DNoAvatar($S,$o,$r)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$r.unshift(this._parent.name);var $G=this._parent;$G._hierarchyAnimator&&$G._getAnimatorToLinkSprite3D($J,$o,$r)}},$r._setAnimatorToLinkSprite3DNoAvatar=function($J,$o,$r){var $S=0,$G=0;for($S=0,$G=$J.getClipCount();$S<$G;$S++)$J._handleSpriteOwnersBySprite($S,$o,$r,this);for($S=0,$G=this._childs.length;$S<$G;$S++){var $z=this._childs[$S],$A=$r.length;$r.push($z.name),$z._setAnimatorToLinkSprite3DNoAvatar($J,$o,$r),$r.splice($A,1)}},$r._changeHierarchyAnimator=function($J){this._hierarchyAnimator=$J},$r._isLinkSpriteToAnimationNode=function($J,$o,$r){var $S=$J._avatarNodes.indexOf($o),$G=$J._cacheSpriteToNodesMap;if($r)this._transform.dummy=$o.transform,$J._cacheNodesToSpriteMap[$S]=$G.length,$G.push($S);else{this._transform.dummy=null;var $z=$J._cacheNodesToSpriteMap[$S];$J._cacheNodesToSpriteMap[$S]=null,$G.splice($z,1)}},$r._setBelongScene=function($J){this._scene=$J;for(var $o=0,$r=this._childs.length;$o<$r;$o++)this._childs[$o]._setBelongScene($J)},$r._setUnBelongScene=function(){this._scene=null;for(var $J=0,$o=this._childs.length;$J<$o;$J++)this._childs[$J]._setUnBelongScene()},$r._activeHierarchy=function(){var $J=0,$o=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$J=0,$o=this._colliders.length;$J<$o;$J++)this._layer._addCollider(this._colliders[$J]);for(this.event("activeinhierarchychanged",!0),$J=0,$o=this._childs.length;$J<$o;$J++){var $r=this._childs[$J];$r._active&&$r._activeHierarchy()}},$r._inActiveHierarchy=function(){var $J=0,$o=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$J=0,$o=this._colliders.length;$J<$o;$J++){var $r=this._colliders[$J];$r._clearCollsionMap(),this._layer._removeCollider($r)}for(this.event("activeinhierarchychanged",!1),$J=0,$o=this._childs.length;$J<$o;$J++){var $S=this._childs[$J];$S._active&&$S._inActiveHierarchy()}},$r.addComponent=function($J){var $o,$r=this._componentsMap.indexOf($J);if(-1===$r)$o=[],this._componentsMap.push($J),this._typeComponentsIndices.push($o);else if($o=this._typeComponentsIndices[$r],this._components[$o[0]].isSingleton)throw new Error("无法单实例创建"+$J+"组件，"+$J+"组件已存在！");var $S=$G.getInstance($J);return $o.push(this._components.length),this._components.push($S),$S instanceof laya.d3.component.Script&&this._scripts.push($S),$S._initialize(this),$S},$r._removeComponent=function($J,$o){var $r,$S=0,$G=this._typeComponentsIndices[$J],$z=$G[$o],$A=this._components[$z];for($A instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($A),1),$G.splice($o,1),0===$G.length&&(this._typeComponentsIndices.splice($J,1),this._componentsMap.splice($J,1)),$S=0,$r=this._componentsMap.length;$S<$r;$S++)for(var $h=($G=this._typeComponentsIndices[$S]).length-1;0<=$h;$h--){var $Z=$G[$h];if(!($z<$Z))break;$G[$h]=--$Z}$A._destroy()},$r._clearSelfRenderObjects=function(){},$r._addSelfRenderObjects=function(){},$r._parseCustomProps=function($J,$o,$r,$S){},$r._updateChilds=function($J){var $o=this._childs.length;if(0!==$o)for(var $r=0;$r<$o;++$r)this._childs[$r]._update($J)},$r._getSortID=function($J,$o){return 1e3*$o.id+$J._getVertexBuffer().vertexDeclaration.id},$r._update=function($J){($J.owner=this)._activeInHierarchy&&(this._updateComponents($J),this._lateUpdateComponents($J),$g.spriteCount++,this._childs.length&&this._updateChilds($J))},$r.getProjectionViewWorldMatrix=function($J){return $Jo.multiply($J,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$r.loadHierarchy=function($J){this.addChild(laya.d3.core.Sprite3D.load($J))},$r.addChildAt=function($J,$o){if(!($J instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$J||this.destroyed||$J===this)return $J;if($J.zOrder&&this._set$P("hasZorder",!0),0<=$o&&$o<=this._childs.length){if($J._parent===this){var $r=this.getChildIndex($J);this._childs.splice($r,1),this._childs.splice($o,0,$J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,$o)),this._childChanged()}else $J.parent&&$J.parent.removeChild($J),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($o,0,$J),this.conchModel&&this.conchModel.addChildAt($J.conchModel,$o),($J.parent=this)._addChild3D($J);return $J}throw new Error("appendChildAt:The index is out of bounds")},$r.addChild=function($J){if(!($J instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$J||this.destroyed||$J===this)return $J;if($J.zOrder&&this._set$P("hasZorder",!0),$J._parent===this){var $o=this.getChildIndex($J);$o!==this._childs.length-1&&(this._childs.splice($o,1),this._childs.push($J),this.conchModel&&(this.conchModel.removeChild($J.conchModel),this.conchModel.addChildAt($J.conchModel,this._childs.length-1)),this._childChanged())}else $J.parent&&$J.parent.removeChild($J),this._childs===$u.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($J),this.conchModel&&this.conchModel.addChildAt($J.conchModel,this._childs.length-1),($J.parent=this)._childChanged(),this._addChild3D($J);return $J},$r.removeChildAt=function($J){var $o=this.getChildAt($J);return $o&&(this._removeChild3D($o),this._childs.splice($J,1),this.conchModel&&this.conchModel.removeChild($o.conchModel),$o.parent=null),$o},$r.removeChildren=function($J,$o){if(void 0===$J&&($J=0),void 0===$o&&($o=2147483647),this._childs&&0<this._childs.length){var $r=this._childs;if(0===$J&&$z<=$o){var $S=$r;this._childs=$u.ARRAY_EMPTY}else $S=$r.splice($J,$o-$J);for(var $G=0,$z=$S.length;$G<$z;$G++)this._removeChild3D($S[$G]),$S[$G].parent=null,this.conchModel&&this.conchModel.removeChild($S[$G].conchModel)}return this},$r.onAsynLoaded=function($J,$o,$r){var $S=$o[0];if("Sprite3D"!==$S.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $G=$o[1];$No._createNodeByJson(this,$S,this,$G),this.event("hierarchyloaded",[this]),this.__loaded=!0},$r.cloneTo=function($J){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $o=$J;$o.name=this.name,$o._destroyed=this._destroyed,$o.timer=this.timer,$o._$P=this._$P,$o.active=this._active;var $r=$o.transform.localPosition;this.transform.localPosition.cloneTo($r),$o.transform.localPosition=$r;var $S=$o.transform.localRotation;this.transform.localRotation.cloneTo($S),$o.transform.localRotation=$S;var $G=$o.transform.localScale;this.transform.localScale.cloneTo($G),$o.transform.localScale=$G,$o.isStatic=this.isStatic;var $z=0,$A=0;for($z=0,$A=this._componentsMap.length;$z<$A;$z++){var $h=$o.addComponent(this._componentsMap[$z]);this._components[$z]._cloneTo($h)}for($z=0,$A=this._childs.length;$z<$A;$z++)$o.addChild(this._childs[$z].clone());var $Z=$o.getComponentByType(Animator);if($Z){var $u=$Z._linkSpritesData;if($u)for(var $B in $u){for(var $v=$u[$B],$j=$o,$Y=0,$_=$v.length;$Y<$_&&($j=$j.getChildByName($v[$Y]));$Y++);if($j){var $D=$Z._avatarNodeMap[$B];$j._isLinkSpriteToAnimationNode($Z,$D,!0)}}}},$r.clone=function(){var $J=new this.constructor;return this.cloneTo($J),$J},$r.destroy=function($J){if(void 0===$J&&($J=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$J);var $o,$r=0;for($r=0,$o=this._components.length;$r<$o;$r++)this._components[$r]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$w.clearRes(this.url),this.loaded||$wo._cancelLoadByUrl(this.url)}},$r._handleSpriteToAvatar=function($J,$o){$J._avatarNodes;var $r=$J._avatarNodeMap[this.name];$r&&$r.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($J,$r,$o)},$r._setAnimatorToLinkAvatar=function($J,$o){this._handleSpriteToAvatar($J,$o);for(var $r=0,$S=this._childs.length;$r<$S;$r++){this._childs[$r]._setAnimatorToLinkAvatar($J,$o)}},$_(0,$r,"activeInHierarchy",function(){return this._activeInHierarchy}),$_(0,$r,"_loaded",null,function($J){this.__loaded=$J}),$_(0,$r,"active",function(){return this._active},function($J){this._active!==$J&&(this._active=$J,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($J?this._activeHierarchy():this._inActiveHierarchy()))}),$_(0,$r,"componentsCount",function(){return this._components.length}),$_(0,$r,"loaded",function(){return this.__loaded}),$_(0,$r,"id",function(){return this._id}),$_(0,$r,"url",function(){return this._url}),$_(0,$r,"layer",function(){return this._layer},function($J){if(this._layer!==$J){if(!$J)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $o=0,$r=this._colliders.length;if(this._layer)for($o=0;$o<$r;$o++)this._layer._removeCollider(this._colliders[$o]);for($o=0;$o<$r;$o++)$J._addCollider(this._colliders[$o])}this._layer=$J,this.event("layerchanged",$J)}}),$_(0,$r,"scene",function(){return this._scene}),$_(0,$r,"transform",function(){return this._transform}),$o.instantiate=function($J,$o,$r,$S,$G){void 0===$r&&($r=!0);var $z=$J.clone();$o&&$o.addChild($z);var $A=$z.transform;if($r){var $h=$A.worldMatrix;$J.transform.worldMatrix.cloneTo($h),$A.worldMatrix=$h}else $S&&($A.position=$S),$G&&($A.rotation=$G);return $z},$o.load=function($J){return $K.loader.create($J,null,null,$o)},$o.WORLDMATRIX=0,$o.MVPMATRIX=1,$o._uniqueIDCounter=0,$o._nameNumberCounter=0,$o}(),$po=function($J){function $B($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$B.__super.call(this),!$J||!$o)throw"Shader Error";this._id=++$B._count,this._vs=$J,this._ps=$o,this._attributeMap=$r,this._sceneUniformMap=$S,this._cameraUniformMap=$G,this._spriteUniformMap=$z,this._materialUniformMap=$A,this._renderElementUniformMap=$h,this._precompile=$Z,this._define=$u,this._precompile&&$B.extCompileObj&&$B.extCompileFunc?$B.extCompileFunc.call($B.extCompileObj,$J,$o,$u):this.recreateResource()}$Y($B,"laya.d3.shader.Shader3D",$r);var $o=$B.prototype;return $o.recreateResource=function(){$k.now();this._compile(),this.completeCreate(),this.memorySize=0},$o.disposeResource=function(){$R.mainContext.deleteShader(this._vshader),$R.mainContext.deleteShader(this._pshader),$R.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$o._compile=function(){if(!$R.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $J=[this._vs,this._ps],$o=$R.mainContext;if(this._program=$o.createProgram(),this._vshader=$B._createShader($o,$J[0],35633),this._pshader=$B._createShader($o,$J[1],35632),$o.attachShader(this._program,this._vshader),$o.attachShader(this._program,this._pshader),$o.linkProgram(this._program),!$D.isConchApp&&$go.debugMode&&!$o.getProgramParameter(this._program,35714))throw $o.getProgramInfoLog(this._program);var $r,$S=0,$G=0,$z=0;for($z=$D.isConchApp?$o.getProgramParameterEx(this._vs,this._ps,"",35721):$o.getProgramParameter(this._program,35721),$S=0;$S<$z;$S++){var $A=null;$r={vartype:"attribute",ivartype:0,attrib:$A=$D.isConchApp?$o.getActiveAttribEx(this._vs,this._ps,"",$S):$o.getActiveAttrib(this._program,$S),location:$o.getAttribLocation(this._program,$A.name),name:$A.name,type:$A.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($r)}var $h=0;for($h=$D.isConchApp?$o.getProgramParameterEx(this._vs,this._ps,"",35718):$o.getProgramParameter(this._program,35718),$S=0;$S<$h;$S++){var $Z=null;$Z=$D.isConchApp?$o.getActiveUniformEx(this._vs,this._ps,"",$S):$o.getActiveUniform(this._program,$S),0<($r={vartype:"uniform",ivartype:1,attrib:$A,location:$o.getUniformLocation(this._program,$Z.name),name:$Z.name,type:$Z.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($r.name=$r.name.substr(0,$r.name.length-3),$r.isArray=!0,$r.location=$o.getUniformLocation(this._program,$r.name)),this._uniformParams.push($r)}for($S=0,$G=this._attributeParams.length;$S<$G;$S++)($r=this._attributeParams[$S]).indexOfParams=$S,$r.index=1,$r.value=[$r.location,null],$r.codename=$r.name,$r.name=null!=this._attributeMap[$r.codename]?this._attributeMap[$r.codename]:$r.codename,this._attributeParamsMap.push($r.name),this._attributeParamsMap.push($r),$r._this=this,$r.uploadedValue=[],$r.fun=this._attribute;for($S=0,$G=this._uniformParams.length;$S<$G;$S++)switch(($r=this._uniformParams[$S]).indexOfParams=$S,$r.index=1,$r.value=[$r.location,null],$r.codename=$r.name,null!=this._sceneUniformMap[$r.codename]?($r.name=this._sceneUniformMap[$r.codename],this._sceneUniformParamsMap.push($r.name),this._sceneUniformParamsMap.push($r)):null!=this._cameraUniformMap[$r.codename]?($r.name=this._cameraUniformMap[$r.codename],this._cameraUniformParamsMap.push($r.name),this._cameraUniformParamsMap.push($r)):null!=this._spriteUniformMap[$r.codename]?($r.name=this._spriteUniformMap[$r.codename],this._spriteUniformParamsMap.push($r.name),this._spriteUniformParamsMap.push($r)):null!=this._materialUniformMap[$r.codename]?($r.name=this._materialUniformMap[$r.codename],this._materialUniformParamsMap.push($r.name),this._materialUniformParamsMap.push($r)):null!=this._renderElementUniformMap[$r.codename]?($r.name=this._renderElementUniformMap[$r.codename],this._renderElementUniformParamsMap.push($r.name),this._renderElementUniformParamsMap.push($r)):console.log("Shader:can't find uinform name:"+$r.codename+" in shader file."),$r._this=this,$r.uploadedValue=[],$r.type){case 5124:$r.fun=$r.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$r.fun=$r.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$r.fun=$r.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$r.fun=$r.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$r.fun=$r.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$r.fun=this._uniform_sampler2D;break;case 35680:$r.fun=this._uniform_samplerCube;break;case 35676:$r.fun=this._uniformMatrix4fv;break;case 35670:$r.fun=this._uniform1i;break;case 35674:$r.fun=this._uinformMatrix2fv;break;case 35675:$r.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$o._attribute=function($J,$o){var $r=$R.mainContext,$S=$h._enableAtributes,$G=$J.location;return $S[$G]||$r.enableVertexAttribArray($G),$r.vertexAttribPointer($G,$o[0],$o[1],$o[2],$o[3],$o[4]),$S[$G]=$h._bindVertexBuffer,1},$o._uniform1f=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o?($R.mainContext.uniform1f($J.location,$r[0]=$o),1):0},$o._uniform1fv=function($J,$o){if($o.length<4){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($R.mainContext.uniform1fv($J.location,$o),$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3],1):0}return $R.mainContext.uniform1fv($J.location,$o),1},$o._uniform_vec2=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]?($R.mainContext.uniform2f($J.location,$r[0]=$o[0],$r[1]=$o[1]),1):0},$o._uniform_vec2v=function($J,$o){if($o.length<2){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($R.mainContext.uniform2fv($J.location,$o),$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3],1):0}return $R.mainContext.uniform2fv($J.location,$o),1},$o._uniform_vec3=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]?($R.mainContext.uniform3f($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2]),1):0},$o._uniform_vec3v=function($J,$o){return $R.mainContext.uniform3fv($J.location,$o),1},$o._uniform_vec4=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($R.mainContext.uniform4f($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3]),1):0},$o._uniform_vec4v=function($J,$o){return $R.mainContext.uniform4fv($J.location,$o),1},$o._uniformMatrix2fv=function($J,$o){return $R.mainContext.uniformMatrix2fv($J.location,!1,$o),1},$o._uniformMatrix3fv=function($J,$o){return $R.mainContext.uniformMatrix3fv($J.location,!1,$o),1},$o._uniformMatrix4fv=function($J,$o){return $R.mainContext.uniformMatrix4fv($J.location,!1,$o),1},$o._uinformMatrix2fv=function($J,$o){return $R.mainContext.uniformMatrix2fv($J.location,!1,$o),1},$o._uinformMatrix3fv=function($J,$o){return $R.mainContext.uniformMatrix3fv($J.location,!1,$o),1},$o._uniform1i=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o?($R.mainContext.uniform1i($J.location,$r[0]=$o),1):0},$o._uniform1iv=function($J,$o){return $R.mainContext.uniform1iv($J.location,$o),1},$o._uniform_ivec2=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]?($R.mainContext.uniform2i($J.location,$r[0]=$o[0],$r[1]=$o[1]),1):0},$o._uniform_ivec2v=function($J,$o){return $R.mainContext.uniform2iv($J.location,$o),1},$o._uniform_vec3i=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]?($R.mainContext.uniform3i($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2]),1):0},$o._uniform_vec3vi=function($J,$o){return $R.mainContext.uniform3iv($J.location,$o),1},$o._uniform_vec4i=function($J,$o){var $r=$J.uploadedValue;return $r[0]!==$o[0]||$r[1]!==$o[1]||$r[2]!==$o[2]||$r[3]!==$o[3]?($R.mainContext.uniform4i($J.location,$r[0]=$o[0],$r[1]=$o[1],$r[2]=$o[2],$r[3]=$o[3]),1):0},$o._uniform_vec4vi=function($J,$o){return $R.mainContext.uniform4iv($J.location,$o),1},$o._uniform_sampler2D=function($J,$o){var $r=$o.source||$o.defaulteTexture.source,$S=$R.mainContext,$G=$J.uploadedValue;if(null!=$G[0])return $S.activeTexture($B._TEXTURES[$G[0]]),$r&&$n.bindTexture($S,3553,$r),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $G[0]=this._curActTexIndex,$S.uniform1i($J.location,this._curActTexIndex),$S.activeTexture($B._TEXTURES[this._curActTexIndex]),$r&&$n.bindTexture($S,3553,$r),this._curActTexIndex++,1},$o._uniform_samplerCube=function($J,$o){var $r=$o.source||$o.defaulteTexture.source,$S=$R.mainContext,$G=$J.uploadedValue;if(null!=$G[0])return $S.activeTexture($B._TEXTURES[$G[0]]),$r?$n.bindTexture($S,34067,$r):$n.bindTexture($S,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $G[0]=this._curActTexIndex,$S.uniform1i($J.location,this._curActTexIndex),$S.activeTexture($B._TEXTURES[this._curActTexIndex]),$r?$n.bindTexture($S,34067,$r):$n.bindTexture($S,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$o._noSetValue=function($J){console.log("no....:"+$J.name)},$o.bind=function(){return $r.activeShader=this,($r.bindShader=this).activeResource(),$n.UseProgram(this._program)},$o.uploadAttributes=function($J,$o){for(var $r,$S,$G=0,$z=0,$A=this._attributeParamsMap.length;$z<$A;$z+=2)$S=this._attributeParamsMap[$z+1],null!=($r=$J[this._attributeParamsMap[$z]])&&($o&&$o[$S.name]&&$o[$S.name].bind(),$G+=$S.fun.call(this,$S,$r));$g.shaderCall+=$G},$o.uploadAttributesX=function($J,$o){for(var $r,$S,$G=0,$z=0,$A=this._attributeParamsMap.length;$z<$A;$z+=2)$S=this._attributeParamsMap[$z+1],null!=($r=$J[this._attributeParamsMap[$z]])&&($o._bind(),$G+=$S.fun.call(this,$S,$r));$g.shaderCall+=$G},$o.uploadSceneUniforms=function($J){for(var $o,$r,$S=0,$G=0,$z=this._sceneUniformParamsMap.length;$G<$z;$G+=2)$r=this._sceneUniformParamsMap[$G+1],null!=($o=$J[this._sceneUniformParamsMap[$G]])&&($S+=$r.fun.call(this,$r,$o));$g.shaderCall+=$S},$o.uploadCameraUniforms=function($J){for(var $o,$r,$S=0,$G=0,$z=this._cameraUniformParamsMap.length;$G<$z;$G+=2)$r=this._cameraUniformParamsMap[$G+1],null!=($o=$J[this._cameraUniformParamsMap[$G]])&&($S+=$r.fun.call(this,$r,$o));$g.shaderCall+=$S},$o.uploadSpriteUniforms=function($J){for(var $o,$r,$S=0,$G=0,$z=this._spriteUniformParamsMap.length;$G<$z;$G+=2)$r=this._spriteUniformParamsMap[$G+1],null!=($o=$J[this._spriteUniformParamsMap[$G]])&&($S+=$r.fun.call(this,$r,$o));$g.shaderCall+=$S},$o.uploadMaterialUniforms=function($J){for(var $o,$r,$S=0,$G=0,$z=this._materialUniformParamsMap.length;$G<$z;$G+=2)$r=this._materialUniformParamsMap[$G+1],null!=($o=$J[this._materialUniformParamsMap[$G]])&&($S+=$r.fun.call(this,$r,$o));$g.shaderCall+=$S},$o.uploadRenderElementUniforms=function($J){for(var $o,$r,$S=0,$G=0,$z=this._renderElementUniformParamsMap.length;$G<$z;$G+=2)$r=this._renderElementUniformParamsMap[$G+1],null!=($o=$J[this._renderElementUniformParamsMap[$G]])&&($S+=$r.fun.call(this,$r,$o));$g.shaderCall+=$S},$B.create=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){return new $B($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u)},$B.addInclude=function($J,$o){$I.addInclude($J,$o)},$B._createShader=function($J,$o,$r){var $S=$J.createShader($r);if($J.shaderSource($S,$o),$J.compileShader($S),$go.debugMode&&!$J.getShaderParameter($S,35713))throw $J.getShaderInfoLog($S);return $S},$B.PERIOD_RENDERELEMENT=0,$B.PERIOD_MATERIAL=1,$B.PERIOD_SPRITE=2,$B.PERIOD_CAMERA=3,$B.PERIOD_SCENE=4,$B._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$B._count=0,$B._preCompile=!1,$B.extCompileFunc=null,$B.extCompileObj=null,$v($B,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $s}]),$B}(),$fo=function($h){function $Z(){this._transformUV=null,$Z.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $Ao(.6,.6,.6)),this._setColor(10,new $Ao(1,1,1)),this._setColor(11,new $ho(1,1,1,8)),this._setColor(12,new $Ao(1,1,1)),this._setColor(7,new $ho(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $ho(1,1,0,0)),this.renderMode=1}$Y($Z,"laya.d3.core.material.StandardMaterial",$h);var $J=$Z.prototype;return $J.disableLight=function(){this._addDisablePublicShaderDefine($go.SHADERDEFINE_POINTLIGHT|$go.SHADERDEFINE_SPOTLIGHT|$go.SHADERDEFINE_DIRECTIONLIGHT)},$J.disableFog=function(){this._addDisablePublicShaderDefine($go.SHADERDEFINE_FOG)},$J.onAsynLoaded=function($J,$o,$r){var $S=$o[0];if($S.version)$h.prototype.onAsynLoaded.call(this,$J,$o,$r);else{var $G=$o[1],$z=$S.props;for(var $A in $z)this[$A]=$z[$A];$Z._parseStandardMaterial($G,this,$S),this._endLoaded()}},$J.cloneTo=function($J){$h.prototype.cloneTo.call(this,$J);var $o=$J;this._transformUV&&($o._transformUV=this._transformUV.clone())},$_(0,$J,"ambientColor",function(){return this._getColor(9)},function($J){this._setColor(9,$J)}),$_(0,$J,"ambientTexture",function(){return this._getTexture(5)},function($J){$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$J)}),$_(0,$J,"renderMode",null,function($J){switch($J){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($Z.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($J)}),$_(0,$J,"reflectColor",function(){return this._getColor(12)},function($J){this._setColor(12,$J)}),$_(0,$J,"tilingOffset",function(){return this._getColor(15)},function($J){if($J){var $o=$J.elements;1!=$o[0]||1!=$o[1]||0!=$o[2]||0!=$o[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$J)}),$_(0,$J,"albedo",function(){return this._getColor(7)},function($J){this._setColor(7,$J)}),$_(0,$J,"diffuseColor",function(){return this._getColor(10)},function($J){this._setColor(10,$J)}),$_(0,$J,"albedoColor",function(){return this._getColor(7)},function($J){this._setColor(7,$J)}),$_(0,$J,"specularColor",function(){return this._getColor(11)},function($J){this._setColor(11,$J)}),$_(0,$J,"diffuseTexture",function(){return this._getTexture(1)},function($J){$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$J)}),$_(0,$J,"normalTexture",function(){return this._getTexture(2)},function($J){$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$J)}),$_(0,$J,"specularTexture",function(){return this._getTexture(3)},function($J){$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$J)}),$_(0,$J,"emissiveTexture",function(){return this._getTexture(4)},function($J){$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$J)}),$_(0,$J,"reflectTexture",function(){return this._getTexture(6)},function($J){$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$J)}),$_(0,$J,"transformUV",function(){return this._transformUV},function($J){this._transformUV=$J,this._setMatrix4x4(13,$J.matrix),$J?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$J.matrix.elements,0)}),$Z.__init__=function(){$Z.SHADERDEFINE_DIFFUSEMAP=$Z.shaderDefines.registerDefine("DIFFUSEMAP"),$Z.SHADERDEFINE_NORMALMAP=$Z.shaderDefines.registerDefine("NORMALMAP"),$Z.SHADERDEFINE_SPECULARMAP=$Z.shaderDefines.registerDefine("SPECULARMAP"),$Z.SHADERDEFINE_EMISSIVEMAP=$Z.shaderDefines.registerDefine("EMISSIVEMAP"),$Z.SHADERDEFINE_AMBIENTMAP=$Z.shaderDefines.registerDefine("AMBIENTMAP"),$Z.SHADERDEFINE_REFLECTMAP=$Z.shaderDefines.registerDefine("REFLECTMAP"),$Z.SHADERDEFINE_UVTRANSFORM=$Z.shaderDefines.registerDefine("UVTRANSFORM"),$Z.SHADERDEFINE_TILINGOFFSET=$Z.shaderDefines.registerDefine("TILINGOFFSET"),$Z.SHADERDEFINE_ADDTIVEFOG=$Z.shaderDefines.registerDefine("ADDTIVEFOG")},$Z.load=function($J){return $K.loader.create($J,null,null,$Z)},$Z._parseStandardMaterial=function($J,$o,$r){var $S=$r.customProps,$G=$S.ambientColor;$o.ambientColor=new $Ao($G[0],$G[1],$G[2]);var $z=$S.diffuseColor;$o.diffuseColor=new $Ao($z[0],$z[1],$z[2]);var $A=$S.specularColor;$o.specularColor=new $ho($A[0],$A[1],$A[2],$A[3]);var $h=$S.reflectColor;$o.reflectColor=new $Ao($h[0],$h[1],$h[2]);var $Z=$S.albedoColor;$Z&&($o.albedo=new $ho($Z[0],$Z[1],$Z[2],$Z[3]));var $u=$S.diffuseTexture.texture2D;$u&&($o.diffuseTexture=$w.getRes($J[$u]));var $B=$S.normalTexture.texture2D;$B&&($o.normalTexture=$w.getRes($J[$B]));var $v=$S.specularTexture.texture2D;$v&&($o.specularTexture=$w.getRes($J[$v]));var $j=$S.emissiveTexture.texture2D;$j&&($o.emissiveTexture=$w.getRes($J[$j]));var $Y=$S.ambientTexture.texture2D;$Y&&($o.ambientTexture=$w.getRes($J[$Y]));var $_=$S.reflectTexture.texture2D;$_&&($o.reflectTexture=$w.getRes($J[$_]))},$Z.RENDERMODE_OPAQUE=1,$Z.RENDERMODE_OPAQUEDOUBLEFACE=2,$Z.RENDERMODE_CUTOUT=3,$Z.RENDERMODE_CUTOUTDOUBLEFACE=4,$Z.RENDERMODE_TRANSPARENT=13,$Z.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$Z.RENDERMODE_ADDTIVE=15,$Z.RENDERMODE_ADDTIVEDOUBLEFACE=16,$Z.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$Z.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$Z.RENDERMODE_DEPTHREAD_ADDTIVE=7,$Z.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$Z.RENDERMODE_NONDEPTH_TRANSPARENT=9,$Z.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$Z.RENDERMODE_NONDEPTH_ADDTIVE=11,$Z.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$Z.SHADERDEFINE_DIFFUSEMAP=0,$Z.SHADERDEFINE_NORMALMAP=0,$Z.SHADERDEFINE_SPECULARMAP=0,$Z.SHADERDEFINE_EMISSIVEMAP=0,$Z.SHADERDEFINE_AMBIENTMAP=0,$Z.SHADERDEFINE_REFLECTMAP=0,$Z.SHADERDEFINE_UVTRANSFORM=0,$Z.SHADERDEFINE_TILINGOFFSET=0,$Z.SHADERDEFINE_ADDTIVEFOG=0,$Z.DIFFUSETEXTURE=1,$Z.NORMALTEXTURE=2,$Z.SPECULARTEXTURE=3,$Z.EMISSIVETEXTURE=4,$Z.AMBIENTTEXTURE=5,$Z.REFLECTTEXTURE=6,$Z.ALBEDO=7,$Z.UVANIAGE=8,$Z.MATERIALAMBIENT=9,$Z.MATERIALDIFFUSE=10,$Z.MATERIALSPECULAR=11,$Z.MATERIALREFLECT=12,$Z.UVMATRIX=13,$Z.UVAGE=14,$Z.TILINGOFFSET=15,$v($Z,["defaultMaterial",function(){var $J=new $Z;return $J.lock=!0,this.defaultMaterial=$J},"shaderDefines",function(){return this.shaderDefines=new $Bo($Co.shaderDefines)}]),$Z}($Co),$Fo=function($J){function $A($J,$o,$r,$S,$G){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$r&&($r=35044),void 0===$S&&($S=!1),$A.__super.call(this),this._indexType=$J,this._indexCount=$o,this._bufferUsage=$r,this._bufferType=34963,this._canRead=$S;var $z;if("ushort"==$J)this._indexTypeByteCount=2;else{if("ubyte"!=$J)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$z=this._indexTypeByteCount*$o,this._byteLength=$z,this._bind(),$h._gl.bufferData(this._bufferType,$z,this._bufferUsage),this.uri=$G,$S?("ushort"==$J?this._buffer=new Uint16Array($o):"ubyte"==$J&&(this._buffer=new Uint8Array($o)),this.memorySize=2*$z):this.memorySize=$z}$Y($A,"laya.d3.graphics.IndexBuffer3D",$J);var $o=$A.prototype;return $o.setData=function($J,$o,$r,$S){void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=4294967295);var $G=0;if("ushort"==this._indexType?($G=2,0===$r&&4294967295===$S||($J=new Uint16Array($J.buffer,$r*$G,$S))):"ubyte"==this._indexType&&($G=1,0===$r&&4294967295===$S||($J=new Uint8Array($J.buffer,$r*$G,$S))),this._bind(),$h._gl.bufferSubData(this._bufferType,$o*$G,$J),this._canRead)if(0!==$o||0!==$r||4294967295!==$S){var $z=this._buffer.length-$o;$z<$S&&($S=$z);for(var $A=0;$A<$S;$A++)this._buffer[$o+$A]=$J[$A]}else this._buffer=$J},$o.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$o.disposeResource=function(){$J.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$_(0,$o,"indexType",function(){return this._indexType}),$_(0,$o,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$_(0,$o,"indexCount",function(){return this._indexCount}),$_(0,$o,"canRead",function(){return this._canRead}),$A.INDEXTYPE_UBYTE="ubyte",$A.INDEXTYPE_USHORT="ushort",$A.create=function($J,$o,$r,$S,$G){return void 0===$r&&($r=35044),void 0===$S&&($S=!1),new $A($J,$o,$r,$S,$G)},$A}($h),$do=function($z){function $A($J,$o,$r,$S,$G){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$S&&($S=!1),$A.__super.call(this),this._vertexDeclaration=$J,this._vertexCount=$o,this._bufferUsage=$r,this._bufferType=34962,this._canRead=$S,this.uri=$G,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$o,this._bind(),$h._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$S&&(this._buffer=new Float32Array(this._byteLength/4))}$Y($A,"laya.d3.graphics.VertexBuffer3D",$z);var $J=$A.prototype;return $J.bindWithIndexBuffer=function($J){$J&&$J._bind(),this._bind()},$J.setData=function($J,$o,$r,$S){if(void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=4294967295),0===$r&&4294967295===$S||($J=new Float32Array($J.buffer,4*$r,$S)),this._bind(),$h._gl.bufferSubData(this._bufferType,4*$o,$J),this._canRead)if(0!==$o||0!==$r||4294967295!==$S){var $G=this._buffer.length-$o;$G<$S&&($S=$G);for(var $z=0;$z<$S;$z++)this._buffer[$o+$z]=$J[$z]}else this._buffer=$J},$J.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$J.disposeResource=function(){for(var $J=$R.mainContext,$o=this._vertexDeclaration.getVertexElements(),$r=$h._enableAtributes,$S=0,$G=$o.length;$S<$G;$S++)$r[$S]===this._glBuffer&&($J.disableVertexAttribArray($S),$r[$S]=null);$z.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$_(0,$J,"vertexDeclaration",function(){return this._vertexDeclaration}),$_(0,$J,"vertexCount",function(){return this._vertexCount}),$_(0,$J,"canRead",function(){return this._canRead}),$A.create=function($J,$o,$r,$S,$G){return void 0===$r&&($r=35044),void 0===$S&&($S=!1),new $A($J,$o,$r,$S,$G)},$A}($h),$lo=function($J){function $I(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$I.__super.call(this),this._type=3553}$Y($I,"laya.d3.resource.DataTexture2D",$Ro);var $o=$I.prototype;return $o.genDebugMipmaps=function(){var $J=[];return $J.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$J.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$J.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$J.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$J.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$J.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$J.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$J.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$J.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$J.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$J},$o._onTextureLoaded=function($J){},$o._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $J=$R.mainContext,$o=this._source=$J.createTexture(),$r=this._width,$S=this._height,$G=$n.curBindTexTarget,$z=$n.curBindTexValue,$A=!1;if($n.bindTexture($J,this._type,$o),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $h=0;$J.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $Z=0;$Z<this._mipmaps.length;$Z++){if(this._mipmaps[$Z].byteLength!=$u*$B*4)throw"mipmap size error  level:"+$Z;$J.texSubImage2D(this._type,0,$I.simLodRect[$h++],$I.simLodRect[$h++],$I.simLodRect[$h++],$I.simLodRect[$h++],6408,5121,new Uint8Array(this._mipmaps[$Z]))}this.minFifter=9729,this.magFifter=9729}else{var $u=this._width,$B=this._height;for($h=0,$J.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$Z=0;$Z<this._mipmaps.length;$Z++){if(this._mipmaps[$Z].byteLength!=$u*$B*4)throw"mipmap size error  level:"+$Z;$J.texImage2D(this._type,$Z,6408,$u,$B,0,6408,5121,new Uint8Array(this._mipmaps[$Z])),($u/=2)<1&&($u=1),($B/=2)<1&&($B=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$J.pixelStorei($J.UNPACK_ALIGNMENT,1),$J.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $v=0,$j=!1,$Y=!1;this._buffer.byteLength==4*$r*$S?($v=6408,$j=!0):this._buffer.byteLength==3*$r*$S?($v=6407,$Y=!0):$v=this._format,$j||$Y?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$Y&&$J.pixelStorei($J.UNPACK_ALIGNMENT,1),$J.texImage2D(this._type,0,$v,$r,$S,0,$v,5121,this._buffer)):$J&&$v==$J.ALPHA?($J.texImage2D(3553,0,$v,$r,$S,0,$v,$J.UNSIGNED_BYTE,this._buffer),$A=!0):0!=$v&&($J.compressedTexImage2D(3553,0,$v,$r,$S,0,this._buffer),$A=!0)}var $_=this._minFifter,$D=this._magFifter,$N=0==this._wrapModeU?10497:33071,$w=0==this._wrapModeV?10497:33071,$i=$t.isPOT($r,$S);$i?(this._mipmap||this._mipmaps?-1!==$_||($_=9987):-1!==$_||($_=9729),-1!==$D||($D=9729),$J.texParameteri(this._type,10241,$_),$J.texParameteri(this._type,10240,$D),$J.texParameteri(this._type,10242,$N),$J.texParameteri(this._type,10243,$w),this._mipmap&&$J.generateMipmap(this._type)):(-1!==$_||($_=9729),-1!==$D||($D=9729),$J.texParameteri(this._type,10241,$_),$J.texParameteri(this._type,10240,$D),$J.texParameteri(this._type,10242,33071),$J.texParameteri(this._type,10243,33071)),$G&&$z&&$n.bindTexture($J,$G,$z),this.memorySize=$A?this._buffer.length:$i?$r*$S*4*(1+1/3):$r*$S*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$o.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$o.onAsynLoaded=function($J,$o,$r){var $S;$r&&($S=$r[0].call(this,$o)),$S&&(this._width=$S.width,this._height=$S.height,this._buffer=$S.data),this._src=$J,this._size=new $Do(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$o.getPixels=function(){return new Uint8Array(this._buffer)},$o.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($R.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$_(0,$o,"src",function(){return this._src}),$I.create=function($J,$o,$r,$S,$G,$z,$A){if(void 0===$S&&($S=9729),void 0===$G&&($G=9729),void 0===$z&&($z=!0),!$J||$J.byteLength<$o*$r*4)throw"DataTexture2D create error";var $h=new $I;return $h.uri=$A,$h._buffer=$J,$h._width=$o,$h._height=$r,$h._mipmap=$z,$h._magFifter=$S,$h._minFifter=$G,$h._size=new $Do($h._width,$h._height),$h._conchTexture?alert("怎么给runtime传递datatexture数据"):$h.activeResource(),$h},$I.load=function($J,$o,$r,$S,$G){if(void 0===$o&&($o=0),void 0===$r&&($r=0),void 0===$S&&($S=9729),void 0===$G&&($G=9729),"mipmaps"===$V.getFileExtension($J)){var $z=$K.loader.create($J,null,null,$I,[function($J){this._mipmaps=[];var $o=new Uint32Array($J);this._width=$o[0];var $r=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$r=1024),this._width!=$r)throw"现在只支持512x256的环境贴图。当前的是"+$o[0];this._height=$o[1];for(var $S=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$G=this._height,$z=8;;){var $A=$S*$G*4;if($z+$A>$J.byteLength)throw"load mipmaps data size error ";var $h=new Uint8Array($J,$z,$A);if(this._mipmaps.push($h),$z+=$A,1==$S&&1==$G)break;($S/=2)<1&&($S=1),($G/=2)<1&&($G=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$z.simLodInfo=new Float32Array(40);for(var $A=0;$A<$z.simLodInfo.length;)$z.simLodInfo[$A]=($I.simLodRect[$A]+.5)/1024,$A++,$z.simLodInfo[$A]=($I.simLodRect[$A]+.5)/256,$A++,$z.simLodInfo[$A]=Math.max($I.simLodRect[$A]-1,.1)/1024,$A++,$z.simLodInfo[$A]=Math.max($I.simLodRect[$A]-1.5,.1)/256,$A++}return $z}if("number"==typeof $o)return $K.loader.create($J,null,null,$I,[function($J){return this._width=$o,this._height=$r,this._buffer=$J,null}]);if("function"==typeof $o)return $K.loader.create($J,null,null,$I,[$o]);throw new Error("unknown params.")},$I.lodasatlas=!1,$v($I,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$I}(),$co=function($J){function $o(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$o.__super.call(this)}$Y($o,"laya.d3.resource.models.PrimitiveMesh",$no);var $r=$o.prototype;return $K.imps($r,{"laya.d3.core.render.IRenderable":!0}),$r._getVertexBuffer=function($J){return void 0===$J&&($J=0),0===$J?this._vertexBuffer:null},$r._getVertexBuffers=function(){return null},$r._getIndexBuffer=function(){return this._indexBuffer},$r._getPositions=function(){var $J,$o=[],$r=this._vertexBuffer.vertexDeclaration.getVertexElements(),$S=0;for($S=0;$S<$r.length;$S++){var $G=$r[$S];if("vector3"===$G.elementFormat&&0===$G.elementUsage){$J=$G;break}}var $z=this._vertexBuffer.getData();for($S=0;$S<$z.length;$S+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $A=$S+$J.offset/4,$h=new $Ao($z[$A+0],$z[$A+1],$z[$A+2]);$o.push($h)}return $o},$r.getRenderElement=function($J){return this},$r.getRenderElementsCount=function(){return 1},$r.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$r._beforeRender=function($J){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$r._render=function($J){$R.mainContext.drawElements(4,this._numberIndices,5123,0),$g.drawCall++,$g.trianglesFaces+=this._numberIndices/3},$_(0,$r,"_vertexBufferCount",function(){return 1}),$_(0,$r,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$o}(),$To=function($J){function $o(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$o.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$Y($o,"laya.d3.resource.models.Mesh",$no);var $r=$o.prototype;return $r._getPositions=function(){var $J,$o,$r,$S,$G,$z=[],$A=0,$h=0,$Z=0;if(0!==this._vertexBuffers.length){var $u=this._vertexBuffers.length;for($A=0;$A<$u;$A++){for($r=($J=this._vertexBuffers[$A]).vertexDeclaration.getVertexElements(),$h=0;$h<$r.length;$h++)if("vector3"===($S=$r[$h]).elementFormat&&0===$S.elementUsage){$o=$S;break}for($G=$J.getData(),$h=0;$h<$G.length;$h+=$J.vertexDeclaration.vertexStride/4)$Z=$h+$o.offset/4,$z.push(new $Ao($G[$Z+0],$G[$Z+1],$G[$Z+2]))}}else{var $B=this._subMeshes.length;for($A=0;$A<$B;$A++){for($r=($J=this._subMeshes[$A]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$h=0;$h<$r.length;$h++)if("vector3"===($S=$r[$h]).elementFormat&&0===$S.elementUsage){$o=$S;break}for($G=$J.getData(),$h=0;$h<$G.length;$h+=$J.vertexDeclaration.vertexStride/4)$Z=$h+$o.offset/4,$z.push(new $Ao($G[$Z+0],$G[$Z+1],$G[$Z+2]))}}return $z},$r._setSubMeshes=function($J){this._subMeshes=$J,this._subMeshCount=$J.length;for(var $o=0;$o<this._subMeshCount;$o++)$J[$o]._indexInMesh=$o;this._positions=this._getPositions(),this._generateBoundingObject()},$r.onAsynLoaded=function($J,$o,$r){var $S=$o[0],$G=$o[1];$MJ.read($S,this,this._materials,this._subMeshes,$G),this.completeCreate(),this._endLoaded()},$r.getSubMesh=function($J){return this._subMeshes[$J]},$r.getSubMeshCount=function(){return this._subMeshes.length},$r.getRenderElementsCount=function(){return this._subMeshes.length},$r.getRenderElement=function($J){return this._subMeshes[$J]},$r.disposeResource=function(){for(var $J=0;$J<this._subMeshes.length;$J++)this._subMeshes[$J].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$_(0,$r,"materials",function(){return this._materials.slice()}),$_(0,$r,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$o.load=function($J){return $K.loader.create($J,null,null,$o)},$o}(),$bo=(function($J){function $u($J,$o,$r,$S,$G,$z,$A,$h,$Z){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$r&&($r=6408),void 0===$S&&($S=5121),void 0===$G&&($G=33189),void 0===$z&&($z=!1),void 0===$A&&($A=!1),void 0===$h&&($h=-1),void 0===$Z&&($Z=-1),$u.__super.call(this),this._type=3553,this._width=$J,this._height=$o,this._size=new $Do($J,$o),this._surfaceFormat=$r,this._surfaceType=$S,this._depthStencilFormat=$G,$D.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$z,this._repeat=$A,this._minFifter=$h,this._magFifter=$Z,this.activeResource(),this._alreadyResolved=!0}$Y($u,"laya.d3.resource.RenderTexture",$Ro);var $o=$u.prototype;$o.recreateResource=function(){var $J=$R.mainContext;this._frameBuffer=$J.createFramebuffer(),this._source=$J.createTexture();var $o=$n.curBindTexTarget,$r=$n.curBindTexValue;$n.bindTexture($J,this._type,this._source),$J.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $S=this._minFifter,$G=this._magFifter,$z=this._repeat?10497:33071;if($t.isPOT(this._width,this._height)?(this._mipmap?-1!==$S||($S=9987):-1!==$S||($S=9729),-1!==$G||($G=9729),$J.texParameteri(this._type,10241,$S),$J.texParameteri(this._type,10240,$G),$J.texParameteri(this._type,10242,$z),$J.texParameteri(this._type,10243,$z),this._mipmap&&$J.generateMipmap(this._type)):(-1!==$S||($S=9729),-1!==$G||($G=9729),$J.texParameteri(this._type,10241,$S),$J.texParameteri(this._type,10240,$G),$J.texParameteri(this._type,10242,33071),$J.texParameteri(this._type,10243,33071)),$o&&$r&&$n.bindTexture($J,$o,$r),$J.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$J.createRenderbuffer(),$J.bindRenderbuffer(36161,this._depthStencilBuffer),$J.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$J.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$J.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$J.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$J.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$J.framebufferTexture2D(36160,36064,3553,this._source,0),$J.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$o.start=function(){$R.mainContext.bindFramebuffer(36160,this.frameBuffer),($u._currentRenderTarget=this)._alreadyResolved=!1},$o.end=function(){$R.mainContext.bindFramebuffer(36160,null),$u._currentRenderTarget=null,this._alreadyResolved=!0},$o.getData=function($J,$o,$r,$S){var $G=$R.mainContext;if($G.bindFramebuffer(36160,this._frameBuffer),!(36053===$G.checkFramebufferStatus(36160)))return $G.bindFramebuffer(36160,null),null;var $z=new Uint8Array(this._width*this._height*4);return $G.readPixels($J,$o,$r,$S,this._surfaceFormat,this._surfaceType,$z),$G.bindFramebuffer(36160,null),$z},$o.disposeResource=function(){if(this._frameBuffer){var $J=$R.mainContext;$J.deleteTexture(this._source),$J.deleteFramebuffer(this._frameBuffer),$J.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$_(0,$o,"surfaceFormat",function(){return this._surfaceFormat}),$_(0,$o,"surfaceType",function(){return this._surfaceType}),$_(0,$o,"depthStencilFormat",function(){return this._depthStencilFormat}),$_(0,$o,"source",function(){return this._alreadyResolved?$K.superGet($Ro,this,"source"):null}),$_(0,$o,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$_(0,$o,"frameBuffer",function(){return this._frameBuffer}),$u._currentRenderTarget=null}(),function($J){function $o($J){this._color=null,this._pixels=null,$o.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $Do(this.width,this.height),this._color=$J,this._pixels=new Uint8Array([255*$J.x,255*$J.y,255*$J.z,255*$J.w]),this.uri="SolidColorTexture2D_"+this.id}$Y($o,"laya.d3.resource.SolidColorTexture2D",$Ro);var $r=$o.prototype;return $r._createWebGlTexture=function(){var $J=$R.mainContext,$o=this._source=$J.createTexture(),$r=this._width,$S=this._height,$G=$n.curBindTexTarget,$z=$n.curBindTexValue;$n.bindTexture($J,this._type,$o),$J.texImage2D(this._type,0,6408,$r,$S,0,6408,5121,this._pixels);var $A=this._minFifter,$h=this._magFifter,$Z=this._repeat?10497:33071,$u=$t.isPOT($r,$S);$u?(this._mipmap?-1!==$A||($A=9987):-1!==$A||($A=9729),-1!==$h||($h=9729),$J.texParameteri(this._type,10241,$A),$J.texParameteri(this._type,10240,$h),$J.texParameteri(this._type,10242,$Z),$J.texParameteri(this._type,10243,$Z),this._mipmap&&$J.generateMipmap(this._type)):(-1!==$A||($A=9729),-1!==$h||($h=9729),$J.texParameteri(this._type,10241,$A),$J.texParameteri(this._type,10240,$h),$J.texParameteri(this._type,10242,33071),$J.texParameteri(this._type,10243,33071)),$G&&$z&&$n.bindTexture($J,$G,$z),this.memorySize=$u?$r*$S*4*(1+1/3):$r*$S*4},$r.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$r.disposeResource=function(){this._source&&($R.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$v($o,["magentaTexture",function(){var $J=new $o(new $ho(1,0,1,1));return $J.lock=!0,this.magentaTexture=$J},"grayTexture",function(){var $J=new $o(new $ho(.5,.5,.5,1));return $J.lock=!0,this.grayTexture=$J}]),$o}()),$$o=function($J){function $G($J,$o,$r,$S){this._canRead=!1,this._image=null,this._pixels=null,void 0===$J&&($J=!1),void 0===$o&&($o=!0),void 0===$r&&($r=6408),void 0===$S&&($S=!0),$G.__super.call(this),this._type=3553,this._repeat=$o,this._canRead=$J,this._format=$r,this._mipmap=$S}$Y($G,"laya.d3.resource.Texture2D",$Ro);var $o=$G.prototype;return $o._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $J=$R.mainContext,$o=this._source=$J.createTexture(),$r=this._width,$S=this._height,$G=$n.curBindTexTarget,$z=$n.curBindTexValue;switch($n.bindTexture($J,this._type,$o),this._format){case 6407:case 6408:this._canRead?$J.texImage2D(this._type,0,this._format,$r,$S,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$J.texImage2D(this._type,0,this._image._format,$r,$S,0,this._image._format,5121,this._image.atlasSource):$J.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $R.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$J.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $A=this._minFifter,$h=this._magFifter,$Z=this._repeat?10497:33071,$u=0==this._wrapModeU?10497:33071,$B=0==this._wrapModeV?10497:33071,$v=$t.isPOT($r,$S);$v?(this._mipmap?-1!==$A||($A=9987):-1!==$A||($A=9729),-1!==$h||($h=9729),$J.texParameteri(this._type,10241,$A),$J.texParameteri(this._type,10240,$h),$J.texParameteri(this._type,10242,$Z),$J.texParameteri(this._type,10243,$Z),$J.texParameteri(this._type,10242,$u),$J.texParameteri(this._type,10243,$B),this._mipmap&&$J.generateMipmap(this._type)):(-1!==$A||($A=9729),-1!==$h||($h=9729),$J.texParameteri(this._type,10241,$A),$J.texParameteri(this._type,10240,$h),$J.texParameteri(this._type,10242,33071),$J.texParameteri(this._type,10243,33071)),$G&&$z&&$n.bindTexture($J,$G,$z),this._image.onload=null,this._image=null,this.memorySize=$v?$r*$S*4*(1+1/3):$r*$S*4},$o.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$o.onAsynLoaded=function($J,$o,$r){if($r){var $S=$r[0];void 0!==$S&&(this._canRead=$S);var $G=$r[1];void 0!==$G&&(this._repeat=$G);var $z=$r[2];void 0!==$z&&(this._format=$z);var $A=$r[3];void 0!==$A&&(this._mipmap=$A);var $h=$r.wrapModeU;void 0!==$h&&(this._wrapModeU=$h);var $Z=$r.wrapModeV;void 0!==$Z&&(this._wrapModeV=$Z)}switch(this._format){case 6407:case 6408:var $u=(this._image=$o).width,$B=$o.height;this._width=$u,this._height=$B,this._size=new $Do($u,$B),this._canRead&&($D.isConchApp?$o instanceof $j.HTMLElement&&(this._pixels=new Uint8Array($o.getImageData(0,0,$u,$B))):($k.canvas.size($u,$B),$k.canvas.clear(),$k.context.drawImage($o,0,0,$u,$B),this._pixels=new Uint8Array($k.context.getImageData(0,0,$u,$B).data.buffer)));break;case $R.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $v=new $e($o);$v.readUTFBytes(4),$v.readUTFBytes(2),$v.getInt16();$v.endian="bigEndian",this._width=$v.getInt16(),this._height=$v.getInt16(),this._size=new $Do(this._width,this._height);$v.getInt16(),$v.getInt16();this._image=new Uint8Array($o,$v.pos)}this.recreateResource(),this._endLoaded()},$o.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$o.disposeResource=function(){this._source&&($R.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$_(0,$o,"_src",function(){return this.url}),$_(0,$o,"src",function(){return this.url}),$G.load=function($J){return $K.loader.create($J,null,null,$G)},$G}(),$qo=function($o){function $r($J,$o){$r.__super.call(this),void 0===$J&&($J=.3),void 0===$o&&($o=1e3),this._tempVector3=new $Ao,this._position=new $Ao,this._up=new $Ao,this._forward=new $Ao,this._right=new $Ao,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$Do.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$J,this._farPlane=$o,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$K.stage.on("resize",this,this._onScreenSizeChanged)}$Y($r,"laya.d3.core.BaseCamera",$o);var $J=$r.prototype;return $J._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $J=this.scene._cameraPool,$o=$J.length-1,$r=0;$r<$o;$r++)if($J[$r].renderingOrder>$J[$o].renderingOrder){var $S=$J[$r];$J[$r]=$J[$o],$J[$o]=$S}},$J._calculateProjectionMatrix=function(){},$J._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$J._prepareCameraToRender=function(){$U._currentCameraCullingMask=this.cullingMask;var $J=this._shaderValues;$J.setValue(0,this.transform.position.elements),$J.setValue(5,this.forward.elements),$J.setValue(6,this.up.elements)},$J._prepareCameraViewProject=function($J,$o){var $r=this._shaderValues;$r.setValue(1,$J.elements),$r.setValue(2,$o.elements)},$J._renderCamera=function($J,$o,$r){},$J.addLayer=function($J){29!==$J.number&&30!=$J.number&&(this.cullingMask=this.cullingMask|$J.mask)},$J.removeLayer=function($J){29!==$J.number&&30!=$J.number&&(this.cullingMask=this.cullingMask&~$J.mask)},$J.addAllLayers=function(){this.cullingMask=2147483647},$J.removeAllLayers=function(){this.cullingMask=0|$U.getLayerByNumber(29).mask|$U.getLayerByNumber(30).mask},$J.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$J.moveForward=function($J){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$J,this.transform.translate(this._tempVector3)},$J.moveRight=function($J){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$J,this.transform.translate(this._tempVector3)},$J.moveVertical=function($J){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$J,this.transform.translate(this._tempVector3,!1)},$J._addSelfRenderObjects=function(){var $J=this.scene._cameraPool,$o=$J.length;if(0<$o){for(var $r=$o-1;0<=$r;$r--)if(this.renderingOrder<=$J[$r].renderingOrder){$J.splice($r+1,0,this);break}}else $J.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$J._clearSelfRenderObjects=function(){var $J=this.scene._cameraPool;$J.splice($J.indexOf(this),1)},$J.destroy=function($J){void 0===$J&&($J=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$K.stage.off("resize",this,this._onScreenSizeChanged),$o.prototype.destroy.call(this,$J)},$_(0,$J,"sky",function(){return this._sky},function($J){(this._sky=$J)._ownerCamera=this}),$_(0,$J,"forward",function(){var $J=this.transform.worldMatrix.elements,$o=this._forward.elements;return $o[0]=-$J[8],$o[1]=-$J[9],$o[2]=-$J[10],this._forward}),$_(0,$J,"position",function(){var $J=this.transform.worldMatrix.elements,$o=this._position.elements;return $o[0]=$J[12],$o[1]=$J[13],$o[2]=$J[14],this._position}),$_(0,$J,"renderTarget",function(){return this._renderTarget},function($J){null!=(this._renderTarget=$J)&&(this._renderTargetSize=$J.size)}),$_(0,$J,"up",function(){var $J=this.transform.worldMatrix.elements,$o=this._up.elements;return $o[0]=$J[4],$o[1]=$J[5],$o[2]=$J[6],this._up}),$_(0,$J,"right",function(){var $J=this.transform.worldMatrix.elements,$o=this._right.elements;return $o[0]=$J[0],$o[1]=$J[1],$o[2]=$J[2],this._right}),$_(0,$J,"renderTargetSize",function(){return this._renderTargetSize},function($J){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$J,this._calculateProjectionMatrix()}),$_(0,$J,"fieldOfView",function(){return this._fieldOfView},function($J){this._fieldOfView=$J,this._calculateProjectionMatrix()}),$_(0,$J,"nearPlane",function(){return this._nearPlane},function($J){this._nearPlane=$J,this._calculateProjectionMatrix()}),$_(0,$J,"farPlane",function(){return this._farPlane},function($J){this._farPlane=$J,this._calculateProjectionMatrix()}),$_(0,$J,"orthographic",function(){return this._orthographic},function($J){this._orthographic=$J,this._calculateProjectionMatrix()}),$_(0,$J,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($J){this._orthographicVerticalSize=$J,this._calculateProjectionMatrix()}),$_(0,$J,"renderingOrder",function(){return this._renderingOrder},function($J){this._renderingOrder=$J,this._sortCamerasByRenderingOrder()}),$r.CAMERAPOS=0,$r.VIEWMATRIX=1,$r.PROJECTMATRIX=2,$r.VPMATRIX=3,$r.VPMATRIX_NO_TRANSLATE=4,$r.CAMERADIRECTION=5,$r.CAMERAUP=6,$r.ENVIRONMENTDIFFUSE=7,$r.ENVIRONMENTSPECULAR=8,$r.SIMLODINFO=9,$r.DIFFUSEIRRADMATR=10,$r.DIFFUSEIRRADMATG=11,$r.DIFFUSEIRRADMATB=12,$r.HDREXPOSURE=13,$r.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$r.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$r.CLEARFLAG_SOLIDCOLOR=0,$r.CLEARFLAG_SKY=1,$r.CLEARFLAG_DEPTHONLY=2,$r.CLEARFLAG_NONE=3,$v($r,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $Jo(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $Jo},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $Jo}]),$r}($Qo),$Ho=function($r){function $o($J){this._render=null,this._geometryFilter=null,$o.__super.call(this,$J)}$Y($o,"laya.d3.core.RenderableSprite3D",$r);var $J=$o.prototype;return $J._addToInitStaticBatchManager=function(){},$J._setBelongScene=function($J){$r.prototype._setBelongScene.call(this,$J),$J._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$J._setUnBelongScene=function(){var $J=this._scene._renderableSprite3Ds,$o=$J.indexOf(this);$J.splice($o,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$r.prototype._setUnBelongScene.call(this)},$J._update=function($J){($J.owner=this)._activeInHierarchy&&(this._updateComponents($J),this._render._updateOctreeNode(),this._lateUpdateComponents($J),$g.spriteCount++,this._childs.length&&this._updateChilds($J))},$J.destroy=function($J){void 0===$J&&($J=!0),$r.prototype.destroy.call(this,$J),this._render._destroy(),this._render=null},$o.__init__=function(){$o.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$o.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$o.SAHDERDEFINE_LIGHTMAP=$o.shaderDefines.registerDefine("LIGHTMAP")},$o.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$o.SAHDERDEFINE_LIGHTMAP=4,$o.LIGHTMAPSCALEOFFSET=2,$o.LIGHTMAP=3,$v($o,["shaderDefines",function(){return this.shaderDefines=new $Bo}]),$o}($Qo),$ao=(function($J){function $S($J,$o,$r){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$J&&($J=1),void 0===$o&&($o=1),void 0===$r&&($r=1),$S.__super.call(this),this._long=$J,this._width=$o,this._height=$r,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$Y($S,"laya.d3.resource.models.BoxMesh",$co);var $o=$S.prototype;$o.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $J=$RJ.vertexDeclaration,$o=($J.vertexStride,this._long/2),$r=this._height/2,$S=this._width/2,$G=new Float32Array([-$o,$r,-$S,0,1,0,0,0,$o,$r,-$S,0,1,0,1,0,$o,$r,$S,0,1,0,1,1,-$o,$r,$S,0,1,0,0,1,-$o,-$r,-$S,0,-1,0,0,1,$o,-$r,-$S,0,-1,0,1,1,$o,-$r,$S,0,-1,0,1,0,-$o,-$r,$S,0,-1,0,0,0,-$o,$r,-$S,-1,0,0,0,0,-$o,$r,$S,-1,0,0,1,0,-$o,-$r,$S,-1,0,0,1,1,-$o,-$r,-$S,-1,0,0,0,1,$o,$r,-$S,1,0,0,1,0,$o,$r,$S,1,0,0,0,0,$o,-$r,$S,1,0,0,0,1,$o,-$r,-$S,1,0,0,1,1,-$o,$r,$S,0,0,1,0,0,$o,$r,$S,0,0,1,1,0,$o,-$r,$S,0,0,1,1,1,-$o,-$r,$S,0,0,1,0,1,-$o,$r,-$S,0,0,-1,1,0,$o,$r,-$S,0,0,-1,0,0,$o,-$r,-$S,0,0,-1,0,1,-$o,-$r,-$S,0,0,-1,1,1]),$z=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $do($J,this._numberVertices,35044,!0),this._indexBuffer=new $Fo("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($G),this._indexBuffer.setData($z),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$_(0,$o,"long",function(){return this._long},function($J){this._long!==$J&&(this._long=$J,this.releaseResource(),this.activeResource())}),$_(0,$o,"width",function(){return this._width},function($J){this._width!==$J&&(this._width=$J,this.releaseResource(),this.activeResource())}),$_(0,$o,"height",function(){return this._height},function($J){this._height!==$J&&(this._height=$J,this.releaseResource(),this.activeResource())})}(),function($J){function $G($J,$o,$r,$S){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$J&&($J=10),void 0===$o&&($o=10),void 0===$r&&($r=10),void 0===$S&&($S=10),$G.__super.call(this),this._long=$J,this._width=$o,this._stacks=$r,this._slices=$S,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$Y($G,"laya.d3.resource.models.PlaneMesh",$co);var $o=$G.prototype;$o.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $J=new Uint16Array(this._numberIndices),$o=$RJ.vertexDeclaration,$r=$o.vertexStride/4,$S=new Float32Array(this._numberVertices*$r),$G=this._long/2,$z=this._width/2,$A=this._long/this._stacks,$h=this._width/this._slices,$Z=0,$u=0;$u<=this._slices;$u++)for(var $B=0;$B<=this._stacks;$B++)$S[$Z++]=$B*$A-$G,$S[$Z++]=0,$S[$Z++]=$u*$h-$z,$S[$Z++]=0,$S[$Z++]=1,$S[$Z++]=0,$S[$Z++]=1*$B/this._stacks,$S[$Z++]=1*$u/this._slices;var $v=0;for($u=0;$u<this._slices;$u++)for($B=0;$B<this._stacks;$B++)$J[$v++]=($u+1)*(this._stacks+1)+$B,$J[$v++]=$u*(this._stacks+1)+$B,$J[$v++]=($u+1)*(this._stacks+1)+$B+1,$J[$v++]=$u*(this._stacks+1)+$B,$J[$v++]=$u*(this._stacks+1)+$B+1,$J[$v++]=($u+1)*(this._stacks+1)+$B+1;this._vertexBuffer=new $do($o,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $Fo("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($S),this._indexBuffer.setData($J),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$_(0,$o,"long",function(){return this._long},function($J){this._long!==$J&&(this._long=$J,this.releaseResource(),this.activeResource())}),$_(0,$o,"width",function(){return this._width},function($J){this._width!==$J&&(this._width=$J,this.releaseResource(),this.activeResource())}),$_(0,$o,"stacks",function(){return this._stacks},function($J){this._stacks!==$J&&(this._stacks=$J,this.releaseResource(),this.activeResource())}),$_(0,$o,"slices",function(){return this._slices},function($J){this._slices!==$J&&(this._slices=$J,this.releaseResource(),this.activeResource())})}(),function($J){function $A($J,$o,$r){void 0===$J&&($J=0),void 0===$o&&($o=.3),void 0===$r&&($r=1e3),this._viewMatrix=new $Jo,this._projectionMatrix=new $Jo,this._projectionViewMatrix=new $Jo,this._viewport=new $Zo(0,0,0,0),this._normalizedViewport=new $Zo(0,0,1,1),this._aspectRatio=$J,this._boundFrustumUpdate=!0,this._boundFrustum=new $PJ($Jo.DEFAULT),$A.__super.call(this,$o,$r),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$Y($A,"laya.d3.core.Camera",$qo);var $o=$A.prototype;return $o._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$o._parseCustomProps=function($J,$o,$r,$S){var $G=$r.clearColor;this.clearColor=new $ho($G[0],$G[1],$G[2],$G[3]);var $z=$r.viewport;this.normalizedViewport=new $Zo($z[0],$z[1],$z[2],$z[3])},$o._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $J=this.orthographicVerticalSize*this.aspectRatio*.5,$o=.5*this.orthographicVerticalSize;$Jo.createOrthoOffCenterRH(-$J,$J,-$o,$o,this.nearPlane,this.farPlane,this._projectionMatrix)}else $Jo.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$o._update=function($J){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$J)},$o._renderCamera=function($J,$o,$r){var $S,$G;$r.parallelSplitShadowMaps[0]&&$r._renderShadowMap($J,$o,this),($o.camera=this)._prepareCameraToRender(),$r._preRenderUpdateComponents($o),$S=$o._viewMatrix=this.viewMatrix;var $z=this._renderTarget;$z?($z.start(),$Jo.multiply($qo._invertYScaleMatrix,this._projectionMatrix,$qo._invertYProjectionMatrix),$Jo.multiply($qo._invertYScaleMatrix,this.projectionViewMatrix,$qo._invertYProjectionViewMatrix),$G=$o._projectionMatrix=$qo._invertYProjectionMatrix,$o._projectionViewMatrix=$qo._invertYProjectionViewMatrix):($G=$o._projectionMatrix=this._projectionMatrix,$o._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($S,$G),$o._viewport=this.viewport,$r._preRenderScene($J,$o,this.boundFrustum),$r._clear($J,$o),$r._renderScene($J,$o),$r._postRenderUpdateComponents($o),$z&&$z.end()},$o.viewportPointToRay=function($J,$o){$_o.calculateCursorRay($J,this.viewport,this._projectionMatrix,this.viewMatrix,null,$o)},$o.normalizedViewportPointToRay=function($J,$o){var $r=$A._tempVector20,$S=this.viewport,$G=$J.elements,$z=$r.elements;$z[0]=$G[0]*$S.width,$z[1]=$G[1]*$S.height,$_o.calculateCursorRay($r,this.viewport,this._projectionMatrix,this.viewMatrix,null,$o)},$o.worldToViewportPoint=function($J,$o){$Jo.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($J,this._projectionViewMatrix,$o);var $r=$o.elements;$r[0]=$r[0]/$K.stage.clientScaleX,$r[1]=$r[1]/$K.stage.clientScaleY},$o.worldToNormalizedViewportPoint=function($J,$o){$Jo.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($J,this._projectionViewMatrix,$o);var $r=$o.elements;$r[0]=$r[0]/$K.stage.clientScaleX,$r[1]=$r[1]/$K.stage.clientScaleY},$o.convertScreenCoordToOrthographicCoord=function($J,$o){if(this._orthographic){var $r=$M.clientWidth,$S=$M.clientHeight,$G=this.orthographicVerticalSize*this.aspectRatio/$r,$z=this.orthographicVerticalSize/$S,$A=$J.elements,$h=$o.elements;return $h[0]=(-$r/2+$A[0])*$G,$h[1]=($S/2-$A[1])*$z,$h[2]=(this.nearPlane-this.farPlane)*($A[2]+1)/2-this.nearPlane,$Ao.transformCoordinate($o,this.transform.worldMatrix,$o),!0}return!1},$_(0,$o,"projectionViewMatrix",function(){return $Jo.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$_(0,$o,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $J=this.viewport;return $J.width/$J.height},function($J){if($J<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$J,this._calculateProjectionMatrix()}),$_(0,$o,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$_(0,$o,"needViewport",function(){var $J=this.normalizedViewport;return 0===$J.x&&0===$J.y&&1===$J.width&&1===$J.height}),$_(0,$o,"viewport",function(){if(this._viewportExpressedInClipSpace){var $J=this._normalizedViewport,$o=this.renderTargetSize,$r=$o.width,$S=$o.height;this._viewport.x=$J.x*$r,this._viewport.y=$J.y*$S,this._viewport.width=$J.width*$r,this._viewport.height=$J.height*$S}return this._viewport},function($J){if(null!=this.renderTarget&&($J.x<0||$J.y<0||0==$J.width||0==$J.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$J,this._calculateProjectionMatrix()}),$_(0,$o,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $J=this._viewport,$o=this.renderTargetSize,$r=$o.width,$S=$o.height;this._normalizedViewport.x=$J.x/$r,this._normalizedViewport.y=$J.y/$S,this._normalizedViewport.width=$J.width/$r,this._normalizedViewport.height=$J.height/$S}return this._normalizedViewport},function($J){$J.x<0&&($J.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$J.y<0&&($J.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$J.x+$J.width&&($J.width=1-$J.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$J.y+$J.height&&($J.height=1-$J.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$J,this._calculateProjectionMatrix()}),$_(0,$o,"projectionMatrix",function(){return this._projectionMatrix},function($J){this._projectionMatrix=$J,this._useUserProjectionMatrix=!0}),$_(0,$o,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$v($A,["_tempVector20",function(){return this._tempVector20=new $zo}]),$A}()),$xo=function($r){function $S($J,$o){$S.__super.call(this,$o),this._geometryFilter=new $ko(this),this._render=new $Uo(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$J&&(this._geometryFilter.sharedMesh=$J)instanceof laya.d3.resource.models.Mesh&&($J.loaded?this._render.sharedMaterials=$J.materials:$J.once("loaded",this,this._applyMeshMaterials))}$Y($S,"laya.d3.core.MeshSprite3D",$r);var $J=$S.prototype;return $J._changeRenderObjectByMesh=function($J){var $o=this._render._renderElements,$r=$o[$J];$r||($r=$o[$J]=new $yo),$r._render=this._render;var $S=this._render.sharedMaterials[$J];$S||($S=$fo.defaultMaterial);var $G=this._geometryFilter.sharedMesh.getRenderElement($J);return $r._mainSortID=this._getSortID($G,$S),$r._sprite3D=this,$r.renderObj=$G,$r._material=$S,$r},$J._changeRenderObjectByMaterial=function($J,$o){var $r=this._render._renderElements[$J];$o||($o=$fo.defaultMaterial);var $S=this._geometryFilter.sharedMesh.getRenderElement($J);return $r._mainSortID=this._getSortID($S,$o),$r._sprite3D=this,$r.renderObj=$S,$r._material=$o,$r},$J._changeRenderObjectsByMesh=function(){var $J=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$J;for(var $o=0;$o<$J;$o++)this._changeRenderObjectByMesh($o)},$J._onMeshChanged=function($J){var $o=$J.sharedMesh;$o.loaded?this._changeRenderObjectsByMesh():$o.once("loaded",this,this._onMeshLoaded)},$J._onMeshLoaded=function($J){$J===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$J._onMaterialChanged=function($J,$o,$r){$o<this._render._renderElements.length&&this._changeRenderObjectByMaterial($o,$r)},$J._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$J._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$J._parseCustomProps=function($J,$o,$r,$S){var $G=this.meshRender,$z=$r.lightmapIndex;null!=$z&&($G.lightmapIndex=$z);var $A,$h,$Z=$r.lightmapScaleOffset;if($Z&&($G.lightmapScaleOffset=new $ho($Z[0],$Z[1],$Z[2],$Z[3])),$S.instanceParams)($A=$S.instanceParams.loadPath)&&($h=$w.getRes($o[$A]),(this.meshFilter.sharedMesh=$h).loaded?$G.sharedMaterials=$h.materials:$h.once("loaded",this,this._applyMeshMaterials));else{($A=$r.meshPath)&&($h=$w.getRes($o[$A]),this.meshFilter.sharedMesh=$h);var $u=$r.materials;if($u){var $B=$G.sharedMaterials,$v=$u.length;$B.length=$v;for(var $j=0;$j<$v;$j++)$B[$j]=$w.getRes($o[$u[$j].path]);$G.sharedMaterials=$B}}},$J._applyMeshMaterials=function($J){for(var $o=this._render.sharedMaterials,$r=$J.materials,$S=0,$G=$r.length;$S<$G;$S++)$o[$S]||($o[$S]=$r[$S]);this._render.sharedMaterials=$o},$J._addToInitStaticBatchManager=function(){$S._staticBatchManager._addInitBatchSprite(this)},$J.cloneTo=function($J){var $o=$J;$o._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $r=this._render,$S=$o._render;$S.enable=$r.enable,$S.sharedMaterials=$r.sharedMaterials,$S.castShadow=$r.castShadow;var $G=$r.lightmapScaleOffset;$G&&($S.lightmapScaleOffset=$G.clone()),$S.lightmapIndex=$r.lightmapIndex,$S.receiveShadow=$r.receiveShadow,$S.sortingFudge=$r.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$J)},$J.destroy=function($J){if(void 0===$J&&($J=!0),!this.destroyed){var $o=this.meshFilter.sharedMesh;null!=$o&&($o.loaded||$o.off("loaded",this,this._applyMeshMaterials)),$r.prototype.destroy.call(this,$J),this._geometryFilter._destroy()}},$_(0,$J,"meshFilter",function(){return this._geometryFilter}),$_(0,$J,"meshRender",function(){return this._render}),$S.__init__=function(){$SJ._staticBatchManagers.push($S._staticBatchManager)},$S.load=function($J){return $K.loader.create($J,null,null,$S)},$v($S,["_staticBatchManager",function(){return this._staticBatchManager=new $so}]),$S}($Ho)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($J,$o){"use strict";for(var $r in Object.defineProperty($o,"__esModule",{value:!0}),Laya){var $S=Laya[$r];$S&&$S.__isclass&&($o[$r]=$S)}}),function($J,$o,$GJ){$GJ.un,$GJ.uns;var $r=$GJ.static,$S=$GJ.class,$z=$GJ.getset,$D=$GJ.__newvec,$h=laya.maths.Bezier,$v=laya.utils.Browser,$RJ=laya.utils.Byte,$G=(laya.events.Event,laya.events.EventDispatcher),$A=laya.display.Graphics,$Z=(laya.resource.HTMLCanvas,laya.utils.Handler),$u=laya.net.Loader,$j=laya.maths.MathUtil,$nJ=laya.maths.Matrix,$N=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$B=(laya.renders.RenderContext,laya.resource.Resource),$Y=laya.utils.RunDriver,$zJ=laya.display.Sprite,$_=laya.utils.Stat,$kJ=laya.resource.Texture,$w=(laya.net.URL,laya.utils.Utils),$n=function(){function $J(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $S($J,"laya.ani.AnimationContent"),$J}(),$k=function(){function $J(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $S($J,"laya.ani.AnimationNodeContent"),$J}(),$I=function(){function $J(){}return $S($J,"laya.ani.AnimationParser01"),$J.parse=function($J,$o){var $r=$o.__getBuffer(),$S=0,$G=0,$z=0,$A=0,$h=0,$Z=0,$u=0,$B=$o.readUTFString();$J._aniClassName=$B;var $v,$j=$o.readUTFString().split("\n"),$Y=$o.getUint8(),$_=$o.getUint32(),$D=$o.getUint32();0<$_&&($v=$r.slice($_,$D));var $N=new $RJ($v);for(0<$D&&($J._publicExtData=$r.slice($D,$r.byteLength)),$J._useParent=!!$o.getUint8(),$J._anis.length=$Y,$S=0;$S<$Y;$S++){var $w=$J._anis[$S]=new $n;$w.nodes=new Array;var $i=$w.name=$j[$o.getUint16()];$J._aniMap[$i]=$S,$w.bone3DMap={},$w.playTime=$o.getFloat32(),$w.playTime<=0&&console.error("播放时间不能为0  url="+$J.url+" name="+$w.name);var $I=$w.nodes.length=$o.getUint8();for($G=$w.totalKeyframeDatasLength=0;$G<$I;$G++){var $t=$w.nodes[$G]=new $k;$t.childs=[];var $K=$o.getInt16();0<=$K&&($t.name=$j[$K],$w.bone3DMap[$t.name]=$G),$t.keyFrame=new Array,$t.parentIndex=$o.getInt16(),-1==$t.parentIndex?$t.parent=null:$t.parent=$w.nodes[$t.parentIndex],$t.lerpType=$o.getUint8();var $e=$o.getUint32();$N.pos=$e;var $y=$t.keyframeWidth=$N.getUint16();if($w.totalKeyframeDatasLength+=$y,0===$t.lerpType||1===$t.lerpType)for($t.interpolationMethod=[],$t.interpolationMethod.length=$y,$z=0;$z<$y;$z++)$t.interpolationMethod[$z]=$Q.interpolation[$N.getUint8()];null!=$t.parent&&$t.parent.childs.push($t);var $g=$o.getUint16();0<$g&&($t.extenData=$r.slice($o.pos,$o.pos+$g),$o.pos+=$g);var $s,$V=$o.getUint16(),$m=0;for($z=0,$A=$t.keyFrame.length=$V;$z<$A;$z++){if(($s=$t.keyFrame[$z]=new $U).duration=$o.getFloat32(),$s.startTime=$m,2===$t.lerpType){$s.interpolationData=[];var $C,$R=$o.getUint8();switch($C=$o.getFloat32()){case 254:for($s.interpolationData.length=$y,$u=0;$u<$y;$u++)$s.interpolationData[$u]=0;break;case 255:for($s.interpolationData.length=$y,$u=0;$u<$y;$u++)$s.interpolationData[$u]=5;break;default:for($s.interpolationData.push($C),$Z=1;$Z<$R;$Z++)$s.interpolationData.push($o.getFloat32())}}for($s.data=new Float32Array($y),$h=0;$h<$y;$h++)$s.data[$h]=$o.getFloat32(),-1e-8<$s.data[$h]&&$s.data[$h]<1e-8&&($s.data[$h]=0);$m+=$s.duration}$s.startTime=$w.playTime,$t.playTime=$w.playTime,$J._calculateKeyFrame($t,$V,$y)}}},$J}(),$t=function(){function $K(){}return $S($K,"laya.ani.AnimationParser02"),$K.READ_DATA=function(){$K._DATA.offset=$K._reader.getUint32(),$K._DATA.size=$K._reader.getUint32()},$K.READ_BLOCK=function(){for(var $J=$K._BLOCK.count=$K._reader.getUint16(),$o=$K._BLOCK.blockStarts=[],$r=$K._BLOCK.blockLengths=[],$S=0;$S<$J;$S++)$o.push($K._reader.getUint32()),$r.push($K._reader.getUint32())},$K.READ_STRINGS=function(){var $J=$K._reader.getUint32(),$o=$K._reader.getUint16(),$r=$K._reader.pos;$K._reader.pos=$J+$K._DATA.offset;for(var $S=0;$S<$o;$S++)$K._strings[$S]=$K._reader.readUTFString();$K._reader.pos=$r},$K.parse=function($J,$o){$K._templet=$J;($K._reader=$o).__getBuffer();$K.READ_DATA(),$K.READ_BLOCK(),$K.READ_STRINGS();for(var $r=0,$S=$K._BLOCK.count;$r<$S;$r++){var $G=$o.getUint16(),$z=$K._strings[$G],$A=$K["READ_"+$z];if(null==$A)throw new Error("model file err,no this function:"+$G+" "+$z);$A.call()}},$K.READ_ANIMATIONS=function(){var $J=$K._reader,$o=$J.__getBuffer(),$r=0,$S=0,$G=0,$z=0,$A=$J.getUint16(),$h=[];for($h.length=$A,$r=0;$r<$A;$r++)$h[$r]=$Q.interpolation[$J.getByte()];var $Z=$J.getUint8();for($K._templet._anis.length=$Z,$r=0;$r<$Z;$r++){var $u=$K._templet._anis[$r]={};$u.nodes=new Array;var $B=$u.name=$K._strings[$J.getUint16()];$K._templet._aniMap[$B]=$r,$u.bone3DMap={},$u.playTime=$J.getFloat32();var $v=$u.nodes.length=$J.getInt16();for($S=$u.totalKeyframeDatasLength=0;$S<$v;$S++){var $j=$u.nodes[$S]={};$j.keyframeWidth=$A,$j.childs=[];var $Y=$J.getUint16();0<=$Y&&($j.name=$K._strings[$Y],$u.bone3DMap[$j.name]=$S),$j.keyFrame=new Array,$j.parentIndex=$J.getInt16(),-1==$j.parentIndex?$j.parent=null:$j.parent=$u.nodes[$j.parentIndex],$u.totalKeyframeDatasLength+=$A,$j.interpolationMethod=$h,null!=$j.parent&&$j.parent.childs.push($j);var $_=$J.getUint16(),$D=null,$N=null;for($G=0,$z=$j.keyFrame.length=$_;$G<$z;$G++){($D=$j.keyFrame[$G]={}).startTime=$J.getFloat32(),$N&&($N.duration=$D.startTime-$N.startTime);var $w=$K._DATA.offset,$i=$J.getUint32(),$I=4*$A,$t=$o.slice($w+$i,$w+$i+$I);$D.data=new Float32Array($t),$N=$D}$D.duration=0,$j.playTime=$u.playTime,$K._templet._calculateKeyFrame($j,$_,$A)}}},$K._templet=null,$K._reader=null,$K._strings=[],$r($K,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$K}(),$UJ=(function(){function $J(){}$S($J,"laya.ani.AnimationState"),$J.stopped=0,$J.paused=1,$J.playing=2}(),function(){function $G(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $HJ,this.resultMatrix=new $nJ,this._children=[]}$S($G,"laya.ani.bone.Bone");var $J=$G.prototype;return $J.setTempMatrix=function($J){this._tempMatrix=$J;var $o,$r=0;for($r=0,$o=this._children.length;$r<$o;$r++)this._children[$r].setTempMatrix(this._tempMatrix)},$J.update=function($J){var $o;if(this.rotation=this.transform.skX,$J)$o=this.resultTransform.getMatrix(),$nJ.mul($o,$J,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$o=this.resultTransform.getMatrix(),$nJ.mul($o,this.parentBone.resultMatrix,this.resultMatrix);else{var $r=this.parentBone,$S=NaN,$G=NaN,$z=NaN,$A=this.parentBone.resultMatrix;$o=this.resultTransform.getMatrix();var $h=$A.a*$o.tx+$A.c*$o.ty+$A.tx,$Z=$A.b*$o.tx+$A.d*$o.ty+$A.ty,$u=new $nJ;this.inheritRotation?($S=Math.atan2($r.resultMatrix.b,$r.resultMatrix.a),$G=Math.cos($S),$z=Math.sin($S),$u.setTo($G,$z,-$z,$G,0,0),$nJ.mul(this._tempMatrix,$u,$nJ.TEMP),$nJ.TEMP.copyTo($u),$o=this.resultTransform.getMatrix(),$nJ.mul($o,$u,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$o=this.resultTransform.getMatrix(),$nJ.TEMP.identity(),$nJ.TEMP.d=this.d,$nJ.mul($o,$nJ.TEMP,this.resultMatrix)),this.resultMatrix.tx=$h,this.resultMatrix.ty=$Z}else($o=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $B,$v=0;for($v=0,$B=this._children.length;$v<$B;$v++)this._children[$v].update()},$J.updateChild=function(){var $J,$o=0;for($o=0,$J=this._children.length;$o<$J;$o++)this._children[$o].update()},$J.setRotation=function($J){this._sprite&&(this._sprite.rotation=180*$J/Math.PI)},$J.updateDraw=function($J,$o){$G.ShowBones&&!$G.ShowBones[this.name]||(this._sprite||(this._sprite=new $zJ,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$GJ.stage.addChild(this._sprite)),this._sprite.x=$J+this.resultMatrix.tx,this._sprite.y=$o+this.resultMatrix.ty);var $r,$S=0;for($S=0,$r=this._children.length;$S<$r;$S++)this._children[$S].updateDraw($J,$o)},$J.addChild=function($J){this._children.push($J),$J.parentBone=this},$J.findBone=function($J){if(this.name==$J)return this;var $o,$r,$S=0;for($S=0,$o=this._children.length;$S<$o;$S++)if($r=this._children[$S].findBone($J))return $r;return null},$J.localToWorld=function($J){var $o=$J[0],$r=$J[1];$J[0]=$o*this.resultMatrix.a+$r*this.resultMatrix.c+this.resultMatrix.tx,$J[1]=$o*this.resultMatrix.b+$r*this.resultMatrix.d+this.resultMatrix.ty},$G.ShowBones={},$G}()),$LJ=function(){function $D(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$S($D,"laya.ani.bone.BoneSlot");var $J=$D.prototype;return $J.showSlotData=function($J,$o){void 0===$o&&($o=!0),this.currSlotData=$J,$o&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$J.showDisplayByName=function($J){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($J))},$J.replaceDisplayByName=function($J,$o){if(this.currSlotData){var $r;$r=this.currSlotData.getDisplayByName($J);var $S;$S=this.currSlotData.getDisplayByName($o),this.replaceDisplayByIndex($r,$S)}},$J.replaceDisplayByIndex=function($J,$o){this.currSlotData&&(this._replaceDic[$J]=$o,this.displayIndex==$J&&this.showDisplayByIndex($J))},$J.showDisplayByIndex=function($J){if(null!=this._replaceDic[$J]&&($J=this._replaceDic[$J]),this.currSlotData&&-1<$J&&$J<this.currSlotData.displayArr.length){if(this.displayIndex=$J,this.currDisplayData=this.currSlotData.displayArr[$J],this.currDisplayData){var $o=this.currDisplayData.name;this.currTexture=this.templet.getTexture($o),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$N.isConchApp||$N.isConchApp&&"0.9.15"<$zJ.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$J.replaceSkin=function($J){this._diyTexture=$J,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$J.setParentMatrix=function($J){this._parentMatrix=$J},$J.draw=function($J,$o,$r,$S){if(void 0===$r&&($r=!1),void 0===$S&&($S=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $G,$z=this.currTexture;switch(this._diyTexture&&($z=this._diyTexture),this.currDisplayData.type){case 0:if($J){var $A=this.getDisplayMatrix();if(this._parentMatrix){var $h=!1;if($A){var $Z;if($nJ.mul($A,this._parentMatrix,$nJ.TEMP),$Z=$r?(null==this._resultMatrix&&(this._resultMatrix=new $nJ),this._resultMatrix):new $nJ,!$N.isWebGL&&this.currDisplayData.uvs||$N.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $u=$D._tempMatrix;$u.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($u.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($h=!0,$u.rotate(-Math.PI/2)),$nJ.mul($u,$nJ.TEMP,$Z)}else $nJ.TEMP.copyTo($Z);$h?$J.drawTexture($z,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$Z):$J.drawTexture($z,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$Z)}}}break;case 1:if(null==($G=$r?(null==this._skinSprite&&(this._skinSprite=$D.createSkinMesh()),this._skinSprite):$D.createSkinMesh()))return;var $B;if(null==this.currDisplayData.bones){var $v,$j=this.currDisplayData.weights;this.deformData&&($j=this.deformData),$v=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$j;this.currDisplayData.triangles.length;$B=this.currDisplayData.triangles,$G.init2($z,null,$B,this._mVerticleArr,$v);var $Y,$_=this.getDisplayMatrix();if(this._parentMatrix)if($_)$nJ.mul($_,this._parentMatrix,$nJ.TEMP),$Y=$r?(null==this._resultMatrix&&(this._resultMatrix=new $nJ),this._resultMatrix):new $nJ,$nJ.TEMP.copyTo($Y),$G.transform=$Y}else this.skinMesh($o,$G,$S);$J.drawSkin($G);break;case 2:if(null==($G=$r?(null==this._skinSprite&&(this._skinSprite=$D.createSkinMesh()),this._skinSprite):$D.createSkinMesh()))return;this.skinMesh($o,$G,$S),$J.drawSkin($G)}}},$J.skinMesh=function($J,$o,$r){var $S,$G=this.currTexture,$z=this.currDisplayData.bones;$S=this._diyTexture?($G=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $A,$h,$Z=this.currDisplayData.weights,$u=this.currDisplayData.triangles,$B=0,$v=0,$j=0,$Y=NaN,$_=NaN,$D=0,$N=0,$w=[],$i=0,$I=0;if(this.deformData&&0<this.deformData.length){var $t=0;for($i=0,$I=$z.length;$i<$I;){for($j=$z[$i++]+$i,$v=$B=0;$i<$j;$i++)$h=$J[$z[$i]],$Y=$Z[$D]+this.deformData[$t++],$_=$Z[$D+1]+this.deformData[$t++],$N=$Z[$D+2],$B+=($Y*$h.a+$_*$h.c+$h.tx)*$N,$v+=($Y*$h.b+$_*$h.d+$h.ty)*$N,$D+=3;$w.push($B,$v)}}else for($i=0,$I=$z.length;$i<$I;){for($j=$z[$i++]+$i,$v=$B=0;$i<$j;$i++)$h=$J[$z[$i]],$Y=$Z[$D],$_=$Z[$D+1],$N=$Z[$D+2],$B+=($Y*$h.a+$_*$h.c+$h.tx)*$N,$v+=($Y*$h.b+$_*$h.d+$h.ty)*$N,$D+=3;$w.push($B,$v)}this._mVerticleArr=$w,$A=$u,$o.init2($G,null,$A,this._mVerticleArr,$S)},$J.drawBonePoint=function($J){$J&&this._parentMatrix&&$J.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$J.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$J.getMatrix=function(){return this._resultMatrix},$J.copy=function(){var $J=new $D;return $J.type="copy",$J.name=this.name,$J.attachmentName=this.attachmentName,$J.srcDisplayIndex=this.srcDisplayIndex,$J.parent=this.parent,$J.displayIndex=this.displayIndex,$J.templet=this.templet,$J.currSlotData=this.currSlotData,$J.currTexture=this.currTexture,$J.currDisplayData=this.currDisplayData,$J},$D.createSkinMesh=function(){return $N.isWebGL||$N.isConchApp?$Y.skinAniSprite():($N.isWebGL,null)},$r($D,["_tempMatrix",function(){return this._tempMatrix=new $nJ}]),$D}(),$QJ=function(){function $J(){this.skinName=null,this.deformSlotDataList=[]}return $S($J,"laya.ani.bone.DeformAniData"),$J}(),$pJ=function(){function $J(){this.deformSlotDisplayList=[]}return $S($J,"laya.ani.bone.DeformSlotData"),$J}(),$fJ=function(){function $J(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$S($J,"laya.ani.bone.DeformSlotDisplayData");var $o=$J.prototype;return $o.binarySearch1=function($J,$o){var $r=0,$S=$J.length-2;if(0==$S)return 1;for(var $G=$S>>>1;;){if($J[Math.floor($G+1)]<=$o?$r=$G+1:$S=$G,$r==$S)return $r+1;$G=$r+$S>>>1}return 0},$o.apply=function($J,$o,$r){if(void 0===$r&&($r=1),$J+=.05,!(this.timeList.length<=0)){var $S=0;if(!($J<this.timeList[0])){var $G=this.vectices[0].length,$z=[],$A=this.binarySearch1(this.timeList,$J);if(this.frameIndex=$A,$J>=this.timeList[this.timeList.length-1]){var $h=this.vectices[this.vectices.length-1];if($r<1)for($S=0;$S<$G;$S++)$z[$S]+=($h[$S]-$z[$S])*$r;else for($S=0;$S<$G;$S++)$z[$S]=$h[$S];this.deformData=$z}else{this.tweenKeyList[this.frameIndex];var $Z=this.vectices[this.frameIndex-1],$u=this.vectices[this.frameIndex],$B=this.timeList[this.frameIndex-1],$v=this.timeList[this.frameIndex];$r=this.tweenKeyList[$A-1]?($J-$B)/($v-$B):0;var $j=NaN;for($S=0;$S<$G;$S++)$j=$Z[$S],$z[$S]=$j+($u[$S]-$j)*$r;this.deformData=$z}}}},$J}(),$FJ=function(){function $J(){this.time=NaN,this.drawOrder=[]}return $S($J,"laya.ani.bone.DrawOrderData"),$J}(),$dJ=function(){function $J(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $S($J,"laya.ani.bone.EventData"),$J}(),$i=function(){function $SJ($J,$o){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$J,this._targetBone=$o[$J.targetBoneIndex],this.isSpine=$J.isSpine,null==this._bones&&(this._bones=[]);for(var $r=this._bones.length=0,$S=$J.boneIndexs.length;$r<$S;$r++)this._bones.push($o[$J.boneIndexs[$r]]);this.name=$J.name,this.mix=$J.mix,this.bendDirection=$J.bendDirection}$S($SJ,"laya.ani.bone.IkConstraint");var $J=$SJ.prototype;return $J.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$J._applyIk1=function($J,$o,$r,$S){var $G=$J.parentBone,$z=1/($G.resultMatrix.a*$G.resultMatrix.d-$G.resultMatrix.b*$G.resultMatrix.c),$A=$o-$G.resultMatrix.tx,$h=$r-$G.resultMatrix.ty,$Z=($A*$G.resultMatrix.d-$h*$G.resultMatrix.c)*$z-$J.transform.x,$u=($h*$G.resultMatrix.a-$A*$G.resultMatrix.b)*$z-$J.transform.y,$B=Math.atan2($u,$Z)*$SJ.radDeg-0-$J.transform.skX;$J.transform.scX<0&&($B+=180),180<$B?$B-=360:$B<-180&&($B+=360),$J.transform.skX=$J.transform.skY=$J.transform.skX+$B*$S,$J.update()},$J.updatePos=function($J,$o){this._sp&&this._sp.pos($J,$o)},$J._applyIk2=function($J,$o,$r,$S,$G,$z){if(0!=$z){var $A=$J.resultTransform.x,$h=$J.resultTransform.y,$Z=$J.transform.scX,$u=$J.transform.scY,$B=$o.transform.scX,$v=0,$j=0,$Y=0;$Y=$Z<0?($Z=-$Z,$v=180,-1):($v=0,1),$u<0&&($u=-$u,$Y=-$Y),$j=$B<0?($B=-$B,180):0;var $_=$o.resultTransform.x,$D=NaN,$N=NaN,$w=NaN,$i=$J.resultMatrix.a,$I=$J.resultMatrix.c,$t=$J.resultMatrix.b,$K=$J.resultMatrix.d,$e=Math.abs($Z-$u)<=1e-4;$w=$e?($N=$i*$_+$I*($D=$o.resultTransform.y)+$J.resultMatrix.tx,$t*$_+$K*$D+$J.resultMatrix.ty):($D=0,$N=$i*$_+$J.resultMatrix.tx,$t*$_+$J.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $zJ,$GJ.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($r,$S,15,"#ffff00"),this._sp.graphics.drawCircle($N,$w,15,"#ff00ff")),$J.setRotation(Math.atan2($w-$J.resultMatrix.ty,$N-$J.resultMatrix.tx));var $y=$J.parentBone;$i=$y.resultMatrix.a,$I=$y.resultMatrix.c,$t=$y.resultMatrix.b;var $g=1/($i*($K=$y.resultMatrix.d)-$I*$t),$s=$r-$y.resultMatrix.tx,$V=$S-$y.resultMatrix.ty,$m=($s*$K-$V*$I)*$g-$A,$C=($V*$i-$s*$t)*$g-$h,$R=(($s=$N-$y.resultMatrix.tx)*$K-($V=$w-$y.resultMatrix.ty)*$I)*$g-$A,$n=($V*$i-$s*$t)*$g-$h,$k=Math.sqrt($R*$R+$n*$n),$U=$o.length*$B,$L=NaN,$Q=NaN;if($e){var $p=($m*$m+$C*$C-$k*$k-($U*=$Z)*$U)/(2*$k*$U);$p<-1?$p=-1:1<$p&&($p=1),$Q=Math.acos($p)*$G,$i=$k+$U*$p,$I=$U*Math.sin($Q),$L=Math.atan2($C*$i-$m*$I,$m*$i+$C*$I)}else{var $f=($i=$Z*$U)*$i,$F=($I=$u*$U)*$I,$d=$m*$m+$C*$C,$l=Math.atan2($C,$m),$c=-2*$F*$k,$T=$F-$f;if(0<($K=$c*$c-4*$T*($t=$F*$k*$k+$f*$d-$f*$F))){var $b=Math.sqrt($K);$c<0&&($b=-$b);var $$=($b=-($c+$b)/2)/$T,$q=$t/$b,$H=Math.abs($$)<Math.abs($q)?$$:$q;$H*$H<=$d&&($V=Math.sqrt($d-$H*$H)*$G,$L=$l-Math.atan2($V,$H),$Q=Math.atan2($V/$u,($H-$k)/$Z))}var $a=0,$x=Number.MAX_VALUE,$M=0,$O=0,$P=0,$W=0,$E=0,$X=0;$W<($K=($s=$k+$i)*$s)&&($P=0,$W=$K,$E=$s),($K=($s=$k-$i)*$s)<$x&&($a=Math.PI,$x=$K,$M=$s);var $JJ=Math.acos(-$i*$k/($f-$F));($K=($s=$i*Math.cos($JJ)+$k)*$s+($V=$I*Math.sin($JJ))*$V)<$x&&($a=$JJ,$x=$K,$M=$s,$O=$V),$W<$K&&($P=$JJ,$W=$K,$E=$s,$X=$V),$Q=$d<=($x+$W)/2?($L=$l-Math.atan2($O*$G,$M),$a*$G):($L=$l-Math.atan2($X*$G,$E),$P*$G)}var $oJ=Math.atan2($D,$_)*$Y,$rJ=$J.resultTransform.skX;180<($L=($L-$oJ)*$SJ.radDeg+$v-$rJ)?$L-=360:$L<-180&&($L+=360),$J.resultTransform.x=$A,$J.resultTransform.y=$h,$J.resultTransform.skX=$J.resultTransform.skY=$rJ+$L*$z,$rJ=$o.resultTransform.skX,180<($Q=(($Q+$oJ)*$SJ.radDeg-0)*$Y+$j-($rJ%=360))?$Q-=360:$Q<-180&&($Q+=360),$o.resultTransform.x=$_,$o.resultTransform.y=$D,$o.resultTransform.skX=$o.resultTransform.skY=$o.resultTransform.skY+$Q*$z,$J.update()}},$J._applyIk3=function($J,$o,$r,$S,$G,$z){if(0!=$z){var $A,$h,$Z=$o.resultMatrix.a*$o.length,$u=$o.resultMatrix.b*$o.length,$B=$Z*$Z+$u*$u,$v=Math.sqrt($B),$j=$J.resultMatrix.tx,$Y=$J.resultMatrix.ty,$_=$o.resultMatrix.tx,$D=$o.resultMatrix.ty,$N=$_-$j,$w=$D-$Y,$i=$N*$N+$w*$w,$I=Math.sqrt($i),$t=($N=$r-$J.resultMatrix.tx)*$N+($w=$S-$J.resultMatrix.ty)*$w,$K=Math.sqrt($t);if($v+$I<=$K||$K+$v<=$I||$K+$I<=$v){var $e=NaN;$_=$j+($e=$v+$I<=$K?1:-1)*($r-$j)*$I/$K,$D=$Y+$e*($S-$Y)*$I/$K}else{var $y=($i-$B+$t)/(2*$t),$g=Math.sqrt($i-$y*$y*$t)/$K,$s=$j+$N*$y,$V=$Y+$w*$y,$m=-$w*$g,$C=$N*$g;$D=0<$G?($_=$s-$m,$V-$C):($_=$s+$m,$V+$C)}$A=$_,$h=$D,this.isDebug&&(this._sp||(this._sp=new $zJ,$GJ.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($j,$Y,15,"#ff00ff"),this._sp.graphics.drawCircle($r,$S,15,"#ffff00"),this._sp.graphics.drawCircle($A,$h,15,"#ff00ff"));var $R,$n;$R=Math.atan2($h-$J.resultMatrix.ty,$A-$J.resultMatrix.tx),$J.setRotation($R),($n=$SJ._tempMatrix).identity(),$n.rotate($R),$n.scale($J.resultMatrix.getScaleX(),$J.resultMatrix.getScaleY()),$n.translate($J.resultMatrix.tx,$J.resultMatrix.ty),$n.copyTo($J.resultMatrix),$J.updateChild();var $k,$U;$k=Math.atan2($S-$h,$r-$A),$o.setRotation($k),($U=$SJ._tempMatrix).identity(),$U.rotate($k),$U.scale($o.resultMatrix.getScaleX(),$o.resultMatrix.getScaleY()),$U.translate($A,$h),$n.copyTo($o.resultMatrix),$o.updateChild()}},$r($SJ,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $nJ}]),$SJ}(),$lJ=function(){function $J(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $S($J,"laya.ani.bone.IkConstraintData"),$J}(),$K=function(){function $U($J,$o){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$J,this.position=$J.position,this.spacing=$J.spacing,this.rotateMix=$J.rotateMix,this.translateMix=$J.translateMix,this.bones=[];for(var $r=this.data.bones,$S=0,$G=$r.length;$S<$G;$S++)this.bones.push($o[$r[$S]])}$S($U,"laya.ani.bone.PathConstraint");var $J=$U.prototype;return $J.apply=function($J,$o){if(this.target){var $r=this.translateMix,$S=this.translateMix,$G=0<$S,$z=this.data.spacingMode,$A="length"==$z,$h=this.data.rotateMode,$Z="tangent"==$h,$u="chainScale"==$h,$B=[],$v=this.bones.length,$j=$Z?$v:$v+1,$Y=[];(this._spaces=$Y)[0]=this.position;var $_=this.spacing;if($u||$A)for(var $D=0,$N=$j-1;$D<$N;){var $w=this.bones[$D],$i=$w.length,$I=$i*$w.resultMatrix.a,$t=$i*$w.resultMatrix.b;$i=Math.sqrt($I*$I+$t*$t),$u&&($B[$D]=$i),$Y[++$D]=$A?Math.max(0,$i+$_):$_}else for($D=1;$D<$j;$D++)$Y[$D]=$_;var $K=this.computeWorldPositions(this.target,$J,$o,$j,$Z,"percent"==this.data.positionMode,"percent"==$z);if(this._debugKey){for($D=0;$D<$K.length;$D++)$o.drawCircle($K[$D++],$K[$D++],5,"#00ff00");var $e=[];for($D=0;$D<$K.length;$D++)$e.push($K[$D++],$K[$D++]);$o.drawLines(0,0,$e,"#ff0000")}var $y=$K[0],$g=$K[1],$s=this.data.offsetRotation,$V="chain"==$h&&0==$s,$m=NaN;for($D=0,$m=3;$D<$v;$D++,$m+=3){($w=this.bones[$D]).resultMatrix.tx+=($y-$w.resultMatrix.tx)*$r,$w.resultMatrix.ty+=($g-$w.resultMatrix.ty)*$r;var $C=($I=$K[$m])-$y,$R=($t=$K[$m+1])-$g;if($u&&0!=($i=$B[$D])){var $n=(Math.sqrt($C*$C+$R*$R)/$i-1)*$S+1;$w.resultMatrix.a*=$n,$w.resultMatrix.c*=$n}if($y=$I,$g=$t,$G){var $k=$w.resultMatrix.a,$U=$w.resultMatrix.c,$L=$w.resultMatrix.b,$Q=$w.resultMatrix.d,$p=NaN,$f=NaN,$F=NaN;$p=$Z?$K[$m-1]:0==$Y[$D+1]?$K[$m+2]:Math.atan2($R,$C),$p-=Math.atan2($L,$k)-$s/180*Math.PI,$V&&($f=Math.cos($p),$F=Math.sin($p),$y+=(($i=$w.length)*($f*$k-$F*$L)-$C)*$S,$g+=($i*($F*$k+$f*$L)-$R)*$S),$p>Math.PI?$p-=2*Math.PI:$p<-Math.PI&&($p+=2*Math.PI),$p*=$S,$f=Math.cos($p),$F=Math.sin($p),$w.resultMatrix.a=$f*$k-$F*$L,$w.resultMatrix.c=$f*$U-$F*$Q,$w.resultMatrix.b=$F*$k+$f*$L,$w.resultMatrix.d=$F*$U+$f*$Q}}}},$J.computeWorldVertices2=function($J,$o,$r,$S,$G,$z){var $A,$h,$Z=$J.currDisplayData.bones,$u=$J.currDisplayData.weights,$B=$J.currDisplayData.triangles,$v=0,$j=0,$Y=0,$_=0,$D=0,$N=0,$w=0,$i=0,$I=0,$t=0,$K=0;if(null!=$Z){for($v=0;$v<$r;$v+=2)$j+=($_=$Z[$j])+1,$Y+=$_;var $e=$o;for($D=$z,$N=3*$Y;$D<$S;$D+=2){for($i=$w=0,$_=$Z[$j++],$_+=$j;$j<$_;$j++,$N+=3){$A=$e[$Z[$j]].resultMatrix,$I=$u[$N],$t=$u[$N+1];var $y=$u[$N+2];$w+=($I*$A.a+$t*$A.c+$A.tx)*$y,$i+=($I*$A.b+$t*$A.d+$A.ty)*$y}$G[$D]=$w,$G[$D+1]=$i}}else{var $g,$s;if($B||($B=$u),$J.deformData&&($B=$J.deformData),$g=$J.parent,$o)for($K=$o.length,$v=0;$v<$K;$v++)if($o[$v].name==$g){$h=$o[$v];break}$h&&($s=$h.resultMatrix),$s||($s=$U._tempMt);var $V=$s.tx,$m=$s.ty,$C=$s.a,$R=$s.b,$n=$s.c,$k=$s.d;for($h&&($k*=$h.d),$j=$r,$D=$z;$D<$S;$j+=2,$D+=2)$I=$B[$j],$t=$B[$j+1],$G[$D]=$I*$C+$t*$R+$V,$G[$D+1]=-($I*$n+$t*$k+$m)}},$J.computeWorldPositions=function($J,$o,$r,$S,$G,$z,$A){$J.currDisplayData.bones,$J.currDisplayData.weights,$J.currDisplayData.triangles;var $h=[],$Z=0,$u=$J.currDisplayData.verLen,$B=this.position,$v=this._spaces,$j=[],$Y=[],$_=$u/6,$D=-1,$N=NaN,$w=0,$i=0,$I=NaN,$t=NaN,$K=NaN,$e=NaN;if($_--,$u-=4,this.computeWorldVertices2($J,$o,2,$u,$h,0),this._debugKey)for($Z=0;$Z<$h.length;)$r.drawCircle($h[$Z++],$h[$Z++],10,"#ff0000");$j=$h,this._curves.length=$_;var $y=this._curves,$g=$j[$N=0],$s=$j[1],$V=0,$m=0,$C=0,$R=0,$n=0,$k=0,$U=NaN,$L=NaN,$Q=NaN,$p=NaN,$f=NaN,$F=NaN,$d=NaN,$l=NaN,$c=0;for($Z=0,$c=2;$Z<$_;$Z++,$c+=6)$V=$j[$c],$m=$j[$c+1],$C=$j[$c+2],$R=$j[$c+3],$f=2*($U=.1875*($g-2*$V+$C))+($Q=.09375*(3*($V-$C)-$g+($n=$j[$c+4]))),$F=2*($L=.1875*($s-2*$m+$R))+($p=.09375*(3*($m-$R)-$s+($k=$j[$c+5]))),$d=.75*($V-$g)+$U+.16666667*$Q,$l=.75*($m-$s)+$L+.16666667*$p,$N+=Math.sqrt($d*$d+$l*$l),$d+=$f,$l+=$F,$f+=$Q,$F+=$p,$N+=Math.sqrt($d*$d+$l*$l),$d+=$f,$l+=$F,$N+=Math.sqrt($d*$d+$l*$l),$d+=$f+$Q,$l+=$F+$p,$N+=Math.sqrt($d*$d+$l*$l),$y[$Z]=$N,$g=$n,$s=$k;if($z&&($B*=$N),$A)for($Z=0;$Z<$S;$Z++)$v[$Z]*=$N;var $T=this._segments,$b=0,$$=0;for($$=$i=$w=$Z=0;$Z<$S;$Z++,$w+=3)if(($I=$B+=$t=$v[$Z])<0)this.addBeforePosition($I,$j,0,$Y,$w);else if($N<$I)this.addAfterPosition($I-$N,$j,$u-4,$Y,$w);else{for(;;$i++)if(!(($e=$y[$i])<$I)){0==$i?$I/=$e:$I=($I-($K=$y[$i-1]))/($e-$K);break}if($i!=$D){var $q=6*($D=$i);for($g=$j[$q],$s=$j[$q+1],$V=$j[$q+2],$m=$j[$q+3],$C=$j[$q+4],$R=$j[$q+5],$f=2*($U=.03*($g-2*$V+$C))+($Q=.006*(3*($V-$C)-$g+($n=$j[$q+6]))),$F=2*($L=.03*($s-2*$m+$R))+($p=.006*(3*($m-$R)-$s+($k=$j[$q+7]))),$d=.3*($V-$g)+$U+.16666667*$Q,$l=.3*($m-$s)+$L+.16666667*$p,$b=Math.sqrt($d*$d+$l*$l),$T[0]=$b,$q=1;$q<8;$q++)$d+=$f,$l+=$F,$f+=$Q,$F+=$p,$b+=Math.sqrt($d*$d+$l*$l),$T[$q]=$b;$d+=$f,$l+=$F,$b+=Math.sqrt($d*$d+$l*$l),$T[8]=$b,$d+=$f+$Q,$l+=$F+$p,$b+=Math.sqrt($d*$d+$l*$l),$T[9]=$b,$$=0}for($I*=$b;;$$++)if(!(($e=$T[$$])<$I)){0==$$?$I/=$e:$I=$$+($I-($K=$T[$$-1]))/($e-$K);break}this.addCurvePosition(.1*$I,$g,$s,$V,$m,$C,$R,$n,$k,$Y,$w,$G||0<$Z&&0==$t)}return $Y},$J.addBeforePosition=function($J,$o,$r,$S,$G){var $z=$o[$r],$A=$o[$r+1],$h=$o[$r+2]-$z,$Z=$o[$r+3]-$A,$u=Math.atan2($Z,$h);$S[$G]=$z+$J*Math.cos($u),$S[$G+1]=$A+$J*Math.sin($u),$S[$G+2]=$u},$J.addAfterPosition=function($J,$o,$r,$S,$G){var $z=$o[$r+2],$A=$o[$r+3],$h=$z-$o[$r],$Z=$A-$o[$r+1],$u=Math.atan2($Z,$h);$S[$G]=$z+$J*Math.cos($u),$S[$G+1]=$A+$J*Math.sin($u),$S[$G+2]=$u},$J.addCurvePosition=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B,$v){0==$J&&($J=1e-4);var $j=$J*$J,$Y=$j*$J,$_=1-$J,$D=$_*$_,$N=$D*$_,$w=$_*$J,$i=3*$w,$I=$_*$i,$t=$i*$J,$K=$o*$N+$S*$I+$z*$t+$h*$Y,$e=$r*$N+$G*$I+$A*$t+$Z*$Y;$u[$B]=$K,$u[$B+1]=$e,$u[$B+2]=$v?Math.atan2($e-($r*$D+$G*$w*2+$A*$j),$K-($o*$D+$S*$w*2+$z*$j)):0},$U.NONE=-1,$U.BEFORE=-2,$U.AFTER=-3,$r($U,["_tempMt",function(){return this._tempMt=new $nJ}]),$U}(),$cJ=function(){function $J(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $S($J,"laya.ani.bone.PathConstraintData"),$J}(),$TJ=function(){function $J(){this.name=null,this.slotArr=[]}return $S($J,"laya.ani.bone.SkinData"),$J}(),$bJ=function(){function $J(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$S($J,"laya.ani.bone.SkinSlotDisplayData");var $o=$J.prototype;return $o.createTexture=function($J){return this.texture||(this.texture=new $kJ($J.bitmap,this.uvs),$J.bitmap.alphaTexture&&(this.texture.alphaTexture=new $kJ($J.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$J.height,this.texture.height=$J.width,this.texture.offsetX=-$J.offsetX,this.texture.offsetY=-$J.offsetY,this.texture.sourceWidth=$J.sourceHeight,this.texture.sourceHeight=$J.sourceWidth):(this.texture.width=$J.width,this.texture.height=$J.height,this.texture.offsetX=-$J.offsetX,this.texture.offsetY=-$J.offsetY,this.texture.sourceWidth=$J.sourceWidth,this.texture.sourceHeight=$J.sourceHeight),$N.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$o.destory=function(){this.texture&&this.texture.destroy()},$J}(),$$J=function(){function $J(){this.name=null,this.displayArr=[]}return $S($J,"laya.ani.bone.SlotData"),$J.prototype.getDisplayByName=function($J){for(var $o=0,$r=this.displayArr.length;$o<$r;$o++)if(this.displayArr[$o].attachmentName==$J)return $o;return-1},$J}(),$e=function(){function $J($J,$o){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$D(2,0),this._data=$J,null==this._bones&&(this._bones=[]),this.target=$o[$J.targetIndex];var $r,$S=0;for($S=0,$r=$J.boneIndexs.length;$S<$r;$S++)this._bones.push($o[$J.boneIndexs[$S]]);this.rotateMix=$J.rotateMix,this.translateMix=$J.translateMix,this.scaleMix=$J.scaleMix,this.shearMix=$J.shearMix}return $S($J,"laya.ani.bone.TfConstraint"),$J.prototype.apply=function(){for(var $J,$o=this.target.resultMatrix.a,$r=this.target.resultMatrix.b,$S=this.target.resultMatrix.c,$G=this.target.resultMatrix.d,$z=0,$A=this._bones.length;$z<$A;$z++){if($J=this._bones[$z],0<this.rotateMix){var $h=$J.resultMatrix.a,$Z=$J.resultMatrix.b,$u=$J.resultMatrix.c,$B=$J.resultMatrix.d,$v=Math.atan2($S,$o)-Math.atan2($u,$h)+this._data.offsetRotation*Math.PI/180;$v>Math.PI?$v-=2*Math.PI:$v<-Math.PI&&($v+=2*Math.PI),$v*=this.rotateMix;var $j=Math.cos($v),$Y=Math.sin($v);$J.resultMatrix.a=$j*$h-$Y*$u,$J.resultMatrix.b=$j*$Z-$Y*$B,$J.resultMatrix.c=$Y*$h+$j*$u,$J.resultMatrix.d=$Y*$Z+$j*$B}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$J.resultMatrix.tx+=(this._temp[0]-$J.resultMatrix.tx)*this.translateMix,$J.resultMatrix.ty+=(this._temp[1]-$J.resultMatrix.ty)*this.translateMix,$J.updateChild()),0<this.scaleMix){var $_=Math.sqrt($J.resultMatrix.a*$J.resultMatrix.a+$J.resultMatrix.c*$J.resultMatrix.c),$D=Math.sqrt($o*$o+$S*$S),$N=1e-5<$_?($_+($D-$_+this._data.offsetScaleX)*this.scaleMix)/$_:0;$J.resultMatrix.a*=$N,$J.resultMatrix.c*=$N,$_=Math.sqrt($J.resultMatrix.b*$J.resultMatrix.b+$J.resultMatrix.d*$J.resultMatrix.d),$D=Math.sqrt($r*$r+$G*$G),$N=1e-5<$_?($_+($D-$_+this._data.offsetScaleY)*this.scaleMix)/$_:0,$J.resultMatrix.b*=$N,$J.resultMatrix.d*=$N}if(0<this.shearMix){$Z=$J.resultMatrix.b,$B=$J.resultMatrix.d;var $w=Math.atan2($B,$Z);($v=Math.atan2($G,$r)-Math.atan2($S,$o)-($w-Math.atan2($J.resultMatrix.c,$J.resultMatrix.a)))>Math.PI?$v-=2*Math.PI:$v<-Math.PI&&($v+=2*Math.PI),$v=$w+($v+this._data.offsetShearY*Math.PI/180)*this.shearMix,$N=Math.sqrt($Z*$Z+$B*$B),$J.resultMatrix.b=Math.cos($v)*$N,$J.resultMatrix.d=Math.sin($v)*$N}}},$J}(),$qJ=function(){function $J(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $S($J,"laya.ani.bone.TfConstraintData"),$J}(),$HJ=function(){function $J(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$S($J,"laya.ani.bone.Transform");var $o=$J.prototype;return $o.initData=function($J){null!=$J.x&&(this.x=$J.x),null!=$J.y&&(this.y=$J.y),null!=$J.skX&&(this.skX=$J.skX),null!=$J.skY&&(this.skY=$J.skY),null!=$J.scX&&(this.scX=$J.scX),null!=$J.scY&&(this.scY=$J.scY)},$o.getMatrix=function(){var $J;return($J=this.mMatrix?this.mMatrix:this.mMatrix=new $nJ).identity(),$J.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($J,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$J.rotate(this.skX*Math.PI/180),$J.translate(this.x,this.y),$J},$o.skew=function($J,$o,$r){var $S=Math.sin($r),$G=Math.cos($r),$z=Math.sin($o),$A=Math.cos($o);return $J.setTo($J.a*$A-$J.b*$S,$J.a*$z+$J.b*$G,$J.c*$A-$J.d*$S,$J.c*$z+$J.d*$G,$J.tx*$A-$J.ty*$S,$J.tx*$z+$J.ty*$G),$J},$J}(),$y=function(){function $J(){}return $S($J,"laya.ani.bone.UVTools"),$J.getRelativeUV=function($J,$o,$r){var $S=$J[0],$G=$J[2]-$J[0],$z=$J[1],$A=$J[5]-$J[1];$r||($r=[]),$r.length=$o.length;var $h,$Z=0;$h=$r.length;var $u=1/$G,$B=1/$A;for($Z=0;$Z<$h;$Z+=2)$r[$Z]=($o[$Z]-$S)*$u,$r[$Z+1]=($o[$Z+1]-$z)*$B;return $r},$J.getAbsoluteUV=function($J,$o,$r){if(0==$J[0]&&0==$J[1]&&1==$J[4]&&1==$J[5])return $r?($w.copyArray($r,$o),$r):$o;var $S=$J[0],$G=$J[2]-$J[0],$z=$J[1],$A=$J[5]-$J[1];$r||($r=[]),$r.length=$o.length;var $h,$Z=0;for($h=$r.length,$Z=0;$Z<$h;$Z+=2)$r[$Z]=$o[$Z]*$G+$S,$r[$Z+1]=$o[$Z+1]*$A+$z;return $r},$J}(),$U=function(){function $J(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $S($J,"laya.ani.KeyFramesContent"),$J}(),$g=function(){function $B(){}return $S($B,"laya.ani.math.BezierLerp"),$B.getBezierRate=function($J,$o,$r,$S,$G){var $z=$B._getBezierParamKey($o,$r,$S,$G),$A=100*$z+$J;if($B._bezierResultCache[$A])return $B._bezierResultCache[$A];var $h,$Z=$B._getBezierPoints($o,$r,$S,$G,$z),$u=0;for($h=$Z.length,$u=0;$u<$h;$u+=2)if($J<=$Z[$u])return $B._bezierResultCache[$A]=$Z[$u+1],$Z[$u+1];return $B._bezierResultCache[$A]=1},$B._getBezierParamKey=function($J,$o,$r,$S){return 100*(100*(100*(100*$J+$o)+$r)+$S)},$B._getBezierPoints=function($J,$o,$r,$S,$G){return $B._bezierPointsCache[$G]?$B._bezierPointsCache[$G]:($z=[0,0,$J,$o,$r,$S,1,1],$A=(new $h).getBezierPoints($z,100,3),$B._bezierPointsCache[$G]=$A);var $z,$A},$B._bezierResultCache={},$B._bezierPointsCache={},$B}(),$s=function($J){function $o(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$o.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$S($o,"laya.ani.AnimationPlayer",$G);var $r=$o.prototype;return $GJ.imps($r,{"laya.resource.IDestroy":!0}),$r._onTempletLoadedComputeFullKeyframeIndices=function($J,$o,$r){this._templet===$r&&this._cachePlayRate===$J&&this._cacheFrameRate===$o&&this._computeFullKeyframeIndices()},$r._computeFullKeyframeIndices=function(){for(var $J=this._fullFrames=[],$o=this._templet,$r=this._cacheFrameRateInterval*this._cachePlayRate,$S=0,$G=$o.getAnimationCount();$S<$G;$S++){for(var $z=[],$A=0,$h=$o.getAnimation($S).nodes.length;$A<$h;$A++){for(var $Z=$o.getAnimation($S).nodes[$A],$u=Math.floor($Z.playTime/$r+.01),$B=new Uint16Array($u+1),$v=-1,$j=0,$Y=$Z.keyFrame.length;$j<$Y;$j++){var $_=$Z.keyFrame[$j],$D=$_.startTime,$N=$D+$_.duration+$r;do{for(var $w=Math.floor($D/$r+.5),$i=$v+1;$i<$w;$i++)$B[$i]=$j;$B[$v=$w]=$j,$D+=$r}while($D<=$N)}$z.push($B)}$J.push($z)}},$r._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$r._calculatePlayDuration=function(){if(0!==this.state){var $J=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$J),this._playEnd>$J&&(this._playEnd=$J),this._playDuration=this._playEnd-this._playStart}},$r._setPlayParams=function($J,$o){this._currentTime=$J,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$o+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$o},$r._setPlayParamsWhenStop=function($J,$o){this._currentTime=$J,this._currentKeyframeIndex=Math.max(Math.floor($J/$o+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$o,this._currentAnimationClipIndex=-1},$r._update=function($J){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $o=this._cacheFrameRateInterval*this._cachePlayRate,$r=0;this._startUpdateLoopCount!==$_.loopCount&&($r=$J*this.playbackRate,this._elapsedPlaybackTime+=$r);var $S=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$S)return this._setPlayParamsWhenStop($S,$o),void this.event("stopped");if($r+=this._currentTime,0<$S)if($S<=$r)do{if($r-=$S,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($S,$o),this._stopWhenCircleFinish=!1,void this.event("stopped");$r<$S&&(this._setPlayParams($r,$o),this.event("complete"))}while($S<=$r);else this._setPlayParams($r,$o);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($S,$o),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$r._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$r.play=function($J,$o,$r,$S,$G){if(void 0===$J&&($J=0),void 0===$o&&($o=1),void 0===$r&&($r=2147483647),void 0===$S&&($S=0),void 0===$G&&($G=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($r<0||$S<0||$G<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$G&&$G<$S)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$o,this._overallDuration=$r,this._playStart=$S,this._playEnd=$G,this._paused=!1,this._currentAnimationClipIndex=$J,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$_.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$r.playByFrame=function($J,$o,$r,$S,$G,$z){void 0===$J&&($J=0),void 0===$o&&($o=1),void 0===$r&&($r=2147483647),void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$z&&($z=30);var $A=1e3/$z;this.play($J,$o,$r,$S*$A,$G*$A)},$r.stop=function($J){void 0===$J&&($J=!0),$J?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$z(0,$r,"playEnd",function(){return this._playEnd}),$z(0,$r,"templet",function(){return this._templet},function($J){0===!this.state&&this.stop(!0),this._templet!==$J&&((this._templet=$J).loaded?this._computeFullKeyframeIndices():$J.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$z(0,$r,"playStart",function(){return this._playStart}),$z(0,$r,"playDuration",function(){return this._playDuration}),$z(0,$r,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$z(0,$r,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$z(0,$r,"overallDuration",function(){return this._overallDuration}),$z(0,$r,"currentFrameTime",function(){return this._currentFrameTime}),$z(0,$r,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$z(0,$r,"currentPlayTime",function(){return this._currentTime+this._playStart}),$z(0,$r,"cachePlayRate",function(){return this._cachePlayRate},function($J){this._cachePlayRate!==$J&&(this._cachePlayRate=$J,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$J,this._cacheFrameRate])))}),$z(0,$r,"cacheFrameRate",function(){return this._cacheFrameRate},function($J){this._cacheFrameRate!==$J&&(this._cacheFrameRate=$J,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$J])))}),$z(0,$r,"currentTime",null,function($J){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($J<this._playStart||$J>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$_.loopCount;var $o=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$J,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$o),0),this._currentFrameTime=this._currentKeyframeIndex*$o}}),$z(0,$r,"paused",function(){return this._paused},function($J){(this._paused=$J)&&this.event("paused")}),$z(0,$r,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$z(0,$r,"destroyed",function(){return this._destroyed}),$o}(),$L=function($J){function $o(){$o.__super.call(this),$N.isConchNode&&(this.drawSkin=function($J){$J.transform||($J.transform=$nJ.EMPTY),this._addCmd([$J]),this.setSkinMesh&&this.setSkinMesh($J._ps,$J.mVBData,$J.mEleNum,0,$J.mTexture,$J.transform)})}return $S($o,"laya.ani.GraphicsAni",$A),$o.prototype.drawSkin=function($J){var $o=[$J];this._saveToCmd($N._context._drawSkin,$o)},$o.create=function(){return $o._caches.pop()||new $o},$o.recycle=function($J){$J.clear(),$o._caches.push($J)},$o._caches=[],$o}(),$Q=function($J){function $i(){this._aniMap={},this.unfixedLastAniIndex=-1,$i.__super.call(this),this._anis=new Array}$S($i,"laya.ani.AnimationTemplet",$B);var $o=$i.prototype;return $o.parse=function($J){var $o=new $RJ($J);this._aniVersion=$o.readUTFString(),$I.parse(this,$o)},$o._calculateKeyFrame=function($J,$o,$r){var $S=$J.keyFrame;$S[$o]=$S[0];for(var $G=0;$G<$o;$G++){var $z=$S[$G];$z.nextData=0===$z.duration?$z.data:$S[$G+1].data}$S.length--},$o.onAsynLoaded=function($J,$o,$r){var $S=new $RJ($o);switch(this._aniVersion=$S.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$t.parse(this,$S);break;default:$I.parse(this,$S)}this._endLoaded()},$o.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$o.getAnimationCount=function(){return this._anis.length},$o.getAnimation=function($J){return this._anis[$J]},$o.getAniDuration=function($J){return this._anis[$J].playTime},$o.getNodes=function($J){return this._anis[$J].nodes},$o.getNodeIndexWithName=function($J,$o){return this._anis[$J].bone3DMap[$o]},$o.getNodeCount=function($J){return this._anis[$J].nodes.length},$o.getTotalkeyframesLength=function($J){return this._anis[$J].totalKeyframeDatasLength},$o.getPublicExtData=function(){return this._publicExtData},$o.getAnimationDataWithCache=function($J,$o,$r,$S){var $G=$o[$r];if($G){var $z=$G[$J];return $z?$z[$S]:null}return null},$o.setAnimationDataWithCache=function($J,$o,$r,$S,$G){var $z=$o[$r]||($o[$r]={});($z[$J]||($z[$J]=[]))[$S]=$G},$o.getOriginalData=function($J,$o,$r,$S,$G){for(var $z=this._anis[$J].nodes,$A=0,$h=0,$Z=$z.length,$u=0;$h<$Z;$h++){var $B,$v=$z[$h];$B=$v.keyFrame[$r[$h][$S]],$v.dataOffset=$u;var $j=$G-$B.startTime,$Y=$v.lerpType;if($Y)switch($Y){case 0:case 1:for($A=0;$A<$v.keyframeWidth;)$A+=$v.interpolationMethod[$A]($v,$A,$o,$u+$A,$B.data,$j,null,$B.duration,$B.nextData);break;case 2:var $_=$B.interpolationData,$D=$_.length,$N=0;for($A=0;$A<$D;){var $w=$_[$A];switch($w){case 6:case 7:$A+=$i.interpolation[$w]($v,$N,$o,$u+$N,$B.data,$j,null,$B.duration,$B.nextData,$_,$A+1);break;default:$A+=$i.interpolation[$w]($v,$N,$o,$u+$N,$B.data,$j,null,$B.duration,$B.nextData)}$N++}}else for($A=0;$A<$v.keyframeWidth;)$A+=$v.interpolationMethod[$A]($v,$A,$o,$u+$A,$B.data,$j,null,$B.duration,$B.nextData);$u+=$v.keyframeWidth}},$o.getNodesCurrentFrameIndex=function($J,$o){var $r=this._anis[$J].nodes;$J!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($r.length),this.unfixedCurrentTimes=new Float32Array($r.length),this.unfixedLastAniIndex=$J);for(var $S=0,$G=$r.length;$S<$G;$S++){var $z=$r[$S];for($o<this.unfixedCurrentTimes[$S]&&(this.unfixedCurrentFrameIndexes[$S]=0),this.unfixedCurrentTimes[$S]=$o;this.unfixedCurrentFrameIndexes[$S]<$z.keyFrame.length&&!($z.keyFrame[this.unfixedCurrentFrameIndexes[$S]].startTime>this.unfixedCurrentTimes[$S]);)this.unfixedCurrentFrameIndexes[$S]++;this.unfixedCurrentFrameIndexes[$S]--}return this.unfixedCurrentFrameIndexes},$o.getOriginalDataUnfixedRate=function($J,$o,$r){var $S=this._anis[$J].nodes;$J!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($S.length),this.unfixedCurrentTimes=new Float32Array($S.length),this.unfixedKeyframes=$D($S.length),this.unfixedLastAniIndex=$J);for(var $G=0,$z=0,$A=$S.length,$h=0;$z<$A;$z++){var $Z=$S[$z];for($r<this.unfixedCurrentTimes[$z]&&(this.unfixedCurrentFrameIndexes[$z]=0),this.unfixedCurrentTimes[$z]=$r;this.unfixedCurrentFrameIndexes[$z]<$Z.keyFrame.length&&!($Z.keyFrame[this.unfixedCurrentFrameIndexes[$z]].startTime>this.unfixedCurrentTimes[$z]);)this.unfixedKeyframes[$z]=$Z.keyFrame[this.unfixedCurrentFrameIndexes[$z]],this.unfixedCurrentFrameIndexes[$z]++;var $u=this.unfixedKeyframes[$z];$Z.dataOffset=$h;var $B=$r-$u.startTime;if($Z.lerpType)switch($Z.lerpType){case 0:case 1:for($G=0;$G<$Z.keyframeWidth;)$G+=$Z.interpolationMethod[$G]($Z,$G,$o,$h+$G,$u.data,$B,null,$u.duration,$u.nextData);break;case 2:var $v=$u.interpolationData,$j=$v.length,$Y=0;for($G=0;$G<$j;){var $_=$v[$G];switch($_){case 6:case 7:$G+=$i.interpolation[$_]($Z,$Y,$o,$h+$Y,$u.data,$B,null,$u.duration,$u.nextData,$v,$G+1);break;default:$G+=$i.interpolation[$_]($Z,$Y,$o,$h+$Y,$u.data,$B,null,$u.duration,$u.nextData)}$Y++}}else for($G=0;$G<$Z.keyframeWidth;)$G+=$Z.interpolationMethod[$G]($Z,$G,$o,$h+$G,$u.data,$B,null,$u.duration,$u.nextData);$h+=$Z.keyframeWidth}},$i._LinearInterpolation_0=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){var $B=0===$h?0:$z/$h;return $r[$S]=(1-$B)*$G[$o]+$B*$Z[$o],1},$i._QuaternionInterpolation_1=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){var $B=0===$h?0:$z/$h;return $j.slerpQuaternionArray($G,$o,$Z,$o,$B,$r,$S),4},$i._AngleInterpolation_2=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){return 0},$i._RadiansInterpolation_3=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){return 0},$i._Matrix4x4Interpolation_4=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){for(var $B=0;$B<16;$B++,$o++)$r[$S+$B]=$G[$o]+$z*$A[$o];return 16},$i._NoInterpolation_5=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u){return $r[$S]=$G[$o],1},$i._BezierInterpolation_6=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B){return void 0===$B&&($B=0),$r[$S]=$G[$o]+($Z[$o]-$G[$o])*$g.getBezierRate($z/$h,$u[$B],$u[$B+1],$u[$B+2],$u[$B+3]),5},$i._BezierInterpolation_7=function($J,$o,$r,$S,$G,$z,$A,$h,$Z,$u,$B){return void 0===$B&&($B=0),$r[$S]=$u[$B+4]+$u[$B+5]*$g.getBezierRate((.001*$z+$u[$B+6])/$u[$B+7],$u[$B],$u[$B+1],$u[$B+2],$u[$B+3]),9},$i.load=function($J){return $GJ.loader.create($J,null,null,$i)},$i.interpolation=[$i._LinearInterpolation_0,$i._QuaternionInterpolation_1,$i._AngleInterpolation_2,$i._RadiansInterpolation_3,$i._Matrix4x4Interpolation_4,$i._NoInterpolation_5,$i._BezierInterpolation_6,$i._BezierInterpolation_7],$i}(),$V=function($o){function $r($J,$o){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$r.__super.call(this),void 0===$o&&($o=0),$J&&this.init($J,$o)}$S($r,"laya.ani.bone.Skeleton",$o);var $J=$r.prototype;return $J.init=function($J,$o){void 0===$o&&($o=0);var $r,$S,$G,$z=0,$A=0;if(1==$o)for(this._graphicsCache=[],$z=0,$A=$J.getAnimationCount();$z<$A;$z++)this._graphicsCache.push([]);if(this._yReverseMatrix=$J.yReverseMatrix,this._aniMode=$o,this._templet=$J,this._player=new $s,this._player.cacheFrameRate=$J.rate,this._player.templet=$J,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$J.mBoneArr,this._rootBone=$J.mRootBone,this._aniSectionDic=$J.aniSectionDic,0<$J.ikArr.length)for(this._ikArr=[],$z=0,$A=$J.ikArr.length;$z<$A;$z++)this._ikArr.push(new $i($J.ikArr[$z],this._boneList));if(0<$J.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$z=0,$A=$J.pathArr.length;$z<$A;$z++)$r=$J.pathArr[$z],$S=new $K($r,this._boneList),($G=this._boneSlotDic[$r.name])&&(($S=new $K($r,this._boneList)).target=$G),this._pathDic[$r.name]=$S;if(0<$J.tfArr.length)for(this._tfArr=[],$z=0,$A=$J.tfArr.length;$z<$A;$z++)this._tfArr.push(new $e($J.tfArr[$z],this._boneList));if(0<$J.skinDataArray.length){var $h=this._templet.skinDataArray[this._skinIndex];this._skinName=$h.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$J.load=function($J,$o,$r){},$J._onLoaded=function(){},$J._parseComplete=function(){var $J=$m.TEMPLET_DICTIONARY[this._aniPath];$J&&(this.init($J,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$J._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$J._onPlay=function(){this.event("played")},$J._onStop=function(){var $J,$o=this._templet.eventAniArr[this._aniClipIndex];if($o&&this._eventIndex<$o.length)for(;this._eventIndex<$o.length;this._eventIndex++)($J=$o[this._eventIndex]).time>=this._player.playStart&&$J.time<=this._player.playEnd&&this.event("label",$J);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$J._onPause=function(){this.event("paused")},$J._parseSrcBoneMatrix=function(){var $J=0,$o=0;for($o=this._templet.srcBoneMatrixArr.length,$J=0;$J<$o;$J++)this._boneMatrixArray.push(new $nJ);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $r,$S,$G=this._templet.boneSlotArray;for($J=0,$o=$G.length;$J<$o;$J++)$r=$G[$J],null==($S=this._bindBoneBoneSlotDic[$r.parent])&&(this._bindBoneBoneSlotDic[$r.parent]=$S=[]),this._boneSlotDic[$r.name]=$r=$r.copy(),$S.push($r),this._boneSlotArray.push($r)}},$J._emitMissedEvents=function($J,$o,$r){void 0===$r&&($r=0);var $S=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($S){var $G,$z,$A=0;for($G=$S.length,$A=$r;$A<$G;$A++)($z=$S[$A]).time>=this._player.playStart&&$z.time<=this._player.playEnd&&this.event("label",$z)}},$J._update=function($J){if(void 0===$J&&($J=!0),!(this._pause||$J&&this._indexControl)){var $o=this.timer.currTimer,$r=this._player.currentKeyframeIndex,$S=$o-this._lastTime;if($J?this._player._update($S):$r=-1,this._lastTime=$o,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$S&&this._clipIndex==$r&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $G;this._lastUpdateAniClipIndex=this._aniClipIndex,$r>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $z,$A=this._templet.eventAniArr[this._aniClipIndex];if($A&&this._eventIndex<$A.length&&(($G=$A[this._eventIndex]).time>=this._player.playStart&&$G.time<=this._player.playEnd?this._player.currentPlayTime>=$G.time&&(this.event("label",$G),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($z=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$z&&(this.graphics=$z));var $h=0,$Z=0;for($Z=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$Z-1)&&0<$Z;)$Z--;if($Z<this._clipIndex)for($h=$Z;$h<this._clipIndex;$h++)this._createGraphics($h)}else if(1==this._aniMode){if($z=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$z&&(this.graphics=$z));for($Z=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$Z-1)&&0<$Z;)$Z--;if($Z<this._clipIndex)for($h=$Z;$h<this._clipIndex;$h++)this._createGraphics($h)}this._createGraphics()}}},$J._createGraphics=function($J){void 0===$J&&($J=-1),-1==$J&&($J=this._clipIndex);var $o,$r,$S=$J*this._player.cacheFrameRateInterval,$G=this._templet.drawOrderAniArr[this._aniClipIndex];if($G&&0<$G.length)for(this._drawOrderIndex=0,$o=$G[this._drawOrderIndex];$S>=$o.time&&(this._drawOrder=$o.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$G.length));)$o=$G[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$L.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$L.create(),$r=this.graphics;var $z=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$J,$S);var $A,$h,$Z,$u,$B=this._aniSectionDic[this._aniClipIndex],$v=0,$j=0,$Y=0,$_=0,$D=0,$N=this._templet.srcBoneMatrixArr.length;for($D=$B[$j=0];$j<$N;$j++)$u=this._boneList[$j],$Z=this._templet.srcBoneMatrixArr[$j],$u.resultTransform.scX=$Z.scX*this._curOriginalData[$v++],$u.resultTransform.skX=$Z.skX+this._curOriginalData[$v++],$u.resultTransform.skY=$Z.skY+this._curOriginalData[$v++],$u.resultTransform.scY=$Z.scY*this._curOriginalData[$v++],$u.resultTransform.x=$Z.x+this._curOriginalData[$v++],$u.resultTransform.y=$Z.y+this._curOriginalData[$v++],8===this._templet.tMatrixDataLen&&($u.resultTransform.skewX=$Z.skewX+this._curOriginalData[$v++],$u.resultTransform.skewY=$Z.skewY+this._curOriginalData[$v++]);var $w,$i={},$I={};for($D+=$B[1];$j<$D;$j++)$i[($w=$z[$j]).name]=this._curOriginalData[$v++],$I[$w.name]=this._curOriginalData[$v++],this._curOriginalData[$v++],this._curOriginalData[$v++],this._curOriginalData[$v++],this._curOriginalData[$v++];var $t,$K,$e={},$y={};for($D+=$B[2];$j<$D;$j++)$e[($w=$z[$j]).name]=this._curOriginalData[$v++],$y[$w.name]=this._curOriginalData[$v++],this._curOriginalData[$v++],this._curOriginalData[$v++],this._curOriginalData[$v++],this._curOriginalData[$v++];if(this._pathDic)for($D+=$B[3];$j<$D;$j++){if($w=$z[$j],$t=this._pathDic[$w.name])switch(new $RJ($w.extenData).getByte()){case 1:$t.position=this._curOriginalData[$v++];break;case 2:$t.spacing=this._curOriginalData[$v++];break;case 3:$t.rotateMix=this._curOriginalData[$v++],$t.translateMix=this._curOriginalData[$v++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($nJ.TEMP.identity()),this._ikArr)for($j=0,$D=this._ikArr.length;$j<$D;$j++)$K=this._ikArr[$j],$e.hasOwnProperty($K.name)&&($K.bendDirection=$e[$K.name]),$y.hasOwnProperty($K.name)&&($K.mix=$y[$K.name]),$K.apply();if(this._pathDic)for(var $g in this._pathDic)($t=this._pathDic[$g]).apply(this._boneList,$r);if(this._tfArr)for($j=0,$_=this._tfArr.length;$j<$_;$j++)this._tfArr[$j].apply();for($j=0,$_=this._boneList.length;$j<$_;$j++)if($u=this._boneList[$j],$h=this._bindBoneBoneSlotDic[$u.name],$u.resultMatrix.copyTo(this._boneMatrixArray[$j]),$h)for($Y=0,$D=$h.length;$Y<$D;$Y++)($A=$h[$Y])&&$A.setParentMatrix($u.resultMatrix);var $s,$V,$m,$C,$R={},$n=this._templet.deformAniArr;if($n&&0<$n.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$j=0,$D=this._boneSlotArray.length;$j<$D;$j++)($A=this._boneSlotArray[$j]).deformData=null;var $k,$U=$n[this._aniClipIndex];for($k in $s=$U.default,this._setDeform($s,$R,this._boneSlotArray,$S),$U)"default"!=$k&&$k!=this._skinName&&($s=$U[$k],this._setDeform($s,$R,this._boneSlotArray,$S));$s=$U[this._skinName],this._setDeform($s,$R,this._boneSlotArray,$S)}if(this._drawOrder)for($j=0,$D=this._drawOrder.length;$j<$D;$j++)$V=$i[($A=this._boneSlotArray[this._drawOrder[$j]]).name],$m=$I[$A.name],isNaN($m)||($r.save(),$r.alpha($m)),isNaN($V)||-2==$V||(this._templet.attachmentNames?$A.showDisplayByName(this._templet.attachmentNames[$V]):$A.showDisplayByIndex($V)),$R[this._drawOrder[$j]]?($C=$R[this._drawOrder[$j]],$A.currDisplayData&&$C[$A.currDisplayData.attachmentName]?$A.deformData=$C[$A.currDisplayData.attachmentName]:$A.deformData=null):$A.deformData=null,isNaN($m)?$A.draw($r,this._boneMatrixArray,2==this._aniMode):$A.draw($r,this._boneMatrixArray,2==this._aniMode,$m),isNaN($m)||$r.restore();else for($j=0,$D=this._boneSlotArray.length;$j<$D;$j++)$V=$i[($A=this._boneSlotArray[$j]).name],$m=$I[$A.name],isNaN($m)||($r.save(),$r.alpha($m)),isNaN($V)||-2==$V||(this._templet.attachmentNames?$A.showDisplayByName(this._templet.attachmentNames[$V]):$A.showDisplayByIndex($V)),$R[$j]?($C=$R[$j],$A.currDisplayData&&$C[$A.currDisplayData.attachmentName]?$A.deformData=$C[$A.currDisplayData.attachmentName]:$A.deformData=null):$A.deformData=null,isNaN($m)?$A.draw($r,this._boneMatrixArray,2==this._aniMode):$A.draw($r,this._boneMatrixArray,2==this._aniMode,$m),isNaN($m)||$r.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$J,$r):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$J,$r)},$J._setDeform=function($J,$o,$r,$S){if($J){var $G,$z,$A,$h=0,$Z=0,$u=0;if($J)for($h=0,$Z=$J.deformSlotDataList.length;$h<$Z;$h++)for($G=$J.deformSlotDataList[$h],$u=0;$u<$G.deformSlotDisplayList.length;$u++)$A=$r[($z=$G.deformSlotDisplayList[$u]).slotIndex],$z.apply($S,$A),$o[$z.slotIndex]||($o[$z.slotIndex]={}),$o[$z.slotIndex][$z.attachment]=$z.deformData}},$J.getAnimNum=function(){return this._templet.getAnimationCount()},$J.getAniNameByIndex=function($J){return this._templet.getAniNameByIndex($J)},$J.getSlotByName=function($J){return this._boneSlotDic[$J]},$J.showSkinByName=function($J,$o){void 0===$o&&($o=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($J),$o)},$J.showSkinByIndex=function($J,$o){void 0===$o&&($o=!0);for(var $r=0;$r<this._boneSlotArray.length;$r++)this._boneSlotArray[$r].showSlotData(null,$o);if(this._templet.showSkinByIndex(this._boneSlotDic,$J,$o)){var $S=this._templet.skinDataArray[$J];this._skinIndex=$J,this._skinName=$S.name}this._clearCache()},$J.showSlotSkinByIndex=function($J,$o){if(0!=this._aniMode){var $r=this.getSlotByName($J);$r&&$r.showDisplayByIndex($o),this._clearCache()}},$J.showSlotSkinByName=function($J,$o){if(0!=this._aniMode){var $r=this.getSlotByName($J);$r&&$r.showDisplayByName($o),this._clearCache()}},$J.replaceSlotSkinName=function($J,$o,$r){if(0!=this._aniMode){var $S=this.getSlotByName($J);$S&&$S.replaceDisplayByName($o,$r),this._clearCache()}},$J.replaceSlotSkinByIndex=function($J,$o,$r){if(0!=this._aniMode){var $S=this.getSlotByName($J);$S&&$S.replaceDisplayByIndex($o,$r),this._clearCache()}},$J.setSlotSkin=function($J,$o){if(0!=this._aniMode){var $r=this.getSlotByName($J);$r&&$r.replaceSkin($o),this._clearCache()}},$J._clearCache=function(){if(1==this._aniMode)for(var $J=0,$o=this._graphicsCache.length;$J<$o;$J++){for(var $r=0,$S=this._graphicsCache[$J].length;$r<$S;$r++){var $G=this._graphicsCache[$J][$r];$G!=this.graphics&&$L.recycle($G)}this._graphicsCache[$J].length=0}},$J.play=function($J,$o,$r,$S,$G,$z){void 0===$r&&($r=!0),void 0===$S&&($S=0),void 0===$G&&($G=0),void 0===$z&&($z=!0),this._indexControl=!1;var $A=-1,$h=NaN;if($h=$o?2147483647:0,"string"==typeof $J)for(var $Z=0,$u=this._templet.getAnimationCount();$Z<$u;$Z++){var $B=this._templet.getAnimation($Z);if($B&&$J==$B.name){$A=$Z;break}}else $A=$J;-1<$A&&$A<this.getAnimNum()&&(this._aniClipIndex=$A,($r||this._pause||this._currAniIndex!=$A)&&(this._currAniIndex=$A,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($A)),this._drawOrder=null,this._eventIndex=0,this._player.play($A,this._player.playbackRate,$h,$S,$G),$z&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$v.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$J.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$J.playbackRate=function($J){this._player&&(this._player.playbackRate=$J)},$J.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$J.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$v.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$J._getGrahicsDataWithCache=function($J,$o){return this._graphicsCache[$J][$o]},$J._setGrahicsDataWithCache=function($J,$o,$r){this._graphicsCache[$J][$o]=$r},$J.destroy=function($J){void 0===$J&&($J=!0),$o.prototype.destroy.call(this,$J),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$z(0,$J,"url",function(){return this._aniPath},function($J){this.load($J)}),$z(0,$J,"index",function(){return this._index},function($J){this.player&&(this._index=$J,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$z(0,$J,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$z(0,$J,"templet",function(){return this._templet}),$z(0,$J,"player",function(){return this._player}),$r.useSimpleMeshInCanvas=!1,$r}($zJ),$m=function($o){function $G(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$G.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$S($G,"laya.ani.bone.Templet",$o);var $J=$G.prototype;return $J.getLoadList=function(){return this._loadList},$J.loadAni=function($J){this._skBufferUrl=$J,$GJ.loader.load($J,$Z.create(this,this.onComplete),null,"arraybuffer")},$J.onComplete=function($J){if(this._isDestroyed)this.destroy();else{var $o=$u.getRes(this._skBufferUrl);$o?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$o)):this.event("error","load failed:"+this._skBufferUrl)}},$J.parseData=function($J,$o,$r){void 0===$r&&($r=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$J,this._mainTexture&&$N.isWebGL&&$J.bitmap&&($J.bitmap.enableMerageInAtlas=!1),this._rate=$r,this.parse($o)},$J.buildArmature=function($J){return void 0===$J&&($J=0),new $V(this,$J)},$J.parse=function($J){$o.prototype.parse.call(this,$J),this._endLoaded(),this._aniVersion!=$G.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$G.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$J._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $J=0;this._loadList=[];var $o,$r=new $RJ(this.getPublicExtData()),$S=0,$G=0,$z=0,$A=$r.getInt32(),$h=$r.readUTFString(),$Z=$h.split("\n");for($J=0;$J<$A;$J++)$o=this._path+$Z[2*$J],$h=$Z[2*$J+1],$r.getFloat32(),$r.getFloat32(),$S=$r.getFloat32(),$G=$r.getFloat32(),$z=$r.getFloat32(),isNaN($z)?0:$z,$z=$r.getFloat32(),isNaN($z)?0:$z,$z=$r.getFloat32(),isNaN($z)?$S:$z,$z=$r.getFloat32(),isNaN($z)?$G:$z,-1==this._loadList.indexOf($o)&&this._loadList.push($o);this.event("inited",this)}},$J._textureComplete=function(){for(var $J,$o,$r=0,$S=this._loadList.length;$r<$S;$r++)$o=this._loadList[$r],$J=this._textureDic[$o]=$u.getRes($o),$N.isWebGL&&$J&&$J.bitmap&&($J.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$J._parsePublicExtData=function(){var $J=0,$o=0,$r=0,$S=0,$G=0;for($J=0,$G=this.getAnimationCount();$J<$G;$J++)this._graphicsCache.push([]);var $z;$z="Dragon"!=this._aniClassName;var $A,$h,$Z=new $RJ(this.getPublicExtData()),$u=0,$B=0,$v=0,$j=0,$Y=0,$_=0,$D=0,$N=0,$w=0,$i=$Z.getInt32(),$I=$Z.readUTFString(),$t=$I.split("\n");for($J=0;$J<$i;$J++){if($A=this._mainTexture,$h=this._path+$t[2*$J],$I=$t[2*$J+1],null==this._mainTexture&&($A=this._textureDic[$h]),!$A)return this.event("error",this),void(this.isParseFail=!0);$u=$Z.getFloat32(),$B=$Z.getFloat32(),$v=$Z.getFloat32(),$j=$Z.getFloat32(),$w=$Z.getFloat32(),$Y=isNaN($w)?0:$w,$w=$Z.getFloat32(),$_=isNaN($w)?0:$w,$w=$Z.getFloat32(),$D=isNaN($w)?$v:$w,$w=$Z.getFloat32(),$N=isNaN($w)?$j:$w,this.subTextureDic[$I]=$kJ.create($A,$u,$B,$v,$j,-$Y,-$_,$D,$N),$A.alphaTexture&&(this.subTextureDic[$I].alphaTexture=$kJ.create($A.alphaTexture,$u,$B,$v,$j,-$Y,-$_,$D,$N))}this._mainTexture=$A;var $K,$e,$y,$g,$s,$V=$Z.getUint16();for($J=0;$J<$V;$J++)($K=[]).push($Z.getUint16()),$K.push($Z.getUint16()),$K.push($Z.getUint16()),$K.push($Z.getUint16()),this.aniSectionDic[$J]=$K;var $m,$C=$Z.getInt16(),$R={};for($J=0;$J<$C;$J++)$e=new $UJ,0==$J?$m=$e:$e.root=$m,$e.d=$z?-1:1,$g=$Z.readUTFString(),$s=$Z.readUTFString(),$e.length=$Z.getFloat32(),1==$Z.getByte()&&($e.inheritRotation=!1),1==$Z.getByte()&&($e.inheritScale=!1),$e.name=$g,$s&&(($y=$R[$s])?$y.addChild($e):this.mRootBone=$e),$R[$g]=$e,this.mBoneArr.push($e);this.tMatrixDataLen=$Z.getUint16();var $n,$k,$U=$Z.getUint16(),$L=Math.floor($U/this.tMatrixDataLen),$Q=this.srcBoneMatrixArr;for($J=0;$J<$L;$J++)($n=new $HJ).scX=$Z.getFloat32(),$n.skX=$Z.getFloat32(),$n.skY=$Z.getFloat32(),$n.scY=$Z.getFloat32(),$n.x=$Z.getFloat32(),$n.y=$Z.getFloat32(),8===this.tMatrixDataLen&&($n.skewX=$Z.getFloat32(),$n.skewY=$Z.getFloat32()),$Q.push($n),($e=this.mBoneArr[$J]).transform=$n;var $p,$f=$Z.getUint16(),$F=0;for($J=0;$J<$f;$J++){for($k=new $lJ,$F=$Z.getUint16(),$o=0;$o<$F;$o++)$k.boneNames.push($Z.readUTFString()),$k.boneIndexs.push($Z.getInt16());$k.name=$Z.readUTFString(),$k.targetBoneName=$Z.readUTFString(),$k.targetBoneIndex=$Z.getInt16(),$k.bendDirection=$Z.getFloat32(),$k.mix=$Z.getFloat32(),$k.isSpine=$z,this.ikArr.push($k)}var $d,$l=$Z.getUint16(),$c=0;for($J=0;$J<$l;$J++){for($p=new $qJ,$c=$Z.getUint16(),$o=0;$o<$c;$o++)$p.boneIndexs.push($Z.getInt16());$p.name=$Z.getUTFString(),$p.targetIndex=$Z.getInt16(),$p.rotateMix=$Z.getFloat32(),$p.translateMix=$Z.getFloat32(),$p.scaleMix=$Z.getFloat32(),$p.shearMix=$Z.getFloat32(),$p.offsetRotation=$Z.getFloat32(),$p.offsetX=$Z.getFloat32(),$p.offsetY=$Z.getFloat32(),$p.offsetScaleX=$Z.getFloat32(),$p.offsetScaleY=$Z.getFloat32(),$p.offsetShearY=$Z.getFloat32(),this.tfArr.push($p)}var $T=$Z.getUint16(),$b=0;for($J=0;$J<$T;$J++){for(($d=new $cJ).name=$Z.readUTFString(),$b=$Z.getUint16(),$o=0;$o<$b;$o++)$d.bones.push($Z.getInt16());$d.target=$Z.readUTFString(),$d.positionMode=$Z.readUTFString(),$d.spacingMode=$Z.readUTFString(),$d.rotateMode=$Z.readUTFString(),$d.offsetRotation=$Z.getFloat32(),$d.position=$Z.getFloat32(),$d.spacing=$Z.getFloat32(),$d.rotateMix=$Z.getFloat32(),$d.translateMix=$Z.getFloat32(),this.pathArr.push($d)}var $$,$q,$H,$a,$x,$M=0,$O=0,$P=0,$W=NaN,$E=0,$X=$Z.getInt16();for($J=0;$J<$X;$J++){var $JJ=$Z.getUint8(),$oJ={};this.deformAniArr.push($oJ);for(var $rJ=0;$rJ<$JJ;$rJ++)for(($$=new $QJ).skinName=$Z.getUTFString(),$oJ[$$.skinName]=$$,$M=$Z.getInt16(),$o=0;$o<$M;$o++)for($q=new $pJ,$$.deformSlotDataList.push($q),$O=$Z.getInt16(),$r=0;$r<$O;$r++)for($H=new $fJ,$q.deformSlotDisplayList.push($H),$H.slotIndex=$Z.getInt16(),$H.attachment=$Z.getUTFString(),$P=$Z.getInt16(),$S=0;$S<$P;$S++)for(1==$Z.getByte()?$H.tweenKeyList.push(!0):$H.tweenKeyList.push(!1),$W=$Z.getFloat32(),$H.timeList.push($W),$a=[],$H.vectices.push($a),$E=$Z.getInt16(),$G=0;$G<$E;$G++)$a.push($Z.getFloat32())}var $SJ,$GJ,$zJ=$Z.getInt16(),$AJ=0,$hJ=0;for($J=0;$J<$zJ;$J++){for($AJ=$Z.getInt16(),$x=[],$o=0;$o<$AJ;$o++){for(($SJ=new $FJ).time=$Z.getFloat32(),$hJ=$Z.getInt16(),$r=0;$r<$hJ;$r++)$SJ.drawOrder.push($Z.getInt16());$x.push($SJ)}this.drawOrderAniArr.push($x)}var $ZJ,$uJ=$Z.getInt16(),$BJ=0;for($J=0;$J<$uJ;$J++){for($BJ=$Z.getInt16(),$GJ=[],$o=0;$o<$BJ;$o++)($ZJ=new $dJ).name=$Z.getUTFString(),$ZJ.intValue=$Z.getInt32(),$ZJ.floatValue=$Z.getFloat32(),$ZJ.stringValue=$Z.getUTFString(),$ZJ.time=$Z.getFloat32(),$GJ.push($ZJ);this.eventAniArr.push($GJ)}var $vJ=$Z.getInt16();if(0<$vJ)for(this.attachmentNames=[],$J=0;$J<$vJ;$J++)this.attachmentNames.push($Z.getUTFString());var $jJ,$YJ,$_J=$Z.getInt16();for($J=0;$J<$_J;$J++)($jJ=new $LJ).name=$Z.readUTFString(),$jJ.parent=$Z.readUTFString(),$jJ.attachmentName=$Z.readUTFString(),$jJ.srcDisplayIndex=$jJ.displayIndex=$Z.getInt16(),($jJ.templet=this).boneSlotDic[$jJ.name]=$jJ,null==($YJ=this.bindBoneBoneSlotDic[$jJ.parent])&&(this.bindBoneBoneSlotDic[$jJ.parent]=$YJ=[]),$YJ.push($jJ),this.boneSlotArray.push($jJ);var $DJ,$NJ,$wJ,$iJ=$Z.readUTFString().split("\n"),$IJ=0,$tJ=$Z.getUint8(),$KJ=0,$eJ=0,$yJ=0,$gJ=0,$sJ=0,$VJ=0,$mJ=0;for($J=0;$J<$tJ;$J++){for(($DJ=new $TJ).name=$iJ[$IJ++],$KJ=$Z.getUint8(),$o=0;$o<$KJ;$o++){for(($NJ=new $$J).name=$iJ[$IJ++],$jJ=this.boneSlotDic[$NJ.name],$eJ=$Z.getUint8(),$r=0;$r<$eJ;$r++){if($wJ=new $bJ,this.skinSlotDisplayDataArr.push($wJ),$wJ.name=$iJ[$IJ++],$wJ.attachmentName=$iJ[$IJ++],$wJ.transform=new $HJ,$wJ.transform.scX=$Z.getFloat32(),$wJ.transform.skX=$Z.getFloat32(),$wJ.transform.skY=$Z.getFloat32(),$wJ.transform.scY=$Z.getFloat32(),$wJ.transform.x=$Z.getFloat32(),$wJ.transform.y=$Z.getFloat32(),$NJ.displayArr.push($wJ),$wJ.width=$Z.getFloat32(),$wJ.height=$Z.getFloat32(),$wJ.type=$Z.getUint8(),$wJ.verLen=$Z.getUint16(),0<($C=$Z.getUint16()))for($wJ.bones=[],$S=0;$S<$C;$S++){var $CJ=$Z.getUint16();$wJ.bones.push($CJ)}if(0<($yJ=$Z.getUint16()))for($wJ.uvs=[],$S=0;$S<$yJ;$S++)$wJ.uvs.push($Z.getFloat32());if(0<($gJ=$Z.getUint16()))for($wJ.weights=[],$S=0;$S<$gJ;$S++)$wJ.weights.push($Z.getFloat32());if(0<($sJ=$Z.getUint16()))for($wJ.triangles=[],$S=0;$S<$sJ;$S++)$wJ.triangles.push($Z.getUint16());if(0<($VJ=$Z.getUint16()))for($wJ.vertices=[],$S=0;$S<$VJ;$S++)$wJ.vertices.push($Z.getFloat32());if(0<($mJ=$Z.getUint16()))for($wJ.lengths=[],$S=0;$S<$mJ;$S++)$wJ.lengths.push($Z.getFloat32())}$DJ.slotArr.push($NJ)}this.skinDic[$DJ.name]=$DJ,this.skinDataArray.push($DJ)}1==$Z.getUint8()?(this.yReverseMatrix=new $nJ(1,0,0,-1,0,0),$m&&$m.setTempMatrix(this.yReverseMatrix)):$m&&$m.setTempMatrix(new $nJ),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$J.getTexture=function($J){var $o=this.subTextureDic[$J];return $o||($o=this.subTextureDic[$J.substr(0,$J.length-1)]),null==$o?this._mainTexture:$o},$J.showSkinByIndex=function($J,$o,$r){if(void 0===$r&&($r=!0),$o<0&&$o>=this.skinDataArray.length)return!1;var $S,$G,$z=0,$A=0,$h=this.skinDataArray[$o];if($h){for($z=0,$A=$h.slotArr.length;$z<$A;$z++)($G=$h.slotArr[$z])&&($S=$J[$G.name])&&($S.showSlotData($G,$r),$r&&"undefined"!=$S.attachmentName&&"null"!=$S.attachmentName?$S.showDisplayByName($S.attachmentName):$S.showDisplayByIndex($S.displayIndex));return!0}return!1},$J.getSkinIndexByName=function($J){for(var $o=0,$r=this.skinDataArray.length;$o<$r;$o++)if(this.skinDataArray[$o].name==$J)return $o;return-1},$J.getGrahicsDataWithCache=function($J,$o){return this._graphicsCache[$J][$o]},$J.setGrahicsDataWithCache=function($J,$o,$r){this._graphicsCache[$J][$o]=$r},$J.destroy=function(){var $J;for(var $o in this._isDestroyed=!0,this.subTextureDic)($J=this.subTextureDic[$o])&&$J.destroy();for($o in this._textureDic)($J=this._textureDic[$o])&&$J.destroy();for(var $r=0,$S=this.skinSlotDisplayDataArr.length;$r<$S;$r++)this.skinSlotDisplayDataArr[$r].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $G.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$J.getAniNameByIndex=function($J){var $o=this.getAnimation($J);return $o?$o.name:null},$z(0,$J,"rate",function(){return this._rate},function($J){this._rate=$J}),$G.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$G.TEMPLET_DICTIONARY=null,$G}($Q)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($J,$o){"use strict";for(var $r in Object.defineProperty($o,"__esModule",{value:!0}),Laya){var $S=Laya[$r];$S&&$S.__isclass&&($o[$r]=$S)}});