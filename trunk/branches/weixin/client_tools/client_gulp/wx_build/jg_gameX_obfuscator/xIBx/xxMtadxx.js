var u=wx.$x;!function(o,a){a.un,a.uns;var i=a.static,l=a.class,n=a.getset,d=(a.__newvec,laya.utils.Browser),e=(laya.events.Event,laya.events.EventDispatcher),r=laya.resource.HTMLImage,c=laya.utils.Handler,t=laya.display.Input,v=laya.net.Loader,f=(laya.maths.Matrix,laya.renders.Render),h=laya.utils.RunDriver,g=(laya.media.Sound,laya.media.SoundChannel),x=laya.media.SoundManager,m=(laya.display.Stage,laya.net.URL),p=laya.utils.Utils,s=(l(iv4xdg,"laya.wx.mini.MiniAdpter"),iv4xdg.getJson=function(i){return JSON.parse(i)},iv4xdg.init=function(i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),iv4xdg._inited||(iv4xdg.window=o).navigator.userAgent.indexOf("MiniGame")<0||(iv4xdg._inited=!0,iv4xdg.isZiYu=n,iv4xdg.isPosMsgYu=i,iv4xdg.EnvConfig={},iv4xdg.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,c.create(iv4xdg,iv4xdg.onMkdirCallBack))),iv4xdg.window.focus=function(){},a.getUrlPath=function(){},iv4xdg.window.logtime=function(i){},iv4xdg.window.alertTimeLog=function(i){},iv4xdg.window.resetShareInfo=function(){},iv4xdg.window.CanvasRenderingContext2D=function(){},iv4xdg.window.CanvasRenderingContext2D.prototype=iv4xdg.window.wx.createCanvas().getContext("2d").__proto__,iv4xdg.window.document.body.appendChild=function(){},iv4xdg.EnvConfig.pixelRatioInt=0,h.getPixelRatio=iv4xdg.pixelRatio,iv4xdg._preCreateElement=d.createElement,d.createElement=iv4xdg.createElement,h.createShaderCondition=iv4xdg.createShaderCondition,p.parseXMLFromString=iv4xdg.parseXMLFromString,t._createInputElement=y._createInputElement,iv4xdg.EnvConfig.load=v.prototype.load,v.prototype.load=E.prototype.load,iv4xdg.isZiYu&&i&&wx.onMessage(function(i){i.isLoad&&(u.ziyuFileData[i.url]=i.data)}))},iv4xdg.onMkdirCallBack=function(i,n){i||(u.filesListObj=JSON.parse(n.data))},iv4xdg.pixelRatio=function(){if(!iv4xdg.EnvConfig.pixelRatioInt)try{var i=wx.getSystemInfoSync();return iv4xdg.EnvConfig.pixelRatioInt=i.pixelRatio,i.pixelRatio}catch(i){}return iv4xdg.EnvConfig.pixelRatioInt},iv4xdg.createElement=function(i){return"canvas"!=i?"textarea"==i||"input"==i?iv4xdg.onCreateInput(i):"div"==i?((e=iv4xdg._preCreateElement(i)).contains=function(i){return null},e.removeChild=function(i){},e):iv4xdg._preCreateElement(i):(1==iv4xdg.idx?iv4xdg.isZiYu?(n=sharedCanvas).style={}:n=o.canvas:n=o.wx.createCanvas(),iv4xdg.idx++,n);var n;var e},iv4xdg.onCreateInput=function(i){i=iv4xdg._preCreateElement(i);return i.focus=y.wxinputFocus,i.blur=y.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(i){},i.setType=function(i){},i.setFontFace=function(i){},i.addEventListener=function(i){},i.contains=function(i){return null},i.removeChild=function(i){},i},iv4xdg.createShaderCondition=function(i){var n=this;return function(){return n[i.replace("this.","")]}},iv4xdg.EnvConfig=null,iv4xdg.window=null,iv4xdg._preCreateElement=null,iv4xdg._inited=!1,iv4xdg.wxRequest=null,iv4xdg.systemInfo=null,iv4xdg.version="0.0.1",iv4xdg.isZiYu=!1,iv4xdg.isPosMsgYu=!1,iv4xdg.parseXMLFromString=function(i){var n;i=i.replace(/>\s+</g,"><");try{n=(new o.Parser.DOMParser).parseFromString(i,"text/xml")}catch(i){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},iv4xdg.idx=1,iv4xdg),y=(l(ugdnvj,"laya.wx.mini.MiniImage"),ugdnvj.prototype._loadImage=function(i){var n=!1;-1==i.indexOf("layaNativeDir/")&&(n=!0,i=m.formatURL(i)),u.getFileInfo(i)?ugdnvj.onCreateImage(i,this,!n):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?u.downImg(i,new c(ugdnvj,ugdnvj.onDownImgCallBack,[i,this]),i):ugdnvj.onCreateImage(i,this,!0)},ugdnvj.onDownImgCallBack=function(i,n,e){e?n.onError(null):ugdnvj.onCreateImage(i,n)},ugdnvj.onCreateImage=function(n,e,i){var t;function ahpbe0(){t.onload=null,t.onerror=null,delete e.imgCache[n]}i=(i=void 0===i?!1:i)?n:(i=u.getFileInfo(n).md5,u.getFileNativePath(i)),null==e.imgCache&&(e.imgCache={});function za(){ahpbe0(),e.onLoaded(t)}function Aa(){ahpbe0(),e.event("error","Load image failed")}"nativeimage"==e._type?((t=new d.window.Image).crossOrigin="",t.onload=za,t.onerror=Aa,t.src=i,e.imgCache[n]=t):new r.create(i,{onload:za,onerror:Aa,onCreate:function(i){t=i,e.imgCache[n]=i}})},l(ujvn,"laya.wx.mini.MiniInput"),ujvn._createInputElement=function(){t._initInput(t.area=d.createElement("textarea")),t._initInput(t.input=d.createElement("input")),t.inputContainer=d.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,d.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(i,n){t.inputContainer.style.left=i+"px",t.inputContainer.style.top=n+"px"},a.stage.on("resize",null,ujvn._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){o.dispatchEvent&&o.dispatchEvent("resize")}),x._soundClass=w,x._musicClass=w,o._videoClass=C},ujvn._onStageResize=function(){a.stage._canvasTransform.identity().scale(d.width/f.canvas.width/h.getPixelRatio(),d.height/f.canvas.height/h.getPixelRatio())},ujvn.wxinputFocus=function(i){var n=t.inputElement.target;n&&!n.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(i){},fail:function(i){}}),s.window.wx.onKeyboardConfirm(function(i){i=i?i.value:"";n.text=i,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(i){i=i?i.value:"";n.multiline||-1==i.indexOf("\n")?(n.text=i,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},ujvn.inputEnter=function(){t.inputElement.target.focus=!1},ujvn.wxinputblur=function(){ujvn.hideKeyboard()},ujvn.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(i){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(i){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(i?i.errMsg:""))}})},ujvn),E=(l(iozsxm,"laya.wx.mini.MiniLoader"),(F=iozsxm.prototype).load=function(i,n,e,t,o){void 0===e&&(e=!0),void 0===o&&(o=!1);var a=this;0===(a._url=i).indexOf("data:image")?a._type=n="image":a._type=n=n||a.getTypeFromUrl(i),a._cache=e,a._data=null;var l="ascii";-1!=i.indexOf(".fnt")?l="utf8":"arraybuffer"==n&&(l="");var d=p.getFileExtension(i);if(-1!=iozsxm._fileTypeArr.indexOf(d))s.EnvConfig.load.call(this,i,n,e,t,o);else if(u.getFileInfo(i))s.EnvConfig.load.call(this,i,n,e,t,o);else{if(-1!=i.indexOf("layaNativeDir/"))return s.isZiYu?(d=u.ziyuFileData[i],void a.onLoaded(d)):(cosnole.log("read read"),void u.read(i,l,new c(iozsxm,iozsxm.onReadNativeCallBack,[l,i,n,e,t,o,a])));d=""==m.rootPath?i:i.split(m.rootPath)[0],-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?s.EnvConfig.load.call(a,i,n,e,t,o):u.readFile(d,l,new c(iozsxm,iozsxm.onReadNativeCallBack,[l,i,n,e,t,o,a]),i)}},F.resMgrLoad=function(i,t,n,e,o,a,l){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===l&&(l=3),-1!=i.indexOf("mpack")&&console.log("=============resMgrLoad url:",i),s.EnvConfig.resMgrLoad(i,(i,n,e)=>{iozsxm.prototype.resMgrLoadCallBack(i,n,e,t)},n,e,o,a,l)},F.resMgrLoadCallBack=function(i,n,e,t){console.log("buff:::",i,e,u.fileNativeDir+"///"+u.fileListName),t(i,n,e)},F.clearRes=function(i,n){this.clearRes(i,n=void 0===n?!1:n);n=u.getFileInfo(i);!n||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(i=n.md5,n=u.getFileNativePath(i),u.remove(n))},iozsxm.onReadNativeCallBack=function(i,n,e,t,o,a,l,d,u){void 0===t&&(t=!0),void 0===a&&(a=!1),(d=void 0===d?0:d)?1==d&&s.EnvConfig.load.call(l,n,e,t,o,a):(d="json"==e||"atlas"==e?s.getJson(u.data):"xml"==e?p.parseXMLFromString(u.data):u.data,l.onLoaded(d),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:n,data:d,isLoad:!0}))},i(iozsxm,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),iozsxm),u=(l(x4gi,"laya.wx.mini.MiniFileMgr",e),x4gi.isLoadFile=function(i){return-1!=x4gi._fileTypeArr.indexOf(i)},x4gi.getFileInfo=function(i){i=i.split("?")[0],i=x4gi.filesListObj[i];return null==i?null:i},x4gi.onFileUpdate=function(i,n){var i=i.split("/"),i=i[i.length-1],e=x4gi.getFileInfo(n);null==e?x4gi.onSaveFile(n,i):e.readyUrl!=n&&x4gi.remove(i,n)},x4gi.exits=function(i,n){i=x4gi.getFileNativePath(i);x4gi.fs.getFileInfo({filePath:i,success:function(i){null!=n&&n.runWith([0,i])},fail:function(i){null!=n&&n.runWith([1,i])}})},x4gi.read=function(i,n,e,t){void 0===n&&(n="ascill"),i=""!=(t=void 0===t?"":t)?x4gi.getFileNativePath(i):i,x4gi.fs.readFile({filePath:i,encoding:n,success:function(i){null!=e&&e.runWith([0,i])},fail:function(i){i&&""!=t?x4gi.down(t,n,e,t):null!=e&&e.runWith([1])}})},x4gi.readNativeFile=function(i,n){x4gi.fs.readFile({filePath:i,encoding:"",success:function(i){null!=n&&n.runWith([0])},fail:function(i){null!=n&&n.runWith([1])}})},x4gi.down=function(i,n,e,t){void 0===n&&(n="ascill"),void 0===t&&(t="");var o=x4gi.getFileNativePath(t);x4gi.wxdown({url:i,filePath:o,success:function(i){200===i.statusCode&&x4gi.readFile(i.filePath,n,e,t)},fail:function(i){null!=e&&e.runWith([1,i])}}).onProgressUpdate(function(i){null!=e&&e.runWith([2,i.progress])})},x4gi.readFile=function(n,i,e,t){void 0===t&&(t=""),x4gi.fs.readFile({filePath:n,encoding:i=void 0===i?"ascill":i,success:function(i){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||x4gi.onFileUpdate(n,t),null!=e&&e.runWith([0,i])},fail:function(i){i&&null!=e&&e.runWith([1,i])}})},x4gi.downImg=function(i,n,e){void 0===e&&(e="");x4gi.wxdown({url:i,success:function(i){200===i.statusCode&&x4gi.copyFile(i.tempFilePath,e,n)},fail:function(i){null!=n&&n.runWith([1,i])}})},x4gi.copyFile=function(i,n,e){var t=i.split("/"),o=t[t.length-1],a=(n.split("?")[0],x4gi.getFileInfo(n)),t=x4gi.getFileNativePath(o);x4gi.fs.copyFile({srcPath:i,destPath:t,success:function(i){a?a.readyUrl!=n&&x4gi.remove(o,n,e):(x4gi.onSaveFile(n,o),null!=e&&e.runWith([0]))},fail:function(i){null!=e&&e.runWith([1,i])}})},x4gi.getFileNativePath=function(i){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+i},x4gi.remove=function(n,e,t){void 0===e&&(e="");var i=x4gi.getFileInfo(e),o=x4gi.getFileNativePath(i.md5);a.loader.clearRes(i.readyUrl),x4gi.fs.unlink({filePath:o,success:function(i){""!=e&&x4gi.onSaveFile(e,n),null!=t&&t.runWith([0])},fail:function(i){}})},x4gi.onSaveFile=function(i,n){var e=i.split("?")[0];x4gi.filesListObj[e]={md5:n,readyUrl:i},x4gi.fs.writeFile({filePath:x4gi.fileNativeDir+"/"+x4gi.fileListName,encoding:"utf8",data:JSON.stringify(x4gi.filesListObj),success:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",i)},fail:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",i)}})},x4gi.existDir=function(i,n){x4gi.fs.mkdir({dirPath:i,success:function(i){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(i){-1!=i.errMsg.indexOf("file already exists")?x4gi.readSync(x4gi.fileListName,"utf8",n):null!=n&&n.runWith([1,i])}})},x4gi.readSync=function(i,n,e,t){void 0===n&&(n="ascill"),void 0===t&&(t="");var o,n=x4gi.getFileNativePath(i);try{o=x4gi.fs.readFileSync(n),null!=e&&e.runWith([0,{data:o}])}catch(i){null!=e&&e.runWith([1])}},x4gi.readCache=function(){},x4gi.writeCache=function(i){var n=readyUrl.split("?")[0];x4gi.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},x4gi.fs.writeFile({filePath:x4gi.fileNativeDir+"/"+x4gi.fileListName,encoding:"utf8",data:JSON.stringify(x4gi.filesListObj),success:function(i){},fail:function(i){}})},x4gi.setNativeFileDir=function(i){x4gi.fileNativeDir=wx.env.USER_DATA_PATH+i},x4gi.filesListObj={},x4gi.fileNativeDir=null,x4gi.fileListName="layaairfiles.txt",x4gi.ziyuFileData={},i(x4gi,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),x4gi),w=(l(jgvdun,"laya.wx.mini.MiniSound",e),(F=jgvdun.prototype).load=function(i){var n;i=m.formatURL(i),this.url=i,jgvdun._audioCache[i]?this.event("complete"):(this._sound.onCanplay(function(){n.loaded=!0,n.event("complete"),jgvdun._audioCache[n.url]=n}),this._sound.onError(function(i){console.error("errCode="+i.errCode+"  errMsg="+i.errMsg),n.event("error")}),this._sound.src=i,n=this)},F.play=function(i,n){var e,t;return void 0===i&&(i=0),void 0===n&&(n=0),t=(e=this.url==x._tMusic?(jgvdun._musicAudio||(jgvdun._musicAudio=this._sound),jgvdun._musicAudio):this._sound,this._chanell),e.src=this.url,e.startTime=0,t.isStopped&&(t.url=this.url,t.loops=n,t.startTime=i,t.play(),x.addChannel(t)),t},F.dispose=function(){var i=jgvdun._audioCache[this.url];i&&(i.src="",delete jgvdun._audioCache[this.url])},n(0,F,"duration",function(){return this._sound.duration}),jgvdun._createSound=function(){return jgvdun._id++,s.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},jgvdun._musicAudio=null,jgvdun._id=0,jgvdun._audioCache={},jgvdun._null=void 0,jgvdun),_=(l(gd4iv,"laya.wx.mini.MiniSoundChannel",g),(i=gd4iv.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__onNull=function(){},i.play=function(){this.isStopped=!1,x.addChannel(this),this._audio&&this._audio.play()},i.stop=function(){this.isStopped=!0,x.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,x.addChannel(this),this._audio.play())},n(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),n(0,i,"duration",function(){return this._audio?this._audio.duration:0}),n(0,i,"volume",function(){return 1},function(i){}),gd4iv._null=void 0,gd4iv),C=(l(keh0p,"laya.wx.mini.MiniVideo"),(e=keh0p.prototype).on=function(i,n,e){"loadedmetadata"==i?(this.onPlayFunc=e.bind(n),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=e.bind(n),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},e.onTimeUpdateFunc=function(i){this.position=i.position,this._duration=i.duration},e.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},e.onended=function(i,n){this.onEndedFunC=n.bind(i),this.videoElement.onended=this.onEndedFunction.bind(this)},e.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},e.off=function(i,n,e){"loadedmetadata"==i?(this.onPlayFunc=e.bind(n),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=e.bind(n),this.videoElement.offEnded=this.onEndedFunction.bind(this))},e.load=function(i){this.videoElement&&(this.videoElement.src=i)},e.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},e.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},e.size=function(i,n){this.videoElement&&(this.videoElement.width=i,this.videoElement.height=n)},e.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},e.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},n(0,e,"duration",function(){return this._duration}),n(0,e,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(i){this.videoElement&&(this.videoElement.initialTime=i)}),n(0,e,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),n(0,e,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),n(0,e,"ended",function(){return this.videoend}),n(0,e,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(i){this.videoElement&&(this.videoElement.loop=i)}),n(0,e,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(i){this.videoElement&&(this.videoElement.playbackRate=i)}),n(0,e,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(i){this.videoElement&&(this.videoElement.muted=i)}),n(0,e,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),n(0,e,"x",function(){return this.videoElement?this.videoElement.x:0},function(i){this.videoElement&&(this.videoElement.x=i)}),n(0,e,"y",function(){return this.videoElement?this.videoElement.y:0},function(i){this.videoElement&&(this.videoElement.y=i)}),n(0,e,"currentSrc",function(){return this.videoElement.src}),n(0,e,"src",function(){return this.videoElement?this.videoElement.src:0},function(i){this.videoElement&&(this.videoElement.src=i)}),n(0,e,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(i){this.videoElement&&(this.videoElement.controls=i)}),n(0,e,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(i){this.videoElement&&(this.videoElement.autoplay=i)}),keh0p);function keh0p(){this.videoend=!1,this.videourl="",this.videoElement=s.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function gd4iv(i){this._audio=null,this._onEnd=null,gd4iv.__super.call(this),this.isStopped=!0,this._audio=i,this._onEnd=p.bind(this.__onEnd,this),i.onEnded(this._onEnd)}function jgvdun(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,jgvdun.__super.call(this),this._sound=jgvdun._createSound(),this._chanell=new _(this._sound)}function x4gi(){x4gi.__super.call(this)}function iozsxm(){}var F;function ujvn(){}function ugdnvj(){}function iv4xdg(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(i,n){"use strict";for(var e in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var t=Laya[e];t&&t.__isclass&&(n[e]=t)}});