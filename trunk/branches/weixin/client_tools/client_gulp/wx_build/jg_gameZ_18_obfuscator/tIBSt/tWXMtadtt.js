var v=wx.$d;!function(t,o){o.un,o.uns;var n=o.static,i=o.class,a=o.getset,l=(o.__newvec,laya.utils.Browser),u=(laya.events.Event,laya.events.EventDispatcher),s=laya.resource.HTMLImage,c=laya.utils.Handler,e=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),v=laya.utils.RunDriver,p=(laya.media.Sound,laya.media.SoundChannel),x=laya.media.SoundManager,y=(laya.display.Stage,laya.net.URL),m=laya.utils.Utils,d=(i(u43dh,"laya.wx.mini.MiniAdpter"),u43dh.getJson=function(n){return JSON.parse(n)},u43dh.init=function(n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),u43dh._inited||(u43dh.window=t).navigator.userAgent.indexOf("MiniGame")<0||(u43dh._inited=!0,u43dh.isZiYu=i,u43dh.isPosMsgYu=n,u43dh.EnvConfig={},u43dh.isZiYu||(r.setNativeFileDir("/layaairGame"),r.existDir(r.fileNativeDir,c.create(u43dh,u43dh.onMkdirCallBack))),u43dh.window.focus=function(){},o.getUrlPath=function(){},u43dh.window.logtime=function(n){},u43dh.window.alertTimeLog=function(n){},u43dh.window.resetShareInfo=function(){},u43dh.window.CanvasRenderingContext2D=function(){},u43dh.window.CanvasRenderingContext2D.prototype=u43dh.window.wx.createCanvas().getContext("2d").__proto__,u43dh.window.document.body.appendChild=function(){},u43dh.EnvConfig.pixelRatioInt=0,v.getPixelRatio=u43dh.pixelRatio,u43dh._preCreateElement=l.createElement,l.createElement=u43dh.createElement,v.createShaderCondition=u43dh.createShaderCondition,m.parseXMLFromString=u43dh.parseXMLFromString,e._createInputElement=_._createInputElement,u43dh.EnvConfig.load=f.prototype.load,f.prototype.load=g.prototype.load,u43dh.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(r.ziyuFileData[n.url]=n.data)}))},u43dh.onMkdirCallBack=function(n,i){n||(r.filesListObj=JSON.parse(i.data))},u43dh.pixelRatio=function(){if(!u43dh.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return u43dh.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return u43dh.EnvConfig.pixelRatioInt},u43dh.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?u43dh.onCreateInput(n):"div"==n?((e=u43dh._preCreateElement(n)).contains=function(n){return null},e.removeChild=function(n){},e):u43dh._preCreateElement(n):(1==u43dh.idx?u43dh.isZiYu?(i=sharedCanvas).style={}:i=t.canvas:i=t.wx.createCanvas(),u43dh.idx++,i);var i;var e},u43dh.onCreateInput=function(n){n=u43dh._preCreateElement(n);return n.focus=_.wxinputFocus,n.blur=_.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},u43dh.createShaderCondition=function(n){var i=this;return function(){return i[n.replace("this.","")]}},u43dh.EnvConfig=null,u43dh.window=null,u43dh._preCreateElement=null,u43dh._inited=!1,u43dh.wxRequest=null,u43dh.systemInfo=null,u43dh.version="0.0.1",u43dh.isZiYu=!1,u43dh.isPosMsgYu=!1,u43dh.parseXMLFromString=function(n){var i;n=n.replace(/>\s+</g,"><");try{i=(new t.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return i},u43dh.idx=1,u43dh),_=(i(d84h3l,"laya.wx.mini.MiniImage"),d84h3l.prototype._loadImage=function(n){var i=!1;-1==n.indexOf("layaNativeDir/")&&(i=!0,n=y.formatURL(n)),r.getFileInfo(n)?d84h3l.onCreateImage(n,this,!i):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?r.downImg(n,new c(d84h3l,d84h3l.onDownImgCallBack,[n,this]),n):d84h3l.onCreateImage(n,this,!0)},d84h3l.onDownImgCallBack=function(n,i,e){e?i.onError(null):d84h3l.onCreateImage(n,i)},d84h3l.onCreateImage=function(i,e,n){var t;function urtykl(){t.onload=null,t.onerror=null,delete e.imgCache[i]}n=(n=void 0===n?!1:n)?i:(n=r.getFileInfo(i).md5,r.getFileNativePath(n)),null==e.imgCache&&(e.imgCache={});function ya(){urtykl(),e.onLoaded(t)}function za(){urtykl(),e.event("error","Load image failed")}"nativeimage"==e._type?((t=new l.window.Image).crossOrigin="",t.onload=ya,t.onerror=za,t.src=n,e.imgCache[i]=t):new s.create(n,{onload:ya,onerror:za,onCreate:function(n){t=n,e.imgCache[i]=n}})},i(pb0mna,"laya.wx.mini.MiniInput"),pb0mna._createInputElement=function(){e._initInput(e.area=l.createElement("textarea")),e._initInput(e.input=l.createElement("input")),e.inputContainer=l.createElement("div"),e.inputContainer.style.position="absolute",e.inputContainer.style.zIndex=1e5,l.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(n,i){e.inputContainer.style.left=n+"px",e.inputContainer.style.top=i+"px"},o.stage.on("resize",null,pb0mna._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){t.dispatchEvent&&t.dispatchEvent("resize")}),x._soundClass=w,x._musicClass=w},pb0mna._onStageResize=function(){o.stage._canvasTransform.identity().scale(l.width/h.canvas.width/v.getPixelRatio(),l.height/h.canvas.height/v.getPixelRatio())},pb0mna.wxinputFocus=function(n){var i=e.inputElement.target;i&&!i.editable||(d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),d.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"";i.text=n,i.event("input"),laya.wx.mini.MiniInput.inputEnter()}),d.window.wx.onKeyboardInput(function(n){n=n?n.value:"";i.multiline||-1==n.indexOf("\n")?(i.text=n,i.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},pb0mna.inputEnter=function(){e.inputElement.target.focus=!1},pb0mna.wxinputblur=function(){pb0mna.hideKeyboard()},pb0mna.hideKeyboard=function(){d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},pb0mna),g=(i(ku3yl,"laya.wx.mini.MiniLoader"),($=ku3yl.prototype).load=function(n,i,e,t,a){void 0===e&&(e=!0),void 0===a&&(a=!1);var o=this;0===(o._url=n).indexOf("data:image")?o._type=i="image":o._type=i=i||o.getTypeFromUrl(n),o._cache=e,o._data=null;var l="ascii";-1!=n.indexOf(".fnt")?l="utf8":"arraybuffer"==i&&(l="");var u=m.getFileExtension(n);if(-1!=ku3yl._fileTypeArr.indexOf(u))d.EnvConfig.load.call(this,n,i,e,t,a);else if(r.getFileInfo(n))d.EnvConfig.load.call(this,n,i,e,t,a);else{if(-1!=n.indexOf("layaNativeDir/"))return d.isZiYu?(u=r.ziyuFileData[n],void o.onLoaded(u)):(cosnole.log("read read"),void r.read(n,l,new c(ku3yl,ku3yl.onReadNativeCallBack,[l,n,i,e,t,a,o])));u=""==y.rootPath?n:n.split(y.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?d.EnvConfig.load.call(o,n,i,e,t,a):r.readFile(u,l,new c(ku3yl,ku3yl.onReadNativeCallBack,[l,n,i,e,t,a,o]),n)}},$.resMgrLoad=function(n,t,i,e,a,o,l){void 0===i&&(i=0),void 0===e&&(e=!1),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===l&&(l=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),d.EnvConfig.resMgrLoad(n,(n,i,e)=>{ku3yl.prototype.resMgrLoadCallBack(n,i,e,t)},i,e,a,o,l)},$.resMgrLoadCallBack=function(n,i,e,t){console.log("buff:::",n,e,r.fileNativeDir+"///"+r.fileListName),t(n,i,e)},$.clearRes=function(n,i){this.clearRes(n,i=void 0===i?!1:i);i=r.getFileInfo(n);!i||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=i.md5,i=r.getFileNativePath(n),r.remove(i))},ku3yl.onReadNativeCallBack=function(n,i,e,t,a,o,l,u,r){void 0===t&&(t=!0),void 0===o&&(o=!1),(u=void 0===u?0:u)?1==u&&d.EnvConfig.load.call(l,i,e,t,a,o):(u="json"==e||"atlas"==e?d.getJson(r.data):"xml"==e?m.parseXMLFromString(r.data):r.data,l.onLoaded(u),!d.isZiYu&&d.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:i,data:u,isLoad:!0}))},n(ku3yl,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),ku3yl),r=(i(x$vj79,"laya.wx.mini.MiniFileMgr",u),x$vj79.isLoadFile=function(n){return-1!=x$vj79._fileTypeArr.indexOf(n)},x$vj79.getFileInfo=function(n){n=n.split("?")[0],n=x$vj79.filesListObj[n];return null==n?null:n},x$vj79.onFileUpdate=function(n,i){var n=n.split("/"),n=n[n.length-1],e=x$vj79.getFileInfo(i);null==e?x$vj79.onSaveFile(i,n):e.readyUrl!=i&&x$vj79.remove(n,i)},x$vj79.exits=function(n,i){n=x$vj79.getFileNativePath(n);x$vj79.fs.getFileInfo({filePath:n,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){null!=i&&i.runWith([1,n])}})},x$vj79.read=function(n,i,e,t){void 0===i&&(i="ascill"),n=""!=(t=void 0===t?"":t)?x$vj79.getFileNativePath(n):n,x$vj79.fs.readFile({filePath:n,encoding:i,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){n&&""!=t?x$vj79.down(t,i,e,t):null!=e&&e.runWith([1])}})},x$vj79.readNativeFile=function(n,i){x$vj79.fs.readFile({filePath:n,encoding:"",success:function(n){null!=i&&i.runWith([0])},fail:function(n){null!=i&&i.runWith([1])}})},x$vj79.down=function(n,i,e,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var a=x$vj79.getFileNativePath(t);x$vj79.wxdown({url:n,filePath:a,success:function(n){200===n.statusCode&&x$vj79.readFile(n.filePath,i,e,t)},fail:function(n){null!=e&&e.runWith([1,n])}}).onProgressUpdate(function(n){null!=e&&e.runWith([2,n.progress])})},x$vj79.readFile=function(i,n,e,t){void 0===t&&(t=""),x$vj79.fs.readFile({filePath:i,encoding:n=void 0===n?"ascill":n,success:function(n){-1==i.indexOf("http://")&&-1==i.indexOf("https://")||x$vj79.onFileUpdate(i,t),null!=e&&e.runWith([0,n])},fail:function(n){n&&null!=e&&e.runWith([1,n])}})},x$vj79.downImg=function(n,i,e){void 0===e&&(e="");x$vj79.wxdown({url:n,success:function(n){200===n.statusCode&&x$vj79.copyFile(n.tempFilePath,e,i)},fail:function(n){null!=i&&i.runWith([1,n])}})},x$vj79.copyFile=function(n,i,e){var t=n.split("/"),a=t[t.length-1],o=(i.split("?")[0],x$vj79.getFileInfo(i)),t=x$vj79.getFileNativePath(a);x$vj79.fs.copyFile({srcPath:n,destPath:t,success:function(n){o?o.readyUrl!=i&&x$vj79.remove(a,i,e):(x$vj79.onSaveFile(i,a),null!=e&&e.runWith([0]))},fail:function(n){null!=e&&e.runWith([1,n])}})},x$vj79.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},x$vj79.remove=function(i,e,t){void 0===e&&(e="");var n=x$vj79.getFileInfo(e),a=x$vj79.getFileNativePath(n.md5);o.loader.clearRes(n.readyUrl),x$vj79.fs.unlink({filePath:a,success:function(n){""!=e&&x$vj79.onSaveFile(e,i),null!=t&&t.runWith([0])},fail:function(n){}})},x$vj79.onSaveFile=function(n,i){var e=n.split("?")[0];x$vj79.filesListObj[e]={md5:i,readyUrl:n},x$vj79.fs.writeFile({filePath:x$vj79.fileNativeDir+"/"+x$vj79.fileListName,encoding:"utf8",data:JSON.stringify(x$vj79.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},x$vj79.existDir=function(n,i){x$vj79.fs.mkdir({dirPath:n,success:function(n){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?x$vj79.readSync(x$vj79.fileListName,"utf8",i):null!=i&&i.runWith([1,n])}})},x$vj79.readSync=function(n,i,e,t){void 0===i&&(i="ascill"),void 0===t&&(t="");var a,i=x$vj79.getFileNativePath(n);try{a=x$vj79.fs.readFileSync(i),null!=e&&e.runWith([0,{data:a}])}catch(n){null!=e&&e.runWith([1])}},x$vj79.readCache=function(){},x$vj79.writeCache=function(n){var i=readyUrl.split("?")[0];x$vj79.filesListObj[i]={md5:md5Name,readyUrl:readyUrl},x$vj79.fs.writeFile({filePath:x$vj79.fileNativeDir+"/"+x$vj79.fileListName,encoding:"utf8",data:JSON.stringify(x$vj79.filesListObj),success:function(n){},fail:function(n){}})},x$vj79.setNativeFileDir=function(n){x$vj79.fileNativeDir=wx.env.USER_DATA_PATH+n},x$vj79.filesListObj={},x$vj79.fileNativeDir=null,x$vj79.fileListName="layaairfiles.txt",x$vj79.ziyuFileData={},n(x$vj79,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),x$vj79),w=(i(ry15,"laya.wx.mini.MiniSound",u),($=ry15.prototype).load=function(n){var i=this;var e;function jm$x6v(){if(null!=ry15._null)i._sound.onCanplay(ry15._null),i._sound.onError(ry15._null);else try{i._sound.onCanplay(null),i._sound.onError(null),ry15._null=null}catch(n){console.warn("[wxmini] _clearSound:"+n),i._sound.onCanplay(f_$9),i._sound.onError(f_$9),ry15._null=f_$9}}function f_$9(){}n=y.formatURL(n),this.url=n,ry15._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){jm$x6v(),e.loaded=!0,e.event("complete"),ry15._audioCache[e.url]=e}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),jm$x6v(),e.event("error")}),this._sound.src=n,e=this)},$.play=function(n,i){void 0===n&&(n=0),void 0===i&&(i=0),(e=this.url==x._tMusic?(ry15._musicAudio||(ry15._musicAudio=ry15._createSound()),ry15._musicAudio):ry15._createSound()).src=this.url;var e=new C(e);return e.url=this.url,e.loops=i,e.startTime=n,e.play(),x.addChannel(e),e},$.dispose=function(){var n=ry15._audioCache[this.url];n&&(n.src="",delete ry15._audioCache[this.url])},a(0,$,"duration",function(){return this._sound.duration}),ry15._createSound=function(){return ry15._id++,d.window.wx.createInnerAudioContext()},ry15._musicAudio=null,ry15._id=0,ry15._audioCache={},ry15._null=void 0,ry15),C=(i(_97$5f,"laya.wx.mini.MiniSoundChannel",p),(n=_97$5f.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(o.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,x.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){if(this.isStopped=!0,x.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=_97$5f._null)this._audio.onEnded(_97$5f._null);else try{this._audio.onEnded(null),_97$5f._null=null}catch(n){console.warn("[wxmini] stop:"+n),this._audio.onEnded(m.bind(this.__onNull,this)),_97$5f._null=m.bind(this.__onNull,this)}this._audio=null}},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,x.addChannel(this),this._audio.play())},a(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,n,"duration",function(){return this._audio?this._audio.duration:0}),a(0,n,"volume",function(){return 1},function(n){}),_97$5f._null=void 0,_97$5f);function _97$5f(n){this._audio=null,this._onEnd=null,_97$5f.__super.call(this),this._audio=n,this._onEnd=m.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function ry15(){this._sound=null,this.url=null,this.loaded=!1,ry15.__super.call(this),this._sound=ry15._createSound()}function x$vj79(){x$vj79.__super.call(this)}function ku3yl(){}var $;function pb0mna(){}function d84h3l(){}function u43dh(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,i){"use strict";for(var e in Object.defineProperty(i,"__esModule",{value:!0}),Laya){var t=Laya[e];t&&t.__isclass&&(i[e]=t)}});