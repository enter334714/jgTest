var F=wx.$D;var config={game_id:"",package_name:"",package_version:"1",channel_id:50};var SQ_XGAMESDK=xgamesdk();var HOST="https://xzsdk.wdiyi.com";var game_version="";var D1W4I2X=null;var is_init=0;function xgamesdk(){var r={};return{order_info:{},init:function(e,a){console.log("SQ_XGAMESDK:CP\u8c03\u7528init\u63a5\u53e3"),game_version=e&&e.game_version?e.game_version:0;var o=e&&e.game_id?e.game_id:"";var n=e&&e.package_name?e.package_name:"";var t=e&&e.package_version?e.package_version:"";""!=o&&""!=n&&""!=t?(config.game_id=o,config.package_name=n,config.package_version=t,n=wx.getStorageSync("xz_pt_uuid")?0:(o=this.uuid(16,32),wx.setStorageSync("xz_pt_uuid",o),1),this.active({is_first_active:n}),wx.showShareMenu(),game_version?this.checkDev(game_version,function(e){a&&a(1,e,"\u521d\u59cb\u5316\u6210\u529f")}):a&&a(1,e,"\u521d\u59cb\u5316\u6210\u529f"),is_init=1):a&&a(0,{},"\u521d\u59cb\u5316\u5931\u8d25")},checkDev:function(e,o){console.log("SQ_XGAMESDK:\u68c0\u67e5\u6e38\u620f\u7248\u672c"),wx.request({url:HOST+"/?ct=xgame&ac=checkDev",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{game_id:config.game_id,game_version:e,package_version:config.package_version,channel_id:config.channel_id,package_name:config.package_name},success:function(e){var a;console.log("SQ_XGAMESDK:\u83b7\u53d6\u6e38\u620f\u7248\u672c\u7ed3\u679c"),console.log(e.data),200==e.statusCode&&(a=e.data).state?o&&o({develop:a.data.develop}):o&&o({develop:0})},fail:function(e){console.log(e)}})},active:function(e,a){var o=wx.getLaunchOptionsSync();var n=JSON.stringify(o);console.log("SQ_XGAMESDK:\u5c0f\u6e38\u620f\u542f\u52a8\u53c2\u6570"),console.log(JSON.stringify(o)),e.is_first_active&&o.query&&o.query.adcode&&wx.setStorageSync("xz_pt_adcode",o.query.adcode);o=this.getCommonParams();o.launch_options=n,o.is_first_active=e.is_first_active,wx.request({url:HOST+"/?ct=xgame&ac=active",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:o,success:function(e){console.log("SQ_XGAMESDK:\u521d\u59cb\u5316\u63a5\u53e3\u7ed3\u679c\uff1a"),console.log(e.data)}})},login:function(e,a){var o=this;var n;console.log("SQ_XGAMESDK:\u8c03\u8d77\u767b\u5f55"),r.login="function"==typeof a?a:null,is_init?(a=wx.getLaunchOptionsSync(),n=JSON.stringify(a),wx.login({success:function(e){var a;console.log("\u5fae\u4fe1\u767b\u5f55\u6210\u529f\u8fd4\u56de"+JSON.stringify(e)),e.code?((a=o.getCommonParams()).code=e.code,a.launch_options=n,wx.request({url:HOST+"/?ct=xgame&ac=login",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:a,success:function(e){if(console.log("SQ_XGAMESDK:\u767b\u5f55\u63a5\u53e3\u7ed3\u679c\uff1a"),console.log(e.data),200==e.statusCode){var a=e.data;if(a.state){e={uid:a.data.uid,code:a.data.code};try{wx.setStorageSync("xz_pt_uid",a.data.uid),wx.setStorageSync("xz_pt_sdk_token",a.data.sdk_token),wx.setStorageSync("xz_pt_sk",a.data.sk)}catch(e){}r.login&&r.login(1,e),a.data.tips&&a.data.tips.content&&(e=a.data.tips.title||"\u6e29\u99a8\u63d0\u793a",wx.showModal({title:e,content:a.data.tips.content,cancelText:"\u53d6\u6d88",confirmText:a.data.tips.confirmText,success:function(e){e.confirm?wx.setClipboardData({data:a.data.tips.bgr,success:function(e){a.data.tips.bgr&&wx.showToast({title:"\u5df2\u590d\u5236"})}}):e.cancel&&console.log("\u7528\u6237\u70b9\u51fb\u53d6\u6d88")}}))}else r.login&&r.login(0,{},a.msg)}else r.login&&r.login(0,{},"\u5e73\u53f0\u670d\u52a1\u5668\u8bf7\u6c42\u9519\u8bef")}})):r.login&&r.login(0,{},e.errMsg)},fail:function(e){console.log("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25"+JSON.stringify(e)),(-1<e.errMsg.indexOf("auth deny")||-1<e.errMsg.indexOf("auth denied"))&&r.login&&r.login(0,{},e.errMsg)}})):r.login&&r.login(0,{},"\u8bf7\u5148\u521d\u59cb\u5316\u5e73\u53f0sdk")},role:function(e){e=e||{};var a=wx.getStorageSync("xz_pt_uid");var o;is_init&&((o={}).game_id=config.game_id,o.package_name=config.package_name,o.uid=a,o.role_id=e.role_id||"",o.role_level=e.role_level||"",o.role_name=e.role_name||"",o.server_id=e.server_id||"",o.server_name=e.server_name||"",o.update_time=e.update_time||"",wx.request({url:HOST+"/?ct=xgame&ac=role",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:o,success:function(e){console.log("SQ_XGAMESDK:\u89d2\u8272\u4e0a\u62a5\u63a5\u53e3\u7ed3\u679c\uff1a"),console.log(e.data)}}))},pay:function(e,a){var o=this;r.pay="function"==typeof a?a:null,is_init?wx.checkSession({success:function(){o.makeOrder(e,a)},fail:function(){console.log("SQ_XGAMESDK:session\u8fc7\u671f\u91cd\u65b0\u767b\u5f55"),o.login({},function(){o.makeOrder(e,a)})}}):r.pay&&r.pay(0,{},"\u8bf7\u5148\u521d\u59cb\u5316\u5e73\u53f0sdk")},makeOrder:function(e,a){console.log("SQ_XGAMESDK:\u8c03\u8d77\u652f\u4ed8\uff0cCP\u4f20\u503c\uff1a"),console.log(e);var o=this;var n=wx.getStorageSync("xz_pt_sdk_token");var t=wx.getStorageSync("xz_pt_uid");var i=wx.getStorageSync("xz_pt_sk");var c,s;n&&i?((c=o.getCommonParams()).uid=t,c.cp_order_num=e.cp_order_num,c.product_id=e.product_id,c.server_id=e.server_id,c.server_name=e.server_name,c.role_id=e.role_id,c.role_level=e.role_level,c.role_name=e.role_name,c.total_fee=e.total_fee,c.ext=e.ext,c.sdk_token=n,c.session_key=i,o.order_info=c,s=wx.getSystemInfoSync(),wx.request({url:HOST+"/?ct=xgame&ac=makeOrder",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:c,success:function(e){console.log("SQ_XGAMESDK:\u8ba2\u5355\u521b\u5efa\u63a5\u53e3"),console.log(e.data),200==e.statusCode?(e=e.data).state?"android"==s.platform||"windows"==s.platform||"devtools"==s.platform?e.data.android_pay?o.virtualPay(e.data):wx.showModal({title:"\u6e29\u99a8\u63d0\u793a",content:"\u6e38\u620f\u4e0d\u652f\u6301\u652f\u4ed8",confirmText:"\u6211\u77e5\u9053\u4e86",showCancel:!1}):e.data.ios_pay?1==e.data.ios_pay_type&&(e.data.ios_pay_appid?o.jminPay(e.data):wx.showModal({title:"\u652f\u4ed8\u63d0\u793a",content:"\u7531\u4e8e\u82f9\u679c\u653f\u7b56\u9650\u5236\uff0c\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\u652f\u4ed8",confirmText:"\u6211\u77e5\u9053\u4e86",showCancel:!1})):wx.showModal({title:"\u652f\u4ed8\u63d0\u793a",content:"\u7531\u4e8e\u82f9\u679c\u653f\u7b56\u9650\u5236\uff0c\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\u652f\u4ed8",confirmText:"\u6211\u77e5\u9053\u4e86",showCancel:!1}):r.pay&&r.pay(0,{},e.msg):r.pay&&r.pay(0,{},"\u8bf7\u6c42\u5e73\u53f0\u670d\u52a1\u5668\u5931\u8d25")}})):r.pay&&r.pay(0,{},"\u7528\u6237\u672a\u767b\u5f55\uff0c\u652f\u4ed8\u5931\u8d25\uff01")},virtualPay:function(a){var o=this;a.buyQuantity<=a.balance?(console.log("SQ_XGAMESDK:\u5f53\u524d\u5269\u4f59\u6e38\u620f\u5e01\u8db3\u591f"),wx.showModal({title:"\u652f\u4ed8\u63d0\u793a",content:"\u60a8\u5269\u4f59"+a.balance+"\u4e2a\u6e38\u620f\u5e01\u672a\u6d88\u8d39\uff0c\u672c\u6b21\u652f\u4ed8\u6263\u9664"+a.buyQuantity+"\u6e38\u620f\u5e01",showCancel:!1,confirmText:"\u6211\u77e5\u9053\u4e86",success:function(){o.midasDeductBalance(a)}})):(console.log("SQ_XGAMESDK:\u5f53\u524d\u5269\u4f59\u6e38\u620f\u5e01\u4e0d\u8db3\uff0c\u8c03\u8d77\u7c73\u5927\u5e08\u652f\u4ed8"),console.log(a),wx.requestMidasPayment({mode:"game",env:a.env,offerId:a.offerId,currencyType:a.currencyType,platform:"android",buyQuantity:a.buyQuantity,zoneId:a.zoneId,success:function(e){"requestMidasPayment:ok"==e.errMsg&&(console.log("SQ_XGAMESDK:\u7c73\u5927\u5e08\u652f\u4ed8\u5b8c\u6210"),o.midasDeductBalance(a))},fail:function(e){-1!==e.errMsg.indexOf("\u7528\u6237\u53d6\u6d88")?r.pay&&r.pay(0,{},"\u7528\u6237\u53d6\u6d88\u652f\u4ed8"):r.pay&&r.pay(0,{},"\u652f\u4ed8\u5931\u8d25:"+e.errMsg+"("+e.errCode+")")},complete:function(e){}}))},jminPay:function(e){console.log(e),console.log("pages/payment/result?token_id="+e.tokenId),wx.navigateToMiniProgram({appId:e.ios_pay_appid,path:"pages/payment/result?token_id="+e.tokenId,extraData:{},envVersion:"release",success:function(){}})},midasDeductBalance:function(a,e){console.log("SQ_XGAMESDK:\u6263\u9664\u6e38\u620f\u5e01");var o=this;var n=wx.getStorageSync("xz_pt_sdk_token");var t=wx.getStorageSync("xz_pt_uid");var i=wx.getStorageSync("xz_pt_sk");wx.request({url:HOST+"/?ct=xgame&ac=midasPay",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{sdk_token:n,uid:t,pt_order_num:a.pt_order_num,time:a.time,sign:a.sign,session_key:i},success:function(e){console.log("SQ_XGAMESDK:\u7c73\u5927\u5e08\u6263\u9664\u6e38\u620f\u5e01\u7ed3\u679c"),console.log(e.data),200==e.statusCode&&(1==e.data.state?(e={cp_order_num:o.order_info.cp_order_num,pt_order_num:a.pt_order_num,total_fee:o.order_info.total_fee,ext:o.order_info.ext},r.pay&&r.pay(1,e,"\u652f\u4ed8\u6210\u529f")):r.pay&&r.pay(0,{},"\u652f\u4ed8\u5931\u8d25"))},fail:function(){}})},uuid:function(e,a){var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var n,t=[];var i;if(e=e||o.length,a)for(n=0;n<a;n++)t[n]=o[0|Math.random()*e];else for(t[8]=t[13]=t[18]=t[23]="-",t[14]="4",n=0;n<36;n++)t[n]||(i=0|16*Math.random(),t[n]=o[19==n?3&i|8:i]);return t.join("")},getCommonParams:function(){var e=wx.getSystemInfoSync();var a=wx.getStorageSync("xz_pt_adcode");var o=wx.getStorageSync("xz_pt_uuid");return{game_id:config.game_id,package_name:config.package_name,package_version:config.package_version,channel_id:config.channel_id,uuid:o,device_name:e.model,device_version:e.system,game_version:game_version,platform:e.platform,device_type:"android"==e.platform?2:1,adcode:a}},msgCheck:function(e,a){console.log("[SQ_XGAMESDK]\u67e5\u770b\u6587\u672c\u662f\u5426\u6709\u8fdd\u89c4\u5185\u5bb9"),e=e||"";var o=wx.getStorageSync("xz_pt_uid");var n;is_init&&((n={}).game_id=config.game_id,n.package_name=config.package_name,n.uid=o,n.content=e,wx.request({url:HOST+"/?ct=xgame&ac=msgCheck",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:n,success:function(e){console.log("SQ_XGAMESDK:\u67e5\u770b\u6587\u672c\u662f\u5426\u6709\u8fdd\u89c4\u5185\u5bb9\u63a5\u53e3\u7ed3\u679c\uff1a"),console.log(e.data);e=e.data;e.state?a&&a(1,{is_sec:e.data.is_sec}):a&&a(0,{},e.msg)}}))},log:function(e){e=JSON.stringify(e);wx.request({url:HOST+"/?ct=xgame&ac=log",method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},data:{content:e},success:function(e){},fail:function(){}})}}}function run(e,a,o){e in SQ_XGAMESDK&&SQ_XGAMESDK[e](a,o)}exports.D12I=function(e,a){run("init",e,a)},exports.sdkLogin=function(e){run("login","",e)},exports.sdkPay=function(e,a){run("pay",e,a)},exports.sdkRole=function(e){run("role",e)},exports.sdkGetConfig=function(){return{game_id:config.game_id,package_name:config.package_name,package_version:config.package_version}},exports.sdkOpenCustomerService=function(){wx.openCustomerServiceConversation()},exports.sdkMsgCheck=function(e,a){run("msgCheck",e,a)};