var F=wx.$D;!function(o,l){l.un,l.uns;var i=l.static,a=l.class,e=l.getset,s=(l.__newvec,laya.utils.Browser),t=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,n=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),m=laya.utils.RunDriver,v=(laya.media.Sound,laya.media.SoundChannel),p=laya.media.SoundManager,_=(laya.display.Stage,laya.net.URL),w=laya.utils.Utils,u=(a(zli_mo,"laya.wx.mini.MiniAdpter"),zli_mo.getJson=function(i){return JSON.parse(i)},zli_mo.init=function(i,e){void 0===i&&(i=!1),void 0===e&&(e=!1),zli_mo._inited||(zli_mo.window=o).navigator.userAgent.indexOf("MiniGame")<0||(zli_mo._inited=!0,zli_mo.isZiYu=e,zli_mo.isPosMsgYu=i,zli_mo.EnvConfig={},zli_mo.isZiYu||(r.setNativeFileDir("/layaairGame"),r.existDir(r.fileNativeDir,c.create(zli_mo,zli_mo.onMkdirCallBack))),zli_mo.window.focus=function(){},l.getUrlPath=function(){},zli_mo.window.logtime=function(i){},zli_mo.window.alertTimeLog=function(i){},zli_mo.window.resetShareInfo=function(){},zli_mo.window.CanvasRenderingContext2D=function(){},zli_mo.window.CanvasRenderingContext2D.prototype=zli_mo.window.wx.createCanvas().getContext("2d").__proto__,zli_mo.window.document.body.appendChild=function(){},zli_mo.EnvConfig.pixelRatioInt=0,m.getPixelRatio=zli_mo.pixelRatio,zli_mo._preCreateElement=s.createElement,s.createElement=zli_mo.createElement,m.createShaderCondition=zli_mo.createShaderCondition,w.parseXMLFromString=zli_mo.parseXMLFromString,n._createInputElement=g._createInputElement,zli_mo.EnvConfig.load=f.prototype.load,f.prototype.load=y.prototype.load,zli_mo.isZiYu&&i&&wx.onMessage(function(i){i.isLoad&&(r.ziyuFileData[i.url]=i.data)}))},zli_mo.onMkdirCallBack=function(i,e){i||(r.filesListObj=JSON.parse(e.data))},zli_mo.pixelRatio=function(){if(!zli_mo.EnvConfig.pixelRatioInt)try{var i=wx.getSystemInfoSync();return zli_mo.EnvConfig.pixelRatioInt=i.pixelRatio,i.pixelRatio}catch(i){}return zli_mo.EnvConfig.pixelRatioInt},zli_mo.createElement=function(i){return"canvas"!=i?"textarea"==i||"input"==i?zli_mo.onCreateInput(i):"div"==i?((t=zli_mo._preCreateElement(i)).contains=function(i){return null},t.removeChild=function(i){},t):zli_mo._preCreateElement(i):(1==zli_mo.idx?zli_mo.isZiYu?(e=sharedCanvas).style={}:e=o.canvas:e=o.wx.createCanvas(),zli_mo.idx++,e);var e;var t},zli_mo.onCreateInput=function(i){i=zli_mo._preCreateElement(i);return i.focus=g.wxinputFocus,i.blur=g.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(i){},i.setType=function(i){},i.setFontFace=function(i){},i.addEventListener=function(i){},i.contains=function(i){return null},i.removeChild=function(i){},i},zli_mo.createShaderCondition=function(i){var e=this;return function(){return e[i.replace("this.","")]}},zli_mo.EnvConfig=null,zli_mo.window=null,zli_mo._preCreateElement=null,zli_mo._inited=!1,zli_mo.wxRequest=null,zli_mo.systemInfo=null,zli_mo.version="0.0.1",zli_mo.isZiYu=!1,zli_mo.isPosMsgYu=!1,zli_mo.parseXMLFromString=function(i){var e;i=i.replace(/>\s+</g,"><");try{e=(new o.Parser.DOMParser).parseFromString(i,"text/xml")}catch(i){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return e},zli_mo.idx=1,zli_mo),g=(a(og5m_,"laya.wx.mini.MiniImage"),og5m_.prototype._loadImage=function(i){var e=!1;-1==i.indexOf("layaNativeDir/")&&(e=!0,i=_.formatURL(i)),r.getFileInfo(i)?og5m_.onCreateImage(i,this,!e):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?r.downImg(i,new c(og5m_,og5m_.onDownImgCallBack,[i,this]),i):og5m_.onCreateImage(i,this,!0)},og5m_.onDownImgCallBack=function(i,e,t){t?e.onError(null):og5m_.onCreateImage(i,e)},og5m_.onCreateImage=function(e,t,i){var n;function kxj6g(){n.onload=null,n.onerror=null,delete t.imgCache[e]}i=(i=void 0===i?!1:i)?e:(i=r.getFileInfo(e).md5,r.getFileNativePath(i)),null==t.imgCache&&(t.imgCache={});function za(){kxj6g(),t.onLoaded(n)}function Aa(){kxj6g(),t.event("error","Load image failed")}"nativeimage"==t._type?((n=new s.window.Image).crossOrigin="",n.onload=za,n.onerror=Aa,n.src=i,t.imgCache[e]=n):new d.create(i,{onload:za,onerror:Aa,onCreate:function(i){n=i,t.imgCache[e]=i}})},a(q6kxw,"laya.wx.mini.MiniInput"),q6kxw._createInputElement=function(){n._initInput(n.area=s.createElement("textarea")),n._initInput(n.input=s.createElement("input")),n.inputContainer=s.createElement("div"),n.inputContainer.style.position="absolute",n.inputContainer.style.zIndex=1e5,s.container.appendChild(n.inputContainer),n.inputContainer.setPos=function(i,e){n.inputContainer.style.left=i+"px",n.inputContainer.style.top=e+"px"},l.stage.on("resize",null,q6kxw._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){o.dispatchEvent&&o.dispatchEvent("resize")}),p._soundClass=E,p._musicClass=E,o._videoClass=k},q6kxw._onStageResize=function(){l.stage._canvasTransform.identity().scale(s.width/h.canvas.width/m.getPixelRatio(),s.height/h.canvas.height/m.getPixelRatio())},q6kxw.wxinputFocus=function(i){var e=n.inputElement.target;e&&!e.editable||(u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(i){},fail:function(i){}}),u.window.wx.onKeyboardConfirm(function(i){i=i?i.value:"";e.text=i,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),u.window.wx.onKeyboardInput(function(i){i=i?i.value:"";e.multiline||-1==i.indexOf("\n")?(e.text=i,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},q6kxw.inputEnter=function(){n.inputElement.target.focus=!1},q6kxw.wxinputblur=function(){q6kxw.hideKeyboard()},q6kxw.hideKeyboard=function(){u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.hideKeyboard({success:function(i){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(i){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(i?i.errMsg:""))}})},q6kxw),y=(a(h_r2iz,"laya.wx.mini.MiniLoader"),(C=h_r2iz.prototype).load=function(i,e,t,n,o){void 0===t&&(t=!0),void 0===o&&(o=!1);var l=this;0===(l._url=i).indexOf("data:image")?l._type=e="image":l._type=e=e||l.getTypeFromUrl(i),l._cache=t,l._data=null;var a="ascii";-1!=i.indexOf(".fnt")?a="utf8":"arraybuffer"==e&&(a="");var s=w.getFileExtension(i);if(-1!=h_r2iz._fileTypeArr.indexOf(s))u.EnvConfig.load.call(this,i,e,t,n,o);else if(r.getFileInfo(i))u.EnvConfig.load.call(this,i,e,t,n,o);else{if(-1!=i.indexOf("layaNativeDir/"))return u.isZiYu?(s=r.ziyuFileData[i],void l.onLoaded(s)):(cosnole.log("read read"),void r.read(i,a,new c(h_r2iz,h_r2iz.onReadNativeCallBack,[a,i,e,t,n,o,l])));s=""==_.rootPath?i:i.split(_.rootPath)[0],-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?u.EnvConfig.load.call(l,i,e,t,n,o):r.readFile(s,a,new c(h_r2iz,h_r2iz.onReadNativeCallBack,[a,i,e,t,n,o,l]),i)}},C.resMgrLoad=function(i,n,e,t,o,l,a){void 0===e&&(e=0),void 0===t&&(t=!1),void 0===o&&(o=!1),void 0===l&&(l=0),void 0===a&&(a=3),-1!=i.indexOf("mpack")&&console.log("=============resMgrLoad url:",i),u.EnvConfig.resMgrLoad(i,(i,e,t)=>{h_r2iz.prototype.resMgrLoadCallBack(i,e,t,n)},e,t,o,l,a)},C.resMgrLoadCallBack=function(i,e,t,n){console.log("buff:::",i,t,r.fileNativeDir+"///"+r.fileListName),n(i,e,t)},C.clearRes=function(i,e){this.clearRes(i,e=void 0===e?!1:e);e=r.getFileInfo(i);!e||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(i=e.md5,e=r.getFileNativePath(i),r.remove(e))},h_r2iz.onReadNativeCallBack=function(i,e,t,n,o,l,a,s,r){void 0===n&&(n=!0),void 0===l&&(l=!1),(s=void 0===s?0:s)?1==s&&u.EnvConfig.load.call(a,e,t,n,o,l):(s="json"==t||"atlas"==t?u.getJson(r.data):"xml"==t?w.parseXMLFromString(r.data):r.data,a.onLoaded(s),!u.isZiYu&&u.isPosMsgYu&&"arraybuffer"!=t&&wx.postMessage({url:e,data:s,isLoad:!0}))},i(h_r2iz,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),h_r2iz),r=(a(kwvsqt,"laya.wx.mini.MiniFileMgr",t),kwvsqt.isLoadFile=function(i){return-1!=kwvsqt._fileTypeArr.indexOf(i)},kwvsqt.getFileInfo=function(i){i=i.split("?")[0],i=kwvsqt.filesListObj[i];return null==i?null:i},kwvsqt.onFileUpdate=function(i,e){var i=i.split("/"),i=i[i.length-1],t=kwvsqt.getFileInfo(e);null==t?kwvsqt.onSaveFile(e,i):t.readyUrl!=e&&kwvsqt.remove(i,e)},kwvsqt.exits=function(i,e){i=kwvsqt.getFileNativePath(i);kwvsqt.fs.getFileInfo({filePath:i,success:function(i){null!=e&&e.runWith([0,i])},fail:function(i){null!=e&&e.runWith([1,i])}})},kwvsqt.read=function(i,e,t,n){void 0===e&&(e="ascill"),i=""!=(n=void 0===n?"":n)?kwvsqt.getFileNativePath(i):i,kwvsqt.fs.readFile({filePath:i,encoding:e,success:function(i){null!=t&&t.runWith([0,i])},fail:function(i){i&&""!=n?kwvsqt.down(n,e,t,n):null!=t&&t.runWith([1])}})},kwvsqt.readNativeFile=function(i,e){kwvsqt.fs.readFile({filePath:i,encoding:"",success:function(i){null!=e&&e.runWith([0])},fail:function(i){null!=e&&e.runWith([1])}})},kwvsqt.down=function(i,e,t,n){void 0===e&&(e="ascill"),void 0===n&&(n="");var o=kwvsqt.getFileNativePath(n);kwvsqt.wxdown({url:i,filePath:o,success:function(i){200===i.statusCode&&kwvsqt.readFile(i.filePath,e,t,n)},fail:function(i){null!=t&&t.runWith([1,i])}}).onProgressUpdate(function(i){null!=t&&t.runWith([2,i.progress])})},kwvsqt.readFile=function(e,i,t,n){void 0===n&&(n=""),kwvsqt.fs.readFile({filePath:e,encoding:i=void 0===i?"ascill":i,success:function(i){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||kwvsqt.onFileUpdate(e,n),null!=t&&t.runWith([0,i])},fail:function(i){i&&null!=t&&t.runWith([1,i])}})},kwvsqt.downImg=function(i,e,t){void 0===t&&(t="");kwvsqt.wxdown({url:i,success:function(i){200===i.statusCode&&kwvsqt.copyFile(i.tempFilePath,t,e)},fail:function(i){null!=e&&e.runWith([1,i])}})},kwvsqt.copyFile=function(i,e,t){var n=i.split("/"),o=n[n.length-1],l=(e.split("?")[0],kwvsqt.getFileInfo(e)),n=kwvsqt.getFileNativePath(o);kwvsqt.fs.copyFile({srcPath:i,destPath:n,success:function(i){l?l.readyUrl!=e&&kwvsqt.remove(o,e,t):(kwvsqt.onSaveFile(e,o),null!=t&&t.runWith([0]))},fail:function(i){null!=t&&t.runWith([1,i])}})},kwvsqt.getFileNativePath=function(i){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+i},kwvsqt.remove=function(e,t,n){void 0===t&&(t="");var i=kwvsqt.getFileInfo(t),o=kwvsqt.getFileNativePath(i.md5);l.loader.clearRes(i.readyUrl),kwvsqt.fs.unlink({filePath:o,success:function(i){""!=t&&kwvsqt.onSaveFile(t,e),null!=n&&n.runWith([0])},fail:function(i){}})},kwvsqt.onSaveFile=function(i,e){var t=i.split("?")[0];kwvsqt.filesListObj[t]={md5:e,readyUrl:i},kwvsqt.fs.writeFile({filePath:kwvsqt.fileNativeDir+"/"+kwvsqt.fileListName,encoding:"utf8",data:JSON.stringify(kwvsqt.filesListObj),success:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",i)},fail:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",i)}})},kwvsqt.existDir=function(i,e){kwvsqt.fs.mkdir({dirPath:i,success:function(i){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(i){-1!=i.errMsg.indexOf("file already exists")?kwvsqt.readSync(kwvsqt.fileListName,"utf8",e):null!=e&&e.runWith([1,i])}})},kwvsqt.readSync=function(i,e,t,n){void 0===e&&(e="ascill"),void 0===n&&(n="");var o,e=kwvsqt.getFileNativePath(i);try{o=kwvsqt.fs.readFileSync(e),null!=t&&t.runWith([0,{data:o}])}catch(i){null!=t&&t.runWith([1])}},kwvsqt.readCache=function(){},kwvsqt.writeCache=function(i){var e=readyUrl.split("?")[0];kwvsqt.filesListObj[e]={md5:md5Name,readyUrl:readyUrl},kwvsqt.fs.writeFile({filePath:kwvsqt.fileNativeDir+"/"+kwvsqt.fileListName,encoding:"utf8",data:JSON.stringify(kwvsqt.filesListObj),success:function(i){},fail:function(i){}})},kwvsqt.setNativeFileDir=function(i){kwvsqt.fileNativeDir=wx.env.USER_DATA_PATH+i},kwvsqt.filesListObj={},kwvsqt.fileNativeDir=null,kwvsqt.fileListName="layaairfiles.txt",kwvsqt.ziyuFileData={},i(kwvsqt,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),kwvsqt),E=(a(ol5gm_,"laya.wx.mini.MiniSound",t),(C=ol5gm_.prototype).load=function(i){var e;i=_.formatURL(i),this.url=i,ol5gm_._audioCache[i]?this.event("complete"):(this._sound.onCanplay(function(){e.loaded=!0,e.event("complete"),ol5gm_._audioCache[e.url]=e}),this._sound.onError(function(i){console.error("errCode="+i.errCode+"  errMsg="+i.errMsg),e.event("error")}),this._sound.src=i,e=this)},C.play=function(i,e){var t,n;return void 0===i&&(i=0),void 0===e&&(e=0),n=(t=this.url==p._tMusic?(ol5gm_._musicAudio||(ol5gm_._musicAudio=this._sound),ol5gm_._musicAudio):this._sound,this._chanell),t.src=this.url,t.startTime=0,n.isStopped&&(n.url=this.url,n.loops=e,n.startTime=i,n.play(),p.addChannel(n)),n},C.dispose=function(){var i=ol5gm_._audioCache[this.url];i&&(i.src="",delete ol5gm_._audioCache[this.url])},e(0,C,"duration",function(){return this._sound.duration}),ol5gm_._createSound=function(){return ol5gm_._id++,u.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},ol5gm_._musicAudio=null,ol5gm_._id=0,ol5gm_._audioCache={},ol5gm_._null=void 0,ol5gm_),x=(a(rhn128,"laya.wx.mini.MiniSoundChannel",v),(i=rhn128.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(l.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__onNull=function(){},i.play=function(){this.isStopped=!1,p.addChannel(this),this._audio&&this._audio.play()},i.stop=function(){this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},e(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),e(0,i,"duration",function(){return this._audio?this._audio.duration:0}),e(0,i,"volume",function(){return 1},function(i){}),rhn128._null=void 0,rhn128),k=(a(ces3u,"laya.wx.mini.MiniVideo"),(t=ces3u.prototype).on=function(i,e,t){"loadedmetadata"==i?(this.onPlayFunc=t.bind(e),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=t.bind(e),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},t.onTimeUpdateFunc=function(i){this.position=i.position,this._duration=i.duration},t.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},t.onended=function(i,e){this.onEndedFunC=e.bind(i),this.videoElement.onended=this.onEndedFunction.bind(this)},t.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},t.off=function(i,e,t){"loadedmetadata"==i?(this.onPlayFunc=t.bind(e),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=t.bind(e),this.videoElement.offEnded=this.onEndedFunction.bind(this))},t.load=function(i){this.videoElement&&(this.videoElement.src=i)},t.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},t.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},t.size=function(i,e){this.videoElement&&(this.videoElement.width=i,this.videoElement.height=e)},t.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},t.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},e(0,t,"duration",function(){return this._duration}),e(0,t,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(i){this.videoElement&&(this.videoElement.initialTime=i)}),e(0,t,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),e(0,t,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),e(0,t,"ended",function(){return this.videoend}),e(0,t,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(i){this.videoElement&&(this.videoElement.loop=i)}),e(0,t,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(i){this.videoElement&&(this.videoElement.playbackRate=i)}),e(0,t,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(i){this.videoElement&&(this.videoElement.muted=i)}),e(0,t,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),e(0,t,"x",function(){return this.videoElement?this.videoElement.x:0},function(i){this.videoElement&&(this.videoElement.x=i)}),e(0,t,"y",function(){return this.videoElement?this.videoElement.y:0},function(i){this.videoElement&&(this.videoElement.y=i)}),e(0,t,"currentSrc",function(){return this.videoElement.src}),e(0,t,"src",function(){return this.videoElement?this.videoElement.src:0},function(i){this.videoElement&&(this.videoElement.src=i)}),e(0,t,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(i){this.videoElement&&(this.videoElement.controls=i)}),e(0,t,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(i){this.videoElement&&(this.videoElement.autoplay=i)}),ces3u);function ces3u(){this.videoend=!1,this.videourl="",this.videoElement=u.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function rhn128(i){this._audio=null,this._onEnd=null,rhn128.__super.call(this),this.isStopped=!0,this._audio=i,this._onEnd=w.bind(this.__onEnd,this),i.onEnded(this._onEnd)}function ol5gm_(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,ol5gm_.__super.call(this),this._sound=ol5gm_._createSound(),this._chanell=new x(this._sound)}function kwvsqt(){kwvsqt.__super.call(this)}function h_r2iz(){}var C;function q6kxw(){}function og5m_(){}function zli_mo(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(i,e){"use strict";for(var t in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[t];n&&n.__isclass&&(e[t]=n)}});