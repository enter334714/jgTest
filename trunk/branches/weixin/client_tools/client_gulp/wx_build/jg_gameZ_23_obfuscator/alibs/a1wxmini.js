var c=wx.$a;!function(o,a){a.un,a.uns;var e=a.static,l=a.class,t=a.getset,r=(a.__newvec,laya.utils.Browser),i=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,n=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),p=laya.utils.RunDriver,v=(laya.media.Sound,laya.media.SoundChannel),m=laya.media.SoundManager,g=(laya.display.Stage,laya.net.URL),w=laya.utils.Utils,s=(l(r7tp5,"laya.wx.mini.MiniAdpter"),r7tp5.getJson=function(e){return JSON.parse(e)},r7tp5.init=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),r7tp5._inited||(r7tp5.window=o).navigator.userAgent.indexOf("MiniGame")<0||(r7tp5._inited=!0,r7tp5.isZiYu=t,r7tp5.isPosMsgYu=e,r7tp5.EnvConfig={},r7tp5.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,c.create(r7tp5,r7tp5.onMkdirCallBack))),r7tp5.window.focus=function(){},a.getUrlPath=function(){},r7tp5.window.logtime=function(e){},r7tp5.window.alertTimeLog=function(e){},r7tp5.window.resetShareInfo=function(){},r7tp5.window.CanvasRenderingContext2D=function(){},r7tp5.window.CanvasRenderingContext2D.prototype=r7tp5.window.wx.createCanvas().getContext("2d").__proto__,r7tp5.window.document.body.appendChild=function(){},r7tp5.EnvConfig.pixelRatioInt=0,p.getPixelRatio=r7tp5.pixelRatio,r7tp5._preCreateElement=r.createElement,r.createElement=r7tp5.createElement,p.createShaderCondition=r7tp5.createShaderCondition,w.parseXMLFromString=r7tp5.parseXMLFromString,n._createInputElement=_._createInputElement,r7tp5.EnvConfig.load=f.prototype.load,f.prototype.load=y.prototype.load,r7tp5.isZiYu&&e&&wx.onMessage(function(e){e.isLoad&&(u.ziyuFileData[e.url]=e.data)}))},r7tp5.onMkdirCallBack=function(e,t){e||(u.filesListObj=JSON.parse(t.data))},r7tp5.pixelRatio=function(){if(!r7tp5.EnvConfig.pixelRatioInt)try{var e=wx.getSystemInfoSync();return r7tp5.EnvConfig.pixelRatioInt=e.pixelRatio,e.pixelRatio}catch(e){}return r7tp5.EnvConfig.pixelRatioInt},r7tp5.createElement=function(e){return"canvas"!=e?"textarea"==e||"input"==e?r7tp5.onCreateInput(e):"div"==e?((i=r7tp5._preCreateElement(e)).contains=function(e){return null},i.removeChild=function(e){},i):r7tp5._preCreateElement(e):(1==r7tp5.idx?r7tp5.isZiYu?(t=sharedCanvas).style={}:t=o.canvas:t=o.wx.createCanvas(),r7tp5.idx++,t);var t;var i},r7tp5.onCreateInput=function(e){e=r7tp5._preCreateElement(e);return e.focus=_.wxinputFocus,e.blur=_.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(e){},e.setType=function(e){},e.setFontFace=function(e){},e.addEventListener=function(e){},e.contains=function(e){return null},e.removeChild=function(e){},e},r7tp5.createShaderCondition=function(e){var t=this;return function(){return t[e.replace("this.","")]}},r7tp5.EnvConfig=null,r7tp5.window=null,r7tp5._preCreateElement=null,r7tp5._inited=!1,r7tp5.wxRequest=null,r7tp5.systemInfo=null,r7tp5.version="0.0.1",r7tp5.isZiYu=!1,r7tp5.isPosMsgYu=!1,r7tp5.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new o.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return t},r7tp5.idx=1,r7tp5),_=(l(oybc,"laya.wx.mini.MiniImage"),oybc.prototype._loadImage=function(e){var t=!1;-1==e.indexOf("layaNativeDir/")&&(t=!0,e=g.formatURL(e)),u.getFileInfo(e)?oybc.onCreateImage(e,this,!t):-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?u.downImg(e,new c(oybc,oybc.onDownImgCallBack,[e,this]),e):oybc.onCreateImage(e,this,!0)},oybc.onDownImgCallBack=function(e,t,i){i?t.onError(null):oybc.onCreateImage(e,t)},oybc.onCreateImage=function(t,i,e){var n;function hzkqd(){n.onload=null,n.onerror=null,delete i.imgCache[t]}e=(e=void 0===e?!1:e)?t:(e=u.getFileInfo(t).md5,u.getFileNativePath(e)),null==i.imgCache&&(i.imgCache={});function As(){hzkqd(),i.onLoaded(n)}function Ds(){hzkqd(),i.event("error","Load image failed")}"nativeimage"==i._type?((n=new r.window.Image).crossOrigin="",n.onload=As,n.onerror=Ds,n.src=e,i.imgCache[t]=n):new d.create(e,{onload:As,onerror:Ds,onCreate:function(e){n=e,i.imgCache[t]=e}})},l(vkhzd,"laya.wx.mini.MiniInput"),vkhzd._createInputElement=function(){n._initInput(n.area=r.createElement("textarea")),n._initInput(n.input=r.createElement("input")),n.inputContainer=r.createElement("div"),n.inputContainer.style.position="absolute",n.inputContainer.style.zIndex=1e5,r.container.appendChild(n.inputContainer),n.inputContainer.setPos=function(e,t){n.inputContainer.style.left=e+"px",n.inputContainer.style.top=t+"px"},a.stage.on("resize",null,vkhzd._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){o.dispatchEvent&&o.dispatchEvent("resize")}),m._soundClass=E,m._musicClass=E,o._videoClass=C},vkhzd._onStageResize=function(){a.stage._canvasTransform.identity().scale(r.width/h.canvas.width/p.getPixelRatio(),r.height/h.canvas.height/p.getPixelRatio())},vkhzd.wxinputFocus=function(e){var t=n.inputElement.target;t&&!t.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:t.text,maxLength:t.maxChars,multiple:t.multiline,confirmHold:!0,confirmType:"done",success:function(e){},fail:function(e){}}),s.window.wx.onKeyboardConfirm(function(e){e=e?e.value:"";t.text=e,t.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(e){e=e?e.value:"";t.multiline||-1==e.indexOf("\n")?(t.text=e,t.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},vkhzd.inputEnter=function(){n.inputElement.target.focus=!1},vkhzd.wxinputblur=function(){vkhzd.hideKeyboard()},vkhzd.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(e){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(e){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(e?e.errMsg:""))}})},vkhzd),y=(l(t8r7q,"laya.wx.mini.MiniLoader"),(F=t8r7q.prototype).load=function(e,t,i,n,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var a=this;0===(a._url=e).indexOf("data:image")?a._type=t="image":a._type=t=t||a.getTypeFromUrl(e),a._cache=i,a._data=null;var l="ascii";-1!=e.indexOf(".fnt")?l="utf8":"arraybuffer"==t&&(l="");var r=w.getFileExtension(e);if(-1!=t8r7q._fileTypeArr.indexOf(r))s.EnvConfig.load.call(this,e,t,i,n,o);else if(u.getFileInfo(e))s.EnvConfig.load.call(this,e,t,i,n,o);else{if(-1!=e.indexOf("layaNativeDir/"))return s.isZiYu?(r=u.ziyuFileData[e],void a.onLoaded(r)):(cosnole.log("read read"),void u.read(e,l,new c(t8r7q,t8r7q.onReadNativeCallBack,[l,e,t,i,n,o,a])));r=""==g.rootPath?e:e.split(g.rootPath)[0],-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?s.EnvConfig.load.call(a,e,t,i,n,o):u.readFile(r,l,new c(t8r7q,t8r7q.onReadNativeCallBack,[l,e,t,i,n,o,a]),e)}},F.resMgrLoad=function(e,n,t,i,o,a,l){void 0===t&&(t=0),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===l&&(l=3),-1!=e.indexOf("mpack")&&console.log("=============resMgrLoad url:",e),s.EnvConfig.resMgrLoad(e,(e,t,i)=>{t8r7q.prototype.resMgrLoadCallBack(e,t,i,n)},t,i,o,a,l)},F.resMgrLoadCallBack=function(e,t,i,n){console.log("buff:::",e,i,u.fileNativeDir+"///"+u.fileListName),n(e,t,i)},F.clearRes=function(e,t){this.clearRes(e,t=void 0===t?!1:t);t=u.getFileInfo(e);!t||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(e=t.md5,t=u.getFileNativePath(e),u.remove(t))},t8r7q.onReadNativeCallBack=function(e,t,i,n,o,a,l,r,u){void 0===n&&(n=!0),void 0===a&&(a=!1),(r=void 0===r?0:r)?1==r&&s.EnvConfig.load.call(l,t,i,n,o,a):(r="json"==i||"atlas"==i?s.getJson(u.data):"xml"==i?w.parseXMLFromString(u.data):u.data,l.onLoaded(r),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:t,data:r,isLoad:!0}))},e(t8r7q,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),t8r7q),u=(l(gw2_eu,"laya.wx.mini.MiniFileMgr",i),gw2_eu.isLoadFile=function(e){return-1!=gw2_eu._fileTypeArr.indexOf(e)},gw2_eu.getFileInfo=function(e){e=e.split("?")[0],e=gw2_eu.filesListObj[e];return null==e?null:e},gw2_eu.onFileUpdate=function(e,t){var e=e.split("/"),e=e[e.length-1],i=gw2_eu.getFileInfo(t);null==i?gw2_eu.onSaveFile(t,e):i.readyUrl!=t&&gw2_eu.remove(e,t)},gw2_eu.exits=function(e,t){e=gw2_eu.getFileNativePath(e);gw2_eu.fs.getFileInfo({filePath:e,success:function(e){null!=t&&t.runWith([0,e])},fail:function(e){null!=t&&t.runWith([1,e])}})},gw2_eu.read=function(e,t,i,n){void 0===t&&(t="ascill"),e=""!=(n=void 0===n?"":n)?gw2_eu.getFileNativePath(e):e,gw2_eu.fs.readFile({filePath:e,encoding:t,success:function(e){null!=i&&i.runWith([0,e])},fail:function(e){e&&""!=n?gw2_eu.down(n,t,i,n):null!=i&&i.runWith([1])}})},gw2_eu.readNativeFile=function(e,t){gw2_eu.fs.readFile({filePath:e,encoding:"",success:function(e){null!=t&&t.runWith([0])},fail:function(e){null!=t&&t.runWith([1])}})},gw2_eu.down=function(e,t,i,n){void 0===t&&(t="ascill"),void 0===n&&(n="");var o=gw2_eu.getFileNativePath(n);gw2_eu.wxdown({url:e,filePath:o,success:function(e){200===e.statusCode&&gw2_eu.readFile(e.filePath,t,i,n)},fail:function(e){null!=i&&i.runWith([1,e])}}).onProgressUpdate(function(e){null!=i&&i.runWith([2,e.progress])})},gw2_eu.readFile=function(t,e,i,n){void 0===n&&(n=""),gw2_eu.fs.readFile({filePath:t,encoding:e=void 0===e?"ascill":e,success:function(e){-1==t.indexOf("http://")&&-1==t.indexOf("https://")||gw2_eu.onFileUpdate(t,n),null!=i&&i.runWith([0,e])},fail:function(e){e&&null!=i&&i.runWith([1,e])}})},gw2_eu.downImg=function(e,t,i){void 0===i&&(i="");gw2_eu.wxdown({url:e,success:function(e){200===e.statusCode&&gw2_eu.copyFile(e.tempFilePath,i,t)},fail:function(e){null!=t&&t.runWith([1,e])}})},gw2_eu.copyFile=function(e,t,i){var n=e.split("/"),o=n[n.length-1],a=(t.split("?")[0],gw2_eu.getFileInfo(t)),n=gw2_eu.getFileNativePath(o);gw2_eu.fs.copyFile({srcPath:e,destPath:n,success:function(e){a?a.readyUrl!=t&&gw2_eu.remove(o,t,i):(gw2_eu.onSaveFile(t,o),null!=i&&i.runWith([0]))},fail:function(e){null!=i&&i.runWith([1,e])}})},gw2_eu.getFileNativePath=function(e){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},gw2_eu.remove=function(t,i,n){void 0===i&&(i="");var e=gw2_eu.getFileInfo(i),o=gw2_eu.getFileNativePath(e.md5);a.loader.clearRes(e.readyUrl),gw2_eu.fs.unlink({filePath:o,success:function(e){""!=i&&gw2_eu.onSaveFile(i,t),null!=n&&n.runWith([0])},fail:function(e){}})},gw2_eu.onSaveFile=function(e,t){var i=e.split("?")[0];gw2_eu.filesListObj[i]={md5:t,readyUrl:e},gw2_eu.fs.writeFile({filePath:gw2_eu.fileNativeDir+"/"+gw2_eu.fileListName,encoding:"utf8",data:JSON.stringify(gw2_eu.filesListObj),success:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",e)},fail:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",e)}})},gw2_eu.existDir=function(e,t){gw2_eu.fs.mkdir({dirPath:e,success:function(e){null!=t&&t.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?gw2_eu.readSync(gw2_eu.fileListName,"utf8",t):null!=t&&t.runWith([1,e])}})},gw2_eu.readSync=function(e,t,i,n){void 0===t&&(t="ascill"),void 0===n&&(n="");var o,t=gw2_eu.getFileNativePath(e);try{o=gw2_eu.fs.readFileSync(t),null!=i&&i.runWith([0,{data:o}])}catch(e){null!=i&&i.runWith([1])}},gw2_eu.readCache=function(){},gw2_eu.writeCache=function(e){var t=readyUrl.split("?")[0];gw2_eu.filesListObj[t]={md5:md5Name,readyUrl:readyUrl},gw2_eu.fs.writeFile({filePath:gw2_eu.fileNativeDir+"/"+gw2_eu.fileListName,encoding:"utf8",data:JSON.stringify(gw2_eu.filesListObj),success:function(e){},fail:function(e){}})},gw2_eu.setNativeFileDir=function(e){gw2_eu.fileNativeDir=wx.env.USER_DATA_PATH+e},gw2_eu.filesListObj={},gw2_eu.fileNativeDir=null,gw2_eu.fileListName="layaairfiles.txt",gw2_eu.ziyuFileData={},e(gw2_eu,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),gw2_eu),E=(l(al9mb$,"laya.wx.mini.MiniSound",i),(F=al9mb$.prototype).load=function(e){var t;e=g.formatURL(e),this.url=e,al9mb$._audioCache[e]?this.event("complete"):(this._sound.onCanplay(function(){t.loaded=!0,t.event("complete"),al9mb$._audioCache[t.url]=t}),this._sound.onError(function(e){console.error("errCode="+e.errCode+"  errMsg="+e.errMsg),t.event("error")}),this._sound.src=e,t=this)},F.play=function(e,t){var i,n;return void 0===e&&(e=0),void 0===t&&(t=0),n=(i=this.url==m._tMusic?(al9mb$._musicAudio||(al9mb$._musicAudio=this._sound),al9mb$._musicAudio):this._sound,this._chanell),i.src=this.url,i.startTime=0,n.isStopped&&(n.url=this.url,n.loops=t,n.startTime=e,n.play(),m.addChannel(n)),n},F.dispose=function(){var e=al9mb$._audioCache[this.url];e&&(e.src="",delete al9mb$._audioCache[this.url])},t(0,F,"duration",function(){return this._sound.duration}),al9mb$._createSound=function(){return al9mb$._id++,s.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},al9mb$._musicAudio=null,al9mb$._id=0,al9mb$._audioCache={},al9mb$._null=void 0,al9mb$),x=(l(w04o,"laya.wx.mini.MiniSoundChannel",v),(e=w04o.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.__onNull=function(){},e.play=function(){this.isStopped=!1,m.addChannel(this),this._audio&&this._audio.play()},e.stop=function(){this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},t(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),t(0,e,"duration",function(){return this._audio?this._audio.duration:0}),t(0,e,"volume",function(){return 1},function(e){}),w04o._null=void 0,w04o),C=(l(shvxjn,"laya.wx.mini.MiniVideo"),(i=shvxjn.prototype).on=function(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},i.onTimeUpdateFunc=function(e){this.position=e.position,this._duration=e.duration},i.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},i.onended=function(e,t){this.onEndedFunC=t.bind(e),this.videoElement.onended=this.onEndedFunction.bind(this)},i.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},i.off=function(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.offEnded=this.onEndedFunction.bind(this))},i.load=function(e){this.videoElement&&(this.videoElement.src=e)},i.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},i.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},i.size=function(e,t){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=t)},i.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},i.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},t(0,i,"duration",function(){return this._duration}),t(0,i,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(e){this.videoElement&&(this.videoElement.initialTime=e)}),t(0,i,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),t(0,i,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),t(0,i,"ended",function(){return this.videoend}),t(0,i,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(e){this.videoElement&&(this.videoElement.loop=e)}),t(0,i,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(e){this.videoElement&&(this.videoElement.playbackRate=e)}),t(0,i,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(e){this.videoElement&&(this.videoElement.muted=e)}),t(0,i,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),t(0,i,"x",function(){return this.videoElement?this.videoElement.x:0},function(e){this.videoElement&&(this.videoElement.x=e)}),t(0,i,"y",function(){return this.videoElement?this.videoElement.y:0},function(e){this.videoElement&&(this.videoElement.y=e)}),t(0,i,"currentSrc",function(){return this.videoElement.src}),t(0,i,"src",function(){return this.videoElement?this.videoElement.src:0},function(e){this.videoElement&&(this.videoElement.src=e)}),t(0,i,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(e){this.videoElement&&(this.videoElement.controls=e)}),t(0,i,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(e){this.videoElement&&(this.videoElement.autoplay=e)}),shvxjn);function shvxjn(){this.videoend=!1,this.videourl="",this.videoElement=s.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function w04o(e){this._audio=null,this._onEnd=null,w04o.__super.call(this),this.isStopped=!0,this._audio=e,this._onEnd=w.bind(this.__onEnd,this),e.onEnded(this._onEnd)}function al9mb$(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,al9mb$.__super.call(this),this._sound=al9mb$._createSound(),this._chanell=new x(this._sound)}function gw2_eu(){gw2_eu.__super.call(this)}function t8r7q(){}var F;function vkhzd(){}function oybc(){}function r7tp5(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var i in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(t[i]=n)}});