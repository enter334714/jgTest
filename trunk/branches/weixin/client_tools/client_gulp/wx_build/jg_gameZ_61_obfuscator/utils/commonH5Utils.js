var commonSdkMd5=require("./commonMd5.js");export default class commonH5Utils{constructor(){this.checkConfigListener="",this.checkOrderListener="",this.statisticsListenerProxy="",this.location="",this.configInfoReturn,this.gzyasjhInfo={},this.configCheckUrl="https://static.public.sdk.guangkatf.com/config",this.sdkInfo={gameSimpleName:"",sdkSimpleName:"",sdkVersionCode:"",sdkClientVersion:"",loginCheckUrl:"",payOrderUrl:"",payCheckUrl:"",logReportUrl:"",statisticsUrl:"",channelParameter1:"",channelParameter2:"",channelId:"",custom:""},this.loginInfo={gameSimpleName:"",sdkSimpleName:"",sdkVersionCode:"",result:"",userType:"",openId:"",userName:"",sign:"",timestamp:"",other:"",serverSign:"",custom:"",custom2:"",di:"",nt:"",gv:"",ot:"",imei:"",rl:"",c1:"",c2:""},this.payInfo={serverId:"",serverName:"",playerId:"",playerName:"",playerLevel:"",postAmount:"",productId:"",productName:"",productDesc:"",custom:"",exchange:"",otherInfo:"",timestamp:"",tsign:"",userId:"",di:"",nt:"",gv:"",ot:"",imei:"",rl:"",c1:"",c2:"",coinName:"",coinNum:""},this.orderInfo={queryID:"",serverID:"",roleId:"",postTime:"",postAmount:"",productID:"",currency:"",other:"",products:"",danjiConfig:""},this.roleInfo={roleId:"",roleName:"",roleLevel:"",roleSex:"",serverId:"",serverName:"",roleCTime:"",partyName:"",roleType:"",roleChangeTime:"",vipLevel:"",diamond:"",moneyType:"",custom:""}}static getInstance(){return commonH5Utils.instance||(commonH5Utils.instance=new commonH5Utils),commonH5Utils.instance}connection(s,e,o){var t,n=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState)if(200<=i.status&&i.status<300||304==i){n.sdkLog("H5SDKLog||"+s+"||Connect server successful:"+i.responseText);try{n.sdkLog(typeof i.response);var o=i.response;let e=i.responseText;o&&"object"==typeof o&&(e=JSON.stringify(o)),n.responseListener(s,JSON.parse(e),i.status)}catch(e){n.sdkLog(e)}}else n.noResponse(s),n.sdkLog("H5SDKLog||"+s+"||Fail to connect server!");n.sdkLog("readyState: "+i.readyState)},"login"==s?(i.open("post",e,!1),t="data="+JSON.stringify(this.loginInfo),n.sdkLog("login url: "+e),n.sdkLog("login data: "+t),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(t)):"submitInfo"==s?(t=this.addUrlParam("",o),i.open("post",e,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(t.substring(1))):"statistics"==s?(i.open("post",e,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t=JSON.stringify(o),i.send(t)):("configInfo"==s?(e=e+"/"+this.sdkInfo.gameSimpleName+"/"+this.sdkInfo.sdkSimpleName+"/"+this.sdkInfo.sdkVersionCode+"/config.json",n.sdkLog("configInfo url:"+e)):"location"!=s&&(e="payCheck"==s?(t=JSON.stringify(o),window.conch||(t=encodeURIComponent(t)),e+"/"+this.sdkInfo.gameSimpleName+"/"+this.sdkInfo.sdkSimpleName+"/"+this.sdkInfo.sdkVersionCode+"?data="+t):(e=e+"/"+this.sdkInfo.gameSimpleName+"/"+this.sdkInfo.sdkSimpleName+"/"+this.sdkInfo.sdkVersionCode,this.addUrlParam(e,o))),n.sdkLog(e),i.open("get",e,!1),i.send(null))}configCheck(e,o){for(var s in e="string"==typeof e?JSON.parse(e):e)this.sdkInfo[s]=e[s],"otherInfo"===s&&this.setGzyasjhInfo(e[s]),this.sdkLog(this.sdkInfo[s]);this.checkConfigListener=o,this.sdkLog("H5SDKLog||Ask configCheck to server with sdkInfo:"+JSON.stringify(this.sdkInfo)),this.connection("configInfo",this.configCheckUrl,this.sdkInfo)}loginCheck(e){for(var o in e)this.loginInfo[o]=e[o];this.loginInfo.sign=e.token,this.loginInfo.custom=commonH5SDK.h5Proxy.loginExt,this.loginInfo=this._addDataToTable(this.loginInfo),this.sdkLog("H5SDKLog||Ask loginCheck to server with loginInfo:"+JSON.stringify(this.loginInfo)),this.connection("login",this.sdkInfo.loginCheckUrl,this.loginInfo)}payCheck(e,o){for(var s in e)this.payInfo[s]=e[s];null!=e.openId&&0<e.openId.length&&(this.payInfo.userId=e.openId),this.payInfo.tsign=commonSdkMd5(this.payInfo.timestamp+"12*&#**@321"),this.checkOrderListener=o,this.payInfo=this._addDataToTable(this.payInfo),this.sdkLog("H5SDKLog||Ask payCheck to server with payInfo:"+JSON.stringify(this.payInfo)),this.connection("payCheck",this.sdkInfo.payOrderUrl,this.payInfo)}submitInfo(e,o){if(null!=o)for(var s in o)this.roleInfo[s]=o[s];var t="",t=(-1!=e.indexOf(":")&&(t=e.substring(e.indexOf(":")+1)),{pid:this.roleInfo.roleId,pn:this.roleInfo.roleName,sid:this.roleInfo.serverId,sn:this.roleInfo.serverName,lv:this.roleInfo.roleLevel,openId:this.loginInfo.openId,gameSimpleName:this.sdkInfo.gameSimpleName,sdkSimpleName:this.sdkInfo.sdkSimpleName,sdkVersionCode:this.sdkInfo.sdkVersionCode,di:"",nt:"",gv:"",ot:"",imei:"",rl:"",c1:this.sdkInfo.channelParameter1,c2:this.sdkInfo.channelParameter2,eventName:t}),t=this._addDataToTable(t),n=(n=(new Date).getTime().toString()).substring(0,n.length-3),i=(this.sdkLog(JSON.stringify(t)),"action="+e+"jssdk=yt="+n+"12909asdask23"),e={action:e,data:JSON.stringify(t),jssdk:"y",t:n,ta:"default",test:"test",sign:commonSdkMd5(i)},t=(this.sdkLog("H5SDKLog||Submit to server with roleCheckInfo:"+JSON.stringify(e)),this.sdkInfo.logReportUrl+"?ya_game="+this.sdkInfo.gameSimpleName+"&ya_sn="+this.sdkInfo.sdkSimpleName+"&ya_ssv="+this.sdkInfo.sdkVersionCode);this.connection("submitInfo",t,e)}statistics(e,o){this.statisticsListenerProxy=o,this.connection("statistics",this.sdkInfo.statisticsUrl,e)}addUrlParam(e,o){for(var s in o)e=(e+=-1==e.indexOf("?")?"?":"&")+s+"="+o[s];return e}responseListener(e,o,s){if("configInfo"==e)1==o.code?(this.sdkInfo.payCheckUrl=o.data.payCheckUrl,this.sdkInfo.payOrderUrl=o.data.payOrderUrl,this.sdkInfo.loginCheckUrl=o.data.loginCheckUrl,this.sdkInfo.logReportUrl=o.data.logReportUrl,this.sdkInfo.channelParameter1=o.data.channelParameter1,this.sdkInfo.custom=o.data.custom,this.sdkInfo.channelId=o.data.channelSimpleName,this.loginInfo.c1=o.data.channelParameter1,this.payInfo.c1=o.data.channelParameter1,this.sdkInfo.channelParameter2=o.data.channelParameter2,this.loginInfo.c2=o.data.channelParameter2,this.payInfo.c2=o.data.channelParameter2,this.sdkLog("H5SDKLog||ConfigCheck successful with configInfo:"+JSON.parse(o.data.clientConfig)),this.configInfoReturn=JSON.parse(o.data.clientConfig),this.checkConfigListener.onCheckConfigSuccess()):(this.sdkLog("H5SDKLog||No configs!Please check whether the sdkInfo is matching or not!"),this.checkConfigListener.onCheckConfigFail());else if("login"==e)1==o.code?(this.sdkLog("H5SDKLog||LoginCheck successful with loginInfo:"+JSON.stringify(o)),this.loginInfo.openId=o.openId,this.payInfo.userId=o.openId,this.loginInfo.custom=commonH5SDK.h5Proxy.loginExt,o.custom=commonH5SDK.h5Proxy.loginExt,o.custom2=this.loginInfo.custom2,o.serverState=this.loginInfo.serverState||0,commonH5SDK.callback(commonH5SDK.code.LOGIN_SUCCESS,o)):(this.sdkLog("H5SDKLog||LoginCheck fail with message:"+o.message),commonH5SDK.callback(commonH5SDK.code.LOGIN_FAIL,"login error"));else if("payCheck"==e){var t,n,i,a;for(a in o)"code"==a?t=o[a]:"data"==a?n=o[a]:"message"==a&&(i=o[a]);this.sdkLog(t),this.sdkLog(n),this.sdkLog(i),1==t?(this.sdkLog("H5SDKLog||PayCheck successful with orderInfo:"+JSON.stringify(n)),this.checkOrderListener.onSuccess(n)):(this.sdkLog("H5SDKLog||PayCheck fail with message:"+i),this.checkOrderListener.onFail())}else"roleInfo"==e?this.sdkLog("H5SDKLog||Submit roleInfo result:"+o):"statistics"==e?200==s?(this.sdkLog("H5SDKLog||Statistics result:"+s),this.statisticsListenerProxy.onStatisticsSuccess()):(this.sdkLog("H5SDKLog||Statistics result:"+s),this.statisticsListenerProxy.onStatisticsFail()):"location"==e&&(0==o.code?(this.location=o.data,this.sdkLog("Location:"+o.data)):this.sdkLog("Location:Fail!"))}noResponse(e){"configInfo"==e?this.checkConfigListener.onCheckConfigFail():"login"==e?commonH5SDK.callback(commonH5SDK.code.LOGIN_FAIL,"login check network error"):"payCheck"==e?this.checkOrderListener.onFail():"roleInfo"!=e&&("statistics"==e?this.statisticsListenerProxy.onStatisticsFail():"location"==e&&this.sdkLog("Location:Fail!"))}setGzyasjhInfo(e){e&&0<e.length&&((e=JSON.parse(decodeURIComponent(e)))&&(this.gzyasjhInfo=e)),"object"!=typeof this.gzyasjhInfo&&(this.gzyasjhInfo={})}_addDataToTable(e){return"object"==typeof e&&(e.di=this.gzyasjhInfo.di||"",e.nt=this.gzyasjhInfo.nt||"",e.gv=this.gzyasjhInfo.gv||"",e.ot="",e.imei=this.gzyasjhInfo.imei||"",e.rl=this.gzyasjhInfo.rl||""),e}allinfo(){return{userAgent:(navigator.userAgent||"").replace(/[;/]/g," "),appName:navigator.appName||"",appVersion:(navigator.appVersion||"").replace(/[;/]/g," "),cookieEnabled:navigator.cookieEnabled||"",cpuClass:navigator.cpuClass||"",mimeType:navigator.mimeTypes||"",platform:navigator.platform||"",userLanguage:navigator.userLanguage||"",systemLanguage:navigator.systemLanguage||"",oscpu:navigator.oscpu||"",product:navigator.product||"",productSub:navigator.productSub||"",vender:navigator.vender||"",vendorSub:navigator.vendorSub||"",webkitPersistentStorage:navigator.webkitPersistentStorage||"",language:navigator.language||"",appCodeName:navigator.appCodeName||""}}getPayUrlCallBack(){return this.sdkInfo.payCheckUrl+"/"+this.sdkInfo.gameSimpleName+"/"+this.sdkInfo.sdkSimpleName+"/"+this.sdkInfo.sdkVersionCode}sdkLog(e){commonH5SDK.sdk_isShowLog&&console.log("commonH5SDK:"+e)}}