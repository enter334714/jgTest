function wxNetworkRequestUrl(e,o,n,t,r){wxSdkLog("requestUrl:"+e),wxSdkLog("requestData:",o),wx.request({url:e,data:o,header:{"content-type":t},method:r||"POST",success(e){wxSdkLog(e.data),n&&n(1,e.data)},fail(e){console.log(e),n&&n(0,"network request error")}})}function getSdkApiHost(){return"https://jy-sdk.goowei.cn"}function wxNetworkRequest(e,o,n,t,r){wxNetworkRequestUrl(getSdkApiHost()+e,o,n,t,r)}var commonWxSdkShowLog=0;function loginDataHandler(e,o){if(0==e.code){var n=e.msg,t=n.open_id,r=n.login_key,s=n.token,a=n.pay_channel_id,d=n.wechat,c=d.openid,i=d.unionid,d=d.session_key,S=n.share_str,w=n.share_pic,g=n.timestamp,m=n.notify_url,u=n.server_state;commonWxSdkShowLog=n.showDebugLog,wxSdkLog("serverState",u),commonWxSdkShowLog=commonWxSdkShowLog||0,wxSdkLog("serverState2",u=u||0);try{wx.setStorageSync("common_sdkOpenId",t+""),wx.setStorageSync("common_wxOpenId",c),wx.setStorageSync("common_wxUnionid",i),wx.setStorageSync("common_sdkLoginKey",r),wx.setStorageSync("common_sdkPayChannelId",a),wx.setStorageSync("common_wxSessionKey",d),wx.setStorageSync("common_wxShareTitle",S),wx.setStorageSync("common_wxShareImage",w),wx.setStorageSync("common_sdk_notify_url",m)}catch(e){}o(1,{openId:t,loginKey:r,token:s,wxOpenId:c,timestamp:g,serverState:u})}else console.log("loginResult:",e),o(0,"server callback error")}function commonSdkLogin(t,r,s){wx.setStorageSync("common_sdkAppId",t),wxSdkLog("commonSdkLogin"),wx.login({success(e){var o,n;e.code?(n="",(o=wx.getSystemInfoSync())&&(n=o.platform),wxSdkLog("currentPlat",n="android"),wxNetworkRequest("/sdk/login?format=json&type=7&mk=","code="+e.code+"&app_id="+t+"&version="+s+"&scene="+n,function(e,o){1==e?loginDataHandler(o,r):r(0,"login fail")},"application/x-www-form-urlencoded")):r&&r(0,e.errMsg)}})}function wxMenuShareInit(e){wxMenuShareInit2(wx.getStorageSync("common_wxShareTitle"),wx.getStorageSync("common_wxShareImage"),e)}function wxMenuShareInit2(e,o,n){wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),wx.onShareAppMessage(function(){return{title:e,imageUrl:o,query:n}}),wx.onShareTimeline(function(){return{title:e,imageUrl:o,query:n}})}function setWxMenuShareContent(e){var o=wx.getStorageSync("common_wxShareTitle"),n=wx.getStorageSync("common_wxShareImage");wx.onShareAppMessage(function(){return{title:o,imageUrl:n,query:e}}),wx.onShareTimeline(function(){return{title:o,imageUrl:n,query:e}})}function wxSdkShareContent(e){wxSdkShareContent2(wx.getStorageSync("common_wxShareTitle"),wx.getStorageSync("common_wxShareImage"),e)}function wxSdkShareContent2(e,o,n){wx.shareAppMessage({title:e,imageUrl:o,query:n})}function wxMenuShareTimeline(e){wxMenuShareTimeline2(wx.getStorageSync("common_wxShareTitle"),wx.getStorageSync("common_wxShareImage"),e)}function wxMenuShareTimeline2(e,o,n){wx.onShareTimeline(function(){return{title:e,imageUrl:o,query:n}})}function wxUserCloudStorage(e,o){o={wxgame:{score:parseInt(o),update_time:Date.parse(new Date)/1e3}},e={key:e,value:JSON.stringify(o)};wx.setUserCloudStorage({KVDataList:[e]})}function sdkUserCenter(){try{var e={action:"change_plat",open_id:wx.getStorageSync("common_sdkOpenId")};console.log("changPlatParam",e),sdkOpenCustomerService('请您发送"密码”，重置当前密码设置。',JSON.stringify(e),getSdkApiHost()+"/static/img/change_plat.jpg")}catch(e){}}function sdkOpenCustomerService(e,o,n){wx.showModal({title:"温馨提示",content:e||"请您发送“充值”或“CZ”获取订单链接。",showCancel:!1,success(e){e.confirm?wx.openCustomerServiceConversation({showMessageCard:!0,sendMessagePath:o,sendMessageImg:n}):e.cancel&&console.log("用户点击取消")}})}function sdkConfirmOrderRequest(e){var o,n=wx.getStorageSync("common_sdk_notify_url");n?(o=(o="app_id="+wx.getStorageSync("common_sdkAppId"))+"&open_id="+wx.getStorageSync("common_sdkOpenId")+"&query_id="+e,o={app_id:wx.getStorageSync("common_sdkAppId"),open_id:wx.getStorageSync("common_sdkOpenId"),query_id:e},wxNetworkRequestUrl(n,o=JSON.stringify(o),function(e,o){console.log("confirm result:"+o)},"application/x-www-form-urlencoded")):wx.showToast({icon:"none",title:"确认订单地址错误"})}function wxSdkLog(...e){1==commonWxSdkShowLog&&console.log(e)}function sdkCreateOrderRequest(e,o){var n="role_name="+e.playerName;wxSdkLog("sdkCreateOrderRequest:",n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n+="&encode=0")+("&login_key="+wx.getStorageSync("common_sdkLoginKey")))+("&pay_channel_id="+wx.getStorageSync("common_sdkPayChannelId")))+("&productid="+e.productId))+("&money="+e.postAmount))+("&open_id="+wx.getStorageSync("common_sdkOpenId")))+("&role_id="+e.playerId))+("&callback="+e.queryId))+("&game_amount="+10*e.postAmount))+("&serverid="+e.serverId))+("&app_id="+wx.getStorageSync("common_sdkAppId")))+("&wx_open_id="+wx.getStorageSync("common_wxOpenId"))),wxNetworkRequest("/sdk/pay?format=json",n,o,"application/x-www-form-urlencoded")}function startRequestMidasPayment(e,o,n,t){console.log("aaamount:"+e),wx.requestMidasPayment({mode:"game",env:t?1:0,offerId:o,currencyType:"CNY",platform:"android",zoneId:1,buyQuantity:e,success:function(){wxSdkLog("pay success"),sdkConfirmOrderRequest(n)},fail:function(e){console.log("pay error:",e)}})}function wxSdkPay(s,a,d){sdkCreateOrderRequest(s,function(e,o){if(wxSdkLog("create order result:"+o),1==e)if(0===o.code){var n,t,r,e=o.msg.pay_param;if(e)if("kefu"==e.pay_type)return void sdkOpenCustomerService("请您发送“充值”或“CZ”获取订单链接。",JSON.stringify({action:"pay"}),getSdkApiHost()+"/static/img/pay_card.jpeg");e&&0==e.errcode?(n=e.balance,t=100*s.postAmount,r=e.query_id,n==t?wx.showModal({content:"您账户上有足够的余额，是否直接用于当前购买项扣除",showCancel:!0,cancelText:"取消",confirmText:"确认扣除",success:function(e){e.confirm&&sdkConfirmOrderRequest(r)}}):(wxSdkLog("balance:"+n),startRequestMidasPayment(t,a,r,d))):(console.log("error:",e),wx.showToast({icon:"none",title:"接口错误"}))}else wx.showToast({icon:"none",title:""+o.msg});else wx.showToast({icon:"none",title:"充值失败,请检查您的网络"})})}function initSdkAd(e,o){try{if(wx.setStorageSync("common_bannerAdId",e+""),wx.setStorageSync("common_videoAdId",o),wxSdkLog("videoAdId:"+o),1<o.length){let e=wx.createRewardedVideoAd({adUnitId:o});e.onError(e=>{console.log(e)}),e.load().then(function(){})}}catch(e){}}function sdkShowBannerAd(e){var o=wx.getStorageSync("common_bannerAdId");typeof window.sdkBannerAd==BannerAd&&window.sdkBannerAd.destroy(),window.sdkBannerAd=wx.createBannerAd({adUnitId:o,style:e}),window.sdkBannerAd.show().catch(e=>console.log("show banner ad error:",e))}function sdkHideBannerAd(){typeof window.sdkBannerAd==BannerAd&&(window.sdkBannerAd.hide(),window.sdkBannerAd.destroy())}function sdkRewardedVideoAd(n){var e=wx.getStorageSync("common_videoAdId");let t=wx.createRewardedVideoAd({adUnitId:e});t.offClose(),t.onClose(e=>{wxSdkLog("onClose",e),e&&e.isEnded||void 0===e?n&&n(1,"play finish"):n&&n(0,"user click exit"),t.offClose(n)}),t.show().then(function(){}).catch(o=>{console.log("show video ad error:",o),t.load().then(()=>t.show()).catch(e=>{console.log("show video ad error2:",o),n&&e&&e.errCode?n(e.errCode,""+e.errMsg):n(1e3,"unknow error")})})}function sdkMsgSecCheck(e,t){wxSdkLog("sdkMsgSecCheck");var o="/sdk/msg_sec_check?format=json&type=7&mk=",e=(o=(o=(o+="&app_id="+wx.getStorageSync("common_sdkAppId"))+("&login_key="+wx.getStorageSync("common_sdkLoginKey")))+("&open_id="+wx.getStorageSync("common_sdkOpenId")),"content="+e.content+"&scene="+e.scene);wxNetworkRequest(o,e,function(e,o){var n;1==e?(wxSdkLog("msgCheckResult",o),0==o.code?(e=o.msg.errcode,n=o.msg.errmsg,0==e?t(1,"success"):t(0,""+n)):t(0,"server error")):(t(0,"network error"),console.log("sdkMsgSecCheck error:"+o))},"application/x-www-form-urlencoded","POST")}function SdkGetWhatsNewSubscriptionsSetting(o){wx.getWhatsNewSubscriptionsSetting({msgType:1,success(e){wxSdkLog("getWhatsNewSubscriptionsSetting",e),e&&2===e.status?o(1,"已订阅"):o(0,"未订阅")},fail(e){console.log("getWhatsNewSubscriptionsSettinge",e),o(0,"未订阅")}})}function SdkRequestSubscribeWhatsNew(o){wx.requestSubscribeWhatsNew({msgType:1,success(e){wxSdkLog("requestSubscribeWhatsNew",e),!0===e.confirm?o(1,"success"):o(0,"user cancel")},fail(e){console.log("requestSubscribeWhatsNewe",e),o(0,"Subscribe fail")}})}module.exports={login:commonSdkLogin,menuShareInit:wxMenuShareInit,menuShareInit2:wxMenuShareInit2,setWxMenuShareContent:setWxMenuShareContent,sdkShareContent:wxSdkShareContent,menuShareTimeline:wxMenuShareTimeline,menuShareTimeline2:wxMenuShareTimeline2,sdkUserCloudStorage:wxUserCloudStorage,sdkPay:wxSdkPay,initSdkAd:initSdkAd,showBannerAd:sdkShowBannerAd,hideBannerAd:sdkHideBannerAd,showRewardedVideoAd:sdkRewardedVideoAd,msgSecCheck:sdkMsgSecCheck,requestSubscribeWhatsNew:SdkRequestSubscribeWhatsNew,getWhatsNewSubscriptionsSetting:SdkGetWhatsNewSubscriptionsSetting,sdkUserCenter:sdkUserCenter};