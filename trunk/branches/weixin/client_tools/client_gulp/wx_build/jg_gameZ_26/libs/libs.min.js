var Laya=window.Laya=function($M,$v){var $Y={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($v,$g){return 1==arguments.length?$Y.__presubstr.call(this,$v):$Y.__presubstr.call(this,$v,0<$g?$g:this.length+$g)},__init:function($v){$v.forEach(function($v){$v.__init$&&$v.__init$()})},__isClass:function($v){return $v&&($v.__isclass||$v==Object||$v==String||$v==Array)},__newvec:function($v,$g){var $Q=[];$Q.length=$v;for(var $d=0;$d<$v;$d++)$Q[$d]=$g;return $Q},__extend:function($v,$g){for(var $Q in $g)if($g.hasOwnProperty($Q)){var $d=Object.getOwnPropertyDescriptor($g,$Q),$r=$d.get,$k=$d.set;$r||$k?$r&&$k?Object.defineProperty($v,$Q,$d):($r&&Object.defineProperty($v,$Q,$r),$k&&Object.defineProperty($v,$Q,$k)):$v[$Q]=$g[$Q]}function $$(){$Y.un(this,"constructor",$v)}$$.prototype=$g.prototype,$v.prototype=new $$,$Y.un($v.prototype,"__imps",$Y.__copy({},$g.prototype.__imps))},__copy:function($v,$g){if(!$g)return null;for(var $Q in $v=$v||{},$g)$v[$Q]=$g[$Q];return $v},__package:function($v,$g){if(!$Y.__packages[$v]){$Y.__packages[$v]=!0;var $Q=$M,$d=$v.split(".");if(1<$d.length)for(var $r=0,$k=$d.length-1;$r<$k;$r++){var $$=$Q[$d[$r]];$Q=$$||($Q[$d[$r]]={})}$Q[$d[$d.length-1]]||($Q[$d[$d.length-1]]=$g||{})}},__hasOwnProperty:function($v,$g){return $g=$g||this,Object.hasOwnProperty.call($g,$v)||function $v($g,$Q){if(Object.hasOwnProperty.call($Q.prototype,$g))return!0;var $d=$Q.prototype.__super;return null==$d?null:$v($g,$d)}($v,$g.__class)},__typeof:function($v,$g){if(!$v||!$g)return!1;if($g===String)return"string"==typeof $v;if($g===Number)return"number"==typeof $v;if($g.__interface__)$g=$g.__interface__;else if("string"!=typeof $g)return $v instanceof $g;return $v.__imps&&$v.__imps[$g]||$v.__class==$g},__as:function($v,$g){return this.__typeof($v,$g)?$v:null},__int:function($v){return $v?parseInt($v):0},interface:function($v,$g){$Y.__package($v,{});var $Q=$Y.__internals,$d=$Q[$v]=$Q[$v]||{self:$v};if($g){var $r=$g.split(",");$d.extend=[];for(var $k=0;$k<$r.length;$k++){var $$=$r[$k];$Q[$$]=$Q[$$]||{self:$$},$d.extend.push($Q[$$])}}var $b=$M,$a=$v.split(".");for($k=0;$k<$a.length-1;$k++)$b=$b[$a[$k]];$b[$a[$a.length-1]]={__interface__:$v}},class:function($v,$g,$Q,$d){if($Q&&$Y.__extend($v,$Q),$g)if($Y.__package($g,$v),$Y.__classmap[$g]=$v,0<$g.indexOf(".")){if(0==$g.indexOf("laya.")){var $r=$g.split(".");$d=$d||$r[$r.length-1],$Y[$d]&&console.log("Warning!,this class["+$d+"] already exist:",$Y[$d]),$Y[$d]=$v}}else"Main"==$g?$M.Main=$v:"MainWX"==$g?$M.MainWX=$v:($Y[$g]&&console.log("Error!,this class["+$g+"] already exist:",$Y[$g]),$Y[$g]=$v);var $k=$Y.un,$$=$v.prototype;$k($$,"hasOwnProperty",$Y.__hasOwnProperty),$k($$,"__class",$v),$k($$,"__super",$Q),$k($$,"__className",$g),$k($v,"__super",$Q),$k($v,"__className",$g),$k($v,"__isclass",!0),$k($v,"super",function($v){this.__super.call($v)})},imps:function($v,$g){if(!$g)return null;var $r=$v.__imps||$Y.un($v,"__imps",{});function $k($v){var $g,$Q;if(($g=$Y.__internals[$v])&&($r[$v]=!0,$Q=$g.extend))for(var $d=0;$d<$Q.length;$d++)$k($Q[$d].self)}for(var $Q in $g)$k($Q)},superSet:function($v,$g,$Q,$d){var $r=$v.prototype["_$set_"+$Q];$r&&$r.call($g,$d)},superGet:function($v,$g,$Q){var $d=$v.prototype["_$get_"+$Q];return $d?$d.call($g):null},getset:function($v,$g,$Q,$d,$r){$v?($d&&($g["_$GET_"+$Q]=$d),$r&&($g["_$SET_"+$Q]=$r)):($d&&$Y.un($g,"_$get_"+$Q,$d),$r&&$Y.un($g,"_$set_"+$Q,$r)),$d&&$r?Object.defineProperty($g,$Q,{get:$d,set:$r,enumerable:!1,configurable:!0}):($d&&Object.defineProperty($g,$Q,{get:$d,enumerable:!1,configurable:!0}),$r&&Object.defineProperty($g,$Q,{set:$r,enumerable:!1,configurable:!0}))},static:function($Q,$d){for(var $r=0,$v=$d.length;$r<$v;$r+=2)if("length"==$d[$r])$Q.length=$d[$r+1].call($Q);else{function $g(){var $g=$d[$r],$v=$d[$r+1];Object.defineProperty($Q,$g,{get:function(){return delete this[$g],this[$g]=$v.call(this)},set:function($v){delete this[$g],this[$g]=$v},enumerable:!0,configurable:!0})}$g()}},un:function($v,$g,$Q){return $Q||($Q=$v[$g]),$Y.__propun.value=$Q,Object.defineProperty($v,$g,$Y.__propun),$Q},uns:function($g,$v){$v.forEach(function($v){$Y.un($g,$v)})}};return $M.console=$M.console||{log:function(){}},$M.trace=$M.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$Y}(window,document);!function($v,$g,$Q){$Q.un,$Q.uns,$Q.static,$Q.class,$Q.getset,$Q.__newvec}(window,document,Laya),function($$,$g,$W){$W.un,$W.uns;var $a=$W.static,$t=$W.class,$Y=$W.getset;$W.__newvec;$W.interface("laya.runtime.IMarket"),$W.interface("laya.filters.IFilter"),$W.interface("laya.display.ILayout"),$W.interface("laya.resource.IDispose"),$W.interface("laya.runtime.IPlatform"),$W.interface("laya.resource.IDestroy"),$W.interface("laya.runtime.IConchNode"),$W.interface("laya.filters.IFilterAction"),$W.interface("laya.runtime.ICPlatformClass"),$W.interface("laya.resource.ICreateResource"),$W.interface("laya.runtime.IConchRenderObject"),$W.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $Z=function(){function $k(){}return $t($k,"laya.utils.RunDriver"),$k.FILTER_ACTIONS=[],$k.pixelRatio=-1,$k._charSizeTestDiv=null,$k.now=function(){return Date.now()},$k.getWindow=function(){return $$},$k.getPixelRatio=function(){if($k.pixelRatio<0){var $v=$c.context,$g=$v.backingStorePixelRatio||$v.webkitBackingStorePixelRatio||$v.mozBackingStorePixelRatio||$v.msBackingStorePixelRatio||$v.oBackingStorePixelRatio||$v.backingStorePixelRatio||1;($k.pixelRatio=($c.window.devicePixelRatio||1)/$g)<1&&($k.pixelRatio=1)}return $k.pixelRatio},$k.getIncludeStr=function($v){return null},$k.createShaderCondition=function($v){var $g="(function() {return "+$v+";})";return $W._runScript($g)},$k.fontMap=[],$k.measureText=function($v,$g){var $Q=$k.hanzi.test($v);if($Q&&$k.fontMap[$g])return $k.fontMap[$g];var $d=$c.context;$d.font=$g;var $r=$d.measureText($v);return $r||($r={width:16,height:16}),$Q&&($k.fontMap[$g]=$r),$r},$k.getWebGLContext=function($v){},$k.beginFlush=function(){},$k.endFinish=function(){},$k.addToAtlas=null,$k.flashFlushImage=function($v){},$k.drawToCanvas=function($v,$g,$Q,$d,$r,$k){var $$=$sv.create("2D"),$b=new $x($Q,$d,$$);return $w.renders[$g]._fun($v,$b,$r,$k),$$},$k.createParticleTemplate2D=null,$k.createGLTextur=null,$k.createWebGLContext2D=null,$k.changeWebGLSize=function($v,$g){},$k.createRenderSprite=function($v,$g){return new $w($v,$g)},$k.createFilterAction=function($v){return new $s},$k.createGraphics=function(){return new $J},$k.clear=function($v){$i._context.ctx.clear()},$k.cancelLoadByUrl=function($v){},$k.clearAtlas=function($v){},$k.isAtlas=function($v){return!1},$k.addTextureToAtlas=function($v){},$k.getTexturePixels=function($v,$g,$Q,$d,$r){return null},$k.skinAniSprite=function(){return null},$k.update3DLoop=function(){},$a($k,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$k}(),$d=($Y(1,$W,"alertGlobalError",null,function($v){var $k=0;$c.window.onerror=$v?function($v,$g,$Q,$d,$r){$k++<5&&$r&&alert($r.stack||$r)}:null}),$W.init=function($v,$g,$Q){for(var $d=[],$r=2,$k=arguments.length;$r<$k;$r++)$d.push(arguments[$r]);if(!$W._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$W._arrayBufferSlice),$W._isinit=!0,$c.__init__(),$m.__init__(),$J.__init__(),$W.timer=new $U,$W.scaleTimer=new $U,$W.loader=new $av,$_.__init__(),$r=0;for(var $$=$d.length;$r<$$;$r++)$d[$r].enable&&$d[$r].enable();return $p.__init__(),$b.__init__(),$K.__init__(),$j.beginCheck(),$W._currentStage=$W.stage=new $Cv,$W.stage.conchModel&&$W.stage.conchModel.setRootNode(),$W._getUrlPath(),$W.render=new $i(0,0),$W.stage.size($v,$g),$w.__init__(),$D.__init__(),$T.instance.__init__($W.stage,$i.canvas),$hv.__init__(),$V.autoStopMusic=!0,$o.__init__(),$i.canvas}},$W._getUrlPath=function(){var $v=$c.window.location,$g=$v.pathname;$g=$g&&":"==$g.charAt(2)?$g.substring(1):$g,$N.rootPath=$N.basePath=$N.getPath("file:"==$v.protocol?$g:$v.protocol+"//"+$v.host+$v.pathname)},$W._arrayBufferSlice=function($v,$g){var $Q=new Uint8Array(this,$v,$g-$v),$d=new Uint8Array($Q.length);return $d.set($Q),$d.buffer},$W._runScript=function($v){return $c.window[$W._evcode]($v)},$W.stage=null,$W.timer=null,$W.scaleTimer=null,$W.loader=null,$W.version="1.8.6",$W.render=null,$W._currentStage=null,$W._isinit=!1,$W.isDebug=!1,$W.MiniAdpter={init:function(){$$.navigator&&$$.navigator.userAgent&&-1<$$.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$a($W,["conchMarket",function(){return this.conchMarket=$$.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$$.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $v(){}return $t($v,"Config"),$v.WebGLTextCacheCount=500,$v.atlasEnable=!1,$v.showCanvasMark=!1,$v.animationInterval=50,$v.isAntialias=!1,$v.isAlpha=!1,$v.premultipliedAlpha=!0,$v.isStencil=!0,$v.preserveDrawingBuffer=!1,$v}()),$M=function(){function $M(){this._events=null}$t($M,"laya.events.EventDispatcher");var $v=$M.prototype;return $v.hasListener=function($v){return!!(this._events&&this._events[$v])},$v.getListener=function($v){return this._events?this._events[$v]:null},$v.event=function($v,$g){if(!this._events||!this._events[$v])return!1;var $Q=this._events[$v];if($Q.lock)$Q.queue||($Q.queue=[]),$Q.queue.push($g);else{var $d;for($Q.lock=!0,$Q.cursor=$Q.head;$Q.cursor;)($d=$Q.cursor).recover?($Q.head=$Q.tail=$Q.cursor=null,console.error("node is recover："+$d.id)):($Q.cursor=$d.next,$d.once&&$M.delNode($Q,$d),$d.method&&(null!=$g?$d.args?$d.method.apply($d.caller,$d.args.concat($g)):$g instanceof Array?$d.method.apply($d.caller,$g):$d.caller?$d.method.call($d.caller,$g):$W.recordError("事件派发错误","node.caller:"+$d.caller+"node.method:"+$d.method+"data:"+$g+"node.prev"+$d.prev):$d.method.apply($d.caller,$d.args)),$d.once&&$M.recoverHandler($d));$Q.lock=!1,!$Q.head&&this._events&&this._events[$v]==$Q&&delete this._events[$v],$Q.queue&&$Q.queue.length&&this.event($v,$Q.queue.shift())}return!0},$v.on=function($v,$g,$Q,$d){return this._createListener($v,$g,$Q,$d,!1)},$v.once=function($v,$g,$Q,$d){return this._createListener($v,$g,$Q,$d,!0)},$v._createListener=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=!0),$k&&this.off($v,$g,$Q,$r);var $$=$M.createHandler($g||this,$Q,$d,$r);this._events||(this._events={});var $b=this._events,$a=$b[$v];return $a?$a.tail?($$.prev=$a.tail,$a.tail.next=$$,$a.tail=$$):$a.head=$a.tail=$$:$b[$v]={head:$$,tail:$$,cursor:null,lock:!1},this},$v.off=function($v,$g,$Q,$d){if(void 0===$d&&($d=!1),!this._events||!this._events[$v])return this;for(var $r=this._events[$v],$k=$r.head;$k;){if((!$g||$k.caller===$g)&&$k.method===$Q&&(!$d||$k.once)){$M.delNode($r,$k),$r.cursor==$k&&($r.cursor=$k.next),$M.recoverHandler($k);break}$k=$k.next}return this},$v.offAll=function($v){var $g=this._events;if(!$g)return this;if($v)this._recoverHandlers($g[$v]),delete $g[$v];else{for(var $Q in $g)this._recoverHandlers($g[$Q]);this._events=null}return this},$v._recoverHandlers=function($v){if($v){for(var $g=$v.head;$g;){$M.delNode($v,$g);var $Q=$g.next;$M.recoverHandler($g),$g=$Q}$v.cursor=null}},$v.isMouseEvent=function($v){return $M.MOUSE_EVENTS[$v]},$M.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$M.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$M.delNode=function($v,$g){$g.prev?$g.prev.next=$g.next:$v.head=$g.next,$g.next?$g.next.prev=$g.prev:$v.tail=$g.prev},$M.createHandler=function($v,$g,$Q,$d){var $r=500<$M._freeHandler.length?$M._freeHandler.shift():null;if($r)if($r.recover)$r.recover=!1,$r.caller=$v,$r.method=$g,$r.args=$Q,$r.once=$d;else{var $k="";try{arguments.propertyIsEnumerable.caller}catch($v){$k=$v.stack}var $$=$r.caller?($r.caller.__proto__&&$r.caller.__proto__.constructor&&$r.caller.__proto__.constructor.name)+"|"+$r.caller.__className+"|"+$r.caller.name:"",$b=$r.method?$r.method.name:"";$W.recordError("EventDispatcher重复创建","caller="+$$+"  method="+$b+"  stack="+$k),$r={id:++$M._nodeCount,caller:$v,method:$g,args:$Q,once:$d,recover:!1}}else $r={id:++$M._nodeCount,caller:$v,method:$g,args:$Q,once:$d,recover:!1};return $r.prev=$r.next=null,$r},$M.recoverHandler=function($v){if($v.recover){if($M._errorCount<5){$M._errorCount++;var $g="";try{arguments.propertyIsEnumerable.caller}catch($v){$g=$v.stack}var $Q=$v.caller?($v.caller.__proto__&&$v.caller.__proto__.constructor&&$v.caller.__proto__.constructor.name)+"|"+$v.caller.__className+"|"+$v.caller.name:"",$d=$v.method?$v.method.name:"";$W.recordError("EventDispatcher重复回收","id="+$v.id+"  caller="+$Q+"  method="+$d+"  stack="+$g)}$v.caller=$v.method=$v.args=$v.prev=null}else $v.recover=!0,$v.caller=$v.method=$v.args=$v.prev=$v.next=null,$M._freeHandler&&$M._freeHandler.length<3e3&&$M._freeHandler.push($v)},$M._freeHandler=[],$M._nodeCount=0,$M._errorCount=0,$M}(),$G=function(){function $r($v,$g,$Q,$d){this.once=!1,void(this._id=0)===$d&&($d=!1),this.setTo($v,$g,$Q,$d)}$t($r,"laya.utils.Handler");var $v=$r.prototype;return $v.setTo=function($v,$g,$Q,$d){return this._id=$r._gid++,this.caller=$v,this.method=$g,this.args=$Q,this.once=$d,this},$v.run=function(){if(null==this.method)return null;var $v=this._id,$g=this.method.apply(this.caller,this.args);return this._id===$v&&this.once&&this.recover(),$g},$v.runWith=function($v){if(null==this.method)return null;var $g=this._id;if(null==$v)var $Q=this.method.apply(this.caller,this.args);else $Q=this.args||$v.unshift?this.args?this.method.apply(this.caller,this.args.concat($v)):this.method.apply(this.caller,$v):this.method.call(this.caller,$v);return this._id===$g&&this.once&&this.recover(),$Q},$v.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$v.recover=function(){0<this._id&&(this._id=0,this.clear())},$r.create=function($v,$g,$Q,$d){return void 0===$d&&($d=!0),new $r($v,$g,$Q,$d)},$r._gid=1,$r}(),$E=function(){function $v(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$t($v,"laya.display.BitmapFont");var $g=$v.prototype;return $g.loadFont=function($v,$g){this._path=$v,this._complete=$g,$W.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$G.create(this,this.onLoaded))},$g.onLoaded=function(){this.parseFont($bv.getRes(this._path),$bv.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$g.parseFont=function($v,$g){if(null!=$v&&null!=$g){this._texture=$g;var $Q=$v.getElementsByTagName("info");if(!$Q[0].getAttributeNode)return this.parseFont2($v,$g);this.fontSize=parseInt($Q[0].getAttributeNode("size").nodeValue);var $d,$r=$Q[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($r[0]),parseInt($r[1]),parseInt($r[2]),parseInt($r[3])],$d=$v.getElementsByTagName("char");var $k=0;for($k=0;$k<$d.length;$k++){var $$=$d[$k],$b=parseInt($$.getAttributeNode("id").nodeValue),$a=parseInt($$.getAttributeNode("xoffset").nodeValue)/1,$M=parseInt($$.getAttributeNode("yoffset").nodeValue)/1,$Y=parseInt($$.getAttributeNode("xadvance").nodeValue)/1,$D=new $l;$D.x=parseInt($$.getAttributeNode("x").nodeValue),$D.y=parseInt($$.getAttributeNode("y").nodeValue),$D.width=parseInt($$.getAttributeNode("width").nodeValue),$D.height=parseInt($$.getAttributeNode("height").nodeValue);var $J=$Yv.create($g,$D.x,$D.y,$D.width,$D.height,$a,$M);this._maxWidth=Math.max(this._maxWidth,$Y+this.letterSpacing),this._fontCharDic[$b]=$J,this._fontWidthMap[$b]=$Y}}},$g.parseFont2=function($v,$g){if(null!=$v&&null!=$g){this._texture=$g;var $Q=$v.getElementsByTagName("info");this.fontSize=parseInt($Q[0].attributes.size.nodeValue);var $d=$Q[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($d[0]),parseInt($d[1]),parseInt($d[2]),parseInt($d[3])];var $r=$v.getElementsByTagName("char"),$k=0;for($k=0;$k<$r.length;$k++){var $$=$r[$k].attributes,$b=parseInt($$.id.nodeValue),$a=parseInt($$.xoffset.nodeValue)/1,$M=parseInt($$.yoffset.nodeValue)/1,$Y=parseInt($$.xadvance.nodeValue)/1,$D=new $l;$D.x=parseInt($$.x.nodeValue),$D.y=parseInt($$.y.nodeValue),$D.width=parseInt($$.width.nodeValue),$D.height=parseInt($$.height.nodeValue);var $J=$Yv.create($g,$D.x,$D.y,$D.width,$D.height,$a,$M);this._maxWidth=Math.max(this._maxWidth,$Y+this.letterSpacing),this._fontCharDic[$b]=$J,this._fontWidthMap[$b]=$Y}}},$g.getCharTexture=function($v){return this._fontCharDic[$v.charCodeAt(0)]},$g.destroy=function(){if(this._texture){for(var $v in this._fontCharDic){var $g=this._fontCharDic[$v];$g&&$g.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$g.setSpaceWidth=function($v){this._spaceWidth=$v},$g.getCharWidth=function($v){var $g=$v.charCodeAt(0);return this._fontWidthMap[$g]?this._fontWidthMap[$g]+this.letterSpacing:" "==$v?this._spaceWidth+this.letterSpacing:0},$g.getTextWidth=function($v){for(var $g=0,$Q=0,$d=$v.length;$Q<$d;$Q++)$g+=this.getCharWidth($v.charAt($Q));return $g},$g.getMaxWidth=function(){return this._maxWidth},$g.getMaxHeight=function(){return this.fontSize},$g.drawText=function($v,$g,$Q,$d,$r,$k){var $$,$b=this.getTextWidth($v),$a=0;"center"===$r&&($a=($k-$b)/2),"right"===$r&&($a=$k-$b);for(var $M=0,$Y=0,$D=$v.length;$Y<$D;$Y++)($$=this.getCharTexture($v.charAt($Y)))&&($g.graphics.drawTexture($$,$Q+$M+$a,$d),$M+=this.getCharWidth($v.charAt($Y)))},$v}(),$b=function(){function $Q(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$Q._TF_EMPTY}$t($Q,"laya.display.css.Style");var $v=$Q.prototype;return $v.getTransform=function(){return this._tf},$v.setTransform=function($v){this._tf="none"!==$v&&$v?$v:$Q._TF_EMPTY},$v.setTranslateX=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.translateX=$v},$v.setTranslateY=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.translateY=$v},$v.setScaleX=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.scaleX=$v},$v.setScale=function($v,$g){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.scaleX=$v,this._tf.scaleY=$g},$v.setScaleY=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.scaleY=$v},$v.setRotate=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.rotate=$v},$v.setSkewX=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.skewX=$v},$v.setSkewY=function($v){this._tf===$Q._TF_EMPTY&&(this._tf=new $r),this._tf.skewY=$v},$v.destroy=function(){this.scrollRect=null},$v.render=function($v,$g,$Q,$d){},$v.getCSSStyle=function(){return $gv.EMPTY},$v._enableLayout=function(){return!1},$Y(0,$v,"scaleX",function(){return this._tf.scaleX},function($v){this.setScaleX($v)}),$Y(0,$v,"transform",function(){return this.getTransform()},function($v){this.setTransform($v)}),$Y(0,$v,"translateX",function(){return this._tf.translateX},function($v){this.setTranslateX($v)}),$Y(0,$v,"translateY",function(){return this._tf.translateY},function($v){this.setTranslateY($v)}),$Y(0,$v,"scaleY",function(){return this._tf.scaleY},function($v){this.setScaleY($v)}),$Y(0,$v,"block",function(){return 0!=(1&this._type)}),$Y(0,$v,"skewY",function(){return this._tf.skewY},function($v){this.setSkewY($v)}),$Y(0,$v,"rotate",function(){return this._tf.rotate},function($v){this.setRotate($v)}),$Y(0,$v,"skewX",function(){return this._tf.skewX},function($v){this.setSkewX($v)}),$Y(0,$v,"paddingLeft",function(){return 0}),$Y(0,$v,"paddingTop",function(){return 0}),$Y(0,$v,"absolute",function(){return!0}),$Q.__init__=function(){$Q._TF_EMPTY=new $r,$Q.EMPTY=new $Q},$Q.EMPTY=null,$Q._TF_EMPTY=null,$Q}(),$p=function(){function $g($v){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$H.create($g.defaultColor),this.family=$g.defaultFamily,this.stroke=$g._STROKE,this.size=$g.defaultSize,$v&&$v!==$g.EMPTY&&$v.copyTo(this)}$t($g,"laya.display.css.Font");var $v=$g.prototype;return $v.set=function($v){this._text=null;for(var $g=$v.split(" "),$Q=0,$d=$g.length;$Q<$d;$Q++){var $r=$g[$Q];switch($r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$r.indexOf("px")&&(this.size=parseInt($r),this.family=$g[$Q+1],$Q++)}},$v.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$v.copyTo=function($v){$v._type=this._type,$v._text=this._text,$v._weight=this._weight,$v._color=this._color,$v.family=this.family,$v.stroke=this.stroke!=$g._STROKE?this.stroke.slice():$g._STROKE,$v.indent=this.indent,$v.size=this.size},$Y(0,$v,"password",function(){return 0!=(1024&this._type)},function($v){$v?this._type|=1024:this._type&=-1025}),$Y(0,$v,"color",function(){return this._color.strColor},function($v){this._color=$H.create($v)}),$Y(0,$v,"italic",function(){return 0!=(512&this._type)},function($v){$v?this._type|=512:this._type&=-513}),$Y(0,$v,"bold",function(){return 0!=(2048&this._type)},function($v){$v?this._type|=2048:this._type&=-2049}),$Y(0,$v,"weight",function(){return""+this._weight},function($v){var $g=0;switch($v){case"normal":break;case"bold":this.bold=!0,$g=700;break;case"bolder":$g=800;break;case"lighter":$g=100;break;default:$g=parseInt($v)}this._weight=$g,this._text=null}),$Y(0,$v,"decoration",function(){return this._decoration?this._decoration.value:null},function($v){var $g=$v.split(" ");switch(this._decoration||(this._decoration={}),$g[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$g[0]}$g[1]&&(this._decoration.color=$H.create($g)),this._decoration.value=$v}),$g.__init__=function(){$g.EMPTY=new $g(null)},$g.EMPTY=null,$g.defaultColor="#000000",$g.defaultSize=12,$g.defaultFamily="Arial",$g.defaultFont="12px Arial",$g._STROKE=[0,"#000000"],$g._ITALIC=512,$g._PASSWORD=1024,$g._BOLD=2048,$g}(),$r=function(){function $v(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $t($v,"laya.display.css.TransformInfo"),$v}(),$J=function(){function $D(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$i.isConchNode){this._nativeObj=new $$._conchGraphics,this.id=this._nativeObj.conchID}}$t($D,"laya.display.Graphics");var $v=$D.prototype;return $v.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$v.clear=function($v){void 0===$v&&($v=!1);var $g=0,$Q=0;if($v){var $d=this._one;if(this._cmds){for($Q=this._cmds.length,$g=0;$g<$Q;$g++)!($d=this._cmds[$g])||$d.callee!==$i._context._drawTexture&&$d.callee!==$i._context._drawTextureWithTransform||($d[0]=null,$D._cache.push($d));this._cmds.length=0}else $d&&(!$d||$d.callee!==$i._context._drawTexture&&$d.callee!==$i._context._drawTextureWithTransform||($d[0]=null,$D._cache.push($d)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($g=0,$Q=this._vectorgraphArray.length;$g<$Q;$g++)$O.getInstance().deleteShape(this._vectorgraphArray[$g]);this._vectorgraphArray.length=0}},$v._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$v._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $Q,this._graphicBounds._graphics=this)},$v._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$v._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$v.getBounds=function($v){return void 0===$v&&($v=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($v)},$v.getBoundPoints=function($v){return void 0===$v&&($v=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($v)},$v._addCmd=function($v){this._cmds=this._cmds||[],$v.callee=$v.shift(),this._cmds.push($v)},$v.setFilters=function($v){this._saveToCmd($i._context._setFilters,$v)},$v.drawTexture=function($v,$g,$Q,$d,$r,$k,$$){if(void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$$&&($$=1),!$v||$$<.01)return null;$d||($d=$v.sourceWidth),$r||($r=$v.sourceHeight),$$=$$<0?0:1<$$?1:$$;var $b,$a=!$i.isWebGL&&($c.onFirefox||$c.onEdge||$c.onIE||$c.onSafari)?.5:0,$M=$d/$v.sourceWidth,$Y=$r/$v.sourceHeight;return $d=$v.width*$M,$r=$v.height*$Y,$v.loaded&&($d<=0||$r<=0)?null:($g+=$v.offsetX*$M,$Q+=$v.offsetY*$Y,this._sp&&(this._sp._renderType|=512),$g-=$a,$Q-=$a,$d+=2*$a,$r+=2*$a,$D._cache.length?(($b=$D._cache.pop())[0]=$v,$b[1]=$g,$b[2]=$Q,$b[3]=$d,$b[4]=$r,$b[5]=$k,$b[6]=$$):$b=[$v,$g,$Q,$d,$r,$k,$$],$b.callee=$k||1!=$$?$i._context._drawTextureWithTransform:$i._context._drawTexture,null!=this._one||$k||1!=$$?this._saveToCmd($b.callee,$b):(this._one=$b,this._render=this._renderOneImg),$v.loaded||$v.once("loaded",this,this._textureLoaded,[$v,$b]),this._repaint(),$b)},$v.cleanByTexture=function($v,$g,$Q,$d,$r){if(void 0===$d&&($d=0),void 0===$r&&($r=0),!$v)return this.clear();if(this._one&&this._render===this._renderOneImg){$d||($d=$v.sourceWidth),$r||($r=$v.sourceHeight);var $k=$d/$v.sourceWidth,$$=$r/$v.sourceHeight;$d=$v.width*$k,$r=$v.height*$$,$g+=$v.offsetX*$k,$Q+=$v.offsetY*$$,this._one[0]=$v,this._one[1]=$g,this._one[2]=$Q,this._one[3]=$d,this._one[4]=$r,this._repaint()}else this.clear(),$v&&this.drawTexture($v,$g,$Q,$d,$r)},$v.drawTextures=function($v,$g){$v&&this._saveToCmd($i._context._drawTextures,[$v,$g])},$v.fillTexture=function($v,$g,$Q,$d,$r,$k,$$){if(void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$k&&($k="repeat"),$v){var $b=[$v,$g,$Q,$d,$r,$k,$$||$F.EMPTY,{}];$v.loaded||$v.once("loaded",this,this._textureLoaded,[$v,$b]),this._saveToCmd($i._context._fillTexture,$b)}},$v._textureLoaded=function($v,$g){$g[3]=$g[3]||$v.width,$g[4]=$g[4]||$v.height,this._repaint()},$v.fillCircle=function($v,$g,$Q,$d,$r,$k,$$){$Q.bitmap.enableMerageInAtlas=!1;var $b=new Float32Array(2*($$+1)),$a=new Float32Array(2*($$+1)),$M=new Uint16Array(3*$$),$Y=2*Math.PI/$$,$D=0;$b[0]=$d,$b[1]=$r,$a[0]=$d/$Q.width,$a[1]=$r/$Q.height;for(var $J=2,$p=0;$p<$$;$p++){var $T=$k*Math.cos($D)+$d,$t=$k*Math.sin($D)+$r;$b[$J]=$T,$b[$J+1]=$t,$a[$J]=$T/$Q.width,$a[$J+1]=$t/$Q.height,$D+=$Y,$J+=2}for($p=$J=0;$p<$$;$p++)$M[$J++]=0,$M[$J++]=$p+1,$M[$J++]=$$+1<=$p+2?1:$p+2;this.drawTriangles($Q,$v,$g,$b,$a,$M)},$v.drawTriangles=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){void 0===$b&&($b=1),this._saveToCmd($i._context.drawTriangles,[$v,$g,$Q,$d,$r,$k,$$,$b,$a,$M])},$v._saveToCmd=function($v,$g){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$g,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($g)),$g.callee=$v,this._repaint(),$g},$v.clipRect=function($v,$g,$Q,$d){this._saveToCmd($i._context._clipRect,[$v,$g,$Q,$d])},$v.fillText=function($v,$g,$Q,$d,$r,$k,$$){void 0===$$&&($$=0),this._saveToCmd($i._context._fillText,[$v,$g,$Q,$d||$p.defaultFont,$r,$k])},$v.fillBorderText=function($v,$g,$Q,$d,$r,$k,$$,$b){this._saveToCmd($i._context._fillBorderText,[$v,$g,$Q,$d||$p.defaultFont,$r,$k,$$,$b])},$v.strokeText=function($v,$g,$Q,$d,$r,$k,$$){this._saveToCmd($i._context._strokeText,[$v,$g,$Q,$d||$p.defaultFont,$r,$k,$$])},$v.alpha=function($v){$v=$v<0?0:1<$v?1:$v,this._saveToCmd($i._context._alpha,[$v])},$v.setAlpha=function($v){$v=$v<0?0:1<$v?1:$v,this._saveToCmd($i._context._setAlpha,[$v])},$v.transform=function($v,$g,$Q){void 0===$g&&($g=0),void 0===$Q&&($Q=0),this._saveToCmd($i._context._transform,[$v,$g,$Q])},$v.rotate=function($v,$g,$Q){void 0===$g&&($g=0),void 0===$Q&&($Q=0),this._saveToCmd($i._context._rotate,[$v,$g,$Q])},$v.scale=function($v,$g,$Q,$d){void 0===$Q&&($Q=0),void 0===$d&&($d=0),this._saveToCmd($i._context._scale,[$v,$g,$Q,$d])},$v.translate=function($v,$g){this._saveToCmd($i._context._translate,[$v,$g])},$v.save=function(){this._saveToCmd($i._context._save,[])},$v.restore=function(){this._saveToCmd($i._context._restore,[])},$v.replaceText=function($v){this._repaint();var $g=this._cmds;if($g){for(var $Q=$g.length-1;-1<$Q;$Q--)if(this._isTextCmd($g[$Q].callee))return $g[$Q][0].toUpperCase?$g[$Q][0]=$v:$g[$Q][0].setText($v),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$v:this._one[0].setText($v),!0;return!1},$v._isTextCmd=function($v){return $v===$i._context._fillText||$v===$i._context._fillBorderText||$v===$i._context._strokeText},$v.replaceTextColor=function($v){this._repaint();var $g=this._cmds;if($g)for(var $Q=$g.length-1;-1<$Q;$Q--)this._isTextCmd($g[$Q].callee)&&($g[$Q][4]=$v,$g[$Q][0].toUpperCase||($g[$Q][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$v,this._one[0].toUpperCase||(this._one[0].changed=!0))},$v.loadImage=function($v,$g,$Q,$d,$r,$k){var $$=this;void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0),void 0===$r&&($r=0);var $b=$bv.getRes($v);function $a($v){$v&&($$.drawTexture($v,$g,$Q,$d,$r),null!=$k&&$k.call($$._sp,$v))}$b?$a($b):$W.loader.load($v,$G.create(null,$a),null,"image")},$v._renderEmpty=function($v,$g,$Q,$d){},$v._renderAll=function($v,$g,$Q,$d){for(var $r,$k=this._cmds,$$=0,$b=$k.length;$$<$b;$$++)($r=$k[$$]).callee.call($g,$Q,$d,$r)},$v._renderOne=function($v,$g,$Q,$d){this._one.callee.call($g,$Q,$d,this._one)},$v._renderOneImg=function($v,$g,$Q,$d){this._one.callee.call($g,$Q,$d,this._one),2305!==$v._renderType&&($v._renderType|=1)},$v.drawLine=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=1);var $$=0;$i.isWebGL&&($$=$O.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($$));var $b=$k%2==0?0:.5,$a=[$v+$b,$g+$b,$Q+$b,$d+$b,$r,$k,$$];this._saveToCmd($i._context._drawLine,$a)},$v.drawLines=function($v,$g,$Q,$d,$r){void 0===$r&&($r=1);var $k=0;if($Q&&!($Q.length<4)){$i.isWebGL&&($k=$O.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($k));var $$=$r%2==0?0:.5,$b=[$v+$$,$g+$$,$Q,$d,$r,$k];this._saveToCmd($i._context._drawLines,$b)}},$v.drawCurves=function($v,$g,$Q,$d,$r){void 0===$r&&($r=1);var $k=[$v,$g,$Q,$d,$r];this._saveToCmd($i._context._drawCurves,$k)},$v.drawRect=function($v,$g,$Q,$d,$r,$k,$$){void 0===$$&&($$=1);var $b=$k?$$/2:0,$a=$k?$$:0,$M=[$v+$b,$g+$b,$Q-$a,$d-$a,$r,$k,$$];this._saveToCmd($i._context._drawRect,$M)},$v.drawCircle=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=1);var $$=$r?$k/2:0,$b=0;$i.isWebGL&&($b=$O.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($b));var $a=[$v,$g,$Q-$$,$d,$r,$k,$b];this._saveToCmd($i._context._drawCircle,$a)},$v.drawPie=function($v,$g,$Q,$d,$r,$k,$$,$b){void 0===$b&&($b=1);var $a=$$?$b/2:0,$M=$$?$b:0,$Y=0;$i.isWebGL&&($Y=$O.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($Y));var $D=[$v+$a,$g+$a,$Q-$M,$d,$r,$k,$$,$b,$Y];$D[3]=$S.toRadian($d),$D[4]=$S.toRadian($r),this._saveToCmd($i._context._drawPie,$D)},$v.drawPoly=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=1);var $$=0,$b=!1;$i.isWebGL&&($$=$O.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($$),$b=!(6<$Q.length));var $a=$r?$k%2==0?0:.5:0,$M=[$v+$a,$g+$a,$Q,$d,$r,$k,$$,$b];this._saveToCmd($i._context._drawPoly,$M)},$v.drawPath=function($v,$g,$Q,$d,$r){var $k=[$v,$g,$Q,$d,$r];this._saveToCmd($i._context._drawPath,$k)},$Y(0,$v,"cmds",function(){return this._cmds},function($v){this._sp&&(this._sp._renderType|=512),this._cmds=$v,this._render=this._renderAll,this._repaint()}),$D.__init__=function(){if($i.isConchNode){for(var $v=laya.display.Graphics.prototype,$g=$c.window.ConchGraphics.prototype,$Q=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$d=0,$r=$Q.length;$d<=$r;$d++){var $k=$Q[$d];$v[$k]=$g[$k]}$v._saveToCmd=null,$g.drawImageS&&($v.drawTextures=function($v,$g){if($v&&$v.loaded&&$v.bitmap&&$v.source){var $Q=$v.uv,$d=$v.bitmap.width,$r=$v.bitmap.height;this.drawImageS($v.bitmap.source,$Q[0]*$d,$Q[1]*$r,($Q[2]-$Q[0])*$d,($Q[5]-$Q[3])*$r,$v.offsetX,$v.offsetY,$v.width,$v.height,$g)}}),$v.drawTexture=function($v,$g,$Q,$d,$r,$k,$$){if(void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$$&&($$=1),$v)if($v.loaded){if($v.loaded&&$v.bitmap&&$v.source&&($d||($d=$v.sourceWidth),$r||($r=$v.sourceHeight),$$=$$<0?0:1<$$?1:$$,$d=$d-$v.sourceWidth+$v.width,$r=$r-$v.sourceHeight+$v.height,!($d<=0||$r<=0))){$g+=$v.offsetX,$Q+=$v.offsetY;var $b=$v.uv,$a=$v.bitmap.width,$M=$v.bitmap.height;$b[4]<$b[0]&&$b[5]<$b[1]?this.drawImageM($v.bitmap.source,$b[4]*$a,$b[5]*$M,($b[0]-$b[4])*$a,($b[1]-$b[5])*$M,$g,$Q,$d,$r,$k,$$):this.drawImageM($v.bitmap.source,$b[0]*$a,$b[1]*$M,($b[2]-$b[0])*$a,($b[5]-$b[3])*$M,$g,$Q,$d,$r,$k,$$),this._repaint()}}else $v.once("loaded",this,function(){this.drawTexture($v,$g,$Q,$d,$r,$k)})},$v.fillTexture=function($v,$g,$Q,$d,$r,$k,$$){if(void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$k&&($k="repeat"),$v&&$v.loaded){var $b,$a=$i._context.ctx,$M=$v.bitmap.width,$Y=$v.bitmap.height,$D=$v.uv;$b=$v.uv!=$Yv.DEF_UV?$a.createPattern($v.bitmap.source,$k,$D[0]*$M,$D[1]*$Y,($D[2]-$D[0])*$M,($D[5]-$D[3])*$Y):$a.createPattern($v.bitmap.source,$k);var $J=0,$p=0;$$&&($g+=$$.x%$v.width,$Q+=$$.y%$v.height,$J-=$$.x%$v.width,$p-=$$.y%$v.height),this._fillImage($b,$g,$Q,$J,$p,$d,$r)}}}},$D._cache=[],$D}(),$Q=function(){function $s(){this._cacheBoundsType=!1}$t($s,"laya.display.GraphicsBounds");var $v=$s.prototype;return $v.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$v.reset=function(){this._temp&&(this._temp.length=0)},$v.getBounds=function($v){return void 0===$v&&($v=!1),(!this._bounds||!this._temp||this._temp.length<1||$v!=this._cacheBoundsType)&&(this._bounds=$l._getWrapRec(this.getBoundPoints($v),this._bounds)),this._cacheBoundsType=$v,this._bounds},$v.getBoundPoints=function($v){return void 0===$v&&($v=!1),(!this._temp||this._temp.length<1||$v!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($v)),this._cacheBoundsType=$v,this._rstBoundPoints=$S.copyArray(this._rstBoundPoints,this._temp)},$v._getCmdPoints=function($v){void 0===$v&&($v=!1);var $g,$Q,$d=$i._context,$r=this._graphics.cmds;if(($g=this._temp||(this._temp=[])).length=0,$r||null==this._graphics._one||($s._tempCmds.length=0,$s._tempCmds.push(this._graphics._one),$r=$s._tempCmds),!$r)return $g;($Q=$s._tempMatrixArrays).length=0;var $k=$s._initMatrix;$k.identity();for(var $$,$b,$a=$s._tempMatrix,$M=NaN,$Y=NaN,$D=NaN,$J=NaN,$p=NaN,$T=NaN,$t=0,$q=$r.length;$t<$q;$t++)if(($$=$r[$t]).callee)switch($$.callee){case $d._save:case 7:$Q.push($k),$k=$k.clone();break;case $d._restore:case 8:$k=$Q.pop();break;case $d._scale:case 5:$a.identity(),$a.translate(-$$[2],-$$[3]),$a.scale($$[0],$$[1]),$a.translate($$[2],$$[3]),this._switchMatrix($k,$a);break;case $d._rotate:case 3:$a.identity(),$a.translate(-$$[1],-$$[2]),$a.rotate($$[0]),$a.translate($$[1],$$[2]),this._switchMatrix($k,$a);break;case $d._translate:case 6:$a.identity(),$a.translate($$[0],$$[1]),this._switchMatrix($k,$a);break;case $d._transform:case 4:$a.identity(),$a.translate(-$$[1],-$$[2]),$a.concat($$[0]),$a.translate($$[1],$$[2]),this._switchMatrix($k,$a);break;case 16:case 24:$s._addPointArrToRst($g,$l._getBoundPointS($$[0],$$[1],$$[2],$$[3]),$k);break;case 17:$k.copyTo($a),$a.concat($$[4]),$s._addPointArrToRst($g,$l._getBoundPointS($$[0],$$[1],$$[2],$$[3]),$a);break;case $d._drawTexture:$b=$$[0],$v?$$[3]&&$$[4]?$s._addPointArrToRst($g,$l._getBoundPointS($$[1],$$[2],$$[3],$$[4]),$k):($b=$$[0],$s._addPointArrToRst($g,$l._getBoundPointS($$[1],$$[2],$b.width,$b.height),$k)):($M=($$[3]||$b.sourceWidth)/$b.width,$Y=($$[4]||$b.sourceHeight)/$b.height,$D=$M*$b.sourceWidth,$J=$Y*$b.sourceHeight,$p=0<$b.offsetX?$b.offsetX:0,$T=0<$b.offsetY?$b.offsetY:0,$p*=$M,$T*=$Y,$s._addPointArrToRst($g,$l._getBoundPointS($$[1]-$p,$$[2]-$T,$D,$J),$k));break;case $d._fillTexture:$$[3]&&$$[4]?$s._addPointArrToRst($g,$l._getBoundPointS($$[1],$$[2],$$[3],$$[4]),$k):($b=$$[0],$s._addPointArrToRst($g,$l._getBoundPointS($$[1],$$[2],$b.width,$b.height),$k));break;case $d._drawTextureWithTransform:var $C;$C=$$[5]?($k.copyTo($a),$a.concat($$[5]),$a):$k,$v?$$[3]&&$$[4]?$s._addPointArrToRst($g,$l._getBoundPointS($$[1],$$[2],$$[3],$$[4]),$C):($b=$$[0],$s._addPointArrToRst($g,$l._getBoundPointS($$[1],$$[2],$b.width,$b.height),$C)):($b=$$[0],$M=($$[3]||$b.sourceWidth)/$b.width,$Y=($$[4]||$b.sourceHeight)/$b.height,$D=$M*$b.sourceWidth,$J=$Y*$b.sourceHeight,$p=0<$b.offsetX?$b.offsetX:0,$T=0<$b.offsetY?$b.offsetY:0,$p*=$M,$T*=$Y,$s._addPointArrToRst($g,$l._getBoundPointS($$[1]-$p,$$[2]-$T,$D,$J),$C));break;case $d._drawRect:case 13:$s._addPointArrToRst($g,$l._getBoundPointS($$[0],$$[1],$$[2],$$[3]),$k);break;case $d._drawCircle:case $d._fillCircle:case 14:$s._addPointArrToRst($g,$l._getBoundPointS($$[0]-$$[2],$$[1]-$$[2],$$[2]+$$[2],$$[2]+$$[2]),$k);break;case $d._drawLine:case 20:$s._tempPoints.length=0;var $G;$G=.5*$$[5],$$[0]==$$[2]?$s._tempPoints.push($$[0]+$G,$$[1],$$[2]+$G,$$[3],$$[0]-$G,$$[1],$$[2]-$G,$$[3]):$$[1]==$$[3]?$s._tempPoints.push($$[0],$$[1]+$G,$$[2],$$[3]+$G,$$[0],$$[1]-$G,$$[2],$$[3]-$G):$s._tempPoints.push($$[0],$$[1],$$[2],$$[3]),$s._addPointArrToRst($g,$s._tempPoints,$k);break;case $d._drawCurves:case 22:$s._addPointArrToRst($g,$A.I.getBezierPoints($$[2]),$k,$$[0],$$[1]);break;case $d._drawPoly:case $d._drawLines:case 18:$s._addPointArrToRst($g,$$[2],$k,$$[0],$$[1]);break;case $d._drawPath:case 19:$s._addPointArrToRst($g,this._getPathPoints($$[2]),$k,$$[0],$$[1]);break;case $d._drawPie:case 15:$s._addPointArrToRst($g,this._getPiePoints($$[0],$$[1],$$[2],$$[3],$$[4]),$k)}return 200<$g.length?$g=$S.copyArray($g,$l._getWrapRec($g)._getBoundPoints()):8<$g.length&&($g=$h.scanPList($g)),$g},$v._switchMatrix=function($v,$g){$g.concat($v),$g.copyTo($v)},$v._getPiePoints=function($v,$g,$Q,$d,$r){var $k=$s._tempPoints;$s._tempPoints.length=0,$k.push($v,$g);var $$=($r-$d)%(2*Math.PI)/10,$b=NaN,$a=$d;for($b=0;$b<=10;$b++)$k.push($v+$Q*Math.cos($a),$g+$Q*Math.sin($a)),$a+=$$;return $k},$v._getPathPoints=function($v){var $g,$Q,$d=0,$r=$s._tempPoints;for($r.length=0,$g=$v.length,$d=0;$d<$g;$d++)1<($Q=$v[$d]).length&&($r.push($Q[1],$Q[2]),3<$Q.length&&$r.push($Q[3],$Q[4]));return $r},$s._addPointArrToRst=function($v,$g,$Q,$d,$r){void 0===$d&&($d=0),void 0===$r&&($r=0);var $k,$$=0;for($k=$g.length,$$=0;$$<$k;$$+=2)$s._addPointToRst($v,$g[$$]+$d,$g[$$+1]+$r,$Q)},$s._addPointToRst=function($v,$g,$Q,$d){var $r=$F.TEMP;$r.setTo($g||0,$Q||0),$d.transformPoint($r),$v.push($r.x,$r.y)},$s._tempPoints=[],$s._tempMatrixArrays=[],$s._tempCmds=[],$a($s,["_tempMatrix",function(){return this._tempMatrix=new $f},"_initMatrix",function(){return this._initMatrix=new $f}]),$s}(),$k=function(){function $v(){}$t($v,"laya.events.Event");var $g=$v.prototype;return $g.setTo=function($v,$g,$Q){return this.type=$v,this.currentTarget=$g,this.target=$Q,this},$g.stopPropagation=function(){this._stoped=!0},$Y(0,$g,"stageY",function(){return $W.stage.mouseY}),$Y(0,$g,"charCode",function(){return this.nativeEvent.charCode}),$Y(0,$g,"touches",function(){var $v=this.nativeEvent.touches;if($v)for(var $g=$W.stage,$Q=0,$d=$v.length;$Q<$d;$Q++){var $r=$v[$Q],$k=$F.TEMP;$k.setTo($r.clientX,$r.clientY),$g._canvasTransform.invertTransformPoint($k),$g.transform.invertTransformPoint($k),$r.stageX=$k.x,$r.stageY=$k.y}return $v}),$Y(0,$g,"keyLocation",function(){return this.nativeEvent.keyLocation}),$Y(0,$g,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$Y(0,$g,"altKey",function(){return this.nativeEvent.altKey}),$Y(0,$g,"shiftKey",function(){return this.nativeEvent.shiftKey}),$Y(0,$g,"stageX",function(){return $W.stage.mouseX}),$v.EMPTY=new $v,$v.MOUSE_DOWN="mousedown",$v.MOUSE_UP="mouseup",$v.CLICK="click",$v.RIGHT_MOUSE_DOWN="rightmousedown",$v.RIGHT_MOUSE_UP="rightmouseup",$v.RIGHT_CLICK="rightclick",$v.MOUSE_MOVE="mousemove",$v.MOUSE_OVER="mouseover",$v.MOUSE_OUT="mouseout",$v.MOUSE_WHEEL="mousewheel",$v.ROLL_OVER="mouseover",$v.ROLL_OUT="mouseout",$v.DOUBLE_CLICK="doubleclick",$v.CHANGE="change",$v.CHANGED="changed",$v.RESIZE="resize",$v.ADDED="added",$v.REMOVED="removed",$v.DISPLAY="display",$v.UNDISPLAY="undisplay",$v.ERROR="error",$v.COMPLETE="complete",$v.LOADED="loaded",$v.INITED="inited",$v.PROGRESS="progress",$v.INPUT="input",$v.RENDER="render",$v.OPEN="open",$v.MESSAGE="message",$v.CLOSE="close",$v.KEY_DOWN="keydown",$v.KEY_PRESS="keypress",$v.KEY_UP="keyup",$v.FRAME="enterframe",$v.DRAG_START="dragstart",$v.DRAG_MOVE="dragmove",$v.DRAG_END="dragend",$v.ENTER="enter",$v.SELECT="select",$v.BLUR="blur",$v.FOCUS="focus",$v.VISIBILITY_CHANGE="visibilitychange",$v.FOCUS_CHANGE="focuschange",$v.PLAYED="played",$v.PAUSED="paused",$v.STOPPED="stopped",$v.START="start",$v.END="end",$v.ENABLE_CHANGED="enablechanged",$v.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$v.COMPONENT_ADDED="componentadded",$v.COMPONENT_REMOVED="componentremoved",$v.LAYER_CHANGED="layerchanged",$v.HIERARCHY_LOADED="hierarchyloaded",$v.RECOVERED="recovered",$v.RELEASED="released",$v.LINK="link",$v.LABEL="label",$v.FULL_SCREEN_CHANGE="fullscreenchange",$v.DEVICE_LOST="devicelost",$v.MESH_CHANGED="meshchanged",$v.MATERIAL_CHANGED="materialchanged",$v.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$v.ANIMATION_CHANGED="animationchanged",$v.TRIGGER_ENTER="triggerenter",$v.TRIGGER_STAY="triggerstay",$v.TRIGGER_EXIT="triggerexit",$v.TRAIL_FILTER_CHANGE="trailfilterchange",$v.DOMINO_FILTER_CHANGE="dominofilterchange",$v}(),$D=(function(){function $v(){}$t($v,"laya.events.Keyboard"),$v.NUMBER_0=48,$v.NUMBER_1=49,$v.NUMBER_2=50,$v.NUMBER_3=51,$v.NUMBER_4=52,$v.NUMBER_5=53,$v.NUMBER_6=54,$v.NUMBER_7=55,$v.NUMBER_8=56,$v.NUMBER_9=57,$v.A=65,$v.B=66,$v.C=67,$v.D=68,$v.E=69,$v.F=70,$v.G=71,$v.H=72,$v.I=73,$v.J=74,$v.K=75,$v.L=76,$v.M=77,$v.N=78,$v.O=79,$v.P=80,$v.Q=81,$v.R=82,$v.S=83,$v.T=84,$v.U=85,$v.V=86,$v.W=87,$v.X=88,$v.Y=89,$v.Z=90,$v.F1=112,$v.F2=113,$v.F3=114,$v.F4=115,$v.F5=116,$v.F6=117,$v.F7=118,$v.F8=119,$v.F9=120,$v.F10=121,$v.F11=122,$v.F12=123,$v.F13=124,$v.F14=125,$v.F15=126,$v.NUMPAD=21,$v.NUMPAD_0=96,$v.NUMPAD_1=97,$v.NUMPAD_2=98,$v.NUMPAD_3=99,$v.NUMPAD_4=100,$v.NUMPAD_5=101,$v.NUMPAD_6=102,$v.NUMPAD_7=103,$v.NUMPAD_8=104,$v.NUMPAD_9=105,$v.NUMPAD_ADD=107,$v.NUMPAD_DECIMAL=110,$v.NUMPAD_DIVIDE=111,$v.NUMPAD_ENTER=108,$v.NUMPAD_MULTIPLY=106,$v.NUMPAD_SUBTRACT=109,$v.SEMICOLON=186,$v.EQUAL=187,$v.COMMA=188,$v.MINUS=189,$v.PERIOD=190,$v.SLASH=191,$v.BACKQUOTE=192,$v.LEFTBRACKET=219,$v.BACKSLASH=220,$v.RIGHTBRACKET=221,$v.QUOTE=222,$v.ALTERNATE=18,$v.BACKSPACE=8,$v.CAPS_LOCK=20,$v.COMMAND=15,$v.CONTROL=17,$v.DELETE=46,$v.ENTER=13,$v.ESCAPE=27,$v.PAGE_UP=33,$v.PAGE_DOWN=34,$v.END=35,$v.HOME=36,$v.LEFT=37,$v.UP=38,$v.RIGHT=39,$v.DOWN=40,$v.SHIFT=16,$v.SPACE=32,$v.TAB=9,$v.INSERT=45}(),function(){function $r(){}return $t($r,"laya.events.KeyBoardManager"),$r.__init__=function(){$r._addEvent("keydown"),$r._addEvent("keypress"),$r._addEvent("keyup")},$r._addEvent=function($g){$c.document.addEventListener($g,function($v){laya.events.KeyBoardManager._dispatch($v,$g)},!0)},$r._dispatch=function($v,$g){if($r.enabled){$r._event._stoped=!1,$r._event.nativeEvent=$v,$r._event.keyCode=$v.keyCode||$v.which||$v.charCode,"keydown"===$g?$r._pressKeys[$r._event.keyCode]=!0:"keyup"===$g&&($r._pressKeys[$r._event.keyCode]=null);for(var $Q=$W.stage.focus&&null!=$W.stage.focus.event&&$W.stage.focus.displayedInStage?$W.stage.focus:$W.stage,$d=$Q;$d;)$d.event($g,$r._event.setTo($g,$d,$Q)),$d=$d.parent}},$r.hasKeyDown=function($v){return $r._pressKeys[$v]},$r._pressKeys={},$r.enabled=!0,$a($r,["_event",function(){return this._event=new $k}]),$r}()),$T=(function(){function $v(){}$t($v,"laya.events.KeyLocation"),$v.STANDARD=0,$v.LEFT=1,$v.RIGHT=2,$v.NUM_PAD=3}(),function(){function $Y(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$c.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $k,this._matrix=new $f,this._point=new $F,this._rect=new $l,this._prePoint=new $F,this._curTouchID=NaN}$t($Y,"laya.events.MouseManager");var $v=$Y.prototype;return $v.__init__=function($v,$g){var $Q=this;this._stage=$v;var $d=this,$r=this._eventList;$g.oncontextmenu=function($v){if($Y.enabled)return!1},$g.addEventListener("mousedown",function($v){$Y.enabled&&($c.onIE||$v.preventDefault(),$r.push($v),$d.mouseDownTime=$c.now())}),$g.addEventListener("mouseup",function($v){$Y.enabled&&($v.preventDefault(),$r.push($v),$d.mouseDownTime=-$c.now())},!0),$g.addEventListener("mousemove",function($v){if($Y.enabled){$v.preventDefault();var $g=$c.now();if($g-$d._lastMoveTimer<10)return;$d._lastMoveTimer=$g,$r.push($v)}},!0),$g.addEventListener("mouseout",function($v){$Y.enabled&&$r.push($v)}),$g.addEventListener("mouseover",function($v){$Y.enabled&&$r.push($v)}),$g.addEventListener("touchstart",function($v){$Y.enabled&&($r.push($v),$Y._isFirstTouch||$hv.isInputting||$v.preventDefault(),$d.mouseDownTime=$c.now())}),$g.addEventListener("touchend",function($v){$Y.enabled?($Y._isFirstTouch||$hv.isInputting||$v.preventDefault(),$Y._isFirstTouch=!1,$r.push($v),$d.mouseDownTime=-$c.now()):$Q._curTouchID=NaN},!0),$g.addEventListener("touchmove",function($v){$Y.enabled&&($v.preventDefault(),$r.push($v))},!0),$g.addEventListener("touchcancel",function($v){$Y.enabled?($v.preventDefault(),$r.push($v)):$Q._curTouchID=NaN},!0),$g.addEventListener("mousewheel",function($v){$Y.enabled&&$r.push($v)}),$g.addEventListener("DOMMouseScroll",function($v){$Y.enabled&&$r.push($v)})},$v.initEvent=function($v,$g){var $Q;this._event._stoped=!1,this._event.nativeEvent=$g||$v,this._target=null,this._point.setTo($v.pageX||$v.clientX,$v.pageY||$v.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$v.identifier||0,this._tTouchID=this._event.touchId,($Q=$q.I._event)._stoped=!1,$Q.nativeEvent=this._event.nativeEvent,$Q.touchId=this._event.touchId},$v.checkMouseWheel=function($v){this._event.delta=$v.wheelDelta?.025*$v.wheelDelta:-$v.detail;for(var $g=$q.I.getLastOvers(),$Q=0,$d=$g.length;$Q<$d;$Q++){var $r=$g[$Q];$r.event("mousewheel",this._event.setTo("mousewheel",$r,this._target))}},$v.onMouseMove=function($v){$q.I.onMouseMove($v,this._tTouchID)},$v.onMouseDown=function($v){if($hv.isInputting&&$W.stage.focus&&$W.stage.focus.focus&&!$W.stage.focus.contains(this._target)){var $g=$W.stage.focus._tf||$W.stage.focus,$Q=$v._tf||$v;$Q instanceof laya.display.Input&&$Q.multiline==$g.multiline?$g._focusOut():$g.focus=!1}$q.I.onMouseDown($v,this._tTouchID,this._isLeftMouse)},$v.onMouseUp=function($v){$q.I.onMouseUp($v,this._tTouchID,this._isLeftMouse)},$v.check=function($v,$g,$Q,$d){this._point.setTo($g,$Q),$v.fromParentPoint(this._point),$g=this._point.x,$Q=this._point.y;var $r=$v.scrollRect;if($r&&(this._rect.setTo($r.x,$r.y,$r.width,$r.height),!this._rect.contains($g,$Q)))return!1;if(!this.disableMouseEvent){if($v.hitTestPrior&&!$v.mouseThrough&&!this.hitTest($v,$g,$Q))return!1;for(var $k=$v._childs.length-1;-1<$k;$k--){var $$=$v._childs[$k];if(!$$.destroyed&&$$.mouseEnabled&&$$.visible&&this.check($$,$g,$Q,$d))return!0}}var $b=!(!$v.hitTestPrior||$v.mouseThrough||this.disableMouseEvent)||this.hitTest($v,$g,$Q);return $b?(this._target=$v,$d.call(this,$v)):$d===this.onMouseUp&&$v===this._stage&&(this._target=this._stage,$d.call(this,this._target)),$b},$v.hitTest=function($v,$g,$Q){var $d=!1;if($v.scrollRect&&($g-=$v.scrollRect.x,$Q-=$v.scrollRect.y),$v.hitArea instanceof laya.utils.HitArea)return $v.hitArea.isHit($g,$Q);if(0<$v.width&&0<$v.height||$v.mouseThrough||$v.hitArea)if($v.mouseThrough)$d=$v.getGraphicBounds().contains($g,$Q);else{var $r=this._rect;$v.hitArea?$r=$v.hitArea:$r.setTo(0,0,$v.width,$v.height),$d=$r.contains($g,$Q)}return $d},$v.runEvent=function(){var $v=this._eventList.length;if($v){var $g=this;$g.mouseEventTime=$c.now();var $Q,$d=0,$r=0,$k=0;try{for(;$d<$v;){var $$=this._eventList[$d];switch("mousemove"!==$$.type&&(this._prePoint.x=this._prePoint.y=-1e6),$$.type){case"mousedown":this._touchIDs[0]=this._id++,$Y._isTouchRespond?$Y._isTouchRespond=!1:($g._isLeftMouse=0===$$.button,$g.initEvent($$),$g.check($g._stage,$g.mouseX,$g.mouseY,$g.onMouseDown));break;case"mouseup":$g._isLeftMouse=0===$$.button,$g.initEvent($$),$g.check($g._stage,$g.mouseX,$g.mouseY,$g.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$$.clientX)+Math.abs(this._prePoint.y-$$.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$$.clientX,this._prePoint.y=$$.clientY,$g.initEvent($$),$g.check($g._stage,$g.mouseX,$g.mouseY,$g.onMouseMove));break;case"touchstart":$Y._isTouchRespond=!0,$g._isLeftMouse=!0;var $b=$$.changedTouches;for($r=0,$k=$b.length;$r<$k;$r++)$Q=$b[$r],($Y.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$Q.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$Q.identifier]=this._id++,$g.initEvent($Q,$$),$g.check($g._stage,$g.mouseX,$g.mouseY,$g.onMouseDown));break;case"touchend":case"touchcancel":$Y._isTouchRespond=!0,$g._isLeftMouse=!0;var $a=$$.changedTouches;for($r=0,$k=$a.length;$r<$k;$r++)if($Q=$a[$r],$Y.multiTouchEnabled||$Q.identifier==this._curTouchID){this._curTouchID=NaN,$g.initEvent($Q,$$);$g.check($g._stage,$g.mouseX,$g.mouseY,$g.onMouseUp)||$g.onMouseUp(null)}break;case"touchmove":var $M=$$.changedTouches;for($r=0,$k=$M.length;$r<$k;$r++)$Q=$M[$r],($Y.multiTouchEnabled||$Q.identifier==this._curTouchID)&&($g.initEvent($Q,$$),$g.check($g._stage,$g.mouseX,$g.mouseY,$g.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$g.checkMouseWheel($$);break;case"mouseout":$q.I.stageMouseOut();break;case"mouseover":$g._stage.event("mouseover",$g._event.setTo("mouseover",$g._stage,$g._stage))}$d++}}catch($v){throw this._eventList.length=0,$v}this._eventList.length=0}},$Y.enabled=!0,$Y.multiTouchEnabled=!0,$Y._isTouchRespond=!1,$Y._isFirstTouch=!0,$a($Y,["instance",function(){return this.instance=new $Y}]),$Y}()),$q=function(){function $T(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $k}$t($T,"laya.events.TouchManager");var $v=$T.prototype;return $v._clearTempArrs=function(){$T._oldArr.length=0,$T._newArr.length=0,$T._tEleArr.length=0},$v.getTouchFromArr=function($v,$g){var $Q,$d,$r=0;for($Q=$g.length,$r=0;$r<$Q;$r++)if(($d=$g[$r]).id==$v)return $d;return null},$v.removeTouchFromArr=function($v,$g){var $Q=0;for($Q=$g.length-1;0<=$Q;$Q--)$g[$Q].id==$v&&$g.splice($Q,1)},$v.createTouchO=function($v,$g){var $Q;return($Q=$R.getItem("TouchData")||{}).id=$g,$Q.tar=$v,$Q},$v.onMouseDown=function($v,$g,$Q){var $d,$r,$k,$$;(void 0===$Q&&($Q=!1),this.enable)&&($d=this.getTouchFromArr($g,this.preOvers),$k=this.getEles($v,null,$T._tEleArr),$d?$d.tar=$v:($r=this.createTouchO($v,$g),this.preOvers.push($r)),$c.onMobile&&this.sendEvents($k,"mouseover",$g),$$=$Q?this.preDowns:this.preRightDowns,($d=this.getTouchFromArr($g,$$))?$d.tar=$v:($r=this.createTouchO($v,$g),$$.push($r)),this.sendEvents($k,$Q?"mousedown":"rightmousedown",$g),this._clearTempArrs())},$v.sendEvents=function($v,$g,$Q){void 0===$Q&&($Q=0);var $d,$r,$k,$$=0;for($d=$v.length,this._event._stoped=!1,$r=$v[0],$$=0;$$<$d;$$++){if(($k=$v[$$]).destroyed)return;if($k.event($g,this._event.setTo($g,$k,$r)),this._event._stoped)break}},$v.getEles=function($v,$g,$Q){for($Q?$Q.length=0:$Q=[];$v&&$v!=$g;)$Q.push($v),$v=$v.parent;return $Q},$v.checkMouseOutAndOverOfMove=function($v,$g,$Q){if(void 0===$Q&&($Q=0),$g!=$v){var $d,$r,$k=0,$$=0;if($g.contains($v))$r=this.getEles($v,$g,$T._tEleArr),this.sendEvents($r,"mouseover",$Q);else if($v.contains($g))$r=this.getEles($g,$v,$T._tEleArr),this.sendEvents($r,"mouseout",$Q);else{var $b,$a;($r=$T._tEleArr).length=0,$b=this.getEles($g,null,$T._oldArr),$a=this.getEles($v,null,$T._newArr),$$=$b.length;var $M=0;for($k=0;$k<$$;$k++){if($d=$b[$k],0<=($M=$a.indexOf($d))){$a.splice($M,$a.length-$M);break}$r.push($d)}0<$r.length&&this.sendEvents($r,"mouseout",$Q),0<$a.length&&this.sendEvents($a,"mouseover",$Q)}}},$v.onMouseMove=function($v,$g){var $Q,$d;this.enable&&(($Q=this.getTouchFromArr($g,this.preOvers))?(this.checkMouseOutAndOverOfMove($v,$Q.tar),$Q.tar=$v,$d=this.getEles($v,null,$T._tEleArr)):($d=this.getEles($v,null,$T._tEleArr),this.sendEvents($d,"mouseover",$g),this.preOvers.push(this.createTouchO($v,$g))),this.sendEvents($d,"mousemove",$g),this._clearTempArrs())},$v.getLastOvers=function(){return($T._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$T._tEleArr):($T._tEleArr.push($W.stage),$T._tEleArr)},$v.stageMouseOut=function(){var $v;$v=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($v,"mouseout",0)},$v.onMouseUp=function($v,$g,$Q){if(void 0===$Q&&($Q=!1),this.enable){var $d,$r,$k,$$,$b,$a,$M=0,$Y=0,$D=$c.onMobile;if($r=this.getEles($v,null,$T._tEleArr),this.sendEvents($r,$Q?"mouseup":"rightmouseup",$g),$a=$Q?this.preDowns:this.preRightDowns,$d=this.getTouchFromArr($g,$a)){var $J,$p=$c.now();if($J=$p-this._lastClickTime<300,this._lastClickTime=$p,$v==$d.tar)$b=$r;else for($k=this.getEles($d.tar,null,$T._oldArr),($b=$T._newArr).length=0,$Y=$k.length,$M=0;$M<$Y;$M++)$$=$k[$M],0<=$r.indexOf($$)&&$b.push($$);0<$b.length&&this.sendEvents($b,$Q?"click":"rightclick",$g),$Q&&$J&&this.sendEvents($b,"doubleclick",$g),this.removeTouchFromArr($g,$a),$d.tar=null,$R.recover("TouchData",$d)}else;($d=this.getTouchFromArr($g,this.preOvers))&&$D&&(($b=this.getEles($d.tar,null,$b))&&0<$b.length&&this.sendEvents($b,"mouseout",$g),this.removeTouchFromArr($g,this.preOvers),$d.tar=null,$R.recover("TouchData",$d)),this._clearTempArrs()}},$T._oldArr=[],$T._newArr=[],$T._tEleArr=[],$a($T,["I",function(){return this.I=new $T}]),$T}(),$C=function(){function $v(){this._action=null}$t($v,"laya.filters.Filter");var $g=$v.prototype;return $W.imps($g,{"laya.filters.IFilter":!0}),$g.callNative=function($v){},$Y(0,$g,"type",function(){return-1}),$Y(0,$g,"action",function(){return this._action}),$v.BLUR=16,$v.COLOR=32,$v.GLOW=8,$v._filterStart=null,$v._filterEnd=null,$v._EndTarget=null,$v._recycleScope=null,$v._filter=null,$v._useSrc=null,$v._endSrc=null,$v._useOut=null,$v._endOut=null,$v}(),$s=function(){function $v(){this.data=null}$t($v,"laya.filters.ColorFilterAction");var $g=$v.prototype;return $W.imps($g,{"laya.filters.IFilterAction":!0}),$g.apply=function($v){var $g=$v.ctx.ctx,$Q=$v.ctx.ctx.canvas;if(0==$Q.width||0==$Q.height)return $Q;for(var $d,$r=$g.getImageData(0,0,$Q.width,$Q.height),$k=$r.data,$$=0,$b=$k.length;$$<$b;$$+=4)$d=this.getColor($k[$$],$k[$$+1],$k[$$+2],$k[$$+3]),0!=$k[$$+3]&&($k[$$]=$d[0],$k[$$+1]=$d[1],$k[$$+2]=$d[2],$k[$$+3]=$d[3]);return $g.putImageData($r,0,0),$v},$g.getColor=function($v,$g,$Q,$d){var $r=[];if(this.data._mat&&this.data._alpha){var $k=this.data._mat,$$=this.data._alpha;$r[0]=$k[0]*$v+$k[1]*$g+$k[2]*$Q+$k[3]*$d+$$[0],$r[1]=$k[4]*$v+$k[5]*$g+$k[6]*$Q+$k[7]*$d+$$[1],$r[2]=$k[8]*$v+$k[9]*$g+$k[10]*$Q+$k[11]*$d+$$[2],$r[3]=$k[12]*$v+$k[13]*$g+$k[14]*$Q+$k[15]*$d+$$[3]}return $r},$v}(),$A=(function(){function $v(){}$t($v,"laya.maths.Arith"),$v.formatR=function($v){return $v>Math.PI&&($v-=2*Math.PI),$v<-Math.PI&&($v+=2*Math.PI),$v},$v.isPOT=function($v,$g){return 0<$v&&0==($v&$v-1)&&0<$g&&0==($g&$g-1)},$v.setMatToArray=function($v,$g){$v.a,$v.b,$v.c,$v.d,$v.tx,$v.ty,$g[0]=$v.a,$g[1]=$v.b,$g[4]=$v.c,$g[5]=$v.d,$g[12]=$v.tx,$g[13]=$v.ty}}(),function(){function $v(){this._controlPoints=[new $F,new $F,new $F],this._calFun=this.getPoint2}$t($v,"laya.maths.Bezier");var $g=$v.prototype;return $g._switchPoint=function($v,$g){var $Q=this._controlPoints.shift();$Q.setTo($v,$g),this._controlPoints.push($Q)},$g.getPoint2=function($v,$g){var $Q=this._controlPoints[0],$d=this._controlPoints[1],$r=this._controlPoints[2],$k=Math.pow(1-$v,2)*$Q.x+2*$v*(1-$v)*$d.x+Math.pow($v,2)*$r.x,$$=Math.pow(1-$v,2)*$Q.y+2*$v*(1-$v)*$d.y+Math.pow($v,2)*$r.y;$g.push($k,$$)},$g.getPoint3=function($v,$g){var $Q=this._controlPoints[0],$d=this._controlPoints[1],$r=this._controlPoints[2],$k=this._controlPoints[3],$$=Math.pow(1-$v,3)*$Q.x+3*$d.x*$v*(1-$v)*(1-$v)+3*$r.x*$v*$v*(1-$v)+$k.x*Math.pow($v,3),$b=Math.pow(1-$v,3)*$Q.y+3*$d.y*$v*(1-$v)*(1-$v)+3*$r.y*$v*$v*(1-$v)+$k.y*Math.pow($v,3);$g.push($$,$b)},$g.insertPoints=function($v,$g){var $Q,$d=NaN;for($Q=1/($v=0<$v?$v:5),$d=0;$d<=1;$d+=$Q)this._calFun($d,$g)},$g.getBezierPoints=function($v,$g,$Q){void 0===$g&&($g=5),void 0===$Q&&($Q=2);var $d,$r,$k=0;if(($d=$v.length)<2*($Q+1))return[];switch($r=[],$Q){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$Q;)this._controlPoints.push(new $F);for($k=0;$k<2*$Q;$k+=2)this._switchPoint($v[$k],$v[$k+1]);for($k=2*$Q;$k<$d;$k+=2)this._switchPoint($v[$k],$v[$k+1]),$k/2%$Q==0&&this.insertPoints($g,$r);return $r},$a($v,["I",function(){return this.I=new $v}]),$v}()),$h=function(){function $M(){}return $t($M,"laya.maths.GrahamScan"),$M.multiply=function($v,$g,$Q){return($v.x-$Q.x)*($g.y-$Q.y)-($g.x-$Q.x)*($v.y-$Q.y)},$M.dis=function($v,$g){return($v.x-$g.x)*($v.x-$g.x)+($v.y-$g.y)*($v.y-$g.y)},$M._getPoints=function($v,$g,$Q){for(void 0===$g&&($g=!1),$M._mPointList||($M._mPointList=[]);$M._mPointList.length<$v;)$M._mPointList.push(new $F);return $Q||($Q=[]),$Q.length=0,$g?$M.getFrom($Q,$M._mPointList,$v):$M.getFromR($Q,$M._mPointList,$v),$Q},$M.getFrom=function($v,$g,$Q){var $d=0;for($d=0;$d<$Q;$d++)$v.push($g[$d]);return $v},$M.getFromR=function($v,$g,$Q){var $d=0;for($d=0;$d<$Q;$d++)$v.push($g.pop());return $v},$M.pListToPointList=function($v,$g){void 0===$g&&($g=!1);var $Q=0,$d=$v.length/2,$r=$M._getPoints($d,$g,$M._tempPointList);for($Q=0;$Q<$d;$Q++)$r[$Q].setTo($v[$Q+$Q],$v[$Q+$Q+1]);return $r},$M.pointListToPlist=function($v){var $g,$Q=0,$d=$v.length,$r=$M._temPList;for($Q=$r.length=0;$Q<$d;$Q++)$g=$v[$Q],$r.push($g.x,$g.y);return $r},$M.scanPList=function($v){return $S.copyArray($v,$M.pointListToPlist($M.scan($M.pListToPointList($v,!0))))},$M.scan=function($v){var $g,$Q,$d,$r=0,$k=0,$$=0,$b=$v.length,$a={};for(($Q=$M._temArr).length=0,$r=($b=$v.length)-1;0<=$r;$r--)$d=($g=$v[$r]).x+"_"+$g.y,$a.hasOwnProperty($d)||($a[$d]=!0,$Q.push($g));for($b=$Q.length,$S.copyArray($v,$Q),$r=1;$r<$b;$r++)($v[$r].y<$v[$$].y||$v[$r].y==$v[$$].y&&$v[$r].x<$v[$$].x)&&($$=$r);for($g=$v[0],$v[0]=$v[$$],$v[$$]=$g,$r=1;$r<$b-1;$r++){for($k=($$=$r)+1;$k<$b;$k++)(0<$M.multiply($v[$k],$v[$$],$v[0])||0==$M.multiply($v[$k],$v[$$],$v[0])&&$M.dis($v[0],$v[$k])<$M.dis($v[0],$v[$$]))&&($$=$k);$g=$v[$r],$v[$r]=$v[$$],$v[$$]=$g}if(($Q=$M._temArr).length=0,$v.length<3)return $S.copyArray($Q,$v);for($Q.push($v[0],$v[1],$v[2]),$r=3;$r<$b;$r++){for(;2<=$Q.length&&0<=$M.multiply($v[$r],$Q[$Q.length-1],$Q[$Q.length-2]);)$Q.pop();$v[$r]&&$Q.push($v[$r])}return $Q},$M._mPointList=null,$M._tempPointList=[],$M._temPList=[],$M._temArr=[],$M}(),$P=function(){function $r(){}return $t($r,"laya.maths.MathUtil"),$r.subtractVector3=function($v,$g,$Q){$Q[0]=$v[0]-$g[0],$Q[1]=$v[1]-$g[1],$Q[2]=$v[2]-$g[2]},$r.lerp=function($v,$g,$Q){return $v*(1-$Q)+$g*$Q},$r.scaleVector3=function($v,$g,$Q){$Q[0]=$v[0]*$g,$Q[1]=$v[1]*$g,$Q[2]=$v[2]*$g},$r.lerpVector3=function($v,$g,$Q,$d){var $r=$v[0],$k=$v[1],$$=$v[2];$d[0]=$r+$Q*($g[0]-$r),$d[1]=$k+$Q*($g[1]-$k),$d[2]=$$+$Q*($g[2]-$$)},$r.lerpVector4=function($v,$g,$Q,$d){var $r=$v[0],$k=$v[1],$$=$v[2],$b=$v[3];$d[0]=$r+$Q*($g[0]-$r),$d[1]=$k+$Q*($g[1]-$k),$d[2]=$$+$Q*($g[2]-$$),$d[3]=$b+$Q*($g[3]-$b)},$r.slerpQuaternionArray=function($v,$g,$Q,$d,$r,$k,$$){var $b,$a,$M,$Y,$D,$J=$v[$g+0],$p=$v[$g+1],$T=$v[$g+2],$t=$v[$g+3],$q=$Q[$d+0],$C=$Q[$d+1],$G=$Q[$d+2],$s=$Q[$d+3];return($a=$J*$q+$p*$C+$T*$G+$t*$s)<0&&($a=-$a,$q=-$q,$C=-$C,$G=-$G,$s=-$s),$D=1e-6<1-$a?($b=Math.acos($a),$M=Math.sin($b),$Y=Math.sin((1-$r)*$b)/$M,Math.sin($r*$b)/$M):($Y=1-$r,$r),$k[$$+0]=$Y*$J+$D*$q,$k[$$+1]=$Y*$p+$D*$C,$k[$$+2]=$Y*$T+$D*$G,$k[$$+3]=$Y*$t+$D*$s,$k},$r.getRotation=function($v,$g,$Q,$d){return Math.atan2($d-$g,$Q-$v)/Math.PI*180},$r.sortBigFirst=function($v,$g){return $v==$g?0:$v<$g?1:-1},$r.sortSmallFirst=function($v,$g){return $v==$g?0:$v<$g?-1:1},$r.sortNumBigFirst=function($v,$g){return parseFloat($g)-parseFloat($v)},$r.sortNumSmallFirst=function($v,$g){return parseFloat($v)-parseFloat($g)},$r.sortByKey=function($Q,$v,$g){var $d;return void 0===$v&&($v=!1),void 0===$g&&($g=!0),$d=$v?$g?$r.sortNumBigFirst:$r.sortBigFirst:$g?$r.sortNumSmallFirst:$r.sortSmallFirst,function($v,$g){return $d($v[$Q],$g[$Q])}},$r}(),$f=function(){function $Q($v,$g,$Q,$d,$r,$k){this.inPool=!1,this.bTransform=!1,void 0===$v&&($v=1),void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=1),void 0===$r&&($r=0),void 0===$k&&($k=0),this.a=$v,this.b=$g,this.c=$Q,this.d=$d,this.tx=$r,this.ty=$k,this._checkTransform()}$t($Q,"laya.maths.Matrix");var $v=$Q.prototype;return $v.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$v._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$v.setTranslate=function($v,$g){return this.tx=$v,this.ty=$g,this},$v.translate=function($v,$g){return this.tx+=$v,this.ty+=$g,this},$v.scale=function($v,$g){this.a*=$v,this.d*=$g,this.c*=$v,this.b*=$g,this.tx*=$v,this.ty*=$g,this.bTransform=!0},$v.rotate=function($v){var $g=Math.cos($v),$Q=Math.sin($v),$d=this.a,$r=this.c,$k=this.tx;this.a=$d*$g-this.b*$Q,this.b=$d*$Q+this.b*$g,this.c=$r*$g-this.d*$Q,this.d=$r*$Q+this.d*$g,this.tx=$k*$g-this.ty*$Q,this.ty=$k*$Q+this.ty*$g,this.bTransform=!0},$v.skew=function($v,$g){var $Q=Math.tan($v),$d=Math.tan($g),$r=this.a,$k=this.b;return this.a+=$d*this.c,this.b+=$d*this.d,this.c+=$Q*$r,this.d+=$Q*$k,this},$v.invertTransformPoint=function($v){var $g=this.a,$Q=this.b,$d=this.c,$r=this.d,$k=this.tx,$$=$g*$r-$Q*$d,$b=$r/$$,$a=-$Q/$$,$M=-$d/$$,$Y=$g/$$,$D=($d*this.ty-$r*$k)/$$,$J=-($g*this.ty-$Q*$k)/$$;return $v.setTo($b*$v.x+$M*$v.y+$D,$a*$v.x+$Y*$v.y+$J)},$v.transformPoint=function($v){return $v.setTo(this.a*$v.x+this.c*$v.y+this.tx,this.b*$v.x+this.d*$v.y+this.ty)},$v.transformPointN=function($v){return $v.setTo(this.a*$v.x+this.c*$v.y,this.b*$v.x+this.d*$v.y)},$v.transformPointArray=function($v,$g){for(var $Q=$v.length,$d=0;$d<$Q;$d+=2){var $r=$v[$d],$k=$v[$d+1];$g[$d]=this.a*$r+this.c*$k+this.tx,$g[$d+1]=this.b*$r+this.d*$k+this.ty}return $g},$v.transformPointArrayScale=function($v,$g){for(var $Q=$v.length,$d=0;$d<$Q;$d+=2){var $r=$v[$d],$k=$v[$d+1];$g[$d]=this.a*$r+this.c*$k,$g[$d+1]=this.b*$r+this.d*$k}return $g},$v.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$v.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$v.invert=function(){var $v=this.a,$g=this.b,$Q=this.c,$d=this.d,$r=this.tx,$k=$v*$d-$g*$Q;return this.a=$d/$k,this.b=-$g/$k,this.c=-$Q/$k,this.d=$v/$k,this.tx=($Q*this.ty-$d*$r)/$k,this.ty=-($v*this.ty-$g*$r)/$k,this},$v.setTo=function($v,$g,$Q,$d,$r,$k){return this.a=$v,this.b=$g,this.c=$Q,this.d=$d,this.tx=$r,this.ty=$k,this},$v.concat=function($v){var $g=this.a,$Q=this.c,$d=this.tx;return this.a=$g*$v.a+this.b*$v.c,this.b=$g*$v.b+this.b*$v.d,this.c=$Q*$v.a+this.d*$v.c,this.d=$Q*$v.b+this.d*$v.d,this.tx=$d*$v.a+this.ty*$v.c+$v.tx,this.ty=$d*$v.b+this.ty*$v.d+$v.ty,this},$v.scaleEx=function($v,$g){var $Q=this.a,$d=this.b,$r=this.c,$k=this.d;0!==$d||0!==$r?(this.a=$v*$Q,this.b=$v*$d,this.c=$g*$r):(this.a=$v*$Q,this.b=0*$k,this.c=0*$Q),this.d=$g*$k,this.bTransform=!0},$v.rotateEx=function($v){var $g=Math.cos($v),$Q=Math.sin($v),$d=this.a,$r=this.b,$k=this.c,$$=this.d;0!==$r||0!==$k?(this.a=$g*$d+$Q*$k,this.b=$g*$r+$Q*$$,this.c=-$Q*$d+$g*$k,this.d=-$Q*$r+$g*$$):(this.a=$g*$d,this.b=$Q*$$,this.c=-$Q*$d,this.d=$g*$$),this.bTransform=!0},$v.clone=function(){var $v=$Q.create();return $v.a=this.a,$v.b=this.b,$v.c=this.c,$v.d=this.d,$v.tx=this.tx,$v.ty=this.ty,$v.bTransform=this.bTransform,$v},$v.copyTo=function($v){return $v.a=this.a,$v.b=this.b,$v.c=this.c,$v.d=this.d,$v.tx=this.tx,$v.ty=this.ty,$v.bTransform=this.bTransform,$v},$v.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$v.destroy=function(){if(!this.inPool){var $v=$Q._cache;this.inPool=!0,$v._length||($v._length=0),($v[$v._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$Q.mul=function($v,$g,$Q){var $d=$v.a,$r=$v.b,$k=$v.c,$$=$v.d,$b=$v.tx,$a=$v.ty,$M=$g.a,$Y=$g.b,$D=$g.c,$J=$g.d,$p=$g.tx,$T=$g.ty;return 0!==$Y||0!==$D?($Q.a=$d*$M+$r*$D,$Q.b=$d*$Y+$r*$J,$Q.c=$k*$M+$$*$D,$Q.d=$k*$Y+$$*$J,$Q.tx=$M*$b+$D*$a+$p,$Q.ty=$Y*$b+$J*$a+$T):($Q.a=$d*$M,$Q.b=$r*$J,$Q.c=$k*$M,$Q.d=$$*$J,$Q.tx=$M*$b+$p,$Q.ty=$J*$a+$T),$Q},$Q.mul16=function($v,$g,$Q){var $d=$v.a,$r=$v.b,$k=$v.c,$$=$v.d,$b=$v.tx,$a=$v.ty,$M=$g.a,$Y=$g.b,$D=$g.c,$J=$g.d,$p=$g.tx,$T=$g.ty;return 0!==$Y||0!==$D?($Q[0]=$d*$M+$r*$D,$Q[1]=$d*$Y+$r*$J,$Q[4]=$k*$M+$$*$D,$Q[5]=$k*$Y+$$*$J,$Q[12]=$M*$b+$D*$a+$p,$Q[13]=$Y*$b+$J*$a+$T):($Q[0]=$d*$M,$Q[1]=$r*$J,$Q[4]=$k*$M,$Q[5]=$$*$J,$Q[12]=$M*$b+$p,$Q[13]=$J*$a+$T),$Q},$Q.mulPre=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=$v.a,$M=$v.b,$Y=$v.c,$D=$v.d,$J=$v.tx,$p=$v.ty;return 0!==$Q||0!==$d?($b.a=$a*$g+$M*$d,$b.b=$a*$Q+$M*$r,$b.c=$Y*$g+$D*$d,$b.d=$Y*$Q+$D*$r,$b.tx=$g*$J+$d*$p+$k,$b.ty=$Q*$J+$r*$p+$$):($b.a=$a*$g,$b.b=$M*$r,$b.c=$Y*$g,$b.d=$D*$r,$b.tx=$g*$J+$k,$b.ty=$r*$p+$$),$b},$Q.mulPos=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=$v.a,$M=$v.b,$Y=$v.c,$D=$v.d,$J=$v.tx,$p=$v.ty;return 0!==$M||0!==$Y?($b.a=$g*$a+$Q*$Y,$b.b=$g*$M+$Q*$D,$b.c=$d*$a+$r*$Y,$b.d=$d*$M+$r*$D,$b.tx=$a*$k+$Y*$$+$J,$b.ty=$M*$k+$D*$$+$p):($b.a=$g*$a,$b.b=$Q*$D,$b.c=$d*$a,$b.d=$r*$D,$b.tx=$a*$k+$J,$b.ty=$D*$$+$p),$b},$Q.preMul=function($v,$g,$Q){var $d=$v.a,$r=$v.b,$k=$v.c,$$=$v.d,$b=$g.a,$a=$g.b,$M=$g.c,$Y=$g.d,$D=$g.tx,$J=$g.ty;return $Q.a=$b*$d,$Q.b=$Q.c=0,$Q.d=$Y*$$,$Q.tx=$D*$d+$v.tx,$Q.ty=$J*$$+$v.ty,0===$a&&0===$M&&0===$r&&0===$k||($Q.a+=$a*$k,$Q.d+=$M*$r,$Q.b+=$b*$r+$a*$$,$Q.c+=$M*$d+$Y*$k,$Q.tx+=$J*$k,$Q.ty+=$D*$r),$Q},$Q.preMulXY=function($v,$g,$Q,$d){var $r=$v.a,$k=$v.b,$$=$v.c,$b=$v.d;return $d.a=$r,$d.b=$k,$d.c=$$,$d.d=$b,$d.tx=$g*$r+$v.tx+$Q*$$,$d.ty=$Q*$b+$v.ty+$g*$k,$d},$Q.create=function(){var $v=$Q._cache,$g=$v._length?$v[--$v._length]:new $Q;return $g.inPool=!1,$g},$Q.EMPTY=new $Q,$Q.TEMP=new $Q,$Q._cache=[],$Q}(),$F=function(){function $v($v,$g){void 0===$v&&($v=0),void 0===$g&&($g=0),this.x=$v,this.y=$g}$t($v,"laya.maths.Point");var $g=$v.prototype;return $g.setTo=function($v,$g){return this.x=$v,this.y=$g,this},$g.distance=function($v,$g){return Math.sqrt((this.x-$v)*(this.x-$v)+(this.y-$g)*(this.y-$g))},$g.toString=function(){return this.x+","+this.y},$g.normalize=function(){var $v=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$v){var $g=1/$v;this.x*=$g,this.y*=$g}},$v.TEMP=new $v,$v.EMPTY=new $v,$v}(),$l=function(){function $M($v,$g,$Q,$d){void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0),this.x=$v,this.y=$g,this.width=$Q,this.height=$d}$t($M,"laya.maths.Rectangle");var $v=$M.prototype;return $v.setTo=function($v,$g,$Q,$d){return this.x=$v,this.y=$g,this.width=$Q,this.height=$d,this},$v.copyFrom=function($v){return this.x=$v.x,this.y=$v.y,this.width=$v.width,this.height=$v.height,this},$v.contains=function($v,$g){return!(this.width<=0||this.height<=0)&&($v>=this.x&&$v<this.right&&$g>=this.y&&$g<this.bottom)},$v.intersects=function($v){return!($v.x>this.x+this.width||$v.x+$v.width<this.x||$v.y>this.y+this.height||$v.y+$v.height<this.y)},$v.intersection=function($v,$g){return this.intersects($v)?($g||($g=new $M),$g.x=Math.max(this.x,$v.x),$g.y=Math.max(this.y,$v.y),$g.width=Math.min(this.right,$v.right)-$g.x,$g.height=Math.min(this.bottom,$v.bottom)-$g.y,$g):null},$v.union=function($v,$g){return $g||($g=new $M),this.clone($g),$v.width<=0||$v.height<=0?$g:($g.addPoint($v.x,$v.y),$g.addPoint($v.right,$v.bottom),this)},$v.clone=function($v){return $v||($v=new $M),$v.x=this.x,$v.y=this.y,$v.width=this.width,$v.height=this.height,$v},$v.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$v.equals=function($v){return!(!$v||$v.x!==this.x||$v.y!==this.y||$v.width!==this.width||$v.height!==this.height)},$v.addPoint=function($v,$g){return this.x>$v&&(this.width+=this.x-$v,this.x=$v),this.y>$g&&(this.height+=this.y-$g,this.y=$g),this.width<$v-this.x&&(this.width=$v-this.x),this.height<$g-this.y&&(this.height=$g-this.y),this},$v._getBoundPoints=function(){var $v=$M._temB;return($v.length=0)==this.width||0==this.height||$v.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$v},$v.isEmpty=function(){return this.width<=0||this.height<=0},$Y(0,$v,"right",function(){return this.x+this.width}),$Y(0,$v,"bottom",function(){return this.y+this.height}),$M._getBoundPointS=function($v,$g,$Q,$d){var $r=$M._temA;return($r.length=0)==$Q||0==$d||$r.push($v,$g,$v+$Q,$g,$v,$g+$d,$v+$Q,$g+$d),$r},$M._getWrapRec=function($v,$g){if(!$v||$v.length<1)return $g?$g.setTo(0,0,0,0):$M.TEMP.setTo(0,0,0,0);$g=$g||new $M;var $Q,$d,$r,$k,$$,$b=$v.length,$a=$F.TEMP;for($r=$$=-($d=$k=99999),$Q=0;$Q<$b;$Q+=2)$a.x=$v[$Q],$a.y=$v[$Q+1],$d=$d<$a.x?$d:$a.x,$k=$k<$a.y?$k:$a.y,$r=$r>$a.x?$r:$a.x,$$=$$>$a.y?$$:$a.y;return $g.setTo($d,$k,$r-$d,$$-$k)},$M.EMPTY=new $M,$M.TEMP=new $M,$M._temB=[],$M._temA=[],$M}(),$V=function(){function $a(){}return $t($a,"laya.media.SoundManager"),$Y(1,$a,"useAudioMusic",function(){return $a._useAudioMusic},function($v){$a._useAudioMusic=$v,$a._musicClass=$v?$Qv:null}),$Y(1,$a,"autoStopMusic",function(){return $a._autoStopMusic},function($v){$W.stage.off("blur",null,$a._stageOnBlur),$W.stage.off("focus",null,$a._stageOnFocus),$W.stage.off("visibilitychange",null,$a._visibilityChange),($a._autoStopMusic=$v)&&($W.stage.on("blur",null,$a._stageOnBlur),$W.stage.on("focus",null,$a._stageOnFocus),$W.stage.on("visibilitychange",null,$a._visibilityChange))}),$Y(1,$a,"muted",function(){return $a._muted},function($v){$v!=$a._muted&&($v&&$a.stopAllSound(),$a.musicMuted=$v,$a._muted=$v)}),$Y(1,$a,"musicMuted",function(){return $a._musicMuted},function($v){$v!=$a._musicMuted&&($v?($a._tMusic&&$a._musicChannel&&!$a._musicChannel.isStopped?$a._musicChannel.pause():$a._musicChannel=null,$a._musicMuted=$v):($a._musicMuted=$v,$a._tMusic&&$a._musicChannel&&$a._musicChannel.resume()))}),$Y(1,$a,"soundMuted",function(){return $a._soundMuted},function($v){$a._soundMuted=$v}),$a.addChannel=function($v){0<=$a._channels.indexOf($v)||($a._channels.push($v),$a.autoReleaseSound&&0!=$a._notUsedCount&&$a._notUsedUrls[$v.url]&&(delete $a._notUsedUrls[$v.url],0==--$a._notUsedCount&&$W.timer.clear($a,$a.disposeSoundIfNotUsed)))},$a.removeChannel=function($v){var $g=$a._channels,$Q=$g.indexOf($v);if(-1!=$Q&&($g.splice($Q,1),$a.autoReleaseSound)){var $d=$v.url,$r=$a.defaultIntervals[$d]||2e4;if(0<$r){var $k=!0;for($Q=$g.length-1;0<=$Q;$Q--)if($g[$Q].url==$d){$k=!1;break}$k&&($a._notUsedUrls[$d]=Date.now()+$r,0==$a._notUsedCount++&&$W.timer.loop(1e4,$a,$a.disposeSoundIfNotUsed))}}},$a.disposeSoundIfNotUsed=function(){var $v=$a._notUsedUrls;if(0!=$a._notUsedCount){var $g=Date.now();for(var $Q in $v)$g>=$v[$Q]&&(delete $v[$Q],--$a._notUsedCount,$a.destroySound($Q));if(0!=$a._notUsedCount)return}$W.timer.clear($a,$a.disposeSoundIfNotUsed)},$a._visibilityChange=function(){$W.stage.isVisibility?$a._stageOnFocus():$a._stageOnBlur()},$a._stageOnBlur=function(){$a._isActive=!1,$a._musicChannel&&($a._musicChannel.isStopped||($a._blurPaused=!0,$a._musicChannel.pause())),$a.stopAllSound(),$W.stage.once("mousedown",null,$a._stageOnFocus)},$a._recoverWebAudio=function(){$kv.ctx&&"running"!=$kv.ctx.state&&$kv.ctx.resume&&$kv.ctx.resume()},$a._stageOnFocus=function(){if($a._isActive=!0,$a._recoverWebAudio(),$W.stage.off("mousedown",null,$a._stageOnFocus),$a._blurPaused){var $v=$a._musicChannel;$v&&$a._music&&$v.isStopped&&($a._blurPaused=!1,$a._music._disposed?$a.playMusic($v.url,$v.loops,$v.startHandler,$v.completeHandler,$v.startTime):$v.audioBuffer?$v.resume():$a._music.play($v.startTime,$v.loops,$v.startHandler,$v))}},$a.playSound=function($v,$g,$Q,$d,$r,$k){if(void 0===$g&&($g=1),void 0===$k&&($k=0),!$v)return null;if($a._muted)return null;if($a._recoverWebAudio(),$v==$a._tMusic){if($a._musicMuted)return null}else{if(!$a._isActive)return null;if($a._soundMuted)return null}var $$,$b=$a._pool[$v];return $r||($r=$a._soundClass),$b||(($b=new $r).load($v),$a._pool[$v]=$b),($$=$b.play($k,$g,$Q))?($v==$a._tMusic&&($a._music=$b,$a._isActive||($a._blurPaused=!0,$$.pause())),$$.url=$v,$$.volume=$v==$a._tMusic?$a.musicVolume:$a.soundVolume,$$.completeHandler=$d,$$):null},$a.destroySound=function($v){var $g=$a._pool[$v];$g&&(delete $a._pool[$v],$g.dispose())},$a.playMusic=function($v,$g,$Q,$d,$r){return void 0===$g&&($g=0),void 0===$r&&($r=0),$a._tMusic=$v,$a._musicChannel&&$a._musicChannel.stop(),$a._musicChannel=$a.playSound($v,$g,$Q,$d,null,$r)},$a.stopSound=function($v){for(var $g,$Q=$a._channels.length-1;0<=$Q;$Q--)($g=$a._channels[$Q]).url==$v&&$g.stop()},$a.stopAll=function(){$a._tMusic=null;var $v=0;for($v=$a._channels.length-1;0<=$v;$v--)$a._channels[$v].stop()},$a.stopAllSound=function(){var $v,$g=0;for($g=$a._channels.length-1;0<=$g;$g--)($v=$a._channels[$g]).url!=$a._tMusic&&$v.stop()},$a.stopMusic=function(){$a._musicChannel&&$a._musicChannel.stop(),$a._tMusic=null},$a.setSoundVolume=function($v,$g){if($g)$a._setVolume($g,$v);else{$a.soundVolume=$v;var $Q,$d=0;for($d=$a._channels.length-1;0<=$d;$d--)($Q=$a._channels[$d]).url!=$a._tMusic&&($Q.volume=$v)}},$a.setMusicVolume=function($v){$a.musicVolume=$v,$a._setVolume($a._tMusic,$v)},$a._setVolume=function($v,$g){for(var $Q,$d=$a._channels.length-1;0<=$d;$d--)($Q=$a._channels[$d]).url==$v&&($Q.volume=$g)},$a.musicVolume=1,$a.soundVolume=1,$a.playbackRate=1,$a._useAudioMusic=!0,$a._muted=!1,$a._soundMuted=!1,$a._musicMuted=!1,$a._tMusic=null,$a._musicChannel=null,$a._music=null,$a._channels=[],$a._autoStopMusic=!1,$a._blurPaused=!1,$a._isActive=!0,$a._soundClass=null,$a._musicClass=null,$a.autoReleaseSound=!0,$a._pool={},$a.defaultIntervals={},$a._notUsedUrls={},$a._notUsedCount=0,$a}(),$o=function(){var $v;function $Q(){}return $t($Q,"laya.net.LocalStorage"),$Q.__init__=function(){$Q._baseClass||($Q._baseClass=$v).init(),$Q.items=$Q._baseClass.items,$Q.support=$Q._baseClass.support},$Q.setItem=function($v,$g){$Q._baseClass.setItem($v,$g)},$Q.getItem=function($v){return $Q._baseClass.getItem($v)},$Q.setJSON=function($v,$g){$Q._baseClass.setJSON($v,$g)},$Q.getJSON=function($v){return $Q._baseClass.getJSON($v)},$Q.removeItem=function($v){$Q._baseClass.removeItem($v)},$Q.clear=function(){$Q._baseClass.clear()},$Q._baseClass=null,$Q.items=null,$Q.support=!1,$Q.__init$=function(){$v=function(){function $Q(){}return $t($Q,""),$Q.init=function(){try{$Q.support=!0,$Q.items=$$.localStorage,$Q.setItem("laya","1"),$Q.removeItem("laya")}catch($v){$Q.support=!1}$Q.support||console.log("LocalStorage is not supprot or browser is private mode.")},$Q.setItem=function($v,$g){try{$Q.support&&$Q.items.setItem($v,$g)}catch($v){console.warn("set localStorage failed",$v)}},$Q.getItem=function($v){return $Q.support?$Q.items.getItem($v):null},$Q.setJSON=function($v,$g){try{$Q.support&&$Q.items.setItem($v,JSON.stringify($g))}catch($v){console.warn("set localStorage failed",$v)}},$Q.getJSON=function($v){return JSON.parse($Q.support?$Q.items.getItem($v):null)},$Q.removeItem=function($v){$Q.support&&$Q.items.removeItem($v)},$Q.clear=function(){$Q.support&&$Q.items.clear()},$Q.items=null,$Q.support=!1,$Q}()},$Q}(),$X=(function(){function $d(){}$t($d,"laya.net.ResourceVersion"),$d.enable=function($v,$g,$Q){void 0===$Q&&($Q=2),laya.net.ResourceVersion.type=$Q,$W.loader.load($v,$G.create(null,$d.onManifestLoaded,[$g]),null,"json"),$N.customFormat=$d.addVersionPrefix},$d.onManifestLoaded=function($v,$g){$d.manifest=$g,$v.run(),$g||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$d.addVersionPrefix=function($v){return $d.manifest&&$d.manifest[$v]?2==$d.type?$d.manifest[$v]:$d.manifest[$v]+"/"+$v:$v},$d.FOLDER_VERSION=1,$d.FILENAME_VERSION=2,$d.manifest=null,$d.type=1}(),function(){function $v(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$t($v,"laya.net.TTFLoader");var $g=$v.prototype;return $g.load=function($v){var $g=(this._url=$v).split(".ttf")[0].split("/");this.fontName=$g[$g.length-1],$c.window.conch?this._loadConch():$c.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$g._loadConch=function(){this._http=new $$v,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$g._onHttpLoaded=function($v){$c.window.conch.setFontFaceFromBuffer(this.fontName,$v),this._clearHttp(),this._complete()},$g._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$g._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$g._complete=function(){$W.timer.clear(this,this._complete),$W.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$g._checkComplete=function(){$Z.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$g._loadWithFontFace=function(){var $v=new $c.window.FontFace(this.fontName,"url('"+this._url+"')");$c.window.document.fonts.add($v);var $g=this;$v.loaded.then(function(){$g._complete()}),$v.load()},$g._createDiv=function(){this._div=$c.createElement("div"),this._div.innerHTML="laya";var $v=this._div.style;$v.fontFamily=this.fontName,$v.position="absolute",$v.left="-100px",$v.top="-100px",$c.document.body.appendChild(this._div)},$g._loadWithCSS=function(){var $v=this,$g=$c.createElement("style");$g.type="text/css",$c.document.body.appendChild($g),$g.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$Z.measureText("LayaTTFFont",this._fontTxt).width;var $Q=this;$g.onload=function(){$W.timer.once(1e4,$Q,$v._complete)},$W.timer.loop(20,this,this._checkComplete),this._createDiv()},$v._testString="LayaTTFFont",$v}()),$N=function(){function $d($v){this._url=null,this._path=null,this._url=$d.formatURL($v),this._path=$d.getPath($v)}$t($d,"laya.net.URL");var $v=$d.prototype;return $Y(0,$v,"path",function(){return this._path}),$Y(0,$v,"url",function(){return this._url}),$d.formatURL=function($v,$g){if(!$v)return"null path";if(0<$v.indexOf(":"))return $v;null!=$d.customFormat&&($v=$d.customFormat($v,$g));var $Q=$v.charAt(0);if("."===$Q)return $d.formatRelativePath(($g||$d.basePath)+$v);if("~"===$Q)return $d.rootPath+$v.substring(1);if("d"===$Q){if(0===$v.indexOf("data:image"))return $v}else if("/"===$Q)return $v;return($g||$d.basePath)+$v},$d.formatRelativePath=function($v){for(var $g=$v.split("/"),$Q=0,$d=$g.length;$Q<$d;$Q++)".."==$g[$Q]&&($g.splice($Q-1,2),$Q-=2);return $g.join("/")},$d.isAbsolute=function($v){return 0<$v.indexOf(":")||"/"==$v.charAt(0)},$d.getPath=function($v){var $g=$v.lastIndexOf("/");return 0<$g?$v.substr(0,$g+1):""},$d.getFileName=function($v){var $g=$v.lastIndexOf("/");return 0<$g?$v.substr($g+1):$v},$d.version={},$d.basePath="",$d.rootPath="",$d.customFormat=function($v){var $g=$d.version[$v];return!$i.isConchApp&&$g&&($v+="?v="+$g),$v},$d}(),$i=function(){function $r($v,$g){this._timeId=0;var $Q=$r._mainCanvas.source.style;$Q.position="absolute",$Q.top=$Q.left="0px",$Q.background="#000000",$r._mainCanvas.source.id="layaCanvas";var $d=laya.renders.Render.isWebGL;$r._mainCanvas.source.width=$v,$r._mainCanvas.source.height=$g,$d&&$r.WebGL.init($r._mainCanvas,$v,$g),$c.container.appendChild($r._mainCanvas.source),($r._context=new $x($v,$g,$d?null:$r._mainCanvas)).ctx.setIsMainContext(),$c.window.requestAnimationFrame(function $v($g){$c.window.requestAnimationFrame($v);$W.stage._loop()}),$W.stage.on("visibilitychange",this,this._onVisibilitychange)}$t($r,"laya.renders.Render");var $v=$r.prototype;return $v._onVisibilitychange=function(){$W.stage.isVisibility?0!=this._timeId&&$c.window.clearInterval(this._timeId):this._timeId=$c.window.setInterval(this._enterFrame,1e3)},$v._enterFrame=function($v){$W.stage._loop()},$Y(1,$r,"context",function(){return $r._context}),$Y(1,$r,"canvas",function(){return $r._mainCanvas.source}),$r._context=null,$r._mainCanvas=null,$r.WebGL=null,$r.isConchNode=!1,$r.isConchApp=!1,$r.isConchWebGL=!1,$r.isWebGL=!1,$r.is3DMode=!1,$r.optimizeTextureMemory=function($v,$g){return!0},$r.__init$=function(){$$.ConchRenderType=$$.ConchRenderType||1,$$.ConchRenderType|=$$.conch?4:0,$r.isConchNode=5==(5&$$.ConchRenderType),$r.isConchApp=4==(4&$$.ConchRenderType),$r.isConchWebGL=6==$$.ConchRenderType},$r}(),$x=function(){function $$($v,$g,$Q){this.x=0,this.y=0,this._drawTexture=function($v,$g,$Q){$Q[0].loaded&&this.ctx.drawTexture($Q[0],$Q[1],$Q[2],$Q[3],$Q[4],$v,$g)},this._fillTexture=function($v,$g,$Q){$Q[0].loaded&&this.ctx.fillTexture($Q[0],$Q[1]+$v,$Q[2]+$g,$Q[3],$Q[4],$Q[5],$Q[6],$Q[7])},this._drawTextureWithTransform=function($v,$g,$Q){$Q[0].loaded&&this.ctx.drawTextureWithTransform($Q[0],$Q[1],$Q[2],$Q[3],$Q[4],$Q[5],$v,$g,$Q[6])},this._fillQuadrangle=function($v,$g,$Q){this.ctx.fillQuadrangle($Q[0],$Q[1],$Q[2],$Q[3],$Q[4])},this._drawRect=function($v,$g,$Q){var $d=this.ctx;null!=$Q[4]&&($d.fillStyle=$Q[4],$d.fillRect($v+$Q[0],$g+$Q[1],$Q[2],$Q[3],null)),null!=$Q[5]&&($d.strokeStyle=$Q[5],$d.lineWidth=$Q[6],$d.strokeRect($v+$Q[0],$g+$Q[1],$Q[2],$Q[3],$Q[6]))},this._drawPie=function($v,$g,$Q){var $d=this.ctx;$i.isWebGL&&$d.setPathId($Q[8]),$d.beginPath(),$i.isWebGL?($d.movePath($Q[0]+$v,$Q[1]+$g),$d.moveTo(0,0)):$d.moveTo($v+$Q[0],$g+$Q[1]),$d.arc($v+$Q[0],$g+$Q[1],$Q[2],$Q[3],$Q[4]),$d.closePath(),this._fillAndStroke($Q[5],$Q[6],$Q[7],!0)},this._clipRect=function($v,$g,$Q){this.ctx.clipRect($v+$Q[0],$g+$Q[1],$Q[2],$Q[3])},this._fillRect=function($v,$g,$Q){this.ctx.fillRect($v+$Q[0],$g+$Q[1],$Q[2],$Q[3],$Q[4])},this._drawCircle=function($v,$g,$Q){var $d=this.ctx;$i.isWebGL&&$d.setPathId($Q[6]),$z.drawCall++,$d.beginPath(),$i.isWebGL&&$d.movePath($Q[0]+$v,$Q[1]+$g),$d.arc($Q[0]+$v,$Q[1]+$g,$Q[2],0,$$.PI2),$d.closePath(),this._fillAndStroke($Q[3],$Q[4],$Q[5],!0)},this._fillCircle=function($v,$g,$Q){$z.drawCall++;var $d=this.ctx;$d.beginPath(),$d.fillStyle=$Q[3],$d.arc($Q[0]+$v,$Q[1]+$g,$Q[2],0,$$.PI2),$d.fill()},this._setShader=function($v,$g,$Q){this.ctx.setShader($Q[0])},this._drawLine=function($v,$g,$Q){var $d=this.ctx;$i.isWebGL&&$d.setPathId($Q[6]),$d.beginPath(),$d.strokeStyle=$Q[4],$d.lineWidth=$Q[5],$i.isWebGL?($d.movePath($v,$g),$d.moveTo($Q[0],$Q[1]),$d.lineTo($Q[2],$Q[3])):($d.moveTo($v+$Q[0],$g+$Q[1]),$d.lineTo($v+$Q[2],$g+$Q[3])),$d.stroke()},this._drawLines=function($v,$g,$Q){var $d=this.ctx;$i.isWebGL&&$d.setPathId($Q[5]),$d.beginPath(),$v+=$Q[0],$g+=$Q[1],$i.isWebGL&&$d.movePath($v,$g),$d.strokeStyle=$Q[3],$d.lineWidth=$Q[4];var $r=$Q[2],$k=2,$$=$r.length;if($i.isWebGL)for($d.moveTo($r[0],$r[1]);$k<$$;)$d.lineTo($r[$k++],$r[$k++]);else for($d.moveTo($v+$r[0],$g+$r[1]);$k<$$;)$d.lineTo($v+$r[$k++],$g+$r[$k++]);$d.stroke()},this._drawLinesWebGL=function($v,$g,$Q){this.ctx.drawLines($v+this.x+$Q[0],$g+this.y+$Q[1],$Q[2],$Q[3],$Q[4])},this._drawCurves=function($v,$g,$Q){this.ctx.drawCurves($v,$g,$Q)},this._draw=function($v,$g,$Q){$Q[0].call(null,this,$v,$g)},this._transformByMatrix=function($v,$g,$Q){this.ctx.transformByMatrix($Q[0])},this._setTransform=function($v,$g,$Q){this.ctx.setTransform($Q[0],$Q[1],$Q[2],$Q[3],$Q[4],$Q[5])},this._setTransformByMatrix=function($v,$g,$Q){this.ctx.setTransformByMatrix($Q[0])},this._save=function($v,$g,$Q){this.ctx.save()},this._restore=function($v,$g,$Q){this.ctx.restore()},this._translate=function($v,$g,$Q){this.ctx.translate($Q[0],$Q[1])},this._transform=function($v,$g,$Q){this.ctx.translate($Q[1]+$v,$Q[2]+$g);var $d=$Q[0];this.ctx.transform($d.a,$d.b,$d.c,$d.d,$d.tx,$d.ty),this.ctx.translate(-$v-$Q[1],-$g-$Q[2])},this._rotate=function($v,$g,$Q){this.ctx.translate($Q[1]+$v,$Q[2]+$g),this.ctx.rotate($Q[0]),this.ctx.translate(-$v-$Q[1],-$g-$Q[2])},this._scale=function($v,$g,$Q){this.ctx.translate($Q[2]+$v,$Q[3]+$g),this.ctx.scale($Q[0],$Q[1]),this.ctx.translate(-$v-$Q[2],-$g-$Q[3])},this._alpha=function($v,$g,$Q){this.ctx.globalAlpha*=$Q[0]},this._setAlpha=function($v,$g,$Q){this.ctx.globalAlpha=$Q[0]},this._fillText=function($v,$g,$Q){this.ctx.fillText($Q[0],$Q[1]+$v,$Q[2]+$g,$Q[3],$Q[4],$Q[5])},this._strokeText=function($v,$g,$Q){this.ctx.strokeText($Q[0],$Q[1]+$v,$Q[2]+$g,$Q[3],$Q[4],$Q[5],$Q[6])},this._fillBorderText=function($v,$g,$Q){this.ctx.fillBorderText($Q[0],$Q[1]+$v,$Q[2]+$g,$Q[3],$Q[4],$Q[5],$Q[6],$Q[7])},this._blendMode=function($v,$g,$Q){this.ctx.globalCompositeOperation=$Q[0]},this._beginClip=function($v,$g,$Q){this.ctx.beginClip&&this.ctx.beginClip($v+$Q[0],$g+$Q[1],$Q[2],$Q[3])},this._setIBVB=function($v,$g,$Q){this.ctx.setIBVB($Q[0]+$v,$Q[1]+$g,$Q[2],$Q[3],$Q[4],$Q[5],$Q[6],$Q[7])},this._fillTrangles=function($v,$g,$Q){this.ctx.fillTrangles($Q[0],$Q[1]+$v,$Q[2]+$g,$Q[3],$Q[4])},this._drawPath=function($v,$g,$Q){var $d=this.ctx;$i.isWebGL&&$d.setPathId(-1),$d.beginPath(),$v+=$Q[0],$g+=$Q[1],$i.isWebGL&&$d.movePath($v,$g);for(var $r=$Q[2],$k=0,$$=$r.length;$k<$$;$k++){var $b=$r[$k];switch($b[0]){case"moveTo":$i.isWebGL?$d.moveTo($b[1],$b[2]):$d.moveTo($v+$b[1],$g+$b[2]);break;case"lineTo":$i.isWebGL?$d.lineTo($b[1],$b[2]):$d.lineTo($v+$b[1],$g+$b[2]);break;case"arcTo":$i.isWebGL?$d.arcTo($b[1],$b[2],$b[3],$b[4],$b[5]):$d.arcTo($v+$b[1],$g+$b[2],$v+$b[3],$g+$b[4],$b[5]);break;case"closePath":$d.closePath()}}var $a=$Q[3];null!=$a&&($d.fillStyle=$a.fillStyle,$d.fill());var $M=$Q[4];null!=$M&&($d.strokeStyle=$M.strokeStyle,$d.lineWidth=$M.lineWidth||1,$d.lineJoin=$M.lineJoin,$d.lineCap=$M.lineCap,$d.miterLimit=$M.miterLimit,$d.stroke())},this.drawPoly=function($v,$g,$Q){this.ctx.drawPoly($v+this.x+$Q[0],$g+this.y+$Q[1],$Q[2],$Q[3],$Q[4],$Q[5],$Q[6])},this._drawPoly=function($v,$g,$Q){var $d=this.ctx,$r=$Q[2],$k=2,$$=$r.length;if($i.isWebGL)for($d.setPathId($Q[6]),$d.beginPath(),$v+=$Q[0],$g+=$Q[1],$d.movePath($v,$g),$d.moveTo($r[0],$r[1]);$k<$$;)$d.lineTo($r[$k++],$r[$k++]);else for($d.beginPath(),$v+=$Q[0],$g+=$Q[1],$d.moveTo($v+$r[0],$g+$r[1]);$k<$$;)$d.lineTo($v+$r[$k++],$g+$r[$k++]);$d.closePath(),this._fillAndStroke($Q[3],$Q[4],$Q[5],$Q[7])},this._drawSkin=function($v,$g,$Q){var $d=$Q[0];if($d){var $r=this.ctx;$d.render($r,$v,$g)}},this._drawParticle=function($v,$g,$Q){this.ctx.drawParticle($v+this.x,$g+this.y,$Q[0])},this._setFilters=function($v,$g,$Q){this.ctx.setFilters($Q)},$Q?this.ctx=$Q.getContext("2d"):($Q=$sv.create("3D"),this.ctx=$Z.createWebGLContext2D($Q),$Q._setContext(this.ctx)),$Q.size($v,$g),this.canvas=$Q}$t($$,"laya.renders.RenderContext");var $v=$$.prototype;return $v.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$v.drawTexture=function($v,$g,$Q,$d,$r){$v.loaded&&this.ctx.drawTexture($v,$g,$Q,$d,$r,this.x,this.y)},$v._drawTextures=function($v,$g,$Q){$Q[0].loaded&&this.ctx.drawTextures($Q[0],$Q[1],$v+this.x,$g+this.y)},$v.drawTextureWithTransform=function($v,$g,$Q,$d,$r,$k,$$){$v.loaded&&this.ctx.drawTextureWithTransform($v,$g,$Q,$d,$r,$k,this.x,this.y,$$)},$v.fillQuadrangle=function($v,$g,$Q,$d,$r){this.ctx.fillQuadrangle($v,$g,$Q,$d,$r)},$v.drawCanvas=function($v,$g,$Q,$d,$r){this.ctx.drawCanvas($v,$g+this.x,$Q+this.y,$d,$r)},$v.drawRect=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=1);var $$=this.ctx;$$.strokeStyle=$r,$$.lineWidth=$k,$$.strokeRect($v+this.x,$g+this.y,$Q,$d,$k)},$v._fillAndStroke=function($v,$g,$Q,$d){void 0===$d&&($d=!1);var $r=this.ctx;null!=$v&&($r.fillStyle=$v,$i.isWebGL?$r.fill($d):$r.fill()),null!=$g&&0<$Q&&($r.strokeStyle=$g,$r.lineWidth=$Q,$r.stroke())},$v.clipRect=function($v,$g,$Q,$d){this.ctx.clipRect($v+this.x,$g+this.y,$Q,$d)},$v.fillRect=function($v,$g,$Q,$d,$r){this.ctx.fillRect($v+this.x,$g+this.y,$Q,$d,$r)},$v.drawCircle=function($v,$g,$Q,$d,$r){void 0===$r&&($r=1),$z.drawCall++;var $k=this.ctx;$k.beginPath(),$k.strokeStyle=$d,$k.lineWidth=$r,$k.arc($v+this.x,$g+this.y,$Q,0,$$.PI2),$k.stroke()},$v.drawTriangles=function($v,$g,$Q){if($i.isWebGL)this.ctx.drawTriangles($Q[0],$v+$Q[1],$g+$Q[2],$Q[3],$Q[4],$Q[5],$Q[6],$Q[7],$Q[8],$Q[9]);else{var $d=$Q[5],$r=0,$k=$d.length,$$=this.ctx;for($r=0;$r<$k;$r+=3){var $b=2*$d[$r],$a=2*$d[$r+1],$M=2*$d[$r+2];$$.drawTriangle($Q[0],$Q[3],$Q[4],$b,$a,$M,$Q[6],!0)}}},$v.fillCircle=function($v,$g,$Q,$d){$z.drawCall++;var $r=this.ctx;$r.beginPath(),$r.fillStyle=$d,$r.arc($v+this.x,$g+this.y,$Q,0,$$.PI2),$r.fill()},$v.setShader=function($v){this.ctx.setShader($v)},$v.drawLine=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=1);var $$=this.ctx;$$.beginPath(),$$.strokeStyle=$r,$$.lineWidth=$k,$$.moveTo(this.x+$v,this.y+$g),$$.lineTo(this.x+$Q,this.y+$d),$$.stroke()},$v.clear=function(){this.ctx.clear()},$v.transformByMatrix=function($v){this.ctx.transformByMatrix($v)},$v.setTransform=function($v,$g,$Q,$d,$r,$k){this.ctx.setTransform($v,$g,$Q,$d,$r,$k)},$v.setTransformByMatrix=function($v){this.ctx.setTransformByMatrix($v)},$v.save=function(){this.ctx.save()},$v.restore=function(){this.ctx.restore()},$v.translate=function($v,$g){this.ctx.translate($v,$g)},$v.transform=function($v,$g,$Q,$d,$r,$k){this.ctx.transform($v,$g,$Q,$d,$r,$k)},$v.rotate=function($v){this.ctx.rotate($v)},$v.scale=function($v,$g){this.ctx.scale($v,$g)},$v.alpha=function($v){this.ctx.globalAlpha*=$v},$v.setAlpha=function($v){this.ctx.globalAlpha=$v},$v.fillWords=function($v,$g,$Q,$d,$r,$k){void 0===$k&&($k=0),this.ctx.fillWords($v,$g,$Q,$d,$r,$k)},$v.fillBorderWords=function($v,$g,$Q,$d,$r,$k,$$){this.ctx.fillBorderWords($v,$g,$Q,$d,$r,$k,$$)},$v.fillText=function($v,$g,$Q,$d,$r,$k){this.ctx.fillText($v,$g+this.x,$Q+this.y,$d,$r,$k)},$v.strokeText=function($v,$g,$Q,$d,$r,$k,$$){this.ctx.strokeText($v,$g+this.x,$Q+this.y,$d,$r,$k,$$)},$v.blendMode=function($v){this.ctx.globalCompositeOperation=$v},$v.flush=function(){this.ctx.flush&&this.ctx.flush()},$v.addRenderObject=function($v){this.ctx.addRenderObject($v)},$v.beginClip=function($v,$g,$Q,$d){this.ctx.beginClip&&this.ctx.beginClip($v,$g,$Q,$d)},$v.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$v.fillTrangles=function($v,$g,$Q){this.ctx.fillTrangles($Q[0],$Q[1],$Q[2],$Q[3],4<$Q.length?$Q[4]:null)},$$.PI2=2*Math.PI,$$}(),$w=function(){function $$($v,$g){switch(this._next=$g||$$.NORENDER,$v){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$C._filter);case 69905:return void(this._fun=$$._initRenderFun)}this.onCreate($v)}$t($$,"laya.renders.RenderSprite");var $v=$$.prototype;return $v.onCreate=function($v){},$v._style=function($v,$g,$Q,$d){$v._style.render($v,$g,$Q,$d);var $r=this._next;$r._fun.call($r,$v,$g,$Q,$d)},$v._no=function($v,$g,$Q,$d){},$v._custom=function($v,$g,$Q,$d){$v.customRender($g,$Q,$d);var $r=$v._style._tf;this._next._fun.call(this._next,$v,$g,$Q-$r.translateX,$d-$r.translateY)},$v._clip=function($v,$g,$Q,$d){var $r=this._next;if($r!=$$.NORENDER){var $k=$v._style.scrollRect;$g.ctx.save(),$g.ctx.clipRect($Q,$d,$k.width,$k.height),$r._fun.call($r,$v,$g,$Q-$k.x,$d-$k.y),$g.ctx.restore()}},$v._blend=function($v,$g,$Q,$d){var $r=$v._style;$r.blendMode&&($g.ctx.globalCompositeOperation=$r.blendMode);var $k=this._next;$k._fun.call($k,$v,$g,$Q,$d),$g.ctx.globalCompositeOperation="source-over"},$v._mask=function($v,$g,$Q,$d){var $r=this._next;$r._fun.call($r,$v,$g,$Q,$d);var $k=$v.mask;$k&&($g.ctx.globalCompositeOperation="destination-in",(0<$k.numChildren||!$k.graphics._isOnlyOne())&&($k.cacheAsBitmap=!0),$k.render($g,$Q-$v.pivotX,$d-$v.pivotY)),$g.ctx.globalCompositeOperation="source-over"},$v._graphics=function($v,$g,$Q,$d){var $r=$v._style._tf;$v._graphics&&$v._graphics._render($v,$g,$Q-$r.translateX,$d-$r.translateY);var $k=this._next;$k._fun.call($k,$v,$g,$Q,$d)},$v._image=function($v,$g,$Q,$d){var $r=$v._style;$g.ctx.drawTexture2($Q,$d,$r._tf.translateX,$r._tf.translateY,$v.transform,$r.alpha,$r.blendMode,$v._graphics._one)},$v._image2=function($v,$g,$Q,$d){var $r=$v._style._tf;$g.ctx.drawTexture2($Q,$d,$r.translateX,$r.translateY,$v.transform,1,null,$v._graphics._one)},$v._alpha=function($v,$g,$Q,$d){var $r;if(.01<($r=$v._style.alpha)||$v._needRepaint()){var $k=$g.ctx.globalAlpha;$g.ctx.globalAlpha*=$r;var $$=this._next;$$._fun.call($$,$v,$g,$Q,$d),$g.ctx.globalAlpha=$k}},$v._transform=function($v,$g,$Q,$d){var $r=$v.transform,$k=this._next;$r&&$k!=$$.NORENDER?($g.save(),$g.transform($r.a,$r.b,$r.c,$r.d,$r.tx+$Q,$r.ty+$d),$k._fun.call($k,$v,$g,0,0),$g.restore()):$k._fun.call($k,$v,$g,$Q,$d)},$v._childs=function($v,$g,$Q,$d){var $r=$v._style,$k=$r._tf;if($Q=$Q-$k.translateX+$r.paddingLeft,$d=$d-$k.translateY+$r.paddingTop,$r._calculation){var $$=$v._getWords();if($$){var $b=$r;$b&&($b.stroke?$g.fillBorderWords($$,$Q,$d,$b.font,$b.color,$b.strokeColor,$b.stroke):$g.fillWords($$,$Q,$d,$b.font,$b.color,"none"!=$b.textDecoration&&$b.underLine?1:0))}}var $a,$M=$v._childs,$Y=$M.length;if($v.viewport||$v.optimizeScrollRect&&$v._style.scrollRect){var $D=$v.viewport||$v._style.scrollRect,$J=$D.x,$p=$D.y,$T=$D.right,$t=$D.bottom,$q=NaN,$C=NaN;for($G=0;$G<$Y;++$G)($a=$M[$G]).visible&&($q=$a._x)<$T&&$q+$a.width>$J&&($C=$a._y)<$t&&$C+$a.height>$p&&$a.render($g,$Q,$d)}else for(var $G=0;$G<$Y;++$G)($a=$M[$G])._style.visible&&$a.render($g,$Q,$d)},$v._canvas=function($v,$g,$Q,$d){var $r=$v._$P.cacheCanvas;if($r){"bitmap"===$r.type?$z.canvasBitmap++:$z.canvasNormal++;var $k=$r.ctx;if($v._needRepaint()||!$k)this._canvas_repaint($v,$g,$Q,$d);else{var $$=$r._cacheRec;$g.drawCanvas($k.canvas,$Q+$$.x,$d+$$.y,$$.width,$$.height)}}else this._next._fun.call(this._next,$v,$g,$Q,$d)},$v._canvas_repaint=function($v,$g,$Q,$d){var $r=$v._$P.cacheCanvas,$k=this._next;if($r){var $$,$b,$a,$M,$Y=$r.ctx,$D=$v._needRepaint()||!$Y,$J=$r.type;if("bitmap"===$J?$z.canvasBitmap++:$z.canvasNormal++,$D){var $p,$T;$r._cacheRec||($r._cacheRec=new $l),$i.isWebGL&&"bitmap"!==$J?$r._cacheRec.setTo(-$v.pivotX,-$v.pivotY,1,1):(($M=$v.getSelfBounds()).x=$M.x-$v.pivotX,$M.y=$M.y-$v.pivotY,$M.x=$M.x-16,$M.y=$M.y-16,$M.width=$M.width+32,$M.height=$M.height+32,$M.x=Math.floor($M.x+$Q)-$Q,$M.y=Math.floor($M.y+$d)-$d,$M.width=Math.floor($M.width),$M.height=Math.floor($M.height),$r._cacheRec.copyFrom($M)),$M=$r._cacheRec;var $t,$q=$i.isWebGL?1:$c.pixelRatio*$W.stage.clientScaleX,$C=$i.isWebGL?1:$c.pixelRatio*$W.stage.clientScaleY;if(!$i.isWebGL){var $G,$s=1,$A=1;for($G=$v;$G&&$G!=$W.stage;)$s*=$G.scaleX,$A*=$G.scaleY,$G=$G.parent;$i.isWebGL?($s<1&&($q*=$s),$A<1&&($C*=$A)):(1<$s&&($q*=$s),1<$A&&($C*=$A))}if($v.scrollRect){var $h=$v.scrollRect;$M.x-=$h.x,$M.y-=$h.y}if($p=$M.width*$q,$T=$M.height*$C,$b=$M.x,$a=$M.y,$i.isWebGL&&"bitmap"===$J&&(2048<$p||2048<$T))return console.warn("cache bitmap size larger than 2048,cache ignored"),$r.ctx&&($R.recover("RenderContext",$r.ctx),$r.ctx.canvas.size(0,0),$r.ctx=null),void $k._fun.call($k,$v,$g,$Q,$d);if($Y||($Y=$r.ctx=$R.getItem("RenderContext")||new $x($p,$T,$sv.create("AUTO"))),$Y.ctx.sprite=$v,($$=$Y.canvas).clear(),($$.width!=$p||$$.height!=$T)&&$$.size($p,$T),"bitmap"===$J?$$.context.asBitmap=!0:"normal"===$J&&($$.context.asBitmap=!1),1!=$q||1!=$C){var $P=$Y.ctx;$P.save(),$P.scale($q,$C),!$i.isConchWebGL&&$i.isConchApp&&($t=$v._$P.cf)&&$P.setFilterMatrix&&$P.setFilterMatrix($t._mat,$t._alpha),$k._fun.call($k,$v,$Y,-$b,-$a),$P.restore(),$i.isConchApp&&!$i.isConchWebGL||$v._applyFilters()}else $P=$Y.ctx,!$i.isConchWebGL&&$i.isConchApp&&($t=$v._$P.cf)&&$P.setFilterMatrix&&$P.setFilterMatrix($t._mat,$t._alpha),$k._fun.call($k,$v,$Y,-$b,-$a),$i.isConchApp&&!$i.isConchWebGL||$v._applyFilters();$v._$P.staticCache&&($r.reCache=!1),$z.canvasReCache++}else $b=($M=$r._cacheRec).x,$a=$M.y,$$=$Y.canvas;$g.drawCanvas($$,$Q+$b,$d+$a,$M.width,$M.height)}else $k._fun.call($k,$v,$Y,$Q,$d)},$$.__init__=function(){var $v,$g,$Q=0;for($g=$Z.createRenderSprite(69905,null),$v=$$.renders.length=4096,$Q=0;$Q<$v;$Q++)$$.renders[$Q]=$g;$$.renders[0]=$Z.createRenderSprite(0,null),function($v,$g){for(var $Q=0,$d=0;$d<$v.length;$d++)$Q|=$v[$d],$$.renders[$Q]=$g}([1,512,4,2],new $$(1,null)),$$.renders[513]=$Z.createRenderSprite(513,null),$$.renders[517]=new $$(517,null)},$$._initRenderFun=function($v,$g,$Q,$d){var $r=$v._renderType;($$.renders[$r]=$$._getTypeRender($r))._fun($v,$g,$Q,$d)},$$._getTypeRender=function($v){for(var $g=null,$Q=2048;1<$Q;)$Q&$v&&($g=$Z.createRenderSprite($Q,$g)),$Q>>=1;return $g},$$.IMAGE=1,$$.ALPHA=2,$$.TRANSFORM=4,$$.BLEND=8,$$.CANVAS=16,$$.FILTERS=32,$$.MASK=64,$$.CLIP=128,$$.STYLE=256,$$.GRAPHICS=512,$$.CUSTOM=1024,$$.CHILDS=2048,$$.INIT=69905,$$.renders=[],$$.NORENDER=new $$(0,null),$$}(),$m=function(){function $b(){this._repaint=!1}$t($b,"laya.resource.Context");var $v=$b.prototype;return $v.replaceReset=function(){var $v,$g,$Q=0;for($v=$b.replaceKeys.length,$Q=0;$Q<$v;$Q++)$g=$b.replaceKeys[$Q],this[$b.newKeys[$Q]]=this[$g]},$v.replaceResotre=function(){this.__restore(),this.__reset()},$v.setIsMainContext=function(){},$v.drawTextures=function($v,$g,$Q,$d){$z.drawCall+=$g.length/2;for(var $r=$v.width,$k=$v.height,$$=0,$b=$g.length;$$<$b;$$+=2)this.drawTexture($v,$g[$$],$g[$$+1],$r,$k,$Q,$d)},$v.drawCanvas=function($v,$g,$Q,$d,$r){$z.drawCall++,this.drawImage($v.source,$g,$Q,$d,$r)},$v.fillRect=function($v,$g,$Q,$d,$r){$z.drawCall++,$r&&(this.fillStyle=$r),this.__fillRect($v,$g,$Q,$d)},$v.fillText=function($v,$g,$Q,$d,$r,$k){$z.drawCall++,3<arguments.length&&null!=$d&&(this.font=$d,this.fillStyle=$r,this.textAlign=$k,this.textBaseline="top"),this.__fillText($v,$g,$Q)},$v.fillBorderText=function($v,$g,$Q,$d,$r,$k,$$,$b){$z.drawCall++,this.font=$d,this.fillStyle=$r,this.textBaseline="top",this.strokeStyle=$k,this.lineWidth=$$,this.textAlign=$b,this.__strokeText($v,$g,$Q),this.__fillText($v,$g,$Q)},$v.strokeText=function($v,$g,$Q,$d,$r,$k,$$){$z.drawCall++,3<arguments.length&&null!=$d&&(this.font=$d,this.strokeStyle=$r,this.lineWidth=$k,this.textAlign=$$,this.textBaseline="top"),this.__strokeText($v,$g,$Q)},$v.transformByMatrix=function($v){this.transform($v.a,$v.b,$v.c,$v.d,$v.tx,$v.ty)},$v.setTransformByMatrix=function($v){this.setTransform($v.a,$v.b,$v.c,$v.d,$v.tx,$v.ty)},$v.clipRect=function($v,$g,$Q,$d){$z.drawCall++,this.beginPath(),this.rect($v,$g,$Q,$d),this.clip()},$v.drawTexture=function($v,$g,$Q,$d,$r,$k,$$){$z.drawCall++;var $b=$v.uv,$a=$v.bitmap.width,$M=$v.bitmap.height;this.drawImage($v.source,$b[0]*$a,$b[1]*$M,($b[2]-$b[0])*$a,($b[5]-$b[3])*$M,$g+$k,$Q+$$,$d,$r)},$v.drawTextureWithTransform=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){$z.drawCall++;var $M=$v.uv,$Y=$v.bitmap.width,$D=$v.bitmap.height;this.save(),1!=$a&&(this.globalAlpha*=$a),$k?(this.transform($k.a,$k.b,$k.c,$k.d,$k.tx+$$,$k.ty+$b),this.drawImage($v.source,$M[0]*$Y,$M[1]*$D,($M[2]-$M[0])*$Y,($M[5]-$M[3])*$D,$g,$Q,$d,$r)):this.drawImage($v.source,$M[0]*$Y,$M[1]*$D,($M[2]-$M[0])*$Y,($M[5]-$M[3])*$D,$g+$$,$Q+$b,$d,$r),this.restore()},$v.drawTexture2=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=$b[0];if($a.loaded&&$a.bitmap&&$a.source){$z.drawCall++;var $M=1!==$k;if($M){var $Y=this.globalAlpha;this.globalAlpha*=$k}var $D=$a.uv,$J=$a.bitmap.width,$p=$a.bitmap.height;$r?(this.save(),this.transform($r.a,$r.b,$r.c,$r.d,$r.tx+$v,$r.ty+$g),this.drawImage($a.source,$D[0]*$J,$D[1]*$p,($D[2]-$D[0])*$J,($D[5]-$D[3])*$p,$b[1]-$Q,$b[2]-$d,$b[3],$b[4]),this.restore()):this.drawImage($a.source,$D[0]*$J,$D[1]*$p,($D[2]-$D[0])*$J,($D[5]-$D[3])*$p,$b[1]-$Q+$v,$b[2]-$d+$g,$b[3],$b[4]),$M&&(this.globalAlpha=$Y)}},$v.fillTexture=function($v,$g,$Q,$d,$r,$k,$$,$b){if(!$b.pat){if($v.uv!=$Yv.DEF_UV){var $a=new $sv("2D");$a.getContext("2d"),$a.size($v.width,$v.height),$a.context.drawTexture($v,0,0,$v.width,$v.height,0,0),$v=new $Yv($a)}$b.pat=this.createPattern($v.bitmap.source,$k)}var $M=$g,$Y=$Q,$D=0,$J=0;$$&&($M+=$$.x%$v.width,$Y+=$$.y%$v.height,$D-=$$.x%$v.width,$J-=$$.y%$v.height),this.translate($M,$Y),this.fillRect($D,$J,$d,$r,$b.pat),this.translate(-$M,-$Y)},$v.drawTriangle=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=$v.bitmap,$M=$a.source,$Y=$v.width,$D=$v.height,$J=$a.width,$p=$a.height,$T=$Q[$d]*$J,$t=$Q[$r]*$J,$q=$Q[$k]*$J,$C=$Q[$d+1]*$p,$G=$Q[$r+1]*$p,$s=$Q[$k+1]*$p,$A=$g[$d],$h=$g[$r],$P=$g[$k],$W=$g[$d+1],$F=$g[$r+1],$l=$g[$k+1];if($b){var $o=($A+$h+$P)/3,$E=($W+$F+$l)/3,$V=$A-$o,$Z=$W-$E,$f=Math.sqrt($V*$V+$Z*$Z);$A=$o+$V/$f*($f+1),$W=$E+$Z/$f*($f+1),$Z=$F-$E,$h=$o+($V=$h-$o)/($f=Math.sqrt($V*$V+$Z*$Z))*($f+1),$F=$E+$Z/$f*($f+1),$Z=$l-$E,$P=$o+($V=$P-$o)/($f=Math.sqrt($V*$V+$Z*$Z))*($f+1),$l=$E+$Z/$f*($f+1)}this.save(),$$&&this.transform($$.a,$$.b,$$.c,$$.d,$$.tx,$$.ty),this.beginPath(),this.moveTo($A,$W),this.lineTo($h,$F),this.lineTo($P,$l),this.closePath(),this.clip();var $X=1/($T*$G+$C*$q+$t*$s-$G*$q-$C*$t-$T*$s),$N=$A*$G+$C*$P+$h*$s-$G*$P-$C*$h-$A*$s,$i=$T*$h+$A*$q+$t*$P-$h*$q-$A*$t-$T*$P,$x=$T*$G*$P+$C*$h*$q+$A*$t*$s-$A*$G*$q-$C*$t*$P-$T*$h*$s,$w=$W*$G+$C*$l+$F*$s-$G*$l-$C*$F-$W*$s,$m=$T*$F+$W*$q+$t*$l-$F*$q-$W*$t-$T*$l,$K=$T*$G*$l+$C*$F*$q+$W*$t*$s-$W*$G*$q-$C*$t*$l-$T*$F*$s;this.transform($N*$X,$w*$X,$i*$X,$m*$X,$x*$X,$K*$X),this.drawImage($M,$v.uv[0]*$J,$v.uv[1]*$p,$Y,$D,$v.uv[0]*$J,$v.uv[1]*$p,$Y,$D),this.restore()},$v.flush=function(){return 0},$v.fillWords=function($v,$g,$Q,$d,$r,$k){$d&&(this.font=$d),$r&&(this.fillStyle=$r);this.textBaseline="top",this.textAlign="left";for(var $$=0,$b=$v.length;$$<$b;$$++){var $a=$v[$$];if(this.__fillText($a.char,$a.x+$g,$a.y+$Q),1===$k){var $M=$a.height,$Y=.5*$a.style.letterSpacing;$Y||($Y=0),this.beginPath(),this.strokeStyle=$r,this.lineWidth=1,this.moveTo($g+$a.x-$Y+.5,$Q+$a.y+$M+.5),this.lineTo($g+$a.x+$a.width+$Y+.5,$Q+$a.y+$M+.5),this.stroke()}}},$v.fillBorderWords=function($v,$g,$Q,$d,$r,$k,$$){$d&&(this.font=$d),$r&&(this.fillStyle=$r),this.textBaseline="top",this.lineWidth=$$,this.textAlign="left",this.strokeStyle=$k;for(var $b=0,$a=$v.length;$b<$a;$b++){var $M=$v[$b];this.__strokeText($M.char,$M.x+$g,$M.y+$Q),this.__fillText($M.char,$M.x+$g,$M.y+$Q)}},$v.destroy=function(){this.canvas.width=this.canvas.height=0},$v.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$v.drawCurves=function($v,$g,$Q){this.beginPath(),this.strokeStyle=$Q[3],this.lineWidth=$Q[4];var $d=$Q[2];$v+=$Q[0],$g+=$Q[1],this.moveTo($v+$d[0],$g+$d[1]);for(var $r=2,$k=$d.length;$r<$k;)this.quadraticCurveTo($v+$d[$r++],$g+$d[$r++],$v+$d[$r++],$g+$d[$r++]);this.stroke()},$b.__init__=function($g){var $Q=laya.resource.Context.prototype;if(!($g=$g||CanvasRenderingContext2D.prototype).inited){$g.inited=!0,$g.__fillText=$g.fillText,$g.__fillRect=$g.fillRect,$g.__strokeText=$g.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($v){$g[$v]=$Q[$v]})}},$b.replaceCanvasGetSet=function($v,$g){var $Q=Object.getOwnPropertyDescriptor($v,$g);if(!$Q||!$Q.configurable)return!1;var $d,$r={};for($d in $Q)"set"!=$d&&($r[$d]=$Q[$d]);var $k=$Q.set;return $r.set=function($v){$k.call(this,$v);var $g=this.getContext("2d");$g&&"__reset"in $g&&$g.__reset()},Object.defineProperty($v,$g,$r),!0},$b.replaceGetSet=function($v,$g){var $Q=Object.getOwnPropertyDescriptor($v,$g);if(!$Q||!$Q.configurable)return!1;var $d,$r={};for($d in $Q)"set"!=$d&&($r[$d]=$Q[$d]);var $k=$Q.set,$$="___"+$g+"__";return $b.newKeys.push($$),$r.set=function($v){$v!=this[$$]&&(this[$$]=$v,$k.call(this,$v))},Object.defineProperty($v,$g,$r),!0},$b._default=new $b,$b.newKeys=[],$a($b,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$b}(),$K=function(){function $k($v){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$k._uniqueIDCounter,this._name=$v||"Content Manager",$k._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$k._resourceManagers.push(this),this._resources=[],this._records={}}$t($k,"laya.resource.ResourceManager");var $v=$k.prototype;return $W.imps($v,{"laya.resource.IDispose":!0}),$v.getResourceByIndex=function($v){return this._resources[$v]},$v.getResourcesLength=function(){return this._resources.length},$v.addResource=function($v){return $v.resourceManager&&$v.resourceManager.removeResource($v),-1===this._resources.indexOf($v)&&(($v._resourceManager=this)._resources.push($v),this.addRecord($v.uri,$v.__className,$v.memorySize),this.addSize($v.memorySize),!0)},$v.removeResource=function($v){var $g=this._resources.indexOf($v);return-1!==$g&&(this._resources.splice($g,1),$v._resourceManager=null,this._memorySize-=$v.memorySize,this.addRecord($v.uri,$v.__className,-$v.memorySize),!0)},$v.unload=function(){for(var $v=this._resources.slice(0,this._resources.length),$g=0;$g<$v.length;$g++){$v[$g].destroy()}$v.length=0},$v.dispose=function(){if(this===$k._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$k._resourceManagers.splice($k._resourceManagers.indexOf(this),1),$k._isResourceManagersSorted=!1;for(var $v=this._resources.slice(0,this._resources.length),$g=0;$g<$v.length;$g++){var $Q=$v[$g];$Q.resourceManager.removeResource($Q),$Q.destroy()}$v.length=0},$v.addSize=function($v){$v&&(this.autoRelease&&0<$v&&this._memorySize+$v>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$v)},$v.addRecord=function($v,$g,$Q){DEBUG&&$Q&&!$v&&console.error($v,$g,$Q)},$v.garbageCollection=function($v){var $g=this._resources;($g=$g.slice()).sort(function($v,$g){if(!$v||!$g)throw new Error("a或b不能为空！");return $v.released&&$g.released?0:$v.released?1:$g.released?-1:$v._lastUseFrameCount-$g._lastUseFrameCount});for(var $Q=$z.loopCount,$d=0,$r=$g.length;$d<$r;$d++){var $k=$g[$d];if(!(1<$Q-$k._lastUseFrameCount))return void(this._memorySize>=$v&&(this._isOverflow=!0));if($k.releaseResource(),this._memorySize<$v)return void(this._isOverflow=!1)}},$Y(0,$v,"id",function(){return this._id}),$Y(0,$v,"name",function(){return this._name},function($v){!$v&&""===$v||this._name===$v||(this._name=$v,$k._isResourceManagersSorted=!1)}),$Y(0,$v,"memorySize",function(){return this._memorySize}),$Y(0,$v,"records",function(){return this._records}),$Y(1,$k,"systemResourceManager",function(){return $k._systemResourceManager}),$k.__init__=function(){$k.currentResourceManager=$k.systemResourceManager},$k.getLoadedResourceManagerByIndex=function($v){return $k._resourceManagers[$v]},$k.getLoadedResourceManagersCount=function(){return $k._resourceManagers.length},$k.recreateContentManagers=function($v){void 0===$v&&($v=!1);for(var $g=$k.currentResourceManager,$Q=0;$Q<$k._resourceManagers.length;$Q++){$k.currentResourceManager=$k._resourceManagers[$Q];for(var $d=0;$d<$k.currentResourceManager._resources.length;$d++)$k.currentResourceManager._resources[$d].releaseResource($v),$k.currentResourceManager._resources[$d].activeResource($v)}$k.currentResourceManager=$g},$k.releaseContentManagers=function($v){void 0===$v&&($v=!1);for(var $g=$k.currentResourceManager,$Q=0;$Q<$k._resourceManagers.length;$Q++){$k.currentResourceManager=$k._resourceManagers[$Q];for(var $d=0;$d<$k.currentResourceManager._resources.length;$d++){var $r=$k.currentResourceManager._resources[$d];!$r.released&&$r.releaseResource($v)}}$k.currentResourceManager=$g},$k._uniqueIDCounter=0,$k._isResourceManagersSorted=!1,$k._resourceManagers=[],$a($k,["_systemResourceManager",function(){return this._systemResourceManager=new $k("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$k._systemResourceManager}]),$k}(),$c=(function(){function $v(){}$t($v,"laya.system.System"),$v.changeDefinition=function($v,$g){$W[$v]=$g;var $Q=$v+"=classObj";$W._runScript($Q)},$v.__init__=function(){$i.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $Q(){}return $t($Q,"laya.utils.Browser"),$Y(1,$Q,"pixelRatio",function(){return $Q.__init__(),-1<$Q.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$Z.getPixelRatio()}),$Y(1,$Q,"height",function(){return $Q.__init__(),($W.stage&&$W.stage.canvasRotation?$Q.clientWidth:$Q.clientHeight)*$Q.pixelRatio}),$Y(1,$Q,"clientWidth",function(){return $Q.__init__(),$Q.window.innerWidth||$Q.document.body.clientWidth}),$Y(1,$Q,"window",function(){return $Q.__init__(),$Q._window}),$Y(1,$Q,"clientHeight",function(){return $Q.__init__(),$Q.window.innerHeight||$Q.document.body.clientHeight||$Q.document.documentElement.clientHeight}),$Y(1,$Q,"width",function(){return $Q.__init__(),($W.stage&&$W.stage.canvasRotation?$Q.clientHeight:$Q.clientWidth)*$Q.pixelRatio}),$Y(1,$Q,"container",function(){return $Q.__init__(),$Q._container||(($Q._container=$Q.createElement("div")).id="layaContainer",$Q.document.body.appendChild($Q._container)),$Q._container},function($v){$Q._container=$v}),$Y(1,$Q,"document",function(){return $Q.__init__(),$Q._document}),$Q.__init__=function(){if(!$Q._window){$Q._window=$Z.getWindow(),$Q._document=$Q.window.document,$Q._window.addEventListener("message",function($v){laya.utils.Browser._onMessage($v)},!1),$Q.document.__createElement=$Q.document.createElement,$$.requestAnimationFrame=$$.requestAnimationFrame||$$.webkitRequestAnimationFrame||$$.mozRequestAnimationFrame||$$.oRequestAnimationFrame||$$.msRequestAnimationFrame||function($v){return $$.setTimeout($v,1e3/60)};var $v=$$.document.body.style;$v["-webkit-user-select"]="none",$v["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$Q.userAgent=$Q.window.navigator.userAgent,$Q.onIOS=!!($Q.u=$Q.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$Q.onMobile=-1<$Q.u.indexOf("Mobile"),$Q.onIPhone=-1<$Q.u.indexOf("iPhone"),$Q.onMac=-1<$Q.u.indexOf("Mac OS X"),$Q.onIPad=-1<$Q.u.indexOf("iPad"),$Q.onAndroid=-1<$Q.u.indexOf("Android")||-1<$Q.u.indexOf("Adr"),$Q.onWP=-1<$Q.u.indexOf("Windows Phone"),$Q.onQQBrowser=-1<$Q.u.indexOf("QQBrowser"),$Q.onMQQBrowser=-1<$Q.u.indexOf("MQQBrowser")||-1<$Q.u.indexOf("Mobile")&&-1<$Q.u.indexOf("QQ"),$Q.onIE=!!$Q.window.ActiveXObject||"ActiveXObject"in $Q.window,$Q.onWeiXin=-1<$Q.u.indexOf("MicroMessenger"),$Q.onPC=!$Q.onMobile,$Q.onSafari=-1<$Q.u.indexOf("Safari"),$Q.onFirefox=-1<$Q.u.indexOf("Firefox"),$Q.onEdge=-1<$Q.u.indexOf("Edge"),$Q.onMiniGame=-1<$Q.u.indexOf("MiniGame"),$Q.onLimixiu=-1<$Q.u.indexOf("limixiu"),$Q.httpProtocol="http:"==$Q.window.location.protocol,$Q.onMiniGame&&null==$Q.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$Q.webAudioEnabled=!!($Q.window.AudioContext||$Q.window.webkitAudioContext||$Q.window.mozAudioContext),$Q.soundType=$Q.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$rv=$Q.webAudioEnabled?$kv:$Qv,$Q.webAudioEnabled&&$kv.initWebAudio(),$Qv._initMusicAudio(),$Q.enableTouch="ontouchstart"in $$||$$.DocumentTouch&&$g instanceof DocumentTouch,$$.focus(),$V._soundClass=$rv,$V._musicClass=$Qv,$i._mainCanvas=$i._mainCanvas||$sv.create("2D"),$Q.canvas||($Q.canvas=$sv.create("2D"),$Q.context=$Q.canvas.getContext("2d"))}},$Q._onMessage=function($v){if($v.data&&"size"==$v.data.name){if($Q.window.innerWidth=$v.data.width,$Q.window.innerHeight=$v.data.height,$Q.window.__innerHeight=$v.data.clientHeight,!$Q.document.createEvent)return void console.warn("no document.createEvent");var $g=$Q.document.createEvent("HTMLEvents");return $g.initEvent("resize",!1,!1),void $Q.window.dispatchEvent($g)}},$Q.createElement=function($v){return $Q.__init__(),$Q.document.__createElement($v)},$Q.getElementById=function($v){return $Q.__init__(),$Q.document.getElementById($v)},$Q.removeElement=function($v){$v&&$v.parentNode&&$v.parentNode.removeChild($v)},$Q.now=function(){return $Z.now()},$Q._window=null,$Q._document=null,$Q._container=null,$Q.userAgent=null,$Q.u=null,$Q.onIOS=!1,$Q.onMac=!1,$Q.onMobile=!1,$Q.onIPhone=!1,$Q.onIPad=!1,$Q.onAndroid=!1,$Q.onWP=!1,$Q.onQQBrowser=!1,$Q.onMQQBrowser=!1,$Q.onSafari=!1,$Q.onFirefox=!1,$Q.onEdge=!1,$Q.onIE=!1,$Q.onWeiXin=!1,$Q.onMiniGame=!1,$Q.onLimixiu=!1,$Q.onPC=!1,$Q.httpProtocol=!1,$Q.webAudioEnabled=!1,$Q.soundType=null,$Q.enableTouch=!1,$Q.canvas=null,$Q.context=null,$Q.__init$=function(){},$Q}()),$B=function(){function $g($v){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$v?(this._u8d_=new Uint8Array($v),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$t($g,"laya.utils.Byte");var $v=$g.prototype;return $v.___resizeBuffer=function($g){try{var $v=new Uint8Array($g);null!=this._u8d_&&(this._u8d_.length<=$g?$v.set(this._u8d_):$v.set(this._u8d_.subarray(0,$g))),this._u8d_=$v,this._d_=new DataView($v.buffer)}catch($v){throw"___resizeBuffer err:"+$g}},$v.getString=function(){return this.rUTF(this.getUint16())},$v.getFloat32Array=function($v,$g){var $Q=$v+$g;$Q=$Q>this._length?this._length:$Q;var $d=new Float32Array(this._d_.buffer.slice($v,$Q));return this._pos_=$Q,$d},$v.getUint8Array=function($v,$g){var $Q=$v+$g;$Q=$Q>this._length?this._length:$Q;var $d=new Uint8Array(this._d_.buffer.slice($v,$Q));return this._pos_=$Q,$d},$v.getInt16Array=function($v,$g){var $Q=$v+$g;$Q=$Q>this._length?this._length:$Q;var $d=new Int16Array(this._d_.buffer.slice($v,$Q));return this._pos_=$Q,$d},$v.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $v=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$v},$v.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $v=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$v},$v.writeFloat32=function($v){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$v,this._xd_),this._pos_+=4},$v.writeFloat64=function($v){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$v,this._xd_),this._pos_+=8},$v.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $v=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$v},$v.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $v=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$v},$v.writeInt32=function($v){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$v,this._xd_),this._pos_+=4},$v.writeUint32=function($v){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$v,this._xd_),this._pos_+=4},$v.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $v=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$v},$v.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $v=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$v},$v.writeUint16=function($v){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$v,this._xd_),this._pos_+=2},$v.writeInt16=function($v){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$v,this._xd_),this._pos_+=2},$v.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$v.writeUint8=function($v){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$v),this._pos_++},$v._getUInt8=function($v){return this._d_.getUint8($v)},$v._getUint16=function($v){return this._d_.getUint16($v,this._xd_)},$v._getMatrix=function(){return new $f(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$v.rUTF=function($v){for(var $g=[],$Q=this._pos_+$v,$d=0,$r=0,$k=0,$$=String.fromCharCode,$b=this._u8d_;this._pos_<$Q;)($d=$b[this._pos_++])<128?0!=$d&&$g.push($$($d)):$d<224?$g.push($$((63&$d)<<6|127&$b[this._pos_++])):$d<240?($r=$b[this._pos_++],$g.push($$((31&$d)<<12|(127&$r)<<6|127&$b[this._pos_++]))):($r=$b[this._pos_++],$k=$b[this._pos_++],$g.push($$((15&$d)<<18|(127&$r)<<12|$k<<6&127|127&$b[this._pos_++]))),0;return $g.join("")},$v.getCustomString=function($v){for(var $g=[],$Q=0,$d=0,$r=0,$k=String.fromCharCode,$$=this._u8d_;0<$v;)if(($d=$$[this._pos_])<128)$g.push($k($d)),this._pos_++,$v--;else for($Q=$d-128,this._pos_++,$v-=$Q;0<$Q;)$d=$$[this._pos_++],$r=$$[this._pos_++],$g.push($k($r<<8|$d)),$Q--;return $g.join("")},$v.clear=function(){this._pos_=0,this.length=0},$v.__getBuffer=function(){return this._d_.buffer},$v.writeUTFBytes=function($v){for(var $g=0,$Q=($v+="").length;$g<$Q;$g++){var $d=$v.charCodeAt($g);$d<=127?this.writeByte($d):$d<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$d>>6,128|63&$d],this._pos_),this._pos_+=2):$d<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$d>>12,128|$d>>6&63,128|63&$d],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$d>>18,128|$d>>12&63,128|$d>>6&63,128|63&$d],this._pos_),this._pos_+=4)}},$v.writeUTFString=function($v){var $g=this.pos;this.writeUint16(1),this.writeUTFBytes($v);var $Q=this.pos-$g-2;if(65536<=$Q)throw"writeUTFString byte len more than 65536";this._d_.setUint16($g,$Q,this._xd_)},$v.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$v.getUTFString=function(){return this.readUTFString()},$v.readUTFBytes=function($v){if(void 0===$v&&($v=-1),0==$v)return"";var $g=this.bytesAvailable;if($g<$v)throw"readUTFBytes error - Out of bounds";return $v=0<$v?$v:$g,this.rUTF($v)},$v.getUTFBytes=function($v){return void 0===$v&&($v=-1),this.readUTFBytes($v)},$v.writeByte=function($v){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$v),this._pos_+=1},$v.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$v.getByte=function(){return this.readByte()},$v.ensureWrite=function($v){this._length<$v&&(this._length=$v),this._allocated_<$v&&(this.length=$v)},$v.writeArrayBuffer=function($v,$g,$Q){if(void 0===$g&&($g=0),void 0===$Q&&($Q=0),$g<0||$Q<0)throw"writeArrayBuffer error - Out of bounds";0==$Q&&($Q=$v.byteLength-$g),this.ensureWrite(this._pos_+$Q);var $d=new Uint8Array($v);this._u8d_.set($d.subarray($g,$g+$Q),this._pos_),this._pos_+=$Q},$Y(0,$v,"buffer",function(){var $v=this._d_.buffer;return $v.byteLength==this.length?$v:$v.slice(0,this.length)}),$Y(0,$v,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($v){this._xd_="littleEndian"==$v}),$Y(0,$v,"length",function(){return this._length},function($v){this._allocated_<$v?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($v,2*this._allocated_))):this._allocated_>$v&&this.___resizeBuffer(this._allocated_=$v),this._length=$v}),$Y(0,$v,"pos",function(){return this._pos_},function($v){this._pos_=$v}),$Y(0,$v,"bytesAvailable",function(){return this._length-this._pos_}),$g.getSystemEndian=function(){if(!$g._sysEndian){var $v=new ArrayBuffer(2);new DataView($v).setInt16(0,256,!0),$g._sysEndian=256===new Int16Array($v)[0]?"littleEndian":"bigEndian"}return $g._sysEndian},$g.BIG_ENDIAN="bigEndian",$g.LITTLE_ENDIAN="littleEndian",$g._sysEndian=null,$g}(),$j=function(){function $r(){}return $t($r,"laya.utils.CacheManager"),$r.regCacheByFunction=function($v,$g){var $Q;$r.unRegCacheByFunction($v,$g),$Q={tryDispose:$v,getCacheList:$g},$r._cacheList.push($Q)},$r.unRegCacheByFunction=function($v,$g){var $Q,$d=0;for($Q=$r._cacheList.length,$d=0;$d<$Q;$d++)if($r._cacheList[$d].tryDispose==$v&&$r._cacheList[$d].getCacheList==$g)return void $r._cacheList.splice($d,1)},$r.forceDispose=function(){var $v=0,$g=$r._cacheList.length;for($v=0;$v<$g;$v++)$r._cacheList[$v].tryDispose(!0)},$r.beginCheck=function($v){void 0===$v&&($v=15e3),$W.timer.loop($v,null,$r._checkLoop)},$r.stopCheck=function(){$W.timer.clear(null,$r._checkLoop)},$r._checkLoop=function(){var $v=$r._cacheList;if(!($v.length<1)){var $g,$Q=$c.now(),$d=0;for($g=$d=$v.length;0<$d&&($v[$r._index=++$r._index%$g].tryDispose(!1),!($c.now()-$Q>$r.loopTimeLimit));)$d--}},$r.loopTimeLimit=2,$r._cacheList=[],$r._index=0,$r}(),$L=function(){function $p(){}return $t($p,"laya.utils.ClassUtils"),$p.regClass=function($v,$g){$p._classMap[$v]=$g},$p.getRegClass=function($v){return $p._classMap[$v]},$p.getInstance=function($v){var $g=$p.getClass($v);return $g?new $g:(console.warn("[error] Undefined class:",$v),null)},$p.createByJson=function($v,$g,$Q,$d,$r){"string"==typeof $v&&($v=JSON.parse($v));var $k=$v.props;if(!$g&&!($g=$r?$r.runWith($v):$p.getInstance($k.runtime||$v.type)))return null;var $$=$v.child;if($$)for(var $b=0,$a=$$.length;$b<$a;$b++){var $M=$$[$b];if("render"!==$M.props.name&&"render"!==$M.props.renderType||!$g._$set_itemRender)if("Graphic"==$M.type)$p.addGraphicsToSprite($M,$g);else if($p.isDrawType($M.type))$p.addGraphicToSprite($M,$g,!0);else{var $Y=$p.createByJson($M,null,$Q,$d,$r);"Script"==$M.type?$Y.hasOwnProperty("owner")?$Y.owner=$g:$Y.hasOwnProperty("target")&&($Y.target=$g):"mask"==$M.props.renderType?$g.mask=$Y:$g.addChild($Y)}else $g.itemRender=$M}if($k)for(var $D in $k){var $J=$k[$D];"var"===$D&&$Q?$Q[$J]=$g:$J instanceof Array&&"function"==typeof $g[$D]?$g[$D].apply($g,$J):$g[$D]=$J}return $d&&$v.customProps&&$d.runWith([$g,$v]),$g.created&&$g.created(),$g},$p.addGraphicsToSprite=function($v,$g){var $Q;if(($Q=$v.child)&&!($Q.length<1)){var $d;$d=$p._getGraphicsFromSprite($v,$g);var $r=0,$k=0;$v.props&&($r=$p._getObjVar($v.props,"x",0),$k=$p._getObjVar($v.props,"y",0)),0!=$r&&0!=$k&&$d.translate($r,$k);var $$,$b=0;for($$=$Q.length,$b=0;$b<$$;$b++)$p._addGraphicToGraphics($Q[$b],$d);0!=$r&&0!=$k&&$d.translate(-$r,-$k)}},$p.addGraphicToSprite=function($v,$g,$Q){var $d;void 0===$Q&&($Q=!1),$d=$Q?$p._getGraphicsFromSprite($v,$g):$g.graphics,$p._addGraphicToGraphics($v,$d)},$p._getGraphicsFromSprite=function($v,$g){var $Q,$d;if(!$v||!$v.props)return $g.graphics;switch($d=$v.props.renderType){case"hit":case"unHit":var $r;$g.hitArea||($g.hitArea=new $e),($r=$g.hitArea)[$d]||($r[$d]=new $J),$Q=$r[$d]}return $Q||($Q=$g.graphics),$Q},$p._getTransformData=function($v){var $g;($v.hasOwnProperty("pivotX")||$v.hasOwnProperty("pivotY"))&&($g=$g||new $f).translate(-$p._getObjVar($v,"pivotX",0),-$p._getObjVar($v,"pivotY",0));var $Q=$p._getObjVar($v,"scaleX",1),$d=$p._getObjVar($v,"scaleY",1),$r=$p._getObjVar($v,"rotation",0);$p._getObjVar($v,"skewX",0),$p._getObjVar($v,"skewY",0);return 1==$Q&&1==$d&&0==$r||(($g=$g||new $f).scale($Q,$d),$g.rotate(.0174532922222222*$r)),$g},$p._addGraphicToGraphics=function($v,$g){var $Q,$d;if(($Q=$v.props)&&($d=$p.DrawTypeDic[$v.type])){var $r,$k;$r=$g;var $$=$p._getParams($Q,$d[1],$d[2],$d[3]);(($k=$p._tM)||1!=$p._alpha)&&($r.save(),$k&&$r.transform($k),1!=$p._alpha&&$r.alpha($p._alpha)),$r[$d[0]].apply($r,$$),($k||1!=$p._alpha)&&$r.restore()}},$p._adptLineData=function($v){return $v[2]=parseFloat($v[0])+parseFloat($v[2]),$v[3]=parseFloat($v[1])+parseFloat($v[3]),$v},$p._adptTextureData=function($v){return $v[0]=$bv.getRes($v[0]),$v},$p._adptLinesData=function($v){return $v[2]=$p._getPointListByStr($v[2]),$v},$p.isDrawType=function($v){return"Image"!=$v&&$p.DrawTypeDic.hasOwnProperty($v)},$p._getParams=function($v,$g,$Q,$d){var $r;void 0===$Q&&($Q=0),($r=$p._temParam).length=$g.length;var $k,$$,$b=0;for($k=$g.length,$b=0;$b<$k;$b++)$r[$b]=$p._getObjVar($v,$g[$b][0],$g[$b][1]);return $p._alpha=$p._getObjVar($v,"alpha",1),$$=$p._getTransformData($v),$p._tM=$$?($Q||($Q=0),$$.translate($r[$Q],$r[$Q+1]),$r[$Q]=$r[$Q+1]=0,$$):null,$d&&$p[$d]&&($r=$p[$d]($r)),$r},$p._getPointListByStr=function($v){var $g,$Q,$d=0;for($Q=($g=$v.split(",")).length,$d=0;$d<$Q;$d++)$g[$d]=parseFloat($g[$d]);return $g},$p._getObjVar=function($v,$g,$Q){return $v.hasOwnProperty($g)?$v[$g]:$Q},$p._temParam=[],$p._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$p.getClass=function($v){var $g=$p._classMap[$v]||$v;return"string"==typeof $g?$W.__classmap[$g]:$g},$p._tM=null,$p._alpha=NaN,$a($p,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$p}(),$H=function(){function $k($v){if(this._color=[],"string"==typeof $v){null===(this.strColor=$v)&&($v="#000000"),"#"==$v.charAt(0)&&($v=$v.substr(1));var $g=$v.length;if(3==$g||4==$g){for(var $Q="",$d=0;$d<$g;$d++)$Q+=$v[$d]+$v[$d];$v=$Q}var $r=this.numColor=parseInt($v,16);if(8==$v.length)return void(this._color=[parseInt($v.substr(0,2),16)/255,((16711680&$r)>>16)/255,((65280&$r)>>8)/255,(255&$r)/255])}else $r=this.numColor=$v,this.strColor=$S.toHexColor($r);this._color=[((16711680&$r)>>16)/255,((65280&$r)>>8)/255,(255&$r)/255,1],this._color.__id=++$k._COLODID}return $t($k,"laya.utils.Color"),$k._initDefault=function(){for(var $v in $k._DEFAULT={},$k._COLOR_MAP)$k._SAVE[$v]=$k._DEFAULT[$v]=new $k($k._COLOR_MAP[$v]);return $k._DEFAULT},$k._initSaveMap=function(){for(var $v in $k._SAVE_SIZE=0,$k._SAVE={},$k._DEFAULT)$k._SAVE[$v]=$k._DEFAULT[$v]},$k.create=function($v){var $g=$k._SAVE[$v+""];return null!=$g?$g:($k._SAVE_SIZE<1e3||$k._initSaveMap(),$k._SAVE[$v+""]=new $k($v))},$k._SAVE={},$k._SAVE_SIZE=0,$k._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$k._DEFAULT=$k._initDefault(),$k._COLODID=1,$k}(),$n=(function(){function $v(){this._values=[],this._keys=[]}$t($v,"laya.utils.Dictionary");var $g=$v.prototype;$g.set=function($v,$g){var $Q=this.indexOf($v);0<=$Q?this._values[$Q]=$g:(this._keys.push($v),this._values.push($g))},$g.indexOf=function($v){var $g=this._keys.indexOf($v);return 0<=$g?$g:($v="string"==typeof $v?Number($v):"number"==typeof $v?$v.toString():$v,this._keys.indexOf($v))},$g.get=function($v){var $g=this.indexOf($v);return $g<0?null:this._values[$g]},$g.remove=function($v){var $g=this.indexOf($v);return 0<=$g&&(this._keys.splice($g,1),this._values.splice($g,1),!0)},$g.clear=function(){this._values.length=0,this._keys.length=0},$Y(0,$g,"values",function(){return this._values}),$Y(0,$g,"keys",function(){return this._keys})}(),function(){function $v(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$t($v,"laya.utils.Dragging");var $g=$v.prototype;return $g.start=function($v,$g,$Q,$d,$r,$k,$$,$b){void 0===$b&&($b=.92),this.clearTimer(),this.target=$v,this.area=$g,this.hasInertia=$Q,this.elasticDistance=$g?$d:0,this.elasticBackTime=$r,this.data=$k,this._disableMouseEvent=$$,this.ratio=$b,1!=$v.globalScaleX||1!=$v.globalScaleY?this._parent=$v.parent:this._parent=$W.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$W.stage.on("mouseup",this,this.onStageMouseUp),$W.stage.on("mouseout",this,this.onStageMouseUp),$W.timer.frameLoop(1,this,this.loop)},$g.clearTimer=function(){$W.timer.clear(this,this.loop),$W.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$g.stop=function(){this._dragging&&($T.instance.disableMouseEvent=!1,$W.stage.off("mouseup",this,this.onStageMouseUp),$W.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$g.loop=function(){var $v=this._parent.getMousePoint(),$g=$v.x,$Q=$v.y,$d=$g-this._lastX,$r=$Q-this._lastY;if(this._clickOnly){if(!(1<Math.abs($d*$W.stage._canvasTransform.getScaleX())||1<Math.abs($r*$W.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$T.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($d,$r);0==$d&&0==$r||(this._lastX=$g,this._lastY=$Q,this.target.x+=$d*this._elasticRateX,this.target.y+=$r*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$g.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $v=this.area.x-this.target.x;else $v=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$v/this.elasticDistance),this.target.y<this.area.y)var $g=this.area.y-this.target.y;else $g=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$g/this.elasticDistance)}},$g.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$g.onStageMouseUp=function($v){if($T.instance.disableMouseEvent=!1,$W.stage.off("mouseup",this,this.onStageMouseUp),$W.stage.off("mouseout",this,this.onStageMouseUp),$W.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $g=this._offsets.length,$Q=Math.min($g,6),$d=this._offsets.length-$Q,$r=$g-1;$d<$r;$r--)this._offsetY+=this._offsets[$r--],this._offsetX+=this._offsets[$r];this._offsetX=this._offsetX/$Q*2,this._offsetY=this._offsetY/$Q*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$W.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$g.checkElastic=function(){var $v=NaN,$g=NaN;if(this.target.x<this.area.x?$v=this.area.x:this.target.x>this.area.x+this.area.width&&($v=this.area.x+this.area.width),this.target.y<this.area.y?$g=this.area.y:this.target.y>this.area.y+this.area.height&&($g=this.area.y+this.area.height),isNaN($v)&&isNaN($g))this.clear();else{var $Q={};isNaN($v)||($Q.x=$v),isNaN($g)||($Q.y=$g),this._tween=$I.to(this.target,$Q,this.elasticBackTime,$y.sineOut,$G.create(this,this.clear),0,!1,!1)}},$g.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($W.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$g.clear=function(){if(this.target){this.clearTimer();var $v=this.target;this.target=null,this._parent=null,$v.event("dragend",this.data)}},$v}()),$y=function(){function $b(){}return $t($b,"laya.utils.Ease"),$b.linearNone=function($v,$g,$Q,$d){return $Q*$v/$d+$g},$b.linearIn=function($v,$g,$Q,$d){return $Q*$v/$d+$g},$b.linearInOut=function($v,$g,$Q,$d){return $Q*$v/$d+$g},$b.linearOut=function($v,$g,$Q,$d){return $Q*$v/$d+$g},$b.bounceIn=function($v,$g,$Q,$d){return $Q-$b.bounceOut($d-$v,0,$Q,$d)+$g},$b.bounceInOut=function($v,$g,$Q,$d){return $v<.5*$d?.5*$b.bounceIn(2*$v,0,$Q,$d)+$g:.5*$b.bounceOut(2*$v-$d,0,$Q,$d)+.5*$Q+$g},$b.bounceOut=function($v,$g,$Q,$d){return($v/=$d)<1/2.75?$Q*(7.5625*$v*$v)+$g:$v<2/2.75?$Q*(7.5625*($v-=1.5/2.75)*$v+.75)+$g:$v<2.5/2.75?$Q*(7.5625*($v-=2.25/2.75)*$v+.9375)+$g:$Q*(7.5625*($v-=2.625/2.75)*$v+.984375)+$g},$b.backIn=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=1.70158),$Q*($v/=$d)*$v*(($r+1)*$v-$r)+$g},$b.backInOut=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=1.70158),($v/=.5*$d)<1?.5*$Q*($v*$v*((1+($r*=1.525))*$v-$r))+$g:$Q/2*(($v-=2)*$v*((1+($r*=1.525))*$v+$r)+2)+$g},$b.backOut=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=1.70158),$Q*(($v=$v/$d-1)*$v*(($r+1)*$v+$r)+1)+$g},$b.elasticIn=function($v,$g,$Q,$d,$r,$k){var $$;return void 0===$r&&($r=0),void 0===$k&&($k=0),0==$v?$g:1==($v/=$d)?$g+$Q:($k||($k=.3*$d),$$=!$r||0<$Q&&$r<$Q||$Q<0&&$r<-$Q?($r=$Q,$k/4):$k/$b.PI2*Math.asin($Q/$r),-$r*Math.pow(2,10*($v-=1))*Math.sin(($v*$d-$$)*$b.PI2/$k)+$g)},$b.elasticInOut=function($v,$g,$Q,$d,$r,$k){var $$;return void 0===$r&&($r=0),void 0===$k&&($k=0),0==$v?$g:2==($v/=.5*$d)?$g+$Q:($k||($k=$d*(.3*1.5)),$$=!$r||0<$Q&&$r<$Q||$Q<0&&$r<-$Q?($r=$Q,$k/4):$k/$b.PI2*Math.asin($Q/$r),$v<1?$r*Math.pow(2,10*($v-=1))*Math.sin(($v*$d-$$)*$b.PI2/$k)*-.5+$g:$r*Math.pow(2,-10*($v-=1))*Math.sin(($v*$d-$$)*$b.PI2/$k)*.5+$Q+$g)},$b.elasticOut=function($v,$g,$Q,$d,$r,$k){var $$;return void 0===$r&&($r=0),void 0===$k&&($k=0),0==$v?$g:1==($v/=$d)?$g+$Q:($k||($k=.3*$d),$$=!$r||0<$Q&&$r<$Q||$Q<0&&$r<-$Q?($r=$Q,$k/4):$k/$b.PI2*Math.asin($Q/$r),$r*Math.pow(2,-10*$v)*Math.sin(($v*$d-$$)*$b.PI2/$k)+$Q+$g)},$b.strongIn=function($v,$g,$Q,$d){return $Q*($v/=$d)*$v*$v*$v*$v+$g},$b.strongInOut=function($v,$g,$Q,$d){return($v/=.5*$d)<1?.5*$Q*$v*$v*$v*$v*$v+$g:.5*$Q*(($v-=2)*$v*$v*$v*$v+2)+$g},$b.strongOut=function($v,$g,$Q,$d){return $Q*(($v=$v/$d-1)*$v*$v*$v*$v+1)+$g},$b.sineInOut=function($v,$g,$Q,$d){return.5*-$Q*(Math.cos(Math.PI*$v/$d)-1)+$g},$b.sineIn=function($v,$g,$Q,$d){return-$Q*Math.cos($v/$d*$b.HALF_PI)+$Q+$g},$b.sineOut=function($v,$g,$Q,$d){return $Q*Math.sin($v/$d*$b.HALF_PI)+$g},$b.quintIn=function($v,$g,$Q,$d){return $Q*($v/=$d)*$v*$v*$v*$v+$g},$b.quintInOut=function($v,$g,$Q,$d){return($v/=.5*$d)<1?.5*$Q*$v*$v*$v*$v*$v+$g:.5*$Q*(($v-=2)*$v*$v*$v*$v+2)+$g},$b.quintOut=function($v,$g,$Q,$d){return $Q*(($v=$v/$d-1)*$v*$v*$v*$v+1)+$g},$b.quartIn=function($v,$g,$Q,$d){return $Q*($v/=$d)*$v*$v*$v+$g},$b.quartInOut=function($v,$g,$Q,$d){return($v/=.5*$d)<1?.5*$Q*$v*$v*$v*$v+$g:.5*-$Q*(($v-=2)*$v*$v*$v-2)+$g},$b.quartOut=function($v,$g,$Q,$d){return-$Q*(($v=$v/$d-1)*$v*$v*$v-1)+$g},$b.cubicIn=function($v,$g,$Q,$d){return $Q*($v/=$d)*$v*$v+$g},$b.cubicInOut=function($v,$g,$Q,$d){return($v/=.5*$d)<1?.5*$Q*$v*$v*$v+$g:.5*$Q*(($v-=2)*$v*$v+2)+$g},$b.cubicOut=function($v,$g,$Q,$d){return $Q*(($v=$v/$d-1)*$v*$v+1)+$g},$b.quadIn=function($v,$g,$Q,$d){return $Q*($v/=$d)*$v+$g},$b.quadInOut=function($v,$g,$Q,$d){return($v/=.5*$d)<1?.5*$Q*$v*$v+$g:.5*-$Q*(--$v*($v-2)-1)+$g},$b.quadOut=function($v,$g,$Q,$d){return-$Q*($v/=$d)*($v-2)+$g},$b.expoIn=function($v,$g,$Q,$d){return 0==$v?$g:$Q*Math.pow(2,10*($v/$d-1))+$g-.001*$Q},$b.expoInOut=function($v,$g,$Q,$d){return 0==$v?$g:$v==$d?$g+$Q:($v/=.5*$d)<1?.5*$Q*Math.pow(2,10*($v-1))+$g:.5*$Q*(2-Math.pow(2,-10*--$v))+$g},$b.expoOut=function($v,$g,$Q,$d){return $v==$d?$g+$Q:$Q*(1-Math.pow(2,-10*$v/$d))+$g},$b.circIn=function($v,$g,$Q,$d){return-$Q*(Math.sqrt(1-($v/=$d)*$v)-1)+$g},$b.circInOut=function($v,$g,$Q,$d){return($v/=.5*$d)<1?.5*-$Q*(Math.sqrt(1-$v*$v)-1)+$g:.5*$Q*(Math.sqrt(1-($v-=2)*$v)+1)+$g},$b.circOut=function($v,$g,$Q,$d){return $Q*Math.sqrt(1-($v=$v/$d-1)*$v)+$g},$b.HALF_PI=.5*Math.PI,$b.PI2=2*Math.PI,$b}(),$e=function(){function $D(){this._hit=null,this._unHit=null}$t($D,"laya.utils.HitArea");var $v=$D.prototype;return $v.isHit=function($v,$g){return!!$D.isHitGraphic($v,$g,this.hit)&&!$D.isHitGraphic($v,$g,this.unHit)},$v.contains=function($v,$g){return this.isHit($v,$g)},$Y(0,$v,"hit",function(){return this._hit||(this._hit=new $J),this._hit},function($v){this._hit=$v}),$Y(0,$v,"unHit",function(){return this._unHit||(this._unHit=new $J),this._unHit},function($v){this._unHit=$v}),$D.isHitGraphic=function($v,$g,$Q){if(!$Q)return!1;var $d;if(!($d=$Q.cmds)&&$Q._one&&(($d=$D._cmds).length=1,$d[0]=$Q._one),!$d)return!1;var $r,$k,$$=0;for($r=$d.length,$$=0;$$<$r;$$++)if($k=$d[$$]){var $b=$i._context;switch($k.callee){case $b._translate:case 6:$v-=$k[0],$g-=$k[1]}if($D.isHitCmd($v,$g,$k))return!0}return!1},$D.isHitCmd=function($v,$g,$Q){if(!$Q)return!1;var $d=$i._context,$r=!1;switch($Q.callee){case $d._drawRect:case 13:$D._rec.setTo($Q[0],$Q[1],$Q[2],$Q[3]),$r=$D._rec.contains($v,$g);break;case $d._drawCircle:case $d._fillCircle:case 14:$r=($v-=$Q[0])*$v+($g-=$Q[1])*$g<$Q[2]*$Q[2];break;case $d._drawPoly:case 18:$v-=$Q[0],$g-=$Q[1],$r=$D.ptInPolygon($v,$g,$Q[2])}return $r},$D.ptInPolygon=function($v,$g,$Q){var $d;($d=$D._ptPoint).setTo($v,$g);var $r,$k=0,$$=NaN,$b=NaN,$a=NaN,$M=NaN;$r=$Q.length;for(var $Y=0;$Y<$r;$Y+=2){if($$=$Q[$Y],$b=$Q[$Y+1],$a=$Q[($Y+2)%$r],$b!=($M=$Q[($Y+3)%$r]))if(!($d.y<Math.min($b,$M)))if(!($d.y>=Math.max($b,$M)))($d.y-$b)*($a-$$)/($M-$b)+$$>$d.x&&$k++}return $k%2==1},$D._cmds=[],$a($D,["_rec",function(){return this._rec=new $l},"_ptPoint",function(){return this._ptPoint=new $F}]),$D}(),$R=(function(){function $r($v,$g,$Q,$d){this.char=$v,this.charNum=$v.charCodeAt(0),this._x=this._y=0,this.width=$g,this.height=$Q,this.style=$d,this.isWord=!$r._isWordRegExp.test($v)}$t($r,"laya.utils.HTMLChar");var $v=$r.prototype;$W.imps($v,{"laya.display.ILayout":!0}),$v.setSprite=function($v){this._sprite=$v},$v.getSprite=function(){return this._sprite},$v._isChar=function(){return!0},$v._getCSSStyle=function(){return this.style},$Y(0,$v,"width",function(){return this._w},function($v){this._w=$v}),$Y(0,$v,"x",function(){return this._x},function($v){this._sprite&&(this._sprite.x=$v),this._x=$v}),$Y(0,$v,"y",function(){return this._y},function($v){this._sprite&&(this._sprite.y=$v),this._y=$v}),$Y(0,$v,"height",function(){return this._h},function($v){this._h=$v}),$r._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $g(){}$t($g,"laya.utils.Log"),$g.enable=function(){$g._logdiv||($g._logdiv=$c.window.document.createElement("div"),$c.window.document.body.appendChild($g._logdiv),$g._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$g.toggle=function(){var $v=$g._logdiv.style;"1px"==$v.width?$v.width=$v.height="50%":$v.width=$v.height="1px"},$g.print=function($v){$g._logdiv&&($g.maxCount<=$g._count&&$g.clear(),$g._count++,$g._logdiv.innerText+=$v+"\n",$g._logdiv.scrollTop=$g._logdiv.scrollHeight)},$g.clear=function(){$g._logdiv.innerText="",$g._count=0},$g._logdiv=null,$g._count=0,$g.maxCount=20}(),function(){function $g(){}$t($g,"laya.utils.Mouse"),$Y(1,$g,"cursor",function(){return $g._style.cursor},function($v){$g._style.cursor=$v}),$g.hide=function(){"none"!=$g.cursor&&($g._preCursor=$g.cursor,$g.cursor="none")},$g.show=function(){"none"==$g.cursor&&($g.cursor=$g._preCursor?$g._preCursor:"auto")},$g._preCursor=null,$a($g,["_style",function(){return this._style=$c.document.body.style}])}(),function(){function $k(){}return $t($k,"laya.utils.Pool"),$k.getPoolBySign=function($v){return $k._poolDic[$v]||($k._poolDic[$v]=[])},$k.clearBySign=function($v){$k._poolDic[$v]&&($k._poolDic[$v].length=0)},$k.recover=function($v,$g){$g.__InPool||($g.__InPool=!0,$k.getPoolBySign($v).push($g))},$k.getItemByClass=function($v,$g){var $Q=$k.getPoolBySign($v),$d=$Q.length?$Q.pop():new $g;return $d.__InPool=!1,$d},$k.getItemByCreateFun=function($v,$g,$Q){var $d=$k.getPoolBySign($v),$r=$d.length?$d.pop():$g.call($Q);return $r.__InPool=!1,$r},$k.getItem=function($v){var $g=$k.getPoolBySign($v),$Q=$g.length?$g.pop():null;return $Q&&($Q.__InPool=!1),$Q},$k._poolDic={},$k.InPoolSign="__InPool",$k}()),$z=function(){function $a(){}return $t($a,"laya.utils.Stat"),$Y(1,$a,"onclick",null,function($v){$a._sp&&$a._sp.on("click",$a._sp,$v),$a._canvas&&($a._canvas.source.onclick=$v,$a._canvas.source.style.pointerEvents="")}),$a.show=function($v,$g,$Q){if(void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),!$i.isConchApp||$i.isConchWebGL){if($i.isConchWebGL||$c.onMiniGame||$c.onLimixiu||($a._useCanvas=!0),$a._show=!0,$a._fpsData.length=60,$a._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$a._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$a._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$a._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$i.isWebGL)if($a._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$i.is3DMode){if($a._view[0].title="FPS(3D)",$a._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$a._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$a._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$Q){var $d=8;$a._view[$d++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$a._view[$d++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$a._view[$d++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$Q){$d=8;$a._view[$d++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$a._view[$d++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$a._view[$d++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$a._view[$d++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$a._view[$d++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$a._view[$d++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$a._view[$d++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $a._view[0].title="FPS(WebGL)",$a._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $a._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$a._useCanvas?$a.createUIPre($v,$g):$a.createUI($v,$g),$a.enable()}else $c.window.conch.showFPS&&$c.window.conch.showFPS($v,$g)},$a.createUIPre=function($v,$g){var $Q=$c.pixelRatio;$a._width=170*$Q,$a._vx=75*$Q,$a._height=$Q*(12*$a._view.length+3*$Q)+4,$a._fontSize=12*$Q;for(var $d=0;$d<$a._view.length;$d++)$a._view[$d].x=4,$a._view[$d].y=$d*$a._fontSize+2*$Q;$a._canvas||(($a._canvas=new $sv("2D")).size($a._width,$a._height),($a._ctx=$a._canvas.getContext("2d")).textBaseline="top",$a._ctx.font=$a._fontSize+"px Sans-serif",$a._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$v+"px;top:"+$g+"px;width:"+$a._width/$Q+"px;height:"+$a._height/$Q+"px;"),$a._first=!0,$a.loop(),$a._first=!1,$c.container.appendChild($a._canvas.source)},$a.createUI=function($v,$g){var $Q=$a._sp,$d=$c.pixelRatio;$Q||($Q=new $Dv,($a._leftText=new $qv).pos(5,5),$a._leftText.color="#ffffff",$Q.addChild($a._leftText),($a._txt=new $qv).pos(80*$d,5),$a._txt.color="#ffffff",$Q.addChild($a._txt),$a._sp=$Q),$Q.pos($v,$g);for(var $r="",$k=0;$k<$a._view.length;$k++){$r+=$a._view[$k].title+"\n"}$a._leftText.text=$r;var $$=170*$d,$b=$d*(12*$a._view.length+3*$d)+4;$a._txt.fontSize=$a._fontSize*$d,$a._leftText.fontSize=$a._fontSize*$d,$Q.size($$,$b),$Q.graphics.clear(),$Q.graphics.setAlpha(.5),$Q.graphics.drawRect(0,0,$$,$b,"#999999"),$Q.graphics.setAlpha(1),$a.loop()},$a.enable=function(){$W.timer.frameLoop(1,$a,$a.loop)},$a.hide=function(){$a._show=!1,$W.timer.clear($a,$a.loop),$a._canvas&&$c.removeElement($a._canvas.source)},$a.clear=function(){$a.trianglesFaces=$a.drawCall=$a.shaderCall=$a.spriteCount=$a.spriteRenderUseCacheCount=$a.treeNodeCollision=$a.treeSpriteCollision=$a.canvasNormal=$a.canvasBitmap=$a.canvasReCache=0},$a.loop=function(){$a._count++;var $v=$c.now();if(!($v-$a._timer<1e3)){var $g=$a._count;if($a.FPS=Math.round(1e3*$g/($v-$a._timer)),$a._show){$a.trianglesFaces=Math.round($a.trianglesFaces/$g),$a.spriteCount=$a._useCanvas?($a.drawCall=Math.round($a.drawCall/$g)-2,$a.shaderCall=Math.round($a.shaderCall/$g),Math.round($a.spriteCount/$g)-1):($a.drawCall=Math.round($a.drawCall/$g)-2,$a.shaderCall=Math.round($a.shaderCall/$g)-4,Math.round($a.spriteCount/$g)-4),$a.spriteRenderUseCacheCount=Math.round($a.spriteRenderUseCacheCount/$g),$a.canvasNormal=Math.round($a.canvasNormal/$g),$a.canvasBitmap=Math.round($a.canvasBitmap/$g),$a.canvasReCache=Math.ceil($a.canvasReCache/$g),$a.treeNodeCollision=Math.round($a.treeNodeCollision/$g),$a.treeSpriteCollision=Math.round($a.treeSpriteCollision/$g);var $Q=0<$a.FPS?Math.floor(1e3/$a.FPS).toString():" ";$a._fpsStr=$a.FPS+($a.renderSlow?" slow":"")+" "+$Q,$a._spriteStr=$a.spriteCount+($a.spriteRenderUseCacheCount?"/"+$a.spriteRenderUseCacheCount:""),$a._canvasStr=$a.canvasReCache+"/"+$a.canvasNormal+"/"+$a.canvasBitmap,$a.currentMemorySize=$K.systemResourceManager.memorySize,$a._useCanvas?$a.renderInfoPre():$a.renderInfo(),$a.clear()}$a._count=0,$a._timer=$v}},$a.renderInfoPre=function(){if($a._canvas){var $v=$a._ctx;$v.clearRect($a._first?0:$a._vx,0,$a._width,$a._height);for(var $g=$i.WebGL.mainContext,$Q=0;$Q<$a._view.length;$Q++){var $d=$a._view[$Q];$a._first&&($v.fillStyle="white",$v.fillText($d.title,$d.x,$d.y,null,null,null)),$v.fillStyle=$d.color;var $r=-1;if(($d=$a._view[$Q]).varying){if($g)switch($d.varying){case 1:$r=$g.getParameter($g[$d.value]);break;case 2:$r=$g.getExtension($d.value)}}else $r=$a[$d.value];"M"==$d.units&&($r=Math.floor($r/1048576*100)/100+" M"),"K"==$d.units&&($r=Math.floor($r/1024*100)/100+" K"),"string"==$d.units&&($r=$r.match(/\d+\.?\d/i)),$v.fillText($r+"",$d.x+$a._vx,$d.y,null,null,null)}}},$a.renderInfo=function(){for(var $v="",$g=$i.WebGL.mainContext,$Q=0;$Q<$a._view.length;$Q++){var $d=$a._view[$Q],$r=-1;if($d.varying){if($g)switch($d.varying){case 1:$r=$g.getParameter($g[$d.value]);break;case 2:$r=$g.getExtension($d.value)}}else $r=$a[$d.value];"M"==$d.units&&($r=Math.floor($r/1048576*100)/100+" M"),"K"==$d.units&&($r=Math.floor($r/1024*100)/100+" K"),"string"==$d.units&&($r=$r.match(/\d+\.?\d/i)),$v+=$r+"\n"}$a._txt.text=$v},$a.FPS=0,$a.loopCount=0,$a.shaderCall=0,$a.drawCall=0,$a.trianglesFaces=0,$a.spriteCount=0,$a.spriteRenderUseCacheCount=0,$a.treeNodeCollision=0,$a.treeSpriteCollision=0,$a.canvasNormal=0,$a.canvasBitmap=0,$a.canvasReCache=0,$a.renderSlow=!1,$a.currentMemorySize=0,$a._fpsStr=null,$a._canvasStr=null,$a._spriteStr=null,$a._fpsData=[],$a._timer=0,$a._count=0,$a._view=[],$a._fontSize=12,$a._txt=null,$a._leftText=null,$a._sp=null,$a._show=!1,$a._useCanvas=!1,$a._canvas=null,$a._ctx=null,$a._first=!1,$a._vx=NaN,$a._width=0,$a._height=100,$a}(),$U=(function(){function $v(){this._strsToID={},this._idToStrs=[],this._length=0}$t($v,"laya.utils.StringKey");var $g=$v.prototype;$g.add=function($v){var $g=this._strsToID[$v];return null!=$g?$g:(this._idToStrs[this._length]=$v,this._strsToID[$v]=this._length++)},$g.getID=function($v){var $g=this._strsToID[$v];return null==$g?-1:$g},$g.getName=function($v){var $g=this._idToStrs[$v];return null==$g?void 0:$g}}(),function(){var $M;function $v(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$t($v,"laya.utils.Timer");var $g=$v.prototype;return $g._init=function(){$W.timer&&$W.timer.frameLoop(1,this,this._update)},$g._now=function(){return Date.now()},$g._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $v=this.currFrame=this.currFrame+this.scale,$g=this._now();this._delta=($g-this._lastTimer)*this.scale;var $Q=this.currTimer=this.currTimer+this._delta;$W.isDebug&&6e4<Math.abs($g-this._lastTimer)&&console.error("系统时间错误！"+($g-this._lastTimer)),this._lastTimer=$g;var $d=this._handlers;for($$=this._count=0,$b=$d.length;$$<$b;$$++)if(null!==($a=$d[$$]).method){var $r=$a.userFrame?$v:$Q;if($r>=$a.exeTime)if($a.repeat)if($a.jumpFrame)for(;$r>=$a.exeTime;)$a.exeTime+=$a.delay,$a.run(!1);else $a.exeTime+=$a.delay,$a.run(!1),$r>$a.exeTime&&($a.exeTime+=Math.ceil(($r-$a.exeTime)/$a.delay)*$a.delay);else $a.run(!0)}else this._count++;(30<this._count||$v%200==0)&&this._clearHandlers();for(var $k=this._laters,$$=0,$b=$k.length-1;$$<=$b;$$++){var $a=$k[$$];this._isIgnoreRecover($a)||(null!==$a.method&&(delete this._map[$a.key],$a.run(!1)),this._recoverHandler($a)),$$===$b&&($b=$k.length-1)}$k.length=0}},$g._clearHandlers=function(){for(var $v=this._handlers,$g=0,$Q=$v.length;$g<$Q;$g++){var $d=$v[$g];null!==$d.method?this._temp.push($d):this._isIgnoreRecover($d)?this._temp.push($d):this._recoverHandler($d)}this._handlers=this._temp,this._temp=$v,this._temp.length=0},$g._recoverHandler=function($v){this._map[$v.key]==$v&&delete this._map[$v.key],$v.recover()},$g._create=function($v,$g,$Q,$d,$r,$k,$$,$b){if(!$Q)return $r.apply($d,$k),null;if($$){var $a=this._getHandler($d,$r);if($a)return $a.repeat=$g,$a.userFrame=$v,$a.delay=$Q,$a.ignoreRecover=$b,$a.caller=$d,$a.method=$r,$a.args=$k,$a.exeTime=$Q+($v?this.currFrame:this.currTimer+this._now()-this._lastTimer),$a}return($a=$M.create()).repeat=$g,$a.userFrame=$v,$a.delay=$Q,$a.ignoreRecover=$b,$a.caller=$d,$a.method=$r,$a.args=$k,$a.exeTime=$Q+($v?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($a),this._handlers.push($a),$a},$g._indexHandler=function($v){var $g=$v.caller,$Q=$v.method,$d=$g?$g.$_GID||($g.$_GID=$S.getGID()):0,$r=$Q.$_TID||($Q.$_TID=this._mid++);$v.key=$d+"_"+$r,this._map[$v.key]=$v},$g.once=function($v,$g,$Q,$d,$r){void 0===$r&&($r=!0),this._create(!1,!1,$v,$g,$Q,$d,$r,!1)},$g.loop=function($v,$g,$Q,$d,$r,$k,$$){void 0===$r&&($r=!0),void 0===$k&&($k=!1),void 0===$$&&($$=!1);var $b=this._create(!1,!0,$v,$g,$Q,$d,$r,$$);$b&&($b.jumpFrame=$k)},$g.frameOnce=function($v,$g,$Q,$d,$r){void 0===$r&&($r=!0),this._create(!0,!1,$v,$g,$Q,$d,$r,!1)},$g.frameLoop=function($v,$g,$Q,$d,$r,$k){void 0===$r&&($r=!0),void 0===$k&&($k=!1),this._create(!0,!0,$v,$g,$Q,$d,$r,$k)},$g.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$M._freeCount},$g.clear=function($v,$g){var $Q=this._getHandler($v,$g);return!(!$Q||this._isIgnoreRecover($Q))&&(delete this._map[$Q.key],$Q.key=null,$Q.clear(),!0)},$g.clearAll=function($v){if($v)for(var $g=0,$Q=this._handlers.length;$g<$Q;$g++){var $d=this._handlers[$g];$d.caller===$v&&(this._isIgnoreRecover($d)||(delete this._map[$d.key],$d.key=null,$d.clear()))}},$g._getHandler=function($v,$g){var $Q=$v?$v.$_GID||($v.$_GID=$S.getGID()):0,$d=$g.$_TID||($g.$_TID=this._mid++);return this._map[$Q+"_"+$d]},$g._isIgnoreRecover=function($v){if($v.ignoreRecover||$v.caller&&"IgnoreRecover"==$v.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $g="";try{arguments.propertyIsEnumerable.caller}catch($v){$g=$v.stack}$W.recordError("报错：核心定时器销毁忽略  "+$g)}return!0}return!1},$g.hasHandler=function($v,$g){return this._map[$v.$_GID+"_"+$g.$_TID]},$g.callLater=function($v,$g,$Q){if(null==this._getHandler($v,$g)){var $d=$M.create();$d.caller=$v,$d.method=$g,$d.args=$Q,this._indexHandler($d),this._laters.push($d)}},$g.runCallLater=function($v,$g){var $Q=this._getHandler($v,$g);$Q&&null!=$Q.method&&(this._isIgnoreRecover($Q)||(delete this._map[$Q.key],$Q.run(!0)))},$g.runTimer=function($v,$g){this.runCallLater($v,$g)},$Y(0,$g,"delta",function(){return this._delta}),$v.__init$=function(){$M=function(){function $g(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$t($g,"");var $v=$g.prototype;return $v.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$v.recover=function(){this.clear(),this.args=$g._freeHandler,$g._freeHandler=this,$g._freeCount++},$v.run=function($v){var $g=this.caller;if($g&&$g.destroyed)return this.clear();var $Q=this.method,$d=this.args;$v&&this.clear(),null!=$Q&&($d?$Q.apply($g,$d):$Q.call($g))},$g._freeHandler=null,$g._freeCount=0,$g.create=function(){var $v=$g._freeHandler;return $v?($g._freeHandler=$v.args,--$g._freeCount,$v.args=null,$v):new $g},$g}()},$v}()),$I=function(){function $D(){this.gid=0}$t($D,"laya.utils.Tween");var $v=$D.prototype;return $v.to=function($v,$g,$Q,$d,$r,$k,$$){return void 0===$k&&($k=0),void 0===$$&&($$=!1),this._create($v,$g,$Q,$d,$r,$k,$$,!0,!1,!0)},$v.from=function($v,$g,$Q,$d,$r,$k,$$){return void 0===$k&&($k=0),void 0===$$&&($$=!1),this._create($v,$g,$Q,$d,$r,$k,$$,!1,!1,!0)},$v._create=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){if(!$v)throw new Error("Tween:target is null");this._target=$v,this._duration=$Q,this._ease=$d||$g.ease||$D.easeNone,this._complete=$r||$g.complete,this._delay=$k,this._props=[],this._usedTimer=0,this._startTimer=$c.now(),this._usedPool=$a,this._delayParam=null,this.update=$g.update;var $Y=$v.$_GID||($v.$_GID=$S.getGID());return $D.tweenMap[$Y]?($$&&$D.clearTween($v),$D.tweenMap[$Y].push(this)):$D.tweenMap[$Y]=[this],$M?$k<=0?this.firstStart($v,$g,$b):(this._delayParam=[$v,$g,$b],$W.scaleTimer.once($k,this,this.firstStart,this._delayParam)):this._initProps($v,$g,$b),this},$v.firstStart=function($v,$g,$Q){this._delayParam=null,$v.destroyed?this.clear():(this._initProps($v,$g,$Q),this._beginLoop())},$v._initProps=function($v,$g,$Q){for(var $d in $g)if("number"==typeof $v[$d]){var $r=$Q?$v[$d]:$g[$d],$k=$Q?$g[$d]:$v[$d];this._props.push([$d,$r,$k-$r]),$Q||($v[$d]=$r)}},$v._beginLoop=function(){$W.scaleTimer.frameLoop(1,this,this._doEase)},$v._doEase=function(){this._updateEase($c.now())},$v._updateEase=function($v){var $g=this._target;if($g){if($g.destroyed)return $D.clearTween($g);var $Q=this._usedTimer=$v-this._startTimer-this._delay;if(!($Q<0)){if($Q>=this._duration)return this.complete();for(var $d=0<$Q?this._ease($Q,0,1,this._duration):0,$r=this._props,$k=0,$$=$r.length;$k<$$;$k++){var $b=$r[$k];$g[$b[0]]=$b[1]+$d*$b[2]}this.update&&this.update.run()}}},$v.complete=function(){if(this._target){$W.scaleTimer.runTimer(this,this.firstStart);for(var $v=this._target,$g=this._props,$Q=this._complete,$d=0,$r=$g.length;$d<$r;$d++){var $k=$g[$d];$v[$k[0]]=$k[1]+$k[2]}this.update&&this.update.run(),this.clear(),$Q&&$Q.run()}},$v.pause=function(){$W.scaleTimer.clear(this,this._beginLoop),$W.scaleTimer.clear(this,this._doEase),$W.scaleTimer.clear(this,this.firstStart);var $v;($v=$c.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$v)},$v.setStartTime=function($v){this._startTimer=$v},$v.clear=function(){this._target&&(this._remove(),this._clear())},$v._clear=function(){this.pause(),$W.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$R.recover("tween",this))},$v.recover=function(){this._usedPool=!0,this._clear()},$v._remove=function(){var $v=$D.tweenMap[this._target.$_GID];if($v)for(var $g=0,$Q=$v.length;$g<$Q;$g++)if($v[$g]===this){$v.splice($g,1);break}},$v.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$c.now(),this._delayParam)$W.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $v=this._props,$g=0,$Q=$v.length;$g<$Q;$g++){var $d=$v[$g];this._target[$d[0]]=$d[1]}$W.scaleTimer.once(this._delay,this,this._beginLoop)}},$v.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$c.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$W.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$Y(0,$v,"progress",null,function($v){var $g=$v*this._duration;this._startTimer=$c.now()-this._delay-$g}),$D.to=function($v,$g,$Q,$d,$r,$k,$$,$b){return void 0===$k&&($k=0),void 0===$$&&($$=!1),void 0===$b&&($b=!0),$R.getItemByClass("tween",$D)._create($v,$g,$Q,$d,$r,$k,$$,!0,$b,!0)},$D.from=function($v,$g,$Q,$d,$r,$k,$$,$b){return void 0===$k&&($k=0),void 0===$$&&($$=!1),void 0===$b&&($b=!0),$R.getItemByClass("tween",$D)._create($v,$g,$Q,$d,$r,$k,$$,!1,$b,!0)},$D.clearAll=function($v){if($v&&$v.$_GID){var $g=$D.tweenMap[$v.$_GID];if($g){for(var $Q=0,$d=$g.length;$Q<$d;$Q++)$g[$Q]._clear();$g.length=0}}},$D.clear=function($v){$v.clear()},$D.clearTween=function($v){$D.clearAll($v)},$D.easeNone=function($v,$g,$Q,$d){return $Q*$v/$d+$g},$D.tweenMap={},$D}(),$S=function(){function $b(){}return $t($b,"laya.utils.Utils"),$b.toRadian=function($v){return $v*$b._pi2},$b.toAngle=function($v){return $v*$b._pi},$b.toHexColor=function($v){if($v<0||isNaN($v))return null;for(var $g=$v.toString(16);$g.length<6;)$g="0"+$g;return"#"+$g},$b.getGID=function(){return $b._gid++},$b.concatArray=function($v,$g){if(!$g)return $v;if(!$v)return $g;var $Q=0,$d=$g.length;for($Q=0;$Q<$d;$Q++)$v.push($g[$Q]);return $v},$b.clearArray=function($v){return $v&&($v.length=0),$v},$b.copyArray=function($v,$g){if($v||($v=[]),!$g)return $v;$v.length=$g.length;var $Q=0,$d=$g.length;for($Q=0;$Q<$d;$Q++)$v[$Q]=$g[$Q];return $v},$b.getGlobalRecByPoints=function($v,$g,$Q,$d,$r){var $k,$$;return $k=new $F($g,$Q),$k=$v.localToGlobal($k),$$=new $F($d,$r),$$=$v.localToGlobal($$),$l._getWrapRec([$k.x,$k.y,$$.x,$$.y])},$b.getGlobalPosAndScale=function($v){return $b.getGlobalRecByPoints($v,0,0,1,1)},$b.bind=function($v,$g){return $v.bind($g)},$b.measureText=function($v,$g){return $Z.measureText($v,$g)},$b.contextMeasureText=function($v){var $g=$c.context.measureText($v);return $g||($g={width:16,height:16}),$g},$b.updateOrder=function($v){if(!$v||$v.length<2)return!1;for(var $g,$Q=1,$d=0,$r=$v.length,$k=NaN;$Q<$r;){for($g=$v[$d=$Q],$k=$v[$d]._zOrder;-1<--$d&&$v[$d]._zOrder>$k;)$v[$d+1]=$v[$d];$v[$d+1]=$g,$Q++}var $$=$g.parent.conchModel;if($$)if(null!=$$.updateZOrder)$$.updateZOrder();else{for($Q=0;$Q<$r;$Q++)$$.removeChild($v[$Q].conchModel);for($Q=0;$Q<$r;$Q++)$$.addChildAt($v[$Q].conchModel,$Q)}return!0},$b.transPointList=function($v,$g,$Q){var $d=0,$r=$v.length;for($d=0;$d<$r;$d+=2)$v[$d]+=$g,$v[$d+1]+=$Q},$b.parseInt=function($v,$g){void 0===$g&&($g=0);var $Q=$c.window.parseInt($v,$g);return isNaN($Q)?0:$Q},$b.getFileExtension=function($v){$b._extReg.lastIndex=$v.lastIndexOf(".");var $g=$b._extReg.exec($v);return $g&&1<$g.length?$g[1].toLowerCase():null},$b.getTransformRelativeToWindow=function($v,$g,$Q){var $d=$W.stage,$r=laya.utils.Utils.getGlobalPosAndScale($v),$k=$d._canvasTransform.clone(),$$=$k.tx,$b=$k.ty;$k.rotate(-Math.PI/180*$W.stage.canvasDegree),$k.scale($W.stage.clientScaleX,$W.stage.clientScaleY);var $a=$W.stage.canvasDegree%180!=0,$M=NaN,$Y=NaN;$a?($M=$Q+$r.y,$Y=$g+$r.x,$M*=$k.d,$Y*=$k.a,90==$W.stage.canvasDegree?($M=$$-$M,$Y+=$b):($M+=$$,$Y=$b-$Y)):($M=$g+$r.x,$Y=$Q+$r.y,$M*=$k.a,$Y*=$k.d,$M+=$$,$Y+=$b);var $D=NaN,$J=NaN;return $J=$a?($D=$k.d*$r.height,$k.a*$r.width):($D=$k.a*$r.width,$k.d*$r.height),{x:$M,y:$Y,scaleX:$D,scaleY:$J}},$b.fitDOMElementInArea=function($v,$g,$Q,$d,$r,$k){$v._fitLayaAirInitialized||($v._fitLayaAirInitialized=!0,$v.style.transformOrigin=$v.style.webKittransformOrigin="left top",$v.style.position="absolute");var $$=$b.getTransformRelativeToWindow($g,$Q,$d);$v.style.transform=$v.style.webkitTransform="scale("+$$.scaleX+","+$$.scaleY+") rotate("+$W.stage.canvasDegree+"deg)",$v.style.width=$r+"px",$v.style.height=$k+"px",$v.style.left=$$.x+"px",$v.style.top=$$.y+"px"},$b.isOkTextureList=function($v){if(!$v)return!1;var $g,$Q=0,$d=$v.length;for($Q=0;$Q<$d;$Q++)if(!($g=$v[$Q])||!$g.source)return!1;return!0},$b.isOKCmdList=function($v){if(!$v)return!1;var $g,$Q,$d=0,$r=$v.length,$k=$i._context;for($d=0;$d<$r;$d++)switch(($g=$v[$d]).callee){case $k._drawTexture:case $k._fillTexture:case $k._drawTextureWithTransform:if(!($Q=$g[0])||!$Q.source)return!1}return!0},$b._gid=1,$b._pi=180/Math.PI,$b._pi2=Math.PI/180,$b._extReg=/\.(\w+)\??/g,$b.parseXMLFromString=function($v){var $g;if($v=$v.replace(/>\s+</g,"><"),-1<($g=(new DOMParser).parseFromString($v,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($g.firstChild.firstChild.textContent);return $g},$b}(),$O=function(){function $v(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$i.isWebGL&&$j.regCacheByFunction($S.bind(this.startDispose,this),$S.bind(this.getCacheList,this))}$t($v,"laya.utils.VectorGraphManager");var $g=$v.prototype;return $g.getId=function(){return this._id++},$g.addShape=function($v,$g){this.shapeDic[$v]=$g,this.useDic[$v]||(this.useDic[$v]=!0)},$g.addLine=function($v,$g){this.shapeLineDic[$v]=$g,this.shapeLineDic[$v]||(this.shapeLineDic[$v]=!0)},$g.getShape=function($v){this._checkKey&&null!=this.useDic[$v]&&(this.useDic[$v]=!0)},$g.deleteShape=function($v){this.shapeDic[$v]&&(this.shapeDic[$v]=null,delete this.shapeDic[$v]),this.shapeLineDic[$v]&&(this.shapeLineDic[$v]=null,delete this.shapeLineDic[$v]),null!=this.useDic[$v]&&delete this.useDic[$v]},$g.getCacheList=function(){var $v,$g=[];for($v in this.shapeDic)$g.push(this.shapeDic[$v]);for($v in this.shapeLineDic)$g.push(this.shapeLineDic[$v]);return $g},$g.startDispose=function($v){var $g;for($g in this.useDic)this.useDic[$g]=!1;this._checkKey=!0},$g.endDispose=function(){if(this._checkKey){var $v;for($v in this.useDic)this.useDic[$v]||this.deleteShape($v);this._checkKey=!1}},$v.getInstance=function(){return $v.instance=$v.instance||new $v},$v.instance=null,$v}(),$_=function(){function $d(){this._obj=null,this._obj=$d.supportWeakMap?new $c.window.WeakMap:{},$d.supportWeakMap||$d._maps.push(this)}$t($d,"laya.utils.WeakObject");var $v=$d.prototype;return $v.set=function($v,$g){if(null!=$v)if($d.supportWeakMap){var $Q=$v;"string"!=typeof $v&&"number"!=typeof $v||($Q=$d._keys[$v])||($Q=$d._keys[$v]={k:$v}),this._obj.set($Q,$g)}else"string"==typeof $v||"number"==typeof $v?this._obj[$v]=$g:($v.$_GID||($v.$_GID=$S.getGID()),this._obj[$v.$_GID]=$g)},$v.get=function($v){if(null==$v)return null;if($d.supportWeakMap){var $g="string"==typeof $v||"number"==typeof $v?$d._keys[$v]:$v;return $g?this._obj.get($g):null}return"string"==typeof $v||"number"==typeof $v?this._obj[$v]:this._obj[$v.$_GID]},$v.del=function($v){if(null!=$v)if($d.supportWeakMap){var $g="string"==typeof $v||"number"==typeof $v?$d._keys[$v]:$v;if(!$g)return;this._obj.delete($g)}else"string"==typeof $v||"number"==typeof $v?delete this._obj[$v]:delete this._obj[this._obj.$_GID]},$v.has=function($v){if(null==$v)return!1;if($d.supportWeakMap){var $g="string"==typeof $v||"number"==typeof $v?$d._keys[$v]:$v;return this._obj.has($g)}return"string"==typeof $v||"number"==typeof $v?null!=this._obj[$v]:null!=this._obj[this._obj.$_GID]},$d.__init__=function(){($d.supportWeakMap=null!=$c.window.WeakMap)||$W.timer.loop($d.delInterval,null,$d.clearCache)},$d.clearCache=function(){for(var $v=0,$g=$d._maps.length;$v<$g;$v++){$d._maps[$v]._obj={}}},$d.supportWeakMap=!1,$d.delInterval=3e5,$d._keys={},$d._maps=[],$a($d,["I",function(){return this.I=new $d}]),$d}(),$u=function(){function $v(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$t($v,"laya.utils.WordText");var $g=$v.prototype;return $g.setText=function($v){this.changed=!0,this._text=$v},$g.toString=function(){return this._text},$g.charCodeAt=function($v){return this._text?this._text.charCodeAt($v):NaN},$g.charAt=function($v){return this._text?this._text.charAt($v):null},$Y(0,$g,"length",function(){return this._text?this._text.length:0}),$v}(),$vv=function($v){function $$(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$$.__super.call(this),this._childs=$$.ARRAY_EMPTY,this._$P=$$.PROP_EMPTY,this.timer=$W.scaleTimer,this.conchModel=$i.isConchNode?this.createConchModel():null}$t($$,"laya.display.Node",$M);var $g=$$.prototype;return $g._setBit=function($v,$g){1==$v&&(this._getBit($v)!=$g&&this._updateDisplayedInstage());$g?this._bits|=$v:this._bits&=~$v},$g._getBit=function($v){return 0!=(this._bits&$v)},$g._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$g._setUpNoticeType=function($v){var $g=this;for($g._setBit($v,!0),$g=$g.parent;$g;){if($g._getBit($v))return;$g._setBit($v,!0),$g=$g.parent}},$g.on=function($v,$g,$Q,$d){return"display"!==$v&&"undisplay"!==$v||this._getBit(1)||this._setUpNoticeType(1),this._createListener($v,$g,$Q,$d,!1)},$g.once=function($v,$g,$Q,$d){return"display"!==$v&&"undisplay"!==$v||this._getBit(1)||this._setUpNoticeType(1),this._createListener($v,$g,$Q,$d,!0)},$g.createConchModel=function(){return null},$g.destroy=function($v){void 0===$v&&($v=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($v?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$g.destroyChildren=function(){if(this._childs)for(var $v=this._childs.length-1;-1<$v;$v--)this._childs[$v].destroy(!0)},$g.addChild=function($v){if(!$v||this.destroyed||$v===this)return $v;if($v.zOrder&&this._set$P("hasZorder",!0),$v._parent===this){var $g=this.getChildIndex($v);$g!==this._childs.length-1&&(this._childs.splice($g,1),this._childs.push($v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,this._childs.length-1)),this._childChanged())}else $v.parent&&$v.parent.removeChild($v),this._childs===$$.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($v),this.conchModel&&this.conchModel.addChildAt($v.conchModel,this._childs.length-1),($v.parent=this)._childChanged();return $v},$g.addChildren=function($v){for(var $g=arguments,$Q=0,$d=$g.length;$Q<$d;)this.addChild($g[$Q++])},$g.addChildAt=function($v,$g){if(!$v||this.destroyed||$v===this)return $v;if($v.zOrder&&this._set$P("hasZorder",!0),0<=$g&&$g<=this._childs.length){if($v._parent===this){var $Q=this.getChildIndex($v);this._childs.splice($Q,1),this._childs.splice($g,0,$v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,$g)),this._childChanged()}else $v.parent&&$v.parent.removeChild($v),this._childs===$$.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($g,0,$v),this.conchModel&&this.conchModel.addChildAt($v.conchModel,$g),$v.parent=this;return $v}throw new Error("appendChildAt:The index is out of bounds")},$g.getChildIndex=function($v){return this._childs.indexOf($v)},$g.getChildByName=function($v){var $g=this._childs;if($g)for(var $Q=0,$d=$g.length;$Q<$d;$Q++){var $r=$g[$Q];if($r.name===$v)return $r}return null},$g._get$P=function($v){return this._$P[$v]},$g._set$P=function($v,$g){return this.destroyed||(this._$P===$$.PROP_EMPTY&&(this._$P={}),this._$P[$v]=$g),$g},$g.getChildAt=function($v){return this._childs[$v]},$g.setChildIndex=function($v,$g){var $Q=this._childs;if($g<0||$g>=$Q.length)throw new Error("setChildIndex:The index is out of bounds.");var $d=this.getChildIndex($v);if($d<0)throw new Error("setChildIndex:node is must child of this object.");return $Q.splice($d,1),$Q.splice($g,0,$v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,$g)),this._childChanged(),$v},$g._childChanged=function($v){},$g.removeChild=function($v){if(!this._childs)return $v;var $g=this._childs.indexOf($v);return this.removeChildAt($g)},$g.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$g.removeChildByName=function($v){var $g=this.getChildByName($v);return $g&&this.removeChild($g),$g},$g.removeChildAt=function($v){var $g=this.getChildAt($v);if($g){for(var $Q=this._childs.length-1,$d=$v;$d<$Q;++$d)this._childs[$d]=this._childs[$d+1];this._childs.length=$Q,this.conchModel&&this.conchModel.removeChild($g.conchModel),$g.parent=null}return $g},$g.removeChildren=function($v,$g){if(void 0===$v&&($v=0),void 0===$g&&($g=2147483647),this._childs&&0<this._childs.length){var $Q=this._childs;if(0===$v&&$k<=$g){var $d=$Q;this._childs=$$.ARRAY_EMPTY}else $d=$Q.splice($v,$g-$v);for(var $r=0,$k=$d.length;$r<$k;$r++)$d[$r].parent=null,this.conchModel&&this.conchModel.removeChild($d[$r].conchModel)}return this},$g.replaceChild=function($v,$g){var $Q=this._childs.indexOf($g);return-1<$Q?(this._childs.splice($Q,1,$v),this.conchModel&&(this.conchModel.removeChild($g.conchModel),this.conchModel.addChildAt($v.conchModel,$Q)),$g.parent=null,$v.parent=this,$v):null},$g._updateDisplayedInstage=function(){var $v;$v=this;var $g=$W.stage;for(this._displayedInStage=!1;$v;){if($v._getBit(1)){this._displayedInStage=$v._displayedInStage;break}if($v==$g||$v._displayedInStage){this._displayedInStage=!0;break}$v=$v.parent}},$g._setDisplay=function($v){this._displayedInStage!==$v&&((this._displayedInStage=$v)?this.event("display"):this.event("undisplay"))},$g._displayChild=function($v,$g){var $Q=$v._childs;if($Q)for(var $d=0;$d<$Q.length;$d++){var $r=$Q[$d];$r&&$r._getBit(1)&&(0<$r._childs.length?this._displayChild($r,$g):$r._setDisplay($g))}$v._setDisplay($g)},$g.contains=function($v){if($v===this)return!0;for(;$v;){if($v.parent===this)return!0;$v=$v.parent}return!1},$g.timerLoop=function($v,$g,$Q,$d,$r,$k){void 0===$r&&($r=!0),void 0===$k&&($k=!1),this.timer.loop($v,$g,$Q,$d,$r,$k)},$g.timerOnce=function($v,$g,$Q,$d,$r){void 0===$r&&($r=!0),this.timer._create(!1,!1,$v,$g,$Q,$d,$r)},$g.frameLoop=function($v,$g,$Q,$d,$r){void 0===$r&&($r=!0),this.timer._create(!0,!0,$v,$g,$Q,$d,$r)},$g.frameOnce=function($v,$g,$Q,$d,$r){void 0===$r&&($r=!0),this.timer._create(!0,!1,$v,$g,$Q,$d,$r)},$g.clearTimer=function($v,$g){this.timer.clear($v,$g)},$Y(0,$g,"numChildren",function(){return this._childs.length}),$Y(0,$g,"destroyed",function(){return this._destroyed}),$Y(0,$g,"parent",function(){return this._parent},function($v){this._parent!==$v&&($v?(this._parent=$v,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$v.displayedInStage&&this._displayChild(this,!0)),$v._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$v))}),$Y(0,$g,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$$.ARRAY_EMPTY=[],$$.PROP_EMPTY={},$$.NOTICE_DISPLAY=1,$$.MOUSEENABLE=2,$$}(),$gv=function($v){function $J($v){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$J.__super.call(this),this._padding=$J._PADDING,this._spacing=$J._SPACING,this._aligns=$J._ALIGNS,this._font=$p.EMPTY,this._ower=$v}$t($J,"laya.display.css.CSSStyle",$v);var $g=$J.prototype;return $g.destroy=function(){this._ower=null,this._font=null,this._rect=null},$g.inherit=function($v){this._font=$v._font,this._spacing=$v._spacing===$J._SPACING?$J._SPACING:$v._spacing.slice(),this.lineHeight=$v.lineHeight},$g._widthAuto=function(){return 0!=(262144&this._type)},$g.widthed=function($v){return 0!=(8&this._type)},$g._calculation=function($v,$g){if($g.indexOf("%")<0)return!1;var $d=this._ower,$r=$d.parent,$k=this._rect;function $$($v,$g,$Q){return $v*$Q[0]+$g*$Q[1]+$Q[2]}function $Q($v){var $g=$r.width,$Q=$d.width;$k.width&&($d.width=$$($g,$Q,$k.width)),$k.height&&($d.height=$$($g,$Q,$k.height)),$k.left&&($d.x=$$($g,$Q,$k.left)),$k.top&&($d.y=$$($g,$Q,$k.top))}null===$k&&($r._getCSSStyle()._type|=524288,$r.on("resize",this,$Q),this._rect=$k={input:{}});var $b=$g.split(" ");return $b[0]=parseFloat($b[0])/100,1==$b.length?$b[1]=$b[2]=0:($b[1]=parseFloat($b[1])/100,$b[2]=parseFloat($b[2])),$k[$v]=$b,$k.input[$v]=$g,$Q(),!0},$g.heighted=function($v){return 0!=(8192&this._type)},$g.size=function($v,$g){var $Q=this._ower,$d=!1;-1!==$v&&$v!=this._ower.width&&(this._type|=8,this._ower.width=$v,$d=!0),-1!==$g&&$g!=this._ower.height&&(this._type|=8192,this._ower.height=$g,$d=!0),$d&&($Q._layoutLater(),524288&this._type&&$Q.event("resize",this))},$g._getAlign=function(){return this._aligns[0]},$g._getValign=function(){return this._aligns[1]},$g._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$g._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $p(this._font))},$g.render=function($v,$g,$Q,$d){var $r=$v.width,$k=$v.height;$Q-=$v.pivotX,$d-=$v.pivotY,this._bgground&&null!=this._bgground.color&&$g.ctx.fillRect($Q,$d,$r,$k,this._bgground.color),this._border&&this._border.color&&$g.drawRect($Q,$d,$r,$k,this._border.color.strColor,this._border.size)},$g.getCSSStyle=function(){return this},$g.cssText=function($v){this.attrs($J.parseOneCSS($v,";"))},$g.attrs=function($v){if($v)for(var $g=0,$Q=$v.length;$g<$Q;$g++){var $d=$v[$g];this[$d[0]]=$d[1]}},$g.setTransform=function($v){"none"===$v?this._tf=$b._TF_EMPTY:this.attrs($J.parseOneCSS($v,","))},$g.translate=function($v,$g){this._tf===$b._TF_EMPTY&&(this._tf=new $r),this._tf.translateX=$v,this._tf.translateY=$g},$g.scale=function($v,$g){this._tf===$b._TF_EMPTY&&(this._tf=new $r),this._tf.scaleX=$v,this._tf.scaleY=$g},$g._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$Y(0,$g,"block",$v.prototype._$get_block,function($v){$v?this._type|=1:this._type&=-2}),$Y(0,$g,"valign",function(){return $J._valigndef[this._aligns[1]]},function($v){this._aligns===$J._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$J._valigndef[$v]}),$Y(0,$g,"height",null,function($v){if(this._type|=8192,"string"==typeof $v){if(this._calculation("height",$v))return;$v=parseInt($v)}this.size(-1,$v)}),$Y(0,$g,"width",null,function($v){if(this._type|=8,"string"==typeof $v){var $g=$v.indexOf("auto");if(0<=$g&&(this._type|=262144,$v=$v.substr(0,$g)),this._calculation("width",$v))return;$v=parseInt($v)}this.size($v,-1)}),$Y(0,$g,"fontWeight",function(){return this._font.weight},function($v){this._createFont().weight=$v}),$Y(0,$g,"left",null,function($v){var $g=this._ower;if("string"==typeof $v){if("center"===$v?$v="50% -50% 0":"right"===$v&&($v="100% -100% 0"),this._calculation("left",$v))return;$v=parseInt($v)}$g.x=$v}),$Y(0,$g,"_translate",null,function($v){this.translate($v[0],$v[1])}),$Y(0,$g,"absolute",function(){return 0!=(4&this._type)}),$Y(0,$g,"top",null,function($v){var $g=this._ower;if("string"==typeof $v){if("middle"===$v?$v="50% -50% 0":"bottom"===$v&&($v="100% -100% 0"),this._calculation("top",$v))return;$v=parseInt($v)}$g.y=$v}),$Y(0,$g,"align",function(){return $J._aligndef[this._aligns[0]]},function($v){this._aligns===$J._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$J._aligndef[$v]}),$Y(0,$g,"bold",function(){return this._font.bold},function($v){this._createFont().bold=$v}),$Y(0,$g,"padding",function(){return this._padding},function($v){this._padding=$v}),$Y(0,$g,"leading",function(){return this._spacing[1]},function($v){"string"==typeof $v&&($v=parseInt($v+"")),this._spacing===$J._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$v}),$Y(0,$g,"lineElement",function(){return 0!=(65536&this._type)},function($v){$v?this._type|=65536:this._type&=-65537}),$Y(0,$g,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($v){this.lineElement=!1,"right"===$v?this._type|=32768:this._type&=-32769}),$Y(0,$g,"textDecoration",function(){return this._font.decoration},function($v){this._createFont().decoration=$v}),$Y(0,$g,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($v){"nowrap"===$v&&(this._type|=131072),"none"===$v&&(this._type&=-131073)}),$Y(0,$g,"background",null,function($v){$v?(this._bgground||(this._bgground={}),this._bgground.color=$v,this._ower.conchModel&&this._ower.conchModel.bgColor($v),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$Y(0,$g,"wordWrap",function(){return 0==(131072&this._type)},function($v){$v?this._type&=-131073:this._type|=131072}),$Y(0,$g,"color",function(){return this._font.color},function($v){this._createFont().color=$v}),$Y(0,$g,"password",function(){return this._font.password},function($v){this._createFont().password=$v}),$Y(0,$g,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($v){"none"===$v?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$v),this._ower.conchModel&&this._ower.conchModel.bgColor($v),this._ower._renderType|=256}),$Y(0,$g,"font",function(){return this._font.toString()},function($v){this._createFont().set($v)}),$Y(0,$g,"weight",null,function($v){this._createFont().weight=$v}),$Y(0,$g,"letterSpacing",function(){return this._spacing[0]},function($v){"string"==typeof $v&&($v=parseInt($v+"")),this._spacing===$J._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$v}),$Y(0,$g,"fontSize",function(){return this._font.size},function($v){this._createFont().size=$v}),$Y(0,$g,"italic",function(){return this._font.italic},function($v){this._createFont().italic=$v}),$Y(0,$g,"fontFamily",function(){return this._font.family},function($v){this._createFont().family=$v}),$Y(0,$g,"stroke",function(){return this._font.stroke[0]},function($v){this._createFont().stroke===$p._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$v}),$Y(0,$g,"strokeColor",function(){return this._font.stroke[1]},function($v){this._createFont().stroke===$p._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$v}),$Y(0,$g,"border",function(){return this._border?this._border.value:""},function($v){if("none"!=$v){this._border||(this._border={});var $g=(this._border.value=$v).split(" ");if(this._border.color=$H.create($g[$g.length-1]),1==$g.length)return this._border.size=1,void(this._border.type="solid");var $Q=0;0<$g[0].indexOf("px")?(this._border.size=parseInt($g[0]),$Q++):this._border.size=1,this._border.type=$g[$Q],this._ower._renderType|=256}else this._border=null}),$Y(0,$g,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($v){$v?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$v?null:$H.create($v),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$Y(0,$g,"position",function(){return 4&this._type?"absolute":""},function($v){"absolute"==$v?this._type|=4:this._type&=-5}),$Y(0,$g,"display",null,function($v){switch($v){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$Y(0,$g,"paddingLeft",function(){return this.padding[3]}),$Y(0,$g,"paddingTop",function(){return this.padding[0]}),$Y(0,$g,"_scale",null,function($v){this._ower.scale($v[0],$v[1])}),$Y(0,$g,"_rotate",null,function($v){this._ower.rotation=$v}),$J.parseOneCSS=function($v,$g){for(var $Q,$d=[],$r=$v.split($g),$k=0,$$=$r.length;$k<$$;$k++){var $b=$r[$k],$a=$b.indexOf(":"),$M=$b.substr(0,$a).replace(/^\s+|\s+$/g,"");if(0!=$M.length){var $Y=$b.substr($a+1).replace(/^\s+|\s+$/g,""),$D=[$M,$Y];switch($M){case"italic":case"bold":$D[1]="true"==$Y;break;case"line-height":$D[0]="lineHeight",$D[1]=parseInt($Y);break;case"font-size":$D[0]="fontSize",$D[1]=parseInt($Y);break;case"padding":1<($Q=$Y.split(" ")).length||($Q[1]=$Q[2]=$Q[3]=$Q[0]),$D[1]=[parseInt($Q[0]),parseInt($Q[1]),parseInt($Q[2]),parseInt($Q[3])];break;case"rotate":$D[0]="_rotate",$D[1]=parseFloat($Y);break;case"scale":$Q=$Y.split(" "),$D[0]="_scale",$D[1]=[parseFloat($Q[0]),parseFloat($Q[1])];break;case"translate":$Q=$Y.split(" "),$D[0]="_translate",$D[1]=[parseInt($Q[0]),parseInt($Q[1])];break;default:($D[0]=$J._CSSTOVALUE[$M])||($D[0]=$M)}$d.push($D)}}return $d},$J.parseCSS=function($v,$g){for(var $Q;null!=($Q=$J._parseCSSRegExp.exec($v));)$J.styleSheets[$Q[1]]=$J.parseOneCSS($Q[2],";")},$J.EMPTY=new $J(null),$J._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$J._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$J._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$J._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$J.styleSheets={},$J.ALIGN_CENTER=1,$J.ALIGN_RIGHT=2,$J.VALIGN_MIDDLE=1,$J.VALIGN_BOTTOM=2,$J._CSS_BLOCK=1,$J._DISPLAY_NONE=2,$J._ABSOLUTE=4,$J._WIDTH_SET=8,$J._PADDING=[0,0,0,0],$J._RECT=[-1,-1,-1,-1],$J._SPACING=[0,0],$J._ALIGNS=[0,0,0],$J.ADDLAYOUTED=512,$J._NEWFONT=4096,$J._HEIGHT_SET=8192,$J._BACKGROUND_SET=16384,$J._FLOAT_RIGHT=32768,$J._LINE_ELEMENT=65536,$J._NOWARP=131072,$J._WIDTHAUTO=262144,$J._LISTERRESZIE=524288,$J}($b),$Qv=function($v){function $$(){this.url=null,this.audio=null,this.loaded=!1,$$.__super.call(this)}$t($$,"laya.media.h5audio.AudioSound",$M);var $g=$$.prototype;return $g.dispose=function(){var $v=$$._audioCache[this.url];$v&&($v.src="",delete $$._audioCache[this.url])},$g.load=function($v){var $g;if($v=$N.formatURL($v),(this.url=$v)==$V._tMusic?($$._initMusicAudio(),($g=$$._musicAudio).src!=$v&&($$._audioCache[$g.src]=null,$g=null)):$g=$$._audioCache[$v],$g&&2<=$g.readyState)this.event("complete");else{$g||($g=$v==$V._tMusic?($$._initMusicAudio(),$$._musicAudio):$c.createElement("audio"),($$._audioCache[$v]=$g).src=$v),$g.addEventListener("canplaythrough",$d),$g.addEventListener("error",$r);var $Q=this;(this.audio=$g).load?$g.load():$r()}function $d(){$k(),$Q.loaded=!0,$Q.event("complete")}function $r(){$g.load=null,$k(),$Q.event("error")}function $k(){$g.removeEventListener("canplaythrough",$d),$g.removeEventListener("error",$r)}},$g.play=function($v,$g,$Q){if(void 0===$v&&($v=0),void 0===$g&&($g=0),!this.url)return null;var $d,$r;if(!($d=this.url==$V._tMusic?$$._musicAudio:$$._audioCache[this.url]))return null;$r=$R.getItem("audio:"+this.url),$i.isConchApp?$r||(($r=$c.createElement("audio")).src=this.url):this.url==$V._tMusic?($$._initMusicAudio(),($r=$$._musicAudio).src=this.url):$r=$r||$d.cloneNode(!0);var $k=new $Jv($r);return $k.url=this.url,$k.loops=$g,$k.startTime=$v,$k.startHandler=$Q,$k.play(!1),$V.addChannel($k),$k},$Y(0,$g,"duration",function(){var $v;return($v=$$._audioCache[this.url])?$v.duration:0}),$$._initMusicAudio=function(){$$._musicAudio||($$._musicAudio||($$._musicAudio=$c.createElement("audio")),$i.isConchApp||$c.document.addEventListener("mousedown",$$._makeMusicOK))},$$._makeMusicOK=function(){$c.document.removeEventListener("mousedown",$$._makeMusicOK),$$._musicAudio.src?$$._musicAudio.play():($$._musicAudio.src="",$$._musicAudio.load())},$$._audioCache={},$$._musicAudio=null,$$}(),$dv=function($v){function $g(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$g.__super.call(this)}$t($g,"laya.media.SoundChannel",$M);var $Q=$g.prototype;return $Q.play=function(){},$Q.stop=function(){},$Q.pause=function(){},$Q.resume=function(){},$Q.__runComplete=function($v){$v&&$v.run()},$Y(0,$Q,"volume",function(){return 1},function($v){}),$Y(0,$Q,"position",function(){return 0}),$Y(0,$Q,"duration",function(){return 0}),$g}(),$rv=function($v){function $g(){$g.__super.call(this)}$t($g,"laya.media.Sound",$M);var $Q=$g.prototype;return $Q.load=function($v){},$Q.play=function($v,$g,$Q){return void 0===$v&&($v=0),void 0===$g&&($g=0),null},$Q.dispose=function(){},$Y(0,$Q,"duration",function(){return 0}),$g}(),$kv=function($v){function $r(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$r.__super.call(this)}$t($r,"laya.media.webaudio.WebAudioSound",$M);var $g=$r.prototype;return $g.load=function($v){this.url=$v,this.audioBuffer=$r._dataCache[$v],this.audioBuffer?this._loaded(this.audioBuffer):($r.e.on("loaded:"+$v,this,this._loaded),$r.e.on("err:"+$v,this,this._err),$r.__loadingSound[$v]||($r.__loadingSound[$v]=!0,$W.loader.load($v,$G.create(this,this.onloaded),null,$bv.BUFFER,4,!1,null,!0)))},$g.onloaded=function($v){$v||this._err(),this._disposed?this._removeLoadEvents():(this.data=$v,$r.buffs.push({buffer:this.data,url:this.url}),$r.decode())},$g._err=function(){if(this._removeLoadEvents(),$r.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $v,$g,$Q,$d=0;for($v=($g=this.__toPlays).length,$d=0;$d<$v;$d++)($Q=$g[$d])[3]&&!$Q[3].isStopped&&$Q[3].event("error");this.__toPlays.length=0}},$g._loaded=function($v){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$v,this.loaded=!0,this.event("complete"))},$g._removeLoadEvents=function(){$r.e.off("loaded:"+this.url,this,this._loaded),$r.e.off("err:"+this.url,this,this._err)},$g.__playAfterLoaded=function(){if(this.__toPlays){var $v,$g,$Q,$d=0;for($v=($g=this.__toPlays).length,$d=0;$d<$v;$d++)($Q=$g[$d])[3]&&!$Q[3].isStopped&&this.play($Q[0],$Q[1],$Q[2],$Q[3]);this.__toPlays.length=0}},$g.play=function($v,$g,$Q,$d){return void 0===$v&&($v=0),void 0===$g&&($g=0),$d=$d||new $pv,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$v,$g,$Q,$d]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$d.url=this.url,$d.loops=$g,$d.audioBuffer=this.audioBuffer,$d.startTime=$v,$d.startHandler=$Q,$d.play(!1),$V.addChannel($d),$d},$g.dispose=function(){this._disposed=!0,delete $r._dataCache[this.url],delete $r.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$Y(0,$g,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$r.decode=function(){if(!($r.buffs.length<=0||$r.isDecoding))if($r.isDecoding=!0,($r.tInfo=$r.buffs.shift())&&$r.tInfo.buffer&&$r.tInfo.buffer.byteLength)try{$r.ctx.decodeAudioData($r.tInfo.buffer,$r._done,$r._fail)}catch($v){console.error("decodeAudioData error  byteLength:"+$r.tInfo.buffer.byteLength+"  url:"+$r.tInfo.url)}else $r._fail()},$r._done=function($v){$r.e.event("loaded:"+$r.tInfo.url,$v),$r._dataCache[$r.tInfo.url]=$v,$r.isDecoding=!1,$r.decode()},$r._fail=function(){$r.e.event("err:"+$r.tInfo.url,null),$r.isDecoding=!1,$r.decode()},$r._playEmptySound=function(){if(null!=$r.ctx){if($r._emptySource&&($r._emptySource.stop(),$r._emptySource.disconnect(0),!$pv._tryCleanFailed))try{$r._emptySource.buffer=null}catch($v){$pv._tryCleanFailed=!0}var $v=$r.ctx.createBufferSource();$v.buffer=$r._miniBuffer,$v.connect($r.ctx.destination),$v.start(0,0,0),$r._emptySource=$v}},$r._unlock=function(){$r._unlocked||($r._playEmptySound(),"running"==$r.ctx.state?($c.document.removeEventListener("mousedown",$r._unlock,!0),$c.document.removeEventListener("touchend",$r._unlock,!0),$c.document.removeEventListener("touchstart",$r._unlock,!0),$r._unlocked=!0):"suspended"==$r.ctx.state&&$V._recoverWebAudio())},$r.initWebAudio=function(){"running"!=$r.ctx.state&&($r._unlock(),$c.document.addEventListener("mousedown",$r._unlock,!0),$c.document.addEventListener("touchend",$r._unlock,!0),$c.document.addEventListener("touchstart",$r._unlock,!0))},$r._emptySource=null,$r._dataCache={},$r.buffs=[],$r.isDecoding=!1,$r._unlocked=!1,$r.tInfo=null,$r.__loadingSound={},$a($r,["window",function(){return this.window=$c.window},"webAudioEnabled",function(){return this.webAudioEnabled=$r.window.AudioContext||$r.window.webkitAudioContext||$r.window.mozAudioContext},"ctx",function(){return this.ctx=$r.webAudioEnabled?new($r.window.AudioContext||$r.window.webkitAudioContext||$r.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$r.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $M}]),$r}(),$$v=function($v){function $g(){this._responseType=null,this._data=null,$g.__super.call(this),this._http=new $c.window.XMLHttpRequest}$t($g,"laya.net.HttpRequest",$M);var $Q=$g.prototype;return $Q.send=function($v,$g,$Q,$d,$r){void 0===$Q&&($Q="get"),void 0===$d&&($d="text"),this._responseType=$d,this._data=null;var $k=this,$$=this._http;if($$.open($Q,$v,!0),$r)for(var $b=0;$b<$r.length;$b++)$$.setRequestHeader($r[$b++],$r[$b]);else $i.isConchApp||($g&&"string"!=typeof $g?$$.setRequestHeader("Content-Type","application/json"):$$.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$$.responseType="arraybuffer"!==$d?"text":"arraybuffer",$$.onerror=function($v){$k._onError($v)},$$.onabort=function($v){$k._onAbort($v)},$$.onprogress=function($v){$k._onProgress($v)},$$.onload=function($v){$k._onLoad($v)},$$.send($g)},$Q._onProgress=function($v){$v&&$v.lengthComputable&&this.event("progress",$v.loaded/$v.total)},$Q._onAbort=function($v){this.error("Request was aborted by user")},$Q._onError=function($v){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$Q._onLoad=function($v){var $g=this._http,$Q=void 0!==$g.status?$g.status:200;200===$Q||204===$Q||0===$Q?this.complete():this.error("["+$g.status+"]"+$g.statusText+":"+$g.responseURL)},$Q.error=function($v){this.clear(),this.event("error",$v)},$Q.complete=function(){this.clear();var $g=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$S.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($v){$g=!1,this.error($v.message)}$g&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$Q.clear=function(){var $v=this._http;$v.onerror=$v.onabort=$v.onprogress=$v.onload=null},$Y(0,$Q,"url",function(){return this._http.responseURL}),$Y(0,$Q,"http",function(){return this._http}),$Y(0,$Q,"data",function(){return this._data}),$g}(),$bv=function($v){function $o(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$o.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}$t($o,"laya.net.Loader",$M);var $g=$o.prototype;return $g.load=function($v,$g,$Q,$d,$r){if($v&&""!=$v||console.error("Loader 加载的url不合法 "+$v),void 0===$Q&&($Q=!0),void 0===$r&&($r=!1),0===(this._url=$v).indexOf("data:image")?this._type=$g="image":this._type=$g||($g=this.getTypeFromUrl($v)),this._cache=$Q,this._data=null,!$r&&$o.loadedMap[$v])return this._data=$o.loadedMap[$v],this.event("progress",1),void this.event("complete",this._data);if($d&&$o.setGroup($v,$d),null!=$o.parserMap[$g])return this._customParse=!0,void($o.parserMap[$g]instanceof laya.utils.Handler?$o.parserMap[$g].runWith(this):$o.parserMap[$g].call(null,this));if("image"===$g||"htmlimage"===$g||"nativeimage"===$g)return this._loadImage($v);if("ttf"===$g)return this._loadTTF($v);switch($g){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$g}$o.preLoadedMap[$v]?this.onLoaded($o.preLoadedMap[$v]):$$.resMgrLoad($v,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$g.getTypeFromUrl=function($v){var $g=$S.getFileExtension($v);return $g?$o.typeMap[$g]:(console.warn("Not recognize the resources suffix",$v),"text")},$g._loadTTF=function($v){$v=$N.formatURL($v);var $g=new $X;$g.complete=$G.create(this,this.onLoaded),$g.load($v)},$g._loadImage=function($v){$$.imgMgrLoad($v,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$g._loadImageComplete=function($v,$g,$Q){if(null!=$Q)if($Q instanceof ArrayBuffer){var $d=new DataView($Q),$r=new laya.webgl.resource.WebGLImage(new Uint8Array($Q,8),$v,0,!1,$d.getUint32(0),$d.getUint32(4));this.onLoaded($r)}else if($Q instanceof $Yv)$o.imgMgrSet[$v]=$g,$$.imgMgrLock($v,$o.imgMgrSet[$v]),this._url=$v,this.complete($Q);else{var $k=-1!=$v.indexOf(".png",$v.length-4)?6408:6407;$r=new laya.webgl.resource.WebGLImage($Q,$v,$k,!1,$Q.width,$Q.height);this.onLoaded($r)}else this.event("error","Load image failed")},$g.imageCancel=function($v,$g,$Q){$$.imgMgrCancel&&$$.imgMgrCancel($v,this._onImageCallback)},$g._loadSound=function($v){var $g=new $V._soundClass,$Q=this;function $d(){$g.offAll()}$g.on("complete",this,function(){$d(),$Q.onLoaded($g)}),$g.on("error",this,function(){$d(),$g.dispose(),$Q.event("error","Load sound failed")}),$g.load($v)},$g.onProgress=function($v){"atlas"===this._type?this.event("progress",.3*$v):this.event("progress",$v)},$g.onError=function($v){this.event("error",$v)},$g._loadedComplete=function($v,$g,$Q){if(null!=$Q)switch(this._type){case"atlas":case"plf":case"json":var $d=new $B($Q);this.onLoaded(JSON.parse($d.readUTFBytes()));break;case"font":$d=new $B($Q);this.onLoaded($S.parseXMLFromString($d.readUTFBytes()));break;default:this.onLoaded($Q)}else this.event("error",$v)},$g.onLoaded=function($v){var $g=this._type;if("plf"==$g)this.parsePLFData($v),this.complete($v);else if("image"===$g){var $Q=new $Yv($v);$Q.url=this._url,this.complete($Q)}else if("sound"===$g||"htmlimage"===$g||"nativeimage"===$g)this.complete($v);else if("atlas"===$g){if(!$v.src&&!$v._setContext){if(!this._data){if((this._data=$v).meta&&$v.meta.image)for(var $d=$v.meta.image.split(","),$r=0<=this._url.indexOf("/")?"/":"\\",$k=this._url.lastIndexOf($r),$$=0<=$k?this._url.substr(0,$k+1):"",$b=0,$a=$d.length;$b<$a;$b++)$d[$b]=$$+$d[$b];else $d=[this._url.replace(".json",".png")];$d.reverse(),$v.toLoads=$d,$v.pics=[]}return this.event("progress",.3+1/$d.length*.6),this._loadImage($d.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($v),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $M=this._data.frames,$Y=this._url.split("?")[0],$D=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$Y.substring(0,$Y.lastIndexOf("."))+"/",$J=this._data.pics,$p=$N.formatURL(this._url),$T=$o.atlasMap[$p]||($o.atlasMap[$p]=[]);$T.dir=$D;var $t=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $q in $t=parseFloat(this._data.meta.scale),$M){var $C,$G=$M[$q],$s=$J[$G.frame.idx?$G.frame.idx:0],$A=$N.formatURL($D+$q);$s.scaleRate=$t,$C=$Yv.create($s,$G.frame.x,$G.frame.y,$G.frame.w,$G.frame.h,$G.spriteSourceSize.x,$G.spriteSourceSize.y,$G.sourceSize.w,$G.sourceSize.h),$o.cacheRes($A,$C),$o.keepCache(this._url,$D+$q),$C.url=$A,$T.push($A)}else for($q in $M)$s=$J[($G=$M[$q]).frame.idx?$G.frame.idx:0],$A=$N.formatURL($D+$q),$o.cacheRes($A,$Yv.create($s,$G.frame.x,$G.frame.y,$G.frame.w,$G.frame.h,$G.spriteSourceSize.x,$G.spriteSourceSize.y,$G.sourceSize.w,$G.sourceSize.h)),$o.loadedMap[$A].url=$A,$o.keepCache(this._url,$D+$q),$T.push($A);delete this._data.pics,this.complete(this._data)}else if("font"==$g){if(!$v.src)return this._data=$v,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $h=new $E;$h.parseFont(this._data,$v);var $P=this._url.split(".fnt")[0].split("/"),$W=$P[$P.length-1];$qv.registerBitmapFont($W,$h),this._data=$h,this.complete(this._data)}else if("pkm"==$g){var $F=$Pv.create($v,this._url),$l=new $Yv($F);$l.url=this._url,this.complete($l)}else this.complete($v)},$g.parsePLFData=function($v){var $g,$Q,$d;for($g in $v)switch($d=$v[$g],$g){case"json":case"text":for($Q in $d)$o.preLoadedMap[$N.formatURL($Q)]=$d[$Q];break;default:for($Q in $d)$o.preLoadedMap[$N.formatURL($Q)]=$d[$Q]}},$g.complete=function($v){this._data=$v,this._customParse?this.event("loaded",$v instanceof Array?[$v]:$v):($o._loaders.push(this),$o._isWorking||$o.checkNext())},$g.endLoad=function($v){$v&&(this._data=$v),this._cache&&$o.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$Y(0,$g,"url",function(){return this._url}),$Y(0,$g,"data",function(){return this._data}),$Y(0,$g,"cache",function(){return this._cache}),$Y(0,$g,"type",function(){return this._type}),$o.checkNext=function(){$o._isWorking=!0;for(var $v=$c.now();$o._startIndex<$o._loaders.length;)if($c.now(),$o._loaders[$o._startIndex].endLoad(),$o._startIndex++,$c.now()-$v>$o.maxTimeOut)return console.warn("loader callback cost a long time:"+($c.now()-$v)+" url="+$o._loaders[$o._startIndex-1].url),void $W.timer.frameOnce(1,null,$o.checkNext);$o._loaders.length=0,$o._startIndex=0,$o._isWorking=!1},$o.clearRes=function($v,$g){if(null!=$v){void 0===$g&&($g=!1),$v=$N.formatURL($v);var $Q=$o.getAtlas($v);if($Q){for(var $d=0,$r=$Q.length;$d<$r;$d++){var $k=$Q[$d],$$=$o.getRes($k);delete $o.loadedMap[$k],$o.clearCache($v.substring($N.basePath.length),$k.substring($N.basePath.length)),$$&&$$.destroy($g)}$Q.length=0,delete $o.atlasMap[$v],delete $o.loadedMap[$v]}else{var $b=$o.loadedMap[$v];$b&&(delete $o.loadedMap[$v],$b instanceof laya.resource.Texture&&$b.bitmap&&$b.destroy($g))}}},$o.clearTextureRes=function($v){$v=$N.formatURL($v);var $g=laya.net.Loader.getAtlas($v),$Q=$g&&0<$g.length?laya.net.Loader.getRes($g[0]):laya.net.Loader.getRes($v);$Q&&$Q.bitmap&&($i.isConchApp&&!$i.isConchWebGL?$Q.bitmap.source.releaseTexture&&$Q.bitmap.source.releaseTexture():null==$Q.bitmap._atlaser&&$Q.bitmap.releaseResource(!0))},$o.getRes=function($v){return $o.loadedMap[$N.formatURL($v)]},$o.getAtlas=function($v){return $o.atlasMap[$N.formatURL($v)]},$o.cacheRes=function($v,$g){$v=$N.formatURL($v),null!=$o.loadedMap[$v]?console.warn("Resources already exist,is repeated loading:",$v):$o.loadedMap[$v]=$g},$o.setGroup=function($v,$g){$o.groupMap[$g]||($o.groupMap[$g]=[]),$o.groupMap[$g].push($v)},$o.clearResByGroup=function($v){if($o.groupMap[$v]){var $g=$o.groupMap[$v],$Q=0,$d=$g.length;for($Q=0;$Q<$d;$Q++)$o.clearRes($g[$Q]);$g.length=0}},$o.keepCache=function($v,$g){if($v&&$g){var $Q=$o.cacheSet[$g];$Q?-1==$Q.indexOf($v)&&$Q.push($v):$o.cacheSet[$g]=[$v]}},$o.clearCache=function($v,$g){if($v&&$g){var $Q=$o.cacheSet[$g];if($Q){var $d=$Q.indexOf($v);if(-1!==$d){var $r=$Q.length-1;0==$r?(delete $o.cacheSet[$g],0<$o.imgMgrSet[$g]?$$.imgMgrFree($g,$o.imgMgrSet[$g]):$o.clearRes($g,!0)):($Q[$d]=$Q[$r],$Q.length=$r)}}}},$o.saveObject=function($v,$g,$Q){if($g&&$v){var $d=$o.objectSet[$v];$d?(console.warn("Loader.saveObject: "+$v),$d[0]=$g,$d[1]=$Q):$o.objectSet[$v]=[$g,$Q,[]]}},$o.findObject=function($v){if($v){var $g=$o.objectSet[$v];if($g)return $g[0]}return null},$o.keepObject=function($v,$g){if($v&&$g){var $Q=$o.objectSet[$g];$Q&&-1===$Q[2].indexOf($v)&&$Q[2].push($v)}},$o.clearObject=function($v,$g){if($v&&$g){var $Q=$o.objectSet[$g];if($Q){var $d=$Q[2],$r=$d.indexOf($v);if(-1!==$r){var $k=$d.length-1;0==$k?(delete $o.objectSet[$g],$Q[1]&&$Q[1].call(null,$Q[0])):($d[$r]=$d[$k],$d.length=$k)}}}},$o.TEXT="text",$o.JSON="json",$o.XML="xml",$o.BUFFER="arraybuffer",$o.IMAGE="image",$o.SOUND="sound",$o.ATLAS="atlas",$o.FONT="font",$o.TTF="ttf",$o.PLF="plf",$o.PKM="pkm",$o.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$o.parserMap={},$o.groupMap={},$o.maxTimeOut=100,$o.loadedMap={},$o.preLoadedMap={},$o.atlasMap={},$o._loaders=[],$o._isWorking=!1,$o._startIndex=0,$o.imgCache={},$o.cacheSet={},$o.objectSet={},$o.imgMgrSet={},$o}(),$av=function($v){var $J;function $p(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$p.__super.call(this);for(var $v=0;$v<this._maxPriority;$v++)this._resInfos[$v]=[]}$t($p,"laya.net.LoaderManager",$M);var $g=$p.prototype;return $g.create=function($v,$Q,$g,$d,$r,$k,$$,$b){if(null==$k&&($k=2),null==$$&&($$=!0),$v instanceof Array){var $a=$v,$M=$a.length,$Y=0;if($g)var $D=$G.create($g.caller,$g.method,$g.args,!1);for(var $J=0;$J<$M;$J++){var $p=$a[$J];"string"==typeof $p&&($p=$a[$J]={url:$p}),$p.progress=0}for($J=0;$J<$M;$J++){$p=$a[$J];var $T=$g?$G.create(null,$C,[$p],!1):null,$t=$g||$Q?$G.create(null,$q,[$p]):null;this._create($p.url,$t,$T,$p.clas||$d,$p.params||$r,null!=$p.priority&&0<=$p.priority?$p.priority:$k,$$,$p.group||$b)}function $q($v,$g){$Y++,$v.progress=1,$Y===$M&&$Q&&$Q.run()}function $C($v,$g){$v.progress=$g;for(var $Q=0,$d=0;$d<$M;$d++){$Q+=$a[$d].progress}var $r=$Q/$M;$D.runWith($r)}return!0}return this._create($v,$Q,$g,$d,$r,$k,$$,$b)},$g._create=function($g,$Q,$v,$d,$r,$k,$$,$b){$g&&""!=$g||console.error("加载的url不合法 "+$g),null==$k&&($k=2),null==$$&&($$=!0);var $a=$N.formatURL($g),$M=this.getRes($a);if($M)!$M.hasOwnProperty("loaded")||$M.loaded?($v&&$v.runWith(1),$Q&&$Q.run()):$Q&&$W.loader._createListener($g,$Q.caller,$Q.method,$Q.args,!0,!1);else{var $Y=$S.getFileExtension($g),$D=$p.createMap[$Y];if(!$D)throw new Error("LoaderManager:unknown file("+$g+") extension with: "+$Y+".");$d||($d=$D[0]);var $J=$D[1];if("atlas"==$Y)this.load($g,$Q,$v,$J,$k,$$);else{$d===$Yv&&($J="htmlimage"),($M=$d?new $d:null).hasOwnProperty("_loaded")&&($M._loaded=!1),$M._setUrl($g),$b&&$M._setGroup($b),this._createLoad($M,$g,$G.create(null,function($v){$M&&!$M.destroyed&&$v&&$M.onAsynLoaded.call($M,$g,$v,$r),$Q&&$Q.run();$W.loader.event($g)}),$v,$J,$k,!1,$b,!0),$$&&this.cacheRes($a,$M)}}return $M},$g.load=function($v,$g,$Q,$d,$r,$k,$$,$b){$v&&""!=$v||console.error("加载的url不合法 "+$v);var $a=this;if(null==$r&&($r=2),null==$k&&($k=!0),void 0===$b&&($b=!1),$v instanceof Array)return this._loadAssets($v,$g,$Q,$d,$r,$k,$$);var $M=$bv.getRes($v);if(null!=$M)$W.timer.frameOnce(1,null,function(){$Q&&$Q.runWith(1),$g&&$g.runWith($M),$a._loaderCount||$a.event("complete")});else{var $Y=$p._resMap[$v];$Y?($g&&$Y._createListener("complete",$g.caller,$g.method,$g.args,!1,!1),$Q&&$Y._createListener("progress",$Q.caller,$Q.method,$Q.args,!1,!1)):(($Y=this._infoPool.length?this._infoPool.pop():new $J).url=$v,$Y.clas=null,$Y.type=$d,$Y.cache=$k,$Y.group=$$,$Y.ignoreCache=$b,$Y.priority=$r,$g&&$Y.on("complete",$g.caller,$g.method,$g.args),$Q&&$Y.on("progress",$Q.caller,$Q.method,$Q.args),$p._resMap[$v]=$Y,$r=$r<this._maxPriority?0<=$r?$r:0:this._maxPriority-1,this._resInfos[$r].push($Y),this._next())}return this},$g.cancel=function($v,$g,$Q){if($M=$p._resMap[$v]){$g&&$M.off("complete",$g.caller,$g.method,!1),$Q&&$M.off("progress",$Q.caller,$Q.method,!1);var $d=$M.getListener("complete"),$r=$M.getListener("progress");if(!($d&&$d.head||$r&&$r.head)){if($M.loader){var $k=$M.loader;$k.imageCancel($v),$k.offAll(),$k._data=null,$k._customParse=!1,$k._url=null,$k._class=null,$k._type=null,this._loaders.push($k),this._loaderCount--,delete this._loaderMap[$M.url]}for(var $$=0;$$<this._maxPriority;$$++)for(var $b=this._resInfos[$$],$a=$b.length-1;-1<$a;$a--){var $M;($M=$b[$a])&&$M.url===$v&&($b[$a]=null,$M.destroy(),$M.offAll(),this._infoPool.push($M))}delete $p._resMap[$v],this._next()}}},$g._createLoad=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){var $M=this;if(null==$k&&($k=2),null==$$&&($$=!0),void 0===$a&&($a=!1),$g instanceof Array)return this._loadAssets($g,$Q,$d,$r,$k,$$,$b);var $Y=$bv.getRes($g);if(null!=$Y)$W.timer.frameOnce(1,null,function(){$d&&$d.runWith(1),$Q&&$Q.runWith($Y),$M._loaderCount||$M.event("complete")});else{var $D=$p._resMap[$g];$D?($Q&&$D._createListener("complete",$Q.caller,$Q.method,$Q.args,!1,!1),$d&&$D._createListener("progress",$d.caller,$d.method,$d.args,!1,!1)):(($D=this._infoPool.length?this._infoPool.pop():new $J).url=$g,$D.clas=$v,$D.type=$r,$D.cache=$$,$D.group=$b,$D.ignoreCache=$a,$D.priority=$k,$Q&&$D.on("complete",$Q.caller,$Q.method,$Q.args),$d&&$D.on("progress",$d.caller,$d.method,$d.args),$p._resMap[$g]=$D,$k=$k<this._maxPriority?0<=$k?$k:0:this._maxPriority-1,this._resInfos[$k].push($D),this._next())}return this},$g._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $v=0;$v<this._maxPriority;$v++)for(var $g=this._resInfos[$v];0<$g.length;){var $Q=$g.shift();if($Q)return this._doLoad($Q)}this._loaderCount||this.event("complete")}},$g._doLoad=function($g){var $Q=this._loaders.length?this._loaders.pop():new $bv;this._loaderCount++,(this._loaderMap[$g.url]=$Q).on("complete",null,$r),$Q.on("progress",null,function($v){$g.event("progress",$v)}),$Q.on("error",null,function($v){$r(null)}),$g.loader=$Q;var $d=this;function $r($v){$Q.offAll(),$Q._data=null,$Q._customParse=!1,$Q._url=null,$Q._class=null,$Q._type=null,$d._loaders.push($Q),$d._loaderCount--,delete $d._loaderMap[$g.url],$d._endLoad($g,$v instanceof Array?[$v]:$v),$d._next()}$Q._class=$g.clas,1<=$g.priority?($Q.priority=$g.priority,$Q.realTime=!1):($Q.priority=0,$Q.realTime=!0),$Q.load($g.url,$g.type,$g.cache,$g.group,$g.ignoreCache)},$g._endLoad=function($v,$g){var $Q=$v.url;if(null==$g){var $d=this._failRes[$Q]||0;if($d<this.retryNum)return console.warn("[warn]Retry to load:",$Q),this._failRes[$Q]=$d+1,void $W.timer.once(this.retryDelay,this,this._addReTry,[$v],!1);console.warn("[error]Failed to load:",$Q),this.event("error",$Q)}this._failRes[$Q]&&(this._failRes[$Q]=0),delete $p._resMap[$Q],$v.event("complete",$g),$v.destroy(),$v.offAll(),this._infoPool.push($v)},$g._addReTry=function($v){this._resInfos[this._maxPriority-1].push($v),this._next()},$g.clearRes=function($v,$g){void 0===$g&&($g=!1),$bv.clearRes($v,$g)},$g.getRes=function($v){return $bv.getRes($v)},$g.cacheRes=function($v,$g){$bv.cacheRes($v,$g)},$g.clearTextureRes=function($v){$bv.clearTextureRes($v)},$g.setGroup=function($v,$g){$bv.setGroup($v,$g)},$g.clearResByGroup=function($v){$bv.clearResByGroup($v)},$g.clearUnLoaded=function(){for(var $v=0;$v<this._maxPriority;$v++){for(var $g=this._resInfos[$v],$Q=$g.length-1;-1<$Q;$Q--){var $d=$g[$Q];$d&&($d.destroy(),$d.offAll(),this._infoPool.push($d))}$g.length=0}this._loaderCount=0,$p._resMap={}},$g.cancelLoadByUrls=function($v){if($v)for(var $g=0,$Q=$v.length;$g<$Q;$g++)this.cancelLoadByUrl($v[$g])},$g.cancelLoadByUrl=function($v){for(var $g=0;$g<this._maxPriority;$g++)for(var $Q=this._resInfos[$g],$d=$Q.length-1;-1<$d;$d--){var $r=$Q[$d];$r&&$r.url===$v&&($Q[$d]=null,$r.destroy(),$r.offAll(),this._infoPool.push($r))}$p._resMap[$v]&&delete $p._resMap[$v]},$g._loadAssets=function($v,$Q,$$,$g,$d,$r,$k){null==$d&&($d=2),null==$r&&($r=!0);for(var $b=$v.length,$a=0,$M=0,$Y=[],$D=!0,$J=0;$J<$b;$J++){var $p=$v[$J];if(!$p)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$v);"string"==typeof $p&&($p={url:$p,type:$g,size:1,priority:$d}),$p.size||($p.size=1),$p.progress=0,$M+=$p.size,$Y.push($p);var $T=$$?$G.create(null,$C,[$p],!1):null,$t=$Q||$$?$G.create(null,$q,[$p]):null;this.load($p.url,$t,$T,$p.type,null!=$p.priority&&0<=$p.priority?$p.priority:2,$r,$p.group||$k)}function $q($v,$g){$a++,$v.progress=1,$g||($D=!1),$a===$b&&$Q&&$Q.runWith($D)}function $C($v,$g){if(null!=$$){$v.progress=$g;for(var $Q=0,$d=0;$d<$Y.length;$d++){var $r=$Y[$d];$Q+=$r.size*$r.progress}var $k=$Q/$M;$$.runWith($k)}}return this},$p.cacheRes=function($v,$g){$bv.cacheRes($v,$g)},$p._resMap={},$a($p,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$p.__init$=function(){$J=function($v){function $g(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$g.__super.call(this)}return $t($g,"",$M),$g.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$g}()},$p}(),$Mv=(function($v){function $r($v){$r.__super.call(this),$v||($v=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $g=0,$Q=0,$d=0;$d<20;$d++)$d%5!=4?this._mat[$g++]=$v[$d]:this._alpha[$Q++]=$v[$d];this._action=$Z.createFilterAction(32),this._action.data=this}$t($r,"laya.filters.ColorFilter",$C);var $g=$r.prototype;$W.imps($g,{"laya.filters.IFilter":!0}),$g.callNative=function($v){$v._$P.cf=this;$v.conchModel&&$v.conchModel.setFilterMatrix&&$v.conchModel.setFilterMatrix(this._mat,this._alpha)},$Y(0,$g,"type",function(){return 32}),$Y(0,$g,"action",function(){return this._action})}(),function($v){function $d($v,$g,$Q){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$g&&($g=0),$d.__super.call(this),this._byteClass=$Q||$B,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$v&&0<$g&&$g<65535&&this.connect($v,$g)}$t($d,"laya.net.Socket",$M);var $g=$d.prototype;$g.connect=function($v,$g){var $Q="ws://"+$v+":"+$g;$Q="https:"==$c.window.location.protocol?"wss://"+$v+":"+$g:"ws://"+$v+":"+$g,this.connectByUrl($Q)},$g.connectByUrl=function($v){var $g=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $c.window.WebSocket($v,this.protocols):this._socket=new $c.window.WebSocket($v),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($v){$g._onOpen($v)},this._socket.onmessage=function($v){$g._onMessage($v)},this._socket.onclose=function($v){$g._onClose($v)},this._socket.onerror=function($v){$g._onError($v)}},$g.cleanSocket=function(){try{this._socket.close()}catch($v){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$g.close=function(){if(null!=this._socket)try{this._socket.close()}catch($v){}},$g._onOpen=function($v){this._connected=!0,this.event("open",$v)},$g._onMessage=function($v){if($v&&$v.data){var $g=$v.data;if(this.disableInput&&$g)this.event("message",$g);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $Q=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$g&&("string"==typeof $g?this._input.writeUTFBytes($g):this._input.writeArrayBuffer($g),this._addInputPosition=this._input.pos,this._input.pos=$Q),this.event("message",$g)}}},$g._onClose=function($v){this._connected=!1,this.event("close",$v)},$g._onError=function($v){this.event("error",$v)},$g.send=function($v){this._socket.send($v)},$g.flush=function(){if(this._output&&0<this._output.length){var $g;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($v){$g=$v}this._output.endian=this.endian,this._output.clear(),$g&&this.event("error",$g)}},$Y(0,$g,"input",function(){return this._input}),$Y(0,$g,"output",function(){return this._output}),$Y(0,$g,"connected",function(){return this._connected}),$Y(0,$g,"endian",function(){return this._endian},function($v){this._endian=$v,null!=this._input&&(this._input.endian=$v),null!=this._output&&(this._output.endian=$v)}),$d.LITTLE_ENDIAN="littleEndian",$d.BIG_ENDIAN="bigEndian"}(),function($v){function $b(){$b.__super.call(this),this._$1__id=++$b._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($b._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$K.currentResourceManager&&$K.currentResourceManager.addResource(this)}$t($b,"laya.resource.Resource",$M);var $g=$b.prototype;return $W.imps($g,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$g._setUrl=function($v){var $g;this._url!==$v&&(this._url&&(($g=$b._urlResourcesMap[this._url]).splice($g.indexOf(this),1),0===$g.length&&delete $b._urlResourcesMap[this._url]),$v&&(($g=$b._urlResourcesMap[$v])||($b._urlResourcesMap[$v]=$g=[]),$g.push(this)),this._url=$v)},$g._getGroup=function(){return this._group},$g._setGroup=function($v){var $g;this._group!==$v&&(this._group&&(($g=$b._groupResourcesMap[this._group]).splice($g.indexOf(this),1),0===$g.length&&delete $b._groupResourcesMap[this._group]),$v&&(($g=$b._groupResourcesMap[$v])||($b._groupResourcesMap[$v]=$g=[]),$g.push(this)),this._group=$v)},$g._addReference=function(){this._referenceCount++},$g._removeReference=function(){this._referenceCount--},$g._clearReference=function(){this._referenceCount=0},$g._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$g.recreateResource=function(){this.completeCreate()},$g.disposeResource=function(){},$g.activeResource=function($v){void 0===$v&&($v=!1),this._lastUseFrameCount=$z.loopCount,!this._destroyed&&this.__loaded&&(this._released||$v)&&this.recreateResource()},$g.releaseResource=function($v){return void 0===$v&&($v=!0),!(!$v&&this.lock)&&(!(this._released&&!$v)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$g.onAsynLoaded=function($v,$g,$Q){throw new Error("Resource: must override this function!")},$g.destroy=function(){var $v;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $b._idResourcesMap[this.id],this._url&&(($v=$b._urlResourcesMap[this._url])&&($v.splice($v.indexOf(this),1),0===$v.length&&delete $b._urlResourcesMap[this.url]),$bv.clearRes(this._url),this.__loaded||$Z.cancelLoadByUrl(this._url)),this._group&&(($v=$b._groupResourcesMap[this._group]).splice($v.indexOf(this),1),0===$v.length&&delete $b._groupResourcesMap[this.url]))},$g.completeCreate=function(){this._released=!1,this.event("recovered",this)},$g.dispose=function(){this.destroy()},$Y(0,$g,"memorySize",function(){return this._memorySize},function($v){var $g=$v-this._memorySize;this._memorySize=$v,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$g),this.resourceManager&&this.resourceManager.addSize($g)}),$Y(0,$g,"_loaded",null,function($v){this.__loaded=$v}),$Y(0,$g,"loaded",function(){return this.__loaded}),$Y(0,$g,"id",function(){return this._$1__id}),$Y(0,$g,"destroyed",function(){return this._destroyed}),$Y(0,$g,"group",function(){return this._getGroup()},function($v){this._setGroup($v)}),$Y(0,$g,"resourceManager",function(){return this._resourceManager}),$Y(0,$g,"url",function(){return this._url}),$Y(0,$g,"released",function(){return this._released}),$Y(0,$g,"referenceCount",function(){return this._referenceCount}),$b.getResourceByID=function($v){return $b._idResourcesMap[$v]},$b.getResourceByURL=function($v,$g){return void 0===$g&&($g=0),null==$b._urlResourcesMap[$v]?null:$b._urlResourcesMap[$v][$g]},$b.getResourceCountByURL=function($v){return $b._urlResourcesMap[$v].length},$b.destroyUnusedResources=function($v){var $g;if($v){var $Q=$b._groupResourcesMap[$v];if($Q)for(var $d=$Q.slice(),$r=0,$k=$d.length;$r<$k;$r++)($g=$d[$r]).lock||0!==$g._referenceCount||$g.destroy()}else for(var $$ in $b._idResourcesMap)($g=$b._idResourcesMap[$$]).lock||0!==$g._referenceCount||$g.destroy()},$b._uniqueIDCounter=0,$b._idResourcesMap={},$b._urlResourcesMap={},$b._groupResourcesMap={},$b}()),$Yv=function($v){function $o($v,$g){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$o.__super.call(this),$v&&null!=$v._addReference&&$v._addReference(),this.setTo($v,$g)}$t($o,"laya.resource.Texture",$M);var $g=$o.prototype;return $g._setUrl=function($v){this.url=$v},$g.setTo=function($v,$g){if($v instanceof $$.HTMLElement){var $Q=$sv.create("2D",$v);this.bitmap=$Q}else this.bitmap=$v;if(this.uv=$g||$o.DEF_UV,$v){this._w=$v.width,this._h=$v.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $d=this;if(this._loaded)$Z.addToAtlas&&$Z.addToAtlas($d);else{var $r=$v;$r instanceof laya.resource.HTMLImage&&$r.image&&$r.image.addEventListener("load",function($v){$Z.addToAtlas&&$Z.addToAtlas($d)},!1)}}},$g.active=function(){this.bitmap&&this.bitmap.activeResource()},$g.destroy=function($v){if(void 0===$v&&($v=!1),this.alphaTexture&&(this.alphaTexture.destroy($v),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $g=this.bitmap;$v?($i.isConchApp&&$g.source&&$g.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$g.dispose(),$g._clearReference()):($g._removeReference(),0==$g.referenceCount&&($i.isConchApp&&$g.source&&$g.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$g.dispose())),this.url&&this===$W.loader.getRes(this.url)&&$W.loader.clearRes(this.url,$v),this._loaded=!1}},$g.load=function($v){var $g=this;this._loaded=!1,$v=$N.customFormat($v);var $Q=this.bitmap||(this.bitmap=$Pv.create($v));$Q.uri=$v,$Q&&$Q._addReference();var $d=this;$Q.onload=function(){$Q.onload=null,$d._loaded=!0,$g.sourceWidth=$g._w=$Q.width,$g.sourceHeight=$g._h=$Q.height,$d.event("loaded",this),$Z.addToAtlas&&$Z.addToAtlas($d)}},$g.addTextureToAtlas=function($v){$Z.addTextureToAtlas(this)},$g.getPixels=function($v,$g,$Q,$d){if($i.isConchApp){var $r=this.bitmap;if($r.source&&$r.source.getImageData){var $k=$r.source.getImageData($v,$g,$Q,$d),$$=new Uint8Array($k);return Array.from($$)}return null}return $i.isWebGL?$Z.getTexturePixels(this,$v,$g,$Q,$d):($c.canvas.size($Q,$d),$c.canvas.clear(),$c.context.drawTexture(this,-$v,-$g,this.width,this.height,0,0),$c.context.getImageData(0,0,$Q,$d).data)},$g.onAsynLoaded=function($v,$g){if($g){if("function"!=typeof $g._addReference)throw new Error("bitmap._addReference is not a function. "+$g.className+" "+typeof $g._addReference+" "+$g.constructor);$g._addReference()}this.setTo($g,this.uv),this._loaded&&this.event("loaded",this)},$Y(0,$g,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$Y(0,$g,"loaded",function(){return this._loaded}),$Y(0,$g,"released",function(){return!this.bitmap||this.bitmap.released}),$Y(0,$g,"width",function(){return this._w?this._w:this.uv&&this.uv!==$o.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($v){this._w=$v,this.sourceWidth||(this.sourceWidth=$v)}),$Y(0,$g,"repeat",function(){return!$i.isWebGL||!this.bitmap||this.bitmap.repeat},function($v){$v&&$i.isWebGL&&this.bitmap&&(this.bitmap.repeat=$v)&&(this.bitmap.enableMerageInAtlas=!1)}),$Y(0,$g,"height",function(){return this._h?this._h:this.uv&&this.uv!==$o.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($v){this._h=$v,this.sourceHeight||(this.sourceHeight=$v)}),$Y(0,$g,"isLinearSampling",function(){return!$i.isWebGL||9728!=this.bitmap.minFifter},function($v){!$v&&$i.isWebGL&&($v||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$o.moveUV=function($v,$g,$Q){for(var $d=0;$d<8;$d+=2)$Q[$d]+=$v,$Q[$d+1]+=$g;return $Q},$o.create=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){void 0===$k&&($k=0),void 0===$$&&($$=0),void 0===$b&&($b=0),void 0===$a&&($a=0);var $M=$v instanceof laya.resource.Texture,$Y=$M?$v.uv:$o.DEF_UV,$D=$M?$v.bitmap:$v,$J=$Z.isAtlas($D);if($J){var $p=$D._atlaser,$T=$v._atlasID;if(-1==$T)throw new Error("create texture error");$D=$p._inAtlasTextureBitmapValue[$T],$Y=$p._inAtlasTextureOriUVValue[$T]}var $t=new $o($D,null);$D.width&&$g+$d>$D.width&&($d=$D.width-$g),$D.height&&$Q+$r>$D.height&&($r=$D.height-$Q),$t.width=$d,$t.height=$r,$t.offsetX=$k,$t.offsetY=$$,$t.sourceWidth=$b||$d,$t.sourceHeight=$a||$r;var $q=1/$D.width,$C=1/$D.height;$g*=$q,$Q*=$C,$d*=$q,$r*=$C;var $G=$t.uv[0],$s=$t.uv[1],$A=$t.uv[4],$h=$t.uv[5],$P=$A-$G,$W=$h-$s,$F=$o.moveUV($Y[0],$Y[1],[$g,$Q,$g+$d,$Q,$g+$d,$Q+$r,$g,$Q+$r]);$t.uv=[$G+$F[0]*$P,$s+$F[1]*$W,$A-(1-$F[2])*$P,$s+$F[3]*$W,$A-(1-$F[4])*$P,$h-(1-$F[5])*$W,$G+$F[6]*$P,$h-(1-$F[7])*$W],$J&&$t.addTextureToAtlas();var $l=$D.scaleRate;return $l&&1!=$l?($t.sourceWidth/=$l,$t.sourceHeight/=$l,$t.width/=$l,$t.height/=$l,$t.scaleRate=$l,$t.offsetX/=$l,$t.offsetY/=$l):$t.scaleRate=1,$t},$o.createFromTexture=function($v,$g,$Q,$d,$r){var $k=$v.scaleRate;1!=$k&&($g*=$k,$Q*=$k,$d*=$k,$r*=$k);var $$=$l.TEMP.setTo($g-$v.offsetX,$Q-$v.offsetY,$d,$r),$b=$$.intersection($o._rect1.setTo(0,0,$v.width,$v.height),$o._rect2);if(!$b)return null;var $a=$o.create($v,$b.x,$b.y,$b.width,$b.height,$b.x-$$.x,$b.y-$$.y,$d,$r);if($a.bitmap&&$a.bitmap._removeReference)return $a.bitmap._removeReference(),$a;var $M="bitmap:"+($a.bitmap?$a.bitmap.constructor?$a.bitmap.constructor.name:$a.bitmap.__className:"")+", url:"+($v.url+" | "+($a.bitmap?$a.bitmap.url:$v.url))+", x="+$g+",y="+$Q+",width="+$d+",height="+$r+", result="+($b?$b.x+","+$b.y+","+$b.width+","+$b.height:"null")+", rect="+$$.x+","+$$.y+","+$$.width+","+$$.height;throw new Error("报错：bitmap._removeReference is not a function  "+$M)},$o.DEF_UV=[0,0,1,0,1,1,0,1],$o.INV_UV=[0,1,1,1,1,0,0,0],$o._rect1=new $l,$o._rect2=new $l,$o}(),$v=function($v){var $b;function $k(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$k.__super.call(this)}$t($k,"laya.utils.TimeLine",$M);var $g=$k.prototype;return $g.to=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=0),this._create($v,$g,$Q,$d,$r,!0)},$g.from=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=0),this._create($v,$g,$Q,$d,$r,!1)},$g._create=function($v,$g,$Q,$d,$r,$k){var $$=$R.getItemByClass("tweenData",$b);return $$.isTo=$k,$$.type=0,$$.target=$v,$$.duration=$Q,$$.data=$g,$$.startTime=this._startTime+$r,$$.endTime=$$.startTime+$$.duration,$$.ease=$d,this._startTime=Math.max($$.endTime,this._startTime),this._tweenDataList.push($$),this._startTimeSort=!0,this._endTimeSort=!0,this},$g.addLabel=function($v,$g){var $Q=$R.getItemByClass("tweenData",$b);return $Q.type=1,$Q.data=$v,$Q.endTime=$Q.startTime=this._startTime+$g,this._labelDic||(this._labelDic={}),this._labelDic[$v]=$Q,this._tweenDataList.push($Q),this},$g.removeLabel=function($v){if(this._labelDic&&this._labelDic[$v]){var $g=this._labelDic[$v];if($g){var $Q=this._tweenDataList.indexOf($g);-1<$Q&&this._tweenDataList.splice($Q,1)}delete this._labelDic[$v]}},$g.gotoTime=function($v){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $g,$Q,$d,$r;for(var $k in this._firstTweenDic)if($Q=this._firstTweenDic[$k])for(var $$ in $Q)$Q.diyTarget.hasOwnProperty($$)&&($Q.diyTarget[$$]=$Q[$$]);for($k in this._tweenDic)($g=this._tweenDic[$k]).clear(),delete this._tweenDic[$k];if(this._index=0,this._gidIndex=0,this._currTime=$v,this._lastTime=$c.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$d=this._tweenDataList.concat(),$d.sort(function($v,$g){return $v.endTime>$g.endTime?1:$v.endTime<$g.endTime?-1:0})}else $d=this._endTweenDataList;for(var $b=0,$a=$d.length;$b<$a;$b++)if(0==($r=$d[$b]).type){if(!($v>=$r.endTime))break;this._index=Math.max(this._index,$b+1);var $M=$r.data;if($r.isTo)for(var $Y in $M)$r.target[$Y]=$M[$Y]}for($b=0,$a=this._tweenDataList.length;$b<$a;$b++)0==($r=this._tweenDataList[$b]).type&&$v>=$r.startTime&&$v<$r.endTime&&(this._index=Math.max(this._index,$b+1),this._gidIndex++,($g=$R.getItemByClass("tween",$I))._create($r.target,$r.data,$r.duration,$r.ease,$G.create(this,this._animComplete,[this._gidIndex]),0,!1,$r.isTo,!0,!1),$g.setStartTime(this._currTime-($v-$r.startTime)),$g._updateEase(this._currTime),$g.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$g)}},$g.gotoLabel=function($v){if(null!=this._labelDic){var $g=this._labelDic[$v];$g&&this.gotoTime($g.startTime)}},$g.pause=function(){$W.timer.clear(this,this._update)},$g.resume=function(){this.play(this._currTime,this._loopKey)},$g.play=function($v,$g){if(void 0===$v&&($v=0),void 0===$g&&($g=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($v,$g){return $v.startTime>$g.startTime?1:$v.startTime<$g.startTime?-1:0});for(var $Q=0,$d=this._tweenDataList.length;$Q<$d;$Q++){var $r=this._tweenDataList[$Q];if(null!=$r&&0==$r.type){var $k=$r.target,$$=$k.$_GID||($k.$_GID=$S.getGID()),$b=null;for(var $a in null==this._firstTweenDic[$$]?(($b={}).diyTarget=$k,this._firstTweenDic[$$]=$b):$b=this._firstTweenDic[$$],$r.data)null==$b[$a]&&($b[$a]=$k[$a])}}}"string"==typeof $v?this.gotoLabel($v):this.gotoTime($v),this._loopKey=$g,this._lastTime=$c.now(),$W.timer.frameLoop(1,this,this._update)}},$g._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $v in this._tweenDic)($g=this._tweenDic[$v]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $g,$Q=$c.now(),$d=$Q-this._lastTime,$r=this._currTime+=$d*this.scale;for($v in this._lastTime=$Q,this._tweenDic)($g=this._tweenDic[$v])._updateEase($r);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $k=this._tweenDataList[this._index];$r>=$k.startTime&&(this._index++,0==$k.type?(this._gidIndex++,($g=$R.getItemByClass("tween",$I))._create($k.target,$k.data,$k.duration,$k.ease,$G.create(this,this._animComplete,[this._gidIndex]),0,!1,$k.isTo,!0,!1),$g.setStartTime($r),$g.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$g)._updateEase($r)):this.event("label",$k.data))}},$g._animComplete=function($v){this._tweenDic[$v]&&delete this._tweenDic[$v]},$g._complete=function(){this.event("complete")},$g.reset=function(){var $v;if(this._labelDic)for($v in this._labelDic)delete this._labelDic[$v];for($v in this._tweenDic)this._tweenDic[$v].clear(),delete this._tweenDic[$v];for($v in this._firstTweenDic)delete this._firstTweenDic[$v];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $g,$Q=0;for($g=this._tweenDataList.length,$Q=0;$Q<$g;$Q++)this._tweenDataList[$Q]&&this._tweenDataList[$Q].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$W.timer.clear(this,this._update)},$g.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$Y(0,$g,"index",function(){return this._frameIndex},function($v){this._frameIndex=$v,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$Y(0,$g,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$k.to=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=0),(new $k).to($v,$g,$Q,$d,$r)},$k.from=function($v,$g,$Q,$d,$r){return void 0===$r&&($r=0),(new $k).from($v,$g,$Q,$d,$r)},$k.__init$=function(){$b=function(){function $v(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $t($v,""),$v.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$R.recover("tweenData",this)},$v}()},$k}(),$Dv=function($r){function $Q(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$Q.__super.call(this),this._style=$b.EMPTY}$t($Q,"laya.display.Sprite",$r);var $v=$Q.prototype;return $W.imps($v,{"laya.display.ILayout":!0}),$v.createConchModel=function(){return new ConchNode},$v.destroy=function($v){if(void 0===$v&&($v=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $g=this.mask;$g&&(this.mask=null,$g.destroy($v))}$r.prototype.destroy.call(this,$v),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$v.updateZOrder=function(){$S.updateOrder(this._childs)&&this.repaint()},$v.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$v.setBounds=function($v){this._set$P("uBounds",$v)},$v.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $l),$l._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$v.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $l),$l._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$v._boundPointsToParent=function($v){void 0===$v&&($v=!1);var $g=0,$Q=0;this._style&&($g=this._style._tf.translateX,$Q=this._style._tf.translateY,$v=$v||0!==this._style._tf.rotate,this._style.scrollRect&&($g+=this._style.scrollRect.x,$Q+=this._style.scrollRect.y));var $d=this._getBoundPointsM($v);if(!$d||$d.length<1)return $d;if(8!=$d.length&&($d=$v?$h.scanPList($d):$l._getWrapRec($d,$l.TEMP)._getBoundPoints()),!this.transform)return $S.transPointList($d,this._x-$g,this._y-$Q),$d;var $r=$F.TEMP,$k=0,$$=$d.length;for($k=0;$k<$$;$k+=2)$r.x=$d[$k],$r.y=$d[$k+1],this.toParentPoint($r),$d[$k]=$r.x,$d[$k+1]=$r.y;return $d},$v.getGraphicBounds=function($v){return void 0===$v&&($v=!1),this._graphics?this._graphics.getBounds($v):$l.TEMP.setTo(0,0,0,0)},$v._getBoundPointsM=function($v){if(void 0===$v&&($v=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $g=$S.clearArray(this._$P.temBM),$Q=$l.TEMP;return $Q.copyFrom(this.scrollRect),$S.concatArray($g,$Q._getBoundPoints()),$g}for(var $d,$r,$k,$$=this._graphics?this._graphics.getBoundPoints():$S.clearArray(this._$P.temBM),$b=0,$a=($k=this._childs).length;$b<$a;$b++)($d=$k[$b])instanceof laya.display.Sprite&&1==$d.visible&&($r=$d._boundPointsToParent($v))&&($$=$$?$S.concatArray($$,$r):$r);return $$},$v.getStyle=function(){return this._style===$b.EMPTY&&(this._style=new $b),this._style},$v.setStyle=function($v){this._style=$v},$v._adjustTransform=function(){this._tfChanged=!1;var $v,$g=this._style._tf,$Q=$g.scaleX,$d=$g.scaleY;if($g.rotate||1!==$Q||1!==$d||$g.skewX||$g.skewY){($v=this._transform||(this._transform=$f.create())).bTransform=!0;var $r=.0174532922222222*($g.rotate-$g.skewX),$k=.0174532922222222*($g.rotate+$g.skewY),$$=Math.cos($k),$b=Math.sin($k),$a=Math.sin($r),$M=Math.cos($r);return $v.a=$Q*$$,$v.b=$Q*$b,$v.c=-$d*$a,$v.d=$d*$M,$v.tx=$v.ty=0,$v}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$v},$v.pos=function($v,$g,$Q){if(void 0===$Q&&($Q=!1),this._x!==$v||this._y!==$g){if(this.destroyed)return this;if($Q){this._x=$v,this._y=$g,this.conchModel&&this.conchModel.pos(this._x,this._y);var $d=this._parent;$d&&0===$d._repaint&&($d._repaint=1,$d.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$v,this.y=$g}return this},$v.pivot=function($v,$g){return this.pivotX=$v,this.pivotY=$g,this},$v.size=function($v,$g){return this.width=$v,this.height=$g,this},$v.scale=function($v,$g,$Q){void 0===$Q&&($Q=!1);var $d=this.getStyle(),$r=$d._tf;if($r.scaleX!=$v||$r.scaleY!=$g){if(this.destroyed)return this;if($Q){$d.setScale($v,$g),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($v,$g),this._renderType|=4;var $k=this._parent;$k&&0===$k._repaint&&($k._repaint=1,$k.parentRepaint())}else this.scaleX=$v,this.scaleY=$g}return this},$v.skew=function($v,$g){return this.skewX=$v,this.skewY=$g,this},$v.render=function($v,$g,$Q){$z.spriteCount++,$w.renders[this._renderType]._fun(this,$v,$g+this._x,$Q+this._y),this._repaint=0},$v.drawToCanvas=function($v,$g,$Q,$d){if($i.isConchNode){var $r=$sv.create("2D");return new $x($v,$g,$r).ctx.setCanvasType(1),this.conchModel.drawToCanvas($r.source,$Q,$d),$r}return $Z.drawToCanvas(this,this._renderType,$v,$g,$Q,$d)},$v.customRender=function($v,$g,$Q){this._renderType|=1024},$v._applyFilters=function(){var $v;if(!$i.isWebGL&&(($v=this._$P.filters)&&!($v.length<1)))for(var $g=0,$Q=$v.length;$g<$Q;$g++)$v[$g].action.apply(this._$P.cacheCanvas)},$v._isHaveGlowFilter=function(){var $v,$g=0;if(this.filters)for($g=0;$g<this.filters.length;$g++)if(8==this.filters[$g].type)return!0;for($g=0,$v=this._childs.length;$g<$v;$g++)if(this._childs[$g]._isHaveGlowFilter())return!0;return!1},$v.localToGlobal=function($v,$g){void 0===$g&&($g=!1),!0===$g&&($v=new $F($v.x,$v.y));for(var $Q=this;$Q&&$Q!=$W.stage;)$v=$Q.toParentPoint($v),$Q=$Q.parent;return $v},$v.globalToLocal=function($v,$g){void 0===$g&&($g=!1),$g&&($v=new $F($v.x,$v.y));for(var $Q=this,$d=[];$Q&&$Q!=$W.stage;)$d.push($Q),$Q=$Q.parent;for(var $r=$d.length-1;0<=$r;)$v=($Q=$d[$r]).fromParentPoint($v),$r--;return $v},$v.toParentPoint=function($v){if(!$v)return $v;$v.x-=this.pivotX,$v.y-=this.pivotY,this.transform&&this._transform.transformPoint($v),$v.x+=this._x,$v.y+=this._y;var $g=this._style.scrollRect;return $g&&($v.x-=$g.x,$v.y-=$g.y),$v},$v.fromParentPoint=function($v){if(!$v)return $v;$v.x-=this._x,$v.y-=this._y;var $g=this._style.scrollRect;return $g&&($v.x+=$g.x,$v.y+=$g.y),this.transform&&this._transform.invertTransformPoint($v),$v.x+=this.pivotX,$v.y+=this.pivotY,$v},$v.on=function($v,$g,$Q,$d){return 1!==this._mouseEnableState&&this.isMouseEvent($v)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($v,$g,$Q,$d,!1)):$r.prototype.on.call(this,$v,$g,$Q,$d)},$v.once=function($v,$g,$Q,$d){return 1!==this._mouseEnableState&&this.isMouseEvent($v)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($v,$g,$Q,$d,!0)):$r.prototype.once.call(this,$v,$g,$Q,$d)},$v._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $v=this;for($v=$v.parent;$v&&1!==$v._mouseEnableState&&!$v._getBit(2);)$v.mouseEnabled=!0,$v._setBit(2,!0),$v=$v.parent}},$v.loadImage=function($v,$g,$Q,$d,$r,$k){var $$=this;return void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0),void 0===$r&&($r=0),this.graphics.loadImage($v,$g,$Q,$d,$r,function($v){$$.destroyed||($$.size($g+($d||$v.width),$Q+($r||$v.height)),$$.repaint(),$k&&$k.runWith($v))}),this},$v.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$v._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$v._childChanged=function($v){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$v&&this._get$P("hasZorder")&&$W.timer.callLater(this,this.updateZOrder),this.repaint()},$v.parentRepaint=function(){var $v=this._parent;$v&&0===$v._repaint&&($v._repaint=1,$v.parentRepaint())},$v.startDrag=function($v,$g,$Q,$d,$r,$k,$$){void 0===$g&&($g=!1),void 0===$Q&&($Q=0),void 0===$d&&($d=300),void 0===$k&&($k=!1),void 0===$$&&($$=.92),this._$P.dragging||this._set$P("dragging",new $n),this._$P.dragging.start(this,$v,$g,$Q,$d,$r,$k,$$)},$v.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$v._releaseMem=function(){if(this._$P){var $v=this._$P.cacheCanvas;$v&&$v.ctx&&($R.recover("RenderContext",$v.ctx),$v.ctx.canvas.size(0,0),$v.ctx=null);var $g=this._$P._filterCache;$g&&($g.destroy(),$g.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$v._setDisplay=function($v){$v||this._releaseMem(),$r.prototype._setDisplay.call(this,$v)},$v.hitTestPoint=function($v,$g){var $Q=this.globalToLocal($F.TEMP.setTo($v,$g));return $v=$Q.x,$g=$Q.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$l.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($v,$g)},$v.getMousePoint=function(){return this.globalToLocal($F.TEMP.setTo($W.stage.mouseX,$W.stage.mouseY))},$v._getWords=function(){return null},$v._addChildsToLayout=function($v){var $g=this._getWords();if(null==$g&&0==this._childs.length)return!1;if($g)for(var $Q=0,$d=$g.length;$Q<$d;$Q++)$v.push($g[$Q]);$Q=0;for(var $r=this._childs.length;$Q<$r;++$Q){var $k=this._childs[$Q];$k._style._enableLayout()&&$k._addToLayout($v)}return!0},$v._addToLayout=function($v){this._style.absolute||(this._style.block?$v.push(this):this._addChildsToLayout($v)&&(this.x=this.y=0))},$v._isChar=function(){return!1},$v._getCSSStyle=function(){return this._style.getCSSStyle()},$v._setAttributes=function($v,$g){switch($v){case"x":this.x=parseFloat($g);break;case"y":this.y=parseFloat($g);break;case"width":this.width=parseFloat($g);break;case"height":this.height=parseFloat($g);break;default:this[$v]=$g}},$v._layoutLater=function(){this.parent&&this.parent._layoutLater()},$Y(0,$v,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($v){this._optimizeScrollRect!=$v&&(this._optimizeScrollRect=$v,this.conchModel&&this.conchModel.optimizeScrollRect($v))}),$Y(0,$v,"customRenderEnable",null,function($v){if($v&&(this._renderType|=1024,$i.isConchNode)){$Q.CustomList.push(this);var $g=new $sv("2d");$g._setContext(new CanvasRenderingContext2D),this.customContext=new $x(0,0,$g),$g.context.setCanvasType&&$g.context.setCanvasType(2),this.conchModel.custom($g.context)}}),$Y(0,$v,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($v){this.cacheAs=$v?this._$P.hasFilter?"none":"normal":"none"}),$Y(0,$v,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($v){var $g=this._$P.cacheCanvas;if($v!==($g?$g.type:"none")){if("none"!==$v)this._getBit(1)||this._setUpNoticeType(1),$g||($g=this._set$P("cacheCanvas",$R.getItemByClass("cacheCanvas",Object))),$g.type=$v,$g.reCache=!0,this._renderType|=16,"bitmap"==$v&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($g){var $Q=$g;$Q&&$Q.ctx&&($R.recover("RenderContext",$Q.ctx),$Q.ctx.canvas.size(0,0),$Q.ctx=null),$R.recover("cacheCanvas",$g)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$Y(0,$v,"zOrder",function(){return this._zOrder},function($v){this._zOrder!=$v&&(this._zOrder=$v,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($v),this._parent&&($v&&this._parent._set$P("hasZorder",!0),$W.timer.callLater(this._parent,this.updateZOrder)))}),$Y(0,$v,"rotation",function(){return this._style._tf.rotate},function($v){var $g=this.getStyle();if($g._tf.rotate!==$v){$g.setRotate($v),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($v),this._renderType|=4;var $Q=this._parent;$Q&&0===$Q._repaint&&($Q._repaint=1,$Q.parentRepaint())}}),$Y(0,$v,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($v){this._width!==$v&&(this._width=$v,this.conchModel&&this.conchModel.size($v,this._height),this.repaint())}),$Y(0,$v,"x",function(){return this._x},function($v){if(this._x!==$v){if(this.destroyed)return;this._x=$v,this.conchModel&&this.conchModel.pos($v,this._y);var $g=this._parent;$g&&0===$g._repaint&&($g._repaint=1,$g.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$Y(0,$v,"globalScaleY",function(){for(var $v=1,$g=this;$g&&$g!==$W.stage;)$v*=$g.scaleY,$g=$g.parent;return $v}),$Y(0,$v,"hitArea",function(){return this._$P.hitArea},function($v){this._set$P("hitArea",$v)}),$Y(0,$v,"staticCache",function(){return this._$P.staticCache},function($v){this._set$P("staticCache",$v),$v||this.reCache()}),$Y(0,$v,"texture",function(){return this._texture},function($v){this._texture!=$v&&(this._texture=$v,this.graphics.cleanByTexture($v,0,0))}),$Y(0,$v,"y",function(){return this._y},function($v){if(this._y!==$v){if(this.destroyed)return;this._y=$v,this.conchModel&&this.conchModel.pos(this._x,$v);var $g=this._parent;$g&&0===$g._repaint&&($g._repaint=1,$g.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$Y(0,$v,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($v){this._height!==$v&&(this._height=$v,this.conchModel&&this.conchModel.size(this._width,$v),this.repaint())}),$Y(0,$v,"blendMode",function(){return this._style.blendMode},function($v){this.getStyle().blendMode=$v,this.conchModel&&this.conchModel.blendMode($v),$v&&"source-over"!=$v?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$Y(0,$v,"scaleX",function(){return this._style._tf.scaleX},function($v){var $g=this.getStyle();if($g._tf.scaleX!==$v){$g.setScaleX($v),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($v,$g._tf.scaleY),this._renderType|=4;var $Q=this._parent;$Q&&0===$Q._repaint&&($Q._repaint=1,$Q.parentRepaint())}}),$Y(0,$v,"scaleY",function(){return this._style._tf.scaleY},function($v){var $g=this.getStyle();if($g._tf.scaleY!==$v){$g.setScaleY($v),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($g._tf.scaleX,$v),this._renderType|=4;var $Q=this._parent;$Q&&0===$Q._repaint&&($Q._repaint=1,$Q.parentRepaint())}}),$Y(0,$v,"stage",function(){return $W.stage}),$Y(0,$v,"skewX",function(){return this._style._tf.skewX},function($v){var $g=this.getStyle();if($g._tf.skewX!==$v){$g.setSkewX($v),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($v,$g._tf.skewY),this._renderType|=4;var $Q=this._parent;$Q&&0===$Q._repaint&&($Q._repaint=1,$Q.parentRepaint())}}),$Y(0,$v,"scrollRect",function(){return this._style.scrollRect},function($v){this.getStyle().scrollRect=$v,this.repaint(),$v?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($v.x,$v.y,$v.width,$v.height)):(this._renderType&=-129,this.conchModel&&($Q.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$Y(0,$v,"skewY",function(){return this._style._tf.skewY},function($v){var $g=this.getStyle();if($g._tf.skewY!==$v){$g.setSkewY($v),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($g._tf.skewX,$v),this._renderType|=4;var $Q=this._parent;$Q&&0===$Q._repaint&&($Q._repaint=1,$Q.parentRepaint())}}),$Y(0,$v,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($v){this._tfChanged=!1,(this._transform=$v)&&(this._x=$v.tx,this._y=$v.ty,$v.tx=$v.ty=0,this.conchModel&&this.conchModel.transform($v.a,$v.b,$v.c,$v.d,this._x,this._y)),$v?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$Y(0,$v,"pivotX",function(){return this._style._tf.translateX},function($v){this.getStyle().setTranslateX($v),this.conchModel&&this.conchModel.pivot($v,this._style._tf.translateY),this.repaint()}),$Y(0,$v,"pivotY",function(){return this._style._tf.translateY},function($v){this.getStyle().setTranslateY($v),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$v),this.repaint()}),$Y(0,$v,"alpha",function(){return this._style.alpha},function($v){this._style&&this._style.alpha!==$v&&($v=$v<0?0:1<$v?1:$v,this.getStyle().alpha=$v,this.conchModel&&this.conchModel.alpha($v),1!==$v?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$Y(0,$v,"visible",function(){return this._style.visible},function($v){this._style&&this._style.visible!==$v&&(this.getStyle().visible=$v,this.conchModel&&this.conchModel.visible($v),this.parentRepaint())}),$Y(0,$v,"graphics",function(){return this._graphics||(this.graphics=$Z.createGraphics())},function($v){this._graphics&&(this._graphics._sp=null),(this._graphics=$v)?(this._renderType&=-2,this._renderType|=512,($v._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($Q.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$Y(0,$v,"filters",function(){return this._$P.filters},function($v){$v&&0===$v.length&&($v=null),this._$P.filters!=$v&&(this._set$P("filters",$v?$v.slice():null),$i.isConchApp&&(this.conchModel&&($Q.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$i.isWebGL&&($v&&$v.length?this._renderType|=32:this._renderType&=-33),$v&&0<$v.length?(this._getBit(1)||this._setUpNoticeType(1),$i.isWebGL&&1==$v.length&&$v[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($i.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$Y(0,$v,"parent",$r.prototype._$get_parent,function($v){$W.superSet($vv,this,"parent",$v),$v&&this._getBit(2)&&this._$2__onDisplay()}),$Y(0,$v,"mask",function(){return this._$P._mask},function($v){$v&&this.mask&&this.mask._$P.maskParent||($v?(this.cacheAs="bitmap",this._set$P("_mask",$v),$v._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$v),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($v?$v.conchModel:null),this._renderType|=64,this.parentRepaint())}),$Y(0,$v,"mouseEnabled",function(){return 1<this._mouseEnableState},function($v){this._mouseEnableState=$v?2:1}),$Y(0,$v,"globalScaleX",function(){for(var $v=1,$g=this;$g&&$g!==$W.stage;)$v*=$g.scaleX,$g=$g.parent;return $v}),$Y(0,$v,"mouseX",function(){return this.getMousePoint().x}),$Y(0,$v,"mouseY",function(){return this.getMousePoint().y}),$Q.fromImage=function($v){return(new $Q).loadImage($v)},$Q._cachePool=[],$Q.CustomList=[],$a($Q,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$$.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$Q}($vv),$Jv=function($v){function $g($v){this._audio=null,this._onEnd=null,this._resumePlay=null,$g.__super.call(this),this._onEnd=$S.bind(this.__onEnd,this),this._resumePlay=$S.bind(this.__resumePlay,this),$v.addEventListener("ended",this._onEnd),this._audio=$v}$t($g,"laya.media.h5audio.AudioSoundChannel",$dv);var $Q=$g.prototype;return $Q.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($W.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$Q.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$c.container.appendChild(this._audio),this._audio.play()}catch($v){this.event("error")}},$Q.play=function($v){this.isStopped=!1;try{this._audio.playbackRate=$V.playbackRate,this._audio.currentTime=this.startTime}catch($v){return void this._audio.addEventListener("canplay",this._resumePlay)}$V.addChannel(this),$c.container.appendChild(this._audio),!$v&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$Q.stop=function(){this.isStopped=!0,$V.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$i.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$c.onIE||this._audio!=$Qv._musicAudio&&$R.recover("audio:"+this.url,this._audio),$c.removeElement(this._audio),this._audio=null)},$Q.pause=function(){this.isStopped=!0,$V.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$Q.resume=function(){this._audio&&(this.isStopped=!1,$V.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$Y(0,$Q,"position",function(){return this._audio?this._audio.currentTime:0}),$Y(0,$Q,"duration",function(){return this._audio?this._audio.duration:0}),$Y(0,$Q,"volume",function(){return this._audio?this._audio.volume:1},function($v){this._audio&&(this._audio.volume=$v)}),$g}(),$pv=function($v){function $g(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$kv.ctx,$g.__super.call(this),this._onPlayEnd=$S.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$t($g,"laya.media.webaudio.WebAudioSoundChannel",$dv);var $Q=$g.prototype;return $Q.play=function($v){if($V.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $g=this.context,$Q=this.gain,$d=$g.createBufferSource();(this.bufferSource=$d).buffer=this.audioBuffer,$d.connect($Q),$Q&&$Q.disconnect(),$Q.connect($g.destination),$d.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$c.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($d.loop=!0),$d.playbackRate.setTargetAtTime?$d.playbackRate.setTargetAtTime($V.playbackRate,this.context.currentTime,.1):$d.playbackRate.value=$V.playbackRate,$d.start(0,this.startTime),!$v&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$Q.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($W.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$Q._clearBufferSource=function(){if(this.bufferSource){var $v=this.bufferSource;$v.stop?$v.stop(0):$v.noteOff(0),$v.disconnect(0),$v.onended=null,$g._tryCleanFailed||this._tryClearBuffer($v),this.bufferSource=null}},$Q._tryClearBuffer=function($v){try{$v.buffer=null}catch($v){$g._tryCleanFailed=!0}},$Q.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$V.removeChannel(this),this.startHandler=null,this.completeHandler=null},$Q.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$V.removeChannel(this)},$Q.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$Y(0,$Q,"position",function(){return this.bufferSource?($c.now()-this._startTime)/1e3+this.startTime:0}),$Y(0,$Q,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$Y(0,$Q,"volume",function(){return this._volume},function($v){this.isStopped||(this._volume=$v,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($v,this.context.currentTime,.1):this.gain.gain.value=$v)}),$g._tryCleanFailed=!1,$g}(),$Tv=function($v){function $g(){$g.__super.call(this),this._w=0,this._h=0}$t($g,"laya.resource.Bitmap",$Mv);var $Q=$g.prototype;return $Y(0,$Q,"width",function(){return this._w}),$Y(0,$Q,"height",function(){return this._h}),$Y(0,$Q,"source",function(){return this._source}),$g}(),$tv=function($g){function $v(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$v.__super.call(this),this._interval=$d.animationInterval,this._setUpNoticeType(1)}$t($v,"laya.display.AnimationPlayerBase",$g);var $Q=$v.prototype;return $Q.play=function($v,$g,$Q,$d){void 0===$v&&($v=0),void 0===$g&&($g=!0),void 0===$Q&&($Q=""),void 0===$d&&($d=!0),this._isPlaying=!0,this.index="string"==typeof $v?this._getFrameByLabel($v):$v,this.loop=$g,this._actionName=$Q,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$Q._getFrameByLabel=function($v){var $g=0;for($g=0;$g<this._count;$g++)if(this._labels[$g]&&0<=this._labels[$g].indexOf($v))return $g;return 0},$Q._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$Q._setControlNode=function($v){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$v)&&$v!=this&&($v.on("display",this,this._checkResumePlaying),$v.on("undisplay",this,this._checkResumePlaying))},$Q._setDisplay=function($v){$g.prototype._setDisplay.call(this,$v),this._checkResumePlaying()},$Q._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$Q.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$Q.addLabel=function($v,$g){this._labels||(this._labels={}),this._labels[$g]||(this._labels[$g]=[]),this._labels[$g].push($v)},$Q.removeLabel=function($v){if($v){if(this._labels)for(var $g in this._labels)this._removeLabelFromLabelList(this._labels[$g],$v)}else this._labels=null},$Q._removeLabelFromLabelList=function($v,$g){if($v)for(var $Q=$v.length-1;0<=$Q;$Q--)$v[$Q]==$g&&$v.splice($Q,1)},$Q.gotoAndStop=function($v){this.index="string"==typeof $v?this._getFrameByLabel($v):$v,this.stop()},$Q._displayToIndex=function($v){},$Q.clear=function(){this.stop(),this._labels=null},$Y(0,$Q,"interval",function(){return this._interval},function($v){this._interval!=$v&&(this._frameRateChanged=!0,this._interval=$v,this._isPlaying&&0<$v&&this.timerLoop($v,this,this._frameLoop,null,!0,!0))}),$Y(0,$Q,"isPlaying",function(){return this._isPlaying}),$Y(0,$Q,"index",function(){return this._index},function($v){if(this._index=$v,this._displayToIndex($v),this._labels&&this._labels[$v])for(var $g=this._labels[$v],$Q=0,$d=$g.length;$Q<$d;$Q++)this.event("label",$g[$Q])}),$Y(0,$Q,"count",function(){return this._count}),$v.WRAP_POSITIVE=0,$v.WRAP_REVERSE=1,$v.WRAP_PINGPONG=2,$v}($Dv),$qv=function($g){function $p(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$p.__super.call(this),this.overflow=$p.VISIBLE,this._style=new $gv(this),this._style.wordWrap=!1}$t($p,"laya.display.Text",$g);var $v=$p.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$v._getBoundPointsM=function($v){void 0===$v&&($v=!1);var $g=$l.TEMP;return $g.setTo(0,0,this.width,this.height),$g._getBoundPoints()},$v.getGraphicBounds=function($v){void 0===$v&&($v=!1);var $g=$l.TEMP;return $g.setTo(0,0,this.width,this.height),$g},$v._getCSSStyle=function(){return this._style},$v.lang=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y){if($v=$p.langPacks&&$p.langPacks[$v]?$p.langPacks[$v]:$v,arguments.length<2)this._text=$v;else{for(var $D=0,$J=arguments.length;$D<$J;$D++)$v=$v.replace("{"+$D+"}",arguments[$D+1]);this._text=$v}},$v._isPassWordMode=function(){var $v=this._style.password;return"prompt"in this&&this.prompt==this._text&&($v=!1),$v},$v._getPassWordTxt=function($v){var $g;$g="";for(var $Q=$v.length;0<$Q;$Q--)$g+="●";return $g},$v.renderText=function($v,$g){var $Q=this.graphics;$Q.clear(!0);var $d=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($c.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$c.context.font=$d;var $r=this.padding,$k=$r[3],$$="left",$b=this._lines,$a=this.leading+this._charSize.height,$M=this._currBitmapFont;$M&&($a=this.leading+$M.getMaxHeight());var $Y=$r[0];if(!$M&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($$="right",$k=this._width-$r[1]):"center"==this.align&&($$="center",$k=.5*this._width+$r[3]-$r[1])),0<this._height){var $D=this._textHeight>this._height?"top":this.valign;"middle"===$D?$Y=.5*(this._height-$g*$a)+$r[0]-$r[2]:"bottom"===$D&&($Y=this._height-$g*$a-$r[2])}var $J=this._style;if($M&&$M.autoScaleSize)var $p=$M.fontSize/this.fontSize;if(this._clipPoint)if($Q.save(),$M&&$M.autoScaleSize){var $T=0,$t=0;$T=this._width?this._width-$r[3]-$r[1]:this._textWidth,$t=this._height?this._height-$r[0]-$r[2]:this._textHeight,$T*=$p,$t*=$p,$Q.clipRect($r[3],$r[0],$T,$t)}else $Q.clipRect($r[3],$r[0],this._width?this._width-$r[3]-$r[1]:this._textWidth,this._height?this._height-$r[0]-$r[2]:this._textHeight);var $q=$J.password;"prompt"in this&&this.prompt==this._text&&($q=!1);for(var $C=0,$G=0,$s=Math.min(this._lines.length,$g+$v)||1,$A=$v;$A<$s;$A++){var $h,$P=$b[$A];if($q){var $W=$P.length;$P="";for(var $F=$W;0<$F;$F--)$P+="●"}if($C=$k-(this._clipPoint?this._clipPoint.x:0),$G=$Y+$a*$A-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($$,$C,$G,$A),$M){var $l=this.width;$M.autoScaleSize&&($l=this.width*$p),$M.drawText($P,this,$C,$G,this.align,$l)}else $i.isWebGL?(this._words||(this._words=[]),($h=this._words.length>$A-$v?this._words[$A-$v]:new $u).setText($P)):$h=$P,$J.stroke?$Q.fillBorderText($h,$C,$G,$d,this.color,$J.strokeColor,$J.stroke,$$):$Q.fillText($h,$C,$G,$d,this.color,$$)}if($M&&$M.autoScaleSize){var $o=1/$p;this.scale($o,$o)}this._clipPoint&&$Q.restore(),this._startX=$k,this._startY=$Y},$v.drawUnderline=function($v,$g,$Q,$d){var $r=this._lineWidths[$d];switch($v){case"center":$g-=$r/2;break;case"right":$g-=$r}$Q+=this._charSize.height,this._graphics.drawLine($g,$Q,$g+$r,$Q,this.underlineColor||this.color,1)},$v.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$c.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $F(0,0)):this._clipPoint=null;var $v=this._lines.length;if(this.overflow!=$p.VISIBLE){var $g=this.overflow==$p.HIDDEN?Math.floor:Math.ceil;$v=Math.min($v,$g((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $Q=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($Q,$v),this.repaint()},$v.evalTextSize=function(){var $v,$g=NaN;$v=Math.max.apply(this,this._lineWidths),$g=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$v==this._textWidth&&$g==this._textHeight||(this._textWidth=$v,this._textHeight=$g,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$v.checkEnabledViewportOrNot=function(){return this.overflow==$p.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$v.changeText=function($v){this._text!==$v&&(this.lang($v+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$v.parseLines=function($v){var $g=this.wordWrap||this.overflow==$p.HIDDEN;if($g)var $Q=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $d=$S.contextMeasureText($p._testWord);$i.isConchApp&&0===$d.width&&0===$d.height&&($d=$S.contextMeasureText("W")),this._charSize.width=$d.width,this._charSize.height=$d.height||this.fontSize}for(var $r=$v.replace(/\r\n/g,"\n").split("\n"),$k=0,$$=$r.length;$k<$$;$k++){var $b=$r[$k];$g?this.parseLine($b,$Q):(this._lineWidths.push(this.getTextWidth($b)),this._lines.push($b))}},$v.parseLine=function($v,$g){$c.context;var $Q,$d=this._lines,$r=0,$k=NaN,$$=NaN,$b=0;if(($k=this.getTextWidth($v))<=$g)return $d.push($v),void this._lineWidths.push($k);$k=this._charSize.width,0==($r=Math.floor($g/$k))&&($r=1),$$=$k=this.getTextWidth($v.substring(0,$r));for(var $a=$r,$M=$v.length;$a<$M;$a++)if($g<($$+=$k=this.getTextWidth($v.charAt($a))))if(this.wordWrap){var $Y=$v.substring($b,$a);if($Y.charCodeAt($Y.length-1)<255?($Q=/(?:\w|-)+$/.exec($Y))&&($a=$Q.index+$b,0==$Q.index?$a+=$Y.length:$Y=$v.substring($b,$a)):$p.RightToLeft&&($Q=/([\u0600-\u06FF])+$/.exec($Y))&&($a=$Q.index+$b,0==$Q.index?$a+=$Y.length:$Y=$v.substring($b,$a)),$d.push($Y),this._lineWidths.push($$-$k),!(($b=$a)+$r<$M)){$d.push($v.substring($b,$M)),this._lineWidths.push(this.getTextWidth($d[$d.length-1])),$b=-1;break}$a+=$r,$$=$k=this.getTextWidth($v.substring($b,$a)),$a--}else if(this.overflow==$p.HIDDEN)return $d.push($v.substring(0,$a)),void this._lineWidths.push(this.getTextWidth($d[$d.length-1]));this.wordWrap&&-1!=$b&&($d.push($v.substring($b,$M)),this._lineWidths.push(this.getTextWidth($d[$d.length-1])))},$v.getTextWidth=function($v){return this._currBitmapFont?this._currBitmapFont.getTextWidth($v):$S.contextMeasureText($v).width},$v.getWordWrapWidth=function(){var $v=this.padding,$g=NaN;return($g=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($g=this.wordWrap?100:$c.width),$g<=0&&($g=100),$g-$v[3]-$v[1]},$v.getCharPoint=function($v,$g){this._isChanged&&$W.timer.runCallLater(this,this.typeset);for(var $Q=0,$d=this._lines,$r=0,$k=0,$$=$d.length;$k<$$;$k++){if($v<($Q+=$d[$k].length)){var $b=$k;break}$r=$Q}var $a=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$c.context.font=$a;var $M=this.getTextWidth(this._text.substring($r,$v));return($g||new $F).setTo(this._startX+$M-(this._clipPoint?this._clipPoint.x:0),this._startY+$b*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$Y(0,$v,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($v){$v!=this._width&&($W.superSet($Dv,this,"width",$v),this.isChanged=!0)}),$Y(0,$v,"textWidth",function(){return this._isChanged&&$W.timer.runCallLater(this,this.typeset),this._textWidth}),$Y(0,$v,"height",function(){return this._height?this._height:this.textHeight},function($v){$v!=this._height&&($W.superSet($Dv,this,"height",$v),this.isChanged=!0)}),$Y(0,$v,"textHeight",function(){return this._isChanged&&$W.timer.runCallLater(this,this.typeset),this._textHeight}),$Y(0,$v,"padding",function(){return this._getCSSStyle().padding},function($v){this._getCSSStyle().padding=$v,this.isChanged=!0}),$Y(0,$v,"bold",function(){return this._getCSSStyle().bold},function($v){this._getCSSStyle().bold=$v,this.isChanged=!0}),$Y(0,$v,"text",function(){return this._text||""},function($v){this._text!==$v&&(this.lang($v+""),this.isChanged=!0,this.event("change"))}),$Y(0,$v,"color",function(){return this._getCSSStyle().color},function($v){this._getCSSStyle().color!=$v&&(this._getCSSStyle().color=$v,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$Y(0,$v,"font",function(){return this._getCSSStyle().fontFamily},function($v){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$p._bitmapFonts&&$p._bitmapFonts[$v]&&(this._currBitmapFont=$p._bitmapFonts[$v]),this._getCSSStyle().fontFamily=$v,this.isChanged=!0}),$Y(0,$v,"fontSize",function(){return this._getCSSStyle().fontSize},function($v){this._getCSSStyle().fontSize=$v,this.isChanged=!0}),$Y(0,$v,"italic",function(){return this._getCSSStyle().italic},function($v){this._getCSSStyle().italic=$v,this.isChanged=!0}),$Y(0,$v,"align",function(){return this._getCSSStyle().align},function($v){this._getCSSStyle().align=$v,this.isChanged=!0}),$Y(0,$v,"valign",function(){return this._getCSSStyle().valign},function($v){this._getCSSStyle().valign=$v,this.isChanged=!0}),$Y(0,$v,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($v){this._getCSSStyle().wordWrap=$v,this.isChanged=!0}),$Y(0,$v,"leading",function(){return this._getCSSStyle().leading},function($v){this._getCSSStyle().leading=$v,this.isChanged=!0}),$Y(0,$v,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($v){this._getCSSStyle().backgroundColor=$v,this.isChanged=!0}),$Y(0,$v,"borderColor",function(){return this._getCSSStyle().borderColor},function($v){this._getCSSStyle().borderColor=$v,this.isChanged=!0}),$Y(0,$v,"stroke",function(){return this._getCSSStyle().stroke},function($v){this._getCSSStyle().stroke=$v,this.isChanged=!0}),$Y(0,$v,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($v){this._getCSSStyle().strokeColor=$v,this.isChanged=!0}),$Y(0,$v,"isChanged",null,function($v){this._isChanged!==$v&&(this._isChanged=$v)&&$W.timer.callLater(this,this.typeset)}),$Y(0,$v,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($v){if(!(this.overflow!=$p.SCROLL||this.textWidth<this._width)&&this._clipPoint){$v=$v<this.padding[3]?this.padding[3]:$v;var $g=this._textWidth-this._width;$v=$g<$v?$g:$v;var $Q=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$v,this.renderText(this._lastVisibleLineIndex,$Q)}}),$Y(0,$v,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($v){if(!(this.overflow!=$p.SCROLL||this.textHeight<this._height)&&this._clipPoint){$v=$v<this.padding[0]?this.padding[0]:$v;var $g=this._textHeight-this._height,$Q=($v=$g<$v?$g:$v)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$Q;var $d=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$v,this.renderText($Q,$d)}}),$Y(0,$v,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$Y(0,$v,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$Y(0,$v,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$Y(0,$v,"underlineColor",function(){return this._underlineColor},function($v){this._underlineColor=$v,this._isChanged=!0,this.typeset()}),$p.registerBitmapFont=function($v,$g){$p._bitmapFonts||($p._bitmapFonts={}),$p._bitmapFonts[$v]=$g},$p.unregisterBitmapFont=function($v,$g){if(void 0===$g&&($g=!0),$p._bitmapFonts&&$p._bitmapFonts[$v]){var $Q=$p._bitmapFonts[$v];$g&&$Q.destroy(),delete $p._bitmapFonts[$v]}},$p.setTextRightToLeft=function(){var $v;($v=$c.canvas.source.style).display="none",$v.position="absolute",$v.direction="rtl",$i._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$c.document.body.appendChild($c.canvas.source)},$p.supportFont=function($v){$c.context.font="10px sans-serif";var $g=$S.contextMeasureText("abcji").width;$c.context.font="10px "+$v;var $Q=$S.contextMeasureText("abcji").width;return console.log($g,$Q),$g!==$Q},$p._testWord="游",$p.langPacks=null,$p.VISIBLE="visible",$p.SCROLL="scroll",$p.HIDDEN="hidden",$p.CharacterCache=!0,$p.RightToLeft=!1,$p._bitmapFonts=null,$a($p,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$p}($Dv),$Cv=function($D){function $$(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$$.__super.call(this),this.offset=new $F,this._canvasTransform=new $f,this._previousOrientation=$c.window.orientation;var $g=this;this.transform=$f.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $v=$c.window,$Q=this;$v.addEventListener("focus",function(){$g._isFocused=!0,$Q.event("focus"),$Q.event("focuschange")}),$v.addEventListener("blur",function(){$g._isFocused=!1,$Q.event("blur"),$Q.event("focuschange"),$Q._isInputting()&&($hv.inputElement.target.focus=!1)});var $d="visibilityState",$r="visibilitychange",$k=$v.document;void 0!==$k.hidden?($r="visibilitychange",$d="visibilityState"):void 0!==$k.mozHidden?($r="mozvisibilitychange",$d="mozVisibilityState"):void 0!==$k.msHidden?($r="msvisibilitychange",$d="msVisibilityState"):void 0!==$k.webkitHidden&&($r="webkitvisibilitychange",$d="webkitVisibilityState"),$v.document.addEventListener($r,function(){"hidden"==$c.document[$d]?$Q._setStageVisible(!1):$Q._setStageVisible(!0)}),$v.document.addEventListener("qbrowserVisibilityChange",function($v){$Q._setStageVisible(!$v.hidden)}),$v.addEventListener("resize",function(){var $v=$c.window.orientation;null!=$v&&$v!=$g._previousOrientation&&$Q._isInputting()&&($hv.inputElement.target.focus=!1),$g._previousOrientation=$v,$Q._isInputting()||$Q._resetCanvas()}),$v.addEventListener("orientationchange",function($v){$Q._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$c.onMobile&&this.on("mousedown",this,this._onmouseMove)}$t($$,"laya.display.Stage",$D);var $v=$$.prototype;return $v._setStageVisible=function($v){this._isVisibility!=$v&&(this._isVisibility=$v,this._isVisibility||this._isInputting()&&($hv.inputElement.target.focus=!1),this.event("visibilitychange"))},$v._isInputting=function(){return $c.onMobile&&$hv.isInputting},$v._changeCanvasSize=function(){this.setScreenSize($c.clientWidth*$c.pixelRatio,$c.clientHeight*$c.pixelRatio)},$v._resetCanvas=function(){if(this.screenAdaptationEnabled){var $v=$i._mainCanvas;$v.source.style;$v.size(1,1),$W.timer.once(100,this,this._changeCanvasSize)}},$v.setScreenSize=function($v,$g){var $Q=!1;if("none"!==this._screenMode&&($Q=($v/$g<1?"vertical":"horizontal")!==this._screenMode)){var $d=$g;$g=$v,$v=$d}this.canvasRotation=$Q;var $r=$i._mainCanvas,$k=$r.source.style,$$=this._canvasTransform.identity(),$b=this._scaleMode,$a=$v/this.designWidth,$M=$g/this.designHeight,$Y=this.designWidth,$D=this.designHeight,$J=$v,$p=$g,$T=$c.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$b){case"noscale":$a=$M=1,$J=this.designWidth,$p=this.designHeight;break;case"showall":$a=$M=Math.min($a,$M),$Y=$J=Math.round(this.designWidth*$a),$D=$p=Math.round(this.designHeight*$M);break;case"noborder":$a=$M=Math.max($a,$M),$J=Math.round(this.designWidth*$a),$p=Math.round(this.designHeight*$M);break;case"full":$a=$M=1,this._width=$Y=$v,this._height=$D=$g;break;case"fixedwidth":$M=$a,this._height=$D=Math.round($g/$a);break;case"fixedheight":$a=$M,this._width=$Y=Math.round($v/$M);break;case"fixedauto":$v/$g<this.designWidth/this.designHeight?($M=$a,this._height=$D=Math.round($g/$a)):($a=$M,this._width=$Y=Math.round($v/$M))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$Y=$Y+1&2147483646,$D=$D+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$a*=this.scaleX,$M*=this.scaleY,1===$a&&1===$M?this.transform.identity():(this.transform.a=this._formatData($a/($J/$Y)),this.transform.d=this._formatData($M/($p/$D)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$r.size($Y,$D),$Z.changeWebGLSize($Y,$D),$$.scale($J/$Y/$T,$p/$D/$T),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($v-$J)/$T:this.offset.x=.5*($v-$J)/$T,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($g-$p)/$T:this.offset.y=.5*($g-$p)/$T,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$$.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$Q&&("horizontal"===this._screenMode?($$.rotate(Math.PI/2),$$.translate($g/$T,0),this.canvasDegree=90):($$.rotate(-Math.PI/2),$$.translate(0,$v/$T),this.canvasDegree=-90)),$$.a=this._formatData($$.a),$$.d=this._formatData($$.d),$$.tx=this._formatData($$.tx),$$.ty=this._formatData($$.ty),$k.transformOrigin=$k.webkitTransformOrigin=$k.msTransformOrigin=$k.mozTransformOrigin=$k.oTransformOrigin="0px 0px 0px",$k.transform=$k.webkitTransform=$k.msTransform=$k.mozTransform=$k.oTransform="matrix("+$$.toString()+")",$$.translate(parseInt($k.left)||0,parseInt($k.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$v._formatData=function($v){return Math.abs($v)<1e-6?0:Math.abs(1-$v)<.001?0<$v?1:-1:$v},$v.getMousePoint=function(){return $F.TEMP.setTo(this.mouseX,this.mouseY)},$v.repaint=function(){this._repaint=1},$v.parentRepaint=function(){},$v._loop=function(){return this.render($i.context,0,0),!0},$v._onmouseMove=function($v){this._mouseMoveTime=$c.now()},$v.getTimeFromFrameStart=function(){return $c.now()-this._frameStartTime},$v.render=function($v,$g,$Q){if("sleep"===this._frameRate&&!$i.isConchApp){var $d=$c.now();if(!(1e3<=$d-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($z.loopCount++,$T.instance.runEvent(),$W.timer._update()));this._frameStartTime=$d}if(this._renderCount++,$i.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$c.now();var $r="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$k=this._renderCount%2==0;if($z.renderSlow=!$r,$r||$k||$i.isConchApp){var $$;$z.loopCount++,$T.instance.runEvent(),$W.timer._update(),$Z.update3DLoop();var $b=0,$a=0;if($i.isConchNode)for($b=0,$a=this._scenes.length;$b<$a;$b++)($$=this._scenes[$b])&&$$._updateSceneConch();else for($b=0,$a=this._scenes.length;$b<$a;$b++)($$=this._scenes[$b])&&$$._updateScene();if($i.isConchNode){var $M=$Dv.CustomList;for($b=0,$a=$M.length;$b<$a;$b++){var $Y=$M[$b];$Y.customRender($Y.customContext,0,0)}return}}$i.isConchNode||this.renderingEnabled&&($r||!$k||$i.isConchWebGL)&&($i.isWebGL?$i.WebGL.mainContext&&!$i.WebGL.mainContext.isContextLost()&&($v.clear(),$D.prototype.render.call(this,$v,$g,$Q),$z._show&&$z._sp&&$z._sp.render($v,$g,$Q),$Z.clear(this._bgColor),$Z.beginFlush(),$v.flush(),$Z.endFinish(),$O.instance&&$O.getInstance().endDispose()):($Z.clear(this._bgColor),$D.prototype.render.call(this,$v,$g,$Q),$z._show&&$z._sp&&$z._sp.render($v,$g,$Q)))}else this._renderCount%5==0&&($z.loopCount++,$T.instance.runEvent(),$W.timer._update())},$v._requestFullscreen=function(){var $v=$c.document.documentElement;$v.requestFullscreen?$v.requestFullscreen():$v.mozRequestFullScreen?$v.mozRequestFullScreen():$v.webkitRequestFullscreen?$v.webkitRequestFullscreen():$v.msRequestFullscreen&&$v.msRequestFullscreen()},$v._fullScreenChanged=function(){$W.stage.event("fullscreenchange")},$v.exitFullscreen=function(){var $v=$c.document;$v.exitFullscreen?$v.exitFullscreen():$v.mozCancelFullScreen?$v.mozCancelFullScreen():$v.webkitExitFullscreen&&$v.webkitExitFullscreen()},$Y(0,$v,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$Y(0,$v,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$Y(0,$v,"frameRate",function(){return this._frameRate},function($v){if(this._frameRate=$v,$i.isConchApp)switch(this._frameRate){case"slow":$c.window.conch&&$c.window.conchConfig.setSlowFrame&&$c.window.conchConfig.setSlowFrame(!0);break;case"fast":$c.window.conch&&$c.window.conchConfig.setSlowFrame&&$c.window.conchConfig.setSlowFrame(!1);break;case"mouse":$c.window.conch&&$c.window.conchConfig.setMouseFrame&&$c.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$c.window.conch&&$c.window.conchConfig.setLimitFPS&&$c.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$Y(0,$v,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$Y(0,$v,"width",$D.prototype._$get_width,function($v){this.designWidth=$v,$W.superSet($Dv,this,"width",$v),$W.timer.callLater(this,this._changeCanvasSize)}),$Y(0,$v,"alignH",function(){return this._alignH},function($v){this._alignH=$v,$W.timer.callLater(this,this._changeCanvasSize)}),$Y(0,$v,"isFocused",function(){return this._isFocused}),$Y(0,$v,"height",$D.prototype._$get_height,function($v){this.designHeight=$v,$W.superSet($Dv,this,"height",$v),$W.timer.callLater(this,this._changeCanvasSize)}),$Y(0,$v,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$f.create()},$D.prototype._$set_transform),$Y(0,$v,"isVisibility",function(){return this._isVisibility}),$Y(0,$v,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$Y(0,$v,"scaleMode",function(){return this._scaleMode},function($v){this._scaleMode=$v,$W.timer.callLater(this,this._changeCanvasSize)}),$Y(0,$v,"alignV",function(){return this._alignV},function($v){this._alignV=$v,$W.timer.callLater(this,this._changeCanvasSize)}),$Y(0,$v,"bgColor",function(){return this._bgColor},function($v){this._bgColor=$v,this.conchModel&&this.conchModel.bgColor($v),$i.isWebGL&&($v?$$._wgColor=$H.create($v)._color:$c.onMiniGame||($$._wgColor=null)),$c.onLimixiu?$$._wgColor=$H.create($v)._color:$i.canvas.style.background=$v||"none"}),$Y(0,$v,"mouseX",function(){return Math.round($T.instance.mouseX/this.clientScaleX)}),$Y(0,$v,"mouseY",function(){return Math.round($T.instance.mouseY/this.clientScaleY)}),$Y(0,$v,"screenMode",function(){return this._screenMode},function($v){this._screenMode=$v}),$Y(0,$v,"visible",$D.prototype._$get_visible,function($v){this.visible!==$v&&($W.superSet($Dv,this,"visible",$v),$i._mainCanvas.source.style.visibility=$v?"visible":"hidden")}),$Y(0,$v,"fullScreenEnabled",null,function($v){var $g=$c.document,$Q=$i.canvas;$v?($Q.addEventListener("mousedown",this._requestFullscreen),$Q.addEventListener("touchstart",this._requestFullscreen),$g.addEventListener("fullscreenchange",this._fullScreenChanged),$g.addEventListener("mozfullscreenchange",this._fullScreenChanged),$g.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$g.addEventListener("msfullscreenchange",this._fullScreenChanged)):($Q.removeEventListener("mousedown",this._requestFullscreen),$Q.removeEventListener("touchstart",this._requestFullscreen),$g.removeEventListener("fullscreenchange",this._fullScreenChanged),$g.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$g.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$g.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$$.SCALE_NOSCALE="noscale",$$.SCALE_EXACTFIT="exactfit",$$.SCALE_SHOWALL="showall",$$.SCALE_NOBORDER="noborder",$$.SCALE_FULL="full",$$.SCALE_FIXED_WIDTH="fixedwidth",$$.SCALE_FIXED_HEIGHT="fixedheight",$$.SCALE_FIXED_AUTO="fixedauto",$$.ALIGN_LEFT="left",$$.ALIGN_RIGHT="right",$$.ALIGN_CENTER="center",$$.ALIGN_TOP="top",$$.ALIGN_MIDDLE="middle",$$.ALIGN_BOTTOM="bottom",$$.SCREEN_NONE="none",$$.SCREEN_HORIZONTAL="horizontal",$$.SCREEN_VERTICAL="vertical",$$.FRAME_FAST="fast",$$.FRAME_SLOW="slow",$$.FRAME_MOUSE="mouse",$$.FRAME_SLEEP="sleep",$$.FRAME_MOUSE_THREDHOLD=2e3,$a($$,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$$}($Dv),$Gv=(function($v){function $g(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$g.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$t($g,"laya.media.SoundNode",$Dv);var $Q=$g.prototype;$Q._onParentChange=function(){this.target=this.parent},$Q.play=function($v,$g){void 0===$v&&($v=1),isNaN($v)&&($v=1),this.url&&(this.stop(),this._channel=$V.playSound(this.url,$v,null,$g))},$Q.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$Q._setPlayAction=function($v,$g,$Q,$d){void 0===$d&&($d=!0),this[$Q]&&$v&&($d?$v.on($g,this,this[$Q]):$v.off($g,this,this[$Q]))},$Q._setPlayActions=function($v,$g,$Q,$d){if(void 0===$d&&($d=!0),$v&&$g){var $r,$k=$g.split(","),$$=0;for($r=$k.length,$$=0;$$<$r;$$++)this._setPlayAction($v,$k[$$],$Q,$d)}},$Y(0,$Q,"playEvent",null,function($v){(this._playEvents=$v)&&this._tar&&this._setPlayActions(this._tar,$v,"play")}),$Y(0,$Q,"target",null,function($v){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$v,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$Y(0,$Q,"stopEvent",null,function($v){(this._stopEvents=$v)&&this._tar&&this._setPlayActions(this._tar,$v,"stop")})}(),function($v){function $g(){this._src=null,this._onload=null,this._onerror=null,$g.__super.call(this)}$t($g,"laya.resource.FileBitmap",$Tv);var $Q=$g.prototype;return $Y(0,$Q,"src",function(){return this._src},function($v){this._src=$v}),$Y(0,$Q,"onload",null,function($v){}),$Y(0,$Q,"onerror",null,function($v){}),$g}()),$sv=function($v){function $Q($v,$g){this._is2D=!1,$Q.__super.call(this);var $d=this;if(this._source=this,"2D"===$v||"AUTO"===$v&&!$i.isWebGL){this._is2D=!0,this._source=$g||$c.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $r=this;$r.getContext=function($v,$g){if($d._ctx)return $d._ctx;var $Q=$d._ctx=$d._source.getContext($v,$g);return $Q&&($Q._canvas=$r,$i.isFlash||$c.onLimixiu||($Q.size=function($v,$g){})),$Q}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$t($Q,"laya.resource.HTMLCanvas",$Tv);var $g=$Q.prototype;return $g.clear=function(){this._ctx&&this._ctx.clear()},$g.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$g.release=function(){},$g._setContext=function($v){this._ctx=$v},$g.getContext=function($v,$g){return this._ctx?this._ctx:this._ctx=$Q._createContext(this)},$g.getMemSize=function(){return 0},$g.size=function($v,$g){(this._w!=$v||this._h!=$g||this._source&&(this._source.width!=$v||this._source.height!=$g))&&(this._w=$v,this._h=$g,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($v,$g),this._source&&(this._source.height=$g,this._source.width=$v))},$g.getCanvas=function(){return this._source},$g.toBase64=function($v,$g,$Q){if(this._source)if($i.isConchApp&&this._source.toBase64)this._source.toBase64($v,$g,$Q);else{var $d=this._source.toDataURL($v,$g);$Q.call(this,$d)}},$Y(0,$g,"context",function(){return this._ctx}),$Y(0,$g,"asBitmap",null,function($v){}),$Q.create=function($v,$g){return new $Q($v,$g)},$Q.TYPE2D="2D",$Q.TYPE3D="3D",$Q.TYPEAUTO="AUTO",$Q._createContext=null,$Q}(),$Av=(function($v){function $a($v,$g,$Q,$d,$r,$k,$$,$b){throw $a.__super.call(this),new Error("不允许new！")}$t($a,"laya.resource.HTMLSubImage",$Tv),$a.create=function($v,$g,$Q,$d,$r,$k,$$,$b){return void 0===$b&&($b=!1),new $a($v,$g,$Q,$d,$r,$k,$$,$b)}}(),function($v){function $D(){this._frames=null,this._url=null,$D.__super.call(this),this._setControlNode(this)}$t($D,"laya.display.Animation",$v);var $g=$D.prototype;$g.destroy=function($v){void 0===$v&&($v=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$v),this._frames=null,this._labels=null},$g.play=function($v,$g,$Q,$d){void 0===$v&&($v=0),void 0===$g&&($g=!0),void 0===$Q&&($Q=""),void 0===$d&&($d=!0),$Q&&this._setFramesFromCache($Q,$d),this._isPlaying=!0,this.index="string"==typeof $v?this._getFrameByLabel($v):$v,this.loop=$g,this._actionName=$Q,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$g._setFramesFromCache=function($v,$g){var $Q;return void 0===$g&&($g=!1),this._url&&($v=this._url+"#"+$v),$v&&$D.framesMap[$v]?(($Q=$D.framesMap[$v])instanceof Array?(this._frames=$D.framesMap[$v],this._count=this._frames.length):($Q.nodeRoot&&($D.framesMap[$v]=this._parseGraphicAnimationByData($Q),$Q=$D.framesMap[$v]),this._frames=$Q.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$Q.interval),this._labels=this._copyLabels($Q.labels)),!0):($g&&console.log("ani not found:",$v),!1)},$g._copyLabels=function($v){if(!$v)return null;var $g,$Q;for($Q in $g={},$v)$g[$Q]=$S.copyArray([],$v[$Q]);return $g},$g._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$v.prototype._frameLoop.call(this)},$g._displayToIndex=function($v){this._frames&&(this.graphics=this._frames[$v])},$g.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$g.loadImages=function($v,$g){return void 0===$g&&($g=""),this._url="",this._setFramesFromCache($g)||(this.frames=$D.framesMap[$g]?$D.framesMap[$g]:$D.createFrames($v,$g)),this},$g.loadAtlas=function($g,$Q,$d){void 0===$d&&($d=""),this._url="";var $r=this;function $v($v){$g===$v&&($r.frames=$D.framesMap[$d]?$D.framesMap[$d]:$D.createFrames($g,$d),$Q&&$Q.run())}return $r._setFramesFromCache($d)||($bv.getAtlas($g)?$v($g):$W.loader.load($g,$G.create(null,$v,[$g]),null,"atlas")),this},$g.loadAnimation=function($v,$g,$Q){this._url=$v;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$g&&$g.run()):!$Q||$bv.getAtlas($Q)?this._loadAnimationData($v,$g,$Q):$W.loader.load($Q,$G.create(this,this._loadAnimationData,[$v,$g,$Q]),null,"atlas"),this},$g._loadAnimationData=function($b,$a,$v){var $M=this;if(!$v||$bv.getAtlas($v)){var $Y=this;$bv.getRes($b)?$g($b):$W.loader.load($b,$G.create(null,$g,[$b]),null,"json"),$bv.clearRes($b)}else console.warn("atlas load fail:"+$v);function $g($v){if($bv.getRes($v)&&$b===$v){var $g;if($D.framesMap[$b+"#"])$Y._setFramesFromCache($M._actionName,!0),$M.index=0,$M._checkResumePlaying();else{var $Q=$Y._parseGraphicAnimation($bv.getRes($b));if(!$Q)return;var $d,$r=$Q.animationList,$k=0,$$=$r.length;for($k=0;$k<$$;$k++)$g=$r[$k],$D.framesMap[$b+"#"+$g.name]=$g,$d||($d=$g);$d&&($D.framesMap[$b+"#"]=$d,$Y._setFramesFromCache($M._actionName,!0),$M.index=0),$M._checkResumePlaying()}$a&&$a.run()}}},$g._parseGraphicAnimation=function($v){return $Wv.parseAnimationData($v)},$g._parseGraphicAnimationByData=function($v){return $Wv.parseAnimationByData($v)},$Y(0,$g,"frames",function(){return this._frames},function($v){(this._frames=$v)&&(this._count=$v.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$Y(0,$g,"autoPlay",null,function($v){$v?this.play():this.stop()}),$Y(0,$g,"source",null,function($v){-1<$v.indexOf(".ani")?this.loadAnimation($v):-1<$v.indexOf(".json")||-1<$v.indexOf("als")||-1<$v.indexOf("atlas")?this.loadAtlas($v):this.loadImages($v.split(","))}),$Y(0,$g,"autoAnimation",null,function($v){this.play(0,!0,$v,!1)}),$D.createFrames=function($v,$g){var $Q,$d,$r=0,$k=0;if("string"==typeof $v){var $$=$bv.getAtlas($v);if($$&&$$.length)for($Q=[],$r=0,$k=$$.length;$r<$k;$r++)($d=new $Z.createGraphics).drawTexture($bv.getRes($$[$r]),0,0),$Q.push($d)}else if($v instanceof Array)for($Q=[],$r=0,$k=$v.length;$r<$k;$r++)($d=new $Z.createGraphics).loadImage($v[$r],0,0),$Q.push($d);return $g&&($D.framesMap[$g]=$Q),$Q},$D.clearCache=function($v){var $g,$Q=$D.framesMap,$d=$v+"#";for($g in $Q)$g!==$v&&0!=$g.indexOf($d)||delete $D.framesMap[$g]},$D.framesMap={}}($tv),function($v){function $k(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$k.__super.call(this),null==$k._sortIndexFun&&($k._sortIndexFun=$P.sortByKey("index",!1,!0))}$t($k,"laya.display.FrameAnimation",$v);var $g=$k.prototype;return $g._setUp=function($v,$g){this._labels=null,this._animationNewFrames=null,this._targetDic=$v,this._animationData=$g,this.interval=1e3/$g.frameRate,$g.parsed?(this._count=$g.count,this._labels=$g.labels,this._animationNewFrames=$g.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$g.parsed=!0,$g.labels=this._labels,$g.count=this._count,$g.animationNewFrames=this._animationNewFrames},$g.clear=function(){$v.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$g._displayToIndex=function($v){if(this._animationData){$v<0&&($v=0),$v>this._count&&($v=this._count);var $g=this._animationData.nodes,$Q=0,$d=$g.length;for($Q=0;$Q<$d;$Q++)this._displayNodeToFrame($g[$Q],$v)}},$g._displayNodeToFrame=function($v,$g,$Q){$Q||($Q=this._targetDic);var $d=$Q[$v.target];if($d){var $r,$k,$$,$b=$v.frames,$a=$v.keys,$M=0,$Y=$a.length;for($M=0;$M<$Y;$M++)$$=($k=$b[$r=$a[$M]]).length>$g?$k[$g]:$k[$k.length-1],$d[$r]=$$}},$g._calculateDatas=function(){if(this._animationData){var $v,$g=this._animationData.nodes,$Q=0,$d=$g.length;for($Q=this._count=0;$Q<$d;$Q++)$v=$g[$Q],this._calculateNodeKeyFrames($v);this._count+=1}},$g._calculateNodeKeyFrames=function($v){var $g,$Q,$d=$v.keyframes,$r=$v.target;for($g in $v.frames||($v.frames={}),$v.keys?$v.keys.length=0:$v.keys=[],$v.initValues||($v.initValues={}),$d)$Q=$d[$g],$v.frames[$g]||($v.frames[$g]=[]),this._targetDic&&this._targetDic[$r]&&($v.initValues[$g]=this._targetDic[$r][$g]),$Q.sort($k._sortIndexFun),$v.keys.push($g),this._calculateNodePropFrames($Q,$v.frames[$g],$g,$r)},$g.resetToInitState=function(){if(this._targetDic&&this._animationData){var $v,$g,$Q=this._animationData.nodes,$d=0,$r=$Q.length;for($d=0;$d<$r;$d++)if($g=($v=$Q[$d]).initValues){var $k,$$=this._targetDic[$v.target];if($$)for($k in $g)$$[$k]=$g[$k]}}},$g._calculateNodePropFrames=function($v,$g,$Q,$d){var $r=0,$k=$v.length-1;if(0<$k){for($g.length=$v[$k].index+1,$r=0;$r<$k;$r++)this._dealKeyFrame($v[$r]),this._calculateFrameValues($v[$r],$v[$r+1],$g);this._dealKeyFrame($v[$r])}0==$k&&($g[$v[0].index]=$v[0].value,this._animationNewFrames&&(this._animationNewFrames[$v[0].index]=!0))},$g._dealKeyFrame=function($v){$v.label&&""!=$v.label&&this.addLabel($v.label,$v.index)},$g._calculateFrameValues=function($v,$g,$Q){var $d,$r=0,$k=$v.index,$$=$g.index,$b=$v.value,$a=$g.value-$v.value,$M=$$-$k;if($$>this._count&&(this._count=$$),$v.tween)for(null==($d=$y[$v.tweenMethod])&&($d=$y.linearNone),$r=$k;$r<$$;$r++)$Q[$r]=$d($r-$k,$b,$a,$M),this._animationNewFrames&&(this._animationNewFrames[$r]=!0);else for($r=$k;$r<$$;$r++)$Q[$r]=$b;this._animationNewFrames&&(this._animationNewFrames[$v.index]=!0,this._animationNewFrames[$g.index]=!0),$Q[$g.index]=$g.value},$k._sortIndexFun=null,$k}($tv)),$hv=function($g){function $r(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$r.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$qv.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$t($r,"laya.display.Input",$g);var $v=$r.prototype;return $v.setSelection=function($v,$g){this.focus=!0,laya.display.Input.inputElement.selectionStart=$v,laya.display.Input.inputElement.selectionEnd=$g},$v._onUnDisplay=function($v){this.focus=!1},$v._onMouseDown=function($v){this.focus=!0},$v._syncInputTransform=function(){var $v=this.nativeInput,$g=$S.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$Q=this._width-this.padding[1]-this.padding[3],$d=this._height-this.padding[0]-this.padding[2];$i.isConchApp?($v.setScale($g.scaleX,$g.scaleY),$v.setSize($Q,$d),$v.setPos($g.x,$g.y)):($r.iframeInput&&$r._showIOSInput(),$r.inputContainer.style.transform=$r.inputContainer.style.webkitTransform="scale("+$g.scaleX+","+$g.scaleY+") rotate("+$W.stage.canvasDegree+"deg)",$v.style.width=$Q+"px",$v.style.height=$d+"px",$r.inputContainer.style.left=$g.x+"px",$r.inputContainer.style.top=$g.y+"px")},$v.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$v._setInputMethod=function(){$r.input.parentElement&&$r.inputContainer.removeChild($r.input),$r.area.parentElement&&$r.inputContainer.removeChild($r.area),$r.inputElement=this.nativeInput,$r.inputContainer.appendChild($r.inputElement),$qv.RightToLeft&&($r.inputElement.style.direction="rtl")},$v._focusIn=function(){laya.display.Input.isInputting=!0;var $v=this.nativeInput;this._focus=!0;var $g=$v.style;$g.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$v.readOnly=!this._editable,$i.isConchApp&&($v.setType(this._type),$v.setForbidEdit(!this._editable)),$v.maxLength=this._maxChars;this.padding;if($v.type=this._type,$v.value=this._content,$v.placeholder=this._prompt,$W.stage.off("keydown",this,this._onKeyDown),$W.stage.on("keydown",this,this._onKeyDown),($W.stage.focus=this).event("focus"),$c.onPC&&$v.focus(),!$c.onMiniGame){this._text;this._text=null}this.typeset(),$v.setColor(this._originColor),$v.setFontSize(this.fontSize),$v.setFontFace($c.onIPhone&&$qv._fontFamilyMap[this.font]||this.font),$i.isConchApp&&$v.setMultiAble&&$v.setMultiAble(this._multiline),$g.lineHeight=this.leading+this.fontSize+"px",$g.fontStyle=this.italic?"italic":"normal",$g.fontWeight=this.bold?"bold":"normal",$g.textAlign=this.align,$g.padding="0 0",this._syncInputTransform(),!$i.isConchApp&&$c.onPC&&$W.timer.frameLoop(1,this,this._syncInputTransform)},$v._setPromptColor=function(){($r.promptStyleDOM=$c.getElementById("promptStyle"))||(($r.promptStyleDOM=$c.createElement("style")).setAttribute("id","promptStyle"),$c.document.head.appendChild($r.promptStyleDOM)),$r.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$v._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($W.superSet($qv,this,"text",this._content),$W.superSet($qv,this,"color",this._originColor)):($W.superSet($qv,this,"text",this._prompt),$W.superSet($qv,this,"color",this._promptColor)),$W.stage.off("keydown",this,this._onKeyDown),$W.stage.focus=null,this.event("blur"),$i.isConchApp&&this.nativeInput.blur(),$c.onPC&&$W.timer.clear(this,this._syncInputTransform)},$v._onKeyDown=function($v){13===$v.keyCode&&($c.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$v.changeText=function($v){this._content=$v,this._focus?(this.nativeInput.value=$v||"",this.event("change")):$g.prototype.changeText.call(this,$v)},$Y(0,$v,"color",$g.prototype._$get_color,function($v){this._focus&&this.nativeInput.setColor($v),$W.superSet($qv,this,"color",this._content?$v:this._promptColor),this._originColor=$v}),$Y(0,$v,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($v){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$Y(0,$v,"multiline",function(){return this._multiline},function($v){this._multiline=$v,this.valign=$v?"top":"middle"}),$Y(0,$v,"maxChars",function(){return this._maxChars},function($v){$v<=0&&($v=1e5),this._maxChars=$v}),$Y(0,$v,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($v){$W.superSet($qv,this,"color",this._originColor),$v+="",this._focus?(this.nativeInput.value=$v||"",this.event("change")):(this._multiline||($v=$v.replace(/\r?\n/g,"")),(this._content=$v)?$W.superSet($qv,this,"text",$v):($W.superSet($qv,this,"text",this._prompt),$W.superSet($qv,this,"color",this.promptColor)))}),$Y(0,$v,"nativeInput",function(){return $r.iframeInput?$r.iframeInput:this._multiline?$r.area:$r.input}),$Y(0,$v,"prompt",function(){return this._prompt},function($v){!this._text&&$v&&$W.superSet($qv,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$W.superSet($qv,this,"text",this._text==this._prompt?$v:this._text):$W.superSet($qv,this,"text",$v),this._prompt=$qv.langPacks&&$qv.langPacks[$v]?$qv.langPacks[$v]:$v}),$Y(0,$v,"focus",function(){return this._focus},function($v){var $g=this.nativeInput;this._focus!==$v&&($v?($g.target?$g.target._focusOut():this._setInputMethod(),($g.target=this)._focusIn()):($g.target=null,this._focusOut(),$c.document.body.scrollTop=0,$g.blur(),$i.isConchApp?$g.setPos(-1e4,-1e4):$r.inputContainer.contains($g)&&$r.inputContainer.removeChild($g)))}),$Y(0,$v,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($v){$v?(-1<($v="[^"+$v+"]").indexOf("^^")&&($v=$v.replace("^^","")),this._restrictPattern=new RegExp($v,"g")):this._restrictPattern=null}),$Y(0,$v,"editable",function(){return this._editable},function($v){this._editable=$v,$i.isConchApp&&$r.input.setForbidEdit(!$v)}),$Y(0,$v,"promptColor",function(){return this._promptColor},function($v){this._promptColor=$v,this._content||$W.superSet($qv,this,"color",$v)}),$Y(0,$v,"type",function(){return this._type},function($v){this._getCSSStyle().password="password"==$v,this._type=$v,$i.isConchApp&&this.nativeInput.setType($v)}),$Y(0,$v,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($v){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$Y(0,$v,"asPassword",function(){return this._getCSSStyle().password},function($v){this._getCSSStyle().password=$v,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$r.__init__=function(){$r._createInputElement(),$c.onMobile&&$i.canvas.addEventListener($r.IOS_IFRAME?$c.onMiniGame?"touchend":"click":"touchend",$r._popupInputMethod)},$r._popupInputMethod=function($v){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$r._createInputElement=function(){$r._initInput($r.area=$c.createElement("textarea")),$r._initInput($r.input=$c.createElement("input")),$r._createIOSInputElement(),($r.inputContainer=$c.createElement("div")).style.position="absolute",$r.inputContainer.style.zIndex=1e5,$c.container.appendChild($r.inputContainer),$r.inputContainer.setPos=function($v,$g){$r.inputContainer.style.left=$v+"px",$r.inputContainer.style.top=$g+"px"}},$r._createIOSInputElement=function(){if($r.IS_IOS){if($c.getElementById("inputIframe"))return;var $g=$c.createElement("iframe");$g.id="inputIframe",$g.onload=function(){$g.style="position: none; width: 0%; height: 0%;";var $v=$g.contentDocument.getElementsByTagName("input");$v=$v?$v[0]:null,($r.iframeInput=$v)&&$r._initInput($v)},$c.container.appendChild($g),$g.src="./input.html"}},$r._reLoadIOSInputElement=function(){var $v=$c.getElementById("inputIframe");$v&&($r.iframeInput.target&&($r.iframeInput.target.focus=!1),$r.iframeInput.onblur=null,$r.iframeInput.onload=null,$v.src="./input.html")},$r._showIOSInput=function(){$c.getElementById("inputIframe")&&($r.iframeInput.value=$r.iframeInput.target.text,$r.iframeInput.onblur=function(){$r._reLoadIOSInputElement()})},$r._initInput=function($g){var $v=$g.style;$v.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$v.resize="none",$v.backgroundColor="transparent",$v.border="none",$v.outline="none",$v.zIndex=1,$g.addEventListener("input",$r._processInputting),$g.addEventListener("mousemove",$r._stopEvent),$g.addEventListener("mousedown",$r._stopEvent),$g.addEventListener("touchmove",$r._stopEvent),$g.setFontFace=function($v){$g.style.fontFamily=$v},$i.isConchApp||($g.setColor=function($v){$g.style.color=$v},$g.setFontSize=function($v){$g.style.fontSize=$v+"px"})},$r._processInputting=function($v){var $g=laya.display.Input.inputElement.target;if($g){var $Q=laya.display.Input.inputElement.value;$g._restrictPattern&&($Q=$Q.replace(/\u2006|\x27/g,""),$g._restrictPattern.test($Q)&&($Q=$Q.replace($g._restrictPattern,""),laya.display.Input.inputElement.value=$Q)),$g._text=$Q,$g.event("input")}},$r._stopEvent=function($v){"touchmove"==$v.type&&$v.preventDefault(),$v.stopPropagation&&$v.stopPropagation()},$r.TYPE_TEXT="text",$r.TYPE_PASSWORD="password",$r.TYPE_EMAIL="email",$r.TYPE_URL="url",$r.TYPE_NUMBER="number",$r.TYPE_RANGE="range",$r.TYPE_DATE="date",$r.TYPE_MONTH="month",$r.TYPE_WEEK="week",$r.TYPE_TIME="time",$r.TYPE_DATE_TIME="datetime",$r.TYPE_DATE_TIME_LOCAL="datetime-local",$r.TYPE_SEARCH="search",$r.input=null,$r.area=null,$r.inputElement=null,$r.inputContainer=null,$r.confirmButton=null,$r.promptStyleDOM=null,$r.inputHeight=45,$r.isInputting=!1,$r.stageMatrix=null,$a($r,["IOS_IFRAME",function(){return this.IOS_IFRAME=$c.onIOS&&$c.window.top!=$c.window.self}]),$a($r,["IS_IOS",function(){return this.IS_IOS=!1}]),$r}($qv),$Pv=function($v){function $Q($v,$g){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$Q.__super.call(this),$v&&this._init_($v,$g)}$t($Q,"laya.resource.HTMLImage",$Gv);var $g=$Q.prototype;return $g._init_=function($v,$g){this._src=$v,this._source=new $c.window.Image,$g&&($g.onload&&(this.onload=$g.onload),$g.onerror&&(this.onerror=$g.onerror),$g.onCreate&&$g.onCreate(this)),0!=$v.indexOf("data:image")&&(this._source.crossOrigin=""),$v&&(this._source.src=$v)},$g.recreateResource=function(){var $v=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $g=this;this._source=new $c.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($g._needReleaseAgain)return $g._needReleaseAgain=!1,$g._source.onload=null,void($g._source=null);$g._source.onload=null,$g.memorySize=$v._w*$v._h*4,$g._recreateLock=!1,$g.completeCreate()},this._source.src=this._src}},$g.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$g.onresize=function(){this._w=this._source.width,this._h=this._source.height},$Y(0,$g,"onload",null,function($v){var $g=this;this._onload=$v,this._source&&(this._source.onload=null!=this._onload?function(){$g.onresize(),$g._onload()}:null)}),$Y(0,$g,"onerror",null,function($v){var $g=this;this._onerror=$v,this._source&&(this._source.onerror=null!=this._onerror?function(){$g._onerror()}:null)}),$Y(0,$g,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($v){this._enableMerageInAtlas=$v,$i.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$v)}),$Q.create=function($v,$g){return new $Q($v,$g)},$Q}(),$Wv=(function($k){function $v(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$v.__super.call(this)}$t($v,"laya.display.EffectAnimation",$k);var $g=$v.prototype;$g._onOtherBegin=function($v){$v!=this&&this.stop()},$g.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$g._onPlayAction=function(){this.play(0,!1)},$g.play=function($v,$g,$Q,$d){void 0===$v&&($v=0),void 0===$g&&($g=!0),void 0===$Q&&($Q=""),void 0===$d&&($d=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$v,$g,$Q,$d))},$g._recordInitData=function(){if(this._aniKeys){var $v,$g,$Q=0;for($v=this._aniKeys.length,$Q=0;$Q<$v;$Q++)$g=this._aniKeys[$Q],this._initData[$g]=this._target[$g]}},$g._displayToIndex=function($v){if(this._animationData){$v<0&&($v=0),$v>this._count&&($v=this._count);var $g=this._animationData.nodes,$Q=0,$d=$g.length;for($d=1<$d?1:$d,$Q=0;$Q<$d;$Q++)this._displayNodeToFrame($g[$Q],$v)}},$g._displayNodeToFrame=function($v,$g,$Q){if(this._target){var $d;$d=this._target;var $r,$k,$$,$b,$a=$v.frames,$M=$v.keys,$Y=0,$D=$M.length;$b=$v.secondFrames;var $J,$p,$T,$t,$q=0;for($Y=0;$Y<$D;$Y++)$k=$a[$r=$M[$Y]],$$=-1==($q=$b[$r])?this._initData[$r]:$g<$q?($T=($p=$v.keyframes[$r])[0]).tween?(null==($J=$y[$T.tweenMethod])&&($J=$y.linearNone),$t=$p[1],$J($g,this._initData[$r],$t.value-this._initData[$r],$t.index)):this._initData[$r]:$k.length>$g?$k[$g]:$k[$k.length-1],$d[$r]=$$}},$g._calculateNodeKeyFrames=function($v){$k.prototype._calculateNodeKeyFrames.call(this,$v);var $g,$Q,$d,$r=$v.keyframes;$v.target;for($g in $d={},$v.secondFrames=$d,$r)($Q=$r[$g]).length<=1?$d[$g]=-1:$d[$g]=$Q[1].index},$Y(0,$g,"target",function(){return this._target},function($v){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$v,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$Y(0,$g,"playEvent",null,function($v){(this._playEvents=$v)&&this.addEvent()}),$Y(0,$g,"effectData",null,function($v){var $g;$v&&(($g=$v.animations)&&$g[0]&&(this._setUp({},$g[0]),$g[0].nodes&&$g[0].nodes[0]&&(this._aniKeys=$g[0].nodes[0].keys)))}),$Y(0,$g,"effectClass",null,function($v){var $g,$Q;(this._effectClass=$L.getClass($v),this._effectClass)&&(($g=this._effectClass.uiView)&&($Q=$g.animations)&&$Q[0]&&(this._setUp({},$Q[0]),$Q[0].nodes&&$Q[0].nodes[0]&&(this._aniKeys=$Q[0].nodes[0].keys)))}),$v.EffectAnimationBegin="effectanimationbegin"}($Av),function($g){var $E;function $V(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$V.__super.call(this)}$t($V,"laya.utils.GraphicAnimation",$g);var $v=$V.prototype;return $v._parseNodeList=function($v){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$v.compId]=$v.props,$v.compId&&this._nodeList.push($v.compId);var $g=$v.child;if($g){var $Q=0,$d=$g.length;for($Q=0;$Q<$d;$Q++)this._parseNodeList($g[$Q])}},$v._calGraphicData=function($v){var $g;if(this._setUp(null,$v),this._createGraphicData(),this._nodeIDAniDic)for($g in this._nodeIDAniDic)this._nodeIDAniDic[$g]=null},$v._createGraphicData=function(){var $v,$g=[],$Q=0,$d=this.count,$r=this._animationNewFrames;for($r||($r=[]),$Q=0;$Q<$d;$Q++)!$r[$Q]&&$v||($v=this._createFrameGraphic($Q)),$g.push($v);this._gList=$g},$v._createFrameGraphic=function($v){var $g=$Z.createGraphics();return $V._rootMatrix||($V._rootMatrix=new $f),this._updateNodeGraphic(this._rootNode,$v,$V._rootMatrix,$g),$g},$v._updateNodeGraphic=function($v,$g,$Q,$d,$r){var $k;void 0===$r&&($r=1);var $$,$b,$a,$M=($k=this._nodeGDic[$v.compId]=this._getNodeGraphicData($v.compId,$g,this._nodeGDic[$v.compId])).alpha*$r;if(!($M<.01)&&($k.resultTransform||($k.resultTransform=$f.create()),$$=$k.resultTransform,$f.mul($k.transform,$Q,$$),$k.skin&&($b=this._getTextureByUrl($k.skin))&&($$._checkTransform()?($d.drawTexture($b,0,0,$k.width,$k.height,$$,$M),$k.resultTransform=null):$d.drawTexture($b,$$.tx,$$.ty,$k.width,$k.height,null,$M)),$a=$v.child)){var $Y,$D=0;for($Y=$a.length,$D=0;$D<$Y;$D++)this._updateNodeGraphic($a[$D],$g,$$,$d,$M)}},$v._updateNoChilds=function($v,$g){if($v.skin){var $Q=this._getTextureByUrl($v.skin);if($Q){var $d=$v.transform;$d._checkTransform();!$d.bTransform?$g.drawTexture($Q,$d.tx,$d.ty,$v.width,$v.height,null,$v.alpha):$g.drawTexture($Q,0,0,$v.width,$v.height,$d.clone(),$v.alpha)}}},$v._updateNodeGraphic2=function($v,$g,$Q){var $d;if($d=this._nodeGDic[$v.compId]=this._getNodeGraphicData($v.compId,$g,this._nodeGDic[$v.compId]),$v.child){var $r=$d.transform;$r._checkTransform();var $k,$$;$$=($k=!$r.bTransform)&&(0!=$r.tx||0!=$r.ty);var $b,$a,$M;if(($b=$r.bTransform||1!=$d.alpha)&&$Q.save(),1!=$d.alpha&&$Q.alpha($d.alpha),$k?$$&&$Q.translate($r.tx,$r.ty):$Q.transform($r.clone()),$a=$v.child,$d.skin&&($M=this._getTextureByUrl($d.skin))&&$Q.drawTexture($M,0,0,$d.width,$d.height),$a){var $Y,$D=0;for($Y=$a.length,$D=0;$D<$Y;$D++)this._updateNodeGraphic2($a[$D],$g,$Q)}$b?$Q.restore():$k?$$&&$Q.translate(-$r.tx,-$r.ty):$Q.transform($r.clone().invert())}else this._updateNoChilds($d,$Q)},$v._calculateNodeKeyFrames=function($v){$g.prototype._calculateNodeKeyFrames.call(this,$v),this._nodeIDAniDic[$v.target]=$v},$v.getNodeDataByID=function($v){return this._nodeIDAniDic[$v]},$v._getParams=function($v,$g,$Q,$d){var $r=$V._temParam;$r.length=$g.length;var $k=0,$$=$g.length;for($k=0;$k<$$;$k++)$r[$k]=this._getObjVar($v,$g[$k][0],$Q,$g[$k][1],$d);return $r},$v._getObjVar=function($v,$g,$Q,$d,$r){if($v.hasOwnProperty($g)){var $k=$v[$g];if($Q>=$k.length&&($Q=$k.length-1),null!=$v[$g][$Q])return $v[$g][$Q]}return $r.hasOwnProperty($g)?$r[$g]:$d},$v._getNodeGraphicData=function($v,$g,$Q){$Q||($Q=$E.create()),$Q.transform?$Q.transform.identity():$Q.transform=$f.create();var $d=this.getNodeDataByID($v);if(!$d)return $Q;var $r,$k,$$=$d.frames,$b=this._getParams($$,$V._drawTextureCmd,$g,this._nodeDefaultProps[$v]),$a=$b[0],$M=NaN,$Y=NaN,$D=$b[5],$J=$b[6],$p=$b[13],$T=$b[14],$t=$b[7],$q=$b[8],$C=$b[9],$G=$b[11],$s=$b[12];$M=$b[3],$Y=$b[4],0!=$M&&0!=$Y||($a=null),-1==$M&&($M=0),-1==$Y&&($Y=0),$Q.skin=$a,$Q.width=$M,$Q.height=$Y,$a&&(($r=this._getTextureByUrl($a))?($M||($M=$r.sourceWidth),$Y||($Y=$r.sourceHeight)):console.warn("lost skin:",$a,",you may load pics first")),$Q.alpha=$b[10],$k=$Q.transform,0!=$p&&($D=$p*$M),0!=$T&&($J=$T*$Y),0==$D&&0==$J||$k.translate(-$D,-$J);var $A=null;if($C||1!==$t||1!==$q||$G||$s){($A=$V._tempMt).identity(),$A.bTransform=!0;var $h=.0174532922222222*($C-$G),$P=.0174532922222222*($C+$s),$W=Math.cos($P),$F=Math.sin($P),$l=Math.sin($h),$o=Math.cos($h);$A.a=$t*$W,$A.b=$t*$F,$A.c=-$q*$l,$A.d=$q*$o,$A.tx=$A.ty=0}return $A&&($k=$f.mul($k,$A,$k)),$k.translate($b[1],$b[2]),$Q},$v._getTextureByUrl=function($v){return $bv.getRes($v)},$v.setAniData=function($v,$g){if($v.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$v,this._parseNodeList($v);var $Q,$d={},$r=[],$k=$v.animations,$$=0,$b=$k.length;for($$=0;$$<$b;$$++)if($Q=$k[$$],this._labels=null,(!$g||$g==$Q.name)&&$Q){try{this._calGraphicData($Q)}catch($v){console.warn("parse animation fail:"+$Q.name+",empty animation created"),this._gList=[]}var $a={};$a.interval=1e3/$Q.frameRate,$a.frames=this._gList,$a.labels=this._labels,$a.name=$Q.name,$r.push($a),$d[$Q.name]=$a}this.animationList=$r,this.animationDic=$d}$V._temParam.length=0},$v.parseByData=function($v){var $g,$Q;$g=$v.nodeRoot,$Q=$v.aniO,delete $v.nodeRoot,delete $v.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$g,this._parseNodeList($g),this._labels=null;try{this._calGraphicData($Q)}catch($v){console.warn("parse animation fail:"+$Q.name+",empty animation created"),this._gList=[]}var $d=$v;return $d.interval=1e3/$Q.frameRate,$d.frames=this._gList,$d.labels=this._labels,$d.name=$Q.name,$d},$v.setUpAniData=function($v){if($v.animations){var $g,$Q={},$d=[],$r=$v.animations,$k=0,$$=$r.length;for($k=0;$k<$$;$k++)if($g=$r[$k]){var $b={};$b.name=$g.name,$b.aniO=$g,$b.nodeRoot=$v,$d.push($b),$Q[$g.name]=$b}this.animationList=$d,this.animationDic=$Q}},$v._clear=function(){var $v,$g;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($v in this._nodeGDic)($g=this._nodeGDic[$v])&&$g.recover();this._nodeGDic=null},$V.parseAnimationByData=function($v){var $g;return $V._I||($V._I=new $V),$g=$V._I.parseByData($v),$V._I._clear(),$g},$V.parseAnimationData=function($v){var $g;return $V._I||($V._I=new $V),$V._I.setUpAniData($v),($g={}).animationList=$V._I.animationList,$g.animationDic=$V._I.animationDic,$V._I._clear(),$g},$V._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$V._temParam=[],$V._I=null,$V._rootMatrix=null,$a($V,["_tempMt",function(){return this._tempMt=new $f}]),$V.__init$=function(){$E=function(){function $v(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $t($v,""),$v.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$R.recover("GraphicNode",this)},$v.create=function(){return $R.getItemByClass("GraphicNode",$v)},$v}()},$V}($Av));$W.__init([$M,$av,$i,$c,$U,$o,$v,$Wv])}(window,document,Laya),function($v,$g,$Q){$Q.un,$Q.uns,$Q.static;var $d=$Q.class;$Q.getset,$Q.__newvec;new(function(){function $v(){}return $d($v,"LayaMain"),$v}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($v,$g){"use strict";for(var $Q in Object.defineProperty($g,"__esModule",{value:!0}),Laya){var $d=Laya[$Q];$d&&$d.__isclass&&($g[$Q]=$d)}}),function($v,$g,$P){$P.un,$P.uns;var $$=$P.static,$J=$P.class,$d=$P.getset,$k=$P.__newvec,$Y=laya.maths.Arith,$D=laya.maths.Bezier,$Q=laya.resource.Bitmap,$p=laya.utils.Browser,$a=laya.utils.Byte,$T=laya.utils.Color,$W=(laya.filters.ColorFilter,$P.Config),$r=laya.resource.Context,$F=(laya.events.Event,laya.filters.Filter),$b=laya.display.Graphics,$M=laya.resource.HTMLCanvas,$t=(laya.utils.HTMLChar,laya.resource.HTMLImage),$q=laya.resource.HTMLSubImage,$l=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$o=laya.maths.Point,$E=laya.maths.Rectangle,$C=laya.renders.Render,$G=(laya.renders.RenderContext,laya.renders.RenderSprite),$s=laya.resource.Resource,$A=laya.resource.ResourceManager,$h=laya.utils.RunDriver,$V=laya.display.Sprite,$Z=laya.display.Stage,$f=laya.utils.Stat,$X=laya.utils.StringKey,$N=(laya.display.css.Style,laya.system.System),$i=laya.display.Text,$x=laya.resource.Texture,$w=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$m=laya.utils.VectorGraphManager;laya.utils.WordText;$P.interface("laya.webgl.shapes.IShape"),$P.interface("laya.webgl.submit.ISubmit"),$P.interface("laya.webgl.text.ICharSegment"),$P.interface("laya.webgl.canvas.save.ISaveData"),$P.interface("laya.webgl.resource.IMergeAtlasBitmap"),$P.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $K=function(){function $v(){}$J($v,"laya.filters.webgl.FilterActionGL");var $g=$v.prototype;return $P.imps($g,{"laya.filters.IFilterActionGL":!0}),$g.setValue=function($v){},$g.setValueMix=function($v){},$g.apply3d=function($v,$g,$Q,$d,$r){return null},$g.apply=function($v){return null},$d(0,$g,"typeMix",function(){return 0}),$v}(),$c=function(){function $v(){}return $J($v,"laya.webgl.shader.ShaderValue"),$v}(),$B=function(){var $d,$r;function $v($v,$g,$Q){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $r,void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),this._cells=null,this._rowInfo=null,this._init($v,$g),this._atlasID=$Q}$J($v,"laya.webgl.atlas.AtlasGrid");var $g=$v.prototype;return $g.getAltasID=function(){return this._atlasID},$g.setAltasID=function($v){0<=$v&&(this._atlasID=$v)},$g.addTex=function($v,$g,$Q){var $d=this._get($g,$Q);return 0==$d.ret||(this._fill($d.x,$d.y,$g,$Q,$v),this._texCount++),$d},$g._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$g._init=function($v,$g){if(this._width=$v,this._height=$g,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$k(this._height);for(var $Q=0;$Q<this._height;$Q++)this._rowInfo[$Q]=new $d;return this._clear(),!0},$g._get=function($v,$g){var $Q=new $L;if($v>=this._failSize.width&&$g>=this._failSize.height)return $Q;for(var $d=-1,$r=-1,$k=this._width,$$=this._height,$b=this._cells,$a=0;$a<$$;$a++)if(!(this._rowInfo[$a].spaceCount<$v))for(var $M=0;$M<$k;){var $Y=3*($a*$k+$M);if(0!=$b[$Y]||$b[1+$Y]<$v||$b[2+$Y]<$g)$M+=$b[1+$Y];else{$d=$M,$r=$a;for(var $D=0;$D<$v;$D++)if($b[3*$D+$Y+2]<$g){$d=-1;break}if(!($d<0))return $Q.ret=!0,$Q.x=$d,$Q.y=$r,$Q;$M+=$b[1+$Y]}}return $Q},$g._fill=function($v,$g,$Q,$d,$r){var $k=this._width,$$=this._height;this._check($v+$Q<=$k&&$g+$d<=$$);for(var $b=$g;$b<$d+$g;++$b){this._check(this._rowInfo[$b].spaceCount>=$Q),this._rowInfo[$b].spaceCount-=$Q;for(var $a=0;$a<$Q;$a++){var $M=3*($v+$b*$k+$a);this._check(0==this._cells[$M]),this._cells[$M]=$r,this._cells[1+$M]=$Q,this._cells[2+$M]=$d}}if(0<$v)for($b=0;$b<$d;++$b){var $Y=0;for($a=$v-1;0<=$a&&0==this._cells[3*(($g+$b)*$k+$a)];--$a,++$Y);for($a=$Y;0<$a;--$a)this._cells[3*(($g+$b)*$k+$v-$a)+1]=$a,this._check(0<$a)}if(0<$g)for($a=$v;$a<$v+$Q;++$a){for($Y=0,$b=$g-1;0<=$b&&0==this._cells[3*($a+$b*$k)];--$b,$Y++);for($b=$Y;0<$b;--$b)this._cells[3*($a+($g-$b)*$k)+2]=$b,this._check(0<$b)}},$g._check=function($v){0==$v&&console.log("xtexMerger 错误啦")},$g._clear=function(){for(var $v=this._texCount=0;$v<this._height;$v++)this._rowInfo[$v].spaceCount=this._width;for(var $g=0;$g<this._height;$g++)for(var $Q=0;$Q<this._width;$Q++){var $d=3*($g*this._width+$Q);this._cells[$d]=0,this._cells[1+$d]=this._width-$Q,this._cells[2+$d]=this._width-$g}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$v.__init$=function(){$d=function(){function $v(){this.spaceCount=0}return $J($v,""),$v}(),$r=function(){function $v(){this.width=0,this.height=0}return $J($v,""),$v}()},$v}(),$j=function(){function $C($v,$g,$Q,$d){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$v,this._height=$g,this._gridSize=$Q,this._maxAtlaserCount=$d,this._gridNumX=$v/$Q,this._gridNumY=$g/$Q,this._curAtlasIndex=0,this._atlaserArray=[]}$J($C,"laya.webgl.atlas.AtlasResourceManager");var $v=$C.prototype;return $v.setAtlasParam=function($v,$g,$Q,$d){if(1==this._setAtlasParam)return $C._sid_=0,this._width=$v,this._height=$g,this._gridSize=$Q,this._maxAtlaserCount=$d,this._gridNumX=$v/$Q,this._gridNumY=$g/$Q,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$v.pushData=function($v){var $g,$Q=$v.bitmap,$d=-1,$r=null,$k=0,$$=0;for($k=0,$g=this._atlaserArray.length;$k<$g&&($$=(this._curAtlasIndex+$k)%$g,-1==($d=($r=this._atlaserArray[$$]).findBitmapIsExist($Q)));$k++);if(-1!=$d){var $b=$r.InAtlasWebGLImagesOffsetValue[$d];return $T=$b[0],$t=$b[1],$r.addToAtlas($v,$T,$t),!0}this._setAtlasParam=!1;for(var $a=Math.ceil(($v.bitmap.width+2)/this._gridSize),$M=Math.ceil(($v.bitmap.height+2)/this._gridSize),$Y=!1,$D=0;$D<2;$D++){var $J=this._maxAtlaserCount;for($k=0;$k<$J;$k++){$$=(this._curAtlasIndex+$k)%$J,this._atlaserArray.length-1>=$$||this._atlaserArray.push(new $Ev(this._gridNumX,this._gridNumY,this._width,this._height,$C._sid_++));var $p=this._atlaserArray[$$],$T=0,$t=0,$q=$p.addTex(1,$a,$M);if($q.ret){$T=$q.x*this._gridSize+1,$t=$q.y*this._gridSize+1,$Q.lock=!0,$p.addToAtlasTexture($Q,$T,$t),$p.addToAtlas($v,$T,$t),$Y=!0,this._curAtlasIndex=$$;break}}if($Y)break;this._atlaserArray.push(new $Ev(this._gridNumX,this._gridNumY,this._width,this._height,$C._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $Y||console.log(">>>AtlasManager pushData error"),$Y},$v.addToAtlas=function($v){laya.webgl.atlas.AtlasResourceManager.instance.pushData($v)},$v.garbageCollection=function(){if(!0===this._needGC){for(var $v=this._atlaserArray.length-this._maxAtlaserCount,$g=0;$g<$v;$g++)this._atlaserArray[$g].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$v),this._atlaserArray.splice(0,$v),this._needGC=!1}return!0},$v.freeAll=function(){for(var $v=0,$g=this._atlaserArray.length;$v<$g;$v++)this._atlaserArray[$v].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$v.getAtlaserCount=function(){return this._atlaserArray.length},$v.getAtlaserByIndex=function($v){return this._atlaserArray[$v]},$d(1,$C,"instance",function(){return $C._Instance||($C._Instance=new $C(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$C._Instance}),$d(1,$C,"enabled",function(){return $W.atlasEnable}),$d(1,$C,"atlasLimitWidth",function(){return $C._atlasLimitWidth},function($v){$C._atlasLimitWidth=$v}),$d(1,$C,"atlasLimitHeight",function(){return $C._atlasLimitHeight},function($v){$C._atlasLimitHeight=$v}),$C._enable=function(){$W.atlasEnable=!0},$C._disable=function(){$W.atlasEnable=!1},$C.__init__=function(){$C.atlasTextureWidth=2048,$C.atlasTextureHeight=2048,$C.maxTextureCount=6,$C.atlasLimitWidth=512,$C.atlasLimitHeight=512},$C._atlasLimitWidth=0,$C._atlasLimitHeight=0,$C.gridSize=16,$C.atlasTextureWidth=0,$C.atlasTextureHeight=0,$C.maxTextureCount=0,$C._atlasRestore=0,$C.BOARDER_TYPE_NO=0,$C.BOARDER_TYPE_RIGHT=1,$C.BOARDER_TYPE_LEFT=2,$C.BOARDER_TYPE_BOTTOM=4,$C.BOARDER_TYPE_TOP=8,$C.BOARDER_TYPE_ALL=15,$C._sid_=0,$C._Instance=null,$C}(),$L=function(){function $v(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $J($v,"laya.webgl.atlas.MergeFillInfo"),$v}(),$H=function(){function $g(){}return $J($g,"laya.webgl.canvas.BlendMode"),$g._init_=function($v){$g.fns=[$g.BlendNormal,$g.BlendAdd,$g.BlendMultiply,$g.BlendScreen,$g.BlendOverlay,$g.BlendLight,$g.BlendMask,$g.BlendDestinationOut],$g.targetFns=[$g.BlendNormalTarget,$g.BlendAddTarget,$g.BlendMultiplyTarget,$g.BlendScreenTarget,$g.BlendOverlayTarget,$g.BlendLightTarget,$g.BlendMask,$g.BlendDestinationOut]},$g.BlendNormal=function($v){$v.blendFunc(1,771)},$g.BlendAdd=function($v){$v.blendFunc(1,772)},$g.BlendMultiply=function($v){$v.blendFunc(774,771)},$g.BlendScreen=function($v){$v.blendFunc(1,1)},$g.BlendOverlay=function($v){$v.blendFunc(1,769)},$g.BlendLight=function($v){$v.blendFunc(1,1)},$g.BlendNormalTarget=function($v){$v.blendFunc(1,771)},$g.BlendAddTarget=function($v){$v.blendFunc(1,772)},$g.BlendMultiplyTarget=function($v){$v.blendFunc(774,771)},$g.BlendScreenTarget=function($v){$v.blendFunc(1,1)},$g.BlendOverlayTarget=function($v){$v.blendFunc(1,769)},$g.BlendLightTarget=function($v){$v.blendFunc(1,1)},$g.BlendMask=function($v){$v.blendFunc(0,770)},$g.BlendDestinationOut=function($v){$v.blendFunc(0,0)},$g.activeBlendFunction=null,$g.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$g.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$g.NORMAL="normal",$g.ADD="add",$g.MULTIPLY="multiply",$g.SCREEN="screen",$g.LIGHT="light",$g.OVERLAY="overlay",$g.DESTINATIONOUT="destination-out",$g.fns=[],$g.targetFns=[],$g}(),$n=function(){function $Q($v){this._color=$T.create("black"),this.setValue($v)}$J($Q,"laya.webgl.canvas.DrawStyle");var $v=$Q.prototype;return $v.setValue=function($v){if($v){if("string"==typeof $v)return void(this._color=$T.create($v));if($v instanceof laya.utils.Color)return void(this._color=$v)}},$v.reset=function(){this._color=$T.create("black")},$v.equal=function($v){return"string"==typeof $v?this._color.strColor===$v:$v instanceof laya.utils.Color&&this._color.numColor===$v.numColor},$v.toColorStr=function(){return this._color.strColor},$Q.create=function($v){var $g;if($v&&("string"==typeof $v?$g=$T.create($v):$v instanceof laya.utils.Color&&($g=$v),$g))return $g._drawStyle||($g._drawStyle=new $Q($v));return laya.webgl.canvas.DrawStyle.DEFAULT},$$($Q,["DEFAULT",function(){return this.DEFAULT=new $Q("#000000")}]),$Q}(),$y=function(){function $v(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$Av.mainContext;this.ib=$_v.create(35048),this.vb=$uv.create(5)}$J($v,"laya.webgl.canvas.Path");var $g=$v.prototype;return $g.addPoint=function($v,$g){this.tempArray.push($v,$g)},$g.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$g.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$g.polygon=function($v,$g,$Q,$d,$r,$k){var $$;return this.geomatrys.push(this._curGeomatry=$$=new $Xv($v,$g,$Q,$d,$r,$k)),$d||($$.fill=!1),null==$k&&($$.borderWidth=0),$$},$g.setGeomtry=function($v){this.geomatrys.push(this._curGeomatry=$v)},$g.drawLine=function($v,$g,$Q,$d,$r){var $k;return this.closePath?this.geomatrys.push(this._curGeomatry=$k=new $fv($v,$g,$Q,$d,$r)):this.geomatrys.push(this._curGeomatry=$k=new $Zv($v,$g,$Q,$d,$r)),$k.fill=!1,$k},$g.update=function(){var $v=this.ib._byteLength,$g=this.geomatrys.length;this.offset=$v;for(var $Q=this.geoStart;$Q<$g;$Q++)this.geomatrys[$Q].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$g,this.count=(this.ib._byteLength-$v)/$tv.BYTES_PIDX},$g.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$g.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$v}(),$e=function(){function $b(){}$J($b,"laya.webgl.canvas.save.SaveBase");var $v=$b.prototype;return $P.imps($v,{"laya.webgl.canvas.save.ISaveData":!0}),$v.isSaveMark=function(){return!1},$v.restore=function($v){this._dataObj[this._valueName]=this._value,($b._cache[$b._cache._length++]=this)._newSubmit&&($v._curSubmit=$kv.RENDERBASE,$v._renderKey=0)},$b._createArray=function(){var $v=[];return $v._length=0,$v},$b._init=function(){var $v=$b._namemap={};return $v[1]="ALPHA",$v[2]="fillStyle",$v[8]="font",$v[256]="lineWidth",$v[512]="strokeStyle",$v[8192]="_mergeID",$v[1024]=$v[2048]=$v[4096]=[],$v[16384]="textBaseline",$v[32768]="textAlign",$v[65536]="_nBlendType",$v[1048576]="shader",$v[2097152]="filters",$v},$b.save=function($v,$g,$Q,$d){if(($v._saveMark._saveuse&$g)!==$g){$v._saveMark._saveuse|=$g;var $r=$b._cache,$k=0<$r._length?$r[--$r._length]:new $b;$k._value=$Q[$k._valueName=$b._namemap[$g]],$k._dataObj=$Q,$k._newSubmit=$d;var $$=$v._save;$$[$$._length++]=$k}},$b._cache=laya.webgl.canvas.save.SaveBase._createArray(),$b._namemap=$b._init(),$b}(),$R=function(){function $k(){this._clipRect=new $E}$J($k,"laya.webgl.canvas.save.SaveClipRect");var $v=$k.prototype;return $P.imps($v,{"laya.webgl.canvas.save.ISaveData":!0}),$v.isSaveMark=function(){return!1},$v.restore=function($v){$v._clipRect=this._clipSaveRect,($k._cache[$k._cache._length++]=this)._submitScissor.submitLength=$v._submits._length-this._submitScissor.submitIndex,$v._curSubmit=$kv.RENDERBASE,$v._renderKey=0},$k.save=function($v,$g){if(131072!=(131072&$v._saveMark._saveuse)){$v._saveMark._saveuse|=131072;var $Q=$k._cache,$d=0<$Q._length?$Q[--$Q._length]:new $k;$d._clipSaveRect=$v._clipRect,$v._clipRect=$d._clipRect.copyFrom($v._clipRect),$d._submitScissor=$g;var $r=$v._save;$r[$r._length++]=$d}},$$($k,["_cache",function(){return this._cache=$e._createArray()}]),$k}(),$z=function(){function $p(){this._contextX=0,this._contextY=0,this._clipRect=new $E,this._rect=new $E,this._matrix=new $l}$J($p,"laya.webgl.canvas.save.SaveClipRectStencil");var $v=$p.prototype;return $P.imps($v,{"laya.webgl.canvas.save.ISaveData":!0}),$v.isSaveMark=function(){return!1},$v.restore=function($v){$Yv.restore($v,this._rect,this._saveMatrix,this._contextX,this._contextY),$v._clipRect=this._clipSaveRect,$v._curMat=this._saveMatrix,$v._x=this._contextX,$v._y=this._contextY,$p._cache[$p._cache._length++]=this,$v._curSubmit=$kv.RENDERBASE},$p.save=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){if(262144!=(262144&$v._saveMark._saveuse)){$v._saveMark._saveuse|=262144;var $Y=$p._cache,$D=0<$Y._length?$Y[--$Y._length]:new $p;$D._clipSaveRect=$v._clipRect,$D._clipRect.setTo($$,$b,$a,$M),$v._clipRect=$D._clipRect,$D._rect.x=$Q,$D._rect.y=$d,$D._rect.width=$r,$D._rect.height=$k,$D._contextX=$v._x,$D._contextY=$v._y,$D._saveMatrix=$v._curMat,$v._curMat.copyTo($D._matrix),$v._curMat=$D._matrix,$D._submitStencil=$g;var $J=$v._save;$J[$J._length++]=$D}},$$($p,["_cache",function(){return this._cache=$e._createArray()}]),$p}(),$U=function(){function $d(){this._saveuse=0}$J($d,"laya.webgl.canvas.save.SaveMark");var $v=$d.prototype;return $P.imps($v,{"laya.webgl.canvas.save.ISaveData":!0}),$v.isSaveMark=function(){return!0},$v.restore=function($v){$v._saveMark=this._preSaveMark,$d._no[$d._no._length++]=this},$d.Create=function($v){var $g=$d._no,$Q=0<$g._length?$g[--$g._length]:new $d;return $Q._saveuse=0,$Q._preSaveMark=$v._saveMark,$v._saveMark=$Q},$$($d,["_no",function(){return this._no=$e._createArray()}]),$d}(),$I=function(){function $k(){this._matrix=new $l}$J($k,"laya.webgl.canvas.save.SaveTransform");var $v=$k.prototype;return $P.imps($v,{"laya.webgl.canvas.save.ISaveData":!0}),$v.isSaveMark=function(){return!1},$v.restore=function($v){$v._curMat=this._savematrix,$k._no[$k._no._length++]=this},$k.save=function($v){var $g=$v._saveMark;if(2048!=(2048&$g._saveuse)){$g._saveuse|=2048;var $Q=$k._no,$d=0<$Q._length?$Q[--$Q._length]:new $k;$d._savematrix=$v._curMat,$v._curMat=$v._curMat.copyTo($d._matrix);var $r=$v._save;$r[$r._length++]=$d}},$$($k,["_no",function(){return this._no=$e._createArray()}]),$k}(),$S=function(){function $r(){}$J($r,"laya.webgl.canvas.save.SaveTranslate");var $v=$r.prototype;return $P.imps($v,{"laya.webgl.canvas.save.ISaveData":!0}),$v.isSaveMark=function(){return!1},$v.restore=function($v){$v._curMat;$v._x=this._x,$v._y=this._y,$r._no[$r._no._length++]=this},$r.save=function($v){var $g=$r._no,$Q=0<$g._length?$g[--$g._length]:new $r;$Q._x=$v._x,$Q._y=$v._y;var $d=$v._save;$d[$d._length++]=$Q},$$($r,["_no",function(){return this._no=$e._createArray()}]),$r}(),$O=function(){function $v(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $E}$J($v,"laya.webgl.resource.RenderTargetMAX");var $g=$v.prototype;return $g.setSP=function($v){this._sp=$v},$g.size=function($v,$g){var $Q=this;this._width!==$v||this._height!==$g?(this.repaint=!0,this._width=$v,this._height=$g,this.target?this.target.size($v,$g):this.target=$mv.create($v,$g),this.target.hasListener("recovered")||this.target.on("recovered",this,function($v){$P.timer.callLater($Q._sp,$Q._sp.repaint)})):this.target.size($v,$g)},$g._flushToTarget=function($v,$g){if(!$g._destroy){var $Q=$Gv.worldScissorTest,$d=$Gv.worldClipRect;$Gv.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$Gv.worldScissorTest=!1,$Av.mainContext.disable(3089);var $r=$Gv.worldAlpha,$k=$Gv.worldMatrix4,$$=$Gv.worldMatrix,$b=$Gv.worldFilters,$a=$Gv.worldShaderDefines;if($Gv.worldMatrix=$l.EMPTY,$Gv.restoreTempArray(),$Gv.worldMatrix4=$Gv.TEMPMAT4_ARRAY,$Gv.worldAlpha=1,$Gv.worldFilters=null,$Gv.worldShaderDefines=null,$wv.activeShader=null,$g.start(),$W.showCanvasMark?$g.clear(0,1,0,.3):$g.clear(0,0,0,0),$v.flush(),$g.end(),$wv.activeShader=null,$Gv.worldAlpha=$r,$Gv.worldMatrix4=$k,$Gv.worldMatrix=$$,$Gv.worldFilters=$b,$Gv.worldShaderDefines=$a,$Gv.worldScissorTest=$Q){var $M=$Gv.height-$d.y-$d.height;$Av.mainContext.scissor($d.x,$M,$d.width,$d.height),$Av.mainContext.enable(3089)}$Gv.worldClipRect=$d}},$g.flush=function($v){this.repaint&&(this._flushToTarget($v,this.target),this.repaint=!1)},$g.drawTo=function($v,$g,$Q,$d,$r){$v.drawTexture(this.target.getTexture(),$g,$Q,$d,$r,0,0)},$g.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$v}(),$_=function(){function $v(){this.ALPHA=1,this.shaderType=0,this.defines=new $Vv}return $J($v,"laya.webgl.shader.d2.Shader2D"),$v.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$v.__init__=function(){var $v,$g;$Uv.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$Uv.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$Uv.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$Uv.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$Uv.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$Uv.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$Uv.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$Uv.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$v="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$g='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$Uv.preCompile2D(0,1,$v,$g,null),$v="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$g='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$Uv.preCompile2D(0,2,$v,$g,null),$v="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$g="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$Uv.preCompile2D(0,4,$v,$g,null),$v="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$g='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$Uv.preCompile2D(0,256,$v,$g,null),$v="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$g="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$Uv.preCompile2D(0,512,$v,$g,null)},$v}(),$u=function(){function $g($v,$g,$Q){this._value=0,this._name2int=$v,this._int2name=$g,this._int2nameMap=$Q}$J($g,"laya.webgl.shader.ShaderDefines");var $v=$g.prototype;return $v.add=function($v){return"string"==typeof $v&&($v=this._name2int[$v]),this._value|=$v,this._value},$v.addInt=function($v){return this._value|=$v,this._value},$v.remove=function($v){return"string"==typeof $v&&($v=this._name2int[$v]),this._value&=~$v,this._value},$v.isDefine=function($v){return(this._value&$v)===$v},$v.getValue=function(){return this._value},$v.setValue=function($v){this._value=$v},$v.toNameDic=function(){var $v=this._int2nameMap[this._value];return $v||$g._toText(this._value,this._int2name,this._int2nameMap)},$g._reg=function($v,$g,$Q,$d){$d[$Q[$v]=$g]=$v},$g._toText=function($v,$g,$Q){var $d=$Q[$v];if($d)return $d;for(var $r={},$k=1,$$=0;$$<32&&!($v<($k=1<<$$));$$++)if($v&$k){var $b=$g[$k];$b&&($r[$b]="")}return $Q[$v]=$r},$g._toInt=function($v,$g){for(var $Q=$v.split("."),$d=0,$r=0,$k=$Q.length;$r<$k;$r++){var $$=$g[$Q[$r]];if(!$$)throw new Error("Defines to int err:"+$v+"/"+$Q[$r]);$d|=$$}return $d},$g}(),$vv=function(){function $$(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $l}$J($$,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $v=$$.prototype;return $v.init=function($v,$g,$Q){if($g)this._vs=$g;else{this._vs=[];var $d=$v.width,$r=$v.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($d,0,1,0,1,1,1,1),this._vs.push($d,$r,1,1,1,1,1,1),this._vs.push(0,$r,0,1,1,1,1,1)}$Q?this._ps=$Q:($$._defaultPS||($$._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$$._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$v},$v.init2=function($v,$g,$Q,$d,$r){this.transform&&(this.transform=null),$Q?this._ps=$Q:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$d,this._uvs=$r,this.mEleNum=this._ps.length,this.mTexture=$v,($C.isConchNode||$C.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$v._initMyData=function(){var $v=0,$g=0,$Q=4*this._verticles.length;this._vs=$$._tempVS;var $d=!1;if($C.isConchNode||$C.isConchApp?(this._vs.length=$Q,$d=!0):this._vs.length<$Q&&(this._vs.length=$Q,$d=!0),$$._tVSLen=$Q,$d)for(;$v<$Q;)this._vs[$v]=this._verticles[$g],this._vs[$v+1]=this._verticles[$g+1],this._vs[$v+2]=this._uvs[$g],this._vs[$v+3]=this._uvs[$g+1],this._vs[$v+4]=1,this._vs[$v+5]=1,this._vs[$v+6]=1,this._vs[$v+7]=1,$v+=8,$g+=2;else for(;$v<$Q;)this._vs[$v]=this._verticles[$g],this._vs[$v+1]=this._verticles[$g+1],this._vs[$v+2]=this._uvs[$g],this._vs[$v+3]=this._uvs[$g+1],$v+=8,$g+=2},$v.getData2=function($v,$g,$Q){var $d;this.mVBBuffer=$v,this.mIBBuffer=$g,this._initMyData(),$v.appendEx2(this._vs,Float32Array,$$._tVSLen,4),this._indexStart=$g._byteLength,($d=$$._tempIB).length<this._ps.length&&($d.length=this._ps.length);for(var $r=0,$k=this._ps.length;$r<$k;$r++)$d[$r]=this._ps[$r]+$Q;$g.appendEx2($d,Uint16Array,this._ps.length,2)},$v.getData=function($v,$g,$Q){if(this.mVBBuffer=$v,this.mIBBuffer=$g,$v.append(this.mVBData),this._indexStart=$g._byteLength,this.mIBData.start!=$Q){for(var $d=0,$r=this._ps.length;$d<$r;$d++)this.mIBData[$d]=this._ps[$d]+$Q;this.mIBData.start=$Q}$g.append(this.mIBData)},$v.render=function($v,$g,$Q){if($C.isWebGL&&this.mTexture){$v._renderKey=0,$v._shader2D.glTexture=null,$gv.getInstance().addSkinMesh(this);var $d=$kv.createShape($v,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$Fv.create(512,0));this.transform||(this.transform=$l.EMPTY),this.transform.translate($g,$Q),$l.mul(this.transform,$v._curMat,this._tempMatrix),this.transform.translate(-$g,-$Q);var $r=$d.shaderValue,$k=$r.u_mmat2||$Gv.getMatrArray();$Gv.mat2MatArray(this._tempMatrix,$k),$r.textureHost=this.mTexture,$r.offsetX=0,$r.offsetY=0,$r.u_mmat2=$k,$r.ALPHA=$v._shader2D.ALPHA,$v._submits[$v._submits._length++]=$d}else $C.isConchApp&&this.mTexture&&(this.transform||(this.transform=$l.EMPTY),$v.setSkinMesh&&$v.setSkinMesh($g,$Q,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$$._tempVS=[],$$._tempIB=[],$$._defaultPS=null,$$._tVSLen=0,$$}(),$gv=function(){function $v(){this.ib=null,this.vb=null;$Av.mainContext;this.ib=$_v.create(35048),this.vb=$uv.create(8)}$J($v,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $g=$v.prototype;return $g.addSkinMesh=function($v){$v.getData2(this.vb,this.ib,this.vb._byteLength/32)},$g.reset=function(){this.vb.clear(),this.ib.clear()},$v.getInstance=function(){return $v.instance=$v.instance||new $v},$v.instance=null,$v}(),$Qv=function(){function $v($v,$g,$Q,$d,$r,$k,$$,$b,$a){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$a&&($a=0),this.x=$v,this.y=$g,this.width=$Q,this.height=$d,this.edges=$r,this.color=$k,this.borderWidth=$$,this.borderColor=$b}$J($v,"laya.webgl.shapes.BasePoly");var $g=$v.prototype;return $P.imps($g,{"laya.webgl.shapes.IShape":!0}),$g.getData=function($v,$g,$Q){},$g.rebuild=function($v){},$g.setMatrix=function($v){},$g.needUpdate=function($v){return!0},$g.sector=function($v,$g,$Q){var $d=this.x,$r=this.y,$k=this.edges,$$=(this.r1-this.r0)/$k,$b=this.width,$a=this.height,$M=this.color,$Y=($M>>16&255)/255,$D=($M>>8&255)/255,$J=(255&$M)/255;$v.push($d,$r,$Y,$D,$J);for(var $p=0;$p<$k+1;$p++)$v.push($d+Math.sin($$*$p+this.r0)*$b,$r+Math.cos($$*$p+this.r0)*$a),$v.push($Y,$D,$J);for($p=0;$p<$k;$p++)$g.push($Q,$Q+$p+1,$Q+$p+2)},$g.createLine2=function($v,$g,$Q,$d,$r,$k){var $$,$b,$a,$M,$Y,$D,$J,$p,$T,$t,$q,$C,$G,$s,$A,$h,$P,$W,$F,$l,$o=$v.concat(),$E=$r,$V=this.borderColor,$Z=($V>>16&255)/255,$f=($V>>8&255)/255,$X=(255&$V)/255,$N=$o.length/2,$i=$d,$x=$Q/2;$a=$o[0],$M=$o[1],$t=$a-($Y=$o[2]),$T=($T=-($M-($D=$o[3])))/($l=Math.sqrt($T*$T+$t*$t))*$x,$t=$t/$l*$x,$E.push($a-$T+this.x,$M-$t+this.y,$Z,$f,$X,$a+$T+this.x,$M+$t+this.y,$Z,$f,$X);for(var $w=1;$w<$N-1;$w++)$a=$o[2*($w-1)],$M=$o[2*($w-1)+1],$Y=$o[2*$w],$D=$o[2*$w+1],$J=$o[2*($w+1)],$p=$o[2*($w+1)+1],$t=$a-$Y,$C=$Y-$J,$A=(-($T=($T=-($M-$D))/($l=Math.sqrt($T*$T+$t*$t))*$x)+$a)*(-($t=$t/$l*$x)+$D)-(-$T+$Y)*(-$t+$M),$W=(-($q=($q=-($D-$p))/($l=Math.sqrt($q*$q+$C*$C))*$x)+$J)*(-($C=$C/$l*$x)+$D)-(-$q+$Y)*(-$C+$p),$F=($G=-$t+$M-(-$t+$D))*($P=-$q+$Y-(-$q+$J))-($h=-$C+$p-(-$C+$D))*($s=-$T+$Y-(-$T+$a)),Math.abs($F)<.1?($F+=10.1,$E.push($Y-$T+this.x,$D-$t+this.y,$Z,$f,$X,$Y+$T+this.x,$D+$t+this.y,$Z,$f,$X)):((($$=($s*$W-$P*$A)/$F)-$Y)*($$-$Y)+(($b=($h*$A-$G*$W)/$F)-$D)+($b-$D),$E.push($$+this.x,$b+this.y,$Z,$f,$X,$Y-($$-$Y)+this.x,$D-($b-$D)+this.y,$Z,$f,$X));$a=$o[$o.length-4],$M=$o[$o.length-3],$t=$a-($Y=$o[$o.length-2]),$T=($T=-($M-($D=$o[$o.length-1])))/($l=Math.sqrt($T*$T+$t*$t))*$x,$t=$t/$l*$x,$E.push($Y-$T+this.x,$D-$t+this.y,$Z,$f,$X,$Y+$T+this.x,$D+$t+this.y,$Z,$f,$X);var $m=$k;for($w=1;$w<$m;$w++)$g.push($i+2*($w-1),$i+2*($w-1)+1,$i+2*$w+1,$i+2*$w+1,$i+2*$w,$i+2*($w-1));return $E},$g.createLine=function($v,$g,$Q,$d){var $r=$v.concat(),$k=$v,$$=this.borderColor,$b=($$>>16&255)/255,$a=($$>>8&255)/255,$M=(255&$$)/255;$r.splice(0,5);var $Y,$D,$J,$p,$T,$t,$q,$C,$G,$s,$A,$h,$P,$W,$F,$l,$o,$E,$V,$Z,$f=$r.length/5,$X=$d,$N=$Q/2;$J=$r[0],$p=$r[1],$s=$J-($T=$r[5]),$G=($G=-($p-($t=$r[6])))/($Z=Math.sqrt($G*$G+$s*$s))*$N,$s=$s/$Z*$N,$k.push($J-$G,$p-$s,$b,$a,$M,$J+$G,$p+$s,$b,$a,$M);for(var $i=1;$i<$f-1;$i++)$J=$r[5*($i-1)],$p=$r[5*($i-1)+1],$T=$r[5*$i],$t=$r[5*$i+1],$q=$r[5*($i+1)],$C=$r[5*($i+1)+1],$s=$J-$T,$h=$T-$q,$F=(-($G=($G=-($p-$t))/($Z=Math.sqrt($G*$G+$s*$s))*$N)+$J)*(-($s=$s/$Z*$N)+$t)-(-$G+$T)*(-$s+$p),$E=(-($A=($A=-($t-$C))/($Z=Math.sqrt($A*$A+$h*$h))*$N)+$q)*(-($h=$h/$Z*$N)+$t)-(-$A+$T)*(-$h+$C),$V=($P=-$s+$p-(-$s+$t))*($o=-$A+$T-(-$A+$q))-($l=-$h+$C-(-$h+$t))*($W=-$G+$T-(-$G+$J)),Math.abs($V)<.1?($V+=10.1,$k.push($T-$G,$t-$s,$b,$a,$M,$T+$G,$t+$s,$b,$a,$M)):((($Y=($W*$E-$o*$F)/$V)-$T)*($Y-$T)+(($D=($l*$F-$P*$E)/$V)-$t)+($D-$t),$k.push($Y,$D,$b,$a,$M,$T-($Y-$T),$t-($D-$t),$b,$a,$M));$J=$r[$r.length-10],$p=$r[$r.length-9],$s=$J-($T=$r[$r.length-5]),$G=($G=-($p-($t=$r[$r.length-4])))/($Z=Math.sqrt($G*$G+$s*$s))*$N,$s=$s/$Z*$N,$k.push($T-$G,$t-$s,$b,$a,$M,$T+$G,$t+$s,$b,$a,$M);var $x=this.edges+1;for($i=1;$i<$x;$i++)$g.push($X+2*($i-1),$X+2*($i-1)+1,$X+2*$i+1,$X+2*$i+1,$X+2*$i,$X+2*($i-1));return $k},$g.createLoopLine=function($v,$g,$Q,$d,$r,$k){var $$=$v.concat(),$b=$r||$v,$a=this.borderColor,$M=($a>>16&255)/255,$Y=($a>>8&255)/255,$D=(255&$a)/255;$$.splice(0,5);var $J=[$$[0],$$[1]],$p=[$$[$$.length-5],$$[$$.length-4]],$T=$p[0]+.5*($J[0]-$p[0]),$t=$p[1]+.5*($J[1]-$p[1]);$$.unshift($T,$t,0,0,0),$$.push($T,$t,0,0,0);var $q,$C,$G,$s,$A,$h,$P,$W,$F,$l,$o,$E,$V,$Z,$f,$X,$N,$i,$x,$w,$m=$$.length/5,$K=$d,$c=$Q/2;$G=$$[0],$s=$$[1],$l=$G-($A=$$[5]),$F=($F=-($s-($h=$$[6])))/($w=Math.sqrt($F*$F+$l*$l))*$c,$l=$l/$w*$c,$b.push($G-$F,$s-$l,$M,$Y,$D,$G+$F,$s+$l,$M,$Y,$D);for(var $B=1;$B<$m-1;$B++)$G=$$[5*($B-1)],$s=$$[5*($B-1)+1],$A=$$[5*$B],$h=$$[5*$B+1],$P=$$[5*($B+1)],$W=$$[5*($B+1)+1],$l=$G-$A,$E=$A-$P,$f=(-($F=($F=-($s-$h))/($w=Math.sqrt($F*$F+$l*$l))*$c)+$G)*(-($l=$l/$w*$c)+$h)-(-$F+$A)*(-$l+$s),$i=(-($o=($o=-($h-$W))/($w=Math.sqrt($o*$o+$E*$E))*$c)+$P)*(-($E=$E/$w*$c)+$h)-(-$o+$A)*(-$E+$W),$x=($V=-$l+$s-(-$l+$h))*($N=-$o+$A-(-$o+$P))-($X=-$E+$W-(-$E+$h))*($Z=-$F+$A-(-$F+$G)),Math.abs($x)<.1?($x+=10.1,$b.push($A-$F,$h-$l,$M,$Y,$D,$A+$F,$h+$l,$M,$Y,$D)):((($q=($Z*$i-$N*$f)/$x)-$A)*($q-$A)+(($C=($X*$f-$V*$i)/$x)-$h)+($C-$h),$b.push($q,$C,$M,$Y,$D,$A-($q-$A),$h-($C-$h),$M,$Y,$D));$k&&($g=$k);var $j=this.edges+1;for($B=1;$B<$j;$B++)$g.push($K+2*($B-1),$K+2*($B-1)+1,$K+2*$B+1,$K+2*$B+1,$K+2*$B,$K+2*($B-1));return $g.push($K+2*($B-1),$K+2*($B-1)+1,$K+1,$K+1,$K,$K+2*($B-1)),$b},$v}(),$dv=function(){function $t(){}return $J($t,"laya.webgl.shapes.Earcut"),$t.earcut=function($v,$g,$Q){$Q=$Q||2;var $d,$r,$k,$$,$b,$a,$M,$Y=$g&&$g.length,$D=$Y?$g[0]*$Q:$v.length,$J=$t.linkedList($v,0,$D,$Q,!0),$p=[];if(!$J)return $p;if($Y&&($J=$t.eliminateHoles($v,$g,$J,$Q)),$v.length>80*$Q){$d=$k=$v[0],$r=$$=$v[1];for(var $T=$Q;$T<$D;$T+=$Q)($b=$v[$T])<$d&&($d=$b),($a=$v[$T+1])<$r&&($r=$a),$k<$b&&($k=$b),$$<$a&&($$=$a);$M=0!==($M=Math.max($k-$d,$$-$r))?1/$M:0}return $t.earcutLinked($J,$p,$Q,$d,$r,$M),$p},$t.linkedList=function($v,$g,$Q,$d,$r){var $k,$$;if($r===0<$t.signedArea($v,$g,$Q,$d))for($k=$g;$k<$Q;$k+=$d)$$=$t.insertNode($k,$v[$k],$v[$k+1],$$);else for($k=$Q-$d;$g<=$k;$k-=$d)$$=$t.insertNode($k,$v[$k],$v[$k+1],$$);return $$&&$t.equals($$,$$.next)&&($t.removeNode($$),$$=$$.next),$$},$t.filterPoints=function($v,$g){if(!$v)return $v;$g||($g=$v);var $Q,$d=$v;do{if($Q=!1,$d.steiner||!$t.equals($d,$d.next)&&0!==$t.area($d.prev,$d,$d.next))$d=$d.next;else{if($t.removeNode($d),($d=$g=$d.prev)===$d.next)break;$Q=!0}}while($Q||$d!==$g);return $g},$t.earcutLinked=function($v,$g,$Q,$d,$r,$k,$$){if($v){!$$&&$k&&$t.indexCurve($v,$d,$r,$k);for(var $b,$a,$M=$v;$v.prev!==$v.next;)if($b=$v.prev,$a=$v.next,$k?$t.isEarHashed($v,$d,$r,$k):$t.isEar($v))$g.push($b.i/$Q),$g.push($v.i/$Q),$g.push($a.i/$Q),$t.removeNode($v),$v=$a.next,$M=$a.next;else if(($v=$a)===$M){$$?1===$$?($v=$t.cureLocalIntersections($v,$g,$Q),$t.earcutLinked($v,$g,$Q,$d,$r,$k,2)):2===$$&&$t.splitEarcut($v,$g,$Q,$d,$r,$k):$t.earcutLinked($t.filterPoints($v,null),$g,$Q,$d,$r,$k,1);break}}},$t.isEar=function($v){var $g=$v.prev,$Q=$v,$d=$v.next;if(0<=$t.area($g,$Q,$d))return!1;for(var $r=$v.next.next;$r!==$v.prev;){if($t.pointInTriangle($g.x,$g.y,$Q.x,$Q.y,$d.x,$d.y,$r.x,$r.y)&&0<=$t.area($r.prev,$r,$r.next))return!1;$r=$r.next}return!0},$t.isEarHashed=function($v,$g,$Q,$d){var $r=$v.prev,$k=$v,$$=$v.next;if(0<=$t.area($r,$k,$$))return!1;for(var $b=$r.x<$k.x?$r.x<$$.x?$r.x:$$.x:$k.x<$$.x?$k.x:$$.x,$a=$r.y<$k.y?$r.y<$$.y?$r.y:$$.y:$k.y<$$.y?$k.y:$$.y,$M=$r.x>$k.x?$r.x>$$.x?$r.x:$$.x:$k.x>$$.x?$k.x:$$.x,$Y=$r.y>$k.y?$r.y>$$.y?$r.y:$$.y:$k.y>$$.y?$k.y:$$.y,$D=$t.zOrder($b,$a,$g,$Q,$d),$J=$t.zOrder($M,$Y,$g,$Q,$d),$p=$v.nextZ;$p&&$p.z<=$J;){if($p!==$v.prev&&$p!==$v.next&&$t.pointInTriangle($r.x,$r.y,$k.x,$k.y,$$.x,$$.y,$p.x,$p.y)&&0<=$t.area($p.prev,$p,$p.next))return!1;$p=$p.nextZ}for($p=$v.prevZ;$p&&$p.z>=$D;){if($p!==$v.prev&&$p!==$v.next&&$t.pointInTriangle($r.x,$r.y,$k.x,$k.y,$$.x,$$.y,$p.x,$p.y)&&0<=$t.area($p.prev,$p,$p.next))return!1;$p=$p.prevZ}return!0},$t.cureLocalIntersections=function($v,$g,$Q){var $d=$v;do{var $r=$d.prev,$k=$d.next.next;!$t.equals($r,$k)&&$t.intersects($r,$d,$d.next,$k)&&$t.locallyInside($r,$k)&&$t.locallyInside($k,$r)&&($g.push($r.i/$Q),$g.push($d.i/$Q),$g.push($k.i/$Q),$t.removeNode($d),$t.removeNode($d.next),$d=$v=$k),$d=$d.next}while($d!==$v);return $d},$t.splitEarcut=function($v,$g,$Q,$d,$r,$k){var $$=$v;do{for(var $b=$$.next.next;$b!==$$.prev;){if($$.i!==$b.i&&$t.isValidDiagonal($$,$b)){var $a=$t.splitPolygon($$,$b);return $$=$t.filterPoints($$,$$.next),$a=$t.filterPoints($a,$a.next),$t.earcutLinked($$,$g,$Q,$d,$r,$k),void $t.earcutLinked($a,$g,$Q,$d,$r,$k)}$b=$b.next}$$=$$.next}while($$!==$v)},$t.eliminateHoles=function($v,$g,$Q,$d){var $r,$k,$$,$b,$a,$M=[];for($r=0,$k=$g.length;$r<$k;$r++)$$=$g[$r]*$d,$b=$r<$k-1?$g[$r+1]*$d:$v.length,($a=$t.linkedList($v,$$,$b,$d,!1))===$a.next&&($a.steiner=!0),$M.push($t.getLeftmost($a));for($M.sort($t.compareX),$r=0;$r<$M.length;$r++)$t.eliminateHole($M[$r],$Q),$Q=$t.filterPoints($Q,$Q.next);return $Q},$t.compareX=function($v,$g){return $v.x-$g.x},$t.eliminateHole=function($v,$g){if($g=$t.findHoleBridge($v,$g)){var $Q=$t.splitPolygon($g,$v);$t.filterPoints($Q,$Q.next)}},$t.findHoleBridge=function($v,$g){var $Q,$d=$g,$r=$v.x,$k=$v.y,$$=-1/0;do{if($k<=$d.y&&$k>=$d.next.y&&$d.next.y!==$d.y){var $b=$d.x+($k-$d.y)*($d.next.x-$d.x)/($d.next.y-$d.y);if($b<=$r&&$$<$b){if(($$=$b)===$r){if($k===$d.y)return $d;if($k===$d.next.y)return $d.next}$Q=$d.x<$d.next.x?$d:$d.next}}$d=$d.next}while($d!==$g);if(!$Q)return null;if($r===$$)return $Q.prev;var $a,$M=$Q,$Y=$Q.x,$D=$Q.y,$J=1/0;for($d=$Q.next;$d!==$M;)$r>=$d.x&&$d.x>=$Y&&$r!==$d.x&&$t.pointInTriangle($k<$D?$r:$$,$k,$Y,$D,$k<$D?$$:$r,$k,$d.x,$d.y)&&(($a=Math.abs($k-$d.y)/($r-$d.x))<$J||$a===$J&&$d.x>$Q.x)&&$t.locallyInside($d,$v)&&($Q=$d,$J=$a),$d=$d.next;return $Q},$t.indexCurve=function($v,$g,$Q,$d){for(var $r=$v;null===$r.z&&($r.z=$t.zOrder($r.x,$r.y,$g,$Q,$d)),$r.prevZ=$r.prev,$r.nextZ=$r.next,($r=$r.next)!==$v;);$r.prevZ.nextZ=null,$r.prevZ=null,$t.sortLinked($r)},$t.sortLinked=function($v){var $g,$Q,$d,$r,$k,$$,$b,$a,$M=1;do{for($Q=$v,$k=$v=null,$$=0;$Q;){for($$++,$d=$Q,$g=$b=0;$g<$M&&($b++,$d=$d.nextZ);$g++);for($a=$M;0<$b||0<$a&&$d;)0!==$b&&(0===$a||!$d||$Q.z<=$d.z)?($Q=($r=$Q).nextZ,$b--):($d=($r=$d).nextZ,$a--),$k?$k.nextZ=$r:$v=$r,$r.prevZ=$k,$k=$r;$Q=$d}$k.nextZ=null,$M*=2}while(1<$$);return $v},$t.zOrder=function($v,$g,$Q,$d,$r){return($v=1431655765&(($v=858993459&(($v=252645135&(($v=16711935&(($v=32767*($v-$Q)*$r)|$v<<8))|$v<<4))|$v<<2))|$v<<1))|($g=1431655765&(($g=858993459&(($g=252645135&(($g=16711935&(($g=32767*($g-$d)*$r)|$g<<8))|$g<<4))|$g<<2))|$g<<1))<<1},$t.getLeftmost=function($v){for(var $g=$v,$Q=$v;$g.x<$Q.x&&($Q=$g),($g=$g.next)!==$v;);return $Q},$t.pointInTriangle=function($v,$g,$Q,$d,$r,$k,$$,$b){return 0<=($r-$$)*($g-$b)-($v-$$)*($k-$b)&&0<=($v-$$)*($d-$b)-($Q-$$)*($g-$b)&&0<=($Q-$$)*($k-$b)-($r-$$)*($d-$b)},$t.isValidDiagonal=function($v,$g){return $v.next.i!==$g.i&&$v.prev.i!==$g.i&&!$t.intersectsPolygon($v,$g)&&$t.locallyInside($v,$g)&&$t.locallyInside($g,$v)&&$t.middleInside($v,$g)},$t.area=function($v,$g,$Q){return($g.y-$v.y)*($Q.x-$g.x)-($g.x-$v.x)*($Q.y-$g.y)},$t.equals=function($v,$g){return $v.x===$g.x&&$v.y===$g.y},$t.intersects=function($v,$g,$Q,$d){return!!($t.equals($v,$g)&&$t.equals($Q,$d)||$t.equals($v,$d)&&$t.equals($Q,$g))||0<$t.area($v,$g,$Q)!=0<$t.area($v,$g,$d)&&0<$t.area($Q,$d,$v)!=0<$t.area($Q,$d,$g)},$t.intersectsPolygon=function($v,$g){var $Q=$v;do{if($Q.i!==$v.i&&$Q.next.i!==$v.i&&$Q.i!==$g.i&&$Q.next.i!==$g.i&&$t.intersects($Q,$Q.next,$v,$g))return!0;$Q=$Q.next}while($Q!==$v);return!1},$t.locallyInside=function($v,$g){return $t.area($v.prev,$v,$v.next)<0?0<=$t.area($v,$g,$v.next)&&0<=$t.area($v,$v.prev,$g):$t.area($v,$g,$v.prev)<0||$t.area($v,$v.next,$g)<0},$t.middleInside=function($v,$g){for(var $Q=$v,$d=!1,$r=($v.x+$g.x)/2,$k=($v.y+$g.y)/2;$Q.y>$k!=$Q.next.y>$k&&$Q.next.y!==$Q.y&&$r<($Q.next.x-$Q.x)*($k-$Q.y)/($Q.next.y-$Q.y)+$Q.x&&($d=!$d),($Q=$Q.next)!==$v;);return $d},$t.splitPolygon=function($v,$g){var $Q=new $rv($v.i,$v.x,$v.y),$d=new $rv($g.i,$g.x,$g.y),$r=$v.next,$k=$g.prev;return($v.next=$g).prev=$v,($Q.next=$r).prev=$Q,($d.next=$Q).prev=$d,($k.next=$d).prev=$k,$d},$t.insertNode=function($v,$g,$Q,$d){var $r=new $rv($v,$g,$Q);return $d?($r.next=$d.next,($r.prev=$d).next.prev=$r,$d.next=$r):($r.prev=$r).next=$r,$r},$t.removeNode=function($v){$v.next.prev=$v.prev,$v.prev.next=$v.next,$v.prevZ&&($v.prevZ.nextZ=$v.nextZ),$v.nextZ&&($v.nextZ.prevZ=$v.prevZ)},$t.signedArea=function($v,$g,$Q,$d){for(var $r=0,$k=$g,$$=$Q-$d;$k<$Q;$k+=$d)$r+=($v[$$]-$v[$k])*($v[$k+1]+$v[$$+1]),$$=$k;return $r},$t}(),$rv=function(){function $v($v,$g,$Q){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$v,this.x=$g,this.y=$Q,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $J($v,"laya.webgl.shapes.EarcutNode"),$v}(),$kv=(function(){function $v($v,$g,$Q,$d,$r,$k,$$){this.lineWidth=$v,this.lineColor=$g,this.lineAlpha=$Q,this.fillColor=$d,this.fillAlpha=$r,this.shape=$$,this.fill=$k}$J($v,"laya.webgl.shapes.GeometryData");var $g=$v.prototype;$g.clone=function(){return new $v(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$g.getIndexData=function(){return null},$g.getVertexData=function(){return null},$g.destroy=function(){this.shape=null}}(),function(){function $v($v){if($v instanceof Float32Array)this.points=$v;else if($v instanceof Array){$v.length;this.points=new Float32Array($v)}}$J($v,"laya.webgl.shapes.Vertex");var $g=$v.prototype;$P.imps($g,{"laya.webgl.shapes.IShape":!0}),$g.getData=function($v,$g,$Q){},$g.needUpdate=function($v){return!1},$g.rebuild=function($v){},$g.setMatrix=function($v){}}(),function(){function $a($v){void 0===$v&&($v=1e4),this._renderType=$v}$J($a,"laya.webgl.submit.Submit");var $v=$a.prototype;return $P.imps($v,{"laya.webgl.submit.ISubmit":!0}),$v.releaseRender=function(){var $v=$a._cache;($v[$v._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$v.getRenderType=function(){return this._renderType},$v.renderSubmit=function(){if(0===this._numEle)return 1;var $v=this.shaderValue.textureHost;if($v){var $g=$v.source;if(!$v.bitmap||!$g)return 1;this.shaderValue.texture=$g,$v.alphaTexture&&$v.alphaTexture.source&&(this.shaderValue.texture1=$v.alphaTexture.source)}this._vb.bind_upload(this._ib);var $Q=$Av.mainContext;return this.shaderValue.upload(),$H.activeBlendFunction!==this._blendFn&&($Q.enable(3042),this._blendFn($Q),$H.activeBlendFunction=this._blendFn),$f.drawCall++,$f.trianglesFaces+=this._numEle/3,$Q.drawElements(4,this._numEle,5123,this._startIdx),1},$a.__init__=function(){var $v=$a.RENDERBASE=new $a(-1);$v.shaderValue=new $Fv(0,0),$v.shaderValue.ALPHA=-1234},$a.createSubmit=function($v,$g,$Q,$d,$r){var $k=$a._cache._length?$a._cache[--$a._cache._length]:new $a;null==$Q&&(($Q=$k._selfVb||($k._selfVb=$uv.create(-1))).clear(),$d=0),$k._ib=$g,$k._vb=$Q,$k._startIdx=$d*$tv.BYTES_PIDX,$k._numEle=0;var $$=$v._nBlendType;$k._blendFn=$v._targets?$H.targetFns[$$]:$H.fns[$$],$k.shaderValue=$r,$k.shaderValue.setValue($v._shader2D);var $b=$v._shader2D.filters;return $b&&$k.shaderValue.setFilters($b),$k},$a.createShape=function($v,$g,$Q,$d,$r,$k){var $$=$a._cache._length?$a._cache[--$a._cache._length]:new $a;$$._ib=$g,$$._vb=$Q,$$._numEle=$d,$$._startIdx=$r,$$.shaderValue=$k,$$.shaderValue.setValue($v._shader2D);var $b=$v._nBlendType;return $$._blendFn=$v._targets?$H.targetFns[$b]:$H.fns[$b],$$},$a.TYPE_2D=1e4,$a.TYPE_CANVAS=10003,$a.TYPE_CMDSETRT=10004,$a.TYPE_CUSTOM=10005,$a.TYPE_BLURRT=10006,$a.TYPE_CMDDESTORYPRERT=10007,$a.TYPE_DISABLESTENCIL=10008,$a.TYPE_OTHERIBVB=10009,$a.TYPE_PRIMITIVE=10010,$a.TYPE_RT=10011,$a.TYPE_BLUR_RT=10012,$a.TYPE_TARGET=10013,$a.TYPE_CHANGE_VALUE=10014,$a.TYPE_SHAPE=10015,$a.TYPE_TEXTURE=10016,$a.TYPE_FILLTEXTURE=10017,$a.RENDERBASE=null,$a._cache=(($a._cache=[])._length=0,$a._cache),$a}()),$$v=function(){function $d(){this.fun=null,this.args=null}$J($d,"laya.webgl.submit.SubmitCMD");var $v=$d.prototype;return $P.imps($v,{"laya.webgl.submit.ISubmit":!0}),$v.renderSubmit=function(){return this.fun.apply(null,this.args),1},$v.getRenderType=function(){return 0},$v.releaseRender=function(){var $v=$d._cache;$v[$v._length++]=this},$d.create=function($v,$g){var $Q=$d._cache._length?$d._cache[--$d._cache._length]:new $d;return $Q.fun=$g,$Q.args=$v,$Q},$d._cache=(($d._cache=[])._length=0,$d._cache),$d}(),$bv=function(){function $g(){this.variables={}}$J($g,"laya.webgl.submit.SubmitCMDScope");var $v=$g.prototype;return $v.getValue=function($v){return this.variables[$v]},$v.addValue=function($v,$g){return this.variables[$v]=$g},$v.setValue=function($v,$g){return this.variables.hasOwnProperty($v)?this.variables[$v]=$g:null},$v.clear=function(){for(var $v in this.variables)delete this.variables[$v]},$v.recycle=function(){this.clear(),$g.POOL.push(this)},$g.create=function(){var $v=$g.POOL.pop();return $v||($v=new $g),$v},$g.POOL=[],$g}(),$av=function(){function $D(){this.offset=0,this.startIndex=0,this._mat=$l.create()}$J($D,"laya.webgl.submit.SubmitOtherIBVB");var $v=$D.prototype;return $P.imps($v,{"laya.webgl.submit.ISubmit":!0}),$v.releaseRender=function(){var $v=$D._cache;($v[$v._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$v.getRenderType=function(){return 10009},$v.renderSubmit=function(){var $v=this._shaderValue.textureHost;if($v){var $g=$v.source;if(!$v.bitmap||!$g)return 1;this._shaderValue.texture=$g}this._vb.bind_upload(this._ib);var $Q=$Gv.worldMatrix4,$d=$l.TEMP;$l.mulPre(this._mat,$Q[0],$Q[1],$Q[4],$Q[5],$Q[12],$Q[13],$d);var $r=$Gv.worldMatrix4=$D.tempMatrix4;$r[0]=$d.a,$r[1]=$d.b,$r[4]=$d.c,$r[5]=$d.d,$r[12]=$d.tx,$r[13]=$d.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $k=$Av.mainContext;return $H.activeBlendFunction!==this._blendFn&&($k.enable(3042),this._blendFn($k),$H.activeBlendFunction=this._blendFn),$f.drawCall++,$f.trianglesFaces+=this._numEle/3,$k.drawElements(4,this._numEle,5123,this.startIndex),$Gv.worldMatrix4=$Q,$wv.activeShader=null,1},$D.create=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){void 0===$a&&($a=0);var $M=$D._cache._length?$D._cache[--$D._cache._length]:new $D;$M._ib=$Q,$M._vb=$g,$M._numEle=$d,$M._shader=$r,$M._shaderValue=$k;var $Y=$v._nBlendType;switch($M._blendFn=$v._targets?$H.targetFns[$Y]:$H.fns[$Y],$a){case 0:$M.offset=0,$M.startIndex=$b/($tv.BYTES_PE*$g.vertexStride)*1.5,$M.startIndex*=$tv.BYTES_PIDX;break;case 1:$M.startIndex=$$,$M.offset=$b}return $M},$D._cache=(($D._cache=[])._length=0,$D._cache),$D.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$D}(),$Mv=function(){function $Q(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $E,this.screenRect=new $E}$J($Q,"laya.webgl.submit.SubmitScissor");var $v=$Q.prototype;return $P.imps($v,{"laya.webgl.submit.ISubmit":!0}),$v._scissor=function($v,$g,$Q,$d){var $r=$Gv.worldMatrix4,$k=$r[0],$$=$r[5],$b=$r[12],$a=$r[13];if($d*=$$,($Q*=$k)<1||$d<1)return!1;var $M=($v=$v*$k+$b)+$Q,$Y=($g=$g*$$+$a)+$d;$v<0&&($Q=$M-($v=0)),$g<0&&($d=$Y-($g=0));var $D=$Gv.worldClipRect;if($v=Math.max($v,$D.x),$g=Math.max($g,$D.y),$Q=Math.min($M,$D.right)-$v,$d=Math.min($Y,$D.bottom)-$g,$Q<1||$d<1)return!1;var $J=$Gv.worldScissorTest;return this.screenRect.copyFrom($D),$D.x=$v,$D.y=$g,$D.width=$Q,$D.height=$d,$Gv.worldScissorTest=!0,$g=$Gv.height-$g-$d,$Av.mainContext.scissor($v,$g,$Q,$d),$Av.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$J?($g=$Gv.height-this.screenRect.y-this.screenRect.height,$Av.mainContext.scissor(this.screenRect.x,$g,this.screenRect.width,this.screenRect.height),$Av.mainContext.enable(3089)):($Av.mainContext.disable(3089),$Gv.worldScissorTest=!1),$D.copyFrom(this.screenRect),!0},$v._scissorWithTagart=function($v,$g,$Q,$d){if($Q<1||$d<1)return!1;var $r=$v+$Q,$k=$g+$d;$v<0&&($Q=$r-($v=0)),$g<0&&($d=$k-($g=0));var $$=$Gv.worldClipRect;if($v=Math.max($v,$$.x),$g=Math.max($g,$$.y),$Q=Math.min($r,$$.right)-$v,$d=Math.min($k,$$.bottom)-$g,$Q<1||$d<1)return!1;var $b=$Gv.worldScissorTest;return this.screenRect.copyFrom($$),$Gv.worldScissorTest=!0,$$.x=$v,$$.y=$g,$$.width=$Q,$$.height=$d,$g=$Gv.height-$g-$d,$Av.mainContext.scissor($v,$g,$Q,$d),$Av.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$b?($g=$Gv.height-this.screenRect.y-this.screenRect.height,$Av.mainContext.scissor(this.screenRect.x,$g,this.screenRect.width,this.screenRect.height),$Av.mainContext.enable(3089)):($Av.mainContext.disable(3089),$Gv.worldScissorTest=!1),$$.copyFrom(this.screenRect),!0},$v.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$v.getRenderType=function(){return 0},$v.releaseRender=function(){var $v=$Q._cache;($v[$v._length++]=this).context=null},$Q.create=function($v){var $g=$Q._cache._length?$Q._cache[--$Q._cache._length]:new $Q;return $g.context=$v,$g},$Q._cache=(($Q._cache=[])._length=0,$Q._cache),$Q}(),$Yv=function(){function $a(){this.step=0,this.blendMode=null,this.level=0}$J($a,"laya.webgl.submit.SubmitStencil");var $v=$a.prototype;return $P.imps($v,{"laya.webgl.submit.ISubmit":!0}),$v.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$v.getRenderType=function(){return 0},$v.releaseRender=function(){var $v=$a._cache;$v[$v._length++]=this},$v.do1=function(){var $v=$Av.mainContext;$v.enable(2960),$v.clear(1024),$v.colorMask(!1,!1,!1,!1),$v.stencilFunc(514,this.level,255),$v.stencilOp(7680,7680,7682)},$v.do2=function(){var $v=$Av.mainContext;$v.stencilFunc(514,this.level+1,255),$v.colorMask(!0,!0,!0,!0),$v.stencilOp(7680,7680,7680)},$v.do3=function(){var $v=$Av.mainContext;$v.colorMask(!0,!0,!0,!0),$v.stencilOp(7680,7680,7680),$v.clear(1024),$v.disable(2960)},$v.do4=function(){var $v=$Av.mainContext;0==this.level&&($v.enable(2960),$v.clear(1024)),$v.colorMask(!1,!1,!1,!1),$v.stencilFunc(519,0,255),$v.stencilOp(7680,7680,7682)},$v.do5=function(){var $v=$Av.mainContext;$v.stencilFunc(514,this.level,255),$v.colorMask(!0,!0,!0,!0),$v.stencilOp(7680,7680,7680)},$v.do6=function(){var $v=$Av.mainContext;$H.targetFns[$H.TOINT[this.blendMode]]($v)},$v.do7=function(){var $v=$Av.mainContext;$v.colorMask(!1,!1,!1,!1),$v.stencilOp(7680,7680,7683)},$v.do8=function(){var $v=$Av.mainContext;$v.colorMask(!0,!0,!0,!0),$v.stencilFunc(514,this.level,255),$v.stencilOp(7680,7680,7680)},$a.restore=function($v,$g,$Q,$d,$r){var $k;if(($v._renderKey=0)<$a._mask&&$a._mask--,0==$a._mask)$k=laya.webgl.submit.SubmitStencil.create(3),$v.addRenderObject($k),$v._curSubmit=$kv.RENDERBASE;else{$k=laya.webgl.submit.SubmitStencil.create(7),$v.addRenderObject($k);var $$=$v._vb;$$._byteLength;if($qv.fillRectImgVb($$,null,$g.x,$g.y,$g.width,$g.height,$x.DEF_UV,$Q,$d,$r,0,0)){$v._shader2D.glTexture=null;var $b=$v._curSubmit=$kv.createSubmit($v,$v._ib,$$,($$._byteLength-64)/32*3,$Fv.create(2,0));$b.shaderValue.ALPHA=1,$v._submits[$v._submits._length++]=$b,$v._curSubmit._numEle+=6,$v._curSubmit=$kv.RENDERBASE}else alert("clipRect calc stencil rect error");$k=laya.webgl.submit.SubmitStencil.create(8),$v.addRenderObject($k)}},$a.restore2=function($v,$g){var $Q;($v._renderKey=0)<$a._mask&&$a._mask--,0==$a._mask?($Q=laya.webgl.submit.SubmitStencil.create(3),$v.addRenderObject($Q),$v._curSubmit=$kv.RENDERBASE):($Q=laya.webgl.submit.SubmitStencil.create(7),$v.addRenderObject($Q),$v._submits[$v._submits._length++]=$g,$Q=laya.webgl.submit.SubmitStencil.create(8),$v.addRenderObject($Q))},$a.create=function($v){var $g=$a._cache._length?$a._cache[--$a._cache._length]:new $a;return 5==($g.step=$v)&&++$a._mask,$g.level=$a._mask,$g},$a._cache=(($a._cache=[])._length=0,$a._cache),$a._mask=0,$a}(),$Dv=function(){function $b(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$J($b,"laya.webgl.submit.SubmitTarget");var $v=$b.prototype;return $P.imps($v,{"laya.webgl.submit.ISubmit":!0}),$v.renderSubmit=function(){this._vb.bind_upload(this._ib);var $v=this.scope.getValue(this.proName);return $v&&(this.shaderValue.texture=$v.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$v.width,$v.height]),this.shaderValue.upload(),this.blend(),$f.drawCall++,$f.trianglesFaces+=this._numEle/3,$Av.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$v.blend=function(){if($H.activeBlendFunction!==$H.fns[this.blendType]){var $v=$Av.mainContext;$v.enable(3042),$H.fns[this.blendType]($v),$H.activeBlendFunction=$H.fns[this.blendType]}},$v.getRenderType=function(){return 0},$v.releaseRender=function(){var $v=$b._cache;($v[$v._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$b.create=function($v,$g,$Q,$d,$r,$k){var $$=$b._cache._length?$b._cache[--$b._cache._length]:new $b;return $$._ib=$g,$$._vb=$Q,$$.proName=$k,$$._startIdx=$d*$tv.BYTES_PIDX,$$._numEle=0,$$.blendType=$v._nBlendType,$$.shaderValue=$r,$$.shaderValue.setValue($v._shader2D),$$},$b._cache=(($b._cache=[])._length=0,$b._cache),$b}(),$Jv=function(){function $v(){this._sourceStr=null}$J($v,"laya.webgl.text.CharSegment");var $g=$v.prototype;return $P.imps($g,{"laya.webgl.text.ICharSegment":!0}),$g.textToSpit=function($v){this._sourceStr=$v},$g.getChar=function($v){return this._sourceStr.charAt($v)},$g.getCharCode=function($v){return this._sourceStr.charCodeAt($v)},$g.length=function(){return this._sourceStr.length},$v}(),$pv=function(){var $v;function $f(){}return $J($f,"laya.webgl.text.DrawText"),$f.__init__=function(){$f._charsTemp=new Array,$f._drawValue=new $v,$f._charSeg=new $Jv},$f.customCharSeg=function($v){$f._charSeg=$v},$f.getChar=function($v,$g,$Q){var $d=$ev.createOneChar($v,$Q);return-1!=$g&&($f._charsCache[$g]=$d),$d},$f._drawSlow=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D,$J,$p,$T){var $t,$q,$C=$f._drawValue.value($k,$b,$a,$M,$J,$p,$T),$G=0,$s=0,$A=$f._charsTemp,$h=0,$P=NaN;if($d)for($A.length=$d.length,$G=0,$s=$d.length;$G<$s;$G++)($q=$d[$G])&&($P=$q.charNum+$C.txtID,$A[$G]=$t=$f._charsCache[$P]||$f.getChar($q.char,$P,$C),$t.active());else{var $W=$Q instanceof laya.utils.WordText?$Q.toString():$Q;if($i.CharacterCache){$f._charSeg.textToSpit($W);var $F=$f._charSeg.length();for($G=0,$s=$A.length=$F;$G<$s;$G++)$P=$f._charSeg.getCharCode($G)+$C.txtID,$A[$G]=$t=$f._charsCache[$P]||$f.getChar($f._charSeg.getChar($G),$P,$C),$t.active(),$h+=$t.cw}else $A.length=0,($t=$f.getChar($W,-1,$C)).active(),$h+=$t.cw,$A[0]=$t}var $l=0;null!==$$&&"left"!==$$&&($l=-("center"==$$?$h/2:$h));var $o,$E,$V=NaN,$Z=0;if($d)for($G=0,$s=$A.length;$G<$s;$G++)$t=$A[$G],$q=$d[$G],$t&&$q&&!$t.isSpace&&($V=$t.borderSize,$o=$t.texture,$g._drawText($o,$Y+$l+$q.x*$J-$V,$D+$q.y*$p-$V,$o.width,$o.height,$r,0,0,0,0));else{for($G=0,$s=$A.length;$G<$s;$G++)($t=$A[$G])&&!$t.isSpace&&($V=$t.borderSize,$o=$t.texture,$g._drawText($o,$Y+$l-$V,$D-$V,$o.width,$o.height,$r,0,0,0,0),$v&&(($E=$v[$Z++])||($E=$v[$Z-1]=[]),$E[0]=$o,$E[1]=$l-$V,$E[2]=-$V)),$l+=$t.cw;$v&&($v.length=$Z)}},$f._drawFast=function($v,$g,$Q,$d,$r){for(var $k,$$,$b=0,$a=$v.length;$b<$a;$b++)($k=($$=$v[$b])[0]).active(),$g._drawText($k,$d+$$[1],$r+$$[2],$k.width,$k.height,$Q,0,0,0,0)},$f.drawText=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D){if(void 0===$D&&($D=0),!($g&&0===$g.length||$Q&&0===$Q.length)){var $J=$d.a,$p=$d.d;(0!==$d.b||0!==$d.c)&&($J=$p=1);var $T=1!==$J||1!==$p;if($T&&$P.stage.transform){var $t=$P.stage.transform;$T=$t.a===$J&&$t.d===$p}else $T=!1;if($T){var $q=($d=$d.copyTo($Wv._tmpMatrix)).tx,$C=$d.ty;$d.scale(1/$J,1/$p),$d._checkTransform(),$M*=$J,$Y*=$p,$M+=$q-$d.tx,$Y+=$C-$d.ty}else $J=$p=1;if($Q)$f._drawSlow(null,$v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$J,$p,$D);else{if(null===$g.toUpperCase){var $G=$J+1e5*$p,$s=$g;return void($s.changed||$s.id!==$G?($s.id=$G,$s.changed=!1,$f._drawSlow($s.save,$v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$J,$p,$D)):$f._drawFast($s.save,$v,$d,$M,$Y))}var $A=$g+$r.toString()+$$+$b+$a+$J+$p+$k,$h=$f._textsCache[$A];$i.CharacterCache?$h?$f._drawFast($h,$v,$d,$M,$Y):($f._textsCache.__length||($f._textsCache.__length=0),$f._textsCache.__length>$W.WebGLTextCacheCount&&(($f._textsCache={}).__length=0,$f._curPoolIndex=0),$f._textCachesPool[$f._curPoolIndex]?($h=$f._textsCache[$A]=$f._textCachesPool[$f._curPoolIndex]).length=0:$f._textCachesPool[$f._curPoolIndex]=$h=$f._textsCache[$A]=[],$f._textsCache.__length++,$f._curPoolIndex++,$f._drawSlow($h,$v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$J,$p,$D)):$f._drawSlow($h,$v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$J,$p,$D)}}},$f._charsTemp=null,$f._textCachesPool=[],$f._curPoolIndex=0,$f._charsCache={},$f._textsCache={},$f._drawValue=null,$f.d=[],$f._charSeg=null,$f.__init$=function(){$v=function(){function $a(){}return $J($a,""),$a.prototype.value=function($v,$g,$Q,$d,$r,$k,$$){this.font=$v,this.fillColor=$g,this.borderColor=$Q,this.lineWidth=$d,this.scaleX=$r,this.scaleY=$k,this.underLine=$$;var $b=$v.toString()+$r+$k+$d+($g?$g.toLowerCase():" ")+($Q?$Q.toLowerCase():" ")+$$;return this.txtID=$a._keymap[$b],this.txtID||(this.txtID=1e-7*++$a._keymapCount,$a._keymap[$b]=this.txtID),this},$a.clear=function(){$a._keymap={},$a._keymapCount=1},$a._keymap={},$a._keymapCount=1,$a}()},$f}(),$Tv=function(){function $r($v){this._index=0,this._size=14,this._italic=-2,$r._cache2=$r._cache2||[],this.setFont($v||"14px Arial")}$J($r,"laya.webgl.text.FontInContext");var $v=$r.prototype;return $v.setFont=function($v){var $g=$r._cache2[$v];if($g)this._words=$g[0],this._size=$g[1];else{this._words=$v.split(" ");for(var $Q=0,$d=this._words.length;$Q<$d;$Q++)if(0<this._words[$Q].indexOf("px")){this._index=$Q;break}this._size=parseInt(this._words[this._index]),$r._cache2[$v]=[this._words,this._size]}this._text=null,this._italic=-2},$v.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$v.hasType=function($v){for(var $g=0,$Q=this._words.length;$g<$Q;$g++)if(this._words[$g]===$v)return $g;return-1},$v.removeType=function($v){for(var $g=0,$Q=this._words.length;$g<$Q;$g++)if(this._words[$g]===$v){this._words.splice($g,1),this._index>$g&&this._index--;break}this._text=null,this._italic=-2},$v.copyTo=function($v){return $v._text=this._text,$v._size=this._size,$v._index=this._index,$v._words=this._words.slice(),$v._italic=-2,$v},$v.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$d(0,$v,"size",function(){return this._size},function($v){this._size=$v,this._words[this._index]=$v+"px",this._text=null}),$r.create=function($v){var $g=$r._cache[$v];return $g||($g=$r._cache[$v]=new $r($v))},$r.EMPTY=new $r,$r._cache={},$r._cache2=null,$r}(),$tv=function(){function $v(){}return $J($v,"laya.webgl.utils.CONST3D2D"),$v.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$v.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$v.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$v._TMPARRAY=[],$v._OFFSETX=0,$v._OFFSETY=0,$$($v,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$v}(),$qv=function(){function $T(){}return $J($T,"laya.webgl.utils.GlUtils"),$T.make2DProjection=function($v,$g,$Q){return[2/$v,0,0,0,0,-2/$g,0,0,0,0,2/$Q,0,-1,1,0,1]},$T.fillIBQuadrangle=function($v,$g){if(65535/4<$g)throw Error("IBQuadrangle count:"+$g+" must<:"+Math.floor(65535/4));$g=Math.floor($g),$v._resizeBuffer(6*($g+1)*2,!1),$v.byteLength=$v.bufferLength;for(var $Q=$v.getUint16Array(),$d=0,$r=0;$r<$g;$r++)$Q[$d++]=4*$r,$Q[$d++]=4*$r+2,$Q[$d++]=4*$r+1,$Q[$d++]=4*$r,$Q[$d++]=4*$r+3,$Q[$d++]=4*$r+2;return $v.setNeedUpload(),!0},$T.expandIBQuadrangle=function($v,$g){$v.bufferLength>=6*$g*2||$T.fillIBQuadrangle($v,$g)},$T.mathCeilPowerOfTwo=function($v){return $v--,$v|=$v>>1,$v|=$v>>2,$v|=$v>>4,$v|=$v>>8,$v|=$v>>16,++$v},$T.fillQuadrangleImgVb=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=16+($v._byteLength>>2);$v.byteLength=$a<<2;var $M=$v.getFloat32Array();$M[($a-=16)+2]=$r[0],$M[$a+3]=$r[1],$M[$a+6]=$r[2],$M[$a+7]=$r[3],$M[$a+10]=$r[4],$M[$a+11]=$r[5],$M[$a+14]=$r[6],$M[$a+15]=$r[7];var $Y=$k.a,$D=$k.b,$J=$k.c,$p=$k.d;if(1!==$Y||0!==$D||0!==$J||1!==$p){$k.bTransform=!0;var $T=$k.tx+$$,$t=$k.ty+$b;$M[$a]=($d[0]+$g)*$Y+($d[1]+$Q)*$J+$T,$M[$a+1]=($d[0]+$g)*$D+($d[1]+$Q)*$p+$t,$M[$a+4]=($d[2]+$g)*$Y+($d[3]+$Q)*$J+$T,$M[$a+5]=($d[2]+$g)*$D+($d[3]+$Q)*$p+$t,$M[$a+8]=($d[4]+$g)*$Y+($d[5]+$Q)*$J+$T,$M[$a+9]=($d[4]+$g)*$D+($d[5]+$Q)*$p+$t,$M[$a+12]=($d[6]+$g)*$Y+($d[7]+$Q)*$J+$T,$M[$a+13]=($d[6]+$g)*$D+($d[7]+$Q)*$p+$t}else $k.bTransform=!1,$g+=$k.tx+$$,$Q+=$k.ty+$b,$M[$a]=$g+$d[0],$M[$a+1]=$Q+$d[1],$M[$a+4]=$g+$d[2],$M[$a+5]=$Q+$d[3],$M[$a+8]=$g+$d[4],$M[$a+9]=$Q+$d[5],$M[$a+12]=$g+$d[6],$M[$a+13]=$Q+$d[7];return $v._upload=!0},$T.fillTranglesVB=function($v,$g,$Q,$d,$r,$k,$$){var $b=($v._byteLength>>2)+$d.length;$v.byteLength=$b<<2;var $a=$v.getFloat32Array();$b-=$d.length;for(var $M=$d.length,$Y=$r.a,$D=$r.b,$J=$r.c,$p=$r.d,$T=0;$T<$M;$T+=4)if($a[$b+$T+2]=$d[$T+2],$a[$b+$T+3]=$d[$T+3],1!==$Y||0!==$D||0!==$J||1!==$p){$r.bTransform=!0;var $t=$r.tx+$k,$q=$r.ty+$$;$a[$b+$T]=($d[$T]+$g)*$Y+($d[$T+1]+$Q)*$J+$t,$a[$b+$T+1]=($d[$T]+$g)*$D+($d[$T+1]+$Q)*$p+$q}else $r.bTransform=!1,$g+=$r.tx+$k,$Q+=$r.ty+$$,$a[$b+$T]=$g+$d[$T],$a[$b+$T+1]=$Q+$d[$T+1];return $v._upload=!0},$T.copyPreImgVb=function($v,$g,$Q){var $d=$v._byteLength>>2;$v.byteLength=$d+16<<2;for(var $r=$v.getFloat32Array(),$k=0,$$=$d-16;$k<4;$k++)$r[$d]=$r[$$]+$g,++$$,$r[++$d]=$r[$$]+$Q,++$$,$r[++$d]=$r[$$],++$$,$r[++$d]=$r[$$],++$d,++$$;$v._upload=!0},$T.fillRectImgVb=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D,$J){void 0===$J&&($J=!1);var $p,$T,$t,$q,$C,$G,$s,$A,$h,$P,$W,$F,$l,$o,$E,$V,$Z=1,$f=$b.a,$X=$b.b,$N=$b.c,$i=$b.d,$x=$g&&$g.width<99999999;if(1!==$f||0!==$X||0!==$N||1!==$i?($b.bTransform=!0,0===$X&&0===$N&&($Z=23,$h=$r+$Q,$P=$k+$d,$p=$f*$Q+($W=$b.tx+$a),$t=$f*$h+$W,$T=$i*$d+($F=$b.ty+$M),$q=$i*$P+$F)):($Z=23,$b.bTransform=!1,$t=($p=$Q+$b.tx+$a)+$r,$q=($T=$d+$b.ty+$M)+$k),$x&&($C=$g.x,$G=$g.y,$s=$g.width+$C,$A=$g.height+$G),1!==$Z){if(Math.min($p,$t)>=$s)return!1;if(Math.min($T,$q)>=$A)return!1;if(Math.max($t,$p)<=$C)return!1;if(Math.max($q,$T)<=$G)return!1}var $w=$v._byteLength>>2;$v.byteLength=16+$w<<2;var $m=$v.getFloat32Array();switch($m[2+$w]=$$[0],$m[3+$w]=$$[1],$m[6+$w]=$$[2],$m[7+$w]=$$[3],$m[10+$w]=$$[4],$m[11+$w]=$$[5],$m[14+$w]=$$[6],$m[15+$w]=$$[7],$Z){case 1:$W=$b.tx+$a,$F=$b.ty+$M;var $K=$f*$Q,$c=$N*$d,$B=$i*$d,$j=$X*$Q,$L=$f*($h=$r+$Q),$H=$N*($P=$k+$d),$n=$i*$P,$y=$X*$h;$J?($l=$K+$c+$W,$E=Math.round($l)-$l,$o=$B+$j+$F,$V=Math.round($o)-$o,$m[$w]=$l+$E,$m[1+$w]=$o+$V,$m[4+$w]=$L+$c+$W+$E,$m[5+$w]=$B+$y+$F+$V,$m[8+$w]=$L+$H+$W+$E,$m[9+$w]=$n+$y+$F+$V,$m[12+$w]=$K+$H+$W+$E,$m[13+$w]=$n+$j+$F+$V):($m[$w]=$K+$c+$W,$m[1+$w]=$B+$j+$F,$m[4+$w]=$L+$c+$W,$m[5+$w]=$B+$y+$F,$m[8+$w]=$L+$H+$W,$m[9+$w]=$n+$y+$F,$m[12+$w]=$K+$H+$W,$m[13+$w]=$n+$j+$F);break;case 23:$J?($l=$p+$Y,$E=Math.round($l)-$l,$o=$T,$V=Math.round($o)-$o,$m[$w]=$l+$E,$m[1+$w]=$o+$V,$m[4+$w]=$t+$Y+$E,$m[5+$w]=$T+$V,$m[8+$w]=$t+$E,$m[9+$w]=$q+$V,$m[12+$w]=$p+$E,$m[13+$w]=$q+$V):($m[$w]=$p+$Y,$m[1+$w]=$T,$m[4+$w]=$t+$Y,$m[5+$w]=$T,$m[8+$w]=$t,$m[9+$w]=$q,$m[12+$w]=$p,$m[13+$w]=$q)}return $v._upload=!0},$T.fillLineVb=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=.5*$$,$M=$T._fillLineArray,$Y=-($d-$k),$D=$Q-$r,$J=Math.sqrt($Y*$Y+$D*$D);$Y/=$J,$D/=$J,$Y*=$a,$D*=$a,$M[0]=$Q-$Y,$M[1]=$d-$D,$M[4]=$Q+$Y,$M[5]=$d+$D,$M[8]=$r+$Y,$M[9]=$k+$D,$M[12]=$r-$Y,$M[13]=$k-$D,$b&&$b.transformPointArray($M,$M);var $p=16+($v._byteLength>>2);return $v.byteLength=$p<<2,$v.insertData($M,$p-16),!0},$T._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$T}(),$Cv=(function(){function $a(){}$J($a,"laya.webgl.utils.MatirxArray"),$a.ArrayMul=function($v,$g,$Q){if($v)if($g)for(var $d=NaN,$r=NaN,$k=NaN,$$=NaN,$b=0;$b<4;$b++)$d=$v[$b],$r=$v[$b+4],$k=$v[$b+8],$$=$v[$b+12],$Q[$b]=$d*$g[0]+$r*$g[1]+$k*$g[2]+$$*$g[3],$Q[$b+4]=$d*$g[4]+$r*$g[5]+$k*$g[6]+$$*$g[7],$Q[$b+8]=$d*$g[8]+$r*$g[9]+$k*$g[10]+$$*$g[11],$Q[$b+12]=$d*$g[12]+$r*$g[13]+$k*$g[14]+$$*$g[15];else $a.copyArray($v,$Q);else $a.copyArray($g,$Q)},$a.copyArray=function($v,$g){if($v&&$g)for(var $Q=0;$Q<$v.length;$Q++)$g[$Q]=$v[$Q]}}(),function(){function $g($v,$g,$Q){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$v,this._vb=new $uv($v,35048),$g&&this._vb._resizeBuffer($g,!1),this._ib=new $_v,$Q&&this._ib._resizeBuffer($Q,!1)}$J($g,"laya.webgl.utils.Mesh2D");var $v=$g.prototype;return $v.cloneWithNewVB=function(){var $v=new $g(this._stride,0,0);return $v._ib=this._ib,$v._quadNum=this._quadNum,$v._attribInfo=this._attribInfo,$v},$v.cloneWithNewVBIB=function(){var $v=new $g(this._stride,0,0);return $v._attribInfo=this._attribInfo,$v},$v.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$v.getVBR=function(){return this._vb},$v.getIBR=function(){return this._ib},$v.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$v.createQuadIB=function($v){this._quadNum=$v,this._ib._resizeBuffer(6*$v*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $g=this._ib.getUint16Array(),$Q=0,$d=0,$r=0;$r<$v;$r++)$g[$Q++]=$d,$g[$Q++]=$d+2,$g[$Q++]=$d+1,$g[$Q++]=$d,$g[$Q++]=$d+3,$g[$Q++]=$d+2,$d+=4;this._ib.setNeedUpload()},$v.setAttributes=function($v){if(this._attribInfo=$v,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$v.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$v.releaseMesh=function(){},$v.destroy=function(){},$v.clearVB=function(){this._vb.clear()},$g._gvaoid=0,$g}()),$Gv=function(){function $r(){}return $J($r,"laya.webgl.utils.RenderState2D"),$r.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$r.mat2MatArray=function($v,$g){var $Q=$v,$d=$g;return $d[0]=$Q.a,$d[1]=$Q.b,$d[2]=$r.EMPTYMAT4_ARRAY[2],$d[3]=$r.EMPTYMAT4_ARRAY[3],$d[4]=$Q.c,$d[5]=$Q.d,$d[6]=$r.EMPTYMAT4_ARRAY[6],$d[7]=$r.EMPTYMAT4_ARRAY[7],$d[8]=$r.EMPTYMAT4_ARRAY[8],$d[9]=$r.EMPTYMAT4_ARRAY[9],$d[10]=$r.EMPTYMAT4_ARRAY[10],$d[11]=$r.EMPTYMAT4_ARRAY[11],$d[12]=$Q.tx,$d[13]=$Q.ty,$d[14]=$r.EMPTYMAT4_ARRAY[14],$d[15]=$r.EMPTYMAT4_ARRAY[15],$g},$r.restoreTempArray=function(){$r.TEMPMAT4_ARRAY[0]=1,$r.TEMPMAT4_ARRAY[1]=0,$r.TEMPMAT4_ARRAY[4]=0,$r.TEMPMAT4_ARRAY[5]=1,$r.TEMPMAT4_ARRAY[12]=0,$r.TEMPMAT4_ARRAY[13]=0},$r.clear=function(){$r.worldScissorTest=!1,$r.worldShaderDefines=null,$r.worldFilters=null,$r.worldAlpha=1,$r.worldClipRect.x=$r.worldClipRect.y=0,$r.worldClipRect.width=$r.width,$r.worldClipRect.height=$r.height,$r.curRenderTarget=null},$r._MAXSIZE=99999999,$r.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$r.worldMatrix4=$r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$r.worldAlpha=1,$r.worldScissorTest=!1,$r.worldFilters=null,$r.worldShaderDefines=null,$r.curRenderTarget=null,$r.width=0,$r.height=0,$$($r,["worldMatrix",function(){return this.worldMatrix=new $l},"worldClipRect",function(){return this.worldClipRect=new $E(0,0,99999999,99999999)}]),$r}(),$sv=function(){var $G,$Q;function $s($v,$g,$Q,$d,$r){var $k=this;function $$($v){var $g=[],$Q=new $G($g);return $k._compileToTree($Q,$v.split("\n"),0,$g,$r),$Q}var $b=$p.now();this._VS=$$($g),this._PS=$$($Q),this._nameMap=$d,2<$p.now()-$b&&console.log("ShaderCompile use time:"+($p.now()-$b)+"  size:"+$g.length+"/"+$Q.length)}$J($s,"laya.webgl.utils.ShaderCompile");var $v=$s.prototype;return $v._compileToTree=function($v,$g,$Q,$d,$r){var $k,$$,$b,$a,$M,$Y,$D,$J=0,$p=0,$T=0,$t=0;for($p=$Q;$p<$g.length;$p++)if(!(($b=$g[$p]).length<1)&&0!==($J=$b.indexOf("//"))){if(0<=$J&&($b=$b.substr(0,$J)),$k=$D||new $G($d),$D=null,$k.text=$b,$k.noCompile=!0,0<=($J=$b.indexOf("#"))){for($a="#",$t=$J+1,$T=$b.length;$t<$T;$t++){var $q=$b.charAt($t);if(" "===$q||"\t"===$q||"\r"===$q||"\n"===$q||"?"===$q)break;$a+=$q}switch($k.name=$a){case"#ifdef":case"#ifndef":if($k.src=$b,$k.noCompile=null!=$b.match(/[!&|()=<>]/),$k.noCompile?console.log("function():Boolean{return "+$b.substr($J+$k.name.length)+"}"):($Y=$b.replace(/^\s*/,"").split(/\s+/),$k.setCondition($Y[1],"#ifdef"===$a?1:2),$k.text="//"+$k.text),$k.setParent($v),$v=$k,$r)for($Y=$b.substr($t).split($s._splitToWordExps3),$t=0;$t<$Y.length;$t++)($b=$Y[$t]).length&&($r[$b]=!0);continue;case"#if":if($k.src=$b,$k.noCompile=!0,$k.setParent($v),$v=$k,$r)for($Y=$b.substr($t).split($s._splitToWordExps3),$t=0;$t<$Y.length;$t++)($b=$Y[$t]).length&&"defined"!=$b&&($r[$b]=!0);continue;case"#else":$k.src=$b,$$=($v=$v.parent).childs[$v.childs.length-1],$k.noCompile=$$.noCompile,$k.noCompile||($k.condition=$$.condition,$k.conditionType=1==$$.conditionType?2:1,$k.text="//"+$k.text+" "+$$.text+" "+$k.conditionType),$k.setParent($v),$v=$k;continue;case"#endif":$$=($v=$v.parent).childs[$v.childs.length-1],$k.noCompile=$$.noCompile,$k.noCompile||($k.text="//"+$k.text),$k.setParent($v);continue;case"#include":$Y=$s.splitToWords($b,null);var $C=$s.includes[$Y[1]];if(!$C)throw"ShaderCompile error no this include file:"+$Y[1];if(($J=$Y[0].indexOf("?"))<0){$k.setParent($v),$b=$C.getWith("with"==$Y[2]?$Y[3]:null),this._compileToTree($k,$b.split("\n"),0,$d,$r),$k.text="";continue}$k.setCondition($Y[0].substr($J+1),1),$k.text=$C.getWith("with"==$Y[2]?$Y[3]:null);break;case"#import":$M=($Y=$s.splitToWords($b,null))[1],$d.push({node:$k,file:$s.includes[$M],ofs:$k.text.length});continue}}else{if(($$=$v.childs[$v.childs.length-1])&&!$$.name){0<$d.length&&$s.splitToWords($b,$$),$D=$k,$$.text+="\n"+$b;continue}0<$d.length&&$s.splitToWords($b,$k)}$k.setParent($v)}},$v.createShader=function($v,$g,$Q){var $d={},$r="";if($v)for(var $k in $v)$r+="#define "+$k+"\n",$d[$k]=!0;var $$=this._VS.toscript($d,[]),$b=this._PS.toscript($d,[]);return($Q||$Uv.create)($r+$$.join("\n"),$r+$b.join("\n"),$g,this._nameMap)},$s._parseOne=function($v,$g,$Q,$d,$r,$k){var $$={type:$s.shaderParamsMap[$Q[$d+1]],name:$Q[$d+2],size:isNaN(parseInt($Q[$d+3]))?1:parseInt($Q[$d+3])};return $k&&("attribute"==$r?$v.push($$):$g.push($$)),":"==$Q[$d+3]&&($$.type=$Q[$d+4],$d+=2),$d+=2},$s.addInclude=function($v,$g){if(!$g||0===$g.length)throw new Error("add shader include file err:"+$v);if($s.includes[$v])throw new Error("add shader include file err, has add:"+$v);$s.includes[$v]=new $Q($g)},$s.preGetParams=function($v,$g){var $Q=[$v,$g],$d={},$r=[],$k=[],$$={},$b=[];$d.attributes=$r,$d.uniforms=$k,$d.defines=$$;for(var $a=0,$M=0,$Y=0;$Y<2;$Y++){$Q[$Y]=$Q[$Y].replace($s._removeAnnotation,"");var $D,$J=$Q[$Y].match($s._reg);for($a=0,$M=$J.length;$a<$M;$a++){var $p=$J[$a];if("attribute"==$p||"uniform"==$p)$a=$s._parseOne($r,$k,$J,$a,$p,!0);else{if("#define"==$p){$b[$p=$J[++$a]]=1;continue}if("#ifdef"==$p){$$[$D=$J[++$a]]=$$[$D]||[];for($a++;$a<$M;$a++)if("attribute"==($p=$J[$a])||"uniform"==$p)$a=$s._parseOne($r,$k,$J,$a,$p,$b[$D]);else if("#else"==$p)for($a++;$a<$M;$a++)if("attribute"==($p=$J[$a])||"uniform"==$p)$a=$s._parseOne($r,$k,$J,$a,$p,!$b[$D]);else if("#endif"==$p)break}}}}return $d},$s.splitToWords=function($v,$g){for(var $Q,$d,$r=[],$k=-1,$$=0,$b=$v.length;$$<$b;$$++)if($Q=$v.charAt($$),0<=" \t=+-*/&%!<>()'\",;".indexOf($Q)){if(0<=$k&&1<$$-$k&&($d=$v.substr($k,$$-$k),$r.push($d)),'"'==$Q||"'"==$Q){var $a=$v.indexOf($Q,$$+1);if($a<0)throw"Sharder err:"+$v;$r.push($v.substr($$+1,$a-$$-1)),$$=$a,$k=-1;continue}"("==$Q&&$g&&0<$r.length&&($d=$r[$r.length-1]+";","vec4;main;".indexOf($d)<0&&($g.useFuns+=$d)),$k=-1}else $k<0&&($k=$$);return $k<$b&&1<$b-$k&&($d=$v.substr($k,$b-$k),$r.push($d)),$r},$s.IFDEF_NO=0,$s.IFDEF_YES=1,$s.IFDEF_ELSE=2,$s.IFDEF_PARENT=3,$s._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$s._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$s._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$s.includes={},$$($s,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$s.__init$=function(){$G=function(){function $Q($v){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$v}$J($Q,"");var $v=$Q.prototype;return $v.setParent=function($v){$v.childs.push(this),this.z=$v.z+1,this.parent=$v},$v.setCondition=function($v,$g){$v&&(this.conditionType=$g,$v=$v.replace(/(\s*$)/g,""),this.condition=function(){return this[$v]},this.condition.__condition=$v)},$v.toscript=function($v,$g){return this._toscript($v,$g,++$Q.__id)},$v._toscript=function($d,$r,$k){if(this.childs.length<1&&!this.text)return $r;$r.length;if(this.condition){var $v=!!this.condition.call($d);if(2===this.conditionType&&($v=!$v),!$v)return $r}if(this.text&&$r.push(this.text),0<this.childs.length&&this.childs.forEach(function($v,$g,$Q){$v._toscript($d,$r,$k)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $g,$Q=0,$$=this.includefiles.length;$Q<$$;$Q++)this.includefiles[$Q].curUseID!=$k&&0<($g=this.includefiles[$Q].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$Q].curUseID=$k,$r[0]=$g+$r[0]);return $r},$Q.__id=1,$Q}(),$Q=function(){function $v($v){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$v;for(var $g=0,$Q=0,$d=0;!(($g=$v.indexOf("#begin",$g))<0);){for($d=$g+5;!(($d=$v.indexOf("#end",$d))<0)&&"i"===$v.charAt($d+4);)$d+=5;if($d<0)throw"add include err,no #end:"+$v;$Q=$v.indexOf("\n",$g);var $r=$s.splitToWords($v.substr($g,$Q-$g),null);"code"==$r[1]?this.codes[$r[2]]=$v.substr($Q+1,$d-$Q-1):"function"==$r[1]&&($Q=$v.indexOf("function",$g),$Q+="function".length,this.funs[$r[3]]=$v.substr($Q+1,$d-$Q-1),this.funnames+=$r[3]+";"),$g=$d+1}}$J($v,"");var $g=$v.prototype;return $g.getWith=function($v){var $g=$v?this.codes[$v]:this.script;if(!$g)throw"get with error:"+$v;return $g},$g.getFunsScript=function($v){var $g="";for(var $Q in this.funs)0<=$v.indexOf($Q+";")&&($g+=this.funs[$Q]);return $g},$v}()},$s}(),$Av=function(){function $$(){}return $J($$,"laya.webgl.WebGL"),$$._uint8ArraySlice=function(){for(var $v=this.length,$g=new Uint8Array(this.length),$Q=0;$Q<$v;$Q++)$g[$Q]=this[$Q];return $g},$$._float32ArraySlice=function(){for(var $v=this.length,$g=new Float32Array(this.length),$Q=0;$Q<$v;$Q++)$g[$Q]=this[$Q];return $g},$$._uint16ArraySlice=function($v){var $g,$Q=arguments,$d=0,$r=0;if(0===$Q.length)for($d=this.length,$g=new Uint16Array($d),$r=0;$r<$d;$r++)$g[$r]=this[$r];else if(2===$Q.length){var $k=$Q[0],$$=$Q[1];if($k<$$)for($d=$$-$k,$g=new Uint16Array($d),$r=$k;$r<$$;$r++)$g[$r-$k]=this[$r];else $g=new Uint16Array(0)}return $g},$$.expandContext=function(){var $v=$r.prototype,$g=CanvasRenderingContext2D.prototype;$g.fillTrangles=$v.fillTrangles,$Iv.__int__(null),$g.setIBVB=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){void 0===$a&&($a=0),void 0===$M&&($M=0),null===$Q&&(this._ib=this._ib||$_v.QuadrangleIB,$Q=this._ib,$qv.expandIBQuadrangle($Q,$d._byteLength/64+8)),this._setIBVB($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M)},$g.fillTrangles=function($v,$g,$Q,$d,$r){this._curMat=this._curMat||$l.create(),this._vb=this._vb||$uv.create(),this._ib||(this._ib=$_v.create(),$qv.fillIBQuadrangle(this._ib,$$/4));var $k=this._vb,$$=$d.length>>4;$qv.fillTranglesVB($k,$g,$Q,$d,$r||this._curMat,0,0),$qv.expandIBQuadrangle(this._ib,$k._byteLength/64+8);var $b=new $Fv(1,0);$b.textureHost=$v;var $a=new $Ov("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$k._vertType=3,this._setIBVB($g,$Q,this._ib,$k,6*$$,$r,$a,$b,0,0)}},$$.enable=function(){if($p.__init__(),$C.isConchApp&&!$C.isConchWebGL)return $h.skinAniSprite=function(){return new $vv},$$.expandContext(),!1;if($h.getWebGLContext=function($v){for(var $g,$Q=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$d=0;$d<$Q.length;$d++){try{$g=$v.getContext($Q[$d],{stencil:$W.isStencil,alpha:$W.isAlpha,antialias:$W.isAntialias,premultipliedAlpha:$W.premultipliedAlpha,preserveDrawingBuffer:$W.preserveDrawingBuffer})}catch($v){}if($g)return $g}return null},null==($$.mainContext=$$.mainContext||$h.getWebGLContext($C._mainCanvas)))return!1;if($C.isWebGL)return!0;$t.create=function($v,$g){return new $vg($v,$g)},$q.create=function($v,$g,$Q,$d,$r,$k,$$){return new $zv($v,$g,$Q,$d,$r,$k,$$)},$C.WebGL=$$,$C.isWebGL=!0,$pv.__init__(),$h.createRenderSprite=function($v,$g){return new $lv($v,$g)},$h.createWebGLContext2D=function($v){return new $Wv($v)},$h.changeWebGLSize=function($v,$g){laya.webgl.WebGL.onStageResize($v,$g)},$h.createGraphics=function(){return new $Pv};var $v=$h.createFilterAction;return $h.createFilterAction=$v||function($v){return new $ov},$h.clear=function($v){$Gv.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $g=$C.context.ctx,$Q=0==$g._submits._length||$W.preserveDrawingBuffer?$T.create($v)._color:$Z._wgColor;$Q&&$g.clearBG($Q[0],$Q[1],$Q[2],$Q[3]),$Gv.clear()},$h.addToAtlas=function($v,$g){void 0===$g&&($g=!1);var $Q=$v.bitmap;$C.optimizeTextureMemory($v.url,$v)?$P.__typeof($Q,"laya.webgl.resource.IMergeAtlasBitmap")&&$Q.allowMerageInAtlas&&$Q.on("recovered",$v,$v.addTextureToAtlas):$Q.enableMerageInAtlas=!1},$h.isAtlas=function($v){return $v instanceof laya.webgl.atlas.AtlasWebGLCanvas},$j._enable(),$h.beginFlush=function(){for(var $v=$j.instance,$g=$v.getAtlaserCount(),$Q=0;$Q<$g;$Q++){var $d=$v.getAtlaserByIndex($Q).texture;$d._flashCacheImageNeedFlush&&$h.flashFlushImage($d)}},$h.drawToCanvas=function($v,$g,$Q,$d,$r,$k){($Q<=0||$d<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$Q|=0,$d|=0,$r|=0,$k|=0;var $$=$mv.create($Q,$d,6408,5121,0,!1);$$.start(),$$.clear(0,0,0,0),$C.context.clear(),$G.renders[$g]._fun($v,$C.context,$r,$Gv.height-$d+$k),$C.context.flush(),$$.end();var $b=$$.getData(0,0,$Q,$d);if($$.recycle(),$b.byteLength==$Q*$d*4){var $a=new $yv;$a._canvas=$p.createElement("canvas"),$a.size($Q,$d);var $M=$a._canvas.getContext("2d");$p.canvas.size($Q,$d);var $Y=$p.context,$D=$Y.createImageData($Q,$d);return $D.data.set(new Uint8ClampedArray($b.buffer)),$a._imgData=$D,$Y.putImageData($D,0,0),$M.save(),$M.translate(0,$d),$M.scale(1,-1),$M.drawImage($p.canvas.source,0,0),$M.restore(),$a}console.log("drawToCanvas error: w:"+$Q+",h:"+$d+",datalen:"+$b.byteLength)},$h.createFilterAction=function($v){var $g;switch($v){case 32:$g=new $ov}return $g},$h.addTextureToAtlas=function($v){$v._uvID++,$j._atlasRestore++,$v.bitmap.enableMerageInAtlas&&$j.instance.addToAtlas($v)},$h.getTexturePixels=function($v,$g,$Q,$d,$r){$C.context.ctx.clear();var $k=new $V;$k.graphics.drawTexture($v,-$g,-$Q);var $$=$mv.create($d,$r);$$.start(),$$.clear(0,0,0,0),$k.render($C.context,0,0),$C.context.ctx.flush(),$$.end();for(var $b=$$.getData(0,0,$d,$r),$a=[],$M=0,$Y=$r-1;0<=$Y;$Y--)for(var $D=0;$D<$d;$D++)$M=4*($Y*$d+$D),$a.push($b[$M]),$a.push($b[$M+1]),$a.push($b[$M+2]),$a.push($b[$M+3]);return $a},$h.skinAniSprite=function(){return new $vv},$M.create=function($v,$g){var $Q=new $yv;return $Q._imgData=$g,$Q.flipY=!1,$Q},$F._filterStart=function($v,$g,$Q,$d,$r){var $k=$v.getValue("bounds"),$$=$mv.create($k.width,$k.height);if($$.start(),$$.clear(0,0,0,0),$v.addValue("src",$$),$v.addValue("ScissorTest",$Gv.worldScissorTest),$Gv.worldScissorTest){var $b=new $E;$b.copyFrom($Q.ctx._clipRect),$v.addValue("clipRect",$b),$Gv.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$F._filterEnd=function($v,$g,$Q,$d,$r){var $k=$v.getValue("bounds");$v.getValue("src").end();var $$=$mv.create($k.width,$k.height);$$.start(),$$.clear(0,0,0,0),$v.addValue("out",$$),$g._set$P("_filterCache",$$),$g._set$P("_isHaveGlowFilter",$v.getValue("_isHaveGlowFilter"))},$F._EndTarget=function($v,$g){if($v.getValue("src").recycle(),$v.getValue("out").end(),$v.getValue("ScissorTest")){$Gv.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$g.ctx.save();var $Q=$v.getValue("clipRect");$g.ctx.clipRect($Q.x,$Q.y,$Q.width,$Q.height)}},$F._useSrc=function($v){var $g=$v.getValue("out");$g.end(),($g=$v.getValue("src")).start(),$g.clear(0,0,0,0)},$F._endSrc=function($v){$v.getValue("src").end()},$F._useOut=function($v){var $g=$v.getValue("src");$g.end(),($g=$v.getValue("out")).start(),$g.clear(0,0,0,0)},$F._endOut=function($v){$v.getValue("out").end()},$F._recycleScope=function($v){$v.recycle()},$F._filter=function($v,$g,$Q,$d){var $r=this._next;if($r){var $k,$$,$b=$v.filters,$a=$b.length;if(1==$a&&32==$b[0].type)return $g.ctx.save(),$g.ctx.setFilters([$b[0]]),$r._fun.call($r,$v,$g,$Q,$d),void $g.ctx.restore();var $M=$bv.create(),$Y=$o.TEMP,$D=$g.ctx._getTransformMatrix(),$J=$l.create();$D.copyTo($J);var $p=0,$T=0,$t=!1,$q=$v._$P._filterCache?$v._$P._filterCache:null;if(!$q||$v._repaint){$t=$v._isHaveGlowFilter(),$M.addValue("_isHaveGlowFilter",$t),$t&&($p=50,$T=25),($$=new $E).copyFrom($v.getSelfBounds()),$$.x+=$v.x,$$.y+=$v.y,$$.x-=$v.pivotX+4,$$.y-=$v.pivotY+4;var $C=$$.x,$G=$$.y;if($$.width+=$p+8,$$.height+=$p+8,$Y.x=$$.x*$J.a+$$.y*$J.c,$Y.y=$$.y*$J.d+$$.x*$J.b,$$.x=$Y.x,$$.y=$Y.y,$Y.x=$$.width*$J.a+$$.height*$J.c,$Y.y=$$.height*$J.d+$$.width*$J.b,$$.width=$Y.x,$$.height=$Y.y,$$.width<=0||$$.height<=0)return;$q&&$q.recycle(),$M.addValue("bounds",$$);var $s=$$v.create([$M,$v,$g,0,0],$F._filterStart);$g.addRenderObject($s),$g.ctx._renderKey=0,$g.ctx._shader2D.glTexture=null;var $A=$v.x-$C+$T,$h=$v.y-$G+$T;$r._fun.call($r,$v,$g,$A,$h),$s=$$v.create([$M,$v,$g,0,0],$F._filterEnd),$g.addRenderObject($s);for(var $P=0;$P<$a;$P++){0!=$P&&($s=$$v.create([$M],$F._useSrc),$g.addRenderObject($s),$k=$Fv.create(1,0),$l.TEMP.identity(),$g.ctx.drawTarget($M,0,0,$$.width,$$.height,$l.TEMP,"out",$k,null,$H.TOINT.overlay),$s=$$v.create([$M],$F._useOut),$g.addRenderObject($s)),$b[$P].action.apply3d($M,$v,$g,0,0)}$s=$$v.create([$M,$g],$F._EndTarget),$g.addRenderObject($s)}else{if(($t=!!$v._$P._isHaveGlowFilter&&$v._$P._isHaveGlowFilter)&&($p=50,$T=25),($$=$v.getBounds()).width<=0||$$.height<=0)return;$$.width+=$p,$$.height+=$p,$Y.x=$$.x*$J.a+$$.y*$J.c,$Y.y=$$.y*$J.d+$$.x*$J.b,$$.x=$Y.x,$$.y=$Y.y,$Y.x=$$.width*$J.a+$$.height*$J.c,$Y.y=$$.height*$J.d+$$.width*$J.b,$$.width=$Y.x,$$.height=$Y.y,$M.addValue("out",$q)}$Q=$Q-$T-$v.x,$d=$d-$T-$v.y,$Y.setTo($Q,$d),$J.transformPoint($Y),$Q=$Y.x+$$.x,$d=$Y.y+$$.y,$k=$Fv.create(1,0),$l.TEMP.identity(),$g.ctx.drawTarget($M,$Q,$d,$$.width,$$.height,$l.TEMP,"out",$k,null,$H.TOINT.overlay),$s=$$v.create([$M],$F._recycleScope),$g.addRenderObject($s),$J.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$$._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$$._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$$._uint8ArraySlice),!0},$$.onStageResize=function($v,$g){null!=$$.mainContext&&($$.mainContext.viewport(0,0,$v,$g),$Gv.width=$v,$Gv.height=$g)},$$.onInvalidGLRes=function(){$j.instance.freeAll(),$A.releaseContentManagers(!0),$$.doNodeRepaint($P.stage),$$.mainContext.viewport(0,0,$Gv.width,$Gv.height),$P.stage.event("devicelost")},$$.doNodeRepaint=function($v){0==$v.numChildren&&$v.repaint();for(var $g=0;$g<$v.numChildren;$g++)$$.doNodeRepaint($v.getChildAt($g))},$$.init=function($v,$g,$Q){$$.mainCanvas=$v,$M._createContext=function($v){return new $Wv($v)},$yv._createContext=function($v){return new $Wv($v)};var $d=laya.webgl.WebGL.mainContext;if(null!=$d.getShaderPrecisionFormat){var $r=$d.getShaderPrecisionFormat(35633,36338),$k=$d.getShaderPrecisionFormat(35632,36338);$$.shaderHighPrecision=!(!$r.precision||!$k.precision)}else $$.shaderHighPrecision=!1;if($$.compressAstc=$d.getExtension("WEBGL_compressed_texture_astc"),$$.compressAtc=$d.getExtension("WEBGL_compressed_texture_atc"),$$.compressEtc=$d.getExtension("WEBGL_compressed_texture_etc"),$$.compressEtc1=$d.getExtension("WEBGL_compressed_texture_etc1"),$$.compressPvrtc=$d.getExtension("WEBGL_compressed_texture_pvrtc"),$$.compressS3tc=$d.getExtension("WEBGL_compressed_texture_s3tc"),$$.compressS3tc_srgb=$d.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$$.compressAstc=$$.compressAstc?$$.compressAstc:{},$$.compressAtc=$$.compressAtc?$$.compressAtc:{},$$.compressEtc=$$.compressEtc?$$.compressEtc:{},$$.compressEtc1=$$.compressEtc1?$$.compressEtc1:{},$$.compressPvrtc=$$.compressPvrtc?$$.compressPvrtc:{},$$.compressS3tc=$$.compressS3tc?$$.compressS3tc:{},$$.compressS3tc_srgb=$$.compressS3tc_srgb?$$.compressS3tc_srgb:{},$d.deleteTexture1=$d.deleteTexture,$d.deleteTexture=function($v){$v==$hv.curBindTexValue&&($hv.curBindTexValue=null),$d.deleteTexture1($v)},$$.onStageResize($g,$Q),null==$$.mainContext)throw new Error("webGL getContext err!");$N.__init__(),$j.__init__(),$Vv.__init__(),$kv.__init__(),$Wv.__init__(),$Fv.__init__(),$_.__init__(),$Iv.__int__($d),$H._init_($d),$C.isConchApp&&conch.setOnInvalidGLRes($$.onInvalidGLRes)},$$.mainCanvas=null,$$.antialias=!0,$$.shaderHighPrecision=!1,$$._bg_null=[0,0,0,0],$$}(),$hv=function(){function $d(){}return $J($d,"laya.webgl.WebGLContext"),$d.UseProgram=function($v){return $d._useProgram!==$v&&($Av.mainContext.useProgram($v),$d._useProgram=$v,!0)},$d.setDepthTest=function($v,$g){$g!==$d._depthTest&&(($d._depthTest=$g)?$v.enable(2929):$v.disable(2929))},$d.setDepthMask=function($v,$g){$g!==$d._depthMask&&($d._depthMask=$g,$v.depthMask($g))},$d.setDepthFunc=function($v,$g){$g!==$d._depthFunc&&($d._depthFunc=$g,$v.depthFunc($g))},$d.setBlend=function($v,$g){$g!==$d._blend&&(($d._blend=$g)?$v.enable(3042):$v.disable(3042))},$d.setBlendFunc=function($v,$g,$Q){($g!==$d._sFactor||$Q!==$d._dFactor)&&($d._sFactor=$g,$d._dFactor=$Q,$v.blendFunc($g,$Q))},$d.setCullFace=function($v,$g){$g!==$d._cullFace&&(($d._cullFace=$g)?$v.enable(2884):$v.disable(2884))},$d.setFrontFace=function($v,$g){$g!==$d._frontFace&&($d._frontFace=$g,$v.frontFace($g))},$d.bindTexture=function($v,$g,$Q){$v.bindTexture($g,$Q),$d.curBindTexTarget=$g,$d.curBindTexValue=$Q},$d.DEPTH_BUFFER_BIT=256,$d.STENCIL_BUFFER_BIT=1024,$d.COLOR_BUFFER_BIT=16384,$d.POINTS=0,$d.LINES=1,$d.LINE_LOOP=2,$d.LINE_STRIP=3,$d.TRIANGLES=4,$d.TRIANGLE_STRIP=5,$d.TRIANGLE_FAN=6,$d.ZERO=0,$d.ONE=1,$d.SRC_COLOR=768,$d.ONE_MINUS_SRC_COLOR=769,$d.SRC_ALPHA=770,$d.ONE_MINUS_SRC_ALPHA=771,$d.DST_ALPHA=772,$d.ONE_MINUS_DST_ALPHA=773,$d.DST_COLOR=774,$d.ONE_MINUS_DST_COLOR=775,$d.SRC_ALPHA_SATURATE=776,$d.FUNC_ADD=32774,$d.BLEND_EQUATION=32777,$d.BLEND_EQUATION_RGB=32777,$d.BLEND_EQUATION_ALPHA=34877,$d.FUNC_SUBTRACT=32778,$d.FUNC_REVERSE_SUBTRACT=32779,$d.BLEND_DST_RGB=32968,$d.BLEND_SRC_RGB=32969,$d.BLEND_DST_ALPHA=32970,$d.BLEND_SRC_ALPHA=32971,$d.CONSTANT_COLOR=32769,$d.ONE_MINUS_CONSTANT_COLOR=32770,$d.CONSTANT_ALPHA=32771,$d.ONE_MINUS_CONSTANT_ALPHA=32772,$d.BLEND_COLOR=32773,$d.ARRAY_BUFFER=34962,$d.ELEMENT_ARRAY_BUFFER=34963,$d.ARRAY_BUFFER_BINDING=34964,$d.ELEMENT_ARRAY_BUFFER_BINDING=34965,$d.STREAM_DRAW=35040,$d.STATIC_DRAW=35044,$d.DYNAMIC_DRAW=35048,$d.BUFFER_SIZE=34660,$d.BUFFER_USAGE=34661,$d.CURRENT_VERTEX_ATTRIB=34342,$d.FRONT=1028,$d.BACK=1029,$d.CULL_FACE=2884,$d.FRONT_AND_BACK=1032,$d.BLEND=3042,$d.DITHER=3024,$d.STENCIL_TEST=2960,$d.DEPTH_TEST=2929,$d.SCISSOR_TEST=3089,$d.POLYGON_OFFSET_FILL=32823,$d.SAMPLE_ALPHA_TO_COVERAGE=32926,$d.SAMPLE_COVERAGE=32928,$d.NO_ERROR=0,$d.INVALID_ENUM=1280,$d.INVALID_VALUE=1281,$d.INVALID_OPERATION=1282,$d.OUT_OF_MEMORY=1285,$d.CW=2304,$d.CCW=2305,$d.LINE_WIDTH=2849,$d.ALIASED_POINT_SIZE_RANGE=33901,$d.ALIASED_LINE_WIDTH_RANGE=33902,$d.CULL_FACE_MODE=2885,$d.FRONT_FACE=2886,$d.DEPTH_RANGE=2928,$d.DEPTH_WRITEMASK=2930,$d.DEPTH_CLEAR_VALUE=2931,$d.DEPTH_FUNC=2932,$d.STENCIL_CLEAR_VALUE=2961,$d.STENCIL_FUNC=2962,$d.STENCIL_FAIL=2964,$d.STENCIL_PASS_DEPTH_FAIL=2965,$d.STENCIL_PASS_DEPTH_PASS=2966,$d.STENCIL_REF=2967,$d.STENCIL_VALUE_MASK=2963,$d.STENCIL_WRITEMASK=2968,$d.STENCIL_BACK_FUNC=34816,$d.STENCIL_BACK_FAIL=34817,$d.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$d.STENCIL_BACK_PASS_DEPTH_PASS=34819,$d.STENCIL_BACK_REF=36003,$d.STENCIL_BACK_VALUE_MASK=36004,$d.STENCIL_BACK_WRITEMASK=36005,$d.VIEWPORT=2978,$d.SCISSOR_BOX=3088,$d.COLOR_CLEAR_VALUE=3106,$d.COLOR_WRITEMASK=3107,$d.UNPACK_ALIGNMENT=3317,$d.PACK_ALIGNMENT=3333,$d.MAX_TEXTURE_SIZE=3379,$d.MAX_VIEWPORT_DIMS=3386,$d.SUBPIXEL_BITS=3408,$d.RED_BITS=3410,$d.GREEN_BITS=3411,$d.BLUE_BITS=3412,$d.ALPHA_BITS=3413,$d.DEPTH_BITS=3414,$d.STENCIL_BITS=3415,$d.POLYGON_OFFSET_UNITS=10752,$d.POLYGON_OFFSET_FACTOR=32824,$d.TEXTURE_BINDING_2D=32873,$d.SAMPLE_BUFFERS=32936,$d.SAMPLES=32937,$d.SAMPLE_COVERAGE_VALUE=32938,$d.SAMPLE_COVERAGE_INVERT=32939,$d.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$d.COMPRESSED_TEXTURE_FORMATS=34467,$d.DONT_CARE=4352,$d.FASTEST=4353,$d.NICEST=4354,$d.GENERATE_MIPMAP_HINT=33170,$d.BYTE=5120,$d.UNSIGNED_BYTE=5121,$d.SHORT=5122,$d.UNSIGNED_SHORT=5123,$d.INT=5124,$d.UNSIGNED_INT=5125,$d.FLOAT=5126,$d.DEPTH_COMPONENT=6402,$d.ALPHA=6406,$d.RGB=6407,$d.RGBA=6408,$d.LUMINANCE=6409,$d.LUMINANCE_ALPHA=6410,$d.UNSIGNED_SHORT_4_4_4_4=32819,$d.UNSIGNED_SHORT_5_5_5_1=32820,$d.UNSIGNED_SHORT_5_6_5=33635,$d.FRAGMENT_SHADER=35632,$d.VERTEX_SHADER=35633,$d.MAX_VERTEX_ATTRIBS=34921,$d.MAX_VERTEX_UNIFORM_VECTORS=36347,$d.MAX_VARYING_VECTORS=36348,$d.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$d.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$d.MAX_TEXTURE_IMAGE_UNITS=34930,$d.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$d.SHADER_TYPE=35663,$d.DELETE_STATUS=35712,$d.LINK_STATUS=35714,$d.VALIDATE_STATUS=35715,$d.ATTACHED_SHADERS=35717,$d.ACTIVE_UNIFORMS=35718,$d.ACTIVE_ATTRIBUTES=35721,$d.SHADING_LANGUAGE_VERSION=35724,$d.CURRENT_PROGRAM=35725,$d.NEVER=512,$d.LESS=513,$d.EQUAL=514,$d.LEQUAL=515,$d.GREATER=516,$d.NOTEQUAL=517,$d.GEQUAL=518,$d.ALWAYS=519,$d.KEEP=7680,$d.REPLACE=7681,$d.INCR=7682,$d.DECR=7683,$d.INVERT=5386,$d.INCR_WRAP=34055,$d.DECR_WRAP=34056,$d.VENDOR=7936,$d.RENDERER=7937,$d.VERSION=7938,$d.NEAREST=9728,$d.LINEAR=9729,$d.NEAREST_MIPMAP_NEAREST=9984,$d.LINEAR_MIPMAP_NEAREST=9985,$d.NEAREST_MIPMAP_LINEAR=9986,$d.LINEAR_MIPMAP_LINEAR=9987,$d.TEXTURE_MAG_FILTER=10240,$d.TEXTURE_MIN_FILTER=10241,$d.TEXTURE_WRAP_S=10242,$d.TEXTURE_WRAP_T=10243,$d.TEXTURE_2D=3553,$d.TEXTURE=5890,$d.TEXTURE_CUBE_MAP=34067,$d.TEXTURE_BINDING_CUBE_MAP=34068,$d.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$d.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$d.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$d.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$d.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$d.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$d.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$d.TEXTURE0=33984,$d.TEXTURE1=33985,$d.TEXTURE2=33986,$d.TEXTURE3=33987,$d.TEXTURE4=33988,$d.TEXTURE5=33989,$d.TEXTURE6=33990,$d.TEXTURE7=33991,$d.TEXTURE8=33992,$d.TEXTURE9=33993,$d.TEXTURE10=33994,$d.TEXTURE11=33995,$d.TEXTURE12=33996,$d.TEXTURE13=33997,$d.TEXTURE14=33998,$d.TEXTURE15=33999,$d.TEXTURE16=34e3,$d.TEXTURE17=34001,$d.TEXTURE18=34002,$d.TEXTURE19=34003,$d.TEXTURE20=34004,$d.TEXTURE21=34005,$d.TEXTURE22=34006,$d.TEXTURE23=34007,$d.TEXTURE24=34008,$d.TEXTURE25=34009,$d.TEXTURE26=34010,$d.TEXTURE27=34011,$d.TEXTURE28=34012,$d.TEXTURE29=34013,$d.TEXTURE30=34014,$d.TEXTURE31=34015,$d.ACTIVE_TEXTURE=34016,$d.REPEAT=10497,$d.CLAMP_TO_EDGE=33071,$d.MIRRORED_REPEAT=33648,$d.FLOAT_VEC2=35664,$d.FLOAT_VEC3=35665,$d.FLOAT_VEC4=35666,$d.INT_VEC2=35667,$d.INT_VEC3=35668,$d.INT_VEC4=35669,$d.BOOL=35670,$d.BOOL_VEC2=35671,$d.BOOL_VEC3=35672,$d.BOOL_VEC4=35673,$d.FLOAT_MAT2=35674,$d.FLOAT_MAT3=35675,$d.FLOAT_MAT4=35676,$d.SAMPLER_2D=35678,$d.SAMPLER_CUBE=35680,$d.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$d.VERTEX_ATTRIB_ARRAY_SIZE=34339,$d.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$d.VERTEX_ATTRIB_ARRAY_TYPE=34341,$d.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$d.VERTEX_ATTRIB_ARRAY_POINTER=34373,$d.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$d.COMPILE_STATUS=35713,$d.LOW_FLOAT=36336,$d.MEDIUM_FLOAT=36337,$d.HIGH_FLOAT=36338,$d.LOW_INT=36339,$d.MEDIUM_INT=36340,$d.HIGH_INT=36341,$d.FRAMEBUFFER=36160,$d.RENDERBUFFER=36161,$d.RGBA4=32854,$d.RGB5_A1=32855,$d.RGB565=36194,$d.DEPTH_COMPONENT16=33189,$d.STENCIL_INDEX=6401,$d.STENCIL_INDEX8=36168,$d.DEPTH_STENCIL=34041,$d.RENDERBUFFER_WIDTH=36162,$d.RENDERBUFFER_HEIGHT=36163,$d.RENDERBUFFER_INTERNAL_FORMAT=36164,$d.RENDERBUFFER_RED_SIZE=36176,$d.RENDERBUFFER_GREEN_SIZE=36177,$d.RENDERBUFFER_BLUE_SIZE=36178,$d.RENDERBUFFER_ALPHA_SIZE=36179,$d.RENDERBUFFER_DEPTH_SIZE=36180,$d.RENDERBUFFER_STENCIL_SIZE=36181,$d.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$d.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$d.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$d.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$d.COLOR_ATTACHMENT0=36064,$d.DEPTH_ATTACHMENT=36096,$d.STENCIL_ATTACHMENT=36128,$d.DEPTH_STENCIL_ATTACHMENT=33306,$d.NONE=0,$d.FRAMEBUFFER_COMPLETE=36053,$d.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$d.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$d.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$d.FRAMEBUFFER_UNSUPPORTED=36061,$d.FRAMEBUFFER_BINDING=36006,$d.RENDERBUFFER_BINDING=36007,$d.MAX_RENDERBUFFER_SIZE=34024,$d.INVALID_FRAMEBUFFER_OPERATION=1286,$d.UNPACK_FLIP_Y_WEBGL=37440,$d.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$d.CONTEXT_LOST_WEBGL=37442,$d.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$d.BROWSER_DEFAULT_WEBGL=37444,$d._useProgram=null,$d._depthTest=!0,$d._depthMask=!0,$d._blend=!1,$d._cullFace=!1,$d.curBindTexTarget=null,$d.curBindTexValue=null,$$($d,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$d}(),$Pv=function($v){function $g(){$g.__super.call(this)}$J($g,"laya.webgl.display.GraphicsGL",$b);var $Q=$g.prototype;return $Q.setShader=function($v){this._saveToCmd($C.context._setShader,[$v])},$Q.setIBVB=function($v,$g,$Q,$d,$r,$k){this._saveToCmd($C.context._setIBVB,[$v,$g,$Q,$d,$r,$k])},$Q.drawParticle=function($v,$g,$Q){var $d=$h.createParticleTemplate2D($Q);$d.x=$v,$d.y=$g,this._saveToCmd($C.context._drawParticle,[$d])},$g}(),$Wv=function($v){var $Q;function $B($v){this._x=0,this._y=0,this._id=++$B._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$B.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$B.MAXCLIPRECT,this.mOutPoint,this._canvas=$v,this._canvas._addReference(),$B._contextcount++,$C.isFlash?(this._ib=$_v.create(35044),$qv.fillIBQuadrangle(this._ib,16)):this._ib=$_v.QuadrangleIB,this.clear()}$J($B,"laya.webgl.canvas.WebGLContext2D",$r);var $g=$B.prototype;return $g.setIsMainContext=function(){this._isMain=!0},$g.clearBG=function($v,$g,$Q,$d){var $r=$Av.mainContext;$r.clearColor($v,$g,$Q,$d),$r.clear(16384)},$g._getSubmits=function(){return this._submits},$g._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $v=0,$g=this._submits._length;$v<$g;$v++)this._submits[$v].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$g.destroy=function(){--$B._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$_v.QuadrangleIB&&this._ib.releaseResource()},$g.clear=function(){this._submits||(this._other=$Q.DEFAULT,this._curMat=$l.create(),this._vb=$uv.create(-1),this._submits=[],this._save=[$U.Create(this)],this._save.length=10,this._shader2D=new $_,this._triangleMesh=$xv.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$Q.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$B.MAXCLIPRECT,this._curSubmit=$kv.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$n.DEFAULT;for(var $v=0,$g=this._submits._length;$v<$g;$v++)this._submits[$v].releaseRender(),this._submits[$v]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$g.size=function($v,$g){if(this._width!=$v||this._height!=$g)if(0==$v||0==$g){0!=this._vb._byteLength&&(this._width=$v,this._height=$g,this._vb.clear(),this._vb.upload());for(var $Q=0,$d=this._submits._length;$Q<$d;$Q++)this._submits[$Q].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$v,this._height=$g,this._targets&&this._targets.size($v,$g),this._canvas.memorySize-=this._canvas.memorySize;0===$v&&0===$g&&this._releaseMem()},$g._getTransformMatrix=function(){return this._curMat},$g.translate=function($v,$g){0===$v&&0===$g||($S.save(this),this._curMat.bTransform&&($I.save(this),this._curMat.transformPointN($o.TEMP.setTo($v,$g)),$v=$o.TEMP.x,$g=$o.TEMP.y),this._x+=$v,this._y+=$g)},$g.save=function(){this._save[this._save._length++]=$U.Create(this)},$g.restore=function(){var $v=this._save._length;if(!($v<1))for(var $g=$v-1;0<=$g;$g--){var $Q=this._save[$g];if($Q.restore(this),$Q.isSaveMark())return void(this._save._length=$g)}},$g._fillText=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){void 0===$M&&($M=0);var $Y=this._shader2D,$D=this._curSubmit.shaderValue,$J=$r?$Tv.create($r):this._other.font;if($j.enabled)$Y.ALPHA!==$D.ALPHA&&($Y.glTexture=null),$pv.drawText(this,$v,$g,this._curMat,$J,$a||this._other.textAlign,$k,$$,$b,$Q,$d,$M);else{this._shader2D.defines.getValue();var $p=$k?$T.create($k)._color:$Y.colorAdd;$Y.ALPHA===$D.ALPHA&&$p===$Y.colorAdd&&$D.colorAdd===$Y.colorAdd||($Y.glTexture=null,$Y.colorAdd=$p),$pv.drawText(this,$v,$g,this._curMat,$J,$a||this._other.textAlign,$k,$$,$b,$Q,$d,$M)}},$g.fillWords=function($v,$g,$Q,$d,$r,$k){this._fillText(null,$v,$g,$Q,$d,$r,null,-1,null,$k)},$g.fillBorderWords=function($v,$g,$Q,$d,$r,$k,$$){this._fillBorderText(null,$v,$g,$Q,$d,$r,$k,$$,null)},$g.fillText=function($v,$g,$Q,$d,$r,$k){this._fillText($v,null,$g,$Q,$d,$r,null,-1,$k)},$g.strokeText=function($v,$g,$Q,$d,$r,$k,$$){this._fillText($v,null,$g,$Q,$d,null,$r,$k||1,$$)},$g.fillBorderText=function($v,$g,$Q,$d,$r,$k,$$,$b){this._fillBorderText($v,null,$g,$Q,$d,$r,$k,$$,$b)},$g._fillBorderText=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){if(!$j.enabled)return this._fillText($v,$g,$Q,$d,$r,null,$$,$b||1,$a),void this._fillText($v,$g,$Q,$d,$r,$k,null,-1,$a);var $M=this._shader2D,$Y=this._curSubmit.shaderValue;$M.ALPHA!==$Y.ALPHA&&($M.glTexture=null);var $D=$r?($B._fontTemp.setFont($r),$B._fontTemp):this._other.font;$pv.drawText(this,$v,$g,this._curMat,$D,$a||this._other.textAlign,$k,$$,$b||1,$Q,$d,0)},$g.fillRect=function($v,$g,$Q,$d,$r){var $k=this._vb;if($qv.fillRectImgVb($k,this._clipRect,$v,$g,$Q,$d,$x.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $$=this._shader2D.fillStyle;$r&&(this._shader2D.fillStyle=$n.create($r));var $b=this._shader2D,$a=this._curSubmit.shaderValue;if($b.fillStyle!==$a.fillStyle||$b.ALPHA!==$a.ALPHA){$b.glTexture=null;var $M=this._curSubmit=$kv.createSubmit(this,this._ib,$k,($k._byteLength-64)/32*3,$Fv.create(2,0));$M.shaderValue.color=$b.fillStyle._color._color,$M.shaderValue.ALPHA=$b.ALPHA,this._submits[this._submits._length++]=$M}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$$}},$g.fillTexture=function($v,$g,$Q,$d,$r,$k,$$,$b){if($v.loaded&&$v.bitmap&&$v.source){var $a=this._vb,$M=$v.bitmap.width,$Y=$v.bitmap.height,$D=$v.uv,$J=$$.x%$v.width,$p=$$.y%$v.height;if($M!=$b.w||$Y!=$b.h){if(!$b.w&&!$b.h)switch($b.oy=$b.ox=0,$k){case"repeat":$b.width=$d,$b.height=$r;break;case"repeat-x":$b.width=$d,$p<0?$v.height+$p>$r?$b.height=$r:$b.height=$v.height+$p:($b.oy=$p,$v.height+$p>$r?$b.height=$r-$p:$b.height=$v.height);break;case"repeat-y":$J<0?$v.width+$J>$d?$b.width=$d:$b.width=$v.width+$J:($b.ox=$J,$v.width+$J>$d?$b.width=$d-$J:$b.width=$v.width),$b.height=$r;break;case"no-repeat":$J<0?$v.width+$J>$d?$b.width=$d:$b.width=$v.width+$J:($b.ox=$J,$v.width+$J>$d?$b.width=$d-$J:$b.width=$v.width),$p<0?$v.height+$p>$r?$b.height=$r:$b.height=$v.height+$p:($b.oy=$p,$v.height+$p>$r?$b.height=$r-$p:$b.height=$v.height);break;default:$b.width=$d,$b.height=$r}$b.w=$M,$b.h=$Y,$b.uv=[0,0,$b.width/$M,0,$b.width/$M,$b.height/$Y,0,$b.height/$Y]}if($g+=$b.ox,$Q+=$b.oy,$J-=$b.ox,$p-=$b.oy,$qv.fillRectImgVb($a,this._clipRect,$g,$Q,$b.width,$b.height,$b.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $T=$iv.create(this,this._ib,$a,($a._byteLength-64)/32*3,$Fv.create(256,0)),$t=(this._submits[this._submits._length++]=$T).shaderValue;$t.textureHost=$v;var $q=$D[0]*$M,$C=$D[1]*$Y,$G=($D[2]-$D[0])*$M,$s=($D[5]-$D[3])*$Y,$A=-$J/$M,$h=-$p/$Y;$t.u_TexRange[0]=$q/$M,$t.u_TexRange[1]=$G/$M,$t.u_TexRange[2]=$C/$Y,$t.u_TexRange[3]=$s/$Y,$t.u_offset[0]=$A,$t.u_offset[1]=$h,$j.enabled&&!this._isMain&&$T.addTexture($v,($a._byteLength>>2)-16),(this._curSubmit=$T)._renderType=10017,$T._numEle+=6}}else this.sprite&&$P.timer.callLater(this,this._repaintSprite)},$g.setShader=function($v){$e.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$v},$g.setFilters=function($v){$e.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$v,this._curSubmit=$kv.RENDERBASE,this._renderKey=0,this._drawCount++},$g.drawTexture=function($v,$g,$Q,$d,$r,$k,$$){this._drawTextureM($v,$g,$Q,$d,$r,$k,$$,null,1)},$g.addTextureVb=function($v,$g,$Q){var $d=this._curSubmit._vb||this._vb,$r=$d._byteLength>>2;$d.byteLength=$r+16<<2;for(var $k=$d.getFloat32Array(),$$=0;$$<16;$$+=4)$k[$r++]=$v[$$]+$g,$k[$r++]=$v[$$+1]+$Q,$k[$r++]=$v[$$+2],$k[$r++]=$v[$$+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$d._upload=!0},$g.willDrawTexture=function($v,$g){if(!($v.loaded&&$v.bitmap&&$v.source))return this.sprite&&$P.timer.callLater(this,this._repaintSprite),0;var $Q=$v.bitmap,$d=$Q.id+this._shader2D.ALPHA*$g+10016;if($d==this._renderKey)return $d;var $r=this._shader2D,$k=$r.ALPHA,$$=this._curSubmit.shaderValue;$r.ALPHA*=$g,this._renderKey=$d,this._drawCount++,$r.glTexture=$Q;var $b=this._vb,$a=null,$M=$b._byteLength/32*3,$Y=$$.textureHost&&$$.textureHost==$v&&$$.textureHost.alphaTexture==$v.alphaTexture;return $a=$iv.create(this,this._ib,$b,$M,$Fv.create(1,0)),(this._submits[this._submits._length++]=$a).shaderValue.textureHost=$v,$a._renderType=10016,$a._preIsSameTextureShader=10016===this._curSubmit._renderType&&$r.ALPHA===$$.ALPHA&&$Y,this._curSubmit=$a,$r.ALPHA=$k,$d},$g.drawTextures=function($v,$g,$Q,$d){if($v.loaded&&$v.bitmap&&$v.source){var $r=this._clipRect;if(this._clipRect=$B.MAXCLIPRECT,this._drawTextureM($v,$g[0],$g[1],$v.width,$v.height,$Q,$d,null,1)){if(this._clipRect=$r,$f.drawCall++,!($g.length<4)){for(var $k=this._curSubmit._vb||this._vb,$$=this._curMat.a,$b=this._curMat.d,$a=2,$M=$g.length;$a<$M;$a+=2)$qv.copyPreImgVb($k,($g[$a]-$g[$a-2])*$$,($g[$a+1]-$g[$a-1])*$b),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$P.timer.callLater(this,this._repaintSprite)},$g._drawTextureM=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){if(!$v.loaded||!$v.source)return this.sprite&&$P.timer.callLater(this,this._repaintSprite),!1;var $M=this._curSubmit._vb||this._vb,$Y=$v.bitmap;$g+=$k,$Q+=$$,this._drawCount++;var $D=$Y.id+this._shader2D.ALPHA*$a+10016;if($D!=this._renderKey){this._renderKey=$D;var $J=this._curSubmit.shaderValue,$p=this._shader2D,$T=$p.ALPHA;$p.ALPHA*=$a,$p.glTexture=$Y;var $t=this._vb,$q=null,$C=$t._byteLength/32*3,$G=$J.textureHost&&$J.textureHost==$v&&$J.textureHost.alphaTexture==$v.alphaTexture;$q=$iv.create(this,this._ib,$t,$C,$Fv.create(1,0)),(this._submits[this._submits._length++]=$q).shaderValue.textureHost=$v,$q._renderType=10016,$q._preIsSameTextureShader=10016===this._curSubmit._renderType&&$p.ALPHA===$J.ALPHA&&$G,this._curSubmit=$q,$M=this._curSubmit._vb||this._vb,$p.ALPHA=$T}return!!$qv.fillRectImgVb($M,this._clipRect,$g,$Q,$d||$v.width,$r||$v.height,$v.uv,$b||this._curMat,this._x,this._y,0,0)&&($j.enabled&&!this._isMain&&this._curSubmit.addTexture($v,($M._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$g._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$g._drawText=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){var $Y=$v.bitmap;this._drawCount++;var $D=$Y.id+this._shader2D.ALPHA+10016;if($D!=this._renderKey){this._renderKey=$D;var $J=this._curSubmit.shaderValue,$p=this._shader2D;$p.glTexture=$Y;var $T=this._vb,$t=null,$q=$T._byteLength/32*3,$C=$J.textureHost&&$J.textureHost==$v&&$J.textureHost.alphaTexture==$v.alphaTexture;($t=$j.enabled?$iv.create(this,this._ib,$T,$q,$Fv.create(1,0)):$iv.create(this,this._ib,$T,$q,$Sv.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$p.ALPHA===$J.ALPHA&&$C,(this._submits[this._submits._length++]=$t).shaderValue.textureHost=$v,$t._renderType=10016,this._curSubmit=$t}$v.active();var $G=this._curSubmit._vb||this._vb;$qv.fillRectImgVb($G,this._clipRect,$g+$$,$Q+$b,$d||$v.width,$r||$v.height,$v.uv,$k||this._curMat,this._x,this._y,$a,$M,!0)&&($j.enabled&&!this._isMain&&this._curSubmit.addTexture($v,($G._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$g.drawTextureWithTransform=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){if($k){var $M=this._curMat,$Y=this._x,$D=this._y;(0!==$$||0!==$b)&&(this._x=$$*$M.a+$b*$M.c,this._y=$b*$M.d+$$*$M.b),$k&&$M.bTransform?($l.mul($k,$M,$B._tmpMatrix),($k=$B._tmpMatrix)._checkTransform()):(this._x+=$M.tx,this._y+=$M.ty),this._drawTextureM($v,$g,$Q,$d,$r,0,0,$k,$a),this._x=$Y,this._y=$D}else this._drawTextureM($v,$g,$Q,$d,$r,$$,$b,null,$a)},$g.fillQuadrangle=function($v,$g,$Q,$d,$r){var $k=this._curSubmit,$$=this._vb,$b=this._shader2D,$a=$k.shaderValue;if(this._renderKey=0,$v.bitmap){var $M=$v.bitmap;$b.glTexture==$M&&$b.ALPHA===$a.ALPHA||($b.glTexture=$M,($k=this._curSubmit=$kv.createSubmit(this,this._ib,$$,$$._byteLength/32*3,$Fv.create(1,0))).shaderValue.glTexture=$M,this._submits[this._submits._length++]=$k),$qv.fillQuadrangleImgVb($$,$g,$Q,$d,$v.uv,$r||this._curMat,this._x,this._y)}else $k.shaderValue.fillStyle&&$k.shaderValue.fillStyle.equal($v)&&$b.ALPHA===$a.ALPHA||($b.glTexture=null,($k=this._curSubmit=$kv.createSubmit(this,this._ib,$$,$$._byteLength/32*3,$Fv.create(2,0))).shaderValue.defines.add(2),$k.shaderValue.fillStyle=$n.create($v),this._submits[this._submits._length++]=$k),$qv.fillQuadrangleImgVb($$,$g,$Q,$d,$x.DEF_UV,$r||this._curMat,this._x,this._y);$k._numEle+=6},$g.drawTexture2=function($v,$g,$Q,$d,$r,$k,$$,$b){if(0!=$k){var $a=this._curMat;if(this._x=$v*$a.a+$g*$a.c,this._y=$g*$a.d+$v*$a.b,$r&&($r=$a.bTransform||$r.bTransform?($l.mul($r,$a,$B._tmpMatrix),$B._tmpMatrix):(this._x+=$r.tx+$a.tx,this._y+=$r.ty+$a.ty,$l.EMPTY)),1!==$k||$$){var $M=this._shader2D.ALPHA,$Y=this._nBlendType;this._shader2D.ALPHA=$k,$$&&(this._nBlendType=$H.TOINT($$)),this._drawTextureM($b[0],$b[1]-$Q,$b[2]-$d,$b[3],$b[4],0,0,$r,1),this._shader2D.ALPHA=$M,this._nBlendType=$Y}else this._drawTextureM($b[0],$b[1]-$Q,$b[2]-$d,$b[3],$b[4],0,0,$r,1);this._x=this._y=0}},$g.drawCanvas=function($v,$g,$Q,$d,$r){var $k=$v.context;if(this._renderKey=0,$k._targets)this._submits[this._submits._length++]=$Nv.create($k,0,null),this._curSubmit=$kv.RENDERBASE,$k._targets.drawTo(this,$g,$Q,$d,$r);else{var $$=this._submits[this._submits._length++]=$Nv.create($k,this._shader2D.ALPHA,this._shader2D.filters),$b=$d/$v.width,$a=$r/$v.height,$M=$$._matrix;this._curMat.copyTo($M),1!=$b&&1!=$a&&$M.scale($b,$a);var $Y=$M.tx,$D=$M.ty;$M.tx=$M.ty=0,$M.transformPoint($o.TEMP.setTo($g,$Q)),$M.translate($o.TEMP.x+$Y,$o.TEMP.y+$D),this._curSubmit=$kv.RENDERBASE}$W.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$k._targets?"yellow":"green",this.strokeRect($g-1,$Q-1,$d+2,$r+2,1),this.strokeRect($g,$Q,$d,$r,1),this.restore())},$g.drawTarget=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){void 0===$M&&($M=-1);var $Y=this._vb;if($qv.fillRectImgVb($Y,this._clipRect,$g,$Q,$d,$r,$a||$x.DEF_UV,$k||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $D=this._curSubmit=$Dv.create(this,this._ib,$Y,($Y._byteLength-64)/32*3,$b,$$);$D.blendType=-1==$M?this._nBlendType:$M,$D.scope=$v,this._submits[this._submits._length++]=$D,this._curSubmit._numEle+=6}},$g.mixRGBandAlpha=function($v){return this._mixRGBandAlpha($v,this._shader2D.ALPHA)},$g._mixRGBandAlpha=function($v,$g){var $Q=(4278190080&$v)>>>24;return 0!=$Q?$Q*=$g:$Q=255*$g,16777215&$v|$Q<<24},$g.drawTriangles=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){if(!$v.loaded||!$v.source)return this.sprite&&$P.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$v.bitmap;var $Y=this._mixRGBandAlpha(4294967295,$b),$D=($d.length,$k.length);this._renderKey=-1;var $J=this._curSubmit=$iv.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$Fv.create(1,0));return $J.shaderValue.textureHost=$v,$J._renderType=10016,this._submits[this._submits._length++]=$J,$$?($B._tmpMatrix.a=$$.a,$B._tmpMatrix.b=$$.b,$B._tmpMatrix.c=$$.c,$B._tmpMatrix.d=$$.d,$B._tmpMatrix.tx=$$.tx+$g,$B._tmpMatrix.ty=$$.ty+$Q,$l.mul($B._tmpMatrix,this._curMat,$B._tmpMatrix)):($B._tmpMatrix.a=this._curMat.a,$B._tmpMatrix.b=this._curMat.b,$B._tmpMatrix.c=this._curMat.c,$B._tmpMatrix.d=this._curMat.d,$B._tmpMatrix.tx=this._curMat.tx+$g,$B._tmpMatrix.ty=this._curMat.ty+$Q),this._triangleMesh.addData($d,$r,$k,$B._tmpMatrix,$Y,this),this._curSubmit._numEle+=$D,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$g.transform=function($v,$g,$Q,$d,$r,$k){$I.save(this),$l.mul($l.TEMP.setTo($v,$g,$Q,$d,$r,$k),this._curMat,this._curMat),this._curMat._checkTransform()},$g.setTransformByMatrix=function($v){$v.copyTo(this._curMat)},$g.transformByMatrix=function($v){$I.save(this),$l.mul($v,this._curMat,this._curMat),this._curMat._checkTransform()},$g.rotate=function($v){$I.save(this),this._curMat.rotateEx($v)},$g.scale=function($v,$g){$I.save(this),this._curMat.scaleEx($v,$g)},$g.clipRect=function($v,$g,$Q,$d){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $r=$Yv.create(4);this.addRenderObject($r);var $k=this._vb,$$=$k._byteLength>>2;if($qv.fillRectImgVb($k,null,$v,$g,$Q,$d,$x.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $b=this._curSubmit=$kv.createSubmit(this,this._ib,$k,($k._byteLength-64)/32*3,$Fv.create(2,0));$b.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$b,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $a=$Yv.create(5);this.addRenderObject($a);var $M=$k.getFloat32Array(),$Y=Math.min(Math.min(Math.min($M[0+$$],$M[4+$$]),$M[8+$$]),$M[12+$$]),$D=Math.max(Math.max(Math.max($M[0+$$],$M[4+$$]),$M[8+$$]),$M[12+$$]),$J=Math.min(Math.min(Math.min($M[1+$$],$M[5+$$]),$M[9+$$]),$M[13+$$]),$p=Math.max(Math.max(Math.max($M[1+$$],$M[5+$$]),$M[9+$$]),$M[13+$$]);$z.save(this,$a,$v,$g,$Q,$d,$Y,$J,$D-$Y,$p-$J),this._curSubmit=$kv.RENDERBASE}else{$Q*=this._curMat.a,$d*=this._curMat.d;var $T=$o.TEMP;this._curMat.transformPoint($T.setTo($v,$g)),$Q<0&&($T.x=$T.x+$Q,$Q=-$Q),$d<0&&($T.y=$T.y+$d,$d=-$d),this._renderKey=0;var $t=this._curSubmit=$Mv.create(this);(this._submits[this._submits._length++]=$t).submitIndex=this._submits._length,$t.submitLength=9999999,$R.save(this,$t);var $q=this._clipRect,$C=$q.x,$G=$q.y,$s=$T.x+$Q,$A=$T.y+$d;$C<$T.x&&($q.x=$T.x),$G<$T.y&&($q.y=$T.y),$q.width=Math.min($s,$C+$q.width)-$q.x,$q.height=Math.min($A,$G+$q.height)-$q.y,this._shader2D.glTexture=null,$t.clipRect.copyFrom($q),this._curSubmit=$kv.RENDERBASE}},$g.setIBVB=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y){if(void 0===$a&&($a=0),void 0===$M&&($M=0),void 0===$Y&&($Y=0),null===$Q){if($C.isFlash){var $D=$d;$D._selfIB||($D._selfIB=$_v.create(35044)),$D._selfIB.clear(),$Q=$D._selfIB}else $Q=this._ib;$qv.expandIBQuadrangle($Q,$d._byteLength/(4*$d.vertexStride*4))}if(!$b||!$$)throw Error("setIBVB must input:shader shaderValues");var $J=$av.create(this,$d,$Q,$r,$$,$b,$a,$M,$Y);$k||($k=$l.EMPTY),$k.translate($v,$g),$l.mul($k,this._curMat,$J._mat),$k.translate(-$v,-$g),this._submits[this._submits._length++]=$J,this._curSubmit=$kv.RENDERBASE,this._renderKey=0},$g.addRenderObject=function($v){this._submits[this._submits._length++]=$v},$g.fillTrangles=function($v,$g,$Q,$d,$r){var $k=this._curSubmit,$$=this._vb,$b=this._shader2D,$a=$k.shaderValue,$M=$d.length>>4,$Y=$v.bitmap;this._renderKey=0,$b.glTexture==$Y&&$b.ALPHA===$a.ALPHA||(($k=this._curSubmit=$kv.createSubmit(this,this._ib,$$,$$._byteLength/32*3,$Fv.create(1,0))).shaderValue.textureHost=$v,this._submits[this._submits._length++]=$k),$qv.fillTranglesVB($$,$g,$Q,$d,$r||this._curMat,this._x,this._y),$k._numEle+=6*$M},$g.submitElement=function($v,$g){var $Q=this._submits;for($g<0&&($g=$Q._length);$v<$g;)$v+=$Q[$v].renderSubmit()},$g.finish=function(){$Av.mainContext.finish()},$g.flush=function(){var $v=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($v>this._ib.bufferLength/12&&$qv.expandIBQuadrangle(this._ib,$v),!this._isMain&&$j.enabled&&$j._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$j._atlasRestore;for(var $g=this._submits,$Q=0,$d=$g._length;$Q<$d;$Q++){var $r=$g[$Q];10016===$r.getRenderType()&&$r.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$gv.instance&&$gv.getInstance().reset();var $k;for($Q=0,$k=this.meshlist.length;$Q<$k;$Q++){var $$=this.meshlist[$Q];$$.canReuse?$$.releaseMesh():$$.destroy()}return this.meshlist.length=0,this._curSubmit=$kv.RENDERBASE,this._renderKey=0,this._triangleMesh=$xv.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$g.setPathId=function($v){if(this.mId=$v,-1!=this.mId){this.mHaveKey=!1;var $g=$m.getInstance();$g.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$g.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$g.movePath=function($v,$g){var $Q=$v,$d=$g;$v=this._curMat.a*$Q+this._curMat.c*$d+this._curMat.tx,$g=this._curMat.b*$Q+this._curMat.d*$d+this._curMat.ty,this.mX+=$v,this.mY+=$g},$g.beginPath=function(){var $v=this._getPath();$v.tempArray.length=0,$v.closePath=!1,this.mX=0,this.mY=0},$g.closePath=function(){this._path.closePath=!0},$g.fill=function($v){void 0===$v&&($v=!1);var $g=this._getPath();this.drawPoly(0,0,$g.tempArray,this.fillStyle._color.numColor,0,0,$v)},$g.stroke=function(){var $v=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$v.drawLine(0,0,$v.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $g=$m.getInstance().shapeLineDic[this.mId];$g.rebuild($v.tempArray),$v.setGeomtry($g)}else $m.getInstance().addLine(this.mId,$v.drawLine(0,0,$v.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$v.update();var $Q=[this.mX,this.mY],$d=$kv.createShape(this,$v.ib,$v.vb,$v.count,$v.offset,$Fv.create(4,0));$d.shaderValue.ALPHA=this._shader2D.ALPHA,$d.shaderValue.u_pos=$Q,$d.shaderValue.u_mmat2=$Gv.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$d,this._renderKey=-1}},$g.line=function($v,$g,$Q,$d,$r,$k){var $$=this._curSubmit,$b=this._vb;if($qv.fillLineVb($b,this._clipRect,$v,$g,$Q,$d,$r,$k)){this._renderKey=0;var $a=this._shader2D,$M=$$.shaderValue;$a.strokeStyle===$M.strokeStyle&&$a.ALPHA===$M.ALPHA||($a.glTexture=null,($$=this._curSubmit=$kv.createSubmit(this,this._ib,$b,($b._byteLength-64)/32*3,$Fv.create(2,0))).shaderValue.strokeStyle=$a.strokeStyle,$$.shaderValue.mainID=2,$$.shaderValue.ALPHA=$a.ALPHA,this._submits[this._submits._length++]=$$),$$._numEle+=6}},$g.moveTo=function($v,$g,$Q){void 0===$Q&&($Q=!0);var $d=this._getPath();if($Q){var $r=$v,$k=$g;$v=this._curMat.a*$r+this._curMat.c*$k,$g=this._curMat.b*$r+this._curMat.d*$k}$d.addPoint($v,$g)},$g.lineTo=function($v,$g,$Q){void 0===$Q&&($Q=!0);var $d=this._getPath();if($Q){var $r=$v,$k=$g;$v=this._curMat.a*$r+this._curMat.c*$k,$g=this._curMat.b*$r+this._curMat.d*$k}$d.addPoint($v,$g)},$g.drawCurves=function($v,$g,$Q){this.setPathId(-1),this.beginPath(),this.strokeStyle=$Q[3],this.lineWidth=$Q[4];var $d=$Q[2];$v+=$Q[0],$g+=$Q[1],this.movePath($v,$g),this.moveTo($d[0],$d[1]);for(var $r=2,$k=$d.length;$r<$k;)this.quadraticCurveTo($d[$r++],$d[$r++],$d[$r++],$d[$r++]);this.stroke()},$g.arcTo=function($v,$g,$Q,$d,$r){if(-1==this.mId||!this.mHaveKey){var $k=0,$$=0,$b=0,$a=this._getPath();this._curMat.copyTo($B._tmpMatrix),$B._tmpMatrix.tx=$B._tmpMatrix.ty=0,$B._tempPoint.setTo($a.getEndPointX(),$a.getEndPointY()),$B._tmpMatrix.invertTransformPoint($B._tempPoint);var $M=$B._tempPoint.x-$v,$Y=$B._tempPoint.y-$g,$D=Math.sqrt($M*$M+$Y*$Y);if(!($D<=1e-6)){var $J=$M/$D,$p=$Y/$D,$T=$Q-$v,$t=$d-$g,$q=$T*$T+$t*$t,$C=Math.sqrt($q);if(!($C<=1e-6)){var $G=$T/$C,$s=$t/$C,$A=$J+$G,$h=$p+$s,$P=Math.sqrt($A*$A+$h*$h);if(!($P<=1e-6)){var $W=$A/$P,$F=$h/$P,$l=Math.acos($W*$J+$F*$p),$o=Math.PI/2-$l,$E=($D=$r/Math.tan($o))*$J+$v,$V=$D*$p+$g,$Z=Math.sqrt($D*$D+$r*$r),$f=$v+$W*$Z,$X=$g+$F*$Z,$N=0,$i=0;if(0<=$J*$s-$p*$G){var $x=2*$o/$B.SEGNUM;$N=Math.sin($x),$i=Math.cos($x)}else $x=2*-$o/$B.SEGNUM,$N=Math.sin($x),$i=Math.cos($x);$$=this._curMat.a*$E+this._curMat.c*$V,$b=this._curMat.b*$E+this._curMat.d*$V,$$==this._path.getEndPointX()&&$b==this._path.getEndPointY()||$a.addPoint($$,$b);var $w=$E-$f,$m=$V-$X;for($k=0;$k<$B.SEGNUM;$k++){var $K=$w*$i+$m*$N,$c=-$w*$N+$m*$i;$$=$K+$f,$b=$c+$X,$v=this._curMat.a*$$+this._curMat.c*$b,$b=$g=this._curMat.b*$$+this._curMat.d*$b,($$=$v)==this._path.getEndPointX()&&$b==this._path.getEndPointY()||$a.addPoint($$,$b),$w=$K,$m=$c}}}}}},$g.arc=function($v,$g,$Q,$d,$r,$k,$$){if(void 0===$k&&($k=!1),void 0===$$&&($$=!0),-1!=this.mId){var $b=$m.getInstance().shapeDic[this.mId];if($b&&this.mHaveKey&&!$b.needUpdate(this._curMat))return;$g=$v=0}var $a,$M=0,$Y=0,$D=0,$J=0,$p=0,$T=0,$t=0;if($Y=$r-$d,$k)if(Math.abs($Y)>=2*Math.PI)$Y=2*-Math.PI;else for(;0<$Y;)$Y-=2*Math.PI;else if(Math.abs($Y)>=2*Math.PI)$Y=2*Math.PI;else for(;$Y<0;)$Y+=2*Math.PI;$a=$Y/($t=$Q<101?Math.max(10,$Y*$Q/5):$Q<201?Math.max(10,$Y*$Q/20):Math.max(10,$Y*$Q/40))/2,$D=Math.abs(4/3*(1-Math.cos($a))/Math.sin($a)),$k&&($D=-$D);var $q=this._getPath(),$C=NaN,$G=NaN;for($T=0;$T<=$t;$T++)$M=$d+$Y*($T/$t),$J=$v+Math.cos($M)*$Q,$p=$g+Math.sin($M)*$Q,$$&&($C=$J,$G=$p,$J=this._curMat.a*$C+this._curMat.c*$G,$p=this._curMat.b*$C+this._curMat.d*$G),$J==this._path.getEndPointX()&&$p==this._path.getEndPointY()||$q.addPoint($J,$p);$J=$v+Math.cos($r)*$Q,$p=$g+Math.sin($r)*$Q,$$&&($C=$J,$G=$p,$J=this._curMat.a*$C+this._curMat.c*$G,$p=this._curMat.b*$C+this._curMat.d*$G),$J==this._path.getEndPointX()&&$p==this._path.getEndPointY()||$q.addPoint($J,$p)},$g.quadraticCurveTo=function($v,$g,$Q,$d){var $r=$D.I,$k=$Q,$$=$d;$Q=this._curMat.a*$k+this._curMat.c*$$,$d=this._curMat.b*$k+this._curMat.d*$$,$k=$v,$$=$g,$v=this._curMat.a*$k+this._curMat.c*$$,$g=this._curMat.b*$k+this._curMat.d*$$;for(var $b=$r.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$v,$g,$Q,$d],30,2),$a=0,$M=$b.length/2;$a<$M;$a++)this.lineTo($b[2*$a],$b[2*$a+1],!1);this.lineTo($Q,$d,!1)},$g.rect=function($v,$g,$Q,$d){this._other=this._other.make(),this._other.path||(this._other.path=new $y),this._other.path.rect($v,$g,$Q,$d)},$g.strokeRect=function($v,$g,$Q,$d,$r){var $k=.5*$r;this.line($v-$k,$g,$v+$Q+$k,$g,$r,this._curMat),this.line($v+$Q,$g,$v+$Q,$g+$d,$r,this._curMat),this.line($v,$g,$v,$g+$d,$r,this._curMat),this.line($v-$k,$g+$d,$v+$Q+$k,$g+$d,$r,this._curMat)},$g.clip=function(){},$g.drawPoly=function($v,$g,$Q,$d,$r,$k,$$){void 0===$$&&($$=!1),this._renderKey=0,this._shader2D.glTexture=null;var $b=this._getPath();if(-1==this.mId)$b.polygon($v,$g,$Q,$d,$r||1,$k);else if(this.mHaveKey){var $a=$m.getInstance().shapeDic[this.mId];$a.setMatrix(this._curMat),$a.rebuild($b.tempArray),$b.setGeomtry($a)}else{var $M=$b.polygon($v,$g,$Q,$d,$r||1,$k);$m.getInstance().addShape(this.mId,$M),$M.setMatrix(this._curMat)}$b.update();var $Y,$D=[this.mX,this.mY];if(($Y=$kv.createShape(this,$b.ib,$b.vb,$b.count,$b.offset,$Fv.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$Y.shaderValue.u_pos=$D,$Y.shaderValue.u_mmat2=$Gv.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$Y,0<$r){if(this.mHaveLineKey){var $J=$m.getInstance().shapeLineDic[this.mId];$J.rebuild($b.tempArray),$b.setGeomtry($J)}else $m.getInstance().addShape(this.mId,$b.drawLine($v,$g,$Q,$r,$k));$b.update(),($Y=$kv.createShape(this,$b.ib,$b.vb,$b.count,$b.offset,$Fv.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$Y.shaderValue.u_mmat2=$Gv.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$Y}},$g.drawParticle=function($v,$g,$Q){$Q.x=$v,$Q.y=$g,this._submits[this._submits._length++]=$Q},$g._getPath=function(){return this._path||(this._path=new $y)},$d(0,$g,"globalCompositeOperation",function(){return $H.NAMES[this._nBlendType]},function($v){var $g=$H.TOINT[$v];null==$g||this._nBlendType===$g||($e.save(this,65536,this,!0),this._curSubmit=$kv.RENDERBASE,this._renderKey=0,this._nBlendType=$g)}),$d(0,$g,"strokeStyle",function(){return this._shader2D.strokeStyle},function($v){this._shader2D.strokeStyle.equal($v)||($e.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$n.create($v))}),$d(0,$g,"globalAlpha",function(){return this._shader2D.ALPHA},function($v){($v=Math.floor(1e3*$v)/1e3)!=this._shader2D.ALPHA&&($e.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$v)}),$d(0,$g,"asBitmap",null,function($v){if($v){if(this._targets||(this._targets=new $O),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$d(0,$g,"fillStyle",function(){return this._shader2D.fillStyle},function($v){this._shader2D.fillStyle.equal($v)||($e.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$n.create($v))}),$d(0,$g,"textAlign",function(){return this._other.textAlign},function($v){this._other.textAlign===$v||(this._other=this._other.make(),$e.save(this,32768,this._other,!1),this._other.textAlign=$v)}),$d(0,$g,"lineWidth",function(){return this._other.lineWidth},function($v){this._other.lineWidth===$v||(this._other=this._other.make(),$e.save(this,256,this._other,!1),this._other.lineWidth=$v)}),$d(0,$g,"textBaseline",function(){return this._other.textBaseline},function($v){this._other.textBaseline===$v||(this._other=this._other.make(),$e.save(this,16384,this._other,!1),this._other.textBaseline=$v)}),$d(0,$g,"font",null,function($v){$v!=this._other.font.toString()&&(this._other=this._other.make(),$e.save(this,8,this._other,!1),this._other.font===$Tv.EMPTY?this._other.font=new $Tv($v):this._other.font.setFont($v))}),$B.__init__=function(){$Q.DEFAULT=new $Q},$B._tempPoint=new $o,$B._SUBMITVBSIZE=32e3,$B._MAXSIZE=99999999,$B._RECTVBSIZE=16,$B.MAXCLIPRECT=new $E(0,0,99999999,99999999),$B._COUNT=0,$B._tmpMatrix=new $l,$B.SEGNUM=32,$B._contextcount=0,$$($B,["_fontTemp",function(){return this._fontTemp=new $Tv},"_drawStyleTemp",function(){return this._drawStyleTemp=new $n(null)}]),$B.__init$=function(){$Q=function(){function $v(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$Tv.EMPTY}$J($v,"");var $g=$v.prototype;return $g.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$Tv.EMPTY},$g.make=function(){return this===$v.DEFAULT?new $v:this},$v.DEFAULT=null,$v}()},$B}(),$Fv=function($v){function $d($v,$g){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$d.__super.call(this),this.defines=new $Vv,this.position=$d._POSITION,this.mainID=$v,this.subID=$g,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$v|$g,this._inClassCache=$d._cache[this._cacheID],0<$v&&!this._inClassCache&&(this._inClassCache=$d._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$J($d,"laya.webgl.shader.d2.value.Value2D",$c);var $g=$d.prototype;return $g.setValue=function($v){},$g.refresh=function(){var $v=this.size;return $v[0]=$Gv.width,$v[1]=$Gv.height,this.alpha=this.ALPHA*$Gv.worldAlpha,this.mmat=$Gv.worldMatrix4,this},$g._ShaderWithCompile=function(){return $Uv.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$Ov.create)},$g._withWorldShaderDefines=function(){var $v=$Gv.worldShaderDefines,$g=$Uv.sharders[this.mainID|this.defines._value|$v.getValue()];if(!$g){var $Q,$d={};for($Q in this.defines.toNameDic())$d[$Q]="";for($Q in $v.toNameDic())$d[$Q]="";$g=$Uv.withCompile2D(0,this.mainID,$d,this.mainID|this.defines._value|$v.getValue(),$Ov.create)}var $r=$Gv.worldFilters;if(!$r)return $g;for(var $k,$$=$r.length,$b=0;$b<$$;$b++)($k=$r[$b])&&$k.action.setValue(this);return $g},$g.upload=function(){var $v=$Gv;this.alpha=this.ALPHA*$v.worldAlpha,$Gv.worldMatrix4!==$Gv.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$Av.shaderHighPrecision&&this.defines.add(1024);var $g,$Q=$v.worldShaderDefines?this._withWorldShaderDefines():$Uv.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$v.width,this.size[1]=$v.height,this.mmat=$v.worldMatrix4,$wv.activeShader!==$Q?$Q._shaderValueWidth!==$v.width||$Q._shaderValueHeight!==$v.height?($Q._shaderValueWidth=$v.width,$Q._shaderValueHeight=$v.height):$g=$Q._params2dQuick2||$Q._make2dQuick2():$Q._shaderValueWidth!==$v.width||$Q._shaderValueHeight!==$v.height?($Q._shaderValueWidth=$v.width,$Q._shaderValueHeight=$v.height):$g=$Q._params2dQuick1||$Q._make2dQuick1(),$Q.upload(this,$g)},$g.setFilters=function($v){if(this.filters=$v)for(var $g,$Q=$v.length,$d=0;$d<$Q;$d++)($g=$v[$d])&&(this.defines.add($g.type),$g.action.setValue(this))},$g.clear=function(){this.defines.setValue(this.subID)},$g.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$d._initone=function($v,$g){$d._typeClass[$v]=$g,$d._cache[$v]=[],$d._cache[$v]._length=0},$d.__init__=function(){$d._POSITION=[2,5126,!1,4*$tv.BYTES_PE,0],$d._TEXCOORD=[2,5126,!1,4*$tv.BYTES_PE,2*$tv.BYTES_PE],$d._initone(2,$Bv),$d._initone(4,$Hv),$d._initone(256,$jv),$d._initone(512,$cv),$d._initone(1,$Lv),$d._initone(65,$Sv),$d._initone(9,$Lv)},$d.create=function($v,$g){var $Q=$d._cache[$v|$g];return $Q._length?$Q[--$Q._length]:new $d._typeClass[$v|$g]($g)},$d._POSITION=null,$d._TEXCOORD=null,$d._cache=[],$d._typeClass=[],$d.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$d}(),$lv=function($v){function $q($v,$g){$q.__super.call(this,$v,$g)}$J($q,"laya.webgl.utils.RenderSprite3D",$G);var $g=$q.prototype;return $g.onCreate=function($v){switch($v){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$g._mask=function($v,$g,$Q,$d){var $r,$k,$$=this._next,$b=$v.mask;if($b){$g.ctx.save();var $a=$g.ctx.globalCompositeOperation,$M=new $E;if($M.copyFrom($b.getBounds()),$M.width=Math.round($M.width),$M.height=Math.round($M.height),$M.x=Math.round($M.x),$M.y=Math.round($M.y),0<$M.width&&0<$M.height){var $Y=$v._style._tf,$D=$bv.create();$D.addValue("bounds",$M),$r=$$v.create([$D,$g],laya.webgl.utils.RenderSprite3D.tmpTarget),$g.addRenderObject($r),$b.render($g,-$M.x,-$M.y),$r=$$v.create([$D],laya.webgl.utils.RenderSprite3D.endTmpTarget),$g.addRenderObject($r),$g.ctx.save(),$g.clipRect($Q-$Y.translateX+$M.x,$d-$Y.translateY+$M.y,$M.width,$M.height),$$._fun.call($$,$v,$g,$Q,$d),$g.ctx.restore(),$k=$Yv.create(6),$a=$g.ctx.globalCompositeOperation,$k.blendMode="mask",$g.addRenderObject($k),$l.TEMP.identity();var $J=$Fv.create(1,0),$p=$x.INV_UV,$T=$M.width,$t=$M.height;($M.width<32||$M.height<32)&&(($p=$q.tempUV)[0]=0,$p[1]=0,$p[2]=32<=$M.width?1:$M.width/32,$p[3]=0,$p[4]=32<=$M.width?1:$M.width/32,$p[5]=32<=$M.height?1:$M.height/32,$p[6]=0,$p[7]=32<=$M.height?1:$M.height/32,$M.width=32<=$M.width?$M.width:32,$M.height=32<=$M.height?$M.height:32,$p[1]*=-1,$p[3]*=-1,$p[5]*=-1,$p[7]*=-1,$p[1]+=1,$p[3]+=1,$p[5]+=1,$p[7]+=1),$g.ctx.drawTarget($D,$Q+$M.x-$Y.translateX,$d+$M.y-$Y.translateY,$T,$t,$l.TEMP,"tmpTarget",$J,$p,6),$r=$$v.create([$D],laya.webgl.utils.RenderSprite3D.recycleTarget),$g.addRenderObject($r),($k=$Yv.create(6)).blendMode=$a,$g.addRenderObject($k)}$g.ctx.restore()}else $$._fun.call($$,$v,$g,$Q,$d)},$g._blend=function($v,$g,$Q,$d){var $r=$v._style,$k=this._next;$r.blendMode?($g.ctx.save(),$g.ctx.globalCompositeOperation=$r.blendMode,$k._fun.call($k,$v,$g,$Q,$d),$g.ctx.restore()):$k._fun.call($k,$v,$g,$Q,$d)},$g._transform=function($v,$g,$Q,$d){var $r=$v.transform,$k=this._next;if($r&&$k!=$G.NORENDER){var $$=$g.ctx;$v._style;$r.tx=$Q,$r.ty=$d;var $b=$$._getTransformMatrix(),$a=$b.clone();$l.mul($r,$b,$b),$b._checkTransform(),$r.tx=$r.ty=0,$k._fun.call($k,$v,$g,0,0),$a.copyTo($b),$a.destroy()}else $k._fun.call($k,$v,$g,$Q,$d)},$q.tmpTarget=function($v,$g){var $Q=$v.getValue("bounds"),$d=$mv.create($Q.width,$Q.height);$d.start(),$d.clear(0,0,0,0),$v.addValue("tmpTarget",$d)},$q.endTmpTarget=function($v){$v.getValue("tmpTarget").end()},$q.recycleTarget=function($v){$v.getValue("tmpTarget").recycle(),$v.recycle()},$$($q,["tempUV",function(){return this.tempUV=new Array(8)}]),$q}(),$ov=function($v){function $g(){this.data=null,$g.__super.call(this)}$J($g,"laya.filters.webgl.ColorFilterActionGL",$K);var $Q=$g.prototype;return $P.imps($Q,{"laya.filters.IFilterActionGL":!0}),$Q.setValue=function($v){$v.colorMat=this.data._mat,$v.colorAlpha=this.data._alpha},$Q.apply3d=function($v,$g,$Q,$d,$r){var $k=$v.getValue("bounds"),$$=$Fv.create(1,0);$$.setFilters([this.data]);var $b=$l.TEMP;$b.identity(),$Q.ctx.drawTarget($v,0,0,$k.width,$k.height,$b,"src",$$)},$g}(),$Ev=function($v){function $k($v,$g,$Q,$d,$r){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$k.__super.call(this,$v,$g,$r),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $nv,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$Q,this._atlasCanvas.height=$d,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$J($k,"laya.webgl.atlas.Atlaser",$B);var $g=$k.prototype;return $g.computeUVinAtlasTexture=function($v,$g,$Q,$d){var $r=$j.atlasTextureWidth,$k=$j.atlasTextureHeight,$$=$Q/$r,$b=$d/$k,$a=($Q+$v.bitmap.width)/$r,$M=($d+$v.bitmap.height)/$k,$Y=$v.bitmap.width/$r,$D=$v.bitmap.height/$k;$v.uv=[$$+$g[0]*$Y,$b+$g[1]*$D,$a-(1-$g[2])*$Y,$b+$g[3]*$D,$a-(1-$g[4])*$Y,$M-(1-$g[5])*$D,$$+$g[6]*$Y,$M-(1-$g[7])*$D]},$g.findBitmapIsExist=function($v){if($v instanceof laya.webgl.resource.WebGLImage){var $g=$v,$Q=$g.url,$d=this._InAtlasWebGLImagesKey[$Q||$g.id];if($d)return $d.offsetInfoID}return-1},$g.addToAtlasTexture=function($v,$g,$Q){if($v instanceof laya.webgl.resource.WebGLImage){var $d=$v,$r=$d.url;this._InAtlasWebGLImagesKey[$r||$d.id]={bitmap:$v,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$g,$Q])}this._atlasCanvas.texSubImage2D($g,$Q,$v.atlasSource),$v.clearAtlasSource()},$g.addToAtlas=function($v,$g,$Q){$v._atlasID=this._inAtlasTextureKey.length;var $d=$v.uv.slice(),$r=$v.bitmap;this._inAtlasTextureKey.push($v),this._inAtlasTextureOriUVValue.push($d),this._inAtlasTextureBitmapValue.push($r),this.computeUVinAtlasTexture($v,$d,$g,$Q),$v.bitmap=this._atlasCanvas},$g.clear=function(){for(var $v=0,$g=this._inAtlasTextureKey.length;$v<$g;$v++)this._inAtlasTextureKey[$v].bitmap=this._inAtlasTextureBitmapValue[$v],this._inAtlasTextureKey[$v].uv=this._inAtlasTextureOriUVValue[$v],this._inAtlasTextureKey[$v]._atlasID=-1,this._inAtlasTextureKey[$v].bitmap.lock=!1,this._inAtlasTextureKey[$v].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$g.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$d(0,$g,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$d(0,$g,"texture",function(){return this._atlasCanvas}),$d(0,$g,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$k}(),$Vv=function($v){function $Q(){$Q.__super.call(this,$Q.__name2int,$Q.__int2name,$Q.__int2nameMap)}return $J($Q,"laya.webgl.shader.d2.ShaderDefines2D",$u),$Q.__init__=function(){$Q.reg("TEXTURE2D",1),$Q.reg("COLOR2D",2),$Q.reg("PRIMITIVE",4),$Q.reg("GLOW_FILTER",8),$Q.reg("BLUR_FILTER",16),$Q.reg("COLOR_FILTER",32),$Q.reg("COLOR_ADD",64),$Q.reg("WORLDMAT",128),$Q.reg("FILLTEXTURE",256),$Q.reg("FSHIGHPRECISION",1024),$Q.reg("TXTALPHA",2048),$Q.reg("TXTCOMPRESS",4096)},$Q.reg=function($v,$g){$u._reg($v,$g,$Q.__name2int,$Q.__int2name)},$Q.toText=function($v,$g,$Q){return $u._toText($v,$g,$Q)},$Q.toInt=function($v){return $u._toInt($v,$Q.__name2int)},$Q.TEXTURE2D=1,$Q.COLOR2D=2,$Q.PRIMITIVE=4,$Q.FILTERGLOW=8,$Q.FILTERBLUR=16,$Q.FILTERCOLOR=32,$Q.COLORADD=64,$Q.WORLDMAT=128,$Q.FILLTEXTURE=256,$Q.SKINMESH=512,$Q.SHADERDEFINE_FSHIGHPRECISION=1024,$Q.TXTALPHA=2048,$Q.TXTCOMPRESS=4096,$Q.__name2int={},$Q.__int2name=[],$Q.__int2nameMap=[],$Q}(),$Zv=(function($v){function $b($v,$g,$Q,$d,$r,$k,$$){$b.__super.call(this,$v,$g,$Q,$d,40,$r,$k,$$)}$J($b,"laya.webgl.shapes.Ellipse",$Qv)}(),function($v){function $k($v,$g,$Q,$d,$r){this._points=[],this.rebuild($Q),$k.__super.call(this,$v,$g,0,0,0,$r,$d,$r,0)}$J($k,"laya.webgl.shapes.Line",$Qv);var $g=$k.prototype;return $g.rebuild=function($v){var $g=$v.length;$g!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($g/2-1)),this.mFloat32Array=new Float32Array(5*$g)),this._points.length=0;for(var $Q=NaN,$d=NaN,$r=-1,$k=-1,$$=$v.length/2,$b=0;$b<$$;$b++)$Q=$v[2*$b],$d=$v[2*$b+1],(.01<Math.abs($r-$Q)||.01<Math.abs($k-$d))&&this._points.push($Q,$d),$r=$Q,$k=$d},$g.getData=function($v,$g,$Q){var $d=[],$r=[];0<this.borderWidth&&this.createLine2(this._points,$d,this.borderWidth,$Q,$r,this._points.length/2),this.mUint16Array.set($d,0),this.mFloat32Array.set($r,0),$v.append(this.mUint16Array),$g.append(this.mFloat32Array)},$k}()),$fv=function($v){function $D($v,$g,$Q,$d,$r){this._points=[];for(var $k=NaN,$$=NaN,$b=-1,$a=-1,$M=$Q.length/2-1,$Y=0;$Y<$M;$Y++)$k=$Q[2*$Y],$$=$Q[2*$Y+1],(.01<Math.abs($b-$k)||.01<Math.abs($a-$$))&&this._points.push($k,$$),$b=$k,$a=$$;$k=$Q[2*$M],$$=$Q[2*$M+1],$b=this._points[0],$a=this._points[1],(.01<Math.abs($b-$k)||.01<Math.abs($a-$$))&&this._points.push($k,$$),$D.__super.call(this,$v,$g,0,0,this._points.length/2,0,$d,$r)}$J($D,"laya.webgl.shapes.LoopLine",$Qv);var $g=$D.prototype;return $g.getData=function($v,$g,$Q){if(0<this.borderWidth){for(var $d=this.color,$r=($d>>16&255)/255,$k=($d>>8&255)/255,$$=(255&$d)/255,$b=[],$a=0,$M=0,$Y=[],$D=Math.floor(this._points.length/2),$J=0;$J<$D;$J++)$a=this._points[2*$J],$M=this._points[2*$J+1],$b.push(this.x+$a,this.y+$M,$r,$k,$$);this.createLoopLine($b,$Y,this.borderWidth,$Q+$b.length/5),$v.append(new Uint16Array($Y)),$g.append(new Float32Array($b))}},$g.createLoopLine=function($v,$g,$Q,$d,$r,$k){$v.length;var $$=$v.concat(),$b=$r||$v,$a=this.borderColor,$M=($a>>16&255)/255,$Y=($a>>8&255)/255,$D=(255&$a)/255,$J=[$$[0],$$[1]],$p=[$$[$$.length-5],$$[$$.length-4]],$T=$p[0]+.5*($J[0]-$p[0]),$t=$p[1]+.5*($J[1]-$p[1]);$$.unshift($T,$t,0,0,0),$$.push($T,$t,0,0,0);var $q,$C,$G,$s,$A,$h,$P,$W,$F,$l,$o,$E,$V,$Z,$f,$X,$N,$i,$x,$w,$m=$$.length/5,$K=$d,$c=$Q/2;$G=$$[0],$s=$$[1],$l=$G-($A=$$[5]),$F=($F=-($s-($h=$$[6])))/($w=Math.sqrt($F*$F+$l*$l))*$c,$l=$l/$w*$c,$b.push($G-$F,$s-$l,$M,$Y,$D,$G+$F,$s+$l,$M,$Y,$D);for(var $B=1;$B<$m-1;$B++)$G=$$[5*($B-1)],$s=$$[5*($B-1)+1],$A=$$[5*$B],$h=$$[5*$B+1],$P=$$[5*($B+1)],$W=$$[5*($B+1)+1],$l=$G-$A,$E=$A-$P,$f=(-($F=($F=-($s-$h))/($w=Math.sqrt($F*$F+$l*$l))*$c)+$G)*(-($l=$l/$w*$c)+$h)-(-$F+$A)*(-$l+$s),$i=(-($o=($o=-($h-$W))/($w=Math.sqrt($o*$o+$E*$E))*$c)+$P)*(-($E=$E/$w*$c)+$h)-(-$o+$A)*(-$E+$W),$x=($V=-$l+$s-(-$l+$h))*($N=-$o+$A-(-$o+$P))-($X=-$E+$W-(-$E+$h))*($Z=-$F+$A-(-$F+$G)),Math.abs($x)<.1?($x+=10.1,$b.push($A-$F,$h-$l,$M,$Y,$D,$A+$F,$h+$l,$M,$Y,$D)):((($q=($Z*$i-$N*$f)/$x)-$A)*($q-$A)+(($C=($X*$f-$V*$i)/$x)-$h)+($C-$h),$b.push($q,$C,$M,$Y,$D,$A-($q-$A),$h-($C-$h),$M,$Y,$D));$k&&($g=$k);var $j=this.edges+1;for($B=1;$B<$j;$B++)$g.push($K+2*($B-1),$K+2*($B-1)+1,$K+2*$B+1,$K+2*$B+1,$K+2*$B,$K+2*($B-1));return $g.push($K+2*($B-1),$K+2*($B-1)+1,$K+1,$K+1,$K,$K+2*($B-1)),$b},$D}(),$Xv=function($v){function $$($v,$g,$Q,$d,$r,$k){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$l.create(),this._points=$Q.slice(0,$Q.length),$$.__super.call(this,$v,$g,0,0,this._points.length/2,$d,$r,$k)}$J($$,"laya.webgl.shapes.Polygon",$Qv);var $g=$$.prototype;return $g.rebuild=function($v){this._repaint||(this._points.length=0,this._points=this._points.concat($v))},$g.setMatrix=function($v){$v.copyTo(this._mat)},$g.needUpdate=function($v){return this._repaint=this._mat.a==$v.a&&this._mat.b==$v.b&&this._mat.c==$v.c&&this._mat.d==$v.d&&this._mat.tx==$v.tx&&this._mat.ty==$v.ty,!this._repaint},$g.getData=function($v,$g,$Q){var $d,$r=0,$k=this._points,$$=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$Q){for(this._start=$Q,$d=[],$$=this.earcutTriangles.length,$r=0;$r<$$;$r++)$d.push(this.earcutTriangles[$r]+$Q);this.mUint16Array=new Uint16Array($d)}}else{this._start=$Q,$d=[];var $b=[],$a=[],$M=this.color,$Y=($M>>16&255)/255,$D=($M>>8&255)/255,$J=(255&$M)/255;for($$=Math.floor($k.length/2),$r=0;$r<$$;$r++)$b.push(this.x+$k[2*$r],this.y+$k[2*$r+1],$Y,$D,$J),$a.push(this.x+$k[2*$r],this.y+$k[2*$r+1]);for(this.earcutTriangles=$dv.earcut($a,null,2),$$=this.earcutTriangles.length,$r=0;$r<$$;$r++)$d.push(this.earcutTriangles[$r]+$Q);this.mUint16Array=new Uint16Array($d),this.mFloat32Array=new Float32Array($b)}$v.append(this.mUint16Array),$g.append(this.mFloat32Array)},$$}(),$Nv=function($v){function $k(){this._matrix=new $l,this._matrix4=$tv.defaultMatrix4.concat(),$k.__super.call(this,1e4),this.shaderValue=new $Fv(0,0)}$J($k,"laya.webgl.submit.SubmitCanvas",$kv);var $g=$k.prototype;return $g.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $v=$Gv.worldAlpha,$g=$Gv.worldMatrix4,$Q=$Gv.worldMatrix,$d=$Gv.worldFilters,$r=$Gv.worldShaderDefines,$k=this.shaderValue,$$=this._matrix,$b=this._matrix4,$a=$l.TEMP;return $l.mul($$,$Q,$a),$b[0]=$a.a,$b[1]=$a.b,$b[4]=$a.c,$b[5]=$a.d,$b[12]=$a.tx,$b[13]=$a.ty,$Gv.worldMatrix=$a.clone(),$Gv.worldMatrix4=$b,$Gv.worldAlpha=$Gv.worldAlpha*$k.alpha,$k.filters&&$k.filters.length&&($Gv.worldFilters=$k.filters,$Gv.worldShaderDefines=$k.defines),this._ctx_src.flush(),$Gv.worldAlpha=$v,$Gv.worldMatrix4=$g,$Gv.worldMatrix.destroy(),$Gv.worldMatrix=$Q,$Gv.worldFilters=$d,$Gv.worldShaderDefines=$r,1},$g.releaseRender=function(){var $v=$k._cache;this._ctx_src=null,$v[$v._length++]=this},$g.getRenderType=function(){return 10003},$k.create=function($v,$g,$Q){var $d=$k._cache._length?$k._cache[--$k._cache._length]:new $k;$d._ctx_src=$v;var $r=$d.shaderValue;return $r.alpha=$g,$r.defines.setValue(0),$Q&&$Q.length&&$r.setFilters($Q),$d},$k._cache=(($k._cache=[])._length=0,$k._cache),$k}(),$iv=function($v){function $M($v){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$v&&($v=1e4),$M.__super.call(this,$v)}$J($M,"laya.webgl.submit.SubmitTexture",$kv);var $g=$M.prototype;return $g.releaseRender=function(){var $v=$M._cache;($v[$v._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$g.addTexture=function($v,$g){this._texsID[this._texs.length]=$v._uvID,this._texs.push($v),this._vbPos.push($g)},$g.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $v=this.shaderValue.textureHost.bitmap;if(null!==$v)for(var $g=this._vb.getFloat32Array(),$Q=0,$d=this._texs.length;$Q<$d;$Q++){var $r=this._texs[$Q];$r.active();var $k=$r.uv;if(this._texsID[$Q]!==$r._uvID){this._texsID[$Q]=$r._uvID;var $$=this._vbPos[$Q];$g[$$+2]=$k[0],$g[$$+3]=$k[1],$g[$$+6]=$k[2],$g[$$+7]=$k[3],$g[$$+10]=$k[4],$g[$$+11]=$k[5],$g[$$+14]=$k[6],$g[$$+15]=$k[7],this._vb.setNeedUpload()}$r.bitmap!==$v&&(this._isSameTexture=!1)}}},$g.renderSubmit=function(){if(0===this._numEle)return $M._shaderSet=!1,1;var $v=this.shaderValue.textureHost;if($v){var $g=$v.source;if(!$v.bitmap||!$g)return $M._shaderSet=!1,1;this.shaderValue.texture=$g,$v.alphaTexture&&$v.alphaTexture.source&&(this.shaderValue.texture1=$v.alphaTexture.source)}this._vb.bind_upload(this._ib);var $Q=$Av.mainContext;if($H.activeBlendFunction!==this._blendFn&&($Q.enable(3042),this._blendFn($Q),$H.activeBlendFunction=this._blendFn),$f.drawCall++,$f.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$wv.activeShader&&$M._shaderSet?($wv.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$wv.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$M._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $d=$v.bitmap,$r=0,$k=$wv.activeShader,$$=0,$b=this._texs.length;$$<$b;$$++){var $a=this._texs[$$];$a.bitmap===$d&&$$+1!==$b||($k.uploadTexture2D($a.source),$Q.drawElements(4,6*($$-$r+1),5123,this._startIdx+6*$r*$tv.BYTES_PIDX),$d=$a.bitmap,$r=$$)}else $Q.drawElements(4,this._numEle,5123,this._startIdx);return 1},$M.create=function($v,$g,$Q,$d,$r){var $k=$M._cache._length?$M._cache[--$M._cache._length]:new $M;null==$Q&&(($Q=$k._selfVb||($k._selfVb=$uv.create(-1))).clear(),$d=0),$k._ib=$g,$k._vb=$Q,$k._startIdx=$d*$tv.BYTES_PIDX,$k._numEle=0;var $$=$v._nBlendType;$k._blendFn=$v._targets?$H.targetFns[$$]:$H.fns[$$],$k.shaderValue=$r,$k.shaderValue.setValue($v._shader2D);var $b=$v._shader2D.filters;return $b&&$k.shaderValue.setFilters($b),$k},$M._cache=(($M._cache=[])._length=0,$M._cache),$M._shaderSet=!0,$M}(),$xv=function($v){function $C(){$C.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$J($C,"laya.webgl.utils.MeshTexture",$Cv);var $g=$C.prototype;return $g.addData=function($v,$g,$Q,$d,$r,$k){for(var $$=$v.length/2,$b=this._vb.needSize($$*$C.const_stride)>>2,$a=this._vb.getFloat32Array(),$M=0,$Y=0;$Y<$$;$Y++){var $D=$v[$M],$J=$v[$M+1],$p=$D*$d.a+$J*$d.c+$d.tx,$T=$D*$d.b+$J*$d.d+$d.ty;$a[$b++]=$p,$a[$b++]=$T,$a[$b++]=$g[$M],$a[$b++]=$g[$M+1],$M+=2}this._vb.setNeedUpload();var $t=this.vertNum;if(0<$t){($$=$Q.length)>$C.tmpIdx.length&&($C.tmpIdx=new Uint16Array($$));for(var $q=0;$q<$$;$q++)$C.tmpIdx[$q]=$Q[$q]+$t;this._ib.appendU16Array($C.tmpIdx,$Q.length)}else this._ib.append($Q);this._ib.setNeedUpload(),this.vertNum+=$$,this.indexNum+=$Q.length},$g.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$g.destroy=function(){this._ib.destroy(),this._vb.destroy()},$C.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $C},$C.const_stride=16,$C._POOL=[],$$($C,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$C}(),$wv=function($v){function $g(){$g.__super.call(this),this.lock=!0}return $J($g,"laya.webgl.shader.BaseShader",$s),$g.activeShader=null,$g.bindShader=null,$g}(),$mv=function($g){function $Y($v,$g,$Q,$d,$r,$k,$$,$b,$a){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$Q&&($Q=6408),void 0===$d&&($d=5121),void 0===$r&&($r=34041),void 0===$k&&($k=!1),void 0===$$&&($$=!1),void 0===$b&&($b=-1),void 0===$a&&($a=-1),this._type=1,this._w=$v,this._h=$g,this._surfaceFormat=$Q,this._surfaceType=$d,this._depthStencilFormat=$r,$C.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$k,this._repeat=$$,this._minFifter=$b,this._magFifter=$a,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$Y.__super.call(this,this.bitmap,$x.INV_UV)}$J($Y,"laya.webgl.resource.RenderTarget2D",$g);var $v=$Y.prototype;return $P.imps($v,{"laya.resource.IDispose":!0}),$v.getType=function(){return this._type},$v.getTexture=function(){return this},$v.size=function($v,$g){this._w==$v&&this._h==$g||(this._w=$v,this._h=$g,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$v.release=function(){this.destroy()},$v.recycle=function(){$Y.POOL.push(this)},$v.start=function(){var $v=$Av.mainContext;return this._preRenderTarget=$Gv.curRenderTarget,$Gv.curRenderTarget=this,$v.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($v.viewport(0,0,this._w,this._h),this._svWidth=$Gv.width,this._svHeight=$Gv.height,$Gv.width=this._w,$Gv.height=this._h,$wv.activeShader=null),this},$v.clear=function($v,$g,$Q,$d){void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=1);var $r=$Av.mainContext;$r.clearColor($v,$g,$Q,$d);var $k=16384;switch(this._depthStencilFormat){case 33189:$k|=256;break;case 36168:$k|=1024;break;case 34041:$k|=256,$k|=1024}$r.clear($k)},$v.end=function(){var $v=$Av.mainContext;$v.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$Gv.curRenderTarget=this._preRenderTarget,1==this._type?($v.viewport(0,0,this._svWidth,this._svHeight),$Gv.width=this._svWidth,$Gv.height=this._svHeight,$wv.activeShader=null):$v.viewport(0,0,$P.stage.width,$P.stage.height)},$v.getData=function($v,$g,$Q,$d){var $r=$Av.mainContext;if($r.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$r.checkFramebufferStatus(36160)))return $r.bindFramebuffer(36160,null),null;var $k=new Uint8Array(this._w*this._h*4);return $r.readPixels($v,$g,$Q,$d,this._surfaceFormat,this._surfaceType,$k),$r.bindFramebuffer(36160,null),$k},$v.destroy=function($v){void 0===$v&&($v=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$g.prototype.destroy.call(this))},$v.dispose=function(){},$v._createWebGLRenderTarget=function(){this.bitmap=new $Rv(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($v){this.event("recovered")})},$d(0,$v,"surfaceFormat",function(){return this._surfaceFormat}),$d(0,$v,"magFifter",function(){return this._magFifter}),$d(0,$v,"surfaceType",function(){return this._surfaceType}),$d(0,$v,"mipMap",function(){return this._mipMap}),$d(0,$v,"depthStencilFormat",function(){return this._depthStencilFormat}),$d(0,$v,"minFifter",function(){return this._minFifter}),$d(0,$v,"source",function(){return this._alreadyResolved?$P.superGet($x,this,"source"):null}),$Y.create=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){void 0===$Q&&($Q=6408),void 0===$d&&($d=5121),void 0===$r&&($r=34041),void 0===$k&&($k=!1),void 0===$$&&($$=!1),void 0===$b&&($b=-1),void 0===$a&&($a=-1);var $M=$Y.POOL.pop();return $M||($M=new $Y($v,$g)),$M.bitmap&&$M._w==$v&&$M._h==$g&&$M._surfaceFormat==$Q&&$M._surfaceType==$d&&$M._depthStencilFormat==$r&&$M._mipMap==$k&&$M._repeat==$$&&$M._minFifter==$b&&$M._magFifter==$a||($M._w=$v,$M._h=$g,$M._surfaceFormat=$Q,$M._surfaceType=$d,$M._depthStencilFormat=$r,$C.isConchWebGL&&34041===$M._depthStencilFormat&&($M._depthStencilFormat=33189),$M._mipMap=$k,$M._repeat=$$,$M._minFifter=$b,$M._magFifter=$a,$M.release(),$M._createWebGLRenderTarget()),$M},$Y.TYPE2D=1,$Y.TYPE3D=2,$Y.POOL=[],$Y}($x),$Kv=function($v){function $g(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$g.__super.call(this),$g._gl=$Av.mainContext}$J($g,"laya.webgl.utils.Buffer",$s);var $Q=$g.prototype;return $Q._bind=function(){this.activeResource(),$g._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($g._bindVertexBuffer=this._glBuffer),$g._gl.bindBuffer(this._bufferType,$g._bindActive[this._bufferType]=this._glBuffer),$wv.activeShader=null)},$Q.recreateResource=function(){this._glBuffer||(this._glBuffer=$g._gl.createBuffer()),this.completeCreate()},$Q.disposeResource=function(){this._glBuffer&&($Av.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$d(0,$Q,"bufferUsage",function(){return this._bufferUsage}),$g._gl=null,$g._bindActive={},$g._bindVertexBuffer=null,$g._enableAtributes=[],$g}(),$cv=function($v){function $Q($v){this.texcoord=null,this.offsetX=300,this.offsetY=0,$Q.__super.call(this,512,0);var $g=8*$tv.BYTES_PE;this.position=[2,5126,!1,$g,0],this.texcoord=[2,5126,!1,$g,2*$tv.BYTES_PE],this.color=[4,5126,!1,$g,4*$tv.BYTES_PE]}return $J($Q,"laya.webgl.shader.d2.skinAnishader.SkinSV",$Fv),$Q}(),$Bv=function($v){function $g($v){$g.__super.call(this,2,0),this.color=[]}return $J($g,"laya.webgl.shader.d2.value.Color2dSV",$Fv),$g.prototype.setValue=function($v){$v.fillStyle&&(this.color=$v.fillStyle._color._color),$v.strokeStyle&&(this.color=$v.strokeStyle._color._color)},$g}(),$jv=function($v){function $g($v){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$Fv._TEXCOORD,$g.__super.call(this,256,0)}$J($g,"laya.webgl.shader.d2.value.FillTextureSV",$Fv);var $Q=$g.prototype;return $Q.setValue=function($v){this.ALPHA=$v.ALPHA,$v.filters&&this.setFilters($v.filters)},$Q.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$g}(),$Lv=function($v){function $g($v){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$Fv._TEXCOORD,void 0===$v&&($v=0),$g.__super.call(this,1,$v)}$J($g,"laya.webgl.shader.d2.value.TextureSV",$Fv);var $Q=$g.prototype;return $Q.setValue=function($v){this.ALPHA=$v.ALPHA,$v.filters&&this.setFilters($v.filters)},$Q.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$g}(),$Hv=function($v){function $g($v){this.a_color=null,this.u_pos=[0,0],$g.__super.call(this,4,0),this.position=[2,5126,!1,5*$tv.BYTES_PE,0],this.a_color=[3,5126,!1,5*$tv.BYTES_PE,2*$tv.BYTES_PE]}return $J($g,"laya.webgl.shader.d2.value.PrimitiveSV",$Fv),$g}(),$nv=function($v){function $g(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$g.__super.call(this)}$J($g,"laya.webgl.atlas.AtlasWebGLCanvas",$v);var $Q=$g.prototype;return $Q.recreateResource=function(){var $v=$Av.mainContext,$g=this._source=$v.createTexture(),$Q=$hv.curBindTexTarget,$d=$hv.curBindTexValue;$hv.bindTexture($v,3553,$g),$v.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$v.texParameteri(3553,10241,9729),$v.texParameteri(3553,10240,9729),$v.texParameteri(3553,10242,33071),$v.texParameteri(3553,10243,33071),$Q&&$d&&$hv.bindTexture($v,$Q,$d),this.memorySize=this._w*this._h*4,this.completeCreate()},$Q.disposeResource=function(){this._source&&($Av.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$Q.texSubImage2D=function($v,$g,$Q){if($C.isFlash){this._flashCacheImage||(this._flashCacheImage=$t.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $d=$Q.bitmapdata;this._flashCacheImage._image.copyPixels($d,0,0,$d.width,$d.height,$v,$g),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $r=$Av.mainContext,$k=$hv.curBindTexTarget,$$=$hv.curBindTexValue;$hv.bindTexture($r,3553,this._source),$r.pixelStorei(37441,!0),0<=$v-1&&$r.texSubImage2D(3553,0,$v-1,$g,6408,5121,$Q),$v+1<=this._w&&$r.texSubImage2D(3553,0,$v+1,$g,6408,5121,$Q),0<=$g-1&&$r.texSubImage2D(3553,0,$v,$g-1,6408,5121,$Q),$g+1<=this._h&&$r.texSubImage2D(3553,0,$v,$g+1,6408,5121,$Q),$r.texSubImage2D(3553,0,$v,$g,6408,5121,$Q),$r.pixelStorei(37441,!1),$k&&$$&&$hv.bindTexture($r,$k,$$)}},$Q.texSubImage2DPixel=function($v,$g,$Q,$d,$r){var $k=$Av.mainContext,$$=$hv.curBindTexTarget,$b=$hv.curBindTexValue;$hv.bindTexture($k,3553,this._source);var $a=new Uint8Array($r.data);$k.pixelStorei(37441,!0),$k.texSubImage2D(3553,0,$v,$g,$Q,$d,6408,5121,$a),$k.pixelStorei(37441,!1),$$&&$b&&$hv.bindTexture($k,$$,$b)},$d(0,$Q,"width",$v.prototype._$get_width,function($v){this._w=$v}),$d(0,$Q,"height",$v.prototype._$get_height,function($v){this._h=$v}),$g}($Q),$yv=function($v){function $r(){this.flipY=!0,this.alwaysChange=!1,$r.__super.call(this)}$J($r,"laya.webgl.resource.WebGLCanvas",$Q);var $g=$r.prototype;return $g.getCanvas=function(){return this._canvas},$g.clear=function(){this._ctx&&this._ctx.clear()},$g.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$g._setContext=function($v){this._ctx=$v},$g.getContext=function($v,$g){return this._ctx?this._ctx:this._ctx=$r._createContext(this)},$g.size=function($v,$g){this._w==$v&&this._h==$g||(this._w=$v,this._h=$g,this._ctx&&this._ctx.size($v,$g),this._canvas&&(this._canvas.height=$g,this._canvas.width=$v))},$g.activeResource=function($v){void 0===$v&&($v=!1),this._source||this.recreateResource()},$g.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$g.disposeResource=function(){this._source&&!this.iscpuSource&&($Av.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$g.createWebGlTexture=function(){var $v=$Av.mainContext;this._canvas;var $g=this._source=$v.createTexture();this.iscpuSource=!1;var $Q=$hv.curBindTexTarget,$d=$hv.curBindTexValue;$hv.bindTexture($v,3553,$g),$v.pixelStorei(37440,this.flipY?1:0),$r.premulAlpha&&$v.pixelStorei(37441,!0),$v.texImage2D(3553,0,6408,6408,5121,this._imgData),$r.premulAlpha&&$v.pixelStorei(37441,!1),$v.texParameteri(3553,10240,9729),$v.texParameteri(3553,10241,9729),$v.texParameteri(3553,10242,33071),$v.texParameteri(3553,10243,33071),$v.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$Q&&$d&&$hv.bindTexture($v,$Q,$d)},$g.reloadCanvasData=function(){var $v=$Av.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $g=$hv.curBindTexTarget,$Q=$hv.curBindTexValue;$hv.bindTexture($v,3553,this._source),$r.premulAlpha&&$v.pixelStorei(37441,!0),$v.texImage2D(3553,0,6408,6408,5121,this._imgData),$r.premulAlpha&&$v.pixelStorei(37441,!1),$v.pixelStorei(37440,0),$g&&$Q&&$hv.bindTexture($v,$g,$Q)},$g.texSubImage2D=function($v,$g,$Q){var $d=$Av.mainContext,$r=$hv.curBindTexTarget,$k=$hv.curBindTexValue;$hv.bindTexture($d,3553,this._source),$d.pixelStorei(37441,!0),$d.texSubImage2D(3553,0,$g,$Q,6408,5121,$v._source),$d.pixelStorei(37441,!1),$r&&$k&&$hv.bindTexture($d,$r,$k)},$g.toBase64=function($v,$g,$Q){var $d=null;this._canvas&&($d=this._canvas.toDataURL($v,$g)),$Q.call(this,$d)},$d(0,$g,"context",function(){return this._ctx}),$d(0,$g,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$d(0,$g,"asBitmap",null,function($v){this._ctx&&(this._ctx.asBitmap=$v)}),$r._createContext=null,$r.premulAlpha=!1,$r}(),$ev=function($v){function $k($v,$g){this.CborderSize=12,$k.__super.call(this),this.char=$v,this.isSpace=" "===$v,this.xs=$g.scaleX,this.ys=$g.scaleY,this.font=$g.font.toString(),this.fontSize=$g.font.size,this.fillColor=$g.fillColor,this.borderColor=$g.borderColor,this.lineWidth=$g.lineWidth,this.underLine=$g.underLine;var $Q,$d=$C.isConchApp;$d?(($Q=ConchTextCanvas)._source=ConchTextCanvas,$Q._source.canvas=ConchTextCanvas):$Q=$p.canvas.source,this.canvas=$Q,this._enableMerageInAtlas=!0,this._ctx=$d?$Q:this.canvas.getContext("2d",void 0);var $r=$w.measureText(this.char,this.font);this.cw=$r.width*this.xs,this.ch=($r.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $x(this)}$J($k,"laya.webgl.resource.WebGLCharImage",$Q);var $g=$k.prototype;return $P.imps($g,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$g.active=function(){this.texture.active()},$g.recreateResource=function(){var $v=$C.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$v){var $g=this.fontSize;1==this.xs&&1==this.ys||($g=parseInt($g*(this.xs>this.ys?this.xs:this.ys)+""));var $Q="normal 100 "+this.font;$Q=$Q.replace($k._fontSizeReg,$g),this.borderColor&&($Q+=" 1 "+this.borderColor),this._ctx.font=$Q,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$i.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $d=this._ctx.measureText(this.char);$d||($d={width:16});var $r=$d.width+1;this._ctx.lineTo($r,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$g.onresize=function($v,$g){this._w=$v,this._h=$g,this._allowMerageInAtlas=!0},$g.clearAtlasSource=function(){},$d(0,$g,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$d(0,$g,"atlasSource",function(){return this.canvas}),$d(0,$g,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($v){this._enableMerageInAtlas=$v}),$k.createOneChar=function($v,$g){return new $k($v,$g)},$k._fontSizeReg=new RegExp("\\d+(?=px)","g"),$k}(),$Rv=function($v){function $M($v,$g,$Q,$d,$r,$k,$$,$b,$a){void 0===$Q&&($Q=6408),void 0===$d&&($d=5121),void 0===$r&&($r=34041),void 0===$k&&($k=!1),void 0===$$&&($$=!1),void 0===$b&&($b=-1),void 0===$a&&($a=1),$M.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$v,this._h=$g,this._surfaceFormat=$Q,this._surfaceType=$d,this._depthStencilFormat=$r,this._mipMap=$k,this._repeat=$$,this._minFifter=$b,this._magFifter=$a}$J($M,"laya.webgl.resource.WebGLRenderTarget",$Q);var $g=$M.prototype;return $g.recreateResource=function(){var $v=$Av.mainContext;this._frameBuffer||(this._frameBuffer=$v.createFramebuffer()),this._source||(this._source=$v.createTexture());var $g=$hv.curBindTexTarget,$Q=$hv.curBindTexValue;$hv.bindTexture($v,3553,this._source),$v.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $d=this._minFifter,$r=this._magFifter,$k=this._repeat?10497:33071,$$=$Y.isPOT(this._w,this._h);if($$?(this._mipMap?-1!==$d||($d=9987):-1!==$d||($d=9729),-1!==$r||($r=9729),$v.texParameteri(3553,10241,$d),$v.texParameteri(3553,10240,$r),$v.texParameteri(3553,10242,$k),$v.texParameteri(3553,10243,$k),this._mipMap&&$v.generateMipmap(3553)):(-1!==$d||($d=9729),-1!==$r||($r=9729),$v.texParameteri(3553,10241,$d),$v.texParameteri(3553,10240,$r),$v.texParameteri(3553,10242,33071),$v.texParameteri(3553,10243,33071)),$v.bindFramebuffer(36160,this._frameBuffer),$v.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$v.createRenderbuffer()),$v.bindRenderbuffer(36161,this._depthStencilBuffer),$v.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$v.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$v.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$v.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$v.bindFramebuffer(36160,null),$g&&$Q&&$hv.bindTexture($v,$g,$Q),$v.bindRenderbuffer(36161,null),$$&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$g.disposeResource=function(){this._frameBuffer&&($Av.mainContext.deleteTexture(this._source),$Av.mainContext.deleteFramebuffer(this._frameBuffer),$Av.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$d(0,$g,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$d(0,$g,"frameBuffer",function(){return this._frameBuffer}),$M}(),$zv=function($v){function $b($v,$g,$Q,$d,$r,$k,$$){this.offsetX=0,this.offsetY=0,$b.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$k,this.canvas=$v,this._ctx=$v.getContext("2d",void 0),this._w=$d,this._h=$r,this.offsetX=$g,this.offsetY=$Q,this.src=$$,this._enableMerageInAtlas=!0,$j.enabled&&this._w<$j.atlasLimitWidth&&this._h<$j.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$J($b,"laya.webgl.resource.WebGLSubImage",$Q);var $g=$b.prototype;return $P.imps($g,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$g.size=function($v,$g){this._w=$v,this._h=$g,this._ctx&&this._ctx.size($v,$g),this.canvas&&(this.canvas.height=$g,this.canvas.width=$v)},$g.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$g.createWebGlTexture=function(){var $v=$Av.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $g=this._source=$v.createTexture(),$Q=$hv.curBindTexTarget,$d=$hv.curBindTexValue;$hv.bindTexture($v,3553,$g),$v.pixelStorei(37441,!0),$v.texImage2D(3553,0,6408,6408,5121,this.canvas),$v.pixelStorei(37441,!1);var $r=this.minFifter,$k=this.magFifter,$$=this.repeat?10497:33071,$b=$Y.isPOT(this.width,this.height);$b?(this.mipmap?-1!==$r||($r=9987):-1!==$r||($r=9729),-1!==$k||($k=9729),$v.texParameteri(3553,10240,$k),$v.texParameteri(3553,10241,$r),$v.texParameteri(3553,10242,$$),$v.texParameteri(3553,10243,$$),this.mipmap&&$v.generateMipmap(3553)):(-1!==$r||($r=9729),-1!==$k||($k=9729),$v.texParameteri(3553,10241,$r),$v.texParameteri(3553,10240,$k),$v.texParameteri(3553,10242,33071),$v.texParameteri(3553,10243,33071)),$Q&&$d&&$hv.bindTexture($v,$Q,$d),this.canvas=null,$b&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$g.disposeResource=function(){$j.enabled&&this._allowMerageInAtlas||!this._source||($Av.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$g.clearAtlasSource=function(){},$d(0,$g,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$d(0,$g,"atlasSource",function(){return this.canvas}),$d(0,$g,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($v){this._allowMerageInAtlas=$v}),$b}(),$Uv=function($v){function $M($v,$g,$Q,$d){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$M.__super.call(this),!$v||!$g)throw"Shader Error";this._id=++$M._count,this._vs=$v,this._ps=$g,this._nameMap=$d||{},null!=$Q&&($M.sharders[$Q]=this)}$J($M,"laya.webgl.shader.Shader",$wv);var $g=$M.prototype;return $g.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$g.disposeResource=function(){$Av.mainContext.deleteShader(this._vshader),$Av.mainContext.deleteShader(this._pshader),$Av.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$g._compile=function(){if(!$Av.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $v=[this._vs,this._ps],$g=$Av.mainContext;if(this._program=$g.createProgram(),this._vshader=$M._createShader($g,$v[0],35633),this._pshader=$M._createShader($g,$v[1],35632),$g.attachShader(this._program,this._vshader),$g.attachShader(this._program,this._pshader),$g.linkProgram(this._program),!$C.isConchApp&&!$g.getProgramParameter(this._program,35714))throw $g.getProgramInfoLog(this._program);var $Q,$d,$r=0,$k=0;for($k=$C.isConchApp?$g.getProgramParameterEx(this._vs,this._ps,"",35721):$g.getProgramParameter(this._program,35721),$r=0;$r<$k;$r++){var $$=null;$Q={vartype:"attribute",glfun:null,ivartype:0,attrib:$$=$C.isConchApp?$g.getActiveAttribEx(this._vs,this._ps,"",$r):$g.getActiveAttrib(this._program,$r),location:$g.getAttribLocation(this._program,$$.name),name:$$.name,type:$$.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($Q)}var $b=0;for($b=$C.isConchApp?$g.getProgramParameterEx(this._vs,this._ps,"",35718):$g.getProgramParameter(this._program,35718),$r=0;$r<$b;$r++){var $a=null;$a=$C.isConchApp?$g.getActiveUniformEx(this._vs,this._ps,"",$r):$g.getActiveUniform(this._program,$r),0<($Q={vartype:"uniform",glfun:null,ivartype:1,attrib:$$,location:$g.getUniformLocation(this._program,$a.name),name:$a.name,type:$a.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($Q.name=$Q.name.substr(0,$Q.name.length-3),$Q.isArray=!0,$Q.location=$g.getUniformLocation(this._program,$Q.name)),this._params.push($Q)}for($r=0,$d=this._params.length;$r<$d;$r++)if(($Q=this._params[$r]).indexOfParams=$r,$Q.index=1,$Q.value=[$Q.location,null],$Q.codename=$Q.name,$Q.name=this._nameMap[$Q.codename]?this._nameMap[$Q.codename]:$Q.codename,(this._paramsMap[$Q.name]=$Q)._this=this,$Q.uploadedValue=[],"attribute"!==$Q.vartype)switch($Q.type){case 5124:$Q.fun=$Q.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$Q.fun=$Q.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$Q.fun=$Q.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$Q.fun=$Q.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$Q.fun=$Q.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$Q.fun=this._uniform_sampler2D;break;case 35680:$Q.fun=this._uniform_samplerCube;break;case 35676:$Q.glfun=$g.uniformMatrix4fv,$Q.fun=this._uniformMatrix4fv;break;case 35670:$Q.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $Q.fun=this._attribute}},$g.getUniform=function($v){return this._paramsMap[$v]},$g._attribute=function($v,$g){var $Q=$Av.mainContext,$d=$Kv._enableAtributes,$r=$v.location;return $d[$r]||$Q.enableVertexAttribArray($r),$Q.vertexAttribPointer($r,$g[0],$g[1],$g[2],$g[3],$g[4]+this._offset),$d[$r]=$Kv._bindVertexBuffer,1},$g._uniform1f=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g?($Av.mainContext.uniform1f($v.location,$Q[0]=$g),1):0},$g._uniform1fv=function($v,$g){if($g.length<4){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Av.mainContext.uniform1fv($v.location,$g),$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3],1):0}return $Av.mainContext.uniform1fv($v.location,$g),1},$g._uniform_vec2=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]?($Av.mainContext.uniform2f($v.location,$Q[0]=$g[0],$Q[1]=$g[1]),1):0},$g._uniform_vec2v=function($v,$g){if($g.length<2){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Av.mainContext.uniform2fv($v.location,$g),$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3],1):0}return $Av.mainContext.uniform2fv($v.location,$g),1},$g._uniform_vec3=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]?($Av.mainContext.uniform3f($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2]),1):0},$g._uniform_vec3v=function($v,$g){return $Av.mainContext.uniform3fv($v.location,$g),1},$g._uniform_vec4=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Av.mainContext.uniform4f($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3]),1):0},$g._uniform_vec4v=function($v,$g){return $Av.mainContext.uniform4fv($v.location,$g),1},$g._uniformMatrix2fv=function($v,$g){return $Av.mainContext.uniformMatrix2fv($v.location,!1,$g),1},$g._uniformMatrix3fv=function($v,$g){return $Av.mainContext.uniformMatrix3fv($v.location,!1,$g),1},$g._uniformMatrix4fv=function($v,$g){return $Av.mainContext.uniformMatrix4fv($v.location,!1,$g),1},$g._uniform1i=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g?($Av.mainContext.uniform1i($v.location,$Q[0]=$g),1):0},$g._uniform1iv=function($v,$g){return $Av.mainContext.uniform1iv($v.location,$g),1},$g._uniform_ivec2=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]?($Av.mainContext.uniform2i($v.location,$Q[0]=$g[0],$Q[1]=$g[1]),1):0},$g._uniform_ivec2v=function($v,$g){return $Av.mainContext.uniform2iv($v.location,$g),1},$g._uniform_vec3i=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]?($Av.mainContext.uniform3i($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2]),1):0},$g._uniform_vec3vi=function($v,$g){return $Av.mainContext.uniform3iv($v.location,$g),1},$g._uniform_vec4i=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Av.mainContext.uniform4i($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3]),1):0},$g._uniform_vec4vi=function($v,$g){return $Av.mainContext.uniform4iv($v.location,$g),1},$g._uniform_sampler2D=function($v,$g){var $Q=$Av.mainContext,$d=$v.uploadedValue;return null==$d[0]?($d[0]=this._curActTexIndex,$Q.uniform1i($v.location,this._curActTexIndex),$Q.activeTexture($M._TEXTURES[this._curActTexIndex]),$hv.bindTexture($Q,3553,$g),this._curActTexIndex++,1):($Q.activeTexture($M._TEXTURES[$d[0]]),$hv.bindTexture($Q,3553,$g),0)},$g._uniform_samplerCube=function($v,$g){var $Q=$Av.mainContext,$d=$v.uploadedValue;return null==$d[0]?($d[0]=this._curActTexIndex,$Q.uniform1i($v.location,this._curActTexIndex),$Q.activeTexture($M._TEXTURES[this._curActTexIndex]),$hv.bindTexture($Q,34067,$g),this._curActTexIndex++,1):($Q.activeTexture($M._TEXTURES[$d[0]]),$hv.bindTexture($Q,34067,$g),0)},$g._noSetValue=function($v){console.log("no....:"+$v.name)},$g.uploadOne=function($v,$g){this.activeResource(),$hv.UseProgram(this._program);var $Q=this._paramsMap[$v];$Q.fun.call(this,$Q,$g)},$g.uploadTexture2D=function($v){$f.shaderCall++;var $g=$Av.mainContext;$g.activeTexture(33984),$hv.bindTexture($g,3553,$v)},$g.uploadTexture2D1=function($v){$f.shaderCall++;var $g=$Av.mainContext;$g.activeTexture(33985),$hv.bindTexture($g,3553,$v)},$g.upload=function($v,$g){$wv.activeShader=$wv.bindShader=this,this._lastUseFrameCount===$f.loopCount||this.activeResource(),$hv.UseProgram(this._program),this._reCompile?($g=this._params,this._reCompile=!1):$g=$g||this._params;$Av.mainContext;for(var $Q,$d,$r=$g.length,$k=0,$$=0;$$<$r;$$++)null!==($d=$v[($Q=$g[$$]).name])&&($k+=$Q.fun.call(this,$Q,$d));$f.shaderCall+=$k},$g.uploadArray=function($v,$g,$Q){$wv.activeShader=this,($wv.bindShader=this).activeResource(),$hv.UseProgram(this._program);this._params;for(var $d,$r,$k=0,$$=$g-2;0<=$$;$$-=2)($r=this._paramsMap[$v[$$]])&&null!=($d=$v[$$+1])&&($Q&&$Q[$r.name]&&$Q[$r.name].bind(),$k+=$r.fun.call(this,$r,$d));$f.shaderCall+=$k},$g.getParams=function(){return this._params},$M.getShader=function($v){return $M.sharders[$v]},$M.create=function($v,$g,$Q,$d){return new $M($v,$g,$Q,$d)},$M.withCompile=function($v,$g,$Q,$d){if($Q&&$M.sharders[$Q])return $M.sharders[$Q];var $r=$M._preCompileShader[2e-4*$v];if(!$r)throw new Error("withCompile shader err!"+$v);return $r.createShader($g,$Q,$d)},$M.withCompile2D=function($v,$g,$Q,$d,$r){if($d&&$M.sharders[$d])return $M.sharders[$d];var $k=$M._preCompileShader[2e-4*$v+$g];if(!$k)throw new Error("withCompile shader err!"+$v+" "+$g);return $k.createShader($Q,$d,$r)},$M.addInclude=function($v,$g){$sv.addInclude($v,$g)},$M.preCompile=function($v,$g,$Q,$d){var $r=2e-4*$v;$M._preCompileShader[$r]=new $sv($r,$g,$Q,$d)},$M.preCompile2D=function($v,$g,$Q,$d,$r){var $k=2e-4*$v+$g;$M._preCompileShader[$k]=new $sv($k,$Q,$d,$r)},$M._createShader=function($v,$g,$Q){var $d=$v.createShader($Q);return $v.shaderSource($d,$g),$v.compileShader($d),$d},$M._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$M._count=0,$M._preCompileShader={},$M.SHADERNAME2ID=2e-4,$M.sharders=(($M.sharders=[]).length=32,$M.sharders),$$($M,["nameKey",function(){return this.nameKey=new $X}]),$M}(),$Iv=function($v){function $g(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$g.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$J($g,"laya.webgl.utils.Buffer2D",$v);var $Q=$g.prototype;return $Q.needSize=function($v){var $g=this._byteLength;if($v){var $Q=this._byteLength+$v;$Q<=this._buffer.byteLength||this._resizeBuffer($Q<<1,!0),this._byteLength=$Q}return $g},$Q._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$f.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$Kv._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$Kv._gl.bufferSubData(this._bufferType,0,this._buffer)},$Q._bufferSubData=function($v,$g,$Q){if(void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$f.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$Kv._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$g||$Q){var $d=this._buffer.slice($g,$Q);$Kv._gl.bufferSubData(this._bufferType,$v,$d)}else $Kv._gl.bufferSubData(this._bufferType,$v,this._buffer)},$Q._checkArrayUse=function(){},$Q._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$Q._bind_subUpload=function($v,$g,$Q){return void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($v,$g,$Q),!0)},$Q._resizeBuffer=function($v,$g){if($v<this._buffer.byteLength)return this;if(this.memorySize=$v,$g&&this._buffer&&0<this._buffer.byteLength){var $Q=new ArrayBuffer($v);new Uint8Array($Q).set(new Uint8Array(this._buffer),0),this._buffer=$Q}else this._buffer=new ArrayBuffer($v);return this._checkArrayUse(),this._upload=!0,this},$Q.append=function($v){this._upload=!0;var $g,$Q;$g=$v.byteLength,$v instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$g,!0),$Q=new Uint8Array(this._buffer,this._byteLength)):$v instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$g,!0),$Q=new Uint16Array(this._buffer,this._byteLength)):$v instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$g,!0),$Q=new Float32Array(this._buffer,this._byteLength)),$Q.set($v,0),this._byteLength+=$g,this._checkArrayUse()},$Q.appendU16Array=function($v,$g){this._resizeBuffer(this._byteLength+2*$g,!0);for(var $Q=new Uint16Array(this._buffer,this._byteLength,$g),$d=0;$d<$g;$d++)$Q[$d]=$v[$d];this._byteLength+=2*$g,this._checkArrayUse()},$Q.appendEx=function($v,$g){this._upload=!0;var $Q;$Q=$v.byteLength,this._resizeBuffer(this._byteLength+$Q,!0),new $g(this._buffer,this._byteLength).set($v,0),this._byteLength+=$Q,this._checkArrayUse()},$Q.appendEx2=function($v,$g,$Q,$d){void 0===$d&&($d=1),this._upload=!0;var $r,$k;$r=$Q*$d,this._resizeBuffer(this._byteLength+$r,!0),$k=new $g(this._buffer,this._byteLength);var $$=0;for($$=0;$$<$Q;$$++)$k[$$]=$v[$$];this._byteLength+=$r,this._checkArrayUse()},$Q.getBuffer=function(){return this._buffer},$Q.setNeedUpload=function(){this._upload=!0},$Q.getNeedUpload=function(){return this._upload},$Q.upload=function(){var $v=this._bind_upload();return $Kv._gl.bindBuffer(this._bufferType,null),$Kv._bindActive[this._bufferType]=null,$wv.activeShader=null,$v},$Q.subUpload=function($v,$g,$Q){void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0);var $d=this._bind_subUpload();return $Kv._gl.bindBuffer(this._bufferType,null),$Kv._bindActive[this._bufferType]=null,$wv.activeShader=null,$d},$Q.disposeResource=function(){$v.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$Q.clear=function(){this._byteLength=0,this._upload=!0},$d(0,$Q,"bufferLength",function(){return this._buffer.byteLength}),$d(0,$Q,"byteLength",null,function($v){this._byteLength!==$v&&($v<=this._buffer.byteLength||this._resizeBuffer(2*$v+256,!0),this._byteLength=$v)}),$g.__int__=function($v){$_v.QuadrangleIB=$_v.create(35044),$qv.fillIBQuadrangle($_v.QuadrangleIB,16)},$g.FLOAT32=4,$g.SHORT=2,$g}($Kv),$Sv=(function($g){function $Q($v){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$Q.__super.call(this,9)}$J($Q,"laya.webgl.shader.d2.value.GlowSV",$g);var $v=$Q.prototype;$v.setValue=function($v){$g.prototype.setValue.call(this,$v)},$v.clear=function(){$g.prototype.clear.call(this)}}($Lv),function($v){function $g($v){$g.__super.call(this,64),this.defines.add(64)}$J($g,"laya.webgl.shader.d2.value.TextSV",$v);var $Q=$g.prototype;return $Q.release=function(){($g.pool[$g._length++]=this).clear()},$Q.clear=function(){$v.prototype.clear.call(this)},$g.create=function(){return $g._length?$g.pool[--$g._length]:new $g(null)},$g.pool=[],$g._length=0,$g}($Lv)),$Ov=function($v){function $r($v,$g,$Q,$d){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$r.__super.call(this,$v,$g,$Q,$d)}$J($r,"laya.webgl.shader.d2.Shader2X",$v);var $g=$r.prototype;return $g.upload2dQuick1=function($v){this.upload($v,this._params2dQuick1||this._make2dQuick1())},$g._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $v,$g=this._params,$Q=0,$d=$g.length;$Q<$d;$Q++)$v=$g[$Q],($C.isFlash||"size"!==$v.name&&"position"!==$v.name&&"texcoord"!==$v.name)&&this._params2dQuick1.push($v)}return this._params2dQuick1},$g.disposeResource=function(){$v.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$g.upload2dQuick2=function($v){this.upload($v,this._params2dQuick2||this._make2dQuick2())},$g._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $v,$g=this._params,$Q=0,$d=$g.length;$Q<$d;$Q++)$v=$g[$Q],($C.isFlash||"size"!==$v.name)&&this._params2dQuick2.push($v)}return this._params2dQuick2},$r.create=function($v,$g,$Q,$d){return new $r($v,$g,$Q,$d)},$r}($Uv),$_v=function($v){function $g($v){this._uint8Array=null,this._uint16Array=null,void 0===$v&&($v=35044),$g.__super.call(this),this._bufferUsage=$v,this._bufferType=34963,$C.isFlash||(this._buffer=new ArrayBuffer(8))}$J($g,"laya.webgl.utils.IndexBuffer2D",$Iv);var $Q=$g.prototype;return $Q._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$Q.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$Q.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$Q.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$g.QuadrangleIB=null,$g.create=function($v){return void 0===$v&&($v=35044),new $g($v)},$g}(),$uv=function($v){function $Q($v,$g){this._floatArray32=null,this._vertexStride=0,$Q.__super.call(this),this._vertexStride=$v,this._bufferUsage=$g,this._bufferType=34962,$C.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$J($Q,"laya.webgl.utils.VertexBuffer2D",$v);var $g=$Q.prototype;return $g.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$g.bind=function($v){$v&&$v._bind(),this._bind()},$g.insertData=function($v,$g){this.getFloat32Array().set($v,$g),this._upload=!0},$g.bind_upload=function($v){$v._bind_upload()||$v._bind(),this._bind_upload()||this._bind()},$g._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$g.disposeResource=function(){$v.prototype.disposeResource.call(this)},$g.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$d(0,$g,"vertexStride",function(){return this._vertexStride}),$Q.create=function($v,$g){return void 0===$g&&($g=35048),new $Q($v,$g)},$Q}($Iv),$vg=function($v){function $b($v,$g,$Q,$d,$r,$k){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$Q&&($Q=6408),void 0===$d&&($d=!0),$b.__super.call(this,$v,$g),$v){if(this._format=$Q,this._mipmap=$d,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $v)this._url=$v,this._src=$v,this._image=new $p.window.Image,$g&&($g.onload&&(this.onload=$g.onload),$g.onerror&&(this.onerror=$g.onerror),$g.onCreate&&$g.onCreate(this)),this._image.crossOrigin=$v&&0==$v.indexOf("data:")?null:"",$v&&(this._image.src=$v);else if($v instanceof ArrayBuffer){this._src=$g,this._url=this._src;var $$=new $a($v);$$.readUTFBytes(4),$$.readUTFBytes(2),$$.getInt16();$$.endian="bigEndian",this._w=$$.getInt16(),this._h=$$.getInt16();$$.getInt16(),$$.getInt16();this._image=new Uint8Array($v,$$.pos),this._format=$Av.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$j.enabled&&this._w<$j.atlasLimitWidth&&this._h<$j.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($v instanceof Uint8Array))return this._src=$g,this._url=this._src,this._image=$v.source||$v,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$g,this._url=this._src,this._w=$r,this._h=$k,this._image=$v,this._format=0===$Q?$v.byteLength/($r*$k)==4?6408:6407:$Q}this._$5__enableMerageInAtlas=!0}}$J($b,"laya.webgl.resource.WebGLImage",$t);var $g=$b.prototype;return $P.imps($g,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$g._init_=function($v,$g){},$g._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $v=$Av.mainContext,$g=this._source=$v.createTexture(),$Q=$hv.curBindTexTarget,$d=$hv.curBindTexValue;$hv.bindTexture($v,3553,$g);var $r=this.minFifter,$k=this.magFifter,$$=this.repeat?10497:33071,$b=$Y.isPOT(this._w,this._h),$a=!1;switch($b?(this.mipmap?-1!==$r||($r=9987):-1!==$r||($r=9729),-1!==$k||($k=9729),$v.texParameteri(3553,10241,$r),$v.texParameteri(3553,10240,$k),$v.texParameteri(3553,10242,$$),$v.texParameteri(3553,10243,$$),this.mipmap&&$v.generateMipmap(3553)):(-1!==$r||($r=9729),-1!==$k||($k=9729),$v.texParameteri(3553,10241,$r),$v.texParameteri(3553,10240,$k),$v.texParameteri(3553,10242,33071),$v.texParameteri(3553,10243,33071)),$v.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$v.pixelStorei($v.UNPACK_ALIGNMENT,1),$v.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$v.pixelStorei($v.UNPACK_ALIGNMENT,1),$v.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$a=!0,$v.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $Av.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$a=!0,$v.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$v.pixelStorei(37441,!1),$Q&&$d&&$hv.bindTexture($v,$Q,$d),this.uri||(this.uri=this._url),$a?this.memorySize=this._image.length:$b&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$g.recreateResource=function(){var $v=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $g=this;this._image=new $p.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($g._needReleaseAgain)return $g._needReleaseAgain=!1,$g._image.onload=null,void($g._image=null);$g._allowMerageInAtlas&&$g._enableMerageInAtlas?($v.memorySize=0,$v._recreateLock=!1):$g._createWebGlTexture(),$g.completeCreate()},this._image.src=this._src}},$g.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$Av.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$g.onresize=function(){this._w=this._image.width,this._h=this._image.height,$j.enabled&&this._w<$j.atlasLimitWidth&&this._h<$j.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$g.clearAtlasSource=function(){this._image=null},$d(0,$g,"format",function(){return this._format}),$d(0,$g,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($v){this._$5__enableMerageInAtlas=$v}),$d(0,$g,"mipmap",function(){return this._mipmap}),$d(0,$g,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$d(0,$g,"atlasSource",function(){return this._image}),$d(0,$g,"onload",null,function($v){var $g=this;this._onload=$v,this._image&&(this._image.onload=null!=this._onload?function(){$g.onresize(),$g._onload()}:null)}),$d(0,$g,"onerror",null,function($v){var $g=this;this._onerror=$v,this._image&&(this._image.onerror=null!=this._onerror?function(){$g._onerror()}:null)}),$b}();$P.__init([$pv,$B,$Wv,$sv])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($v,$g){"use strict";for(var $Q in Object.defineProperty($g,"__esModule",{value:!0}),Laya){var $d=Laya[$Q];$d&&$d.__isclass&&($g[$Q]=$d)}}),function($k,$v,$d){$d.un,$d.uns;var $r=$d.static,$$=$d.class,$b=$d.getset,$a=($d.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$T=laya.utils.ClassUtils,$D=(laya.events.Event,laya.utils.HTMLChar),$M=laya.net.Loader,$Y=(laya.display.Node,laya.maths.Rectangle),$J=laya.renders.Render,$p=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$t=laya.utils.Stat,$w=laya.display.Text,$q=laya.resource.Texture,$C=laya.net.URL,$G=laya.utils.Utils,$s=function(){function $p(){}return $$($p,"laya.html.utils.HTMLParse"),$p.parse=function($v,$g,$Q){$g=($g="<root>"+($g=$g.replace(/<br>/g,"<br/>"))+"</root>").replace($p.spacePattern,$p.char255);var $d=$G.parseXMLFromString($g);$p._parseXML($v,$d.childNodes[0].childNodes,$Q)},$p._parseXML=function($v,$g,$Q,$d){var $r=0,$k=0;if($g.join||$g.item)for($r=0,$k=$g.length;$r<$k;++$r)$p._parseXML($v,$g[$r],$Q,$d);else{var $$,$b,$a;if(3==$g.nodeType)return void($v instanceof laya.html.dom.HTMLDivElement?(null==$g.nodeName&&($g.nodeName="#text"),$b=$g.nodeName.toLowerCase(),0<($a=$g.textContent.replace(/^\s+|\s+$/g,"")).length&&($$=$T.getInstance($b))&&($v.addChild($$),$$.innerTEXT=$a.replace($p.char255AndOneSpacePattern," "))):0<($a=$g.textContent.replace(/^\s+|\s+$/g,"")).length&&($v.innerTEXT=$a.replace($p.char255AndOneSpacePattern," ")));if("#comment"==($b=$g.nodeName.toLowerCase()))return;if($$=$T.getInstance($b)){($$=$v.addChild($$)).URI=$Q,$$.href=$d;var $M=$g.attributes;if($M&&0<$M.length)for($r=0,$k=$M.length;$r<$k;++$r){var $Y=$M[$r],$D=$Y.nodeName,$J=$Y.value;$$._setAttributes($D,$J)}$p._parseXML($$,$g.childNodes,$Q,$$.href)}else $p._parseXML($v,$g.childNodes,$Q,$d)}},$p.char255=String.fromCharCode(255),$p.spacePattern=/&nbsp;|&#160;/g,$p.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$p}(),$A=function(){function $x(){}return $$($x,"laya.html.utils.Layout"),$x.later=function($v){null==$x._will&&($x._will=[],$d.stage.frameLoop(1,null,function(){if(!($x._will.length<1)){for(var $v=0;$v<$x._will.length;$v++)laya.html.utils.Layout.layout($x._will[$v]);$x._will.length=0}})),$x._will.push($v)},$x.layout=function($v){if(!$v||!$v._style)return null;if(0==(512&$v._style._type))return null;$v.getStyle()._type&=-513;var $g=$x._multiLineLayout($v);return $J.isConchApp&&$v.layaoutCallNative&&$v.layaoutCallNative(),$g},$x._multiLineLayout=function($v){if($w.RightToLeft)return $x._multiLineLayout2($v);var $g=new Array;$v._addChildsToLayout($g);var $Q,$d,$r,$k,$$,$b=0,$a=$g.length,$M=$v._getCSSStyle(),$Y=$M.letterSpacing,$D=$M.leading,$J=$M.lineHeight,$p=$M._widthAuto()||!$M.wordWrap,$T=$p?999999:$v.width,$t=($v.height,0),$q=$M.italic?$M.fontSize/3:0,$C=$M._getAlign(),$G=$M._getValign(),$s=0!==$G||0!==$C||0!=$J,$A=0,$h=0,$P=0,$W=0,$F=new Array,$l=$F[0]=new $m,$o=!1,$E=!1;$l.h=0,$M.italic&&($T-=$M.fontSize/3);var $V=0,$Z=!0;function $f(){$l.y=$h,$h+=$l.h+$D,0==$l.h&&($h+=$J),$l.mWidth=$V,$V=0,$l=new $m,$F.push($l),$l.h=0,$o=!($Z=!($A=0))}for($b=0;$b<$a;$b++)if(null!=($Q=$g[$b]))if($Z=!1,$Q instanceof laya.html.dom.HTMLBrElement)$f(),$l.y=$h;else{if($Q._isChar()){if(($k=$Q).isWord)$o=$E||"\n"===$k.char,$l.wordStartIndex=$l.elements.length;else{if($P=$k.width+$k.style.letterSpacin,0<$F.length&&$T<$A+$P&&0<$l.wordStartIndex){var $X;$X=$l.elements.length-$l.wordStartIndex+1,$l.elements.length=$l.wordStartIndex,$b-=$X,$f();continue}$o=!1,$V+=$k.width}$P=$k.width+$Y,$W=$k.height,$E=!1,($o=$o||$T<$A+$P)&&$f(),$l.minTextHeight=Math.min($l.minTextHeight,$Q.height)}else $d=$Q._getCSSStyle(),$$=$Q,$r=$d.padding,0===$d._getCssFloat()||($s=!0),$o=$E||$d.lineElement,$P=$$.width*$$._style._tf.scaleX+$r[1]+$r[3]+$Y,$W=$$.height*$$._style._tf.scaleY+$r[0]+$r[2],$E=$d.lineElement,($o=$o||$T<$A+$P&&$d.wordWrap)&&$f();$l.elements.push($Q),$l.h=Math.max($l.h,$W),$Q.x=$A,$Q.y=$h,$A+=$P,$l.w=$A-$Y,$l.y=$h,$t=Math.max($A+$q,$t)}else $Z||($A+=$x.DIV_ELEMENT_PADDING),$l.wordStartIndex=$l.elements.length;if($h=$l.y+$l.h,$s){var $N=0,$i=$T;for($p&&0<$v.width&&($i=$v.width),$b=0,$a=$F.length;$b<$a;$b++)$F[$b].updatePos(0,$i,$b,$N,$C,$G,$J),$N+=Math.max($J,$F[$b].h+$D);$h=$N}return $p&&($v.width=$t),$h>$v.height&&($v.height=$h),[$t,$h]},$x._multiLineLayout2=function($v){var $g=new Array;$v._addChildsToLayout($g);var $Q,$d,$r,$k,$$,$b=0,$a=$g.length,$M=$v._getCSSStyle(),$Y=$M.letterSpacing,$D=$M.leading,$J=$M.lineHeight,$p=$M._widthAuto()||!$M.wordWrap,$T=$p?999999:$v.width,$t=($v.height,0),$q=$M.italic?$M.fontSize/3:0,$C=2-$M._getAlign(),$G=$M._getValign(),$s=0!==$G||0!=$C||0!=$J,$A=0,$h=0,$P=0,$W=0,$F=new Array,$l=$F[0]=new $m,$o=!1,$E=!1;$l.h=0,$M.italic&&($T-=$M.fontSize/3);var $V=0,$Z=!0;function $f(){$l.y=$h,$h+=$l.h+$D,0==$l.h&&($h+=$J),$l.mWidth=$V,$V=0,$l=new $m,$F.push($l),$l.h=0,$o=!($Z=!($A=0))}for($b=0;$b<$a;$b++)if(null!=($Q=$g[$b]))if($Z=!1,$Q instanceof laya.html.dom.HTMLBrElement)$f(),$l.y=$h;else{if($Q._isChar()){if(($k=$Q).isWord)$o=$E||"\n"===$k.char,$l.wordStartIndex=$l.elements.length;else{if(0<$F.length&&$T<$A+$P&&0<$l.wordStartIndex){var $X;$X=$l.elements.length-$l.wordStartIndex+1,$l.elements.length=$l.wordStartIndex,$b-=$X,$f();continue}$o=!1,$V+=$k.width}$P=$k.width+$Y,$W=$k.height,$E=!1,($o=$o||$T<$A+$P)&&$f(),$l.minTextHeight=Math.min($l.minTextHeight,$Q.height)}else $d=$Q._getCSSStyle(),$$=$Q,$r=$d.padding,0===$d._getCssFloat()||($s=!0),$o=$E||$d.lineElement,$P=$$.width*$$._style._tf.scaleX+$r[1]+$r[3]+$Y,$W=$$.height*$$._style._tf.scaleY+$r[0]+$r[2],$E=$d.lineElement,($o=$o||$T<$A+$P&&$d.wordWrap)&&$f();$l.elements.push($Q),$l.h=Math.max($l.h,$W),$Q.x=$A,$Q.y=$h,$A+=$P,$l.w=$A-$Y,$l.y=$h,$t=Math.max($A+$q,$t)}else $Z||($A+=$x.DIV_ELEMENT_PADDING),$l.wordStartIndex=$l.elements.length;if($h=$l.y+$l.h,$s){var $N=0,$i=$T;for($b=0,$a=$F.length;$b<$a;$b++)$F[$b].updatePos(0,$i,$b,$N,$C,$G,$J),$N+=Math.max($J,$F[$b].h+$D);$h=$N}for($p&&($v.width=$t),$h>$v.height&&($v.height=$h),$b=0,$a=$F.length;$b<$a;$b++)$F[$b].revertOrder($T);return[$t,$h]},$x._will=null,$x.DIV_ELEMENT_PADDING=0,$x}(),$m=function(){function $v(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$$($v,"laya.html.utils.LayoutLine");var $g=$v.prototype;return $g.updatePos=function($v,$g,$Q,$d,$r,$k,$$){var $b,$a=0;0<this.elements.length&&($a=($b=this.elements[this.elements.length-1]).x+$b.width-this.elements[0].x);var $M=0,$Y=NaN;1===$r&&($M=($g-$a)/2),2===$r&&($M=$g-$a),0===$$||0!=$k||($k=1);for(var $D=0,$J=this.elements.length;$D<$J;$D++){var $p=($b=this.elements[$D])._getCSSStyle();switch(0!==$M&&($b.x+=$M),$p._getValign()){case 0:$b.y=$d;break;case 1:var $T=0;99999!=this.minTextHeight&&($T=this.minTextHeight);var $t=($T+$$)/2;$t=Math.max($t,this.h),$Y=(laya.html.dom.HTMLImageElement,$d+$t-$b.height),$b.y=$Y;break;case 2:$b.y=$d+($$-$b.height)}}},$g.revertOrder=function($v){var $g;if(0<this.elements.length){var $Q,$d=0;for($Q=this.elements.length,$d=0;$d<$Q;$d++)($g=this.elements[$d]).x=$v-$g.x-$g.width}},$v}(),$h=function($Q){function $g(){this.URI=null,this._href=null,$g.__super.call(this),this._text=$g._EMPTYTEXT,this.setStyle(new $a(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$$($g,"laya.html.dom.HTMLElement",$Q);var $v=$g.prototype;return $v.layaoutCallNative=function(){var $v=0;if(this._childs&&0<($v=this._childs.length))for(var $g=0;$g<$v;$g++)this._childs[$g].layaoutCallNative&&this._childs[$g].layaoutCallNative();var $Q=this._getWords();$Q?laya.html.dom.HTMLElement.fillWords(this,$Q,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$v.appendChild=function($v){return this.addChild($v)},$v._getWords2=function(){var $v=this._text.text;if(!$v||0===$v.length)return null;var $g,$Q,$d=0,$r=0;if(this._text.drawWords)$Q=this._text.drawWords;else{for($r=($g=$v.split(" ")).length-1,$Q=[],$d=0;$d<$r;$d++)$Q.push($g[$d]," ");0<=$r&&$Q.push($g[$r]),this._text.drawWords=$Q}var $k,$$=this._text.words;if($$&&$$.length===$Q.length)return $$;null===$$&&(this._text.words=$$=[]),$$.length=$Q.length;var $b=this.style,$a=$b.font;for($d=0,$r=$Q.length;$d<$r;$d++){$k=$G.measureText($Q[$d],$a);var $M=$$[$d]=new $D($Q[$d],$k.width,$k.height||$b.fontSize,$b);if(1<$M.char.length&&($M.charNum=$M.char),this.href){var $Y=new $p;this.addChild($Y),$M.setSprite($Y)}}return $$},$v._getWords=function(){if(!$w.CharacterCache)return this._getWords2();var $v=this._text.text;if(!$v||0===$v.length)return null;var $g,$Q=this._text.words;if($Q&&$Q.length===$v.length)return $Q;null===$Q&&(this._text.words=$Q=[]),$Q.length=$v.length;for(var $d=this.style,$r=$d.font,$k=0,$$=$v.length;$k<$$;$k++)if($g=$G.measureText($v.charAt($k),$r)){var $b=$Q[$k]=new $D($v.charAt($k),$g.width,$g.height||$d.fontSize,$d);if(this.href){var $a=new $p;this.addChild($a),$b.setSprite($a)}}else console.warn("_getWords size is null"+$v.charAt($k),$r);return $Q},$v.showLinkSprite=function(){var $v=this._text.words;if($v)for(var $g,$Q,$d=[],$r=0;$r<$v.length;$r++)$Q=$v[$r],($g=new $p).graphics.drawRect(0,0,$Q.width,$Q.height,"#ff0000"),$g.width=$Q.width,$g.height=$Q.height,this.addChild($g),$d.push($g)},$v._layoutLater=function(){var $v=this.style;512&$v._type||($v.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$v.block?($A.later(this),$v._type|=512):this.parent&&this.parent._layoutLater())},$v._setAttributes=function($v,$g){switch($v){case"style":return void this.style.cssText($g);case"class":return void(this.className=$g)}$Q.prototype._setAttributes.call(this,$v,$g)},$v.updateHref=function(){if(null!=this._href){var $v=this._getWords();if($v)for(var $g,$Q,$d=0;$d<$v.length;$d++)($Q=($g=$v[$d]).getSprite())&&($Q.size($g.width,$g.height),$Q.on("click",this,this.onLinkHandler))}},$v.onLinkHandler=function($v){switch($v.type){case"click":for(var $g=this;$g;)$g.event("link",[this.href]),$g=$g.parent}},$v.formatURL=function($v){return this.URI?$C.formatURL($v,this.URI?this.URI.path:null):$v},$b(0,$v,"href",function(){return this._href},function($v){null!=(this._href=$v)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$b(0,$v,"color",null,function($v){this.style.color=$v}),$b(0,$v,"onClick",null,function($v){$d._runScript("fn=function(event){"+$v+";}"),this.on("click",this,void 0)}),$b(0,$v,"id",null,function($v){$P.document.setElementById($v,this)}),$b(0,$v,"innerTEXT",function(){return this._text.text},function($v){this.text=$v}),$b(0,$v,"style",function(){return this._style}),$b(0,$v,"text",function(){return this._text.text},function($v){this._text==$g._EMPTYTEXT?this._text={text:$v,words:null}:(this._text.text=$v,this._text.words&&(this._text.words.length=0)),$J.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$b(0,$v,"parent",$Q.prototype._$get_parent,function($v){if($v instanceof laya.html.dom.HTMLElement){var $g=$v;this.URI||(this.URI=$g.URI),this.style.inherit($g.style)}$d.superSet($p,this,"parent",$v)}),$b(0,$v,"className",null,function($v){this.style.attrs($P.document.styleSheets["."+$v])}),$g.fillWords=function($v,$g,$Q,$d,$r,$k,$$){$v.graphics.clear();for(var $b=0,$a=$g.length;$b<$a;$b++){var $M=$g[$b];$v.graphics.fillText($M.char,$M.x+$Q,$M.y+$d,$r,$k,"left",$$)}},$g._EMPTYTEXT={text:null,words:null},$g}($p),$g=(function($v){function $g(){$g.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$$($g,"laya.html.dom.HTMLBrElement",$h)}(),function($v){function $g(){this.contextHeight=NaN,this.contextWidth=NaN,$g.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$$($g,"laya.html.dom.HTMLDivElement",$v);var $Q=$g.prototype;return $Q.appendHTML=function($v){$s.parse(this,$v,this.URI),this.layout()},$Q._addChildsToLayout=function($g){var $v=this._getWords();if(null==$v&&0==this._childs.length)return!1;$v&&$v.forEach(function($v){$g.push($v)});for(var $Q=!0,$d=0,$r=this._childs.length;$d<$r;$d++){var $k=this._childs[$d];$Q?$Q=!1:$g.push(null),$k._addToLayout($g)}return!0},$Q._addToLayout=function($v){this.layout()},$Q.layout=function(){if(this.style){this.style._type|=512;var $v=$A.layout(this);if($v){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $Y);var $g=this._$P.mHtmlBounds;$g.x=$g.y=0,$g.width=this.contextWidth=$v[0],$g.height=this.contextHeight=$v[1],this.setBounds($g)}}},$b(0,$Q,"height",function(){return this._height?this._height:this.contextHeight},$v.prototype._$set_height),$b(0,$Q,"innerHTML",null,function($v){this.destroyChildren(),this.appendHTML($v)}),$b(0,$Q,"width",function(){return this._width?this._width:this.contextWidth},function($v){var $g=!1;$g=0===$v?$v!=this._width:$v!=this.width,$d.superSet($h,this,"width",$v),$g&&this.layout()}),$g}($h)),$P=function($v){function $g(){this.all=new Array,this.styleSheets=$a.styleSheets,$g.__super.call(this)}$$($g,"laya.html.dom.HTMLDocument",$h);var $Q=$g.prototype;return $Q.getElementById=function($v){return this.all[$v]},$Q.setElementById=function($v,$g){this.all[$v]=$g},$r($g,["document",function(){return this.document=new $g}]),$g}();(function($v){function $g(){this._tex=null,this._url=null,this._renderArgs=[],$g.__super.call(this),this.style.block=!0}$$($g,"laya.html.dom.HTMLImageElement",$h);var $Q=$g.prototype;$Q._addToLayout=function($v){!this._style.absolute&&$v.push(this)},$Q.render=function($v,$g,$Q){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($t.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$v.ctx.drawTexture2($g,$Q,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$Q.layaoutCallNative=function(){var $v=0;if(this._childs&&0<($v=this._childs.length))for(var $g=0;$g<$v;$g++)this._childs[$g].layaoutCallNative&&this._childs[$g].layaoutCallNative()},$b(0,$Q,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($v){this._width!==$v&&(this._width=$v,this._style.width=$v,this.repaint())}),$b(0,$Q,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($v){this._height!==$v&&(this._height=$v,this._style.height=$v,this.repaint())}),$Q.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$M.clearCache(this,this._url),this._tex=null),$h.prototype.destroy.call(this)},$Q.onloaded=function(){var $v=this._style;$v&&!$v.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$v&&!$v.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$J.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$Q._loadImageComplete=function($v,$g,$Q){if(!this._destroyed)if(null!=$Q)if($Q instanceof ArrayBuffer){var $d=new DataView($Q);new laya.webgl.resource.WebGLImage(new Uint8Array($Q,8),$v,0,!1,$d.getUint32(0),$d.getUint32(4));this.onloaded()}else if($Q instanceof $q)$M.imgMgrSet[$v]=$g,$k.imgMgrLock($v,$M.imgMgrSet[$v]),this._url=$v,this._tex=$Q,$M.keepCache(this,$v),$M.cacheRes($v,this._tex),this.onloaded();else{var $r=-1!=$v.indexOf(".png",$v.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($Q,$v,$r,!1,$Q.width,$Q.height);this.onloaded()}else this.event("error","Load image failed")},$b(0,$Q,"src",null,function($v){($v=this.formatURL($v),this._url!=$v)&&(null!=this._tex&&($M.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$v,(this._tex=$M.getRes($v))?($M.keepCache(this,$v),this.onloaded()):$k.imgMgrLoad($v,this._loadImageComplete.bind(this),2,!1))})})(),function($v){function $g(){this.type=null,$g.__super.call(this),this.visible=!1}$$($g,"laya.html.dom.HTMLLinkElement",$v);var $Q=$g.prototype;$Q._onload=function($v){switch(this.type){case"text/css":$a.parseCSS($v,this.URI)}},$b(0,$Q,"href",$v.prototype._$get_href,function($v){var $g=this;$v=this.formatURL($v),this.URI=new $C($v);var $Q=new $M;$Q.once("complete",null,function($v){$g._onload($v)}),$Q.load($v,"text")}),$g._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($h),function($v){function $g(){$g.__super.call(this),this.visible=!1}$$($g,"laya.html.dom.HTMLStyleElement",$v),$b(0,$g.prototype,"text",$v.prototype._$get_text,function($v){$a.parseCSS($v,null)})}($h),function($v){function $g(){$g.__super.call(this),this._getCSSStyle().valign="middle"}$$($g,"laya.html.dom.HTMLIframeElement",$v),$b(0,$g.prototype,"href",$v.prototype._$get_href,function($Q){var $d=this;$Q=this.formatURL($Q);var $v=new $M;$v.once("complete",null,function($v){var $g=$d.URI;$d.URI=new $C($Q),$d.innerHTML=$v,!$g||($d.URI=$g)}),$v.load($Q,"text")})}($g)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($v,$g){"use strict";for(var $Q in Object.defineProperty($g,"__esModule",{value:!0}),Laya){var $d=Laya[$Q];$d&&$d.__isclass&&($g[$Q]=$d)}}),function($r,$v,$t){$t.un,$t.uns;var $d=$t.static,$k=$t.class,$$=$t.getset,$Q=($t.__newvec,laya.display.Animation),$q=(laya.utils.Browser,laya.utils.ClassUtils),$b=laya.filters.ColorFilter,$a=laya.utils.Ease,$M=laya.events.Event,$Y=(laya.events.EventDispatcher,laya.display.css.Font),$D=laya.display.FrameAnimation,$g=laya.display.Graphics,$J=laya.utils.Handler,$p=laya.display.Input,$G=laya.net.Loader,$T=(laya.display.Node,laya.maths.Point),$C=laya.maths.Rectangle,$s=laya.renders.Render,$A=laya.display.Sprite,$h=laya.display.Text,$P=laya.resource.Texture,$W=laya.utils.Tween,$F=laya.utils.Utils,$l=laya.utils.WeakObject;$t.interface("laya.ui.IItem"),$t.interface("laya.ui.ISelect"),$t.interface("laya.ui.IRender"),$t.interface("laya.ui.IComponent"),$t.interface("laya.ui.IBox","IComponent");var $o=function(){function $v(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $k($v,"laya.ui.LayoutStyle"),$d($v,["EMPTY",function(){return this.EMPTY=new $v}]),$v}(),$E=function(){function $v(){}return $k($v,"laya.ui.Styles"),$v.labelColor="#000000",$v.buttonStateNum=3,$v.scrollBarMinNum=15,$v.scrollBarDelayTime=500,$d($v,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$v}(),$V=function(){function $r(){}return $k($r,"laya.ui.UIUtils"),$r.fillArray=function($v,$g,$Q){var $d=$v.concat();if($g)for(var $r=$g.split(","),$k=0,$$=Math.min($d.length,$r.length);$k<$$;$k++){var $b=$r[$k];$d[$k]="true"==$b||"false"!=$b&&$b,null!=$Q&&($d[$k]=$Q($b))}return $d},$r.toColor=function($v){return $F.toHexColor($v)},$r.gray=function($v,$g){void 0===$g&&($g=!0),$g?$r.addFilter($v,$r.grayFilter):$r.clearFilter($v,$b)},$r.addFilter=function($v,$g){var $Q=$v.filters||[];$Q.push($g),$v.filters=$Q},$r.clearFilter=function($v,$g){var $Q=$v.filters;if(null!=$Q&&0<$Q.length){for(var $d=$Q.length-1;-1<$d;$d--){var $r=$Q[$d];$t.__typeof($r,$g)&&$Q.splice($d,1)}$v.filters=$Q}},$r._getReplaceStr=function($v){return $r.escapeSequence[$v]},$r.adptString=function($v){return $v.replace(/\\(\w)/g,$r._getReplaceStr)},$r.getBindFun=function($v){var $g=$r._funMap.get($v);if(null==$g){var $Q='"'+$v+'"',$d="(function(data){if(data==null)return;with(data){try{\nreturn "+($Q=$Q.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$g=$t._runScript($d),$r._funMap.set($v,$g)}return $g},$d($r,["grayFilter",function(){return this.grayFilter=new $b([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $l}]),$r}(),$Z=function(){function $v(){}return $k($v,"UIConfig"),$v.touchScrollEnable=!0,$v.mouseWheelEnable=!0,$v.showButtons=!0,$v.popupBgColor="#000000",$v.popupBgAlpha=.5,$v.closeDialogOnSide=!0,$v}(),$f=function($Q){function $C(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$C.__super.call(this),this._weakKeys=[]}$k($C,"laya.ui.AutoBitmap",$Q);var $v=$C.prototype;return $v.destroy=function(){if($G.clearObject(this,this._weakKey),this._weakKeys){for(var $v=0,$g=this._weakKeys.length;$v<$g;++$v)$G.clearObject(this,this._weakKeys[$v]);this._weakKeys=null}$Q.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$v._setChanged=function(){this._isChanged||(this._isChanged=!0,$t.timer.callLater(this,this.changeSource))},$v.changeSource=function(){this._isChanged=!1;var $v=this._source;if($v&&$v.bitmap){var $g=this.width,$Q=this.height,$d=this._sizeGrid,$r=$v.sourceWidth,$k=$v.sourceHeight;if(!$d||$r===$g&&$k===$Q)this.cleanByTexture($v,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$g,$Q);else{$G.clearObject(this,this._weakKey),$v.$_GID||($v.$_GID=$F.getGID());var $$=$v.$_GID+"."+$g+"."+$Q+"."+$d.join("."),$b=$G.findObject($$);if($F.isOKCmdList($b))return this._weakKey=$$,$G.keepObject(this,this._weakKey),void(this.cmds=$b);this.clear();var $a,$M,$Y=$d[0],$D=$d[1],$J=$d[2],$p=$d[3],$T=$d[4],$t=!1;if($g==$r&&($p=$D=0),$Q==$k&&($Y=$J=0),$g<$p+$D){var $q=$g;$t=!0,$g=$p+$D,this.save(),this.clipRect(0,0,$q,$Q)}$p&&$Y&&($a=$C.getTexture($v,0,0,$p,$Y),$M=this._weakKeys[0],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[0]=$a.weakKey),this.drawTexture($a,0,0,$p,$Y)):($G.clearObject(this,$M),this._weakKeys[0]="")),$D&&$Y&&($a=$C.getTexture($v,$r-$D,0,$D,$Y),$M=this._weakKeys[1],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[1]=$a.weakKey),this.drawTexture($a,$g-$D,0,$D,$Y)):($G.clearObject(this,$M),this._weakKeys[1]="")),$p&&$J&&($a=$C.getTexture($v,0,$k-$J,$p,$J),$M=this._weakKeys[2],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[2]=$a.weakKey),this.drawTexture($a,0,$Q-$J,$p,$J)):($G.clearObject(this,$M),this._weakKeys[2]="")),$D&&$J&&($a=$C.getTexture($v,$r-$D,$k-$J,$D,$J),$M=this._weakKeys[3],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[3]=$a.weakKey),this.drawTexture($a,$g-$D,$Q-$J,$D,$J)):($G.clearObject(this,$M),this._weakKeys[3]="")),$Y&&($a=$C.getTexture($v,$p,0,$r-$p-$D,$Y),$M=this._weakKeys[4],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[4]=$a.weakKey),this.drawBitmap($T,$a,$p,0,$g-$p-$D,$Y)):($G.clearObject(this,$M),this._weakKeys[4]="")),$J&&($a=$C.getTexture($v,$p,$k-$J,$r-$p-$D,$J),$M=this._weakKeys[5],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[5]=$a.weakKey),this.drawBitmap($T,$a,$p,$Q-$J,$g-$p-$D,$J)):($G.clearObject(this,$M),this._weakKeys[5]="")),$p&&($a=$C.getTexture($v,0,$Y,$p,$k-$Y-$J),$M=this._weakKeys[6],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[6]=$a.weakKey),this.drawBitmap($T,$a,0,$Y,$p,$Q-$Y-$J)):($G.clearObject(this,$M),this._weakKeys[6]="")),$D&&($a=$C.getTexture($v,$r-$D,$Y,$D,$k-$Y-$J),$M=this._weakKeys[7],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[7]=$a.weakKey),this.drawBitmap($T,$a,$g-$D,$Y,$D,$Q-$Y-$J)):($G.clearObject(this,$M),this._weakKeys[7]="")),$a=$C.getTexture($v,$p,$Y,$r-$p-$D,$k-$Y-$J),$M=this._weakKeys[8],$a?($M!=$a.weakKey&&($G.clearObject(this,$M),$G.keepObject(this,$a.weakKey),this._weakKeys[8]=$a.weakKey),this.drawBitmap($T,$a,$p,$Y,$g-$p-$D,$Q-$Y-$J)):($G.clearObject(this,$M),this._weakKeys[8]=""),$t&&this.restore(),this.autoCacheCmd&&!$s.isConchApp&&($G.saveObject($$,this.cmds,null),this._weakKey=$$,$G.keepObject(this,this._weakKey))}this._repaint()}},$v.drawBitmap=function($v,$g,$Q,$d,$r,$k){void 0===$r&&($r=0),void 0===$k&&($k=0),$r<.1||$k<.1||(!$v||$g.width==$r&&$g.height==$k?this.drawTexture($g,$Q,$d,$r,$k):this.fillTexture($g,$Q,$d,$r,$k))},$v.clear=function($v){void 0===$v&&($v=!0),$Q.prototype.clear.call(this,!1)},$$(0,$v,"sizeGrid",function(){return this._sizeGrid},function($v){this._sizeGrid=$v,this._setChanged()}),$$(0,$v,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($v){this._width!=$v&&(this._width=$v,this._setChanged())}),$$(0,$v,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($v){this._height!=$v&&(this._height=$v,this._setChanged())}),$$(0,$v,"source",function(){return this._source},function($v){$v?(this._source=$v,this._setChanged()):(this._source=null,this.clear())}),$C.getTexture=function($v,$g,$Q,$d,$r){$d<=0&&($d=1),$r<=0&&($r=1),$v.$_GID||($v.$_GID=$F.getGID());var $k=$v.$_GID+"."+$g+"."+$Q+"."+$d+"."+$r,$$=$G.findObject($k);if((!$$||!$$.source)&&($$=$P.createFromTexture($v,$g,$Q,$d,$r))){if($v.alphaTexture){var $b=$v.width/$v.alphaTexture.width;$$.alphaTexture=$P.createFromTexture($v.alphaTexture,$g/$b,$Q/$b,$d/$b,$r/$b)}$G.saveObject($k,$$),$$.weakKey=$k}return $$},$C}($g),$X=(function($v){function $g(){$g.__super.call(this)}$k($g,"laya.ui.UIEvent",$M),$g.SHOW_TIP="showtip",$g.HIDE_TIP="hidetip"}(),function($g){function $v(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$v.__super.call(this),this._layout=$o.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$k($v,"laya.ui.Component",$g);var $Q=$v.prototype;return $t.imps($Q,{"laya.ui.IComponent":!0}),$Q.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$Q.preinitialize=function(){},$Q.createChildren=function(){},$Q.initialize=function(){},$Q.callLater=function($v,$g){$t.timer.callLater(this,$v,$g)},$Q.runCallLater=function($v){$t.timer.runCallLater(this,$v)},$Q.commitMeasure=function(){},$Q.changeSize=function(){this.event("resize")},$Q.getLayout=function(){return this._layout===$o.EMPTY&&(this._layout=new $o),this._layout},$Q._setLayoutEnabled=function($v){this._layout&&this._layout.enable!=$v&&(this._layout.enable=$v,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$Q.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$Q.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$Q.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$Q.resetLayoutX=function(){var $v=this._layout;if(isNaN($v.anchorX)||(this.pivotX=$v.anchorX*this.width),this.layoutEnabled){var $g=this.parent;$g&&(isNaN($v.centerX)?isNaN($v.left)?isNaN($v.right)||(this.x=Math.round($g.width-this.displayWidth-$v.right+this.pivotX*this.scaleX)):(this.x=Math.round($v.left+this.pivotX*this.scaleX),isNaN($v.right)||(this.width=($g._width-$v.left-$v.right)/(this.scaleX||.01))):this.x=Math.round(.5*($g.width-this.displayWidth)+$v.centerX+this.pivotX*this.scaleX))}},$Q.resetLayoutY=function(){var $v=this._layout;if(isNaN($v.anchorY)||(this.pivotY=$v.anchorY*this.height),this.layoutEnabled){var $g=this.parent;$g&&(isNaN($v.centerY)?isNaN($v.top)?isNaN($v.bottom)||(this.y=Math.round($g.height-this.displayHeight-$v.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($v.top+this.pivotY*this.scaleY),isNaN($v.bottom)||(this.height=($g._height-$v.top-$v.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($g.height-this.displayHeight)+$v.centerY+this.pivotY*this.scaleY))}},$Q.onMouseOver=function($v){$t.stage.event("showtip",this._toolTip)},$Q.onMouseOut=function($v){$t.stage.event("hidetip",this._toolTip)},$$(0,$Q,"displayWidth",function(){return this.width*this.scaleX}),$$(0,$Q,"width",function(){return this._width?this._width:this.measureWidth},function($v){this._width!=$v&&(this._width=$v,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$$(0,$Q,"measureWidth",function(){var $v=0;this.commitMeasure();for(var $g=this.numChildren-1;-1<$g;$g--){var $Q=this.getChildAt($g);$Q.visible&&($v=Math.max($Q.x+$Q.width*$Q.scaleX,$v))}return $v}),$$(0,$Q,"displayHeight",function(){return this.height*this.scaleY}),$$(0,$Q,"height",function(){return this._height?this._height:this.measureHeight},function($v){this._height!=$v&&(this._height=$v,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$$(0,$Q,"dataSource",function(){return this._dataSource},function($v){for(var $g in this._dataSource=$v,this._dataSource)this.hasOwnProperty($g)&&"function"!=typeof this[$g]&&(this[$g]=this._dataSource[$g])}),$$(0,$Q,"scaleY",$g.prototype._$get_scaleY,function($v){$t.superGet($A,this,"scaleY")!=$v&&($t.superSet($A,this,"scaleY",$v),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$$(0,$Q,"measureHeight",function(){var $v=0;this.commitMeasure();for(var $g=this.numChildren-1;-1<$g;$g--){var $Q=this.getChildAt($g);$Q.visible&&($v=Math.max($Q.y+$Q.height*$Q.scaleY,$v))}return $v}),$$(0,$Q,"scaleX",$g.prototype._$get_scaleX,function($v){$t.superGet($A,this,"scaleX")!=$v&&($t.superSet($A,this,"scaleX",$v),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$$(0,$Q,"top",function(){return this._layout.top},function($v){$v!=this._layout.top&&(this.getLayout().top=$v,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$$(0,$Q,"bottom",function(){return this._layout.bottom},function($v){$v!=this._layout.bottom&&(this.getLayout().bottom=$v,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$$(0,$Q,"left",function(){return this._layout.left},function($v){$v!=this._layout.left&&(this.getLayout().left=$v,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$$(0,$Q,"right",function(){return this._layout.right},function($v){$v!=this._layout.right&&(this.getLayout().right=$v,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$$(0,$Q,"centerX",function(){return this._layout.centerX},function($v){$v!=this._layout.centerX&&(this.getLayout().centerX=$v,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$$(0,$Q,"centerY",function(){return this._layout.centerY},function($v){$v!=this._layout.centerY&&(this.getLayout().centerY=$v,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$$(0,$Q,"anchorX",function(){return this._layout.anchorX},function($v){$v!=this._layout.anchorX&&(this.getLayout().anchorX=$v,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$$(0,$Q,"anchorY",function(){return this._layout.anchorY},function($v){$v!=this._layout.anchorY&&(this.getLayout().anchorY=$v,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$$(0,$Q,"tag",function(){return this._tag},function($v){this._tag=$v}),$$(0,$Q,"toolTip",function(){return this._toolTip},function($v){this._toolTip!=$v&&(null!=(this._toolTip=$v)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$$(0,$Q,"comXml",function(){return this._comXml},function($v){this._comXml=$v}),$$(0,$Q,"gray",function(){return this._gray},function($v){$v!==this._gray&&(this._gray=$v,$V.gray(this,$v))}),$$(0,$Q,"disabled",function(){return this._disabled},function($v){$v!==this._disabled&&(this.gray=this._disabled=$v,this.mouseEnabled=!$v)}),$v}($A)),$N=function($v){function $g(){this.lockLayer=null,this.popupEffect=function($v){$v.scale(1,1),$W.from($v,{x:$t.stage.width/2,y:$t.stage.height/2,scaleX:0,scaleY:0},300,$a.backOut,$J.create(this,this.doOpen,[$v]))},this.closeEffect=function($v,$g){$W.to($v,{x:$t.stage.width/2,y:$t.stage.height/2,scaleX:0,scaleY:0},300,$a.strongOut,$J.create(this,this.doClose,[$v,$g]))},$g.__super.call(this),this.maskLayer=new $A,this.popupEffectHandler=$J.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$J.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$t.stage.addChild(this),$t.stage.on("resize",this,this._onResize),$Z.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$k($g,"laya.ui.DialogManager",$A);var $Q=$g.prototype;return $Q._closeOnSide=function(){var $v=this.getChildAt(this.numChildren-1);$v instanceof laya.ui.Dialog&&$v.close("side")},$Q.setLockView=function($v){this.lockLayer||(this.lockLayer=new $i,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($t.stage.width,$t.stage.height)),this.lockLayer.removeChildren(),$v&&($v.centerX=$v.centerY=0,this.lockLayer.addChild($v))},$Q._onResize=function($v){var $g=this.maskLayer.width=$t.stage.width,$Q=this.maskLayer.height=$t.stage.height;this.lockLayer&&this.lockLayer.size($g,$Q),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$g,$Q,$Z.popupBgColor),this.maskLayer.alpha=$Z.popupBgAlpha;for(var $d=this.numChildren-1;-1<$d;$d--){var $r=this.getChildAt($d);$r.popupCenter&&this._centerDialog($r)}},$Q._centerDialog=function($v){$v.x=Math.round(($t.stage.width-$v.width>>1)+$v.pivotX),$v.y=Math.round(($t.stage.height-$v.height>>1)+$v.pivotY)},$Q.open=function($v,$g,$Q){void 0===$g&&($g=!1),void 0===$Q&&($Q=!1),$g&&this._closeAll(),$v.popupCenter&&this._centerDialog($v),this.addChild($v),($v.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$Q&&null!=$v.popupEffect?$v.popupEffect.runWith($v):this.doOpen($v),this.event("open")},$Q.doOpen=function($v){$v.onOpened()},$Q.lock=function($v){this.lockLayer&&($v?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$Q.close=function($v,$g,$Q){void 0===$Q&&($Q=!1),$Q&&null!=$v.closeEffect?$v.closeEffect.runWith([$v,$g]):this.doClose($v,$g),this.event("close")},$Q.doClose=function($v,$g){$v.removeSelf(),$v.isModal&&this._checkMask(),$v.closeHandler&&$v.closeHandler.runWith($g),$v.onClosed($g)},$Q.closeAll=function(){this._closeAll(),this.event("close")},$Q._closeAll=function(){for(var $v=this.numChildren-1;-1<$v;$v--){var $g=this.getChildAt($v);$g&&null!=$g.close&&this.doClose($g)}},$Q.getDialogsByGroup=function($v){for(var $g=[],$Q=this.numChildren-1;-1<$Q;$Q--){var $d=this.getChildAt($Q);$d&&$d.group===$v&&$g.push($d)}return $g},$Q.closeByGroup=function($v){for(var $g=[],$Q=this.numChildren-1;-1<$Q;$Q--){var $d=this.getChildAt($Q);$d&&$d.group===$v&&($d.close(),$g.push($d))}return $g},$Q._checkMask=function(){this.maskLayer.removeSelf();for(var $v=this.numChildren-1;-1<$v;$v--){var $g=this.getChildAt($v);if($g&&$g.isModal)return void this.addChildAt(this.maskLayer,$v)}},$g}(),$i=function($v){function $g(){$g.__super.call(this)}$k($g,"laya.ui.Box",$v);var $Q=$g.prototype;return $t.imps($Q,{"laya.ui.IBox":!0}),$$(0,$Q,"dataSource",$v.prototype._$get_dataSource,function($v){for(var $g in this._dataSource=$v){var $Q=this.getChildByName($g);$Q?$Q.dataSource=$v[$g]:this.hasOwnProperty($g)&&"function"!=typeof this[$g]&&(this[$g]=$v[$g])}}),$g}($X),$x=function($g){function $Q($v,$g){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$Q.__super.call(this),this._labelColors=$E.buttonLabelColors,this._stateNum=$E.buttonStateNum,void 0===$g&&($g=""),this.skin=$v,this.label=$g}$k($Q,"laya.ui.Button",$g);var $v=$Q.prototype;return $t.imps($v,{"laya.ui.ISelect":!0}),$v.destroy=function($v){this.clearEvent(),$G.clearCache(this,this._skin),$G.clearObject(this,this._weakKey),void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($v),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$v.clearEvent=function(){this._skin&&$r.atalsNotify&&$r.atalsNotify.off(this._skin,this,this._setBtnSource)},$v.createChildren=function(){this.graphics=this._bitmap=new $f},$v.createText=function(){this._text||(this._text=new $h,this._text.overflow=$h.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$v.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$v.onMouse=function($v){if(!1!==this.toggle||!this._selected)return"click"===$v.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$Q.stateMap[$v.type]))},$v.changeClips=function(){var $v=$G.getRes(this._skin);if($v)if(this._skin&&""!=this._skin){$G.clearObject(this,this._weakKey);var $g=$v.sourceWidth,$Q=$v.sourceHeight/this._stateNum;$v.$_GID||($v.$_GID=$F.getGID());var $d=$v.$_GID+"-"+this._stateNum,$r=$G.findObject($d);if($F.isOkTextureList($r)||($r=null),$r)this._weakKey=$d,$G.keepObject(this,this._weakKey),this._sources=$r;else{if(this._sources=[],1===this._stateNum)this._sources.push($v);else for(var $k=0;$k<this._stateNum;$k++){var $$=$P.createFromTexture($v,0,$Q*$k,$g,$Q);if($v.alphaTexture){var $b=$v.width/$v.alphaTexture.width;$$.alphaTexture=$P.createFromTexture($v.alphaTexture,0/$b,$Q*$k/$b,$g/$b,$Q/$b)}this._sources.push($$)}$G.saveObject($d,this._sources),this._weakKey=$d,$G.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$g,this._bitmap.height=this._height||$Q,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$g)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$v.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $v=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$v]),this.label&&(this._text.color=this._labelColors[$v],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$v]))},$v._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$$(0,$v,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($v){this.createText(),this._text.strokeColor=$v}),$$(0,$v,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$$(0,$v,"skin",function(){return this._skin},function($v){if(this._skin!=$v)if(this.clearEvent(),$G.clearCache(this,this._skin),this._skin=$v,$G.keepCache(this,this._skin),$G.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $g=$r.resAtalsObj&&$r.resAtalsObj[this._skin];$g?($r.atalsNotify&&$r.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$g.sourceW),0==this.height&&(this.height=$g.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$v._setBtnSource=function($v,$g){$v===this._skin&&$g&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$$(0,$v,"state",function(){return this._state},function($v){this._state!=$v&&(this._state=$v,this._setStateChanged())}),$$(0,$v,"text",function(){return this.createText(),this._text}),$$(0,$v,"stateNum",function(){return this._stateNum},function($v){"string"==typeof $v&&($v=parseInt($v)),this._stateNum!=$v&&(this._stateNum=$v<1?1:3<$v?3:$v,this.callLater(this.changeClips))}),$$(0,$v,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($v){this._strokeColors=$V.fillArray($E.buttonLabelColors,$v,String),this._setStateChanged()}),$$(0,$v,"labelColors",function(){return this._labelColors.join(",")},function($v){this._labelColors=$V.fillArray($E.buttonLabelColors,$v,String),this._setStateChanged()}),$$(0,$v,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$$(0,$v,"label",function(){return this._text?this._text.text:null},function($v){(this._text||$v)&&(this.createText(),this._text.text!=$v&&($v&&!this._text.parent&&this.addChild(this._text),this._text.text=($v+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$$(0,$v,"selected",function(){return this._selected},function($v){this._selected!=$v&&(this._selected=$v,this.state=this._selected?2:0,this.event("change"))}),$$(0,$v,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($v){this.createText(),this._text.padding=$V.fillArray($E.labelPadding,$v,Number)}),$$(0,$v,"labelSize",function(){return this.createText(),this._text.fontSize},function($v){this.createText(),this._text.fontSize=$v}),$$(0,$v,"labelStroke",function(){return this.createText(),this._text.stroke},function($v){this.createText(),this._text.stroke=$v}),$$(0,$v,"labelBold",function(){return this.createText(),this._text.bold},function($v){this.createText(),this._text.bold=$v}),$$(0,$v,"labelFont",function(){return this.createText(),this._text.font},function($v){this.createText(),this._text.font=$v}),$$(0,$v,"labelAlign",function(){return this.createText(),this._text.align},function($v){this.createText(),this._text.align=$v}),$$(0,$v,"clickHandler",function(){return this._clickHandler},function($v){this._clickHandler=$v}),$$(0,$v,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($v){this._bitmap.sizeGrid=$V.fillArray($E.defaultSizeGrid,$v,Number)}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($X,this,"width",$v),this._autoSize&&(this._bitmap.width=$v,this._text&&(this._text.width=$v))}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($X,this,"height",$v),this._autoSize&&(this._bitmap.height=$v,this._text&&(this._text.height=$v))}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)||"string"==typeof $v?this.label=$v+"":$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($v){this._bitmap._offset=$v?$V.fillArray([1,1],$v,Number):[]}),$d($Q,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$Q}($X),$w=function($g){function $d($v,$g,$Q){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$d.__super.call(this),void 0===$g&&($g=1),void 0===$Q&&($Q=1),this._clipX=$g,this._clipY=$Q,this.skin=$v}$k($d,"laya.ui.Clip",$g);var $v=$d.prototype;return $v.destroy=function($v){this.clearEvent(),this.clearLoad(),$G.clearCache(this,this._skin),$G.clearObject(this,this._weakKey),void 0===$v&&($v=!0),$g.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$v.dispose=function(){this.destroy(!0),$t.loader.clearRes(this._skin)},$v.createChildren=function(){this.graphics=this._bitmap=new $f},$v._onDisplay=function($v){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$v.changeClip=function(){if(this._clipChanged=!1,this._skin){var $v=$G.getRes(this._skin);if($v)this.loadComplete(this._skin,$v);else{if($r.resAtalsObj&&$r.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$J.create(this,this.loadComplete,[this._skin]),this._progress=null,$t.loader.load(this._skin,this._complete,this._progress)}}},$v.loadComplete=function($v,$g){if($v===this._skin&&$g){$G.clearObject(this,this._weakKey);var $Q=this._clipWidth||Math.ceil($g.sourceWidth/this._clipX),$d=this._clipHeight||Math.ceil($g.sourceHeight/this._clipY),$r=this._skin+$Q+$d,$k=$G.findObject($r);if($F.isOkTextureList($k)||($k=null),$k)this._weakKey=$r,$G.keepObject(this,this._weakKey),this._sources=$k;else{this._sources=[];for(var $$=0;$$<this._clipY;$$++)for(var $b=0;$b<this._clipX;$b++){var $a=$P.createFromTexture($g,$Q*$b,$d*$$,$Q,$d);if($g.alphaTexture){var $M=$g.width/$g.alphaTexture.width;$a.alphaTexture=$P.createFromTexture($g.alphaTexture,$Q*$b/$M,$d*$$/$M,$Q/$M,$d/$M)}this._sources.push($a)}$G.saveObject($r,this._sources),this._weakKey=$r,$G.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$v.play=function($v,$g){void 0===$v&&($v=0),void 0===$g&&($g=-1),this._isPlaying=!0,this.index=$v,this._toIndex=$g,this._index++,$t.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$v._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$v.stop=function(){this._isPlaying=!1,$t.timer.clear(this,this._loop),this.event("complete")},$v._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$$(0,$v,"interval",function(){return this._interval},function($v){this._interval!=$v&&(this._interval=$v,this._isPlaying&&this.play())}),$v.clearEvent=function(){this._skin&&$r.atalsNotify&&$r.atalsNotify.off(this._skin,this,this._setBtnSource)},$v.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$t.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$$(0,$v,"skin",function(){return this._skin},function($v){if(this._skin!=$v)if(this.clearLoad(),this.clearEvent(),$G.clearCache(this,this._skin),this._skin=$v){$G.keepCache(this,this._skin);var $g=$G.getRes($v),$Q=$r.resAtalsObj&&$r.resAtalsObj[this._skin];!$g&&$Q?$r.atalsNotify&&$r.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$v._setBtnSource=function($v,$g){$v===this._skin&&$g&&(this.loadComplete($v,$g),this.clearEvent())},$$(0,$v,"sources",function(){return this._sources},function($v){this._sources=$v,this.index=this._index,this.event("loaded")}),$$(0,$v,"clipX",function(){return this._clipX},function($v){this._clipX=$v||1,this._setClipChanged()}),$$(0,$v,"clipY",function(){return this._clipY},function($v){this._clipY=$v||1,this._setClipChanged()}),$$(0,$v,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$$(0,$v,"clipWidth",function(){return this._clipWidth},function($v){this._clipWidth=$v,this._setClipChanged()}),$$(0,$v,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($v){this._bitmap.sizeGrid=$V.fillArray($E.defaultSizeGrid,$v,Number)}),$$(0,$v,"group",function(){return this._group},function($v){$v&&this._skin&&$G.setGroup(this._skin,$v),this._group=$v}),$$(0,$v,"clipHeight",function(){return this._clipHeight},function($v){this._clipHeight=$v,this._setClipChanged()}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($X,this,"width",$v),this._bitmap.width=$v}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($X,this,"height",$v),this._bitmap.height=$v}),$$(0,$v,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$$(0,$v,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$$(0,$v,"index",function(){return this._index},function($v){this._index=$v,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$v]),this.event("change")}),$$(0,$v,"autoPlay",function(){return this._autoPlay},function($v){this._autoPlay!=$v&&((this._autoPlay=$v)?this.play():this.stop())}),$$(0,$v,"isPlaying",function(){return this._isPlaying},function($v){this._isPlaying=$v}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)&&Math.floor($v)==$v||"string"==typeof $v?this.index=parseInt($v):$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"bitmap",function(){return this._bitmap}),$d}($X),$m=function($g){function $v(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$v.__super.call(this)}$k($v,"laya.ui.ColorPicker",$g);var $Q=$v.prototype;return $Q.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._colorPanel&&this._colorPanel.destroy($v),this._colorButton&&this._colorButton.destroy($v),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$Q.createChildren=function(){this.addChild(this._colorButton=new $x),this._colorPanel=new $i,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $A),this._colorPanel.addChild(this._colorBlock=new $A),this._colorPanel.addChild(this._colorInput=new $p)},$Q.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$Q.onPanelMouseDown=function($v){$v.stopPropagation()},$Q.changePanel=function(){this._panelChanged=!1;var $v=this._colorPanel.graphics;$v.clear(),$v.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($v=this._colorTiles.graphics).clear();for(var $g=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$Q=0;$Q<12;$Q++)for(var $d=0;$d<20;$d++){var $r=0;$r=0===$d?$g[$Q]:1===$d?0:51*(((3*$Q+$d/6)%3<<0)+3*($Q/6<<0))<<16|$d%6*51<<8|($Q<<0)%6*51;var $k=$V.toColor($r);this._colors.push($k);var $$=$d*this._gridSize,$b=$Q*this._gridSize;$v.drawRect($$,$b,this._gridSize,this._gridSize,$k,"#000000")}},$Q.onColorButtonClick=function($v){this._colorPanel.parent?this.close():this.open()},$Q.open=function(){var $v=this.localToGlobal(new $T),$g=$v.x+this._colorPanel.width<=$t.stage.width?$v.x:$t.stage.width-this._colorPanel.width,$Q=$v.y+this._colorButton.height;$Q=$Q+this._colorPanel.height<=$t.stage.height?$Q:$v.y-this._colorPanel.height,this._colorPanel.pos($g,$Q),this._colorPanel.zOrder=1001,$t._currentStage.addChild(this._colorPanel),$t.stage.on("mousedown",this,this.removeColorBox)},$Q.close=function(){$t.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$Q.removeColorBox=function($v){this.close()},$Q.onColorFieldKeyDown=function($v){13==$v.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$v.stopPropagation())},$Q.onColorInputChange=function($v){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$Q.onColorTilesClick=function($v){this.selectedColor=this.getColorByMouse(),this.close()},$Q.onColorTilesMouseMove=function($v){this._colorInput.focus=!1;var $g=this.getColorByMouse();this._colorInput.text=$g,this.drawBlock($g)},$Q.getColorByMouse=function(){var $v=this._colorTiles.getMousePoint(),$g=Math.floor($v.x/this._gridSize),$Q=Math.floor($v.y/this._gridSize);return this._colors[20*$Q+$g]},$Q.drawBlock=function($v){var $g=this._colorBlock.graphics;$g.clear();var $Q=$v||"#ffffff";$g.drawRect(0,0,50,20,$Q,this._borderColor),$v||$g.drawLine(0,0,50,20,"#ff0000")},$Q.changeColor=function(){var $v=this.graphics;$v.clear();var $g=this._selectedColor||"#000000";$v.drawRect(0,0,this._colorButton.width,this._colorButton.height,$g)},$Q._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$$(0,$Q,"inputBgColor",function(){return this._inputBgColor},function($v){this._inputBgColor=$v,this._setPanelChanged()}),$$(0,$Q,"selectedColor",function(){return this._selectedColor},function($v){this._selectedColor!=$v&&(this._selectedColor=this._colorInput.text=$v,this.drawBlock($v),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$M.EMPTY.setTo("change",this,this)))}),$$(0,$Q,"skin",function(){return this._colorButton.skin},function($v){this._colorButton.skin=$v,this.changeColor()}),$$(0,$Q,"bgColor",function(){return this._bgColor},function($v){this._bgColor=$v,this._setPanelChanged()}),$$(0,$Q,"borderColor",function(){return this._borderColor},function($v){this._borderColor=$v,this._setPanelChanged()}),$$(0,$Q,"inputColor",function(){return this._inputColor},function($v){this._inputColor=$v,this._setPanelChanged()}),$v}($X),$K=function($g){function $Q($v,$g){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$Q.__super.call(this),this._itemColors=$E.comboBoxItemColors,this.skin=$v,this.labels=$g}$k($Q,"laya.ui.ComboBox",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._button&&this._button.destroy($v),this._list&&this._list.destroy($v),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$v.createChildren=function(){this.addChild(this._button=new $x),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$v._createList=function(){this._list=new $z,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$v._setListEvent=function($v){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$J.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$v.onListDown=function($v){$v.stopPropagation()},$v.onScrollBarDown=function($v){$v.stopPropagation()},$v.onButtonMouseDown=function($v){this.callLater(this.switchTo,[!this._isOpen])},$v.changeList=function(){this._listChanged=!1;var $v=this.width-2,$g=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$v,height:this._itemHeight,fontSize:this._itemSize,color:$g}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$v.onlistItemMouse=function($v,$g){var $Q=$v.type;if("mouseover"===$Q||"mouseout"===$Q){if(this._isCustomList)return;var $d=this._list.getCell($g);if(!$d)return;var $r=$d.getChildByName("label");$r&&("mouseover"===$Q?($r.bgColor=this._itemColors[0],$r.color=this._itemColors[1]):($r.bgColor=null,$r.color=this._itemColors[2]))}else"click"===$Q&&(this.selectedIndex=$g,this.isOpen=!1)},$v.switchTo=function($v){this.isOpen=$v},$v.changeOpen=function(){this.isOpen=!this._isOpen},$v.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $v=this._list.graphics;$v.clear(),$v.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $g=this._list.array||[],$Q=$g.length=0,$d=this._labels.length;$Q<$d;$Q++)$g.push({label:this._labels[$Q]});this._list.height=this._listHeight,this._list.array=$g},$v.changeSelected=function(){this._button.label=this.selectedLabel},$v._onStageMouseWheel=function($v){this._list&&!this._list.contains($v.target)&&this.removeList(null)},$v.removeList=function($v){$t.stage.off("mousedown",this,this.removeList),$t.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$$(0,$v,"selectedIndex",function(){return this._selectedIndex},function($v){this._selectedIndex!=$v&&(this._selectedIndex=$v,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$M.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$$(0,$v,"measureHeight",function(){return this._button.height}),$$(0,$v,"skin",function(){return this._button.skin},function($v){this._button.skin!=$v&&(this._button.skin=$v,this._listChanged=!0)}),$$(0,$v,"measureWidth",function(){return this._button.width}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($X,this,"width",$v),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$$(0,$v,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($v){this.selectedIndex=this._labels.indexOf($v)}),$$(0,$v,"labels",function(){return this._labels.join(",")},function($v){0<this._labels.length&&(this.selectedIndex=-1),$v?this._labels=$v.split(","):this._labels.length=0,this._itemChanged=!0}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($X,this,"height",$v),this._button.height=this._height}),$$(0,$v,"selectHandler",function(){return this._selectHandler},function($v){this._selectHandler=$v}),$$(0,$v,"visibleNum",function(){return this._visibleNum},function($v){this._visibleNum=$v,this._listChanged=!0}),$$(0,$v,"labelBold",function(){return this._button.text.bold},function($v){this._button.text.bold=$v}),$$(0,$v,"itemColors",function(){return String(this._itemColors)},function($v){this._itemColors=$V.fillArray(this._itemColors,$v,String),this._listChanged=!0}),$$(0,$v,"itemSize",function(){return this._itemSize},function($v){this._itemSize=$v,this._listChanged=!0}),$$(0,$v,"scrollBar",function(){return this.list.scrollBar}),$$(0,$v,"isOpen",function(){return this._isOpen},function($v){if(this._isOpen!=$v)if(this._isOpen=$v,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $g=this.localToGlobal($T.TEMP.setTo(0,0)),$Q=$g.y+this._button.height;$Q=$Q+this._listHeight<=$t.stage.height?$Q:$g.y-this._listHeight,this._list.pos($g.x,$Q),this._list.zOrder=1001,$t._currentStage.addChild(this._list),$t.stage.once("mousedown",this,this.removeList),$t.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$$(0,$v,"scrollBarSkin",function(){return this._scrollBarSkin},function($v){this._scrollBarSkin=$v}),$$(0,$v,"sizeGrid",function(){return this._button.sizeGrid},function($v){this._button.sizeGrid=$v}),$$(0,$v,"button",function(){return this._button}),$$(0,$v,"list",function(){return this._list||this._createList(),this._list},function($v){$v&&($v.removeSelf(),this._isCustomList=!0,this._list=$v,this._setListEvent($v),this._itemHeight=$v.getCell(0).height+$v.spaceY)}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)&&Math.floor($v)==$v||"string"==typeof $v?this.selectedIndex=parseInt($v):$v instanceof Array?this.labels=$v.join(","):$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"labelColors",function(){return this._button.labelColors},function($v){this._button.labelColors!=$v&&(this._button.labelColors=$v)}),$$(0,$v,"labelPadding",function(){return this._button.text.padding.join(",")},function($v){this._button.text.padding=$V.fillArray($E.labelPadding,$v,Number)}),$$(0,$v,"labelSize",function(){return this._button.text.fontSize},function($v){this._button.text.fontSize=$v}),$$(0,$v,"labelFont",function(){return this._button.text.font},function($v){this._button.text.font=$v}),$$(0,$v,"stateNum",function(){return this._button.stateNum},function($v){this._button.stateNum=$v}),$Q}($X),$c=function($g){function $Q($v){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$Q.__super.call(this),this._showButtons=$Z.showButtons,this._touchScrollEnable=$Z.touchScrollEnable,this._mouseWheelEnable=$Z.mouseWheelEnable,this.skin=$v,this.max=1}$k($Q,"laya.ui.ScrollBar",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),this.stopScroll(),this.target=null,$g.prototype.destroy.call(this,$v),this.upButton&&this.upButton.destroy($v),this.downButton&&this.downButton.destroy($v),this.slider&&this.slider.destroy($v),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$v.createChildren=function(){this.addChild(this.slider=new $B),this.addChild(this.upButton=new $x),this.addChild(this.downButton=new $x)},$v.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$v.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$v.onButtonMouseDown=function($v){var $g=$v.currentTarget===this.upButton;this.slide($g),$t.timer.once($E.scrollBarDelayTime,this,this.startLoop,[$g]),$t.stage.once("mouseup",this,this.onStageMouseUp)},$v.startLoop=function($v){$t.timer.frameLoop(1,this,this.slide,[$v])},$v.slide=function($v){$v?this.value-=this._scrollSize:this.value+=this._scrollSize},$v.onStageMouseUp=function($v){$t.timer.clear(this,this.startLoop),$t.timer.clear(this,this.slide)},$v.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$v.changeSize=function(){$g.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$v.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$v.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$v.setScroll=function($v,$g,$Q){this.runCallLater(this.changeSize),this.slider.setSlider($v,$g,$Q),this.slider.bar.visible=0<$g,!this._hide&&this.autoHide&&(this.visible=!1)},$v.onTargetMouseWheel=function($v){this.value-=$v.delta*this._scrollSize,this.target=this._target},$v.onTargetMouseDown=function($v){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $T),this._lastPoint.setTo($t.stage.mouseX,$t.stage.mouseY),$t.timer.clear(this,this.tweenMove),$W.clearTween(this),$t.stage.once("mouseup",this,this.onStageMouseUp2),$t.stage.once("mouseout",this,this.onStageMouseUp2),$t.timer.frameLoop(1,this,this.loop)},$v.loop=function(){var $v=$t.stage.mouseY,$g=$t.stage.mouseX;if(this._lastOffset=this.isVertical?$v-this._lastPoint.y:$g-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$t.stage._canvasTransform.getScaleY():$t.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$g,this._lastPoint.y=$v,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$v.onStageMouseUp2=function($v){if($t.stage.off("mouseup",this,this.onStageMouseUp2),$t.stage.off("mouseout",this,this.onStageMouseUp2),$t.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$W.to(this,{value:this.min},this.elasticBackTime,$a.sineOut,$J.create(this,this.elasticOver)):this._value>this.max&&$W.to(this,{value:this.max},this.elasticBackTime,$a.sineOut,$J.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$t.stage.mouseY-this._lastPoint.y:$t.stage.mouseX-this._lastPoint.x);for(var $g=0,$Q=Math.min(this._offsets.length,3),$d=0;$d<$Q;$d++)$g+=this._offsets[this._offsets.length-1-$d];if(this._lastOffset=$g/$Q,($g=Math.abs(this._lastOffset))<2)return void this.event("end");60<$g&&(this._lastOffset=0<this._lastOffset?60:-60);var $r=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$t.timer.frameLoop(1,this,this.tweenMove,[$r])}},$v.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$W.to(this,{alpha:0},500),this.event("end")},$v.tweenMove=function($v){this._lastOffset*=this.rollRatio;var $g=NaN;if(0<$v&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$g=.5*-(this.min-$v-this.value),this._lastOffset>$g&&(this._lastOffset=$g)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$g=.5*-(this.max+$v-this.value),this._lastOffset<$g&&(this._lastOffset=$g))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($t.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$W.to(this,{value:this.min},this.elasticBackTime,$a.sineOut,$J.create(this,this.elasticOver)):this._value>this.max?$W.to(this,{value:this.max},this.elasticBackTime,$a.sineOut,$J.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$W.to(this,{alpha:0},500)}},$v.stopScroll=function(){this.onStageMouseUp2(null),$t.timer.clear(this,this.tweenMove),$W.clearTween(this)},$$(0,$v,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$$(0,$v,"skin",function(){return this._skin},function($v){this._skin!=$v&&(this._skin=$v,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$$(0,$v,"max",function(){return this.slider.max},function($v){this.slider.max=$v}),$$(0,$v,"showButtons",function(){return this._showButtons},function($v){this._showButtons=$v,this.callLater(this.changeScrollBar)}),$$(0,$v,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$$(0,$v,"min",function(){return this.slider.min},function($v){this.slider.min=$v}),$$(0,$v,"value",function(){return this._value},function($v){$v!==this._value&&(this._value=$v,this._isElastic||(this.slider._value!=$v&&(this.slider._value=$v,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$$(0,$v,"isVertical",function(){return this.slider.isVertical},function($v){this.slider.isVertical=$v}),$$(0,$v,"sizeGrid",function(){return this.slider.sizeGrid},function($v){this.slider.sizeGrid=$v}),$$(0,$v,"scrollSize",function(){return this._scrollSize},function($v){this._scrollSize=$v}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)||"string"==typeof $v?this.value=Number($v):$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"thumbPercent",function(){return this._thumbPercent},function($v){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$v=1<=$v?.99:$v,this._thumbPercent=$v,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$v,$E.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$v,$E.scrollBarMinNum))}),$$(0,$v,"target",function(){return this._target},function($v){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$v)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$$(0,$v,"hide",function(){return this._hide},function($v){this._hide=$v,this.visible=!$v}),$$(0,$v,"touchScrollEnable",function(){return this._touchScrollEnable},function($v){this._touchScrollEnable=$v,this.target=this._target}),$$(0,$v,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($v){this._mouseWheelEnable=$v,this.target=this._target}),$$(0,$v,"tick",function(){return this.slider.tick},function($v){this.slider.tick=$v}),$Q}($X),$B=function($g){function $Q($v){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$Q.__super.call(this),this.skin=$v}$k($Q,"laya.ui.Slider",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._bg&&this._bg.destroy($v),this._bar&&this._bar.destroy($v),this._progress&&this._progress.destroy($v),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$v.createChildren=function(){this.addChild(this._bg=new $j),this.addChild(this._bar=new $x)},$v.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$v.onBarMouseDown=function($v){this._globalSacle||(this._globalSacle=new $T),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$t.stage.mouseX,this._ty=$t.stage.mouseY,$t.stage.on("mousemove",this,this.mouseMove),$t.stage.once("mouseup",this,this.mouseUp),$t.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$v.showValueText=function(){if(this.showLabel){var $v=laya.ui.Slider.label;this.addChild($v),$v.textField.changeText(this._value+""),this.isVertical?($v.x=this._bar.x+20,$v.y=.5*(this._bar.height-$v.height)+this._bar.y):($v.y=this._bar.y-20,$v.x=.5*(this._bar.width-$v.width)+this._bar.x)}},$v.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$v.mouseUp=function($v){$t.stage.off("mousemove",this,this.mouseMove),$t.stage.off("mouseup",this,this.mouseUp),$t.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$v.mouseMove=function($v){var $g=this._value;this.isVertical?(this._bar.y+=($t.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($t.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$t.stage.mouseX,this._ty=$t.stage.mouseY;var $Q=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$Q)/$Q,this._value!=$g&&this.sendChangeEvent(),this.showValueText()},$v.sendChangeEvent=function($v){void 0===$v&&($v="change"),this.event($v),this.changeHandler&&this.changeHandler.runWith(this._value)},$v.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$v.changeSize=function(){$g.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$v.setSlider=function($v,$g,$Q){this._value=-1,this._min=$v,this._max=$v<$g?$g:$v,this.value=$Q<$v?$v:$g<$Q?$g:$Q},$v.changeValue=function(){var $v=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$v)/$v,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $g=this._max-this._min;0===$g&&($g=1),this.isVertical?(this._bar.y=(this._value-this._min)/$g*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$g*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$v.onBgMouseDown=function($v){var $g=this._bg.getMousePoint();this.isVertical?this.value=$g.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$g.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$$(0,$v,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$$(0,$v,"skin",function(){return this._skin},function($v){if(this._skin!=$v){this._skin=$v,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $g=this._skin.replace(".png","$progress.png");$G.getRes($g)&&(this._progress||(this.addChild(this._progress=new $j),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$g),this.setBarPoint(),this.callLater(this.changeValue)}}),$$(0,$v,"allowClickBack",function(){return this._allowClickBack},function($v){this._allowClickBack!=$v&&((this._allowClickBack=$v)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$$(0,$v,"max",function(){return this._max},function($v){this._max!=$v&&(this._max=$v,this.callLater(this.changeValue))}),$$(0,$v,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$$(0,$v,"tick",function(){return this._tick},function($v){this._tick!=$v&&(this._tick=$v,this.callLater(this.changeValue))}),$$(0,$v,"sizeGrid",function(){return this._bg.sizeGrid},function($v){this._bg.sizeGrid=$v,this._bar.sizeGrid=$v,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$$(0,$v,"min",function(){return this._min},function($v){this._min!=$v&&(this._min=$v,this.callLater(this.changeValue))}),$$(0,$v,"value",function(){return this._value},function($v){if(this._value!=$v){var $g=this._value;this._value=$v,this.changeValue(),this._value!=$g&&this.sendChangeEvent()}}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)||"string"==typeof $v?this.value=Number($v):$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"bar",function(){return this._bar}),$d($Q,["label",function(){return this.label=new $L}]),$Q}($X),$j=function($g){function $Q($v){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$Q.__super.call(this),this.skin=$v}$k($Q,"laya.ui.Image",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$G.clearCache(this,this._skin)},$v.dispose=function(){this.destroy(!0),$G.clearCache(this,this._skin),this.clearEvent()},$v.createChildren=function(){this.graphics=this._bitmap=new $f},$v.setSource=function($v,$g){this.destroyed||$v===this._skin&&$g&&(this.source=$g,this.onCompResize(),this.clearEvent())},$v.clearEvent=function(){this._skin&&$r.atalsNotify&&$r.atalsNotify.off(this._skin,this,this.setSource)},$v.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$t.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$$(0,$v,"source",function(){return this._bitmap.source},function($v){this._bitmap&&(this._bitmap.source=$v,this.event("loaded"),this.repaint())}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"string"==typeof(this._dataSource=$v)?this.skin=$v:$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"measureHeight",function(){return this._bitmap.height}),$$(0,$v,"skin",function(){return this._skin},function($v){if(this._skin!=$v)if($G.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$v){$G.keepCache(this,this._skin);var $g=$G.getRes($v),$Q=$r.resAtalsObj&&$r.resAtalsObj[this._skin];$g?(this.source=$g,this.onCompResize()):$Q?($r.atalsNotify&&$r.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$Q.sourceW),0==this.height&&(this.height=$Q.sourceH)):(this._complete=$J.create(this,this.setSource,[this._skin]),this._progress=null,$t.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$$(0,$v,"group",function(){return this._group},function($v){$v&&this._skin&&$G.setGroup(this._skin,$v),this._group=$v}),$$(0,$v,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($v){this._bitmap.sizeGrid=$V.fillArray($E.defaultSizeGrid,$v,Number)}),$$(0,$v,"measureWidth",function(){return this._bitmap.width}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($X,this,"width",$v),this._bitmap.width=0==$v?1e-7:$v}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($X,this,"height",$v),this._bitmap.height=0==$v?1e-7:$v}),$Q}($X),$L=function($g){function $Q($v){this._tf=null,$Q.__super.call(this),void 0===$v&&($v=""),$Y.defaultColor=$E.labelColor,this.text=$v}$k($Q,"laya.ui.Label",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._tf=null},$v.createChildren=function(){this.addChild(this._tf=new $h)},$v.changeText=function($v){this._tf.changeText($v)},$$(0,$v,"padding",function(){return this._tf.padding.join(",")},function($v){this._tf.padding=$V.fillArray($E.labelPadding,$v,Number)}),$$(0,$v,"bold",function(){return this._tf.bold},function($v){this._tf.bold=$v}),$$(0,$v,"align",function(){return this._tf.align},function($v){this._tf.align=$v}),$$(0,$v,"text",function(){return this._tf.text},function($v){this._tf.text!=$v&&($v&&($v=$V.adptString($v+"")),this._tf.text=$v,this.event("change"),this._width&&this._height||this.onCompResize())}),$$(0,$v,"italic",function(){return this._tf.italic},function($v){this._tf.italic=$v}),$$(0,$v,"wordWrap",function(){return this._tf.wordWrap},function($v){this._tf.wordWrap=$v}),$$(0,$v,"font",function(){return this._tf.font},function($v){this._tf.font=$v}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)||"string"==typeof $v?this.text=$v+"":$t.superSet($X,this,"dataSource",$v)}),$$(0,$v,"color",function(){return this._tf.color},function($v){this._tf.color=$v}),$$(0,$v,"valign",function(){return this._tf.valign},function($v){this._tf.valign=$v}),$$(0,$v,"leading",function(){return this._tf.leading},function($v){this._tf.leading=$v}),$$(0,$v,"fontSize",function(){return this._tf.fontSize},function($v){this._tf.fontSize=$v}),$$(0,$v,"bgColor",function(){return this._tf.bgColor},function($v){this._tf.bgColor=$v}),$$(0,$v,"borderColor",function(){return this._tf.borderColor},function($v){this._tf.borderColor=$v}),$$(0,$v,"stroke",function(){return this._tf.stroke},function($v){this._tf.stroke=$v}),$$(0,$v,"strokeColor",function(){return this._tf.strokeColor},function($v){this._tf.strokeColor=$v}),$$(0,$v,"textField",function(){return this._tf}),$$(0,$v,"measureWidth",function(){return this._tf.width}),$$(0,$v,"measureHeight",function(){return this._tf.height}),$$(0,$v,"width",function(){return this._width||this._tf.text?$t.superGet($X,this,"width"):0},function($v){$t.superSet($X,this,"width",$v),this._tf.width=$v}),$$(0,$v,"height",function(){return this._height||this._tf.text?$t.superGet($X,this,"height"):0},function($v){$t.superSet($X,this,"height",$v),this._tf.height=$v}),$$(0,$v,"overflow",function(){return this._tf.overflow},function($v){this._tf.overflow=$v}),$$(0,$v,"underline",function(){return this._tf.underline},function($v){this._tf.underline=$v}),$$(0,$v,"underlineColor",function(){return this._tf.underlineColor},function($v){this._tf.underlineColor=$v}),$Q}($X),$H=function($g){function $Q($v){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$Q.__super.call(this),this.skin=$v}$k($Q,"laya.ui.ProgressBar",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._bg&&this._bg.destroy($v),this._bar&&this._bar.destroy($v),this._bg=this._bar=null,this.changeHandler=null},$v.createChildren=function(){this.addChild(this._bg=new $j),this.addChild(this._bar=new $j)},$v.changeValue=function(){if(this.sizeGrid){var $v=this.sizeGrid.split(","),$g=Number($v[3]),$Q=Number($v[1]),$d=(this.width-$g-$Q)*this._value;this._bar.width=$g+$Q+$d,this._bar.visible=this._bar.width>$g+$Q}else this._bar.width=this.width*this._value},$$(0,$v,"measureHeight",function(){return this._bg.height}),$$(0,$v,"skin",function(){return this._skin},function($v){this._skin!=$v&&(this._skin=$v,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$$(0,$v,"measureWidth",function(){return this._bg.width}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($X,this,"height",$v),this._bg.height=this._height,this._bar.height=this._height}),$$(0,$v,"bar",function(){return this._bar}),$$(0,$v,"value",function(){return this._value},function($v){this._value!=$v&&($v=1<$v?1:$v<0?0:$v,this._value=$v,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($v))}),$$(0,$v,"bg",function(){return this._bg}),$$(0,$v,"sizeGrid",function(){return this._bg.sizeGrid},function($v){this._bg.sizeGrid=this._bar.sizeGrid=$v}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($X,this,"width",$v),this._bg.width=this._width,this.callLater(this.changeValue)}),$$(0,$v,"dataSource",$g.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)||"string"==typeof $v?this.value=Number($v):$t.superSet($X,this,"dataSource",$v)}),$Q}($X),$n=(function($v){function $Q(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$Q.__super.call(this),this._tipBox=new $X,this._tipBox.addChild(this._tipText=new $h),this._tipText.x=this._tipText.y=5,this._tipText.color=$Q.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$t.stage.on("showtip",this,this._onStageShowTip),$t.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$k($Q,"laya.ui.TipManager",$X);var $g=$Q.prototype;$g._onStageHideTip=function($v){$t.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$g._onStageShowTip=function($v){$t.timer.once($Q.tipDelay,this,this._showTip,[$v],!0)},$g._showTip=function($v){if("string"==typeof $v){var $g=String($v);Boolean($g)&&this._defaultTipHandler($g)}else $v instanceof laya.utils.Handler?$v.run():"function"==typeof $v&&$v.apply();$t.stage.on("mousemove",this,this._onStageMouseMove),$t.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$g._onStageMouseDown=function($v){this.closeAll()},$g._onStageMouseMove=function($v){this._showToStage(this,$Q.offsetX,$Q.offsetY)},$g._showToStage=function($v,$g,$Q){void 0===$g&&($g=0),void 0===$Q&&($Q=0);var $d=$v.getBounds();$v.x=$t.stage.mouseX+$g,$v.y=$t.stage.mouseY+$Q,$v.x+$d.width>$t.stage.width&&($v.x-=$d.width+$g),$v.y+$d.height>$t.stage.height&&($v.y-=$d.height+$Q)},$g.closeAll=function(){$t.timer.clear(this,this._showTip),$t.stage.off("mousemove",this,this._onStageMouseMove),$t.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$g.showDislayTip=function($v){this.addChild($v),this._showToStage(this),$t._currentStage.addChild(this)},$g._showDefaultTip=function($v){this._tipText.text=$v;var $g=this._tipBox.graphics;$g.clear(),$g.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$Q.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$t._currentStage.addChild(this)},$$(0,$g,"defaultTipHandler",function(){return this._defaultTipHandler},function($v){this._defaultTipHandler=$v}),$Q.offsetX=10,$Q.offsetY=15,$Q.tipTextColor="#ffffff",$Q.tipBackColor="#111111",$Q.tipDelay=200}(),function($v){var $p;function $T(){this._idMap=null,this._aniList=null,this._watchMap={},$T.__super.call(this)}$k($T,"laya.ui.View",$i);var $g=$T.prototype;return $g.createView=function($v){if($v.animations&&!this._idMap&&(this._idMap={}),$T.createComp($v,this,this),$v.animations){var $g,$Q,$d=[],$r=$v.animations,$k=0,$$=$r.length;for($k=0;$k<$$;$k++){switch($g=new $D,$Q=$r[$k],$g._setUp(this._idMap,$Q),(this[$Q.name]=$g)._setControlNode(this),$Q.action){case 1:$g.play(0,!1);break;case 2:$g.play(0,!0)}$d.push($g)}this._aniList=$d}0<this._width&&null==$v.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$g.onEvent=function($v,$g){},$g.loadUI=function($v){var $g=$T.uiMap[$v];$g&&this.createView($g)},$g.destroy=function($v){void 0===$v&&($v=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$v)},$g.changeData=function($v){var $g=this._watchMap[$v];if($g){console.log("change",$v);for(var $Q=0,$d=$g.length;$Q<$d;$Q++){$g[$Q].exe(this)}}},$T._regs=function(){for(var $v in $T.uiClassMap)$q.regClass($v,$T.uiClassMap[$v])},$T.createComp=function($v,$g,$Q,$d){if(!($g=$g||$T.getCompInstance($v)))return console.warn("can not create:"+$v.type),null;var $r=$v.child;if($r)for(var $k=$g instanceof laya.ui.List,$$=0,$b=$r.length;$$<$b;$$++){var $a=$r[$$];if(!$g.hasOwnProperty("itemRender")||"render"!=$a.props.name&&"render"!==$a.props.renderType)if("Graphic"==$a.type)$q.addGraphicsToSprite($a,$g);else if($q.isDrawType($a.type))$q.addGraphicToSprite($a,$g,!0);else{if($k){var $M=[],$Y=$T.createComp($a,null,$Q,$M);$M.length&&($Y._$bindData=$M)}else $Y=$T.createComp($a,null,$Q,$d);"Script"==$a.type?"owner"in $Y?$Y.owner=$g:"target"in $Y&&($Y.target=$g):"mask"==$a.props.renderType||"mask"==$a.props.name?$g.mask=$Y:$Y instanceof laya.display.Sprite&&$g.addChild($Y)}else $g.itemRender=$a}var $D=$v.props;for(var $J in $D){var $p=$D[$J];$T.eventDic[$J]?$p&&$Q&&$g.on($J,$Q,$Q.onEvent,[$p]):$T.setCompValue($g,$J,$p,$Q,$d)}return $t.__typeof($g,"laya.ui.IItem")&&$g.initItems(),$v.compId&&$Q&&$Q._idMap&&($Q._idMap[$v.compId]=$g),$g},$T.setCompValue=function($v,$g,$Q,$d,$r){if("string"==typeof $Q&&-1<$Q.indexOf("${")){if($T._sheet||($T._sheet=$q.getClass("laya.data.Table")),!$T._sheet)return void console.warn("Can not find class Sheet");if($r)$r.push($v,$g,$Q);else if($d){-1==$Q.indexOf("].")&&($Q=$Q.replace(".","[0]."));var $k,$$,$b=new $p($v,$g,$Q);$b.exe($d);for(var $a=$Q.replace(/\[.*?\]\./g,".");null!=($k=$T._parseWatchData.exec($a));){for(var $M=$k[1];null!=($$=$T._parseKeyWord.exec($M));){var $Y=$$[0],$D=$d._watchMap[$Y]||($d._watchMap[$Y]=[]);$D.push($b),$T._sheet.I.notifer.on($Y,$d,$d.changeData,[$Y])}($D=$d._watchMap[$M]||($d._watchMap[$M]=[])).push($b),$T._sheet.I.notifer.on($M,$d,$d.changeData,[$M])}}}else if("var"===$g&&$d)$d[$Q]=$v;else if("onClick"==$g){var $J=$t._runScript("(function(){"+$Q+"})");$v.on("click",$d,$J)}else $v[$g]="true"===$Q||"false"!==$Q&&$Q},$T.getCompInstance=function($v){var $g,$Q=$v.props?$v.props.runtime:null;return $g=$Q?$T.viewClassMap[$Q]||$T.uiClassMap[$Q]||$t.__classmap[$Q]:$T.uiClassMap[$v.type],$v.props&&$v.props.hasOwnProperty("renderType")&&"instance"==$v.props.renderType?$g.instance:$g?new $g:null},$T.regComponent=function($v,$g){$T.uiClassMap[$v]=$g,$q.regClass($v,$g)},$T.regViewRuntime=function($v,$g){$T.viewClassMap[$v]=$g},$T.uiMap={},$T.viewClassMap={},$T._sheet=null,$d($T,["uiClassMap",function(){return this.uiClassMap={ViewStack:$vv,LinkButton:$x,TextArea:$Mv,ColorPicker:$m,Box:$i,Button:$x,CheckBox:$y,Clip:$w,ComboBox:$K,Component:$X,HScrollBar:$U,HSlider:$S,Image:$j,Label:$L,List:$z,Panel:$I,ProgressBar:$H,Radio:$_,RadioGroup:$bv,ScrollBar:$c,Slider:$B,Tab:$av,TextInput:$Qv,View:$T,VScrollBar:$gv,VSlider:$dv,Tree:$u,HBox:$kv,VBox:$$v,Sprite:$A,Animation:$Q,Text:$h,FontClip:$R}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$T.__init$=function(){$T._regs(),$p=function(){function $v($v,$g,$Q){this.comp=null,this.prop=null,this.value=null,this.comp=$v,this.prop=$g,this.value=$Q}return $k($v,""),$v.prototype.exe=function($v){var $g=$V.getBindFun(this.value);this.comp[this.prop]=$g.call(this,$v)},$v}()},$T}()),$y=function($v){function $Q($v,$g){void 0===$g&&($g=""),$Q.__super.call(this,$v,$g)}$k($Q,"laya.ui.CheckBox",$v);var $g=$Q.prototype;return $g.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$g.initialize=function(){$v.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$$(0,$g,"dataSource",$v.prototype._$get_dataSource,function($v){"boolean"==typeof(this._dataSource=$v)?this.selected=$v:"string"==typeof $v?this.selected="true"===$v:$t.superSet($x,this,"dataSource",$v)}),$Q}($x),$e=function($v){function $g(){this._space=0,this._align="none",this._itemChanged=!1,$g.__super.call(this)}$k($g,"laya.ui.LayoutBox",$i);var $Q=$g.prototype;return $Q.addChild=function($v){return $v.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$v)},$Q.onResize=function($v){this._setItemChanged()},$Q.addChildAt=function($v,$g){return $v.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$v,$g)},$Q.removeChild=function($v){return $v.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$v)},$Q.removeChildAt=function($v){return this.getChildAt($v).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$v)},$Q.refresh=function(){this._setItemChanged()},$Q.changeItems=function(){this._itemChanged=!1},$Q.sortItem=function($v){$v&&$v.sort(function($v,$g){return $v.y-$g.y})},$Q._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$$(0,$Q,"space",function(){return this._space},function($v){this._space=$v,this._setItemChanged()}),$$(0,$Q,"align",function(){return this._align},function($v){this._align=$v,this._setItemChanged()}),$g}(),$R=function($g){function $Q($v,$g){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$Q.__super.call(this),$v&&(this.skin=$v),$g&&(this.sheet=$g)}$k($Q,"laya.ui.FontClip",$g);var $v=$Q.prototype;return $v.createChildren=function(){this._bitmap=new $f,this.on("loaded",this,this._onClipLoaded)},$v._onClipLoaded=function(){this.callLater(this.changeValue)},$v.changeValue=function(){var $v;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$v=this._sources[0]))){var $g="horizontal"===this._direction;$g?(this._wordsW=this._valueArr.length*($v.sourceWidth+this.spaceX),this._wordsH=$v.sourceHeight):(this._wordsW=$v.sourceWidth,this._wordsH=($v.sourceHeight+this.spaceY)*this._valueArr.length);var $Q=0;if(this._width)switch(this._align){case"center":$Q=.5*(this._width-this._wordsW);break;case"right":$Q=this._width-this._wordsW;break;default:$Q=0}for(var $d=0,$r=this._valueArr.length;$d<$r;$d++){var $k=this._indexMap[this._valueArr.charAt($d)];this.sources[$k]&&($v=this.sources[$k],$g?this.graphics.drawTexture($v,$Q+$d*($v.sourceWidth+this.spaceX),0,$v.sourceWidth,$v.sourceHeight):this.graphics.drawTexture($v,0+$Q,$d*($v.sourceHeight+this.spaceY),$v.sourceWidth,$v.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$v.destroy=function($v){void 0===$v&&($v=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$g.prototype.destroy.call(this,$v)},$$(0,$v,"sheet",function(){return this._sheet},function($v){$v+="";var $g=(this._sheet=$v).split(" ");this._clipX=String($g[0]).length,this.clipY=$g.length,this._indexMap={};for(var $Q=0;$Q<this._clipY;$Q++)for(var $d=$g[$Q].split(""),$r=0,$k=$d.length;$r<$k;$r++)this._indexMap[$d[$r]]=$Q*this._clipX+$r}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($w,this,"height",$v),this.callLater(this.changeValue)}),$$(0,$v,"direction",function(){return this._direction},function($v){this._direction=$v,this.callLater(this.changeValue)}),$$(0,$v,"value",function(){return this._valueArr?this._valueArr:""},function($v){$v+="",this._valueArr=$v,this.callLater(this.changeValue)}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($w,this,"width",$v),this.callLater(this.changeValue)}),$$(0,$v,"spaceX",function(){return this._spaceX},function($v){this._spaceX=$v,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$$(0,$v,"spaceY",function(){return this._spaceY},function($v){this._spaceY=$v,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$$(0,$v,"align",function(){return this._align},function($v){this._align=$v,this.callLater(this.changeValue)}),$$(0,$v,"measureWidth",function(){return this._wordsW}),$$(0,$v,"measureHeight",function(){return this._wordsH}),$Q}($w),$z=function($v){function $g(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $T,$g.__super.call(this)}$k($g,"laya.ui.List",$v);var $Q=$g.prototype;return $t.imps($Q,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$Q.destroy=function($v){void 0===$v&&($v=!0),this._content&&this._content.destroy($v),this._scrollBar&&this._scrollBar.destroy($v),laya.ui.Component.prototype.destroy.call(this,$v),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$Q.createChildren=function(){this.addChild(this._content=new $i)},$Q.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$t.superGet($i,this,"cacheAs")),$t.superSet($i,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$Q.onScrollEnd=function(){$t.superSet($i,this,"cacheAs",this._$P.cacheAs)},$Q._removePreScrollBar=function(){var $v=this.removeChildByName("scrollBar");$v&&$v.destroy(!0)},$Q.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $v=this._getOneCell(),$g=$v.width+this._spaceX||1,$Q=$v.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$g):Math.ceil(this._width/$g)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$Q):Math.round(this._height/$Q));var $d=this._width?this._width:$g*this.repeatX-this._spaceX,$r=this._height?this._height:$Q*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$Q:$g,this._cellOffset=this._isVertical?$Q*Math.max(this._repeatY2,this._repeatY)-$r-this._spaceY:$g*Math.max(this._repeatX2,this._repeatX)-$d-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$r:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$d),this.setContentSize($d,$r);var $k=this._isVertical?this.repeatX:this.repeatY,$$=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$k,$$),this._createdLine=$$,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$Q._getOneCell=function(){if(0===this._cells.length){var $v=this.createItem();if(this._offset.setTo($v.x,$v.y),this.cacheContent)return $v;this._cells.push($v)}return this._cells[0]},$Q._createItems=function($v,$g,$Q){var $d=this._content,$r=this._getOneCell(),$k=$r.width+this._spaceX,$$=$r.height+this._spaceY;if(this.cacheContent){var $b=new $i;$b.cacheAsBitmap=!0,$b.pos((this._isVertical?0:$v)*$k,(this._isVertical?$v:0)*$$),this._content.addChild($b),this._content.optimizeScrollRect=!0,$d=$b}else{for(var $a=[],$M=this._cells.length-1;-1<$M;$M--){var $Y=this._cells[$M];$Y.removeSelf(),$a.push($Y)}this._cells.length=0}for(var $D=$v;$D<$Q;$D++)for(var $J=0;$J<$g;$J++)($r=$a&&$a.length?$a.pop():this.createItem()).x=(this._isVertical?$J:$D)*$k-$d.x,$r.y=(this._isVertical?$D:$J)*$$-$d.y,$r.name="item"+($D*$g+$J),$d.addChild($r),this.addCell($r)},$Q.createItem=function(){var $v=[];if("function"==typeof this._itemRender)var $g=new this._itemRender;else $g=$n.createComp(this._itemRender,null,null,$v);if(0==$v.length&&$g._watchMap){var $Q=$g._watchMap;for(var $d in $Q)for(var $r=$Q[$d],$k=0;$k<$r.length;$k++){var $$=$r[$k];$v.push($$.comp,$$.prop,$$.value)}}return $v.length&&($g._$bindData=$v),$g},$Q.addCell=function($v){$v.on("click",this,this.onCellMouse),$v.on("rightclick",this,this.onCellMouse),$v.on("mouseover",this,this.onCellMouse),$v.on("mouseout",this,this.onCellMouse),$v.on("mousedown",this,this.onCellMouse),$v.on("mouseup",this,this.onCellMouse),this._cells.push($v)},$Q.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $v=0,$g=$v=0;$g<1e4;$g++){var $Q=this.getChildByName("item"+$g);if(!$Q)break;this.addCell($Q),$v++}this.repeatY=$v}},$Q.setContentSize=function($v,$g){this._content.width=$v,this._content.height=$g,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $C),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$v,$g),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$Q.onCellMouse=function($v){"mousedown"===$v.type&&(this._isMoved=!1);var $g=$v.currentTarget,$Q=this._startIndex+this._cells.indexOf($g);$Q<0||("click"===$v.type||"rightclick"===$v.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$Q:this.changeCellState($g,!0,0):"mouseover"!==$v.type&&"mouseout"!==$v.type||this._selectedIndex===$Q||this.changeCellState($g,"mouseover"===$v.type,0),this.mouseHandler&&this.mouseHandler.runWith([$v,$Q]))},$Q.changeCellState=function($v,$g,$Q){var $d=$v.getChildByName("selectBox");$d&&(this.selectEnable=!0,$d.visible=$g,$d.index=$Q)},$Q.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$Q.onScrollBarChange=function($v){this.runCallLater(this.changeCells);var $g=this._scrollBar.value,$Q=this._isVertical?this.repeatX:this.repeatY,$d=this._isVertical?this.repeatY:this.repeatX,$r=Math.floor($g/this._cellSize);if(this.cacheContent)$$=$d+1,this._createdLine-$r<$$&&(this._createItems(this._createdLine,$Q,this._createdLine+$$),this.renderItems(this._createdLine*$Q,0),this._createdLine+=$$);else{var $k=$r*$Q,$$=0;if($k>this._startIndex){$$=$k-this._startIndex;var $b=!0,$a=this._startIndex+$Q*($d+1);this._isMoved=!0}else $k<this._startIndex&&($$=this._startIndex-$k,$b=!1,$a=this._startIndex-1,this._isMoved=!0);for(var $M=0;$M<$$;$M++){if($b){var $Y=this._cells.shift();this._cells[this._cells.length]=$Y;var $D=$a+$M}else $Y=this._cells.pop(),this._cells.unshift($Y),$D=$a-$M;var $J=Math.floor($D/$Q)*this._cellSize;this._isVertical?$Y.y=$J:$Y.x=$J,this.renderItem($Y,$D)}this._startIndex=$k,this.changeSelectStatus()}var $p=this._content.scrollRect;this._isVertical?($p.y=$g-this._offset.y,$p.x=-this._offset.x):($p.y=-this._offset.y,$p.x=$g-this._offset.x),this._content.scrollRect=$p},$Q.posCell=function($v,$g){if(this._scrollBar){var $Q=this._isVertical?this.repeatX:this.repeatY,$d=(this._isVertical?this.repeatY:this.repeatX,Math.floor($g/$Q)*this._cellSize);this._isVertical?$v.y=$d:$v.x=$d}},$Q.changeSelectStatus=function(){for(var $v=0,$g=this._cells.length;$v<$g;$v++)this.changeCellState(this._cells[$v],this._selectedIndex===this._startIndex+$v,1)},$Q.renderItems=function($v,$g){void 0===$v&&($v=0),void 0===$g&&($g=0);for(var $Q=$v,$d=$g||this._cells.length;$Q<$d;$Q++)this.renderItem(this._cells[$Q],this._startIndex+$Q);this.changeSelectStatus(),this._twDone=!0},$Q.renderItem=function($v,$g){this._array&&0<=$g&&$g<this._array.length?($v.visible=!0,$v._$bindData?($v._dataSource=this._array[$g],this._bindData($v,this._array[$g])):$v.dataSource=this._array[$g],this.cacheContent||this.posCell($v,$g),this.hasListener("render")&&this.event("render",[$v,$g]),this.renderHandler&&this.renderHandler.runWith([$v,$g]),this.renderTwHandler&&this.renderTwHandler.runWith([$v,$g])):($v.visible=!1,$v.dataSource=null)},$Q._bindData=function($v,$g){for(var $Q=$v._$bindData,$d=0,$r=$Q.length;$d<$r;$d++){var $k=$Q[$d++],$$=$Q[$d++],$b=$Q[$d],$a=$V.getBindFun($b);$k[$$]=$a.call(this,$g)}},$Q.refresh=function(){this.array=this._array},$Q.getItem=function($v){return-1<$v&&$v<this._array.length?this._array[$v]:null},$Q.changeItem=function($v,$g){-1<$v&&$v<this._array.length&&(this._array[$v]=$g,$v>=this._startIndex&&$v<this._startIndex+this._cells.length&&this.renderItem(this.getCell($v),$v))},$Q.setItem=function($v,$g){this.changeItem($v,$g)},$Q.addItem=function($v){this._array.push($v),this.array=this._array},$Q.addItemAt=function($v,$g){this._array.splice($g,0,$v),this.array=this._array},$Q.deleteItem=function($v){this._array.splice($v,1),this.array=this._array},$Q.getCell=function($v){return this.runCallLater(this.changeCells),-1<$v&&this._cells?this._cells[($v-this._startIndex)%this._cells.length]:null},$Q.scrollTo=function($v){if(this._scrollBar){var $g=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($v/$g)*this._cellSize}else this.startIndex=$v},$Q.tweenTo=function($v,$g,$Q){if(void 0===$g&&($g=200),this._scrollBar){var $d=this._isVertical?this.repeatX:this.repeatY;$W.to(this._scrollBar,{value:Math.floor($v/$d)*this._cellSize},$g,null,$Q,0,!0)}else this.startIndex=$v,$Q&&$Q.run()},$Q._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$Q.commitMeasure=function(){this.runCallLater(this.changeCells)},$$(0,$Q,"cacheAs",$v.prototype._$get_cacheAs,function($v){$t.superSet($i,this,"cacheAs",$v),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$v?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$$(0,$Q,"content",function(){return this._content}),$$(0,$Q,"height",$v.prototype._$get_height,function($v){$v!=this._height&&($t.superSet($i,this,"height",$v),this._setCellChanged())}),$$(0,$Q,"itemRender",function(){return this._itemRender},function($v){if(this._itemRender!=$v){this._itemRender=$v;for(var $g=this._cells.length-1;-1<$g;$g--)this._cells[$g].destroy();this._cells.length=0,this._setCellChanged()}}),$$(0,$Q,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($v){this._removePreScrollBar();var $g=new $gv;$g.name="scrollBar",$g.right=0,$v&&" "!=$v&&($g.skin=$v),this.scrollBar=$g,this.addChild($g),this._setCellChanged()}),$$(0,$Q,"page",function(){return this._page},function($v){this._page=$v,this._array&&(this._page=0<$v?$v:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$$(0,$Q,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($v){this._removePreScrollBar();var $g=new $U;$g.name="scrollBar",$g.bottom=0,$v&&" "!=$v&&($g.skin=$v),this.scrollBar=$g,this.addChild($g),this._setCellChanged()}),$$(0,$Q,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($v){this._repeatX=$v,this._setCellChanged()}),$$(0,$Q,"scrollBar",function(){return this._scrollBar},function($v){this._scrollBar!=$v&&(this._scrollBar=$v)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$$(0,$Q,"width",$v.prototype._$get_width,function($v){$v!=this._width&&($t.superSet($i,this,"width",$v),this._setCellChanged())}),$$(0,$Q,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($v){this._repeatY=$v,this._setCellChanged()}),$$(0,$Q,"spaceX",function(){return this._spaceX},function($v){this._spaceX=$v,this._setCellChanged()}),$$(0,$Q,"spaceY",function(){return this._spaceY},function($v){this._spaceY=$v,this._setCellChanged()}),$$(0,$Q,"selectedIndex",function(){return this._selectedIndex},function($v){this._selectedIndex!=$v&&(this._selectedIndex=$v,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($v),this.startIndex=this._startIndex)}),$$(0,$Q,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($v){this.selectedIndex=this._array.indexOf($v)}),$$(0,$Q,"length",function(){return this._array?this._array.length:0}),$$(0,$Q,"selection",function(){return this.getCell(this._selectedIndex)},function($v){this.selectedIndex=this._startIndex+this._cells.indexOf($v)}),$$(0,$Q,"startIndex",function(){return this._startIndex},function($v){this._startIndex=0<$v?$v:0,this.callLater(this.renderItems)}),$$(0,$Q,"twSwitch",function(){return this._twSwitch},function($v){this._twSwitch=$v}),$$(0,$Q,"twDone",function(){return this._twDone},function($v){this._twDone=$v}),$$(0,$Q,"array",function(){return this._array},function($v){this.runCallLater(this.changeCells),this._array=$v||[];var $g=this._array.length;if(this.totalPage=Math.ceil($g/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$g?this._selectedIndex:$g-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $Q=this._isVertical?this.repeatX:this.repeatY,$d=this._isVertical?this.repeatY:this.repeatX,$r=Math.ceil($g/$Q);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$d/$r,this._scrollBar.setScroll(0,($r-$d)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$$(0,$Q,"dataSource",$v.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)&&Math.floor($v)==$v||"string"==typeof $v?this.selectedIndex=parseInt($v):$v instanceof Array?this.array=$v:$t.superSet($i,this,"dataSource",$v)}),$$(0,$Q,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$g}($i),$U=function($v){function $g(){$g.__super.call(this)}return $k($g,"laya.ui.HScrollBar",$v),$g.prototype.initialize=function(){$v.prototype.initialize.call(this),this.slider.isVertical=!1},$g}($c),$I=function($v){function $g(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$g.__super.call(this),this.width=this.height=100}$k($g,"laya.ui.Panel",$v);var $Q=$g.prototype;return $Q.destroy=function($v){void 0===$v&&($v=!0),laya.ui.Component.prototype.destroy.call(this,$v),this._content&&this._content.destroy($v),this._vScrollBar&&this._vScrollBar.destroy($v),this._hScrollBar&&this._hScrollBar.destroy($v),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$Q.destroyChildren=function(){this._content.destroyChildren()},$Q.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $i)},$Q.addChild=function($v){return $v.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($v)},$Q.onResize=function(){this._setScrollChanged()},$Q.addChildAt=function($v,$g){return $v.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($v,$g)},$Q.removeChild=function($v){return $v.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($v)},$Q.removeChildAt=function($v){return this.getChildAt($v).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($v)},$Q.removeChildren=function($v,$g){return void 0===$v&&($v=0),void 0===$g&&($g=2147483647),this._content.removeChildren($v,$g),this._setScrollChanged(),this},$Q.getChildAt=function($v){return this._content.getChildAt($v)},$Q.getChildByName=function($v){return this._content.getChildByName($v)},$Q.getChildIndex=function($v){return this._content.getChildIndex($v)},$Q.changeScroll=function(){this._scrollChanged=!1;var $v=this.contentWidth||1,$g=this.contentHeight||1,$Q=this._vScrollBar,$d=this._hScrollBar,$r=$Q&&$g>this._height,$k=$d&&$v>this._width,$$=$r?this._width-$Q.width:this._width,$b=$k?this._height-$d.height:this._height;$Q&&($Q.x=this._width-$Q.width,$Q.y=0,$Q.height=this._height-($k?$d.height:0),$Q.scrollSize=Math.max(.033*this._height,1),$Q.thumbPercent=$b/$g,$Q.setScroll(0,$g-$b,$Q.value)),$d&&($d.x=0,$d.y=this._height-$d.height,$d.width=this._width-($r?$Q.width:0),$d.scrollSize=Math.max(.033*this._width,1),$d.thumbPercent=$$/$v,$d.setScroll(0,$v-$$,$d.value))},$Q.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$Q.setContentSize=function($v,$g){var $Q=this._content;$Q.width=$v,$Q.height=$g,$Q.scrollRect||($Q.scrollRect=new $C),$Q.scrollRect.setTo(0,0,$v,$g),$Q.scrollRect=$Q.scrollRect},$Q.onScrollBarChange=function($v){var $g=this._content.scrollRect;if($g){var $Q=Math.round($v.value);$v.isVertical?$g.y=$Q:$g.x=$Q,this._content.scrollRect=$g}},$Q.scrollTo=function($v,$g){void 0===$v&&($v=0),void 0===$g&&($g=0),this.vScrollBar&&(this.vScrollBar.value=$g),this.hScrollBar&&(this.hScrollBar.value=$v)},$Q.refresh=function(){this.changeScroll()},$Q.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$t.superGet($i,this,"cacheAs")),$t.superSet($i,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$Q.onScrollEnd=function(){$t.superSet($i,this,"cacheAs",this._$P.cacheAs)},$Q._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$$(0,$Q,"numChildren",function(){return this._content.numChildren}),$$(0,$Q,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($v){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $U),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$v}),$$(0,$Q,"contentWidth",function(){for(var $v=0,$g=this._content.numChildren-1;-1<$g;$g--){var $Q=this._content.getChildAt($g);$v=Math.max($Q.x+$Q.width*$Q.scaleX,$v)}return $v}),$$(0,$Q,"contentHeight",function(){for(var $v=0,$g=this._content.numChildren-1;-1<$g;$g--){var $Q=this._content.getChildAt($g);$v=Math.max($Q.y+$Q.height*$Q.scaleY,$v)}return $v}),$$(0,$Q,"width",$v.prototype._$get_width,function($v){$t.superSet($i,this,"width",$v),this._setScrollChanged()}),$$(0,$Q,"hScrollBar",function(){return this._hScrollBar}),$$(0,$Q,"content",function(){return this._content}),$$(0,$Q,"height",$v.prototype._$get_height,function($v){$t.superSet($i,this,"height",$v),this._setScrollChanged()}),$$(0,$Q,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($v){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $gv),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$v}),$$(0,$Q,"vScrollBar",function(){return this._vScrollBar}),$$(0,$Q,"cacheAs",$v.prototype._$get_cacheAs,function($v){$t.superSet($i,this,"cacheAs",$v),this._$P.cacheAs=null,"none"!==$v?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$g}($i),$S=function($v){function $g($v){$g.__super.call(this,$v),this.isVertical=!1}return $k($g,"laya.ui.HSlider",$B),$g}(),$O=function($v){function $Q($v,$g){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$Q.__super.call(this),this.skin=$g,this.labels=$v}$k($Q,"laya.ui.UIGroup",$v);var $g=$Q.prototype;return $t.imps($g,{"laya.ui.IItem":!0}),$g.preinitialize=function(){this.mouseEnabled=!0},$g.destroy=function($v){void 0===$v&&($v=!0),laya.ui.Component.prototype.destroy.call(this,$v),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$g.addItem=function($v,$g){void 0===$g&&($g=!0);var $Q=$v,$d=this._items.length;if($Q.name="item"+$d,this.addChild($Q),this.initItems(),$g&&0<$d){var $r=this._items[$d-1];"horizontal"==this._direction?$Q.x=$r.x+$r.width+this._space:$Q.y=$r.y+$r.height+this._space}else $g&&($Q.x=0,$Q.y=0);return $d},$g.delItem=function($v,$g){void 0===$g&&($g=!0);var $Q=this._items.indexOf($v);if(-1!=$Q){var $d=$v;this.removeChild($d);for(var $r=$Q+1,$k=this._items.length;$r<$k;$r++){var $$=this._items[$r];$$.name="item"+($r-1),$g&&("horizontal"==this._direction?$$.x-=$d.width+this._space:$$.y-=$d.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $b;$b=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$b}}},$g.initItems=function(){this._items||(this._items=[]);for(var $v=this._items.length=0;$v<1e4;$v++){var $g=this.getChildByName("item"+$v);if(null==$g)break;this._items.push($g),$g.selected=$v===this._selectedIndex,$g.clickHandler=$J.create(this,this.itemClick,[$v],!1)}},$g.itemClick=function($v){this.selectedIndex=$v},$g.setSelect=function($v,$g){this._items&&-1<$v&&$v<this._items.length&&(this._items[$v].selected=$g)},$g.createItem=function($v,$g){return null},$g.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $v=0,$g=0,$Q=this._items.length;$g<$Q;$g++){var $d=this._items[$g];this._skin&&($d.skin=this._skin),this._labelColors&&($d.labelColors=this._labelColors),this._labelSize&&($d.labelSize=this._labelSize),this._labelStroke&&($d.labelStroke=this._labelStroke),this._labelStrokeColor&&($d.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($d.strokeColors=this._strokeColors),this._labelBold&&($d.labelBold=this._labelBold),this._labelPadding&&($d.labelPadding=this._labelPadding),this._labelAlign&&($d.labelAlign=this._labelAlign),this._stateNum&&($d.stateNum=this._stateNum),this._labelFont&&($d.labelFont=this._labelFont),"horizontal"===this._direction?($d.y=0,$d.x=$v,$v+=$d.width+this._space):($d.x=0,$d.y=$v,$v+=$d.height+this._space)}this.changeSize()},$g.commitMeasure=function(){this.runCallLater(this.changeLabels)},$g._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$$(0,$g,"labelStrokeColor",function(){return this._labelStrokeColor},function($v){this._labelStrokeColor!=$v&&(this._labelStrokeColor=$v,this._setLabelChanged())}),$$(0,$g,"skin",function(){return this._skin},function($v){this._skin!=$v&&(this._skin=$v,this._setLabelChanged())}),$$(0,$g,"selectedIndex",function(){return this._selectedIndex},function($v){this._selectedIndex!=$v&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$v,this.setSelect($v,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$$(0,$g,"labels",function(){return this._labels},function($v){if(this._labels!=$v){if(this._labels=$v,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $g=this._labels.split(","),$Q=0,$d=$g.length;$Q<$d;$Q++){var $r=this.createItem(this._skin,$g[$Q]);$r.name="item"+$Q,this.addChild($r)}this.initItems()}}),$$(0,$g,"strokeColors",function(){return this._strokeColors},function($v){this._strokeColors!=$v&&(this._strokeColors=$v,this._setLabelChanged())}),$$(0,$g,"labelColors",function(){return this._labelColors},function($v){this._labelColors!=$v&&(this._labelColors=$v,this._setLabelChanged())}),$$(0,$g,"labelStroke",function(){return this._labelStroke},function($v){this._labelStroke!=$v&&(this._labelStroke=$v,this._setLabelChanged())}),$$(0,$g,"labelSize",function(){return this._labelSize},function($v){this._labelSize!=$v&&(this._labelSize=$v,this._setLabelChanged())}),$$(0,$g,"stateNum",function(){return this._stateNum},function($v){this._stateNum!=$v&&(this._stateNum=$v,this._setLabelChanged())}),$$(0,$g,"labelBold",function(){return this._labelBold},function($v){this._labelBold!=$v&&(this._labelBold=$v,this._setLabelChanged())}),$$(0,$g,"labelFont",function(){return this._labelFont},function($v){this._labelFont!=$v&&(this._labelFont=$v,this._setLabelChanged())}),$$(0,$g,"labelPadding",function(){return this._labelPadding},function($v){this._labelPadding!=$v&&(this._labelPadding=$v,this._setLabelChanged())}),$$(0,$g,"direction",function(){return this._direction},function($v){this._direction=$v,this._setLabelChanged()}),$$(0,$g,"space",function(){return this._space},function($v){this._space=$v,this._setLabelChanged()}),$$(0,$g,"items",function(){return this._items}),$$(0,$g,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($v){this.selectedIndex=this._items.indexOf($v)}),$$(0,$g,"dataSource",$v.prototype._$get_dataSource,function($v){"number"==typeof(this._dataSource=$v)&&Math.floor($v)==$v||"string"==typeof $v?this.selectedIndex=parseInt($v):$v instanceof Array?this.labels=$v.join(","):$t.superSet($i,this,"dataSource",$v)}),$Q}($i),$_=function($g){function $Q($v,$g){this._value=null,void 0===$g&&($g=""),$Q.__super.call(this,$v,$g)}$k($Q,"laya.ui.Radio",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._value=null},$v.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$v.initialize=function(){$g.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$v.onClick=function($v){this.selected=!0},$$(0,$v,"value",function(){return null!=this._value?this._value:this.label},function($v){this._value=$v}),$Q}($x),$u=function($v){function $g(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$g.__super.call(this),this.width=this.height=200}$k($g,"laya.ui.Tree",$v);var $Q=$g.prototype;return $t.imps($Q,{"laya.ui.IRender":!0}),$Q.destroy=function($v){void 0===$v&&($v=!0),laya.ui.Component.prototype.destroy.call(this,$v),this._list&&this._list.destroy($v),this._list=null,this._source=null,this._renderHandler=null},$Q.createChildren=function(){this.addChild(this._list=new $z),this._list.renderHandler=$J.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$Q.onListChange=function($v){this.event("change")},$Q.getArray=function(){var $v,$g=[];for(var $Q in this._source)$v=this._source[$Q],this.getParentOpenStatus($v)&&($v.x=this._spaceLeft*this.getDepth($v),$g.push($v));return $g},$Q.getDepth=function($v,$g){return void 0===$g&&($g=0),null==$v.nodeParent?$g:this.getDepth($v.nodeParent,$g+1)},$Q.getParentOpenStatus=function($v){var $g=$v.nodeParent;return null==$g||!!$g.isOpen&&(null==$g.nodeParent||this.getParentOpenStatus($g))},$Q.renderItem=function($v,$g){var $Q=$v.dataSource;if($Q){$v.left=$Q.x;var $d=$v.getChildByName("arrow");$d&&($Q.hasChild?($d.visible=!0,$d.index=$Q.isOpen?1:0,$d.tag=$g,$d.off("click",this,this.onArrowClick),$d.on("click",this,this.onArrowClick)):$d.visible=!1);var $r=$v.getChildByName("folder");$r&&(2==$r.clipY?$r.index=$Q.isDirectory?0:1:$r.index=$Q.isDirectory?$Q.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$v,$g])}},$Q.onArrowClick=function($v){var $g=$v.currentTarget.tag;this._list.array[$g].isOpen=!this._list.array[$g].isOpen,this.event("open"),this._list.array=this.getArray()},$Q.setItemState=function($v,$g){this._list.array[$v]&&(this._list.array[$v].isOpen=$g,this._list.array=this.getArray())},$Q.fresh=function(){this._list.array=this.getArray(),this.repaint()},$Q.parseXml=function($v,$g,$Q,$d){var $r,$k=$v.childNodes,$$=$k.length;if(!$d){$r={};var $b,$a=$v.attributes;for(var $M in $a){var $Y=($b=$a[$M]).nodeName,$D=$b.nodeValue;$r[$Y]="true"==$D||"false"!=$D&&$D}$r.nodeParent=$Q,0<$$&&($r.isDirectory=!0),$r.hasChild=0<$$,$g.push($r)}for(var $J=0;$J<$$;$J++){var $p=$k[$J];this.parseXml($p,$g,$r,!1)}},$Q.parseOpenStatus=function($v,$g){for(var $Q=0,$d=$g.length;$Q<$d;$Q++){var $r=$g[$Q];if($r.isDirectory)for(var $k=0,$$=$v.length;$k<$$;$k++){var $b=$v[$k];if($b.isDirectory&&this.isSameParent($b,$r)&&$r.label==$b.label){$r.isOpen=$b.isOpen;break}}}},$Q.isSameParent=function($v,$g){return null==$v.nodeParent&&null==$g.nodeParent||null!=$v.nodeParent&&null!=$g.nodeParent&&($v.nodeParent.label==$g.nodeParent.label&&this.isSameParent($v.nodeParent,$g.nodeParent))},$Q.filter=function($v){if(Boolean($v)){var $g=[];this.getFilterSource(this._source,$g,$v),this._list.array=$g}else this._list.array=this.getArray()},$Q.getFilterSource=function($v,$g,$Q){var $d;for(var $r in $Q=$Q.toLocaleLowerCase(),$v)!($d=$v[$r]).isDirectory&&-1<String($d.label).toLowerCase().indexOf($Q)&&($d.x=0,$g.push($d)),$d.child&&0<$d.child.length&&this.getFilterSource($d.child,$g,$Q)},$$(0,$Q,"spaceBottom",function(){return this._list.spaceY},function($v){this._list.spaceY=$v}),$$(0,$Q,"keepStatus",function(){return this._keepStatus},function($v){this._keepStatus=$v}),$$(0,$Q,"itemRender",function(){return this._list.itemRender},function($v){this._list.itemRender=$v}),$$(0,$Q,"array",function(){return this._list.array},function($v){this._keepStatus&&this._list.array&&$v&&this.parseOpenStatus(this._list.array,$v),this._source=$v,this._list.array=this.getArray()}),$$(0,$Q,"mouseHandler",function(){return this._list.mouseHandler},function($v){this._list.mouseHandler=$v}),$$(0,$Q,"dataSource",$v.prototype._$get_dataSource,function($v){this._dataSource=$v,$t.superSet($i,this,"dataSource",$v)}),$$(0,$Q,"source",function(){return this._source}),$$(0,$Q,"scrollBar",function(){return this._list.scrollBar}),$$(0,$Q,"list",function(){return this._list}),$$(0,$Q,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($v){this._list.vScrollBarSkin=$v}),$$(0,$Q,"renderHandler",function(){return this._renderHandler},function($v){this._renderHandler=$v}),$$(0,$Q,"selectedIndex",function(){return this._list.selectedIndex},function($v){this._list.selectedIndex=$v}),$$(0,$Q,"spaceLeft",function(){return this._spaceLeft},function($v){this._spaceLeft=$v}),$$(0,$Q,"selectedItem",function(){return this._list.selectedItem},function($v){this._list.selectedItem=$v}),$$(0,$Q,"width",$v.prototype._$get_width,function($v){$t.superSet($i,this,"width",$v),this._list.width=$v}),$$(0,$Q,"height",$v.prototype._$get_height,function($v){$t.superSet($i,this,"height",$v),this._list.height=$v}),$$(0,$Q,"xml",null,function($v){var $g=[];this.parseXml($v.childNodes[0],$g,null,!0),this.array=$g}),$$(0,$Q,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$g}($i),$vv=function($v){function $g(){this._items=null,this._selectedIndex=0,$g.__super.call(this),this._setIndexHandler=$J.create(this,this.setIndex,null,!1)}$k($g,"laya.ui.ViewStack",$v);var $Q=$g.prototype;return $t.imps($Q,{"laya.ui.IItem":!0}),$Q.setItems=function($v){this.removeChildren();for(var $g=0,$Q=0,$d=$v.length;$Q<$d;$Q++){var $r=$v[$Q];$r&&($r.name="item"+$g,this.addChild($r),$g++)}this.initItems()},$Q.addItem=function($v){$v.name="item"+this._items.length,this.addChild($v),this.initItems()},$Q.initItems=function(){this._items=[];for(var $v=0;$v<1e4;$v++){var $g=this.getChildByName("item"+$v);if(null==$g)break;this._items.push($g),$g.visible=$v==this._selectedIndex}},$Q.setSelect=function($v,$g){this._items&&-1<$v&&$v<this._items.length&&(this._items[$v].visible=$g)},$Q.setIndex=function($v){this.selectedIndex=$v},$$(0,$Q,"dataSource",$v.prototype._$get_dataSource,function($v){if("number"==typeof(this._dataSource=$v)&&Math.floor($v)==$v||"string"==typeof $v)this.selectedIndex=parseInt($v);else for(var $g in this._dataSource)this.hasOwnProperty($g)&&(this[$g]=this._dataSource[$g])}),$$(0,$Q,"selectedIndex",function(){return this._selectedIndex},function($v){this._selectedIndex!=$v&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$v,this.setSelect(this._selectedIndex,!0))}),$$(0,$Q,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($v){this.selectedIndex=this._items.indexOf($v)}),$$(0,$Q,"items",function(){return this._items}),$$(0,$Q,"setIndexHandler",function(){return this._setIndexHandler},function($v){this._setIndexHandler=$v}),$g}($i),$gv=function($v){function $g(){$g.__super.call(this)}return $k($g,"laya.ui.VScrollBar",$c),$g}(),$Qv=function($g){function $Q($v){this._bg=null,this._skin=null,$Q.__super.call(this),void 0===$v&&($v=""),this.text=$v,this.skin=this.skin}$k($Q,"laya.ui.TextInput",$g);var $v=$Q.prototype;return $v.preinitialize=function(){this.mouseEnabled=!0},$v.destroy=function($v){$G.clearCache(this,this._skin),void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._bg&&this._bg.destroy(),this._bg=null},$v.createChildren=function(){this.addChild(this._tf=new $p),this._tf.padding=$E.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$v._onFocus=function(){this.event("focus",this)},$v._onBlur=function(){this.event("blur",this)},$v._onInput=function(){this.event("input",this)},$v._onEnter=function(){this.event("enter",this)},$v.initialize=function(){this.width=128,this.height=22},$v.select=function(){this._tf.select()},$v.setSelection=function($v,$g){this._tf.setSelection($v,$g)},$$(0,$v,"text",$g.prototype._$get_text,function($v){this._tf.text!=$v&&($v+="",this._tf.text=$v,this.event("change"))}),$$(0,$v,"bg",function(){return this._bg},function($v){this.graphics=this._bg=$v}),$$(0,$v,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($v){this._tf.inputElementYAdjuster=$v}),$$(0,$v,"multiline",function(){return this._tf.multiline},function($v){this._tf.multiline=$v}),$$(0,$v,"skin",function(){return this._skin},function($v){this._skin!=$v&&($G.clearCache(this,this._skin),this._skin=$v,this._bg||(this.graphics=this._bg=new $f),$G.keepCache(this,this._skin),this._bg.source=$G.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$$(0,$v,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($v){this._bg||(this.graphics=this._bg=new $f),this._bg.sizeGrid=$V.fillArray($E.defaultSizeGrid,$v,Number)}),$$(0,$v,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($v){this._tf.inputElementXAdjuster=$v}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($L,this,"width",$v),this._bg&&(this._bg.width=$v)}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($L,this,"height",$v),this._bg&&(this._bg.height=$v)}),$$(0,$v,"editable",function(){return this._tf.editable},function($v){this._tf.editable=$v}),$$(0,$v,"restrict",function(){return this._tf.restrict},function($v){this._tf.restrict=$v}),$$(0,$v,"prompt",function(){return this._tf.prompt},function($v){this._tf.prompt=$v}),$$(0,$v,"promptColor",function(){return this._tf.promptColor},function($v){this._tf.promptColor=$v}),$$(0,$v,"maxChars",function(){return this._tf.maxChars},function($v){this._tf.maxChars=$v}),$$(0,$v,"focus",function(){return this._tf.focus},function($v){this._tf.focus=$v}),$$(0,$v,"type",function(){return this._tf.type},function($v){this._tf.type=$v}),$$(0,$v,"asPassword",function(){return this._tf.asPassword},function($v){this._tf.asPassword=$v}),$Q}($L),$dv=function($v){function $g(){$g.__super.call(this)}return $k($g,"laya.ui.VSlider",$B),$g}(),$rv=function($v){function $d(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$d.__super.call(this)}$k($d,"laya.ui.Dialog",$v);var $g=$d.prototype;return $g.initialize=function(){this.popupEffect=$d.manager.popupEffectHandler,this.closeEffect=$d.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$g._dealDragArea=function(){var $v=this.getChildByName("drag");$v&&(this.dragArea=$v.x+","+$v.y+","+$v.width+","+$v.height,$v.removeSelf())},$g._onClick=function($v){var $g=$v.target;if($g)switch($g.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($g.name)}},$g.show=function($v,$g){void 0===$v&&($v=!1),void 0===$g&&($g=!0),this._open(!1,$v,$g)},$g.popup=function($v,$g){void 0===$v&&($v=!1),void 0===$g&&($g=!0),this._open(!0,$v,$g)},$g._open=function($v,$g,$Q){$d.manager.lock(!1),this.isModal=$v,$d.manager.open(this,$g,$Q)},$g.onOpened=function(){},$g.close=function($v,$g){void 0===$g&&($g=!0),$d.manager.close(this,$v,$g)},$g.onClosed=function($v){},$g._onMouseDown=function($v){var $g=this.getMousePoint();this._dragArea.contains($g.x,$g.y)?this.startDrag():this.stopDrag()},$$(0,$g,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($v){if($v){var $g=$V.fillArray([0,0,0,0],$v,Number);this._dragArea=new $C($g[0],$g[1],$g[2],$g[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$$(0,$g,"isPopup",function(){return null!=this.parent}),$$(0,$g,"zOrder",$v.prototype._$get_zOrder,function($v){$t.superSet($n,this,"zOrder",$v),$d.manager._checkMask()}),$$(1,$d,"manager",function(){return $d._manager=$d._manager||new $N},function($v){$d._manager=$v}),$d.setLockView=function($v){$d.manager.setLockView($v)},$d.lock=function($v){$d.manager.lock($v)},$d.closeAll=function(){$d.manager.closeAll()},$d.getDialogsByGroup=function($v){return $d.manager.getDialogsByGroup($v)},$d.closeByGroup=function($v){return $d.manager.closeByGroup($v)},$d.CLOSE="close",$d.CANCEL="cancel",$d.SURE="sure",$d.NO="no",$d.OK="ok",$d.YES="yes",$d._manager=null,$d}($n),$kv=function($v){function $g(){$g.__super.call(this)}$k($g,"laya.ui.HBox",$v);var $Q=$g.prototype;return $Q.sortItem=function($v){$v&&$v.sort(function($v,$g){return $v.x-$g.x})},$Q.changeItems=function(){this._itemChanged=!1;for(var $v=[],$g=0,$Q=0,$d=this.numChildren;$Q<$d;$Q++){var $r=this.getChildAt($Q);$r&&$r.layoutEnabled&&($v.push($r),$g=this._height?this._height:Math.max($g,$r.height*$r.scaleY))}this.sortItem($v);var $k=0;for($Q=0,$d=$v.length;$Q<$d;$Q++)($r=$v[$Q]).x=$k,$k+=$r.width*$r.scaleX+this._space,"top"==this._align?$r.y=0:"middle"==this._align?$r.y=.5*($g-$r.height*$r.scaleY):"bottom"==this._align&&($r.y=$g-$r.height*$r.scaleY);this.changeSize()},$$(0,$Q,"height",$v.prototype._$get_height,function($v){this._height!=$v&&($t.superSet($e,this,"height",$v),this.callLater(this.changeItems))}),$g.NONE="none",$g.TOP="top",$g.MIDDLE="middle",$g.BOTTOM="bottom",$g}($e),$$v=function($v){function $g(){$g.__super.call(this)}$k($g,"laya.ui.VBox",$v);var $Q=$g.prototype;return $Q.changeItems=function(){this._itemChanged=!1;for(var $v=[],$g=0,$Q=0,$d=this.numChildren;$Q<$d;$Q++){var $r=this.getChildAt($Q);$r&&$r.layoutEnabled&&($v.push($r),$g=this._width?this._width:Math.max($g,$r.width*$r.scaleX))}this.sortItem($v);var $k=0;for($Q=0,$d=$v.length;$Q<$d;$Q++)($r=$v[$Q]).y=$k,$k+=$r.height*$r.scaleY+this._space,"left"==this._align?$r.x=0:"center"==this._align?$r.x=.5*($g-$r.width*$r.scaleX):"right"==this._align&&($r.x=$g-$r.width*$r.scaleX);this.changeSize()},$$(0,$Q,"width",$v.prototype._$get_width,function($v){this._width!=$v&&($t.superSet($e,this,"width",$v),this.callLater(this.changeItems))}),$g.NONE="none",$g.LEFT="left",$g.CENTER="center",$g.RIGHT="right",$g}($e),$bv=function($v){function $g(){$g.__super.call(this)}return $k($g,"laya.ui.RadioGroup",$O),$g.prototype.createItem=function($v,$g){return new $_($v,$g)},$g}(),$av=function($v){function $g(){$g.__super.call(this)}return $k($g,"laya.ui.Tab",$O),$g.prototype.createItem=function($v,$g){return new $x($v,$g)},$g}(),$Mv=function($g){function $Q($v){this._vScrollBar=null,this._hScrollBar=null,void 0===$v&&($v=""),$Q.__super.call(this,$v)}$k($Q,"laya.ui.TextArea",$g);var $v=$Q.prototype;return $v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$v.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$v.onVBarChanged=function($v){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$v.onHBarChanged=function($v){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$v.changeScroll=function(){var $v=this._vScrollBar&&0<this._tf.maxScrollY,$g=this._hScrollBar&&0<this._tf.maxScrollX,$Q=$v?this._width-this._vScrollBar.width:this._width,$d=$g?this._height-this._hScrollBar.height:this._height,$r=this._tf.padding||$E.labelPadding;this._tf.width=$Q,this._tf.height=$d,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$r[2],this._vScrollBar.y=$r[1],this._vScrollBar.height=this._height-($g?this._hScrollBar.height:0)-$r[1]-$r[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$d/Math.max(this._tf.textHeight,$d),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$v),this._hScrollBar&&(this._hScrollBar.x=$r[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$r[3],this._hScrollBar.width=this._width-($v?this._vScrollBar.width:0)-$r[0]-$r[2],this._hScrollBar.scrollSize=Math.max(.033*$Q,1),this._hScrollBar.thumbPercent=$Q/Math.max(this._tf.textWidth,$Q),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$g)},$v.scrollTo=function($v){this.commitMeasure(),this._tf.scrollY=$v},$$(0,$v,"scrollY",function(){return this._tf.scrollY}),$$(0,$v,"width",$g.prototype._$get_width,function($v){$t.superSet($Qv,this,"width",$v),this.callLater(this.changeScroll)}),$$(0,$v,"hScrollBar",function(){return this._hScrollBar}),$$(0,$v,"height",$g.prototype._$get_height,function($v){$t.superSet($Qv,this,"height",$v),this.callLater(this.changeScroll)}),$$(0,$v,"maxScrollX",function(){return this._tf.maxScrollX}),$$(0,$v,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($v){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $gv),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$v}),$$(0,$v,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($v){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $U),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$v}),$$(0,$v,"vScrollBar",function(){return this._vScrollBar}),$$(0,$v,"maxScrollY",function(){return this._tf.maxScrollY}),$$(0,$v,"scrollX",function(){return this._tf.scrollX}),$Q}($Qv);!function($v){function $g(){this._uiView=null,this.isCloseOther=!1,$g.__super.call(this)}$k($g,"laya.ui.AsynDialog",$rv);var $Q=$g.prototype;$Q.createView=function($v){this._uiView=$v},$Q._open=function($v,$g,$Q){this.isModal=$v,this.isCloseOther=$g,$rv.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$Q.onCreated=function(){this.createUI(),this.onOpen()},$Q.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$Q.onOpen=function(){$rv.manager.open(this,this.isCloseOther),$rv.manager.lock(!1)},$Q.close=function($v,$g){void 0===$g&&($g=!0),$rv.manager.close(this),this.onClose()},$Q.onClose=function(){},$Q.destroy=function($v){void 0===$v&&($v=!0),laya.ui.View.prototype.destroy.call(this,$v),this._uiView=null,this.onDestroy()},$Q.onDestroy=function(){}}();$t.__init([$n])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($v,$g){"use strict";for(var $Q in Object.defineProperty($g,"__esModule",{value:!0}),Laya){var $d=Laya[$Q];$d&&$d.__isclass&&($g[$Q]=$d)}}),function($J,$v,$h){$h.un,$h.uns;var $D=$h.static,$p=$h.class,$T=$h.getset,$d=$h.__newvec,$A=laya.maths.Arith,$$=laya.webgl.atlas.AtlasResourceManager,$Q=laya.webgl.shader.BaseShader,$X=laya.utils.Browser,$b=laya.webgl.utils.Buffer,$P=laya.utils.Byte,$r=laya.utils.ClassUtils,$a=$h.Config,$k=(laya.events.Event,laya.events.EventDispatcher),$E=laya.utils.Handler,$C=laya.net.Loader,$g=laya.net.LoaderManager,$M=(laya.maths.MathUtil,laya.display.Node),$t=laya.renders.Render,$Y=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$q=laya.resource.Resource,$G=laya.utils.RunDriver,$s=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$W=laya.display.Sprite,$F=laya.utils.Stat,$l=laya.utils.StringKey,$V=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$o=laya.utils.Utils,$Z=laya.webgl.WebGL,$f=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$h.interface("laya.d3.core.IClone"),$h.interface("laya.d3.graphics.IVertex"),$h.interface("laya.d3.core.render.IUpdate"),$h.interface("laya.d3.core.scene.ITreeNode"),$h.interface("laya.d3.core.render.IRenderable");(function(){function $x(){}$p($x,"laya.d3.animation.AnimationClipParser01"),$x.READ_DATA=function(){$x._DATA.offset=$x._reader.getUint32(),$x._DATA.size=$x._reader.getUint32()},$x.READ_BLOCK=function(){for(var $v=$x._BLOCK.count=$x._reader.getUint16(),$g=$x._BLOCK.blockStarts=[],$Q=$x._BLOCK.blockLengths=[],$d=0;$d<$v;$d++)$g.push($x._reader.getUint32()),$Q.push($x._reader.getUint32())},$x.READ_STRINGS=function(){var $v=$x._reader.getUint32(),$g=$x._reader.getUint16(),$Q=$x._reader.pos;$x._reader.pos=$v+$x._DATA.offset;for(var $d=0;$d<$g;$d++)$x._strings[$d]=$x._reader.readUTFString();$x._reader.pos=$Q},$x.parse=function($v,$g){$x._animationClip=$v;($x._reader=$g).__getBuffer();$x.READ_DATA(),$x.READ_BLOCK(),$x.READ_STRINGS();for(var $Q=0,$d=$x._BLOCK.count;$Q<$d;$Q++){var $r=$g.getUint16(),$k=$x._strings[$r],$$=$x["READ_"+$k];if(null==$$)throw new Error("model file err,no this function:"+$r+" "+$k);$$.call()}},$x.READ_ANIMATIONS=function(){var $v,$g=0,$Q=0,$d=$x._reader,$r=$d.__getBuffer(),$k=[],$$=$d.getUint8();for($k.length=$$,$g=0;$g<$$;$g++)$k[$g]=$d.getUint16();var $b=[],$a=$d.getUint16();for($b.length=$a,$g=0;$g<$a;$g++)$b[$g]=$d.getFloat32();var $M=$x._animationClip;$M.name=$x._strings[$d.getUint16()];var $Y=$M._duration=$d.getFloat32();$M.islooping=!!$d.getByte(),$M._frameRate=$d.getInt16();var $D=$d.getInt16(),$J=$M._nodes=new Array;$J.length=$D,($M._publicClipDatas=[]).length=$D;var $p=$M._nodesMap={},$T=0,$t=0;for($g=0;$g<$D;$g++){$v=$J[$g]=new $H;var $q=$d.getUint16(),$C=$v.path=[];for($C.length=$q,$Q=0;$Q<$q;$Q++)$C[$Q]=$x._strings[$d.getUint16()];var $G=$C.join("/"),$s=$p[$G];$s||($p[$G]=$s=[]),$s.push($v);var $A=$d.getInt16();-1!==$A&&($v.componentType=$x._strings[$A]);var $h=$j._propertyIndexDic[$x._strings[$d.getUint16()]];if(null==$h)throw new Error("AnimationClipParser01:unknown property name.");var $P=$h<4,$W=!$P||$P&&""===$C[0];($v._cacheProperty=$W)?$T++:$t++,$v.propertyNameID=$h;var $F=$k[$d.getUint8()];$v.keyFrameWidth=$F/4;var $l=$v.keyFrames=[],$o=$l.length=$d.getUint16(),$E=null,$V=NaN;for($Q=0;$Q<$o;$Q++){var $Z=$l[$Q]=new $L;$V=$Z.startTime=$b[$d.getUint16()];var $f=$d.pos;$Z.inTangent=new Float32Array($r.slice($f,$f+$F)),$d.pos+=$F,$f=$d.pos,$Z.outTangent=new Float32Array($r.slice($f,$f+$F)),$d.pos+=$F,$f=$d.pos,$Z.data=new Float32Array($r.slice($f,$f+$F)),$d.pos+=$F,$E&&($E.next=$Z,$E.duration=$V-$E.startTime),$E=$Z}$Z.next=null,$Z.duration=$Y-$V}var $X=$M._nodeToCachePropertyMap=new Int32Array($D),$N=$M._cachePropertyMap=new Int32Array($T),$i=$M._unCachePropertyMap=new Int32Array($t);for($T=$t=0,$g=0;$g<$D;$g++)($v=$J[$g])._cacheProperty?($X[$g]=$T,$N[$T++]=$g):$i[$t++]=$g},$x._animationClip=null,$x._reader=null,$x._strings=[],$D($x,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $c(){}$p($c,"laya.d3.animation.AnimationClipParser02"),$c.READ_DATA=function(){$c._DATA.offset=$c._reader.getUint32(),$c._DATA.size=$c._reader.getUint32()},$c.READ_BLOCK=function(){for(var $v=$c._BLOCK.count=$c._reader.getUint16(),$g=$c._BLOCK.blockStarts=[],$Q=$c._BLOCK.blockLengths=[],$d=0;$d<$v;$d++)$g.push($c._reader.getUint32()),$Q.push($c._reader.getUint32())},$c.READ_STRINGS=function(){var $v=$c._reader.getUint32(),$g=$c._reader.getUint16(),$Q=$c._reader.pos;$c._reader.pos=$v+$c._DATA.offset;for(var $d=0;$d<$g;$d++)$c._strings[$d]=$c._reader.readUTFString();$c._reader.pos=$Q},$c.parse=function($v,$g){$c._animationClip=$v;($c._reader=$g).__getBuffer();$c.READ_DATA(),$c.READ_BLOCK(),$c.READ_STRINGS();for(var $Q=0,$d=$c._BLOCK.count;$Q<$d;$Q++){var $r=$g.getUint16(),$k=$c._strings[$r],$$=$c["READ_"+$k];if(null==$$)throw new Error("model file err,no this function:"+$r+" "+$k);$$.call()}},$c.READ_ANIMATIONS=function(){var $v,$g=0,$Q=0,$d=$c._reader,$r=$d.__getBuffer(),$k=[],$$=$d.getUint8();for($k.length=$$,$g=0;$g<$$;$g++)$k[$g]=$d.getUint16();var $b=[],$a=$d.getUint16();for($b.length=$a,$g=0;$g<$a;$g++)$b[$g]=$d.getFloat32();var $M=$c._animationClip;$M.name=$c._strings[$d.getUint16()];var $Y=$M._duration=$d.getFloat32();$M.islooping=!!$d.getByte(),$M._frameRate=$d.getInt16();var $D=$d.getInt16(),$J=$M._nodes=new Array;$J.length=$D,($M._publicClipDatas=[]).length=$D;var $p=$M._nodesMap={},$T=0,$t=0;for($g=0;$g<$D;$g++){$v=$J[$g]=new $H;var $q=$d.getUint16(),$C=$v.path=[];for($C.length=$q,$Q=0;$Q<$q;$Q++)$C[$Q]=$c._strings[$d.getUint16()];var $G=$C.join("/"),$s=$p[$G];$s||($p[$G]=$s=[]),$s.push($v);var $A=$d.getInt16();-1!==$A&&($v.componentType=$c._strings[$A]);var $h=$j._propertyIndexDic[$c._strings[$d.getUint16()]];if(null==$h)throw new Error("AnimationClipParser02:unknown property name.");var $P=$h<4,$W=!$P||$P&&""===$C[0];($v._cacheProperty=$W)?$T++:$t++,$v.propertyNameID=$h;var $F=$k[$d.getUint8()];$v.keyFrameWidth=$F/4;var $l=$v.keyFrames=[],$o=$l.length=$d.getUint16(),$E=null,$V=NaN;for($Q=0;$Q<$o;$Q++){var $Z=$l[$Q]=new $L;$V=$Z.startTime=$b[$d.getUint16()];var $f=$d.pos;$Z.inTangent=new Float32Array($r.slice($f,$f+$F)),$d.pos+=$F,$f=$d.pos,$Z.outTangent=new Float32Array($r.slice($f,$f+$F)),$d.pos+=$F,$f=$d.pos,$Z.data=new Float32Array($r.slice($f,$f+$F)),$d.pos+=$F,$E&&($E.next=$Z,$E.duration=$V-$E.startTime),$E=$Z}$Z.next=null,$Z.duration=$Y-$V}var $X=$d.getUint16();for($g=0;$g<$X;$g++){var $N,$i=new $B;$i.time=$d.getFloat32(),$i.eventName=$c._strings[$d.getUint16()];var $x=$d.getUint16();for(0<$x&&($i.params=$N=[]),$Q=0;$Q<$x;$Q++){switch($d.getByte()){case 0:$N.push(!!$d.getByte());break;case 1:$N.push($d.getInt32());break;case 2:$N.push($d.getFloat32());break;case 3:$N.push($c._strings[$d.getUint16()]);break;default:throw new Error("unknown type.")}}$M.addEvent($i)}var $w=$M._nodeToCachePropertyMap=new Int32Array($D),$m=$M._cachePropertyMap=new Int32Array($T),$K=$M._unCachePropertyMap=new Int32Array($t);for($T=$t=0,$g=0;$g<$D;$g++)($v=$J[$g])._cacheProperty?($w[$g]=$T,$m[$T++]=$g):$K[$t++]=$g},$c._animationClip=null,$c._reader=null,$c._strings=[],$D($c,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $B=function(){function $v(){this.time=NaN,this.eventName=null,this.params=null}return $p($v,"laya.d3.animation.AnimationEvent"),$v}(),$j=function(){function $d(){this._childs=[],this.transform=new $Gg(this)}$p($d,"laya.d3.animation.AnimationNode");var $v=$d.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.addChild=function($v){$v._parent=this,$v.transform.setParent(this.transform),this._childs.push($v)},$v.removeChild=function($v){var $g=this._childs.indexOf($v);-1!==$g&&this._childs.splice($g,1)},$v.getChildByName=function($v){for(var $g=0,$Q=this._childs.length;$g<$Q;$g++){var $d=this._childs[$g];if($d.name===$v)return $d}return null},$v.getChildByIndex=function($v){return this._childs[$v]},$v.getChildCount=function(){return this._childs.length},$v.cloneTo=function($v){var $g=$v;$g.name=this.name;for(var $Q=0,$d=this._childs.length;$Q<$d;$Q++){var $r=this._childs[$Q],$k=$r.clone();$g.addChild($k);var $$=$r.transform,$b=$k.transform;$b.setLocalPosition($$.getLocalPosition()),$b.setLocalRotation($$.getLocalRotation()),$b.setLocalScale($$.getLocalScale()),$b._localRotationEuler=$$._localRotationEuler,$b._setWorldMatrixIgnoreUpdate($$.getWorldMatrix())}},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$d.__init__=function(){$d.registerAnimationNodeProperty("localPosition",$d._getLocalPosition,$d._setLocalPosition),$d.registerAnimationNodeProperty("localRotation",$d._getLocalRotation,$d._setLocalRotation),$d.registerAnimationNodeProperty("localScale",$d._getLocalScale,$d._setLocalScale),$d.registerAnimationNodeProperty("localRotationEuler",$d._getLocalRotationEuler,$d._setLocalRotationEuler),$d.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$d._getParticleRenderSharedMaterialTintColor,$d._setParticleRenderSharedMaterialTintColor),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$d._getMeshRenderSharedMaterialTilingOffset,$d._setMeshRenderSharedMaterialTilingOffset),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$d._getMeshRenderSharedMaterialAlbedo,$d._setMeshRenderSharedMaterialAlbedo),$d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$d._getSkinnedMeshRenderSharedMaterialTilingOffset,$d._setSkinnedMeshRenderSharedMaterialTilingOffset),$d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$d._getSkinnedMeshRenderSharedMaterialAlbedo,$d._setSkinnedMeshRenderSharedMaterialAlbedo),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$d._getMeshRenderSharedMaterialAlbedo,$d._setMeshRenderSharedMaterialAlbedo),$d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$d._getSkinnedMeshRenderSharedMaterialAlbedo,$d._setSkinnedMeshRenderSharedMaterialAlbedo),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$d._getMeshRenderSharedMaterialIntensity,$d._setMeshRenderSharedMaterialIntensity),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$d._getMeshRenderSharedMaterialAlpha,$d._setMeshRenderSharedMaterialAlpha),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$d._getMeshRenderSharedMaterialAlphaColor,$d._setMeshRenderSharedMaterialAlphaColor),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$d._getMeshRenderSharedMaterialBaseColor,$d._setMeshRenderSharedMaterialBaseColor),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$d._getMeshRenderSharedMaterialDissolve,$d._setMeshRenderSharedMaterialDissolve),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$d._getMeshRenderSharedMaterialDissolveSpeed,$d._setMeshRenderSharedMaterialDissolveSpeed),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$d._getMeshRenderSharedMaterialMMultiplier,$d._setMeshRenderSharedMaterialMMultiplier),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$d._getMeshRenderSharedMaterialBaseScrollSpeedX,$d._setMeshRenderSharedMaterialBaseScrollSpeedX),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$d._getMeshRenderSharedMaterialBaseScrollSpeedY,$d._setMeshRenderSharedMaterialBaseScrollSpeedY),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$d._getMeshRenderSharedMaterialSecondScrollSpeedX,$d._setMeshRenderSharedMaterialSecondScrollSpeedX),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$d._getMeshRenderSharedMaterialSecondScrollSpeedY,$d._setMeshRenderSharedMaterialSecondScrollSpeedY),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$d._getMeshRenderSharedMaterialDetailTilingOffset,$d._setMeshRenderSharedMaterialDetailTilingOffset),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$d._getMeshRenderSharedMaterialDissolveTilingOffset,$d._setMeshRenderSharedMaterialDissolveTilingOffset),$d.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$d._getMeshRenderSharedMaterialMaskTilingOffset,$d._setMeshRenderSharedMaterialMaskTilingOffset)},$d.registerAnimationNodeProperty=function($v,$g,$Q){if($d._propertyIndexDic[$v])throw new Error("AnimationNode: this propertyName has registered.");$d._propertyIndexDic[$v]=$d._propertyIDCounter,$d._propertyGetFuncs[$d._propertyIDCounter]=$g,$d._propertySetFuncs[$d._propertyIDCounter]=$Q,$d._propertyIDCounter++},$d._getLocalPosition=function($v,$g){return $v?$v.transform.getLocalPosition():$g._transform.localPosition.elements},$d._setLocalPosition=function($v,$g,$Q){if($v)$v.transform.setLocalPosition($Q);else{var $d=$g._transform,$r=$d.localPosition;$r.elements=$Q,$d.localPosition=$r}},$d._getLocalRotation=function($v,$g){return $v?$v.transform.getLocalRotation():$g._transform.localRotation.elements},$d._setLocalRotation=function($v,$g,$Q){if($v)$v.transform.setLocalRotation($Q);else{var $d=$g._transform,$r=$d.localRotation;$r.elements=$Q,$d.localRotation=$r}},$d._getLocalScale=function($v,$g){return $v?$v.transform.getLocalScale():$g._transform.localScale.elements},$d._setLocalScale=function($v,$g,$Q){if($v)$v.transform.setLocalScale($Q);else{var $d=$g._transform,$r=$d.localScale;$r.elements=$Q,$d.localScale=$r}},$d._getLocalRotationEuler=function($v,$g){return $v?$v.transform.getLocalRotationEuler():$g._transform.localRotationEuler.elements},$d._setLocalRotationEuler=function($v,$g,$Q){if($v)$v.transform.setLocalRotationEuler($Q);else{var $d=$g._transform,$r=$d.localRotationEuler;$r.elements=$Q,$d.localRotationEuler=$r}},$d._getMeshRenderSharedMaterialTilingOffset=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $g.meshRender.sharedMaterial.tilingOffset.elements},$d._setMeshRenderSharedMaterialTilingOffset=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).tilingOffset).elements=$Q,$d.tilingOffset=$r)}else($r=($d=$g.meshRender.material).tilingOffset).elements=$Q,$d.tilingOffset=$r},$d._getMeshRenderSharedMaterialAlbedo=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $g.meshRender.sharedMaterial.albedoColor.elements},$d._setMeshRenderSharedMaterialAlbedo=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).albedoColor).elements=$Q,$d.albedoColor=$r)}else($r=($d=$g.meshRender.material).albedoColor).elements=$Q,$d.albedoColor=$r},$d._getSkinnedMeshRenderSharedMaterialTilingOffset=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $g.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$d._setSkinnedMeshRenderSharedMaterialTilingOffset=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.skinnedMeshRender.material).tilingOffset).elements=$Q,$d.tilingOffset=$r)}else($r=($d=$g.skinnedMeshRender.material).tilingOffset).elements=$Q,$d.tilingOffset=$r},$d._getSkinnedMeshRenderSharedMaterialAlbedo=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $g.skinnedMeshRender.sharedMaterial.albedoColor.elements},$d._setSkinnedMeshRenderSharedMaterialAlbedo=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.skinnedMeshRender.material).albedoColor).elements=$Q,$d.albedoColor=$r)}else($r=($d=$g.skinnedMeshRender.material).albedoColor).elements=$Q,$d.albedoColor=$r},$d._getParticleRenderSharedMaterialTintColor=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.particleRender.sharedMaterial.tintColor.elements:null}return $g.particleRender.sharedMaterial.tintColor.elements},$d._setParticleRenderSharedMaterialTintColor=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.particleRender.material).tintColor).elements=$Q,$d.tintColor=$r)}else($r=($d=$g.particleRender.material).tintColor).elements=$Q,$d.tintColor=$r},$d._getMeshRenderSharedMaterialAlphaColor=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $g.meshRender.sharedMaterial.alphaColor.elements},$d._setMeshRenderSharedMaterialAlphaColor=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).alphaColor).elements=$Q,$d.alphaColor=$r)}else($r=($d=$g.meshRender.material).alphaColor).elements=$Q,$d.alphaColor=$r},$d._getMeshRenderSharedMaterialBaseColor=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.baseColor.elements:null}return $g.meshRender.sharedMaterial.baseColor.elements},$d._setMeshRenderSharedMaterialBaseColor=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).baseColor).elements=$Q,$d.baseColor=$r)}else($r=($d=$g.meshRender.material).baseColor).elements=$Q,$d.baseColor=$r},$d._getMeshRenderSharedMaterialDissolve=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.dissolve:0}return $g.meshRender.sharedMaterial.dissolve},$d._setMeshRenderSharedMaterialDissolve=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.dissolve=$Q[0])}else $g.meshRender.material.dissolve=$Q[0]},$d._getMeshRenderSharedMaterialDissolveSpeed=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $g.meshRender.sharedMaterial.dissolveSpeed},$d._setMeshRenderSharedMaterialDissolveSpeed=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.dissolveSpeed=$Q[0])}else $g.meshRender.material.dissolveSpeed=$Q[0]},$d._getMeshRenderSharedMaterialMMultiplier=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.mMultiplier:0}return $g.meshRender.sharedMaterial.mMultiplier},$d._setMeshRenderSharedMaterialMMultiplier=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.mMultiplier=$Q[0])}else $g.meshRender.material.mMultiplier=$Q[0]},$d._getMeshRenderSharedMaterialBaseScrollSpeedX=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $g.meshRender.sharedMaterial.baseScrollSpeedX},$d._setMeshRenderSharedMaterialBaseScrollSpeedX=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.baseScrollSpeedX=$Q[0])}else $g.meshRender.material.baseScrollSpeedX=$Q[0]},$d._getMeshRenderSharedMaterialBaseScrollSpeedY=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $g.meshRender.sharedMaterial.baseScrollSpeedY},$d._setMeshRenderSharedMaterialBaseScrollSpeedY=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.baseScrollSpeedY=$Q[0])}else $g.meshRender.material.baseScrollSpeedY=$Q[0]},$d._getMeshRenderSharedMaterialSecondScrollSpeedX=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $g.meshRender.sharedMaterial.secondScrollSpeedX},$d._setMeshRenderSharedMaterialSecondScrollSpeedX=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.secondScrollSpeedX=$Q[0])}else $g.meshRender.material.secondScrollSpeedX=$Q[0]},$d._getMeshRenderSharedMaterialSecondScrollSpeedY=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $g.meshRender.sharedMaterial.secondScrollSpeedY},$d._setMeshRenderSharedMaterialSecondScrollSpeedY=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.secondScrollSpeedY=$Q[0])}else $g.meshRender.material.secondScrollSpeedY=$Q[0]},$d._getMeshRenderSharedMaterialAlpha=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.alpha:0}return $g.meshRender.sharedMaterial.alpha},$d._setMeshRenderSharedMaterialAlpha=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.alpha=$Q[0])}else $g.meshRender.material.alpha=$Q[0]},$d._getMeshRenderSharedMaterialIntensity=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.intensity:0}return $g.meshRender.sharedMaterial.intensity},$d._setMeshRenderSharedMaterialIntensity=function($v,$g,$Q){if($v){var $d=$v.transform._entity;$d&&($d.owner.meshRender.material.intensity=$Q[0])}else $g.meshRender.material.intensity=$Q[0]},$d._getMeshRenderSharedMaterialDetailTilingOffset=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $g.meshRender.sharedMaterial.detailTilingOffset.elements},$d._setMeshRenderSharedMaterialDetailTilingOffset=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).detailTilingOffset).elements=$Q,$d.detailTilingOffset=$r)}else($r=($d=$g.meshRender.material).detailTilingOffset).elements=$Q,$d.detailTilingOffset=$r},$d._getMeshRenderSharedMaterialDissolveTilingOffset=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $g.meshRender.sharedMaterial.dissolveTilingOffset.elements},$d._setMeshRenderSharedMaterialDissolveTilingOffset=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).dissolveTilingOffset).elements=$Q,$d.dissolveTilingOffset=$r)}else($r=($d=$g.meshRender.material).dissolveTilingOffset).elements=$Q,$d.dissolveTilingOffset=$r},$d._getMeshRenderSharedMaterialMaskTilingOffset=function($v,$g){if($v){var $Q=$v.transform._entity;return $Q?$Q.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $g.meshRender.sharedMaterial.maskTilingOffset.elements},$d._setMeshRenderSharedMaterialMaskTilingOffset=function($v,$g,$Q){var $d,$r;if($v){var $k=$v.transform._entity;$k&&(($r=($d=$k.owner.meshRender.material).maskTilingOffset).elements=$Q,$d.maskTilingOffset=$r)}else($r=($d=$g.meshRender.material).maskTilingOffset).elements=$Q,$d.maskTilingOffset=$r},$d._propertyIDCounter=0,$d._propertyIndexDic={},$d._propertySetFuncs=[],$d._propertyGetFuncs=[],$d}(),$L=function(){function $v(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $p($v,"laya.d3.animation.Keyframe"),$v}(),$H=function(){function $v(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $p($v,"laya.d3.animation.KeyframeNode"),$v}(),$N=(function(){function $v(){this._tempVector30=new $$g,this._tempVector31=new $$g,this._tempVector32=new $$g,this._a=new $$g,this._b=new $$g,this._c=new $$g,this._d=new $$g}$p($v,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $g=$v.prototype;$g.Init=function($v,$g,$Q,$d){$v.cloneTo(this._d),$g.cloneTo(this._c),$$g.scale($v,2,this._a),$$g.scale($Q,2,this._tempVector30),$$g.subtract(this._a,this._tempVector30,this._a),$$g.add(this._a,$g,this._a),$$g.add(this._a,$d,this._a),$$g.scale($Q,3,this._b),$$g.scale($v,3,this._tempVector30),$$g.subtract(this._b,this._tempVector30,this._b),$$g.subtract(this._b,$d,this._b),$$g.scale($g,2,this._tempVector30),$$g.subtract(this._b,this._tempVector30,this._b)},$g.Slerp=function($v,$g){$$g.scale(this._a,$v*$v*$v,this._tempVector30),$$g.scale(this._b,$v*$v,this._tempVector31),$$g.scale(this._c,$v,this._tempVector32),$$g.add(this._tempVector30,this._tempVector31,$g),$$g.add($g,this._tempVector32,$g),$$g.add($g,this._d,$g)}}(),function(){function $m($v,$g,$Q,$d){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$v,this._h=$g,this._minHeight=$Q,this._maxHeight=$d}$p($m,"laya.d3.core.HeightMap");var $v=$m.prototype;$v._inBounds=function($v,$g){return 0<=$v&&$v<this._h&&0<=$g&&$g<this._w},$v.getHeight=function($v,$g){return this._inBounds($v,$g)?this._datas[$v][$g]:NaN},$T(0,$v,"width",function(){return this._w}),$T(0,$v,"height",function(){return this._h}),$T(0,$v,"maxHeight",function(){return this._maxHeight}),$T(0,$v,"minHeight",function(){return this._minHeight}),$m.creatFromMesh=function($v,$g,$Q,$d){for(var $r=[],$k=[],$$=$v.getSubMeshCount(),$b=0;$b<$$;$b++){for(var $a=$v.getSubMesh($b),$M=$a._getVertexBuffer(),$Y=$M.getData(),$D=[],$J=0;$J<$Y.length;$J+=$M.vertexDeclaration.vertexStride/4){var $p=new $$g($Y[$J+0],$Y[$J+1],$Y[$J+2]);$D.push($p)}$r.push($D);var $T=$a._getIndexBuffer();$k.push($T.getData())}var $t=$v.boundingBox,$q=$t.min.x,$C=$t.min.z,$G=$t.max.x,$s=$t.max.z,$A=$t.min.y,$h=$t.max.y,$P=$G-$q,$W=$s-$C,$F=$d.elements[0]=$P/($g-1),$l=$d.elements[1]=$W/($Q-1),$o=new $m($g,$Q,$A,$h),$E=$m._tempRay,$V=$E.direction.elements;$V[0]=0,$V[1]=-1,$V[2]=0;var $Z=$h+.1;$E.origin.elements[1]=$Z;for(var $f=0;$f<$Q;$f++){var $X=$C+$f*$l;$o._datas[$f]=[];for(var $N=0;$N<$g;$N++){var $i=$q+$N*$F,$x=$E.origin.elements;$x[0]=$i,$x[2]=$X;var $w=$m._getPosition($E,$r,$k);$o._datas[$f][$N]=$w===Number.MAX_VALUE?NaN:$Z-$w}}return $o},$m.createFromImage=function($v,$g,$Q){for(var $d=$v.width,$r=$v.height,$k=new $m($d,$r,$g,$Q),$$=($Q-$g)/254,$b=$v.getPixels(),$a=0,$M=0;$M<$r;$M++)for(var $Y=$k._datas[$M]=[],$D=0;$D<$d;$D++){var $J=$b[$a++],$p=$b[$a++],$T=$b[$a++],$t=$b[$a++];$Y[$D]=255==$J&&255==$p&&255==$T&&255==$t?NaN:($J+$p+$T)/3*$$+$g}return $k},$m._getPosition=function($v,$g,$Q){for(var $d=Number.MAX_VALUE,$r=0;$r<$g.length;$r++)for(var $k=$g[$r],$$=$Q[$r],$b=0;$b<$$.length;$b+=3){var $a=$k[$$[$b+0]],$M=$k[$$[$b+1]],$Y=$k[$$[$b+2]],$D=$Tg.rayIntersectsTriangle($v,$a,$M,$Y);!isNaN($D)&&$D<$d&&($d=$D)}return $d},$D($m,["_tempRay",function(){return this._tempRay=new $rg(new $$g,new $$g)}])}(),function(){function $r(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$p($r,"laya.d3.core.Layer");var $v=$r.prototype;return $v._binarySearchIndex=function(){for(var $v=0,$g=$r._collsionTestList.length-1,$Q=0;$v<=$g;){$Q=Math.floor(($v+$g)/2);var $d=$r._collsionTestList[$Q];if($d==this._number)return $Q;$d>this._number?$g=$Q-1:$v=$Q+1}return $v},$v._addCollider=function($v){0===this._colliders.length&&$r._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$v._isRigidbody?(this._colliders.unshift($v),this._nonRigidbodyOffset++):this._colliders.push($v)},$v._removeCollider=function($v){var $g=this._colliders.indexOf($v);$g<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($g,1),0===this._colliders.length&&$r._collsionTestList.splice($r._collsionTestList.indexOf(this._number),1)},$T(0,$v,"number",function(){return this._number}),$T(0,$v,"visible",function(){return this._visible},function($v){this._visible=$v,$r._visibleLayers=$v?$r._visibleLayers|this.mask:$r._visibleLayers&~this.mask}),$T(0,$v,"mask",function(){return this._mask}),$T(1,$r,"visibleLayers",function(){return $r._visibleLayers},function($v){$r._visibleLayers=$v;for(var $g=0,$Q=$r._layerList.length;$g<$Q;$g++){var $d=$r._layerList[$g];$d._visible=0!=($d._mask&$r._visibleLayers)}}),$r.__init__=function(){$r._layerList.length=31;for(var $v=0;$v<31;$v++){var $g=new $r;$r._layerList[$v]=$g,0===$v?($g.name="Default Layer",$g.visible=!0):($g.name="Layer-"+$v,$g.visible=!1),$g._number=$v,$g._mask=Math.pow(2,$v)}$r.currentCreationLayer=$r._layerList[0]},$r.getLayerByNumber=function($v){if($v<0||30<$v)throw new Error("无法返回指定Layer，该number超出范围！");return $r._layerList[$v]},$r.getLayerByName=function($v){for(var $g=0;$g<31;$g++)if($r._layerList[$g].name===$v)return $r._layerList[$g];throw new Error("无法返回指定Layer,该name不存在")},$r.isVisible=function($v){return 0!=($v&$r._currentCameraCullingMask&$r._visibleLayers)},$r._layerList=[],$r._visibleLayers=2147483647,$r._collsionTestList=[],$r._currentCameraCullingMask=2147483647,$r.maxCount=31,$r.currentCreationLayer=null,$r}()),$i=(function(){function $v($v,$g,$Q){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$v,this._minCount=$g,this._maxCount=$Q}$p($v,"laya.d3.core.particleShuriKen.module.Burst");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.cloneTo=function($v){var $g=$v;$g._time=this._time,$g._minCount=this._minCount,$g._maxCount=this._maxCount},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"time",function(){return this._time}),$T(0,$g,"minCount",function(){return this._minCount}),$T(0,$g,"maxCount",function(){return this._maxCount})}(),function(){function $v($v){this._color=null,this.enbale=!1,this._color=$v}$p($v,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $g=$v.prototype;$g.cloneTo=function($v){var $g=$v;this._color.cloneTo($g._color),$g.enbale=this.enbale},$g.clone=function(){var $v;switch(this._color.type){case 0:$v=$w.createByConstant(this._color.constant.clone());break;case 1:$v=$w.createByGradient(this._color.gradient.clone());break;case 2:$v=$w.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$v=$w.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $g=new this.constructor($v);return $g.enbale=this.enbale,$g},$T(0,$g,"color",function(){return this._color})}(),function(){function $v(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$p($v,"laya.d3.core.particleShuriKen.module.Emission");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$g._destroy=function(){this._bursts=null,this._destroyed=!0},$g.getBurstsCount=function(){return this._bursts.length},$g.getBurstByIndex=function($v){return this._bursts[$v]},$g.addBurst=function($v){var $g=this._bursts.length;if(0<$g)for(var $Q=0;$Q<$g;$Q++)this._bursts[$Q].time>$v.time&&this._bursts.splice($Q,0,$v);this._bursts.push($v)},$g.removeBurst=function($v){var $g=this._bursts.indexOf($v);-1!==$g&&this._bursts.splice($g,1)},$g.removeBurstByIndex=function($v){this._bursts.splice($v,1)},$g.clearBurst=function(){this._bursts.length=0},$g.cloneTo=function($v){var $g=$v,$Q=$g._bursts;$Q.length=this._bursts.length;for(var $d=0,$r=this._bursts.length;$d<$r;$d++){var $k=$Q[$d];$k?this._bursts[$d].cloneTo($k):$Q[$d]=this._bursts[$d].clone()}$g._emissionRate=this._emissionRate,$g.enbale=this.enbale},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"destroyed",function(){return this._destroyed}),$T(0,$g,"emissionRate",function(){return this._emissionRate},function($v){if($v<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$v})}(),function(){function $d(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$p($d,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $v=$d.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.cloneTo=function($v){var $g=$v;$g._type=this._type,$g._constant=this._constant,this._overTime.cloneTo($g._overTime),$g._constantMin=this._constantMin,$g._constantMax=this._constantMax,this._overTimeMin.cloneTo($g._overTimeMin),this._overTimeMax.cloneTo($g._overTimeMax)},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$v,"frameOverTimeData",function(){return this._overTime}),$T(0,$v,"constant",function(){return this._constant}),$T(0,$v,"type",function(){return this._type}),$T(0,$v,"frameOverTimeDataMin",function(){return this._overTimeMin}),$T(0,$v,"constantMin",function(){return this._constantMin}),$T(0,$v,"frameOverTimeDataMax",function(){return this._overTimeMax}),$T(0,$v,"constantMax",function(){return this._constantMax}),$d.createByConstant=function($v){var $g=new $d;return $g._type=0,$g._constant=$v,$g},$d.createByOverTime=function($v){var $g=new $d;return $g._type=1,$g._overTime=$v,$g},$d.createByRandomTwoConstant=function($v,$g){var $Q=new $d;return $Q._type=2,$Q._constantMin=$v,$Q._constantMax=$g,$Q},$d.createByRandomTwoOverTime=function($v,$g){var $Q=new $d;return $Q._type=3,$Q._overTimeMin=$v,$Q._overTimeMax=$g,$Q},$d}()),$x=function(){function $M(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$p($M,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $v=$M.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.cloneTo=function($v){var $g=$v;$g._type=this._type,$g._separateAxes=this._separateAxes,$g._constant=this._constant,this._constantSeparate.cloneTo($g._constantSeparate),this._gradient.cloneTo($g._gradient),this._gradientX.cloneTo($g._gradientX),this._gradientY.cloneTo($g._gradientY),this._gradientZ.cloneTo($g._gradientZ),$g._constantMin=this._constantMin,$g._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($g._constantMinSeparate),this._constantMaxSeparate.cloneTo($g._constantMaxSeparate),this._gradientMin.cloneTo($g._gradientMin),this._gradientMax.cloneTo($g._gradientMax),this._gradientXMin.cloneTo($g._gradientXMin),this._gradientXMax.cloneTo($g._gradientXMax),this._gradientYMin.cloneTo($g._gradientYMin),this._gradientYMax.cloneTo($g._gradientYMax),this._gradientZMin.cloneTo($g._gradientZMin),this._gradientZMax.cloneTo($g._gradientZMax)},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$v,"gradientZ",function(){return this._gradientZ}),$T(0,$v,"constant",function(){return this._constant}),$T(0,$v,"gradient",function(){return this._gradient}),$T(0,$v,"separateAxes",function(){return this._separateAxes}),$T(0,$v,"type",function(){return this._type}),$T(0,$v,"constantSeparate",function(){return this._constantSeparate}),$T(0,$v,"gradientX",function(){return this._gradientX}),$T(0,$v,"gradientY",function(){return this._gradientY}),$T(0,$v,"gradientW",function(){return this._gradientW}),$T(0,$v,"gradientMin",function(){return this._gradientMin}),$T(0,$v,"constantMin",function(){return this._constantMin}),$T(0,$v,"gradientMax",function(){return this._gradientMax}),$T(0,$v,"constantMax",function(){return this._constantMax}),$T(0,$v,"gradientWMin",function(){return this._gradientWMin}),$T(0,$v,"constantMinSeparate",function(){return this._constantMinSeparate}),$T(0,$v,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$T(0,$v,"gradientXMin",function(){return this._gradientXMin}),$T(0,$v,"gradientXMax",function(){return this._gradientXMax}),$T(0,$v,"gradientWMax",function(){return this._gradientWMax}),$T(0,$v,"gradientYMin",function(){return this._gradientYMin}),$T(0,$v,"gradientYMax",function(){return this._gradientYMax}),$T(0,$v,"gradientZMin",function(){return this._gradientZMin}),$T(0,$v,"gradientZMax",function(){return this._gradientZMax}),$M.createByConstant=function($v){var $g=new $M;return $g._type=0,$g._separateAxes=!1,$g._constant=$v,$g},$M.createByConstantSeparate=function($v){var $g=new $M;return $g._type=0,$g._separateAxes=!0,$g._constantSeparate=$v,$g},$M.createByGradient=function($v){var $g=new $M;return $g._type=1,$g._separateAxes=!1,$g._gradient=$v,$g},$M.createByGradientSeparate=function($v,$g,$Q,$d){var $r=new $M;return $r._type=1,$r._separateAxes=!0,$r._gradientX=$v,$r._gradientY=$g,$r._gradientZ=$Q,$r._gradientW=$d,$r},$M.createByRandomTwoConstant=function($v,$g){var $Q=new $M;return $Q._type=2,$Q._separateAxes=!1,$Q._constantMin=$v,$Q._constantMax=$g,$Q},$M.createByRandomTwoConstantSeparate=function($v,$g){var $Q=new $M;return $Q._type=2,$Q._separateAxes=!0,$Q._constantMinSeparate=$v,$Q._constantMaxSeparate=$g,$Q},$M.createByRandomTwoGradient=function($v,$g){var $Q=new $M;return $Q._type=3,$Q._separateAxes=!1,$Q._gradientMin=$v,$Q._gradientMax=$g,$Q},$M.createByRandomTwoGradientSeparate=function($v,$g,$Q,$d,$r,$k,$$,$b){var $a=new $M;return $a._type=3,$a._separateAxes=!0,$a._gradientXMin=$v,$a._gradientXMax=$g,$a._gradientYMin=$Q,$a._gradientYMax=$d,$a._gradientZMin=$r,$a._gradientZMax=$k,$a._gradientWMin=$$,$a._gradientWMax=$b,$a},$M}(),$w=function(){function $d(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$p($d,"laya.d3.core.particleShuriKen.module.GradientColor");var $v=$d.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.cloneTo=function($v){var $g=$v;$g._type=this._type,this._constant.cloneTo($g._constant),this._constantMin.cloneTo($g._constantMin),this._constantMax.cloneTo($g._constantMax),this._gradient.cloneTo($g._gradient),this._gradientMin.cloneTo($g._gradientMin),this._gradientMax.cloneTo($g._gradientMax)},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$v,"gradient",function(){return this._gradient}),$T(0,$v,"constant",function(){return this._constant}),$T(0,$v,"type",function(){return this._type}),$T(0,$v,"gradientMin",function(){return this._gradientMin}),$T(0,$v,"constantMin",function(){return this._constantMin}),$T(0,$v,"gradientMax",function(){return this._gradientMax}),$T(0,$v,"constantMax",function(){return this._constantMax}),$d.createByConstant=function($v){var $g=new $d;return $g._type=0,$g._constant=$v,$g},$d.createByGradient=function($v){var $g=new $d;return $g._type=1,$g._gradient=$v,$g},$d.createByRandomTwoConstant=function($v,$g){var $Q=new $d;return $Q._type=2,$Q._constantMin=$v,$Q._constantMax=$g,$Q},$d.createByRandomTwoGradient=function($v,$g){var $Q=new $d;return $Q._type=3,$Q._gradientMin=$v,$Q._gradientMax=$g,$Q},$d}(),$m=(function(){function $v(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$p($v,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.addAlpha=function($v,$g){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$v&&($v=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$v,this._alphaElements[this._alphaCurrentLength++]=$g):DEBUG},$g.addRGB=function($v,$g){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$v&&($v=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$v,this._rgbElements[this._rgbCurrentLength++]=$g.x,this._rgbElements[this._rgbCurrentLength++]=$g.y,this._rgbElements[this._rgbCurrentLength++]=$g.z):DEBUG},$g.cloneTo=function($v){var $g=$v,$Q=0,$d=0;$g._alphaCurrentLength=this._alphaCurrentLength;var $r=$g._alphaElements;for($r.length=this._alphaElements.length,$Q=0,$d=this._alphaElements.length;$Q<$d;$Q++)$r[$Q]=this._alphaElements[$Q];$g._rgbCurrentLength=this._rgbCurrentLength;var $k=$g._rgbElements;for($k.length=this._rgbElements.length,$Q=0,$d=this._rgbElements.length;$Q<$d;$Q++)$k[$Q]=this._rgbElements[$Q]},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$T(0,$g,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $v(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$p($v,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.add=function($v,$g){this._currentLength<8?(6===this._currentLength&&1!==$v&&($v=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$v,this._elements[this._currentLength++]=$g):console.log("Warning:data count must lessEqual than 4")},$g.cloneTo=function($v){var $g=$v;$g._currentLength=this._currentLength;var $Q=$g._elements;$Q.length=this._elements.length;for(var $d=0,$r=this._elements.length;$d<$r;$d++)$Q[$d]=this._elements[$d]},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"gradientCount",function(){return this._currentLength/2})}(),function(){function $v(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$p($v,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.add=function($v,$g){this._currentLength<8?(6===this._currentLength&&1!==$v&&($v=1,DEBUG),this._elements[this._currentLength++]=$v,this._elements[this._currentLength++]=$g):DEBUG},$g.getKeyByIndex=function($v){return this._elements[2*$v]},$g.getValueByIndex=function($v){return this._elements[2*$v+1]},$g.getAverageValue=function(){for(var $v=0,$g=this._currentLength-2;$v<$g;$v+=2){this._elements[$v+1];this._elements[$v+3],this._elements[$v+2]-this._elements[$v]}return 0},$g.cloneTo=function($v){var $g=$v;$g._currentLength=this._currentLength;var $Q=$g._elements;$Q.length=this._elements.length;for(var $d=0,$r=this._elements.length;$d<$r;$d++)$Q[$d]=this._elements[$d]},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"gradientCount",function(){return this._currentLength/2})}(),function(){function $v(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$p($v,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.add=function($v,$g){this._currentLength<8?(6===this._currentLength&&1!==$v&&($v=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$v,this._elements[this._currentLength++]=$g.x,this._elements[this._currentLength++]=$g.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$g.cloneTo=function($v){var $g=$v;$g._currentLength=this._currentLength;var $Q=$g._elements;$Q.length=this._elements.length;for(var $d=0,$r=this._elements.length;$d<$r;$d++)$Q[$d]=this._elements[$d]},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"gradientCount",function(){return this._currentLength/3})}(),function(){function $b(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$p($b,"laya.d3.core.particleShuriKen.module.GradientSize");var $v=$b.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.getMaxSizeInGradient=function(){var $v=0,$g=0,$Q=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($v=0,$g=this._gradientX.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientX.getValueByIndex($v));for($v=0,$g=this._gradientY.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientY.getValueByIndex($v))}else for($v=0,$g=this._gradient.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradient.getValueByIndex($v));break;case 1:$Q=this._separateAxes?($Q=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$Q=Math.max($Q,this._constantMinSeparate.y),Math.max($Q,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($v=0,$g=this._gradientXMin.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientXMin.getValueByIndex($v));for($v=0,$g=this._gradientXMax.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientXMax.getValueByIndex($v));for($v=0,$g=this._gradientYMin.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientYMin.getValueByIndex($v));for($v=0,$g=this._gradientZMax.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientZMax.getValueByIndex($v))}else{for($v=0,$g=this._gradientMin.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientMin.getValueByIndex($v));for($v=0,$g=this._gradientMax.gradientCount;$v<$g;$v++)$Q=Math.max($Q,this._gradientMax.getValueByIndex($v))}}return $Q},$v.cloneTo=function($v){var $g=$v;$g._type=this._type,$g._separateAxes=this._separateAxes,this._gradient.cloneTo($g._gradient),this._gradientX.cloneTo($g._gradientX),this._gradientY.cloneTo($g._gradientY),this._gradientZ.cloneTo($g._gradientZ),$g._constantMin=this._constantMin,$g._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($g._constantMinSeparate),this._constantMaxSeparate.cloneTo($g._constantMaxSeparate),this._gradientMin.cloneTo($g._gradientMin),this._gradientMax.cloneTo($g._gradientMax),this._gradientXMin.cloneTo($g._gradientXMin),this._gradientXMax.cloneTo($g._gradientXMax),this._gradientYMin.cloneTo($g._gradientYMin),this._gradientYMax.cloneTo($g._gradientYMax),this._gradientZMin.cloneTo($g._gradientZMin),this._gradientZMax.cloneTo($g._gradientZMax)},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$v,"gradientZ",function(){return this._gradientZ}),$T(0,$v,"gradient",function(){return this._gradient}),$T(0,$v,"separateAxes",function(){return this._separateAxes}),$T(0,$v,"type",function(){return this._type}),$T(0,$v,"gradientMin",function(){return this._gradientMin}),$T(0,$v,"constantMin",function(){return this._constantMin}),$T(0,$v,"gradientX",function(){return this._gradientX}),$T(0,$v,"gradientY",function(){return this._gradientY}),$T(0,$v,"gradientMax",function(){return this._gradientMax}),$T(0,$v,"constantMax",function(){return this._constantMax}),$T(0,$v,"constantMinSeparate",function(){return this._constantMinSeparate}),$T(0,$v,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$T(0,$v,"gradientXMin",function(){return this._gradientXMin}),$T(0,$v,"gradientXMax",function(){return this._gradientXMax}),$T(0,$v,"gradientYMin",function(){return this._gradientYMin}),$T(0,$v,"gradientYMax",function(){return this._gradientYMax}),$T(0,$v,"gradientZMin",function(){return this._gradientZMin}),$T(0,$v,"gradientZMax",function(){return this._gradientZMax}),$b.createByGradient=function($v){var $g=new $b;return $g._type=0,$g._separateAxes=!1,$g._gradient=$v,$g},$b.createByGradientSeparate=function($v,$g,$Q){var $d=new $b;return $d._type=0,$d._separateAxes=!0,$d._gradientX=$v,$d._gradientY=$g,$d._gradientZ=$Q,$d},$b.createByRandomTwoConstant=function($v,$g){var $Q=new $b;return $Q._type=1,$Q._separateAxes=!1,$Q._constantMin=$v,$Q._constantMax=$g,$Q},$b.createByRandomTwoConstantSeparate=function($v,$g){var $Q=new $b;return $Q._type=1,$Q._separateAxes=!0,$Q._constantMinSeparate=$v,$Q._constantMaxSeparate=$g,$Q},$b.createByRandomTwoGradient=function($v,$g){var $Q=new $b;return $Q._type=2,$Q._separateAxes=!1,$Q._gradientMin=$v,$Q._gradientMax=$g,$Q},$b.createByRandomTwoGradientSeparate=function($v,$g,$Q,$d,$r,$k){var $$=new $b;return $$._type=2,$$._separateAxes=!0,$$._gradientXMin=$v,$$._gradientXMax=$g,$$._gradientYMin=$Q,$$._gradientYMax=$d,$$._gradientZMin=$r,$$._gradientZMax=$k,$$},$b}()),$K=function(){function $b(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$p($b,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $v=$b.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.cloneTo=function($v){var $g=$v;$g._type=this._type,this._constant.cloneTo($g._constant),this._gradientX.cloneTo($g._gradientX),this._gradientY.cloneTo($g._gradientY),this._gradientZ.cloneTo($g._gradientZ),this._constantMin.cloneTo($g._constantMin),this._constantMax.cloneTo($g._constantMax),this._gradientXMin.cloneTo($g._gradientXMin),this._gradientXMax.cloneTo($g._gradientXMax),this._gradientYMin.cloneTo($g._gradientYMin),this._gradientYMax.cloneTo($g._gradientYMax),this._gradientZMin.cloneTo($g._gradientZMin),this._gradientZMax.cloneTo($g._gradientZMax)},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$v,"gradientZ",function(){return this._gradientZ}),$T(0,$v,"constant",function(){return this._constant}),$T(0,$v,"type",function(){return this._type}),$T(0,$v,"gradientXMax",function(){return this._gradientXMax}),$T(0,$v,"constantMin",function(){return this._constantMin}),$T(0,$v,"gradientX",function(){return this._gradientX}),$T(0,$v,"gradientY",function(){return this._gradientY}),$T(0,$v,"gradientXMin",function(){return this._gradientXMin}),$T(0,$v,"constantMax",function(){return this._constantMax}),$T(0,$v,"gradientYMin",function(){return this._gradientYMin}),$T(0,$v,"gradientYMax",function(){return this._gradientYMax}),$T(0,$v,"gradientZMin",function(){return this._gradientZMin}),$T(0,$v,"gradientZMax",function(){return this._gradientZMax}),$b.createByConstant=function($v){var $g=new $b;return $g._type=0,$g._constant=$v,$g},$b.createByGradient=function($v,$g,$Q){var $d=new $b;return $d._type=1,$d._gradientX=$v,$d._gradientY=$g,$d._gradientZ=$Q,$d},$b.createByRandomTwoConstant=function($v,$g){var $Q=new $b;return $Q._type=2,$Q._constantMin=$v,$Q._constantMax=$g,$Q},$b.createByRandomTwoGradient=function($v,$g,$Q,$d,$r,$k){var $$=new $b;return $$._type=3,$$._gradientXMin=$v,$$._gradientXMax=$g,$$._gradientYMin=$Q,$$._gradientYMax=$d,$$._gradientZMin=$r,$$._gradientZMax=$k,$$},$b}(),$c=(function(){function $v($v){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$v}$p($v,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.cloneTo=function($v){var $g=$v;this._angularVelocity.cloneTo($g._angularVelocity),$g.enbale=this.enbale},$g.clone=function(){var $v;switch(this._angularVelocity.type){case 0:$v=this._angularVelocity.separateAxes?$x.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$x.createByConstant(this._angularVelocity.constant);break;case 1:$v=this._angularVelocity.separateAxes?$x.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$x.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$v=this._angularVelocity.separateAxes?$x.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$x.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$v=this._angularVelocity.separateAxes?$x.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$x.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $g=new this.constructor($v);return $g.enbale=this.enbale,$g},$T(0,$g,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $v(){this.enable=!1,this.randomDirection=!1}$p($v,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $g=$v.prototype;return $h.imps($g,{"laya.d3.core.IClone":!0}),$g._getShapeBoundBox=function($v){throw new Error("BaseShape: must override it.")},$g._getSpeedBoundBox=function($v){throw new Error("BaseShape: must override it.")},$g.generatePositionAndDirection=function($v,$g,$Q,$d){throw new Error("BaseShape: must override it.")},$g._calculateProceduralBounds=function($v,$g,$Q){this._getShapeBoundBox($v);var $d=$v.min,$r=$v.max;$$g.multiply($d,$g,$d),$$g.multiply($r,$g,$r);var $k=new $Iv(new $$g,new $$g);this.randomDirection?($k.min=new $$g(-1,-1,-1),$k.max=new $$g(1,1,1)):this._getSpeedBoundBox($k);var $$=new $Iv(new $$g,new $$g),$b=$$.min,$a=$$.max;$$g.scale($k.min,$Q.y,$b),$$g.scale($k.max,$Q.y,$a),$$g.add($v.min,$b,$b),$$g.add($v.max,$a,$a),$$g.min($v.min,$b,$v.min),$$g.max($v.max,$b,$v.max);var $M=new $Iv(new $$g,new $$g),$Y=$M.min,$D=$M.max;$$g.scale($k.min,$Q.x,$Y),$$g.scale($k.max,$Q.x,$D),$$g.min($M.min,$D,$b),$$g.max($M.min,$D,$a),$$g.min($v.min,$b,$v.min),$$g.max($v.max,$b,$v.max)},$g.cloneTo=function($v){$v.enable=this.enable},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$v}()),$n=function(){function $k(){}return $p($k,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$k._randomPointUnitArcCircle=function($v,$g,$Q){var $d=$g.elements,$r=NaN;$r=$Q?$Q.getFloat()*$v:Math.random()*$v,$d[0]=Math.cos($r),$d[1]=Math.sin($r)},$k._randomPointInsideUnitArcCircle=function($v,$g,$Q){var $d=$g.elements;$k._randomPointUnitArcCircle($v,$g,$Q);var $r=NaN;$r=$Q?Math.pow($Q.getFloat(),.5):Math.pow(Math.random(),.5),$d[0]=$d[0]*$r,$d[1]=$d[1]*$r},$k._randomPointUnitCircle=function($v,$g){var $Q=$v.elements,$d=NaN;$d=$g?$g.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$Q[0]=Math.cos($d),$Q[1]=Math.sin($d)},$k._randomPointInsideUnitCircle=function($v,$g){var $Q=$v.elements;$k._randomPointUnitCircle($v);var $d=NaN;$d=$g?Math.pow($g.getFloat(),.5):Math.pow(Math.random(),.5),$Q[0]=$Q[0]*$d,$Q[1]=$Q[1]*$d},$k._randomPointUnitSphere=function($v,$g){var $Q=$v.elements,$d=NaN,$r=NaN;$r=$g?($d=$Q[2]=2*$g.getFloat()-1,$g.getFloat()*Math.PI*2):($d=$Q[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $k=Math.sqrt(1-$d*$d);$Q[0]=$k*Math.cos($r),$Q[1]=$k*Math.sin($r)},$k._randomPointInsideUnitSphere=function($v,$g){var $Q=$v.elements;$k._randomPointUnitSphere($v);var $d=NaN;$d=$g?Math.pow($g.getFloat(),1/3):Math.pow(Math.random(),1/3),$Q[0]=$Q[0]*$d,$Q[1]=$Q[1]*$d,$Q[2]=$Q[2]*$d},$k._randomPointInsideHalfUnitBox=function($v,$g){var $Q=$v.elements;$g?($Q[0]=$g.getFloat()-.5,$Q[1]=$g.getFloat()-.5,$Q[2]=$g.getFloat()-.5):($Q[0]=Math.random()-.5,$Q[1]=Math.random()-.5,$Q[2]=Math.random()-.5)},$k}(),$y=(function(){function $v($v){this._size=null,this.enbale=!1,this._size=$v}$p($v,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.cloneTo=function($v){var $g=$v;this._size.cloneTo($g._size),$g.enbale=this.enbale},$g.clone=function(){var $v;switch(this._size.type){case 0:$v=this._size.separateAxes?$m.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$m.createByGradient(this._size.gradient.clone());break;case 1:$v=this._size.separateAxes?$m.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$m.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$v=this._size.separateAxes?$m.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$m.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $g=new this.constructor($v);return $g.enbale=this.enbale,$g},$T(0,$g,"size",function(){return this._size})}(),function(){function $d(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$p($d,"laya.d3.core.particleShuriKen.module.StartFrame");var $v=$d.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.cloneTo=function($v){var $g=$v;$g._type=this._type,$g._constant=this._constant,$g._constantMin=this._constantMin,$g._constantMax=this._constantMax},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$v,"constant",function(){return this._constant}),$T(0,$v,"type",function(){return this._type}),$T(0,$v,"constantMin",function(){return this._constantMin}),$T(0,$v,"constantMax",function(){return this._constantMax}),$d.createByConstant=function($v){var $g=new $d;return $g._type=0,$g._constant=$v,$g},$d.createByRandomTwoConstant=function($v,$g){var $Q=new $d;return $Q._type=1,$Q._constantMin=$v,$Q._constantMax=$g,$Q},$d}()),$e=(function(){function $v($v,$g){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $kg(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$v,this._startFrame=$g}$p($v,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.cloneTo=function($v){var $g=$v;this.tiles.cloneTo($g.tiles),$g.type=this.type,$g.randomRow=this.randomRow,this._frame.cloneTo($g._frame),this._startFrame.cloneTo($g._startFrame),$g.cycles=this.cycles,$g.enableUVChannels=this.enableUVChannels,$g.enable=this.enable},$g.clone=function(){var $v,$g;switch(this._frame.type){case 0:$v=$i.createByConstant(this._frame.constant);break;case 1:$v=$i.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$v=$i.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$v=$i.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$g=$y.createByConstant(this._startFrame.constant);break;case 1:$g=$y.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $Q=new this.constructor($v,$g);return this.tiles.cloneTo($Q.tiles),$Q.type=this.type,$Q.randomRow=this.randomRow,$Q.cycles=this.cycles,$Q.enableUVChannels=this.enableUVChannels,$Q.enable=this.enable,$Q},$T(0,$g,"frame",function(){return this._frame}),$T(0,$g,"startFrame",function(){return this._startFrame})}(),function(){function $v($v){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$v}$p($v,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $g=$v.prototype;$h.imps($g,{"laya.d3.core.IClone":!0}),$g.cloneTo=function($v){var $g=$v;this._velocity.cloneTo($g._velocity),$g.enbale=this.enbale,$g.space=this.space},$g.clone=function(){var $v;switch(this._velocity.type){case 0:$v=$K.createByConstant(this._velocity.constant.clone());break;case 1:$v=$K.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$v=$K.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$v=$K.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $g=new this.constructor($v);return $g.enbale=this.enbale,$g.space=this.space,$g},$T(0,$g,"velocity",function(){return this._velocity})}(),function(){function $v(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $Jg,this._vb=$cg.create($v._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$Kg.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$wg.nameKey.getID("LINE"),this._shaderCompile=$Fg._preCompileShader[this._sharderNameID]}$p($v,"laya.d3.core.PhasorSpriter3D");var $g=$v.prototype;return $g.line=function($v,$g,$Q,$d){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($v.x,$v.y,$v.z,$g.x,$g.y,$g.z,$g.w),this.addVertex($Q.x,$Q.y,$Q.z,$d.x,$d.y,$d.z,$d.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$g.circle=function($v,$g,$Q,$d,$r,$k){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$g,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$g,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$v,Math.cos(this._tempNumver0)*$v,0,$Q,$d,$r,$k),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$g.plane=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$d/2,this._tempNumver1=$r/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($v-this._tempNumver0,$g+this._tempNumver1,$Q,$k,$$,$b,$a),this.addVertex($v+this._tempNumver0,$g+this._tempNumver1,$Q,$k,$$,$b,$a),this.addVertex($v-this._tempNumver0,$g-this._tempNumver1,$Q,$k,$$,$b,$a),this.addVertex($v+this._tempNumver0,$g-this._tempNumver1,$Q,$k,$$,$b,$a),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$g.box=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$d/2,this._tempNumver1=$r/2,this._tempNumver2=$k/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($v-this._tempNumver0,$g+this._tempNumver1,$Q+this._tempNumver2,$$,$b,$a,$M),this.addVertex($v+this._tempNumver0,$g+this._tempNumver1,$Q+this._tempNumver2,$$,$b,$a,$M),this.addVertex($v-this._tempNumver0,$g-this._tempNumver1,$Q+this._tempNumver2,$$,$b,$a,$M),this.addVertex($v+this._tempNumver0,$g-this._tempNumver1,$Q+this._tempNumver2,$$,$b,$a,$M),this.addVertex($v+this._tempNumver0,$g+this._tempNumver1,$Q-this._tempNumver2,$$,$b,$a,$M),this.addVertex($v-this._tempNumver0,$g+this._tempNumver1,$Q-this._tempNumver2,$$,$b,$a,$M),this.addVertex($v+this._tempNumver0,$g-this._tempNumver1,$Q-this._tempNumver2,$$,$b,$a,$M),this.addVertex($v-this._tempNumver0,$g-this._tempNumver1,$Q-this._tempNumver2,$$,$b,$a,$M),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$g.cone=function($v,$g,$Q,$d,$r,$k,$$){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$Q+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$Q>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$Q,this.addVertexIndex(0,$g,0,$d,$r,$k,$$,this._tempUint0),this.addVertexIndex(0,0,0,$d,$r,$k,$$,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$Q;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($v*this._tempNumver2,0,$v*this._tempNumver3,$d,$r,$k,$$,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$Q-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($v*this._tempNumver2,0,$v*this._tempNumver3,$d,$r,$k,$$,this._tempUint0+(this._tempInt0+$Q)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$Q-1?this.addIndexes(this._tempUint1+$Q+2):this.addIndexes(this._tempUint1+this._tempInt0+$Q+1),this.addIndexes(this._tempUint1+this._tempInt0+$Q),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$g.boundingBoxLine=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($v,$r,$k,$$,$b,$a,$M),this.addVertex($d,$r,$k,$$,$b,$a,$M),this.addVertex($v,$g,$k,$$,$b,$a,$M),this.addVertex($d,$g,$k,$$,$b,$a,$M),this.addVertex($d,$r,$Q,$$,$b,$a,$M),this.addVertex($v,$r,$Q,$$,$b,$a,$M),this.addVertex($d,$g,$Q,$$,$b,$a,$M),this.addVertex($v,$g,$Q,$$,$b,$a,$M),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$g.addVertex=function($v,$g,$Q,$d,$r,$k,$$){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$v,this._vbData[this._posInVBData+1]=$g,this._vbData[this._posInVBData+2]=$Q,this._vbData[this._posInVBData+3]=$d,this._vbData[this._posInVBData+4]=$r,this._vbData[this._posInVBData+5]=$k,this._vbData[this._posInVBData+6]=$$,this._posInVBData+=this._floatSizePerVer,this},$g.addVertexIndex=function($v,$g,$Q,$d,$r,$k,$$,$b){return this._hasBegun||this.addVertexIndexException(),this._vbData[$b]=$v,this._vbData[$b+1]=$g,this._vbData[$b+2]=$Q,this._vbData[$b+3]=$d,this._vbData[$b+4]=$r,this._vbData[$b+5]=$k,this._vbData[$b+6]=$$,($b+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$b),this},$g.addIndexes=function($v){var $g=arguments;this._hasBegun||this.addVertexIndexException();for(var $Q=0;$Q<$g.length;$Q++)this._ibData[this._posInIBData]=$g[$Q],this._posInIBData++;return this},$g.begin=function($v,$g){return this._hasBegun&&this.beginException0(),1!==$v&&4!==$v&&this.beginException1(),this._primitiveType=$v,this._camera=$g,this._hasBegun=!0,this},$g.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$g.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($v._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$F.drawCall++,$Z.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$g.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$g.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$g.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$g.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$g.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$g.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(28,[new $$v(0,"vector3",0),new $$v(12,"vector4",1)])}]),$v}()),$R=function(){function $v(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$v._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $Jg}$p($v,"laya.d3.core.render.RenderElement");var $g=$v.prototype;return $g.getDynamicBatchBakedVertexs=function($v){for(var $g=this._renderObj._getVertexBuffer($v),$Q=$g.getData().slice(),$d=$g.vertexDeclaration,$r=$d.getVertexElementByUsage(0).offset/4,$k=$d.getVertexElementByUsage(3).offset/4,$$=this._sprite3D.transform,$b=$$.worldMatrix,$a=$$.rotation,$M=$d.vertexStride/4,$Y=0,$D=$Q.length;$Y<$D;$Y+=$M){var $J=$Y+$r,$p=$Y+$k;$qg.transformVector3ArrayToVector3ArrayCoordinate($Q,$J,$b,$Q,$J),$qg.transformVector3ArrayByQuat($Q,$p,$a,$Q,$p)}return $Q},$g.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$g._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$T(0,$g,"id",function(){return this._id}),$T(0,$g,"renderObj",function(){return this._renderObj},function($v){this._renderObj!==$v&&(this._renderObj=$v)}),$v._uniqueIDCounter=0,$v}(),$z=function(){function $g($v){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$g._uniqueIDCounter,this._needSort=!1,this._scene=$v,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$p($g,"laya.d3.core.render.RenderQueue");var $v=$g.prototype;return $v._sortOpaqueFunc=function($v,$g){if($v._render&&$g._render){var $Q=$v._material.renderQueue-$g._material.renderQueue;return 0==$Q?$v._render._distanceForSort-$g._render._distanceForSort:$Q}return 0},$v._sortAlphaFunc=function($v,$g){if($v._render&&$g._render){var $Q=$v._material.renderQueue-$g._material.renderQueue;return 0==$Q?$g._render._distanceForSort-$v._render._distanceForSort:$Q}return 0},$v._begainRenderElement=function($v,$g,$Q){return!!$g._beforeRender($v)},$v._sortAlpha=function($v){$g._cameraPosition=$v,this._finalElements.sort(this._sortAlphaFunc)},$v._sortOpaque=function($v){$g._cameraPosition=$v,this._finalElements.sort(this._sortOpaqueFunc)},$v._preRender=function($v){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$v._render=function($v,$g){for(var $Q,$d,$r,$k,$$,$b,$a=$F.loopCount,$M=this._scene,$Y=$v.camera,$D=($Y.id,!1),$J=0,$p=this._finalElements.length;$J<$p;$J++){var $T,$t,$q,$C=this._finalElements[$J];if(null!=$C._onPreRenderFunction&&$C._onPreRenderFunction.call($C._sprite3D,$v),0===$C._type){if($v.owner=$q=$C._sprite3D,$v.renderElement=$C,$q._preRenderUpdateComponents($v),$T=$C.renderObj,$t=$C._material,this._begainRenderElement($v,$T,$t)){if($Q=$T._getVertexBuffers(),!($r=($d=$T._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$d.id]){this._errorRecord[$d.id]=1;var $G="vertexBuffer:"+("("+$d._destroyed+","+$d._released+","+$d._referenceCount+","+$d._buffer+")")+", material:"+($t?$t.__className+"("+$t._destroyed+","+$t._released+")":"null")+", owner:"+($q?$q.__className+"("+$q._destroyed+","+$q._activeInHierarchy+","+$q._displayedInStage+")":"null")+", renderObj:"+($T?$T.__className+"("+$T._destroyed+","+$T._released+","+$T._referenceCount+")":"")+", parent:, url:"+($q?$q.url:"")+", disposeStack:"+$d.disposeStack;$h.recordError("报错：unknown vertexDeclaration  "+$G)}continue}if($D=($k=$v._shader=$t._getShader($M._shaderDefineValue,$r.shaderDefineValue,$q._shaderDefineValue)).bind()||$a!==$k._uploadLoopCount,$Q){if($k._uploadVertexBuffer!==$Q||$D){for(var $s=0;$s<$Q.length;$s++){var $A=$Q[$s];$k.uploadAttributesX($A.vertexDeclaration.shaderValues.data,$A)}$k._uploadVertexBuffer=$Q}}else($k._uploadVertexBuffer!==$d||$D)&&($k.uploadAttributes($r.shaderValues.data,null),$k._uploadVertexBuffer=$d);($k._uploadScene!==$M||$D)&&($k.uploadSceneUniforms($M._shaderValues.data),$k._uploadScene=$M),($Y!==$k._uploadCamera||$k._uploadSprite3D!==$q||$D)&&($k.uploadSpriteUniforms($q._shaderValues.data),$k._uploadSprite3D=$q),($Y!==$k._uploadCamera||$D)&&($k.uploadCameraUniforms($Y._shaderValues.data),$k._uploadCamera=$Y),($k._uploadMaterial!==$t||$D)&&($t._upload(),$k._uploadMaterial=$t),$$!==$t?($t._setRenderStateBlendDepth(),$t._setRenderStateFrontFace($g,$q.transform),$$=$t,$b=$q):$b!==$q&&($t._setRenderStateFrontFace($g,$q.transform),$b=$q),$T._render($v),$k._uploadLoopCount=$a}$q._postRenderUpdateComponents($v)}else if(2===$C._type){$C.renderObj;$v.owner=$q=$C._sprite3D,$v.renderElement=$C,$v._batchIndexStart=$C._tempBatchIndexStart,$v._batchIndexEnd=$C._tempBatchIndexEnd,$T=$C.renderObj,$t=$C._material,this._begainRenderElement($v,$T,$t)&&($r=($d=$T._getVertexBuffer(0)).vertexDeclaration,$D=($k=$v._shader=$t._getShader($M._shaderDefineValue,$r.shaderDefineValue,$q._shaderDefineValue)).bind()||$a!==$k._uploadLoopCount,($k._uploadVertexBuffer!==$d||$D)&&($k.uploadAttributes($r.shaderValues.data,null),$k._uploadVertexBuffer=$d),($k._uploadScene!==$M||$D)&&($k.uploadSceneUniforms($M._shaderValues.data),$k._uploadScene=$M),($Y!==$k._uploadCamera||$k._uploadSprite3D!==$q||$D)&&($k.uploadSpriteUniforms($q._shaderValues.data),$k._uploadSprite3D=$q),($Y!==$k._uploadCamera||$D)&&($k.uploadCameraUniforms($Y._shaderValues.data),$k._uploadCamera=$Y),($k._uploadMaterial!==$t||$D)&&($t._upload(),$k._uploadMaterial=$t),$$!==$t?($t._setRenderStateBlendDepth(),$t._setRenderStateFrontFace($g,$q.transform),$$=$t,$b=$q):$b!==$q&&($t._setRenderStateFrontFace($g,$q.transform),$b=$q),$T._render($v),$k._uploadLoopCount=$a)}}},$v._renderShadow=function($v,$g){for(var $Q,$d,$r,$k,$$,$b=$F.loopCount,$a=this._scene,$M=$v.camera,$Y=!1,$D=0,$J=this._finalElements.length;$D<$J;$D++){var $p,$T,$t,$q=this._finalElements[$D];0===$q._type&&($v.owner=$t=$q._sprite3D,$g||$t._projectionViewWorldUpdateCamera===$M&&$t._projectionViewWorldUpdateLoopCount===$F.loopCount||($t._render._renderUpdate($v._projectionViewMatrix),$t._projectionViewWorldUpdateLoopCount=$F.loopCount,$t._projectionViewWorldUpdateCamera=$M),$v.renderElement=$q,$t._preRenderUpdateComponents($v),$p=$q.renderObj,$T=$q._material,this._begainRenderElement($v,$p,null)&&($d=($Q=$p._getVertexBuffer(0)).vertexDeclaration,$Y=($r=$v._shader=$T._getShader($a._shaderDefineValue,$d.shaderDefineValue,$t._shaderDefineValue)).bind()||$b!==$r._uploadLoopCount,($r._uploadVertexBuffer!==$Q||$Y)&&($r.uploadAttributes($d.shaderValues.data,null),$r._uploadVertexBuffer=$Q),($M!==$r._uploadCamera||$r._uploadSprite3D!==$t||$Y)&&($r.uploadSpriteUniforms($t._shaderValues.data),$r._uploadSprite3D=$t),($M!==$r._uploadCamera||$Y)&&($r.uploadCameraUniforms($M._shaderValues.data),$r._uploadCamera=$M),($r._uploadMaterial!==$T||$Y)&&($T._upload(),$r._uploadMaterial=$T),$r._uploadRenderElement,$k!==$T?($T._setRenderStateFrontFace(!1,$t.transform),$k=$T,$$=$t):$$!==$t&&($T._setRenderStateFrontFace(!1,$t.transform),$$=$t),$p._render($v),$r._uploadLoopCount=$b),$t._postRenderUpdateComponents($v))}},$v._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$v._addRenderElement=function($v){this._renderElements.push($v),this._needSort=!0},$v._addDynamicBatchElement=function($v){this._dynamicBatchCombineRenderElements.push($v)},$T(0,$v,"id",function(){return this._id}),$g._uniqueIDCounter=0,$g._cameraPosition=null,$g}(),$U=function(){function $v(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $p($v,"laya.d3.core.render.RenderState"),$v.clientWidth=0,$v.clientHeight=0,$v}(),$I=function(){function $$($v,$g){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $Ov(new $$g,0),this._corners=[new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g],this._boundingBoxCenter=new $$g,this._children=$d(8),this._objects=[],this._tempBoundBoxCorners=[new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g],this._scene=$v,this._currentDepth=$g}$p($$,"laya.d3.core.scene.OctreeNode");var $v=$$.prototype;return $h.imps($v,{"laya.d3.core.scene.ITreeNode":!0}),$v.init=function($v,$g){var $Q=new $$g,$d=new $$g;$$g.scale($g,-.5,$Q),$$g.scale($g,.5,$d),$$g.add($Q,$v,$Q),$$g.add($d,$v,$d),this.exactBox=new $Iv($Q,$d),this.relaxBox=new $Iv($Q,$d)},$v.addTreeNode=function($v){1===Collision.boxContainsBox(this._relaxBox,$v.boundingBox)?this.addNodeDown($v,0):this.addObject($v)},$v.addChild=function($v){var $g=this._children[$v];if(null==$g){$g=new $$(this._scene,this._currentDepth+1),(this._children[$v]=$g)._parent=this,$$g.subtract(this._exactBox.max,this._exactBox.min,$$.tempSize),$$g.multiply($$.tempSize,$$._octreeSplit[$v],$$.tempCenter),$$g.add(this._exactBox.min,$$.tempCenter,$$.tempCenter),$$g.scale($$.tempSize,.25,$$.tempSize);var $Q=new $$g,$d=new $$g;$$g.subtract($$.tempCenter,$$.tempSize,$Q),$$g.add($$.tempCenter,$$.tempSize,$d),$g.exactBox=new $Iv($Q,$d),$$g.scale($$.tempSize,$$.relax,$$.tempSize);var $r=new $$g,$k=new $$g;$$g.subtract($$.tempCenter,$$.tempSize,$r),$$g.add($$.tempCenter,$$.tempSize,$k),$g.relaxBox=new $Iv($r,$k)}return $g},$v.addObject=function($v){($v._treeNode=this)._objects.push($v)},$v.removeObject=function($v){if($v._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $g=this._objects.indexOf($v);return-1!==$g&&(this._objects.splice($g,1),!0)},$v.clearObject=function(){this._objects.length=0},$v.addNodeUp=function($v,$g){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$v.boundingBox)?this._parent.addNodeUp($v,$g-1):this.addNodeDown($v,$g)},$v.addNodeDown=function($v,$g){if($g<this._scene.treeLevel){var $Q=this.inChildIndex($v.boundingBoxCenter),$d=this.addChild($Q);1===Collision.boxContainsBox($d._relaxBox,$v.boundingBox)?$d.addNodeDown($v,++$g):this.addObject($v)}else this.addObject($v)},$v.inChildIndex=function($v){return 4*($v.z<this._boundingBoxCenter.z?0:1)+2*($v.y<this._boundingBoxCenter.y?0:1)+($v.x<this._boundingBoxCenter.x?0:1)},$v.updateObject=function($v){1===Collision.boxContainsBox(this._relaxBox,$v.boundingBox)?(this.removeObject($v),$v._treeNode=null,this.addNodeDown($v,this._currentDepth)):this._parent&&(this.removeObject($v),$v._treeNode=null,this._parent.addNodeUp($v,this._currentDepth-1))},$v.cullingObjects=function($v,$g,$Q,$d,$r){var $k,$$=0,$b=0,$a=0,$M=this._scene._dynamicBatchManager;for($$=0,$k=this._objects.length;$$<$k;$$++){var $Y=this._objects[$$];if($N.isVisible($Y._owner.layer.mask)&&$Y.enable){if($g&&($F.treeSpriteCollision+=1,0===$v.containsBoundSphere($Y.boundingSphere)))continue;$Y._renderUpdate($r),$Y._distanceForSort=$$g.distance($Y.boundingSphere.center,$d)+$Y.sortingFudge;var $D=$Y._renderElements;for($b=0,$a=$D.length;$b<$a;$b++){var $J=$D[$b],$p=$J._staticBatch;if($p&&$p._material===$J._material)$p._addBatchRenderElement($J);else{var $T=$J.renderObj;$T.triangleCount<10&&1===$T._vertexBufferCount&&$T._getIndexBuffer()&&$J._material.renderQueue<2&&$J._canDynamicBatch&&!$Y._owner.isStatic?$M._addPrepareRenderElement($J):this._scene.getRenderQueue($J._material.renderQueue)._addRenderElement($J)}}}}for($$=0;$$<8;$$++){var $t=this._children[$$];if(null!=$t){var $q=$g;if($g){var $C=$v.containsBoundBox($t._relaxBox);if($F.treeNodeCollision+=1,0===$C)continue;$q=2===$C}$t.cullingObjects($v,$q,$Q,$d,$r)}}},$v.cullingShadowObjects=function($v,$g,$Q,$d,$r){var $k,$$=0,$b=0,$a=0;this._scene._dynamicBatchManager;for($$=0,$k=this._objects.length;$$<$k;$$++){var $M=this._objects[$$];if($M.castShadow&&$N.isVisible($M._owner.layer.mask)&&$M.enable){if($Q&&0===$v[0].containsBoundSphere($M.boundingSphere))continue;for(var $Y=1,$D=$v.length;$Y<$D;$Y++){var $J=$g[$Y-1];if(0!==$v[$Y].containsBoundSphere($M.boundingSphere)){var $p=$M._renderElements;for($b=0,$a=$p.length;$b<$a;$b++)$J._addRenderElement($p[$b])}}}}for($$=0;$$<8;$$++){var $T=this._children[$$];if(null!=$T){var $t=$Q;if($Q){var $q=$v[0].containsBoundBox($T._relaxBox);if(0===$q)continue;$t=2===$q}$T.cullingShadowObjects($v,$g,$t,$d,$r)}}},$v.cullingShadowObjectsOnePSSM=function($v,$g,$Q,$d,$r,$k){var $$,$b=$g[0],$a=0,$M=0,$Y=0;for($a=0,$$=this._objects.length;$a<$$;$a++){var $D=this._objects[$a];if($D.castShadow&&$N.isVisible($D._owner.layer.mask)&&$D.enable){if($d&&0===$v.containsBoundSphere($D.boundingSphere))continue;$D._renderUpdate($Q);var $J=$D._renderElements;for($M=0,$Y=$J.length;$M<$Y;$M++)$b._addRenderElement($J[$M])}}for($a=0;$a<8;$a++){var $p=this._children[$a];if(null!=$p){var $T=$d;if($d){var $t=$v.containsBoundBox($p._relaxBox);if(0===$t)continue;$T=2===$t}$p.cullingShadowObjectsOnePSSM($v,$g,$Q,$T,$r,$k)}}},$v.renderBoudingBox=function($v){this._renderBoudingBox($v);for(var $g=0;$g<8;++$g){var $Q=this._children[$g];$Q&&$Q.renderBoudingBox($v)}},$v.buildAllChild=function($v){if($v<this._scene.treeLevel)for(var $g=0;$g<8;$g++){this.addChild($g).buildAllChild($v+1)}},$v._renderBoudingBox=function($v){},$T(0,$v,"exactBox",function(){return this._exactBox},function($v){this._exactBox=$v,$$g.add($v.min,$v.max,this._boundingBoxCenter),$$g.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$T(0,$v,"relaxBox",function(){return this._relaxBox},function($v){(this._relaxBox=$v).getCorners(this._corners),$Ov.createfromPoints(this._corners,this._boundingSphere)}),$$.debugMode=!1,$$.relax=1.15,$$.CHILDNUM=8,$D($$,["tempVector0",function(){return this.tempVector0=new $$g},"tempSize",function(){return this.tempSize=new $$g},"tempCenter",function(){return this.tempCenter=new $$g},"_octreeSplit",function(){return this._octreeSplit=[new $$g(.25,.25,.25),new $$g(.75,.25,.25),new $$g(.25,.75,.25),new $$g(.75,.75,.25),new $$g(.25,.25,.75),new $$g(.75,.25,.75),new $$g(.25,.75,.75),new $$g(.75,.75,.75)]}]),$$}(),$S=(function(){function $v(){}$p($v,"laya.d3.core.scene.SceneManager")}(),function(){function $v($v,$g,$Q,$d){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$v&&($v=1),void 0===$g&&($g=1),void 0===$Q&&($Q=1),void 0===$d&&($d=1),this._r=$v,this._g=$g,this._b=$Q,this._a=$d}return $p($v,"laya.d3.core.trail.module.Color",null,"Color$1"),$v.prototype.cloneTo=function($v){$v._r=this._r,$v._g=this._g,$v._b=this._b,$v._a=this._a},$D($v,["RED",function(){return this.RED=new $v(1,0,0,1)},"GREEN",function(){return this.GREEN=new $v(0,1,0,1)},"BLUE",function(){return this.BLUE=new $v(0,0,1,1)},"CYAN",function(){return this.CYAN=new $v(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $v(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $v(1,0,1,1)},"GRAY",function(){return this.GRAY=new $v(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $v(1,1,1,1)},"BLACK",function(){return this.BLACK=new $v(0,0,0,1)}]),$v}()),$O=(function(){function $v(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$p($v,"laya.d3.core.trail.module.Gradient");var $g=$v.prototype;$g.setKeys=function($v,$g){var $Q,$d;this._colorKeys=$v;for(var $r=this.index=0;$r<$v.length;$r++){var $k=($Q=$v[$r]).color;this._colorKeyData[this.index++]=$k._r,this._colorKeyData[this.index++]=$k._g,this._colorKeyData[this.index++]=$k._b,this._colorKeyData[this.index++]=$Q.time}this._alphaKeys=$g;for(var $$=this.index=0;$$<$g.length;$$++)$d=$g[$$],this._alphaKeyData[this.index++]=$d.alpha,this._alphaKeyData[this.index++]=$d.time},$g.cloneTo=function($v){var $g=0,$Q=0,$d=this.colorKeys,$r=[];for($g=0,$Q=$d.length;$g<$Q;$g++){var $k=new $_;$d[$g].cloneTo($k),$r.push($k)}var $$=this.alphaKeys,$b=[];for($g=0,$Q=$$.length;$g<$Q;$g++){var $a=new $O;$$[$g].cloneTo($a),$b.push($a)}$v.setKeys($r,$b)},$T(0,$g,"mode",function(){return this._mode},function($v){this._mode=$v}),$T(0,$g,"colorKeys",function(){return this._colorKeys},function($v){this._colorKeys=$v;for(var $g=this.index=0;$g<$v.length;$g++){var $Q=$v[$g],$d=$Q.color;this._colorKeyData[this.index++]=$d._r,this._colorKeyData[this.index++]=$d._g,this._colorKeyData[this.index++]=$d._b,this._colorKeyData[this.index++]=$Q.time}}),$T(0,$g,"alphaKeys",function(){return this._alphaKeys},function($v){this._alphaKeys=$v;for(var $g=this.index=0;$g<$v.length;$g++){var $Q=$v[$g];this._alphaKeyData[this.index++]=$Q.alpha,this._alphaKeyData[this.index++]=$Q.time}})}(),function(){function $v($v,$g){this._alpha=NaN,this._time=NaN,void 0===$v&&($v=0),void 0===$g&&($g=0),this._alpha=$v,this._time=$g}$p($v,"laya.d3.core.trail.module.GradientAlphaKey");var $g=$v.prototype;return $g.cloneTo=function($v){$v.alpha=this.alpha,$v.time=this.time},$T(0,$g,"alpha",function(){return this._alpha},function($v){this._alpha=$v}),$T(0,$g,"time",function(){return this._time},function($v){this._time=$v}),$v}()),$_=function(){function $v($v,$g){this._color=null,this._time=NaN,void 0===$g&&($g=0),this._color=$v||new $S,this._time=$g}$p($v,"laya.d3.core.trail.module.GradientColorKey");var $g=$v.prototype;return $g.cloneTo=function($v){this.color.cloneTo($v.color),$v.time=this.time},$T(0,$g,"color",function(){return this._color},function($v){this._color=$v}),$T(0,$g,"time",function(){return this._time},function($v){this._time=$v}),$v}(),$u=(function(){function $v(){}$p($v,"laya.d3.core.trail.module.GradientMode"),$v.Blend=0,$v.Fixed=1}(),function(){function $v(){}$p($v,"laya.d3.core.trail.module.TextureMode"),$v.Stretch=0,$v.Tile=1}(),function(){function $v(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$p($v,"laya.d3.core.trail.module.TrailKeyFrame"),$v.prototype.cloneTo=function($v){$v.time=this.time,$v.inTangent=this.inTangent,$v.outTangent=this.outTangent,$v.value=this.value}}(),function(){function $g($v){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $$g,this._curPosition=new $$g,this._delVector3=new $$g,this._lastFixedVertexPosition=new $$g,this._pointAtoBVector3=new $$g,this._pointA=new $$g,this._pointB=new $$g,this._owner=$v,this._id=$g.renderElementCount++,0==this._id?$v._owner.transform.position.cloneTo(this._lastPosition):$v._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $cg($u.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $cg($u.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$p($g,"laya.d3.core.trail.TrailRenderElement");var $v=$g.prototype;$h.imps($v,{"laya.d3.core.render.IRenderable":!0}),$v._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$v._addTrailByFirstPosition=function($v,$g){$$g.subtract($g,$v,this._delVector3),$$g.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$$g.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$$g.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($v),$v.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$v._addTrailByNextPosition=function($v){$$g.subtract($v,this._lastFixedVertexPosition,this._delVector3),$$g.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$$g.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$$g.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$$g.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$_v.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($v),$v.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($v),this._virtualVerticesCount=2)},$v._updateVerticesByPosition=function($v){this._pointe=$v.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$v._updateVertexBuffer2=function(){var $v,$g=0,$Q=0,$d=0;for($d=0,$v=(this._verticesCount+this._virtualVerticesCount)/2;$d<$v;$d++)$Q=0==this._owner.textureMode?(this._VerticesToTailLength[$d]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$d],this._vertices2[$g++]=1-$Q,this._vertices2[$g++]=1-$Q;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$v._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$v._updateDisappear=function(){var $v,$g=0;for($g=this._curDisappearIndex,$v=(this._verticesCount+this._virtualVerticesCount)/2;$g<$v;$g++)this._owner._curtime-this._everyGroupVertexBirthTime[$g]>=this._owner.time+$_v.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$v._beforeRender=function($v){return this._camera=$v.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$$g.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$v._render=function($v){this._isDead||($Z.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$F.drawCall++,$F.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$v._getVertexBuffer=function($v){return void 0===$v&&($v=0),0===$v?this._vertexBuffer1:1===$v?this._vertexBuffer2:null},$v._getVertexBuffers=function(){return this._vertexBuffers},$v._getIndexBuffer=function(){return null},$v.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$v._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$T(0,$v,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$T(0,$v,"triangleCount",function(){return 0}),$g.renderElementCount=0}(),function(){function $v(){}$p($v,"laya.d3.core.trail.VertexTrail");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration1}),$T(1,$v,"vertexDeclaration1",function(){return $v._vertexDeclaration1}),$T(1,$v,"vertexDeclaration2",function(){return $v._vertexDeclaration2}),$D($v,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $kv(32,[new $$v(0,"vector3",0),new $$v(12,"vector3",41),new $$v(24,"single",33),new $$v(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $kv(4,[new $$v(0,"single",38)])}]),$v}()),$vv=function(){function $A($v){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$v}$p($A,"laya.d3.graphics.DynamicBatch");var $v=$A.prototype;return $h.imps($v,{"laya.d3.core.render.IRenderable":!0}),$v._getVertexBuffer=function($v){return void 0===$v&&($v=0),0===$v?this._vertexBuffer:null},$v._getIndexBuffer=function(){return this._indexBuffer},$v._getCombineRenderElementFromPool=function($v,$g,$Q){var $d=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $d||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$d=new $R,$d._sprite3D=new $zg),$d._sprite3D._render._renderUpdate($Q),$d},$v._getRenderElement=function($v,$g,$Q){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$A.maxVertexCount),this._indexDatas=new Uint16Array($A.maxIndexCount),this._vertexBuffer=$cg.create(this._vertexDeclaration,$A.maxVertexCount,35048),this._indexBuffer=$Kg.create("ushort",$A.maxIndexCount,35048));for(var $d=this._merageElements.length=0,$r=0,$k=0,$$=this._combineRenderElements.length;$k<$$;$k++){var $b=this._combineRenderElements[$k],$a=$b.getDynamicBatchBakedVertexs(0),$M=$b.getBakedIndices(),$Y=$b._sprite3D.transform._isFrontFaceInvert,$D=$d/(this._vertexDeclaration.vertexStride/4),$J=$r,$p=$J+$M.length;$b._tempBatchIndexStart=$J,$b._tempBatchIndexEnd=$p,this._indexDatas.set($M,$r);var $T=0;if($Y)for($T=$J;$T<$p;$T+=3){this._indexDatas[$T]=$D+this._indexDatas[$T];var $t=this._indexDatas[$T+1],$q=this._indexDatas[$T+2];this._indexDatas[$T+1]=$D+$q,this._indexDatas[$T+2]=$D+$t}else for($T=$J;$T<$p;$T+=3)this._indexDatas[$T]=$D+this._indexDatas[$T],this._indexDatas[$T+1]=$D+this._indexDatas[$T+1],this._indexDatas[$T+2]=$D+this._indexDatas[$T+2];$r+=$M.length,this._vertexDatas.set($a,$d),$d+=$a.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$k=this._combineRenderElementPoolIndex=0,$$=this._materials.length;$k<$$;$k++){var $C=this._getCombineRenderElementFromPool($v,$g,$Q);$C._type=2,$C._staticBatch=null;var $G=($C.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$k]]._tempBatchIndexStart,$s=$k+1===this._materialToRenderElementsOffsets.length?$r:this._combineRenderElements[this._materialToRenderElementsOffsets[$k+1]]._tempBatchIndexStart;$C._tempBatchIndexStart=$G,$C._tempBatchIndexEnd=$s,$C._material=this._materials[$k],this._merageElements.push($C)}},$v._addCombineRenderObjTest=function($v){var $g=$v.renderObj,$Q=this._currentCombineIndexCount+$g._getIndexBuffer().indexCount,$d=this._currentCombineVertexCount+$g._getVertexBuffer().vertexCount;return!($A.maxVertexCount<$d||$A.maxIndexCount<$Q)},$v._addCombineRenderObj=function($v){var $g=$v.renderObj;this._combineRenderElements.push($v),this._currentCombineIndexCount=this._currentCombineIndexCount+$g._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$g._getVertexBuffer().vertexCount},$v._addCombineMaterial=function($v){this._materials.push($v)},$v._addMaterialToRenderElementOffset=function($v){this._materialToRenderElementsOffsets.push($v)},$v._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$v._addToRenderQueue=function($v,$g,$Q,$d){this._getRenderElement($g,$Q,$d);for(var $r=0,$k=this._materials.length;$r<$k;$r++)$v.getRenderQueue(this._materials[$r].renderQueue)._addDynamicBatchElement(this._merageElements[$r])},$v._beforeRender=function($v){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$v._render=function($v){var $g=$v._batchIndexEnd-$v._batchIndexStart;$Z.mainContext.drawElements(4,$g,5123,2*$v._batchIndexStart),$F.drawCall++,$F.trianglesFaces+=$g/3},$v._getVertexBuffers=function(){return null},$T(0,$v,"_vertexBufferCount",function(){return 1}),$T(0,$v,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$T(0,$v,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$A.maxVertexCount=2e4,$A.maxIndexCount=4e4,$A.maxCombineTriangleCount=10,$A}(),$gv=function(){function $A(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$p($A,"laya.d3.graphics.DynamicBatchManager");var $v=$A.prototype;return $v.getDynamicBatch=function($v,$g){var $Q,$d=$v.id.toString()+$g;return this._dynamicBatches[$d]?$Q=this._dynamicBatches[$d]:this._dynamicBatches[$d]=$Q=new $vv($v),$Q},$v._garbageCollection=function(){for(var $v in this._dynamicBatches)0===this._dynamicBatches[$v].combineRenderElementsCount&&delete this._dynamicBatches[$v]},$v._addPrepareRenderElement=function($v){this._prepareDynamicBatchCombineElements.push($v)},$v._finishCombineDynamicBatch=function($v){var $g,$Q,$d;this._prepareDynamicBatchCombineElements.sort($A._sortPrepareDynamicBatch);for(var $r,$k,$$,$b,$a,$M=-1,$Y=!0,$D=0,$J=-1,$p=0,$T=this._prepareDynamicBatchCombineElements.length;$p<$T;$p++){var $t=($k=this._prepareDynamicBatchCombineElements[$p]).renderObj._getVertexBuffer(0).vertexDeclaration,$q=$Q!==$t;$q&&($D=0,$Q=$t);var $C=$D!==$M;if($C&&($M=$D),($q||$C)&&($$=this.getDynamicBatch($t,$D),$g=null),$Y)if($$._addCombineRenderObjTest($k)){if($g!==($r=$k._material))$b&&($v.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$a=$b=null,$J=-1),$b=$r,$J=$$.combineRenderElementsCount,$a=$k,$g=$r;else if($b){var $G=$a.renderObj,$s=$k.renderObj;$G._getVertexBuffer().vertexCount+$s._getVertexBuffer().vertexCount>$vv.maxVertexCount||$G._getIndexBuffer().indexCount+$s._getIndexBuffer().indexCount>$vv.maxIndexCount?($v.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$b=$r,$J=$$.combineRenderElementsCount,$a=$k):($$._addCombineMaterial($b),$$._addMaterialToRenderElementOffset($J),$$._addCombineRenderObj($a),$a=$b=null,$J=-1,$$._addCombineRenderObj($k))}else $$._addCombineRenderObj($k);$Y=!0}else $b&&($v.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$a=$b=null,$J=-1),$D++,$Y=!1;else $d=this._prepareDynamicBatchCombineElements[$p-1],$$._addMaterialToRenderElementOffset($$.combineRenderElementsCount),$g=$d._material,$$._addCombineMaterial($g),$$._addCombineRenderObj($d),$Y=!0,$g!==($r=$k._material)?($b=$r,$J=$$.combineRenderElementsCount,$a=$k):$$._addCombineRenderObj($k),$g=$r}$b&&($v.getRenderQueue($a._material.renderQueue)._addRenderElement($a),$a=$b=null,$J=-1),this._prepareDynamicBatchCombineElements.length=0},$v._clearRenderElements=function(){for(var $v in this._dynamicBatches)this._dynamicBatches[$v]._clearRenderElements()},$v._addToRenderQueue=function($v,$g,$Q,$d){for(var $r in this._dynamicBatches){var $k=this._dynamicBatches[$r];0<$k.combineRenderElementsCount&&$k._addToRenderQueue($v,$g,$Q,$d)}},$v.dispose=function(){this._dynamicBatches=null},$A._sortPrepareDynamicBatch=function($v,$g){return $v._mainSortID-$g._mainSortID},$A}(),$Qv=function(){function $v(){}return $p($v,"laya.d3.graphics.FrustumCulling"),$v.renderShadowObjectCulling=function($v,$g,$Q,$d,$r){var $k=0,$$=0,$b=0,$a=0;for($k=0,$b=$Q.length;$k<$b;$k++){var $M=$Q[$k];$M&&$M._clearRenderElements()}var $Y,$D,$J,$p=$v._cullingRenders;if(1<$r){for($k=0,$b=$v._cullingRendersLength;$k<$b;$k++)if(($Y=$p[$k]).castShadow&&$N.isVisible($Y._owner.layer.mask)&&$Y.enable)for(var $T=1,$t=$g.length;$T<$t;$T++)if($D=$Q[$T-1],0!==$g[$T].containsBoundSphere($Y.boundingSphere))for($$=0,$a=($J=$Y._renderElements).length;$$<$a;$$++)$D._addRenderElement($J[$$])}else for($k=0,$b=$v._cullingRendersLength;$k<$b;$k++)if(($Y=$p[$k]).castShadow&&$N.isVisible($Y._owner.layer.mask)&&$Y.enable&&0!==$g[0].containsBoundSphere($Y.boundingSphere))for($Y._renderUpdate($d),$D=$Q[0],$$=0,$a=($J=$Y._renderElements).length;$$<$a;$$++)$D._addRenderElement($J[$$])},$v.renderShadowObjectCullingOctree=function($v,$g,$Q,$d,$r){for(var $k=0,$$=$Q.length;$k<$$;$k++){var $b=$Q[$k];$b&&$b._clearRenderElements()}1<$r?$v.treeRoot.cullingShadowObjects($g,$Q,!0,0,$v):$v.treeRoot.cullingShadowObjectsOnePSSM($g[0],$Q,$d,!0,0,$v)},$v.renderObjectCulling=function($v,$g,$Q,$d,$r,$k){var $$=0,$b=0,$a=0,$M=0,$Y=$g._quenes,$D=$g._dynamicBatchManager,$J=$g._cullingRenders;for($$=0,$b=$Y.length;$$<$b;$$++){var $p=$Y[$$];$p&&$p._clearRenderElements()}var $T=$dv._staticBatchManagers;for($$=0,$b=$T.length;$$<$b;$$++)$T[$$]._clearRenderElements();$D._clearRenderElements();var $t=$Q.transform.position;for($$=0,$b=$g._cullingRendersLength;$$<$b;$$++){var $q=$J[$$];if($N.isVisible($q._owner.layer.mask)&&$q.enable&&0!==$v.containsBoundSphere($q.boundingSphere)&&$q._renderUpdate($k)){$q._distanceForSort=$$g.distance($q.boundingSphere.center,$t)+$q.sortingFudge;var $C=$q._renderElements;for($a=0,$M=$C.length;$a<$M;$a++){var $G=$C[$a],$s=$G._staticBatch;if($s&&$s._material===$G._material)$s._addBatchRenderElement($G);else{var $A=$G.renderObj;$A.triangleCount<10&&1===$A._vertexBufferCount&&$A._getIndexBuffer()&&$G._material.renderQueue<2&&$G._canDynamicBatch&&!$q._owner.isStatic?$D._addPrepareRenderElement($G):$g.getRenderQueue($G._material.renderQueue)._addRenderElement($G)}}}}for($$=0,$b=$T.length;$$<$b;$$++)$T[$$]._addToRenderQueue($g,$d,$r,$k);$D._finishCombineDynamicBatch($g),$D._addToRenderQueue($g,$d,$r,$k)},$v.renderObjectCullingOctree=function($v,$g,$Q,$d,$r,$k){var $$=0,$b=0,$a=$g._quenes,$M=$g._dynamicBatchManager;for($$=0,$b=$a.length;$$<$b;$$++){var $Y=$a[$$];$Y&&$Y._clearRenderElements()}var $D=$dv._staticBatchManagers;for($$=0,$b=$D.length;$$<$b;$$++)$D[$$]._clearRenderElements();for($M._clearRenderElements(),$g._cullingRenders.length=0,$g.treeRoot.cullingObjects($v,!0,0,$Q.transform.position,$k),$$=0,$b=$D.length;$$<$b;$$++)$D[$$]._addToRenderQueue($g,$d,$r,$k);$M._finishCombineDynamicBatch($g),$M._addToRenderQueue($g,$d,$r,$k)},$v.renderObjectCullingNoBoundFrustum=function($v,$g,$Q,$d,$r){var $k=0,$$=0,$b=0,$a=0,$M=$v._quenes,$Y=$v._dynamicBatchManager,$D=$v._cullingRenders;for($k=0,$$=$M.length;$k<$$;$k++){var $J=$M[$k];$J&&$J._clearRenderElements()}var $p=$dv._staticBatchManagers;for($k=0,$$=$p.length;$k<$$;$k++)$p[$k]._clearRenderElements();$Y._clearRenderElements();var $T=$g.transform.position;for($k=0,$$=$v._cullingRendersLength;$k<$$;$k++){var $t=$D[$k];if($N.isVisible($t._owner.layer.mask)&&$t.enable){$t._renderUpdate($r),$t._distanceForSort=$$g.distance($t.boundingSphere.center,$T)+$t.sortingFudge;var $q=$t._renderElements;for($b=0,$a=$q.length;$b<$a;$b++){var $C=$q[$b],$G=$C._staticBatch;if($G&&$G._material===$C._material)$G._addBatchRenderElement($C);else{var $s=$C.renderObj;$s.triangleCount<10&&1===$s._vertexBufferCount&&$s._getIndexBuffer()&&$C._material.renderQueue<2&&$C._canDynamicBatch&&!$t._owner.isStatic?$Y._addPrepareRenderElement($C):$v.getRenderQueue($C._material.renderQueue)._addRenderElement($C)}}}}for($k=0,$$=$p.length;$k<$$;$k++)$p[$k]._addToRenderQueue($v,$Q,$d,$r);$Y._finishCombineDynamicBatch($v),$Y._addToRenderQueue($v,$Q,$d,$r)},$v}(),$dv=function(){function $k(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$p($k,"laya.d3.graphics.StaticBatchManager");var $v=$k.prototype;return $v._finishInit=function(){for(var $v in this._staticBatches)this._staticBatches[$v]._finishInit();this._initBatchRenderElements.length=0},$v._initStaticBatchs=function($v){throw new Error("StaticBatchManager:must override this function.")},$v._addInitBatchSprite=function($v){for(var $g=$v._render._renderElements,$Q=0,$d=$g.length;$Q<$d;$Q++)this._initBatchRenderElements.push($g[$Q])},$v._clearRenderElements=function(){for(var $v in this._staticBatches)this._staticBatches[$v]._clearRenderElements()},$v._garbageCollection=function($v){var $g=$v._staticBatch,$Q=$g._initBatchRenderElements,$d=$Q.indexOf($v);$Q.splice($d,1),0===$Q.length&&($g.dispose(),delete this._staticBatches[$g._key])},$v._addToRenderQueue=function($v,$g,$Q,$d){for(var $r in this._staticBatches){var $k=this._staticBatches[$r];0<$k._batchRenderElements.length&&$k._updateToRenderQueue($v,$d)}},$v.dispose=function(){this._staticBatches=null},$k._addToStaticBatchQueue=function($v){$v instanceof laya.d3.core.RenderableSprite3D&&$v._addToInitStaticBatchManager();for(var $g=0,$Q=$v.numChildren;$g<$Q;$g++)$k._addToStaticBatchQueue($v._childs[$g])},$k.combine=function($v,$g){var $Q,$d=0,$r=0;if($g)for($d=0,$r=$g.length;$d<$r;$d++){$g[$d]._addToInitStaticBatchManager()}else $v&&$k._addToStaticBatchQueue($v);for($d=0,$r=$k._staticBatchManagers.length;$d<$r;$d++)($Q=$k._staticBatchManagers[$d])._initStaticBatchs($v),$Q._finishInit()},$k._staticBatchManagers=[],$k}(),$rv=function(){function $v($v,$g,$Q){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$v,this._manager=$g,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$Q}$p($v,"laya.d3.graphics.StaticBatch");var $g=$v.prototype;return $h.imps($g,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$g._binarySearch=function($v){for(var $g=0,$Q=this._batchRenderElements.length-1,$d=0;$g<=$Q;)$d=Math.floor(($g+$Q)/2),this._compareBatchRenderElement(this._batchRenderElements[$d],$v)?$Q=$d-1:$g=$d+1;return $g},$g._compareBatchRenderElement=function($v,$g){throw new Error("StaticBatch:must override this function.")},$g._getVertexDecLightMap=function($v){return $v===$Kv.vertexDeclaration?$Nv.vertexDeclaration:$v===$mv.vertexDeclaration?$Xv.vertexDeclaration:$v===$lv.vertexDeclaration?$Av.vertexDeclaration:$v===$Lv.vertexDeclaration?null:$v===$tv.vertexDeclaration?$qv.vertexDeclaration:$v===$Bv.vertexDeclaration?$xv.vertexDeclaration:$v===$Zv.vertexDeclaration?$fv.vertexDeclaration:$v===$cv.vertexDeclaration?$iv.vertexDeclaration:$v===$mv.vertexDeclaration?$Xv.vertexDeclaration:$v===$ov.vertexDeclaration?$hv.vertexDeclaration:$v===$Lv.vertexDeclaration?null:$v===$tv.vertexDeclaration?$qv.vertexDeclaration:$v===$jv.vertexDeclaration?$wv.vertexDeclaration:$v===$Zv.vertexDeclaration?$fv.vertexDeclaration:$v},$g._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$g._addBatchRenderElement=function($v){this._batchRenderElements.splice(this._binarySearch($v),0,$v)},$g._updateToRenderQueue=function($v,$g){this._combineRenderElementPoolIndex=0,this._getRenderElement($v.getRenderQueue(this._material.renderQueue)._renderElements,$v,$g)},$g._getRenderElement=function($v,$g,$Q){throw new Error("StaticBatch:must override this function.")},$g._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$g._clearRenderElements=function(){this._batchRenderElements.length=0},$g.dispose=function(){},$g._getVertexBuffer=function($v){return void 0===$v&&($v=0),null},$g._getIndexBuffer=function(){return null},$g._beforeRender=function($v){return!0},$g._render=function($v){},$g._getVertexBuffers=function(){return null},$T(0,$g,"_vertexBufferCount",function(){return 1}),$T(0,$g,"triangleCount",function(){return 0}),$v.combine=function($v){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$dv.combine($v)},$v.maxBatchVertexCount=65535,$v}(),$kv=function(){function $$($v,$g){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$$._uniqueIDCounter,this._id>$$.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$$.maxVertexDeclaration);this._shaderValues=new $Jg,this._vertexElementsDic={},this._vertexStride=$v,this._vertexElements=$g;for(var $Q=0;$Q<$g.length;$Q++){var $d=$g[$Q],$r=$d.elementUsage;this._vertexElementsDic[$r]=$d;var $k=[$$._getTypeSize($d.elementFormat)/4,5126,!1,this._vertexStride,$d.offset];switch(this._shaderValues.setValue($r,$k),$r){case 1:this._addShaderDefine($Fg.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($Fg.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($Fg.SHADERDEFINE_UV1)}}}$p($$,"laya.d3.graphics.VertexDeclaration");var $v=$$.prototype;return $v._addShaderDefine=function($v){this._shaderDefineValue|=$v},$v._removeShaderDefine=function($v){this._shaderDefineValue&=~$v},$v.getVertexElements=function(){return this._vertexElements.slice()},$v.getVertexElementByUsage=function($v){return this._vertexElementsDic[$v]},$v.unBinding=function(){},$T(0,$v,"shaderDefineValue",function(){return this._shaderDefineValue}),$T(0,$v,"id",function(){return this._id}),$T(0,$v,"vertexStride",function(){return this._vertexStride}),$T(0,$v,"shaderValues",function(){return this._shaderValues}),$$._getTypeSize=function($v){switch($v){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$$.getVertexStride=function($v){for(var $g=0,$Q=0;$Q<$v.Length;$Q++){var $d=$v[$Q],$r=$d.offset+$$._getTypeSize($d.elementFormat);$g<$r&&($g=$r)}return $g},$$._maxVertexDeclarationBit=1e3,$$._uniqueIDCounter=1,$D($$,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$$}(),$$v=function(){function $v($v,$g,$Q){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$v,this.elementFormat=$g,this.elementUsage=$Q}return $p($v,"laya.d3.graphics.VertexElement"),$v}(),$bv=(function(){function $v(){}$p($v,"laya.d3.graphics.VertexElementFormat"),$v.Single="single",$v.Vector2="vector2",$v.Vector3="vector3",$v.Vector4="vector4",$v.Color="color",$v.Byte4="byte4",$v.Short2="short2",$v.Short4="short4",$v.NormalizedShort2="normalizedshort2",$v.NormalizedShort4="normalizedshort4",$v.HalfVector2="halfvector2",$v.HalfVector4="halfvector4"}(),function(){function $v(){}$p($v,"laya.d3.graphics.VertexElementUsage"),$v.POSITION0=0,$v.COLOR0=1,$v.TEXTURECOORDINATE0=2,$v.NORMAL0=3,$v.BINORMAL0=4,$v.TANGENT0=5,$v.BLENDINDICES0=6,$v.BLENDWEIGHT0=7,$v.DEPTH0=8,$v.FOG0=9,$v.POINTSIZE0=10,$v.SAMPLE0=11,$v.TESSELLATEFACTOR0=12,$v.COLOR1=13,$v.NEXTTEXTURECOORDINATE0=14,$v.TEXTURECOORDINATE1=15,$v.NEXTTEXTURECOORDINATE1=16,$v.CORNERTEXTURECOORDINATE0=17,$v.VELOCITY0=18,$v.STARTCOLOR0=19,$v.STARTSIZE=20,$v.AGEADDSCALE0=21,$v.STARTROTATION=22,$v.ENDCOLOR0=23,$v.STARTLIFETIME=24,$v.TIME0=33,$v.SHAPEPOSITIONSTARTLIFETIME=30,$v.DIRECTIONTIME=32,$v.SIZEROTATION0=27,$v.RADIUS0=28,$v.RADIAN0=29,$v.STARTSPEED=31,$v.RANDOM0=34,$v.RANDOM1=35,$v.SIMULATIONWORLDPOSTION=36,$v.SIMULATIONWORLDROTATION=37,$v.TEXTURECOORDINATE0X=38,$v.TEXTURECOORDINATE0X1=39,$v.TEXTURECOORDINATE0Y=40,$v.OFFSETVECTOR=41}(),function(){function $v($v,$g,$Q){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$v,this._textureCoordinate0=$g,this._time=$Q}$p($v,"laya.d3.graphics.VertexGlitter");var $g=$v.prototype;$h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate0}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"time",function(){return this._time}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(24,[new $$v(0,"vector3",0),new $$v(12,"vector2",2),new $$v(20,"single",33)])}])}(),function(){function $v($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$v,this._position=$g,this._velocity=$Q,this._startColor=$d,this._endColor=$r,this._sizeRotation=$k,this._radius=$$,this._radian=$b,this._ageAddScale=$a,this._time=$M}$p($v,"laya.d3.graphics.VertexParticle");var $g=$v.prototype;$h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"endColor",function(){return this._endColor}),$T(0,$g,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$T(0,$g,"sizeRotation",function(){return this._sizeRotation}),$T(0,$g,"velocity",function(){return this._velocity}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"startColor",function(){return this._startColor}),$T(0,$g,"radius",function(){return this._radius}),$T(0,$g,"radian",function(){return this._radian}),$T(0,$g,"ageAddScale",function(){return this._ageAddScale}),$T(0,$g,"time",function(){return this._time}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(116,[new $$v(0,"vector4",17),new $$v(16,"vector3",0),new $$v(28,"vector3",18),new $$v(40,"vector4",19),new $$v(56,"vector4",23),new $$v(72,"vector3",27),new $$v(84,"vector2",28),new $$v(92,"vector4",29),new $$v(108,"single",24),new $$v(112,"single",33)])}])}(),function(){function $v($v){this._position=null,this._position=$v}$p($v,"laya.d3.graphics.VertexPosition");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(12,[new $$v(0,"vector3",0)])}]),$v}()),$av=function(){function $v($v,$g){this._position=null,this._normal=null,this._position=$v,this._normal=$g}$p($v,"laya.d3.graphics.VertexPositionNormal");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(24,[new $$v(0,"vector3",0),new $$v(12,"vector3",3)])}]),$v}(),$Mv=function(){function $v($v,$g,$Q){this._position=null,this._normal=null,this._color=null,this._position=$v,this._normal=$g,this._color=$Q}$p($v,"laya.d3.graphics.VertexPositionNormalColor");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(40,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1)])}]),$v}(),$Yv=function(){function $v($v,$g,$Q,$d,$r){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$v,this._normal=$g,this._color=$Q,this._blendIndex=$d,this._blendWeight=$r}$p($v,"laya.d3.graphics.VertexPositionNormalColorSkin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(72,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector4",7),new $$v(56,"vector4",6)])}]),$v}(),$Dv=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._tangent=$d,this._blendIndex=$r,this._blendWeight=$k}$p($v,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(88,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector4",7),new $$v(56,"vector4",6),new $$v(72,"vector4",5)])}]),$v}(),$Jv=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._tangent=$d,this._blendIndex=$r,this._blendWeight=$k}$p($v,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(84,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector4",7),new $$v(56,"vector4",6),new $$v(72,"vector3",5)])}]),$v}(),$pv=function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._tangent=$d}$p($v,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(56,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector4",5)])}]),$v}(),$Tv=function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._tangent=$d}$p($v,"laya.d3.graphics.VertexPositionNormalColorTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(52,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector3",5)])}]),$v}(),$tv=function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate=$d}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(48,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2)])}]),$v}(),$qv=function(){function $v($v,$g,$Q,$d,$r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate0=$d,this._textureCoordinate1=$r}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(56,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector2",15)])}]),$v}(),$Cv=function(){function $v($v,$g,$Q,$d,$r,$k,$$){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate0=$d,this._textureCoordinate1=$r,this._blendIndex=$k,this._blendWeight=$$}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(88,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector2",15),new $$v(56,"vector4",7),new $$v(72,"vector4",6)])}]),$v}(),$Gv=function(){function $v($v,$g,$Q,$d,$r,$k,$$,$b){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate0=$d,this._textureCoordinate1=$r,this._tangent=$k,this._blendIndex=$$,this._blendWeight=$b}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(104,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector2",15),new $$v(56,"vector4",7),new $$v(72,"vector4",6),new $$v(88,"vector4",5)])}]),$v}(),$sv=function(){function $v(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$g.VertexPositionNormalColorTexture0SkinTangent=function($v,$g,$Q,$d,$r,$k,$$,$b){this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate0=$d,this._textureCoordinate1=$r,this._tangent=$k,this._blendIndex=$$,this._blendWeight=$b},$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(100,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector2",15),new $$v(56,"vector4",7),new $$v(72,"vector4",6),new $$v(88,"vector3",5)])}]),$v}(),$Av=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate0=$d,this._textureCoordinate1=$r,this._tangent=$k}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(72,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector2",15),new $$v(56,"vector4",5)])}]),$v}(),$hv=function(){function $v(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$p($v,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$g.VertexPositionNormalColorTexture0Tangent=function($v,$g,$Q,$d,$r,$k){this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate0=$d,this._textureCoordinate1=$r,this._tangent=$k},$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(68,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector2",15),new $$v(56,"vector3",5)])}]),$v}(),$Pv=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate=$d,this._blendIndex=$r,this._blendWeight=$k}$p($v,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(80,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector4",7),new $$v(64,"vector4",6)])}]),$v}(),$Wv=function(){function $v($v,$g,$Q,$d,$r,$k,$$){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate=$d,this._tangent=$r,this._blendIndex=$k,this._blendWeight=$$}$p($v,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(96,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector4",7),new $$v(64,"vector4",6),new $$v(80,"vector4",5)])}]),$v}(),$Fv=function(){function $v($v,$g,$Q,$d,$r,$k,$$){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate=$d,this._tangent=$r,this._blendIndex=$k,this._blendWeight=$$}$p($v,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(92,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector4",7),new $$v(64,"vector4",6),new $$v(80,"vector3",5)])}]),$v}(),$lv=function(){function $v($v,$g,$Q,$d,$r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate=$d,this._tangent=$r}$p($v,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(64,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector4",5)])}]),$v}(),$ov=function(){function $v($v,$g,$Q,$d,$r){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$v,this._normal=$g,this._color=$Q,this._textureCoordinate=$d,this._tangent=$r}$p($v,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"color",function(){return this._color}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(60,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",1),new $$v(40,"vector2",2),new $$v(48,"vector3",5)])}]),$v}(),$Ev=function(){function $v($v,$g,$Q){this._position=null,this._normal=null,this._tangent=null,this._position=$v,this._normal=$g,this._tangent=$Q}$p($v,"laya.d3.graphics.VertexPositionNormalSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(40,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector4",5)])}]),$v}(),$Vv=function(){function $v($v,$g,$Q){this._position=null,this._normal=null,this._tangent=null,this._position=$v,this._normal=$g,this._tangent=$Q}$p($v,"laya.d3.graphics.VertexPositionNormalTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(36,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector3",5)])}]),$v}(),$Zv=function(){function $v($v,$g,$Q){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q}$p($v,"laya.d3.graphics.VertexPositionNormalTexture");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(32,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2)])}]),$v}(),$fv=function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$v,this._normal=$g,this._textureCoordinate0=$Q,this._textureCoordinate1=$d}$p($v,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(40,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15)])}]),$v}(),$Xv=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$v,this._normal=$g,this._textureCoordinate0=$Q,this._textureCoordinate1=$d,this._blendIndex=$r,this._blendWeight=$k}$p($v,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(72,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15),new $$v(40,"vector4",7),new $$v(56,"vector4",6)])}]),$v}(),$Nv=function(){function $v($v,$g,$Q,$d,$r,$k,$$){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._textureCoordinate0=$Q,this._textureCoordinate1=$d,this._tangent=$r,this._blendIndex=$k,this._blendWeight=$$}$p($v,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(88,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15),new $$v(40,"vector4",7),new $$v(56,"vector4",6),new $$v(72,"vector4",5)])}]),$v}(),$iv=function(){function $v(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$p($v,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$g.VertexPositionNormalTexture0SkinTangent=function($v,$g,$Q,$d,$r,$k,$$){this._position=$v,this._normal=$g,this._textureCoordinate0=$Q,this._textureCoordinate1=$d,this._tangent=$r,this._blendIndex=$k,this._blendWeight=$$},$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(84,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15),new $$v(40,"vector4",7),new $$v(56,"vector4",6),new $$v(72,"vector3",5)])}]),$v}(),$xv=function(){function $v($v,$g,$Q,$d,$r){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$v,this._normal=$g,this._textureCoordinate0=$Q,this._textureCoordinate1=$d,this._tangent=$r}$p($v,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(56,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15),new $$v(40,"vector4",5)])}]),$v}(),$wv=function(){function $v(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$p($v,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$g.VertexPositionNormalTexture0Tangent=function($v,$g,$Q,$d,$r){this._position=$v,this._normal=$g,this._textureCoordinate0=$Q,this._textureCoordinate1=$d,this._tangent=$r},$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(52,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15),new $$v(40,"vector3",5)])}]),$v}(),$mv=function(){function $v($v,$g,$Q,$d,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q,this._blendIndex=$d,this._blendWeight=$r}$p($v,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(64,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector4",7),new $$v(48,"vector4",6)])}]),$v}(),$Kv=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q,this._tangent=$d,this._blendIndex=$r,this._blendWeight=$k}$p($v,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(80,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector4",7),new $$v(48,"vector4",6),new $$v(64,"vector4",5)])}]),$v}(),$cv=function(){function $v($v,$g,$Q,$d,$r,$k){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q,this._tangent=$d,this._blendIndex=$r,this._blendWeight=$k}$p($v,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(76,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector4",7),new $$v(48,"vector4",6),new $$v(64,"vector3",5)])}]),$v}(),$Bv=function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q,this._tangent=$d}$p($v,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(48,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector4",5)])}]),$v}(),$jv=function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q,this._tangent=$d}$p($v,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(44,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector3",5)])}]),$v}(),$Lv=function(){function $v($v,$g,$Q){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q}$p($v,"laya.d3.graphics.VertexPositionNTBTexture");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(56,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector3",5),new $$v(36,"vector3",4),new $$v(48,"vector2",2)])}]),$v}(),$Hv=function(){function $v($v,$g,$Q,$d,$r,$k,$$,$b){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$v,this._normal=$g,this._textureCoordinate0=$d,this._textureCoordinate1=$r,this._tangent=$k,$Q=$Q,this._blendIndex=$$,this._blendWeight=$b}$p($v,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"tangent",function(){return this._tangent}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(0,$g,"textureCoordinate1",function(){return this._textureCoordinate1}),$T(0,$g,"blendIndex",function(){return this._blendIndex}),$T(0,$g,"blendWeight",function(){return this._blendWeight}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(96,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector3",5),new $$v(36,"vector3",4),new $$v(48,"vector2",2),new $$v(56,"vector2",15),new $$v(64,"vector4",7),new $$v(80,"vector4",6)])}]),$v}(),$nv=function(){function $v($v,$g,$Q){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$v,this._normal=$g,this._textureCoordinate=$Q}$p($v,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"textureCoordinate",function(){return this._textureCoordinate}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(88,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector3",5),new $$v(36,"vector3",4),new $$v(48,"vector2",2),new $$v(56,"vector4",7),new $$v(72,"vector4",6)])}]),$v}(),$yv=(function(){function $v($v,$g,$Q,$d){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$v,this._normal=$g,this._textureCoord0=$Q,this._textureCoord1=$d}$p($v,"laya.d3.graphics.VertexPositionTerrain");var $g=$v.prototype;$h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"normal",function(){return this._normal}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoord0",function(){return this._textureCoord0}),$T(0,$g,"textureCoord1",function(){return this._textureCoord1}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(40,[new $$v(0,"vector3",0),new $$v(12,"vector3",3),new $$v(24,"vector2",2),new $$v(32,"vector2",15)])}])}(),function(){function $v($v,$g){this._position=null,this._textureCoordinate0=null,this._position=$v,this._textureCoordinate0=$g}$p($v,"laya.d3.graphics.VertexPositionTexture0");var $g=$v.prototype;return $h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"position",function(){return this._position}),$T(0,$g,"textureCoordinate0",function(){return this._textureCoordinate0}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(20,[new $$v(0,"vector3",0),new $$v(12,"vector2",2)])}]),$v}()),$ev=(function(){function $v($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D,$J,$p){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$v,this._positionStartLifeTime=$g,this._velocity=$Q,this._startColor=$d,this._startSize=$r,this._startRotation0=$k,this._startRotation1=$$,this._startRotation2=$b,this._startLifeTime=$a,this._time=$M,this._startSpeed=$Y,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$p}$p($v,"laya.d3.graphics.VertexShurikenParticleBillboard");var $g=$v.prototype;$h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$T(0,$g,"random1",function(){return this._randoms1}),$T(0,$g,"startRotation2",function(){return this._startRotation2}),$T(0,$g,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$T(0,$g,"velocity",function(){return this._velocity}),$T(0,$g,"random0",function(){return this._randoms0}),$T(0,$g,"startSize",function(){return this._startSize}),$T(0,$g,"startColor",function(){return this._startColor}),$T(0,$g,"startRotation0",function(){return this._startRotation0}),$T(0,$g,"startRotation1",function(){return this._startRotation1}),$T(0,$g,"startLifeTime",function(){return this._startLifeTime}),$T(0,$g,"time",function(){return this._time}),$T(0,$g,"startSpeed",function(){return this._startSpeed}),$T(0,$g,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(152,[new $$v(0,"vector4",17),new $$v(16,"vector4",30),new $$v(32,"vector4",32),new $$v(48,"vector4",19),new $$v(64,"vector3",20),new $$v(76,"vector3",22),new $$v(88,"single",31),new $$v(92,"vector4",34),new $$v(108,"vector4",35),new $$v(124,"vector3",36),new $$v(136,"vector4",37)])}])}(),function(){function $v($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D,$J,$p){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$v,this._positionStartLifeTime=$g,this._velocity=$Q,this._startColor=$d,this._startSize=$r,this._startRotation0=$k,this._startRotation1=$$,this._startRotation2=$b,this._startLifeTime=$a,this._time=$M,this._startSpeed=$Y,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$p}$p($v,"laya.d3.graphics.VertexShurikenParticleMesh");var $g=$v.prototype;$h.imps($g,{"laya.d3.graphics.IVertex":!0}),$T(0,$g,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$T(0,$g,"velocity",function(){return this._velocity}),$T(0,$g,"position",function(){return this._positionStartLifeTime}),$T(0,$g,"random0",function(){return this._randoms0}),$T(0,$g,"startSize",function(){return this._startSize}),$T(0,$g,"startColor",function(){return this._startColor}),$T(0,$g,"startRotation0",function(){return this._startRotation0}),$T(0,$g,"startRotation1",function(){return this._startRotation1}),$T(0,$g,"random1",function(){return this._randoms1}),$T(0,$g,"startRotation2",function(){return this._startRotation2}),$T(0,$g,"startLifeTime",function(){return this._startLifeTime}),$T(0,$g,"time",function(){return this._time}),$T(0,$g,"startSpeed",function(){return this._startSpeed}),$T(0,$g,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$T(0,$g,"vertexDeclaration",function(){return $v._vertexDeclaration}),$T(1,$v,"vertexDeclaration",function(){return $v._vertexDeclaration}),$D($v,["_vertexDeclaration",function(){return this._vertexDeclaration=new $kv(172,[new $$v(0,"vector3",0),new $$v(12,"vector4",1),new $$v(28,"vector2",2),new $$v(36,"vector4",30),new $$v(52,"vector4",32),new $$v(68,"vector4",19),new $$v(84,"vector3",20),new $$v(96,"vector3",22),new $$v(108,"single",31),new $$v(112,"vector4",34),new $$v(128,"vector4",35),new $$v(144,"vector3",36),new $$v(156,"vector4",37)])}])}(),function(){function $s($v,$g,$Q,$d,$r,$k){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$Q,this._materials=$d,this._subMeshes=$r,this._materialMap=$k,this._version=$g,this._onLoaded($v)}$p($s,"laya.d3.loaders.LoadModelV01");var $v=$s.prototype;return $v._onLoaded=function($v){this._readData=$v,this.READ_BLOCK();for(var $g=0;$g<this._BLOCK.count;$g++){var $Q=this._readData.getUint16(),$d=this._strings[$Q],$r=this["READ_"+$d];if(null==$r)throw new Error("model file err,no this function:"+$Q+" "+$d);if(!$r.call(this))break}return this._mesh},$v.onError=function(){},$v._readString=function(){return this._strings[this._readData.getUint16()]},$v.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$v.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$v.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $v=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $g=0;$g<this._STRINGS.size;$g++)this._strings[$g]=this._readData.readUTFString();return this._readData.pos=$v,!0},$v.READ_MATERIAL=function(){var $v=this._readData.getUint16(),$g=(this._readString(),this._readString());return this._materials[$v]="null"!==$g?$C.getRes(this._materialMap[$g]):new $Vg,!0},$v.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $v,$g=this._readData.__getBuffer(),$Q=0,$d=this._readData.getUint32(),$r=this._readData.getUint32(),$k=(new Float32Array($g.slice($d+this._DATA.offset,$d+this._DATA.offset+$r)),this._readData.getUint32()),$$=this._readData.getUint32(),$b=new Float32Array($g.slice($k+this._DATA.offset,$k+this._DATA.offset+$$));for(this.mesh._inverseBindPoses=[],$Q=0,$v=$b.length;$Q<$v;$Q+=16){var $a=new $vg($b[$Q+0],$b[$Q+1],$b[$Q+2],$b[$Q+3],$b[$Q+4],$b[$Q+5],$b[$Q+6],$b[$Q+7],$b[$Q+8],$b[$Q+9],$b[$Q+10],$b[$Q+11],$b[$Q+12],$b[$Q+13],$b[$Q+14],$b[$Q+15]);this.mesh._inverseBindPoses.push($a)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$v.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $v=this._readString();this._shaderAttributes=$v.match($s._attrReg);var $g=this._readData.getUint32(),$Q=this._readData.getUint32(),$d=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$r=this._readData.getUint32(),$k=this._readData.getUint32(),$$=this._readData.getUint32(),$b=this._readData.__getBuffer(),$a=new $Mg(this._mesh),$M=this._getVertexDeclaration(),$Y=$cg.create($M,$r/$M.vertexStride,35044,!0),$D=$d+this._DATA.offset,$J=$b.slice($D,$D+$r);$Y.setData(new Float32Array($J));for(var $p=($a._vertexBuffer=$Y).vertexDeclaration.getVertexElements(),$T=0;$T<$p.length;$T++)$a._bufferUsage[$p[$T].elementUsage]=$Y;var $t=$Kg.create("ushort",$Q/2,35044,!0),$q=$g+this._DATA.offset,$C=$b.slice($q,$q+$Q);$t.setData(new Uint16Array($C)),$a._indexBuffer=$t;var $G=$b.slice($k+this._DATA.offset,$k+this._DATA.offset+$$);return $a._boneIndicesList[0]=new Uint8Array($G),this._subMeshes.push($a),!0},$v.READ_DATAAREA=function(){return!1},$v._getVertexDeclaration=function(){for(var $v,$g=!1,$Q=!1,$d=!1,$r=!1,$k=!1,$$=!1,$b=!1,$a=!1,$M=!1,$Y=0;$Y<this._shaderAttributes.length;$Y+=8)switch(this._shaderAttributes[$Y]){case"POSITION":$g=!0;break;case"NORMAL":$Q=!0;break;case"COLOR":$d=!0;break;case"UV":$r=!0;break;case"UV1":$k=!0;break;case"BLENDWEIGHT":$b=!0;break;case"BLENDINDICES":$a=!0;break;case"TANGENT":$$=!0;break;case"BINORMAL":$M=!0}return $g&&$Q&&$d&&$r&&$k&&$b&&$a&&$$?$v=$sv.vertexDeclaration:$g&&$Q&&$d&&$r&&$k&&$b&&$a?$v=$Cv.vertexDeclaration:$g&&$Q&&$r&&$k&&$b&&$a&&$$?$v=$iv.vertexDeclaration:$g&&$Q&&$r&&$k&&$b&&$a?$v=$Xv.vertexDeclaration:$g&&$Q&&$d&&$r&&$b&&$a&&$$?$v=$Fv.vertexDeclaration:$g&&$Q&&$d&&$r&&$b&&$a?$v=$Pv.vertexDeclaration:$g&&$Q&&$$&&$M&&$r&&$b&&$a?$v=$nv.vertexDeclaration:$g&&$Q&&$r&&$b&&$a&&$$?$v=$cv.vertexDeclaration:$g&&$Q&&$r&&$b&&$a?$v=$mv.vertexDeclaration:$g&&$Q&&$d&&$b&&$a&&$$?$v=$Jv.vertexDeclaration:$g&&$Q&&$d&&$b&&$a?$v=$Yv.vertexDeclaration:$g&&$Q&&$d&&$r&&$k&&$$?$v=$hv.vertexDeclaration:$g&&$Q&&$d&&$r&&$k?$v=$qv.vertexDeclaration:$g&&$Q&&$r&&$k&&$$?$v=$wv.vertexDeclaration:$g&&$Q&&$r&&$k?$v=$fv.vertexDeclaration:$g&&$Q&&$d&&$r&&$$?$v=$ov.vertexDeclaration:$g&&$Q&&$r&&$$&&$M?$v=$Lv.vertexDeclaration:$g&&$Q&&$d&&$r?$v=$tv.vertexDeclaration:$g&&$Q&&$r&&$$?$v=$jv.vertexDeclaration:$g&&$Q&&$r?$v=$Zv.vertexDeclaration:$g&&$Q&&$d&&$$?$v=$Tv.vertexDeclaration:$g&&$Q&&$d&&($v=$Mv.vertexDeclaration),$v},$T(0,$v,"mesh",function(){return this._mesh}),$s._attrReg=new RegExp("(\\w+)|([:,;])","g"),$s}()),$Rv=function(){function $W(){}return $p($W,"laya.d3.loaders.LoadModelV02"),$W.parse=function($v,$g,$Q,$d,$r,$k){$W._mesh=$Q,$W._materials=$d,$W._subMeshes=$r,$W._materialMap=$k,$W._version=$g,$W._readData=$v,$W.READ_DATA(),$W.READ_BLOCK(),$W.READ_STRINGS();for(var $$=0,$b=$W._BLOCK.count;$$<$b;$$++){$W._readData.pos=$W._BLOCK.blockStarts[$$];var $a=$W._readData.getUint16(),$M=$W._strings[$a],$Y=$W["READ_"+$M];if(null==$Y)throw new Error("model file err,no this function:"+$a+" "+$M);$Y.call()}$W._strings.length=0,$W._readData=null,$W._version=null,$W._mesh=null,$W._materials=null,$W._subMeshes=null,$W._materialMap=null},$W._readString=function(){return $W._strings[$W._readData.getUint16()]},$W.READ_DATA=function(){$W._DATA.offset=$W._readData.getUint32(),$W._DATA.size=$W._readData.getUint32()},$W.READ_BLOCK=function(){for(var $v=$W._BLOCK.count=$W._readData.getUint16(),$g=$W._BLOCK.blockStarts=[],$Q=$W._BLOCK.blockLengths=[],$d=0;$d<$v;$d++)$g.push($W._readData.getUint32()),$Q.push($W._readData.getUint32())},$W.READ_STRINGS=function(){var $v=$W._readData.getUint32(),$g=$W._readData.getUint16(),$Q=$W._readData.pos;$W._readData.pos=$v+$W._DATA.offset;for(var $d=0;$d<$g;$d++)$W._strings[$d]=$W._readData.readUTFString();$W._readData.pos=$Q},$W.READ_MATERIAL=function(){$W._readString(),$W._readString();var $v=$W._readString();return""!==$v&&$W._materials.push($C.getRes($W._materialMap[$v])),!0},$W.READ_MESH=function(){$W._readString();var $v,$g=$W._readData.__getBuffer(),$Q=0,$d=$W._readData.getInt16(),$r=$W._DATA.offset;for($Q=0;$Q<$d;$Q++){var $k=$r+$W._readData.getUint32(),$$=$W._readData.getUint32(),$b=new Float32Array($g.slice($k,$k+$$)),$a=$W._readString().match($W._attrReg),$M=$W._getVertexDeclaration($a),$Y=$cg.create($M,4*$b.length/$M.vertexStride,35044,!0);$Y.setData($b),$W._mesh._vertexBuffers.push($Y)}var $D=$r+$W._readData.getUint32(),$J=$W._readData.getUint32(),$p=new Uint16Array($g.slice($D,$D+$J)),$T=$Kg.create("ushort",$J/2,35044,!0);$T.setData($p),$W._mesh._indexBuffer=$T;var $t=$W._mesh._boneNames=[],$q=$W._readData.getUint16();for($t.length=$q,$Q=0;$Q<$q;$Q++)$t[$Q]=$W._strings[$W._readData.getUint16()];var $C=$W._readData.getUint32(),$G=$W._readData.getUint32(),$s=(new Float32Array($g.slice($r+$C,$r+$C+$G)),$W._readData.getUint32()),$A=$W._readData.getUint32(),$h=new Float32Array($g.slice($r+$s,$r+$s+$A));for($W._mesh._inverseBindPoses=[],$Q=0,$v=$h.length;$Q<$v;$Q+=16){var $P=new $vg($h[$Q+0],$h[$Q+1],$h[$Q+2],$h[$Q+3],$h[$Q+4],$h[$Q+5],$h[$Q+6],$h[$Q+7],$h[$Q+8],$h[$Q+9],$h[$Q+10],$h[$Q+11],$h[$Q+12],$h[$Q+13],$h[$Q+14],$h[$Q+15]);$W._mesh._inverseBindPoses.push($P)}return $W._mesh._skinnedDatas=new Float32Array(16*$h.length),!0},$W.READ_SUBMESH=function(){var $v=$W._readData.__getBuffer(),$g=new $Mg($W._mesh),$Q=$W._readData.getInt16(),$d=$W._readData.getUint32(),$r=$W._readData.getUint32();$g._vertexBuffer=$W._mesh._vertexBuffers[$Q],$g._vertexStart=$d,$g._vertexCount=$r;var $k=$W._readData.getUint32(),$$=$W._readData.getUint32(),$b=$W._mesh._indexBuffer;$g._indexBuffer=$b,$g._indexStart=$k,$g._indexCount=$$,$g._indices=new Uint16Array($b.getData().buffer,2*$k,$$);var $a=$W._DATA.offset,$M=$g._subIndexBufferStart,$Y=$g._subIndexBufferCount,$D=$g._boneIndicesList,$J=$W._readData.getUint16();$M.length=$J,$Y.length=$J,$D.length=$J;for(var $p=0;$p<$J;$p++){$M[$p]=$W._readData.getUint32(),$Y[$p]=$W._readData.getUint32();var $T=$W._readData.getUint32(),$t=$W._readData.getUint32();$g._boneIndicesList[$p]=new Uint8Array($v.slice($a+$T,$a+$T+$t))}return $W._subMeshes.push($g),!0},$W._getVertexDeclaration=function($v){for(var $g,$Q=!1,$d=!1,$r=!1,$k=!1,$$=!1,$b=!1,$a=!1,$M=!1,$Y=!1,$D=0;$D<$v.length;$D++)switch($v[$D]){case"POSITION":$Q=!0;break;case"NORMAL":$d=!0;break;case"COLOR":$r=!0;break;case"UV":$k=!0;break;case"UV1":$$=!0;break;case"BLENDWEIGHT":$a=!0;break;case"BLENDINDICES":$M=!0;break;case"TANGENT":$b=!0;break;case"BINORMAL":$Y=!0}return $Q&&$d&&$r&&$k&&$$&&$a&&$M&&$b?$g=$sv.vertexDeclaration:$Q&&$d&&$r&&$k&&$$&&$a&&$M?$g=$Cv.vertexDeclaration:$Q&&$d&&$k&&$$&&$a&&$M&&$b?$g=$iv.vertexDeclaration:$Q&&$d&&$k&&$$&&$a&&$M?$g=$Xv.vertexDeclaration:$Q&&$d&&$r&&$k&&$a&&$M&&$b?$g=$Fv.vertexDeclaration:$Q&&$d&&$r&&$k&&$a&&$M?$g=$Pv.vertexDeclaration:$Q&&$d&&$k&&$a&&$M&&$b?$g=$cv.vertexDeclaration:$Q&&$d&&$k&&$a&&$M?$g=$mv.vertexDeclaration:$Q&&$d&&$r&&$a&&$M&&$b?$g=$Jv.vertexDeclaration:$Q&&$d&&$r&&$a&&$M?$g=$Yv.vertexDeclaration:$Q&&$d&&$r&&$k&&$$&&$b?$g=$hv.vertexDeclaration:$Q&&$d&&$r&&$k&&$$?$g=$qv.vertexDeclaration:$Q&&$d&&$k&&$$&&$b?$g=$wv.vertexDeclaration:$Q&&$d&&$k&&$$?$g=$fv.vertexDeclaration:$Q&&$d&&$r&&$k&&$b?$g=$ov.vertexDeclaration:$Q&&$d&&$k&&$b&&$Y?$g=$Lv.vertexDeclaration:$Q&&$d&&$r&&$k?$g=$tv.vertexDeclaration:$Q&&$d&&$k&&$b?$g=$jv.vertexDeclaration:$Q&&$d&&$k?$g=$Zv.vertexDeclaration:$Q&&$d&&$r&&$b?$g=$Tv.vertexDeclaration:$Q&&$d&&$r&&($g=$Mv.vertexDeclaration),$g},$W._attrReg=new RegExp("(\\w+)|([:,;])","g"),$W._strings=[],$W._readData=null,$W._version=null,$W._mesh=null,$W._materials=null,$W._subMeshes=null,$W._materialMap=null,$D($W,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$W}(),$zv=function(){function $P(){}return $p($P,"laya.d3.loaders.LoadModelV03"),$P.parse=function($v,$g,$Q,$d,$r){$P._mesh=$Q,$P._subMeshes=$d,$P._materialMap=$r,$P._version=$g,$P._readData=$v,$P.READ_DATA(),$P.READ_BLOCK(),$P.READ_STRINGS();for(var $k=0,$$=$P._BLOCK.count;$k<$$;$k++){$P._readData.pos=$P._BLOCK.blockStarts[$k];var $b=$P._readData.getUint16(),$a=$P._strings[$b],$M=$P["READ_"+$a];if(null==$M)throw new Error("model file err,no this function:"+$b+" "+$a);$M.call()}$P._strings.length=0,$P._readData=null,$P._version=null,$P._mesh=null,$P._subMeshes=null,$P._materialMap=null},$P._readString=function(){return $P._strings[$P._readData.getUint16()]},$P.READ_DATA=function(){$P._DATA.offset=$P._readData.getUint32(),$P._DATA.size=$P._readData.getUint32()},$P.READ_BLOCK=function(){for(var $v=$P._BLOCK.count=$P._readData.getUint16(),$g=$P._BLOCK.blockStarts=[],$Q=$P._BLOCK.blockLengths=[],$d=0;$d<$v;$d++)$g.push($P._readData.getUint32()),$Q.push($P._readData.getUint32())},$P.READ_STRINGS=function(){var $v=$P._readData.getUint32(),$g=$P._readData.getUint16(),$Q=$P._readData.pos;$P._readData.pos=$v+$P._DATA.offset;for(var $d=0;$d<$g;$d++)$P._strings[$d]=$P._readData.readUTFString();$P._readData.pos=$Q},$P.READ_MESH=function(){var $v,$g=$P._readString(),$Q=$P._readData.__getBuffer(),$d=0,$r=$P._readData.getInt16(),$k=$P._DATA.offset;for($d=0;$d<$r;$d++){var $$,$b=$k+$P._readData.getUint32(),$a=$P._readData.getUint32(),$M=new Float32Array($Q.slice($b,$b+$a)),$Y=$P._readString();switch($P._version){case"LAYAMODEL:03":$$=$P._vertexDeclarationMap_Discard[$Y];break;case"LAYAMODEL:0301":$$=$P._vertexDeclarationMap[$Y];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$$)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$P._version+"  bufferAttribute="+$Y+"  name="+$g+"  url="+($P._mesh?$P._mesh.url:"null"));var $D=$cg.create($$,4*$M.length/$$.vertexStride,35044,!0,$P._mesh._url+"_"+$d);$D.setData($M),$P._mesh._vertexBuffers.push($D)}var $J=$k+$P._readData.getUint32(),$p=$P._readData.getUint32(),$T=new Uint16Array($Q.slice($J,$J+$p)),$t=$Kg.create("ushort",$p/2,35044,!0,$P._mesh._url);$t.setData($T),$P._mesh._indexBuffer=$t;var $q=$P._mesh._boneNames=[],$C=$P._readData.getUint16();for($q.length=$C,$d=0;$d<$C;$d++)$q[$d]=$P._strings[$P._readData.getUint16()];$P._readData.pos+=8;var $G=$P._readData.getUint32(),$s=$P._readData.getUint32(),$A=new Float32Array($Q.slice($k+$G,$k+$G+$s));for($P._mesh._inverseBindPoses=[],$d=0,$v=$A.length;$d<$v;$d+=16){var $h=new $vg($A[$d+0],$A[$d+1],$A[$d+2],$A[$d+3],$A[$d+4],$A[$d+5],$A[$d+6],$A[$d+7],$A[$d+8],$A[$d+9],$A[$d+10],$A[$d+11],$A[$d+12],$A[$d+13],$A[$d+14],$A[$d+15]);$P._mesh._inverseBindPoses.push($h)}return $P._mesh._skinnedDatas=new Float32Array(16*$A.length),!0},$P.READ_SUBMESH=function(){var $v=$P._readData.__getBuffer(),$g=new $Mg($P._mesh),$Q=$P._readData.getInt16(),$d=$P._readData.getUint32(),$r=$P._readData.getUint32();$g._vertexBuffer=$P._mesh._vertexBuffers[$Q],$g._vertexStart=$d,$g._vertexCount=$r;var $k=$P._readData.getUint32(),$$=$P._readData.getUint32(),$b=$P._mesh._indexBuffer;$g._indexBuffer=$b,$g._indexStart=$k,$g._indexCount=$$,$g._indices=new Uint16Array($b.getData().buffer,2*$k,$$);var $a=$P._DATA.offset,$M=$g._subIndexBufferStart,$Y=$g._subIndexBufferCount,$D=$g._boneIndicesList,$J=$P._readData.getUint16();$M.length=$J,$Y.length=$J,$D.length=$J;for(var $p=0;$p<$J;$p++){$M[$p]=$P._readData.getUint32(),$Y[$p]=$P._readData.getUint32();var $T=$P._readData.getUint32(),$t=$P._readData.getUint32();$D[$p]=new Uint8Array($v.slice($a+$T,$a+$T+$t))}return $P._subMeshes.push($g),!0},$P._strings=[],$P._readData=null,$P._version=null,$P._mesh=null,$P._subMeshes=null,$P._materialMap=null,$D($P,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$sv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Cv.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Hv.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$iv.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Xv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Fv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$Pv.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$cv.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$mv.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$Jv.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$Yv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$hv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$qv.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$wv.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$fv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$ov.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$Lv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$tv.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$jv.vertexDeclaration,"POSITION,NORMAL,UV":$Zv.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$Tv.vertexDeclaration,"POSITION,NORMAL,COLOR":$Mv.vertexDeclaration,"POSITION,NORMAL,TANGENT":$Vv.vertexDeclaration,"POSITION,NORMAL":$av.vertexDeclaration,"POSITION,UV":$yv.vertexDeclaration,POSITION:$bv.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Gv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Cv.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Hv.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Nv.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$Xv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Wv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$Pv.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Kv.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$mv.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$Dv.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$Yv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Av.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$qv.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$xv.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$fv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$lv.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$Lv.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$tv.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Bv.vertexDeclaration,"POSITION,NORMAL,UV":$Zv.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$pv.vertexDeclaration,"POSITION,NORMAL,COLOR":$Mv.vertexDeclaration,"POSITION,NORMAL,TANGENT":$Ev.vertexDeclaration,"POSITION,NORMAL":$av.vertexDeclaration,"POSITION,UV":$yv.vertexDeclaration,POSITION:$bv.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$P}(),$Uv=function(){function $b(){}return $p($b,"laya.d3.loaders.MeshReader"),$b.read=function($v,$g,$Q,$d,$r){var $k=new $P($v);$k.pos=0;var $$=$k.readUTFString();switch($$){case"LAYAMODEL:01":case"LAYASKINANI:01":$b._readVersion01($k,$$,$g,$Q,$d,$r);break;case"LAYAMODEL:02":$Rv.parse($k,$$,$g,$Q,$d,$r);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$zv.parse($k,$$,$g,$d,$r);break;default:throw new Error("MeshReader: unknown mesh version.")}$g._setSubMeshes($d)},$b._readVersion01=function($v,$g,$Q,$d,$r,$k){new $ev($v,$g,$Q,$d,$r,$k)},$b}(),$Iv=function(){function $v($v,$g){this.min=null,this.max=null,this.min=$v,this.max=$g}$p($v,"laya.d3.math.BoundBox");var $g=$v.prototype;return $h.imps($g,{"laya.d3.core.IClone":!0}),$g.getCorners=function($v){$v.length=8;var $g=this.min.elements,$Q=this.max.elements,$d=$g[0],$r=$g[1],$k=$g[2],$$=$Q[0],$b=$Q[1],$a=$Q[2];$v[0]=new $$g($d,$b,$a),$v[1]=new $$g($$,$b,$a),$v[2]=new $$g($$,$r,$a),$v[3]=new $$g($d,$r,$a),$v[4]=new $$g($d,$b,$k),$v[5]=new $$g($$,$b,$k),$v[6]=new $$g($$,$r,$k),$v[7]=new $$g($d,$r,$k)},$g.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$g.cloneTo=function($v){var $g=$v;this.min.cloneTo($g.min),this.max.cloneTo($g.max)},$g.clone=function(){var $v=new this.constructor(new $$g,new $$g);return this.cloneTo($v),$v},$v.createfromPoints=function($v,$g){if(null==$v)throw new Error("points");var $Q=$g.min,$d=$g.max,$r=$Q.elements;$r[0]=Number.MAX_VALUE,$r[1]=Number.MAX_VALUE,$r[2]=Number.MAX_VALUE;var $k=$d.elements;$k[0]=-Number.MAX_VALUE,$k[1]=-Number.MAX_VALUE,$k[2]=-Number.MAX_VALUE;for(var $$=0,$b=$v.length;$$<$b;++$$)$$g.min($Q,$v[$$],$Q),$$g.max($d,$v[$$],$d)},$v.merge=function($v,$g,$Q){$$g.min($v.min,$g.min,$Q.min),$$g.max($v.max,$g.max,$Q.max)},$v}(),$Sv=function(){function $M($v){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$v,this._near=new $gg(new $$g),this._far=new $gg(new $$g),this._left=new $gg(new $$g),this._right=new $gg(new $$g),this._top=new $gg(new $$g),this._bottom=new $gg(new $$g),$M._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$p($M,"laya.d3.math.BoundFrustum");var $v=$M.prototype;return $v.equalsBoundFrustum=function($v){return this._matrix.equalsOtherMatrix($v.matrix)},$v.equalsObj=function($v){if($v instanceof laya.d3.math.BoundFrustum){var $g=$v;return this.equalsBoundFrustum($g)}return!1},$v.getPlane=function($v){switch($v){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$v.getCorners=function($v){$M._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($v[0]),$M._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($v[1]),$M._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($v[2]),$M._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($v[3]),$M._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($v[4]),$M._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($v[5]),$M._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($v[6]),$M._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($v[7])},$v.containsPoint=function($v){for(var $g=$gg.PlaneIntersectionType_Front,$Q=$gg.PlaneIntersectionType_Front,$d=0;$d<6;$d++){switch($d){case 0:$Q=Collision.intersectsPlaneAndPoint(this._near,$v);break;case 1:$Q=Collision.intersectsPlaneAndPoint(this._far,$v);break;case 2:$Q=Collision.intersectsPlaneAndPoint(this._left,$v);break;case 3:$Q=Collision.intersectsPlaneAndPoint(this._right,$v);break;case 4:$Q=Collision.intersectsPlaneAndPoint(this._top,$v);break;case 5:$Q=Collision.intersectsPlaneAndPoint(this._bottom,$v)}switch($Q){case $gg.PlaneIntersectionType_Back:return 0;case $gg.PlaneIntersectionType_Intersecting:$g=$gg.PlaneIntersectionType_Intersecting}}switch($g){case $gg.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$v.containsBoundBox=function($v){for(var $g,$Q=$M._tempV30,$d=$M._tempV31,$r=1,$k=0;$k<6;$k++){if($g=this.getPlane($k),this._getBoxToPlanePVertexNVertex($v,$g.normal,$Q,$d),Collision.intersectsPlaneAndPoint($g,$Q)===$gg.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($g,$d)===$gg.PlaneIntersectionType_Back&&($r=2)}return $r},$v.containsBoundSphere=function($v){for(var $g=$gg.PlaneIntersectionType_Front,$Q=$gg.PlaneIntersectionType_Front,$d=0;$d<6;$d++){switch($d){case 0:$Q=Collision.intersectsPlaneAndSphere(this._near,$v);break;case 1:$Q=Collision.intersectsPlaneAndSphere(this._far,$v);break;case 2:$Q=Collision.intersectsPlaneAndSphere(this._left,$v);break;case 3:$Q=Collision.intersectsPlaneAndSphere(this._right,$v);break;case 4:$Q=Collision.intersectsPlaneAndSphere(this._top,$v);break;case 5:$Q=Collision.intersectsPlaneAndSphere(this._bottom,$v)}switch($Q){case $gg.PlaneIntersectionType_Back:return 0;case $gg.PlaneIntersectionType_Intersecting:$g=$gg.PlaneIntersectionType_Intersecting}}switch($g){case $gg.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$v._getBoxToPlanePVertexNVertex=function($v,$g,$Q,$d){var $r=$v.min,$k=$r.elements,$$=$v.max,$b=$$.elements,$a=$g.elements,$M=$a[0],$Y=$a[1],$D=$a[2];$r.cloneTo($Q);var $J=$Q.elements;0<=$M&&($J[0]=$b[0]),0<=$Y&&($J[1]=$b[1]),0<=$D&&($J[2]=$b[2]),$$.cloneTo($d);var $p=$d.elements;0<=$M&&($p[0]=$k[0]),0<=$Y&&($p[1]=$k[1]),0<=$D&&($p[2]=$k[2])},$T(0,$v,"top",function(){return this._top}),$T(0,$v,"matrix",function(){return this._matrix},function($v){this._matrix=$v,$M._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$T(0,$v,"near",function(){return this._near}),$T(0,$v,"far",function(){return this._far}),$T(0,$v,"left",function(){return this._left}),$T(0,$v,"right",function(){return this._right}),$T(0,$v,"bottom",function(){return this._bottom}),$M._getPlanesFromMatrix=function($v,$g,$Q,$d,$r,$k,$$){var $b=$v.elements,$a=$b[0],$M=$b[1],$Y=$b[2],$D=$b[3],$J=$b[4],$p=$b[5],$T=$b[6],$t=$b[7],$q=$b[8],$C=$b[9],$G=$b[10],$s=$b[11],$A=$b[12],$h=$b[13],$P=$b[14],$W=$b[15],$F=$g.normal.elements;$F[0]=$D+$Y,$F[1]=$t+$T,$F[2]=$s+$G,$g.distance=$W+$P,$g.normalize();var $l=$Q.normal.elements;$l[0]=$D-$Y,$l[1]=$t-$T,$l[2]=$s-$G,$Q.distance=$W-$P,$Q.normalize();var $o=$d.normal.elements;$o[0]=$D+$a,$o[1]=$t+$J,$o[2]=$s+$q,$d.distance=$W+$A,$d.normalize();var $E=$r.normal.elements;$E[0]=$D-$a,$E[1]=$t-$J,$E[2]=$s-$q,$r.distance=$W-$A,$r.normalize();var $V=$k.normal.elements;$V[0]=$D-$M,$V[1]=$t-$p,$V[2]=$s-$C,$k.distance=$W-$h,$k.normalize();var $Z=$$.normal.elements;$Z[0]=$D+$M,$Z[1]=$t+$p,$Z[2]=$s+$C,$$.distance=$W+$h,$$.normalize()},$M._get3PlaneInterPoint=function($v,$g,$Q){var $d=$v.normal,$r=$g.normal,$k=$Q.normal;$$g.cross($r,$k,$M._tempV30),$$g.cross($k,$d,$M._tempV31),$$g.cross($d,$r,$M._tempV32);var $$=$$g.dot($d,$M._tempV30),$b=$$g.dot($r,$M._tempV31),$a=$$g.dot($k,$M._tempV32);return $$g.scale($M._tempV30,-$v.distance/$$,$M._tempV33),$$g.scale($M._tempV31,-$g.distance/$b,$M._tempV34),$$g.scale($M._tempV32,-$Q.distance/$a,$M._tempV35),$$g.add($M._tempV33,$M._tempV34,$M._tempV36),$$g.add($M._tempV35,$M._tempV36,$M._tempV37),$M._tempV37},$D($M,["_tempV30",function(){return this._tempV30=new $$g},"_tempV31",function(){return this._tempV31=new $$g},"_tempV32",function(){return this._tempV32=new $$g},"_tempV33",function(){return this._tempV33=new $$g},"_tempV34",function(){return this._tempV34=new $$g},"_tempV35",function(){return this._tempV35=new $$g},"_tempV36",function(){return this._tempV36=new $$g},"_tempV37",function(){return this._tempV37=new $$g}]),$M}(),$Ov=function(){function $Y($v,$g){this.center=null,this.radius=NaN,this.center=$v,this.radius=$g}$p($Y,"laya.d3.math.BoundSphere");var $v=$Y.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.toDefault=function(){this.center.toDefault(),this.radius=0},$v.intersectsRayDistance=function($v){return Collision.intersectsRayAndSphereRD($v,this)},$v.intersectsRayPoint=function($v,$g){return Collision.intersectsRayAndSphereRP($v,this,$g)},$v.cloneTo=function($v){var $g=$v;this.center.cloneTo($g.center),$g.radius=this.radius},$v.clone=function(){var $v=new this.constructor(new $$g,new $$g);return this.cloneTo($v),$v},$Y.createFromSubPoints=function($v,$g,$Q,$d){if(null==$v)throw new Error("points");if($g<0||$g>=$v.length)throw new Error("start"+$g+"Must be in the range [0, "+($v.length-1)+"]");if($Q<0||$g+$Q>$v.length)throw new Error("count"+$Q+"Must be in the range <= "+$v.length+"}");var $r=$g+$Q,$k=$Y._tempVector3;$k.elements[0]=0,$k.elements[1]=0,$k.elements[2]=0;for(var $$=$g;$$<$r;++$$)$$g.add($v[$$],$k,$k);var $b=$d.center;$$g.scale($k,1/$Q,$b);var $a=0;for($$=$g;$$<$r;++$$){var $M=$$g.distanceSquared($b,$v[$$]);$a<$M&&($a=$M)}$d.radius=Math.sqrt($a)},$Y.createfromPoints=function($v,$g){if(null==$v)throw new Error("points");$Y.createFromSubPoints($v,0,$v.length,$g)},$D($Y,["_tempVector3",function(){return this._tempVector3=new $$g}]),$Y}(),$_v=(function(){function $v(){}$p($v,"laya.d3.math.ContainmentType"),$v.Disjoint=0,$v.Contains=1,$v.Intersects=2}(),function(){function $Q(){}return $p($Q,"laya.d3.math.MathUtils3D"),$Q.isZero=function($v){return Math.abs($v)<$Q.zeroTolerance},$Q.nearEqual=function($v,$g){return!!$Q.isZero($v-$g)},$Q.fastInvSqrt=function($v){return $Q.isZero($v)?$v:1/Math.sqrt($v)},$D($Q,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$Q}()),$uv=function(){function $a(){var $v=this.elements=new Float32Array(9);$v[0]=1,$v[1]=0,$v[2]=0,$v[3]=0,$v[4]=1,$v[5]=0,$v[6]=0,$v[7]=0,$v[8]=1}$p($a,"laya.d3.math.Matrix3x3");var $v=$a.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.determinant=function(){var $v=this.elements,$g=$v[0],$Q=$v[1],$d=$v[2],$r=$v[3],$k=$v[4],$$=$v[5],$b=$v[6],$a=$v[7],$M=$v[8];return $g*($M*$k-$$*$a)+$Q*(-$M*$r+$$*$b)+$d*($a*$r-$k*$b)},$v.translate=function($v,$g){var $Q=$g.elements,$d=this.elements,$r=$v.elements,$k=$d[0],$$=$d[1],$b=$d[2],$a=$d[3],$M=$d[4],$Y=$d[5],$D=$d[6],$J=$d[7],$p=$d[8],$T=$r[0],$t=$r[1];$Q[0]=$k,$Q[1]=$$,$Q[2]=$b,$Q[3]=$a,$Q[4]=$M,$Q[5]=$Y,$Q[6]=$T*$k+$t*$a+$D,$Q[7]=$T*$$+$t*$M+$J,$Q[8]=$T*$b+$t*$Y+$p},$v.rotate=function($v,$g){var $Q=$g.elements,$d=this.elements,$r=$d[0],$k=$d[1],$$=$d[2],$b=$d[3],$a=$d[4],$M=$d[5],$Y=$d[6],$D=$d[7],$J=$d[8],$p=Math.sin($v),$T=Math.cos($v);$Q[0]=$T*$r+$p*$b,$Q[1]=$T*$k+$p*$a,$Q[2]=$T*$$+$p*$M,$Q[3]=$T*$b-$p*$r,$Q[4]=$T*$a-$p*$k,$Q[5]=$T*$M-$p*$$,$Q[6]=$Y,$Q[7]=$D,$Q[8]=$J},$v.scale=function($v,$g){var $Q=$g.elements,$d=this.elements,$r=$v.elements,$k=$r[0],$$=$r[1];$Q[0]=$k*$d[0],$Q[1]=$k*$d[1],$Q[2]=$k*$d[2],$Q[3]=$$*$d[3],$Q[4]=$$*$d[4],$Q[5]=$$*$d[5],$Q[6]=$d[6],$Q[7]=$d[7],$Q[8]=$d[8]},$v.invert=function($v){var $g=$v.elements,$Q=this.elements,$d=$Q[0],$r=$Q[1],$k=$Q[2],$$=$Q[3],$b=$Q[4],$a=$Q[5],$M=$Q[6],$Y=$Q[7],$D=$Q[8],$J=$D*$b-$a*$Y,$p=-$D*$$+$a*$M,$T=$Y*$$-$b*$M,$t=$d*$J+$r*$p+$k*$T;$t||($v=null),$t=1/$t,$g[0]=$J*$t,$g[1]=(-$D*$r+$k*$Y)*$t,$g[2]=($a*$r-$k*$b)*$t,$g[3]=$p*$t,$g[4]=($D*$d-$k*$M)*$t,$g[5]=(-$a*$d+$k*$$)*$t,$g[6]=$T*$t,$g[7]=(-$Y*$d+$r*$M)*$t,$g[8]=($b*$d-$r*$$)*$t},$v.transpose=function($v){var $g=$v.elements,$Q=this.elements;if($v===this){var $d=$Q[1],$r=$Q[2],$k=$Q[5];$g[1]=$Q[3],$g[2]=$Q[6],$g[3]=$d,$g[5]=$Q[7],$g[6]=$r,$g[7]=$k}else $g[0]=$Q[0],$g[1]=$Q[3],$g[2]=$Q[6],$g[3]=$Q[1],$g[4]=$Q[4],$g[5]=$Q[7],$g[6]=$Q[2],$g[7]=$Q[5],$g[8]=$Q[8]},$v.identity=function(){var $v=this.elements;$v[0]=1,$v[1]=0,$v[2]=0,$v[3]=0,$v[4]=1,$v[5]=0,$v[6]=0,$v[7]=0,$v[8]=1},$v.cloneTo=function($v){var $g,$Q,$d;if(($Q=this.elements)!==($d=$v.elements))for($g=0;$g<9;++$g)$d[$g]=$Q[$g]},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$a.createFromTranslation=function($v,$g){$g.elements;var $Q=$v.elements;$g[0]=1,$g[1]=0,$g[2]=0,$g[3]=0,$g[4]=1,$g[5]=0,$g[6]=$Q[0],$g[7]=$Q[1],$g[8]=1},$a.createFromRotation=function($v,$g){var $Q=$g.elements,$d=Math.sin($v),$r=Math.cos($v);$Q[0]=$r,$Q[1]=$d,$Q[2]=0,$Q[3]=-$d,$Q[4]=$r,$Q[5]=0,$Q[6]=0,$Q[7]=0,$Q[8]=1},$a.createFromScaling=function($v,$g){var $Q=$g.elements,$d=$v.elements;$Q[0]=$d[0],$Q[1]=0,$Q[2]=0,$Q[3]=0,$Q[4]=$d[1],$Q[5]=0,$Q[6]=0,$Q[7]=0,$Q[8]=1},$a.createFromMatrix4x4=function($v,$g){$g[0]=$v[0],$g[1]=$v[1],$g[2]=$v[2],$g[3]=$v[4],$g[4]=$v[5],$g[5]=$v[6],$g[6]=$v[8],$g[7]=$v[9],$g[8]=$v[10]},$a.multiply=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements,$$=$r[0],$b=$r[1],$a=$r[2],$M=$r[3],$Y=$r[4],$D=$r[5],$J=$r[6],$p=$r[7],$T=$r[8],$t=$k[0],$q=$k[1],$C=$k[2],$G=$k[3],$s=$k[4],$A=$k[5],$h=$k[6],$P=$k[7],$W=$k[8];$d[0]=$t*$$+$q*$M+$C*$J,$d[1]=$t*$b+$q*$Y+$C*$p,$d[2]=$t*$a+$q*$D+$C*$T,$d[3]=$G*$$+$s*$M+$A*$J,$d[4]=$G*$b+$s*$Y+$A*$p,$d[5]=$G*$a+$s*$D+$A*$T,$d[6]=$h*$$+$P*$M+$W*$J,$d[7]=$h*$b+$P*$Y+$W*$p,$d[8]=$h*$a+$P*$D+$W*$T},$a.lookAt=function($v,$g,$Q,$d){$$g.subtract($v,$g,$a._tempV30),$$g.normalize($a._tempV30,$a._tempV30),$$g.cross($Q,$a._tempV30,$a._tempV31),$$g.normalize($a._tempV31,$a._tempV31),$$g.cross($a._tempV30,$a._tempV31,$a._tempV32);var $r=$a._tempV30.elements,$k=$a._tempV31.elements,$$=$a._tempV32.elements,$b=$d.elements;$b[0]=$k[0],$b[3]=$k[1],$b[6]=$k[2],$b[1]=$$[0],$b[4]=$$[1],$b[7]=$$[2],$b[2]=$r[0],$b[5]=$r[1],$b[8]=$r[2]},$a.DEFAULT=new $a,$D($a,["_tempV30",function(){return this._tempV30=new $$g},"_tempV31",function(){return this._tempV31=new $$g},"_tempV32",function(){return this._tempV32=new $$g}]),$a}(),$vg=function(){function $l($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D,$J,$p,$T,$t){void 0===$v&&($v=1),void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$k&&($k=1),void 0===$$&&($$=0),void 0===$b&&($b=0),void 0===$a&&($a=0),void 0===$M&&($M=0),void 0===$Y&&($Y=1),void 0===$D&&($D=0),void 0===$J&&($J=0),void 0===$p&&($p=0),void 0===$T&&($T=0),void 0===$t&&($t=1);var $q=this.elements=new Float32Array(16);$q[0]=$v,$q[1]=$g,$q[2]=$Q,$q[3]=$d,$q[4]=$r,$q[5]=$k,$q[6]=$$,$q[7]=$b,$q[8]=$a,$q[9]=$M,$q[10]=$Y,$q[11]=$D,$q[12]=$J,$q[13]=$p,$q[14]=$T,$q[15]=$t}$p($l,"laya.d3.math.Matrix4x4");var $v=$l.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.getElementByRowColumn=function($v,$g){if($v<0||3<$v)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($g<0||3<$g)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$v+$g]},$v.setElementByRowColumn=function($v,$g,$Q){if($v<0||3<$v)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($g<0||3<$g)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$v+$g]=$Q},$v.equalsOtherMatrix=function($v){var $g=this.elements,$Q=$v.elements;return $_v.nearEqual($g[0],$Q[0])&&$_v.nearEqual($g[1],$Q[1])&&$_v.nearEqual($g[2],$Q[2])&&$_v.nearEqual($g[3],$Q[3])&&$_v.nearEqual($g[4],$Q[4])&&$_v.nearEqual($g[5],$Q[5])&&$_v.nearEqual($g[6],$Q[6])&&$_v.nearEqual($g[7],$Q[7])&&$_v.nearEqual($g[8],$Q[8])&&$_v.nearEqual($g[9],$Q[9])&&$_v.nearEqual($g[10],$Q[10])&&$_v.nearEqual($g[11],$Q[11])&&$_v.nearEqual($g[12],$Q[12])&&$_v.nearEqual($g[13],$Q[13])&&$_v.nearEqual($g[14],$Q[14])&&$_v.nearEqual($g[15],$Q[15])},$v.decomposeTransRotScale=function($v,$g,$Q){var $d=$l._tempMatrix4x4;return this.decomposeTransRotMatScale($v,$d,$Q)?($Qg.createFromMatrix4x4($d,$g),!0):($g.identity(),!1)},$v.decomposeTransRotMatScale=function($v,$g,$Q){var $d=this.elements,$r=$v.elements,$k=$g.elements,$$=$Q.elements;$r[0]=$d[12],$r[1]=$d[13],$r[2]=$d[14];var $b=$d[0],$a=$d[1],$M=$d[2],$Y=$d[4],$D=$d[5],$J=$d[6],$p=$d[8],$T=$d[9],$t=$d[10],$q=$$[0]=Math.sqrt($b*$b+$a*$a+$M*$M),$C=$$[1]=Math.sqrt($Y*$Y+$D*$D+$J*$J),$G=$$[2]=Math.sqrt($p*$p+$T*$T+$t*$t);if($_v.isZero($q)||$_v.isZero($C)||$_v.isZero($G))return $k[1]=$k[2]=$k[3]=$k[4]=$k[6]=$k[7]=$k[8]=$k[9]=$k[11]=$k[12]=$k[13]=$k[14]=0,$k[0]=$k[5]=$k[10]=$k[15]=1,!1;var $s=$l._tempVector0,$A=$s.elements;$A[0]=$p/$G,$A[1]=$T/$G,$A[2]=$t/$G;var $h=$l._tempVector1,$P=$h.elements;$P[0]=$b/$q,$P[1]=$a/$q,$P[2]=$M/$q;var $W=$l._tempVector2;$$g.cross($s,$h,$W);var $F=$l._tempVector1;return $$g.cross($W,$s,$F),$k[3]=$k[7]=$k[11]=$k[12]=$k[13]=$k[14]=0,$k[15]=1,$k[0]=$F.x,$k[1]=$F.y,$k[2]=$F.z,$k[4]=$W.x,$k[5]=$W.y,$k[6]=$W.z,$k[8]=$s.x,$k[9]=$s.y,$k[10]=$s.z,$k[0]*$b+$k[1]*$a+$k[2]*$M<0&&($$[0]=-$q),$k[4]*$Y+$k[5]*$D+$k[6]*$J<0&&($$[1]=-$C),$k[8]*$p+$k[9]*$T+$k[10]*$t<0&&($$[2]=-$G),!0},$v.decomposeYawPitchRoll=function($v){var $g=$v.elements,$Q=Math.asin(-this.elements[9]);$g[1]=$Q,Math.cos($Q)>$_v.zeroTolerance?($g[2]=Math.atan2(this.elements[1],this.elements[5]),$g[0]=Math.atan2(this.elements[8],this.elements[10])):($g[2]=Math.atan2(-this.elements[4],this.elements[0]),$g[0]=0)},$v.normalize=function(){var $v=this.elements,$g=$v[0],$Q=$v[1],$d=$v[2],$r=Math.sqrt($g*$g+$Q*$Q+$d*$d);if(!$r)return $v[0]=0,$v[1]=0,void($v[2]=0);1!=$r&&($r=1/$r,$v[0]=$g*$r,$v[1]=$Q*$r,$v[2]=$d*$r)},$v.transpose=function(){var $v,$g;return $g=($v=this.elements)[1],$v[1]=$v[4],$v[4]=$g,$g=$v[2],$v[2]=$v[8],$v[8]=$g,$g=$v[3],$v[3]=$v[12],$v[12]=$g,$g=$v[6],$v[6]=$v[9],$v[9]=$g,$g=$v[7],$v[7]=$v[13],$v[13]=$g,$g=$v[11],$v[11]=$v[14],$v[14]=$g,this},$v.invert=function($v){var $g=this.elements,$Q=$v.elements,$d=$g[0],$r=$g[1],$k=$g[2],$$=$g[3],$b=$g[4],$a=$g[5],$M=$g[6],$Y=$g[7],$D=$g[8],$J=$g[9],$p=$g[10],$T=$g[11],$t=$g[12],$q=$g[13],$C=$g[14],$G=$g[15],$s=$d*$a-$r*$b,$A=$d*$M-$k*$b,$h=$d*$Y-$$*$b,$P=$r*$M-$k*$a,$W=$r*$Y-$$*$a,$F=$k*$Y-$$*$M,$l=$D*$q-$J*$t,$o=$D*$C-$p*$t,$E=$D*$G-$T*$t,$V=$J*$C-$p*$q,$Z=$J*$G-$T*$q,$f=$p*$G-$T*$C,$X=$s*$f-$A*$Z+$h*$V+$P*$E-$W*$o+$F*$l;0!==Math.abs($X)&&($X=1/$X,$Q[0]=($a*$f-$M*$Z+$Y*$V)*$X,$Q[1]=($k*$Z-$r*$f-$$*$V)*$X,$Q[2]=($q*$F-$C*$W+$G*$P)*$X,$Q[3]=($p*$W-$J*$F-$T*$P)*$X,$Q[4]=($M*$E-$b*$f-$Y*$o)*$X,$Q[5]=($d*$f-$k*$E+$$*$o)*$X,$Q[6]=($C*$h-$t*$F-$G*$A)*$X,$Q[7]=($D*$F-$p*$h+$T*$A)*$X,$Q[8]=($b*$Z-$a*$E+$Y*$l)*$X,$Q[9]=($r*$E-$d*$Z-$$*$l)*$X,$Q[10]=($t*$W-$q*$h+$G*$s)*$X,$Q[11]=($J*$h-$D*$W-$T*$s)*$X,$Q[12]=($a*$o-$b*$V-$M*$l)*$X,$Q[13]=($d*$V-$r*$o+$k*$l)*$X,$Q[14]=($q*$A-$t*$P-$C*$s)*$X,$Q[15]=($D*$P-$J*$A+$p*$s)*$X)},$v.identity=function(){var $v=this.elements;$v[1]=$v[2]=$v[3]=$v[4]=$v[6]=$v[7]=$v[8]=$v[9]=$v[11]=$v[12]=$v[13]=$v[14]=0,$v[0]=$v[5]=$v[10]=$v[15]=1},$v.cloneTo=function($v){var $g,$Q,$d;if(($Q=this.elements)!==($d=$v.elements))for($g=0;$g<16;++$g)$d[$g]=$Q[$g]},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$v.getTranslationVector=function($v){var $g=this.elements,$Q=$v.elements;$Q[0]=$g[12],$Q[1]=$g[13],$Q[2]=$g[14]},$v.setTranslationVector=function($v){var $g=this.elements,$Q=$v.elements;$g[12]=$Q[0],$g[13]=$Q[1],$g[14]=$Q[2]},$v.getForward=function($v){var $g=this.elements,$Q=$v.elements;$Q[0]=-$g[8],$Q[1]=-$g[9],$Q[2]=-$g[10]},$v.setForward=function($v){var $g=this.elements,$Q=$v.elements;$g[8]=-$Q[0],$g[9]=-$Q[1],$g[10]=-$Q[2]},$l.createRotationX=function($v,$g){var $Q=$g.elements,$d=Math.sin($v),$r=Math.cos($v);$Q[1]=$Q[2]=$Q[3]=$Q[4]=$Q[7]=$Q[8]=$Q[11]=$Q[12]=$Q[13]=$Q[14]=0,$Q[0]=$Q[15]=1,$Q[5]=$Q[10]=$r,$Q[6]=$d,$Q[9]=-$d},$l.createRotationY=function($v,$g){var $Q=$g.elements,$d=Math.sin($v),$r=Math.cos($v);$Q[1]=$Q[3]=$Q[4]=$Q[6]=$Q[7]=$Q[9]=$Q[11]=$Q[12]=$Q[13]=$Q[14]=0,$Q[5]=$Q[15]=1,$Q[0]=$Q[10]=$r,$Q[2]=-$d,$Q[8]=$d},$l.createRotationZ=function($v,$g){var $Q=$g.elements,$d=Math.sin($v),$r=Math.cos($v);$Q[2]=$Q[3]=$Q[6]=$Q[7]=$Q[8]=$Q[9]=$Q[11]=$Q[12]=$Q[13]=$Q[14]=0,$Q[10]=$Q[15]=1,$Q[0]=$Q[5]=$r,$Q[1]=$d,$Q[4]=-$d},$l.createRotationYawPitchRoll=function($v,$g,$Q,$d){$Qg.createFromYawPitchRoll($v,$g,$Q,$l._tempQuaternion),$l.createRotationQuaternion($l._tempQuaternion,$d)},$l.createRotationAxis=function($v,$g,$Q){var $d=$v.elements,$r=$d[0],$k=$d[1],$$=$d[2],$b=Math.cos($g),$a=Math.sin($g),$M=$r*$r,$Y=$k*$k,$D=$$*$$,$J=$r*$k,$p=$r*$$,$T=$k*$$,$t=$Q.elements;$t[3]=$t[7]=$t[11]=$t[12]=$t[13]=$t[14]=0,$t[15]=1,$t[0]=$M+$b*(1-$M),$t[1]=$J-$b*$J+$a*$$,$t[2]=$p-$b*$p-$a*$k,$t[4]=$J-$b*$J-$a*$$,$t[5]=$Y+$b*(1-$Y),$t[6]=$T-$b*$T+$a*$r,$t[8]=$p-$b*$p+$a*$k,$t[9]=$T-$b*$T-$a*$r,$t[10]=$D+$b*(1-$D)},$l.createRotationQuaternion=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$Q[0],$k=$Q[1],$$=$Q[2],$b=$Q[3],$a=$r*$r,$M=$k*$k,$Y=$$*$$,$D=$r*$k,$J=$$*$b,$p=$$*$r,$T=$k*$b,$t=$k*$$,$q=$r*$b;$d[3]=$d[7]=$d[11]=$d[12]=$d[13]=$d[14]=0,$d[15]=1,$d[0]=1-2*($M+$Y),$d[1]=2*($D+$J),$d[2]=2*($p-$T),$d[4]=2*($D-$J),$d[5]=1-2*($Y+$a),$d[6]=2*($t+$q),$d[8]=2*($p+$T),$d[9]=2*($t-$q),$d[10]=1-2*($M+$a)},$l.createTranslate=function($v,$g){var $Q=$v.elements,$d=$g.elements;$d[4]=$d[8]=$d[1]=$d[9]=$d[2]=$d[6]=$d[3]=$d[7]=$d[11]=0,$d[0]=$d[5]=$d[10]=$d[15]=1,$d[12]=$Q[0],$d[13]=$Q[1],$d[14]=$Q[2]},$l.createScaling=function($v,$g){var $Q=$v.elements,$d=$g.elements;$d[0]=$Q[0],$d[5]=$Q[1],$d[10]=$Q[2],$d[1]=$d[4]=$d[8]=$d[12]=$d[9]=$d[13]=$d[2]=$d[6]=$d[14]=$d[3]=$d[7]=$d[11]=0,$d[15]=1},$l.multiply=function($v,$g,$Q){var $d,$r,$k,$$,$b,$a,$M,$Y;for($r=$Q.elements,$k=$v.elements,$r===($$=$g.elements)&&($$=$$.slice()),$d=0;$d<4;$d++)$b=$k[$d],$a=$k[$d+4],$M=$k[$d+8],$Y=$k[$d+12],$r[$d]=$b*$$[0]+$a*$$[1]+$M*$$[2]+$Y*$$[3],$r[$d+4]=$b*$$[4]+$a*$$[5]+$M*$$[6]+$Y*$$[7],$r[$d+8]=$b*$$[8]+$a*$$[9]+$M*$$[10]+$Y*$$[11],$r[$d+12]=$b*$$[12]+$a*$$[13]+$M*$$[14]+$Y*$$[15]},$l.createFromQuaternion=function($v,$g){var $Q=$g.elements,$d=$v.elements,$r=$d[0],$k=$d[1],$$=$d[2],$b=$d[3],$a=$r+$r,$M=$k+$k,$Y=$$+$$,$D=$r*$a,$J=$k*$a,$p=$k*$M,$T=$$*$a,$t=$$*$M,$q=$$*$Y,$C=$b*$a,$G=$b*$M,$s=$b*$Y;$Q[0]=1-$p-$q,$Q[1]=$J+$s,$Q[2]=$T-$G,$Q[3]=0,$Q[4]=$J-$s,$Q[5]=1-$D-$q,$Q[6]=$t+$C,$Q[7]=0,$Q[8]=$T+$G,$Q[9]=$t-$C,$Q[10]=1-$D-$p,$Q[11]=0,$Q[12]=0,$Q[13]=0,$Q[14]=0,$Q[15]=1},$l.createAffineTransformation=function($v,$g,$Q,$d){var $r=$v.elements,$k=$g.elements,$$=$Q.elements,$b=$d.elements,$a=$k[0],$M=$k[1],$Y=$k[2],$D=$k[3],$J=$a+$a,$p=$M+$M,$T=$Y+$Y,$t=$a*$J,$q=$a*$p,$C=$a*$T,$G=$M*$p,$s=$M*$T,$A=$Y*$T,$h=$D*$J,$P=$D*$p,$W=$D*$T,$F=$$[0],$l=$$[1],$o=$$[2];$b[0]=(1-($G+$A))*$F,$b[1]=($q+$W)*$F,$b[2]=($C-$P)*$F,$b[3]=0,$b[4]=($q-$W)*$l,$b[5]=(1-($t+$A))*$l,$b[6]=($s+$h)*$l,$b[7]=0,$b[8]=($C+$P)*$o,$b[9]=($s-$h)*$o,$b[10]=(1-($t+$G))*$o,$b[11]=0,$b[12]=$r[0],$b[13]=$r[1],$b[14]=$r[2],$b[15]=1},$l.createLookAt=function($v,$g,$Q,$d){var $r=$d.elements,$k=$l._tempVector0,$$=$l._tempVector1,$b=$l._tempVector2;$$g.subtract($v,$g,$b),$$g.normalize($b,$b),$$g.cross($Q,$b,$k),$$g.normalize($k,$k),$$g.cross($b,$k,$$),$d.identity(),$r[0]=$k.x,$r[4]=$k.y,$r[8]=$k.z,$r[1]=$$.x,$r[5]=$$.y,$r[9]=$$.z,$r[2]=$b.x,$r[6]=$b.y,$r[10]=$b.z,$r[12]=-$$g.dot($k,$v),$r[13]=-$$g.dot($$,$v),$r[14]=-$$g.dot($b,$v)},$l.createPerspective=function($v,$g,$Q,$d,$r){var $k=$r.elements,$$=1/Math.tan($v/2),$b=1/($Q-$d);$k[0]=$$/$g,$k[5]=$$,$k[10]=($d+$Q)*$b,$k[11]=-1,$k[14]=2*$d*$Q*$b,$k[1]=$k[2]=$k[3]=$k[4]=$k[6]=$k[7]=$k[8]=$k[9]=$k[12]=$k[13]=$k[15]=0},$l.createOrthoOffCenterRH=function($v,$g,$Q,$d,$r,$k,$$){var $b=$$.elements,$a=1/($v-$g),$M=1/($Q-$d),$Y=1/($r-$k);$b[1]=$b[2]=$b[3]=$b[4]=$b[6]=$b[7]=$b[8]=$b[9]=$b[11]=0,$b[15]=1,$b[0]=-2*$a,$b[5]=-2*$M,$b[10]=2*$Y,$b[12]=($v+$g)*$a,$b[13]=($d+$Q)*$M,$b[14]=($k+$r)*$Y},$l.translation=function($v,$g){var $Q=$v.elements,$d=$g.elements;$d[0]=$d[5]=$d[10]=$d[15]=1,$d[12]=$Q[0],$d[13]=$Q[1],$d[14]=$Q[2]},$D($l,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $l},"_tempVector0",function(){return this._tempVector0=new $$g},"_tempVector1",function(){return this._tempVector1=new $$g},"_tempVector2",function(){return this._tempVector2=new $$g},"_tempQuaternion",function(){return this._tempQuaternion=new $Qg},"DEFAULT",function(){return this.DEFAULT=new $l},"ZERO",function(){return this.ZERO=new $l(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$l}(),$gg=(function(){function $s($v,$g){this.extents=null,this.transformation=null,this.extents=$v,this.transformation=$g}$p($s,"laya.d3.math.OrientedBoundBox");var $v=$s.prototype;$v.getCorners=function($v){var $g=$s._tempV30.elements,$Q=$s._tempV31.elements,$d=$s._tempV32.elements,$r=this.extents.elements;$g[0]=$r[0],$g[1]=$g[2]=0,$Q[1]=$r[1],$Q[0]=$Q[2]=0,$d[2]=$r[2],$d[0]=$d[1]=0,$$g.TransformNormal($s._tempV30,this.transformation,$s._tempV30),$$g.TransformNormal($s._tempV31,this.transformation,$s._tempV31),$$g.TransformNormal($s._tempV32,this.transformation,$s._tempV32);var $k=$s._tempV33;this.transformation.getTranslationVector($k),$v.length=8,$$g.add($k,$s._tempV30,$s._tempV34),$$g.add($s._tempV34,$s._tempV31,$s._tempV34),$$g.add($s._tempV34,$s._tempV32,$v[0]),$$g.add($k,$s._tempV30,$s._tempV34),$$g.add($s._tempV34,$s._tempV31,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV32,$v[1]),$$g.subtract($k,$s._tempV30,$s._tempV34),$$g.add($s._tempV34,$s._tempV31,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV32,$v[2]),$$g.subtract($k,$s._tempV30,$s._tempV34),$$g.add($s._tempV34,$s._tempV31,$s._tempV34),$$g.add($s._tempV34,$s._tempV32,$v[3]),$$g.add($k,$s._tempV30,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV31,$s._tempV34),$$g.add($s._tempV34,$s._tempV32,$v[4]),$$g.add($k,$s._tempV30,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV31,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV32,$v[5]),$$g.subtract($k,$s._tempV30,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV31,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV32,$v[6]),$$g.subtract($k,$s._tempV30,$s._tempV34),$$g.subtract($s._tempV34,$s._tempV31,$s._tempV34),$$g.add($s._tempV34,$s._tempV32,$v[7])},$v.transform=function($v){$vg.multiply(this.transformation,$v,this.transformation)},$v.scale=function($v){$$g.multiply(this.extents,$v,this.extents)},$v.translate=function($v){this.transformation.getTranslationVector($s._tempV30),$$g.add($s._tempV30,$v,$s._tempV31),this.transformation.setTranslationVector($s._tempV31)},$v.Size=function($v){$$g.scale(this.extents,2,$v)},$v.getSize=function($v){var $g=this.extents.elements;$s._tempV30.x=$g[0],$s._tempV31.y=$g[1],$s._tempV32.z=$g[2],$$g.TransformNormal($s._tempV30,this.transformation,$s._tempV30),$$g.TransformNormal($s._tempV31,this.transformation,$s._tempV31),$$g.TransformNormal($s._tempV31,this.transformation,$s._tempV32);var $Q=$v.elements;$Q[0]=$$g.scalarLength($s._tempV30),$Q[1]=$$g.scalarLength($s._tempV31),$Q[2]=$$g.scalarLength($s._tempV32)},$v.getSizeSquared=function($v){var $g=this.extents.elements;$s._tempV30.x=$g[0],$s._tempV31.y=$g[1],$s._tempV32.z=$g[2],$$g.TransformNormal($s._tempV30,this.transformation,$s._tempV30),$$g.TransformNormal($s._tempV31,this.transformation,$s._tempV31),$$g.TransformNormal($s._tempV31,this.transformation,$s._tempV32);var $Q=$v.elements;$Q[0]=$$g.scalarLengthSquared($s._tempV30),$Q[1]=$$g.scalarLengthSquared($s._tempV31),$Q[2]=$$g.scalarLengthSquared($s._tempV32)},$v.getCenter=function($v){this.transformation.getTranslationVector($v)},$v.containsPoint=function($v){var $g=this.extents.elements,$Q=$g[0],$d=$g[1],$r=$g[2];this.transformation.invert($s._tempM0),$$g.transformCoordinate($v,$s._tempM0,$s._tempV30);var $k=$s._tempV30.elements,$$=Math.abs($k[0]),$b=Math.abs($k[1]),$a=Math.abs($k[2]);return $_v.nearEqual($$,$Q)&&$_v.nearEqual($b,$d)&&$_v.nearEqual($a,$r)?2:$$<$Q&&$b<$d&&$a<$r?1:0},$v.containsPoints=function($v){var $g=this.extents.elements,$Q=$g[0],$d=$g[1],$r=$g[2];this.transformation.invert($s._tempM0);for(var $k=!0,$$=!1,$b=0;$b<$v.length;$b++){$$g.transformCoordinate($v[$b],$s._tempM0,$s._tempV30);var $a=$s._tempV30.elements,$M=Math.abs($a[0]),$Y=Math.abs($a[1]),$D=Math.abs($a[2]);$_v.nearEqual($M,$Q)&&$_v.nearEqual($Y,$d)&&$_v.nearEqual($D,$r)&&($$=!0),$M<$Q&&$Y<$d&&$D<$r?$$=!0:$k=!1}return $k?1:$$?2:0},$v.containsSphere=function($v,$g){void 0===$g&&($g=!1);var $Q=this.extents.elements,$d=$Q[0],$r=$Q[1],$k=$Q[2],$$=$v.radius;this.transformation.invert($s._tempM0),$$g.transformCoordinate($v.center,$s._tempM0,$s._tempV30);var $b=NaN;if($b=$g?$$:($$g.scale($$g.UnitX,$$,$s._tempV31),$$g.TransformNormal($s._tempV31,$s._tempM0,$s._tempV31),$$g.scalarLength($s._tempV31)),$$g.scale(this.extents,-1,$s._tempV32),$$g.Clamp($s._tempV30,$s._tempV32,this.extents,$s._tempV33),$b*$b<$$g.distanceSquared($s._tempV30,$s._tempV33))return 0;var $a=$s._tempV30.elements,$M=$a[0],$Y=$a[1],$D=$a[2],$J=$s._tempV32.elements,$p=$J[0],$T=$J[1],$t=$J[2];return $p+$b<=$M&&$M<=$d-$b&&$b<$d-$p&&$T+$b<=$Y&&$Y<=$r-$b&&$b<$r-$T&&$t+$b<=$D&&$D<=$k-$b&&$b<$k-$t?1:2},$v.containsOrientedBoundBox=function($v){var $g=0,$Q=0;$v.getCorners($s._corners);var $d=this.containsPoints($s._corners);if(0!=$d)return $d;var $r=this.extents.elements;$v.extents.cloneTo($s._tempV35);var $k=$s._tempV35.elements;$s._getRows(this.transformation,$s._rows1),$s._getRows($v.transformation,$s._rows2);var $$=NaN;for($g=0;$g<4;$g++)for($Q=0;$Q<4;$Q++)3==$g||3==$Q?($s._tempM0.setElementByRowColumn($g,$Q,0),$s._tempM1.setElementByRowColumn($g,$Q,0)):($$=$$g.dot($s._rows1[$g],$s._rows2[$Q]),$s._tempM0.setElementByRowColumn($g,$Q,$$),$s._tempM1.setElementByRowColumn($g,$Q,Math.abs($$)));$v.getCenter($s._tempV34),this.getCenter($s._tempV36),$$g.subtract($s._tempV34,$s._tempV36,$s._tempV30);var $b=$s._tempV31.elements;$b[0]=$$g.dot($s._tempV30,$s._rows1[0]),$b[1]=$$g.dot($s._tempV30,$s._rows1[1]),$b[2]=$$g.dot($s._tempV30,$s._rows1[2]);var $a=$s._tempV32.elements,$M=$s._tempV33.elements;for($g=0;$g<3;$g++)if($a[0]=$s._tempM1.getElementByRowColumn($g,0),$a[1]=$s._tempM1.getElementByRowColumn($g,1),$a[2]=$s._tempM1.getElementByRowColumn($g,2),$r[$g]+$$g.dot($s._tempV35,$s._tempV32)<Math.abs($b[$g]))return 0;for($Q=0;$Q<3;$Q++)if($a[0]=$s._tempM1.getElementByRowColumn(0,$Q),$a[1]=$s._tempM1.getElementByRowColumn(1,$Q),$a[2]=$s._tempM1.getElementByRowColumn(2,$Q),$M[0]=$s._tempM0.getElementByRowColumn(0,$Q),$M[1]=$s._tempM0.getElementByRowColumn(1,$Q),$M[2]=$s._tempM0.getElementByRowColumn(2,$Q),$$g.dot(this.extents,$s._tempV32)+$k[$Q]<Math.abs($$g.dot($s._tempV31,$s._tempV33)))return 0;for($g=0;$g<3;$g++)for($Q=0;$Q<3;$Q++){var $Y=($g+1)%3,$D=($g+2)%3,$J=($Q+1)%3,$p=($Q+2)%3;if($r[$Y]*$s._tempM1.getElementByRowColumn($D,$Q)+$r[$D]*$s._tempM1.getElementByRowColumn($Y,$Q)+($k[$J]*$s._tempM1.getElementByRowColumn($g,$p)+$k[$p]*$s._tempM1.getElementByRowColumn($g,$J))<Math.abs($b[$D]*$s._tempM0.getElementByRowColumn($Y,$Q)-$b[$Y]*$s._tempM0.getElementByRowColumn($D,$Q)))return 0}return 2},$v.containsLine=function($v,$g){$s._corners[0]=$v,$s._corners[1]=$g;var $Q=this.containsPoints($s._corners);if(0!=$Q)return $Q;var $d=this.extents.elements,$r=$d[0],$k=$d[1],$$=$d[2];this.transformation.invert($s._tempM0),$$g.transformCoordinate($v,$s._tempM0,$s._tempV30),$$g.transformCoordinate($g,$s._tempM0,$s._tempV31),$$g.add($s._tempV30,$s._tempV31,$s._tempV32),$$g.scale($s._tempV32,.5,$s._tempV32),$$g.subtract($s._tempV30,$s._tempV32,$s._tempV33);var $b=$s._tempV33.elements,$a=$b[0],$M=$b[1],$Y=$b[2],$D=$s._tempV34.elements,$J=$D[0]=Math.abs($b[0]),$p=$D[1]=Math.abs($b[1]),$T=$D[2]=Math.abs($b[2]),$t=$s._tempV32.elements,$q=$t[0],$C=$t[1],$G=$t[2];return Math.abs($q)>$r+$J?0:Math.abs($C)>$k+$p?0:Math.abs($G)>$$+$T?0:Math.abs($C*$Y-$G*$M)>$k*$T+$$*$p?0:Math.abs($q*$Y-$G*$a)>$r*$T+$$*$J?0:Math.abs($q*$M-$C*$a)>$r*$p+$k*$J?0:2},$v.containsBoundBox=function($v){var $g=0,$Q=0,$d=$v.min,$r=$v.max;$v.getCorners($s._corners);var $k=this.containsPoints($s._corners);if(0!=$k)return $k;$$g.subtract($r,$d,$s._tempV30),$$g.scale($s._tempV30,.5,$s._tempV30),$$g.add($d,$s._tempV30,$s._tempV30),$$g.subtract($r,$s._tempV30,$s._tempV31);var $$=this.extents.elements,$b=$s._tempV31.elements;$s._getRows(this.transformation,$s._rows1),this.transformation.invert($s._tempM0);for($g=0;$g<3;$g++)for($Q=0;$Q<3;$Q++)$s._tempM1.setElementByRowColumn($g,$Q,Math.abs($s._tempM0.getElementByRowColumn($g,$Q)));this.getCenter($s._tempV35),$$g.subtract($s._tempV30,$s._tempV35,$s._tempV32);var $a=$s._tempV31.elements;$a[0]=$$g.dot($s._tempV32,$s._rows1[0]),$a[1]=$$g.dot($s._tempV32,$s._rows1[1]),$a[2]=$$g.dot($s._tempV32,$s._rows1[2]);var $M=$s._tempV33.elements,$Y=$s._tempV34.elements;for($g=0;$g<3;$g++)if($M[0]=$s._tempM1.getElementByRowColumn($g,0),$M[1]=$s._tempM1.getElementByRowColumn($g,1),$M[2]=$s._tempM1.getElementByRowColumn($g,2),$$[$g]+$$g.dot($s._tempV31,$s._tempV33)<Math.abs($a[$g]))return 0;for($Q=0;$Q<3;$Q++)if($M[0]=$s._tempM1.getElementByRowColumn(0,$Q),$M[1]=$s._tempM1.getElementByRowColumn(1,$Q),$M[2]=$s._tempM1.getElementByRowColumn(2,$Q),$Y[0]=$s._tempM0.getElementByRowColumn(0,$Q),$Y[1]=$s._tempM0.getElementByRowColumn(1,$Q),$Y[2]=$s._tempM0.getElementByRowColumn(2,$Q),$$g.dot(this.extents,$s._tempV33)+$b[$Q]<Math.abs($$g.dot($s._tempV31,$s._tempV34)))return 0;for($g=0;$g<3;$g++)for($Q=0;$Q<3;$Q++){var $D=($g+1)%3,$J=($g+2)%3,$p=($Q+1)%3,$T=($Q+2)%3;if($$[$D]*$s._tempM1.getElementByRowColumn($J,$Q)+$$[$J]*$s._tempM1.getElementByRowColumn($D,$Q)+($b[$p]*$s._tempM1.getElementByRowColumn($g,$T)+$b[$T]*$s._tempM1.getElementByRowColumn($g,$p))<Math.abs($a[$J]*$s._tempM0.getElementByRowColumn($D,$Q)-$a[$D]*$s._tempM0.getElementByRowColumn($J,$Q)))return 0}return 2},$v.intersectsRay=function($v,$g){$$g.scale(this.extents,-1,$s._tempV30),this.transformation.invert($s._tempM0),$$g.TransformNormal($v.direction,$s._tempM0,$s._ray.direction),$$g.transformCoordinate($v.origin,$s._tempM0,$s._ray.origin),$s._boxBound1.min=$s._tempV30,$s._boxBound1.max=this.extents;var $Q=Collision.intersectsRayAndBoxRP($s._ray,$s._boxBound1,$g);return-1!==$Q&&$$g.transformCoordinate($g,this.transformation,$g),$Q},$v._getLocalCorners=function($v){$v.length=8;var $g=this.extents.elements;$s._tempV30.x=$g[0],$s._tempV31.y=$g[1],$s._tempV32.z=$g[2],$$g.add($s._tempV30,$s._tempV31,$s._tempV33),$$g.add($s._tempV33,$s._tempV32,$v[0]),$$g.add($s._tempV30,$s._tempV31,$s._tempV33),$$g.subtract($s._tempV33,$s._tempV32,$v[1]),$$g.subtract($s._tempV31,$s._tempV30,$s._tempV33),$$g.subtract($s._tempV33,$s._tempV30,$v[2]),$$g.subtract($s._tempV31,$s._tempV30,$s._tempV33),$$g.add($s._tempV33,$s._tempV32,$v[3]),$$g.subtract($s._tempV30,$s._tempV31,$s._tempV33),$$g.add($s._tempV33,$s._tempV32,$v[4]),$$g.subtract($s._tempV30,$s._tempV31,$s._tempV33),$$g.subtract($s._tempV33,$s._tempV32,$v[5]),$$g.scale($v[0],-1,$v[6]),$$g.subtract($s._tempV32,$s._tempV30,$s._tempV33),$$g.subtract($s._tempV33,$s._tempV31,$v[7])},$v.equals=function($v){return this.extents==$v.extents&&this.transformation==$v.transformation},$v.cloneTo=function($v){var $g=$v;this.extents.cloneTo($g.extents),this.transformation.cloneTo($g.transformation)},$s.createByBoundBox=function($v,$g){var $Q=$v.min,$d=$v.max;$$g.subtract($d,$Q,$s._tempV30),$$g.scale($s._tempV30,.5,$s._tempV30),$$g.add($Q,$s._tempV30,$s._tempV31),$$g.subtract($d,$s._tempV31,$s._tempV32),$vg.translation($s._tempV31,$s._tempM0);var $r=$s._tempV32.clone(),$k=$s._tempM0.clone();$g.extents=$r,$g.transformation=$k},$s.createByMinAndMaxVertex=function($v,$g){return $$g.subtract($g,$v,$s._tempV30),$$g.scale($s._tempV30,.5,$s._tempV30),$$g.add($v,$s._tempV30,$s._tempV31),$$g.subtract($g,$s._tempV31,$s._tempV32),$vg.translation($s._tempV31,$s._tempM0),new $s($s._tempV32,$s._tempM0)},$s._getRows=function($v,$g){$g.length=3;var $Q=$v.elements,$d=$g[0].elements;$d[0]=$Q[0],$d[1]=$Q[1],$d[2]=$Q[2];var $r=$g[1].elements;$r[0]=$Q[4],$r[1]=$Q[5],$r[2]=$Q[6];var $k=$g[2].elements;$k[0]=$Q[8],$k[1]=$Q[9],$k[2]=$Q[10]},$s.getObbtoObbMatrix4x4=function($v,$g,$Q,$d){var $r=$v.transformation,$k=$g.transformation;if($Q){$s._getRows($r,$s._rows1),$s._getRows($k,$s._rows2);for(var $$=0;$$<3;$$++)for(var $b=0;$b<3;$b++)$d.setElementByRowColumn($$,$b,$$g.dot($s._rows2[$$],$s._rows1[$b]));$g.getCenter($s._tempV30),$v.getCenter($s._tempV31),$$g.subtract($s._tempV30,$s._tempV31,$s._tempV32);var $a=$d.elements;$a[12]=$$g.dot($s._tempV32,$s._rows1[0]),$a[13]=$$g.dot($s._tempV32,$s._rows1[1]),$a[14]=$$g.dot($s._tempV32,$s._rows1[2]),$a[15]=1}else $r.invert($s._tempM0),$vg.multiply($k,$s._tempM0,$d)},$s.merge=function($v,$g,$Q){var $d=$v.extents,$r=$v.transformation;$s.getObbtoObbMatrix4x4($v,$g,$Q,$s._tempM0),$g._getLocalCorners($s._corners),$$g.transformCoordinate($s._corners[0],$s._tempM0,$s._corners[0]),$$g.transformCoordinate($s._corners[1],$s._tempM0,$s._corners[1]),$$g.transformCoordinate($s._corners[2],$s._tempM0,$s._corners[2]),$$g.transformCoordinate($s._corners[3],$s._tempM0,$s._corners[3]),$$g.transformCoordinate($s._corners[4],$s._tempM0,$s._corners[4]),$$g.transformCoordinate($s._corners[5],$s._tempM0,$s._corners[5]),$$g.transformCoordinate($s._corners[6],$s._tempM0,$s._corners[6]),$$g.transformCoordinate($s._corners[7],$s._tempM0,$s._corners[7]),$$g.scale($d,-1,$s._boxBound1.min),$d.cloneTo($s._boxBound1.max),$Iv.createfromPoints($s._corners,$s._boxBound2),$Iv.merge($s._boxBound2,$s._boxBound1,$s._boxBound3);var $k=$s._boxBound3.min,$$=$s._boxBound3.max;$$g.subtract($$,$k,$s._tempV30),$$g.scale($s._tempV30,.5,$s._tempV30),$$g.add($k,$s._tempV30,$s._tempV32),$$g.subtract($$,$s._tempV32,$d),$$g.transformCoordinate($s._tempV32,$r,$s._tempV33)},$D($s,["_tempV30",function(){return this._tempV30=new $$g},"_tempV31",function(){return this._tempV31=new $$g},"_tempV32",function(){return this._tempV32=new $$g},"_tempV33",function(){return this._tempV33=new $$g},"_tempV34",function(){return this._tempV34=new $$g},"_tempV35",function(){return this._tempV35=new $$g},"_tempV36",function(){return this._tempV36=new $$g},"_tempM0",function(){return this._tempM0=new $vg},"_tempM1",function(){return this._tempM1=new $vg},"_corners",function(){return this._corners=[new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g]},"_rows1",function(){return this._rows1=[new $$g,new $$g,new $$g]},"_rows2",function(){return this._rows2=[new $$g,new $$g,new $$g]},"_ray",function(){return this._ray=new $rg(new $$g,new $$g)},"_boxBound1",function(){return this._boxBound1=new $Iv(new $$g,new $$g)},"_boxBound2",function(){return this._boxBound2=new $Iv(new $$g,new $$g)},"_boxBound3",function(){return this._boxBound3=new $Iv(new $$g,new $$g)}])}(),function(){function $h($v,$g){this.normal=null,this.distance=NaN,void 0===$g&&($g=0),this.normal=$v,this.distance=$g}return $p($h,"laya.d3.math.Plane"),$h.prototype.normalize=function(){var $v=this.normal.elements,$g=$v[0],$Q=$v[1],$d=$v[2],$r=1/Math.sqrt($g*$g+$Q*$Q+$d*$d);$v[0]=$g*$r,$v[1]=$Q*$r,$v[2]=$d*$r,this.distance*=$r},$h.createPlaneBy3P=function($v,$g,$Q){var $d=$v.elements,$r=$g.elements,$k=$Q.elements,$$=$r[0]-$d[0],$b=$r[1]-$d[1],$a=$r[2]-$d[2],$M=$k[0]-$d[0],$Y=$k[1]-$d[1],$D=$k[2]-$d[2],$J=$b*$D-$a*$Y,$p=$a*$M-$$*$D,$T=$$*$Y-$b*$M,$t=1/Math.sqrt($J*$J+$p*$p+$T*$T),$q=$J*$t,$C=$p*$t,$G=$T*$t,$s=$h._TEMPVec3.elements;$s[0]=$q,$s[1]=$C,$s[2]=$G;var $A=-($q*$d[0]+$C*$d[1]+$G*$d[2]);return new $h($h._TEMPVec3,$A)},$h.PlaneIntersectionType_Back=0,$h.PlaneIntersectionType_Front=1,$h.PlaneIntersectionType_Intersecting=2,$D($h,["_TEMPVec3",function(){return this._TEMPVec3=new $$g}]),$h}()),$Qg=function(){function $r($v,$g,$Q,$d){this.elements=new Float32Array(4),void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=1),this.elements[0]=$v,this.elements[1]=$g,this.elements[2]=$Q,this.elements[3]=$d}$p($r,"laya.d3.math.Quaternion");var $v=$r.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.scaling=function($v,$g){var $Q=$g.elements,$d=this.elements;$Q[0]=$d[0]*$v,$Q[1]=$d[1]*$v,$Q[2]=$d[2]*$v,$Q[3]=$d[3]*$v},$v.normalize=function($v){var $g=$v.elements,$Q=this.elements,$d=$Q[0],$r=$Q[1],$k=$Q[2],$$=$Q[3],$b=$d*$d+$r*$r+$k*$k+$$*$$;0<$b&&($b=1/Math.sqrt($b),$g[0]=$d*$b,$g[1]=$r*$b,$g[2]=$k*$b,$g[3]=$$*$b)},$v.length=function(){var $v=this.elements,$g=$v[0],$Q=$v[1],$d=$v[2],$r=$v[3];return Math.sqrt($g*$g+$Q*$Q+$d*$d+$r*$r)},$v.rotateX=function($v,$g){var $Q=$g.elements,$d=this.elements;$v*=.5;var $r=$d[0],$k=$d[1],$$=$d[2],$b=$d[3],$a=Math.sin($v),$M=Math.cos($v);$Q[0]=$r*$M+$b*$a,$Q[1]=$k*$M+$$*$a,$Q[2]=$$*$M-$k*$a,$Q[3]=$b*$M-$r*$a},$v.rotateY=function($v,$g){var $Q=$g.elements,$d=this.elements;$v*=.5;var $r=$d[0],$k=$d[1],$$=$d[2],$b=$d[3],$a=Math.sin($v),$M=Math.cos($v);$Q[0]=$r*$M-$$*$a,$Q[1]=$k*$M+$b*$a,$Q[2]=$$*$M+$r*$a,$Q[3]=$b*$M-$k*$a},$v.rotateZ=function($v,$g){var $Q=$g.elements,$d=this.elements;$v*=.5;var $r=$d[0],$k=$d[1],$$=$d[2],$b=$d[3],$a=Math.sin($v),$M=Math.cos($v);$Q[0]=$r*$M+$k*$a,$Q[1]=$k*$M-$r*$a,$Q[2]=$$*$M+$b*$a,$Q[3]=$b*$M-$$*$a},$v.getYawPitchRoll=function($v){$$g.transformQuat($$g.ForwardRH,this,$r.TEMPVector31),$$g.transformQuat($$g.Up,this,$r.TEMPVector32);var $g=$r.TEMPVector32.elements;$r.angleTo($$g.ZERO,$r.TEMPVector31,$r.TEMPVector33);var $Q=$r.TEMPVector33.elements;$Q[0]==Math.PI/2?($Q[1]=$r.arcTanAngle($g[2],$g[0]),$Q[2]=0):$Q[0]==-Math.PI/2?($Q[1]=$r.arcTanAngle(-$g[2],-$g[0]),$Q[2]=0):($vg.createRotationY(-$Q[1],$r.TEMPMatrix0),$vg.createRotationX(-$Q[0],$r.TEMPMatrix1),$$g.transformCoordinate($r.TEMPVector32,$r.TEMPMatrix0,$r.TEMPVector32),$$g.transformCoordinate($r.TEMPVector32,$r.TEMPMatrix1,$r.TEMPVector32),$Q[2]=$r.arcTanAngle($g[1],-$g[0])),$Q[1]<=-Math.PI&&($Q[1]=Math.PI),$Q[2]<=-Math.PI&&($Q[2]=Math.PI),$Q[1]>=Math.PI&&$Q[2]>=Math.PI&&($Q[1]=0,$Q[2]=0,$Q[0]=Math.PI-$Q[0]);var $d=$v.elements;$d[0]=$Q[1],$d[1]=$Q[0],$d[2]=$Q[2]},$v.invert=function($v){var $g=$v.elements,$Q=this.elements,$d=$Q[0],$r=$Q[1],$k=$Q[2],$$=$Q[3],$b=$d*$d+$r*$r+$k*$k+$$*$$,$a=$b?1/$b:0;$g[0]=-$d*$a,$g[1]=-$r*$a,$g[2]=-$k*$a,$g[3]=$$*$a},$v.identity=function(){var $v=this.elements;$v[0]=0,$v[1]=0,$v[2]=0,$v[3]=1},$v.fromArray=function($v,$g){void 0===$g&&($g=0),this.elements[0]=$v[$g+0],this.elements[1]=$v[$g+1],this.elements[2]=$v[$g+2],this.elements[3]=$v[$g+3]},$v.cloneTo=function($v){var $g,$Q,$d;if(($Q=this.elements)!==($d=$v.elements))for($g=0;$g<4;++$g)$d[$g]=$Q[$g]},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$v.equals=function($v){var $g=this.elements,$Q=$v.elements;return $_v.nearEqual($g[0],$Q[0])&&$_v.nearEqual($g[1],$Q[1])&&$_v.nearEqual($g[2],$Q[2])&&$_v.nearEqual($g[3],$Q[3])},$v.lengthSquared=function(){var $v=this.elements[0],$g=this.elements[1],$Q=this.elements[2],$d=this.elements[3];return $v*$v+$g*$g+$Q*$Q+$d*$d},$T(0,$v,"x",function(){return this.elements[0]}),$T(0,$v,"y",function(){return this.elements[1]}),$T(0,$v,"z",function(){return this.elements[2]}),$T(0,$v,"w",function(){return this.elements[3]}),$r.createFromYawPitchRoll=function($v,$g,$Q,$d){var $r=.5*$Q,$k=.5*$g,$$=.5*$v,$b=Math.sin($r),$a=Math.cos($r),$M=Math.sin($k),$Y=Math.cos($k),$D=Math.sin($$),$J=Math.cos($$),$p=$d.elements;$p[0]=$J*$M*$a+$D*$Y*$b,$p[1]=$D*$Y*$a-$J*$M*$b,$p[2]=$J*$Y*$b-$D*$M*$a,$p[3]=$J*$Y*$a+$D*$M*$b},$r.multiply=function($v,$g,$Q){var $d=$v.elements,$r=$g.elements,$k=$Q.elements,$$=$d[0],$b=$d[1],$a=$d[2],$M=$d[3],$Y=$r[0],$D=$r[1],$J=$r[2],$p=$r[3],$T=$b*$J-$a*$D,$t=$a*$Y-$$*$J,$q=$$*$D-$b*$Y,$C=$$*$Y+$b*$D+$a*$J;$k[0]=$$*$p+$Y*$M+$T,$k[1]=$b*$p+$D*$M+$t,$k[2]=$a*$p+$J*$M+$q,$k[3]=$M*$p-$C},$r.arcTanAngle=function($v,$g){return 0==$v?1==$g?Math.PI/2:-Math.PI/2:0<$v?Math.atan($g/$v):$v<0?0<$g?Math.atan($g/$v)+Math.PI:Math.atan($g/$v)-Math.PI:0},$r.angleTo=function($v,$g,$Q){$$g.subtract($g,$v,$r.TEMPVector30),$$g.normalize($r.TEMPVector30,$r.TEMPVector30),$Q.elements[0]=Math.asin($r.TEMPVector30.y),$Q.elements[1]=$r.arcTanAngle(-$r.TEMPVector30.z,-$r.TEMPVector30.x)},$r.createFromAxisAngle=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements;$g*=.5;var $k=Math.sin($g);$d[0]=$k*$r[0],$d[1]=$k*$r[1],$d[2]=$k*$r[2],$d[3]=Math.cos($g)},$r.createFromMatrix3x3=function($v,$g){var $Q,$d=$g.elements,$r=$v.elements,$k=$r[0]+$r[4]+$r[8];if(0<$k)$Q=Math.sqrt($k+1),$d[3]=.5*$Q,$Q=.5/$Q,$d[0]=($r[5]-$r[7])*$Q,$d[1]=($r[6]-$r[2])*$Q,$d[2]=($r[1]-$r[3])*$Q;else{var $$=0;$r[4]>$r[0]&&($$=1),$r[8]>$r[3*$$+$$]&&($$=2);var $b=($$+1)%3,$a=($$+2)%3;$Q=Math.sqrt($r[3*$$+$$]-$r[3*$b+$b]-$r[3*$a+$a]+1),$d[$$]=.5*$Q,$Q=.5/$Q,$d[3]=($r[3*$b+$a]-$r[3*$a+$b])*$Q,$d[$b]=($r[3*$b+$$]+$r[3*$$+$b])*$Q,$d[$a]=($r[3*$a+$$]+$r[3*$$+$a])*$Q}},$r.createFromMatrix4x4=function($v,$g){var $Q,$d,$r=$v.elements,$k=$g.elements,$$=$r[0]+$r[5]+$r[10];0<$$?($Q=Math.sqrt($$+1),$k[3]=.5*$Q,$Q=.5/$Q,$k[0]=($r[6]-$r[9])*$Q,$k[1]=($r[8]-$r[2])*$Q,$k[2]=($r[1]-$r[4])*$Q):$r[0]>=$r[5]&&$r[0]>=$r[10]?($d=.5/($Q=Math.sqrt(1+$r[0]-$r[5]-$r[10])),$k[0]=.5*$Q,$k[1]=($r[1]+$r[4])*$d,$k[2]=($r[2]+$r[8])*$d,$k[3]=($r[6]-$r[9])*$d):$r[5]>$r[10]?($d=.5/($Q=Math.sqrt(1+$r[5]-$r[0]-$r[10])),$k[0]=($r[4]+$r[1])*$d,$k[1]=.5*$Q,$k[2]=($r[9]+$r[6])*$d,$k[3]=($r[8]-$r[2])*$d):($d=.5/($Q=Math.sqrt(1+$r[10]-$r[0]-$r[5])),$k[0]=($r[8]+$r[2])*$d,$k[1]=($r[9]+$r[6])*$d,$k[2]=.5*$Q,$k[3]=($r[1]-$r[4])*$d)},$r.slerp=function($v,$g,$Q,$d){var $r,$k,$$,$b,$a,$M=$v.elements,$Y=$g.elements,$D=$d.elements,$J=$M[0],$p=$M[1],$T=$M[2],$t=$M[3],$q=$Y[0],$C=$Y[1],$G=$Y[2],$s=$Y[3];return($k=$J*$q+$p*$C+$T*$G+$t*$s)<0&&($k=-$k,$q=-$q,$C=-$C,$G=-$G,$s=-$s),$a=1e-6<1-$k?($r=Math.acos($k),$$=Math.sin($r),$b=Math.sin((1-$Q)*$r)/$$,Math.sin($Q*$r)/$$):($b=1-$Q,$Q),$D[0]=$b*$J+$a*$q,$D[1]=$b*$p+$a*$C,$D[2]=$b*$T+$a*$G,$D[3]=$b*$t+$a*$s,$D},$r.lerp=function($v,$g,$Q,$d){var $r=$d.elements,$k=$v.elements,$$=$g.elements,$b=$k[0],$a=$k[1],$M=$k[2],$Y=$k[3];$r[0]=$b+$Q*($$[0]-$b),$r[1]=$a+$Q*($$[1]-$a),$r[2]=$M+$Q*($$[2]-$M),$r[3]=$Y+$Q*($$[3]-$Y)},$r.add=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]+$k[0],$d[1]=$r[1]+$k[1],$d[2]=$r[2]+$k[2],$d[3]=$r[3]+$k[3]},$r.dot=function($v,$g){var $Q=$v.elements,$d=$g.elements;return $Q[0]*$d[0]+$Q[1]*$d[1]+$Q[2]*$d[2]+$Q[3]*$d[3]},$r.rotationLookAt=function($v,$g,$Q){$r.lookAt($$g.ZERO,$v,$g,$Q)},$r.lookAt=function($v,$g,$Q,$d){$uv.lookAt($v,$g,$Q,$r._tempMatrix3x3),$r.rotationMatrix($r._tempMatrix3x3,$d)},$r.invert=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$v.lengthSquared();$_v.isZero($r)||($r=1/$r,$d[0]=-$Q[0]*$r,$d[1]=-$Q[1]*$r,$d[2]=-$Q[2]*$r,$d[3]=$Q[3]*$r)},$r.rotationMatrix=function($v,$g){var $Q=$v.elements,$d=$Q[0],$r=$Q[1],$k=$Q[2],$$=$Q[3],$b=$Q[4],$a=$Q[5],$M=$Q[6],$Y=$Q[7],$D=$Q[8],$J=$g.elements,$p=NaN,$T=NaN,$t=$d+$b+$D;0<$t?($p=Math.sqrt($t+1),$J[3]=.5*$p,$p=.5/$p,$J[0]=($a-$Y)*$p,$J[1]=($M-$k)*$p,$J[2]=($r-$$)*$p):$b<=$d&&$D<=$d?($T=.5/($p=Math.sqrt(1+$d-$b-$D)),$J[0]=.5*$p,$J[1]=($r+$$)*$T,$J[2]=($k+$M)*$T,$J[3]=($a-$Y)*$T):$D<$b?($T=.5/($p=Math.sqrt(1+$b-$d-$D)),$J[0]=($$+$r)*$T,$J[1]=.5*$p,$J[2]=($Y+$a)*$T,$J[3]=($M-$k)*$T):($T=.5/($p=Math.sqrt(1+$D-$d-$b)),$J[0]=($M+$k)*$T,$J[1]=($Y+$a)*$T,$J[2]=.5*$p,$J[3]=($r-$$)*$T)},$r.DEFAULT=new $r,$D($r,["TEMPVector30",function(){return this.TEMPVector30=new $$g},"TEMPVector31",function(){return this.TEMPVector31=new $$g},"TEMPVector32",function(){return this.TEMPVector32=new $$g},"TEMPVector33",function(){return this.TEMPVector33=new $$g},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $vg},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $vg},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $uv},"NAN",function(){return this.NAN=new $r(NaN,NaN,NaN,NaN)}]),$r}(),$dg=function(){function $v($v){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$v,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$p($v,"laya.d3.math.Rand");var $g=$v.prototype;return $g.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$g.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$g.getSignedFloat=function(){return 2*this.getFloat()-1},$T(0,$g,"seed",function(){return this.seeds[0]},function($v){this.seeds[0]=$v,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$v.getFloatFromInt=function($v){return 1/8388607*(8388607&$v)},$v.getByteFromInt=function($v){return(8388607&$v)>>>15},$v}(),$rg=(function(){function $r($v){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($v instanceof Array)||4!==$v.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$v[0],this._state0L=0|$v[1],this._state1U=0|$v[2],this._state1L=0|$v[3]}$p($r,"laya.d3.math.RandX");var $v=$r.prototype;$v.randomint=function(){var $v=this._state0U,$g=this._state0L,$Q=this._state1U,$d=this._state1L,$r=($d>>>0)+($g>>>0),$k=$Q+$v+($r/2>>>31)>>>0,$$=$r>>>0,$b=0,$a=0;$b=($v^=$b=$v<<23|(-512&$g)>>>9)^(this._state0U=$Q),$a=($g^=$a=$g<<23)^(this._state0L=$d);$b^=$v>>>18,$a^=$g>>>18|(262143&$v)<<14;return $b^=$Q>>>5,$a^=$d>>>5|(31&$Q)<<27,this._state1U=$b,this._state1L=$a,[$k,$$]},$v.random=function(){var $v=this.randomint(),$g=$v[0],$Q=1023<<20|$g>>>12,$d=0|($v[1]>>>12|(4095&$g)<<20);return $r._CONVERTION_BUFFER.setUint32(0,$Q,!1),$r._CONVERTION_BUFFER.setUint32(4,$d,!1),$dg._CONVERTION_BUFFER.getFloat64(0,!1)-1},$D($r,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $dg([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $v($v,$g){this.origin=null,this.direction=null,this.origin=$v,this.direction=$g}return $p($v,"laya.d3.math.Ray"),$v}()),$kg=function(){function $v($v,$g){this.elements=new Float32Array(2),void 0===$v&&($v=0),void 0===$g&&($g=0);var $Q=this.elements;$Q[0]=$v,$Q[1]=$g}$p($v,"laya.d3.math.Vector2");var $g=$v.prototype;return $h.imps($g,{"laya.d3.core.IClone":!0}),$g.fromArray=function($v,$g){void 0===$g&&($g=0),this.elements[0]=$v[$g+0],this.elements[1]=$v[$g+1]},$g.cloneTo=function($v){var $g=$v.elements,$Q=this.elements;$g[0]=$Q[0],$g[1]=$Q[1]},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"x",function(){return this.elements[0]},function($v){this.elements[0]=$v}),$T(0,$g,"y",function(){return this.elements[1]},function($v){this.elements[1]=$v}),$v.scale=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements;$d[0]=$r[0]*$g,$d[1]=$r[1]*$g},$D($v,["ZERO",function(){return this.ZERO=new $v(0,0)},"ONE",function(){return this.ONE=new $v(1,1)}]),$v}(),$$g=function(){function $Y($v,$g,$Q){this.elements=new Float32Array(3),void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0);var $d=this.elements;$d[0]=$v,$d[1]=$g,$d[2]=$Q}$p($Y,"laya.d3.math.Vector3");var $v=$Y.prototype;return $h.imps($v,{"laya.d3.core.IClone":!0}),$v.fromArray=function($v,$g){void 0===$g&&($g=0),this.elements[0]=$v[$g+0],this.elements[1]=$v[$g+1],this.elements[2]=$v[$g+2]},$v.cloneTo=function($v){var $g=$v.elements,$Q=this.elements;$g[0]=$Q[0],$g[1]=$Q[1],$g[2]=$Q[2]},$v.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$v.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$v.reset=function($v,$g,$Q){this.elements[0]=$v,this.elements[1]=$g,this.elements[2]=$Q},$T(0,$v,"x",function(){return this.elements[0]},function($v){this.elements[0]=$v}),$T(0,$v,"y",function(){return this.elements[1]},function($v){this.elements[1]=$v}),$T(0,$v,"z",function(){return this.elements[2]},function($v){this.elements[2]=$v}),$Y.distanceSquared=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$Q[0]-$d[0],$k=$Q[1]-$d[1],$$=$Q[2]-$d[2];return $r*$r+$k*$k+$$*$$},$Y.distance=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$Q[0]-$d[0],$k=$Q[1]-$d[1],$$=$Q[2]-$d[2];return Math.sqrt($r*$r+$k*$k+$$*$$)},$Y.min=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=Math.min($r[0],$k[0]),$d[1]=Math.min($r[1],$k[1]),$d[2]=Math.min($r[2],$k[2])},$Y.max=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=Math.max($r[0],$k[0]),$d[1]=Math.max($r[1],$k[1]),$d[2]=Math.max($r[2],$k[2])},$Y.transformQuat=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements,$$=$r[0],$b=$r[1],$a=$r[2],$M=$k[0],$Y=$k[1],$D=$k[2],$J=$k[3],$p=$J*$$+$Y*$a-$D*$b,$T=$J*$b+$D*$$-$M*$a,$t=$J*$a+$M*$b-$Y*$$,$q=-$M*$$-$Y*$b-$D*$a;$d[0]=$p*$J+$q*-$M+$T*-$D-$t*-$Y,$d[1]=$T*$J+$q*-$Y+$t*-$M-$p*-$D,$d[2]=$t*$J+$q*-$D+$p*-$Y-$T*-$M},$Y.scalarLength=function($v){var $g=$v.elements,$Q=$g[0],$d=$g[1],$r=$g[2];return Math.sqrt($Q*$Q+$d*$d+$r*$r)},$Y.scalarLengthSquared=function($v){var $g=$v.elements,$Q=$g[0],$d=$g[1],$r=$g[2];return $Q*$Q+$d*$d+$r*$r},$Y.normalize=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$Q[0],$k=$Q[1],$$=$Q[2],$b=$r*$r+$k*$k+$$*$$;0<$b&&($b=1/Math.sqrt($b),$d[0]=$Q[0]*$b,$d[1]=$Q[1]*$b,$d[2]=$Q[2]*$b)},$Y.multiply=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]*$k[0],$d[1]=$r[1]*$k[1],$d[2]=$r[2]*$k[2]},$Y.scale=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements;$d[0]=$r[0]*$g,$d[1]=$r[1]*$g,$d[2]=$r[2]*$g},$Y.lerp=function($v,$g,$Q,$d){var $r=$d.elements,$k=$v.elements,$$=$g.elements,$b=$k[0],$a=$k[1],$M=$k[2];$r[0]=$b+$Q*($$[0]-$b),$r[1]=$a+$Q*($$[1]-$a),$r[2]=$M+$Q*($$[2]-$M)},$Y.transformV3ToV3=function($v,$g,$Q){var $d=$Y._tempVector4;$Y.transformV3ToV4($v,$g,$d);var $r=$d.elements,$k=$Q.elements;$k[0]=$r[0],$k[1]=$r[1],$k[2]=$r[2]},$Y.transformV3ToV4=function($v,$g,$Q){var $d=$v.elements,$r=$d[0],$k=$d[1],$$=$d[2],$b=$g.elements,$a=$Q.elements;$a[0]=$r*$b[0]+$k*$b[4]+$$*$b[8]+$b[12],$a[1]=$r*$b[1]+$k*$b[5]+$$*$b[9]+$b[13],$a[2]=$r*$b[2]+$k*$b[6]+$$*$b[10]+$b[14],$a[3]=$r*$b[3]+$k*$b[7]+$$*$b[11]+$b[15]},$Y.TransformNormal=function($v,$g,$Q){var $d=$v.elements,$r=$d[0],$k=$d[1],$$=$d[2],$b=$g.elements,$a=$Q.elements;$a[0]=$r*$b[0]+$k*$b[4]+$$*$b[8],$a[1]=$r*$b[1]+$k*$b[5]+$$*$b[9],$a[2]=$r*$b[2]+$k*$b[6]+$$*$b[10]},$Y.transformCoordinate=function($v,$g,$Q){var $d=$Y._tempVector4.elements,$r=$v.elements,$k=$r[0],$$=$r[1],$b=$r[2],$a=$g.elements;$d[0]=$k*$a[0]+$$*$a[4]+$b*$a[8]+$a[12],$d[1]=$k*$a[1]+$$*$a[5]+$b*$a[9]+$a[13],$d[2]=$k*$a[2]+$$*$a[6]+$b*$a[10]+$a[14],$d[3]=1/($k*$a[3]+$$*$a[7]+$b*$a[11]+$a[15]);var $M=$Q.elements;$M[0]=$d[0]*$d[3],$M[1]=$d[1]*$d[3],$M[2]=$d[2]*$d[3]},$Y.Clamp=function($v,$g,$Q,$d){var $r=$v.elements,$k=$r[0],$$=$r[1],$b=$r[2],$a=$g.elements,$M=$a[0],$Y=$a[1],$D=$a[2],$J=$Q.elements,$p=$J[0],$T=$J[1],$t=$J[2],$q=$d.elements;$k=($k=$p<$k?$p:$k)<$M?$M:$k,$$=($$=$T<$$?$T:$$)<$Y?$Y:$$,$b=($b=$t<$b?$t:$b)<$D?$D:$b,$q[0]=$k,$q[1]=$$,$q[2]=$b},$Y.add=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]+$k[0],$d[1]=$r[1]+$k[1],$d[2]=$r[2]+$k[2]},$Y.subtract=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]-$k[0],$d[1]=$r[1]-$k[1],$d[2]=$r[2]-$k[2]},$Y.cross=function($v,$g,$Q){var $d=$v.elements,$r=$g.elements,$k=$Q.elements,$$=$d[0],$b=$d[1],$a=$d[2],$M=$r[0],$Y=$r[1],$D=$r[2];$k[0]=$b*$D-$a*$Y,$k[1]=$a*$M-$$*$D,$k[2]=$$*$Y-$b*$M},$Y.dot=function($v,$g){var $Q=$v.elements,$d=$g.elements;return $Q[0]*$d[0]+$Q[1]*$d[1]+$Q[2]*$d[2]},$Y.equals=function($v,$g){var $Q=$v.elements,$d=$g.elements;return $_v.nearEqual(Math.abs($Q[0]),Math.abs($d[0]))&&$_v.nearEqual(Math.abs($Q[1]),Math.abs($d[1]))&&$_v.nearEqual(Math.abs($Q[2]),Math.abs($d[2]))},$Y.ZERO=new $Y(0,0,0),$Y.ONE=new $Y(1,1,1),$Y.NegativeUnitX=new $Y(-1,0,0),$Y.UnitX=new $Y(1,0,0),$Y.UnitY=new $Y(0,1,0),$Y.UnitZ=new $Y(0,0,1),$Y.ForwardRH=new $Y(0,0,-1),$Y.ForwardLH=new $Y(0,0,1),$Y.Up=new $Y(0,1,0),$Y.NAN=new $Y(NaN,NaN,NaN),$D($Y,["_tempVector4",function(){return this._tempVector4=new $bg}]),$Y}(),$bg=function(){function $v($v,$g,$Q,$d){this.elements=new Float32Array(4),void 0===$v&&($v=0),void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=0);var $r=this.elements;$r[0]=$v,$r[1]=$g,$r[2]=$Q,$r[3]=$d}$p($v,"laya.d3.math.Vector4");var $g=$v.prototype;return $h.imps($g,{"laya.d3.core.IClone":!0}),$g.fromArray=function($v,$g){void 0===$g&&($g=0),this.elements[0]=$v[$g+0],this.elements[1]=$v[$g+1],this.elements[2]=$v[$g+2],this.elements[3]=$v[$g+3]},$g.cloneTo=function($v){var $g=$v.elements,$Q=this.elements;$g[0]=$Q[0],$g[1]=$Q[1],$g[2]=$Q[2],$g[3]=$Q[3]},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$g.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$g.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$T(0,$g,"x",function(){return this.elements[0]},function($v){this.elements[0]=$v}),$T(0,$g,"y",function(){return this.elements[1]},function($v){this.elements[1]=$v}),$T(0,$g,"z",function(){return this.elements[2]},function($v){this.elements[2]=$v}),$T(0,$g,"w",function(){return this.elements[3]},function($v){this.elements[3]=$v}),$v.lerp=function($v,$g,$Q,$d){var $r=$d.elements,$k=$v.elements,$$=$g.elements,$b=$k[0],$a=$k[1],$M=$k[2],$Y=$k[3];$r[0]=$b+$Q*($$[0]-$b),$r[1]=$a+$Q*($$[1]-$a),$r[2]=$M+$Q*($$[2]-$M),$r[3]=$Y+$Q*($$[3]-$Y)},$v.transformByM4x4=function($v,$g,$Q){var $d=$v.elements,$r=$d[0],$k=$d[1],$$=$d[2],$b=$d[3],$a=$g.elements,$M=$Q.elements;$M[0]=$r*$a[0]+$k*$a[4]+$$*$a[8]+$b*$a[12],$M[1]=$r*$a[1]+$k*$a[5]+$$*$a[9]+$b*$a[13],$M[2]=$r*$a[2]+$k*$a[6]+$$*$a[10]+$b*$a[14],$M[3]=$r*$a[3]+$k*$a[7]+$$*$a[11]+$b*$a[15]},$v.equals=function($v,$g){var $Q=$v.elements,$d=$g.elements;return $_v.nearEqual(Math.abs($Q[0]),Math.abs($d[0]))&&$_v.nearEqual(Math.abs($Q[1]),Math.abs($d[1]))&&$_v.nearEqual(Math.abs($Q[2]),Math.abs($d[2]))&&$_v.nearEqual(Math.abs($Q[3]),Math.abs($d[3]))},$v.normalize=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$v.length();0<$r&&($d[0]=$Q[0]*$r,$d[1]=$Q[1]*$r,$d[2]=$Q[2]*$r,$d[3]=$Q[3]*$r)},$v.add=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]+$k[0],$d[1]=$r[1]+$k[1],$d[2]=$r[2]+$k[2],$d[3]=$r[3]+$k[3]},$v.subtract=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]-$k[0],$d[1]=$r[1]-$k[1],$d[2]=$r[2]-$k[2],$d[3]=$r[3]-$k[3]},$v.multiply=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=$r[0]*$k[0],$d[1]=$r[1]*$k[1],$d[2]=$r[2]*$k[2],$d[3]=$r[3]*$k[3]},$v.scale=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements;$d[0]=$r[0]*$g,$d[1]=$r[1]*$g,$d[2]=$r[2]*$g,$d[3]=$r[3]*$g},$v.Clamp=function($v,$g,$Q,$d){var $r=$v.elements,$k=$r[0],$$=$r[1],$b=$r[2],$a=$r[3],$M=$g.elements,$Y=$M[0],$D=$M[1],$J=$M[2],$p=$M[3],$T=$Q.elements,$t=$T[0],$q=$T[1],$C=$T[2],$G=$T[3],$s=$d.elements;$k=($k=$t<$k?$t:$k)<$Y?$Y:$k,$$=($$=$q<$$?$q:$$)<$D?$D:$$,$b=($b=$C<$b?$C:$b)<$J?$J:$b,$a=($a=$G<$a?$G:$a)<$p?$p:$a,$s[0]=$k,$s[1]=$$,$s[2]=$b,$s[3]=$a},$v.distanceSquared=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$Q[0]-$d[0],$k=$Q[1]-$d[1],$$=$Q[2]-$d[2],$b=$Q[3]-$d[3];return $r*$r+$k*$k+$$*$$+$b*$b},$v.distance=function($v,$g){var $Q=$v.elements,$d=$g.elements,$r=$Q[0]-$d[0],$k=$Q[1]-$d[1],$$=$Q[2]-$d[2],$b=$Q[3]-$d[3];return Math.sqrt($r*$r+$k*$k+$$*$$+$b*$b)},$v.dot=function($v,$g){var $Q=$v.elements,$d=$g.elements;return $Q[0]*$d[0]+$Q[1]*$d[1]+$Q[2]*$d[2]+$Q[3]*$d[3]},$v.min=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=Math.min($r[0],$k[0]),$d[1]=Math.min($r[1],$k[1]),$d[2]=Math.min($r[2],$k[2]),$d[3]=Math.min($r[3],$k[3])},$v.max=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g.elements;$d[0]=Math.max($r[0],$k[0]),$d[1]=Math.max($r[1],$k[1]),$d[2]=Math.max($r[2],$k[2]),$d[3]=Math.max($r[3],$k[3])},$D($v,["ZERO",function(){return this.ZERO=new $v},"ONE",function(){return this.ONE=new $v(1,1,1,1)},"UnitX",function(){return this.UnitX=new $v(1,0,0,0)},"UnitY",function(){return this.UnitY=new $v(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $v(0,0,1,0)},"UnitW",function(){return this.UnitW=new $v(0,0,0,1)}]),$v}(),$ag=function(){function $k($v,$g,$Q,$d){this.minDepth=0,this.maxDepth=1,this.x=$v,this.y=$g,this.width=$Q,this.height=$d}$p($k,"laya.d3.math.Viewport");var $v=$k.prototype;return $v.project=function($v,$g,$Q){$$g.transformV3ToV3($v,$g,$Q);var $d=$v.elements,$r=$g.elements,$k=$Q.elements,$$=$d[0]*$r[3]+$d[1]*$r[7]+$d[2]*$r[11]+$r[15];1!==$$&&($k[0]=$k[0]/$$,$k[1]=$k[1]/$$,$k[2]=$k[2]/$$),$k[0]=.5*($k[0]+1)*this.width+this.x,$k[1]=.5*(1-$k[1])*this.height+this.y,$k[2]=$k[2]*(this.maxDepth-this.minDepth)+this.minDepth},$v.unprojectFromMat=function($v,$g,$Q){var $d=$v.elements,$r=$g.elements,$k=$Q.elements;$k[0]=($d[0]-this.x)/this.width*2-1,$k[1]=-(($d[1]-this.y)/this.height*2-1);var $$=(this.maxDepth-this.minDepth)/2;$k[2]=($d[2]-this.minDepth-$$)/$$;var $b=$k[0]*$r[3]+$k[1]*$r[7]+$k[2]*$r[11]+$r[15];$$g.transformV3ToV3($Q,$g,$Q),1!==$b&&($k[0]=$k[0]/$b,$k[1]=$k[1]/$b,$k[2]=$k[2]/$b)},$v.unprojectFromWVP=function($v,$g,$Q,$d,$r){$vg.multiply($g,$Q,$k._tempMatrix4x4),$d&&$vg.multiply($k._tempMatrix4x4,$d,$k._tempMatrix4x4),$k._tempMatrix4x4.invert($k._tempMatrix4x4),this.unprojectFromMat($v,$k._tempMatrix4x4,$r)},$D($k,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $vg}]),$k}(),$Mg=function(){function $V($v){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$v,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$p($V,"laya.d3.resource.models.SubMesh");var $v=$V.prototype;return $h.imps($v,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$v._getVertexBuffer=function($v){return void 0===$v&&($v=0),0===$v?this._vertexBuffer:null},$v._getIndexBuffer=function(){return this._indexBuffer},$v._getStaticBatchBakedVertexs=function($v,$g){var $Q,$d,$r=this._vertexBuffer,$k=$r.vertexDeclaration,$$=$k.getVertexElementByUsage(0).offset/4,$b=$k.getVertexElementByUsage(3).offset/4,$a=$g.meshRender.lightmapScaleOffset,$M=0,$Y=0,$D=0,$J=0,$p=0,$T=0;if($a)if($d=$k.getVertexElementByUsage(15))$D=$k.vertexStride/4,$Q=0<this._vertexCount?$r.getData().slice(this._vertexStart*$D,(this._vertexStart+this._vertexCount)*$D):$r.getData().slice(),$J=$d.offset/4;else{$D=($T=$k.vertexStride/4)+2,$Q=this._vertexCount?new Float32Array(this._vertexCount*($r.vertexDeclaration.vertexStride/4+2)):new Float32Array($r.vertexCount*($r.vertexDeclaration.vertexStride/4+2)),$J=($p=$k.getVertexElementByUsage(2).offset/4)+2;var $t=$r.getData();for($M=0,$Y=$t.length/$T;$M<$Y;$M++){var $q=0;$q=0<this._vertexCount?(this._vertexStart+$M)*$T:$M*$T;var $C=$M*$D,$G=0;for($G=0;$G<$J;$G++)$Q[$C+$G]=$t[$q+$G];for($G=$J;$G<$T;$G++)$Q[$C+$G+2]=$t[$q+$G]}}else $D=$k.vertexStride/4,$Q=this._vertexCount?$r.getData().slice(this._vertexStart*$D,(this._vertexStart+this._vertexCount)*$D):$r.getData().slice();if($v){var $s=$v.worldMatrix,$A=$V._tempMatrix4x40;$s.invert($A);var $h=$V._tempMatrix4x41,$P=$g.transform.worldMatrix;$vg.multiply($A,$P,$h)}else $h=$g.transform.worldMatrix;var $W=$V._tempQuaternion0;for($h.decomposeTransRotScale($V._tempVector30,$W,$V._tempVector31),$M=0,$Y=$Q.length/$D;$M<$Y;$M++){var $F=$M*$D+$$,$l=$M*$D+$b;if($qg.transformVector3ArrayToVector3ArrayCoordinate($Q,$F,$h,$Q,$F),$qg.transformVector3ArrayByQuat($Q,$l,$W,$Q,$l),$a){var $o=$M*$D+$J;if($d)$qg.transformLightingMapTexcoordByUV1Array($Q,$o,$a,$Q,$o);else{var $E=$M*$T+$p;$qg.transformLightingMapTexcoordByUV0Array($t,$E,$a,$Q,$o)}}}return $Q},$v._getVertexBuffers=function(){return null},$v._beforeRender=function($v){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$v._render=function($v){var $g,$Q=0,$d=$v.renderElement;if(1<this._indexCount){var $r=this._boneIndicesList.length;if(1<$r){for(var $k=0;$k<$r;$k++)($g=$d._skinAnimationDatas||this._skinAnimationDatas)&&($d._shaderValue.setValue(0,$g[$k]),$v._shader.uploadRenderElementUniforms($d._shaderValue.data)),$Z.mainContext.drawElements(4,this._subIndexBufferCount[$k],5123,2*this._subIndexBufferStart[$k]);$F.drawCall+=$r}else($g=$d._skinAnimationDatas||this._skinAnimationDatas)&&($d._shaderValue.setValue(0,$g[0]),$v._shader.uploadRenderElementUniforms($d._shaderValue.data)),$Z.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$F.drawCall++;$Q=this._indexCount}else $Q=this._indexBuffer.indexCount,($g=$d._skinAnimationDatas||this._skinAnimationDatas)&&($d._shaderValue.setValue(0,$g[0]),$v._shader.uploadRenderElementUniforms($d._shaderValue.data)),$Z.mainContext.drawElements(4,$Q,5123,0),$F.drawCall++;$F.trianglesFaces+=$Q/3},$v.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$v.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$T(0,$v,"_vertexBufferCount",function(){return 1}),$T(0,$v,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$D($V,["_tempVector30",function(){return this._tempVector30=new $$g},"_tempVector31",function(){return this._tempVector31=new $$g},"_tempQuaternion0",function(){return this._tempQuaternion0=new $Qg},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $vg},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $vg}]),$V}(),$Yg=function(){function $v($v){this.defineCounter=0,this.defines=null,$v?(this.defineCounter=$v.defineCounter,this.defines=$v.defines.slice()):(this.defineCounter=0,this.defines=[])}return $p($v,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$v.prototype.registerDefine=function($v){var $g=Math.pow(2,this.defineCounter++);return this.defines[$g]=$v,$g},$v}(),$Dg=function(){function $v(){}return $p($v,"laya.d3.shader.ShaderInit3D"),$v.__init__=function(){var $v,$g;$Fg._globalRegDefine("HIGHPRECISION",$Fg.SHADERDEFINE_HIGHPRECISION),$Fg._globalRegDefine("FOG",$Fg.SHADERDEFINE_FOG),$Fg._globalRegDefine("DIRECTIONLIGHT",$Fg.SHADERDEFINE_DIRECTIONLIGHT),$Fg._globalRegDefine("POINTLIGHT",$Fg.SHADERDEFINE_POINTLIGHT),$Fg._globalRegDefine("SPOTLIGHT",$Fg.SHADERDEFINE_SPOTLIGHT),$Fg._globalRegDefine("UV",$Fg.SHADERDEFINE_UV0),$Fg._globalRegDefine("COLOR",$Fg.SHADERDEFINE_COLOR),$Fg._globalRegDefine("UV1",$Fg.SHADERDEFINE_UV1),$Fg._globalRegDefine("CASTSHADOW",$pg.SHADERDEFINE_CAST_SHADOW),$Fg._globalRegDefine("SHADOWMAP_PSSM1",$pg.SHADERDEFINE_SHADOW_PSSM1),$Fg._globalRegDefine("SHADOWMAP_PSSM2",$pg.SHADERDEFINE_SHADOW_PSSM2),$Fg._globalRegDefine("SHADOWMAP_PSSM3",$pg.SHADERDEFINE_SHADOW_PSSM3),$Fg._globalRegDefine("SHADOWMAP_PCF_NO",$pg.SHADERDEFINE_SHADOW_PCF_NO),$Fg._globalRegDefine("SHADOWMAP_PCF1",$pg.SHADERDEFINE_SHADOW_PCF1),$Fg._globalRegDefine("SHADOWMAP_PCF2",$pg.SHADERDEFINE_SHADOW_PCF2),$Fg._globalRegDefine("SHADOWMAP_PCF3",$pg.SHADERDEFINE_SHADOW_PCF3),$Fg._globalRegDefine("DEPTHFOG",$Fg.SAHDERDEFINE_DEPTHFOG),$wg.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$wg.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$v={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$g={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $Q=$wg.nameKey.add("SIMPLE");shaderCompile=$Fg.add($Q,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$v,$g),$mg.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$mg.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$mg.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$mg.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$mg.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$mg.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$mg.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$mg.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$mg.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$v}(),$Jg=function(){function $v(){this._data=null,this._data=[]}$p($v,"laya.d3.shader.ValusArray");var $g=$v.prototype;return $g.setValue=function($v,$g){this._data[$v]=$g},$T(0,$g,"data",function(){return this._data}),$v}(),$pg=function(){function $v(){}return $v.SHADERDEFINE_RECEIVE_SHADOW=1,$v.SHADERDEFINE_CAST_SHADOW=512,$v.SHADERDEFINE_SHADOW_PSSM1=1024,$v.SHADERDEFINE_SHADOW_PSSM2=2048,$v.SHADERDEFINE_SHADOW_PSSM3=4096,$v.SHADERDEFINE_SHADOW_PCF_NO=8192,$v.SHADERDEFINE_SHADOW_PCF1=16384,$v.SHADERDEFINE_SHADOW_PCF2=32768,$v.SHADERDEFINE_SHADOW_PCF3=65536,$v.MAX_PSSM_COUNT=3,$v}(),$Tg=function(){function $z(){}return $p($z,"laya.d3.utils.Picker"),$z.calculateCursorRay=function($v,$g,$Q,$d,$r,$k){var $$=$v.elements[0],$b=$v.elements[1],$a=$z._tempVector30,$M=$a.elements;$M[0]=$$,$M[1]=$b,$M[2]=$g.minDepth;var $Y=$z._tempVector31,$D=$Y.elements;$D[0]=$$,$D[1]=$b,$D[2]=$g.maxDepth;var $J=$k.origin,$p=$z._tempVector32;$g.unprojectFromWVP($a,$Q,$d,$r,$J),$g.unprojectFromWVP($Y,$Q,$d,$r,$p);var $T=$k.direction.elements;$T[0]=$p.x-$J.x,$T[1]=$p.y-$J.y,$T[2]=$p.z-$J.z,$$g.normalize($k.direction,$k.direction)},$z.rayIntersectsPositionsAndIndices=function($v,$g,$Q,$d,$r){for(var $k=$Q.vertexStride/4,$$=$Q.getVertexElementByUsage(0).offset/4,$b=Number.MAX_VALUE,$a=-1,$M=-1,$Y=-1,$D=0;$D<$d.length;$D+=3){var $J=$z._tempVector35,$p=$J.elements,$T=$d[$D]*$k,$t=$T+$$;$p[0]=$g[$t],$p[1]=$g[1+$t],$p[2]=$g[2+$t];var $q=$z._tempVector36,$C=$q.elements,$G=$d[$D+1]*$k,$s=$G+$$;$C[0]=$g[$s],$C[1]=$g[1+$s],$C[2]=$g[2+$s];var $A=$z._tempVector37,$h=$A.elements,$P=$d[$D+2]*$k,$W=$P+$$;$h[0]=$g[$W],$h[1]=$g[1+$W],$h[2]=$g[2+$W];var $F=laya.d3.utils.Picker.rayIntersectsTriangle($v,$J,$q,$A);!isNaN($F)&&$F<$b&&($b=$F,$a=$T,$M=$G,$Y=$P)}if($b===Number.MAX_VALUE)return $r.position.toDefault(),$r.distance=Number.MAX_VALUE,$r.trianglePositions[0].toDefault(),$r.trianglePositions[1].toDefault(),$r.trianglePositions[2].toDefault(),$r.triangleNormals[0].toDefault(),$r.triangleNormals[1].toDefault(),$r.triangleNormals[2].toDefault(),!1;$r.distance=$b,$$g.scale($v.direction,$b,$r.position),$$g.add($v.origin,$r.position,$r.position);var $l=$r.trianglePositions,$o=$l[0],$E=$l[1],$V=$l[2],$Z=$o.elements,$f=$E.elements,$X=$V.elements,$N=$a+$$;$Z[0]=$g[$N],$Z[1]=$g[$N+1],$Z[2]=$g[$N+2];var $i=$M+$$;$f[0]=$g[$i],$f[1]=$g[$i+1],$f[2]=$g[$i+2];var $x=$Y+$$;$X[0]=$g[$x],$X[1]=$g[$x+1],$X[2]=$g[$x+2];var $w=$Q.getVertexElementByUsage(3);if($w){var $m=$w.offset/4,$K=$r.triangleNormals,$c=$K[0],$B=$K[1],$j=$K[2],$L=$c.elements,$H=$B.elements,$n=$j.elements,$y=$a+$m;$L[0]=$g[$y],$L[1]=$g[$y+1],$L[2]=$g[$y+2];var $e=$M+$m;$H[0]=$g[$e],$H[1]=$g[$e+1],$H[2]=$g[$e+2];var $R=$Y+$m;$n[0]=$g[$R],$n[1]=$g[$R+1],$n[2]=$g[$R+2]}return!0},$z.rayIntersectsTriangle=function($v,$g,$Q,$d){var $r=$z._tempVector30,$k=$z._tempVector31;$$g.subtract($Q,$g,$r),$$g.subtract($d,$g,$k);var $$,$b=$z._tempVector32;if($$g.cross($v.direction,$k,$b),($$=$$g.dot($r,$b))>-Number.MIN_VALUE&&$$<Number.MIN_VALUE)return Number.NaN;var $a,$M=1/$$,$Y=$z._tempVector33;if($$g.subtract($v.origin,$g,$Y),$a=$$g.dot($Y,$b),($a*=$M)<0||1<$a)return Number.NaN;var $D,$J,$p=$z._tempVector34;return $$g.cross($Y,$r,$p),$D=$$g.dot($v.direction,$p),($D*=$M)<0||1<$a+$D?Number.NaN:($J=$$g.dot($k,$p),($J*=$M)<0?Number.NaN:$J)},$D($z,["_tempVector30",function(){return this._tempVector30=new $$g},"_tempVector31",function(){return this._tempVector31=new $$g},"_tempVector32",function(){return this._tempVector32=new $$g},"_tempVector33",function(){return this._tempVector33=new $$g},"_tempVector34",function(){return this._tempVector34=new $$g},"_tempVector35",function(){return this._tempVector35=new $$g},"_tempVector36",function(){return this._tempVector36=new $$g},"_tempVector37",function(){return this._tempVector37=new $$g}]),$z}(),$tg=(function(){function $v(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $$g,new $$g,new $$g],this.trianglePositions.length=3,this.triangleNormals=[new $$g,new $$g,new $$g],this.triangleNormals.length=3,this.position=new $$g}$p($v,"laya.d3.utils.RaycastHit"),$v.prototype.cloneTo=function($v){$v.distance=this.distance,this.trianglePositions[0].cloneTo($v.trianglePositions[0]),this.trianglePositions[1].cloneTo($v.trianglePositions[1]),this.trianglePositions[2].cloneTo($v.trianglePositions[2]),this.triangleNormals[0].cloneTo($v.triangleNormals[0]),this.triangleNormals[1].cloneTo($v.triangleNormals[1]),this.triangleNormals[2].cloneTo($v.triangleNormals[2]),this.position.cloneTo($v.position),$v.sprite3D=this.sprite3D}}(),function(){function $v($v,$g){this._width=0,this._height=0,this._width=$v,this._height=$g}$p($v,"laya.d3.utils.Size");var $g=$v.prototype;return $T(0,$g,"width",function(){return-1===this._width?$U.clientWidth:this._width}),$T(0,$g,"height",function(){return-1===this._height?$U.clientHeight:this._height}),$T(1,$v,"fullScreen",function(){return new $v(-1,-1)}),$v}()),$qg=function(){function $N(){}return $p($N,"laya.d3.utils.Utils3D"),$N._rotationTransformScaleSkinAnimation=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D){var $J,$p,$T,$t,$q,$C=$N._tempArray16_0,$G=$N._tempArray16_1,$s=$N._tempArray16_2,$A=$d+$d,$h=$r+$r,$P=$k+$k,$W=$d*$A,$F=$r*$A,$l=$r*$h,$o=$k*$A,$E=$k*$h,$V=$k*$P,$Z=$$*$A,$f=$$*$h,$X=$$*$P;for($C[15]=1,$C[0]=1-$l-$V,$C[1]=$F+$X,$C[2]=$o-$f,$C[4]=$F-$X,$C[5]=1-$W-$V,$C[6]=$E+$Z,$C[8]=$o+$f,$C[9]=$E-$Z,$C[10]=1-$W-$l,$G[15]=1,$G[0]=$b,$G[5]=$a,$G[10]=$M,$J=0;$J<4;$J++)$p=$C[$J],$T=$C[$J+4],$t=$C[$J+8],$q=$C[$J+12],$s[$J]=$p,$s[$J+4]=$T,$s[$J+8]=$t,$s[$J+12]=$p*$v+$T*$g+$t*$Q+$q;for($J=0;$J<4;$J++)$p=$s[$J],$T=$s[$J+4],$t=$s[$J+8],$q=$s[$J+12],$Y[$J+$D]=$p*$G[0]+$T*$G[1]+$t*$G[2]+$q*$G[3],$Y[$J+$D+4]=$p*$G[4]+$T*$G[5]+$t*$G[6]+$q*$G[7],$Y[$J+$D+8]=$p*$G[8]+$T*$G[9]+$t*$G[10]+$q*$G[11],$Y[$J+$D+12]=$p*$G[12]+$T*$G[13]+$t*$G[14]+$q*$G[15]},$N._createNodeByJson=function($v,$g,$Q,$d){if(!$Q)switch($g.type){case"Sprite3D":$Q=new $xg;break;case"MeshSprite3D":$Q=new $zg;break;case"SkinnedMeshSprite3D":$Q=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$Q=new ShuriKenParticle3D;break;case"TrailSprite3D":$Q=new TrailSprite3D;break;case"Terrain":$Q=new Terrain;break;case"Camera":$Q=new $Rg;break;case"DirectionLight":$Q=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $r=$g.props;if($r)for(var $k in $r)$Q[$k]=$r[$k];var $$=$g.customProps;$$&&($Q instanceof laya.d3.core.Sprite3D?($Q._parseBaseCustomProps($$),$Q._parseCustomProps($v,$d,$$,$g),$Q._parseCustomComponent($v,$d,$g.components)):$Q._parseCustomProps($v,$d,$$,$g));var $b=$g.child;if($b)for(var $a=0,$M=$b.length;$a<$M;$a++){var $Y=$N._createNodeByJson($v,$b[$a],null,$d);$Q.addChild($Y)}return $Q},$N._computeBoneAndAnimationDatasByBindPoseMatrxix=function($v,$g,$Q,$d,$r,$k){var $$,$b,$a=0,$M=0,$Y=$v.length;for($$=0;$$<$Y;$a+=$v[$$].keyframeWidth,$M+=16,$$++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($g[$a+0],$g[$a+1],$g[$a+2],$g[$a+3],$g[$a+4],$g[$a+5],$g[$a+6],$g[$a+7],$g[$a+8],$g[$a+9],$d,$M),0!=$$&&($b=16*$v[$$].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($d,$b,$d,$M,$d,$M));var $D=$Q.length;for($$=0;$$<$D;$$++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($d,16*$k[$$],$Q[$$],$r,16*$$)},$N._computeAnimationDatasByArrayAndMatrixFast=function($v,$g,$Q,$d){for(var $r=0,$k=$v.length;$r<$k;$r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($g,16*$d[$r],$v[$r],$Q,16*$r)},$N._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($v,$g,$Q,$d,$r){var $k,$$,$b=0,$a=0,$M=$v.length;for($k=0;$k<$M;$b+=$v[$k].keyframeWidth,$a+=16,$k++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($g[$b+7],$g[$b+8],$g[$b+9],$g[$b+3],$g[$b+4],$g[$b+5],$g[$b+6],$g[$b+0],$g[$b+1],$g[$b+2],$d,$a),0!=$k&&($$=16*$v[$k].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($d,$$,$d,$a,$d,$a));var $Y=$Q.length;for($k=0;$k<$Y;$k++){var $D=16*$k;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($d,$D,$Q[$k],$r,$D)}},$N._computeAnimationDatasByArrayAndMatrixFastOld=function($v,$g,$Q){for(var $d=$v.length,$r=0;$r<$d;$r++){var $k=16*$r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($g,$k,$v[$r],$Q,$k)}},$N._computeRootAnimationData=function($v,$g,$Q){for(var $d=0,$r=0,$k=0,$$=$v.length;$d<$$;$r+=$v[$d].keyframeWidth,$k+=16,$d++)laya.d3.utils.Utils3D.createAffineTransformationArray($g[$r+0],$g[$r+1],$g[$r+2],$g[$r+3],$g[$r+4],$g[$r+5],$g[$r+6],$g[$r+7],$g[$r+8],$g[$r+9],$Q,$k)},$N.transformVector3ArrayByQuat=function($v,$g,$Q,$d,$r){var $k=$Q.elements,$$=$v[$g],$b=$v[$g+1],$a=$v[$g+2],$M=$k[0],$Y=$k[1],$D=$k[2],$J=$k[3],$p=$J*$$+$Y*$a-$D*$b,$T=$J*$b+$D*$$-$M*$a,$t=$J*$a+$M*$b-$Y*$$,$q=-$M*$$-$Y*$b-$D*$a;$d[$r]=$p*$J+$q*-$M+$T*-$D-$t*-$Y,$d[$r+1]=$T*$J+$q*-$Y+$t*-$M-$p*-$D,$d[$r+2]=$t*$J+$q*-$D+$p*-$Y-$T*-$M},$N.mulMatrixByArray=function($v,$g,$Q,$d,$r,$k){var $$,$b,$a,$M,$Y;if($r===$Q){for($Q=$N._tempArray16_3,$$=0;$$<16;++$$)$Q[$$]=$r[$k+$$];$d=0}for($$=0;$$<4;$$++)$b=$v[$g+$$],$a=$v[$g+$$+4],$M=$v[$g+$$+8],$Y=$v[$g+$$+12],$r[$k+$$]=$b*$Q[$d+0]+$a*$Q[$d+1]+$M*$Q[$d+2]+$Y*$Q[$d+3],$r[$k+$$+4]=$b*$Q[$d+4]+$a*$Q[$d+5]+$M*$Q[$d+6]+$Y*$Q[$d+7],$r[$k+$$+8]=$b*$Q[$d+8]+$a*$Q[$d+9]+$M*$Q[$d+10]+$Y*$Q[$d+11],$r[$k+$$+12]=$b*$Q[$d+12]+$a*$Q[$d+13]+$M*$Q[$d+14]+$Y*$Q[$d+15]},$N.mulMatrixByArrayFast=function($v,$g,$Q,$d,$r,$k){var $$,$b,$a,$M,$Y;for($$=0;$$<4;$$++)$b=$v[$g+$$],$a=$v[$g+$$+4],$M=$v[$g+$$+8],$Y=$v[$g+$$+12],$r[$k+$$]=$b*$Q[$d+0]+$a*$Q[$d+1]+$M*$Q[$d+2]+$Y*$Q[$d+3],$r[$k+$$+4]=$b*$Q[$d+4]+$a*$Q[$d+5]+$M*$Q[$d+6]+$Y*$Q[$d+7],$r[$k+$$+8]=$b*$Q[$d+8]+$a*$Q[$d+9]+$M*$Q[$d+10]+$Y*$Q[$d+11],$r[$k+$$+12]=$b*$Q[$d+12]+$a*$Q[$d+13]+$M*$Q[$d+14]+$Y*$Q[$d+15]},$N.mulMatrixByArrayAndMatrixFast=function($v,$g,$Q,$d,$r){var $k,$$,$b,$a,$M,$Y=$Q.elements,$D=$Y[0],$J=$Y[1],$p=$Y[2],$T=$Y[3],$t=$Y[4],$q=$Y[5],$C=$Y[6],$G=$Y[7],$s=$Y[8],$A=$Y[9],$h=$Y[10],$P=$Y[11],$W=$Y[12],$F=$Y[13],$l=$Y[14],$o=$Y[15],$E=$g,$V=$g+4,$Z=$g+8,$f=$g+12,$X=$r,$N=$r+4,$i=$r+8,$x=$r+12;for($k=0;$k<4;$k++)$$=$v[$E+$k],$b=$v[$V+$k],$a=$v[$Z+$k],$M=$v[$f+$k],$d[$X+$k]=$$*$D+$b*$J+$a*$p+$M*$T,$d[$N+$k]=$$*$t+$b*$q+$a*$C+$M*$G,$d[$i+$k]=$$*$s+$b*$A+$a*$h+$M*$P,$d[$x+$k]=$$*$W+$b*$F+$a*$l+$M*$o},$N.createAffineTransformationArray=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D){var $J=$d+$d,$p=$r+$r,$T=$k+$k,$t=$d*$J,$q=$d*$p,$C=$d*$T,$G=$r*$p,$s=$r*$T,$A=$k*$T,$h=$$*$J,$P=$$*$p,$W=$$*$T;$Y[$D+0]=(1-($G+$A))*$b,$Y[$D+1]=($q+$W)*$b,$Y[$D+2]=($C-$P)*$b,$Y[$D+3]=0,$Y[$D+4]=($q-$W)*$a,$Y[$D+5]=(1-($t+$A))*$a,$Y[$D+6]=($s+$h)*$a,$Y[$D+7]=0,$Y[$D+8]=($C+$P)*$M,$Y[$D+9]=($s-$h)*$M,$Y[$D+10]=(1-($t+$G))*$M,$Y[$D+11]=0,$Y[$D+12]=$v,$Y[$D+13]=$g,$Y[$D+14]=$Q,$Y[$D+15]=1},$N.transformVector3ArrayToVector3ArrayCoordinate=function($v,$g,$Q,$d,$r){var $k=$N._tempArray4_0,$$=$v[$g+0],$b=$v[$g+1],$a=$v[$g+2],$M=$Q.elements;$k[0]=$$*$M[0]+$b*$M[4]+$a*$M[8]+$M[12],$k[1]=$$*$M[1]+$b*$M[5]+$a*$M[9]+$M[13],$k[2]=$$*$M[2]+$b*$M[6]+$a*$M[10]+$M[14],$k[3]=1/($$*$M[3]+$b*$M[7]+$a*$M[11]+$M[15]),$d[$r+0]=$k[0]*$k[3],$d[$r+1]=$k[1]*$k[3],$d[$r+2]=$k[2]*$k[3]},$N.transformLightingMapTexcoordByUV0Array=function($v,$g,$Q,$d,$r){var $k=$Q.elements;$d[$r+0]=$v[$g+0]*$k[0]+$k[2],$d[$r+1]=($v[$g+1]-1)*$k[1]+$k[3]},$N.transformLightingMapTexcoordByUV1Array=function($v,$g,$Q,$d,$r){var $k=$Q.elements;$d[$r+0]=$v[$g+0]*$k[0]+$k[2],$d[$r+1]=1+$v[$g+1]*$k[1]+$k[3]},$N.getURLVerion=function($v){var $g=$v.indexOf("?");return 0<=$g?$v.substr($g):null},$N._quaternionCreateFromYawPitchRollArray=function($v,$g,$Q,$d){var $r=.5*$Q,$k=.5*$g,$$=.5*$v,$b=Math.sin($r),$a=Math.cos($r),$M=Math.sin($k),$Y=Math.cos($k),$D=Math.sin($$),$J=Math.cos($$);$d[0]=$J*$M*$a+$D*$Y*$b,$d[1]=$D*$Y*$a-$J*$M*$b,$d[2]=$J*$Y*$b-$D*$M*$a,$d[3]=$J*$Y*$a+$D*$M*$b},$N._createAffineTransformationArray=function($v,$g,$Q,$d){var $r=$g[0],$k=$g[1],$$=$g[2],$b=$g[3],$a=$r+$r,$M=$k+$k,$Y=$$+$$,$D=$r*$a,$J=$r*$M,$p=$r*$Y,$T=$k*$M,$t=$k*$Y,$q=$$*$Y,$C=$b*$a,$G=$b*$M,$s=$b*$Y,$A=$Q[0],$h=$Q[1],$P=$Q[2];$d[0]=(1-($T+$q))*$A,$d[1]=($J+$s)*$A,$d[2]=($p-$G)*$A,$d[3]=0,$d[4]=($J-$s)*$h,$d[5]=(1-($D+$q))*$h,$d[6]=($t+$C)*$h,$d[7]=0,$d[8]=($p+$G)*$P,$d[9]=($t-$C)*$P,$d[10]=(1-($D+$T))*$P,$d[11]=0,$d[12]=$v[0],$d[13]=$v[1],$d[14]=$v[2],$d[15]=1},$N._mulMatrixArray=function($v,$g,$Q,$d){var $r,$k,$$,$b,$a,$M=$g.elements,$Y=$M[0],$D=$M[1],$J=$M[2],$p=$M[3],$T=$M[4],$t=$M[5],$q=$M[6],$C=$M[7],$G=$M[8],$s=$M[9],$A=$M[10],$h=$M[11],$P=$M[12],$W=$M[13],$F=$M[14],$l=$M[15],$o=$d,$E=$d+4,$V=$d+8,$Z=$d+12;for($r=0;$r<4;$r++)$k=$v[$r],$$=$v[$r+4],$b=$v[$r+8],$a=$v[$r+12],$Q[$o+$r]=$k*$Y+$$*$D+$b*$J+$a*$p,$Q[$E+$r]=$k*$T+$$*$t+$b*$q+$a*$C,$Q[$V+$r]=$k*$G+$$*$s+$b*$A+$a*$h,$Q[$Z+$r]=$k*$P+$$*$W+$b*$F+$a*$l},$N.getYawPitchRoll=function($v,$g){$N.transformQuat($$g.ForwardRH,$v,$Qg.TEMPVector31),$N.transformQuat($$g.Up,$v,$Qg.TEMPVector32);var $Q=$Qg.TEMPVector32.elements;$N.angleTo($$g.ZERO,$Qg.TEMPVector31,$Qg.TEMPVector33);var $d=$Qg.TEMPVector33.elements;$d[0]==Math.PI/2?($d[1]=$N.arcTanAngle($Q[2],$Q[0]),$d[2]=0):$d[0]==-Math.PI/2?($d[1]=$N.arcTanAngle(-$Q[2],-$Q[0]),$d[2]=0):($vg.createRotationY(-$d[1],$Qg.TEMPMatrix0),$vg.createRotationX(-$d[0],$Qg.TEMPMatrix1),$$g.transformCoordinate($Qg.TEMPVector32,$Qg.TEMPMatrix0,$Qg.TEMPVector32),$$g.transformCoordinate($Qg.TEMPVector32,$Qg.TEMPMatrix1,$Qg.TEMPVector32),$d[2]=$N.arcTanAngle($Q[1],-$Q[0])),$d[1]<=-Math.PI&&($d[1]=Math.PI),$d[2]<=-Math.PI&&($d[2]=Math.PI),$d[1]>=Math.PI&&$d[2]>=Math.PI&&($d[1]=0,$d[2]=0,$d[0]=Math.PI-$d[0]),$g[0]=$d[1],$g[1]=$d[0],$g[2]=$d[2]},$N.arcTanAngle=function($v,$g){return 0==$v?1==$g?Math.PI/2:-Math.PI/2:0<$v?Math.atan($g/$v):$v<0?0<$g?Math.atan($g/$v)+Math.PI:Math.atan($g/$v)-Math.PI:0},$N.angleTo=function($v,$g,$Q){$$g.subtract($g,$v,$Qg.TEMPVector30),$$g.normalize($Qg.TEMPVector30,$Qg.TEMPVector30),$Q.elements[0]=Math.asin($Qg.TEMPVector30.y),$Q.elements[1]=$N.arcTanAngle(-$Qg.TEMPVector30.z,-$Qg.TEMPVector30.x)},$N.transformQuat=function($v,$g,$Q){var $d=$Q.elements,$r=$v.elements,$k=$g,$$=$r[0],$b=$r[1],$a=$r[2],$M=$k[0],$Y=$k[1],$D=$k[2],$J=$k[3],$p=$J*$$+$Y*$a-$D*$b,$T=$J*$b+$D*$$-$M*$a,$t=$J*$a+$M*$b-$Y*$$,$q=-$M*$$-$Y*$b-$D*$a;$d[0]=$p*$J+$q*-$M+$T*-$D-$t*-$Y,$d[1]=$T*$J+$q*-$Y+$t*-$M-$p*-$D,$d[2]=$t*$J+$q*-$D+$p*-$Y-$T*-$M},$N.quaterionNormalize=function($v,$g){var $Q=$v[0],$d=$v[1],$r=$v[2],$k=$v[3],$$=$Q*$Q+$d*$d+$r*$r+$k*$k;0<$$&&($$=1/Math.sqrt($$),$g[0]=$Q*$$,$g[1]=$d*$$,$g[2]=$r*$$,$g[3]=$k*$$)},$N.matrix4x4MultiplyFFF=function($v,$g,$Q){var $d,$r,$k,$$,$b;if($Q===$g)for($g=new Float32Array(16),$d=0;$d<16;++$d)$g[$d]=$Q[$d];for($d=0;$d<4;$d++)$r=$v[$d],$k=$v[$d+4],$$=$v[$d+8],$b=$v[$d+12],$Q[$d]=$r*$g[0]+$k*$g[1]+$$*$g[2]+$b*$g[3],$Q[$d+4]=$r*$g[4]+$k*$g[5]+$$*$g[6]+$b*$g[7],$Q[$d+8]=$r*$g[8]+$k*$g[9]+$$*$g[10]+$b*$g[11],$Q[$d+12]=$r*$g[12]+$k*$g[13]+$$*$g[14]+$b*$g[15]},$N.matrix4x4MultiplyMFM=function($v,$g,$Q){$N.matrix4x4MultiplyFFF($v.elements,$g,$Q.elements)},$D($N,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $$g},"_tempVector3_1",function(){return this._tempVector3_1=new $$g},"_tempVector3_2",function(){return this._tempVector3_2=new $$g},"_tempVector3_3",function(){return this._tempVector3_3=new $$g},"_tempVector3_4",function(){return this._tempVector3_4=new $$g},"_tempVector3_5",function(){return this._tempVector3_5=new $$g},"_tempVector3_6",function(){return this._tempVector3_6=new $$g},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$N}(),$Cg=function(){function $f(){}return $p($f,"Laya3D"),$f._cancelLoadByUrl=function($v){$h.loader.cancelLoadByUrl($v),$f._innerFirstLevelLoaderManager.cancelLoadByUrl($v),$f._innerSecondLevelLoaderManager.cancelLoadByUrl($v),$f._innerThirdLevelLoaderManager.cancelLoadByUrl($v),$f._innerFourthLevelLoaderManager.cancelLoadByUrl($v)},$f._changeWebGLSize=function($v,$g){$Z.onStageResize($v,$g),$U.clientWidth=$v,$U.clientHeight=$g},$f.__init__=function(){var $v=$g.createMap;$v.lh=[$xg,"SPRITE3DHIERARCHY"],$v.ls=[$ig,"SPRITE3DHIERARCHY"],$v.lm=[$Lg,"MESH"],$v.lmat=[$mg,"MATERIAL"],$v.jpg=[$ng,"nativeimage"],$v.jpeg=[$ng,"nativeimage"],$v.png=[$ng,"nativeimage"],$v.pkm=[$ng,"arraybuffer"],$v.raw=[$Bg,"arraybuffer"],$v.mipmaps=[$Bg,"arraybuffer"],$C.parserMap.SPRITE3DHIERARCHY=$f._loadHierarchy,$C.parserMap.MESH=$f._loadMesh,$C.parserMap.MATERIAL=$f._loadMaterial,$C.parserMap.TEXTURECUBE=$f._loadTextureCube,$C.parserMap.TERRAIN=$f._loadTerrain,$f._innerFirstLevelLoaderManager.on("error",null,$f._eventLoadManagerError),$f._innerSecondLevelLoaderManager.on("error",null,$f._eventLoadManagerError),$f._innerThirdLevelLoaderManager.on("error",null,$f._eventLoadManagerError),$f._innerFourthLevelLoaderManager.on("error",null,$f._eventLoadManagerError)},$f.READ_BLOCK=function(){return $f._readData.pos+=4,!0},$f.READ_DATA=function(){return $f._DATA.offset=$f._readData.getUint32(),$f._DATA.size=$f._readData.getUint32(),!0},$f.READ_STRINGS=function(){var $v=[],$g={offset:0,size:0};$g.offset=$f._readData.getUint16(),$g.size=$f._readData.getUint16();$f._readData.pos;$f._readData.pos=$g.offset+$f._DATA.offset;for(var $Q=0;$Q<$g.size;$Q++){var $d=$f._readData.readUTFString();-1===$d.lastIndexOf(".lmat")&&-1===$d.lastIndexOf(".lpbr")||$v.push($d)}return $v},$f.formatRelativePath=function($v,$g){var $Q;if("."===$g.charAt(0)){for(var $d=($v+$g).split("/"),$r=0,$k=$d.length;$r<$k;$r++)if(".."==$d[$r]){var $$=$r-1;0<$$&&".."!==$d[$$]&&($d.splice($$,2),$r-=2)}$Q=$d.join("/")}else $Q=$v+$g;return null!=$V.customFormat&&($Q=$V.customFormat($Q,null)),$Q},$f._eventLoadManagerError=function($v){$h.loader.event("error",$v)},$f._addHierarchyInnerUrls=function($v,$g,$Q,$d,$r,$k){var $$=$f.formatRelativePath($d,$r);$Q&&($$+=$Q),$v.push({url:$$,clas:$k}),$g[$r]=$$},$f._getSprite3DHierarchyInnerUrls=function($v,$g,$Q,$d,$r,$k,$$){var $b,$a=0,$M=0;switch($v.type){case"Scene":var $Y=$v.customProps.lightmaps;for($a=0,$M=$Y.length;$a<$M;$a++){var $D=$Y[$a].replace(".exr",".png");$f._addHierarchyInnerUrls($d,$r,$k,$$,$D,$ng)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $J;if($v.instanceParams)($J=$v.instanceParams.loadPath)&&$f._addHierarchyInnerUrls($g,$r,$k,$$,$J,$Lg);else{($J=($b=$v.customProps).meshPath)&&$f._addHierarchyInnerUrls($g,$r,$k,$$,$J,$Lg);var $p=$b.materials;if($p)for($a=0,$M=$p.length;$a<$M;$a++){for(var $T=$p[$a],$t=$T.type.split("."),$q=$X.window,$C=0,$G=$t.length;$C<$G;++$C){$q=$q[this.clasPaths[$C]]}if("function"!=typeof $q)throw"_getSprite3DHierarchyInnerUrls 错误: "+$T.type+" 不是类";$f._addHierarchyInnerUrls($Q,$r,$k,$$,$T.path,$q)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $s=($b=$v.customProps).meshPath;$s&&$f._addHierarchyInnerUrls($g,$r,$k,$$,$s,$Lg);var $A=$b.material;if($A){$t=$A.type.split("."),$q=$X.window;for($C=0,$G=$t.length;$C<$G;++$C){$q=$q[this.clasPaths[$C]]}$f._addHierarchyInnerUrls($Q,$r,$k,$$,$A.path,$q)}else{var $h=$b.materialPath;if($h)$f._addHierarchyInnerUrls($Q,$r,$k,$$,$h,ShurikenParticleMaterial);else{var $P=$b.texturePath;$P&&$f._addHierarchyInnerUrls($d,$r,$k,$$,$P,$ng)}}break;case"Terrain":$f._addHierarchyInnerUrls($d,$r,$k,$$,$v.customProps.dataPath,TerrainRes)}var $W=$v.components;for(var $F in $W){var $l=$W[$F];switch($F){case"Animator":var $o=$l.avatarPath;if($o)$f._addHierarchyInnerUrls($d,$r,$k,$$,$o,Avatar);else{var $E=$l.avatar;$E&&$f._addHierarchyInnerUrls($d,$r,$k,$$,$E.path,Avatar)}var $V=$l.clipPaths;for($a=0,$M=$V.length;$a<$M;$a++)$f._addHierarchyInnerUrls($d,$r,$k,$$,$V[$a],AnimationClip)}}var $Z=$v.child;for($a=0,$M=$Z.length;$a<$M;$a++)$f._getSprite3DHierarchyInnerUrls($Z[$a],$g,$Q,$d,$r,$k,$$)},$f._loadHierarchy=function($v){$v.on("loaded",null,$f._onHierarchylhLoaded,[$v,$v._class._getGroup()]),$v.load($v.url,"json",!1,null,!0)},$f._onHierarchylhLoaded=function($v,$g,$Q){if($v._class.destroyed)$v.endLoad();else{var $d=$v.url,$r=$qg.getURLVerion($d),$k=$V.getPath($d),$$=[],$b=[],$a=[],$M={};$f._getSprite3DHierarchyInnerUrls($Q,$$,$b,$a,$M,$r,$k);var $Y=$$.length+$b.length+$a.length,$D=$Y+1,$J=1/$D;if($f._onProcessChange($v,0,$J,1),0<$a.length){var $p=$Y/$D,$T=$E.create(null,$f._onProcessChange,[$v,$J,$p],!1);$f._innerFourthLevelLoaderManager.create($a,$E.create(null,$f._onHierarchyInnerForthLevResouLoaded,[$v,$g,$T,$Q,$M,$$,$b,$J+$p*$a.length,$p]),$T,null,null,1,!0,$g)}else $f._onHierarchyInnerForthLevResouLoaded($v,$g,null,$Q,$M,$$,$b,$J,$p)}},$f._onHierarchyInnerForthLevResouLoaded=function($v,$g,$Q,$d,$r,$k,$$,$b,$a){if($v._class.destroyed)$v.endLoad();else if($Q&&$Q.recover(),0<$$.length){var $M=$E.create(null,$f._onProcessChange,[$v,$b,$a],!1);$f._innerSecondLevelLoaderManager.create($$,$E.create(null,$f._onHierarchyInnerSecondLevResouLoaded,[$v,$g,$M,$d,$r,$k,$b+$a*$$.length,$a]),$Q,null,null,1,!0,$g)}else $f._onHierarchyInnerSecondLevResouLoaded($v,$g,null,$d,$r,$k,$b,$a)},$f._onHierarchyInnerSecondLevResouLoaded=function($v,$g,$Q,$d,$r,$k,$$,$b){if($v._class.destroyed)$v.endLoad();else if($Q&&$Q.recover(),0<$k.length){var $a=$E.create(null,$f._onProcessChange,[$v,$$,$b],!1);$f._innerFirstLevelLoaderManager.create($k,$E.create(null,$f._onHierarchyInnerFirstLevResouLoaded,[$v,$a,$d,$r]),$Q,null,null,1,!0,$g)}else $f._onHierarchyInnerFirstLevResouLoaded($v,null,$d,$r)},$f._onHierarchyInnerFirstLevResouLoaded=function($v,$g,$Q,$d){$g&&$g.recover(),$v.endLoad([$Q,$d])},$f._loadTerrain=function($v){$v.on("loaded",null,$f._onTerrainLtLoaded,[$v,$v._class._getGroup()]),$v.load($v.url,"json",!1,null,!0)},$f._onTerrainLtLoaded=function($v,$g,$Q){if($v._class.destroyed)$v.endLoad();else{var $d,$r,$k=$v.url,$$=$qg.getURLVerion($k),$b=$V.getPath($k),$a=[],$M={},$Y=0,$D=0,$J=$Q.heightData;$d=$J.url,$r=$f.formatRelativePath($b,$d),$$&&($r+=$$),$d=$M[$d]=$r;var $p=$Q.detailTexture;for($Y=0,$D=$p.length;$Y<$D;$Y++)$a.push({url:$p[$Y].diffuse});var $T=$Q.normalMap;for($Y=0,$D=$T.length;$Y<$D;$Y++)$a.push({url:$T[$Y]});var $t=$Q.alphaMap;for($Y=0,$D=$t.length;$Y<$D;$Y++)$a.push({url:$t[$Y],params:[!1,!1,6408,!0]});for($Y=0,$D=$a.length;$Y<$D;$Y++){var $q=$a[$Y].url;$r=$f.formatRelativePath($b,$q),$$&&($r+=$$),$a[$Y].url=$r,$M[$q]=$r}var $C=$a.length,$G=$C+2,$s=1/$G;$f._onProcessChange($v,0,$s,1);var $A={heightMapLoaded:!1,texturesLoaded:!1},$h=$E.create(null,$f._onProcessChange,[$v,$s,$s],!1);$f._innerFourthLevelLoaderManager.create($d,$E.create(null,$f._onTerrainHeightMapLoaded,[$v,$h,$Q,$M,$A]),$h,null,[$J.numX,$J.numZ,$J.bitType,$J.value],1,!0,$g);var $P=$E.create(null,$f._onProcessChange,[$v,2*$s,$C/$G],!1);$f._innerFourthLevelLoaderManager.create($a,$E.create(null,$f._onTerrainTexturesLoaded,[$v,$P,$Q,$M,$A]),$P,null,null,1,!0,$g)}},$f._onTerrainHeightMapLoaded=function($v,$g,$Q,$d,$r){$r.heightMapLoaded=!0,$r.texturesLoaded&&($v.endLoad([$Q,$d]),$g.recover())},$f._onTerrainTexturesLoaded=function($v,$g,$Q,$d,$r){$r.texturesLoaded=!0,$r.heightMapLoaded&&($v.endLoad([$Q,$d]),$g.recover())},$f._loadMesh=function($v){$v.on("loaded",null,$f._onMeshLmLoaded,[$v,$v._class._getGroup()]),$v.load($v.url,"arraybuffer",!1,null,!0)},$f._onMeshLmLoaded=function($v,$g,$Q){if($v._class.destroyed)$v.endLoad();else{var $d,$r,$k,$$=$v.url,$b=$qg.getURLVerion($$),$a=$V.getPath($$),$M={},$Y=0,$D=0;switch(($f._readData=new $P($Q)).pos=0,$f._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $J=$f._readData.getUint32();$f._readData.pos=$f._readData.pos+4,$D=$f._readData.getUint16(),$f._readData.pos=$f._readData.pos+8*$D;var $p=$f._readData.getUint32();for($D=$f._readData.getUint16(),$f._readData.pos=$J+$p,$d=[],$Y=0;$Y<$D;$Y++){var $T=$f._readData.readUTFString();-1!==$T.lastIndexOf(".lmat")&&$d.push($T)}break;default:for($f.READ_BLOCK(),$Y=0;$Y<2;$Y++){var $t=$f._readData.getUint16(),$q=$f._strings[$t],$C=$f["READ_"+$q];if(null==$C)throw new Error("model file err,no this function:"+$t+" "+$q);1===$Y?$d=$C.call():$C.call()}}for($Y=0,$k=$d.length;$Y<$k;$Y++){var $G=$d[$Y];$r=$f.formatRelativePath($a,$G),$b&&($r+=$b),$d[$Y]=$r,$M[$G]=$r}if(0<$d.length){$f._onProcessChange($v,0,.5,1);var $s=$E.create(null,$f._onProcessChange,[$v,.5,.5],!1);$f._innerSecondLevelLoaderManager.create($d,$E.create(null,$f._onMeshMateialLoaded,[$v,$s,$Q,$M]),$s,null,null,1,!0,$g)}else $v.endLoad([$Q,$M])}},$f._onMeshMateialLoaded=function($v,$g,$Q,$d){$v.endLoad([$Q,$d]),$g.recover()},$f._getMaterialTexturePath=function($v,$g,$Q){var $d=$v.length-4;return $v.indexOf(".dds")!=$d&&$v.indexOf(".tga")!=$d&&$v.indexOf(".exr")!=$d&&$v.indexOf(".DDS")!=$d&&$v.indexOf(".TGA")!=$d&&$v.indexOf(".EXR")!=$d||($v=$v.substr(0,$d)+".png"),$v=$f.formatRelativePath($Q,$v),$g&&($v+=$g),$v},$f._loadMaterial=function($v){$v.on("loaded",null,$f._onMaterilLmatLoaded,[$v,$v._class._getGroup()]),$v.load($v.url,"json",!1,null,!0)},$f._onMaterilLmatLoaded=function($v,$g,$Q){if($v._class.destroyed)$v.endLoad();else{var $d,$r=$v.url,$k=$qg.getURLVerion($r),$$=$V.getPath($r),$b=[],$a={},$M=$Q.customProps,$Y=$Q.version;if($Y)switch($Y){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $D=$Q.props.textures,$J=0,$p=$D.length;$J<$p;$J++){var $T=$D[$J],$t=$T.path;if($t){var $q=$t.length-4;$t.indexOf(".exr")!=$q&&$t.indexOf(".EXR")!=$q||($t=$t.substr(0,$q)+".png"),$d=$f.formatRelativePath($$,$t),$k&&($d+=$k),$b.push({url:$d,params:$T.params}),$a[$t]=$d}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $C=$M.diffuseTexture.texture2D;if($C&&($d=$f._getMaterialTexturePath($C,$k,$$),$b.push($d),$a[$C]=$d),$M.normalTexture){var $G=$M.normalTexture.texture2D;$G&&($d=$f._getMaterialTexturePath($G,$k,$$),$b.push($d),$a[$G]=$d)}if($M.specularTexture){var $s=$M.specularTexture.texture2D;$s&&($d=$f._getMaterialTexturePath($s,$k,$$),$b.push($d),$a[$s]=$d)}if($M.emissiveTexture){var $A=$M.emissiveTexture.texture2D;$A&&($d=$f._getMaterialTexturePath($A,$k,$$),$b.push($d),$a[$A]=$d)}if($M.ambientTexture){var $h=$M.ambientTexture.texture2D;$h&&($d=$f._getMaterialTexturePath($h,$k,$$),$b.push($d),$a[$h]=$d)}if($M.reflectTexture){var $P=$M.reflectTexture.texture2D;$P&&($d=$f._getMaterialTexturePath($P,$k,$$),$b.push($d),$a[$P]=$d)}}var $W=$b.length,$F=$W+1,$l=1/$F;if($f._onProcessChange($v,0,$l,1),0<$W){var $o=$E.create(null,$f._onProcessChange,[$v,$l,$W/$F],!1);$f._innerFourthLevelLoaderManager.create($b,$E.create(null,$f._onMateialTexturesLoaded,[$v,$o,$Q,$a]),$o,$ng,null,1,!0,$g)}else $f._onMateialTexturesLoaded($v,null,$Q,null)}},$f._onMateialTexturesLoaded=function($v,$g,$Q,$d){$v.endLoad([$Q,$d]),$g&&$g.recover()},$f._loadTextureCube=function($v){$v.on("loaded",null,$f._onTextureCubeLtcLoaded,[$v]),$v.load($v.url,"json",!1,null,!0)},$f._onTextureCubeLtcLoaded=function($v,$g){if($v._class.destroyed)$v.endLoad();else{var $Q=$V.getPath($v.url),$d=[$f.formatRelativePath($Q,$g.px),$f.formatRelativePath($Q,$g.nx),$f.formatRelativePath($Q,$g.py),$f.formatRelativePath($Q,$g.ny),$f.formatRelativePath($Q,$g.pz),$f.formatRelativePath($Q,$g.nz)];$f._onProcessChange($v,0,1/7,1);var $r=$E.create(null,$f._onProcessChange,[$v,1/7,6/7],!1);$f._innerFourthLevelLoaderManager.load($d,$E.create(null,$f._onTextureCubeImagesLoaded,[$v,$d,$r]),$r,"nativeimage")}},$f._onTextureCubeImagesLoaded=function($v,$g,$Q){var $d=[];$d.length=6;for(var $r=0;$r<6;$r++){var $k=$g[$r];$d[$r]=$C.getRes($k),$C.clearRes($k)}$v.endLoad($d),$Q.recover()},$f._onProcessChange=function($v,$g,$Q,$d){($d=$g+$d*$Q)<1&&$v.event("progress",$d)},$f.init=function($v,$g,$Q,$d,$r,$k){if(void 0===$Q&&($Q=!1),void 0===$d&&($d=!1),void 0===$r&&($r=!0),void 0===$k&&($k=!0),$G.update3DLoop=function(){},$G.cancelLoadByUrl=function($v){$f._cancelLoadByUrl($v)},$a.isAntialias=$Q,$a.isAlpha=$d,$a.premultipliedAlpha=$r,$a.isStencil=$k,!$Z.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$G.changeWebGLSize=$f._changeWebGLSize,$t.is3DMode=!0,$h.init($v,$g),$N.__init__(),$Dg.__init__(),$zg.__init__(),$j.__init__(),$f.__init__(),$$.maxTextureCount=2,($f.debugMode||$I.debugMode)&&($f._debugPhasorSprite=new $e)},$f.HIERARCHY="SPRITE3DHIERARCHY",$f.MESH="MESH",$f.MATERIAL="MATERIAL",$f.PBRMATERIAL="PBRMTL",$f.TEXTURECUBE="TEXTURECUBE",$f.TERRAIN="TERRAIN",$f._readData=null,$f._debugPhasorSprite=null,$f.debugMode=!1,$D($f,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $g},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $g},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $g},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $g}]),$f}(),$Gg=function($v){function $r($v){$r.__super.call(this),this._owner=$v,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$p($r,"laya.d3.animation.AnimationTransform3D",$k);var $g=$r.prototype;return $g._getlocalMatrix=function(){return this._localUpdate&&($qg._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$g._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldTransform()}},$g._setWorldMatrixAndUpdate=function($v){if(this._worldMatrix=$v,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $g=this._getlocalMatrix(),$Q=0;$Q<16;++$Q)this._worldMatrix[$Q]=$g[$Q];else $qg.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$g._setWorldMatrixNoUpdate=function($v){this._worldMatrix=$v},$g._setWorldMatrixIgnoreUpdate=function($v){this._worldMatrix=$v,this._worldUpdate=!1},$g.getLocalPosition=function(){return this._localPosition},$g.setLocalPosition=function($v){if(this._parent)this._localPosition=$v,this._localUpdate=!0,this._onWorldTransform();else{var $g=this._entity.owner._transform,$Q=this._entity.localPosition,$d=$Q.elements;$d[0]=$v[0],$d[1]=$v[1],$d[2]=$v[2],$g.localPosition=$Q}},$g.getLocalRotation=function(){if(this._localQuaternionUpdate){var $v=this._localRotationEuler;$qg._quaternionCreateFromYawPitchRollArray($v[1]/$r._angleToRandin,$v[0]/$r._angleToRandin,$v[2]/$r._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$g.setLocalRotation=function($v){if(this._parent)this._localRotation=$v,$qg.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $g=this._entity.owner._transform,$Q=this._entity.localRotation,$d=$Q.elements;$d[0]=$v[0],$d[1]=$v[1],$d[2]=$v[2],$d[3]=$v[3],$g.localRotation=$Q}},$g.getLocalScale=function(){return this._localScale},$g.setLocalScale=function($v){if(this._parent)this._localScale=$v,this._localUpdate=!0,this._onWorldTransform();else{var $g=this._entity.owner._transform,$Q=this._entity.localScale,$d=$Q.elements;$d[0]=$v[0],$d[1]=$v[1],$d[2]=$v[2],$g.localScale=$Q}},$g.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$qg.getYawPitchRoll(this._localRotation,$r._tempVector3);var $v=$r._tempVector3,$g=this._localRotationEuler;$g[0]=$v[1]*$r._angleToRandin,$g[1]=$v[0]*$r._angleToRandin,$g[2]=$v[2]*$r._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$g.setLocalRotationEuler=function($v){if(this._parent)$qg._quaternionCreateFromYawPitchRollArray($v[1]/$r._angleToRandin,$v[0]/$r._angleToRandin,$v[2]/$r._angleToRandin,this._localRotation),this._localRotationEuler=$v,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $g=this._entity.owner._transform,$Q=this._entity.localRotationEuler,$d=$Q.elements;$d[0]=$v[0],$d[1]=$v[1],$d[2]=$v[2],$g.localRotationEuler=$Q}},$g.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$qg.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $v=this._getlocalMatrix(),$g=0;$g<16;++$g)this._worldMatrix[$g]=$v[$g];this._worldUpdate=!1}return this._worldMatrix},$g.setParent=function($v){if(this._parent!==$v){if(this._parent){var $g=this._parent._childs,$Q=$g.indexOf(this);$g.splice($Q,1)}$v&&($v._childs.push(this),$v&&this._onWorldTransform()),this._parent=$v}},$D($r,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$r}(),$sg=function($v){function $g(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$g.__super.call(this),this._destroyed=!1,this._id=$g._uniqueIDCounter,$g._uniqueIDCounter++}$p($g,"laya.d3.component.Component3D",$k);var $Q=$g.prototype;return $h.imps($Q,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$Q._initialize=function($v){this._owner=$v,this._enable=!0,this.started=!1,this._load($v)},$Q._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$Q._load=function($v){},$Q._start=function($v){},$Q._update=function($v){},$Q._lateUpdate=function($v){},$Q._preRenderUpdate=function($v){},$Q._postRenderUpdate=function($v){},$Q._unload=function($v){this.offAll()},$Q._cloneTo=function($v){},$T(0,$Q,"id",function(){return this._id}),$T(0,$Q,"destroyed",function(){return this._destroyed}),$T(0,$Q,"owner",function(){return this._owner}),$T(0,$Q,"enable",function(){return this._enable},function($v){this._enable!==$v&&(this._enable=$v,this.event("enablechanged",this._enable))}),$T(0,$Q,"isSingleton",function(){return $g._isSingleton}),$g._isSingleton=!0,$g._uniqueIDCounter=1,$g}(),$Ag=function($v){function $g(){this._destroyed=!1,$g.__super.call(this),this._destroyed=!1}$p($g,"laya.d3.core.GeometryFilter",$k);var $Q=$g.prototype;return $h.imps($Q,{"laya.resource.IDestroy":!0}),$Q._destroy=function(){this.offAll(),this._destroyed=!0},$T(0,$Q,"_isAsyncLoaded",function(){return!0}),$T(0,$Q,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$T(0,$Q,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$T(0,$Q,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$T(0,$Q,"destroyed",function(){return this._destroyed}),$g}(),$hg=function($v){function $d($v){$d.__super.call(this),this._id=++$d._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $Iv(new $$g,new $$g),this._boundingBoxCenter=new $$g,this._boundingSphere=new $Ov(new $$g,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$v,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$p($d,"laya.d3.core.render.BaseRender",$k);var $g=$d.prototype;return $h.imps($g,{"laya.resource.IDestroy":!0}),$g._changeMaterialReference=function($v,$g){$v&&$v._removeReference(),$g._addReference()},$g._getInstanceMaterial=function($v,$g){var $Q=new $v.constructor;return $v.cloneTo($Q),$Q.name=$Q.name+"(Instance)",this._materialsInstance[$g]=!0,this._changeMaterialReference(this._materials[$g],$Q),this._materials[$g]=$Q},$g._setShaderValuelightMap=function($v){this._setShaderValueTexture(3,$v)},$g._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$g._renderRenderableBoundBox=function(){var $v=$Cg._debugPhasorSprite,$g=this.boundingBox,$Q=$d._tempBoundBoxCorners;$g.getCorners($Q),$v.line($Q[0],$d._greenColor,$Q[1],$d._greenColor),$v.line($Q[2],$d._greenColor,$Q[3],$d._greenColor),$v.line($Q[4],$d._greenColor,$Q[5],$d._greenColor),$v.line($Q[6],$d._greenColor,$Q[7],$d._greenColor),$v.line($Q[0],$d._greenColor,$Q[3],$d._greenColor),$v.line($Q[1],$d._greenColor,$Q[2],$d._greenColor),$v.line($Q[2],$d._greenColor,$Q[6],$d._greenColor),$v.line($Q[3],$d._greenColor,$Q[7],$d._greenColor),$v.line($Q[0],$d._greenColor,$Q[4],$d._greenColor),$v.line($Q[1],$d._greenColor,$Q[5],$d._greenColor),$v.line($Q[4],$d._greenColor,$Q[7],$d._greenColor),$v.line($Q[5],$d._greenColor,$Q[6],$d._greenColor)},$g._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$g._calculateBoundingBox=function(){throw"BaseRender: must override it."},$g._setShaderValueTexture=function($v,$g){this._owner._shaderValues.setValue($v,$g)},$g._setShaderValueMatrix4x4=function($v,$g){this._owner._shaderValues.setValue($v,$g?$g.elements:null)},$g._setShaderValueColor=function($v,$g){this._owner._shaderValues.setValue($v,$g?$g.elements:null)},$g._setShaderValueBuffer=function($v,$g){this._owner._shaderValues.setValue($v,$g)},$g._setShaderValueInt=function($v,$g){this._owner._shaderValues.setValue($v,$g)},$g._setShaderValueBool=function($v,$g){this._owner._shaderValues.setValue($v,$g)},$g._setShaderValueNumber=function($v,$g){this._owner._shaderValues.setValue($v,$g)},$g._setShaderValueVector2=function($v,$g){this._owner._shaderValues.setValue($v,$g?$g.elements:null)},$g._addShaderDefine=function($v){this._owner._shaderDefineValue|=$v},$g._removeShaderDefine=function($v){this._owner._shaderDefineValue&=~$v},$g._renderUpdate=function($v){return!0},$g._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $v=this._owner.scene;if($v){var $g=$v.getlightmaps()[this._lightmapIndex];$g?(this._addShaderDefine($eg.SAHDERDEFINE_LIGHTMAP),$g.loaded?this._setShaderValuelightMap($g):$g.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($eg.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($eg.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($eg.SAHDERDEFINE_LIGHTMAP)},$g._updateOctreeNode=function(){var $v=this._treeNode;$v&&this._octreeNodeNeedChange&&($v.updateObject(this),this._octreeNodeNeedChange=!1)},$g._destroy=function(){this.offAll();var $v=0,$g=0;for($v=0,$g=this._renderElements.length;$v<$g;$v++)this._renderElements[$v]._destroy();for($v=0,$g=this._materials.length;$v<$g;$v++)this._materials[$v]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$T(0,$g,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$T(0,$g,"id",function(){return this._id}),$T(0,$g,"material",function(){var $v=this._materials[0];if($v&&!this._materialsInstance[0]){var $g=this._getInstanceMaterial($v,0);this.event("materialchanged",[this,0,$g])}return this._materials[0]},function($v){this.sharedMaterial=$v}),$T(0,$g,"sharedMaterial",function(){return this._materials[0]},function($v){var $g=this._materials[0];$g!==$v&&(this._materials[0]=$v,this._materialsInstance[0]=!1,this._changeMaterialReference($g,$v),this.event("materialchanged",[this,0,$v]))}),$T(0,$g,"lightmapIndex",function(){return this._lightmapIndex},function($v){this._lightmapIndex=$v,this._applyLightMapParams()}),$T(0,$g,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($v){this._lightmapScaleOffset=$v,this._setShaderValueColor(2,$v),this._addShaderDefine($eg.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$T(0,$g,"enable",function(){return this._enable},function($v){this._enable=$v,this.event("enablechanged",[this,$v])}),$T(0,$g,"materials",function(){for(var $v=0,$g=this._materials.length;$v<$g;$v++)if(!this._materialsInstance[$v]){var $Q=this._getInstanceMaterial(this._materials[$v],$v);this.event("materialchanged",[this,$v,$Q])}return this._materials.slice()},function($v){this.sharedMaterials=$v}),$T(0,$g,"sharedMaterials",function(){return this._materials.slice()},function($v){if(!$v)throw new Error("MeshRender: shadredMaterials value can't be null.");var $g=$v.length;this._materialsInstance.length=$g;for(var $Q=0;$Q<$g;$Q++){var $d=this._materials[$Q];$d!==$v[$Q]&&(this._materialsInstance[$Q]=!1,this._changeMaterialReference($d,$v[$Q]),this.event("materialchanged",[this,$Q,$v[$Q]]))}this._materials=$v}),$T(0,$g,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$T(0,$g,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $v=this.boundingBox;$$g.add($v.min,$v.max,this._boundingBoxCenter),$$g.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$T(0,$g,"receiveShadow",function(){return this._receiveShadow},function($v){this._receiveShadow!==$v&&((this._receiveShadow=$v)?this._addShaderDefine($pg.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($pg.SHADERDEFINE_RECEIVE_SHADOW))}),$T(0,$g,"destroyed",function(){return this._destroyed}),$d._uniqueIDCounter=0,$D($d,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g,new $$g]},"_greenColor",function(){return this._greenColor=new $bg(0,1,0,1)}]),$d}(),$Pg=function($v){function $b($v){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$b.__super.call(this),this._localPosition=new $$g,this._localRotation=new $Qg(0,0,0,1),this._localScale=new $$g(1,1,1),this._localRotationEuler=new $$g,this._localMatrix=new $vg,this._position=new $$g,this._rotation=new $Qg(0,0,0,1),this._scale=new $$g(1,1,1),this._worldMatrix=new $vg,this._forward=new $$g,this._up=new $$g,this._right=new $$g,this._owner=$v,this._childs=[]}$p($b,"laya.d3.core.Transform3D",$k);var $g=$b.prototype;return $g._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$vg.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $v=$b._tempVector30;$$g.multiply(this.pivot,this._localScale,$v);var $g=$b._tempVector31;$$g.subtract($v,this.pivot,$g);var $Q=$b._tempVector32,$d=this.localRotation;$$g.transformQuat($v,$d,$Q),$$g.subtract($Q,$v,$Q);var $r=$b._tempVector33;$$g.subtract(this._localPosition,$g,$r),$$g.subtract($r,$Q,$r),$vg.createAffineTransformation($r,$d,this._localScale,this._localMatrix)}},$g._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldPositionRotationTransform()}},$g._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldPositionScaleTransform()}},$g._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldPositionTransform()}},$g._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldPositionRotationTransform()}},$g._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldPositionScaleTransform()}},$g._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._onWorldTransform()}},$g.translate=function($v,$g){void 0===$g&&($g=!0),$g?($vg.createFromQuaternion(this.localRotation,$b._tempMatrix0),$$g.transformCoordinate($v,$b._tempMatrix0,$b._tempVector30),$$g.add(this.localPosition,$b._tempVector30,this._localPosition),this.localPosition=this._localPosition):($$g.add(this.position,$v,this._position),this.position=this._position)},$g.rotate=function($v,$g,$Q){var $d;void 0===$g&&($g=!0),void 0===$Q&&($Q=!0),$d=$Q?$v:($$g.scale($v,Math.PI/180,$b._tempVector30),$b._tempVector30),$Qg.createFromYawPitchRoll($d.y,$d.x,$d.z,$b._tempQuaternion0),$g?($Qg.multiply(this._localRotation,$b._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($Qg.multiply($b._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$g.lookAt=function($v,$g,$Q){void 0===$Q&&($Q=!1);var $d,$r=$v.elements;if($Q){if($d=this._localPosition.elements,Math.abs($d[0]-$r[0])<$_v.zeroTolerance&&Math.abs($d[1]-$r[1])<$_v.zeroTolerance&&Math.abs($d[2]-$r[2])<$_v.zeroTolerance)return;$Qg.lookAt(this._localPosition,$v,$g,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $k=this.position;if($d=$k.elements,Math.abs($d[0]-$r[0])<$_v.zeroTolerance&&Math.abs($d[1]-$r[1])<$_v.zeroTolerance&&Math.abs($d[2]-$r[2])<$_v.zeroTolerance)return;$Qg.lookAt($k,$v,$g,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$T(0,$g,"_isFrontFaceInvert",function(){var $v=this.scale,$g=$v.x<0;return $v.y<0&&($g=!$g),$v.z<0&&($g=!$g),$g}),$T(0,$g,"owner",function(){return this._owner}),$T(0,$g,"localRotation",function(){if(this._localQuaternionUpdate){var $v=this._localRotationEuler.elements;$Qg.createFromYawPitchRoll($v[1]/$b._angleToRandin,$v[0]/$b._angleToRandin,$v[2]/$b._angleToRandin,this._localRotation)}return this._localRotation},function($v){this._localRotation=$v,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$T(0,$g,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$vg.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($v){null===this._parent?$v.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$vg.multiply(this._localMatrix,$v,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$v,this._worldUpdate=!1}),$T(0,$g,"worldNeedUpdate",function(){return this._worldUpdate}),$T(0,$g,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($v){this._localMatrix=$v,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$T(0,$g,"dummy",function(){return this._dummy},function($v){this._dummy!==$v&&(this._dummy&&(this._dummy._entity=null),$v&&($v._entity=this),this._dummy=$v)}),$T(0,$g,"localPosition",function(){return this._localPosition},function($v){this._localPosition=$v,this._localUpdate=!0,this._onWorldPositionTransform()}),$T(0,$g,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $v=this._parent.position;$$g.multiply(this._localPosition,this._parent.scale,$b._tempVector30),$$g.transformQuat($b._tempVector30,this._parent.rotation,$b._tempVector30),$$g.add($v,$b._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($v){if(null!=this._parent){$$g.subtract($v,this._parent.position,this._localPosition);var $g=this._parent.scale.elements,$Q=$g[0],$d=$g[1],$r=$g[2];if(1!==$Q||1!==$d||1!==$r){var $k=$b._tempVector30,$$=$k.elements;$$[0]=1/$Q,$$[1]=1/$d,$$[2]=1/$r,$$g.multiply(this._localPosition,$k,this._localPosition)}this._parent.rotation.invert($b._tempQuaternion0),$$g.transformQuat(this._localPosition,$b._tempQuaternion0,this._localPosition)}else $v.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$v,this._positionUpdate=!1}),$T(0,$g,"localScale",function(){return this._localScale},function($v){this._localScale=$v,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$T(0,$g,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($b._tempVector30);var $v=$b._tempVector30.elements,$g=this._localRotationEuler.elements;$g[0]=$v[1]*$b._angleToRandin,$g[1]=$v[0]*$b._angleToRandin,$g[2]=$v[2]*$b._angleToRandin}return this._localRotationEuler},function($v){this._localRotationEuler=$v,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$T(0,$g,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$Qg.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($v){null!=this._parent?(this._parent.rotation.invert($b._tempQuaternion0),$Qg.multiply($v,$b._tempQuaternion0,this._localRotation)):$v.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$v,this._rotationUpdate=!1}),$T(0,$g,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$$g.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($v){if(null!==this._parent){var $g=this._parent.scale.elements,$Q=$b._tempVector30.elements;$Q[0]=1/$g[0],$Q[1]=1/$g[1],$Q[2]=1/$g[2],$$g.multiply($v,$b._tempVector30,this._localScale)}else $v.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$v,this._scaleUpdate=!1}),$T(0,$g,"rotationEuler",null,function($v){$Qg.createFromYawPitchRoll($v.y,$v.x,$v.z,this._rotation),this.rotation=this._rotation}),$T(0,$g,"forward",function(){var $v=this.worldMatrix.elements;return this._forward.elements[0]=-$v[8],this._forward.elements[1]=-$v[9],this._forward.elements[2]=-$v[10],this._forward}),$T(0,$g,"up",function(){var $v=this.worldMatrix.elements;return this._up.elements[0]=$v[4],this._up.elements[1]=$v[5],this._up.elements[2]=$v[6],this._up}),$T(0,$g,"right",function(){var $v=this.worldMatrix.elements;return this._right.elements[0]=$v[0],this._right.elements[1]=$v[1],this._right.elements[2]=$v[2],this._right}),$T(0,$g,"parent",function(){return this._parent},function($v){if(this._parent!==$v){if(this._parent){var $g=this._parent._childs,$Q=$g.indexOf(this);$g.splice($Q,1)}$v&&($v._childs.push(this),$v&&this._onWorldTransform()),this._parent=$v}}),$D($b,["_tempVector30",function(){return this._tempVector30=new $$g},"_tempVector31",function(){return this._tempVector31=new $$g},"_tempVector32",function(){return this._tempVector32=new $$g},"_tempVector33",function(){return this._tempVector33=new $$g},"_tempQuaternion0",function(){return this._tempQuaternion0=new $Qg},"_tempMatrix0",function(){return this._tempMatrix0=new $vg},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$b}(),$Wg=(function($v){function $g(){this._rotation=0,this._matNeedUpdte=!1,$g.__super.call(this),this._matrix=new $vg,this._offset=new $kg,this._tiling=new $kg(1,1)}$p($g,"laya.d3.core.TransformUV",$k);var $Q=$g.prototype;$h.imps($Q,{"laya.d3.core.IClone":!0}),$Q._updateMatrix=function(){$g._tempOffsetV3.elements[0]=this._offset.x,$g._tempOffsetV3.elements[1]=this._offset.y,$Qg.createFromYawPitchRoll(0,0,this._rotation,$g._tempRotationQua),$g._tempTitlingV3.elements[0]=this._tiling.x,$g._tempTitlingV3.elements[1]=this._tiling.y,$vg.createAffineTransformation($g._tempOffsetV3,$g._tempRotationQua,$g._tempTitlingV3,this._matrix)},$Q.cloneTo=function($v){$v._matrix=this._matrix.clone(),$v._offset=this._offset.clone(),$v._rotation=this._rotation,$v._tiling=this._tiling.clone()},$Q.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$Q,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$T(0,$Q,"tiling",function(){return this._tiling},function($v){this._tiling=$v,this._matNeedUpdte=!0}),$T(0,$Q,"offset",function(){return this._offset},function($v){this._offset=$v,this._matNeedUpdte=!0}),$T(0,$Q,"rotation",function(){return this._rotation},function($v){this._rotation=$v,this._matNeedUpdte=!0}),$D($g,["_tempOffsetV3",function(){return this._tempOffsetV3=new $$g(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $Qg},"_tempTitlingV3",function(){return this._tempTitlingV3=new $$g(1,1,1)}])}(),function($Q){function $v(){this.x=NaN,this.y=NaN,this.z=NaN,$v.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$p($v,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$Q);var $g=$v.prototype;$g._getShapeBoundBox=function($v){var $g=$v.min.elements;$g[0]=.5*-this.x,$g[1]=.5*-this.y,$g[2]=.5*-this.z;var $Q=$v.max.elements;$Q[0]=.5*this.x,$Q[1]=.5*this.y,$Q[2]=.5*this.z},$g._getSpeedBoundBox=function($v){var $g=$v.min.elements;$g[0]=0,$g[1]=0,$g[2]=0;var $Q=$v.max.elements;$Q[0]=0,$Q[1]=1,$Q[2]=0},$g.generatePositionAndDirection=function($v,$g,$Q,$d){var $r=$v.elements,$k=$g.elements;$Q?($Q.seed=$d[16],$n._randomPointInsideHalfUnitBox($v,$Q),$d[16]=$Q.seed):$n._randomPointInsideHalfUnitBox($v),$r[0]=this.x*$r[0],$r[1]=this.y*$r[1],$r[2]=this.z*$r[2],this.randomDirection?$Q?($Q.seed=$d[17],$n._randomPointUnitSphere($g,$Q),$d[17]=$Q.seed):$n._randomPointUnitSphere($g):($k[0]=0,$k[1]=0,$k[2]=1)},$g.cloneTo=function($v){$Q.prototype.cloneTo.call(this,$v);var $g=$v;$g.x=this.x,$g.y=this.y,$g.z=this.z,$g.randomDirection=this.randomDirection}}($c),function($Q){function $$(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$$.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$p($$,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$Q);var $v=$$.prototype;$v._getShapeBoundBox=function($v){var $g=$v.min.elements;$g[0]=$g[2]=-this.radius,$g[1]=0;var $Q=$v.max.elements;$Q[0]=$Q[2]=this.radius,$Q[1]=0},$v._getSpeedBoundBox=function($v){var $g=$v.min.elements;$g[0]=$g[1]=-1,$g[2]=0;var $Q=$v.max.elements;$Q[0]=$Q[1]=1,$Q[2]=0},$v.generatePositionAndDirection=function($v,$g,$Q,$d){var $r=$v.elements,$k=$$._tempPositionPoint.elements;$Q?($Q.seed=$d[16],this.emitFromEdge?$n._randomPointUnitArcCircle(this.arc,$$._tempPositionPoint,$Q):$n._randomPointInsideUnitArcCircle(this.arc,$$._tempPositionPoint,$Q),$d[16]=$Q.seed):this.emitFromEdge?$n._randomPointUnitArcCircle(this.arc,$$._tempPositionPoint):$n._randomPointInsideUnitArcCircle(this.arc,$$._tempPositionPoint),$r[0]=-$k[0],$r[1]=$k[1],$r[2]=0,$$g.scale($v,this.radius,$v),this.randomDirection?$Q?($Q.seed=$d[17],$n._randomPointUnitSphere($g,$Q),$d[17]=$Q.seed):$n._randomPointUnitSphere($g):$v.cloneTo($g)},$v.cloneTo=function($v){$Q.prototype.cloneTo.call(this,$v);var $g=$v;$g.radius=this.radius,$g.arc=this.arc,$g.emitFromEdge=this.emitFromEdge,$g.randomDirection=this.randomDirection},$D($$,["_tempPositionPoint",function(){return this._tempPositionPoint=new $kg}])}($c),function($Q){function $J(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$J.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$p($J,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$Q);var $v=$J.prototype;$v._getShapeBoundBox=function($v){var $g=this.radius+this.length*Math.sin(this.angle),$Q=this.length*Math.cos(this.angle),$d=$v.min.elements;$d[0]=$d[1]=-$g,$d[2]=0;var $r=$v.max.elements;$r[0]=$r[1]=$g,$r[2]=$Q},$v._getSpeedBoundBox=function($v){var $g=Math.sin(this.angle),$Q=$v.min.elements;$Q[0]=$Q[1]=-$g,$Q[2]=0;var $d=$v.max.elements;$d[0]=$Q[1]=$g,$d[2]=1},$v.generatePositionAndDirection=function($v,$g,$Q,$d){var $r,$k=$v.elements,$$=$g.elements,$b=$J._tempPositionPoint.elements,$a=NaN,$M=NaN,$Y=Math.cos(this.angle),$D=Math.sin(this.angle);switch(this.emitType){case 0:$Q?($Q.seed=$d[16],$n._randomPointInsideUnitCircle($J._tempPositionPoint,$Q),$d[16]=$Q.seed):$n._randomPointInsideUnitCircle($J._tempPositionPoint),$a=$b[0],$M=$b[1],$k[0]=$a*this.radius,$k[1]=$M*this.radius,$k[2]=0,this.randomDirection?($Q?($Q.seed=$d[17],$n._randomPointInsideUnitCircle($J._tempDirectionPoint,$Q),$d[17]=$Q.seed):$n._randomPointInsideUnitCircle($J._tempDirectionPoint),$r=$J._tempDirectionPoint.elements,$$[0]=$r[0]*$D,$$[1]=$r[1]*$D):($$[0]=$a*$D,$$[1]=$M*$D),$$[2]=$Y;break;case 1:$Q?($Q.seed=$d[16],$n._randomPointUnitCircle($J._tempPositionPoint,$Q),$d[16]=$Q.seed):$n._randomPointUnitCircle($J._tempPositionPoint),$a=$b[0],$M=$b[1],$k[0]=$a*this.radius,$k[1]=$M*this.radius,$k[2]=0,this.randomDirection?($Q?($Q.seed=$d[17],$n._randomPointInsideUnitCircle($J._tempDirectionPoint,$Q),$d[17]=$Q.seed):$n._randomPointInsideUnitCircle($J._tempDirectionPoint),$r=$J._tempDirectionPoint.elements,$$[0]=$r[0]*$D,$$[1]=$r[1]*$D):($$[0]=$a*$D,$$[1]=$M*$D),$$[2]=$Y;break;case 2:$Q?($Q.seed=$d[16],$n._randomPointInsideUnitCircle($J._tempPositionPoint,$Q)):$n._randomPointInsideUnitCircle($J._tempPositionPoint),$a=$b[0],$M=$b[1],$k[0]=$a*this.radius,$k[1]=$M*this.radius,$$[$k[2]=0]=$a*$D,$$[1]=$M*$D,$$[2]=$Y,$$g.normalize($g,$g),$Q?($$g.scale($g,this.length*$Q.getFloat(),$g),$d[16]=$Q.seed):$$g.scale($g,this.length*Math.random(),$g),$$g.add($v,$g,$v),this.randomDirection&&($Q?($Q.seed=$d[17],$n._randomPointUnitSphere($g,$Q),$d[17]=$Q.seed):$n._randomPointUnitSphere($g));break;case 3:$Q?($Q.seed=$d[16],$n._randomPointUnitCircle($J._tempPositionPoint,$Q)):$n._randomPointUnitCircle($J._tempPositionPoint),$a=$b[0],$M=$b[1],$k[0]=$a*this.radius,$k[1]=$M*this.radius,$$[$k[2]=0]=$a*$D,$$[1]=$M*$D,$$[2]=$Y,$$g.normalize($g,$g),$Q?($$g.scale($g,this.length*$Q.getFloat(),$g),$d[16]=$Q.seed):$$g.scale($g,this.length*Math.random(),$g),$$g.add($v,$g,$v),this.randomDirection&&($Q?($Q.seed=$d[17],$n._randomPointUnitSphere($g,$Q),$d[17]=$Q.seed):$n._randomPointUnitSphere($g));break;default:throw new Error("ConeShape:emitType is invalid.")}},$v.cloneTo=function($v){$Q.prototype.cloneTo.call(this,$v);var $g=$v;$g.angle=this.angle,$g.radius=this.radius,$g.length=this.length,$g.emitType=this.emitType,$g.randomDirection=this.randomDirection},$D($J,["_tempPositionPoint",function(){return this._tempPositionPoint=new $kg},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $kg}])}($c),function($Q){function $v(){this.radius=NaN,this.emitFromShell=!1,$v.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$p($v,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$Q);var $g=$v.prototype;$g._getShapeBoundBox=function($v){var $g=$v.min.elements;$g[0]=$g[1]=$g[2]=-this.radius;var $Q=$v.max.elements;$Q[0]=$Q[1]=this.radius,$Q[2]=0},$g._getSpeedBoundBox=function($v){var $g=$v.min.elements;$g[0]=$g[1]=-1,$g[2]=0;var $Q=$v.max.elements;$Q[0]=$Q[1]=$Q[2]=1},$g.generatePositionAndDirection=function($v,$g,$Q,$d){var $r=$v.elements;$Q?($Q.seed=$d[16],this.emitFromShell?$n._randomPointUnitSphere($v,$Q):$n._randomPointInsideUnitSphere($v,$Q),$d[16]=$Q.seed):this.emitFromShell?$n._randomPointUnitSphere($v):$n._randomPointInsideUnitSphere($v),$$g.scale($v,this.radius,$v);var $k=$r[2];$k<0&&($r[2]=-1*$k),this.randomDirection?$Q?($Q.seed=$d[17],$n._randomPointUnitSphere($g,$Q),$d[17]=$Q.seed):$n._randomPointUnitSphere($g):$v.cloneTo($g)},$g.cloneTo=function($v){$Q.prototype.cloneTo.call(this,$v);var $g=$v;$g.radius=this.radius,$g.emitFromShell=this.emitFromShell,$g.randomDirection=this.randomDirection}}($c),function($Q){function $v(){this.radius=NaN,this.emitFromShell=!1,$v.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$p($v,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$Q);var $g=$v.prototype;$g._getShapeBoundBox=function($v){var $g=$v.min.elements;$g[0]=$g[1]=$g[2]=-this.radius;var $Q=$v.max.elements;$Q[0]=$Q[1]=$Q[2]=this.radius},$g._getSpeedBoundBox=function($v){var $g=$v.min.elements;$g[0]=$g[1]=$g[2]=-1;var $Q=$v.max.elements;$Q[0]=$Q[1]=$Q[2]=1},$g.generatePositionAndDirection=function($v,$g,$Q,$d){$Q?($Q.seed=$d[16],this.emitFromShell?$n._randomPointUnitSphere($v,$Q):$n._randomPointInsideUnitSphere($v,$Q),$d[16]=$Q.seed):this.emitFromShell?$n._randomPointUnitSphere($v):$n._randomPointInsideUnitSphere($v),$$g.scale($v,this.radius,$v),this.randomDirection?$Q?($Q.seed=$d[17],$n._randomPointUnitSphere($g,$Q),$d[17]=$Q.seed):$n._randomPointUnitSphere($g):$v.cloneTo($g)},$g.cloneTo=function($v){$Q.prototype.cloneTo.call(this,$v);var $g=$v;$g.radius=this.radius,$g.emitFromShell=this.emitFromShell,$g.randomDirection=this.randomDirection}}($c),function($v){function $g(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$g.__super.call(this)}return $p($g,"laya.d3.core.render.SubMeshRenderElement",$R),$g}()),$Fg=function($v){function $q($v,$g,$Q,$d,$r,$k){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$v,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$pg.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$eg.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$eg.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$Vg.SHADERDEFINE_ALPHATEST]="ALPHATEST";$q.__super.call(this,$v,$g,$Q,null,{}),this._attributeMap=$d;var $$;for($$ in $r){var $b=$r[$$];switch($b[1]){case 0:this._renderElementUniformMap[$$]=$b[0];break;case 1:this._materialUniformMap[$$]=$b[0];break;case 2:this._spriteUniformMap[$$]=$b[0];break;case 3:this._cameraUniformMap[$$]=$b[0];break;case 4:this._sceneUniformMap[$$]=$b[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$p($q,"laya.d3.shader.ShaderCompile3D",$s);var $g=$q.prototype;return $g._definesToNameDic=function($v,$g){for(var $Q={},$d=1,$r=0;$r<32&&!($v<($d=1<<$r));$r++)if($v&$d){var $k=$g[$d];$k&&($Q[$k]="")}return $Q},$g.withCompile=function($v,$g,$Q,$d){var $r,$k,$$;if($k=this.sharders[$v])if($$=$k[$g]){if($r=$$[$Q])return $r}else $$=$k[$g]=[];else $$=($k=this.sharders[$v]=[])[$g]=[];var $b,$a=this._definesToNameDic($v,$q._globalInt2name),$M=this._definesToNameDic($g,this._spriteInt2name),$Y=this._definesToNameDic($Q,this._materialInt2name),$D={},$J="";if($a)for($b in $a)$J+="#define "+$b+"\n",$D[$b]=!0;if($M)for($b in $M)$J+="#define "+$b+"\n",$D[$b]=!0;if($Y)for($b in $Y)$J+="#define "+$b+"\n",$D[$b]=!0;var $p=$wg.nameKey.getName(this._name)+" compile ("+$v+","+$g+","+$Q+")",$T=this._VS.toscript($D,[]),$t=this._PS.toscript($D,[]);$X.now();if($r=$wg.create($J+$T.join("\n"),$J+$t.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$d,$p),$$[$Q]=$r,laya.d3.shader.ShaderCompile3D.debugMode)$X.now();return $r},$g.precompileShaderWithShaderDefine=function($v,$g,$Q){this.withCompile($v,$g,$Q,!0)},$g.addMaterialDefines=function($v){var $g=$v.defines;for(var $Q in $g){var $d=$g[$Q],$r=parseInt($Q);this._materialInt2name[$r]=$d,this._materialName2Int[$d]=$r}},$g.addSpriteDefines=function($v){var $g=$v.defines;for(var $Q in $g){var $d=$g[$Q],$r=parseInt($Q);this._spriteInt2name[$r]=$d,this._spriteName2Int[$d]=$r}},$g.getMaterialDefineByName=function($v){return this._materialName2Int[$v]},$g.registerMaterialDefine=function($v){var $g=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$g]=$v,this._materialName2Int[$v]=$g},$g.registerSpriteDefine=function($v){var $g=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$g]=$v,this._spriteName2Int[$v]=$g},$q._globalRegDefine=function($v,$g){$q._globalInt2name[$g]=$v},$q.add=function($v,$g,$Q,$d,$r){return laya.d3.shader.ShaderCompile3D._preCompileShader[$v]=new $q($v,$g,$Q,$d,$r,$s.includes)},$q.get=function($v){return laya.d3.shader.ShaderCompile3D._preCompileShader[$wg.nameKey.getID($v)]},$q._preCompileShader={},$q._globalInt2name=[],$q.debugMode=!1,$q.SHADERDEFINE_HIGHPRECISION=1,$q.SHADERDEFINE_FOG=4,$q.SHADERDEFINE_DIRECTIONLIGHT=8,$q.SHADERDEFINE_POINTLIGHT=16,$q.SHADERDEFINE_SPOTLIGHT=32,$q.SHADERDEFINE_UV0=64,$q.SHADERDEFINE_COLOR=128,$q.SHADERDEFINE_UV1=256,$q.SAHDERDEFINE_DEPTHFOG=131072,$q}(),$lg=function($v){function $T(){$T.__super.call(this)}$p($T,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$dv);var $g=$T.prototype;return $g._getStaticBatch=function($v,$g,$Q,$d){var $r,$k;return $k=$v?$v.id.toString()+$Q.id.toString()+$g.id.toString()+$d.toString():$Q.id.toString()+$g.id.toString()+$d.toString(),this._staticBatches[$k]?$r=this._staticBatches[$k]:this._staticBatches[$k]=$r=new $og($k,this,$v,$g,$Q),$r},$g._initStaticBatchs=function($v){var $g,$Q;this._initBatchRenderElements.sort($T._sortPrepareStaticBatch);for(var $d,$r=!1,$k=0,$$=0,$b=this._initBatchRenderElements.length;$$<$b;$$++){var $a,$M=this._initBatchRenderElements[$$],$Y=$M.renderObj._getVertexBuffer(0);$M._sprite3D;if($Q===$Y.vertexDeclaration&&$g===$M._material)if($r)$d._addCombineBatchRenderObjTest($M)?($a=$M._staticBatch)!==$d&&($a&&$a._deleteCombineBatchRenderObj($M),$d._addCombineBatchRenderObj($M)):($r=!1,$k++);else{var $D=this._initBatchRenderElements[$$-1],$J=$D.renderObj,$p=$M.renderObj;$r=!(65535<$J._getVertexBuffer().vertexCount+$p._getVertexBuffer().vertexCount)&&($d=this._getStaticBatch($v,$Q,$g,$k),($a=$D._staticBatch)!==$d&&($a&&$a._deleteCombineBatchRenderObj($D),$d._addCombineBatchRenderObj($D)),($a=$M._staticBatch)!==$d&&($a&&$a._deleteCombineBatchRenderObj($M),$d._addCombineBatchRenderObj($M)),!0)}else $r=!1,$k=0;$g=$M._material,$Q=$Y.vertexDeclaration}},$T._sortPrepareStaticBatch=function($v,$g){var $Q=$v._render,$d=$g._render,$r=$Q.lightmapIndex-$d.lightmapIndex;if(0!=$r)return $r;var $k=$Q.receiveShadow-$d.receiveShadow;if(0!=$k)return $k;var $$=$v._mainSortID-$g._mainSortID;return 0==$$?$v.renderObj.triangleCount-$g.renderObj.triangleCount:$$},$T}(),$og=function($v){function $k($v,$g,$Q,$d,$r){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$k.__super.call(this,$v,$g,$Q),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$d,this._material=$r}$p($k,"laya.d3.graphics.SubMeshStaticBatch",$rv);var $g=$k.prototype;return $g._compareBatchRenderElement=function($v,$g){return $v._batchIndexStart>$g._batchIndexStart},$g._addCombineBatchRenderObjTest=function($v){var $g=$v.renderObj._vertexCount;return!(65535<(0<$g?this._currentCombineVertexCount+$g:this._currentCombineVertexCount+$v.renderObj._getVertexBuffer().vertexCount))},$g._addCombineBatchRenderObj=function($v){var $g=$v.renderObj,$Q=$g._vertexCount;this._initBatchRenderElements.push($v),$v._staticBatch=this,0<$Q?(this._currentCombineIndexCount+=$g._indexCount,this._currentCombineVertexCount+=$Q):(this._currentCombineIndexCount=this._currentCombineIndexCount+$g._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$g._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$g._deleteCombineBatchRenderObj=function($v){var $g=$v.renderObj,$Q=this._initBatchRenderElements.indexOf($v);if(-1!==$Q){this._initBatchRenderElements.splice($Q,1),$v._staticBatch=null;var $d=$g._vertexCount;0<$d?(this._currentCombineIndexCount=this._currentCombineIndexCount-$g._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$d):(this._currentCombineIndexCount=this._currentCombineIndexCount-$g._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$g._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$g._finishInit=function(){if(this._needFinishCombine){var $v=0,$g=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $Q=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$d=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$cg.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$Kg.create("ushort",this._currentCombineIndexCount,35044);for(var $r=0,$k=this._initBatchRenderElements.length;$r<$k;$r++){var $$=this._initBatchRenderElements[$r],$b=$$.renderObj,$a=$b._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$$._sprite3D),$M=$b.getIndices(),$Y=$$._sprite3D.transform._isFrontFaceInvert,$D=$v/(this._vertexDeclaration.vertexStride/4)-$b._vertexStart,$J=$g,$p=$J+$M.length;$$._batchIndexStart=$J,$$._batchIndexEnd=$p,$d.set($M,$g);var $T=0;if($Y)for($T=$J;$T<$p;$T+=3){$d[$T]=$D+$d[$T];var $t=$d[$T+1],$q=$d[$T+2];$d[$T+1]=$D+$q,$d[$T+2]=$D+$t}else for($T=$J;$T<$p;$T+=3)$d[$T]=$D+$d[$T],$d[$T+1]=$D+$d[$T+1],$d[$T+2]=$D+$d[$T+2];$g+=$M.length,$Q.set($a,$v),$v+=$a.length}this._vertexBuffer.setData($Q),this._indexBuffer.setData($d),this._needFinishCombine=!1}},$g._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $Wg)},$g._getRenderElement=function($v,$g,$Q){for(var $d,$r,$k=this._batchRenderElements.length,$$=!0,$b=0;$b<$k;$b++){var $a,$M,$Y=($r=this._batchRenderElements[$b])._sprite3D._render;if(0!==$b&&($$=($a=($d=this._batchRenderElements[$b-1])._sprite3D._render).lightmapIndex!==$Y.lightmapIndex||$a.receiveShadow!==$Y.receiveShadow||$d._batchIndexEnd!==$r._batchIndexStart),$$){($M=this._getCombineRenderElementFromPool()).renderObj=this,$M._material=this._material,$M._batchIndexStart=$r._batchIndexStart,$M._batchIndexEnd=$r._batchIndexEnd;var $D=$Y.lightmapIndex,$J=$D+1,$p=this._batchOwnerIndices[$J];$p||($p=this._batchOwnerIndices[$J]=[]);var $T,$t=$p[$r._render.receiveShadow?1:0];void 0===$t?($p[$Y.receiveShadow?1:0]=this._batchOwners.length,($T=new $zg(null,"StaticBatchMeshSprite3D"))._scene=$g,$T._transform=this._rootOwner?this._rootOwner._transform:null,$T._render.lightmapIndex=$D,$T._render.receiveShadow=$r._render.receiveShadow,this._batchOwners.push($T)):$T=this._batchOwners[$t],$T._render._renderUpdate($Q),$M._sprite3D=$T,$v.push($M)}else $M._batchIndexEnd=$r._batchIndexEnd}},$g._beforeRender=function($v){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$g._render=function($v){var $g=$v.renderElement,$Q=$g._batchIndexStart,$d=$g._batchIndexEnd-$Q;$Z.mainContext.drawElements(4,$d,5123,2*$Q),$F.drawCall++,$F.trianglesFaces+=$d/3},$g.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$g._getVertexBuffer=function($v){return void 0===$v&&($v=0),this._vertexBuffer},$k}(),$Eg=function($v){function $g(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$g.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$p($g,"laya.d3.core.ComponentNode",$M);var $Q=$g.prototype;return $Q.addComponent=function($v){var $g,$Q=this._componentsMap.indexOf($v);if(-1===$Q)$g=[],this._componentsMap.push($v),this._typeComponentsIndices.push($g);else if($g=this._typeComponentsIndices[$Q],this._components[$g[0]].isSingleton)throw new Error("无法单实例创建"+$v+"组件，"+$v+"组件已存在！");var $d=$r.getInstance($v);return $g.push(this._components.length),this._components.push($d),$d instanceof laya.d3.component.Script&&this._scripts.push($d),$d._initialize(this),$d},$Q._removeComponent=function($v,$g){var $Q=this._typeComponentsIndices[$v],$d=$Q[$g],$r=this._components[$d];this._components.splice($d,1),$r instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($r),1),$Q.splice($g,1),0===$Q.length&&(this._typeComponentsIndices.splice($v,1),this._componentsMap.splice($v,1));for(var $k=0,$$=this._componentsMap.length;$k<$$;$k++)for(var $b=($Q=this._typeComponentsIndices[$k]).length-1;0<=$b;$b--){var $a=$Q[$b];if(!($d<$a))break;$Q[$b]=--$a}$r._destroy()},$Q.getComponentByType=function($v,$g){void 0===$g&&($g=0);var $Q=this._componentsMap.indexOf($v);return-1===$Q?null:this._components[this._typeComponentsIndices[$Q][$g]]},$Q.getComponentsByType=function($v,$g){var $Q=this._componentsMap.indexOf($v);if(-1!==$Q){var $d=this._typeComponentsIndices[$Q],$r=$d.length;$g.length=$r;for(var $k=0;$k<$r;$k++)$g[$k]=this._components[$d[$k]]}else $g.length=0},$Q.getComponentByIndex=function($v){return this._components[$v]},$Q.removeComponentByType=function($v,$g){void 0===$g&&($g=0);var $Q=this._componentsMap.indexOf($v);-1!==$Q&&this._removeComponent($Q,$g)},$Q.removeComponentsByType=function($v){var $g=this._componentsMap.indexOf($v);if(-1!==$g)for(var $Q=this._typeComponentsIndices[$g],$d=0,$r=$Q.length;$d<$r;$Q.length<$r?$r--:$d++)this._removeComponent($g,$d)},$Q.removeAllComponent=function(){for(var $v=0,$g=this._componentsMap.length;$v<$g;this._componentsMap.length<$g?$g--:$v++)this.removeComponentsByType(this._componentsMap[$v])},$Q._updateComponents=function($v){for(var $g=0,$Q=this._components.length;$g<$Q;$g++){var $d=this._components[$g];!$d.started&&($d._start($v),$d.started=!0),$d.enable&&$d._update($v)}},$Q._lateUpdateComponents=function($v){for(var $g=0;$g<this._components.length;$g++){var $Q=this._components[$g];!$Q.started&&($Q._start($v),$Q.started=!0),$Q.enable&&$Q._lateUpdate($v)}},$Q._preRenderUpdateComponents=function($v){for(var $g=0;$g<this._components.length;$g++){var $Q=this._components[$g];!$Q.started&&($Q._start($v),$Q.started=!0),$Q.enable&&$Q._preRenderUpdate($v)}},$Q._postRenderUpdateComponents=function($v){for(var $g=0;$g<this._components.length;$g++){var $Q=this._components[$g];!$Q.started&&($Q._start($v),$Q.started=!0),$Q.enable&&$Q._postRenderUpdate($v)}},$g}(),$Vg=function($d){function $v(){$v.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $Jg,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $bg(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$p($v,"laya.d3.core.material.BaseMaterial",$d);var $g=$v.prototype;return $h.imps($g,{"laya.d3.core.IClone":!0}),$g._addShaderDefine=function($v){this._shaderDefineValue|=$v},$g._removeShaderDefine=function($v){this._shaderDefineValue&=~$v},$g._addDisablePublicShaderDefine=function($v){this._disablePublicShaderDefine|=$v},$g._removeDisablePublicShaderDefine=function($v){this._disablePublicShaderDefine&=~$v},$g._setBuffer=function($v,$g){this._shaderValues.setValue($v,$g),this._values[$v]=$g},$g._getBuffer=function($v){return this._values[$v]},$g._setMatrix4x4=function($v,$g){this._shaderValues.setValue($v,$g?$g.elements:null),this._values[$v]=$g},$g._getMatrix4x4=function($v){return this._values[$v]},$g._setInt=function($v,$g){this._shaderValues.setValue($v,$g),this._values[$v]=$g},$g._getInt=function($v){return this._values[$v]},$g._setNumber=function($v,$g){this._shaderValues.setValue($v,$g),this._values[$v]=$g},$g._getNumber=function($v){return this._values[$v]},$g._setBool=function($v,$g){this._shaderValues.setValue($v,$g),this._values[$v]=$g},$g._getBool=function($v){return this._values[$v]},$g._setVector2=function($v,$g){this._shaderValues.setValue($v,$g?$g.elements:null),this._values[$v]=$g},$g._getVector2=function($v){return this._values[$v]},$g._setColor=function($v,$g){this._shaderValues.setValue($v,$g?$g.elements:null),this._values[$v]=$g},$g._getColor=function($v){return this._values[$v]},$g._setTexture=function($v,$g){var $Q=this._values[$v];this._values[$v]=$g,this._shaderValues.setValue($v,$g),0<this.referenceCount&&($Q&&$Q._removeReference(),$g&&$g._addReference())},$g._getTexture=function($v){return this._values[$v]},$g._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$g._getShader=function($v,$g,$Q){var $d=($v|$g)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($d,$Q,this._shaderDefineValue),this._shader},$g._setRenderStateBlendDepth=function(){var $v=$Z.mainContext;switch($f.setDepthMask($v,this.depthWrite),0===this.depthTest?$f.setDepthTest($v,!1):($f.setDepthTest($v,!0),$f.setDepthFunc($v,this.depthTest)),this.blend){case 0:$f.setBlend($v,!1);break;case 1:$f.setBlend($v,!0),$f.setBlendFunc($v,this.srcBlend,this.dstBlend);break;case 2:$f.setBlend($v,!0)}},$g._setRenderStateFrontFace=function($v,$g){var $Q=$Z.mainContext,$d=0;switch(this.cull){case 0:$f.setCullFace($Q,!1);break;case 1:$f.setCullFace($Q,!0),$d=$v?$g&&$g._isFrontFaceInvert?2305:2304:$g&&$g._isFrontFaceInvert?2304:2305,$f.setFrontFace($Q,$d);break;case 2:$f.setCullFace($Q,!0),$d=$v?$g&&$g._isFrontFaceInvert?2304:2305:$g&&$g._isFrontFaceInvert?2305:2304,$f.setFrontFace($Q,$d)}},$g.onAsynLoaded=function($v,$g,$Q){var $d=$g[0],$r=$g[1];switch($d.version){case"LAYAMATERIAL:01":var $k=0,$$=0,$b=$d.props;for(var $a in $b)switch($a){case"vectors":var $M=$b[$a];for($k=0,$$=$M.length;$k<$$;$k++){var $Y=$M[$k],$D=$Y.value;switch($D.length){case 2:this[$Y.name]=new $kg($D[0],$D[1]);break;case 3:this[$Y.name]=new $$g($D[0],$D[1],$D[2]);break;case 4:this[$Y.name]=new $bg($D[0],$D[1],$D[2],$D[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $J=$b[$a];for($k=0,$$=$J.length;$k<$$;$k++){var $p=$J[$k],$T=$p.path;$T&&(this[$p.name]=$C.getRes($r[$T]))}break;case"defines":var $t=$b[$a];for($k=0,$$=$t.length;$k<$$;$k++){var $q=this._shaderCompile.getMaterialDefineByName($t[$k]);this._addShaderDefine($q)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$a]=$b[$a];break;case"renderQueue":switch($b[$a]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$a]=$b[$a]}break;case"LAYAMATERIAL:02":for($a in $b=$d.props)switch($a){case"vectors":for($k=0,$$=($M=$b[$a]).length;$k<$$;$k++)switch(($D=($Y=$M[$k]).value).length){case 2:this[$Y.name]=new $kg($D[0],$D[1]);break;case 3:this[$Y.name]=new $$g($D[0],$D[1],$D[2]);break;case 4:this[$Y.name]=new $bg($D[0],$D[1],$D[2],$D[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($k=0,$$=($J=$b[$a]).length;$k<$$;$k++)($T=($p=$J[$k]).path)&&(this[$p.name]=$C.getRes($r[$T]));break;case"defines":for($k=0,$$=($t=$b[$a]).length;$k<$$;$k++)$q=this._shaderCompile.getMaterialDefineByName($t[$k]),this._addShaderDefine($q);break;default:this[$a]=$b[$a]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$g._addReference=function(){$d.prototype._addReference.call(this);for(var $v=0,$g=this._values.length;$v<$g;$v++){var $Q=this._values[$v];$Q&&$Q instanceof laya.d3.resource.BaseTexture&&$Q._addReference()}},$g._removeReference=function(){$d.prototype._removeReference.call(this);for(var $v=0,$g=this._values.length;$v<$g;$v++){var $Q=this._values[$v];$Q&&$Q instanceof laya.d3.resource.BaseTexture&&$Q._removeReference()}},$g.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$g.setShaderName=function($v){var $g=$wg.nameKey.getID($v);if(-1===$g)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$Fg._preCompileShader[$g]},$g.cloneTo=function($v){var $g=$v;$g.name=this.name,$g.cull=this.cull,$g.blend=this.blend,$g.srcBlend=this.srcBlend,$g.dstBlend=this.dstBlend,$g.srcBlendRGB=this.srcBlendRGB,$g.dstBlendRGB=this.dstBlendRGB,$g.srcBlendAlpha=this.srcBlendAlpha,$g.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($g.blendConstColor),$g.blendEquation=this.blendEquation,$g.blendEquationRGB=this.blendEquationRGB,$g.blendEquationAlpha=this.blendEquationAlpha,$g.depthTest=this.depthTest,$g.depthWrite=this.depthWrite,$g.renderQueue=this.renderQueue,$g._shader=this._shader,$g._disablePublicShaderDefine=this._disablePublicShaderDefine,$g._shaderDefineValue=this._shaderDefineValue;var $Q,$d=0,$r=$g._shaderValues;$g._shaderValues.data.length=this._shaderValues.data.length;var $k=this._values.length,$$=$g._values;for($d=0,$Q=$$.length=$k;$d<$Q;$d++){var $b=this._values[$d];if($b)if("number"==typeof $b)$$[$d]=$b,$r.data[$d]=$b;else if("number"==typeof $b&&Math.floor($b)==$b)$$[$d]=$b,$r.data[$d]=$b;else if("boolean"==typeof $b)$$[$d]=$b,$r.data[$d]=$b;else if($b instanceof laya.d3.math.Vector2){var $a=$$[$d]||($$[$d]=new $kg);$b.cloneTo($a),$r.data[$d]=$a.elements}else if($b instanceof laya.d3.math.Vector3){var $M=$$[$d]||($$[$d]=new $$g);$b.cloneTo($M),$r.data[$d]=$M.elements}else if($b instanceof laya.d3.math.Vector4){var $Y=$$[$d]||($$[$d]=new $bg);$b.cloneTo($Y),$r.data[$d]=$Y.elements}else if($b instanceof laya.d3.math.Matrix4x4){var $D=$$[$d]||($$[$d]=new $vg);$b.cloneTo($D),$r.data[$d]=$D.elements}else $b instanceof laya.d3.resource.BaseTexture&&($$[$d]=$b,$r.data[$d]=$b)}},$g.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$T(0,$g,"alphaTestValue",function(){return this._getNumber(0)},function($v){this._setNumber(0,$v)}),$T(0,$g,"alphaTest",function(){return this._alphaTest},function($v){(this._alphaTest=$v)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$v.__init__=function(){$v.SHADERDEFINE_ALPHATEST=$v.shaderDefines.registerDefine("ALPHATEST")},$v.RENDERQUEUE_OPAQUE=2e3,$v.RENDERQUEUE_ALPHATEST=2450,$v.RENDERQUEUE_TRANSPARENT=3e3,$v.CULL_NONE=0,$v.CULL_FRONT=1,$v.CULL_BACK=2,$v.BLEND_DISABLE=0,$v.BLEND_ENABLE_ALL=1,$v.BLEND_ENABLE_SEPERATE=2,$v.BLENDPARAM_ZERO=0,$v.BLENDPARAM_ONE=1,$v.BLENDPARAM_SRC_COLOR=768,$v.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$v.BLENDPARAM_DST_COLOR=774,$v.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$v.BLENDPARAM_SRC_ALPHA=770,$v.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$v.BLENDPARAM_DST_ALPHA=772,$v.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$v.BLENDPARAM_SRC_ALPHA_SATURATE=776,$v.BLENDEQUATION_ADD=0,$v.BLENDEQUATION_SUBTRACT=1,$v.BLENDEQUATION_REVERSE_SUBTRACT=2,$v.DEPTHTEST_OFF=0,$v.DEPTHTEST_NEVER=512,$v.DEPTHTEST_LESS=513,$v.DEPTHTEST_EQUAL=514,$v.DEPTHTEST_LEQUAL=515,$v.DEPTHTEST_GREATER=516,$v.DEPTHTEST_NOTEQUAL=517,$v.DEPTHTEST_GEQUAL=518,$v.DEPTHTEST_ALWAYS=519,$v.SHADERDEFINE_ALPHATEST=1,$v.ALPHATESTVALUE=0,$D($v,["shaderDefines",function(){return this.shaderDefines=new $Yg}]),$v}($q),$Zg=function($v){function $g(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$g.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$p($g,"laya.d3.resource.BaseTexture",$q);var $Q=$g.prototype;return $T(0,$Q,"width",function(){return this._width}),$T(0,$Q,"repeat",function(){return this._repeat},function($v){if(this._repeat!==$v&&(this._repeat=$v,this._source)){var $g=$Z.mainContext;$f.bindTexture($g,this._type,this._source),$A.isPOT(this._width,this._height)&&this._repeat?($g.texParameteri(this._type,10242,10497),$g.texParameteri(this._type,10243,10497)):($g.texParameteri(this._type,10242,33071),$g.texParameteri(this._type,10243,33071))}}),$T(0,$Q,"height",function(){return this._height}),$T(0,$Q,"magFifter",function(){return this._magFifter},function($v){(this._magFifter=$v)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($v)}),$T(0,$Q,"wrapModeV",function(){return this._wrapModeV}),$T(0,$Q,"size",function(){return this._size}),$T(0,$Q,"wrapModeU",function(){return this._wrapModeU}),$T(0,$Q,"mipmap",function(){return this._mipmap},function($v){this._mipmap=$v,this._mipmap!=$v&&this._conchTexture&&this._conchTexture.setMipMap($v)}),$T(0,$Q,"minFifter",function(){return this._minFifter},function($v){this._minFifter=$v,this._minFifter!=$v&&this._conchTexture&&this._conchTexture.setMinFifter($v)}),$T(0,$Q,"format",function(){return this._format}),$T(0,$Q,"source",function(){return this.activeResource(),this._source}),$T(0,$Q,"defaulteTexture",function(){return $Hg.grayTexture}),$g.WARPMODE_REPEAT=0,$g.WARPMODE_CLAMP=1,$g}(),$fg=function($v){function $g(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$g.__super.call(this),this._boundingBoxCorners=$d(8,null)}$p($g,"laya.d3.resource.models.BaseMesh",$q);var $Q=$g.prototype;return $Q._getPositions=function(){throw new Error("未Override,请重载该属性！")},$Q._generateBoundingObject=function(){this._boundingSphere=new $Ov(new $$g,0),$Ov.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $Iv(new $$g,new $$g),$Iv.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$Q.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$Q.getRenderElement=function($v){throw new Error("未Override,请重载该属性！")},$T(0,$Q,"subMeshCount",function(){return this._subMeshCount}),$T(0,$Q,"boundingBox",function(){return this._boundingBox}),$T(0,$Q,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$T(0,$Q,"boundingSphere",function(){return this._boundingSphere}),$g}(),$Xg=(function($v){function $g(){$g.__super.call(this)}$p($g,"laya.d3.component.Script",$sg);var $Q=$g.prototype;$Q.onTriggerEnter=function($v){},$Q.onTriggerExit=function($v){},$Q.onTriggerStay=function($v){},$T(0,$Q,"isSingleton",function(){return $g._isSingleton}),$g._isSingleton=!1}(),function($v){function $g($v){this._owner=null,this._sharedMesh=null,$g.__super.call(this),this._owner=$v}$p($g,"laya.d3.core.MeshFilter",$v);var $Q=$g.prototype;return $Q._sharedMeshLoaded=function(){this.event("loaded")},$Q._destroy=function(){$v.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$T(0,$Q,"sharedMesh",function(){return this._sharedMesh},function($v){var $g=this._sharedMesh;$g&&$g._removeReference(),(this._sharedMesh=$v)._addReference(),this.event("meshchanged",[this,$g,$v]),$v.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$T(0,$Q,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$T(0,$Q,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$T(0,$Q,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$T(0,$Q,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$g}($Ag)),$Ng=function($v){function $g($v){$g.__super.call(this,$v),$v.meshFilter.on("meshchanged",this,this._onMeshChanged)}$p($g,"laya.d3.core.MeshRender",$hg);var $Q=$g.prototype;return $Q._onMeshChanged=function($v,$g,$Q){$Q.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$Q.once("loaded",this,this._onMeshLoaed)},$Q._onMeshLoaed=function($v,$g){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$Q._calculateBoundingSphereByInitSphere=function($v){var $g=NaN,$Q=this._owner.transform,$d=$Q.scale.elements,$r=Math.abs($d[0]),$k=Math.abs($d[1]),$$=Math.abs($d[2]);$g=$k<=$r&&$$<=$r?$r:$$<=$k?$k:$$,$$g.transformCoordinate($v.center,$Q.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$v.radius*$g},$Q._calculateBoundBoxByInitCorners=function($v){for(var $g=this._owner.transform.worldMatrix,$Q=0;$Q<8;$Q++)$$g.transformCoordinate($v[$Q],$g,$hg._tempBoundBoxCorners[$Q]);$Iv.createfromPoints($hg._tempBoundBoxCorners,this._boundingBox)},$Q._calculateBoundingSphere=function(){var $v=this._owner.meshFilter.sharedMesh;null==$v||null==$v.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($v.boundingSphere)},$Q._calculateBoundingBox=function(){var $v=this._owner.meshFilter.sharedMesh;null==$v||null==$v.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($v.boundingBoxCorners)},$Q._renderUpdate=function($v){var $g=this._owner.transform;if($g){this._setShaderValueMatrix4x4(0,$g.worldMatrix);var $Q=this._owner.getProjectionViewWorldMatrix($v);this._setShaderValueMatrix4x4(1,$Q)}else this._setShaderValueMatrix4x4(0,$vg.DEFAULT),this._setShaderValueMatrix4x4(1,$v);return $Cg.debugMode&&this._renderRenderableBoundBox(),!0},$g}(),$ig=function($g){function $d(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$d.__super.call(this),this._renderState=new $U,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $Jg,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $gv,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $$g(.7,.7,.7),this.ambientColor=new $$g(.212,.227,.259),$Z.shaderHighPrecision&&this.addShaderDefine($Fg.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$p($d,"laya.d3.core.scene.Scene",$g);var $v=$d.prototype;return $h.imps($v,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$v._setUrl=function($v){this._url=$v},$v._getGroup=function(){return this._group},$v._setGroup=function($v){this._group=$v},$v._display=function(){$h.stage._scenes.push(this),$h.stage._scenes.sort($d._sortScenes);for(var $v=0,$g=this._childs.length;$v<$g;$v++){var $Q=this._childs[$v];$Q.active&&$Q._activeHierarchy()}},$v._unDisplay=function(){var $v=$h.stage._scenes;$v.splice($v.indexOf(this),1);for(var $g=0,$Q=this._childs.length;$g<$Q;$g++){var $d=this._childs[$g];$d.active&&$d._inActiveHierarchy()}},$v._addChild3D=function($v){$v.transform._onWorldTransform(),$v._setBelongScene(this),this.displayedInStage&&$v.active&&$v._activeHierarchy()},$v._removeChild3D=function($v){$v.transform.parent=null,this.displayedInStage&&$v.active&&$v._inActiveHierarchy(),$v._setUnBelongScene()},$v.initOctree=function($v,$g,$Q,$d,$r){void 0===$r&&($r=6),this.treeSize=new $$g($v,$g,$Q),this.treeLevel=$r,this.treeRoot=new $I(this,0),this.treeRoot.init($d,this.treeSize)},$v._prepareUpdateToRenderState=function($v,$g){$g.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$g.scene=this},$v._prepareSceneToRender=function($v){var $g=this._lights.length;if(0<$g)for(var $Q=0,$d=0;$d<$g&&!(this._lights[$d]._prepareToScene($v)&&++$Q>=this._enableLightCount);$d++);},$v._updateChilds=function($v){for(var $g=0,$Q=this._childs.length;$g<$Q;++$g)this._childs[$g]._update($v)},$v._preRenderScene=function($v,$g,$Q){var $d,$r=$g._viewMatrix,$k=$g._projectionMatrix,$$=$g._projectionViewMatrix,$b=0,$a=$g.camera;for($a.useOcclusionCulling?this.treeRoot?$Qv.renderObjectCullingOctree($Q,this,$a,$r,$k,$$):$Qv.renderObjectCulling($Q,this,$a,$r,$k,$$):$Qv.renderObjectCullingNoBoundFrustum(this,$a,$r,$k,$$),$b=0,$d=this._quenes.length;$b<$d;$b++)this._quenes[$b]&&this._quenes[$b]._preRender($g)},$v._clear=function($v,$g){var $Q=$g._viewport,$d=$g.camera,$r=$Q.x,$k=$d.renderTargetSize.height-$Q.y-$Q.height,$$=$Q.width,$b=$Q.height;$v.viewport($r,$k,$$,$b);var $a=256,$M=$d.renderTarget;switch($d.clearFlag){case 0:var $Y=$d.clearColor;if($Y){$v.enable(3089),$v.scissor($r,$k,$$,$b);var $D=$Y.elements;$v.clearColor($D[0],$D[1],$D[2],$D[3]),$a|=16384}if($M)switch($Y||($a=16384),$M.depthStencilFormat){case 33189:$a|=256;break;case 36168:$a|=1024;break;case 34041:$a|=256,$a|=1024}$v.clear($a),$Y&&$v.disable(3089);break;case 1:case 2:if($M)switch($a=16384,$M.depthStencilFormat){case 33189:$a|=256;break;case 36168:$a|=1024;break;case 34041:$a|=256,$a|=1024}$v.clear($a);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$v._renderScene=function($v,$g){var $Q,$d,$r=$g.camera,$k=0;for($k=0;$k<2;$k++)($d=this._quenes[$k])&&($r.renderTarget?$d._render($g,!0):$d._render($g,!1));if(1===$r.clearFlag){var $$=$r.sky;$$&&($f.setCullFace($v,!1),$f.setDepthFunc($v,515),$f.setDepthMask($v,!1),$$._render($g),$f.setDepthFunc($v,513),$f.setDepthMask($v,!0))}for($k=2,$Q=this._quenes.length;$k<$Q;$k++)($d=this._quenes[$k])&&($d._sortAlpha($g.camera.transform.position),$r.renderTarget?$d._render($g,!0):$d._render($g,!1))},$v._set3DRenderConfig=function($v){$v.disable(3042),$f._blend=!1,$v.blendFunc(770,771),$f._sFactor=770,$f._dFactor=771,$v.disable(2929),$f._depthTest=!1,$v.enable(2884),$f._cullFace=!0,$v.depthMask(1),$f._depthMask=!0,$v.frontFace(2304),$f._frontFace=2304},$v._set2DRenderConfig=function($v){$f.setBlend($v,!0),$f.setBlendFunc($v,1,771),$f.setDepthTest($v,!1),$f.setCullFace($v,!1),$f.setDepthMask($v,!0),$f.setFrontFace($v,2305),$v.viewport(0,0,$Y.width,$Y.height)},$v._parseCustomProps=function($v,$g,$Q,$d){var $r=$d.customProps.lightmaps,$k=$r.length,$$=this._lightmaps;$$.length=$k;for(var $b=0;$b<$k;$b++)$$[$b]=$C.getRes($g[$r[$b].replace(".exr",".png")]);this.setlightmaps($$);var $a=$d.customProps.ambientColor;$a&&(this.ambientColor=new $$g($a[0],$a[1],$a[2]));var $M=$d.customProps.fogColor;$M&&(this.fogColor=new $$g($M[0],$M[1],$M[2]))},$v._addLight=function($v){this._lights.indexOf($v)<0&&this._lights.push($v)},$v._removeLight=function($v){var $g=this._lights.indexOf($v);0<=$g&&this._lights.splice($g,1)},$v._updateScene=function(){var $v=this._renderState;this._prepareUpdateToRenderState($Z.mainContext,$v),this._updateComponents($v),this._updateChilds($v),this._lateUpdateComponents($v),this._time+=$v.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$v._updateSceneConch=function(){var $v=this._renderState;this._prepareUpdateToRenderState($Z.mainContext,$v),this._updateComponents($v),this._lateUpdateComponents($v),this._prepareSceneToRender($v);for(var $g=0,$Q=this._cameraPool.length;$g<$Q;$g++){var $d=this._cameraPool[$g];($v.camera=$d)._prepareCameraToRender()}},$v._preRenderShadow=function($v,$g,$Q,$d,$r){this.treeRoot?$Qv.renderShadowObjectCullingOctree(this,$g,$Q,$d,$r):$Qv.renderShadowObjectCulling(this,$g,$Q,$d,$r);for(var $k=0,$$=$Q.length;$k<$$;$k++)$Q[$k]&&$Q[$k]._preRender($v)},$v._renderShadowMap=function($v,$g,$Q){var $d=this.parallelSplitShadowMaps[0];$d._calcAllLightCameraInfo($Q);var $r,$k,$$,$b=$d.PSSMNum;if(this._preRenderShadow($g,$d._lightCulling,$d._shadowQuenes,$d._lightVPMatrix[0],$b),this.addShaderDefine($pg.SHADERDEFINE_CAST_SHADOW),1<$b)for(var $a=0;$a<$b;$a++)$r=$d.getRenderTarget($a+1),$d.beginRenderTarget($a+1),$v.clearColor(1,1,1,1),$v.clear(16640),$v.viewport(0,0,$r.width,$r.height),$g.camera=$$=$d.getLightCamera($a),$$._prepareCameraToRender(),$$._prepareCameraViewProject($$.viewMatrix,$$.projectionMatrix),$g._projectionViewMatrix=$d._lightVPMatrix[$a+1],($k=$d._shadowQuenes[$a])._preRender($g),$k._renderShadow($g,!1),$d.endRenderTarget($a+1);else $r=$d.getRenderTarget(1),$d.beginRenderTarget(1),$v.clearColor(1,1,1,1),$v.clear(16640),$v.viewport(0,0,$r.width,$r.height),$g.camera=$$=$d.getLightCamera(0),$$._prepareCameraToRender(),$$._prepareCameraViewProject($$.viewMatrix,$$.projectionMatrix),$g._projectionViewMatrix=$d._lightVPMatrix[0],($k=$d._shadowQuenes[0])._preRender($g),$k._renderShadow($g,!0),$d.endRenderTarget(1);this.removeShaderDefine($pg.SHADERDEFINE_CAST_SHADOW)},$v.addTreeNode=function($v){this.treeRoot.addTreeNode($v)},$v.removeTreeNode=function($v){this.treeSize&&$v._treeNode&&$v._treeNode.removeObject($v)},$v.setlightmaps=function($v){this._lightmaps=$v;for(var $g=0,$Q=this._renderableSprite3Ds.length;$g<$Q;$g++)this._renderableSprite3Ds[$g]._render._applyLightMapParams()},$v.getlightmaps=function(){return this._lightmaps},$v.addChildAt=function($v,$g){if(!($v instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($v&&$v.__className));if(!$v||this.destroyed||$v===this)return $v;if($v.zOrder&&this._set$P("hasZorder",!0),0<=$g&&$g<=this._childs.length){if($v._parent===this){var $Q=this.getChildIndex($v);this._childs.splice($Q,1),this._childs.splice($g,0,$v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,$g)),this._childChanged()}else $v.parent&&$v.parent.removeChild($v),this._childs===$M.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($g,0,$v),this.conchModel&&this.conchModel.addChildAt($v.conchModel,$g),($v.parent=this)._addChild3D($v);return $v}throw new Error("appendChildAt:The index is out of bounds")},$v.addChild=function($v){if(!($v instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$v||this.destroyed||$v===this)return $v;if($v.zOrder&&this._set$P("hasZorder",!0),$v._parent===this){var $g=this.getChildIndex($v);$g!==this._childs.length-1&&(this._childs.splice($g,1),this._childs.push($v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,this._childs.length-1)),this._childChanged())}else $v.parent&&$v.parent.removeChild($v),this._childs===$M.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($v),this.conchModel&&this.conchModel.addChildAt($v.conchModel,this._childs.length-1),($v.parent=this)._childChanged(),this._addChild3D($v);return $v},$v.removeChildAt=function($v){var $g=this.getChildAt($v);return $g&&(this._removeChild3D($g),this._childs.splice($v,1),this.conchModel&&this.conchModel.removeChild($g.conchModel),$g.parent=null),$g},$v.removeChildren=function($v,$g){if(void 0===$v&&($v=0),void 0===$g&&($g=2147483647),this._childs&&0<this._childs.length){var $Q=this._childs;if(0===$v&&$k<=$g){var $d=$Q;this._childs=$M.ARRAY_EMPTY}else $d=$Q.splice($v,$g-$v);for(var $r=0,$k=$d.length;$r<$k;$r++)this._removeChild3D($d[$r]),$d[$r].parent=null,this.conchModel&&this.conchModel.removeChild($d[$r].conchModel)}return this},$v.addFrustumCullingObject=function($v){this.treeRoot?this.addTreeNode($v):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($v):this._cullingRenders[this._cullingRendersLength]=$v,$v._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$v.removeFrustumCullingObject=function($v){if(this.treeRoot)this.removeTreeNode($v);else{this._cullingRendersLength--;var $g=$v._indexInSceneFrustumCullingObjects;if($g!==this._cullingRendersLength){var $Q=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$g]=$Q)._indexInSceneFrustumCullingObjects=$g,$v._indexInSceneFrustumCullingObjects=-1}}},$v.getRenderQueue=function($v){return $v<3e3?this._quenes[1]||(this._quenes[1]=new $z(this)):this._quenes[2]||(this._quenes[2]=new $z(this))},$v.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $z(this)},$v.addShaderDefine=function($v){this._shaderDefineValue|=$v},$v.removeShaderDefine=function($v){this._shaderDefineValue&=~$v},$v.addScript=function($v){return this._addComponent($v)},$v.getScriptByType=function($v,$g){return void 0===$g&&($g=0),this._getComponentByType($v,$g)},$v.getScriptsByType=function($v,$g){this._getComponentsByType($v,$g)},$v.getScriptByIndex=function($v){return this._getComponentByIndex($v)},$v.removeScriptByType=function($v,$g){void 0===$g&&($g=0),this._removeComponentByType($v,$g)},$v.removeScriptsByType=function($v){this._removeComponentByType($v)},$v.removeAllScript=function(){this._removeAllComponent()},$v.render=function($v,$g,$Q){($t._context.ctx._renderKey=0)<this._childs.length&&$v.addRenderObject(this)},$v.renderSubmit=function(){var $v=$Z.mainContext,$g=this._renderState;this._set3DRenderConfig($v),this._prepareSceneToRender(this._renderState);var $Q,$d=0,$r=0;if($Cg.debugMode||$I.debugMode)for($d=0,$r=this._cameraPool.length;$d<$r;$d++)$Q=this._cameraPool[$d],$Cg._debugPhasorSprite.begin(1,$Q),$Q.activeInHierarchy&&$Q._renderCamera($v,$g,this),$Cg._debugPhasorSprite.end();else for($d=0,$r=this._cameraPool.length;$d<$r;$d++)($Q=this._cameraPool[$d]).activeInHierarchy&&$Q._renderCamera($v,$g,this);return this._set2DRenderConfig($v),1},$v.onAsynLoaded=function($v,$g,$Q){var $d=$g[0];if("Scene"!==$d.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $r=$g[1];$qg._createNodeByJson(this,$d,this,$r),this.event("hierarchyloaded",[this]),this.__loaded=!0},$v.destroy=function($v){void 0===$v&&($v=!0),this.destroyed||($g.prototype.destroy.call(this,$v),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$C.clearRes(this.url),this.loaded||$Cg._cancelLoadByUrl(this.url))},$v.getRenderType=function(){return 0},$v.releaseRender=function(){},$v._addComponent=function($v){var $g,$Q=this._componentsMap.indexOf($v);if(-1===$Q)$g=[],this._componentsMap.push($v),this._typeComponentsIndices.push($g);else if($g=this._typeComponentsIndices[$Q],this._components[$g[0]].isSingleton)throw new Error("无法单实例创建"+$v+"组件，"+$v+"组件已存在！");var $d=$r.getInstance($v);$g.push(this._components.length),this._components.push($d);return $d._initialize(this),$d},$v._removeComponent=function($v,$g){var $Q=this._typeComponentsIndices[$v],$d=$Q[$g],$r=this._components[$d];this._components.splice($d,1),$Q.splice($g,1),0===$Q.length&&(this._typeComponentsIndices.splice($v,1),this._componentsMap.splice($v,1));for(var $k=0,$$=this._componentsMap.length;$k<$$;$k++)for(var $b=($Q=this._typeComponentsIndices[$k]).length-1;0<=$b;$b--){var $a=$Q[$b];if(!($d<$a))break;$Q[$b]=--$a}$r._destroy()},$v._getComponentByType=function($v,$g){void 0===$g&&($g=0);var $Q=this._componentsMap.indexOf($v);return-1===$Q?null:this._components[this._typeComponentsIndices[$Q][$g]]},$v._getComponentsByType=function($v,$g){var $Q=this._componentsMap.indexOf($v);if(-1!==$Q){var $d=this._typeComponentsIndices[$Q],$r=$d.length;$g.length=$r;for(var $k=0;$k<$r;$k++)$g[$k]=this._components[$d[$k]]}else $g.length=0},$v._getComponentByIndex=function($v){return this._components[$v]},$v._removeComponentByType=function($v,$g){void 0===$g&&($g=0);var $Q=this._componentsMap.indexOf($v);-1!==$Q&&this._removeComponent($Q,$g)},$v._removeComponentsByType=function($v){var $g=this._componentsMap.indexOf($v);if(-1!==$g)for(var $Q=this._typeComponentsIndices[$g],$d=0,$r=$Q.length;$d<$r;$Q.length<$r?$r--:$d++)this._removeComponent($g,$d)},$v._removeAllComponent=function(){for(var $v=0,$g=this._componentsMap.length;$v<$g;this._componentsMap.length<$g?$g--:$v++)this._removeComponentsByType(this._componentsMap[$v])},$v._updateComponents=function($v){for(var $g=0,$Q=this._components.length;$g<$Q;$g++){var $d=this._components[$g];!$d.started&&($d._start($v),$d.started=!0),$d.enable&&$d._update($v)}},$v._lateUpdateComponents=function($v){for(var $g=0;$g<this._components.length;$g++){var $Q=this._components[$g];!$Q.started&&($Q._start($v),$Q.started=!0),$Q.enable&&$Q._lateUpdate($v)}},$v._preRenderUpdateComponents=function($v){for(var $g=0;$g<this._components.length;$g++){var $Q=this._components[$g];!$Q.started&&($Q._start($v),$Q.started=!0),$Q.enable&&$Q._preRenderUpdate($v)}},$v._postRenderUpdateComponents=function($v){for(var $g=0;$g<this._components.length;$g++){var $Q=this._components[$g];!$Q.started&&($Q._start($v),$Q.started=!0),$Q.enable&&$Q._postRenderUpdate($v)}},$T(0,$v,"_loaded",null,function($v){this.__loaded=$v}),$T(0,$v,"fogColor",function(){return this._fogColor},function($v){this._fogColor=$v,this._shaderValues.setValue(0,$v.elements)}),$T(0,$v,"enableFog",function(){return this._enableFog},function($v){this._enableFog!==$v&&((this._enableFog=$v)?(this.addShaderDefine($Fg.SHADERDEFINE_FOG),this.removeShaderDefine($Fg.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($Fg.SHADERDEFINE_FOG))}),$T(0,$v,"url",function(){return this._url}),$T(0,$v,"loaded",function(){return this.__loaded}),$T(0,$v,"enableDepthFog",function(){return this._enableDepthFog},function($v){this._enableDepthFog!=$v&&((this._enableDepthFog=$v)?(this.addShaderDefine($Fg.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($Fg.SHADERDEFINE_FOG)):this.removeShaderDefine($Fg.SAHDERDEFINE_DEPTHFOG))}),$T(0,$v,"fogStart",function(){return this._fogStart},function($v){this._fogStart=$v,this._shaderValues.setValue(1,$v)}),$T(0,$v,"fogRange",function(){return this._fogRange},function($v){this._fogRange=$v,this._shaderValues.setValue(2,$v)}),$T(0,$v,"ambientColor",function(){return this._ambientColor},function($v){this._ambientColor=$v,this._shaderValues.setValue(21,$v.elements)}),$T(0,$v,"scene",function(){return this}),$T(0,$v,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$d._sortScenes=function($v,$g){if($v.parent!==$h.stage||$g.parent!==$h.stage)return $v.parent!==$h.stage&&$g.parent!==$h.stage?$d._sortScenes($v.parent,$g.parent):$v.parent===$h.stage?-1:1;var $Q=$h.stage._childs;return $Q.indexOf($v)-$Q.indexOf($g)},$d.load=function($v){return $h.loader.create($v,null,null,$d)},$d.FOGCOLOR=0,$d.FOGSTART=1,$d.FOGRANGE=2,$d.LIGHTDIRECTION=3,$d.LIGHTDIRCOLOR=4,$d.POINTLIGHTPOS=5,$d.POINTLIGHTRANGE=6,$d.POINTLIGHTATTENUATION=7,$d.POINTLIGHTCOLOR=8,$d.SPOTLIGHTPOS=9,$d.SPOTLIGHTDIRECTION=10,$d.SPOTLIGHTSPOT=11,$d.SPOTLIGHTRANGE=12,$d.SPOTLIGHTATTENUATION=13,$d.SPOTLIGHTCOLOR=14,$d.SHADOWDISTANCE=15,$d.SHADOWLIGHTVIEWPROJECT=16,$d.SHADOWMAPPCFOFFSET=17,$d.SHADOWMAPTEXTURE1=18,$d.SHADOWMAPTEXTURE2=19,$d.SHADOWMAPTEXTURE3=20,$d.AMBIENTCOLOR=21,$d.TIME=22,$d}($W),$xg=function($v){function $g($v){$g.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $vg,this._shaderValues=new $Jg,this._colliders=[],this._id=++$g._uniqueIDCounter,this._transform=new $Pg(this),this.name=$v||"Sprite3D-"+$g._nameNumberCounter++,this.layer=$N.currentCreationLayer,this.active=!0}$p($g,"laya.d3.core.Sprite3D",$Eg);var $Q=$g.prototype;return $h.imps($Q,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$Q._setUrl=function($v){this._url=$v},$Q._getGroup=function(){return this._group},$Q._setGroup=function($v){this._group=$v},$Q._addChild3D=function($v){$v.transform.parent=this.transform,this._hierarchyAnimator&&(!$v._hierarchyAnimator&&$v._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($v,!0,[$v.name])),this._scene&&($v._setBelongScene(this._scene),this._activeInHierarchy&&$v._active&&$v._activeHierarchy())},$Q._removeChild3D=function($v){$v.transform.parent=null,this._scene&&(this._activeInHierarchy&&$v._active&&$v._inActiveHierarchy(),$v._setUnBelongScene()),this._hierarchyAnimator&&($v._hierarchyAnimator==this._hierarchyAnimator&&$v._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($v,!1,[$v.name]))},$Q._parseBaseCustomProps=function($v){var $g=this.transform.localPosition;$v.translate?($g.fromArray($v.translate),$g.x*=100,$g.y*=100,$g.z*=100):$g.elements.fill(0),this.transform.localPosition=$g;var $Q=this.transform.localRotation;$v.rotation?$Q.fromArray($v.rotation):$Q.fromArray([0,0,0,-1]),this.transform.localRotation=$Q;var $d=this.transform.localScale;$v.scale?$d.fromArray($v.scale):$d.elements.fill(1),this.transform.localScale=$d;var $r=$v.layer;null!=$r&&(this.layer=$N.getLayerByNumber($r))},$Q._parseCustomComponent=function($v,$g,$Q){for(var $d in $Q){var $r=$Q[$d];switch($d){case"Animator":var $k=this.addComponent(Animator);if($r.avatarPath)$k.avatar=$C.getRes($g[$r.avatarPath]);else{var $$=$r.avatar;if($$){$k.avatar=$C.getRes($g[$$.path]);var $b=$$.linkSprites;$b&&$v.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$k,$b])}}for(var $a=$r.clipPaths,$M=$a.length,$Y=0;$Y<$M;$Y++)$k.addClip($C.getRes($g[$a[$Y]]));$k.clip=$C.getRes($g[$a[0]]);var $D=$r.playOnWake;void 0!==$D&&($k.playOnWake=$D);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $J=this.addComponent(SphereCollider);$J.isTrigger=$r.isTrigger;var $p=$J.center;$p.fromArray($r.center),$J.center=$p,$J.radius=$r.radius;break;case"BoxCollider":var $T=this.addComponent(BoxCollider);$T.isTrigger=$r.isTrigger,$T.center.fromArray($r.center);var $t=$T.size;$t.fromArray($r.size),$T.size=$t;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$Q._onRootNodeHierarchyLoaded=function($v,$g){for(var $Q in $g){for(var $d=this,$r=$g[$Q],$k=0,$$=$r.length;$k<$$;$k++){var $b=$r[$k];if(""===$b)break;if(!($d=$d.getChildByName($b)))break}$d&&$v.linkSprite3DToAvatarNode($Q,$d)}},$Q._setHierarchyAnimator=function($v,$g){this._changeHierarchyAnimator($v);for(var $Q=0,$d=this._childs.length;$Q<$d;$Q++){var $r=this._childs[$Q];$r._hierarchyAnimator==$g&&$r._setHierarchyAnimator($v,$g)}},$Q._clearHierarchyAnimator=function($v,$g){this._changeHierarchyAnimator($g);for(var $Q=0,$d=this._childs.length;$Q<$d;$Q++){var $r=this._childs[$Q];$r._hierarchyAnimator==$v&&$r._clearHierarchyAnimator($v,$g)}},$Q._getAnimatorToLinkSprite3D=function($v,$g,$Q){var $d=this.getComponentByType(Animator);if($d&&($d.avatar?$d.avatar._version||$v._setAnimatorToLinkAvatar($d,$g):$v._setAnimatorToLinkSprite3DNoAvatar($d,$g,$Q)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$Q.unshift(this._parent.name);var $r=this._parent;$r._hierarchyAnimator&&$r._getAnimatorToLinkSprite3D($v,$g,$Q)}},$Q._setAnimatorToLinkSprite3DNoAvatar=function($v,$g,$Q){var $d=0,$r=0;for($d=0,$r=$v.getClipCount();$d<$r;$d++)$v._handleSpriteOwnersBySprite($d,$g,$Q,this);for($d=0,$r=this._childs.length;$d<$r;$d++){var $k=this._childs[$d],$$=$Q.length;$Q.push($k.name),$k._setAnimatorToLinkSprite3DNoAvatar($v,$g,$Q),$Q.splice($$,1)}},$Q._changeHierarchyAnimator=function($v){this._hierarchyAnimator=$v},$Q._isLinkSpriteToAnimationNode=function($v,$g,$Q){var $d=$v._avatarNodes.indexOf($g),$r=$v._cacheSpriteToNodesMap;if($Q)this._transform.dummy=$g.transform,$v._cacheNodesToSpriteMap[$d]=$r.length,$r.push($d);else{this._transform.dummy=null;var $k=$v._cacheNodesToSpriteMap[$d];$v._cacheNodesToSpriteMap[$d]=null,$r.splice($k,1)}},$Q._setBelongScene=function($v){this._scene=$v;for(var $g=0,$Q=this._childs.length;$g<$Q;$g++)this._childs[$g]._setBelongScene($v)},$Q._setUnBelongScene=function(){this._scene=null;for(var $v=0,$g=this._childs.length;$v<$g;$v++)this._childs[$v]._setUnBelongScene()},$Q._activeHierarchy=function(){var $v=0,$g=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$v=0,$g=this._colliders.length;$v<$g;$v++)this._layer._addCollider(this._colliders[$v]);for(this.event("activeinhierarchychanged",!0),$v=0,$g=this._childs.length;$v<$g;$v++){var $Q=this._childs[$v];$Q._active&&$Q._activeHierarchy()}},$Q._inActiveHierarchy=function(){var $v=0,$g=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$v=0,$g=this._colliders.length;$v<$g;$v++){var $Q=this._colliders[$v];$Q._clearCollsionMap(),this._layer._removeCollider($Q)}for(this.event("activeinhierarchychanged",!1),$v=0,$g=this._childs.length;$v<$g;$v++){var $d=this._childs[$v];$d._active&&$d._inActiveHierarchy()}},$Q.addComponent=function($v){var $g,$Q=this._componentsMap.indexOf($v);if(-1===$Q)$g=[],this._componentsMap.push($v),this._typeComponentsIndices.push($g);else if($g=this._typeComponentsIndices[$Q],this._components[$g[0]].isSingleton)throw new Error("无法单实例创建"+$v+"组件，"+$v+"组件已存在！");var $d=$r.getInstance($v);return $g.push(this._components.length),this._components.push($d),$d instanceof laya.d3.component.Script&&this._scripts.push($d),$d._initialize(this),$d},$Q._removeComponent=function($v,$g){var $Q,$d=0,$r=this._typeComponentsIndices[$v],$k=$r[$g],$$=this._components[$k];for($$ instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($$),1),$r.splice($g,1),0===$r.length&&(this._typeComponentsIndices.splice($v,1),this._componentsMap.splice($v,1)),$d=0,$Q=this._componentsMap.length;$d<$Q;$d++)for(var $b=($r=this._typeComponentsIndices[$d]).length-1;0<=$b;$b--){var $a=$r[$b];if(!($k<$a))break;$r[$b]=--$a}$$._destroy()},$Q._clearSelfRenderObjects=function(){},$Q._addSelfRenderObjects=function(){},$Q._parseCustomProps=function($v,$g,$Q,$d){},$Q._updateChilds=function($v){var $g=this._childs.length;if(0!==$g)for(var $Q=0;$Q<$g;++$Q)this._childs[$Q]._update($v)},$Q._getSortID=function($v,$g){return 1e3*$g.id+$v._getVertexBuffer().vertexDeclaration.id},$Q._update=function($v){($v.owner=this)._activeInHierarchy&&(this._updateComponents($v),this._lateUpdateComponents($v),$F.spriteCount++,this._childs.length&&this._updateChilds($v))},$Q.getProjectionViewWorldMatrix=function($v){return $vg.multiply($v,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$Q.loadHierarchy=function($v){this.addChild(laya.d3.core.Sprite3D.load($v))},$Q.addChildAt=function($v,$g){if(!($v instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$v||this.destroyed||$v===this)return $v;if($v.zOrder&&this._set$P("hasZorder",!0),0<=$g&&$g<=this._childs.length){if($v._parent===this){var $Q=this.getChildIndex($v);this._childs.splice($Q,1),this._childs.splice($g,0,$v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,$g)),this._childChanged()}else $v.parent&&$v.parent.removeChild($v),this._childs===$M.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($g,0,$v),this.conchModel&&this.conchModel.addChildAt($v.conchModel,$g),($v.parent=this)._addChild3D($v);return $v}throw new Error("appendChildAt:The index is out of bounds")},$Q.addChild=function($v){if(!($v instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$v||this.destroyed||$v===this)return $v;if($v.zOrder&&this._set$P("hasZorder",!0),$v._parent===this){var $g=this.getChildIndex($v);$g!==this._childs.length-1&&(this._childs.splice($g,1),this._childs.push($v),this.conchModel&&(this.conchModel.removeChild($v.conchModel),this.conchModel.addChildAt($v.conchModel,this._childs.length-1)),this._childChanged())}else $v.parent&&$v.parent.removeChild($v),this._childs===$M.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($v),this.conchModel&&this.conchModel.addChildAt($v.conchModel,this._childs.length-1),($v.parent=this)._childChanged(),this._addChild3D($v);return $v},$Q.removeChildAt=function($v){var $g=this.getChildAt($v);return $g&&(this._removeChild3D($g),this._childs.splice($v,1),this.conchModel&&this.conchModel.removeChild($g.conchModel),$g.parent=null),$g},$Q.removeChildren=function($v,$g){if(void 0===$v&&($v=0),void 0===$g&&($g=2147483647),this._childs&&0<this._childs.length){var $Q=this._childs;if(0===$v&&$k<=$g){var $d=$Q;this._childs=$M.ARRAY_EMPTY}else $d=$Q.splice($v,$g-$v);for(var $r=0,$k=$d.length;$r<$k;$r++)this._removeChild3D($d[$r]),$d[$r].parent=null,this.conchModel&&this.conchModel.removeChild($d[$r].conchModel)}return this},$Q.onAsynLoaded=function($v,$g,$Q){var $d=$g[0];if("Sprite3D"!==$d.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $r=$g[1];$qg._createNodeByJson(this,$d,this,$r),this.event("hierarchyloaded",[this]),this.__loaded=!0},$Q.cloneTo=function($v){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $g=$v;$g.name=this.name,$g._destroyed=this._destroyed,$g.timer=this.timer,$g._$P=this._$P,$g.active=this._active;var $Q=$g.transform.localPosition;this.transform.localPosition.cloneTo($Q),$g.transform.localPosition=$Q;var $d=$g.transform.localRotation;this.transform.localRotation.cloneTo($d),$g.transform.localRotation=$d;var $r=$g.transform.localScale;this.transform.localScale.cloneTo($r),$g.transform.localScale=$r,$g.isStatic=this.isStatic;var $k=0,$$=0;for($k=0,$$=this._componentsMap.length;$k<$$;$k++){var $b=$g.addComponent(this._componentsMap[$k]);this._components[$k]._cloneTo($b)}for($k=0,$$=this._childs.length;$k<$$;$k++)$g.addChild(this._childs[$k].clone());var $a=$g.getComponentByType(Animator);if($a){var $M=$a._linkSpritesData;if($M)for(var $Y in $M){for(var $D=$M[$Y],$J=$g,$p=0,$T=$D.length;$p<$T&&($J=$J.getChildByName($D[$p]));$p++);if($J){var $t=$a._avatarNodeMap[$Y];$J._isLinkSpriteToAnimationNode($a,$t,!0)}}}},$Q.clone=function(){var $v=new this.constructor;return this.cloneTo($v),$v},$Q.destroy=function($v){if(void 0===$v&&($v=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$v);var $g,$Q=0;for($Q=0,$g=this._components.length;$Q<$g;$Q++)this._components[$Q]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$C.clearRes(this.url),this.loaded||$Cg._cancelLoadByUrl(this.url)}},$Q._handleSpriteToAvatar=function($v,$g){$v._avatarNodes;var $Q=$v._avatarNodeMap[this.name];$Q&&$Q.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($v,$Q,$g)},$Q._setAnimatorToLinkAvatar=function($v,$g){this._handleSpriteToAvatar($v,$g);for(var $Q=0,$d=this._childs.length;$Q<$d;$Q++){this._childs[$Q]._setAnimatorToLinkAvatar($v,$g)}},$T(0,$Q,"activeInHierarchy",function(){return this._activeInHierarchy}),$T(0,$Q,"_loaded",null,function($v){this.__loaded=$v}),$T(0,$Q,"active",function(){return this._active},function($v){this._active!==$v&&(this._active=$v,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($v?this._activeHierarchy():this._inActiveHierarchy()))}),$T(0,$Q,"componentsCount",function(){return this._components.length}),$T(0,$Q,"loaded",function(){return this.__loaded}),$T(0,$Q,"id",function(){return this._id}),$T(0,$Q,"url",function(){return this._url}),$T(0,$Q,"layer",function(){return this._layer},function($v){if(this._layer!==$v){if(!$v)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $g=0,$Q=this._colliders.length;if(this._layer)for($g=0;$g<$Q;$g++)this._layer._removeCollider(this._colliders[$g]);for($g=0;$g<$Q;$g++)$v._addCollider(this._colliders[$g])}this._layer=$v,this.event("layerchanged",$v)}}),$T(0,$Q,"scene",function(){return this._scene}),$T(0,$Q,"transform",function(){return this._transform}),$g.instantiate=function($v,$g,$Q,$d,$r){void 0===$Q&&($Q=!0);var $k=$v.clone();$g&&$g.addChild($k);var $$=$k.transform;if($Q){var $b=$$.worldMatrix;$v.transform.worldMatrix.cloneTo($b),$$.worldMatrix=$b}else $d&&($$.position=$d),$r&&($$.rotation=$r);return $k},$g.load=function($v){return $h.loader.create($v,null,null,$g)},$g.WORLDMATRIX=0,$g.MVPMATRIX=1,$g._uniqueIDCounter=0,$g._nameNumberCounter=0,$g}(),$wg=function($v){function $Y($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$Y.__super.call(this),!$v||!$g)throw"Shader Error";this._id=++$Y._count,this._vs=$v,this._ps=$g,this._attributeMap=$Q,this._sceneUniformMap=$d,this._cameraUniformMap=$r,this._spriteUniformMap=$k,this._materialUniformMap=$$,this._renderElementUniformMap=$b,this._precompile=$a,this._define=$M,this._precompile&&$Y.extCompileObj&&$Y.extCompileFunc?$Y.extCompileFunc.call($Y.extCompileObj,$v,$g,$M):this.recreateResource()}$p($Y,"laya.d3.shader.Shader3D",$Q);var $g=$Y.prototype;return $g.recreateResource=function(){$X.now();this._compile(),this.completeCreate(),this.memorySize=0},$g.disposeResource=function(){$Z.mainContext.deleteShader(this._vshader),$Z.mainContext.deleteShader(this._pshader),$Z.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$g._compile=function(){if(!$Z.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $v=[this._vs,this._ps],$g=$Z.mainContext;if(this._program=$g.createProgram(),this._vshader=$Y._createShader($g,$v[0],35633),this._pshader=$Y._createShader($g,$v[1],35632),$g.attachShader(this._program,this._vshader),$g.attachShader(this._program,this._pshader),$g.linkProgram(this._program),!$t.isConchApp&&$Fg.debugMode&&!$g.getProgramParameter(this._program,35714))throw $g.getProgramInfoLog(this._program);var $Q,$d=0,$r=0,$k=0;for($k=$t.isConchApp?$g.getProgramParameterEx(this._vs,this._ps,"",35721):$g.getProgramParameter(this._program,35721),$d=0;$d<$k;$d++){var $$=null;$Q={vartype:"attribute",ivartype:0,attrib:$$=$t.isConchApp?$g.getActiveAttribEx(this._vs,this._ps,"",$d):$g.getActiveAttrib(this._program,$d),location:$g.getAttribLocation(this._program,$$.name),name:$$.name,type:$$.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($Q)}var $b=0;for($b=$t.isConchApp?$g.getProgramParameterEx(this._vs,this._ps,"",35718):$g.getProgramParameter(this._program,35718),$d=0;$d<$b;$d++){var $a=null;$a=$t.isConchApp?$g.getActiveUniformEx(this._vs,this._ps,"",$d):$g.getActiveUniform(this._program,$d),0<($Q={vartype:"uniform",ivartype:1,attrib:$$,location:$g.getUniformLocation(this._program,$a.name),name:$a.name,type:$a.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($Q.name=$Q.name.substr(0,$Q.name.length-3),$Q.isArray=!0,$Q.location=$g.getUniformLocation(this._program,$Q.name)),this._uniformParams.push($Q)}for($d=0,$r=this._attributeParams.length;$d<$r;$d++)($Q=this._attributeParams[$d]).indexOfParams=$d,$Q.index=1,$Q.value=[$Q.location,null],$Q.codename=$Q.name,$Q.name=null!=this._attributeMap[$Q.codename]?this._attributeMap[$Q.codename]:$Q.codename,this._attributeParamsMap.push($Q.name),this._attributeParamsMap.push($Q),$Q._this=this,$Q.uploadedValue=[],$Q.fun=this._attribute;for($d=0,$r=this._uniformParams.length;$d<$r;$d++)switch(($Q=this._uniformParams[$d]).indexOfParams=$d,$Q.index=1,$Q.value=[$Q.location,null],$Q.codename=$Q.name,null!=this._sceneUniformMap[$Q.codename]?($Q.name=this._sceneUniformMap[$Q.codename],this._sceneUniformParamsMap.push($Q.name),this._sceneUniformParamsMap.push($Q)):null!=this._cameraUniformMap[$Q.codename]?($Q.name=this._cameraUniformMap[$Q.codename],this._cameraUniformParamsMap.push($Q.name),this._cameraUniformParamsMap.push($Q)):null!=this._spriteUniformMap[$Q.codename]?($Q.name=this._spriteUniformMap[$Q.codename],this._spriteUniformParamsMap.push($Q.name),this._spriteUniformParamsMap.push($Q)):null!=this._materialUniformMap[$Q.codename]?($Q.name=this._materialUniformMap[$Q.codename],this._materialUniformParamsMap.push($Q.name),this._materialUniformParamsMap.push($Q)):null!=this._renderElementUniformMap[$Q.codename]?($Q.name=this._renderElementUniformMap[$Q.codename],this._renderElementUniformParamsMap.push($Q.name),this._renderElementUniformParamsMap.push($Q)):console.log("Shader:can't find uinform name:"+$Q.codename+" in shader file."),$Q._this=this,$Q.uploadedValue=[],$Q.type){case 5124:$Q.fun=$Q.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$Q.fun=$Q.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$Q.fun=$Q.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$Q.fun=$Q.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$Q.fun=$Q.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$Q.fun=this._uniform_sampler2D;break;case 35680:$Q.fun=this._uniform_samplerCube;break;case 35676:$Q.fun=this._uniformMatrix4fv;break;case 35670:$Q.fun=this._uniform1i;break;case 35674:$Q.fun=this._uinformMatrix2fv;break;case 35675:$Q.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$g._attribute=function($v,$g){var $Q=$Z.mainContext,$d=$b._enableAtributes,$r=$v.location;return $d[$r]||$Q.enableVertexAttribArray($r),$Q.vertexAttribPointer($r,$g[0],$g[1],$g[2],$g[3],$g[4]),$d[$r]=$b._bindVertexBuffer,1},$g._uniform1f=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g?($Z.mainContext.uniform1f($v.location,$Q[0]=$g),1):0},$g._uniform1fv=function($v,$g){if($g.length<4){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Z.mainContext.uniform1fv($v.location,$g),$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3],1):0}return $Z.mainContext.uniform1fv($v.location,$g),1},$g._uniform_vec2=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]?($Z.mainContext.uniform2f($v.location,$Q[0]=$g[0],$Q[1]=$g[1]),1):0},$g._uniform_vec2v=function($v,$g){if($g.length<2){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Z.mainContext.uniform2fv($v.location,$g),$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3],1):0}return $Z.mainContext.uniform2fv($v.location,$g),1},$g._uniform_vec3=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]?($Z.mainContext.uniform3f($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2]),1):0},$g._uniform_vec3v=function($v,$g){return $Z.mainContext.uniform3fv($v.location,$g),1},$g._uniform_vec4=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Z.mainContext.uniform4f($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3]),1):0},$g._uniform_vec4v=function($v,$g){return $Z.mainContext.uniform4fv($v.location,$g),1},$g._uniformMatrix2fv=function($v,$g){return $Z.mainContext.uniformMatrix2fv($v.location,!1,$g),1},$g._uniformMatrix3fv=function($v,$g){return $Z.mainContext.uniformMatrix3fv($v.location,!1,$g),1},$g._uniformMatrix4fv=function($v,$g){return $Z.mainContext.uniformMatrix4fv($v.location,!1,$g),1},$g._uinformMatrix2fv=function($v,$g){return $Z.mainContext.uniformMatrix2fv($v.location,!1,$g),1},$g._uinformMatrix3fv=function($v,$g){return $Z.mainContext.uniformMatrix3fv($v.location,!1,$g),1},$g._uniform1i=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g?($Z.mainContext.uniform1i($v.location,$Q[0]=$g),1):0},$g._uniform1iv=function($v,$g){return $Z.mainContext.uniform1iv($v.location,$g),1},$g._uniform_ivec2=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]?($Z.mainContext.uniform2i($v.location,$Q[0]=$g[0],$Q[1]=$g[1]),1):0},$g._uniform_ivec2v=function($v,$g){return $Z.mainContext.uniform2iv($v.location,$g),1},$g._uniform_vec3i=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]?($Z.mainContext.uniform3i($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2]),1):0},$g._uniform_vec3vi=function($v,$g){return $Z.mainContext.uniform3iv($v.location,$g),1},$g._uniform_vec4i=function($v,$g){var $Q=$v.uploadedValue;return $Q[0]!==$g[0]||$Q[1]!==$g[1]||$Q[2]!==$g[2]||$Q[3]!==$g[3]?($Z.mainContext.uniform4i($v.location,$Q[0]=$g[0],$Q[1]=$g[1],$Q[2]=$g[2],$Q[3]=$g[3]),1):0},$g._uniform_vec4vi=function($v,$g){return $Z.mainContext.uniform4iv($v.location,$g),1},$g._uniform_sampler2D=function($v,$g){var $Q=$g.source||$g.defaulteTexture.source,$d=$Z.mainContext,$r=$v.uploadedValue;if(null!=$r[0])return $d.activeTexture($Y._TEXTURES[$r[0]]),$Q&&$f.bindTexture($d,3553,$Q),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $r[0]=this._curActTexIndex,$d.uniform1i($v.location,this._curActTexIndex),$d.activeTexture($Y._TEXTURES[this._curActTexIndex]),$Q&&$f.bindTexture($d,3553,$Q),this._curActTexIndex++,1},$g._uniform_samplerCube=function($v,$g){var $Q=$g.source||$g.defaulteTexture.source,$d=$Z.mainContext,$r=$v.uploadedValue;if(null!=$r[0])return $d.activeTexture($Y._TEXTURES[$r[0]]),$Q?$f.bindTexture($d,34067,$Q):$f.bindTexture($d,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $r[0]=this._curActTexIndex,$d.uniform1i($v.location,this._curActTexIndex),$d.activeTexture($Y._TEXTURES[this._curActTexIndex]),$Q?$f.bindTexture($d,34067,$Q):$f.bindTexture($d,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$g._noSetValue=function($v){console.log("no....:"+$v.name)},$g.bind=function(){return $Q.activeShader=this,($Q.bindShader=this).activeResource(),$f.UseProgram(this._program)},$g.uploadAttributes=function($v,$g){for(var $Q,$d,$r=0,$k=0,$$=this._attributeParamsMap.length;$k<$$;$k+=2)$d=this._attributeParamsMap[$k+1],null!=($Q=$v[this._attributeParamsMap[$k]])&&($g&&$g[$d.name]&&$g[$d.name].bind(),$r+=$d.fun.call(this,$d,$Q));$F.shaderCall+=$r},$g.uploadAttributesX=function($v,$g){for(var $Q,$d,$r=0,$k=0,$$=this._attributeParamsMap.length;$k<$$;$k+=2)$d=this._attributeParamsMap[$k+1],null!=($Q=$v[this._attributeParamsMap[$k]])&&($g._bind(),$r+=$d.fun.call(this,$d,$Q));$F.shaderCall+=$r},$g.uploadSceneUniforms=function($v){for(var $g,$Q,$d=0,$r=0,$k=this._sceneUniformParamsMap.length;$r<$k;$r+=2)$Q=this._sceneUniformParamsMap[$r+1],null!=($g=$v[this._sceneUniformParamsMap[$r]])&&($d+=$Q.fun.call(this,$Q,$g));$F.shaderCall+=$d},$g.uploadCameraUniforms=function($v){for(var $g,$Q,$d=0,$r=0,$k=this._cameraUniformParamsMap.length;$r<$k;$r+=2)$Q=this._cameraUniformParamsMap[$r+1],null!=($g=$v[this._cameraUniformParamsMap[$r]])&&($d+=$Q.fun.call(this,$Q,$g));$F.shaderCall+=$d},$g.uploadSpriteUniforms=function($v){for(var $g,$Q,$d=0,$r=0,$k=this._spriteUniformParamsMap.length;$r<$k;$r+=2)$Q=this._spriteUniformParamsMap[$r+1],null!=($g=$v[this._spriteUniformParamsMap[$r]])&&($d+=$Q.fun.call(this,$Q,$g));$F.shaderCall+=$d},$g.uploadMaterialUniforms=function($v){for(var $g,$Q,$d=0,$r=0,$k=this._materialUniformParamsMap.length;$r<$k;$r+=2)$Q=this._materialUniformParamsMap[$r+1],null!=($g=$v[this._materialUniformParamsMap[$r]])&&($d+=$Q.fun.call(this,$Q,$g));$F.shaderCall+=$d},$g.uploadRenderElementUniforms=function($v){for(var $g,$Q,$d=0,$r=0,$k=this._renderElementUniformParamsMap.length;$r<$k;$r+=2)$Q=this._renderElementUniformParamsMap[$r+1],null!=($g=$v[this._renderElementUniformParamsMap[$r]])&&($d+=$Q.fun.call(this,$Q,$g));$F.shaderCall+=$d},$Y.create=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){return new $Y($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M)},$Y.addInclude=function($v,$g){$s.addInclude($v,$g)},$Y._createShader=function($v,$g,$Q){var $d=$v.createShader($Q);if($v.shaderSource($d,$g),$v.compileShader($d),$Fg.debugMode&&!$v.getShaderParameter($d,35713))throw $v.getShaderInfoLog($d);return $d},$Y.PERIOD_RENDERELEMENT=0,$Y.PERIOD_MATERIAL=1,$Y.PERIOD_SPRITE=2,$Y.PERIOD_CAMERA=3,$Y.PERIOD_SCENE=4,$Y._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$Y._count=0,$Y._preCompile=!1,$Y.extCompileFunc=null,$Y.extCompileObj=null,$D($Y,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $l}]),$Y}(),$mg=function($b){function $a(){this._transformUV=null,$a.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $$g(.6,.6,.6)),this._setColor(10,new $$g(1,1,1)),this._setColor(11,new $bg(1,1,1,8)),this._setColor(12,new $$g(1,1,1)),this._setColor(7,new $bg(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $bg(1,1,0,0)),this.renderMode=1}$p($a,"laya.d3.core.material.StandardMaterial",$b);var $v=$a.prototype;return $v.disableLight=function(){this._addDisablePublicShaderDefine($Fg.SHADERDEFINE_POINTLIGHT|$Fg.SHADERDEFINE_SPOTLIGHT|$Fg.SHADERDEFINE_DIRECTIONLIGHT)},$v.disableFog=function(){this._addDisablePublicShaderDefine($Fg.SHADERDEFINE_FOG)},$v.onAsynLoaded=function($v,$g,$Q){var $d=$g[0];if($d.version)$b.prototype.onAsynLoaded.call(this,$v,$g,$Q);else{var $r=$g[1],$k=$d.props;for(var $$ in $k)this[$$]=$k[$$];$a._parseStandardMaterial($r,this,$d),this._endLoaded()}},$v.cloneTo=function($v){$b.prototype.cloneTo.call(this,$v);var $g=$v;this._transformUV&&($g._transformUV=this._transformUV.clone())},$T(0,$v,"ambientColor",function(){return this._getColor(9)},function($v){this._setColor(9,$v)}),$T(0,$v,"ambientTexture",function(){return this._getTexture(5)},function($v){$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$v)}),$T(0,$v,"renderMode",null,function($v){switch($v){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($a.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($v)}),$T(0,$v,"reflectColor",function(){return this._getColor(12)},function($v){this._setColor(12,$v)}),$T(0,$v,"tilingOffset",function(){return this._getColor(15)},function($v){if($v){var $g=$v.elements;1!=$g[0]||1!=$g[1]||0!=$g[2]||0!=$g[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$v)}),$T(0,$v,"albedo",function(){return this._getColor(7)},function($v){this._setColor(7,$v)}),$T(0,$v,"diffuseColor",function(){return this._getColor(10)},function($v){this._setColor(10,$v)}),$T(0,$v,"albedoColor",function(){return this._getColor(7)},function($v){this._setColor(7,$v)}),$T(0,$v,"specularColor",function(){return this._getColor(11)},function($v){this._setColor(11,$v)}),$T(0,$v,"diffuseTexture",function(){return this._getTexture(1)},function($v){$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$v)}),$T(0,$v,"normalTexture",function(){return this._getTexture(2)},function($v){$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$v)}),$T(0,$v,"specularTexture",function(){return this._getTexture(3)},function($v){$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$v)}),$T(0,$v,"emissiveTexture",function(){return this._getTexture(4)},function($v){$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$v)}),$T(0,$v,"reflectTexture",function(){return this._getTexture(6)},function($v){$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$v)}),$T(0,$v,"transformUV",function(){return this._transformUV},function($v){this._transformUV=$v,this._setMatrix4x4(13,$v.matrix),$v?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$v.matrix.elements,0)}),$a.__init__=function(){$a.SHADERDEFINE_DIFFUSEMAP=$a.shaderDefines.registerDefine("DIFFUSEMAP"),$a.SHADERDEFINE_NORMALMAP=$a.shaderDefines.registerDefine("NORMALMAP"),$a.SHADERDEFINE_SPECULARMAP=$a.shaderDefines.registerDefine("SPECULARMAP"),$a.SHADERDEFINE_EMISSIVEMAP=$a.shaderDefines.registerDefine("EMISSIVEMAP"),$a.SHADERDEFINE_AMBIENTMAP=$a.shaderDefines.registerDefine("AMBIENTMAP"),$a.SHADERDEFINE_REFLECTMAP=$a.shaderDefines.registerDefine("REFLECTMAP"),$a.SHADERDEFINE_UVTRANSFORM=$a.shaderDefines.registerDefine("UVTRANSFORM"),$a.SHADERDEFINE_TILINGOFFSET=$a.shaderDefines.registerDefine("TILINGOFFSET"),$a.SHADERDEFINE_ADDTIVEFOG=$a.shaderDefines.registerDefine("ADDTIVEFOG")},$a.load=function($v){return $h.loader.create($v,null,null,$a)},$a._parseStandardMaterial=function($v,$g,$Q){var $d=$Q.customProps,$r=$d.ambientColor;$g.ambientColor=new $$g($r[0],$r[1],$r[2]);var $k=$d.diffuseColor;$g.diffuseColor=new $$g($k[0],$k[1],$k[2]);var $$=$d.specularColor;$g.specularColor=new $bg($$[0],$$[1],$$[2],$$[3]);var $b=$d.reflectColor;$g.reflectColor=new $$g($b[0],$b[1],$b[2]);var $a=$d.albedoColor;$a&&($g.albedo=new $bg($a[0],$a[1],$a[2],$a[3]));var $M=$d.diffuseTexture.texture2D;$M&&($g.diffuseTexture=$C.getRes($v[$M]));var $Y=$d.normalTexture.texture2D;$Y&&($g.normalTexture=$C.getRes($v[$Y]));var $D=$d.specularTexture.texture2D;$D&&($g.specularTexture=$C.getRes($v[$D]));var $J=$d.emissiveTexture.texture2D;$J&&($g.emissiveTexture=$C.getRes($v[$J]));var $p=$d.ambientTexture.texture2D;$p&&($g.ambientTexture=$C.getRes($v[$p]));var $T=$d.reflectTexture.texture2D;$T&&($g.reflectTexture=$C.getRes($v[$T]))},$a.RENDERMODE_OPAQUE=1,$a.RENDERMODE_OPAQUEDOUBLEFACE=2,$a.RENDERMODE_CUTOUT=3,$a.RENDERMODE_CUTOUTDOUBLEFACE=4,$a.RENDERMODE_TRANSPARENT=13,$a.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$a.RENDERMODE_ADDTIVE=15,$a.RENDERMODE_ADDTIVEDOUBLEFACE=16,$a.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$a.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$a.RENDERMODE_DEPTHREAD_ADDTIVE=7,$a.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$a.RENDERMODE_NONDEPTH_TRANSPARENT=9,$a.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$a.RENDERMODE_NONDEPTH_ADDTIVE=11,$a.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$a.SHADERDEFINE_DIFFUSEMAP=0,$a.SHADERDEFINE_NORMALMAP=0,$a.SHADERDEFINE_SPECULARMAP=0,$a.SHADERDEFINE_EMISSIVEMAP=0,$a.SHADERDEFINE_AMBIENTMAP=0,$a.SHADERDEFINE_REFLECTMAP=0,$a.SHADERDEFINE_UVTRANSFORM=0,$a.SHADERDEFINE_TILINGOFFSET=0,$a.SHADERDEFINE_ADDTIVEFOG=0,$a.DIFFUSETEXTURE=1,$a.NORMALTEXTURE=2,$a.SPECULARTEXTURE=3,$a.EMISSIVETEXTURE=4,$a.AMBIENTTEXTURE=5,$a.REFLECTTEXTURE=6,$a.ALBEDO=7,$a.UVANIAGE=8,$a.MATERIALAMBIENT=9,$a.MATERIALDIFFUSE=10,$a.MATERIALSPECULAR=11,$a.MATERIALREFLECT=12,$a.UVMATRIX=13,$a.UVAGE=14,$a.TILINGOFFSET=15,$D($a,["defaultMaterial",function(){var $v=new $a;return $v.lock=!0,this.defaultMaterial=$v},"shaderDefines",function(){return this.shaderDefines=new $Yg($Vg.shaderDefines)}]),$a}($Vg),$Kg=function($v){function $$($v,$g,$Q,$d,$r){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$Q&&($Q=35044),void 0===$d&&($d=!1),$$.__super.call(this),this._indexType=$v,this._indexCount=$g,this._bufferUsage=$Q,this._bufferType=34963,this._canRead=$d;var $k;if("ushort"==$v)this._indexTypeByteCount=2;else{if("ubyte"!=$v)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$k=this._indexTypeByteCount*$g,this._byteLength=$k,this._bind(),$b._gl.bufferData(this._bufferType,$k,this._bufferUsage),this.uri=$r,$d?("ushort"==$v?this._buffer=new Uint16Array($g):"ubyte"==$v&&(this._buffer=new Uint8Array($g)),this.memorySize=2*$k):this.memorySize=$k}$p($$,"laya.d3.graphics.IndexBuffer3D",$v);var $g=$$.prototype;return $g.setData=function($v,$g,$Q,$d){void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=4294967295);var $r=0;if("ushort"==this._indexType?($r=2,0===$Q&&4294967295===$d||($v=new Uint16Array($v.buffer,$Q*$r,$d))):"ubyte"==this._indexType&&($r=1,0===$Q&&4294967295===$d||($v=new Uint8Array($v.buffer,$Q*$r,$d))),this._bind(),$b._gl.bufferSubData(this._bufferType,$g*$r,$v),this._canRead)if(0!==$g||0!==$Q||4294967295!==$d){var $k=this._buffer.length-$g;$k<$d&&($d=$k);for(var $$=0;$$<$d;$$++)this._buffer[$g+$$]=$v[$$]}else this._buffer=$v},$g.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$g.disposeResource=function(){$v.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$T(0,$g,"indexType",function(){return this._indexType}),$T(0,$g,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$T(0,$g,"indexCount",function(){return this._indexCount}),$T(0,$g,"canRead",function(){return this._canRead}),$$.INDEXTYPE_UBYTE="ubyte",$$.INDEXTYPE_USHORT="ushort",$$.create=function($v,$g,$Q,$d,$r){return void 0===$Q&&($Q=35044),void 0===$d&&($d=!1),new $$($v,$g,$Q,$d,$r)},$$}($b),$cg=function($k){function $$($v,$g,$Q,$d,$r){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$d&&($d=!1),$$.__super.call(this),this._vertexDeclaration=$v,this._vertexCount=$g,this._bufferUsage=$Q,this._bufferType=34962,this._canRead=$d,this.uri=$r,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$g,this._bind(),$b._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$d&&(this._buffer=new Float32Array(this._byteLength/4))}$p($$,"laya.d3.graphics.VertexBuffer3D",$k);var $v=$$.prototype;return $v.bindWithIndexBuffer=function($v){$v&&$v._bind(),this._bind()},$v.setData=function($v,$g,$Q,$d){if(void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=4294967295),0===$Q&&4294967295===$d||($v=new Float32Array($v.buffer,4*$Q,$d)),this._bind(),$b._gl.bufferSubData(this._bufferType,4*$g,$v),this._canRead)if(0!==$g||0!==$Q||4294967295!==$d){var $r=this._buffer.length-$g;$r<$d&&($d=$r);for(var $k=0;$k<$d;$k++)this._buffer[$g+$k]=$v[$k]}else this._buffer=$v},$v.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$v.disposeResource=function(){for(var $v=$Z.mainContext,$g=this._vertexDeclaration.getVertexElements(),$Q=$b._enableAtributes,$d=0,$r=$g.length;$d<$r;$d++)$Q[$d]===this._glBuffer&&($v.disableVertexAttribArray($d),$Q[$d]=null);$k.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$T(0,$v,"vertexDeclaration",function(){return this._vertexDeclaration}),$T(0,$v,"vertexCount",function(){return this._vertexCount}),$T(0,$v,"canRead",function(){return this._canRead}),$$.create=function($v,$g,$Q,$d,$r){return void 0===$Q&&($Q=35044),void 0===$d&&($d=!1),new $$($v,$g,$Q,$d,$r)},$$}($b),$Bg=function($v){function $s(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$s.__super.call(this),this._type=3553}$p($s,"laya.d3.resource.DataTexture2D",$Zg);var $g=$s.prototype;return $g.genDebugMipmaps=function(){var $v=[];return $v.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$v.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$v.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$v.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$v.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$v.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$v.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$v.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$v.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$v.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$v},$g._onTextureLoaded=function($v){},$g._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $v=$Z.mainContext,$g=this._source=$v.createTexture(),$Q=this._width,$d=this._height,$r=$f.curBindTexTarget,$k=$f.curBindTexValue,$$=!1;if($f.bindTexture($v,this._type,$g),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $b=0;$v.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $a=0;$a<this._mipmaps.length;$a++){if(this._mipmaps[$a].byteLength!=$M*$Y*4)throw"mipmap size error  level:"+$a;$v.texSubImage2D(this._type,0,$s.simLodRect[$b++],$s.simLodRect[$b++],$s.simLodRect[$b++],$s.simLodRect[$b++],6408,5121,new Uint8Array(this._mipmaps[$a]))}this.minFifter=9729,this.magFifter=9729}else{var $M=this._width,$Y=this._height;for($b=0,$v.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$a=0;$a<this._mipmaps.length;$a++){if(this._mipmaps[$a].byteLength!=$M*$Y*4)throw"mipmap size error  level:"+$a;$v.texImage2D(this._type,$a,6408,$M,$Y,0,6408,5121,new Uint8Array(this._mipmaps[$a])),($M/=2)<1&&($M=1),($Y/=2)<1&&($Y=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$v.pixelStorei($v.UNPACK_ALIGNMENT,1),$v.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $D=0,$J=!1,$p=!1;this._buffer.byteLength==4*$Q*$d?($D=6408,$J=!0):this._buffer.byteLength==3*$Q*$d?($D=6407,$p=!0):$D=this._format,$J||$p?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$p&&$v.pixelStorei($v.UNPACK_ALIGNMENT,1),$v.texImage2D(this._type,0,$D,$Q,$d,0,$D,5121,this._buffer)):$v&&$D==$v.ALPHA?($v.texImage2D(3553,0,$D,$Q,$d,0,$D,$v.UNSIGNED_BYTE,this._buffer),$$=!0):0!=$D&&($v.compressedTexImage2D(3553,0,$D,$Q,$d,0,this._buffer),$$=!0)}var $T=this._minFifter,$t=this._magFifter,$q=0==this._wrapModeU?10497:33071,$C=0==this._wrapModeV?10497:33071,$G=$A.isPOT($Q,$d);$G?(this._mipmap||this._mipmaps?-1!==$T||($T=9987):-1!==$T||($T=9729),-1!==$t||($t=9729),$v.texParameteri(this._type,10241,$T),$v.texParameteri(this._type,10240,$t),$v.texParameteri(this._type,10242,$q),$v.texParameteri(this._type,10243,$C),this._mipmap&&$v.generateMipmap(this._type)):(-1!==$T||($T=9729),-1!==$t||($t=9729),$v.texParameteri(this._type,10241,$T),$v.texParameteri(this._type,10240,$t),$v.texParameteri(this._type,10242,33071),$v.texParameteri(this._type,10243,33071)),$r&&$k&&$f.bindTexture($v,$r,$k),this.memorySize=$$?this._buffer.length:$G?$Q*$d*4*(1+1/3):$Q*$d*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$g.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$g.onAsynLoaded=function($v,$g,$Q){var $d;$Q&&($d=$Q[0].call(this,$g)),$d&&(this._width=$d.width,this._height=$d.height,this._buffer=$d.data),this._src=$v,this._size=new $tg(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$g.getPixels=function(){return new Uint8Array(this._buffer)},$g.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($Z.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$T(0,$g,"src",function(){return this._src}),$s.create=function($v,$g,$Q,$d,$r,$k,$$){if(void 0===$d&&($d=9729),void 0===$r&&($r=9729),void 0===$k&&($k=!0),!$v||$v.byteLength<$g*$Q*4)throw"DataTexture2D create error";var $b=new $s;return $b.uri=$$,$b._buffer=$v,$b._width=$g,$b._height=$Q,$b._mipmap=$k,$b._magFifter=$d,$b._minFifter=$r,$b._size=new $tg($b._width,$b._height),$b._conchTexture?alert("怎么给runtime传递datatexture数据"):$b.activeResource(),$b},$s.load=function($v,$g,$Q,$d,$r){if(void 0===$g&&($g=0),void 0===$Q&&($Q=0),void 0===$d&&($d=9729),void 0===$r&&($r=9729),"mipmaps"===$o.getFileExtension($v)){var $k=$h.loader.create($v,null,null,$s,[function($v){this._mipmaps=[];var $g=new Uint32Array($v);this._width=$g[0];var $Q=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$Q=1024),this._width!=$Q)throw"现在只支持512x256的环境贴图。当前的是"+$g[0];this._height=$g[1];for(var $d=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$r=this._height,$k=8;;){var $$=$d*$r*4;if($k+$$>$v.byteLength)throw"load mipmaps data size error ";var $b=new Uint8Array($v,$k,$$);if(this._mipmaps.push($b),$k+=$$,1==$d&&1==$r)break;($d/=2)<1&&($d=1),($r/=2)<1&&($r=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$k.simLodInfo=new Float32Array(40);for(var $$=0;$$<$k.simLodInfo.length;)$k.simLodInfo[$$]=($s.simLodRect[$$]+.5)/1024,$$++,$k.simLodInfo[$$]=($s.simLodRect[$$]+.5)/256,$$++,$k.simLodInfo[$$]=Math.max($s.simLodRect[$$]-1,.1)/1024,$$++,$k.simLodInfo[$$]=Math.max($s.simLodRect[$$]-1.5,.1)/256,$$++}return $k}if("number"==typeof $g)return $h.loader.create($v,null,null,$s,[function($v){return this._width=$g,this._height=$Q,this._buffer=$v,null}]);if("function"==typeof $g)return $h.loader.create($v,null,null,$s,[$g]);throw new Error("unknown params.")},$s.lodasatlas=!1,$D($s,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$s}(),$jg=function($v){function $g(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$g.__super.call(this)}$p($g,"laya.d3.resource.models.PrimitiveMesh",$fg);var $Q=$g.prototype;return $h.imps($Q,{"laya.d3.core.render.IRenderable":!0}),$Q._getVertexBuffer=function($v){return void 0===$v&&($v=0),0===$v?this._vertexBuffer:null},$Q._getVertexBuffers=function(){return null},$Q._getIndexBuffer=function(){return this._indexBuffer},$Q._getPositions=function(){var $v,$g=[],$Q=this._vertexBuffer.vertexDeclaration.getVertexElements(),$d=0;for($d=0;$d<$Q.length;$d++){var $r=$Q[$d];if("vector3"===$r.elementFormat&&0===$r.elementUsage){$v=$r;break}}var $k=this._vertexBuffer.getData();for($d=0;$d<$k.length;$d+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $$=$d+$v.offset/4,$b=new $$g($k[$$+0],$k[$$+1],$k[$$+2]);$g.push($b)}return $g},$Q.getRenderElement=function($v){return this},$Q.getRenderElementsCount=function(){return 1},$Q.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$Q._beforeRender=function($v){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$Q._render=function($v){$Z.mainContext.drawElements(4,this._numberIndices,5123,0),$F.drawCall++,$F.trianglesFaces+=this._numberIndices/3},$T(0,$Q,"_vertexBufferCount",function(){return 1}),$T(0,$Q,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$g}(),$Lg=function($v){function $g(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$g.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$p($g,"laya.d3.resource.models.Mesh",$fg);var $Q=$g.prototype;return $Q._getPositions=function(){var $v,$g,$Q,$d,$r,$k=[],$$=0,$b=0,$a=0;if(0!==this._vertexBuffers.length){var $M=this._vertexBuffers.length;for($$=0;$$<$M;$$++){for($Q=($v=this._vertexBuffers[$$]).vertexDeclaration.getVertexElements(),$b=0;$b<$Q.length;$b++)if("vector3"===($d=$Q[$b]).elementFormat&&0===$d.elementUsage){$g=$d;break}for($r=$v.getData(),$b=0;$b<$r.length;$b+=$v.vertexDeclaration.vertexStride/4)$a=$b+$g.offset/4,$k.push(new $$g($r[$a+0],$r[$a+1],$r[$a+2]))}}else{var $Y=this._subMeshes.length;for($$=0;$$<$Y;$$++){for($Q=($v=this._subMeshes[$$]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$b=0;$b<$Q.length;$b++)if("vector3"===($d=$Q[$b]).elementFormat&&0===$d.elementUsage){$g=$d;break}for($r=$v.getData(),$b=0;$b<$r.length;$b+=$v.vertexDeclaration.vertexStride/4)$a=$b+$g.offset/4,$k.push(new $$g($r[$a+0],$r[$a+1],$r[$a+2]))}}return $k},$Q._setSubMeshes=function($v){this._subMeshes=$v,this._subMeshCount=$v.length;for(var $g=0;$g<this._subMeshCount;$g++)$v[$g]._indexInMesh=$g;this._positions=this._getPositions(),this._generateBoundingObject()},$Q.onAsynLoaded=function($v,$g,$Q){var $d=$g[0],$r=$g[1];$Uv.read($d,this,this._materials,this._subMeshes,$r),this.completeCreate(),this._endLoaded()},$Q.getSubMesh=function($v){return this._subMeshes[$v]},$Q.getSubMeshCount=function(){return this._subMeshes.length},$Q.getRenderElementsCount=function(){return this._subMeshes.length},$Q.getRenderElement=function($v){return this._subMeshes[$v]},$Q.disposeResource=function(){for(var $v=0;$v<this._subMeshes.length;$v++)this._subMeshes[$v].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$T(0,$Q,"materials",function(){return this._materials.slice()}),$T(0,$Q,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$g.load=function($v){return $h.loader.create($v,null,null,$g)},$g}(),$Hg=(function($v){function $M($v,$g,$Q,$d,$r,$k,$$,$b,$a){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$Q&&($Q=6408),void 0===$d&&($d=5121),void 0===$r&&($r=33189),void 0===$k&&($k=!1),void 0===$$&&($$=!1),void 0===$b&&($b=-1),void 0===$a&&($a=-1),$M.__super.call(this),this._type=3553,this._width=$v,this._height=$g,this._size=new $tg($v,$g),this._surfaceFormat=$Q,this._surfaceType=$d,this._depthStencilFormat=$r,$t.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$k,this._repeat=$$,this._minFifter=$b,this._magFifter=$a,this.activeResource(),this._alreadyResolved=!0}$p($M,"laya.d3.resource.RenderTexture",$Zg);var $g=$M.prototype;$g.recreateResource=function(){var $v=$Z.mainContext;this._frameBuffer=$v.createFramebuffer(),this._source=$v.createTexture();var $g=$f.curBindTexTarget,$Q=$f.curBindTexValue;$f.bindTexture($v,this._type,this._source),$v.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $d=this._minFifter,$r=this._magFifter,$k=this._repeat?10497:33071;if($A.isPOT(this._width,this._height)?(this._mipmap?-1!==$d||($d=9987):-1!==$d||($d=9729),-1!==$r||($r=9729),$v.texParameteri(this._type,10241,$d),$v.texParameteri(this._type,10240,$r),$v.texParameteri(this._type,10242,$k),$v.texParameteri(this._type,10243,$k),this._mipmap&&$v.generateMipmap(this._type)):(-1!==$d||($d=9729),-1!==$r||($r=9729),$v.texParameteri(this._type,10241,$d),$v.texParameteri(this._type,10240,$r),$v.texParameteri(this._type,10242,33071),$v.texParameteri(this._type,10243,33071)),$g&&$Q&&$f.bindTexture($v,$g,$Q),$v.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$v.createRenderbuffer(),$v.bindRenderbuffer(36161,this._depthStencilBuffer),$v.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$v.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$v.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$v.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$v.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$v.framebufferTexture2D(36160,36064,3553,this._source,0),$v.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$g.start=function(){$Z.mainContext.bindFramebuffer(36160,this.frameBuffer),($M._currentRenderTarget=this)._alreadyResolved=!1},$g.end=function(){$Z.mainContext.bindFramebuffer(36160,null),$M._currentRenderTarget=null,this._alreadyResolved=!0},$g.getData=function($v,$g,$Q,$d){var $r=$Z.mainContext;if($r.bindFramebuffer(36160,this._frameBuffer),!(36053===$r.checkFramebufferStatus(36160)))return $r.bindFramebuffer(36160,null),null;var $k=new Uint8Array(this._width*this._height*4);return $r.readPixels($v,$g,$Q,$d,this._surfaceFormat,this._surfaceType,$k),$r.bindFramebuffer(36160,null),$k},$g.disposeResource=function(){if(this._frameBuffer){var $v=$Z.mainContext;$v.deleteTexture(this._source),$v.deleteFramebuffer(this._frameBuffer),$v.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$T(0,$g,"surfaceFormat",function(){return this._surfaceFormat}),$T(0,$g,"surfaceType",function(){return this._surfaceType}),$T(0,$g,"depthStencilFormat",function(){return this._depthStencilFormat}),$T(0,$g,"source",function(){return this._alreadyResolved?$h.superGet($Zg,this,"source"):null}),$T(0,$g,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$T(0,$g,"frameBuffer",function(){return this._frameBuffer}),$M._currentRenderTarget=null}(),function($v){function $g($v){this._color=null,this._pixels=null,$g.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $tg(this.width,this.height),this._color=$v,this._pixels=new Uint8Array([255*$v.x,255*$v.y,255*$v.z,255*$v.w]),this.uri="SolidColorTexture2D_"+this.id}$p($g,"laya.d3.resource.SolidColorTexture2D",$Zg);var $Q=$g.prototype;return $Q._createWebGlTexture=function(){var $v=$Z.mainContext,$g=this._source=$v.createTexture(),$Q=this._width,$d=this._height,$r=$f.curBindTexTarget,$k=$f.curBindTexValue;$f.bindTexture($v,this._type,$g),$v.texImage2D(this._type,0,6408,$Q,$d,0,6408,5121,this._pixels);var $$=this._minFifter,$b=this._magFifter,$a=this._repeat?10497:33071,$M=$A.isPOT($Q,$d);$M?(this._mipmap?-1!==$$||($$=9987):-1!==$$||($$=9729),-1!==$b||($b=9729),$v.texParameteri(this._type,10241,$$),$v.texParameteri(this._type,10240,$b),$v.texParameteri(this._type,10242,$a),$v.texParameteri(this._type,10243,$a),this._mipmap&&$v.generateMipmap(this._type)):(-1!==$$||($$=9729),-1!==$b||($b=9729),$v.texParameteri(this._type,10241,$$),$v.texParameteri(this._type,10240,$b),$v.texParameteri(this._type,10242,33071),$v.texParameteri(this._type,10243,33071)),$r&&$k&&$f.bindTexture($v,$r,$k),this.memorySize=$M?$Q*$d*4*(1+1/3):$Q*$d*4},$Q.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$Q.disposeResource=function(){this._source&&($Z.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$D($g,["magentaTexture",function(){var $v=new $g(new $bg(1,0,1,1));return $v.lock=!0,this.magentaTexture=$v},"grayTexture",function(){var $v=new $g(new $bg(.5,.5,.5,1));return $v.lock=!0,this.grayTexture=$v}]),$g}()),$ng=function($v){function $r($v,$g,$Q,$d){this._canRead=!1,this._image=null,this._pixels=null,void 0===$v&&($v=!1),void 0===$g&&($g=!0),void 0===$Q&&($Q=6408),void 0===$d&&($d=!0),$r.__super.call(this),this._type=3553,this._repeat=$g,this._canRead=$v,this._format=$Q,this._mipmap=$d}$p($r,"laya.d3.resource.Texture2D",$Zg);var $g=$r.prototype;return $g._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $v=$Z.mainContext,$g=this._source=$v.createTexture(),$Q=this._width,$d=this._height,$r=$f.curBindTexTarget,$k=$f.curBindTexValue;switch($f.bindTexture($v,this._type,$g),this._format){case 6407:case 6408:this._canRead?$v.texImage2D(this._type,0,this._format,$Q,$d,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$v.texImage2D(this._type,0,this._image._format,$Q,$d,0,this._image._format,5121,this._image.atlasSource):$v.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $Z.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$v.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $$=this._minFifter,$b=this._magFifter,$a=this._repeat?10497:33071,$M=0==this._wrapModeU?10497:33071,$Y=0==this._wrapModeV?10497:33071,$D=$A.isPOT($Q,$d);$D?(this._mipmap?-1!==$$||($$=9987):-1!==$$||($$=9729),-1!==$b||($b=9729),$v.texParameteri(this._type,10241,$$),$v.texParameteri(this._type,10240,$b),$v.texParameteri(this._type,10242,$a),$v.texParameteri(this._type,10243,$a),$v.texParameteri(this._type,10242,$M),$v.texParameteri(this._type,10243,$Y),this._mipmap&&$v.generateMipmap(this._type)):(-1!==$$||($$=9729),-1!==$b||($b=9729),$v.texParameteri(this._type,10241,$$),$v.texParameteri(this._type,10240,$b),$v.texParameteri(this._type,10242,33071),$v.texParameteri(this._type,10243,33071)),$r&&$k&&$f.bindTexture($v,$r,$k),this._image.onload=null,this._image=null,this.memorySize=$D?$Q*$d*4*(1+1/3):$Q*$d*4},$g.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$g.onAsynLoaded=function($v,$g,$Q){if($Q){var $d=$Q[0];void 0!==$d&&(this._canRead=$d);var $r=$Q[1];void 0!==$r&&(this._repeat=$r);var $k=$Q[2];void 0!==$k&&(this._format=$k);var $$=$Q[3];void 0!==$$&&(this._mipmap=$$);var $b=$Q.wrapModeU;void 0!==$b&&(this._wrapModeU=$b);var $a=$Q.wrapModeV;void 0!==$a&&(this._wrapModeV=$a)}switch(this._format){case 6407:case 6408:var $M=(this._image=$g).width,$Y=$g.height;this._width=$M,this._height=$Y,this._size=new $tg($M,$Y),this._canRead&&($t.isConchApp?$g instanceof $J.HTMLElement&&(this._pixels=new Uint8Array($g.getImageData(0,0,$M,$Y))):($X.canvas.size($M,$Y),$X.canvas.clear(),$X.context.drawImage($g,0,0,$M,$Y),this._pixels=new Uint8Array($X.context.getImageData(0,0,$M,$Y).data.buffer)));break;case $Z.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $D=new $P($g);$D.readUTFBytes(4),$D.readUTFBytes(2),$D.getInt16();$D.endian="bigEndian",this._width=$D.getInt16(),this._height=$D.getInt16(),this._size=new $tg(this._width,this._height);$D.getInt16(),$D.getInt16();this._image=new Uint8Array($g,$D.pos)}this.recreateResource(),this._endLoaded()},$g.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$g.disposeResource=function(){this._source&&($Z.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$T(0,$g,"_src",function(){return this.url}),$T(0,$g,"src",function(){return this.url}),$r.load=function($v){return $h.loader.create($v,null,null,$r)},$r}(),$yg=function($g){function $Q($v,$g){$Q.__super.call(this),void 0===$v&&($v=.3),void 0===$g&&($g=1e3),this._tempVector3=new $$g,this._position=new $$g,this._up=new $$g,this._forward=new $$g,this._right=new $$g,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$tg.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$v,this._farPlane=$g,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$h.stage.on("resize",this,this._onScreenSizeChanged)}$p($Q,"laya.d3.core.BaseCamera",$g);var $v=$Q.prototype;return $v._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $v=this.scene._cameraPool,$g=$v.length-1,$Q=0;$Q<$g;$Q++)if($v[$Q].renderingOrder>$v[$g].renderingOrder){var $d=$v[$Q];$v[$Q]=$v[$g],$v[$g]=$d}},$v._calculateProjectionMatrix=function(){},$v._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$v._prepareCameraToRender=function(){$N._currentCameraCullingMask=this.cullingMask;var $v=this._shaderValues;$v.setValue(0,this.transform.position.elements),$v.setValue(5,this.forward.elements),$v.setValue(6,this.up.elements)},$v._prepareCameraViewProject=function($v,$g){var $Q=this._shaderValues;$Q.setValue(1,$v.elements),$Q.setValue(2,$g.elements)},$v._renderCamera=function($v,$g,$Q){},$v.addLayer=function($v){29!==$v.number&&30!=$v.number&&(this.cullingMask=this.cullingMask|$v.mask)},$v.removeLayer=function($v){29!==$v.number&&30!=$v.number&&(this.cullingMask=this.cullingMask&~$v.mask)},$v.addAllLayers=function(){this.cullingMask=2147483647},$v.removeAllLayers=function(){this.cullingMask=0|$N.getLayerByNumber(29).mask|$N.getLayerByNumber(30).mask},$v.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$v.moveForward=function($v){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$v,this.transform.translate(this._tempVector3)},$v.moveRight=function($v){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$v,this.transform.translate(this._tempVector3)},$v.moveVertical=function($v){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$v,this.transform.translate(this._tempVector3,!1)},$v._addSelfRenderObjects=function(){var $v=this.scene._cameraPool,$g=$v.length;if(0<$g){for(var $Q=$g-1;0<=$Q;$Q--)if(this.renderingOrder<=$v[$Q].renderingOrder){$v.splice($Q+1,0,this);break}}else $v.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$v._clearSelfRenderObjects=function(){var $v=this.scene._cameraPool;$v.splice($v.indexOf(this),1)},$v.destroy=function($v){void 0===$v&&($v=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$h.stage.off("resize",this,this._onScreenSizeChanged),$g.prototype.destroy.call(this,$v)},$T(0,$v,"sky",function(){return this._sky},function($v){(this._sky=$v)._ownerCamera=this}),$T(0,$v,"forward",function(){var $v=this.transform.worldMatrix.elements,$g=this._forward.elements;return $g[0]=-$v[8],$g[1]=-$v[9],$g[2]=-$v[10],this._forward}),$T(0,$v,"position",function(){var $v=this.transform.worldMatrix.elements,$g=this._position.elements;return $g[0]=$v[12],$g[1]=$v[13],$g[2]=$v[14],this._position}),$T(0,$v,"renderTarget",function(){return this._renderTarget},function($v){null!=(this._renderTarget=$v)&&(this._renderTargetSize=$v.size)}),$T(0,$v,"up",function(){var $v=this.transform.worldMatrix.elements,$g=this._up.elements;return $g[0]=$v[4],$g[1]=$v[5],$g[2]=$v[6],this._up}),$T(0,$v,"right",function(){var $v=this.transform.worldMatrix.elements,$g=this._right.elements;return $g[0]=$v[0],$g[1]=$v[1],$g[2]=$v[2],this._right}),$T(0,$v,"renderTargetSize",function(){return this._renderTargetSize},function($v){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$v,this._calculateProjectionMatrix()}),$T(0,$v,"fieldOfView",function(){return this._fieldOfView},function($v){this._fieldOfView=$v,this._calculateProjectionMatrix()}),$T(0,$v,"nearPlane",function(){return this._nearPlane},function($v){this._nearPlane=$v,this._calculateProjectionMatrix()}),$T(0,$v,"farPlane",function(){return this._farPlane},function($v){this._farPlane=$v,this._calculateProjectionMatrix()}),$T(0,$v,"orthographic",function(){return this._orthographic},function($v){this._orthographic=$v,this._calculateProjectionMatrix()}),$T(0,$v,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($v){this._orthographicVerticalSize=$v,this._calculateProjectionMatrix()}),$T(0,$v,"renderingOrder",function(){return this._renderingOrder},function($v){this._renderingOrder=$v,this._sortCamerasByRenderingOrder()}),$Q.CAMERAPOS=0,$Q.VIEWMATRIX=1,$Q.PROJECTMATRIX=2,$Q.VPMATRIX=3,$Q.VPMATRIX_NO_TRANSLATE=4,$Q.CAMERADIRECTION=5,$Q.CAMERAUP=6,$Q.ENVIRONMENTDIFFUSE=7,$Q.ENVIRONMENTSPECULAR=8,$Q.SIMLODINFO=9,$Q.DIFFUSEIRRADMATR=10,$Q.DIFFUSEIRRADMATG=11,$Q.DIFFUSEIRRADMATB=12,$Q.HDREXPOSURE=13,$Q.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$Q.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$Q.CLEARFLAG_SOLIDCOLOR=0,$Q.CLEARFLAG_SKY=1,$Q.CLEARFLAG_DEPTHONLY=2,$Q.CLEARFLAG_NONE=3,$D($Q,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $vg(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $vg},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $vg}]),$Q}($xg),$eg=function($Q){function $g($v){this._render=null,this._geometryFilter=null,$g.__super.call(this,$v)}$p($g,"laya.d3.core.RenderableSprite3D",$Q);var $v=$g.prototype;return $v._addToInitStaticBatchManager=function(){},$v._setBelongScene=function($v){$Q.prototype._setBelongScene.call(this,$v),$v._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$v._setUnBelongScene=function(){var $v=this._scene._renderableSprite3Ds,$g=$v.indexOf(this);$v.splice($g,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$Q.prototype._setUnBelongScene.call(this)},$v._update=function($v){($v.owner=this)._activeInHierarchy&&(this._updateComponents($v),this._render._updateOctreeNode(),this._lateUpdateComponents($v),$F.spriteCount++,this._childs.length&&this._updateChilds($v))},$v.destroy=function($v){void 0===$v&&($v=!0),$Q.prototype.destroy.call(this,$v),this._render._destroy(),this._render=null},$g.__init__=function(){$g.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$g.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$g.SAHDERDEFINE_LIGHTMAP=$g.shaderDefines.registerDefine("LIGHTMAP")},$g.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$g.SAHDERDEFINE_LIGHTMAP=4,$g.LIGHTMAPSCALEOFFSET=2,$g.LIGHTMAP=3,$D($g,["shaderDefines",function(){return this.shaderDefines=new $Yg}]),$g}($xg),$Rg=(function($v){function $d($v,$g,$Q){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$v&&($v=1),void 0===$g&&($g=1),void 0===$Q&&($Q=1),$d.__super.call(this),this._long=$v,this._width=$g,this._height=$Q,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$p($d,"laya.d3.resource.models.BoxMesh",$jg);var $g=$d.prototype;$g.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $v=$Zv.vertexDeclaration,$g=($v.vertexStride,this._long/2),$Q=this._height/2,$d=this._width/2,$r=new Float32Array([-$g,$Q,-$d,0,1,0,0,0,$g,$Q,-$d,0,1,0,1,0,$g,$Q,$d,0,1,0,1,1,-$g,$Q,$d,0,1,0,0,1,-$g,-$Q,-$d,0,-1,0,0,1,$g,-$Q,-$d,0,-1,0,1,1,$g,-$Q,$d,0,-1,0,1,0,-$g,-$Q,$d,0,-1,0,0,0,-$g,$Q,-$d,-1,0,0,0,0,-$g,$Q,$d,-1,0,0,1,0,-$g,-$Q,$d,-1,0,0,1,1,-$g,-$Q,-$d,-1,0,0,0,1,$g,$Q,-$d,1,0,0,1,0,$g,$Q,$d,1,0,0,0,0,$g,-$Q,$d,1,0,0,0,1,$g,-$Q,-$d,1,0,0,1,1,-$g,$Q,$d,0,0,1,0,0,$g,$Q,$d,0,0,1,1,0,$g,-$Q,$d,0,0,1,1,1,-$g,-$Q,$d,0,0,1,0,1,-$g,$Q,-$d,0,0,-1,1,0,$g,$Q,-$d,0,0,-1,0,0,$g,-$Q,-$d,0,0,-1,0,1,-$g,-$Q,-$d,0,0,-1,1,1]),$k=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $cg($v,this._numberVertices,35044,!0),this._indexBuffer=new $Kg("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($r),this._indexBuffer.setData($k),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$T(0,$g,"long",function(){return this._long},function($v){this._long!==$v&&(this._long=$v,this.releaseResource(),this.activeResource())}),$T(0,$g,"width",function(){return this._width},function($v){this._width!==$v&&(this._width=$v,this.releaseResource(),this.activeResource())}),$T(0,$g,"height",function(){return this._height},function($v){this._height!==$v&&(this._height=$v,this.releaseResource(),this.activeResource())})}(),function($v){function $r($v,$g,$Q,$d){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$v&&($v=10),void 0===$g&&($g=10),void 0===$Q&&($Q=10),void 0===$d&&($d=10),$r.__super.call(this),this._long=$v,this._width=$g,this._stacks=$Q,this._slices=$d,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$p($r,"laya.d3.resource.models.PlaneMesh",$jg);var $g=$r.prototype;$g.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $v=new Uint16Array(this._numberIndices),$g=$Zv.vertexDeclaration,$Q=$g.vertexStride/4,$d=new Float32Array(this._numberVertices*$Q),$r=this._long/2,$k=this._width/2,$$=this._long/this._stacks,$b=this._width/this._slices,$a=0,$M=0;$M<=this._slices;$M++)for(var $Y=0;$Y<=this._stacks;$Y++)$d[$a++]=$Y*$$-$r,$d[$a++]=0,$d[$a++]=$M*$b-$k,$d[$a++]=0,$d[$a++]=1,$d[$a++]=0,$d[$a++]=1*$Y/this._stacks,$d[$a++]=1*$M/this._slices;var $D=0;for($M=0;$M<this._slices;$M++)for($Y=0;$Y<this._stacks;$Y++)$v[$D++]=($M+1)*(this._stacks+1)+$Y,$v[$D++]=$M*(this._stacks+1)+$Y,$v[$D++]=($M+1)*(this._stacks+1)+$Y+1,$v[$D++]=$M*(this._stacks+1)+$Y,$v[$D++]=$M*(this._stacks+1)+$Y+1,$v[$D++]=($M+1)*(this._stacks+1)+$Y+1;this._vertexBuffer=new $cg($g,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $Kg("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($d),this._indexBuffer.setData($v),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$T(0,$g,"long",function(){return this._long},function($v){this._long!==$v&&(this._long=$v,this.releaseResource(),this.activeResource())}),$T(0,$g,"width",function(){return this._width},function($v){this._width!==$v&&(this._width=$v,this.releaseResource(),this.activeResource())}),$T(0,$g,"stacks",function(){return this._stacks},function($v){this._stacks!==$v&&(this._stacks=$v,this.releaseResource(),this.activeResource())}),$T(0,$g,"slices",function(){return this._slices},function($v){this._slices!==$v&&(this._slices=$v,this.releaseResource(),this.activeResource())})}(),function($v){function $$($v,$g,$Q){void 0===$v&&($v=0),void 0===$g&&($g=.3),void 0===$Q&&($Q=1e3),this._viewMatrix=new $vg,this._projectionMatrix=new $vg,this._projectionViewMatrix=new $vg,this._viewport=new $ag(0,0,0,0),this._normalizedViewport=new $ag(0,0,1,1),this._aspectRatio=$v,this._boundFrustumUpdate=!0,this._boundFrustum=new $Sv($vg.DEFAULT),$$.__super.call(this,$g,$Q),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$p($$,"laya.d3.core.Camera",$yg);var $g=$$.prototype;return $g._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$g._parseCustomProps=function($v,$g,$Q,$d){var $r=$Q.clearColor;this.clearColor=new $bg($r[0],$r[1],$r[2],$r[3]);var $k=$Q.viewport;this.normalizedViewport=new $ag($k[0],$k[1],$k[2],$k[3])},$g._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $v=this.orthographicVerticalSize*this.aspectRatio*.5,$g=.5*this.orthographicVerticalSize;$vg.createOrthoOffCenterRH(-$v,$v,-$g,$g,this.nearPlane,this.farPlane,this._projectionMatrix)}else $vg.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$g._update=function($v){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$v)},$g._renderCamera=function($v,$g,$Q){var $d,$r;$Q.parallelSplitShadowMaps[0]&&$Q._renderShadowMap($v,$g,this),($g.camera=this)._prepareCameraToRender(),$Q._preRenderUpdateComponents($g),$d=$g._viewMatrix=this.viewMatrix;var $k=this._renderTarget;$k?($k.start(),$vg.multiply($yg._invertYScaleMatrix,this._projectionMatrix,$yg._invertYProjectionMatrix),$vg.multiply($yg._invertYScaleMatrix,this.projectionViewMatrix,$yg._invertYProjectionViewMatrix),$r=$g._projectionMatrix=$yg._invertYProjectionMatrix,$g._projectionViewMatrix=$yg._invertYProjectionViewMatrix):($r=$g._projectionMatrix=this._projectionMatrix,$g._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($d,$r),$g._viewport=this.viewport,$Q._preRenderScene($v,$g,this.boundFrustum),$Q._clear($v,$g),$Q._renderScene($v,$g),$Q._postRenderUpdateComponents($g),$k&&$k.end()},$g.viewportPointToRay=function($v,$g){$Tg.calculateCursorRay($v,this.viewport,this._projectionMatrix,this.viewMatrix,null,$g)},$g.normalizedViewportPointToRay=function($v,$g){var $Q=$$._tempVector20,$d=this.viewport,$r=$v.elements,$k=$Q.elements;$k[0]=$r[0]*$d.width,$k[1]=$r[1]*$d.height,$Tg.calculateCursorRay($Q,this.viewport,this._projectionMatrix,this.viewMatrix,null,$g)},$g.worldToViewportPoint=function($v,$g){$vg.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($v,this._projectionViewMatrix,$g);var $Q=$g.elements;$Q[0]=$Q[0]/$h.stage.clientScaleX,$Q[1]=$Q[1]/$h.stage.clientScaleY},$g.worldToNormalizedViewportPoint=function($v,$g){$vg.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($v,this._projectionViewMatrix,$g);var $Q=$g.elements;$Q[0]=$Q[0]/$h.stage.clientScaleX,$Q[1]=$Q[1]/$h.stage.clientScaleY},$g.convertScreenCoordToOrthographicCoord=function($v,$g){if(this._orthographic){var $Q=$U.clientWidth,$d=$U.clientHeight,$r=this.orthographicVerticalSize*this.aspectRatio/$Q,$k=this.orthographicVerticalSize/$d,$$=$v.elements,$b=$g.elements;return $b[0]=(-$Q/2+$$[0])*$r,$b[1]=($d/2-$$[1])*$k,$b[2]=(this.nearPlane-this.farPlane)*($$[2]+1)/2-this.nearPlane,$$g.transformCoordinate($g,this.transform.worldMatrix,$g),!0}return!1},$T(0,$g,"projectionViewMatrix",function(){return $vg.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$T(0,$g,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $v=this.viewport;return $v.width/$v.height},function($v){if($v<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$v,this._calculateProjectionMatrix()}),$T(0,$g,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$T(0,$g,"needViewport",function(){var $v=this.normalizedViewport;return 0===$v.x&&0===$v.y&&1===$v.width&&1===$v.height}),$T(0,$g,"viewport",function(){if(this._viewportExpressedInClipSpace){var $v=this._normalizedViewport,$g=this.renderTargetSize,$Q=$g.width,$d=$g.height;this._viewport.x=$v.x*$Q,this._viewport.y=$v.y*$d,this._viewport.width=$v.width*$Q,this._viewport.height=$v.height*$d}return this._viewport},function($v){if(null!=this.renderTarget&&($v.x<0||$v.y<0||0==$v.width||0==$v.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$v,this._calculateProjectionMatrix()}),$T(0,$g,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $v=this._viewport,$g=this.renderTargetSize,$Q=$g.width,$d=$g.height;this._normalizedViewport.x=$v.x/$Q,this._normalizedViewport.y=$v.y/$d,this._normalizedViewport.width=$v.width/$Q,this._normalizedViewport.height=$v.height/$d}return this._normalizedViewport},function($v){$v.x<0&&($v.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$v.y<0&&($v.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$v.x+$v.width&&($v.width=1-$v.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$v.y+$v.height&&($v.height=1-$v.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$v,this._calculateProjectionMatrix()}),$T(0,$g,"projectionMatrix",function(){return this._projectionMatrix},function($v){this._projectionMatrix=$v,this._useUserProjectionMatrix=!0}),$T(0,$g,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$D($$,["_tempVector20",function(){return this._tempVector20=new $kg}]),$$}()),$zg=function($Q){function $d($v,$g){$d.__super.call(this,$g),this._geometryFilter=new $Xg(this),this._render=new $Ng(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$v&&(this._geometryFilter.sharedMesh=$v)instanceof laya.d3.resource.models.Mesh&&($v.loaded?this._render.sharedMaterials=$v.materials:$v.once("loaded",this,this._applyMeshMaterials))}$p($d,"laya.d3.core.MeshSprite3D",$Q);var $v=$d.prototype;return $v._changeRenderObjectByMesh=function($v){var $g=this._render._renderElements,$Q=$g[$v];$Q||($Q=$g[$v]=new $Wg),$Q._render=this._render;var $d=this._render.sharedMaterials[$v];$d||($d=$mg.defaultMaterial);var $r=this._geometryFilter.sharedMesh.getRenderElement($v);return $Q._mainSortID=this._getSortID($r,$d),$Q._sprite3D=this,$Q.renderObj=$r,$Q._material=$d,$Q},$v._changeRenderObjectByMaterial=function($v,$g){var $Q=this._render._renderElements[$v];$g||($g=$mg.defaultMaterial);var $d=this._geometryFilter.sharedMesh.getRenderElement($v);return $Q._mainSortID=this._getSortID($d,$g),$Q._sprite3D=this,$Q.renderObj=$d,$Q._material=$g,$Q},$v._changeRenderObjectsByMesh=function(){var $v=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$v;for(var $g=0;$g<$v;$g++)this._changeRenderObjectByMesh($g)},$v._onMeshChanged=function($v){var $g=$v.sharedMesh;$g.loaded?this._changeRenderObjectsByMesh():$g.once("loaded",this,this._onMeshLoaded)},$v._onMeshLoaded=function($v){$v===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$v._onMaterialChanged=function($v,$g,$Q){$g<this._render._renderElements.length&&this._changeRenderObjectByMaterial($g,$Q)},$v._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$v._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$v._parseCustomProps=function($v,$g,$Q,$d){var $r=this.meshRender,$k=$Q.lightmapIndex;null!=$k&&($r.lightmapIndex=$k);var $$,$b,$a=$Q.lightmapScaleOffset;if($a&&($r.lightmapScaleOffset=new $bg($a[0],$a[1],$a[2],$a[3])),$d.instanceParams)($$=$d.instanceParams.loadPath)&&($b=$C.getRes($g[$$]),(this.meshFilter.sharedMesh=$b).loaded?$r.sharedMaterials=$b.materials:$b.once("loaded",this,this._applyMeshMaterials));else{($$=$Q.meshPath)&&($b=$C.getRes($g[$$]),this.meshFilter.sharedMesh=$b);var $M=$Q.materials;if($M){var $Y=$r.sharedMaterials,$D=$M.length;$Y.length=$D;for(var $J=0;$J<$D;$J++)$Y[$J]=$C.getRes($g[$M[$J].path]);$r.sharedMaterials=$Y}}},$v._applyMeshMaterials=function($v){for(var $g=this._render.sharedMaterials,$Q=$v.materials,$d=0,$r=$Q.length;$d<$r;$d++)$g[$d]||($g[$d]=$Q[$d]);this._render.sharedMaterials=$g},$v._addToInitStaticBatchManager=function(){$d._staticBatchManager._addInitBatchSprite(this)},$v.cloneTo=function($v){var $g=$v;$g._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $Q=this._render,$d=$g._render;$d.enable=$Q.enable,$d.sharedMaterials=$Q.sharedMaterials,$d.castShadow=$Q.castShadow;var $r=$Q.lightmapScaleOffset;$r&&($d.lightmapScaleOffset=$r.clone()),$d.lightmapIndex=$Q.lightmapIndex,$d.receiveShadow=$Q.receiveShadow,$d.sortingFudge=$Q.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$v)},$v.destroy=function($v){if(void 0===$v&&($v=!0),!this.destroyed){var $g=this.meshFilter.sharedMesh;null!=$g&&($g.loaded||$g.off("loaded",this,this._applyMeshMaterials)),$Q.prototype.destroy.call(this,$v),this._geometryFilter._destroy()}},$T(0,$v,"meshFilter",function(){return this._geometryFilter}),$T(0,$v,"meshRender",function(){return this._render}),$d.__init__=function(){$dv._staticBatchManagers.push($d._staticBatchManager)},$d.load=function($v){return $h.loader.create($v,null,null,$d)},$D($d,["_staticBatchManager",function(){return this._staticBatchManager=new $lg}]),$d}($eg)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($v,$g){"use strict";for(var $Q in Object.defineProperty($g,"__esModule",{value:!0}),Laya){var $d=Laya[$Q];$d&&$d.__isclass&&($g[$Q]=$d)}}),function($v,$g,$rv){$rv.un,$rv.uns;var $Q=$rv.static,$d=$rv.class,$k=$rv.getset,$t=$rv.__newvec,$b=laya.maths.Bezier,$D=laya.utils.Browser,$Zv=laya.utils.Byte,$r=(laya.events.Event,laya.events.EventDispatcher),$$=laya.display.Graphics,$a=(laya.resource.HTMLCanvas,laya.utils.Handler),$M=laya.net.Loader,$J=laya.maths.MathUtil,$fv=laya.maths.Matrix,$q=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$Y=(laya.renders.RenderContext,laya.resource.Resource),$p=laya.utils.RunDriver,$kv=laya.display.Sprite,$T=laya.utils.Stat,$Xv=laya.resource.Texture,$C=(laya.net.URL,laya.utils.Utils),$f=function(){function $v(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $d($v,"laya.ani.AnimationContent"),$v}(),$X=function(){function $v(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $d($v,"laya.ani.AnimationNodeContent"),$v}(),$s=function(){function $v(){}return $d($v,"laya.ani.AnimationParser01"),$v.parse=function($v,$g){var $Q=$g.__getBuffer(),$d=0,$r=0,$k=0,$$=0,$b=0,$a=0,$M=0,$Y=$g.readUTFString();$v._aniClassName=$Y;var $D,$J=$g.readUTFString().split("\n"),$p=$g.getUint8(),$T=$g.getUint32(),$t=$g.getUint32();0<$T&&($D=$Q.slice($T,$t));var $q=new $Zv($D);for(0<$t&&($v._publicExtData=$Q.slice($t,$Q.byteLength)),$v._useParent=!!$g.getUint8(),$v._anis.length=$p,$d=0;$d<$p;$d++){var $C=$v._anis[$d]=new $f;$C.nodes=new Array;var $G=$C.name=$J[$g.getUint16()];$v._aniMap[$G]=$d,$C.bone3DMap={},$C.playTime=$g.getFloat32(),$C.playTime<=0&&console.error("播放时间不能为0  url="+$v.url+" name="+$C.name);var $s=$C.nodes.length=$g.getUint8();for($r=$C.totalKeyframeDatasLength=0;$r<$s;$r++){var $A=$C.nodes[$r]=new $X;$A.childs=[];var $h=$g.getInt16();0<=$h&&($A.name=$J[$h],$C.bone3DMap[$A.name]=$r),$A.keyFrame=new Array,$A.parentIndex=$g.getInt16(),-1==$A.parentIndex?$A.parent=null:$A.parent=$C.nodes[$A.parentIndex],$A.lerpType=$g.getUint8();var $P=$g.getUint32();$q.pos=$P;var $W=$A.keyframeWidth=$q.getUint16();if($C.totalKeyframeDatasLength+=$W,0===$A.lerpType||1===$A.lerpType)for($A.interpolationMethod=[],$A.interpolationMethod.length=$W,$k=0;$k<$W;$k++)$A.interpolationMethod[$k]=$x.interpolation[$q.getUint8()];null!=$A.parent&&$A.parent.childs.push($A);var $F=$g.getUint16();0<$F&&($A.extenData=$Q.slice($g.pos,$g.pos+$F),$g.pos+=$F);var $l,$o=$g.getUint16(),$E=0;for($k=0,$$=$A.keyFrame.length=$o;$k<$$;$k++){if(($l=$A.keyFrame[$k]=new $N).duration=$g.getFloat32(),$l.startTime=$E,2===$A.lerpType){$l.interpolationData=[];var $V,$Z=$g.getUint8();switch($V=$g.getFloat32()){case 254:for($l.interpolationData.length=$W,$M=0;$M<$W;$M++)$l.interpolationData[$M]=0;break;case 255:for($l.interpolationData.length=$W,$M=0;$M<$W;$M++)$l.interpolationData[$M]=5;break;default:for($l.interpolationData.push($V),$a=1;$a<$Z;$a++)$l.interpolationData.push($g.getFloat32())}}for($l.data=new Float32Array($W),$b=0;$b<$W;$b++)$l.data[$b]=$g.getFloat32(),-1e-8<$l.data[$b]&&$l.data[$b]<1e-8&&($l.data[$b]=0);$E+=$l.duration}$l.startTime=$C.playTime,$A.playTime=$C.playTime,$v._calculateKeyFrame($A,$o,$W)}}},$v}(),$A=function(){function $h(){}return $d($h,"laya.ani.AnimationParser02"),$h.READ_DATA=function(){$h._DATA.offset=$h._reader.getUint32(),$h._DATA.size=$h._reader.getUint32()},$h.READ_BLOCK=function(){for(var $v=$h._BLOCK.count=$h._reader.getUint16(),$g=$h._BLOCK.blockStarts=[],$Q=$h._BLOCK.blockLengths=[],$d=0;$d<$v;$d++)$g.push($h._reader.getUint32()),$Q.push($h._reader.getUint32())},$h.READ_STRINGS=function(){var $v=$h._reader.getUint32(),$g=$h._reader.getUint16(),$Q=$h._reader.pos;$h._reader.pos=$v+$h._DATA.offset;for(var $d=0;$d<$g;$d++)$h._strings[$d]=$h._reader.readUTFString();$h._reader.pos=$Q},$h.parse=function($v,$g){$h._templet=$v;($h._reader=$g).__getBuffer();$h.READ_DATA(),$h.READ_BLOCK(),$h.READ_STRINGS();for(var $Q=0,$d=$h._BLOCK.count;$Q<$d;$Q++){var $r=$g.getUint16(),$k=$h._strings[$r],$$=$h["READ_"+$k];if(null==$$)throw new Error("model file err,no this function:"+$r+" "+$k);$$.call()}},$h.READ_ANIMATIONS=function(){var $v=$h._reader,$g=$v.__getBuffer(),$Q=0,$d=0,$r=0,$k=0,$$=$v.getUint16(),$b=[];for($b.length=$$,$Q=0;$Q<$$;$Q++)$b[$Q]=$x.interpolation[$v.getByte()];var $a=$v.getUint8();for($h._templet._anis.length=$a,$Q=0;$Q<$a;$Q++){var $M=$h._templet._anis[$Q]={};$M.nodes=new Array;var $Y=$M.name=$h._strings[$v.getUint16()];$h._templet._aniMap[$Y]=$Q,$M.bone3DMap={},$M.playTime=$v.getFloat32();var $D=$M.nodes.length=$v.getInt16();for($d=$M.totalKeyframeDatasLength=0;$d<$D;$d++){var $J=$M.nodes[$d]={};$J.keyframeWidth=$$,$J.childs=[];var $p=$v.getUint16();0<=$p&&($J.name=$h._strings[$p],$M.bone3DMap[$J.name]=$d),$J.keyFrame=new Array,$J.parentIndex=$v.getInt16(),-1==$J.parentIndex?$J.parent=null:$J.parent=$M.nodes[$J.parentIndex],$M.totalKeyframeDatasLength+=$$,$J.interpolationMethod=$b,null!=$J.parent&&$J.parent.childs.push($J);var $T=$v.getUint16(),$t=null,$q=null;for($r=0,$k=$J.keyFrame.length=$T;$r<$k;$r++){($t=$J.keyFrame[$r]={}).startTime=$v.getFloat32(),$q&&($q.duration=$t.startTime-$q.startTime);var $C=$h._DATA.offset,$G=$v.getUint32(),$s=4*$$,$A=$g.slice($C+$G,$C+$G+$s);$t.data=new Float32Array($A),$q=$t}$t.duration=0,$J.playTime=$M.playTime,$h._templet._calculateKeyFrame($J,$T,$$)}}},$h._templet=null,$h._reader=null,$h._strings=[],$Q($h,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$h}(),$Nv=(function(){function $v(){}$d($v,"laya.ani.AnimationState"),$v.stopped=0,$v.paused=1,$v.playing=2}(),function(){function $r(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $ev,this.resultMatrix=new $fv,this._children=[]}$d($r,"laya.ani.bone.Bone");var $v=$r.prototype;return $v.setTempMatrix=function($v){this._tempMatrix=$v;var $g,$Q=0;for($Q=0,$g=this._children.length;$Q<$g;$Q++)this._children[$Q].setTempMatrix(this._tempMatrix)},$v.update=function($v){var $g;if(this.rotation=this.transform.skX,$v)$g=this.resultTransform.getMatrix(),$fv.mul($g,$v,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$g=this.resultTransform.getMatrix(),$fv.mul($g,this.parentBone.resultMatrix,this.resultMatrix);else{var $Q=this.parentBone,$d=NaN,$r=NaN,$k=NaN,$$=this.parentBone.resultMatrix;$g=this.resultTransform.getMatrix();var $b=$$.a*$g.tx+$$.c*$g.ty+$$.tx,$a=$$.b*$g.tx+$$.d*$g.ty+$$.ty,$M=new $fv;this.inheritRotation?($d=Math.atan2($Q.resultMatrix.b,$Q.resultMatrix.a),$r=Math.cos($d),$k=Math.sin($d),$M.setTo($r,$k,-$k,$r,0,0),$fv.mul(this._tempMatrix,$M,$fv.TEMP),$fv.TEMP.copyTo($M),$g=this.resultTransform.getMatrix(),$fv.mul($g,$M,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$g=this.resultTransform.getMatrix(),$fv.TEMP.identity(),$fv.TEMP.d=this.d,$fv.mul($g,$fv.TEMP,this.resultMatrix)),this.resultMatrix.tx=$b,this.resultMatrix.ty=$a}else($g=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $Y,$D=0;for($D=0,$Y=this._children.length;$D<$Y;$D++)this._children[$D].update()},$v.updateChild=function(){var $v,$g=0;for($g=0,$v=this._children.length;$g<$v;$g++)this._children[$g].update()},$v.setRotation=function($v){this._sprite&&(this._sprite.rotation=180*$v/Math.PI)},$v.updateDraw=function($v,$g){$r.ShowBones&&!$r.ShowBones[this.name]||(this._sprite||(this._sprite=new $kv,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$rv.stage.addChild(this._sprite)),this._sprite.x=$v+this.resultMatrix.tx,this._sprite.y=$g+this.resultMatrix.ty);var $Q,$d=0;for($d=0,$Q=this._children.length;$d<$Q;$d++)this._children[$d].updateDraw($v,$g)},$v.addChild=function($v){this._children.push($v),$v.parentBone=this},$v.findBone=function($v){if(this.name==$v)return this;var $g,$Q,$d=0;for($d=0,$g=this._children.length;$d<$g;$d++)if($Q=this._children[$d].findBone($v))return $Q;return null},$v.localToWorld=function($v){var $g=$v[0],$Q=$v[1];$v[0]=$g*this.resultMatrix.a+$Q*this.resultMatrix.c+this.resultMatrix.tx,$v[1]=$g*this.resultMatrix.b+$Q*this.resultMatrix.d+this.resultMatrix.ty},$r.ShowBones={},$r}()),$iv=function(){function $t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$d($t,"laya.ani.bone.BoneSlot");var $v=$t.prototype;return $v.showSlotData=function($v,$g){void 0===$g&&($g=!0),this.currSlotData=$v,$g&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$v.showDisplayByName=function($v){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($v))},$v.replaceDisplayByName=function($v,$g){if(this.currSlotData){var $Q;$Q=this.currSlotData.getDisplayByName($v);var $d;$d=this.currSlotData.getDisplayByName($g),this.replaceDisplayByIndex($Q,$d)}},$v.replaceDisplayByIndex=function($v,$g){this.currSlotData&&(this._replaceDic[$v]=$g,this.displayIndex==$v&&this.showDisplayByIndex($v))},$v.showDisplayByIndex=function($v){if(null!=this._replaceDic[$v]&&($v=this._replaceDic[$v]),this.currSlotData&&-1<$v&&$v<this.currSlotData.displayArr.length){if(this.displayIndex=$v,this.currDisplayData=this.currSlotData.displayArr[$v],this.currDisplayData){var $g=this.currDisplayData.name;this.currTexture=this.templet.getTexture($g),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$q.isConchApp||$q.isConchApp&&"0.9.15"<$kv.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$v.replaceSkin=function($v){this._diyTexture=$v,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$v.setParentMatrix=function($v){this._parentMatrix=$v},$v.draw=function($v,$g,$Q,$d){if(void 0===$Q&&($Q=!1),void 0===$d&&($d=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $r,$k=this.currTexture;switch(this._diyTexture&&($k=this._diyTexture),this.currDisplayData.type){case 0:if($v){var $$=this.getDisplayMatrix();if(this._parentMatrix){var $b=!1;if($$){var $a;if($fv.mul($$,this._parentMatrix,$fv.TEMP),$a=$Q?(null==this._resultMatrix&&(this._resultMatrix=new $fv),this._resultMatrix):new $fv,!$q.isWebGL&&this.currDisplayData.uvs||$q.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $M=$t._tempMatrix;$M.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($M.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($b=!0,$M.rotate(-Math.PI/2)),$fv.mul($M,$fv.TEMP,$a)}else $fv.TEMP.copyTo($a);$b?$v.drawTexture($k,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$a):$v.drawTexture($k,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$a)}}}break;case 1:if(null==($r=$Q?(null==this._skinSprite&&(this._skinSprite=$t.createSkinMesh()),this._skinSprite):$t.createSkinMesh()))return;var $Y;if(null==this.currDisplayData.bones){var $D,$J=this.currDisplayData.weights;this.deformData&&($J=this.deformData),$D=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$W.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$W.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$J;this.currDisplayData.triangles.length;$Y=this.currDisplayData.triangles,$r.init2($k,null,$Y,this._mVerticleArr,$D);var $p,$T=this.getDisplayMatrix();if(this._parentMatrix)if($T)$fv.mul($T,this._parentMatrix,$fv.TEMP),$p=$Q?(null==this._resultMatrix&&(this._resultMatrix=new $fv),this._resultMatrix):new $fv,$fv.TEMP.copyTo($p),$r.transform=$p}else this.skinMesh($g,$r,$d);$v.drawSkin($r);break;case 2:if(null==($r=$Q?(null==this._skinSprite&&(this._skinSprite=$t.createSkinMesh()),this._skinSprite):$t.createSkinMesh()))return;this.skinMesh($g,$r,$d),$v.drawSkin($r)}}},$v.skinMesh=function($v,$g,$Q){var $d,$r=this.currTexture,$k=this.currDisplayData.bones;$d=this._diyTexture?($r=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$W.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$W.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $$,$b,$a=this.currDisplayData.weights,$M=this.currDisplayData.triangles,$Y=0,$D=0,$J=0,$p=NaN,$T=NaN,$t=0,$q=0,$C=[],$G=0,$s=0;if(this.deformData&&0<this.deformData.length){var $A=0;for($G=0,$s=$k.length;$G<$s;){for($J=$k[$G++]+$G,$D=$Y=0;$G<$J;$G++)$b=$v[$k[$G]],$p=$a[$t]+this.deformData[$A++],$T=$a[$t+1]+this.deformData[$A++],$q=$a[$t+2],$Y+=($p*$b.a+$T*$b.c+$b.tx)*$q,$D+=($p*$b.b+$T*$b.d+$b.ty)*$q,$t+=3;$C.push($Y,$D)}}else for($G=0,$s=$k.length;$G<$s;){for($J=$k[$G++]+$G,$D=$Y=0;$G<$J;$G++)$b=$v[$k[$G]],$p=$a[$t],$T=$a[$t+1],$q=$a[$t+2],$Y+=($p*$b.a+$T*$b.c+$b.tx)*$q,$D+=($p*$b.b+$T*$b.d+$b.ty)*$q,$t+=3;$C.push($Y,$D)}this._mVerticleArr=$C,$$=$M,$g.init2($r,null,$$,this._mVerticleArr,$d)},$v.drawBonePoint=function($v){$v&&this._parentMatrix&&$v.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$v.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$v.getMatrix=function(){return this._resultMatrix},$v.copy=function(){var $v=new $t;return $v.type="copy",$v.name=this.name,$v.attachmentName=this.attachmentName,$v.srcDisplayIndex=this.srcDisplayIndex,$v.parent=this.parent,$v.displayIndex=this.displayIndex,$v.templet=this.templet,$v.currSlotData=this.currSlotData,$v.currTexture=this.currTexture,$v.currDisplayData=this.currDisplayData,$v},$t.createSkinMesh=function(){return $q.isWebGL||$q.isConchApp?$p.skinAniSprite():($q.isWebGL,null)},$Q($t,["_tempMatrix",function(){return this._tempMatrix=new $fv}]),$t}(),$xv=function(){function $v(){this.skinName=null,this.deformSlotDataList=[]}return $d($v,"laya.ani.bone.DeformAniData"),$v}(),$wv=function(){function $v(){this.deformSlotDisplayList=[]}return $d($v,"laya.ani.bone.DeformSlotData"),$v}(),$mv=function(){function $v(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$d($v,"laya.ani.bone.DeformSlotDisplayData");var $g=$v.prototype;return $g.binarySearch1=function($v,$g){var $Q=0,$d=$v.length-2;if(0==$d)return 1;for(var $r=$d>>>1;;){if($v[Math.floor($r+1)]<=$g?$Q=$r+1:$d=$r,$Q==$d)return $Q+1;$r=$Q+$d>>>1}return 0},$g.apply=function($v,$g,$Q){if(void 0===$Q&&($Q=1),$v+=.05,!(this.timeList.length<=0)){var $d=0;if(!($v<this.timeList[0])){var $r=this.vectices[0].length,$k=[],$$=this.binarySearch1(this.timeList,$v);if(this.frameIndex=$$,$v>=this.timeList[this.timeList.length-1]){var $b=this.vectices[this.vectices.length-1];if($Q<1)for($d=0;$d<$r;$d++)$k[$d]+=($b[$d]-$k[$d])*$Q;else for($d=0;$d<$r;$d++)$k[$d]=$b[$d];this.deformData=$k}else{this.tweenKeyList[this.frameIndex];var $a=this.vectices[this.frameIndex-1],$M=this.vectices[this.frameIndex],$Y=this.timeList[this.frameIndex-1],$D=this.timeList[this.frameIndex];$Q=this.tweenKeyList[$$-1]?($v-$Y)/($D-$Y):0;var $J=NaN;for($d=0;$d<$r;$d++)$J=$a[$d],$k[$d]=$J+($M[$d]-$J)*$Q;this.deformData=$k}}}},$v}(),$Kv=function(){function $v(){this.time=NaN,this.drawOrder=[]}return $d($v,"laya.ani.bone.DrawOrderData"),$v}(),$cv=function(){function $v(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $d($v,"laya.ani.bone.EventData"),$v}(),$G=function(){function $dv($v,$g){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$v,this._targetBone=$g[$v.targetBoneIndex],this.isSpine=$v.isSpine,null==this._bones&&(this._bones=[]);for(var $Q=this._bones.length=0,$d=$v.boneIndexs.length;$Q<$d;$Q++)this._bones.push($g[$v.boneIndexs[$Q]]);this.name=$v.name,this.mix=$v.mix,this.bendDirection=$v.bendDirection}$d($dv,"laya.ani.bone.IkConstraint");var $v=$dv.prototype;return $v.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$v._applyIk1=function($v,$g,$Q,$d){var $r=$v.parentBone,$k=1/($r.resultMatrix.a*$r.resultMatrix.d-$r.resultMatrix.b*$r.resultMatrix.c),$$=$g-$r.resultMatrix.tx,$b=$Q-$r.resultMatrix.ty,$a=($$*$r.resultMatrix.d-$b*$r.resultMatrix.c)*$k-$v.transform.x,$M=($b*$r.resultMatrix.a-$$*$r.resultMatrix.b)*$k-$v.transform.y,$Y=Math.atan2($M,$a)*$dv.radDeg-0-$v.transform.skX;$v.transform.scX<0&&($Y+=180),180<$Y?$Y-=360:$Y<-180&&($Y+=360),$v.transform.skX=$v.transform.skY=$v.transform.skX+$Y*$d,$v.update()},$v.updatePos=function($v,$g){this._sp&&this._sp.pos($v,$g)},$v._applyIk2=function($v,$g,$Q,$d,$r,$k){if(0!=$k){var $$=$v.resultTransform.x,$b=$v.resultTransform.y,$a=$v.transform.scX,$M=$v.transform.scY,$Y=$g.transform.scX,$D=0,$J=0,$p=0;$p=$a<0?($a=-$a,$D=180,-1):($D=0,1),$M<0&&($M=-$M,$p=-$p),$J=$Y<0?($Y=-$Y,180):0;var $T=$g.resultTransform.x,$t=NaN,$q=NaN,$C=NaN,$G=$v.resultMatrix.a,$s=$v.resultMatrix.c,$A=$v.resultMatrix.b,$h=$v.resultMatrix.d,$P=Math.abs($a-$M)<=1e-4;$C=$P?($q=$G*$T+$s*($t=$g.resultTransform.y)+$v.resultMatrix.tx,$A*$T+$h*$t+$v.resultMatrix.ty):($t=0,$q=$G*$T+$v.resultMatrix.tx,$A*$T+$v.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $kv,$rv.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($Q,$d,15,"#ffff00"),this._sp.graphics.drawCircle($q,$C,15,"#ff00ff")),$v.setRotation(Math.atan2($C-$v.resultMatrix.ty,$q-$v.resultMatrix.tx));var $W=$v.parentBone;$G=$W.resultMatrix.a,$s=$W.resultMatrix.c,$A=$W.resultMatrix.b;var $F=1/($G*($h=$W.resultMatrix.d)-$s*$A),$l=$Q-$W.resultMatrix.tx,$o=$d-$W.resultMatrix.ty,$E=($l*$h-$o*$s)*$F-$$,$V=($o*$G-$l*$A)*$F-$b,$Z=(($l=$q-$W.resultMatrix.tx)*$h-($o=$C-$W.resultMatrix.ty)*$s)*$F-$$,$f=($o*$G-$l*$A)*$F-$b,$X=Math.sqrt($Z*$Z+$f*$f),$N=$g.length*$Y,$i=NaN,$x=NaN;if($P){var $w=($E*$E+$V*$V-$X*$X-($N*=$a)*$N)/(2*$X*$N);$w<-1?$w=-1:1<$w&&($w=1),$x=Math.acos($w)*$r,$G=$X+$N*$w,$s=$N*Math.sin($x),$i=Math.atan2($V*$G-$E*$s,$E*$G+$V*$s)}else{var $m=($G=$a*$N)*$G,$K=($s=$M*$N)*$s,$c=$E*$E+$V*$V,$B=Math.atan2($V,$E),$j=-2*$K*$X,$L=$K-$m;if(0<($h=$j*$j-4*$L*($A=$K*$X*$X+$m*$c-$m*$K))){var $H=Math.sqrt($h);$j<0&&($H=-$H);var $n=($H=-($j+$H)/2)/$L,$y=$A/$H,$e=Math.abs($n)<Math.abs($y)?$n:$y;$e*$e<=$c&&($o=Math.sqrt($c-$e*$e)*$r,$i=$B-Math.atan2($o,$e),$x=Math.atan2($o/$M,($e-$X)/$a))}var $R=0,$z=Number.MAX_VALUE,$U=0,$I=0,$S=0,$O=0,$_=0,$u=0;$O<($h=($l=$X+$G)*$l)&&($S=0,$O=$h,$_=$l),($h=($l=$X-$G)*$l)<$z&&($R=Math.PI,$z=$h,$U=$l);var $vv=Math.acos(-$G*$X/($m-$K));($h=($l=$G*Math.cos($vv)+$X)*$l+($o=$s*Math.sin($vv))*$o)<$z&&($R=$vv,$z=$h,$U=$l,$I=$o),$O<$h&&($S=$vv,$O=$h,$_=$l,$u=$o),$x=$c<=($z+$O)/2?($i=$B-Math.atan2($I*$r,$U),$R*$r):($i=$B-Math.atan2($u*$r,$_),$S*$r)}var $gv=Math.atan2($t,$T)*$p,$Qv=$v.resultTransform.skX;180<($i=($i-$gv)*$dv.radDeg+$D-$Qv)?$i-=360:$i<-180&&($i+=360),$v.resultTransform.x=$$,$v.resultTransform.y=$b,$v.resultTransform.skX=$v.resultTransform.skY=$Qv+$i*$k,$Qv=$g.resultTransform.skX,180<($x=(($x+$gv)*$dv.radDeg-0)*$p+$J-($Qv%=360))?$x-=360:$x<-180&&($x+=360),$g.resultTransform.x=$T,$g.resultTransform.y=$t,$g.resultTransform.skX=$g.resultTransform.skY=$g.resultTransform.skY+$x*$k,$v.update()}},$v._applyIk3=function($v,$g,$Q,$d,$r,$k){if(0!=$k){var $$,$b,$a=$g.resultMatrix.a*$g.length,$M=$g.resultMatrix.b*$g.length,$Y=$a*$a+$M*$M,$D=Math.sqrt($Y),$J=$v.resultMatrix.tx,$p=$v.resultMatrix.ty,$T=$g.resultMatrix.tx,$t=$g.resultMatrix.ty,$q=$T-$J,$C=$t-$p,$G=$q*$q+$C*$C,$s=Math.sqrt($G),$A=($q=$Q-$v.resultMatrix.tx)*$q+($C=$d-$v.resultMatrix.ty)*$C,$h=Math.sqrt($A);if($D+$s<=$h||$h+$D<=$s||$h+$s<=$D){var $P=NaN;$T=$J+($P=$D+$s<=$h?1:-1)*($Q-$J)*$s/$h,$t=$p+$P*($d-$p)*$s/$h}else{var $W=($G-$Y+$A)/(2*$A),$F=Math.sqrt($G-$W*$W*$A)/$h,$l=$J+$q*$W,$o=$p+$C*$W,$E=-$C*$F,$V=$q*$F;$t=0<$r?($T=$l-$E,$o-$V):($T=$l+$E,$o+$V)}$$=$T,$b=$t,this.isDebug&&(this._sp||(this._sp=new $kv,$rv.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($J,$p,15,"#ff00ff"),this._sp.graphics.drawCircle($Q,$d,15,"#ffff00"),this._sp.graphics.drawCircle($$,$b,15,"#ff00ff"));var $Z,$f;$Z=Math.atan2($b-$v.resultMatrix.ty,$$-$v.resultMatrix.tx),$v.setRotation($Z),($f=$dv._tempMatrix).identity(),$f.rotate($Z),$f.scale($v.resultMatrix.getScaleX(),$v.resultMatrix.getScaleY()),$f.translate($v.resultMatrix.tx,$v.resultMatrix.ty),$f.copyTo($v.resultMatrix),$v.updateChild();var $X,$N;$X=Math.atan2($d-$b,$Q-$$),$g.setRotation($X),($N=$dv._tempMatrix).identity(),$N.rotate($X),$N.scale($g.resultMatrix.getScaleX(),$g.resultMatrix.getScaleY()),$N.translate($$,$b),$f.copyTo($g.resultMatrix),$g.updateChild()}},$Q($dv,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $fv}]),$dv}(),$Bv=function(){function $v(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $d($v,"laya.ani.bone.IkConstraintData"),$v}(),$h=function(){function $N($v,$g){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$v,this.position=$v.position,this.spacing=$v.spacing,this.rotateMix=$v.rotateMix,this.translateMix=$v.translateMix,this.bones=[];for(var $Q=this.data.bones,$d=0,$r=$Q.length;$d<$r;$d++)this.bones.push($g[$Q[$d]])}$d($N,"laya.ani.bone.PathConstraint");var $v=$N.prototype;return $v.apply=function($v,$g){if(this.target){var $Q=this.translateMix,$d=this.translateMix,$r=0<$d,$k=this.data.spacingMode,$$="length"==$k,$b=this.data.rotateMode,$a="tangent"==$b,$M="chainScale"==$b,$Y=[],$D=this.bones.length,$J=$a?$D:$D+1,$p=[];(this._spaces=$p)[0]=this.position;var $T=this.spacing;if($M||$$)for(var $t=0,$q=$J-1;$t<$q;){var $C=this.bones[$t],$G=$C.length,$s=$G*$C.resultMatrix.a,$A=$G*$C.resultMatrix.b;$G=Math.sqrt($s*$s+$A*$A),$M&&($Y[$t]=$G),$p[++$t]=$$?Math.max(0,$G+$T):$T}else for($t=1;$t<$J;$t++)$p[$t]=$T;var $h=this.computeWorldPositions(this.target,$v,$g,$J,$a,"percent"==this.data.positionMode,"percent"==$k);if(this._debugKey){for($t=0;$t<$h.length;$t++)$g.drawCircle($h[$t++],$h[$t++],5,"#00ff00");var $P=[];for($t=0;$t<$h.length;$t++)$P.push($h[$t++],$h[$t++]);$g.drawLines(0,0,$P,"#ff0000")}var $W=$h[0],$F=$h[1],$l=this.data.offsetRotation,$o="chain"==$b&&0==$l,$E=NaN;for($t=0,$E=3;$t<$D;$t++,$E+=3){($C=this.bones[$t]).resultMatrix.tx+=($W-$C.resultMatrix.tx)*$Q,$C.resultMatrix.ty+=($F-$C.resultMatrix.ty)*$Q;var $V=($s=$h[$E])-$W,$Z=($A=$h[$E+1])-$F;if($M&&0!=($G=$Y[$t])){var $f=(Math.sqrt($V*$V+$Z*$Z)/$G-1)*$d+1;$C.resultMatrix.a*=$f,$C.resultMatrix.c*=$f}if($W=$s,$F=$A,$r){var $X=$C.resultMatrix.a,$N=$C.resultMatrix.c,$i=$C.resultMatrix.b,$x=$C.resultMatrix.d,$w=NaN,$m=NaN,$K=NaN;$w=$a?$h[$E-1]:0==$p[$t+1]?$h[$E+2]:Math.atan2($Z,$V),$w-=Math.atan2($i,$X)-$l/180*Math.PI,$o&&($m=Math.cos($w),$K=Math.sin($w),$W+=(($G=$C.length)*($m*$X-$K*$i)-$V)*$d,$F+=($G*($K*$X+$m*$i)-$Z)*$d),$w>Math.PI?$w-=2*Math.PI:$w<-Math.PI&&($w+=2*Math.PI),$w*=$d,$m=Math.cos($w),$K=Math.sin($w),$C.resultMatrix.a=$m*$X-$K*$i,$C.resultMatrix.c=$m*$N-$K*$x,$C.resultMatrix.b=$K*$X+$m*$i,$C.resultMatrix.d=$K*$N+$m*$x}}}},$v.computeWorldVertices2=function($v,$g,$Q,$d,$r,$k){var $$,$b,$a=$v.currDisplayData.bones,$M=$v.currDisplayData.weights,$Y=$v.currDisplayData.triangles,$D=0,$J=0,$p=0,$T=0,$t=0,$q=0,$C=0,$G=0,$s=0,$A=0,$h=0;if(null!=$a){for($D=0;$D<$Q;$D+=2)$J+=($T=$a[$J])+1,$p+=$T;var $P=$g;for($t=$k,$q=3*$p;$t<$d;$t+=2){for($G=$C=0,$T=$a[$J++],$T+=$J;$J<$T;$J++,$q+=3){$$=$P[$a[$J]].resultMatrix,$s=$M[$q],$A=$M[$q+1];var $W=$M[$q+2];$C+=($s*$$.a+$A*$$.c+$$.tx)*$W,$G+=($s*$$.b+$A*$$.d+$$.ty)*$W}$r[$t]=$C,$r[$t+1]=$G}}else{var $F,$l;if($Y||($Y=$M),$v.deformData&&($Y=$v.deformData),$F=$v.parent,$g)for($h=$g.length,$D=0;$D<$h;$D++)if($g[$D].name==$F){$b=$g[$D];break}$b&&($l=$b.resultMatrix),$l||($l=$N._tempMt);var $o=$l.tx,$E=$l.ty,$V=$l.a,$Z=$l.b,$f=$l.c,$X=$l.d;for($b&&($X*=$b.d),$J=$Q,$t=$k;$t<$d;$J+=2,$t+=2)$s=$Y[$J],$A=$Y[$J+1],$r[$t]=$s*$V+$A*$Z+$o,$r[$t+1]=-($s*$f+$A*$X+$E)}},$v.computeWorldPositions=function($v,$g,$Q,$d,$r,$k,$$){$v.currDisplayData.bones,$v.currDisplayData.weights,$v.currDisplayData.triangles;var $b=[],$a=0,$M=$v.currDisplayData.verLen,$Y=this.position,$D=this._spaces,$J=[],$p=[],$T=$M/6,$t=-1,$q=NaN,$C=0,$G=0,$s=NaN,$A=NaN,$h=NaN,$P=NaN;if($T--,$M-=4,this.computeWorldVertices2($v,$g,2,$M,$b,0),this._debugKey)for($a=0;$a<$b.length;)$Q.drawCircle($b[$a++],$b[$a++],10,"#ff0000");$J=$b,this._curves.length=$T;var $W=this._curves,$F=$J[$q=0],$l=$J[1],$o=0,$E=0,$V=0,$Z=0,$f=0,$X=0,$N=NaN,$i=NaN,$x=NaN,$w=NaN,$m=NaN,$K=NaN,$c=NaN,$B=NaN,$j=0;for($a=0,$j=2;$a<$T;$a++,$j+=6)$o=$J[$j],$E=$J[$j+1],$V=$J[$j+2],$Z=$J[$j+3],$m=2*($N=.1875*($F-2*$o+$V))+($x=.09375*(3*($o-$V)-$F+($f=$J[$j+4]))),$K=2*($i=.1875*($l-2*$E+$Z))+($w=.09375*(3*($E-$Z)-$l+($X=$J[$j+5]))),$c=.75*($o-$F)+$N+.16666667*$x,$B=.75*($E-$l)+$i+.16666667*$w,$q+=Math.sqrt($c*$c+$B*$B),$c+=$m,$B+=$K,$m+=$x,$K+=$w,$q+=Math.sqrt($c*$c+$B*$B),$c+=$m,$B+=$K,$q+=Math.sqrt($c*$c+$B*$B),$c+=$m+$x,$B+=$K+$w,$q+=Math.sqrt($c*$c+$B*$B),$W[$a]=$q,$F=$f,$l=$X;if($k&&($Y*=$q),$$)for($a=0;$a<$d;$a++)$D[$a]*=$q;var $L=this._segments,$H=0,$n=0;for($n=$G=$C=$a=0;$a<$d;$a++,$C+=3)if(($s=$Y+=$A=$D[$a])<0)this.addBeforePosition($s,$J,0,$p,$C);else if($q<$s)this.addAfterPosition($s-$q,$J,$M-4,$p,$C);else{for(;;$G++)if(!(($P=$W[$G])<$s)){0==$G?$s/=$P:$s=($s-($h=$W[$G-1]))/($P-$h);break}if($G!=$t){var $y=6*($t=$G);for($F=$J[$y],$l=$J[$y+1],$o=$J[$y+2],$E=$J[$y+3],$V=$J[$y+4],$Z=$J[$y+5],$m=2*($N=.03*($F-2*$o+$V))+($x=.006*(3*($o-$V)-$F+($f=$J[$y+6]))),$K=2*($i=.03*($l-2*$E+$Z))+($w=.006*(3*($E-$Z)-$l+($X=$J[$y+7]))),$c=.3*($o-$F)+$N+.16666667*$x,$B=.3*($E-$l)+$i+.16666667*$w,$H=Math.sqrt($c*$c+$B*$B),$L[0]=$H,$y=1;$y<8;$y++)$c+=$m,$B+=$K,$m+=$x,$K+=$w,$H+=Math.sqrt($c*$c+$B*$B),$L[$y]=$H;$c+=$m,$B+=$K,$H+=Math.sqrt($c*$c+$B*$B),$L[8]=$H,$c+=$m+$x,$B+=$K+$w,$H+=Math.sqrt($c*$c+$B*$B),$L[9]=$H,$n=0}for($s*=$H;;$n++)if(!(($P=$L[$n])<$s)){0==$n?$s/=$P:$s=$n+($s-($h=$L[$n-1]))/($P-$h);break}this.addCurvePosition(.1*$s,$F,$l,$o,$E,$V,$Z,$f,$X,$p,$C,$r||0<$a&&0==$A)}return $p},$v.addBeforePosition=function($v,$g,$Q,$d,$r){var $k=$g[$Q],$$=$g[$Q+1],$b=$g[$Q+2]-$k,$a=$g[$Q+3]-$$,$M=Math.atan2($a,$b);$d[$r]=$k+$v*Math.cos($M),$d[$r+1]=$$+$v*Math.sin($M),$d[$r+2]=$M},$v.addAfterPosition=function($v,$g,$Q,$d,$r){var $k=$g[$Q+2],$$=$g[$Q+3],$b=$k-$g[$Q],$a=$$-$g[$Q+1],$M=Math.atan2($a,$b);$d[$r]=$k+$v*Math.cos($M),$d[$r+1]=$$+$v*Math.sin($M),$d[$r+2]=$M},$v.addCurvePosition=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y,$D){0==$v&&($v=1e-4);var $J=$v*$v,$p=$J*$v,$T=1-$v,$t=$T*$T,$q=$t*$T,$C=$T*$v,$G=3*$C,$s=$T*$G,$A=$G*$v,$h=$g*$q+$d*$s+$k*$A+$b*$p,$P=$Q*$q+$r*$s+$$*$A+$a*$p;$M[$Y]=$h,$M[$Y+1]=$P,$M[$Y+2]=$D?Math.atan2($P-($Q*$t+$r*$C*2+$$*$J),$h-($g*$t+$d*$C*2+$k*$J)):0},$N.NONE=-1,$N.BEFORE=-2,$N.AFTER=-3,$Q($N,["_tempMt",function(){return this._tempMt=new $fv}]),$N}(),$jv=function(){function $v(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $d($v,"laya.ani.bone.PathConstraintData"),$v}(),$Lv=function(){function $v(){this.name=null,this.slotArr=[]}return $d($v,"laya.ani.bone.SkinData"),$v}(),$Hv=function(){function $v(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$d($v,"laya.ani.bone.SkinSlotDisplayData");var $g=$v.prototype;return $g.createTexture=function($v){return this.texture||(this.texture=new $Xv($v.bitmap,this.uvs),$v.bitmap.alphaTexture&&(this.texture.alphaTexture=new $Xv($v.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$v.height,this.texture.height=$v.width,this.texture.offsetX=-$v.offsetX,this.texture.offsetY=-$v.offsetY,this.texture.sourceWidth=$v.sourceHeight,this.texture.sourceHeight=$v.sourceWidth):(this.texture.width=$v.width,this.texture.height=$v.height,this.texture.offsetX=-$v.offsetX,this.texture.offsetY=-$v.offsetY,this.texture.sourceWidth=$v.sourceWidth,this.texture.sourceHeight=$v.sourceHeight),$q.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$g.destory=function(){this.texture&&this.texture.destroy()},$v}(),$nv=function(){function $v(){this.name=null,this.displayArr=[]}return $d($v,"laya.ani.bone.SlotData"),$v.prototype.getDisplayByName=function($v){for(var $g=0,$Q=this.displayArr.length;$g<$Q;$g++)if(this.displayArr[$g].attachmentName==$v)return $g;return-1},$v}(),$P=function(){function $v($v,$g){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$t(2,0),this._data=$v,null==this._bones&&(this._bones=[]),this.target=$g[$v.targetIndex];var $Q,$d=0;for($d=0,$Q=$v.boneIndexs.length;$d<$Q;$d++)this._bones.push($g[$v.boneIndexs[$d]]);this.rotateMix=$v.rotateMix,this.translateMix=$v.translateMix,this.scaleMix=$v.scaleMix,this.shearMix=$v.shearMix}return $d($v,"laya.ani.bone.TfConstraint"),$v.prototype.apply=function(){for(var $v,$g=this.target.resultMatrix.a,$Q=this.target.resultMatrix.b,$d=this.target.resultMatrix.c,$r=this.target.resultMatrix.d,$k=0,$$=this._bones.length;$k<$$;$k++){if($v=this._bones[$k],0<this.rotateMix){var $b=$v.resultMatrix.a,$a=$v.resultMatrix.b,$M=$v.resultMatrix.c,$Y=$v.resultMatrix.d,$D=Math.atan2($d,$g)-Math.atan2($M,$b)+this._data.offsetRotation*Math.PI/180;$D>Math.PI?$D-=2*Math.PI:$D<-Math.PI&&($D+=2*Math.PI),$D*=this.rotateMix;var $J=Math.cos($D),$p=Math.sin($D);$v.resultMatrix.a=$J*$b-$p*$M,$v.resultMatrix.b=$J*$a-$p*$Y,$v.resultMatrix.c=$p*$b+$J*$M,$v.resultMatrix.d=$p*$a+$J*$Y}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$v.resultMatrix.tx+=(this._temp[0]-$v.resultMatrix.tx)*this.translateMix,$v.resultMatrix.ty+=(this._temp[1]-$v.resultMatrix.ty)*this.translateMix,$v.updateChild()),0<this.scaleMix){var $T=Math.sqrt($v.resultMatrix.a*$v.resultMatrix.a+$v.resultMatrix.c*$v.resultMatrix.c),$t=Math.sqrt($g*$g+$d*$d),$q=1e-5<$T?($T+($t-$T+this._data.offsetScaleX)*this.scaleMix)/$T:0;$v.resultMatrix.a*=$q,$v.resultMatrix.c*=$q,$T=Math.sqrt($v.resultMatrix.b*$v.resultMatrix.b+$v.resultMatrix.d*$v.resultMatrix.d),$t=Math.sqrt($Q*$Q+$r*$r),$q=1e-5<$T?($T+($t-$T+this._data.offsetScaleY)*this.scaleMix)/$T:0,$v.resultMatrix.b*=$q,$v.resultMatrix.d*=$q}if(0<this.shearMix){$a=$v.resultMatrix.b,$Y=$v.resultMatrix.d;var $C=Math.atan2($Y,$a);($D=Math.atan2($r,$Q)-Math.atan2($d,$g)-($C-Math.atan2($v.resultMatrix.c,$v.resultMatrix.a)))>Math.PI?$D-=2*Math.PI:$D<-Math.PI&&($D+=2*Math.PI),$D=$C+($D+this._data.offsetShearY*Math.PI/180)*this.shearMix,$q=Math.sqrt($a*$a+$Y*$Y),$v.resultMatrix.b=Math.cos($D)*$q,$v.resultMatrix.d=Math.sin($D)*$q}}},$v}(),$yv=function(){function $v(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $d($v,"laya.ani.bone.TfConstraintData"),$v}(),$ev=function(){function $v(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$d($v,"laya.ani.bone.Transform");var $g=$v.prototype;return $g.initData=function($v){null!=$v.x&&(this.x=$v.x),null!=$v.y&&(this.y=$v.y),null!=$v.skX&&(this.skX=$v.skX),null!=$v.skY&&(this.skY=$v.skY),null!=$v.scX&&(this.scX=$v.scX),null!=$v.scY&&(this.scY=$v.scY)},$g.getMatrix=function(){var $v;return($v=this.mMatrix?this.mMatrix:this.mMatrix=new $fv).identity(),$v.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($v,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$v.rotate(this.skX*Math.PI/180),$v.translate(this.x,this.y),$v},$g.skew=function($v,$g,$Q){var $d=Math.sin($Q),$r=Math.cos($Q),$k=Math.sin($g),$$=Math.cos($g);return $v.setTo($v.a*$$-$v.b*$d,$v.a*$k+$v.b*$r,$v.c*$$-$v.d*$d,$v.c*$k+$v.d*$r,$v.tx*$$-$v.ty*$d,$v.tx*$k+$v.ty*$r),$v},$v}(),$W=function(){function $v(){}return $d($v,"laya.ani.bone.UVTools"),$v.getRelativeUV=function($v,$g,$Q){var $d=$v[0],$r=$v[2]-$v[0],$k=$v[1],$$=$v[5]-$v[1];$Q||($Q=[]),$Q.length=$g.length;var $b,$a=0;$b=$Q.length;var $M=1/$r,$Y=1/$$;for($a=0;$a<$b;$a+=2)$Q[$a]=($g[$a]-$d)*$M,$Q[$a+1]=($g[$a+1]-$k)*$Y;return $Q},$v.getAbsoluteUV=function($v,$g,$Q){if(0==$v[0]&&0==$v[1]&&1==$v[4]&&1==$v[5])return $Q?($C.copyArray($Q,$g),$Q):$g;var $d=$v[0],$r=$v[2]-$v[0],$k=$v[1],$$=$v[5]-$v[1];$Q||($Q=[]),$Q.length=$g.length;var $b,$a=0;for($b=$Q.length,$a=0;$a<$b;$a+=2)$Q[$a]=$g[$a]*$r+$d,$Q[$a+1]=$g[$a+1]*$$+$k;return $Q},$v}(),$N=function(){function $v(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $d($v,"laya.ani.KeyFramesContent"),$v}(),$F=function(){function $Y(){}return $d($Y,"laya.ani.math.BezierLerp"),$Y.getBezierRate=function($v,$g,$Q,$d,$r){var $k=$Y._getBezierParamKey($g,$Q,$d,$r),$$=100*$k+$v;if($Y._bezierResultCache[$$])return $Y._bezierResultCache[$$];var $b,$a=$Y._getBezierPoints($g,$Q,$d,$r,$k),$M=0;for($b=$a.length,$M=0;$M<$b;$M+=2)if($v<=$a[$M])return $Y._bezierResultCache[$$]=$a[$M+1],$a[$M+1];return $Y._bezierResultCache[$$]=1},$Y._getBezierParamKey=function($v,$g,$Q,$d){return 100*(100*(100*(100*$v+$g)+$Q)+$d)},$Y._getBezierPoints=function($v,$g,$Q,$d,$r){return $Y._bezierPointsCache[$r]?$Y._bezierPointsCache[$r]:($k=[0,0,$v,$g,$Q,$d,1,1],$$=(new $b).getBezierPoints($k,100,3),$Y._bezierPointsCache[$r]=$$);var $k,$$},$Y._bezierResultCache={},$Y._bezierPointsCache={},$Y}(),$l=function($v){function $g(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$g.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$d($g,"laya.ani.AnimationPlayer",$r);var $Q=$g.prototype;return $rv.imps($Q,{"laya.resource.IDestroy":!0}),$Q._onTempletLoadedComputeFullKeyframeIndices=function($v,$g,$Q){this._templet===$Q&&this._cachePlayRate===$v&&this._cacheFrameRate===$g&&this._computeFullKeyframeIndices()},$Q._computeFullKeyframeIndices=function(){for(var $v=this._fullFrames=[],$g=this._templet,$Q=this._cacheFrameRateInterval*this._cachePlayRate,$d=0,$r=$g.getAnimationCount();$d<$r;$d++){for(var $k=[],$$=0,$b=$g.getAnimation($d).nodes.length;$$<$b;$$++){for(var $a=$g.getAnimation($d).nodes[$$],$M=Math.floor($a.playTime/$Q+.01),$Y=new Uint16Array($M+1),$D=-1,$J=0,$p=$a.keyFrame.length;$J<$p;$J++){var $T=$a.keyFrame[$J],$t=$T.startTime,$q=$t+$T.duration+$Q;do{for(var $C=Math.floor($t/$Q+.5),$G=$D+1;$G<$C;$G++)$Y[$G]=$J;$Y[$D=$C]=$J,$t+=$Q}while($t<=$q)}$k.push($Y)}$v.push($k)}},$Q._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$Q._calculatePlayDuration=function(){if(0!==this.state){var $v=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$v),this._playEnd>$v&&(this._playEnd=$v),this._playDuration=this._playEnd-this._playStart}},$Q._setPlayParams=function($v,$g){this._currentTime=$v,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$g+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$g},$Q._setPlayParamsWhenStop=function($v,$g){this._currentTime=$v,this._currentKeyframeIndex=Math.max(Math.floor($v/$g+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$g,this._currentAnimationClipIndex=-1},$Q._update=function($v){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $g=this._cacheFrameRateInterval*this._cachePlayRate,$Q=0;this._startUpdateLoopCount!==$T.loopCount&&($Q=$v*this.playbackRate,this._elapsedPlaybackTime+=$Q);var $d=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$d)return this._setPlayParamsWhenStop($d,$g),void this.event("stopped");if($Q+=this._currentTime,0<$d)if($d<=$Q)do{if($Q-=$d,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($d,$g),this._stopWhenCircleFinish=!1,void this.event("stopped");$Q<$d&&(this._setPlayParams($Q,$g),this.event("complete"))}while($d<=$Q);else this._setPlayParams($Q,$g);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($d,$g),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$Q._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$Q.play=function($v,$g,$Q,$d,$r){if(void 0===$v&&($v=0),void 0===$g&&($g=1),void 0===$Q&&($Q=2147483647),void 0===$d&&($d=0),void 0===$r&&($r=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($Q<0||$d<0||$r<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$r&&$r<$d)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$g,this._overallDuration=$Q,this._playStart=$d,this._playEnd=$r,this._paused=!1,this._currentAnimationClipIndex=$v,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$T.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$Q.playByFrame=function($v,$g,$Q,$d,$r,$k){void 0===$v&&($v=0),void 0===$g&&($g=1),void 0===$Q&&($Q=2147483647),void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$k&&($k=30);var $$=1e3/$k;this.play($v,$g,$Q,$d*$$,$r*$$)},$Q.stop=function($v){void 0===$v&&($v=!0),$v?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$k(0,$Q,"playEnd",function(){return this._playEnd}),$k(0,$Q,"templet",function(){return this._templet},function($v){0===!this.state&&this.stop(!0),this._templet!==$v&&((this._templet=$v).loaded?this._computeFullKeyframeIndices():$v.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$k(0,$Q,"playStart",function(){return this._playStart}),$k(0,$Q,"playDuration",function(){return this._playDuration}),$k(0,$Q,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$k(0,$Q,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$k(0,$Q,"overallDuration",function(){return this._overallDuration}),$k(0,$Q,"currentFrameTime",function(){return this._currentFrameTime}),$k(0,$Q,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$k(0,$Q,"currentPlayTime",function(){return this._currentTime+this._playStart}),$k(0,$Q,"cachePlayRate",function(){return this._cachePlayRate},function($v){this._cachePlayRate!==$v&&(this._cachePlayRate=$v,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$v,this._cacheFrameRate])))}),$k(0,$Q,"cacheFrameRate",function(){return this._cacheFrameRate},function($v){this._cacheFrameRate!==$v&&(this._cacheFrameRate=$v,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$v])))}),$k(0,$Q,"currentTime",null,function($v){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($v<this._playStart||$v>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$T.loopCount;var $g=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$v,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$g),0),this._currentFrameTime=this._currentKeyframeIndex*$g}}),$k(0,$Q,"paused",function(){return this._paused},function($v){(this._paused=$v)&&this.event("paused")}),$k(0,$Q,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$k(0,$Q,"destroyed",function(){return this._destroyed}),$g}(),$i=function($v){function $g(){$g.__super.call(this),$q.isConchNode&&(this.drawSkin=function($v){$v.transform||($v.transform=$fv.EMPTY),this._addCmd([$v]),this.setSkinMesh&&this.setSkinMesh($v._ps,$v.mVBData,$v.mEleNum,0,$v.mTexture,$v.transform)})}return $d($g,"laya.ani.GraphicsAni",$$),$g.prototype.drawSkin=function($v){var $g=[$v];this._saveToCmd($q._context._drawSkin,$g)},$g.create=function(){return $g._caches.pop()||new $g},$g.recycle=function($v){$v.clear(),$g._caches.push($v)},$g._caches=[],$g}(),$x=function($v){function $G(){this._aniMap={},this.unfixedLastAniIndex=-1,$G.__super.call(this),this._anis=new Array}$d($G,"laya.ani.AnimationTemplet",$Y);var $g=$G.prototype;return $g.parse=function($v){var $g=new $Zv($v);this._aniVersion=$g.readUTFString(),$s.parse(this,$g)},$g._calculateKeyFrame=function($v,$g,$Q){var $d=$v.keyFrame;$d[$g]=$d[0];for(var $r=0;$r<$g;$r++){var $k=$d[$r];$k.nextData=0===$k.duration?$k.data:$d[$r+1].data}$d.length--},$g.onAsynLoaded=function($v,$g,$Q){var $d=new $Zv($g);switch(this._aniVersion=$d.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$A.parse(this,$d);break;default:$s.parse(this,$d)}this._endLoaded()},$g.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$g.getAnimationCount=function(){return this._anis.length},$g.getAnimation=function($v){return this._anis[$v]},$g.getAniDuration=function($v){return this._anis[$v].playTime},$g.getNodes=function($v){return this._anis[$v].nodes},$g.getNodeIndexWithName=function($v,$g){return this._anis[$v].bone3DMap[$g]},$g.getNodeCount=function($v){return this._anis[$v].nodes.length},$g.getTotalkeyframesLength=function($v){return this._anis[$v].totalKeyframeDatasLength},$g.getPublicExtData=function(){return this._publicExtData},$g.getAnimationDataWithCache=function($v,$g,$Q,$d){var $r=$g[$Q];if($r){var $k=$r[$v];return $k?$k[$d]:null}return null},$g.setAnimationDataWithCache=function($v,$g,$Q,$d,$r){var $k=$g[$Q]||($g[$Q]={});($k[$v]||($k[$v]=[]))[$d]=$r},$g.getOriginalData=function($v,$g,$Q,$d,$r){for(var $k=this._anis[$v].nodes,$$=0,$b=0,$a=$k.length,$M=0;$b<$a;$b++){var $Y,$D=$k[$b];$Y=$D.keyFrame[$Q[$b][$d]],$D.dataOffset=$M;var $J=$r-$Y.startTime,$p=$D.lerpType;if($p)switch($p){case 0:case 1:for($$=0;$$<$D.keyframeWidth;)$$+=$D.interpolationMethod[$$]($D,$$,$g,$M+$$,$Y.data,$J,null,$Y.duration,$Y.nextData);break;case 2:var $T=$Y.interpolationData,$t=$T.length,$q=0;for($$=0;$$<$t;){var $C=$T[$$];switch($C){case 6:case 7:$$+=$G.interpolation[$C]($D,$q,$g,$M+$q,$Y.data,$J,null,$Y.duration,$Y.nextData,$T,$$+1);break;default:$$+=$G.interpolation[$C]($D,$q,$g,$M+$q,$Y.data,$J,null,$Y.duration,$Y.nextData)}$q++}}else for($$=0;$$<$D.keyframeWidth;)$$+=$D.interpolationMethod[$$]($D,$$,$g,$M+$$,$Y.data,$J,null,$Y.duration,$Y.nextData);$M+=$D.keyframeWidth}},$g.getNodesCurrentFrameIndex=function($v,$g){var $Q=this._anis[$v].nodes;$v!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($Q.length),this.unfixedCurrentTimes=new Float32Array($Q.length),this.unfixedLastAniIndex=$v);for(var $d=0,$r=$Q.length;$d<$r;$d++){var $k=$Q[$d];for($g<this.unfixedCurrentTimes[$d]&&(this.unfixedCurrentFrameIndexes[$d]=0),this.unfixedCurrentTimes[$d]=$g;this.unfixedCurrentFrameIndexes[$d]<$k.keyFrame.length&&!($k.keyFrame[this.unfixedCurrentFrameIndexes[$d]].startTime>this.unfixedCurrentTimes[$d]);)this.unfixedCurrentFrameIndexes[$d]++;this.unfixedCurrentFrameIndexes[$d]--}return this.unfixedCurrentFrameIndexes},$g.getOriginalDataUnfixedRate=function($v,$g,$Q){var $d=this._anis[$v].nodes;$v!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($d.length),this.unfixedCurrentTimes=new Float32Array($d.length),this.unfixedKeyframes=$t($d.length),this.unfixedLastAniIndex=$v);for(var $r=0,$k=0,$$=$d.length,$b=0;$k<$$;$k++){var $a=$d[$k];for($Q<this.unfixedCurrentTimes[$k]&&(this.unfixedCurrentFrameIndexes[$k]=0),this.unfixedCurrentTimes[$k]=$Q;this.unfixedCurrentFrameIndexes[$k]<$a.keyFrame.length&&!($a.keyFrame[this.unfixedCurrentFrameIndexes[$k]].startTime>this.unfixedCurrentTimes[$k]);)this.unfixedKeyframes[$k]=$a.keyFrame[this.unfixedCurrentFrameIndexes[$k]],this.unfixedCurrentFrameIndexes[$k]++;var $M=this.unfixedKeyframes[$k];$a.dataOffset=$b;var $Y=$Q-$M.startTime;if($a.lerpType)switch($a.lerpType){case 0:case 1:for($r=0;$r<$a.keyframeWidth;)$r+=$a.interpolationMethod[$r]($a,$r,$g,$b+$r,$M.data,$Y,null,$M.duration,$M.nextData);break;case 2:var $D=$M.interpolationData,$J=$D.length,$p=0;for($r=0;$r<$J;){var $T=$D[$r];switch($T){case 6:case 7:$r+=$G.interpolation[$T]($a,$p,$g,$b+$p,$M.data,$Y,null,$M.duration,$M.nextData,$D,$r+1);break;default:$r+=$G.interpolation[$T]($a,$p,$g,$b+$p,$M.data,$Y,null,$M.duration,$M.nextData)}$p++}}else for($r=0;$r<$a.keyframeWidth;)$r+=$a.interpolationMethod[$r]($a,$r,$g,$b+$r,$M.data,$Y,null,$M.duration,$M.nextData);$b+=$a.keyframeWidth}},$G._LinearInterpolation_0=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){var $Y=0===$b?0:$k/$b;return $Q[$d]=(1-$Y)*$r[$g]+$Y*$a[$g],1},$G._QuaternionInterpolation_1=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){var $Y=0===$b?0:$k/$b;return $J.slerpQuaternionArray($r,$g,$a,$g,$Y,$Q,$d),4},$G._AngleInterpolation_2=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){return 0},$G._RadiansInterpolation_3=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){return 0},$G._Matrix4x4Interpolation_4=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){for(var $Y=0;$Y<16;$Y++,$g++)$Q[$d+$Y]=$r[$g]+$k*$$[$g];return 16},$G._NoInterpolation_5=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M){return $Q[$d]=$r[$g],1},$G._BezierInterpolation_6=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y){return void 0===$Y&&($Y=0),$Q[$d]=$r[$g]+($a[$g]-$r[$g])*$F.getBezierRate($k/$b,$M[$Y],$M[$Y+1],$M[$Y+2],$M[$Y+3]),5},$G._BezierInterpolation_7=function($v,$g,$Q,$d,$r,$k,$$,$b,$a,$M,$Y){return void 0===$Y&&($Y=0),$Q[$d]=$M[$Y+4]+$M[$Y+5]*$F.getBezierRate((.001*$k+$M[$Y+6])/$M[$Y+7],$M[$Y],$M[$Y+1],$M[$Y+2],$M[$Y+3]),9},$G.load=function($v){return $rv.loader.create($v,null,null,$G)},$G.interpolation=[$G._LinearInterpolation_0,$G._QuaternionInterpolation_1,$G._AngleInterpolation_2,$G._RadiansInterpolation_3,$G._Matrix4x4Interpolation_4,$G._NoInterpolation_5,$G._BezierInterpolation_6,$G._BezierInterpolation_7],$G}(),$o=function($g){function $Q($v,$g){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$Q.__super.call(this),void 0===$g&&($g=0),$v&&this.init($v,$g)}$d($Q,"laya.ani.bone.Skeleton",$g);var $v=$Q.prototype;return $v.init=function($v,$g){void 0===$g&&($g=0);var $Q,$d,$r,$k=0,$$=0;if(1==$g)for(this._graphicsCache=[],$k=0,$$=$v.getAnimationCount();$k<$$;$k++)this._graphicsCache.push([]);if(this._yReverseMatrix=$v.yReverseMatrix,this._aniMode=$g,this._templet=$v,this._player=new $l,this._player.cacheFrameRate=$v.rate,this._player.templet=$v,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$v.mBoneArr,this._rootBone=$v.mRootBone,this._aniSectionDic=$v.aniSectionDic,0<$v.ikArr.length)for(this._ikArr=[],$k=0,$$=$v.ikArr.length;$k<$$;$k++)this._ikArr.push(new $G($v.ikArr[$k],this._boneList));if(0<$v.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$k=0,$$=$v.pathArr.length;$k<$$;$k++)$Q=$v.pathArr[$k],$d=new $h($Q,this._boneList),($r=this._boneSlotDic[$Q.name])&&(($d=new $h($Q,this._boneList)).target=$r),this._pathDic[$Q.name]=$d;if(0<$v.tfArr.length)for(this._tfArr=[],$k=0,$$=$v.tfArr.length;$k<$$;$k++)this._tfArr.push(new $P($v.tfArr[$k],this._boneList));if(0<$v.skinDataArray.length){var $b=this._templet.skinDataArray[this._skinIndex];this._skinName=$b.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$v.load=function($v,$g,$Q){},$v._onLoaded=function(){},$v._parseComplete=function(){var $v=$E.TEMPLET_DICTIONARY[this._aniPath];$v&&(this.init($v,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$v._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$v._onPlay=function(){this.event("played")},$v._onStop=function(){var $v,$g=this._templet.eventAniArr[this._aniClipIndex];if($g&&this._eventIndex<$g.length)for(;this._eventIndex<$g.length;this._eventIndex++)($v=$g[this._eventIndex]).time>=this._player.playStart&&$v.time<=this._player.playEnd&&this.event("label",$v);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$v._onPause=function(){this.event("paused")},$v._parseSrcBoneMatrix=function(){var $v=0,$g=0;for($g=this._templet.srcBoneMatrixArr.length,$v=0;$v<$g;$v++)this._boneMatrixArray.push(new $fv);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $Q,$d,$r=this._templet.boneSlotArray;for($v=0,$g=$r.length;$v<$g;$v++)$Q=$r[$v],null==($d=this._bindBoneBoneSlotDic[$Q.parent])&&(this._bindBoneBoneSlotDic[$Q.parent]=$d=[]),this._boneSlotDic[$Q.name]=$Q=$Q.copy(),$d.push($Q),this._boneSlotArray.push($Q)}},$v._emitMissedEvents=function($v,$g,$Q){void 0===$Q&&($Q=0);var $d=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($d){var $r,$k,$$=0;for($r=$d.length,$$=$Q;$$<$r;$$++)($k=$d[$$]).time>=this._player.playStart&&$k.time<=this._player.playEnd&&this.event("label",$k)}},$v._update=function($v){if(void 0===$v&&($v=!0),!(this._pause||$v&&this._indexControl)){var $g=this.timer.currTimer,$Q=this._player.currentKeyframeIndex,$d=$g-this._lastTime;if($v?this._player._update($d):$Q=-1,this._lastTime=$g,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$d&&this._clipIndex==$Q&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $r;this._lastUpdateAniClipIndex=this._aniClipIndex,$Q>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $k,$$=this._templet.eventAniArr[this._aniClipIndex];if($$&&this._eventIndex<$$.length&&(($r=$$[this._eventIndex]).time>=this._player.playStart&&$r.time<=this._player.playEnd?this._player.currentPlayTime>=$r.time&&(this.event("label",$r),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($k=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$k&&(this.graphics=$k));var $b=0,$a=0;for($a=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$a-1)&&0<$a;)$a--;if($a<this._clipIndex)for($b=$a;$b<this._clipIndex;$b++)this._createGraphics($b)}else if(1==this._aniMode){if($k=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$k&&(this.graphics=$k));for($a=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$a-1)&&0<$a;)$a--;if($a<this._clipIndex)for($b=$a;$b<this._clipIndex;$b++)this._createGraphics($b)}this._createGraphics()}}},$v._createGraphics=function($v){void 0===$v&&($v=-1),-1==$v&&($v=this._clipIndex);var $g,$Q,$d=$v*this._player.cacheFrameRateInterval,$r=this._templet.drawOrderAniArr[this._aniClipIndex];if($r&&0<$r.length)for(this._drawOrderIndex=0,$g=$r[this._drawOrderIndex];$d>=$g.time&&(this._drawOrder=$g.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$r.length));)$g=$r[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$i.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$i.create(),$Q=this.graphics;var $k=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$v,$d);var $$,$b,$a,$M,$Y=this._aniSectionDic[this._aniClipIndex],$D=0,$J=0,$p=0,$T=0,$t=0,$q=this._templet.srcBoneMatrixArr.length;for($t=$Y[$J=0];$J<$q;$J++)$M=this._boneList[$J],$a=this._templet.srcBoneMatrixArr[$J],$M.resultTransform.scX=$a.scX*this._curOriginalData[$D++],$M.resultTransform.skX=$a.skX+this._curOriginalData[$D++],$M.resultTransform.skY=$a.skY+this._curOriginalData[$D++],$M.resultTransform.scY=$a.scY*this._curOriginalData[$D++],$M.resultTransform.x=$a.x+this._curOriginalData[$D++],$M.resultTransform.y=$a.y+this._curOriginalData[$D++],8===this._templet.tMatrixDataLen&&($M.resultTransform.skewX=$a.skewX+this._curOriginalData[$D++],$M.resultTransform.skewY=$a.skewY+this._curOriginalData[$D++]);var $C,$G={},$s={};for($t+=$Y[1];$J<$t;$J++)$G[($C=$k[$J]).name]=this._curOriginalData[$D++],$s[$C.name]=this._curOriginalData[$D++],this._curOriginalData[$D++],this._curOriginalData[$D++],this._curOriginalData[$D++],this._curOriginalData[$D++];var $A,$h,$P={},$W={};for($t+=$Y[2];$J<$t;$J++)$P[($C=$k[$J]).name]=this._curOriginalData[$D++],$W[$C.name]=this._curOriginalData[$D++],this._curOriginalData[$D++],this._curOriginalData[$D++],this._curOriginalData[$D++],this._curOriginalData[$D++];if(this._pathDic)for($t+=$Y[3];$J<$t;$J++){if($C=$k[$J],$A=this._pathDic[$C.name])switch(new $Zv($C.extenData).getByte()){case 1:$A.position=this._curOriginalData[$D++];break;case 2:$A.spacing=this._curOriginalData[$D++];break;case 3:$A.rotateMix=this._curOriginalData[$D++],$A.translateMix=this._curOriginalData[$D++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($fv.TEMP.identity()),this._ikArr)for($J=0,$t=this._ikArr.length;$J<$t;$J++)$h=this._ikArr[$J],$P.hasOwnProperty($h.name)&&($h.bendDirection=$P[$h.name]),$W.hasOwnProperty($h.name)&&($h.mix=$W[$h.name]),$h.apply();if(this._pathDic)for(var $F in this._pathDic)($A=this._pathDic[$F]).apply(this._boneList,$Q);if(this._tfArr)for($J=0,$T=this._tfArr.length;$J<$T;$J++)this._tfArr[$J].apply();for($J=0,$T=this._boneList.length;$J<$T;$J++)if($M=this._boneList[$J],$b=this._bindBoneBoneSlotDic[$M.name],$M.resultMatrix.copyTo(this._boneMatrixArray[$J]),$b)for($p=0,$t=$b.length;$p<$t;$p++)($$=$b[$p])&&$$.setParentMatrix($M.resultMatrix);var $l,$o,$E,$V,$Z={},$f=this._templet.deformAniArr;if($f&&0<$f.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$J=0,$t=this._boneSlotArray.length;$J<$t;$J++)($$=this._boneSlotArray[$J]).deformData=null;var $X,$N=$f[this._aniClipIndex];for($X in $l=$N.default,this._setDeform($l,$Z,this._boneSlotArray,$d),$N)"default"!=$X&&$X!=this._skinName&&($l=$N[$X],this._setDeform($l,$Z,this._boneSlotArray,$d));$l=$N[this._skinName],this._setDeform($l,$Z,this._boneSlotArray,$d)}if(this._drawOrder)for($J=0,$t=this._drawOrder.length;$J<$t;$J++)$o=$G[($$=this._boneSlotArray[this._drawOrder[$J]]).name],$E=$s[$$.name],isNaN($E)||($Q.save(),$Q.alpha($E)),isNaN($o)||-2==$o||(this._templet.attachmentNames?$$.showDisplayByName(this._templet.attachmentNames[$o]):$$.showDisplayByIndex($o)),$Z[this._drawOrder[$J]]?($V=$Z[this._drawOrder[$J]],$$.currDisplayData&&$V[$$.currDisplayData.attachmentName]?$$.deformData=$V[$$.currDisplayData.attachmentName]:$$.deformData=null):$$.deformData=null,isNaN($E)?$$.draw($Q,this._boneMatrixArray,2==this._aniMode):$$.draw($Q,this._boneMatrixArray,2==this._aniMode,$E),isNaN($E)||$Q.restore();else for($J=0,$t=this._boneSlotArray.length;$J<$t;$J++)$o=$G[($$=this._boneSlotArray[$J]).name],$E=$s[$$.name],isNaN($E)||($Q.save(),$Q.alpha($E)),isNaN($o)||-2==$o||(this._templet.attachmentNames?$$.showDisplayByName(this._templet.attachmentNames[$o]):$$.showDisplayByIndex($o)),$Z[$J]?($V=$Z[$J],$$.currDisplayData&&$V[$$.currDisplayData.attachmentName]?$$.deformData=$V[$$.currDisplayData.attachmentName]:$$.deformData=null):$$.deformData=null,isNaN($E)?$$.draw($Q,this._boneMatrixArray,2==this._aniMode):$$.draw($Q,this._boneMatrixArray,2==this._aniMode,$E),isNaN($E)||$Q.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$v,$Q):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$v,$Q)},$v._setDeform=function($v,$g,$Q,$d){if($v){var $r,$k,$$,$b=0,$a=0,$M=0;if($v)for($b=0,$a=$v.deformSlotDataList.length;$b<$a;$b++)for($r=$v.deformSlotDataList[$b],$M=0;$M<$r.deformSlotDisplayList.length;$M++)$$=$Q[($k=$r.deformSlotDisplayList[$M]).slotIndex],$k.apply($d,$$),$g[$k.slotIndex]||($g[$k.slotIndex]={}),$g[$k.slotIndex][$k.attachment]=$k.deformData}},$v.getAnimNum=function(){return this._templet.getAnimationCount()},$v.getAniNameByIndex=function($v){return this._templet.getAniNameByIndex($v)},$v.getSlotByName=function($v){return this._boneSlotDic[$v]},$v.showSkinByName=function($v,$g){void 0===$g&&($g=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($v),$g)},$v.showSkinByIndex=function($v,$g){void 0===$g&&($g=!0);for(var $Q=0;$Q<this._boneSlotArray.length;$Q++)this._boneSlotArray[$Q].showSlotData(null,$g);if(this._templet.showSkinByIndex(this._boneSlotDic,$v,$g)){var $d=this._templet.skinDataArray[$v];this._skinIndex=$v,this._skinName=$d.name}this._clearCache()},$v.showSlotSkinByIndex=function($v,$g){if(0!=this._aniMode){var $Q=this.getSlotByName($v);$Q&&$Q.showDisplayByIndex($g),this._clearCache()}},$v.showSlotSkinByName=function($v,$g){if(0!=this._aniMode){var $Q=this.getSlotByName($v);$Q&&$Q.showDisplayByName($g),this._clearCache()}},$v.replaceSlotSkinName=function($v,$g,$Q){if(0!=this._aniMode){var $d=this.getSlotByName($v);$d&&$d.replaceDisplayByName($g,$Q),this._clearCache()}},$v.replaceSlotSkinByIndex=function($v,$g,$Q){if(0!=this._aniMode){var $d=this.getSlotByName($v);$d&&$d.replaceDisplayByIndex($g,$Q),this._clearCache()}},$v.setSlotSkin=function($v,$g){if(0!=this._aniMode){var $Q=this.getSlotByName($v);$Q&&$Q.replaceSkin($g),this._clearCache()}},$v._clearCache=function(){if(1==this._aniMode)for(var $v=0,$g=this._graphicsCache.length;$v<$g;$v++){for(var $Q=0,$d=this._graphicsCache[$v].length;$Q<$d;$Q++){var $r=this._graphicsCache[$v][$Q];$r!=this.graphics&&$i.recycle($r)}this._graphicsCache[$v].length=0}},$v.play=function($v,$g,$Q,$d,$r,$k){void 0===$Q&&($Q=!0),void 0===$d&&($d=0),void 0===$r&&($r=0),void 0===$k&&($k=!0),this._indexControl=!1;var $$=-1,$b=NaN;if($b=$g?2147483647:0,"string"==typeof $v)for(var $a=0,$M=this._templet.getAnimationCount();$a<$M;$a++){var $Y=this._templet.getAnimation($a);if($Y&&$v==$Y.name){$$=$a;break}}else $$=$v;-1<$$&&$$<this.getAnimNum()&&(this._aniClipIndex=$$,($Q||this._pause||this._currAniIndex!=$$)&&(this._currAniIndex=$$,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($$)),this._drawOrder=null,this._eventIndex=0,this._player.play($$,this._player.playbackRate,$b,$d,$r),$k&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$D.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$v.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$v.playbackRate=function($v){this._player&&(this._player.playbackRate=$v)},$v.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$v.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$D.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$v._getGrahicsDataWithCache=function($v,$g){return this._graphicsCache[$v][$g]},$v._setGrahicsDataWithCache=function($v,$g,$Q){this._graphicsCache[$v][$g]=$Q},$v.destroy=function($v){void 0===$v&&($v=!0),$g.prototype.destroy.call(this,$v),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$k(0,$v,"url",function(){return this._aniPath},function($v){this.load($v)}),$k(0,$v,"index",function(){return this._index},function($v){this.player&&(this._index=$v,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$k(0,$v,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$k(0,$v,"templet",function(){return this._templet}),$k(0,$v,"player",function(){return this._player}),$Q.useSimpleMeshInCanvas=!1,$Q}($kv),$E=function($g){function $r(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$r.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$d($r,"laya.ani.bone.Templet",$g);var $v=$r.prototype;return $v.getLoadList=function(){return this._loadList},$v.loadAni=function($v){this._skBufferUrl=$v,$rv.loader.load($v,$a.create(this,this.onComplete),null,"arraybuffer")},$v.onComplete=function($v){if(this._isDestroyed)this.destroy();else{var $g=$M.getRes(this._skBufferUrl);$g?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$g)):this.event("error","load failed:"+this._skBufferUrl)}},$v.parseData=function($v,$g,$Q){void 0===$Q&&($Q=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$v,this._mainTexture&&$q.isWebGL&&$v.bitmap&&($v.bitmap.enableMerageInAtlas=!1),this._rate=$Q,this.parse($g)},$v.buildArmature=function($v){return void 0===$v&&($v=0),new $o(this,$v)},$v.parse=function($v){$g.prototype.parse.call(this,$v),this._endLoaded(),this._aniVersion!=$r.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$r.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$v._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $v=0;this._loadList=[];var $g,$Q=new $Zv(this.getPublicExtData()),$d=0,$r=0,$k=0,$$=$Q.getInt32(),$b=$Q.readUTFString(),$a=$b.split("\n");for($v=0;$v<$$;$v++)$g=this._path+$a[2*$v],$b=$a[2*$v+1],$Q.getFloat32(),$Q.getFloat32(),$d=$Q.getFloat32(),$r=$Q.getFloat32(),$k=$Q.getFloat32(),isNaN($k)?0:$k,$k=$Q.getFloat32(),isNaN($k)?0:$k,$k=$Q.getFloat32(),isNaN($k)?$d:$k,$k=$Q.getFloat32(),isNaN($k)?$r:$k,-1==this._loadList.indexOf($g)&&this._loadList.push($g);this.event("inited",this)}},$v._textureComplete=function(){for(var $v,$g,$Q=0,$d=this._loadList.length;$Q<$d;$Q++)$g=this._loadList[$Q],$v=this._textureDic[$g]=$M.getRes($g),$q.isWebGL&&$v&&$v.bitmap&&($v.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$v._parsePublicExtData=function(){var $v=0,$g=0,$Q=0,$d=0,$r=0;for($v=0,$r=this.getAnimationCount();$v<$r;$v++)this._graphicsCache.push([]);var $k;$k="Dragon"!=this._aniClassName;var $$,$b,$a=new $Zv(this.getPublicExtData()),$M=0,$Y=0,$D=0,$J=0,$p=0,$T=0,$t=0,$q=0,$C=0,$G=$a.getInt32(),$s=$a.readUTFString(),$A=$s.split("\n");for($v=0;$v<$G;$v++){if($$=this._mainTexture,$b=this._path+$A[2*$v],$s=$A[2*$v+1],null==this._mainTexture&&($$=this._textureDic[$b]),!$$)return this.event("error",this),void(this.isParseFail=!0);$M=$a.getFloat32(),$Y=$a.getFloat32(),$D=$a.getFloat32(),$J=$a.getFloat32(),$C=$a.getFloat32(),$p=isNaN($C)?0:$C,$C=$a.getFloat32(),$T=isNaN($C)?0:$C,$C=$a.getFloat32(),$t=isNaN($C)?$D:$C,$C=$a.getFloat32(),$q=isNaN($C)?$J:$C,this.subTextureDic[$s]=$Xv.create($$,$M,$Y,$D,$J,-$p,-$T,$t,$q),$$.alphaTexture&&(this.subTextureDic[$s].alphaTexture=$Xv.create($$.alphaTexture,$M,$Y,$D,$J,-$p,-$T,$t,$q))}this._mainTexture=$$;var $h,$P,$W,$F,$l,$o=$a.getUint16();for($v=0;$v<$o;$v++)($h=[]).push($a.getUint16()),$h.push($a.getUint16()),$h.push($a.getUint16()),$h.push($a.getUint16()),this.aniSectionDic[$v]=$h;var $E,$V=$a.getInt16(),$Z={};for($v=0;$v<$V;$v++)$P=new $Nv,0==$v?$E=$P:$P.root=$E,$P.d=$k?-1:1,$F=$a.readUTFString(),$l=$a.readUTFString(),$P.length=$a.getFloat32(),1==$a.getByte()&&($P.inheritRotation=!1),1==$a.getByte()&&($P.inheritScale=!1),$P.name=$F,$l&&(($W=$Z[$l])?$W.addChild($P):this.mRootBone=$P),$Z[$F]=$P,this.mBoneArr.push($P);this.tMatrixDataLen=$a.getUint16();var $f,$X,$N=$a.getUint16(),$i=Math.floor($N/this.tMatrixDataLen),$x=this.srcBoneMatrixArr;for($v=0;$v<$i;$v++)($f=new $ev).scX=$a.getFloat32(),$f.skX=$a.getFloat32(),$f.skY=$a.getFloat32(),$f.scY=$a.getFloat32(),$f.x=$a.getFloat32(),$f.y=$a.getFloat32(),8===this.tMatrixDataLen&&($f.skewX=$a.getFloat32(),$f.skewY=$a.getFloat32()),$x.push($f),($P=this.mBoneArr[$v]).transform=$f;var $w,$m=$a.getUint16(),$K=0;for($v=0;$v<$m;$v++){for($X=new $Bv,$K=$a.getUint16(),$g=0;$g<$K;$g++)$X.boneNames.push($a.readUTFString()),$X.boneIndexs.push($a.getInt16());$X.name=$a.readUTFString(),$X.targetBoneName=$a.readUTFString(),$X.targetBoneIndex=$a.getInt16(),$X.bendDirection=$a.getFloat32(),$X.mix=$a.getFloat32(),$X.isSpine=$k,this.ikArr.push($X)}var $c,$B=$a.getUint16(),$j=0;for($v=0;$v<$B;$v++){for($w=new $yv,$j=$a.getUint16(),$g=0;$g<$j;$g++)$w.boneIndexs.push($a.getInt16());$w.name=$a.getUTFString(),$w.targetIndex=$a.getInt16(),$w.rotateMix=$a.getFloat32(),$w.translateMix=$a.getFloat32(),$w.scaleMix=$a.getFloat32(),$w.shearMix=$a.getFloat32(),$w.offsetRotation=$a.getFloat32(),$w.offsetX=$a.getFloat32(),$w.offsetY=$a.getFloat32(),$w.offsetScaleX=$a.getFloat32(),$w.offsetScaleY=$a.getFloat32(),$w.offsetShearY=$a.getFloat32(),this.tfArr.push($w)}var $L=$a.getUint16(),$H=0;for($v=0;$v<$L;$v++){for(($c=new $jv).name=$a.readUTFString(),$H=$a.getUint16(),$g=0;$g<$H;$g++)$c.bones.push($a.getInt16());$c.target=$a.readUTFString(),$c.positionMode=$a.readUTFString(),$c.spacingMode=$a.readUTFString(),$c.rotateMode=$a.readUTFString(),$c.offsetRotation=$a.getFloat32(),$c.position=$a.getFloat32(),$c.spacing=$a.getFloat32(),$c.rotateMix=$a.getFloat32(),$c.translateMix=$a.getFloat32(),this.pathArr.push($c)}var $n,$y,$e,$R,$z,$U=0,$I=0,$S=0,$O=NaN,$_=0,$u=$a.getInt16();for($v=0;$v<$u;$v++){var $vv=$a.getUint8(),$gv={};this.deformAniArr.push($gv);for(var $Qv=0;$Qv<$vv;$Qv++)for(($n=new $xv).skinName=$a.getUTFString(),$gv[$n.skinName]=$n,$U=$a.getInt16(),$g=0;$g<$U;$g++)for($y=new $wv,$n.deformSlotDataList.push($y),$I=$a.getInt16(),$Q=0;$Q<$I;$Q++)for($e=new $mv,$y.deformSlotDisplayList.push($e),$e.slotIndex=$a.getInt16(),$e.attachment=$a.getUTFString(),$S=$a.getInt16(),$d=0;$d<$S;$d++)for(1==$a.getByte()?$e.tweenKeyList.push(!0):$e.tweenKeyList.push(!1),$O=$a.getFloat32(),$e.timeList.push($O),$R=[],$e.vectices.push($R),$_=$a.getInt16(),$r=0;$r<$_;$r++)$R.push($a.getFloat32())}var $dv,$rv,$kv=$a.getInt16(),$$v=0,$bv=0;for($v=0;$v<$kv;$v++){for($$v=$a.getInt16(),$z=[],$g=0;$g<$$v;$g++){for(($dv=new $Kv).time=$a.getFloat32(),$bv=$a.getInt16(),$Q=0;$Q<$bv;$Q++)$dv.drawOrder.push($a.getInt16());$z.push($dv)}this.drawOrderAniArr.push($z)}var $av,$Mv=$a.getInt16(),$Yv=0;for($v=0;$v<$Mv;$v++){for($Yv=$a.getInt16(),$rv=[],$g=0;$g<$Yv;$g++)($av=new $cv).name=$a.getUTFString(),$av.intValue=$a.getInt32(),$av.floatValue=$a.getFloat32(),$av.stringValue=$a.getUTFString(),$av.time=$a.getFloat32(),$rv.push($av);this.eventAniArr.push($rv)}var $Dv=$a.getInt16();if(0<$Dv)for(this.attachmentNames=[],$v=0;$v<$Dv;$v++)this.attachmentNames.push($a.getUTFString());var $Jv,$pv,$Tv=$a.getInt16();for($v=0;$v<$Tv;$v++)($Jv=new $iv).name=$a.readUTFString(),$Jv.parent=$a.readUTFString(),$Jv.attachmentName=$a.readUTFString(),$Jv.srcDisplayIndex=$Jv.displayIndex=$a.getInt16(),($Jv.templet=this).boneSlotDic[$Jv.name]=$Jv,null==($pv=this.bindBoneBoneSlotDic[$Jv.parent])&&(this.bindBoneBoneSlotDic[$Jv.parent]=$pv=[]),$pv.push($Jv),this.boneSlotArray.push($Jv);var $tv,$qv,$Cv,$Gv=$a.readUTFString().split("\n"),$sv=0,$Av=$a.getUint8(),$hv=0,$Pv=0,$Wv=0,$Fv=0,$lv=0,$ov=0,$Ev=0;for($v=0;$v<$Av;$v++){for(($tv=new $Lv).name=$Gv[$sv++],$hv=$a.getUint8(),$g=0;$g<$hv;$g++){for(($qv=new $nv).name=$Gv[$sv++],$Jv=this.boneSlotDic[$qv.name],$Pv=$a.getUint8(),$Q=0;$Q<$Pv;$Q++){if($Cv=new $Hv,this.skinSlotDisplayDataArr.push($Cv),$Cv.name=$Gv[$sv++],$Cv.attachmentName=$Gv[$sv++],$Cv.transform=new $ev,$Cv.transform.scX=$a.getFloat32(),$Cv.transform.skX=$a.getFloat32(),$Cv.transform.skY=$a.getFloat32(),$Cv.transform.scY=$a.getFloat32(),$Cv.transform.x=$a.getFloat32(),$Cv.transform.y=$a.getFloat32(),$qv.displayArr.push($Cv),$Cv.width=$a.getFloat32(),$Cv.height=$a.getFloat32(),$Cv.type=$a.getUint8(),$Cv.verLen=$a.getUint16(),0<($V=$a.getUint16()))for($Cv.bones=[],$d=0;$d<$V;$d++){var $Vv=$a.getUint16();$Cv.bones.push($Vv)}if(0<($Wv=$a.getUint16()))for($Cv.uvs=[],$d=0;$d<$Wv;$d++)$Cv.uvs.push($a.getFloat32());if(0<($Fv=$a.getUint16()))for($Cv.weights=[],$d=0;$d<$Fv;$d++)$Cv.weights.push($a.getFloat32());if(0<($lv=$a.getUint16()))for($Cv.triangles=[],$d=0;$d<$lv;$d++)$Cv.triangles.push($a.getUint16());if(0<($ov=$a.getUint16()))for($Cv.vertices=[],$d=0;$d<$ov;$d++)$Cv.vertices.push($a.getFloat32());if(0<($Ev=$a.getUint16()))for($Cv.lengths=[],$d=0;$d<$Ev;$d++)$Cv.lengths.push($a.getFloat32())}$tv.slotArr.push($qv)}this.skinDic[$tv.name]=$tv,this.skinDataArray.push($tv)}1==$a.getUint8()?(this.yReverseMatrix=new $fv(1,0,0,-1,0,0),$E&&$E.setTempMatrix(this.yReverseMatrix)):$E&&$E.setTempMatrix(new $fv),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$v.getTexture=function($v){var $g=this.subTextureDic[$v];return $g||($g=this.subTextureDic[$v.substr(0,$v.length-1)]),null==$g?this._mainTexture:$g},$v.showSkinByIndex=function($v,$g,$Q){if(void 0===$Q&&($Q=!0),$g<0&&$g>=this.skinDataArray.length)return!1;var $d,$r,$k=0,$$=0,$b=this.skinDataArray[$g];if($b){for($k=0,$$=$b.slotArr.length;$k<$$;$k++)($r=$b.slotArr[$k])&&($d=$v[$r.name])&&($d.showSlotData($r,$Q),$Q&&"undefined"!=$d.attachmentName&&"null"!=$d.attachmentName?$d.showDisplayByName($d.attachmentName):$d.showDisplayByIndex($d.displayIndex));return!0}return!1},$v.getSkinIndexByName=function($v){for(var $g=0,$Q=this.skinDataArray.length;$g<$Q;$g++)if(this.skinDataArray[$g].name==$v)return $g;return-1},$v.getGrahicsDataWithCache=function($v,$g){return this._graphicsCache[$v][$g]},$v.setGrahicsDataWithCache=function($v,$g,$Q){this._graphicsCache[$v][$g]=$Q},$v.destroy=function(){var $v;for(var $g in this._isDestroyed=!0,this.subTextureDic)($v=this.subTextureDic[$g])&&$v.destroy();for($g in this._textureDic)($v=this._textureDic[$g])&&$v.destroy();for(var $Q=0,$d=this.skinSlotDisplayDataArr.length;$Q<$d;$Q++)this.skinSlotDisplayDataArr[$Q].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $r.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$v.getAniNameByIndex=function($v){var $g=this.getAnimation($v);return $g?$g.name:null},$k(0,$v,"rate",function(){return this._rate},function($v){this._rate=$v}),$r.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$r.TEMPLET_DICTIONARY=null,$r}($x)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($v,$g){"use strict";for(var $Q in Object.defineProperty($g,"__esModule",{value:!0}),Laya){var $d=Laya[$Q];$d&&$d.__isclass&&($g[$Q]=$d)}});