"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_config=require("../config"),_config2=_interopRequireDefault(_config),_constant=require("./constant"),_constant2=_interopRequireDefault(_constant),_sha=require("./sha1"),_sha2=_interopRequireDefault(_sha);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var MD5=require("./md5"),urlDebug=!1,debug=!1,HOST_DEUBG="https://api-sandbox.xiyousdk.com/",HOST_RELEASE="https://api.xiyousdk.com/",appKey=null,sessionId=null,Common=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"debugStatus",set:function(e){debug=!!e},get:function(){return debug}}],[{key:"xylog",value:function(){debug&&console.log&&("function"==typeof console.log.apply?console.log.apply(console,arguments):console.log(arguments[0]))}},{key:"getDeviceId",value:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),t=new RegExp("-","g");return e=e.replace(t,"")}},{key:"serHost",value:function(){return urlDebug?HOST_DEUBG:HOST_RELEASE}},{key:"wxRequest",value:function(e,t,n,a,u){var n=i.buildSortMD5Sign(n),o=void 0,o=-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?e:(_constant2.default.debug()?HOST_DEUBG:HOST_RELEASE)+e;i.xylog(o),i.xylog("md5data:",n),wx.request({url:o,header:{"content-type":"application/x-www-form-urlencoded"},method:t,data:n,success:function(e){a(e)},fail:function(e){u(e)}})}},{key:"request",value:function(e){var t=e.url,t=void 0===t?"":t,n=e.header,n=void 0===n?{}:n,a=e.method,u=e.data,o=e.success,r=e.fail,e=void 0,e=-1!=t.indexOf("http://")||-1!=t.indexOf("https://")?t:(_constant2.default.debug()?HOST_DEUBG:HOST_RELEASE)+t,t=Object.assign({"content-type":"application/x-www-form-urlencoded"},n);wx.request({url:e,header:t,method:a,data:u,success:function(e){o(e)},fail:function(e){r(e)}})}},{key:"buildSortMD5Sign",value:function(e){for(var t=Object.keys(e).sort(),n={},a=0;a<t.length;a++)n[t[a]]=e[t[a]];for(var u=Object.keys(n).sort(),o="",a=0;a<u.length;a++)o+=u[a]+"="+n[u[a]]+"&";var o=o.substring(0,o.length-1),r=new _config2.default;return i.xylog("config :",r.appKey),o+=r.appKey,i.xylog("sign:",o),console.log(o),n.sign=MD5.hex_md5(o),n.sign_type="MD5",n}},{key:"respJson",value:function(e,t,n){return{msg:e,status:t?i.Status().Success:i.Status().Fail,data:n}}},{key:"compare",value:function(n){return function(e,t){e=e[n],t=t[n];return e<t?-1:t<e?1:0}}},{key:"Status",value:function(){return{Success:1,Fail:0,Pay_Success:9,Pay_Fail:10,Pay_Wait:11,Pay_Cancel:12,Pay_Qrcode:13}}},{key:"isRealNum",value:function(e){return""!==e&&null!=e&&!isNaN(e)}},{key:"isStrEmpty",value:function(e){return void 0===e||null==e||""==e}},{key:"getSessionId",value:function(){var e,t;return null===sessionId&&(e=i.getDeviceId(),t=899999*Math.random()+1e5,t=parseInt(t,10),sessionId=MD5.hex_md5(e+t).toLowerCase()),sessionId}},{key:"signSha1",value:function(){var e=[].slice.call(arguments,0),t=(e.sort(),"");return e.forEach(function(e){t+=e}),(0,_sha2.default)(t)}},{key:"dateDelayDay",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=new Date(e);return e.setTime(e.getTime()+864e5*t),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}},{key:"isDuringDate",value:function(e,t){var n=new Date,e=e instanceof Date?e:new Date(e),t=t instanceof Date?t:new Date(t);return e<=n&&n<=t}},{key:"getStartTimeAndEndTime",value:function(e){return e=new Date(e),{startTime:new Date(e.setHours(0,0,0,0)),endTime:new Date(e.setHours(23,59,59,999))}}}]),i}();exports.default=Common;